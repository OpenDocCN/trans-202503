# 第十二章：水面上的月亮

与你的主公达成协议后，你应该用诱饵引诱敌人，潜入他们的防线。

> 在此技巧中，你应该像在海中或河里钓鱼一样，用诱人的诱饵引诱敌人，以使原本不会现身的敌人最终离开防线。
> 
> —《万川集海》，Yo-nin II ^(1)

在如同俳句般的意境中，*万川集海*称开放伪装潜入技巧为*水月之术*——“水面上的月亮”之术。^(2) 尽管该术有多种用途，但忍者主要用于攻击那些防守森严的敌人营地——这种营地限制了人员的进出，甚至无法接近。忍者并不是通过强行突破营地防线，而是诱使目标现身，巧妙地引诱目标泄露入营的相关规定，例如徽章及其他身份标志、密码、口令和挑战应答信号。此术还允许忍者尾随目标返回营地，诱使守卫离开岗哨并无阻渗透，或者直接与目标接触并通过欺骗或攻击手段渗透。

对于那些特别不愿离开防守严密的目标，卷轴指示忍者寻求指挥官的帮助，进行高级的欺骗策略。^(3) 例如，指挥官可以将部队调动到脆弱位置，诱使敌人攻击，从而消耗敌人的防御，使忍者得以渗透。或者，忍者在敌人疲惫归营时击败他们。指挥官甚至可能安排更为复杂的方案，比如开始一场全面的长期城堡围攻。然后，忍者可能派遣一名伪装成盟军将军使者的士兵，劝说敌人离开城堡，参与反攻并打破围攻。为了完成这个诡计，忍者指挥官会派遣一支小队伪装成盟军增援，不仅引诱目标离开营地，也让忍者在城门打开时得以渗透。

根据卷轴内容，在忍者成功使用*水月之术*潜入目标后，他们必须牢记以下思维：

+   保持冷静，不要表现出迷失。

+   模仿城中人。

+   优先收集口令、密码、挑战应答、徽章等信息。

+   尽快向盟友发出信号。^(4)

在这一章中，我们将探讨这种古老技术如何被网络威胁行为者部署，并与常见的社会工程学战术进行比较。我们将介绍一种抽象思考网络通信信号的方式，认为它们进入和/或离开防火墙——尽管计算机系统本身并未发生物理移动——并详细讲解应对“水面月亮”技术和社会工程学攻击的概念。最后，我们将尝试一个思维练习场景，模拟古代日本将军们在遭遇“水面月亮”攻击时可能面临的困境。

## 社会工程学

忍者“水面月亮”攻击与今天的*社会工程学*攻击有惊人的相似之处，它们利用人类目标的决策过程和认知偏差，操控目标泄露敏感信息或执行自毁性行动。在网络安全中，大多数社会工程学战术是敌方在敌人阵地内部操作，利用目标的信任进行攻击。典型的社会工程学攻击示例包括：

1.  网络钓鱼 敌方发送一封邮件，诱使收件人打开危险的文档或访问恶意链接，导致恶意软件感染、勒索软件执行、数据盗窃或其他攻击。

1.  伪装攻击 敌方通过电话或电子邮件，以编造的情景说服目标泄露敏感信息或执行恶意行动。

1.  诱饵攻击 敌方策略性地将恶意的可移动媒体（如 USB 驱动器）放置在物理位置上，诱使目标捡起并将其连接到内部系统，从而为系统入侵创造机会。

社会工程学是一个特别具有挑战性的安全问题，因为它利用了人性上的弱点，而这些弱点是技术控制措施无法始终防范的。随着目标和受害者对社会工程学威胁的认识不断提高，许多组织依赖于专注的技术控制、安全协议和用户教育来保护其宝贵资产。员工接受如何正确处理和保护敏感信息和系统的培训，同时安全团队记录程序以验证陌生或未受邀请的访客身份，并要求非员工在公司场地内由员工陪同。红队进行内部钓鱼攻击和尾随测试等演练，以评估员工对社会工程学战术的意识并增强他们的抵抗力。管理员实施技术控制措施，以阻止恶意文档和链接，使用数据丢失防护（DLP）软件，防止未授权的系统变更，黑名单未注册的系统和外部媒体，并使用来电显示。

尽管这些都是很好的、必要的安全措施，但人们的工作方式已经发生了变化。而且，围绕社会工程学攻击的思维尚未完全发展，无法充分考虑防御“月亮水面”式攻击——即试图诱使目标脱离自身防御的攻击。

今天，像自带设备（BYOD）政策、全职远程工作和多租户云等，使得员工和组织更加灵活。然而，它们也削弱了传统的强大外围安全架构，并使员工暴露于新的社会工程学威胁中。例如，在大多数情况下，状态防火墙规则不允许外部（互联网）通信通过防火墙传递到内部主机。相反，防火墙要求内部（内网）系统发起联系，然后才允许外部系统的响应通过防火墙传递到内部主机。因此，虽然内部主机物理上没有离开组织的防御，但如果通过虚拟方式——比如访问恶意网站——就可能使威胁行为者通过响应通信渗透进来。本质上，这就是数字尾随。

除了直接破坏传统的安全架构，威胁行为者还可以使用多种“月亮水面”式的技术渗透重防御组织。考虑以下场景：

+   一名攻击者在一个安全设施中触发火灾报警，导致员工大量撤离。当消防员清理建筑物时，攻击者混入员工人群中，窃取或记录徽章、钥匙、令牌、面孔、指纹等信息。为了顺畅处理员工返回工作，设施暂时关闭徽章读取器、旋转门或其他物理访问控制，或者由于人员涌入，安全人员被压得喘不过气来，未能注意到尾随进入。

+   一名攻击者使用餐车诱使员工离开安全设施。然后，他们利用自己作为非发起者的身份，通过互惠互利的社会工程学手段对目标进行操作，最终与目标建立关系，并说服目标执行他们在传统社会工程学场景中不会执行的行为。

+   一名攻击者在街对面的咖啡馆破坏了 Wi-Fi 网络，以窃取目标组织员工的凭证。通过进入咖啡馆并使用他们的设备，这些员工无意间脱离了组织的防御，暴露在攻击者控制的环境中。

+   一名攻击者对目标人物、系统和数据进行大规模的破坏性、拒绝服务或破坏性攻击，迫使他们转移到一个不如组织永久总部安全的灾难恢复站点，易于被渗透。

请注意，虽然这些攻击不一定能达到对手的最终目标，但它们可能提供手段或信息，结合其他漏洞，达成恶意目的。

## 防御社会工程学攻击

大多数组织进行社会工程学意识培训，并定期对内部员工进行钓鱼测试。虽然这种策略提高了对这种攻击的抵抗力，但仍有相当一部分人员总是会失败。不幸的是，大多数组织仍然让员工面临社会工程学的漏洞。我们需要做更多的工作，为员工提供防范这种欺骗的工具。

1.  *建立保护措施*。为员工实施标准的信任框架，以减少社会工程学带来的风险。识别您环境中的高价值目标，然后为这些系统上敏感信息的适当控制和处理建立安全协议、政策和程序（并随着时间的推移将这些扩展到所有系统）。在您的组织内部进行培训、意识提升和测试演习，以提高员工对社会工程学的认识，并通过反复的威胁建模来审查和改进相关的安全控制。

1.  *实施“慢思考”*。与您的安全团队一起分发并讨论丹尼尔·卡尼曼的书《思考，快与慢》^(5)。这本书描述了两种思维系统：较快且更具冲动性的“系统 1”和较慢且更具逻辑性的“系统 2”。制定强迫员工放慢速度并以系统 2 的方式思考的解决方案，从而避免社会工程师最常利用的认知偏差和捷径。可能的例子包括：

    +   配置您的电话交换系统，要求接到外部电话的员工在系统连接之前输入来电者电话号码的偶数位数字。

    +   配置您的邮件客户端，要求员工必须将“发件人”邮箱地址倒着输入，才能打开外部邮件附件。

    +   要求访问非白名单 URL 的用户，在浏览器执行 DNS 查询之前，正确输入域名中的字符数。

    所有这些措施都会减缓业务操作，但也有助于缓解社会工程学攻击。

## 推荐的安全控制和缓解措施

在相关情况下，提出的建议会结合 NIST 800-53 标准中的适用安全控制进行展示。每个建议都应在心中考虑“月亮在水面”的概念来进行评估。

1.  因为安全系统和控制只能在已设定的边界内保护信息，所以需要实施保护措施，防止信息和系统超出这些边界，落入社会工程师手中。[AC-3: 访问执行 | (9) 受控释放; PE-3: 物理访问控制 | (2) 设施/信息系统边界; SC-7: 边界保护]

1.  控制信息流动，以确保即使数据超出了正常的保护边界，也不会被传输到未授权的信息系统之间或其中。[AC-4: 信息流执行；PL-8: 信息安全架构；SC-8: 传输机密性与完整性]

1.  对于所有非本地（即通过网络）系统维护，建立审批协议，要求使用强身份验证器和记录政策，并实施监控。[MA-4: 非本地维护]

1.  为受控区域外的数据建立保护措施，并将数据处理活动限制在授权人员之间。[MP-5: 媒体传输 | (1) 受控区域外的保护]

## 简报

在本章中，我们描述了“水面月光”这一高级忍者技艺。我们探讨了如何将这一技艺现代化，以便针对商业目标进行应用的各种场景。我们讨论了社交工程所带来的挑战及其可能呈现的多种形式。我们回顾了现有的安全实践，旨在应对社交工程攻击，并审视了新的防御概念。我们还从忍者卷轴中提取了一项思维练习，展示了我们的信任模型是多么脆弱，以及如何防范社交工程攻击的难度。

在下一章中，我们将讨论内部威胁——这是安全领域最引人入胜的话题之一。忍者卷轴提供了关于如何识别可能被招募为内部人员的详细指南，并指出了与现代最佳实践相悖的一种防御内部威胁的方法。
