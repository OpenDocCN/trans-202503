# 第二十一章：渗透的情境

你应该在敌人动的时候立即渗透，而不是在他们不动的时候尝试——这是一种有原则的做法。

> 在暴雨中，当雨势最猛烈时，你应该利用这个机会进行忍者活动和夜间攻击。
> 
> —吉盛百首 #1

*忍秘传*和*万川集海*都建议，在对目标采取行动时，忍者应该利用掩护来避免被发现。他们可以等待自然形成的掩护环境，或者在必要时自行创造这种环境。卷轴提供了多种可以帮助渗透的情况，从自然现象（强风和暴雨）到社交聚会（节日、婚礼和宗教服务），再到忍者发起的活动（放马、制造争斗和纵火）^(1)。无论这些情况来源如何，机智的忍者应能利用分心、兴奋、混乱和其他使目标注意力分散的条件。

忍者能够将恶劣天气转化为有利的渗透条件。例如，暴雨意味着街道空旷、能见度差，并且滂沱大雨可以掩盖忍者的动作声。^(2) 当然，坏天气对所有人来说都是不利的，*吉盛百首*的第二首诗提到，暴风雨过于猛烈时，忍者也可能被压倒，难以执行战术和技巧：“在死寂的夜晚，风雨肆虐，街道黑暗得忍者难以发动夜间攻击。”^(3)

忍者还利用了其他一些更为个人化的情况，比如目标家中的悲剧性死亡。卷轴指出，当目标处于哀悼状态时，他们可能会有两到三晚睡不着觉，这意味着忍者可以在葬礼或丧亲期间伪装成哀悼者，趁机接近目标，或者等到目标在第三或第四晚彻底睡着时再进行渗透。^(4)

当然，忍者的任务并不总是与天意相符。在某些情况下，忍者会自己让目标堡垒中的人患上重病。生病的人无法有效防守，而他们担忧的看护者为了照顾病人而无法入睡。当病人开始恢复时，松了一口气的看护者会沉沉入睡，此时忍者便可以渗透进去。或者，忍者可以摧毁重要的基础设施，比如桥梁，然后等目标在夏季的酷热中进行艰难的重建工程后，再去渗透疲惫的敌人。^(5)

有效的分散注意力也可能更直接地具有对抗性。*《万川集海》*描述了一种名为*虚隙*（“通过惊讶创造空隙”）的技巧，该技巧利用军事力量或其他忍者的帮助。这些盟友使目标认为攻击正在进行中，可能通过开枪、击打战鼓或喊叫，忍者可以在混乱中悄悄渗透。当忍者想安全撤退时，这一技巧会简单地重复。^(6)

在本章中，我们将回顾如何利用情境因素来帮助渗透，如《忍者卷轴》中所描述的应用于数字时代。情境因素的使用依赖于防御者、安全系统和组织的有限注意力。过载、混淆和误导这些有限的注意力创造了威胁行动者可以利用的机会。我们将识别在现代网络环境中可以发现的各种机会，并解释它们如何与《忍者卷轴》中描述的情况相似。最后，我们将回顾组织如何通过采取防范措施和增强韧性，准备应对可能削弱防御的情况。

## 对抗性机会

网络安全对手可能会分散其目标的注意力，并创造条件，使得像忍者曾经做的那样广泛且明智地检测到渗透。例如，当网络防御者检测到突然的分布式拒绝服务（DDoS）攻击时，标准操作程序要求评估 DDoS 的强度和持续时间，并创建一个安全事件单来记录该活动。防御者可能不会立即怀疑 DDoS 是威胁行动者攻击网络的掩护。因此，当攻击压倒目标的安全传感器和数据包捕获（pcap）及入侵检测或防御系统（IDS/IPS）未能开启时——换句话说，当有太多通信无法检查时——防御系统可能会自然地将数据包匆忙传送而不检查是否含有恶意内容。当 DDoS 攻击停止时，防御者会注意到没有显著的停机时间，并将其状态恢复正常，而没有意识到，虽然 DDoS 只持续了 10 分钟，但数据包洪流给了对手足够的时间和掩护来攻破系统并在网络中建立立足点。（如*《吉盛百首》*第二章所警告的那样，“强烈的风暴可能阻碍目标和攻击者”，对手不太可能部署过于强烈的 DDoS 攻击。这样做可能会导致网络设备丢失数据包并失去通信数据——包括他们自己的攻击。相反，攻击者更可能限制目标系统的性能，以压倒安全防护，而不干扰通信。）

对手有很多其他方法可以在渗透目标中创造有利的环境，他们仅受限于他们的聪明才智。攻击服务和基础设施的质量与可靠性可能会带来优势，例如破坏互联网服务提供商（ISP）或互联互通。耐心的攻击者可能会等待商业供应商发布有缺陷的更新或补丁，之后目标的安全或 IT 团队可能暂时创建“允许任何-任何”条件或移除安全控制以排除故障。威胁行为者可能会监控公司的资产获取过程，以确定何时将新系统和服务器迁移到生产环境或云端——从而知道这些目标可能会暂时没有防护或未正确配置以防范攻击。威胁行为者也可能会追踪公司合并，并尝试渗透不同公司合并网络时产生的漏洞。其他对手可能会利用目标建筑内举办的特殊事件，例如大型会议、供应商博览会和第三方会议，在陌生人中间混入人群并渗透目标。他们甚至可能在过程中顺便拿到一个纪念品袋。

## 对抗的困境

被认为是不可行的，无法保证数字系统的 100%正常运行时间，而且要保证这些系统在任何时候都能 100%安全，几乎更为困难。此外，几乎可以肯定的是，无法防止灾难、危害、事故、故障和不可预见的变化——其中许多将创造出有利条件，供机会主义的威胁行为者进行渗透。过于谨慎以避免这些情况可能会妨碍企业在战略上大胆行动并实现目标。解决这一困境的办法可能是冗余层次化系统，以减少渗透机会。安全团队可以实施等同于高可用性安全的措施——在系统较弱的地方冗余地层叠安全措施。*实践意识和准备。* 作为安全团队变更管理、事件、事故、危机、自然灾害和其他干扰或困惑情况的协议的一部分，训练你的安全团队寻找迹象，表明某个事件是由对手制造或利用来渗透组织的。将角色责任记录在组织政策和程序中。使用威胁建模、桌面演习和风险管理来识别潜在的干扰因素，然后考虑为应对它们采取保护措施、对策和防护。

## 推荐的安全控制和缓解措施

在相关的情况下，建议会结合 NIST 800-53 标准中的适用安全控制进行呈现。它们应该在考虑渗透环境的背景下进行评估。

1.  确定并记录在紧急情况或其他极端情况下，如何处理不同的安全控制和协议——例如身份验证——以减轻敌方渗透的风险。[AC-14: 无身份验证或认证的允许操作]

1.  建立关于在特殊情况下使用外部信息系统的控制和政策。[AC-20: 使用外部信息系统]

1.  在应急训练期间（例如消防演习），进行渗透测试演习，以测试防御和检测能力。[CA-8: 渗透测试；CP-3: 应急训练；IR-2: 事件响应训练]

1.  对访客实施物理访问限制，并针对无法护送大量无控制人员的情况采取措施——例如，火灾发生时的消防员——但仍需防止未经授权的系统进出。[PE-3: 物理访问控制]

1.  发展在紧急情况下关闭信息系统和网络的能力，当怀疑敌方已经突破防线时，实施关停。[PE-10: 紧急关停]

1.  考虑您的组织如何将对敌方的意识和狩猎纳入应急计划中。[CP-2: 应急计划]

1.  评估是否在后备站点突然转移或恢复业务操作会为敌方渗透创造有利的机会。然后考虑适当的防御保障和缓解措施。[CP-7: 备用处理站点]

## 事后总结

在本章中，我们回顾了创造和/或等待能够掩护渗透目标的情形这一战术。我们看了几个例子，展示了忍者如何在目标防御严密时创造机会，同时探索了这一战术在现代网络环境中的应用。我们讨论了在弱势时期如何管理安全，并通过思维练习，研究了在无法避免、转移或反制的情况下，如何为可能的风险情形做好准备。

在下一章中，我们将讨论零日漏洞，或一种如此新颖或机密的渗透手段，以至于尚未有人想到如何防御它。忍者有类似零日漏洞的利用技巧；这些技巧非常机密，以至于禁止记录下来，卷轴中只间接提及这些技巧。我们只留下了隐晦的线索——这些线索是为了提醒忍者他们曾学过的秘密技巧，而不是教导它们。即便如此，卷轴还是提供了如何创造新零日漏洞、防御它们的程序以及执行这些漏洞的间谍技巧的见解。此外，卷轴还描述了几种历史上的零日技巧，这些技巧因被披露而失传，给我们提供了对现代零日漏洞的洞察，以及对未来零日漏洞的预测。
