# 第十九章：暗号

当你潜行进入时，首先要做的是标记路线，向同伴显示出口和如何逃脱。

> 在成功潜入敌区后，要更加注意避免意外地与自己人发生冲突，而不是过多关注敌人。
> 
> —吉盛百首 #26

虽然忍者在流行文化中常常被描绘为独行侠，但许多忍者实际上是以小队形式作战的。这些小队特别擅长在现场悄无声息地相互传递信息。*《军法示要》*手册描述了忍者用来相互沟通的三种暗号或物理标记，这些标记帮助忍者在不引起怀疑的情况下交流。根据这些标记的形式和放置位置，暗号可以帮助忍者识别目标，指示在路口选择哪条道路，提供前往敌方据点的方向，或协调攻击等行动。尽管这些暗号在忍者圈子里十分常见，但参与的忍者会在任务前商定定制的变种，以确保目标或敌方忍者无法在现场识别这些暗号。卷轴建议使用便携、可丢弃、迅速部署和收回的标记，并且标记要放置在地面上。最重要的是，标记必须在视觉上独特，但对于外行人来说却不显眼。

例如，忍者可能会通过在预定的、看似无害的地方留下染色的大米粒，来通知同伴自己所在的位置。一位忍者留下红色大米，另一位留下绿色，以此类推，这样当另一位忍者看到这些几颗彩色大米时，就知道自己的同伴已经经过了。这套系统的优点在于，虽然忍者可以迅速识别这些物品，但普通路人却不会注意到几颗颜色奇怪的大米。使用类似的方法，忍者可以巧妙地指向一根断竹子，指引同伴前往选定的小径，或者他们可以在地面上留下小纸片，标识出一个将被烧毁的住所，从而减少队员成为纵火受害者或嫌疑人的可能性。^(1)

在本章中，我们将探讨在网络环境中如何使用呼号技术，以及网络威胁行为者为何可能使用它们。我们将假设呼号可能放置在网络的哪个位置，以及它们可能的表现形式。此外，我们还将讨论如何在目标网络中寻找这些呼号。我们将回顾检测创造性呼号的挑战，并触及这一挑战的关键点：控制和监控你的环境，以防敌方行为。通过思维练习，你将有机会构建思维模型和解决方案，以应对敌人呼号的挑战。你还将接触到可能防止威胁行为者在你的环境中使用呼号的安全控制措施，以及限制他们能力的手段。

## 操作员技艺

在 2016 年民主党全国委员会（DNC）黑客事件中，俄罗斯军事机构 GRU（也称为 APT28 或 FANCYBEAR）及其盟友安全机构 FSB（APT29 或 COZYBEAR）在相同的网络和系统上进行操作，但它们未能使用呼号进行相互通信。这一疏忽导致了工作重复、可观察项、异常及其他妥协指示符在受害者网络中出现，可能促成了两次行动的失败。^(2) 缺乏沟通，可能源于这两个情报机构之间的分隔，让我们了解了网络间谍威胁组织能从忍者那里学到什么。

尽管网络安全社区尚未观察到重叠的威胁组使用隐蔽标记，但 DNC 黑客事件表明，确实需要这样的协议。可以合理推测，GRU 和 FSB 对他们的 DNC 黑客行动进行了事后报告，并且他们可能已经决定在未来的行动中，特别是在目标重叠的情况下，实施呼号协议。如果网络间谍组织开始定期以隔离但交叉的方式合作，他们将需要一种沟通多种信息的方式，包括在正常通信渠道无法使用时，简单地传达他们在系统和网络上的存在以及他们的目标的详细信息。

如果这些呼号确实存在，它们会是什么样子？有效的网络呼号最可能：

+   随着时间的推移，像忍者标记一样发生变化

+   实施在无法被捕获和逆向工程的工具和恶意软件中。需要使用键盘的人工操作才能识别它们。

+   存在于重叠间谍组织肯定能够找到的位置，例如珍贵且独特的主域控制器（DC）。考虑到文件安全监控的存在以及 DC 不经常重启的操作现实，威胁组织可能会将标记放置在 DC 的内存中，以最大化其持久性并最小化其可检测性。

目前尚不清楚哪些字符串或独特的十六进制字节可以作为标记；这些标记可能存放在哪些缓存、临时表或内存位置；以及另一个操作员如何轻松发现它们。然而，值得注意的是，网络安全行业已经观察到多个恶意软件家族，它们留下特定的文件或注册表键，作为向病毒的未来副本发出的信号，表明感染已经成功传播到给定的机器（因此它们不需要再次尝试感染它）。^(3) 尽管这种呼叫标识符功能不容易对动态的人类威胁行为者实施，但防御者可以创建文件和注册表键，错误地发出感染信号，促使恶意软件无害地继续前进。

## 检测呼叫标识符的存在

许多组织难以确定是哪个用户从共享网络驱动器中删除了文件，更不用说检测隐藏在系统远程部分的隐蔽呼叫标识符了。尽管如此，防御者将越来越需要能够防御相互通信的威胁行为者，尤其是在防御者的环境内部。为了有机会抓住威胁行为者，防御者需要培训，并且他们需要实施检测工具，拥有主机可见性。

1.  *实施高级内存监控。* 确定网络中高价值的系统——那些你认为威胁行为者可能会攻击或需要访问以继续前往目标的系统。然后，探索你组织现有的能力，以监控和限制这些系统上的内存更改。同时，看看供应商提供的产品和服务。评估调查这些内存更改来源所需的工作量和时间。最后，确定你是否能够自信地判断这些更改是否表明目标机器已经被攻陷。

1.  *培训你的人员。* 培训你的安全、侦查和 IT 团队，将内存中的法医证据视为潜在的入侵指示，尤其是当它们出现在高价值目标中时，而不是忽视他们发现的任何不一致之处。

## 推荐的安全控制与缓解措施

在相关的情况下，推荐措施将与 NIST 800-53 标准中的适用安全控制一起呈现。每一项都应考虑呼叫标识符的概念。

1.  确保以前的用户信息对当前访问同一系统或资源的用户不可用。[SC-4: 共享资源中的信息]

1.  确定可能用于未经授权信息流动的系统通信。一个潜在隐蔽通道的例子来自控制“PE-8: 访客访问记录”。访客用来签入设施的纸质日志本或不受限制的数字设备，可能会受到信息标记的影响，向分隔的间谍行为者发出信号，表明其他团队曾访问过该地点。[SC-31: 隐蔽通道分析]

1.  搜寻潜在攻击和未经授权的系统使用的迹象，并部署监控设备以跟踪感兴趣的信息交易。[SI-4: 系统监控]

1.  保护系统内存，防止未经授权的更改。[SI-16: 内存保护]

## 简报

在本章中，我们回顾了忍者小组在敌方领土内彼此传递信号时使用的物理标记。我们了解了这些信号的作用及卷轴中提到的良好信号的特征。接着，我们回顾了一次网络间谍行动，其中由于缺乏信号而导致的协调失误暴露了威胁集团的活动。我们讨论了现代威胁集团可能会继续提高技术水平—这一水平可能包括采纳信号技巧。我们探讨了现代数字信号可能的形式，以及我们如何发现它们。

在接下来的章节中，我们将讨论忍者信号的对立面：忍者为确保不留下任何活动痕迹在敌方领土中采取的预防措施，正如卷轴所示。高级技巧包括制造假信号，旨在欺骗防守方。
