# 第二十章：光线、噪音和垃圾管理纪律

古老的忍者传统中有云，你在用火观察敌人之前，应该先锁好门。

> 如果忍者在下雪时潜入，必须特别小心的是脚步声。
> 
> —吉盛百首 #53

避免引起不必要的注意是他们职业的一项核心纪律，忍者们在隐匿方面训练得非常刻苦。如果灯笼发出的光线干扰了动物，脚步声回响并惊醒了熟睡的目标，或是食物残渣引起了守卫对入侵者的警觉，那么忍者就可能把任务——如果不是生命——置于险境。因此，卷轴中提供了大量关于在保持光线、噪音和垃圾管理纪律的同时，进行战术移动和操作的指导。

光线管理纪律包括一般的战术。例如，卷轴建议潜入的忍者在点燃火把之前，先从内部锁上门，以防光线（以及房间里的人）泄露出去。^(1) 它还包括一些具体的技巧。*《万川集海》*详细描述了一些巧妙的光线管理工具，如*火卵*。这是一种特别的可燃材料，中央有一颗炭火，被压缩成鸡蛋的形状和大小。火卵被忍者掌心握住，打开或闭合手掌可以控制空气进入炭火的量，从而调整光线的亮度或昏暗，并让忍者能将光线引导到特定的、狭窄的方向。^(2) 使用这个工具，忍者可以迅速打开手掌查看房间内是否有人在睡觉，然后通过紧握拳头迅速熄灭光线。因此，火卵拥有类似现代战术手电筒的按需定向光控制和开/关光控制功能。

对忍者来说，保持安静至关重要，卷轴中描述了许多技巧，帮助忍者在潜入目标时保持沉默。*《忍秘伝》*建议忍者咬住一条纸条，以减弱呼吸声。类似地，有些忍者通过用双手掌抓住脚底，然后用手走路来减少脚步声的响动。这项技巧肯定需要大量的练习和适应才能成功执行。忍者还常常携带油或其他粘稠物质，用来润滑嘎吱作响的门轴或木质滑动门——任何可能发出声音并引起他人警觉的物品。卷轴还警告说，不要过度使用这些液体，因为它们可能会在地面上积聚，暴露出有人闯入的痕迹。^(3)

并非所有忍者的噪音纪律技巧都是为了最小化噪音。卷轴中也提供了制造故意喧闹的指导。*《正忍记》*描述了一种叫做*靴替*的噪音纪律技巧，实际上是通过改变步伐，而不是换鞋，来改变步伐声音。一名渗透的忍者可以拖步、跳跃、装作跛行、走碎步，或者制造出可听的但清晰的脚步声来迷惑任何在倾听的人。然后，当他们恢复自然步态时，听者会误以为他们听到了另一个人，或者错误地认为他们追踪的人突然停下了脚步。^(4) *《忍秘传》*则描述了拍打木块或大喊“贼啊！”或“救命！”以模拟警报，测试守卫对噪音的反应。^(5) *《万全守诀》*描述了一种更为控制的噪音测试方法，在这种方法中，忍者在目标或守卫附近逐渐提高耳语的声音，以确定目标的噪音检测阈值。噪音测试帮助忍者具体观察目标的反应，包括：

+   目标反应有多快？

+   守卫之间是否有关于听到噪音的争论？

+   守卫是否迅速警觉地出现，并持有武器？

+   噪音是否让目标措手不及？

+   目标是否完全没有察觉？

这些观察不仅能告诉忍者目标的警觉性和听力有多敏锐，还能揭示目标应对事件的技能和准备情况——忍者可以利用这些信息来调整渗透策略。^(6)

就物理证据而言，忍者早在“环保”成为口号之前就已经实行“无痕”策略。一个名为*长袋*（或“长包”）的工具有助于隔绝声音并收集垃圾。当忍者攀爬高墙并需要切开一个孔来穿过时，他们会在下面挂上一个大而厚的皮质*长袋*，袋内衬有毛皮或毡布，用以收集从墙上掉下的碎片并压低声音。忍者可以将这些碎片悄悄地放到地面上的隐蔽处。这比让碎片掉落到地面或溅入护城河要好得多。^(7)

在本章中，我们将忍者的光线、噪音和垃圾抽象为它们在网络安全中的等效威胁。我们将回顾一些威胁组织使用的工具和技术，这些工具和技术旨在最小化它们留下的证据，并探讨一些程序性技艺纪律。我们将讨论如何检测“低慢威胁”以及如何调整你的环境以便为自己所用。这个思维练习将研究忍者用来掩盖脚步声的技巧，这一技巧理论上可以应用于现代数字系统。章节的最后，我们将讨论检测纪律，作为应对一位精通网络中可观察行为（或无法留下这些行为）的对手的手段。

## 网络光、噪音和垃圾

数字世界的行为不总是与物理世界相同。理解并持续寻找网络中“光、噪音和垃圾”的数字等价物可能是一个挑战。由于防御者缺乏时间、资源和能力来监控和追踪其控制下的数字系统，对手的光、噪音和/或垃圾痕迹常常未被记录。因此，威胁行为者可能比进行物理渗透更容易执行网络渗透。

许多扫描和利用工具与框架，如 Nmap,^(8) 具有限速模式或其他“低速且缓慢”的方法，试图控制目标网络上数据包或有效载荷的大小、数据包频率和带宽使用。对手开发了极小的恶意文件（例如，中国劈刀（China Chopper）可以小于 4KB^(9))，这些文件利用防御者的假设，即文件的足迹如此轻微，不会造成伤害。恶意软件可以配置为通过不频繁地向指挥与控制（C2）站点发送信号，来最小化其产生的噪音，或者通过故意进入休眠状态或长时间执行无操作（NOP），在进程日志或内存中最小化噪音。为了避免留下可能暴露其存在的数字垃圾，某些恶意软件不会将任何文件写入磁盘。对手和邻近网络基础设施上的恶意软件可以选择被动地收集信息，从而对目标内部环境有一个缓慢但富有成效的理解。值得注意的是，这些威胁中的许多也选择接受因其执行攻击活动而产生的网络光、噪音和/或垃圾的风险。

合理推测，足够先进的对手有相应的程序来限制网络光、噪音和垃圾，例如：

+   将与目标的通信限制在每天少于 100MB

+   确保恶意软件工件、文件和字符串不容易被识别为可能暴露其自身存在或归因于恶意软件的垃圾

+   “静默”日志、警报、陷阱和其他传感器，以便安全系统不会对入侵者的存在做出警报

目前看来，大多数安全设备和系统的设计是响应已知威胁的确切特征，例如特定的 IP、事件日志或字节模式。即使是专门的软件，如 Wireshark,^(10) 也能实时向分析人员展示威胁活动，但收集、处理和研究这些信息依然需要大量努力。将这种工作流程与听到脚步声后做出反应进行对比。由于人类无法像感知物理环境一样感知数字领域，安全措施基本上就像是有视觉和听觉障碍的守卫，等待着威胁在房间对面出现时发出提示后采取行动。

## 检测纪律

不幸的是，对于那些精于隐匿技巧的人来说，并没有理想的解决方案。一些威胁行为者在这一领域拥有相对于防御者的巨大优势，他们可以未经授权访问安全团队的事件工单工具，并监控其中任何提及他们自己威胁活动的新调查。然而，仍然可以做出改进，进行培训，部署对策，并尝试一些防御技巧来使威胁者犯错或被捕。

1.  *练习警觉性*。作为威胁狩猎、事件响应和安全分析培训的一部分，教导您的安全团队寻找敌人轻微痕迹、噪音或杂乱的迹象。

1.  *安装嘎吱作响的门*。考虑实现欺骗性攻击感知和警告（AS&W）指示器，例如，在域控制器或其他敏感系统或网络设备上每分钟触发的安全事件。例如，您可以实施一个警告，内容为“[安全事件日志警报]：Windows 未能激活 Windows Defender/验证此版本的 Windows。”这可能会误导渗透者认为您没有关注警报，从而促使对方“关闭”或“重定向”安全日志，避开您的传感器或分析人员。假如虚假警报突然消失，这将通知您的防御人员敌人的存在（或者，在正常崩溃的情况下，告知需要重启系统或由 IT 部门调查故障）。

1.  *打响木质响板*。考虑一下，先进的敌人可能如何故意触发警报或从您环境中的受保护或隐藏位置产生明显的网络噪音（即，攻击已知的蜜罐），以观察您的安全团队的检测和响应能力。这相当于网络中的忍者，在夜晚悄悄跑过您的房子，用两块木板猛地拍打，测试您的反应。可以合理假设，一些敌人可能会以这种方式评估您的安全防御，以便确定他们是否可以在不被发现的情况下使用零日漏洞或其他隐秘技巧。

## 推荐的安全控制和缓解措施

在相关情况下，提出的建议会配有适用的 NIST 800-53 标准中的安全控制。每一项建议都应从攻击可能伴随的光、噪音和杂乱因素进行评估。

1.  通过模拟网络渗透，确定您组织的检测能力，既模拟快速攻击的敌人，也模拟缓慢潜行的敌人。记录哪些日志与哪些可观察活动相关，并找出可能存在的感知盲点。[AU-2：审计事件；CA-8：渗透测试；SC-42：传感器能力和数据]

1.  将事件日志、警报和可观察信息与已记录的威胁行动进行关联，以更好地教育您的团队并测试您对威胁在网络上“发出的声音”的感知。[IR-4：事件处理 | (4) 信息关联]

1.  调整你的沙盒和引爆室，以寻找潜在威胁行为者的迹象，他们试图执行网络领域中的光、噪音和垃圾纪律。[SC-44: 引爆室]

1.  使用非基于签名的检测方法，寻找旨在避免签名识别的隐秘有序活动。[SI-3: 恶意代码防护 | (7) 非基于签名的检测]

1.  部署信息系统监控以检测隐秘活动。避免在高活动区域放置过于敏感的传感器。[SI-4: 信息系统监控]

## 简报

在本章中，我们回顾了忍者采取的预防措施和他们用来隐藏活动证据的工具——例如，衡量他们能制造多少噪音才不会引起警卫警觉，并了解如果忍者活动被发现，目标可能采取的行动。我们讨论了敌对方使用的几种网络工具，以及这些工具如何被理解为相当于光和噪音——这些都是防御者可以检测到的证据。最后，我们回顾了防御者可以采取的潜在对策。

在下一章中，我们将讨论有助于忍者渗透的情况，因为这些情况能够减轻光、噪音和垃圾的问题。例如，一场强烈的暴风雨可以掩盖噪音，遮挡视线，清除他们存在的证据。网络防御者可以考虑类似的情况来保护他们的系统。
