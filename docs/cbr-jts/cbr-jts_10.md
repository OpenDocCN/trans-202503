# 第十章：桥梁与梯子

无论墙壁或护城河有多高或多陡，你都能越过，特别是如果你使用忍者梯的话。

> 城堡的门楼通常是最严格防守的地方，但屋顶是你安装钩梯最方便的位置。
> 
> —《万川集海》，“隐忍 II” ^(1)

忍者可以悄无声息地越过敌人的墙壁和大门，使用*忍器*渗透工具——这些工具在《万川集海》^(2)和《军法事要书》^(3)中都有描述。多功能梯子和便携桥梁，如带刺的梯子、云梯或工具运输绳^(4)，使得忍者能够跨越护城河、攀爬城墙，并安全、悄无声息地将工具交给其他忍者。有时这些梯子是“正式的”，即忍者在任务前预先制造的；有时是“临时的”，即在现场构建的^(5)。这些工具非常有价值，因为它们提供了进入那些由于过度自信而未被守卫的敏感地点的机会。

这些卷轴还解释了如何通过操控敌人的安全措施渗透敌营。《翔忍记》指示忍者想象鸟或鱼是如何进入城堡的^(6)——换句话说，要意识到高处或低处带来的独特优势。例如，攀爬城墙可以为你提供以极高的速度跨越其他城墙和屋顶的机会，从而比通过城门进入提供更好的进入城堡内部的途径。游过护城河可以提供通往一个常见水道的水下通道——这个水道通向城堡。《万川集海》甚至建议故意尝试跨越守卫楼门——守卫最多的地方，因为防守者可能会假设攻击者会避免试图在这一点上渗透^(7)。

在本章中，我们将讨论如何将网络域连接的方式与连接城堡墙外围的方式进行类比。就像城堡的墙壁一样，网络也设计有障碍和分段，假设必须通过一个受控的网关。桥接允许威胁绕过这些网关，从而绕过在网关出口点设立的安全控制。看似简单的措施，比如指示守卫阻止任何建造跨越城堡护城河的桥梁的人，实际上可能变得徒劳无功。比如，如果城堡的建筑师选择因水管理的原因将护城河的同心环连接起来，那么连接后的三个护城河不再是敌人必须通过的三个独立的边界。相反，它们成为一座水桥，敌人可以直接游入城堡的心脏。学习如何像忍者一样思考，并将障碍视为潜在的梯钩点，可以帮助你重新评估自己的网络，并预先切断桥接的机会。

## 网络边界桥接

对于网络安全专业人员来说，*桥接*是一个虚拟或物理网络设备，操作于物理层和数据链路层——OSI 模型的第 1 层和第 2 层——将两个网络段连接在一起，形成一个单一的聚合网络。该术语还指任何使信息跨越“空白”区域的设备、工具或方法，如空中隔离网络或分段边界。桥接通常绕过安全控制和保护措施，允许从网络中提取数据或将未经授权或恶意数据传递到网络。这些潜在的严重后果促使网络安全专家开发检测和缓解方法来防止桥接，包括：

+   禁用无线以太网卡上的网络桥接

+   禁用具有两个或更多活动网络接口的系统

+   实施网络访问控制（NAC）和监控，以检测网络上的新设备

+   安装传感器以检测未经授权的 Wi-Fi 接入点

+   使用 VLAN 或其他路由技术限制某些网络

+   在链路层发现协议（LLDP）中使用身份验证

尽管安全控制措施不断发展，未经授权的桥接仍然发生——而且一些高级渗透技术，尽管只在学术或实验室环境中得到验证，但展示了巨大的危害潜力。最近的例子包括控制系统 LED 以将比特通过光接收器传输到不同房间或建筑物，使用 FM 频率信号与附近的手机通信（例如 AirHopper 和 GSMem 漏洞），控制并脉冲风扇通过声波传递比特，以及人为地过热和冷却 CPU 以缓慢传输数据（如 BitWhisper 漏洞）。威胁行为者甚至可能通过系统的电源线通过电力以太网技术（EOP，切勿与以太网供电 POE 混淆）来进行网络桥接。在其他情况下，组织的 VoIP 电话可能会被远程激活其麦克风和扬声器，允许对手传输声音数据或窃听对话。

当然，某些桥接方式不那么先进。对手可能会爬上办公楼的屋顶，接入可接触的网络电缆，并安装一个小型地球卫星站，通过它提供对网络的强力桥接访问。智能手机经常插入系统的 USB 端口进行充电，但充电的手机还将计算机连接到一个外部蜂窝网络，而这个网络并未经过防火墙、数据丢失防护（DLP）或其他安全工具的检查，从而完全绕过了组织的防御，促进了数据窃取或代码注入。当通过*sneakernet*桥接时，用户将信息加载到便携式媒体上，然后将其走到另一台计算机或网络位置，手动绕过安全控制。还有一种担忧是威胁可能会利用隐藏的管理网络——通常是在 10.0.0.0/8 网段——直接连接到路由器、防火墙和其他安全系统的控制台，使用这些设备作为跳点，桥接不同的网络 VLAN 和子网，实际上利用网络绕过其自身的安全性。此外，分离隧道也构成风险，因为信息可能通过同时连接到两个网络的设备泄漏到不同的网络之间。

成熟的组织在假设对手不断开发不同的桥接技术以通过新的、无法预见的方式绕过防御的前提下运作。事实上，似乎所有的电磁频谱——包括声波、光波、地震波、磁场、热能和无线电频率——都可以成为桥接网络和隔离的可行手段。

## 对抗桥接

防止设计用于连接其他系统的系统之间的桥接是一个难以解决的问题。虽然没有完美的解决方案，但可以通过减少桥接机会，并将隔离努力集中在最重要的资产上，来降低风险。此外，可以叠加反制措施，以消除桥接技术的能力，从而提高这些防御的有效性。

1.  *识别你的弱点。* 确定那些存储你组织敏感、关键或高价值数据的网络和信息系统。创建数据流图（DFD）来模拟信息在系统中的存储和流动方式。然后，识别可能发生隐蔽、非正式渠道桥接攻击的区域。

1.  *实施桥接反制措施。* 考虑实施 TEMPEST^(8)控制措施，如法拉第笼或屏蔽玻璃，来阻止通过辐射或其他信号进行的空隙桥接。为了阻止非法桥接，确保在允许设备连接到你的网络或其他设备之前已识别并认证这些设备。根据你的威胁模型，开发适当的防护措施以缓解潜在的桥接威胁。

## 推荐的安全控制和缓解措施

在相关的情况下，提供与 NIST 800-53 标准中适用的安全控制措施相对应的建议。每一项建议都应结合桥接的概念进行评估。

1.  实施边界保护和信息流控制措施，防止外部设备、系统和网络从你的网络窃取数据或传播恶意代码。[AC-4：信息流强制 | (21) 信息流的物理/逻辑分隔；AC-19：移动设备的访问控制；AC-20：外部信息系统的使用 | (3) 非组织拥有的系统/组件/设备；SC-7：边界保护]

1.  强制执行无线访问保护控制，阻止或检测未经授权的无线信号，这些信号可能通过微波、超高频/甚高频、蓝牙、802.11x 等频段跨越网络桥接。[AC-18：无线访问；SC-40：无线链路保护]

1.  审计网络访问和互连，识别可能将你的网络与外部系统或网络连接的设备——例如远程网络打印机——这些设备可能成为数据传输的桥接。[CA-3 系统互连；CA-9 内部系统连接]

1.  建立强有力的可移动媒体政策，以防止未经授权的桥接。要求在允许任何外部媒体和设备连接到环境之前进行身份识别和认证。[IA-3：设备识别与认证；MP-1 媒体保护政策与程序；MP-2：媒体访问；MP-5：媒体传输]

1.  测试 TEMPEST 泄漏或来自系统的其他信号外泄。根据测试结果，决定在何处实施保护措施，抑制信号被用作桥接的能力。[PE-19：信息泄漏；SC-37：带外信道]

## 反馈

在本章中，我们讨论了对抗性桥接的哲学，并探讨了桥接网络段和传统最佳实践。我们了解了多种桥接技术——这些桥接可以以你可能以前没有想到的方式跨越间隙。本章中的思维练习旨在促使大家思考在梯子和墙壁之间建立物理防护措施；理论上，这些措施可以成为创新现代防御体系中输入/输出系统的基础。

在接下来的章节中，我们将讨论锁具和忍者的开锁技艺，后者基于这样一种信念：任何由人类设计的锁都能被人类打开。我们还将窥见忍者在不得不依赖他们自己不信任的锁时的安全策略。我们将讨论锁具在网络安全中的应用，以及我们可以从忍者那里学到什么，来改进我们对锁具和开锁技艺的理解。
