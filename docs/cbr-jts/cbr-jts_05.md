# 第五章：双重密语

有时，应当配合捏鼻子或捏耳朵等动作来使用这些密码。

> Aikei 识别标志包括*tachisuguri isuguri*技术——即站立和坐下时给出密码。
> 
> —*Bansenshūkai*, Yo-Nin II

*Bansenshūkai*和*Gunpo Jiyoshu*卷轴描述了一种由 14 世纪的武士楠木正成所发明的公开伪装检测协议。(^(1)) *Tachisuguri isuguri*信号技术使用手势、姿势或身体定位作为一个秘密身份认证因素，从而为密码验证过程增加了一层安全性。这些技术形成了所谓的*双重密封*^(2)密码系统，旨在捕捉伪装的敌方忍者，即使他们通过窃取的密码、身份标记和正确的挑战回答词也能通过其他认证挑战。

在最常见的*tachisuguri isuguri*例子中，一个穿着正确制服并带有家徽的人接近一扇门准备进入。守卫因为不认识陌生人，选择坐下或站立，然后低声说出挑战词。如果来访者是已经了解*tachisuguri isuguri*识别协议的盟友，他们会根据预先安排的对应动作做出反应——一个不显眼的信号，如触摸自己的鼻子或耳朵——并低声说出匹配的密码词。只有当陌生人同时回答正确的密码词和正确的身体动作时，守卫才允许其进入。（可能有多种方式来实现*tachisuguri isuguri*，而不仅仅是让守卫站立或坐下，但不幸的是，这些方法被认为记载在*Teikairon*卷轴中，*Bansenshūkai*的一个失落的补充部分。）^(3)

这种技术的简单妙处在于，站立或坐下的动作通常不会被人注意到。即使是一个恶意的观察者试图冒充授权人员，也很可能没能注意到这个第二个、无声的挑战响应。他们可能会看到 100 人用相同的口令通过一个门，而守卫坐着（因为他认得他们所有人），因此他们也不会看到守卫站起来时的互动差异。*Tachisuguri isuguri*足够成功，甚至其他忍者也没有足够的对策来阻止它，尽管*Bansenshūkai*指示忍者在所有检查点模仿守卫的行为和言辞，即使守卫看起来似乎是无意识地行动；（^(4)）如果没有其他作用，至少可以让守卫混淆，认为忍者是无序的或仅仅是愚蠢的。卷轴还向任何未能通过未知的*tachisuguri isuguri*挑战的忍者提供了有用的建议：要么迅速思考并快速说话——要么拼命逃跑。(^(5))

虽然忍者卷轴并未明确说明*双重封印*的定义，且我没有证据表明下面的假设性例子真的发生过，但我仍然认为它是一个合理的概念示例。印章，通常刻印在蜡上，自古以来就被用来确保信件或卷轴内容的安全。理想情况下，每个通信的发送者都有一个独特的金属印章，因此只有他本人能够做出特定的印记，从而验证文档的真实性。此外，如果除预定收件人之外的任何人打开了信件或卷轴，印章就会破裂，表明内容已被篡改。

然而，间谍们发现，通过特殊的加热技术，他们可以松开蜡，完好地取下印章而不伤害纸张，读取信件的内容，然后重新封印原始文件或将印章附加到新伪造的包含虚假信息的文件上。对抗这种融化蜡封纸面技巧的方法可能就是“**双重封印**”蜡。想象一下，作者不是使用单一的金属印章，而是用了一个夹具或类似于台钳的设备，它两面都有印章。蜡片的下侧会在纸的下方留下一个隐藏的印章，这个印章只有在撕开文档时才能看到。尝试融化封蜡纸面可能会保留顶部的印章，但会破坏第二个隐藏印章，从而使通信变成双重封印。

你可以理解为什么双重封印被采纳作为有效的对抗手段，防止单一封印被突破，并且它如何帮助发现敌方忍者的活动。在本章中，我将指出两因素认证和第二步认证之间的区别。我还将讨论如何通过双重封印来增强现代第二步认证器的有效性。接着，我将描述我认为实施双重封印密码的要求和标准，以及如何利用现有的认证器和技术来实现它们。我的希望是，通过进行思维训练，并参考我提供的双重封印密码实现示例，你能理解楠木正成的智慧，并尝试亲自实践这一极具直觉性的想法。

## 隐藏的 2 步认证

越来越多的网络认证和身份验证协议要求在密码上增加一层安全保护。这就是所谓的*2 步认证*：第二步要求用户执行额外的认证操作，比如提供一个密钥或点击一个*外部设备*上的按钮（即与其余认证过程无关的设备）。注意，它与上一章提到的两*因素*认证有些微区别，后者用于防止攻击者利用被窃取的登录凭据访问账户。

尽管通过软件应用可以随机化秘密代码（第二步），但通常每次生成时都使用相同的程序。不幸的是，这种程序的僵化性给对手提供了多个机会来破坏 2 步身份验证方法。例如，2 步身份验证代码通常通过明文的、未加密的消息发送，可以通过电话克隆被拦截。在这种情况下，用户收到验证码 12345 并在密码提示框中输入该序列时，也无意中将代码提供给了对手。用于身份验证的设备——通常是手机——可能会被盗，或者通过呼叫转接被劫持，甚至被克隆并被对手用来完成身份验证。同样，用于发送 2 步验证码的带外设备也可能丢失或被盗，并被用来绕过身份验证过程，从而使对手窃取用户提供的备份代码。

使用 tachisuguri isuguri 技术加密的双重密钥 2 步验证码可以缓解某些身份验证过程中的固有弱点。每个用户应能够建立一个事先安排好的、对他们来说既独特又有意义的 tachisuguri isuguri 标识符。例如，假设一个用户已经通过口头或其他安全方法被指示，在他们的 2 步验证码中，将数字按键盘上的数字 5 进行交换——1 变为 9，2 变为 8，以此类推^(6)——但是仅当验证码显示为红色字体时才会生效，而不是正常的绿色。这种颜色变化是隐性的 tachisuguri isuguri 因素，在系统由于时间异常、未识别设备或不同 IP 地址的请求等原因发现身份验证请求可疑时触发。（为了避免让可能监视登录的对手知晓，此协议不应过于频繁地使用。）现在，当合法用户收到红色验证码 12345 时，他们知道应该输入 98765，而窃取了用户凭证但不知道隐藏规则的对手如果输入 12345，身份验证过程将被中止，账户会被标记进行调查，并将该会话添加一个 2 步身份验证失败。随后，2 步身份验证器会发送一个提示——“使用身份验证协议#5”，可能还会附带另一个红色验证码，例如 64831（用户应回答 46279）。另一个错误响应将触发进一步的警报或账户锁定。

## 开发双重密封密码

集成了行业标准授权控制的双重密封安全解决方案将执行以下操作：

1.  仅在怀疑用户身份时使用，例如当用户：

    +   从新设备、位置、IP 地址或时间窗口登录

    +   报告他们的移动设备被盗或遭到入侵

    +   丢失备份令牌、代码或密码，需要重置密码

1.  使用带外或侧信道通信方法。

1.  使用基于规则的秘密知识因子。每个用户应能够自定义协议，创建一套独特的隐秘规则。

1.  利用易于理解和记住的认证因子，但不明显。

1.  允许在连续错误猜测或认证尝试之间经过足够时间后，将规则叠加使用。

1.  启用限制、冻结或锁定因认证失败次数过多的账户。大多数应用程序在连续错误密码后会锁定账户，但不会对连续错误的 2 步认证尝试进行锁定。

1.  不应在任何帮助台 SOP 或其他文档中描述。员工也应避免公开讨论双重密封安全层。

普及双重密封安全性需要设计师、工程师和用户共同探索技术可行性并应用创造性思维。例如，考虑现有手机设备上的各种输入变化，这些设备可以与 2 步认证应用一起使用，并仅要求用户按“是”或“否”按钮来验证身份。以下是一些示例，展示当用户在 2 步认证应用中收到 tachisuguri isuguri 信号时可能的响应范围：

1.  用户在选择“是”之前将屏幕旋转到倒置状态，应用程序会静默检查`DeviceOrientation`状态，以测试其是否等于`portraitUpsideDown`。

1.  用户操作手机设备上的物理音量按钮，将`OutputVolume`设置为 0.0（静音）或 1.0（最大音量）后选择“是”，应用程序会静默获取音量浮动值，测试其是否与预定值匹配。

1.  用户等待直到他们观察到手机设备时钟滚动到下一分钟，然后立即选择“是”。应用程序会静默请求时间戳，并将选择时间与 HH:MM:0*X*进行比较，其中*X*小于 3 秒。

1.  用户在手机设备上选择“是”时施加过多压力，应用程序会静默获取事件的`UITouch.force`，以判断其是否超过预设阈值。

1.  用户在手机设备上快速多次点击“是”按钮，应用程序会静默获取`UIEvent`的`tapCount`，判断其是否少于 2 次。

1.  用户在选择手机设备上的“是”按钮时执行手势，应用程序会静默获取`UIGestureRecognizer`，判断其是否为`Pinch`、`LongPress`、`Swipe`（上、下、左、右）或`Rotation`。

## 推荐的安全控制和缓解措施

在相关情况下，会根据 NIST 800-53 标准提出的适用安全控制来提供建议。每个建议都应从 2 步（双重密封）认证的角度进行评估。

1.  通过独立的通信路径利用带外认证（OOBA）验证认证请求是否来源于已验证的用户。[IA-2: 身份识别与认证 | (13) 带外认证]

1.  确保工作人员不会透露 2 步认证隐藏规则的存在。[IA-5: 认证器管理 | (6) 认证器保护]

1.  建立多个双重密封规则，以确保 tachisuguri isuguri 不是静态的。[IA-5: 认证器管理 | (7) 无嵌入式未加密静态认证器]

1.  实施带外通信并建立双重密封规则以保持机密性。[SC-37: 带外通道]

1.  仔细设计失败认证尝试的错误消息，以免泄露对手可能利用的双重密封密码信息。[SI-11: 错误处理]

## 复盘

在本章中，你了解了一种反忍者认证技术，叫做双重密封密码或 tachisuguri isuguri。我们讨论了身份验证过程中因素和步骤的区别。然后，我们简要分析了良好的 tachisuguri isuguri 认证器的标准，并列举了几个示例。

在下一章中，我们将讨论一个叫做“潜入时机”的忍者概念。你将了解一天中的特定时段如何提供有利的潜入机会。理解这些基于时间的机会，可能有助于你选择何时在组织中实施或触发 tachisuguri isuguri 认证器，比如仅在特定时段或日期，减少 tachisuguri isuguri 的使用并保持其机密性。
