# 第二十二章：零日漏洞

一个秘密只有保持不泄露才能奏效；如果泄露出去，你就会失败。

> 你应该意识到，不应使用任何已经为人所知的古老方式，因为这样你会失去出其不意的优势。
> 
> —《正忍记》，《高木を超え飛行機に入るの習い》^(1)

忍者的一个关键战术优势就是隐秘性。卷轴反复警告忍者要防止他人了解他们的能力细节，因为如果某项技术被泄露给公众，后果可能是灾难性的。不仅这项技术可能会在几代人之间失效，而且使用该技术的忍者的生命也可能面临危险。《正忍记》和《忍法传》都描述了将忍者的秘密技艺暴露给外部人员的危险，一些卷轴甚至建议杀掉那些发现技艺秘密的目标或观察到忍者行动的旁观者。^(2)

《正忍记》和《忍法传》都引用了因公开暴露而被毁掉的古老技术。例如，当古代忍者（*yato*）^(3)进行侦察时，他们有时会穿越农田；他们通过多种方式避免被发现，其中之一就是装扮成稻草人，当有人靠近时摆出一个逼真的姿势。^(4) 然而，一旦这个技巧被发现，当地人开始通过冲向稻草人，甚至刺穿它们来测试稻草人的真假。不管忍者的伪装多么逼真，动作多么巧妙，这个技巧变得太危险，忍者不得不开发出新的隐藏方式，或者干脆避免穿越农田。这个技能就这样丧失了。

同样，一些忍者成为了猫狗声音的模仿大师，以便在执行任务时不小心暴露自己的存在时，他们可以通过吠叫或喵叫来让目标相信骚动只是经过的一只动物，无需进一步检查。这个技巧最终也被发现了。警卫被训练去调查不熟悉的动物声音，这使得忍者面临被发现的风险。^(5)

卷轴中还描述了一个情景，其中一座防御工事由狗保护，而忍者无法在不引起警卫怀疑的情况下杀死、绑架或与狗建立友谊。在这种情况下，卷轴建议忍者涂抹鲸油的气味，然后等待狗远离警卫，或者将狗引开。接着，他们会殴打狗，并且连续几晚都这么做。由于鲸油的刺鼻气味和稀有性，这种气味会使狗将疼痛和惩罚与这种气味联系起来，最终狗就会害怕攻击涂抹了这种特殊气味的忍者。当这一技术被公开时，警卫们被训练去注意鲸油的独特气味，或者注意到狗的行为突然发生变化。^(6)

当然，大多数忍者的秘密在忍者实际上成为历史遗物之后，直到许多年后卷轴正式出版时才被揭示出来。因此，那个时代的防御者必须创造出一些技术来挫败他们没有详细了解的攻击——甚至可能是那些攻击者自己尚未考虑到的攻击。

对于作为防御者的忍者，卷轴提供了一些基本的建议。*万善集会*的《指挥官指南》^(7)卷推荐了各种安全最佳实践，包括密码、认证印章、标记、以及秘密标志和信号。卷轴还建议指挥官思考这些安全策略背后的原因；将其与其他标准协议结合使用，如夜间值守和警卫；采取预防措施，如设陷阱；并开发自己的秘密、定制、动态安全方案。综合来看，这些技术能够抵御低技能或中等技能的攻击者，但无法应对最为复杂的忍者^(8)。

为此，*万善集会*最务实的安全建议是，防御者永远不可能做到完全安全、时刻警觉或纪律严明。始终会存在忍者可以利用的漏洞。相反，卷轴强调理解敌人的哲学、思维方式和思考过程的重要性，并敦促忍者愿意尝试新的技术，有时甚至是在应变时：“很难准确地根据情势、时间和地点来决定该如何行动。如果你有一套固定的方式或使用固定的形式，那么即使是最伟大的将军，又怎么可能获得胜利呢？”^(9)

忍者防御者采用了创造性的思维建模，比如通过想象逆转的场景并探索潜在的漏洞。他们从大自然中汲取灵感，想象鱼、鸟或猴子如何渗透到城堡中，并思考如何模仿这些动物的能力^(10)。他们通过研究常见的盗贼（*盗人*）来获得新的技术。最重要的是，他们信任人类思维的创造力，并不断进行学习、逻辑分析、问题解决以及元认知的灵活性。

> 尽管忍者的学习有成千上万的课程，它们既微妙又不断变化，但你不能通过传统方式或传承将这些知识完全传授给他们。你需要做的最重要的事之一，就是尽量了解你能了解的所有地方或省份……如果你的思维完全与事物的本质相符，并且以完美的理性和逻辑进行运作，那么你就能穿过“无门之门”……人类的思维是奇妙而灵活的。它令人惊叹。随着时间的推移，无论是清晰还是神秘，你都会意识到事物的本质，理解会从无处而来……在[忍者的道路]上，你应该掌握一切你能够掌握的……你应该利用你的想象力和洞察力来领悟和把握一切事物的方式。^(11)

一个具有前瞻性思维、敏锐头脑和勤奋工作态度的忍者，能够建立足够强大的防御系统，以抵御未知的攻击，迫使敌人投入时间和资源开发新的攻击计划，测试安全漏洞，并与隐藏的防御作斗争——结果只会在整个安全系统动态变化时，再次被挫败。

在本章中，我们将探索现代零日威胁的格局，并理解我们可以将忍者卷轴中描述的哪些哲学和技巧应用于网络安全。此外，我们还将探索各种针对零日的防御措施。本章中的城堡思维练习提出了应对隐藏在现代计算硬件、软件、云计算和网络中的未知和潜在零日漏洞的挑战——所有这些都希望能激发新的见解。

## 零日漏洞

在网络安全词汇中，很少有像*零日*（或*0-day*）这样的术语，能像它一样让防御者和知识丰富的商业利益相关者感到恐惧，它是指一个之前未知的漏洞或攻击，防御者可能不知道如何应对。这个术语来源于公众对攻击或漏洞知晓的天数为零。因为受害者和防御者没有机会研究这个威胁，所以拥有零日漏洞的攻击者几乎总是能成功，特别是当这个零日漏洞针对的是一种常见技术时。例如，STUXNET 使用了四个零日漏洞，破坏了伊朗的一个空气隔离的核浓缩设施，展示了零日漏洞对攻击即使是最安全、最隐秘目标的强大威力。^(12)

零日攻击的价值源于其未知性。一旦威胁行为者利用了零日漏洞，受害者就有机会通过传感器和监控系统捕获攻击的证据，进行法医分析并逆向工程攻击方式。在零日漏洞被公开后，安全专家可以迅速开发缓解措施、检测签名和补丁，并发布 CVE 编号以提醒社区。并不是每个人都注意这些警告或修补他们的系统，但随着零日漏洞变成 1 日、2 日漏洞，成功的几率会越来越低。

零日漏洞的部署方式取决于攻击者的动机。那些急于获得丰厚回报的网络犯罪分子，可能会立即利用零日漏洞发起一次大规模且高度可见的攻击，从而最大化他们的即时收益。更为先进的威胁行为者会建立程序来删除攻击过程中产生的痕迹、日志及其他可观察的证据，从而延长零日攻击的有效期。真正复杂的攻击者会将零日漏洞留给那些防御坚固、具有高价值的目标，因为针对流行技术的零日漏洞在黑市上可以卖到数千美元，或者卖给渴望将其武器化或建立防御的政府，价格甚至超过 100 万美元。

虽然一些零日漏洞源于软件代码中合法的、出于善意的安全缺口，但威胁行为者也可以通过协议或秘密安排，恶意地将零日漏洞引入软件应用的源代码中。定向攻击还可以通过妥协软件库、硬件或编译器，引入漏洞、后门和其他隐藏的弱点，为未来的利用提供条件，方式与忍者加入城堡建设队伍、通过制造只有忍者知道的秘密通道来破坏设计非常相似（卷轴中提到过这种情况）。^(13)

传统上，零日漏洞的发现依赖于具有深厚专业知识的安全研究人员、创意思维的威胁猎人，或者分析师在野外偶然发现攻击他们的漏洞。虽然这些方法依然有效，但“模糊测试”等新技术已经帮助自动化了零日漏洞的检测。模糊测试工具及类似工具会自动尝试各种输入——随机的、无效的和意外的——以发现以前未曾知晓的系统漏洞。AI 驱动的模糊测试器和 AI 防御系统的出现，标志着一个新范式的到来。就像大炮的发明可以穿透城墙，从而促使新的防御战略的产生一样，人工智能的出现也提供了这样的可能性：防御体系未来可能会几乎与威胁本身一样快速演进。当然，攻击系统也可能学会如何压倒任何防御能力，改变行业检测和应对零日漏洞的方式，也可能改变全世界对网络安全的看法。

然而，目前漏洞利用和发现的模式是周期性的。威胁行为者会熟悉一部分漏洞和安全缺陷，如 SQL 注入、XSS 或内存泄漏。当防御者熟悉应对这些威胁的方法时，攻击者会转向利用不同的技术和方法，这样周期就会继续。随着时间的推移，当这些防御者和攻击者离开职场时，我们很可能会看到新一代的威胁行为者重新发现新软件和技术中的相同常见弱点，从而导致旧的零日漏洞重新浮出水面——这个周期将重新开始。

## 零日防御

零日检测和防护常常成为新进入网络安全市场的厂商的主打宣传，他们喜欢承诺通过其解决方案带来显著的成果。这并不是说他们的解决方案都无效。然而，这个话题很容易滑入庸医推销的领域。放心，我并不是在推销任何东西，而是在提供有关威胁的实际指导，如下所述。

1.  *遵循最佳实践*。尽管零日漏洞极其难以防御，但这并不意味着你应该放弃安全防护。遵循行业最佳实践。虽然这些方法可能无法完全消除零日漏洞的威胁，但它们确实能让威胁行为者更难在你的环境中实施攻击，同时也为你的组织提供了更好的机会来检测和应对零日攻击。与其空想潜在的零日漏洞，不如修补并缓解 1 天、2 天、3 天等漏洞，最大限度地减少组织在已知攻击面前暴露的时间。

1.  *使用猎杀小组和蓝队*。组建或外包猎杀小组和蓝队，共同制定零日防御策略。

    猎杀小组由专门的防御人员组成，这些人员不依赖于标准的基于签名的防御方法。相反，他们不断地提出假设，推测对手可能利用零日漏洞或其他方法来渗透网络。基于这些假设，他们通过蜜罐、行为和统计分析、预测性威胁情报以及其他定制化技术进行猎杀。

    蓝队由专门的防御人员组成，他们负责设计、测试和实施实际的防御措施。首先，他们记录系统或网络的信息流，然后构建威胁模型，描述可能对当前设计成功的实际和假想攻击。与猎杀小组不同，蓝队的任务不是发现零日漏洞。相反，他们根据零日漏洞评估其信息和威胁模型，以确定如何有效地减轻、保护、加固和防护其系统。蓝队独立于正常的安全、运维和事件响应人员，但该团队应审查现有的事件响应报告，以确定防御失败的原因，并制定针对类似未来攻击的主动防御策略。

1.  *实施动态防御……谨慎行事*。近年来，安全专家们已积极努力引入复杂且动态的防御措施：

    +   尝试让网络成为一个移动的目标——例如，每晚更新

    +   引入随机化——例如，地址空间布局随机化（ASLR）

    +   在交互过程中动态变化——例如，量子密码学

    +   启动不规则的防御条件或免疫反应系统

    其中一些动态防御最初非常成功，但随后对手开发了突破它们的方法，从战略角度看，它们实际上变得静态。

    与网络安全供应商和从业人员沟通，并查阅关于最前沿动态防御的文献，以确定哪些措施适合你的组织。然而，请谨慎行事，因为今天的动态防御可能会成为明天的标准配置，容易被规避的安全层。

1.  *构建一个更加无聊的防御*。考虑在你的环境中尽可能利用“无聊”的系统、编码实践和实现。这个概念由 Google 的 BoringSSL 开源项目发起，14，提出简化和减少代码的攻击面、大小、依赖性和复杂性——让它变得无聊——可能会消除高价值或关键漏洞。在这一实践下——无论是在代码、应用程序还是系统层面——代码不是复杂或精巧的，而是单调地被保护并且结构上无变化，实施方式单调简单。理论上，简化代码，使其更易于人类和机器阅读、测试和理解，会使得意外的输入或事件不太可能暴露零日漏洞。

1.  *实践否认与欺骗（D&D）*。D&D 可以防止对手获取有关你环境、系统、网络、人员、数据和其他可观察因素的信息，并且可以欺骗对方采取对你有利的行动。让对手的侦察、武器化和攻击传播变得更加困难，迫使他们花费更多时间来测试、探索和验证他们认为存在的环境差距是否真实。例如，你可以通过欺骗性地修改你的系统，使其看起来像是运行了不同的操作系统和软件，比如将 Solaris 实例改为类似 SELinux 系统的外观。（理想情况下，你会实际迁移到 SELinux，但由于传统 IT 系统的后勤问题，可能会让你的组织继续依赖旧软件，远超过预期。）如果你的欺骗有效，对手可能会尝试开发并投送针对 SELinux 实例的武器化攻击——但当然，这将失败，因为你并没有真正运行 SELinux。

    注意，D&D 应该建立在良好的安全实践基础上进行应用，以增强这些实践，而不是仅凭借 D&D 通过安全模糊化来实现安全。D&D 是一种面向极其成熟组织的安全终局策略，旨在为防御持久性威胁行动者提供额外的防护方法，类似于 *《万川集海》* 中描述的“低调战术”。^(15)

1.  *断开连接以保护。* 在讨论断开防御时，*《忍经》*教你从心理、战略、物理以及其他各方面与敌人断开连接。^(16) 在网络安全中，这意味着创建一个自我流放的蓝队，完全向内转向，与外界隔绝，忽视所有安全新闻、威胁情报、补丁、漏洞、恶意软件变种、新的签名、前沿产品——任何可能影响他们思维、改变他们心态或与敌人建立联系的事物。如果操作得当，断开连接技巧能使防御者的思维方向远离行业标准。对手很难像被断开连接的防御者那样思考，防御者则能制定出独特的、敌人未曾遇见的秘密防御策略，使零日攻击极其难以奏效。

    像 D&D（假设方法）一样，只有在你已经具备精英网络安全技能的情况下，才推荐使用这种方法。否则，孤立自己并在黑暗中行动可能适得其反。

## 推荐的安全控制和缓解措施

在相关情况下，推荐措施与适用的 NIST 800-53 标准中的安全控制一起呈现。每一项都应以零日漏洞的概念进行评估。

1.  为你的组织创建定制、动态和自适应的安全保护措施，以加强最佳安全实践。[AC-2：账户管理 | （6）动态权限管理；AC-4：信息流强制执行 | （3）动态信息流控制；AC-16：安全与隐私属性 | （1）动态属性关联；IA-10：自适应身份验证；IR-4：事件处理 | （2）动态重配置；IR-10：集成信息安全分析团队；PL-8：安全与隐私架构 | （1）深度防御；SA-20：关键组件的定制开发；SC-7：边界保护 | （20）动态隔离和分离；SI-14：非持久性]

1.  保留零日漏洞的记录，包括发现的时间和方式、所针对的技术、漏洞扫描结果以及与预测未来零日漏洞的关联。[AU-6：审计审查、分析和报告 | （5）审计记录的集成分析；SA-15：开发过程、标准和工具 | （8）威胁和漏洞信息的重用]

1.  进行专业的漏洞扫描、验证和系统测试，以评估零日漏洞的安全性。[CA-2：评估 | （2）专业评估]

1.  合同聘请专业渗透测试人员，寻找软件、系统和其他技术中的零日漏洞，以便你能够主动防御这些攻击。[CA-8: 渗透测试；RA-6: 技术监控对策调查]

1.  为你的系统和软件进行威胁建模，评估潜在的零日漏洞，并评估如何通过主动重新设计来减轻这些威胁。考虑实施“枯燥”的代码。[SA-11: 开发者测试与评估 | (2) 威胁建模和漏洞分析；SA-15: 开发过程、标准和工具 | (5) 攻击面缩减；SI-10: 信息输入验证 | (3) 可预测行为]

1.  实施定制化、多样化、独特的安全防御措施，减轻零日漏洞利用你系统的能力。[SC-29: 异质性]

1.  部署拒绝和欺骗行动，减少对手进行侦察或武器化并对你的组织发动零日攻击的能力。[SC-30: 隐蔽与误导]

1.  建立猎人小组和安全小组，搜索零日攻击和漏洞的指标。[SI-4: 系统监控 | (24) 妥协指标]

1.  定期进行自动化漏洞扫描，检查 1 天漏洞、2 天漏洞、3 天漏洞等。根据需要修补、缓解或修复漏洞。[RA-5: 漏洞扫描；SI-2: 缺陷修复]

## 汇报

本章回顾了忍者的技艺以及他们数百年来培养的攻击技术的秘密。我们探讨了许多这些秘密忍者技艺与今天我们观察到的零日漏洞和攻击是如何紧密相似的。我们回顾了零日攻击在网络安全、网络战争和信息主导方面的当前状态和潜在未来。本章讨论了零日漏洞的讨论可能显得无意义，但实际上对于应对这种威胁至关重要。

在下一章，我们将讨论如何雇佣合适的人才来应对零日漏洞和各种威胁行动者。我们将回顾忍者卷轴中关于招募忍者的指导原则，并探讨如何将这些指导应用于吸引网络安全人才。网络安全行业存在人才短缺的说法，我怀疑在日本中世纪的动荡时期，忍者也面临类似的短缺问题。忍者卷轴解释了如何识别可以训练成为忍者特工的人，这一角色的风险远高于今天的办公室工作。错误的招聘选择可能会导致人员很快死亡，从而浪费培训投入并危及任务和团队成员的生命。
