# 第四章：识别挑战

尽管有一些古老的识别标记、密码和证明方法，除非你发明新的并且定期更换，否则敌人最终会通过类似的假冒方式渗透进来。

> 在夜间进攻时，敌人可能会跟随你并进入你盟友的阵营。为了防止这种情况，必须有一个预定的政策——一种辨别盟友的方法。
> 
> —吉守百首 #27

想象以下历史场景：在执行夜间突袭后，一位军事指挥官必须打开城门让部队重新进入防御工事。夜间突袭有助于赢得战斗，但也为反击提供了机会。敌方的忍者可以伪造或偷取袭击部队的制服，并在他们返回基地时混入队伍。

为了应对这一威胁，指挥官实施了一个一次性密码，袭击者必须在通过城门之前使用该密码——但这个密码很容易被破解：伪装成士兵的忍者会在排队时听到前方士兵说出的密码。因此，指挥官尝试了其他识别方法。有些要求袭击者穿戴某种特定颜色的内衣，以便在他们返回时进行检查，但聪明的忍者会携带或穿上多种颜色的内衣，然后有选择性地拉开内衣的层次，只露出正确颜色的部分以便检查。其他的对策包括一天多次更换密码（但这依然无法阻止忍者偷听到当前的密码）以及独特的制服标志或徽章（忍者可以在突袭后从死去士兵的尸体上偷走这些标志）。

忍者将这些技巧分为两类，分别是明装忍术（*yo-nin*，字面意思是“光明忍者”）和暗藏忍术（*in-nin*，字面意思是“黑暗忍者”）。在这种情况下，*明装*指的是显而易见的，比如攻击者可以穿上防守士兵的制服，完全预计到自己会被看到。而*暗藏*则指的是尽量不被看到，比如使用伪装或融入阴影中。许多《万川集海》中描述的明装忍术技巧都可以在进攻和防守中同时使用。忍者不仅知道如何利用这些技巧进行攻击，还知道如何识别敌方的渗透者。间谍常常复制制服和纹章，或偷听密码，因此忍者发展出了识别对策，以区分盟友和敌人。

其中一种身份识别技术是*配对词组*，一种用于验证盟友的词语组合挑战。^(1) 这种技术也被称为*口令*或*挑战-响应认证*。配对词组技术的运作方式如下：一个身份不明的人走近城堡门口的守卫并要求进入。守卫首先检查陌生人是否穿着正确的制服并佩戴合适的徽章。如果是，守卫就说出一个词——例如“树”。如果陌生人没有用正确的预设配对词作答——比如“森林”——守卫就知道他们面对的是敌人。虽然*《万川集海》*指出配对词组应该简单到“低级”人员也能记住，但它建议避免使用对手可能猜到的常见联想。因此，与其使用“雪”和“山”，不如使用“雪”和“富士山”这一对。卷轴建议忍者与指挥官合作，每 100 天生成 100 对不同的匹配词，并每天使用一对新的配对。^(2) 这个大量的配对词组可以让哨兵在每支部队接近时随机轮换配对（如果需要），这样伪装的敌人就不太可能偷听到他们将收到的挑战词的答案。

配对词组被用来揭示可能的渗透者。如果陌生人回答挑战问题错误，他们会被迅速拘留、审问，甚至可能被杀害。了解这些后果，*《万川集海》*建议试图潜入敌营的忍者将自己的外貌、行为和语言打扮成一个邋遢或低级士兵的样子。这样，如果他们被要求回答一个自己不知道的配对挑战，他们可以可信地声称自己不知道答案。^(3) 一些读者可能注意到，他们的金融机构已经开始使用配对单词或图片来进行在线身份验证，但需要注意的是，这些网站并不要求使用 100 对不同的配对，也不会频繁更新它们，甚至可能根本不会更新。一个小范围的静态配对池使得对手能够观察所有配对，然后利用窃取的认证回应执行未授权的操作。

这些历史示例强调了在面对先进且动态的对手时，保护身份验证的挑战。在本章中，我们将讨论证明身份的困难，并介绍信息保障（IA）中用于身份验证的各种因素。我将提到一些现代网络威胁行为者用来阻挠身份验证的技术，强调类似忍者战术的策略，说明为什么身份验证在可预见的未来将是一项挑战。我还将为读者提供如何将忍者身份验证技术应用于现代应用程序的指导。本章的总体目标是帮助读者理解这一身份识别问题的关键问题，而不是迷失在身份验证和密码学这一广阔的知识领域中。

## 理解身份验证

*身份验证*是确认用户身份的过程，在授予访问信息系统、数据、网络、物理场所和其他资源之前。身份验证过程通过询问用户所知道的内容、用户拥有的东西或用户本身的特征来确认用户身份。例如，身份验证器可能会要求输入密码（用户知道的东西）、令牌（用户拥有的东西）或生物特征（用户本身的特征）。根据所需的安全级别，组织可能需要*单因素*、*双因素*或*多因素*身份验证。

成熟的组织可能还会使用*强身份验证*，该方法使用多层次的多因素凭证。例如，强身份验证的第一步可能需要用户名、密码和指纹，而第二步则通过令牌和通过短信发送的一次性验证码进行验证。越来越多的行业专业人士正在考虑第四个因素的可行性，比如组织中的可信人员来确认用户的身份。有趣的是，匹配对忍者场景从这个测试开始；只有当周围没有人能够验证陌生人的身份时，才会使用这一挑战。

身份验证失败是一个关键的安全漏洞。用户的已验证身份与允许他们执行特定、通常是特权的操作的权限相关联。成功搭载在有效用户的身份验证连接上的对手，能够自由访问用户的资源，并可以在信息系统、数据和网络上进行恶意活动。

不幸的是，认证过程并不完美。尽管有大量的网络认证措施，目前仍然无法完全确定地验证用户或进程的身份，因为几乎每个现有的验证测试都可能被伪造（*伪造*是使用虚假数据冒充其他实体）或被攻破。攻击者使用多种技术盗取密码、拦截令牌、复制认证哈希或票证，以及伪造生物识别数据。如果攻击者获得了身份管理系统的未经授权访问权限，如域控制器，他们可以创建和认证伪造的账户。用户认证后，他们的身份在会话期间很少受到挑战，除非需要重新输入密码以进行特权任务。同样，伪装成忍者的人也能在城堡内部自由行动而不被质疑——在这两种情况下，都假设内部人员已通过认证。

安全技术正在不断发展，以应对认证威胁。一种新兴的解决方案，称为*持续* *认证*或*主动认证*，在初次登录后持续验证用户身份。然而，由于持续认证对话框可能会妨碍用户体验，因此也在开发一些技术，通过输入风格、鼠标移动或与用户身份相关的其他行为特征来监控认证。这些技术能够识别物理访问了无人看管的已登录系统的攻击者，将其锁定。这些技术同样适用于未经授权的远程访问方式，例如远程桌面协议（RDP）会话。即使攻击者使用有效的凭据和认证器登录，这些技术也能识别攻击者。当然，人的行为可能会发生变化。此外，即使是特定的行为，也可能被熟练的对手模仿或模拟，他们通过将用户行为侦察融入攻击中来实现。

匹配对模型的一种可能实现方式涉及使用被动脑波传感器的人工智能界面，这些传感器连接到一个基于用户思维模式来验证身份的系统。研究表明，当人类看到与自己有过互动的物体或有特定思维关联的物体时，会产生独特的脑波模式。因此，展示用户控制的刺激（如匹配对的词语或图像组合），监测大脑的电响应，并将其与用户档案匹配，可以准确地验证用户身份。通过动态生成足够多的独特挑战对，并使用风格化的排列组合，攻击者几乎不可能在提示下重放或模拟用户的脑波活动。

在下一节中，我们将讨论一些可用于匹配对认证的技术。

## 开发匹配对认证器

以下是开发匹配对认证器的几个建议和应用思路。

1.  **与合适的商业身份验证供应商合作。** 寻找使用与用户密码、账户名或其他可能被攻击者窃取的身份信息不同的挑战短语身份验证的供应商。尽管一些金融机构在授权账户更改之前使用匹配对挑战短语，但不幸的是，这种方法通常只在用户报告丢失或忘记密码时才会使用，而且挑战短语是静态的，不会发生变化。

1.  **开发新的身份验证系统。** 一款身份验证产品可以与身份控制系统集成，在经过身份验证的用户尝试执行特权操作（例如管理员/root/system 命令）时，向其展示一个匹配对挑战。在此协议下，即使攻击者观察到一个或多个挑战对，用户请求执行特权操作时也会被拒绝。

    理想的产品使用两种形式的匹配对挑战：每日挑战和用户预设挑战。每日挑战以非数字方式分发，只在授权人员可见的区域中展示，使用一个单词或图像挑战本地身份验证请求，并要求用户用匹配项作出回应。所有其他员工，包括远程/VPN 员工，都会建立一组不容易忘记或误解的大量匹配单词对。组织可以随机选择这些对，或定期轮换它们，以便快速识别在网络上已通过身份验证的未经授权用户。（请注意，为防止攻击者插入他们自己的匹配对来伪造或篡改凭证，必须对新的匹配对进行安全传输、存储和审计。）考虑在需要手动身份验证和授权进入的安全受控信息设施（SCIF）或隔离房间中，使用单向接口插入匹配对。其他机制还可以让组织通过要求访问用户的麦克风、摄像头、位置、正在运行的进程、内存或缓存、桌面截图等信息，来更好地识别威胁的来源和身份。

## 推荐的安全控制和缓解措施

在相关情况下，推荐的方案会与 NIST 800-53 标准中的适用安全控制一起呈现。每个方案都应在匹配对标识和身份验证挑战响应的背景下进行评估。

1.  对特权账户在设定的时间后、特权用户请求时，或在发现可疑行为时实施会话锁。只有在用户提供匹配对挑战响应后，才能重新建立访问权限。（会话锁可能比普通密码锁更优，因为匹配对验证只需一次点击或一个比用户账户密码更简单的词语。）[AC-11: 会话锁；IA-2: 身份验证与认证（组织用户）| (1) 网络访问特权账户 | (3) 本地访问特权账户；IA-10: 自适应身份验证与认证；IA-11: 重新认证]

1.  识别、记录并执行安全控制，明确哪些用户操作可以在不通过匹配对挑战响应的情况下执行——例如，联系技术支持或拨打紧急电话。[AC-14: 无需身份验证或认证的许可操作]

1.  开发抗重放攻击的匹配对认证过程，通过建立大量一次性挑战响应认证器。[IA-2: 身份验证与认证（组织用户）| (8) 网络访问特权账户—抗重放]

1.  捕获能够唯一标识请求认证的用户设备的信息，以便收集未通过匹配对挑战响应的身份不明敌人的情报。[IA-3: 设备识别与认证 | (4) 设备证明]

1.  需要面对面输入匹配对以减轻挑战响应身份验证系统被攻破的风险。[IA-4: 标识符管理 | (7) 现场注册]

1.  物理和逻辑上隔离匹配对挑战响应系统，并实施严格的访问控制，防止其遭到破坏。[IA-5: 验证器管理 | (6) 验证器保护]

## 课后总结

本章强调了指挥官面临的挑战，他们需要验证部队成员的身份，以防止伪装的忍者渗透到他们的防御工事中。你学习了匹配对识别技术，既了解了忍者如何用它来检测敌人，又了解了忍者在进攻时如何防范这一技术。你还看到了这种技术在计算机安全认证和识别中的现代对应物。

在下一章中，你将通过理解认证因素和历史挑战响应，学习两步认证与匹配对之间的区别及其互补性。我将讨论一种隐藏的忍者认证技术——双重封印密码，它可以用来检测复杂的渗透者。
