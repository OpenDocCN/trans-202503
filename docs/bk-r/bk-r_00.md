## 前言

![image](img/common-01.jpg)

R 在各种研究和数据分析项目中发挥着关键作用，因为它使许多现代统计方法，无论是简单还是高级，都变得易于使用和快速获得。然而，确实，对于 R 的初学者来说，往往也是编程的新手。作为初学者，你不仅需要学习如何使用 R 来完成特定的数据分析目标，还需要学习如何像程序员一样思考。这部分是为什么 R 有时被认为“难学”的原因——但请放心，事实并非如此。

### R 语言简史

R 语言在很大程度上基于 S 语言，S 语言最早是在 1960 年代和 1970 年代由新泽西州贝尔实验室的研究人员开发的（欲了解概况，参见例如 Becker 等，1988）。为了拥抱开源软件，R 的开发者——来自新西兰奥克兰大学的 Ross Ihaka 和 Robert Gentleman——在 1990 年代初期以 GNU 公共许可证发布了它。（该软件的名字源自于 Ross 和 Robert 共同的首字母。）从那时起，R 的受欢迎程度迅速增长，因为它在数据分析中的无与伦比的灵活性和强大的图形工具，而这一切都以*零成本*提供。也许 R 最具吸引力的特点是任何研究人员都可以通过*包*（或*库*）的形式贡献代码，这样全世界就能快速获取统计学和数据科学的最新进展（参见附录 A.2）。

今天，R 的主要源代码库由一个专门的团队——*R 核心团队*——维护，R 是一个协作的成果。你可以在*[`www.r-project.org/`](http://www.r-project.org/)*上找到最杰出贡献者的名字；这些人值得感谢，因为他们不断的努力使得 R 始终保持活力，并处于统计计算的前沿！

团队相对频繁地发布 R 的更新版本。尽管随着时间的推移软件有了显著的变化，但相邻版本通常是相似的。在本书中，我使用了版本 3.0.1 至 3.2.2。你可以通过点击相关下载页面上的 NEWS 链接来查看最新版本的更新内容（参见附录 A）。

### 关于本书

*R 语言手册*旨在帮助你熟悉 R，作为第一门编程语言，并掌握其背后的统计思维。目标是为理解现代数据科学的计算特性打下一个既入门又全面的基础。

这本书的结构旨在内容上自然进展，首先聚焦于将 R 作为计算和编程工具使用，然后转向讨论如何利用 R 进行概率、统计以及数据探索和建模。你将逐步建立知识，在每一章的末尾，你会找到一个总结重要代码的部分，作为快速参考。

#### *第一部分：语言基础*

第一部分介绍了 R 编程中使用的基本语法和对象类型，对于初学者来说至关重要。第二章至第五章介绍了简单算术、赋值以及向量、矩阵、列表和数据框等重要对象类型的基础知识。在第六章中，我将讨论 R 如何表示缺失数据值并区分不同的对象类型。第七章为你提供了绘图的入门，使用了内置功能和贡献的功能（通过`ggplot2`包——参见 Wickham, 2009）；本章为后续讨论的图形设计奠定了基础。在第八章中，我将介绍从外部文件读取数据的基础知识，这对于分析你自己收集的数据非常重要。

#### *第二部分：编程*

第二部分专注于帮助你熟悉常见的 R 编程机制。首先，我将在第九章中讨论函数及其在 R 中的工作方式。接下来，在第十章中，我将介绍循环和条件语句，它们用于控制代码的流程、重复执行和执行顺序，之后我将在第十一章中教你如何编写自己的可执行 R 函数。这两章的示例主要帮助你理解这些机制的行为，而不是呈现真实世界的分析。我还将在第十二章中介绍一些额外的话题，如错误处理和衡量函数执行时间。

#### *第三部分：统计与概率*

当你对 R 语言有了扎实的掌握后，你将把注意力转向统计思维，在第三部分中学习。在第十三章中，你将了解描述变量的重要术语；基础的汇总统计量，如均值、方差、分位数和相关性；以及这些统计量在 R 中的实现。再次回到绘图，第十四章讲解如何通过使用和自定义常见的统计图形（如直方图和箱线图）来直观地探索数据（包括内置功能和`ggplot2`功能）。第十五章概述了概率和随机变量的概念，然后在第十六章中，你将了解一些常见概率分布在 R 中的实现和统计解释。

#### *第四部分：统计检验与建模*

在第四部分，你将接触到统计假设检验和线性回归模型。第十七章介绍了抽样分布和置信区间。第十八章详细讲解了假设检验和*p*-值，并通过 R 语言展示了实现与解释；然后，第十九章讨论了常见的方差分析（ANOVA）过程。在第二十章和第二十一章中，你将深入探索线性回归建模，包括模型拟合、处理不同类型的预测变量、推断与预测、以及变量转换和交互效应。第四部分的最后，第二十二章讨论了选择合适线性模型的方法，并通过各种诊断工具评估模型的有效性。

线性回归仅代表一类参数模型，是学习统计回归的自然起点。同样，用于拟合、总结、预测和诊断此类线性模型的 R 语法和输出与其他回归模型的语法和输出几乎相同——因此，一旦你掌握了这些章节，你将能够相对轻松地处理更高级文本中涉及的更复杂模型的 R 实现。

第三部分和第四部分包含了你在大学一年级和二年级统计学课程中所期待的内容。我的目标是将数学细节保持在最小范围内，重点放在实现和解释上。如果你有兴趣深入了解底层理论，我会在必要时提供其他资源的参考。

#### *第五部分：高级图形*

最后一部分讲解了一些更高级的绘图技巧。第二十三章展示了如何自定义传统的 R 图形，从处理图形设备本身到控制绘图外观的细节。在第二十四章中，你将进一步学习流行的`ggplot2`包，研究更高级的功能，比如添加平滑散点图趋势和通过分面制作多个图形。最后两章集中讨论 R 中的高维绘图。第二十五章讲解了颜色处理和三维表面准备，随后介绍了等高线图、透视图和像素图，并通过多个示例进行演示。第二十六章则专注于交互式图形，并包括一些绘制多元参数方程的简单说明。

虽然不严格要求，但在攻克第五部分之前，了解第四部分中讨论的线性回归方法会有所帮助，因为最后部分的一些例子使用了拟合的线性模型。

### 针对学生

像许多人一样，我开始熟练掌握 R 编程和相关的统计方法实现时，是在我开始研究生学习（在新西兰帕默斯顿北的梅西大学）时。依托于我在澳大利亚本科时接触过的几行代码，虽然“被抛入深水区”既有好处也有坏处。虽然这种沉浸式学习加速了我的进步，但当遇到问题时不知道该怎么办，当然是令人沮丧的。

*R 编程之书*因此代表了我希望在开始学习 R 时所能拥有的语言入门书籍，并结合了统计学这一学科的第一年基础知识，这些内容都已在 R 中实现。通过这本书，你将能够为使用 R 打下坚实的基础，既可以作为编程语言，也可以作为统计分析的工具。

本书的写作方式是从头到尾阅读，就像一篇故事（尽管没有情节曲折！）。书中的思想是逐步构建的，因此你可以选择从头开始，或是从你目前的知识水平开始。考虑到这一点，我给 R 语言的学生们提供以下建议：

• 尽量不要害怕 R。它会完全按照你所说的去做——不会多做，也不会少做。当事情没有按预期进行或出现错误时，这种字面上的行为反而对你有利。仔细查看每一行命令，并尝试缩小导致错误的指令。

• 尝试完成书中的练习，并通过提供的解决方案检查你的答案——这些答案作为 R 脚本文件都可以在本书网站上找到，* [`www.nostarch.com/bookofr/`](https://www.nostarch.com/bookofr/)*。下载*.zip*文件并提取*.R*文件，每个文件对应书中的一个部分。将它们打开并在你的 R 会话中运行，就像运行任何 R 代码一样，可以查看输出。短小的练习题旨在作为练习，而不是困难或难以克服的挑战。完成这些练习所需的一切信息都会在该章节的前面部分提供。

• 尤其是在学习的早期阶段，当你远离这本书时，尽量用 R 来做所有事情，即使是一些你平时可能在其他地方做的简单任务或计算。这将迫使你的思维更频繁地切换到“R 模式”，并且让你迅速适应这个环境。

### 给教师的建议

本书是根据我目前所在机构——新西兰奥塔哥大学数学与统计系——举办的为期三天的工作坊《R 语言入门》设计的，作为我们为研究生和教职工举办的统计学工作坊（SWoPS）的一部分。此课程由我的两位同事继承并发展为 SWoPS 类别的《统计建模 1》，《R 语言入门》的目标正如其标题所示，旨在解决编程方面的问题。您的内容覆盖将自然取决于目标受众。

在此，我提供了一些使用 *《R 语言宝典》* 内容的建议，适用于类似于我们 SWoPS 系列的工作坊。根据您的目标工作坊时长和学生现有知识，可以选择性地添加或删除某些章节。

• **编程入门**： 第一部分 和 第二部分。从 第五部分 中选取的内容，特别是 第二十三章（高级绘图自定义），也可能适合这样的课程范围。

• **统计学入门**： 第三部分 和 第四部分。如果需要简短介绍 R 语言，可以考虑省略，例如 第三部分 中的 第十三章，以及 第四部分 中的 第十七章 到 第十九章，并通过 第一部分 的内容构建初步基础。

• **中级编程与统计**： 第二部分 和 第四部分。如果受众希望提高绘图技能，可以考虑省略 第四部分 中的 第十七章 到 第十九章，并包含 第五部分。

• **R 图形**： 第一部分 和 第五部分。根据受众的知识水平，可能会省略 第一部分 的内容，以便包含 第二部分 中的 第十四章（基础数据可视化）。

如果您打算根据本书设计更长时间的课程，实践练习特别适合作为课后作业，帮助学生跟上 R 语言和统计学技能的发展。构成每章的主要内容相对容易转化为幻灯片，初步结构可以通过“详细目录”得到帮助。
