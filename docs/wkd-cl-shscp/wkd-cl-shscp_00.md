## **介绍**

![image](img/common4.jpg)

自 2004 年本书首次出版以来，Unix 系统管理的世界发生了许多变化。当时，很少有普通计算机用户使用类 Unix 操作系统——但随着像 Ubuntu 这样的初学者友好的桌面 Linux 发行版的流行，这一局面开始发生变化。随后，OS X 出现了，这是苹果基于 Unix 的操作系统的下一代版本，同时还有基于 iOS 的众多技术。如今，类 Unix 操作系统的采用比以往任何时候都更为广泛。事实上，如果我们把 Android 智能手机算在内，它们可能是世界上最为普及的操作系统。

不用多说，很多事情已经发生了变化，但有一件事没有变，那就是 Bourne-again shell（简称*bash*）依然是 Unix 用户的主要系统 Shell。利用 bash 脚本的全部功能，现在比以往任何时候都更需要成为系统管理员、工程师或爱好者工具箱中的一项技能。

### **主要收获**

本书重点讨论你在编写便携式自动化时可能会遇到的常见挑战，例如在构建软件或提供编排时，通过使常见任务易于自动化来解决这些问题。但从本书中获得最大收益的方法是，将你为每个问题创建的解决方案推广到你可能遇到的其他类似问题。例如，在第一章中，我们通过创建一个小的包装脚本来编写一个便携式的`echo`实现。虽然许多系统管理员会从这个具体的脚本中受益，但重要的收获是创建包装脚本的通用解决方案，以确保在不同平台之间的一致性。书中的后续章节，我们将深入探讨一些非常酷的 Bash 脚本功能和 Unix 系统中常见的实用工具，将强大的多功能性和能力轻松呈现在你的指尖。

### **本书适合你如果...**

Bash 仍然是所有在类 Unix 服务器或工作站上工作的人必备的工具，包括 Web 开发人员（其中许多人在 OS X 上开发并部署到 Linux 服务器）、数据分析师、移动应用开发人员和软件工程师——仅举几例！此外，越来越多的爱好者开始在开源微型计算机上运行 Linux，比如树莓派，用来自动化他们的智能家居。对于所有这些用途，Shell 脚本都是完美的选择。

这些脚本的应用对于那些希望通过一些很酷的 Shell 脚本来提升自己已相当扎实的 Bash 技能的人以及那些可能只是偶尔使用终端或 Shell 脚本的人来说，都是极其有用的。后者的人可能希望复习一些快捷键，或者通过阅读一些更高级的 Bash 概念来补充自己的知识。

但是，本书并不是一本教程！我们的目标是为你带来实际的 bash 脚本技术应用以及常用工具的（大多数是）简短、紧凑的脚本，但我们不会逐行解释。我们解释每个脚本的核心部分，经验更丰富的 shell 脚本编写者可能通过阅读代码理解其余部分的工作原理。但我们希望你作为读者能够亲自操作脚本——破坏它、修复它、修改它以满足你的需求——从中理解。这里的脚本精神在于解决常见挑战，例如网站管理或文件同步——每个技术人员都需要解决这些问题，不论他们使用的工具是什么。

### **本书结构**

第二版对原有的 12 章进行了更新和现代化，并新增了 3 章。每一章都展示了 Shell 脚本的新特性或应用场景，合起来涵盖了 Shell 脚本在简化 Unix 使用中的多种应用方式。OS X 用户可以放心，大部分书中的脚本都适用于 Linux 或 OS X；如果有例外，书中会明确指出。

**第零章：Shell 脚本速成课**

这一章是第二版的新内容，旨在为新 Unix 用户提供快速的 bash 脚本语法介绍及使用方法。从 Shell 脚本是什么的基本概念到构建和执行简单 Shell 脚本，本章简洁明了，帮助你快速掌握 bash 脚本，使你能在第一章中顺利开始。

**第一章：缺失的代码库**

在 Unix 环境中的编程语言，特别是 C、Perl 和 Python，都有丰富的函数库和工具，用于验证数字格式、计算日期偏移和执行许多其他有用任务。而在 Shell 环境中，我们的工具选择要少得多，因此本章重点介绍了各种工具和技巧，使 Shell 脚本更加易用。本章中学到的内容将帮助你更好地理解书中的脚本，也能提升你编写自己的脚本的能力。我们包含了多种输入验证函数、一个简单而强大的`bc`可脚本化前端、一个快速添加逗号以改进大数字展示的工具、一个绕过不支持`-n`标志的 Unix 系统的技巧以及一个用于在脚本中使用 ANSI 颜色序列的脚本。

**第二章 和 第三章：改进用户命令和创建实用工具**

这两章介绍了扩展和扩展 Unix 的多种新命令，具有各种实用的功能。实际上，Unix 的一个奇妙之处就是它始终在发展和进化。我们在推动这一进化方面与下一个黑客一样有责任，因此，这一对章节提供了实现友好的交互式计算器、不可删除的功能、两个提醒/事件跟踪系统、`locate`命令的重实现、一个多时区日期命令，以及一个新的`ls`版本，能够增加目录列表的实用性。

**第四章：调整 Unix**

这也许是亵渎之言，但 Unix 中有些方面似乎仍然有缺陷，即使经过几十年的开发。如果你在不同的 Unix 版本之间切换，特别是在开源的 Linux 发行版与商业 Unix（如 OS X、Solaris 或 Red Hat）之间切换时，你会注意到缺少的标志、缺失的命令、不一致的命令等问题。因此，本章包含了一些重写和 Unix 命令的前端，使其变得更友好或与其他 Unix 系统更一致。这里包括了一种向非 GNU 命令添加 GNU 风格的完整单词命令标志的方法。你还会找到一些智能脚本，使得与各种文件压缩工具的工作变得更加简单。

**第五章 和 第六章：系统管理：管理用户和系统维护**

如果你拿起了这本书，很可能你在一个或多个 Unix 系统上拥有管理员权限和管理责任，即使只是一个个人的 Ubuntu 或 BSD 系统。这两章提供了不少脚本来改善你作为管理员的工作，包括磁盘使用分析工具、一个自动向超出配额的用户发送邮件的磁盘配额系统、`killall`的重实现、`crontab`验证器、日志文件轮换工具以及一些备份工具。

**第七章：Web 与互联网用户**

本章包含了一些非常酷的 Shell 脚本技巧，展示了 Unix 命令行提供的一些极其简便的方法，用于处理互联网资源。这里包括了一种从网页中提取 URL 的工具、一种天气追踪工具、一种电影数据库搜索工具，以及一种网站更改跟踪器，它会在网站发生更改时自动发送邮件通知。

**第八章：Web 管理员技巧**

也许你运营着一个网站，无论是从自己的 Unix 系统上，还是在网络上其他共享服务器上。如果你是一个网站管理员，本章中的脚本提供了构建网页、创建基于 Web 的照片相册，甚至记录 Web 搜索的有趣工具。

**第九章 和 第十章：Web 与互联网管理以及互联网服务器管理**

这两章解决了面向互联网的服务器管理员面临的挑战。它们包括两个分析 Web 服务器流量日志不同方面的脚本，识别网站上破损的内部或外部链接的工具，以及一个时尚的 Apache Web 密码管理工具，使得维护*.htaccess*文件的准确性变得轻松。还探讨了镜像目录和整个网站的技术。

**第十一章：OS X 脚本**

OS X 凭借其吸引人的、商业上成功的图形用户界面，标志着 Unix 融入用户友好操作系统的巨大进步。更重要的是，由于 OS X 包括一个完整的 Unix 系统，隐藏在漂亮的界面背后，能够为其编写许多有用且具有教育意义的脚本，而这正是本章要探索的内容。除了自动化的屏幕截图工具，本章还包含了一些探索 iTunes 如何存储音乐库、如何更改 Terminal 窗口标题以及如何改进有用的`open`命令的脚本。

**第十二章：Shell 脚本趣味与游戏**

没有几款游戏的编程书算什么？本章结合了书中最复杂的技术和想法，创造了六个有趣且富有挑战性的游戏。虽然本章的目标是娱乐，但每个游戏的代码也非常值得研究。特别值得注意的是猜字游戏，它展示了一些巧妙的编码技巧和 Shell 脚本技巧。

**第十三章：与云端的协作**

自本书的第一版以来，互联网在我们日常生活中承担了越来越多的责任，许多与同步设备和文件到云服务（如 iCloud、Dropbox 和 Google Drive）相关。本章介绍了使您能够充分利用这些服务的 Shell 脚本，确保文件和目录得到备份和同步。您还会找到几个展示 OS X 特定功能的 Shell 脚本，用于处理照片或文字转语音。

**第十四章：ImageMagick 与图形文件处理**

命令行应用程序不必局限于文本数据或图形。 本章旨在通过使用开源软件 ImageMagick 中包含的一套图像处理工具，来识别和操作命令行中的图像。从识别图像类型到裁剪和加水印，本章中的 Shell 脚本完成了常见的图像任务，此外还涵盖了一些其他使用案例。

**第十五章：日期和日期计算**

最后一章简化了处理日期和约会的繁琐细节：计算两个日期之间的间隔、查找某个日期是星期几，或者离指定日期还有多少天。我们通过易于使用的 Shell 脚本解决了这些问题。

**附录 A：在 Windows 10 上安装 Bash**

在第二版的开发过程中，微软开始大力改变其对开源软件的态度，甚至在 2016 年为 Windows 10 发布了一个完整的 bash 系统。尽管书中的示例没有针对这个版本的 bash 进行测试，但许多概念和解决方案应该是非常具有可移植性的。在本附录中，我们介绍了如何在 Windows 10 上安装 bash，这样你就可以在 Windows 机器上尝试编写一些非常酷的 shell 脚本！

**附录 B：附加脚本**

每个优秀的童子军都知道你应该始终准备好备份计划！在我们的案例中，我们希望确保在开发本书的过程中有备份脚本，以防万一出现问题，需要替换某些脚本。结果是，我们并不需要备份，但和朋友们保守秘密可不有趣。本附录包括三个额外的脚本——用于批量重命名文件、批量执行命令和查找月相——这些是我们在准备好前 101 个脚本之后，忍不住想与大家分享的。

### **在线资源**

所有 shell 脚本的源文件，以及一些修改过的脚本，可以从*[`www.nostarch.com/wcss2/`](https://www.nostarch.com/wcss2/)*下载。你还会找到我们在脚本中使用的资源文件，例如第 84 个脚本中用于“吊死游戏”的单词列表（在第 277 页），以及第 27 个脚本中摘自《爱丽丝梦游仙境》的片段（在第 98 页）。

### **最后...**

我们希望你喜欢我们对这本经典 shell 脚本书所做的更新和新增的脚本。享受乐趣是学习的一部分，书中的示例之所以被选中，是因为它们有趣、易于编写并且充满挑战。我们希望读者在探索本书时能和我们写书时一样开心。祝你玩得愉快！
