## 第五章：4

**使用变量**

![image](img/common01.jpg)

你曾经想过成为医生、宇航员、消防员、动画师、市长、植物学家，或者忍者吗？如果你能成为它们所有的，但只能一次做一件事呢？一个*变量*可以是你程序中的任何东西，比如字符串或数字，但它一次只能是其中的一样。例如，一个猜数字游戏可能会要求玩家输入他们的名字（字符串），然后用这个名字问候玩家。接下来，程序可能会要求玩家输入他们的第一次猜测（数字），然后检查是否猜对了。

为了使游戏正常运行，它必须记住，或者*存储*玩家输入的数据。它可能还需要跟踪玩家猜出秘密数字用了多少轮。你可以通过使用变量来实现这一切！

在这一章中，你将学会如何定义变量，并使用它们存储文本或数字。然后你将使用变量来编写解决实际问题的程序。

### 什么是变量？

变量用于存储值，比如数字或文本。你可以像用一个藏宝箱来存放宝贵物品一样使用它。如果你是海盗的话，可以把变量当作一个箱子。你可以把不同的东西放进你的箱子里，以后使用。你可以更改变量的值，就像把新东西放进箱子里一样，比如你收集的口香糖。变量之所以叫变量，是因为它们的内容可以变化。

在 Small Basic 中创建一个变量，可以使用像这样的*赋值语句*：

```
treasureChest = "My booty!"
```

这条语句创建了变量 `treasureChest` 并赋值为字符串 `"My booty!"` 等号是一个*赋值运算符*。第一次给变量赋值被称为*初始化*变量。

现在让我们探索如何在你的程序中使用变量。锚链起航！

### 使用变量的基础

Karen 有 12 个毛绒熊。她的姐姐 Linda 有一半数量。Linda 有多少只熊？你可以用脑袋算或者用计算器算，但我们来按照清单 4-1 以 Small Basic 的方式解决这个问题！

```
1 ' Variables.sb
2 karenBears = 12             ' Karen has 12 bears
3 lindaBears = karenBears / 2 ' Linda has half as many bears as Karen
4
5 TextWindow.Write("Karen's " + karenBears + " bears aren't as ")
6 TextWindow.WriteLine("fancy as Linda's " + lindabears + " bears!")
```

*清单 4-1：演示变量*

第 2 行的语句 `karenBears = 12` 创建了一个名为 `karenBears` 的变量，并为其赋值 `12`。第 3 行将 `karenBears` 除以 `2`，然后将结果存储到一个名为 `lindaBears` 的新变量中。当第 3 行运行时，`lindaBears` 保存的值是 12 ÷ 2，即 6。

第 5 行输出字符串 `"Karen's "`，然后加号将 `karenBears` 的值（即 12）连接到这个字符串后面。接着，它将 `" bears aren't as "` 连接到 12 后面。（关于字符串连接的复习，请参见第 18 页的“连接字符串”）同样，第 6 行输出字符串 `"fancy as Linda's "`，然后是存储在变量 `lindaBears` 中的值。最后，它添加了 `" bears!"`。

现在，让我们运行程序来查看结果。你应该看到这个：

```
Karen's 12 bears aren't as fancy as Linda's 6 bears!
```

尝试更改`karenBears`的值并重新运行程序，看看会发生什么。不错吧？更改`karenBears`的值也会改变`lindaBears`的值。变量可以让你的编程生活变得更加轻松！

让我们看看一些你在使用自己变量时需要了解的其他重要概念。

#### *将表达式赋值给变量*

*算术表达式*是变量、运算符和数字的组合。它们可以是常量数字（例如`3`、`6.8`或`–10`）、算术运算（例如`3 + 6`或`10 / 3`），或者代数表达式（例如`karenBears / 2`）。在 Small Basic 中计算算术表达式就像在数学中计算一个表达式。例如，表达式`4 * 3 + 6 / 2`的计算过程为（4 × 3 + 6 ÷ 2）= 12 + 3 = 15。你还可以在表达式中使用括号来决定运算的顺序。

你可以通过赋值语句将变量设置为算术表达式的结果。你的程序会抓取等号右边的值，并将这个值赋给等号左边的变量。你已经在示例 4-1 中做过了，让我们在这个基础上继续扩展，编写更多将算术表达式赋值给变量的代码！

这是一个示例：

```
barbies = 5                     ' You have 5 Barbies
ponies = barbies + 7            ' You have 7 more My Little Ponies than Barbies
donate = (barbies * ponies)/ 10 ' Total toys you need to donate
```

当你运行这个程序时，变量`barbies`、`ponies`和`donate`的值分别是 5、12 和 6。是时候捐赠 6 个玩具了！

你需要设置赋值运算符左侧的变量，正如你在每个赋值示例中看到的那样。所以这个语句是错误的：

```
5 = barbies  ' This is backwards, like the Twilight Zone
```

尝试自己运行一下，看看是否会出现错误！

#### *传递变量给方法*

一个方法的参数可以是常量、变量，甚至是表达式。例如，下面语句中`WriteLine()`的参数是一个算术表达式：

```
TextWindow.WriteLine((3 * x + y) / (x - y))
```

如果`x = 7`且`y = 5`，此语句将在屏幕上显示 13。看看你是否能弄明白如何编写并运行这段代码。记得先设置`x`和`y`！

#### *更改变量的值*

当你在程序中创建一个新变量时，你使用赋值运算符为其赋予初始值。你也可以使用赋值运算符来*更改*现有变量的值，这将清除旧的值，如下所示：

```
ferrets = 5
ferrets = 15
TextWindow.WriteLine("There are " + ferrets + " ferrets in my bed!")
```

这个示例中的第一行创建了一个名为`ferrets`的新变量，并将 5 赋值给它，但第二行将其值更改为 15。因此，`WriteLine`语句将输出`There are 15 ferrets in my bed!`

在幕后，变量`ferrets`指向计算机内存中的一个存储区域。当你写`ferrets = 15`时，你告诉 Small Basic 进入为`ferrets`预留的内存空间，并将 5 替换为 15。每当你显示`ferrets`的值时，你就会获取当前存储在那个空间里的值。

你也可以通过给变量增加值来改变它的值。假设你正在编写一个游戏，玩家需要射击来袭的飞机。当玩家击落一架飞机时，你想要把玩家的分数（存储在名为`score`的变量中）增加五分。你如何更新`score`变量？下面是一种方式：

```
score = 10        ' Assumes the player already has 10 points
temp = score + 5  ' temp = 10 + 5 (= 15)
score = temp      ' Now the player has 15 points
```

第二行使用一个临时变量`temp`来存储将 5 加到当前`score`值的结果。然后将`temp`的值赋给`score`。

但你可以在一条语句中更快地完成这件事：

```
score = score + 5
```

你是否看到相同的变量`score`出现在赋值语句的两边？这条语句将 5 加到变量`score`的当前值，并将结果重新存储回同一个变量中。旧值 10 会被新值 15 替换。参见图 4-1。

![image](img/f04-01.jpg)

*图 4-1：说明语句* `score = score + 5`

更新`score`变量的这两种方式本质上是相同的，但第二种方法更常见，你将在其他人的程序中经常看到它。

#### *使用空格提高可读性*

添加制表符和空格使表达式更具可读性。例如，看看这两个表达式：

```
x=y+10*(x-3)-z
x = y + 10 * (x - 3) - z
```

它们对 Small Basic 来说是相同的，但第二行中的空格使得人类（和其他非机器人）更容易阅读。

**尝试练习 4-1**

以下程序计算你在两门课程中每周花费的作业时间的平均值。首先，识别出程序中的所有变量。当你运行它时，这个程序会显示什么？试试看！

```
mathHours = 8
scienceHours = 6
avgHours = (mathHours + scienceHours) / 2
TextWindow.Write("I spend " + mathHours)
TextWindow.Write(" hours a week on math homework and " + scienceHours)
TextWindow.WriteLine(" hours a week on science homework.")
TextWindow.Write("The average of " + mathHours + " and ")
TextWindow.WriteLine(scienceHours + " is " + avgHours + ".")
```

现在，替换掉你在两门课程中每周花费的实际时间。你每周花多少时间做作业？把结果展示给你的父母看看——在你讨论成绩单之前，这可能是一个很好的预习！

### 命名变量的规则

你为变量命名的名称称为*标识符*。变量名可以包含字母（小写和大写）、数字（0 到 9）以及下划线字符（`_`）。你可以为变量取任何名字，只要遵循几个规则：

1.  变量名必须以字母或下划线开头，不能以数字开头。

1.  不要使用 Small Basic 的任何关键字，例如`If`、`Else`、`Then`、`And` 或 `While`。这些关键字有特殊的含义，不能用于其他用途。你将在本书后面学到更多关于它们的内容。

1.  Small Basic 中的变量名不区分大小写；`side`、`SIDE` 和 `siDE` 是相同的变量。

根据这些规则，`MyAddress`、`totalScore`、`player1`、`sum`、`room_temperature` 和 `_x123` 都是有效的变量名。

除了我们提到的规则之外，程序员在命名变量时还会使用其他准则。这些*约定*是良好的编程实践，你也应该遵循它们。让我们来看看这些额外的约定。

#### *说清楚你的意思*

尽管你可以随意命名变量，但我们建议你选择一个能解释变量用途的名称。例如，使用名为`address`的变量来存储一个人的地址比使用`xy123`或`TacoTruck`更有意义。

#### *找到合适的长度*

避免使用单个字母的变量名，如`m`、`j`、`x`和`w`，除非它们的含义非常明确，否则你会让程序变得更难阅读和理解。但也不要使用过长的变量名，避免让你的朋友打瞌睡！

选择简短且有意义的名称。例如，使用`name`或`presidentName`，而不是`the_name_of_the_president`。

#### *坚持你的风格*

目前流行的做法是将变量名以小写字母开头，然后将每个单词的首字母大写，例如`sideLength`、`firstName`、`roomTemp`、`variablesAreAwesome`和`scoobyDoo`。这种命名风格叫做*驼峰命名法*，因为它中间有一个小“驼峰”。但不用担心——驼峰命名的变量不会“喷”出来！

本书使用的是驼峰命名法，但如果你更喜欢其他风格，没关系。只要你选择一个命名规则并坚持使用！尽管 Small Basic 在变量名方面不区分大小写，但命名时应该保持一致。如果你命名一个变量为`firstName`，那么在程序中其他地方也要保持相同的大小写。这会让你更容易找到变量，并且让其他人更容易理解你的代码。IntelliSense 自动完成功能可以帮助你。让我们看看如何做到。

#### *让 IntelliSense 为你工作*

当你在程序中创建一个变量时，该变量的名称会被添加到 IntelliSense 下拉菜单中。当你想要重用一个变量（或检查其大小写）时，只需输入前几个字母并在 IntelliSense 中查找它，如图 4-2 所示。Small Basic 会自动完成你的变量名，就像一个总是替你完成三明治的好朋友！

![图片](img/f04-02.jpg)

*图 4-2：如何将一个变量添加到 IntelliSense 菜单中*

请注意，第一行中创建的变量名（`interestRate`）如何出现在菜单中。当我在第二行开始输入`in`时，IDE 会高亮显示该变量名。按下 ENTER 键即可自动完成我开始输入的内容。谢谢你，IntelliSense！

#### *避免将变量命名为方法和对象的名称*

方法名不是保留关键字，因此你可以将它们用作变量名。例如，如果你写下以下代码，Small Basic 并不会报错：

```
writeline = 5
TextWindow.WriteLine(writeline)
```

虽然这是有效的，但我们强烈建议你不要将变量命名为现有方法的名称。世界已经足够混乱了。

**动手试试 4-2**

1.  以下哪些变量名是无效的？如果名称无效，请解释原因。

    ```
    _myBooK
    1MoreRound
    $FinalScore
    Level2
    ```

1.  对于以下每个值，你会如何命名表示它的变量，为什么？

    • 游戏中玩家的得分

    • 直角三角形的斜边

    • 一栋楼的楼层数

    • 一辆车每加仑油能行驶的英里数

    • 得到 Tutsi Pop 中心的舔数

### 简化表达式

变量可以使算术表达式的计算更容易。假设你想编写一个程序来计算这个表达式：

![image](img/f0050-01.jpg)

你可以编写许多不同的程序，这些程序都会给你正确的答案。例如，你可以写一个语句一次性计算整个表达式：

```
TextWindow.WriteLine((1 / 5 + 5 / 7) / (7 / 8 - 2 / 3))
```

或者你可能单独计算分子和分母，然后显示它们除法的结果：

```
num = (1 / 5) + (5 / 7)         ' Finds the numerator
den = (7 / 8) - (2 / 3)         ' Finds the denominator
TextWindow.WriteLine(num / den) ' Does the division
```

你也可以单独计算每个分数，然后显示合并表达式的结果：

```
a = 1 / 5
b = 5 / 7
c = 7 / 8
d = 2 / 3
answer = (a + b) / (c - d)
TextWindow.WriteLine(answer)
```

尽管这三个程序给出的答案相同，但每个程序的风格都不同。第一个程序是编程中的“胖兔子”：它将所有内容塞进一个语句中。如果原始表达式更复杂，语句就会变得很难跟随。第三个程序则正好相反：它用变量表示表达式中的每个分数，这样也可能难以阅读。

如果你是金发姑娘，那么第二种解决方案就是你认为的“恰到好处”。它将表达式分解为足够的部分，使程序更容易理解。变量`num`和`den`清晰地表示了分子和分母。

正如这些例子所示，通常有不止一种方法可以解决问题。如果你卡住了，试着将问题分解成更容易处理的部分！

**尝试一下 4-3**

写一个程序来计算以下表达式的值。试试几种不同的方法。试着在跳舞的时候做！别害羞！

![image](img/f0051-01.jpg)

### 使用变量解决问题

人们常常在没有真正考虑每一步的情况下解决问题。但计算机无法这样做：它们需要你为它们考虑每一步*（至少直到*《终结者》*或*《黑客帝国》*成为现实）*。这就是为什么使用计算机解决问题需要一些规划的原因。开发程序解决方案时，你应该这样做：

1.  明白问题是什么。

1.  设计解决方案。

1.  编写程序。

1.  测试程序，确保它按预期工作。

假设你想创建一个程序来计算给定半径的圆的面积。要解决这个问题，你需要回答以下基本问题：

1.  你需要程序输出什么？

1.  你需要什么输入，程序将从哪里获得这些输入？

1.  程序需要进行哪些处理才能将输入转换为输出？

对于这个问题，以下是你如何回答这些问题：

1.  你的程序需要输出圆的面积。它将在文本窗口中向用户显示这个输出。

1.  这个程序只需要一个用户输入：圆的半径。

1.  你的程序需要使用这个公式来计算面积，这个公式在数学课上可能很熟悉：

    area = π × (radius)²

**注意**

*希腊字母* π，*发音* pi，*是一个特殊的数字，可以四舍五入为 3.1416。我们免费赠送了π给你！*

现在你已经定义了问题，让我们设计一个逐步的解决方案，这叫做*算法*。首先，我们将把问题的每一部分（输入、处理和输出）分解为详细的步骤。

养成编写程序大纲的习惯，将每个步骤按顺序列出。这个大纲叫做*伪代码*，因为它不是一个真正的程序，但它解释了代码应该做什么。查看你的伪代码应该能清楚地告诉你每个步骤中需要写的真实代码。对于复杂的问题，伪代码帮助你以简单的方式表达你的思维过程，之后可以将其转化为真实代码。图 4-3 展示了我们的圆面积问题的算法和伪代码。

![image](img/f04-03.jpg)

*图 4-3：计算圆面积的算法和伪代码*

最后的步骤是将你的伪代码转化为一个 Small Basic 程序。由于我们还没有向你展示如何从用户那里获取值，你将使用一个固定的半径值。请在清单 4-2 中输入程序。

```
1 ' CircleArea.sb
2 radius = 5
3 area = 3.1416 * radius * radius
4 TextWindow.WriteLine("Area = " + area)
```

*清单 4-2：计算圆的面积*

在第 2 行，你创建了一个名为`radius`的变量，并为其赋值 5。在第 3 行，你使用第 51 页的公式计算圆的面积，并将结果赋值给一个名为`area`的新变量。在第 4 行，你在文本`"Area = "`后显示变量`area`的值，以便明确显示的数字表示什么。

当你运行代码时，你会看到这个结果：

```
Area = 78.5400
```

**试试看 4-4**

编写一个程序，计算并显示半径为 5 单位的圆的周长。我们给你一个提示：圆的周长公式是 2 × π × 半径。

### 两种数据类型

程序使用各种不同类型的数据：做计算的应用程序使用数字，但其他应用程序可能使用文本。

Small Basic 使用非常简单的数据类型。它仅内置支持两种数据类型：数字和字符串。数字可以是整数，如-2 和 2365，或者是小数，如 0.25 和-123.78。正如你所知，字符串是由双引号括起来的一系列字符，如`"独立宣言"`或`"她在海边卖海贝壳。"`

你不需要告诉 Small Basic 你将存储什么类型的数据在一个变量中。这是面向初学者的编程方式。

### 全局变量

Small Basic 中的变量是*全局*作用域的。这意味着你可以在程序的任何地方定义和访问变量。这个特性很有帮助，因为它允许你在需要时定义变量（而不是必须把所有变量放在程序的顶部）。但你必须小心！因为 Small Basic 按顺序读取你的程序，可能会导致逻辑错误。试试清单 4-3 中的程序。

```
1 ' LogicError.sb
2 y = x / 10
3 x = 20
4 TextWindow.WriteLine("y = " + y)
```

*清单 4-3：全局变量的逻辑错误*

如果你仔细阅读这段代码，你已经注意到，在第 2 行中，我们在给变量`x`赋值之前就使用了它。当我们运行这段代码时，得到如下输出：

```
y = 0
```

这个答案让你感到惊讶吗？这里发生了什么？当 Small Basic 编译器读取这段代码时，它首先列出程序中定义的所有变量。这些变量的初始值保持为空，就像空框一样。只要程序中的表达式使用的是该列表中的变量名，编译器就会很高兴，程序会正常运行。

当程序运行到第 2 行的表达式`x / 10`时，它将`x`解释为一个数字，因为除法仅对数字有意义。这就是为什么它会用 0 填充`x`的空框。然后，它将除法的结果（即 0）赋值给`y`。变量`x`在第 3 行被更改为 20，但为时已晚！你得到的是错误的输出。

**注意**

*大多数其他编程语言会报告语法错误，因为第 2 行中的表达式*`x / 10`*使用了一个尚未在程序中定义的变量*`x`*。Small Basic 允许你在程序中的任何位置定义变量；不过，别指望在其他语言中也能这样做。*

在编写语句时要小心，因为 Small Basic 是从上到下执行的。确保在第一次使用变量之前先定义它们。

**动手试试 4-5**

这个程序的输出是什么？解释你看到的结果。

```
TextWindow.WriteLine("Before: x = " + x + " and y = " + y)
x = 10
y = 10
TextWindow.WriteLine("After: x = " + x + " and y = " + y)
```

### 编程挑战

如果你卡住了，访问 *[`nostarch.com/smallbasic/`](http://nostarch.com/smallbasic/)* 查找解决方案以及更多的资源和复习问题，适用于教师和学生。

1.  你喜欢敲敲门笑话吗？试试下面的程序，看看如何在 Small Basic 中讲这些笑话！你需要更改哪些程序行才能讲一个不同的笑话？做出更改并重新运行程序，看看会发生什么：

    ```
    ' KnockKnock.sb
    ' Small Basic can tell knock-knock jokes!

    name = "Orange"
    reply = "you going to answer the door?"

    TextWindow.WriteLine("Knock Knock")
    TextWindow.WriteLine("Who's there?")
    TextWindow.WriteLine(name)
    TextWindow.WriteLine(name + " who?")
    TextWindow.WriteLine(name + " " + reply)
    TextWindow.WriteLine("")
    ```

1.  将以下伪代码翻译成一个 Small Basic 程序：

    a. 将*数量*设为 10。

    b. 将*商品价格*设为 15 美元。

    c. 通过将*数量*乘以*商品价格*来计算*总价格*。

    d. 显示*总价格*。
