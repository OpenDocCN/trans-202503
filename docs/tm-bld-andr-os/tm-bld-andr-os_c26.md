# 第二十六章：开源

> 我认为开源的事情并不重要。
> 
> —Iliyan Malchev^(1)

对许多人来说，开源有很多种意义。

它可以是一种“众包”工作的方式，借助更大的社区来帮助完成任务。Linux 就是一个很好的例子。尽管最初的系统是由单个开发者 Linus Torvalds 编写的，但在随后的几十年中，许多个人和公司都贡献了从修复到驱动程序再到核心系统功能等各个方面的内容。

开源可以是一种宣传和分享工作的方式。GitHub 是一个很好的平台，托管着许多活跃（也有过时的）项目，展示了那些花时间和精力完成并上传代码，而不是让它在本地系统中搁置的人们的作品。开源你自己的宠物项目可以是一个很好的方式，让别人知道你是一个从事这类工作的开发者；能够指向一个公开透明的网站是向潜在雇主展示你能力的好方法。

开源可以成为公司的招聘工具。类似于个人宣传自己能力的方式，公司也经常开源项目（应用程序或供其他开发者使用的库）作为将公司名字推向其他开发者的一种方式。Square 本质上是一家信用卡公司，单靠他们的业务吸引开发者可能比较困难。但他们在开发者社区中因提供有趣且强大的开源库而广为人知。那些对金融交易软件不感兴趣的开发者也会去那里，因为他们希望为开源社区做出贡献（包括在这些项目中作为开发者让自己的名字广为人知）。

开源也可以是大公司悄无声息地淘汰某个产品的方式。有时候公司决定关闭一个项目，并将那些工程师调到一个更有前景的项目上。公司可以，也经常会，直接终止该产品。但他们也可以将旧代码开源，作为对开发者社区的一种馈赠。公司通过这种方式并不会直接获得利益（事实上，通常需要一些努力和时间将项目迁移到开源），但通过这样做，他们可以赢得开发者的好感，并减轻关闭那些开发者正在使用并依赖的产品带来的痛苦。

开源也可以是一种让其他人透明地获取并使用你的软件的方式。这就是 Android 的开源模式。

自 2008 年 11 月起，所有 Android 平台软件都可以作为 Android 开源项目（AOSP）在[`source.android.com/`](https://source.android.com/)上获取。每个版本的代码都会在该版本发布的同时开源^(2)，并提供给设备使用。只要新版本对用户开放（无论是新设备还是现有设备的更新），开发者就可以查看用于创建该版本的代码。

Android 接受外部贡献；开发者可以在[`source.android.com/`](https://source.android.com/)上创建账户并提交补丁^(3)。这些补丁会由 Android 团队成员审查，审核通过后可以提交到 Android 源代码库中，以供未来版本使用。

事实上，外部贡献并不常见……也不是预期中的情况。Android 确实会收到一些合作伙伴公司的定期贡献。例如，合作伙伴通常会修复 bug，以确保他们的设备能正常运行。也许他们发现了一个可以改进的边角案例，或者 Android 尚未考虑到的设备外形，或者他们仅仅是发现并修复了一个 bug。对他们来说，将修复直接集成到 Android 中是有意义的，这样每次 Android 发布新版本时，他们就不需要重新应用这个修复。而 Android 偶尔也会有一些个人贡献修复。但外部贡献仍然很少；大部分代码都来自于内部工程团队。

这种动态背后有几个原因。一方面，Android 的源代码库非常庞大，即便是一个简单的修复，也需要投入大量的精力来理解原始代码的上下文以及该修改的影响。更重要的原因是 Android 的“最终开源”^(4)模式本身。外部开发者无法得知，当他们发现并修复了一个 bug 时，是否该 bug 已经在内部/未来版本的代码中修复，甚至他们所专注的那一段代码是否仍然存在。代码有时会因为未来的需求或变更而被移动或重写。

即使 Android 没有从外部获得大量的贡献，Android 的开源模式仍然带来了显著的优势。首先，应用程序开发者喜欢它。一个像 Android 这样规模和复杂性的平台永远无法被完全文档化，以便程序员能够理解它的每一个细微之处以及内部的互动方式。直接查看实际代码以确定到底发生了什么是非常宝贵的；如果开发者可以查看代码本身，他们就不需要猜测平台在做什么。这种透明性一直帮助 Android 开发者编写他们的应用程序，这也是 Android 与许多其他操作系统平台之间的根本区别的体现。^(5)

Dan Lew，一个在 Android 初期在小型初创公司开发 Android 应用的开发者，说代码的开放性简化了开发过程：“早期有很多平台的 bug 要处理。我记得有很多的 hack。但由于 Android 是开源的，通常这些 hack 至少是可以发现的。如果它不是开源的，要解决一些问题就会困难得多。”

Android 开源模式的第二个，也可以说是更重要的元素是，Android 的合作伙伴可以自由轻松地访问所有内容。这实际上是 Android 开源平台的最初原因；这是一种机制，可以让任何潜在的设备制造商获取他们所需的一切，从而使 Android 可用。没有许可证，也没有冗长的合同谈判；合作伙伴可以简单地访问网站并获取他们需要的组件来制造基于 Android 的设备。通过这样做，他们有助于实现一致的兼容 Android 实现的生态系统，因为每个人都从相同的公共实现开始。如果他们想要获取像 Play Store、Maps 和 Gmail 这样的 Google 服务，那就有更多内容，但用于构建手机平台的核心代码可以供任何人下载和使用。Romain Guy 解释道：“这就是我们在谈论 Android 的‘开源’时的想法。合作伙伴并不一定关心贡献，但他们拥有他们所需的一切。”

Brian Swetland 认为：“Android 的一个目标，在他们与 Google 有任何接触之前，就是为人们提供一个选择，避免某个单一公司主导移动计算平台的可怕未来。他们的想法是，如何让人们采用它？它必须是开放的。否则，他们怎么能信任他们拥有任何程度的控制权呢？”

Dianne Hackborn 也表示同意，并将 Android 的开源模式与她之前所经历的授权模式进行了比较：“我们在 PalmSource 时遇到的一个问题是，其他公司对使用我们的平台非常害怕，他们害怕移动领域会重蹈微软当年对 PC 做的事情。例如，摩托罗拉曾对授权使用 Rome（PalmSource 为 Palm OS 6 开发的 UI 工具包）感到非常困难，但他们对收购公司并拥有它却毫不犹豫。能将 Android 做成开源，使得 OEM 更容易接受，因为他们可以共享一部分所有权，并且它的灵活性也使得移动设备能够快速演进。”

正是这个第二个元素——为设备制造商开放平台——使得 Android 与其他平台产品区分开来。这个平台不仅可以使用，而且其代码也可以理解和修改，随着公司将其应用到设备中。此外，这个开源平台本身也是一个完整的、符合生产标准的实现，已经在实际硬件产品上验证，并且可以供制造商使用。

相比之下，如果你当时想要发布一款 Windows 手机，你必须向微软购买 Windows 授权（并支付费用）。此外，将它应用到新设备的过程也非常复杂。Michael Morrissey 在 Android 之前曾在微软工作，亲眼目睹了这个过程。“当你试图在一款新手机上启动新的操作系统，无论是 Win CE、Pocket PC 还是其他什么系统，整合这些东西并调试其运行是极其痛苦的。你需要有一个叫做‘板级支持包’的东西，它包含了来自 OEM 的所有底层代码。然后，你还需要所有更高层的 Windows 代码。所以如果电话功能失败，或者网络不好，或者出现其他问题，问题出在哪里？没有人能弄明白。”

“这是我在微软时最喜欢的一个玩笑：有一个团队专门负责与这些 OEM 合作，推动新硬件的开发。可问题是，双方都不能看到对方的代码，因为它是保密的。三星、HTC 或其他公司会派人到西雅图，坐到这个团队的成员旁边。他们会尽力调试，而不让彼此看到对方的代码。他们只是凑过去说，‘这是我认为我在这个调用中发送给你的内容，你看到什么了？’这就像是一场冗长而荒谬的舞蹈。”

当然，Android 开源的事实意味着制造商可以免费使用它，这是一个额外的好处。Michael 说：“这些 OEM 厂商的利润率非常低。所以，如果你有像 HTC 这样的公司，他们每台设备要被微软收费 10 美元，并且为了让它工作，他们还得做大量复杂的集成工作，那么免费的开源就是魔法。如果你有像 Android 这样开源的系统，那么 OEM 厂商可以非常非常快地推出新设备，因为他们可以访问所有的代码。更重要的是，它是免费的。”

另一方面，如果你想要发布一款基于 iOS 的设备……你是做不到的。苹果是唯一的 iPhone 制造商；他们根本不提供其平台。类似地，RIM 是唯一的 BlackBerry 设备供应商。与此同时，Android 不仅是免费的，而且任何人都可以自由地下载、玩耍、定制并在此基础上开发。

事实上，这种模型也使得软件对应用开发者来说很容易查看内部代码，并且使得接受任何外部（尽管是偶尔的）贡献成为可能，这仅仅是一个意外的巧合，最终对 Android 有利。

当然，开放源代码不仅仅是说代码是开放源代码。团队必须以一种方式将项目组织起来，使得外部开发者和公司能够访问、下载、构建并理解如何做到这些。在初始发布之前的那段时间里，团队花费了很多努力来整理这些内容。

首先，源代码本身必须组织成一个适合持续向开源分发的状态，这是 Dave Bort 在 Ed Heyl 团队中努力的成果。

Google 开源项目主管 Chris DiBona 也参与了解决这个问题。Android 当时使用的一些工具不适合外部使用。Google 使用的工具要么是授权工具，要么是内部开发的专有工具。Android 的代码需要能够由外部开发者在没有专有或授权工具的情况下进行构建，因此团队内部采用了可以（免费）供外部使用的工具。

Chris 帮助做出了将源代码管理^(6)切换到一个名为 Git 的系统的决定，但这个系统在大多数工程师中并不受欢迎。Chris 对他们说：“内核和系统团队[已经在使用 Git]，他们永远不会离开 Git。Git 是我们开发模型的正确选择。他们需要一个外部的人来讨厌。我自愿成为那个人。”

团队做出了改用 Git 的决定，代码也被组织成适合公开使用的形式，并且该项目于 2008 年 11 月在 1.0 版本发布时开源。此后，它一直保持开源状态，为开发者提供了透明度，为制造商提供了平台代码。

加入安卓团队的 Jeff Sharkey 总结了开源对合作伙伴和用户的吸引力：“我坚信开源软件，因为它赋予人们建造你从未想象过或没有资源自己建造的东西的力量。如果你是安卓初期的 OEM 厂商，你无法授权 iOS，而微软提供的体验也相当统一。相比之下，安卓为 OEM 厂商提供了一个机会，可以迅速添加功能，从而在商店货架上与众不同。”

“开源世界的精神也引起了终端用户的共鸣。安卓不是像独裁者一样强制规定只能有一个主屏幕应用、一个软件键盘、一组快捷设置图标等，而是让用户彻底自定义它们。手机是非常个人化的设备，这些更深层次的定制（不仅仅是外壳）使用户产生了更强的连接感和拥有感。”

本章开头引用了伊利安·马尔切夫（Iliyan Malchev）的一句话，虽然这句话被残酷地断章取义了。以下是完整版本：

“我不认为开源这个事情很重要。我们本可以在不开源的情况下免费提供给他们。我是开源的倡导者。我认为我们应该做更多的开源工作。但我就是不认为安卓的强大取决于它是否开源。如果我们在没有开源的情况下让它免费，它同样会如此成功。”

也就是说，拥有源代码并不是*开源*的关键部分；仅仅将源代码*公开*就足够了。开源只是实现这一目标的自然且透明的方式。
