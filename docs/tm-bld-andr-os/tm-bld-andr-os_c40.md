# 第四十章：1.0 版本的准备

![g40001](img/g40001.png)

从 2007 年 11 月 SDK 的初始发布到 1.0 版本发布之间，几乎过去了一年，1.0 版本与 G1 手机几乎在一年后发布。那么在这段时间里究竟发生了什么呢？

首先，实际上这段时间并没有你想象的那么长。

根据情况，有些软件产品可以很快发布。如果你只是更新网页上的一些代码，你可以立即发布。如果该版本中有一个 bug，修复后可以立刻重新发布。但如果你发布的是一种不像简单更新网站那样容易分发给用户的产品，你就需要进行一定程度的测试和稳定性处理才能发布。你不想让用户经历一次繁琐的更新过程，却发现有一个严重的 bug，并且还需要再次更新。这样至少要耗费几周时间^(1)。而像 G1 这样的硬件发布，除了其所依赖的软件，还涉及更多的时间。

Android SDK 仅仅是软件，团队本可以在发布前继续更新，修复 bug（正如他们在 1.0 版本发布前的 Beta 阶段所做的那样），直到宣布“完成”。但这个版本需要在 G1 手机上运行良好，这涉及到完全不同的约束。手机需要经过运营商严格的合规性测试，这意味着团队必须比单纯发布一个新的 SDK 版本提前完成工作。Romain 谈到过：“定稿时间是在商店发售前一个月。但在此之前是大约三个月的运营商测试。”因此，为了确保 G1 能够在 10 月中旬上市，团队必须在 2008 年 6 月（即 SDK 初始发布后仅七个月）基本完成平台开发工作（除了修复最终测试阶段出现的关键 bug）。

在这七个月里，许多问题需要解决，包括完善公共 API 的细节、进行关键性能优化以及修复各种 bug。

## 兼容性的成本

发布前，公共 API 需要进行打磨。SDK 处于 Beta 阶段，鼓励开发者为其编写应用，但 API（方法名、类名等）并非最终版。然而，一旦 1.0 发布，API 就固定下来了，无法更改。在发布版本之间更改 API 意味着使用这些 API 的应用可能会在用户设备上神秘崩溃。

这种兼容性动态在像 Android 这样的平台上尤其明显，因为开发者无法强制要求他们更新应用程序，也无法强制用户安装这些更新。假设一位开发者在 10 年前编写并上传了一款应用到 Play Store。某个地方，有人正在愉快地使用这个应用。然后该用户将手机升级到更新的版本。如果该更新版本改变了那个旧应用所使用的 API，它可能无法正常工作，甚至可能崩溃，显然这不是 Google 想要的。所以，旧的 API 会一直保留并得到支持……太久……太久了。

因此，Android 团队开发者的诀窍是，对任何新的 API 都要非常谨慎，因为这个团队必须永远使用它。当然，总会有错误，或者事后你会想“如果当时做得不一样会怎样”。^(2) 菲库斯·柯克帕特里克（Ficus Kirkpatrick）观察到：“你可以尝试设计完美的东西。然而，当你在实验室里忙着打磨它时，总会有人出来做出某些东西，让你显得不再重要。”

团队致力于让 API 达到他们满意的程度，并愿意让这些 API 长期存在。1.0 版本前的一些更改，如方法或类名，比较小。但是有些 API 被完全移除，因为它们并不是平台希望永远支持的内容。

罗曼·盖伊（Romain Guy）说：“在 2008 年的很大一部分时间里，我都在清理 API，并尽可能地从框架中移除不必要的内容，直到我们发布。”例如，他移除了 PageTurner 类，这个类实现了一个酷炫的撕纸效果。它最初是为早期版本的计算器应用程序编写的，用来在清除显示时展示一个有趣的动画。但计算器的设计发生了变化，不再使用这个动画。由于这个效果过于具体，属于一个小众的效果，因此不适合保留在公共 API 中，所以该类被删除了。

![](img/f40001.png)

计算器应用的撕纸效果很酷，但并不是普遍实用的。因此，它在 1.0 版本前就被从平台 API 中移除了。

当时作为外部开发者的杰夫·沙基（Jeff Sharkey）评论了项目在这一阶段的 API 波动：“在 1.0 发布之前的多个预览版本中，Android SDK 的部分内容经历了相当动荡的变化。UI 组件在每个快照中都在被添加、移除或重新设计^(3)。一些完整的功能被彻底砍掉了。”

这并不是说没有一些糟糕的 API 悄悄进入并在 1.0 之后继续存在（见前面的脚注评论关于“制造未来的遗憾”）。一个例子是 ZoomButton，这是一个用于将长按解释为多个点击事件的工具类，然后将这些事件发送到处理缩放的其他逻辑。ZoomButton 本身并没有进行任何缩放操作。实际上，它什么也没做，除了将一种输入类型（长按）重新解释为另一种（多个点击）。但不幸的是，它在 1.0 之后继续存在，直到多年后，在 Oreo 版本中才被弃用^(4)。

## 性能

在这个阶段，另一个关键的工作领域是性能。尽管当时的硬件相比早期的移动设备已经有了很大的进步，足以支持智能手机的存在，但 CPU 仍然非常有限。此外，手机上的每一项操作都会消耗电池并缩短用户需要充电的时间。因此，平台和应用工程师们尽力让一切运行得更快、更流畅、更高效。例如，罗曼·盖伊和其他 UI 工具包团队的成员花了大量时间优化动画和绘图逻辑，以避免做不必要的工作。

## 错误，错误，错误

G1 的硬件终于在 SDK 发布时开始广泛供内部使用，团队也能开始在真实硬件上测试他们的代码。一旦设备可以大量获得，大家也能将 G1 作为日常使用的手机，这也产生了许多需要在 1.0 版本发布前修复的 bug。

罗曼说：“那段时间发生了什么？大量的调试。”

## 彩蛋

在 1.0 版本中没有实现的一项功能是一个彩蛋^(5)，列出了所有参与发布工作的人的名字，这让人想起经典的 Macintosh 团队签名，这些签名曾装饰在电脑机箱内部。罗曼·盖伊实现了这个功能，但它最终没有发布。

“你可以为所谓的‘秘密代码’在拨号器中注册一个意图。当你拨打像*#*#，一个号码，*#*#，它基本上是一个系统命令。有时你的互联网服务提供商可能会让你输入这样的内容，以要求你执行某些操作。”

“启动器注册了其中一个代码。如果你输入了它，启动器会被唤醒，并且会在我隐藏在元数据中的一个图标里找到参与 Android 1.0 开发的团队成员的名单。它会弹出一个 UI，滚动显示这些名字。实现这一功能的代码被写在 Java 源代码中的注释里。所以，这段代码是被隐藏起来的。”

“我们把它变成了一个功能。我们开始招募更多的人，包括承包商。我们加入了越来越多的功能。最终它被放弃了，因为有人担心我们会忘记某个人。”

“所以它曾是一个有趣的小彩蛋，但最终被过度产品化了。”

最近发布的 Android 系统中有彩蛋，大多数是由系统 UI 团队的 Dan Sandler 实现的。这一 Android 传统开始于 1.0 发布之后的几个版本，也许是当时团队终于有时间喘口气，开始考虑一些非关键性的事情。或者也许只是因为像 Dan 这样具有艺术技能、幽默感和编码速度的人可以做成这件事。长按系统设置中的版本信息会弹出……某些内容。有时候它只是一个漂亮的视觉效果，有时候是一个简单的游戏或应用程序。但它从来不是一份产品开发人员的名单，因为那样会太复杂。

## 应用程序

团队在 1.0 版本发布前也花了一些时间，尤其是在版本接近完成时，当时只允许修复关键性的 bug，进行应用程序的编写。Mike Cleron 说：“这就是我大部分应用程序编写生涯的地方。在框架上进行调试。”

Mike 和 Romain，都是充满激情的风光摄影师，他们致力于摄影应用程序的开发。编写真实世界中的应用程序不仅为用户提供了更多功能，也帮助平台开发人员从应用程序开发者的角度理解平台，从而推动未来版本中更好的 API 和功能的开发。当然，它也有助于发现可以修复的 bug。
