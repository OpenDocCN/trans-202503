# 前言

![image](img/common01.jpg)

网络是一个充满挑战的地方。人们很容易产生这样的印象：互联网是由专家精心设计的，一切的运作方式都有其合理的原因。事实上，互联网的发展既迅速又杂乱无章，我们今天在网络上所做的事情远远超出了最初发明者的设想。

因此，确保你的网站安全可能会显得是一项艰巨的任务。网站是一种独特的软件类型，在发布后立即向数百万用户开放，包括一个活跃且动机十足的黑客社区。大公司经常遭遇安全失误，每周都会宣布新的数据泄露事件。在这种情况下，独立的网页开发者如何保护自己呢？

### 关于本书

网络安全的一个大秘密是，网络漏洞的数量实际上相当少——巧合的是，大约刚好可以容纳在一本书里——而且这些漏洞每年变化不大。本书将教你*每个*你需要了解的关键威胁，我将分解出你应该采取的实际步骤来保护你的网站。

### 谁应该阅读本书

如果你是刚刚起步的网页开发者，这本书是你了解网络安全的理想指南。无论你刚刚完成计算机科学学位、刚从训练营毕业，还是自学成才，我都建议你从头到尾阅读本书。本书中的每一项内容都是必备的知识，且以最简洁的方式和清晰的示例进行讲解。现在就为你将面临的威胁做好充分准备，将为你将来的工作节省很多麻烦。

如果你是一个更有经验的程序员，这本书对你也会很有帮助。你总是可以通过复习安全知识来受益，因此可以利用本书填补任何知识空白。把它当作一本参考书，翻阅你感兴趣的章节。你并不总是知道自己不知道什么！像你这样的资深程序员有责任以身作则，带领团队前进，对于网络开发人员来说，这意味着遵循安全最佳实践。

你会注意到，本书并不针对任何特定的编程语言（尽管我会根据需要为主要语言提供各种安全建议）。对网络安全的深入理解将对你有所帮助，无论你选择用哪种语言进行编程。许多程序员在职业生涯中会使用多种语言，因此，学习网络安全的基本原则要比过于专注于某个特定库更为重要。

### 互联网简史

在我开始介绍本书内容之前，回顾一下互联网是如何发展到今天的状态将是有益的。许多聪明的工程师为互联网的爆炸性增长做出了贡献，但与大多数软件项目一样，安全考虑往往在新增功能时被忽视。理解安全漏洞是如何悄悄出现的，将帮助你在学习如何修复这些漏洞时获得必要的背景知识。

万维网（World Wide Web）是由蒂姆·伯纳斯-李（Tim Berners-Lee）在欧洲核子研究组织（CERN）工作时发明的。CERN 的研究主要是通过撞击亚原子粒子，期望它们会裂解成更小的亚原子粒子，从而揭示宇宙的本质结构，并且明知这种研究有可能在地球上制造黑洞。

伯纳斯-李（Berners-Lee）显然对终结宇宙的事情兴趣较少，他在 CERN 的时间则用于发明今天我们所知道的互联网，作为大学之间共享研究成果的一种手段。他发明了第一个网页浏览器和第一个网页服务器，并创造了超文本标记语言（HTML）和超文本传输协议（HTTP）。世界上第一个网站于 1993 年上线。

早期的网页仅包含文本。第一个能够显示内联图片的浏览器是 Mosaic，由国家超级计算应用中心（National Center for Supercomputing Applications）开发。Mosaic 的开发者最终加入了 Netscape Communications 公司，并帮助创建了 Netscape Navigator，这是第一个广泛使用的网页浏览器。在早期的互联网中，大多数网页是静态的，且流量传输没有加密。那时是一个更简单的时代！

#### *浏览器中的脚本语言*

快进到 1995 年，Netscape Communications 公司新聘的布伦丹·艾克（Brendan Eich）花了 10 天时间发明了 JavaScript，这是第一个能够嵌入网页的编程语言。在开发过程中，这门语言最初被称为 Mocha，随后改名为 LiveScript，再次更名为 JavaScript，最终正式定名为 ECMAScript。没有人喜欢这个名字，尤其是艾克，他曾表示这个名字听起来像是一种皮肤病；因此，除了在最正式的场合，大家依旧称其为 JavaScript。

JavaScript 的最初版本结合了 Java 编程语言（虽然与其无关）那种笨拙的命名约定、C 语言的结构化编程语法、Self 语言的晦涩原型继承以及艾克自己设计的恶梦般的类型转换逻辑。无论好坏，JavaScript 成了网页浏览器的事实标准语言。突然间，网页变得可以互动，并且一系列安全漏洞随之而来。黑客们通过跨站脚本攻击（XSS）找到了将 JavaScript 代码注入页面的方法，互联网变得更加危险。

#### *新挑战者进入竞技场*

Netscape Navigator 的第一个真正竞争对手是微软的 Internet Explorer。Internet Explorer 具有一些竞争优势——它是免费的，并且预装在 Microsoft Windows 系统中。Explorer 迅速成为全球最受欢迎的浏览器，Explorer 图标成为一代用户学习如何浏览网页时的“互联网按钮”。

微软试图“主宰”互联网，导致其在浏览器中引入了 ActiveX 等专有技术。不幸的是，这导致了*恶意软件*的增加——一种感染用户计算机的恶意程序。Windows 曾经（并且依然是）计算机病毒的主要目标，而互联网则成为了有效的传播渠道。

Internet Explorer 的主导地位在许多年里没有受到挑战，直到 Mozilla 的 Firefox 发布，再到由年轻搜索初创公司 Google 创建的时髦新浏览器 Chrome。这些新浏览器加速了互联网标准的增长和创新。然而，到现在为止，黑客攻击已经变成了一个盈利的生意，任何安全漏洞在被发现后都会立即被利用。确保浏览器安全成为供应商的首要任务，而网站所有者必须时刻关注最新的安全动态，以便保护他们的用户。

#### *用于编写 HTML 的机器*

网络服务器的发展速度与浏览器技术的进步一样迅速。在互联网的早期，托管网站是学术界的一个小众爱好。大多数大学都使用开源操作系统 Linux。1993 年，Linux 社区实现了*通用网关接口（CGI）*，它允许*网站管理员*轻松创建由相互关联的静态 HTML 页面组成的网站。

更有趣的是，CGI 允许通过 Perl 或 PHP 等脚本语言生成 HTML——因此，网站所有者可以从数据库中存储的内容动态创建页面。PHP 最初代表个人主页（Personal Home Page），当时的梦想是每个人都能运行自己的网页服务器，而不是将所有个人信息上传到一个数据隐私政策存疑的社交媒体巨头。

PHP 使*模板*文件的概念变得流行：嵌入处理标签的 HTML，可以通过 PHP 运行时引擎进行处理。动态 PHP 网站（比如 Facebook 的最早版本）在互联网中蓬勃发展。然而，动态服务器代码引入了一类全新的安全漏洞。黑客通过注入攻击以新颖的方式在服务器上运行他们自己的恶意代码，或者通过目录遍历探索服务器的文件系统。

#### *一系列管道*

网络技术的不断革新意味着，今天的互联网很大程度上依赖于我们认为的“旧”技术。软件通常会达到一个工作得足够好的程度，然后进入“维护”模式，仅在绝对必要时才进行更改。对于网页服务器来说尤其如此，因为它们需要全天候在线。黑客扫描网络，寻找运行老旧技术的易受攻击网站，因为这些网站通常存在安全漏洞。我们仍在修复十年前首次发现的安全问题，这就是为什么在本书中我会描述每一个可能影响网站的主要安全漏洞。

与此同时，互联网的增长速度比以往任何时候都快！将日常设备（如汽车、门铃、冰箱、灯泡和猫砂盘）连接到互联网的趋势为攻击提供了新的途径。连接到物联网的设备越简单，就越不可能具备自动更新的安全功能。这导致了大量未加保护的互联网节点，这些节点为*僵尸网络*提供了丰富的托管环境，僵尸网络是由黑客远程安装和控制的恶意软件代理。这为攻击者提供了大量潜在的火力，如果他们针对你的网站进行攻击。

#### *首先要担心的是什么*

一名网页开发人员可能会因正确保护网站的困难而感到灰心。不过你应该有信心：有一支安全研究人员的队伍正在勇敢地发现、记录和修复安全漏洞。保护你的网站所需的工具都是免费且通常容易使用的。

了解最常见的安全漏洞，并知道如何修复它们，将保护你的系统免受 99%的攻击。尽管总有技术高超的对手能够入侵你的系统，但除非你在经营一个伊朗核反应堆或一个美国的政治竞选，否则这些想法不必让你夜不能寐。

### 本书内容

这本书分为两部分。第一部分介绍了互联网的工作原理。第二部分深入探讨了你需要防范的具体漏洞。内容如下：

**第一章：让我们攻击一个网站**

在本章中，你将学习到攻击一个网站是多么简单。提示：真的很简单，所以你做得对，买了这本书。

**第二章：互联网是如何工作的**

互联网的“管道”基于互联网协议（Internet Protocol），这是一系列允许全球计算机无缝通信的网络技术。你将学习 TCP、IP 地址、域名和 HTTP，并了解如何在网络上安全传输数据。

**第三章：浏览器是如何工作的**

用户通过浏览器与你的网站互动，许多安全漏洞会在这里显现。你将了解浏览器如何渲染网页，以及 JavaScript 代码如何在浏览器安全模型中执行。

**第四章：Web 服务器如何工作**

你为网站编写的大部分代码都将在 Web 服务器环境中运行。Web 服务器是黑客的主要目标。本章描述了它们如何提供静态内容，以及如何利用动态内容（如模板）将数据库和其他系统中的数据结合起来。你还将了解一些用于 Web 编程的主要编程语言，并回顾每种语言的安全考虑事项。

**第五章：程序员如何工作**

本章解释了你应如何进行网站代码编写的过程，以及你可以养成哪些良好习惯，以减少错误和安全漏洞的风险。

**第六章：注入攻击**

我们将通过查看你将遇到的最具威胁性的漏洞之一开始对网站漏洞的调查：黑客注入代码并在你的服务器上执行。这通常发生在你的代码与 SQL 数据库或操作系统交互时；或者攻击可能包括远程代码注入到 Web 服务器进程中。你还将看到文件上传功能如何允许黑客注入恶意脚本。

**第七章：跨站脚本攻击**

本章回顾了用于将恶意 JavaScript 代码注入浏览器环境的攻击方式，以及如何防范这些攻击。跨站脚本攻击有三种不同的方式（存储型、反射型和基于 DOM 的），你将学习如何防范每一种。

**第八章：跨站请求伪造攻击**

你将看到黑客如何利用伪造攻击欺骗用户执行不希望发生的操作。这是互联网上常见的烦恼，你需要为用户提供相应的保护。

**第九章：身份验证的破坏**

如果用户注册了你的网站，确保安全处理他们的账户是至关重要的。你将回顾黑客用于绕过登录屏幕的各种方法，从暴力破解密码到用户枚举。你还将回顾如何在数据库中安全地存储用户凭证。

**第十章：会话劫持**

你将看到用户在登录后如何可能会遭遇账户被劫持的情况。你将学习如何构建你的网站并安全地处理 cookies，以减轻这一风险。

**第十一章：权限**

了解如何防止恶意攻击者利用特权提升访问你网站的禁区。特别是，如果你在 URL 中引用了文件，黑客将尝试使用目录遍历来探索你的文件系统。

**第十二章：信息泄露**

你可能无意中通过泄露信息而在你的网站上宣传漏洞。本章将告诉你如何立即停止这种情况。

**第十三章：加密**

本章展示了如何正确使用加密，并解释了它在互联网上的重要性。准备好一些简单的数学知识。

**第十四章：第三方代码**

你将学习如何管理他人代码中的漏洞。你运行的大多数代码都将是由别人编写的，你应该知道如何确保它的安全！

**第十五章：XML 攻击**

你的网页服务器可能解析 XML，并且可能容易受到本章描述的攻击。XML 攻击已经是黑客们过去几十年来常用的攻击方式之一，因此要小心！

**第十六章：不要当帮凶**

你可能在不知情的情况下充当了对他人黑客攻击的帮凶，正如你将在本章中看到的。作为一个良好的互联网公民，确保你关闭这些安全漏洞。

**第十七章：拒绝服务攻击**

在这一章中，我将向你展示大规模的网络流量如何作为拒绝服务攻击的一部分使你的网站瘫痪。

**第十八章：总结**

最后一章是一个备忘单，回顾了你在整本书中学到的安全关键要素，并总结了在注重安全时应应用的高层次原则。把它背下来，每晚睡觉前复习一下这些教训。
