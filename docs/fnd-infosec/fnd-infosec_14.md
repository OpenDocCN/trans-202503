## 第十四章：评估安全性

![Image](img/common.jpg)

一旦你实施了安全措施，你需要确保它们确实在保护你的资产。如第六章所述，遵守法律和法规并不意味着你已经安全。既然如此，你如何评估自己安全的真实水平呢？你有两种主要的方式来做到这一点：漏洞评估和渗透测试。在本章中，我将讨论这两种方法。

### 漏洞评估

*漏洞评估*是一个使用专门设计的工具扫描漏洞的过程。两个常见的漏洞评估工具是 Qualys 和 Nessus。为了开发这些工具，供应商必须做大量的工作来编录漏洞，确定这些漏洞适用于哪些平台和应用程序，并按严重性对它们进行分类。供应商通常还会提供关于漏洞的潜在影响、如何修复漏洞等附加信息。

由于保持这些工具的更新需要大量工作，因此一些工具可能会相当昂贵。由于漏洞处于不断变化的状态，供应商需要不断跟进漏洞的变化、发布的修补程序、新出现的变种以及其他许多不断变化的因素。如果没有这些持续的更新，这些工具将很快失去实用性，无法检测到新漏洞或提供准确的信息。

最终，漏洞评估的结果只会给你一个关于你是否安全的信息——也就是，它会告诉你是否在每台主机上存在已知的特定漏洞。

进行漏洞评估需要几个步骤，本节将详细介绍。

#### *映射和发现*

要能够扫描漏洞，你需要知道在环境中有哪些设备。通常，你会对一组或一范围的主机进行扫描，而这些主机会随着时间发生变化。如果你没有某种方法来保持主机列表的最新，扫描结果将不完整，或者你可能会扫描完全错误的主机。这在云主机中尤其是一个问题，我将在本章稍后讨论这一点。

##### 环境映射

开始你的漏洞扫描工作时，首先需要创建一个显示网络中设备的环境图。大多数漏洞扫描工具允许你直接创建这样的图；如果没有，你可以从专门为此目的开发的工具（如 Nmap (*[`nmap.org/`](https://nmap.org/)*))导入主机信息。

通常，工具通过查询网络范围内的每个 IP 地址来创建这些网络图。对于大型网络范围，这可能需要很长时间——也许比主机出现和消失的时间还要长。例如，一个*Class A*的内部网络，通常可以通过其 IP 地址范围 10.0.0.0 到 10.255.255.255 来识别，它可以包含超过 1600 万个 IP 地址。另一个常见的内部网络方案，*Class B*网络，通常使用类似于 192.168.0.0 的 IP 地址，最多可以包含超过 65,000 个主机。在某些环境中，常常使用一个 Class A 网络和多个 Class B 网络来进行分段。由于大多数工具每查询一个 IP 地址都需要一秒钟或更长时间，你可能需要花费相当长的时间来完成扫描。

如果不小心慢速执行，进行这些发现扫描还可能给你的网络基础设施带来压力。在绘制网络图时，完全有可能过载网络设备，如路由器和交换机，导致它们无法响应。

##### 发现新主机

除了绘制网络图来了解网络中原本存在的设备外，你还需要保持主机列表的最新。 如果你知道网络中任何新设备的位置，可以去特定地方查找，但如果它们不在你预期的位置，你可能会错过某些主机——特别是当它们被放置在某些隐蔽的位置以便隐藏时。

你可以主动或被动地发现新的主机。*主动*发现涉及一个类似于最初用来绘制网络图的过程：你逐一检查每个 IP，询问它是否有任何响应。这与绘制网络图时遇到的限制有很多相似之处，但你可以将这些更新限制在你已知包含设备的网络部分，以便能够更快速地扫描网络范围，间隔时间也更短。

你还可以使用*被动*扫描技术来发现网络上的设备。这通常涉及将设备放置在网络瓶颈点，例如路由器或交换机，以监听通过你网络基础设施的流量。通过这种方式，当设备在网络上通信时，你可以自动发现它们，并将其自动添加到你要扫描的主机列表中。

#### *扫描*

一旦你知道了自己的主机，你可以对它们进行漏洞扫描。有几种不同类型的扫描可以执行，每种类型也有不同的方法。

##### 未认证扫描

主机的基本漏洞扫描通常是外部和未经认证的扫描。这类扫描不需要主机的任何凭据，也不需要除了网络连接之外的其他访问权限。这样，你几乎可以对任何设备进行扫描。根据扫描的设置，它通常会显示目标主机上开放的端口，揭示这些端口上服务的横幅信息，并根据收集的其他信息推测正在使用的应用程序和操作系统。

##### 认证扫描

你还可以对主机执行认证扫描。*认证扫描*是使用有效凭据（通常是管理员凭据）进行的扫描。拥有登录主机的凭据通常可以让你收集内部信息，例如已安装的软件、配置文件的内容、文件和目录的权限、系统需要但当前没有的漏洞修补程序以及其他信息。这使你能够比从外部看到的更加全面地了解设备及其潜在漏洞，从而生成更加准确的设备安全状况图像。

然而，认证扫描要求你保持认证凭据的最新状态，既包括漏洞扫描工具端的凭据，也包括主机本身的凭据。一些检查还需要管理员访问权限，而一些系统所有者可能不愿意给你提供这种广泛访问权限的凭据。

##### 代理扫描

代理扫描可以提供一种解决认证扫描一些缺点的方式。*代理*是安装在每个主机上的一小段软件。该软件作为系统上的用户运行，因此它是经过认证的，但不需要你在设备上或漏洞扫描工具中维护一组单独的凭据。

使用代理的另一个好处是，配置了代理的主机通常会自动向管理设备报告，从而减少了在网络中单独搜索设备的需求。尽管这并不能完全消除这一需求，因为一些设备，如网络设备，可能无法运行代理，但它应该大大减轻你的负担，因为大多数或所有你期望存在的设备应该会自动识别自己。

##### 应用程序扫描

一些工具允许你扫描特定的应用程序。例如，许多成熟的扫描器专门用于扫描 Web 应用程序。这类扫描特定于 Web 技术和漏洞，并且比仅用于主机扫描的扫描器能更深入地搜索应用程序中的问题。你会发现，Web 应用程序扫描器通常是开发得更深入的应用程序漏洞扫描器，事实上，许多扫描器专门用于此目的。一个常见的扫描器是 Burp Suite（*[`portswigger.net/burp/`](https://portswigger.net/burp/)*），它在第十三章中提到，是一个非常强大的工具，适用于 Web 应用程序的自动化和手动测试。

#### *漏洞评估中的技术挑战*

你可能会遇到许多技术挑战，这些挑战会让你更难以实例化和维护漏洞扫描器。一些最常见和频繁的障碍与云技术和虚拟化技术有关。

##### 云

云中的资源给这里讨论的任务、流程和技术带来了一些变化。如第六章中所述，云提供商可能会有一些特定的规则，规定你在他们的环境中可以做什么、不能做什么，而这些规则可能因云提供商而异。

在进行漏洞扫描时，一些供应商可能根本不希望你在他们的环境中扫描设备，尤其是当他们使用某些云部署模型时。在大多数基础设施即服务（IaaS）模型中，你可能能够在某些边界内并根据特定规则进行扫描。在平台即服务（PaaS）环境中，供应商可能会限制你只能通过代理进行扫描，因为基础设施本身可能对你不可见。在软件即服务（SaaS）环境中，提供商可能根本不希望你进行扫描。

进行云扫描时的另一个考虑因素是环境的波动性。即使是在 IaaS 平台的情况下，设备和 IP 也可能在后台频繁变化，你可能会不小心发现自己正在扫描不再属于你的设备或网络。由未知实体发起的外部漏洞扫描产生的流量几乎无法与攻击流量区分开，因此你不应在没有适当权限的情况下，将这些工具指向其他公司的资源。

##### 容器

云计算和虚拟化环境中另一个常见且可能有问题的特点是容器。*容器*是一种完全自包含并且可立即运行的虚拟化实例，专门设计用于让环境中某些部分根据负载波动轻松扩展和缩减。例如，您的 Web 服务器集群在深夜时可能负载很轻，缩减到几个容器即可满足需求。而在白天，服务器集群可能会扩展到数百个实例，并根据负载在一天内不断地扩展和缩减。

由于容器可能一秒存在，下一秒就消失，因此它们不适合进行定期的漏洞扫描。容器通常需要专门的漏洞扫描工具来评估其漏洞。

### 渗透测试

有些人认为漏洞扫描和渗透测试是一样的。虽然渗透测试人员可能会使用漏洞扫描的结果，但这两者是不同的活动，各自有独立的流程。

渗透测试，也称为*pentesting*或*伦理黑客*，是测试系统是否存在攻击者可能利用的漏洞的过程。渗透测试比漏洞扫描更深入，且通常是手动进行的。虽然漏洞评估可能帮助你评估部分安全性，但它无法全面评估。

渗透测试的目标是发现安全漏洞，以便在攻击者发现之前修复它们。渗透测试人员使用与真正的恶意黑客（称为*黑帽黑客*）相同的工具和技术。但与黑帽黑客不同，渗透测试人员有权进行这些活动，这意味着如果在未经另一家公司授权的情况下对你的系统进行渗透测试，那么这在任何意义上都将被视为网络犯罪行为。

你常常会看到渗透测试团队被称为*红队*，这是一个源自军事的术语。红队在评估系统安全性时，扮演攻击者的角色，尽可能真实地进行测试，同时确保测试安全合理。

#### *渗透测试过程*

渗透测试遵循一个相对标准的过程：范围界定、侦察、发现、利用和报告，如图 14-1 所示。

![图片](img/14fig01.jpg)

*图 14-1：渗透测试过程*

尽管对渗透测试过程的描述可能使用略有不同的术语或包含更多或更少的步骤，但一般概念几乎总是相同的。

##### 范围界定

在你进行渗透测试之前，你需要知道你正在测试的对象是什么。你的渗透测试范围可以非常宽泛，比如“所有 MyCompany 的资产”，或者仅列出你可以测试的单独 IP 地址。

此外，组织可能会将你的测试限制在测试或质量保证（QA）环境中，以避免对生产系统造成影响。虽然渗透测试人员通常不会使用故意破坏性的攻击，但他们的工具和技术仍然可能产生不可预见的副作用。

组织还可能在其范围讨论中提供*参与规则*。这些规则可能会指定测试必须进行的时间、测试人员如果发现严重漏洞时应遵循的程序等等。这些规则会根据被测试的环境和具体组织的不同而大不相同。

##### 侦察

*侦察*，或称*侦查*，是你在尝试攻击目标之前进行的研究。这可能包括在互联网上搜索有关目标环境或公司信息、查看招聘信息中是否提到特定技术、研究公司可能使用的一些技术等等。侦察通常是一个被动的活动，但并不总是如此，它几乎接近于将工具指向目标环境。

##### 发现

渗透测试的发现阶段开始了积极的测试阶段。在这里，你可能会运行漏洞评估工具（如果你还没有运行过的话），并检查结果。在这一步中，你会查找主机上的开放端口和服务，以检测可能易受攻击的服务。根据你在这里发现的内容，你可能会根据你收集的具体信息进行额外的研究和侦察。

##### 利用

这个阶段涉及尝试利用你在早期阶段发现的漏洞。这可能包括攻击环境中的漏洞，甚至将多个漏洞结合起来，以便深入渗透到环境中。同样，你在这里发现的内容可能会促使你进行额外的研究和侦察，因为你获得了关于目标的新信息，或者新的目标变得可用。

##### 报告

渗透测试的最后一个阶段是报告。在这里，你需要仔细记录你发现的内容以及重新执行你成功实施的攻击所需的确切步骤。

这一步说明了漏洞评估和渗透测试之间的一个关键区别。漏洞评估可能会产生一个环境中潜在漏洞的列表，但工具无法保证攻击者能够实际利用这些漏洞。在渗透测试中，测试者只会报告那些导致系统可以被实际攻击或有很高可能被利用的问题。

#### *渗透测试分类*

你可以通过几种不同的方式对渗透测试进行分类。在测试时，你可以以不同的了解程度、不同的起点或者由不同的团队负责特定部分的方式来进行。

##### 黑盒、白盒和灰盒

你会经常看到渗透测试被称为某种颜色或透明度级别。这指的是测试人员获得的关于被测试环境的信息量。

在*黑盒测试*中，测试人员对环境的了解仅限于测试范围。这与现实中的攻击非常相似，因为外部攻击者通常也会从这个地方开始。

*白盒测试*则为测试人员提供关于环境的所有可用信息。这可能包括所有主机的列表、使用的软件、应用程序和网站的源代码等等。尽管这不是一种现实的攻击方式，因为攻击者通常不会拥有这些信息，但它允许测试人员更为彻底地进行测试，并可能发现那些原本未被发现的问题。

*灰盒测试*是前面提到的两种测试类型的混合体。在这种测试中，攻击者会获得一些关于环境的内部信息，但不会像进行白盒测试时那样得到大量的信息。这是渗透测试中比较常见的一种类型。

##### 内部与外部

渗透测试有时也被称为内部或外部测试，这可以有两种不同的解释。*内部*和*外部*可能指的是测试人员获得的访问权限类型。例如，如果你只给测试人员提供从互联网面向的部分访问权限，你可以称之为外部渗透测试。相反，如果测试人员和环境在同一网络上，无论是物理上还是通过虚拟私人网络（VPN）连接，你可以称之为内部测试。在这种情况下，内部测试可能会提供更大的访问权限，因为测试人员将在某些安全层级内开始他们的测试。

*内部*和*外部*也可能指的是进行渗透测试的人员或团队类型。外部测试可能指的是聘请的第三方测试公司来进行渗透测试，而内部测试则可能指的是为你的组织工作的渗透测试团队。

#### *渗透测试目标*

渗透测试有时会针对特定的技术或环境，如 Web 应用程序、网络或硬件。我将在本节中详细讨论这些内容。

##### 网络渗透测试

尽管*网络渗透测试*这个术语听起来像是针对特定网络设备进行的测试，比如路由器或交换机，但它通常作为一个总括性渗透测试术语，用于广泛测试主机的漏洞、与 Web 应用程序相关的问题，甚至是容易受到社会工程攻击的员工。

网络渗透测试通常具有广泛的测试范围，但往往在有限的时间内进行（也称为*时间限定*），因此相较于专门聚焦的测试，它通常会稍显浅显，因为测试者可能没有足够的时间去深入挖掘测试范围内的所有内容。这是较为常见的一种测试类型。

##### 应用程序渗透测试

*应用渗透测试*，另一种常见的测试类型，直接关注应用程序或应用程序环境。与网络渗透测试所需的工具和技能相比，应用程序测试通常涉及更加专业化的工具和技能，并且更加聚焦。它可以采用两种不同的方法：静态分析和动态分析。

*静态分析*涉及直接分析应用程序的源代码和资源。例如，测试者可能会仔细检查代码，寻找逻辑错误或由于特定代码行和使用的库而存在的漏洞。进行静态分析时，测试者必须具有强大的开发背景和对使用语言的掌握。

*动态分析*涉及在应用程序运行时进行测试——换句话说，测试已编译的二进制文件或正在运行的 Web 应用程序。虽然这不能像静态分析那样让测试者深入了解代码，但它更贴近真实的攻击方式。

Web 应用程序测试很常见，因为组织使用 Web 应用程序的频率很高，攻击者也很可能以它们为目标。移动和桌面应用程序也是特定应用程序测试的常见目标，通常通过静态分析技术进行测试。这些应用程序对攻击者来说尤其容易成为目标，因为应用程序和它们的资源的大部分存储在测试者可以控制的设备上。

##### 物理渗透测试

物理渗透测试涉及通过直接测试物理安全措施，例如撬锁或绕过报警系统，来进行测试。像应用程序测试一样，这种类型的测试也需要特定的工具和技能来进行有效测试。这也是一种较为少见的测试类型，因为许多组织更关心黑客是否渗透进他们的系统，而不是有人撬开他们办公室门锁。

测试人员通常会与其他渗透测试一起进行物理渗透测试，或辅助其他测试。例如，如果攻击者能够进入一个设施并进入一个上锁的网络机房，他们可能能够将设备插入网络并留下，这样他们就可以在网络内部执行攻击，而无需亲自到场。

和其他类型的渗透测试一样，通常在特定范围内并以特定目标为导向进行物理渗透测试，无论你是想进入数据中心或办公室，还是将你的恶意设备插入网络。

##### 社会工程测试

社会工程渗透测试使用了第八章中讨论的相同技术，并且通常与其他测试一起进行。社会工程测试非常有效，以至于测试人员几乎总是能够成功，因此许多组织拒绝允许这种测试。为了防止它们成功，工作场所通常需要仔细的准备和良好的教育（或者他们需要保持警觉）。

社会工程测试通常涉及钓鱼攻击，这些攻击容易设置并且可以传递给大量员工。冒充员工并试图未经授权访问设施或资源也是常见的策略。外部审计团队通常会直接走进一个受保护区域的门后，就像是没有使用通行证一样（记住这叫做*尾随*）。一旦他们这么做，他们就能将一台不明设备带入建筑物并留下，就像前面提到的那样。许多人不会对那个正在空桌子上插入并设置计算机的“IT 人员”提出疑问。

##### 硬件测试

硬件测试是一种稍显不同的渗透测试类型。它通常发生在制造硬件设备的组织中，如网络设备、电视或物联网设备，这些设备常常是渗透测试者的肥沃土壤，因为它们的许多接口对普通用户不可访问且安全性不高。除了测试设备本身，渗透测试者还通常会测试设备上的固件、相关的移动应用程序以及设备用于与服务器通信的应用程序接口（APIs）。

在侦察和发现阶段，你很可能会发现关于硬件的具体信息。此步骤可能涉及拆解设备并查看内部组件和芯片上的标记。还经常可以找到制造商的规格说明，有时这能让你以设备制造商未曾预料的方式访问硬件。

硬件设备通常配备有通用异步接收/发送器（UART）或联合测试行动小组（JTAG）调试端口，打开设备后可以在电路板上访问这些端口。这些端口通常提供终端访问设备的功能，在很多情况下不需要任何身份验证，你可以利用它们来操控设备。

硬件设备的发现阶段可能会稍微复杂一些。测试人员可能会调查设备本身的固件，也许是在从设备内部的闪存存储芯片中提取其副本之后，或者他们可能会测试控制设备的模块或应用程序，甚至是相关的 Web 应用程序。这些设备的软件部分可能非常复杂，因为它们包括了整个操作系统和所有运行设备的应用程序。一些设备，例如智能手机，甚至可能有多个操作系统和软件层次。

#### *漏洞悬赏计划*

在过去几年中，许多组织已经开始将漏洞悬赏计划作为一种渗透测试。这些计划的规则和流程与常规的渗透测试基本相同，只是稍有不同。

在一个*漏洞悬赏计划*中，组织会向发现其资源中漏洞的人提供奖励。这些“悬赏”通常根据发现的问题的严重性而有所不同。奖励可以从一声感谢或一件 T 恤到数十万美元不等。举个例子，在 2018 年 1 月，谷歌向一位中国安全研究人员支付了 11.2 万美元，作为其在 Pixel 智能手机中发现的一个漏洞的奖励。¹

拥有悬赏计划的组织允许任何人在其设定的范围内进行测试，并根据指定的悬赏支付发现特定问题的测试人员奖励。让全世界的任何人随时攻击你的系统听起来可能是个糟糕的主意，但这些计划已经取得了很高的成功率。风险部分得以缓解，原因是这些组织通常会小心地明确规定其计划的具体范围，并且仅对在指定范围内报告的问题支付悬赏。因此，通常没有太多动机去进行范围之外的攻击——比如仅仅是为了“乐趣”。

很多平台代表其他公司管理漏洞悬赏计划。一些知名的漏洞悬赏平台包括 HackerOne (*[`www.hackerone.com/`](https://www.hackerone.com/)*), Bugcrowd (*[`www.bugcrowd.com/`](https://www.bugcrowd.com/)*), 和 Synack (*[`www.synack.com/`](https://www.synack.com/)*)。这些平台还使得那些希望参与计划的人可以轻松查看悬赏内容，以及每家公司提供的范围和奖励。

#### *渗透测试中的技术挑战*

就像漏洞分析一样，渗透测试也面临着技术挑战，其中许多问题是相似的。

##### 云

云计算同样会给渗透测试带来一些问题。一个较大的问题是云服务提供商通常不喜欢测试者随意攻击他们的云基础设施。云服务提供商在资源管理方面非常严格，不太喜欢那些消耗大量资源的突发活动。如果允许测试，云服务提供商通常会要求你正式请求渗透测试的许可，并在特定的时间表内、从已知的 IP 地址进行测试。随意对云服务进行攻击的测试者，很可能会发现他们的流量被阻塞，或者更糟的是，相关部门介入。

##### 寻找熟练的测试人员

同时，找到有经验的渗透测试人员也常常是一个难题。经验丰富的高技能测试人员与新手之间的差距，在你可以期待的结果上是巨大的。一个不熟练的测试人员可能仅仅停留在检查漏洞扫描工具输出的结果，这些结果很可能包含未经验证的误报，并遗漏了重大问题。

从渗透测试团队获得的结果较少的报告，往往不是你惊人安全性的有力证明，而是测试团队技能水平的体现。渗透测试技巧需要时间和经验来培养，但渗透测试需求量很大。因此，你可能会遇到一些未经监督的测试，这些测试由没有资格进行的测试人员执行。

### 这真的意味着你已经安全了吗？

在你评估了漏洞、进行了渗透测试，并修复了所有相关问题后，你真的安全吗？那些邪恶的黑帽黑客是否会在你坚不可摧的安全墙上猛撞，然后夹着尾巴灰溜溜地离开？嗯，可能不会。关于我讨论的所有内容，存在一些警告，而且没有什么是完美安全的。

#### *现实测试*

为了准确评估你的安全性，你需要进行现实的测试。这意味着你应该在不妨碍或歪曲结果的情况下进行漏洞评估和渗透测试。这比听起来要难得多。

##### 参与规则

当你为测试设定参与规则时，必须严格遵守外部攻击发生的条件。这项工作的核心目的是模拟攻击者的行为，以便你能够首先发现并修复问题。如果你设定的参与规则人为地提高了你的安全等级，那就没有为自己提供任何帮助。例如，如果你设定了一个规则，要求不进行攻击链（连续进行多个攻击以深入渗透），那么你实际上已经阻止了攻击者获取更深层次环境的能力。

##### 范围

出于类似的原因，设定一个实际可行的范围也非常重要。是的，你必须确保你的测试不会影响生产环境或降低客户服务水平，但组织通常会以这些因素作为借口，设定一个人为狭窄的范围。例如，如果你在零售环境中进行测试，并将处理支付卡数据的系统排除在范围之外，那么你就排除了攻击者试图访问的正是这个部分。

在进行范围决策以保护生产资产时，最好设置一个特定的环境来模拟生产环境，以便可以毫无顾虑地进行测试。

##### 测试环境

如果你使用测试环境进行扫描或测试，你应该确保它与生产环境尽可能相似。许多组织通常会为渗透测试设置理想化的、经过充分修补和高度安全的环境，但在实际生产环境中却没有采取任何相同的措施。设置一个这种“波将金村”的环境与进行这些评估和测试的初衷是背道而驰的。

在这些情况下，通常在云环境中操作会很有帮助。在许多情况下，你可以准确地复制一个完全由云主机和基础设施组成的环境，并将其置于独立的隔离区域，这样你就可以测试一个与生产环境完全相同的环境，并在不再需要时拆除它。

#### *你能发现自己的攻击吗？*

评估你安全性的一种方法是，在运行漏洞扫描工具和渗透测试时，密切关注你的日常安全工具和告警系统。如果你正确地评估了安全性，这些活动应该与实际攻击几乎无法区分。如果你没有注意到你的测试进行中，那么你也很可能无法察觉到实际的攻击。在许多情况下，渗透测试人员的隐秘性通常不如攻击者，所以他们应该更容易被发现。

##### 蓝队和紫队

在本章之前，我们提到过渗透测试人员是红队。红队的对立面是*蓝队*，负责保护组织并抓住红队。蓝队应该像红队攻击一样参与渗透测试的另一面。虽然你可能不想主动阻止来自红队的攻击（干扰测试是一个有争议的话题，因为它可能会影响测试结果），但你一定要记录并记录他们活动的证据。你应该有每次红队成功突破的攻击证据，或者至少了解它是如何避开你的注意力的，这样你才能修复你的安全漏洞。渗透测试的结果是申请额外资源或工具预算以弥补这些漏洞的一个极好的依据。

你也许会听到有人谈论*紫队*，它们在红队和蓝队之间架起桥梁，帮助确保两者尽可能高效地运作。在小型安全团队的环境中，紫队可能同时扮演红队和蓝队的角色。

##### 仪器化

要在渗透测试人员行动时抓住他们，必须部署适当的监控工具。如果没有入侵检测系统、防火墙来监视异常流量，或者没有反恶意软件和文件完整性监控（FIM）工具等，你就无法获得用于监视这些攻击的数据。合理的工具组合会根据你的环境和安全预算有所不同，但如果需要，你也可以用较少的工具做很多事情。

至少，你应该运行一些在最低硬件上运行并且能够以极低开销部署的开源工具。例如，Security Onion 分发版可以从主机入侵检测、网络入侵检测、全时数据包捕获、日志、会话数据和交易数据中获取数据——这些都可以在预算有限的情况下实现。²

**FIM 工具**

FIM 工具用于监视特定机器上的应用程序和操作系统文件的完整性。通常，你会使用 FIM 仅监视敏感文件，例如定义操作系统或应用程序配置的文件，或保存特别敏感数据的文件。一旦文件发生变化，可能会有警报通知某人更改，或者在某些情况下，文件可能会自动恢复到原始状态。FIM 工具需要仔细调优，因为如果配置不当，它们可能会产生大量警报“噪音”。

##### 警报

同样，来自工具的适当警报也至关重要。你需要有良好的警报机制，这样你才能知道何时捕获到测试者。你不希望你的工具在角落里低声自语，完全被蓝队忽视。通过适当的警报，你可以接近实时地响应攻击或渗透测试。

你还需要小心你发送的警报。如果你发送了太多警报，特别是虚假的警报，你的蓝队可能会开始完全忽视这些警报。来自医疗行业的常见术语*警报疲劳*³ 描述的就是这种情况。解决这个问题的方法是谨慎发送可操作的警报（那些能促使特定响应的警报），并尽量减少警报的数量。

#### *今天安全并不意味着明天安全*

重要的是要理解漏洞评估和渗透测试只是某一时刻的快照。一次性安全并不意味着永远安全。你必须定期迭代这些过程，以保持它们产生的信息的有效性。

##### 你不断变化的攻击面

攻击面是指攻击者可以用来与你的环境交互的所有点的总和。它包括你的网页服务器、邮件服务器、托管的云系统、在酒店房间里使用笔记本电脑的销售人员、公开的 GitHub 仓库中的内部源代码以及其他成百上千个类似问题。由于你的攻击面由许多不断变化的部分组成，它处于不断变化的状态。你一个月前的漏洞评估或去年的渗透测试可能已经不再完全准确——这就是需要定期更新这些评估的原因。

##### 攻击者也在变化

攻击者也在不断发展他们的攻击和工具。攻击者的数量远多于防御者，而且许多攻击者有直接的经济动机去更新他们的工具和技术。此外，攻击工具经常以丰厚的利润出售给其他黑客。整个网络犯罪行业的运作依赖于保持其工具的更新，至少和安全工具行业对防御者的依赖一样，甚至更多。

如果只安装一层安全防护，并期望它在几年后依旧和安装时一样坚固有效，这是一个错误的赌注。为了应对攻击者的变化，你也需要进行变化。这个“猫捉老鼠”游戏已经推动了安全行业多年来的发展，并将继续这样下去。

##### 技术在你之下更新

更糟糕的是，你的技术可能会在你不知情的情况下发生变化。你常用的许多操作系统、移动应用、云服务、安全工具和代码库都会定期更新，由其创建和维护者进行更新。你智能电视中的操作系统可能在昨晚深夜更新了，暴露了你面临来自互联网的攻击。它可能会在明天再次更新以修复问题，而你当时可能依然不会知道。

你可能会在测试过程中发现由于更新引发的一些安全问题，或者你可能根本不知道这些问题的存在。为了防止这种问题发生，最好的做法是实施多层次的安全控制。

#### *修复安全漏洞是昂贵的*

最后，修复安全漏洞是非常昂贵的。它在资源、购买和更新安全控制的成本，以及修复应用程序和网站中不安全代码所需的开发工作方面都是昂贵的。比你想象的更常见的是，组织会在业务优先级面前忽视安全性。你可能会花费大量精力来 catalog 漏洞并编写渗透测试报告，结果却被告知你发现的关键问题要等到其他工作完成后才会处理。在安全领域中，这种情况非常常见，你可能会找到另一种方法来部署安全控制，或者用安全工具来填补漏洞。事情不会总是完美的，但你仍然必须尽力确保组织的安全。

### 摘要

在本章中，我讨论了漏洞评估以及你可以用来查找主机和应用程序中的安全问题的工具。我还讨论了漏洞评估与渗透测试的区别，以及为什么你应该同时进行这两者。

我介绍了渗透测试、进行渗透测试的过程，以及渗透测试的几个专业子领域，如 Web 应用程序和硬件测试。我还讨论了在云环境和虚拟化环境中进行渗透测试时所面临的挑战。

最后，我讨论了在经过漏洞评估和渗透测试的所有努力后，你是否真的变得更加安全，以及如何判断自己是否进行过测试（或没有进行）。漏洞评估和渗透测试代表了一个特定时间点，这意味着你必须不断地重复这些过程，以保持数据的更新。

### 练习

1.  你可以使用哪些方法来检测环境中的新主机？

1.  在漏洞扫描中，代理程序提供了哪些好处？

1.  在容器的漏洞扫描中存在哪些挑战？

1.  渗透测试与漏洞评估有何不同？

1.  红队和蓝队有什么不同？

1.  为什么渗透测试的范围定义很重要？

1.  静态分析和动态分析有什么区别？

1.  Bug 奖励计划与渗透测试有何不同？

1.  你所测试的环境对测试结果有什么影响？

1.  什么是警报疲劳？
