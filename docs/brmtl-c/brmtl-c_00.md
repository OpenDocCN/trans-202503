# 前言

![](img/chapterart.png)

本书名为*裸机 C*，因为它是为那些接近硬件的人准备的。它不适合那些购买现成电脑并从未看到过内部结构的人。本书使用的计算机甚至没有外壳。如果你想使用它，你必须将某些东西连接到电路板的“裸金属”上。

本书教授嵌入式编程。*嵌入式计算机*是指那种嵌入机器内部且你永远不知道它存在的设备。它是驱动你的车库门开关、微波炉、汽车，甚至贺卡的设备。但在它能够执行这些任务之前，需要进行编程。这就是本书教给你的内容：如何编程嵌入式系统。

为什么选择 C？C 语言让你能够精确控制程序的行为，而其他语言，如 C++，可能会在你不知情的情况下做很多事情。考虑以下语句：

```
a = b;
```

在 C++中，这可能调用类的赋值操作符函数，导致堆内存被分配和释放，并且可能抛出异常。现在这些是什么意思并不重要；关键是你无法完全知道将会发生什么。

在 C 语言中，这个语句将值`b`赋给变量`a`，没有副作用；它只是一个赋值操作，仅此而已。这个例子很简单，但你会在本书中看到 C 语言如何按照你的指令做事。

精确控制非常重要，因为我们使用 C 语言来编程一个基于 STM32F030x4 处理器的低端*系统单芯片（SOC）*系统（这是一个廉价的基于 ARM Cortex-M0 的系统，配备 8KB RAM）。在有限的 RAM 下，内存管理至关重要，因此我们不能允许像 C++这样的高级语言在背后操控内存。精确控制同样重要，因为嵌入式系统没有操作系统，你需要直接告诉硬件该做什么。高级语言并不总是允许你与硬件直接交互，而 C 语言则可以。

本书适用于那些具备基本计算机和硬件知识，但对编程了解有限的人。它是为那些希望将新硬件连接到微控制器并首次使用的硬件设计师而设计的。它也适用于那些对低级编程感兴趣并希望充分利用 38 美分芯片的程序员。

为了充分发挥程序的性能，你需要了解程序背后发生的事情。这本书不仅教你如何编写程序，还会展示你的程序是如何被翻译成 ARM 芯片使用的机器码的。这一点对于最大化效率至关重要。例如，你将了解到如果将程序中的 16 位整数改为 32 位整数，会带来多大的性能影响。令人惊讶的是，32 位整数*更高效*且*更快*（32 位是 ARM 的自然数据大小，如果被迫进行 16 位运算，它会先进行 32 位计算，然后丢弃 16 位）。

要编程和调试 ARM 芯片，你需要一些额外的工具：闪存编程器（用于将代码加载到机器中）、USB 到串行转换器（因为我们使用串行线进行调试）和 JTAG 调试器。由于几乎所有开发者都需要这种工具组合，意法半导体（STMicroelectronics）生产了一款提供所有所需硬件的开发板，名为 NUCLEO-F030R8。目前，由于芯片短缺，某些开发板可能很难找到。请参考[`nostarch.com/bare-metal-c`](https://nostarch.com/bare-metal-c)以获取替代开发板。你还需要一根迷你 USB 数据线（那种不适用于你手机的线），以便将开发板连接到计算机上。

你的第一项任务是订购一块 NUCLEO-F030R8 开发板。然后开始阅读第一章。当开发板到货时，你就准备好了。
