# 第二部分

大型机器的 C 语言

到目前为止，我们集中讨论了嵌入式编程。在嵌入式系统中，你有有限的内存和资源。然而，C 语言是为有操作系统的大型机器设计的（这些操作系统我们不需要自己编程），它具有许多在这些大型机器上有用的功能。

例如，有一个称为*堆*的内存区域，它允许你根据需要分配和释放内存来存储复杂的对象。像网页浏览器和 XML 解析器广泛使用堆。

我们之前没有讨论过这个，因为我们几乎没有足够的内存来处理堆栈——将内存划分为堆栈和堆就像将一滴水分到两个杯子里。虽然可能，但非常棘手且不太有用。

我们也没有讨论过 C 语言的 I/O 系统。我们必须自己处理 I/O，直接访问硬件。而在具有操作系统的大型机器上，C 语言的 I/O 系统和操作系统会将所有这些细节隐藏起来。

让我们来看一下嵌入式编程和非嵌入式编程之间的区别。

在嵌入式编程中，当你写入设备时，你是直接写入设备。这意味着你必须了解你所使用的设备的详细信息。而在非嵌入式编程中，当你调用`write`写入设备时，你是告诉操作系统来完成这项工作，包括缓冲区处理，以提高 I/O 效率，并处理实际的设备。

在嵌入式编程中，你的内存是有限的。你需要知道每一个字节的位置以及它是如何使用的。而在非嵌入式编程中，你有操作系统和内存映射系统，这使你可以访问大量内存。大多数程序可以浪费一些内存，而且许多程序确实会这样做。

嵌入式程序通过外部加载器加载到闪存中。在我们的例子中，它被称为 ST-LINK，并且隐藏在 IDE 内部，但它确实存在。程序永远驻留在闪存中，在系统正常运行期间永远不会被卸载或替换。而非嵌入式系统则有一个操作系统，根据需要加载和卸载程序。

嵌入式系统运行一个程序。你几乎没有足够的内存来运行其他程序。然而，非嵌入式系统可以并且确实能同时运行多个程序。我现在使用的系统正在运行 341 个程序，而且它是一个小型系统。

嵌入式程序永远不会停止，而非嵌入式程序可以退出并将控制权返回给操作系统。

嵌入式系统将所有数据存储在内存中。非嵌入式系统有一个文件系统，可以读取和写入文件数据，以及屏幕、网络和其他外设。

最后，嵌入式系统中的错误必须由你的程序来处理。对于非嵌入式系统，你有一个操作系统，它会捕捉程序未处理的错误并打印警告或停止程序。操作系统可以防止坏程序损坏系统中的其他资源。相比之下，如果嵌入式程序出现问题，你很容易就会把系统“砖化”。

C++ 在大系统上运行得很好，因为在大多数情况下，开销不会对事情产生显著影响。例如，假设你想编写一个程序从数据库中读取一堆数据并生成报告。对于一天运行一次的报告，谁在乎程序使用了 0.5 秒 CPU 时间还是 0.2 秒？

然而，如果你从事高性能计算，如游戏、动画或视频编辑，你需要 C 语言的性能和精度。尽管它是一个较老的语言，C 语言仍然在大型机上占有一席之地。

在本节中，你将学习如何使用堆，它是可以随时分配或释放的动态内存。你还将学习如何处理操作系统的 I/O 系统——实际上有两个 I/O 系统：缓冲 I/O 系统和原始 I/O 系统。

最后，你将发现如何使用浮动点数。大多数廉价的嵌入式处理器没有浮点单元，因此我们无法在嵌入式程序中使用浮动点数。此外，尽管大型机有专用的浮点硬件，你必须小心使用此功能；否则，可能会得到意外的结果。
