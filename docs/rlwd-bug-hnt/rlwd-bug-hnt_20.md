## 第二十章：漏洞报告**

![图片](img/common.jpg)

好了，你发现了第一个漏洞，恭喜你！找到漏洞并不容易。我给出的第一个建议是放松，别急于求成。急躁时你常常会犯错误。相信我——我知道那种兴奋的感觉，提交一个漏洞报告却被拒绝。当公司将报告标记为无效时，漏洞悬赏平台还会扣除你的信誉点。这是一个艰难的教训，这一章将通过提供编写优秀漏洞报告的技巧，帮助你避免这种情况。

### 阅读政策

在提交漏洞之前，务必检查程序政策。每个参与漏洞悬赏平台的公司都会提供一份政策文件，通常会列出排除的漏洞类型，以及某些属性是否在程序范围之内。始终在进行黑客攻击之前阅读公司的政策，以避免浪费时间。如果你还没有阅读某个程序的政策，现在就去做，确保你没有在寻找公司要求你不要报告的已知问题或漏洞。

这是我曾经犯的一个痛苦错误，如果我事先阅读了政策是可以避免的。我发现的第一个漏洞是在 Shopify 上。我意识到，如果在其文本编辑器中提交格式错误的 HTML，Shopify 的解析器会自动修正并存储 XSS。我很兴奋。我以为我的漏洞挖掘工作得到了回报，迫不及待地想提交报告。

提交报告后，我等待了至少 500 美元的悬赏。提交五分钟内，程序礼貌地告诉我漏洞已经为人所知，并且研究人员已被要求不要提交此漏洞。该报告被关闭为无效报告，我失去了五个信誉点。我恨不得想找个地方躲起来。这是一个痛苦的教训。

从我的错误中吸取教训；阅读政策。

### 提供细节；然后再提供更多

确认你能报告漏洞后，你需要编写报告。如果你希望公司认真对待你的报告，提供包括以下内容的详细信息：

+   重现漏洞所需的 URL 和任何受影响的参数

+   你的浏览器、操作系统（如适用）以及测试应用的版本（如适用）

+   漏洞的描述

+   重现漏洞的步骤

+   漏洞影响的解释，包括漏洞可能被利用的方式

+   修复漏洞的建议方案

我建议你以截图或 *短* 视频的形式提供漏洞证明，视频时长不超过两分钟。概念验证材料不仅提供了你发现的记录，还在演示如何重现漏洞时非常有帮助。

在准备报告时，你还需要考虑漏洞的影响。例如，Twitter 上的存储型 XSS 是一个严重问题，因为该公司是公开的，用户数量庞大，人们对平台的信任等因素。相比之下，一个没有用户账户的网站可能会认为存储型 XSS 的严重性较低。相比之下，托管个人健康记录的敏感网站上的隐私泄漏，可能比 Twitter 上的隐私泄漏更为重要，因为 Twitter 上的大多数用户信息已经是公开的。

### 重新确认漏洞

在你阅读完公司政策、草拟报告并包含概念验证材料后，花点时间问问自己，所报告的内容是否真的是一个漏洞。例如，如果你报告了一个 CSRF 漏洞，因为你在 HTTP 请求体中没有看到 token，检查一下该参数是否可能作为 header 被传递。

2016 年 3 月，Mathias Karlsson 写了一篇关于绕过同源策略（SOP）漏洞的精彩博客文章 (*[`labs.detectify.com/2016/03/17/bypassing-sop-and-shouting-hello-before-you-cross-the-pond/`](https://labs.detectify.com/2016/03/17/bypassing-sop-and-shouting-hello-before-you-cross-the-pond/)*）。但他并没有获得奖金，Karlsson 在博客中解释道，引用了瑞典谚语 *Don’t shout hello before you cross the pond*，意思是，在你完全确定成功之前，不要庆祝。

根据 Karlsson 的说法，他正在测试 Firefox，并注意到浏览器在 macOS 上会接受格式不正确的主机名。具体来说，URL *http://example.com..* 会加载 *example.com*，但会在 host header 中发送 *example.com..*。然后他尝试访问 *http://example.com...evil.com*，并得到了相同的结果。他知道这意味着他可以绕过 SOP，因为 Flash 会将 *http://example.com..[evil.com](http://evil.com)* 视为属于 *\*.evil.com* 域名。他查看了 Alexa 的前 10,000 个网站，发现 7% 的网站是可以被利用的，包括 *[yahoo.com](http://yahoo.com)*。

他写出了漏洞报告，但后来决定和同事再次确认这个问题。他们使用另一台计算机重现了这个漏洞。他更新了 Firefox，仍然确认了漏洞存在。他在推特上发布了关于这个 bug 的预告。然后他意识到自己的错误。他没有更新操作系统。更新后，bug 消失了。显然，他注意到的问题在六个月前就已经被报告并修复了。

Karlsson 是最优秀的漏洞赏金黑客之一，但即便是他，也差点犯了一个令人尴尬的错误。确保在报告漏洞之前确认清楚它。以为自己发现了一个重大漏洞，结果发现自己误解了应用程序并提交了无效报告，真是令人失望。

### 你的声誉

每当你考虑提交一个 bug 时，先退一步问问自己，是否会为公开披露这个报告而感到自豪。

当我开始进行黑客攻防时，我提交了很多报告，因为我想要帮助他人并进入排行榜。但实际上，我只是在浪费大家的时间，提交了很多无效的报告。不要犯同样的错误。

你可能不在乎自己的声誉，或者你可能认为公司能从收到的报告中筛选出有意义的漏洞。但在所有的漏洞悬赏平台上，你的统计数据很重要。这些数据会被追踪，且公司会用它们来决定是否邀请你参加私密项目。这样的项目通常对黑客来说更有利可图，因为参与的黑客更少，意味着竞争更小。

这是我经验中的一个例子：我受邀参加了一个私密的项目，并在一天之内发现了八个漏洞。但那天晚上，我向另一个项目提交了一份报告，结果被标记为 N/A。这份报告降低了我在 HackerOne 上的统计数据。第二天，当我去向另一个私密项目报告一个新漏洞时，得知我的统计数据太低，必须等待 30 天才能报告我发现的漏洞。等待这 30 天并不好受。我很幸运——没有其他人发现这个漏洞。但我犯下的错误让我学会了在所有平台上重视自己的声誉。

### 尊重公司

虽然很容易忽视，但并不是所有公司都有资源立即响应报告或整合漏洞修复。写报告或跟进时，请记住公司的立场。

当一家公司启动一个新的公开漏洞悬赏项目时，它将会收到大量需要筛选的报告。在你开始请求更新之前，给公司一些时间来回复你。一些公司政策包括服务级别协议，并承诺在给定的时间范围内回应报告。抑制你的兴奋，考虑公司的工作负担。对于新提交的报告，预计会在五个工作日内收到回应。之后，你通常可以礼貌地发布评论，确认报告的状态。大多数情况下，公司会回应并告知你当前的情况。如果没有回应，你应该再给他们几天时间，然后再尝试或将问题升级到平台。

另一方面，如果公司已经确认报告中漏洞的优先级，你可以询问修复的预期时间表以及是否会获得进度更新。你也可以问是否可以在一两个月后再次确认进展。开放的沟通是你希望继续合作的项目的一个标志；如果公司没有回应，最好转到另一个项目。

在写这本书时，我有幸与 Adam Bacchus 进行过交流，当时他担任 HackerOne 的首席赏金官（自 2019 年 4 月起，他已回到 Google，成为 Google Play 奖励计划的一部分）。Bacchus 的过往经验包括在 Snapchat 工作，致力于弥合安全和软件工程之间的关系。他还曾在 Google 的漏洞管理团队工作，帮助运营 Google 漏洞奖励计划。

Bacchus 帮助我理解了分派人员在运营赏金计划过程中遇到的问题：

+   尽管漏洞赏金计划不断改进，但它们仍然会收到许多无效报告，尤其是当它们是公开计划时。这被称为*噪音*。报告中的噪音会增加分派人员的工作量，从而可能延迟他们对有效报告的回应。

+   赏金计划必须找到一种方法，在漏洞修复和已有的开发任务之间找到平衡。当程序收到大量报告或多个不同的人报告同一漏洞时，情况会变得更加复杂。优先修复低或中等严重性的漏洞是一个特别具有挑战性的任务。

+   在复杂系统中验证报告需要时间。因此，编写清晰的描述和重现步骤非常重要。当一个分派人员需要向你请求额外的信息来验证和重现一个漏洞时，这会延迟漏洞修复并影响你的奖励支付。

+   并非所有公司都有专门的安全人员来运营全职的赏金计划。小公司可能会让员工在管理赏金计划和其他开发职责之间分配时间。因此，某些公司可能需要更长时间来响应报告和跟踪漏洞修复。

+   修复漏洞需要时间，特别是当公司需要经过完整的开发生命周期时。为了集成修复，公司可能需要经历某些步骤，如调试、编写测试和阶段性部署。当系统中发现低影响漏洞时，这些过程会使修复进程更加缓慢，尤其是当这些系统是客户依赖的。程序可能需要比你预期的更长时间来确定合适的修复方案。但在这种情况下，清晰的沟通和相互尊重非常重要。如果你担心能否快速获得报酬，可以关注那些在分派阶段就支付奖励的程序。

+   漏洞赏金计划希望黑客能够继续回归。这是因为，正如 HackerOne 所描述的那样，一个黑客报告的漏洞严重性通常随着该黑客提交给同一计划的漏洞数量增加而加剧。这被称为*深入挖掘*一个计划。

+   不良的媒体报道是真实存在的。计划总是面临着错误地忽略漏洞、修复耗时过长或奖励过低等风险。此外，一些黑客会在社交媒体和传统媒体上公开指出程序问题，特别是当他们认为上述任何情况发生时。这些风险会影响分派人员的工作方式以及他们与黑客建立的关系。

Bacchus 分享了这些见解，旨在使漏洞奖励过程更具人性化。我在不同的项目中经历了各种各样的情况，就像他所描述的那样。在编写报告时，记住黑客和项目需要共同理解这些挑战，才能改善双方的局面。

### 奖励上诉

如果你向一家支付奖励的公司提交了漏洞，尊重其对奖励金额的决定，但不要害怕与公司沟通。在 Quora 上，HackerOne 的联合创始人 Jobert Abma 分享了关于奖励争议的以下内容（*[`www.quora.com/How-do-I-become-a-successful-Bug-bounty-hunter/`](https://www.quora.com/How-do-I-become-a-successful-Bug-bounty-hunter/)*）：

如果你不同意收到的金额，可以讨论为什么你认为应该获得更高的奖励。避免要求额外奖励时没有详细说明原因。作为回报，公司应该尊重你的时间和价值。

礼貌地询问为何报告获得了特定金额是可以的。当我过去这样做时，我通常会使用以下评论：

非常感谢你们的奖励。我真的很感激。我很好奇这个金额是如何确定的。我原本期待$*X*，但你们给了$*Y*。我认为这个漏洞可能被用来*［利用 Z］*，这可能对你们的*［系统/用户］*产生重大影响。我希望你能帮助我理解，以便我将来能更好地专注于对你们最重要的事情。

作为回应，公司做出了以下行动：

+   解释说报告的影响比我想的要小，但金额没有变化

+   同意他们误解了我的报告，并增加了金额

+   同意他们错误分类了我的报告，并在修正后增加了金额

如果一家公司披露了涉及相同类型漏洞或具有类似影响的报告，并且与您的奖励预期一致，你也可以在后续的沟通中引用该报告来解释你的期望。但我建议你只引用同一家公司中的报告。不要引用其他公司更高的奖励，因为公司 A 的奖励并不一定能为公司 B 的奖励设立标准。

### 总结

学会写一份出色的报告并有效沟通你的发现，是成功的漏洞奖励黑客必备的技能。阅读项目政策至关重要，确定报告中要包含的细节也是如此。一旦发现漏洞，确认你的发现是至关重要的，以避免提交无效报告。即使是像 Mathias Karlsson 这样的优秀黑客，也会有意识地避免犯错。

一旦你提交了报告，就要体谅那些评估潜在漏洞的人。在与公司合作时，牢记 Adam Bacchus 的见解。如果你已经收到了奖励金，但觉得这个金额不合适，最好进行一次礼貌的对话，而不是在 Twitter 上发泄。

你写的所有报告都会影响你在漏洞悬赏平台上的声誉。保护好自己的声誉非常重要，因为平台会根据你的统计数据来决定是否邀请你参与私人项目，在这些项目中，你可能能够获得更高的黑客投资回报。
