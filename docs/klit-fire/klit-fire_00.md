> 我们建造计算机系统的方式就像我们建造城市的方式：随着时间推移，没有规划，建立在废墟之上。
> 
> ——艾伦·厄尔曼

# 前言

1975 年，著名物理学家大卫·L·古德斯坦（David L. Goodstein）出版了他的著作《物质的状态》（*States of Matter*），并在书中写道：

> *路德维希·玻尔兹曼（Ludwig Boltzmann），他一生大部分时间都在研究统计力学，于 1906 年自杀。保罗·厄恩费斯特（Paul Ehrenfest），继续这项工作的人，于 1933 年也以类似的方式去世。现在轮到我们来研究统计力学了。*

这是一本关于如何运行遗留系统现代化的书，许多软件工程师认为这是一个缓慢的职业自杀，甚至是字面意义上的开篇。此书适用于在大型组织中工作、处理老化技术的人，但它同样适用于那些在仍在构建自己技术的小型创业公司工作的人。恢复遗留系统的运营卓越，归根结底是为了恢复一个迭代开发过程，使得这些系统随着时间的推移能够得到维护和演进。

这本书中的大多数建议同样适用于构建新技术，但遗留系统在我心中占有特殊的地位。我职业生涯的最初十年，我环游世界寻找应用人类学的工作，同时也在空闲时间编程。我会编程，因为我的父亲是一名计算机程序员，我在一个充满计算机的家庭中长大，那时这还很罕见。

我从未成为自己想象中的那种勇敢的国际援助工作者，但我最终找到了将应用人类学运用于遗留系统现代化的工作。像陶器碎片一样，旧计算机程序是人类思想的遗物。通过查看代码，你能了解一个组织过去的很多信息。

要理解遗留系统，你必须能够定义原始需求是如何确定的。你需要挖掘整个思维过程，并弄清楚当选项发生变化时，权衡取舍的情况是什么样的。

仅仅因为老旧并不足以让某个事物成为遗留系统。*遗留技术*这一词背后的潜台词是它也是糟糕的，可能几乎不能运行，但遗留技术之所以存在，仅仅因为它是成功的。这些旧程序或许不如以前高效，但没有被使用的技术是不可能存活几十年的。

我们已经过了所有技术对话和知识分享仅仅围绕构建新事物的阶段。我们有太多的旧事物了。我父辈那一代写了很多程序，每年他们都会对自己的工作有多少仍然存在、仍在某个生产系统中运行感到震惊。我们这一代编写的程序 exponentially 更多，感染了生活的方方面面，嵌入了计算机芯片和一些运行指令。我们将会感到同样的震惊，当那些系统在 30 年、40 年或 50 年后仍然存在时。

因为我们没有讨论如何现代化旧技术，组织一次又一次地陷入相同的陷阱。失败是可预测的，因为许多软件工程师认为关于现代化遗留技术的讨论与他们的职业无关。有些人甚至会惊讶地发现，COBOL 仍然支撑着金融行业的运作，大部分网站仍然是用 PHP 编写的，或者人们仍然在寻找具备 ActionScript、Flash 和 Visual Basic 技能的软件工程师。

失败是如此可预测，以至于在做这项工作一两年后，我发现只要了解一些关于所部署技术的基本信息，我就能预测出组织面临的一系列问题，以及这些问题的解决方案如何失败。偶尔，我会为了逗乐其他工程师并推动我的职业发展，表演这个“魔术”，其中一次是在*纽约时报*的面试中。

当我离开政府部门回到私营部门时，我发现那些曾经对旧系统有效的技术，实际上对相对较新的系统也非常有效。我加入了一家成立六年的公司，做遗留技术现代化工作。然后，我又加入了一家成立仅六个月的公司，依旧做遗留技术现代化工作。有一次，我不禁抱怨对我的老板说：“为什么我在一个三个月大的系统上还要做遗留技术现代化？”他反驳道：“活该，三个月前你没来。”

尽管如此，将所有系统都视作遗留系统来维护几乎没有什么坏处。建立新系统很容易，但一旦系统建立，重新思考它们就变得困难。遗留技术现代化之所以困难，并不是因为技术上难——问题和解决方案通常是可以理解的——而是现代化过程中涉及到的人际因素让人感到棘手。要获得足够的时间和资源来实施变更，培养对变革的需求并保持这一势头，管理跨部门的沟通，尤其是在有许多其他系统与之连接或依赖的情况下——这些都很难。

然而，作为一个行业，我们并没有讨论这些挑战。我们假设太阳、月亮、星星和董事会会围绕正确的技术答案自动重新配置，仅仅因为它是正确的技术答案。我们震惊地发现，大多数人其实并不关心一项技术有多健康，只要它能够以合理的精度在不让他们失去耐心的时间内完成他们需要的功能。在技术领域，“足够好”是最重要的。

在尝试解释如何接近遗留系统现代化时，我首先回顾并探讨了技术如何随着时间变化。第一章和第二章都探讨了计算趋势和最佳实践的机制：我们是如何决定今天被视为遗留的技术的，以及我们能从这一过程中学到什么，以指导我们的现代化计划？

在第三章中，我讨论了让组织觉得需要现代化的三大问题：技术债务、性能问题和系统稳定性。我举了一个真实（虽然匿名）的系统的每种问题的例子，并说明了如何将现代化计划组织起来。

第四章讨论了为什么遗留系统现代化如此困难以及为何如此频繁失败。我分析了跨平台兼容性的大误区，以及抽象在处理我们认为容易或困难的事物时的作用。

第五章谈到了任何遗留系统现代化中最关键的特性：动力。你如何获得动力，并且如何保持它？我概述了一系列条件——有些是动力杀手，有些是动力促进者。

第六章讨论了如何进入一个已经开始的现代化项目，并解决可能阻碍其进展的最常见问题。

第七章尽可能全面地概述了设计思维，以及我们如何利用设计来引导并最终改善技术对话的结果。

第八章完全讲述了打破现状以及不惧失败的价值。我探讨了混乱测试如何补充遗留系统现代化，并探讨如何与一个认为你应该故意打破事物的建议可能有些过于激进的组织合作。

第九章讨论了为什么成功不像你想象的那样显而易见或自明，以及如何定义标准来判断一个项目何时完成。

最后，第十章提出了避免再次对同一个系统进行现代化的策略。你如何知道你的软件是否可维护？如果不可维护，你能做些什么？

本书的语言是经过深思熟虑的。我使用了*组织*而不是*公司*或*企业*这个词。我在这个领域的大部分工作经验都来自政府和非营利组织，但遗留问题无处不在。需要构建和维护良好技术的组织不仅限于私营部门。例如，美国联邦政府是世界上最大的技术生产者之一。关于遗留系统的讨论跨越了商业、政府、医院和非营利组织。因此，当我提到“业务”方面的组织时，我是指工程团队为支持其使命而构建技术的部分。一个组织不一定要盈利，才会有业务方面。

在整本书中，我使用*系统*一词来指代一组为完成共同任务而协同工作的技术。系统是一个在技术讨论中颇具争议的词，因为似乎永远找不到一群工程师能达成一致来定义它的边界。不过，就我而言，这种模糊性是有益的。它使我可以更广泛地讨论传统系统的现代化问题。

为了描述系统的各个部分，我经常使用*组件*或偶尔使用*服务*这个词。虽然本书中的许多技术适用于任何类型的技术，但示例和讨论特别倾向于软件工程和基于网络的开发。我不可能写一本关于传统系统的书而不提到主机、数据中心和旧操作系统，但我的大部分经验是将这些系统升级为更适合互联网的选项，这本书也反映了这一点。我期待着拥有其他背景的技术专家通过文章补充本书的内容，讨论我的建议是否同样适用于他们。

我真诚的希望，在你阅读本书时，无论你的技术多么陈旧，都能找到对自己技术项目的启发。我尽力将尽可能多的资源、练习和框架融入这本书，力求做到尽可能详细，并尽可能通过真实的故事来支撑我的论断。

我们正迎来传统系统的临界点。构建这些系统的最早一代人正在逐渐离世，而我们在这些陈旧、基本没有文档记录并且无人维护的计算机程序上不断叠加更多社会层面。虽然我不认为社会会因此崩溃，但对于愿意加入其中的人来说，仍有很多有趣且有意义的工作。
