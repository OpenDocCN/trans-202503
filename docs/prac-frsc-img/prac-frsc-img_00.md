## 前言

欢迎阅读 *实用法医影像：使用 Linux 工具保障数字证据*。本书涵盖了一系列用于获取和管理数字证据磁盘镜像的命令行技术。获取磁盘镜像是保存数字法医证据、为事后检验和分析做准备的第一步。

### 我为何写这本书

目前市场上有许多数字法医书籍。然而，法医获取和证据保存的重要性往往得到的关注较少。通常，这个话题只在较大的书籍中的小章节或子章节中简要介绍。我认为，获取和证据保存的主题足够庞大，值得单独成书，本书正是填补了这一领域的空白。

写这本书的另一个动机是我希望以某种方式回馈社区。在数字法医实验室工作了十多年，定期使用开源工具进行各种任务（除了其他商业工具）后，我想为我的同事和其他专业人士提供额外的资源。

第三个动机是保存法医证据在私营部门日益重要的现实。调查不当行为、欺诈、恶意软件、网络攻击和其他滥用行为在私营行业变得越来越普遍。然而，关于获取和保存证据所需步骤的强调往往缺乏。执法机构需要适当获取和保存的证据来起诉犯罪分子。涉及电子发现的民事案件可能要求正确的磁盘镜像获取和保存。大型组织中管理人力资源争议、政策违规和举报事件的内部团队也能通过遵循公认的证据收集和保存程序获益。

### 本书的不同之处

本书是一本技术性的操作指南。它解释了如何使用 Linux 作为执行计算机法医的基础平台，特别是在存储介质的法医影像获取和证据保存方面。我包括了通过使用免费或开源计算机法医工具来展示知名法医方法的示例，用于获取各种目标介质。

与涵盖广泛应用和操作系统分析主题的 Linux 法医书籍不同，本书专注于计算机法医学中的一个特定领域：*法医获取*，也称为 *法医影像*，即存储介质的获取。这包括来自各种存储介质的数字证据的准备、获取、保存和管理。存储介质的准确获取正是使这一过程成为“法医”的原因。

除了涵盖开源工具，本书还包括了几个专有命令行工具的示例，这些工具是免费的，但并非开源。

我讨论了一些较新的硬件话题，这些话题尚未被其他取证书籍涵盖。例如，NVME 和 SATA Express，4K 原生扇区驱动器，混合 SSD、SAS、UASP/USB3x、Thunderbolt 等。对于其中的一些，在数字取证中管理起来比较简单，而其他一些则更具挑战性。

我还介绍了一种新的取证技术，它使用 SquashFS 压缩文件系统作为简单实用的取证证据容器。在本书中，我提供了 sfsimage shell 脚本，能够将证据保存到 SquashFS 取证容器中。

### 为什么使用命令行？

为什么一本基于命令行的书今天仍然有用或相关？计算机命令行自 1960 年代的电传打字机时代就已经存在，至今已有超过半个世纪的历史。在计算机领域，虽然年龄有时被视为过时的标志，但它也可以是成熟和可靠的标志，这正是 Linux/Unix 命令行的特点。即使是微软也认识到命令行的价值和力量，通过引入和推广 PowerShell 作为 DOS 提示符的替代方案。

有许多原因解释了命令行为何多年来仍然保持其流行性，并且继续与本书讨论的话题相关。以下是一些例子：

• **更简便的脚本编写与自动化可能性：** 图形用户界面（GUI）是为人类使用设计的，而命令行可以由人类或机器使用。这使得命令行在脚本编写和工作自动化方面特别有用。

• **更好地理解底层工作原理：** 图形工具通常只是命令行工具的前端。学习命令行工具有助于你理解在使用图形界面工具时底层到底发生了什么。

• **灵活性和高效性：** 当你在命令行上执行某些任务时，你拥有更多的灵活性、控制力和力量。例如，管道和重定向使你能够将多个步骤合并为一个命令行。

• **Unix 哲学：** 传统的 Unix 哲学是创建简单的工具，每个工具只做一件事且做得好，而大型 GUI 程序则将丰富复杂的功能集成到一个庞大的单体程序中。

• **远程访问：** 使用 ssh 远程执行命令行操作既安全又容易。在某些情况下，远程 shell 访问是唯一的选择，尤其是当你在处理虚拟或基于云的服务器，或位于其他城市或国家的系统时。

• **无头服务器：** 在发生故障的 Unix 和 Linux 服务器上，命令行可能是唯一的选择，因为可能没有安装图形界面（GUI）。

• **嵌入式系统：** 嵌入式 Unix 和 Linux 系统（如 Raspberry Pi、Beagleboard 或其他物联网设备）的日益流行，可能仅提供命令行界面。

• **知识投资：** 与 GUI 工具相比，命令行工具的变化相对较少。如果你投资时间学习使用命令行工具，那么在命令更新或新功能添加时，你无需重新学习一切。

• **个人偏好：** 一些技术人员仅仅因为喜欢命令行而非 GUI，如果有选择，他们会选择使用命令行。

本书为你提供了一个命令行指南，用于执行数字法医获取，适用于调查和事件响应活动。它不涉及 GUI 等效工具或前端。

### 目标读者和前提条件

我写这本书时是有特定读者群体的。我在写许多章节时有一些预期，并且做出了一些假设。

#### *谁应该阅读本书？*

本书主要惠及两类人群。首先，它帮助有经验的法医调查员提升他们的 Linux 命令行技能，以便执行法医获取工作。其次，它对那些想要学习数字法医获取技术的经验丰富的 Unix 和 Linux 管理员有帮助。

本书面向越来越多的法医从业者，这些从业者来自多个领域，包括事件响应团队；大公司中的计算机法医调查员；来自法律、审计和咨询公司的法医和电子发现技术人员；以及来自执法机构的传统法医从业者。

本书结束时，你应该对可用于进行存储介质法医获取和法医图像管理的命令行工具 landscape 有一个全面且完整的认识。

#### *前提知识*

本书假定你具备操作系统的工作知识，特别是 Unix 和 Linux shell 环境。本书中的示例广泛使用 Bash shell。你还应该了解如何运行命令行程序，以及如何在程序之间进行基本的管道传输和重定向。

此外，你应该具备基本的数字取证原理知识，包括写入阻止技术、按扇区获取和使用加密哈希保持证据完整性。当应用本书中的示例时，这些基础知识是默认具备的。

#### *预安装平台和软件*

你应该能够访问一个正常运行的 Linux 平台，并且已经安装了相关工具。本书不涉及如何查找、下载、编译或安装各种工具。如果你有一台较新的机器（在本书出版日期的一年内）并且安装了较新的 Linux 发行版，那么示例应该没有问题。一些工具不是标准 Linux 发行版的一部分，但可以很容易地在 github 上找到或通过搜索找到。

### 本书结构

本书不是按照时间顺序列出的步骤，而更像是一本任务手册。然而，本书确实遵循一个逻辑进程，从平台搭建、规划与准备、采集到采集后活动。一般来说，本书设计为一本参考书，因此你不必从头到尾阅读它。某些章节假设你具备一定的前置知识和理解，相关的交叉引用也已提供。

• **第零章** 是数字取证的概述。我还涵盖了该领域的历史和发展，提到了塑造其方向的重要事件。我特别强调了为产生可以在法庭上使用的数字证据而需要的标准。本书力求具有国际性，并独立于地区法律管辖区。这一点在今天尤为重要，因为越来越多的刑事调查跨越国家边界，并涉及多个管辖区。此外，由于私营部门法医能力的提高，本书对私营法医实验室尤其是全球公司中的实验室具有重要参考价值。

• **第一章** 提供了大容量存储介质、连接器和接口的技术概述，以及用于访问介质的命令和协议。它涵盖了典型法医调查员在专业法医实验室环境中会遇到的技术。我努力帮助你清晰理解不同存储介质接口、协议隧道、桥接，以及存储介质如何与主机系统连接并交互。

• **第二章** 提供了将 Linux 作为法医采集平台的概述。它简要介绍了使用 Linux 和开源软件的优缺点。它描述了 Linux 内核如何识别并处理连接到系统的新设备，以及如何访问这些设备。本章还概述了 Linux 发行版和 Shell 执行。它还解释了管道和重定向的使用，这在本书中是一个重要的概念。

• **第三章** 介绍了在该领域常用的各种原始和法医格式。这些格式是获取存储介质的数字“证据袋”。本章解释了原始镜像，描述了商业法医格式，如 EnCase 和 FTK，并涵盖了研究社区使用的格式，如 AFF。它还介绍了一种基于 SquashFS 的简单法医证据容器以及管理该容器的工具。

• **第四章** 是本书的一个过渡点，离开理论部分，进入更加实践和程序化的内容。它首先介绍了如何维护日志和审计追踪，以及保存命令数据以供正式的法医报告使用。它涵盖了法医调查员经常面临的各种规划和后勤问题。最后，本章讨论了如何建立一个法医安全、写入阻止的工作环境，为实际的获取过程做好准备。

• **第五章** 讲解如何将嫌疑磁盘连接到获取主机并收集磁盘的数据（如 ATA、SMART 等）。在这一阶段，去除了如 HPA 和 DCO 之类的媒体访问限制，使得锁定和自加密的磁盘可以访问。本章还涉及一些特殊主题，如 Apple 目标磁盘模式。此时，磁盘已准备好，可以执行获取命令。

• **第六章** 执行数据获取，演示了使用开源和专有工具的多种法医获取方式。重点是在获取过程中使用哈希值、签名和时间戳服务来保护证据。本章还讨论了处理坏扇区和错误的各种情况，以及如何通过网络进行远程获取。特殊主题包括磁带和 RAID 系统的获取。

• **第七章** 重点讲解了如何管理获取的磁盘镜像。本章假设法医图像已经成功创建，并描述了典型的后期处理任务。这些任务包括压缩、拆分和加密图像；在法医格式之间转换；克隆或复制图像；将图像传输给其他方；以及为长期存储准备图像。本章最后讨论了安全数据销毁的部分内容。

• **第八章** 涵盖了一些特殊任务，您可以在获取数据后为考试做准备。这些任务包括通过循环设备访问图像、访问虚拟机镜像以及访问操作系统加密的镜像（如 BitLocker、FileVault、TrueCrypt/VeraCrypt 等）。本章还涉及访问其他虚拟磁盘容器。这些技术使您能够对图像进行法医分析，并允许您使用常规文件管理器和其他程序安全地浏览文件系统。

• **第九章** 部分进入法医分析领域，演示了从图像中提取数据子集。它包括识别和提取分区（包括已删除的分区）、提取分区间隙、提取松散空间，以及提取磁盘中先前隐藏的区域（DCO 和 HPA）。本章展示了多个数据提取的示例，包括提取单个扇区和块。

每一章可能会描述多个不同的工具，用于执行相同的任务。通常，你会有多个工具可以选择来执行相同的任务，具体使用哪一个工具取决于情况，有时候某个工具可能比另一个更有用。在这种情况下，我会讨论每个工具的优缺点。

每一章中的各个部分大致遵循相同的结构。标题提供了该主题的高层次描述。引言段落描述了该部分的动机，并解释了为什么这一特定任务对调查、数字取证或事件响应有用。在许多情况下，动机由法律或行业公认的标准驱动。了解并理解这些标准非常重要，因为它们支持所做工作的取证有效性。在必要时，我会提供工具源代码、额外信息或其他相关文章的参考。

在介绍或演示新工具之前，我会提供一段描述工具功能或目的的段落，并阐明它与数字取证的相关性。在某些情况下，工具的历史可能对你有兴趣，因此我也会包括这部分内容。

在描述任务和工具之后，你将看到一个或多个命令行示例以及命令输出（以等宽字体块显示）。一个命令可能会重复，以展示不同的变体或扩展使用形式。每个命令示例后会跟随一段描述，解释正在执行的命令及其输出结果。

最后一段可能包括潜在的注意事项、警告、风险以及可能在数字取证调查中遇到的常见问题或错误。

### 本书的范围

本书聚焦于常见存储介质的取证采集及其保存证据所需的步骤。虽然书中展示了一些初步筛选和分析工作，但一般来说，应用程序和操作系统数据的取证分析被认为超出了本书的范围。

本书的范围之外还有一些领域，包括从传统存储介质以外的领域进行数据采集，例如网络取证采集、从实时系统采集内存、云数据采集等。

在多个地方，我提到了企业级存储介质和传统存储介质，但没有提供实际示例。这些介质在取证实验室环境中较少见。然而，许多展示的方法通常也适用于企业级或传统存储硬件。

专有设备的获取超出了本书的范围。使用本书中展示的工具和技术，可能能够获取最新一代的手机、平板电脑或物联网设备（如果它们在 Linux 内核中作为块设备运行），但我不会明确介绍这些设备。

### 约定与格式

代码、命令和命令输出的示例以等宽字体或固定宽度字体显示，类似于你在计算机终端屏幕上看到的样式。在某些地方，可能会删除或截断不相关的命令输出，并用省略号（...）代替，当某些行过长超出书籍的边距时，它们会被换行并缩进。

无需根权限即可运行的命令使用`$`提示符。通常需要以 root 身份运行的特权命令以`#`为前缀。为了简洁起见，sudo 或其他权限提升操作通常不显示。某些章节提供了以非 root 用户身份运行命令过程的更多信息。

在计算机书籍行业中，通常会将代码块和命令输出中的时间戳更改为发布后的未来某个时刻，以使内容看起来更新。我认为，写一本关于保持证据完整性的书，然后再通过将时间戳提前日期来篡改书中的证据并不合适。本书中所有的命令输出都反映了实际测试和研究中的输出，包括原始日期和时间戳。除了删除不太相关的部分（使用`...`）和去除多余的空行外，我保留了命令输出的原始内容。

本书末尾没有提供参考书目。所有参考文献都作为脚注列出，位于引用来源的页面底部。

调查员或检查员的工作站被称为*采集主机*或*检查主机*。正在进行采集的磁盘和镜像被称为*目标磁盘*、*嫌疑磁盘*或*证据磁盘*。

本书中使用了多个互换的术语。*磁盘*、*驱动器*、*介质*和*存储*在泛指时通常可以互换使用。*法医调查员*、*检查员*和*分析员*在本书中被用于指代使用检查主机进行各种法医任务的人员（即你）。*镜像*、*采集*和*获取*是可以互换使用的，但故意排除了*复制*一词，以避免与法医背景外的普通复制产生混淆。
