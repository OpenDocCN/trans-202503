## 前言

![image](img/common01.jpg)

如果你从事安全工作，可能会发现你比以往更频繁地使用数据科学，即使你可能没有意识到这一点。例如，你的防病毒软件使用数据科学算法来检测恶意软件。你的防火墙供应商可能使用数据科学算法来检测可疑的网络活动。你的安全信息和事件管理（SIEM）软件可能也使用数据科学来识别数据中的可疑趋势。无论是否显而易见，整个安全行业正朝着将更多数据科学融入安全产品的方向发展。

高级 IT 安全专业人员正将自己的定制机器学习算法融入工作流程中。例如，在最近的会议演讲和新闻文章中，Target、Mastercard 和 Wells Fargo 的安全分析师都描述了开发定制数据科学技术，并将其作为安全工作流程的一部分。¹ 如果你还没有加入数据科学的行列，现在正是升级技能、将数据科学融入你的安全实践的最佳时机。

### 什么是数据科学？

*数据科学* 是一组不断发展的算法工具，允许我们通过统计学、数学和精美的统计数据可视化来理解数据并做出预测。虽然有更为具体的定义，但一般来说，数据科学包含三个子领域：机器学习、数据挖掘和数据可视化。

在安全领域，机器学习算法通过训练数据来学习检测新威胁。这些方法已被证明能有效检测那些传统检测技术（如签名）难以捕捉的恶意软件。数据挖掘算法会从安全数据中搜索有趣的模式（如威胁行为者之间的关系），这些模式可能帮助我们识别针对我们组织的攻击活动。最后，数据可视化将枯燥的表格数据转化为图形格式，使人们更容易发现有趣和可疑的趋势。本书将深入探讨这三个领域，并展示如何应用它们。

### 数据科学为何对安全至关重要

数据科学对网络安全的未来至关重要，原因有三：首先，安全是*与数据密切相关的*。当我们试图检测网络威胁时，我们分析的是文件、日志、网络包和其他数据形式。传统上，安全专业人员并没有使用数据科学技术基于这些数据源进行检测。相反，他们使用文件哈希、定制编写的规则（如签名）和手动定义的启发式方法。尽管这些技术各有优点，但它们需要为每种类型的攻击手工制作技术，导致需要大量人工工作，难以跟上不断变化的网络威胁格局。近年来，数据科学技术已成为增强我们检测威胁能力的关键。

其次，数据科学对网络安全的重要性在于，互联网的网络攻击数量已急剧增加。以恶意软件地下世界的增长为例，2008 年，安全社区已知的独特恶意软件可执行文件约为 100 万个。而到了 2012 年，这一数字增至 1 亿个。到 2018 年本书出版时，安全社区已知的恶意可执行文件超过 7 亿个（* [`www.av-test.org/en/statistics/malware/`](https://www.av-test.org/en/statistics/malware/)*），这一数字可能还会继续增长。

由于恶意软件的数量庞大，手动检测技术（如签名）已不再是检测所有网络攻击的合理方法。因为数据科学技术自动化了大量检测网络攻击的工作，并大大减少了检测此类攻击所需的内存，它们在防御网络和用户免受网络威胁的过程中具有巨大的潜力。

最后，数据科学对安全至关重要，因为它是*本十年的*技术趋势，无论是在安全行业内外，它都可能在下一个十年内继续占主导地位。事实上，您可能已经在各个领域看到了数据科学的应用——如个人语音助手（亚马逊 Echo、Siri 和 Google Home）、自动驾驶汽车、广告推荐系统、网络搜索引擎、医学图像分析系统以及健身追踪应用等。

我们可以预见，数据科学驱动的系统将在法律服务、教育等领域产生重大影响。由于数据科学已成为技术领域的关键推动力，大学、大型公司（如谷歌、Facebook、微软和 IBM）以及政府正在投资数十亿美元来改进数据科学工具。得益于这些投资，数据科学工具将变得更加熟练于解决复杂的攻击检测问题。

### 将数据科学应用于恶意软件

本书聚焦于数据科学在*恶意软件*领域的应用，我们将恶意软件定义为具有恶意意图编写的可执行程序，因为恶意软件仍然是威胁行为者在网络上获取立足点并随后实现其目标的主要手段。例如，在近年来出现的勒索病毒灾难中，攻击者通常会通过发送带有恶意附件的电子邮件，下载勒索病毒可执行文件（恶意软件）到用户的计算机上，这些恶意软件会加密用户的数据并要求用户支付赎金以解密数据。尽管为政府工作的一些技术高超的攻击者有时会避免使用恶意软件，以躲避检测系统的侦测，但恶意软件仍然是如今网络攻击中的主要技术手段。

本书专注于安全数据科学的一个具体应用，而不是广泛覆盖安全数据科学，旨在更深入地展示数据科学技术如何应用于重大安全问题。通过理解恶意软件数据科学，你将更好地将数据科学应用于安全的其他领域，如检测网络攻击、钓鱼邮件或可疑用户行为。实际上，本书中你将学到的几乎所有技术都适用于构建数据科学检测和情报系统，而不仅限于恶意软件。

### 谁应该阅读本书？

本书面向那些对如何将数据科学应用于计算机安全问题感兴趣的安全专业人士。如果计算机安全*和*数据科学对你来说是全新的，你可能需要查阅一些术语来帮助自己理解背景，但你仍然可以成功阅读本书。如果你只对数据科学感兴趣，而不关心安全，本书可能不适合你。

### 关于本书

本书的第一部分由三章组成，涵盖了理解本书后续讨论的恶意软件数据科学技术所需的基础逆向工程概念。如果你是恶意软件领域的新手，建议先阅读前三章。如果你已经是恶意软件逆向工程的老手，可以跳过这些章节。

+   **第一章：基础静态恶意软件分析** 涵盖了静态分析技术，帮助分析恶意软件文件并发现它们如何在计算机上实现恶意目的。

+   **第二章：超越基础静态分析：x86 反汇编** 简要概述了 x86 汇编语言以及如何反汇编和逆向工程恶意软件。

+   **第三章：动态分析简要介绍** 通过讨论动态分析来结束本书的逆向工程部分，动态分析涉及在受控环境中运行恶意软件，以了解其行为。

本书的接下来的两章，第四章和第五章，重点介绍恶意软件关系分析，涉及通过比较一系列恶意软件的相似性和差异性，识别针对你所在组织的恶意软件攻击活动，如由一群网络犯罪分子控制的勒索软件攻击，或是针对你组织的精心策划的定向攻击。这些独立的章节适合那些不仅对检测恶意软件感兴趣，还希望提取有价值的威胁情报，了解谁在攻击其网络的读者。如果你对威胁情报不太感兴趣，而更关注数据科学驱动的恶意软件检测，你可以跳过这些章节。

+   **第四章：使用恶意软件网络识别攻击活动** 向你展示如何基于共享属性（如恶意软件程序联系的主机名）分析和可视化恶意软件。

+   **第五章：共享代码分析** 解释了如何识别和可视化恶意软件样本之间的共享代码关系，这有助于你判断一组恶意软件样本是来自一个还是多个犯罪团伙。

接下来的四章涵盖了理解、应用和实现基于机器学习的恶意软件检测系统所需的所有知识。这些章节还为将机器学习应用于其他安全场景提供了基础。

+   **第六章：理解基于机器学习的恶意软件检测器** 是对基本机器学习概念的易于理解、直观且非数学化的介绍。如果你有机器学习的背景，本章将为你提供一个方便的复习。

+   **第七章：评估恶意软件检测系统** 向你展示了如何使用基本的统计方法评估机器学习系统的准确性，以便选择最佳的检测方法。

+   **第八章：构建机器学习检测器** 介绍了你可以用来构建自己机器学习系统的开源工具，并解释了如何使用它们。

+   **第九章：可视化恶意软件趋势** 讲解了如何使用 Python 可视化恶意软件威胁数据，以揭示攻击活动和趋势，以及如何将数据可视化集成到你日常分析安全数据的工作流中。

最后三章介绍了深度学习，这是机器学习的一个高级领域，涉及更多的数学知识。深度学习是安全数据科学中的一个热门发展领域，这些章节提供了足够的内容来帮助你入门。

+   **第十章：深度学习基础** 介绍了深度学习的基本概念。

+   **第十一章：使用 Keras 构建神经网络恶意软件检测器** 解释了如何使用 Python 和开源工具实现基于深度学习的恶意软件检测系统。

+   **第十二章：成为数据科学家** 通过分享成为数据科学家的不同路径和成功所需的品质来总结本书。

+   **附录：数据集和工具概览** 介绍了本书附带的数据和示例工具实现。

### 如何使用示例代码和数据

没有示例代码供你自己动手尝试和扩展的编程书籍是不完整的。本书的每一章都有配套的示例代码和数据，并在附录中进行了详细描述。所有代码都针对 Linux 环境中的 Python 2.7 进行开发。要访问代码和数据，你可以下载一个包含代码、数据和支持的开源工具都已设置好的 VirtualBox Linux 虚拟机，并在你自己的 VirtualBox 环境中运行它。你可以在*[`www.malwaredatascience.com/`](http://www.malwaredatascience.com/)*下载本书配套的数据，并且你可以在*[`www.virtualbox.org/wiki/Downloads`](https://www.virtualbox.org/wiki/Downloads)*免费下载 VirtualBox。代码已在 Linux 上进行了测试，但如果你更喜欢在 Linux 虚拟机之外的环境中工作，同样的代码应该在 MacOS 上几乎同样有效，在 Windows 机器上效果稍差一些。

如果你更愿意在自己的 Linux 环境中安装代码和数据，你可以在这里下载：*[`www.malwaredatascience.com/`](http://www.malwaredatascience.com/)*。你会在可下载的压缩包中找到每一章的目录，并且在每一章的目录下都有*code/*和*data/*文件夹，里面分别包含对应的代码和数据。代码文件与章节列表或某些小节相对应，具体取决于当前应用的需求。一些代码文件与列表完全相同，而另一些则略微修改过，以便你可以更容易地玩转参数和其他选项。代码目录中包含 pip 的*requirements.txt*文件，其中列出了本章代码运行所依赖的开源库。要在你的机器上安装这些库，只需在每一章的*code/*目录中输入 pip -r requirements.txt。

现在你已经可以访问本书的代码和数据了，接下来让我们开始吧。
