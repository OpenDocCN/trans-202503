## 前言

当初，允许设备连接到网络的技术是大公司和政府的专属。如今，大多数人都在口袋里携带着一台完全联网的计算设备，随着物联网（IoT）的兴起，你可以将冰箱和家庭安防系统等设备加入到这个互联的世界中。因此，这些联网设备的安全性变得越来越重要。虽然你可能不太关心有人泄露你购买多少酸奶的细节，但如果你的智能手机在与冰箱连接的同一网络上被攻击者控制，你可能会丧失所有个人和财务信息。

本书名为 *攻击网络协议*，因为要发现网络连接设备中的安全漏洞，你需要以攻击者的思维方式来寻找和利用这些弱点。网络协议与网络上的其他设备进行通信，而由于这些协议必须暴露在公共网络上，且通常没有其他设备组件那样的严格审查，它们成为了明显的攻击目标。

### **为什么要读这本书？**

许多书籍讨论网络流量捕获，主要用于诊断和基本的网络分析，但它们并未聚焦于捕获协议的安全性方面。本书的与众不同之处在于，它专注于分析自定义协议，以发现安全漏洞。

本书适合那些对分析和攻击网络协议感兴趣，但不知道从哪里开始的人。章节将指导你学习如何捕获网络流量、分析协议以及发现并利用安全漏洞。本书提供了有关网络和网络安全的背景信息，并提供了实际的协议分析示例。

无论你是想攻击网络协议，向应用程序供应商报告安全漏洞，还是仅仅想了解你最新的物联网设备是如何通信的，你都会找到多个感兴趣的主题。

### **本书内容**

本书包含了理论和实践相结合的章节。在实践部分，我开发并提供了一个名为 Canape Core 的网络库，你可以使用它来构建自己的协议分析和利用工具。我还提供了一个示例网络应用 *SuperFunkyChat*，它实现了用户之间的聊天协议。通过跟随各章节的讨论，你可以使用这个示例应用学习协议分析技巧，并攻击样本网络协议。以下是每一章的简要介绍：

**第一章：网络基础**

本章描述了计算机网络的基础知识，特别关注 TCP/IP，它构成了应用层网络协议的基础。后续章节假设你对网络基础有很好的掌握。本章还介绍了我用来建模应用协议的方法。该模型将应用协议分解为灵活的层次，并抽象出复杂的技术细节，使你可以集中精力分析协议中定制的部分。

**第二章：捕获应用流量**

本章介绍了被动和主动捕获网络流量的概念，并且是第一个使用 Canape Core 网络库进行实际任务的章节。

**第三章：网络协议结构**

本章包含网络协议中常见的内部结构的详细信息，例如数字或可读文本的表示。当你分析捕获的网络流量时，可以利用这些知识快速识别常见的结构，从而加速分析过程。

**第四章：高级应用流量捕获**

本章探讨了与第二章中的示例互补的更高级的捕获技术。这些高级捕获技术包括配置网络地址转换（NAT）来重定向感兴趣的流量，并伪造地址解析协议（ARP）。

**第五章：从网络中分析**

本章介绍了使用第二章中描述的被动和主动技术分析捕获网络流量的方法。在本章中，我们将开始使用*SuperFunkyChat*应用程序生成示例流量。

**第六章：应用逆向工程**

本章描述了逆向工程网络连接程序的技术。逆向工程使你能够分析协议，而无需捕获示例流量。这些方法还帮助识别自定义加密或混淆的实现方式，从而更好地分析你捕获的流量。

**第七章：网络协议安全**

本章提供了用于保护网络协议的技术和加密算法的背景信息。在公共网络上传输时，保护网络流量内容免受泄露或篡改对于网络协议的安全至关重要。

**第八章：实现网络协议**

本章解释了如何在自己的代码中实现应用网络协议的技术，以便测试协议的行为并找到安全漏洞。

**第九章：漏洞的根本原因**

本章描述了你在网络协议中可能遇到的常见安全漏洞。当你理解漏洞的根本原因时，你可以更容易地在分析过程中识别它们。

**第十章：寻找和利用安全漏洞**

本章描述了基于第九章中根本原因的安全漏洞查找过程，并演示了多种利用这些漏洞的方法，包括开发自己的 Shell 代码和通过返回导向编程绕过漏洞利用缓解措施。

**附录：网络协议分析工具包**

在附录中，你会找到一些我在进行网络协议分析时常用工具的描述。许多工具也在正文中简要描述。

### **如何使用本书**

如果你想从网络基础知识复习开始，首先阅读第一章。当你熟悉了基础知识后，继续阅读第二章、第三章和第五章，获取捕获网络流量和学习网络协议分析过程的实际经验。

通过掌握网络流量捕获与分析的基本原理，你可以继续阅读第七章到第十章，了解如何在这些协议中寻找和利用安全漏洞。第四章和第六章包含更多关于额外捕获技术和应用逆向工程的高级内容，你可以在阅读完其他章节后根据需要阅读它们。

对于实际示例，你需要安装.NET Core（* [`www.microsoft.com/net/core/`](https://www.microsoft.com/net/core/)*），它是 Microsoft 推出的跨平台版本的.NET 运行时，支持 Windows、Linux 和 macOS。然后，你可以从*[`github.com/tyranid/CANAPE.Core/releases/`](https://github.com/tyranid/CANAPE.Core/releases/)*下载 Canape Core 的发布版本，从*[`github.com/tyranid/ExampleChatApplication/releases/`](https://github.com/tyranid/ExampleChatApplication/releases/)*下载 SuperFunkyChat 的发布版本；这两者都使用.NET Core 作为运行时。每个站点的链接可以在本书资源中找到，网址为*[`www.nostarch.com/networkprotocols/`](https://www.nostarch.com/networkprotocols/)*。

要执行示例的 Canape Core 脚本，你需要使用*CANAPE.Cli*应用程序，该程序将在从 Canape Core Github 仓库下载的发布包中。使用以下命令行执行脚本，将`script.csx`替换为你要执行的脚本名称。

```
dotnet exec CANAPE.Cli.dll script.csx
```

本书的实践章节示例列表以及数据包捕获文件可以在书籍页面的* [`www.nostarch.com/networkprotocols/`](https://www.nostarch.com/networkprotocols/)*上获取。最好在开始之前下载这些示例列表，这样你就可以在实践章节中跟着操作，而无需手动输入大量源代码。

### **联系我**

我始终对收到关于我的工作的反馈，无论是积极的还是消极的，都非常感兴趣，这本书也不例外。你可以通过电子邮件与我联系，邮箱是* attacking.network.protocols@gmail.com*。你还可以在 Twitter 上关注我 *@tiraniddo*，或者订阅我的博客* [`tyranidslair.blogspot.com/`](https://tyranidslair.blogspot.com/)*，在那里我会发布一些我最新的高级安全研究。
