# 第十二章：敏捷规划

软件开发应该进行规划和跟踪。你的队友希望了解你正在做什么，这样他们才能与你有效合作。团队需要跟踪进展，这样他们才能规划未来的工作，并在开发过程中根据新信息进行调整。没有一个有意识的流程，项目会拖延，外部需求会分散注意力，运营问题也会干扰开发人员。

*敏捷开发*，一种广泛采用的软件开发方法论，旨在快速交付优质软件。理解核心理念以及常见敏捷流程的目标，如冲刺规划、每日站会、评审和回顾，将帮助你有效地使用这些方法。本章将向你介绍敏捷规划的基础知识和 Scrum（一个常用的敏捷框架）的关键实践，帮助你迅速上手。

## 《敏捷宣言》

要理解敏捷开发实践，你必须首先了解敏捷的哲学。敏捷诞生于 2001 年，源自极限编程、Scrum、特性驱动开发和务实编程等前期开发过程中的领导者之间的合作。敏捷流程的创始人写下了*敏捷宣言*（[`agilemanifesto.org/`](https://agilemanifesto.org/)），以描述支撑该流程的核心理念：

> 我们通过实践开发软件并帮助他人开发，发现了更好的开发软件的方法。通过这项工作，我们已经开始重视：
> 
> **个人和互动**高于流程和工具
> 
> **工作软件**高于全面文档
> 
> **客户协作**高于合同谈判
> 
> **响应变化**高于遵循计划
> 
> 也就是说，虽然右侧的项目有价值，但我们更重视左侧的项目。

宣言听起来有点怪异，但它表达了一些重要观点。敏捷实践强调与队友和客户的协作；识别、接受并融入变化；以及注重迭代改进而非大爆炸式的开发发布。敏捷通常与*瀑布模型*相对，后者是一种过时的实践，项目在开始时就进行详尽的规划。

具有讽刺意味的是，一旦敏捷变得流行，黑带忍者、认证和流程顾问就涌入了一些组织。人们开始迷恋“做敏捷”的“正确”方式，往往忽视了第一条原则：“个人和互动高于流程和工具”。

## 敏捷规划框架

Scrum 和看板是最常见的敏捷规划框架。*Scrum*是最流行的框架，鼓励通过短期迭代和频繁的检查点来调整计划。开发工作被拆分为*冲刺*。冲刺的长度各异，通常为两周。在冲刺开始时，每个团队都会召开*冲刺规划*会议来分配工作，这些工作通常以*用户故事*或*任务*的形式记录。规划结束后，开发人员开始工作。进度会通过*票务*或*问题*系统来跟踪。每天会举行一次简短的*站立会议*，分享更新并提出问题。在每次冲刺结束后，团队会进行*回顾*，回顾完成的工作，讨论新发现，查看关键指标，并微调流程。*回顾（retro）*为下一个冲刺的规划会议提供反馈，形成从计划到开发，再到回顾的反馈循环，然后回到计划。

*看板*不像 Scrum 那样使用固定长度的冲刺。相反，看板定义了工作项过渡的工作流阶段（例如，待办、规划、实施、测试、部署、发布）。团队通常会根据需求定制看板阶段。看板通过限制每个阶段中的任务数量来限制*进行中的工作（WIP）*。通过限制任务数量，团队被迫在接收新工作之前完成现有任务。看板板是每个工作流阶段的垂直列的仪表板。任务以带标题的框表示，随着状态的变化，任务在列之间移动。看板板可视化了进行中的工作，并能识别出例如某个阶段任务积压等问题。如果看板显示大量工作被卡在测试阶段，团队可能会通过将一些开发任务转移到待办事项中，来调整工作流程，从而释放工程师帮助测试。看板最适合像支持工程师和 SRE 这类处理大量请求而不是长期项目的团队。

团队很少实施“理想化”的 Scrum 或看板；他们通常会挑选一些做法，调整或忽略其他做法。无论你的组织实践的是 Scrum、看板、两者的混合体*Scrum 看板*（这是真的！）还是其他任何敏捷变种，规划过程的目标应该是交付有用的软件并让客户满意。始终专注于目标，而不是机制。进行实验并衡量结果；保留有效的部分，丢弃其余的。

## Scrum

大多数软件团队都会实践某种形式的 Scrum，因此你需要了解它是如何运作的。所有规划通常从预工作开始。开发人员和产品经理会创建新的*用户故事*，并且*待办事项*中的任务会被*筛选*。故事会被分配*故事点*来估算其复杂性，并拆分成*任务*。较大的故事会通过*冲刺故事*来进行设计和研究。在*冲刺规划*中，团队会选择在下一个冲刺中完成的故事，并使用故事点来避免过度承诺。

### 用户故事

用户故事是一种特定类型的票据，定义了从用户角度的功能请求，格式为“作为<用户>，我<想要> <这样>。”举个例子：“作为管理员，我希望授予我的会计人员查看权限，这样他们就可以查看账单声明。”以用户为中心的描述有助于将焦点放在交付用户价值上。

用户故事的一个常见误用是将常规任务描述硬塞进故事里，比如“作为开发人员，我需要将着色器插件升级到版本 8.7”或“作为用户，我希望隐私政策出现在页脚。”像这样的故事失去了核心意义。为什么需要更新着色器插件？这带来了什么价值？是谁需要它？是“用户”想要这个政策，还是合规官员？如果你要写故事而不是任务，写得好一点。

故事通常除了标题和描述外，还有其他属性。最常见的两个是*估算*和*验收标准*。用户故事的估算是对实现该故事所需工作量的预测。验收标准定义了故事何时完成。验收标准确保开发人员、产品经理、QA 和用户在同一页面上。尽量为每个验收标准写明确定的测试。

+   管理员权限页面列出了“账单声明”选项。

+   获得非管理员授予的“账单声明”查看权限的用户可以查看该账户的所有账单声明。

+   对于非管理员账户，账单声明页面上的编辑按钮是隐藏的。

+   拥有查看权限的非管理员用户无法编辑账单声明。

+   拥有编辑和查看账单声明权限的非管理员用户可以查看和编辑账单声明。

小型故事通常同时作为工作票，而较大的故事与实施票或子任务相关联。模糊或需要设计的故事会被标记为**spike**。Spike 是一个有时间限制的调查，它帮助完成其他故事。Spike 的交付物通常包括设计文档、买与建的决策、权衡评估等。关于设计的更多内容请参见第十章。

### 任务

单个故事可能需要拆解成更小的任务，以便估算所需时间、分配多个开发人员的工作并跟踪实施进度。拆解工作的一个好方法是写出非常详细的描述。仔细阅读描述，找出所有任务。

> 我们需要在`postProfile`中添加一个`retry`参数。目前，如果发生网络超时，配置文件不会更新。我们可能需要限制重试次数，并加入指数回退，以避免长时间阻塞；需要与产品部门沟通，了解他们愿意等待配置文件发布完成的最长时间。
> 
> 一旦实现，我们应该进行单元测试和集成测试。在集成测试中，我们应该模拟真实的网络超时，以验证回退机制是否正常工作。
> 
> 在测试后，我们需要部署到我们的测试环境，然后再部署到生产环境。在生产环境中，应该考虑分流流量，并且逐步增加重试行为，因为`postProfile`非常敏感。

即使是像为网络请求添加`retry`参数这样简单的事情，实际上也包含了许多步骤：与产品经理确认规格、编码、单元测试、集成测试、部署和逐步增加流量。将这些工作拆解成子任务有助于追踪和协调所有步骤。

### 故事点

团队的工作能力通过*故事点*来衡量，这是一个已达成一致的大小单位（以小时、天数或“复杂度”计量）。一个迭代的能力是开发人员人数乘以每位开发人员的故事点数；例如，一个有 4 个工程师且每位工程师有 10 个点的团队，其能力为 40 个点。用户故事的时间估算也用故事点来定义；一个迭代中的所有故事点之和不应超过迭代的总能力。

许多团队使用基于时间的分配，其中一个点等于一个工作日。基于天数的估算通常会考虑非任务性工作——例如会议、干扰、代码评审等等——通过将工作日定义为四小时长来进行。

其他团队通过任务复杂度来定义故事点，采用 T 恤尺码的方法：一个点代表超小，两个点代表小，三个点代表中等，五个点代表大，八个点代表超大。认出这个模式了吗？它是斐波那契数列！按照斐波那契数列递增故事点有助于消除对于 3 点和 3.5 点之间的争论。点值之间有一些间隔，也迫使团队在判断任务是大还是小时做出更艰难的决定，而不是“中等”大小。对于更复杂任务，点数之间差距的增大则考虑到了更大工作量下的估算不准确性。

敏捷框架的教义对基于时间的估算持反对态度。实践者认为日期具有情感附加值，且并不代表复杂性。使用非时间单位可以更容易地表达不确定性。改变单一方法可能看似工作量不大，但如果该方法极为复杂，可能需要投入大量精力。与其说“这是一个中等复杂度的任务”，不如说“这需要我三整天的工作”来 mentally 更容易表达。

人们对使用时间与复杂性来估算任务非常热衷，并且对它们的整体效用有很大的争议。我们发现关于这个话题的争论并没有什么建设性，建议采纳最适合你团队的方法。

估算故事点是主观的；人们往往是差的估算者。提高估算准确度的一种方法是使用*相对大小*来推导数值。相对大小是通过为已经完成的任务定义故事点，然后将已完成的任务与尚未开始的任务进行比较来完成的。如果未完成的任务工作量较少，那么它可能对应较少的点数；更多的工作量可能对应更多的点数；如果任务相似，那么它们应该分配相同的数值。像*规划扑克*这样的过程有时会被使用，但即使你没有参与其中，查看已完成的工作也会让你对团队的故事点值有一定的感觉。

### 待办事项整理

*待办事项整理*或*梳理*（在修剪树木的意义上）通常在计划会议之前进行。待办事项列表是候选故事的清单。整理用于保持待办事项的更新、相关和优先排序。产品经理与工程经理一起审阅待办事项，有时还会与开发人员一起。新的故事被添加，过时的故事被关闭，未完成的故事被更新，高优先级的工作被移到待办事项的顶部。整理良好的待办事项列表将推动计划会议的讨论。

### 冲刺计划

冲刺计划会议在前期准备工作完成后举行。计划会议是协作性的；工程团队与产品经理一起决定要做什么。优先级较高的故事会被讨论，工程师与产品经理共同确定哪些内容能够符合冲刺的容量。

冲刺容量通过查看前几个冲刺中完成的工作量来确定。每个冲刺容量会在冲刺计划时进一步调整，考虑到团队成员的加入或离开、休假、或是否参与待命轮班等因素。

冲刺最重要的特点是它的短暂——通常是两周。短冲刺使得推动工作变得可行，因为工作最多只需推迟一到两周。小型冲刺迫使团队将大任务拆分成更小的任务。小任务更好，因为它们更容易理解和估算。将工作拆解成小任务还允许多个开发人员同时参与一个项目。更短的开发周期和频繁的接触点——站立会议和评审——意味着问题会更早浮现。

一旦冲刺计划完成，冲刺就被认为是锁定的。在冲刺过程中出现的新工作不应被引入；它应被推到待办事项列表，并为未来的冲刺进行规划。锁定冲刺让开发人员能够专注于自己的工作，并带来可预测性。当未计划的工作被引入时，团队应该在回顾会议中研究原因，旨在减少未来未计划的工作。

严格遵守冲刺规划流程并不常见。大多数团队会选择性地执行某些内容；有的团队会在冲刺规划会议中进行预工作，其他团队则没有产品经理——开发人员定义所有工作。许多团队不使用用户故事，而是选择任务或缺陷工单，这些工单格式更加开放。不同团队之间可能存在差异。

## 站立会议

在冲刺规划完成后，工作开始，团队会举行*站立会议*，也叫做*scrum 会议*或*小组讨论*。站立会议可以让每个人了解进度，保持责任感和专注，并为团队提供一个机会，以应对可能危及冲刺目标的任何问题。

站立会议通常是每天早上的 15 分钟会议（足够短，能站着开，虽然实际站立是可选的）。在会议中，团队成员会围绕一个圈子进行更新，分享自上次站立会议以来的工作内容、接下来打算做的工作，以及是否发现任何可能会延迟或破坏冲刺的事项。尽管面对面的站立会议最为常见，但有些团队采用异步形式。在异步站立会议中，团队成员会将相同的更新提交给聊天机器人或群邮件，按每日节奏进行。

站立会议是一个常规的系统检查——就像检查车的仪表盘，确保油箱有油，并且“检查引擎”灯没有亮起。更新应该快速进行；这里不是故障排除的地方。尽量将进度报告限制为必要的要点，并提出你遇到的任何问题。也要宣布你发现的新情况；比如你发现的 bug、遇到的意外行为等等。关于你发现的问题可以在*停车场*（当然不是字面意义上的停车场）进行讨论。

如果你的团队进行同步的站立会议，尽量准时参加。如果站立会议需要更新工单或问题的状态，尽量在会议前更新分配给你的工单。当你在阅读或听取他人的更新时，你应该寻找机会帮助减少冲刺完成的风险：如果有人说某个工单比预期花费了更多时间，若你有空闲时间，可以主动提供帮助。

停车场讨论发生在会议之后。这是一种让站立会议简短的方式，并确保讨论内容对所有与会者都相关。当有人说“留到停车场讨论”时，他们是让你停止当前讨论，等会议结束后与相关方继续。

当遇到时间冲突时，跳过会议是可以接受的。如果你需要缺席站立会议，可以询问你的经理如何提供和获取更新。异步站立会议被跳过的情况较少。

站会和冲刺会有许多变种。你可能会听到诸如*scrum of scrums*或*Scrumban*的词语。scrum of scrums 是一种模式，其中每个 scrum 会议的负责人被选中，前往第二次 scrum 会议，在那里所有团队汇集一起，报告他们的进展，并指出彼此之间的相互依赖。scrum of scrums 在运维中很常见，在这种情况下，每个团队都会派一名工程师（通常是值班工程师）参加运维 scrum 会议，以便跟进运维问题。Scrumban 是 Scrum 和 Kanban 的结合体。所有这些方法中最重要的是理解你的团队和组织的工作方式，并在这一框架内开展工作。

## 评审

评审会发生在每次冲刺之间。评审通常分为两部分：演示和项目评审。在演示环节，团队中的每个人展示他们在本次冲刺中的进展。之后，当前冲刺会根据其目标进行评估。成功的冲刺将会达成目标，并具有较高的故事完成率。

评审会议的结构差异很大。对于一些团队来说，演示是会议的重点，而其他团队则仅关注项目状态评审。许多团队甚至没有评审会议。如果你的团队有评审会议，务必认真对待；提供真实的反馈，并为自己所做的工作感到自豪。你从评审中获得的价值，与投入的努力是成正比的。

标准做法是每个冲刺周的评审时间不超过一小时——一个两周的冲刺将有一个两小时的评审会。大家围绕桌子或在会议室集合进行演示。队友们轮流展示他们所做的工作。会议保持非正式性。之后，冲刺目标会被回顾并评估完成情况。

不要为冲刺评审做过度准备。花几分钟时间弄清楚你将展示什么，并确保你的任务状态准确无误。演示是非正式的，所以避免正式的演讲或演示。

评审庆祝团队的成功，增强团队凝聚力，提供反馈机会，并让团队保持对进展的诚实。并不是团队中的每个开发者都在做同样的项目，因此评审帮助队友们了解彼此的工作进展。保持队友之间的同步，给每个人提供反馈的机会，并让大家认识到出色的工作；这有助于团队凝聚力。项目状态评审还帮助团队达成共识，确定什么是“完成”的，并评估他们向目标进展的情况。发现的问题可以在冲刺回顾中讨论。

## 回顾

《敏捷宣言》中的 12 条原则之一写道：“定期，团队反思如何变得更有效，然后根据需要调整其行为。” 回顾会议正是针对这一原则的。

在回顾会议中，团队聚集在一起讨论自上次回顾以来，哪些方面做得好，哪些做得不好。会议通常分为三个阶段：分享、优先级排序和问题解决。

领导者（或*敏捷教练*）会通过让每个人分享在上一个冲刺中有效和无效的部分来启动回顾。每个人都参与其中，敏捷教练会在白板上或共享文档中记录下来。团队成员接着讨论那些没有做好、最令人痛苦的问题的优先级。最后，团队集思广益，找出解决最优先问题的方法。

不要害怕改变。敏捷开发实践是灵活可变的；这一点在宣言中明确提到：“个人和互动高于过程和工具。”在每次回顾之前，花几分钟思考一下如何使你的团队变得更好。然后在会议上分享你的想法。

回顾与评审经常被混淆。评审专注于冲刺中完成的工作，而回顾则专注于过程和工具。回顾通常发生在冲刺之间，通常是在评审会议之后。许多团队将评审、回顾和冲刺规划会议合并成一个会议，在每个冲刺的开始进行。合并会议是可以的，只要每个环节——评审、回顾和规划——都得到单独的处理。

回顾也是敏捷有多种形式的原因之一。团队被鼓励频繁地重新评估和调整他们的流程。持续的调整意味着没有两个团队以完全相同的方式实践敏捷。

## 路线图

两周一次的冲刺是完成小型和中型工作的好方法，但较大的项目需要更先进的规划。客户有交付日期，开发人员需要遵守，业务部门需要了解哪些团队需要更多的工程师，而大型技术项目需要被分解、规划和协调。

经理们使用产品路线图进行长期规划。路线图通常按季度划分：一月到三月、四月到六月、七月到九月以及十月到十二月。

规划在每个季度开始之前进行。工程经理、产品经理、工程师和其他相关人员都会聚集在一起讨论即将到来的目标和工作。规划通常涉及一系列会议和多轮讨论。

根据*德怀特·戴维·艾森豪威尔文集*第十一卷，艾森豪威尔曾说：“在准备作战时，我发现计划是没有用的，但规划是不可或缺的。”（约翰·霍普金斯大学出版社，1984 年）。这同样适用于路线图。我们从未见过一个年度甚至季度的路线图能百分之百准确；这不是重点。路线图应该鼓励每个人从长远角度思考团队正在建设的内容；它们不是关于团队将在九个月后完成什么的静态和可靠的文档。离得较远的季度应更加模糊，而离得较近的季度应更准确。不要自欺欺人地认为任何一个季度都是百分之百准确的。

与迭代周期不同，路线图是需要不断演进的。客户需求会发生变化，新的技术问题也会出现。这时，迭代规划、回顾和复盘就能发挥作用；它们可以帮助你根据新的信息调整计划。在调整路线图时，沟通至关重要。相关团队应尽早收到通知，了解工作是否被调整或取消。

许多公司会经历年度规划周期。经理们花费每年最后一个季度的时间，规划接下来四个季度的工作内容。年度规划大多是形式主义——讨价还价和谈判。然而，年度规划周期通常会推动“资源分配”或“员工人数”——公司用语指的是新招聘的工程师最终会分配到哪里。年度规划通常聚焦于那些占据团队时间相当大比例的大型项目。如果你关注的项目没有被提及，不必焦虑；可以在规划结束时询问经理该项目的进展情况。

## 做与不做

| **做** | **不做** |
| --- | --- |
| **做** 保持站会更新简短。 | **不做** 对“正确的敏捷方法”过于执着。 |
| **做** 为故事编写详细的验收标准。 | **不做** 害怕改变敏捷流程。 |
| **做** 只在迭代周期内承诺可以实际完成的工作。 | **不做** 强迫将常规任务描述塞进“故事”中。 |
| **做** 如果你不能在一个迭代周期内完成大块工作，请将其拆分。 | **不做** 忘记跟踪规划和设计工作。 |
| **做** 使用故事点来估算工作量。 | **不做** 在迭代开始后，如果承诺的工作尚未完成，不要再添加新工作。 |
| **做** 使用相对大小和 T 恤尺码来帮助估算工作量。 | **不做** 盲目遵循流程。 |

## 升级

大多数敏捷书籍对于你来说可能过于复杂。它们内容极其详细，涉及了大量的敏捷变体；这些书籍主要面向项目经理和程序经理。最好还是参考在线资源。

我们在本章中提到的敏捷宣言，另有一页名为“敏捷宣言背后的原则” ([`agilemanifesto.org/principles.html`](http://agilemanifesto.org/principles.html))。可以查看该页面了解更多关于敏捷理念的细节。

Atlassian 的文章（[`www.atlassian.com/agile/`](https://www.atlassian.com/agile/)）是很好的实用信息来源。你可以找到关于项目管理、路线图规划、到敏捷中的 DevOps 等各类文章。如果你的团队使用的是看板而不是 Scrum，Atlassian 的看板文章将非常有价值。
