

# 详细内容



1.  封面

1.  版权

1.  献词

1.  关于作者和技术审阅者

1.  前言

1.  致谢

1.  介绍

1.  这本书适合谁阅读？

1.  本书的内容是什么？

1.  本书中使用的 PowerShell 约定

1.  保持联系

1.  第一部分：Windows 操作系统概述

1.  [1]

    设置 PowerShell 测试环境

1.  选择 PowerShell 版本

1.  配置 PowerShell

1.  PowerShell 语言概述

1.  理解类型、变量和表达式

1.  执行命令

1.  发现命令并获取帮助

1.  定义函数

1.  显示和操作对象

1.  过滤、排序和分组对象

1.  导出数据

1.  总结

1.  [2]

    Windows 内核

1.  Windows 内核执行程序

1.  安全参考监视器

1.  对象管理器

1.  对象类型

1.  对象管理器命名空间

1.  系统调用

1.  NTSTATUS 代码

1.  对象句柄

1.  查询和设置信息的系统调用

1.  输入/输出管理器

1.  进程和线程管理器

1.  内存管理器

1.  Nt 虚拟内存命令

1.  节对象

1.  代码完整性

1.  高级本地过程调用

1.  配置管理器

1.  工作示例

1.  按名称查找打开的句柄

1.  查找共享对象

1.  修改映射节

1.  查找可写和可执行内存

1.  总结

1.  3

    用户模式应用程序

1.  Win32 与用户模式 Windows API

1.  加载新库

1.  查看导入的 API

1.  搜索 DLL

1.  Win32 图形用户界面（GUI）

1.  GUI 内核资源

1.  窗口消息

1.  控制台会话

1.  比较 Win32 API 和系统调用

1.  Win32 注册表路径

1.  打开密钥

1.  列出注册表内容

1.  DOS 设备路径

1.  路径类型

1.  最大路径长度

1.  进程创建

1.  命令行解析

1.  Shell API

1.  系统进程

1.  会话管理器

1.  Windows 登录过程

1.  本地安全机构子系统

1.  服务控制管理器

1.  工作示例

1.  查找导入特定 API 的可执行文件

1.  查找隐藏的注册表键或值

1.  总结

1.  第二部分：Windows 安全参考监视器

1.  4

    安全访问令牌

1.  主令牌

1.  模拟令牌

1.  安全服务质量

1.  显式令牌模拟

1.  在令牌类型之间转换

1.  伪令牌句柄

1.  令牌组

1.  启用、默认启用和强制

1.  登录 ID

1.  所有者

1.  仅用于拒绝

1.  完整性与完整性启用

1.  资源

1.  设备组

1.  权限

1.  沙盒令牌

1.  受限令牌

1.  写限制令牌

1.  AppContainer 和 Lowbox 令牌

1.  什么是管理员用户？

1.  用户帐户控制

1.  关联令牌与提升类型

1.  UI 访问

1.  虚拟化

1.  安全属性

1.  创建令牌

1.  令牌分配

1.  分配主令牌

1.  分配假冒令牌

1.  工作示例

1.  查找 UI 访问进程

1.  查找用于假冒的令牌句柄

1.  移除管理员权限

1.  总结

1.  5

    安全描述符

1.  安全描述符的结构

1.  SID 结构

1.  绝对和相对安全描述符

1.  访问控制列表头和条目

1.  头部

1.  ACE 列表

1.  构造和操作安全描述符

1.  创建新的安全描述符

1.  排序 ACE

1.  格式化安全描述符

1.  转换为相对安全描述符

1.  安全描述符定义语言

1.  工作示例

1.  手动解析二进制 SID

1.  枚举 SID

1.  总结

1.  6

    读取和分配安全描述符

1.  读取安全描述符

1.  分配安全描述符

1.  在资源创建期间分配安全描述符

1.  为现有资源分配安全描述符

1.  Win32 安全 API

1.  服务器安全描述符和复合 ACE

1.  继承行为总结

1.  工作示例

1.  查找对象管理器资源所有者

1.  更改资源所有权

1.  总结

1.  7

    访问检查过程

1.  执行访问检查

1.  内核模式访问检查

1.  用户模式访问检查

1.  Get-NtGrantedAccess PowerShell 命令

1.  PowerShell 中的访问检查过程

1.  定义访问检查函数

1.  执行强制访问检查

1.  执行令牌访问检查

1.  执行自主访问检查

1.  沙箱化

1.  受限令牌

1.  低箱令牌

1.  企业访问检查

1.  对象类型访问检查

1.  中央访问策略

1.  实际示例

1.  使用 Get-PSGrantedAccess 命令

1.  计算资源的授予访问权限

1.  总结

1.  8

    其他访问检查用例](chapter8.xhtml)

1.  遍历检查

1.  SeChangeNotifyPrivilege 权限

1.  有限检查

1.  处理重复访问检查

1.  沙盒令牌检查

1.  自动化访问检查

1.  实际示例

1.  简化对象的访问检查

1.  查找可写的部分对象

1.  总结

1.  9

    安全审计](chapter9.xhtml)

1.  安全事件日志

1.  配置系统审计策略

1.  配置每个用户的审计策略

1.  审计策略安全

1.  配置资源 SACL

1.  配置全局 SACL

1.  实际示例

1.  验证审计访问安全

1.  查找具有审计 ACE 的资源

1.  总结

1.  第三部分：本地安全机构与认证](part3.xhtml)

1.  10

    WINDOWS 认证](chapter10.xhtml)

1.  域认证

1.  本地身份验证

1.  企业网络域

1.  域森林

1.  本地域配置

1.  用户数据库

1.  LSA 策略数据库

1.  远程 LSA 服务

1.  SAM 远程服务

1.  域策略远程服务

1.  SAM 和安全数据库

1.  通过注册表访问 SAM 数据库

1.  检查安全数据库

1.  实用示例

1.  RID 循环

1.  强制用户更改密码

1.  提取所有本地用户哈希

1.  总结

1.  11

    ACTIVE DIRECTORY](chapter11.xhtml)

1.  Active Directory 简史

1.  使用 PowerShell 探索 Active Directory 域

1.  远程服务器管理工具

1.  基本森林和域信息

1.  用户

1.  组

1.  计算机

1.  对象和区别名称

1.  枚举目录对象

1.  访问其他域中的对象

1.  模式

1.  检查模式

1.  访问安全属性

1.  安全描述符

1.  查询目录对象的安全描述符

1.  将安全描述符分配给新目录对象

1.  将安全描述符分配给现有对象

1.  检查安全描述符的继承安全

1.  访问检查

1.  创建对象

1.  删除对象

1.  列出对象

1.  读取和写入属性

1.  检查多个属性

1.  分析属性集

1.  检查控制访问权限

1.  分析写入验证的访问权限

1.  访问 SELF SID

1.  执行额外的安全检查

1.  声明和中央访问策略

1.  组策略

1.  示例

1.  构建授权上下文

1.  收集对象信息

1.  运行访问检查

1.  总结

1.  12

    交互式认证

1.  创建用户桌面

1.  LsaLogonUser API

1.  本地认证

1.  域认证

1.  登录和控制台会话

1.  令牌创建

1.  从 PowerShell 使用 LsaLogonUser API

1.  使用令牌创建新进程

1.  服务登录类型

1.  已完成示例

1.  测试特权和登录账户权限

1.  在不同控制台会话中创建进程

1.  验证虚拟账户

1.  总结

1.  13

    网络认证

1.  NTLM 网络认证

1.  使用 PowerShell 进行 NTLM 认证

1.  加密派生过程

1.  通行认证

1.  本地环回认证

1.  替代客户端凭据

1.  NTLM 中继攻击

1.  攻击概述

1.  活动服务器挑战

1.  签名和封装

1.  目标名称

1.  通道绑定

1.  已完成示例

1.  概述

1.  代码模块

1.  服务器实现

1.  客户端实现

1.  NTLM 认证测试

1.  总结

1.  14

    KERBEROS

1.  与 Kerberos 的交互式认证

1.  初始用户认证

1.  网络服务身份验证

1.  在 PowerShell 中执行 Kerberos 身份验证

1.  解密 AP-REQ 消息

1.  解密 AP-REP 消息

1.  跨域身份验证

1.  Kerberos 委托

1.  无受限委托

1.  受限委托

1.  用户到用户的 Kerberos 身份验证

1.  实例讲解

1.  查询 Kerberos 票据缓存

1.  简单 Kerberoasting

1.  总结

1.  15

    协商身份验证和其他安全包](chapter15.xhtml)

1.  安全缓冲区

1.  在身份验证上下文中使用缓冲区

1.  使用缓冲区进行签名和封装

1.  协商协议

1.  较少见的安全包

1.  安全通道

1.  CredSSP

1.  远程凭证保护和受限管理员模式

1.  凭证管理器

1.  附加请求属性标志

1.  匿名会话

1.  身份令牌

1.  使用低箱令牌的网络身份验证

1.  使用企业身份验证能力进行身份验证

1.  已知 Web 代理的身份验证

1.  使用显式凭据进行认证

1.  认证审计事件日志

1.  工作示例

1.  确定认证失败的原因

1.  使用安全通道提取服务器的 TLS 证书

1.  总结

1.  最终思考

1.  [A]

    建立用于测试的 Windows 域网络](appendix-A.xhtml)

1.  域网络

1.  安装和配置 Windows Hyper-V

1.  创建虚拟机

1.  PRIMARYDC 服务器

1.  GRAPHITE 工作站

1.  SALESDC 服务器

1.  [B]

    SDDL SID 别名映射](appendix-B.xhtml)

1.  索引
