# 前言

![](img/chapterart.png)

2015 年，我们第一次在多伦多市中心的一家咖啡店见面，想要建立一个本地的黑客社区。那次会议是多伦多正式 DEFCON 分会的起源。从那时起，我们就开始合作攻破网络应用、汽车、锁具、智能建筑和 API。近年来，我们将注意力集中在另一个挑战上：庞大的进攻性 GraphQL 安全世界。

作为一种相对较新的技术，GraphQL 查询语言已经改变了 API 的范式，吸引了许多公司希望优化性能、可扩展性和易用性。然而，要完全理解这种查询语言的安全影响需要时间。我们的合作揭示了大量关于 GraphQL 及其生态系统的全新见解。事实上，本书中提到的许多漏洞和利用手段之前从未公开过。我们通过联合研究发现了其中几个，包括一些独特的、前所未见的弱点。此外，我们自己也是许多 GraphQL 安全工具、教育安全平台和本书中提到的漏洞的作者和维护者。

本书为进攻性安全工程师以及防守方提供了一个实用的资源。通过架起黑客社区和 GraphQL 生态系统之间的桥梁，我们旨在改善这一日益流行的技术，增强许多行业的安全性，并教育工程师如何攻击和防守他们的 GraphQL API。

## 本书的适用对象

本书适合任何有兴趣通过应用进攻性安全测试学习如何破解和保护 GraphQL API 的人。无论你是听说过 GraphQL 并希望发展黑客技能的渗透测试员，还是希望提高防御 GraphQL API 知识的安全分析师，抑或是计划构建一个基于 GraphQL 的应用程序的软件工程师，你都能从本书中获得许多有用的信息。通过学习如何攻击 GraphQL API，你可以制定加固程序，将自动化安全测试集成到你的集成与交付管道中，并有效地验证控制措施。

本书假设你没有接触过 GraphQL。如果你已经理解了这项技术，前三章将加深你对语言的一些基础知识的理解，并讨论一些高级话题。然后，你可以从第四章开始深入了解进攻性安全方面的内容。

## 本书的实验室和代码库

你可以在本书专门为 GraphQL 黑客攻击创建的安全实验室中练习书中涉及的所有内容。我们强烈推荐你通过运行各种工具并查询 GraphQL API，来实验全书在 10 章中分享的材料。你将在第二章中设置这个实验室。

此外，我们鼓励你克隆本书的代码仓库，仓库地址为 [`github.com/dolevf/Black-Hat-GraphQL`](https://github.com/dolevf/Black-Hat-GraphQL)。该仓库包含按章节分类的文件，例如 GraphQL 代码示例、漏洞利用、查询等。我们也意识到，随着安全社区对如何黑客攻击和保护 GraphQL API 的了解不断加深，新的工具和研究论文将会不断涌现。因此，我们在仓库中专门创建了一个文档区，用于记录这些资源，以便将其添加到你的工具库中，位置在*tools*文件夹下。

## 本书内容

本书在前三章中介绍了基本和高级的 GraphQL 概念，并指导你设置安全专家在测试 GraphQL API 时需要的实验室工具。到了第四章，你将对 GraphQL 技术如何运作有一个扎实的理解。本书的其余部分将专注于学习和实践 GraphQL 渗透测试的艺术，这将使你能够自信地在未来的安全工作中测试 GraphQL API。在本书的附录 A 中，你可以找到一个 GraphQL 安全测试备忘单，以及在附录 B 中找到更多学习 GraphQL 的额外资源。以下总结提供了每一章的更多细节。

在 **第一章：GraphQL 简介** 中，你将了解这项技术，并学习它与其他 API 协议的区别。特别是，我们将通过每个协议的示例来演示 GraphQL 和 REST API 之间的差异。这将有助于说明它们的相对优势和劣势，并阐明为什么 GraphQL 在 API 领域中逐渐占据市场份额。你还将运行你的第一个 GraphQL 查询。

**第二章：设置 GraphQL 安全实验室** 汇集了一些适合长期渗透测试实验室环境的最佳 GraphQL 安全工具。我们将指导你如何安装和配置这些工具。其中一些工具是我们自己编写的，而其他工具则是由其他安全专家善意地发布为开源软件的。

如果你是 GraphQL 新手，请特别关注 **第三章：GraphQL 攻击面**。本章有两个目标：一是向你介绍该技术的多个组件，二是使你能够从黑客攻击的角度思考这些概念。在这一章中，你将学习 GraphQL 语言和类型系统。在了解类型系统后，你将理解 GraphQL 架构如何在幕后运作。而在了解语言系统后，你将掌握如何针对 GraphQL API 构建和执行查询。我们还将概述 GraphQL 中的常见弱点，为第四至九章的内容做准备。

在**第四章：侦察**中，我们将使用数据收集和目标映射来应用工具和技术，尽可能多地了解我们的目标。如果不做这项前期工作，我们就像盲目射箭，浪费宝贵的时间。你将学习到信息收集技术，这些技术将使你能够对 GraphQL 目标的基础设施进行有根据的猜测，并增加成功的机会。

在**第五章：拒绝服务**中，你将学习如何实现性能降级或完全的服务器瘫痪。拒绝服务是 GraphQL 中最常见的漏洞之一，本章将介绍多种通过执行特殊查询来使服务器不稳定的技术。你还将学习如何让 GraphQL API 更具抗压性，使用防御性的 GraphQL 安全控制来构建更具韧性的系统。

知识就是力量，正如你将在**第六章：信息泄露**中学到的那样，某些 GraphQL 设计决策可能导致信息泄露漏洞。我们将利用不安全的配置并滥用 GraphQL 功能，在强化的目标上重建架构。我们还将利用 GraphQL 服务器中的错误和调试机制，推测目标的关键信息。

你应该预期在任何托管有价值数据的应用程序或 API 中都能找到授权和认证控制，但这些控制并不总是容易实现并且保证安全。**第七章：认证与授权绕过**将教你如何测试这两种重要控制的绕过方式，使我们能够伪装成用户，执行未经授权的操作，查看未经授权的信息。

处理用户输入是一项必要的恶事。大多数应用程序都需要它，但我们永远不应信任它，因为它可能是恶意的。**第八章：注入攻击**将介绍几种注入类型，以及它们如何在接受用户输入的 GraphQL 接口中引入。我们将使用手动技巧和自动化工具来发现服务器、数据库和客户端浏览器中的基于注入的漏洞。

在**第九章：请求伪造与劫持**中，我们将讨论跨站请求伪造和服务器端请求伪造，这两种基于伪造的漏洞影响客户端和服务器。我们还将讨论跨站 WebSocket 劫持：一种用于窃取用户会话的攻击，影响 GraphQL 订阅。通过使用几种 HTTP 方法发送 GraphQL 查询，我们将以客户端为目标，迫使服务器代表我们请求敏感信息。

在**第十章：已公开漏洞与利用**中，我们将探索十多个漏洞披露报告，并审查影响 GraphQL API 的利用代码。我们将解析这些文档，以巩固之前章节的要点，并揭示漏洞如何影响运行 GraphQL API 的大型公司。

作为计算机安全爱好者，我们很荣幸通过与行业分享我们的知识，为黑客社区做出贡献。凭借我们的视角，你也可以帮助企业更好地保护他们的 GraphQL 应用程序。请记住，本书的内容仅供教育用途。我们强烈建议在对应用程序进行任何渗透测试之前，先获得正式授权。
