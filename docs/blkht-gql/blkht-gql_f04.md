# 前言

如今，构建软件和系统有点像在你的前院组装宜家厨房。人们正在将解析器、实用程序和其他最初用于由个人在其自己的命令行上使用的受信任数据的组件，暴露在互联网上。随着每种新的查询语言和解释器/解析器组合（GraphQL 是其中较新的一种），旧事物变得新起来。

在我职业生涯中，像拒绝服务（DoS）、注入、信息泄露以及认证/授权绕过这样的漏洞类型，几乎出现在使用正则表达式解析的每一种数据格式和语言中。其中一些问题源于底层技术中存在的固有弱点，这些弱点并未被新语言开发者充分理解。但这些漏洞类别难以解决不仅仅是技术问题，更是生态系统问题。

在大多数情况下，由于暴露在互联网上的组件的固有设计，要在不损失功能或效率的情况下添加安全控制层是具有挑战性的。以正则表达式为例：其自引用和反向引用的能力使其非常强大，但这种能力也同时带来固有的 DoS 风险。为了解析一个语句，正则表达式可以反复进行自引用或反向引用。然而对于攻击者来说，“必要”可能意味着“除非你付我停止为止”。

开发者可以合理地假设在自己系统上工作的命令行用户将提交良好格式化的请求，并设计使其在计算合理时间内结束。毕竟，除了偶然之外，谁会自己 DoS 自己呢？但这一基础假设在互联网上不成立。即使对于那些极少数考虑和理解在线威胁如何使得其正在重用的组件的基本设计假设失效的人们，弥补设计决策也是棘手的。更普遍的情况是，人们甚至不知道存在这样的问题需要考虑。

此外，可用性也是一个问题。我们大部分面向互联网的技术应当对错误宽容处理，以便最普通的互联网用户能够应对。它应当能够自动校正，使错误得到优雅处理。同时，这些技术需要对抗最富技术挑战的、无聊的或决心很大的攻击者。没有有效的自校正和沟通系统也能阻止一个人推断数据是否正确或已被更正。一个精明的用户在不了解系统的情况下，通常可以通过一系列有根据的猜测并滥用技术的沟通特性推断其包含的数据。这种推断和确认能力是许多微妙信息泄露风险的根源。

从更广泛的角度来看，这些数据格式和语言的许多规范由于设计过程的缘故本身就不安全。像 PDF 和图像这样的标准通常包含了由当时最大供应商所主导的一堆需求。这些标准的核心规范包含了供应商们能够达成一致的内容，而可选项则容纳了每个供应商特有的功能和设计决策。由有利益关系的委员会所编制的拼凑方案，显然并不会激励小组去思考安全问题。随着数据成为新的货币，委员会几乎是故意在标准中加入隐私和安全风险，以便公司能够继续进行数据收集（并从中获利）。

最后，对于这些问题的教育普遍不足，这也是我们回到本书的原因。如果你是第一次学习如何攻击解释型查询语言和数据格式，那么本书应该为你提供了扎实的基础方法，让你不止是破解 GraphQL。书中描述的相同技术、思维过程和问题类别，可能会为你未来十年甚至更长时间的职业生涯提供帮助。

如果你阅读这本书是为了更好地理解 GraphQL（或者在为下一个任务做匆忙准备时浏览它），你会发现它是由两位曾亲自进行过大量黑客实践的人编写的精彩简报，书中包含了你需要的信息。这包括一份有用的检查清单，提醒你需要注意的问题，洞察一些小的陷阱，以及 GraphQL 特有的怪癖和细节，这些东西否则可能需要你花费大量时间和精力去研究。

Nick Aleks 和 Dolev Farhi 都曾利用这些信息来破解和构建复杂的系统，因此他们能够从建设者和破坏者的角度进行描述，这是许多黑客书籍中常常缺失的视角。他们对 GraphQL 生态系统的洞察力应该能帮助你迅速将工作提升到*发现漏洞*之外，并能够转向对抗性模拟或威胁狩猎的方法。

如果你正在开发一个新的框架，本书将是帮助你改变生态系统中小部分的宝贵资源。通过研究常见的技术问题并理解 GraphQL 生态系统中的挑战，希望你能学到一些避免问题的技巧，并能掌握能够转化为更安全设计决策的概念。

Opheliar Chan

OWASP 多伦多分会负责人
