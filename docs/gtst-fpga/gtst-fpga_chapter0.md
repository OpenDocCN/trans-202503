# 第一章：介绍

![](img/opener-img.png)

在大学毕业后的第一份工作中，作为一名初级电气工程师，我曾参与一个旧设计的工作，那个设计上有一个定时器电路。利用一个简单的电阻和电容，这个电路会等待 50 毫秒（ms）后触发一个动作。我们需要将这个 50 毫秒定时器改为 60 毫秒，但这个小小的改变却需要巨大的努力：我们必须将数百块电路板上的电容和电阻拆除并更换为新的。

幸运的是，我们有一支现场可编程门阵列（FPGA）设计师团队，他们挺身而出，提供了帮助。在他们的帮助下，我们能够在 FPGA 内部实现相同的功能。然后，在几分钟之内，我们就能修改代码，将定时器设置为任何我们想要的值，而无需触碰烙铁。这种更快的进展速度让我兴奋不已，我很快就迷上了 FPGA。

最终，我转向了全职从事 FPGA 的工作，并且大约在那个时候，我开始在 Stack Overflow 上阅读和回答与 FPGA 相关的问题。通常这些问题来自 FPGA 初学者，他们对基本概念感到困惑。我发现同样类型的问题反复出现，并意识到没有一个地方可以让人们以简单、易懂的方式学习 FPGA。当然，网上有很多关于 Verilog 和 VHDL 的参考资料，这两种是最流行的 FPGA 编程语言，但关于这些语言究竟在做什么的资料相对较少。当你编写某一行代码时，FPGA 内部到底创建了哪些组件？各个部分是如何连接的？并行操作与串行操作有何区别？

我不再重复回答同样的问题，而是创建了自己的网站，[*https://<wbr>nandland<wbr>.com*](https://nandland.com)，开始撰写关于 FPGA 的长篇文章。随着流量的增长，我还开始制作 YouTube 视频。我甚至创建了自己的 FPGA 开发板，为初学者提供实践经验。在这些努力中，我的目标是揭开 FPGA 的神秘面纱，同时让信息变得容易接近并引人入胜，尤其是对于刚开始接触的人来说。写这本书让我能够更深入地研究这个主题，为那些有兴趣探索 FPGA 设计这个激动人心的世界的人打下坚实的基础。

## 这本书适合谁？

我尽力让本书尽可能容易理解，以便广泛的读者都能阅读和理解这些内容。本书的目标读者是那些对数字可编程逻辑的工作原理以及 FPGA 如何用于解决各种问题感兴趣的人。也许你是一个大学生，在课程中接触到 FPGA，产生了兴趣但又感到困惑，或者是电子行业的人，在工作中接触过 FPGA。也许你是一个爱动手的创客或硬件黑客，或者是一个对在比平时更低层次上进行编程感兴趣的软件开发者。本书对于所有这些群体来说都非常易于接近。

我假设你至少接触过一种传统的编程语言，比如 Python、C 或 JavaScript。如果你了解函数、条件语句（if…else）、循环和其他基本编程技巧，这将会对你有帮助。不过，你不需要具备 Verilog 或 VHDL 的任何先验经验；本书将介绍这些语言的基础知识。

FPGA 位于硬件和软件的交集处，因此对电子学有所兴趣会有所帮助。我们有时会讨论一些如电压和电流等与 FPGA 内部相关的概念。在这一点上，如果你对这些术语有所基本了解会更有帮助，但并不要求必须掌握，才能从这些部分中获得价值。

## 本书的内容不包括哪些

本书并不旨在教授你 Verilog 或 VHDL 的每个方面。正如我之前所说，如果你的目标是深入了解这些语言，网上有很多资源可以参考。相反，我的目标是让你理解 FPGA 的工作原理，这样你就能明白 Verilog 或 VHDL 在做什么，从而能做出更智能的设计选择。话虽如此，我们*将*在本书中查看大量代码。所有的代码都会得到充分的解释，因此你不需要有这些编程语言的先前经验就能跟得上。随着阅读的深入，你将获得扎实的 Verilog 和 VHDL 知识基础，并且能够通过独立学习提升这些知识。

本书包括一些项目，你可以在实际硬件上使用 Lattice Semiconductor 的 iCE40 系列 FPGA 来完成。我专注于这些相对便宜、简单的 FPGA，以便使本书的实践部分尽可能易于接触。更昂贵的 FPGA 拥有许多额外的功能；它们非常酷，但对于初学者来说可能会有些压倒性。iCE40 FPGA 仍然非常强大，但可用的高端功能较少。因此，本书不会以实践方式探讨诸如 SerDes 和硬核处理器等复杂特性，也不会深入讨论使用这些特性所需的更复杂的 FPGA 工具。不过，我们*会*从高层次讨论一些这些特性，这样你就能在选择升级到更高级的 FPGA 时，掌握必要的背景知识来使用它们。

## 书中内容有哪些？

本书结合了高层次的讨论、详细的代码示例和实际项目。每个代码示例都同时展示了 Verilog 和 VHDL，因此无论你选择哪种语言进行 FPGA 开发，都能跟得上。书的末尾还有一个详尽的术语表供参考。以下是每章内容的概述：

**第一章: 认识 FPGA**   介绍了 FPGA，并讨论了它们的优缺点。作为一名工程师，知道在什么场景下使用哪种工具非常重要。理解何时使用 FPGA——以及何时不使用——是至关重要的。

**第二章: 设置你的硬件和工具**   帮助你设置 Lattice iCE40 系列 FPGA。你将下载并安装 FPGA 工具，并学习如何运行这些工具来编程你的 FPGA。

**第三章: 布尔代数与查找表**   探讨了 FPGA 的两个最基础组件之一：查找表（LUT）。你将学习 LUT 如何执行布尔代数，并代替专用逻辑门。

**第四章: 使用触发器存储状态**   介绍了第二个基础 FPGA 组件：触发器。你将看到触发器如何在 FPGA 中存储状态，赋予设备记忆之前发生的事件。

**第五章: 使用仿真测试你的代码**   讨论了如何编写测试平台来模拟你的 FPGA 设计，并确保它们正常工作。在真实的物理 FPGA 中很难看到内部的运行情况，但仿真可以让你检查代码的行为，发现漏洞，并理解一些奇怪的现象。

**第六章: 常见 FPGA 模块**   展示了如何创建大多数 FPGA 设计中常见的一些基础构建块，包括多路复用器、解复用器、移位寄存器以及先进先出（FIFO）和其他存储结构。你将学习它们如何工作，以及如何将它们组合起来解决复杂问题。

**第七章: 综合、布局与布线以及时钟域跨越**   扩展了 FPGA 构建过程的内容，详细介绍了综合以及布局与布线阶段。你将学习时序错误及其避免方法，并了解如何安全地跨越 FPGA 设计中的时钟域。

**第八章: 状态机**   介绍了状态机，这是一个常见的模型，用于跟踪 FPGA 中事件序列的逻辑流程。你将使用状态机来实现一个互动记忆游戏。

**第九章: 有用的 FPGA 原语**   讨论了除了 LUT 和触发器之外的其他重要 FPGA 组件，包括块 RAM、DSP 模块和相位锁定环（PLL）。你将学习如何利用这些组件的不同策略，并看到它们如何解决常见问题。

**第十章: 数字与数学**   概述了在 FPGA 中处理数字和实施数学运算的简单规则。你将学习有符号与无符号数字、定点与浮点运算的区别，以及更多内容。

**第十一章: 使用 I/O 和 SerDes 进行数据输入输出**   探讨 FPGA 的输入/输出（I/O）能力。你将了解不同接口类型的优缺点，并接触到 SerDes，一种用于高速数据传输的强大 FPGA 功能。

**附录 A: FPGA 开发板**   推荐一些可以用于本书项目的 FPGA 开发板。

**附录 B: FPGA 工程职业建议**   概述了寻找 FPGA 相关工作的策略，适合那些希望专业从事 FPGA 设计的人。我会提出如何构建一份优秀的简历、准备面试以及谈判获得最佳工作机会的建议。

## 你需要的工具

虽然不是严格要求，但我建议拥有一个配备 Lattice iCE40 FPGA 的开发板，这样你就可以完成本书中的动手项目。没有什么比学习一个概念然后能够在真实硬件上实现它更令人满足的了。第二章详细讨论了选择开发板时需要注意的事项以及完成本书项目所需的具体内容。简而言之，开发板应具备 USB 连接和像 LED、按键开关、七段显示器等外设。附录 A 描述了一些适用的开发板。

处理 iCE40 FPGA 的软件工具在 Windows 上运行效果最佳。如果你没有 Windows 计算机，我建议在 Windows 虚拟机中运行这些工具。我们将在第二章中讨论如何安装这些工具。

## 在线资源

本书中介绍的代码可以通过 GitHub 仓库在线获取。你可以在[*https://<wbr>github<wbr>.com<wbr>/nandland<wbr>/getting<wbr>-started<wbr>-with<wbr>-fpgas*](https://github.com/nandland/getting-started-with-fpgas)访问它。你还可以在[*https://<wbr>nandland<wbr>.com*](https://nandland.com)找到更多信息和 FPGA 项目的创意。
