# 前言

![](img/chapterart.png)

本书是为那些希望更好地理解软件安全学科的基本概念，并学习如何实践安全软件设计和实现的艺术的软件专业人员编写的。这里涵盖的几个主题，我有幸自己进行了创新。其他的，我亲眼见证了它们的发展并扎根。基于我个人的行业经验，本书充满了可以立即付诸实践的可操作的想法，帮助你让你所工作的软件更加安全。

本书贯穿两个核心主题：鼓励软件专业人员在软件构建过程的早期就关注安全，并让整个团队参与到安全的过程以及对安全的责任中。无论在这两个领域中都有很大的改进空间，而本书展示了如何实现这些目标。

在我的职业生涯中，我有过在软件安全前线工作的独特机会，现在我希望尽可能广泛地分享我的经验。20 多年前，我曾是微软团队的一员，首次在大规模软件公司中应用威胁建模。几年后，在谷歌，我参与了同一基本实践的演进，并经历了一种全新的方式来应对这一挑战。本书的第二部分得益于我进行过上百次设计审查的经验。回顾我们所走过的路，让我拥有了一个很好的视角来重新阐释这一切。

设计、构建和操作软件系统本身就是一个具有风险的工作。每一个选择，每一步，都可能增加或降低引入安全漏洞的风险。本书涵盖了我最擅长的内容，这些都是我通过亲身经历学到的。我从基本原则传达安全思维，并展示如何在整个开发过程中融入安全。在此过程中，我提供了设计和代码的示例，基本独立于特定技术，以便尽可能广泛地适用。文本中穿插了大量的故事、类比和示例，以增加趣味性，并尽可能有效地传达抽象的理念。

安全思维对某些人来说比对其他人更容易获得，因此我专注于建立这种直觉，帮助你从新的角度思考，以便在工作中融入软件安全的视角。我还应该补充一点，在我个人的经验中，即使是对我们这些轻松掌握它的人来说，仍然有许多可以获得的见解。

这是一本简明的书，涵盖了大量内容。在编写这本书的过程中，我逐渐认识到它的简洁性对它可能取得的成功至关重要。软件安全是一个广度和深度都令人畏惧的领域，因此我希望通过简化书籍的篇幅，使其更易于广泛接触。我的目标是让你从新的角度思考安全，并让你能够轻松地将这种新视角应用到自己的工作中。

## 谁应该阅读本书？

本书适用于已经在某个软件设计和开发领域熟练的人员，包括架构师、UX/UI 设计师、项目经理、软件工程师、程序员、测试人员和管理层。只要技术专业人员了解软件的基本工作原理和构建方式，他们就能轻松理解本书中的概念性内容。软件的使用如此广泛且种类繁多，我不认为*所有*软件都需要安全保护；然而，大多数软件可能都需要，尤其是任何连接到互联网或与人类有较大交互的部分。

在写作过程中，我认为考虑三类潜在读者很有帮助，并希望在这里分别对这三类读者说几句话。

*安全新手*，尤其是那些对安全感到畏惧的人，是我写作的主要读者群体，因为每个从事软件工作的人都应该理解安全问题，以便他们能为提升安全性做出贡献。为了在未来开发出更安全的软件，我们需要每个人的参与，我希望这本书能帮助那些刚开始学习安全的人迅速入门。

*安全意识*读者是那些对安全感兴趣，但知识有限的读者，他们希望深化对安全的理解，并学习更多实用的方式将这些技能应用到自己的工作中。我写这本书的目的是填补这些知识空白，并提供多种方式帮助读者将所学内容立即付诸实践。

*安全专家*（你们知道自己是谁）也包含在其中。他们可能已经对大部分内容非常熟悉，但我相信这本书提供了一些新的视角，并且仍然有很多值得他们学习的东西。具体来说，本书讨论了一些重要的相关主题，如安全设计、安全评审，以及那些很少被书面提及的“软技能”。

本书的第三部分，涵盖实现漏洞和缓解措施，包含了用 C 或 Python 编写的简短代码示例。部分示例假设读者已熟悉内存分配的概念，并理解整数和浮点类型，包括二进制运算。在某些地方，我使用了数学公式，但仅限于模运算和指数运算。对于觉得代码或数学内容过于技术性或不相关的读者，可以跳过这些部分，完全不影响对整体内容的理解。像 `man(1)` 这样的引用是 *nix（Unix 系列操作系统）命令 `(1)` 和函数 `(3)`。

## 这本书涵盖了哪些主题？

本书由 13 章组成，分为三个部分，涵盖概念、设计和实现，最后是结论。

### 第一部分：概念

第一章至第五章为本书的其余部分提供了概念基础。**第一章：基础**概述了信息安全和隐私的基本知识。**第二章：威胁**介绍了威胁建模，详细讲解了在保护资产的背景下，攻击面和信任边界的核心概念。接下来的三章为读者介绍了构建安全软件时可用的有价值工具。**第三章：缓解措施**讨论了常用的策略，以防御性地缓解已识别的威胁。**第四章：模式**展示了一些有效的安全设计模式，并标出了一些需要避免的反模式。**第五章：密码学**通过工具箱的方式解释了如何使用标准的加密库来缓解常见风险，而不涉及底层的数学原理（这些在实践中很少需要）。

### 第二部分：设计

本书的这一部分可能是其对未来读者最独特和最重要的贡献。**第六章：安全设计**和**第七章：安全设计评审**提供了关于安全软件设计的指导，以及如何实现这些设计的实用技巧，分别从设计师和评审者的角度接近这一主题。在这个过程中，它们解释了为什么从一开始就将安全性融入软件设计中是如此重要。

这些章节基于本书第一部分中介绍的思想，提供了具体的方法论，说明如何将这些思想融入到安全设计的构建中。评审方法论直接来源于我的行业经验，包括一个逐步的过程，您可以根据自己的工作方式进行调整。在阅读这些章节时，考虑参考附录 A 中的示例设计文档，作为将这些思想付诸实践的例子。

### 第三部分：实现

第八章至第十三章涵盖了实施阶段的安全性，并涉及部署、操作和生命周期结束问题。一旦你有了安全的设计，本部分将解释如何在不引入额外漏洞的情况下开发软件。这些章节包括代码片段，展示了漏洞如何渗入代码，以及如何避免它们。**第八章：安全编程** 介绍了程序员面临的安全挑战，以及漏洞在代码中实际的表现形式。**第九章：低级编码缺陷** 讨论了计算机算术的弱点，以及 C 语言风格的动态内存分配显式管理如何破坏安全性。**第十章：不可信的输入** 和 **第十一章：Web 安全** 涵盖了许多常见的漏洞，这些漏洞已经被广泛认知多年，但似乎一直未能消失（例如注入、路径遍历、XSS 和 CSRF 漏洞）。**第十二章：安全测试** 讨论了常被忽视的实践——测试以确保代码安全。**第十三章：安全开发最佳实践** 总结了安全实施的指导方针，涵盖了一些通用的最佳实践，并提供了关于常见陷阱的警示。

本书中的代码摘录通常展示了需要避免的漏洞，并提供了修补后的版本，展示了如何使代码变得安全（分别标记为“漏洞代码”和“修复代码”）。因此，书中的代码并非用于生产软件的参考。即使是修复后的代码，在其他环境下也可能因为其他问题而存在漏洞，所以不应认为本书中提供的任何代码对于任何应用程序都是绝对安全的。

### 结论

后记总结了本书的内容，并描述了我希望它能产生的积极影响。在这里，我概述了书中的关键观点，尝试展望未来，并提出一些可能有助于提升软件安全性的方法，首先从本书如何为更安全的软件做出贡献的愿景开始。

### 附录

**附录 A** 是一个示例设计文档，展示了实际中安全意识设计的样貌。

**附录 B** 是书中出现的与软件安全相关术语的词汇表。

**附录 C** 包含一些开放式的练习和问题，雄心勃勃的读者可能会喜欢进行研究。

**附录 D** 包含了一些总结关键概念和过程的备忘单。

此外，可以在 [`designingsecuresoftware.com/`](https://designingsecuresoftware.com/) 找到本书提到的所有参考资料汇编（也可通过 [`nostarch.com/designing-secure-software/`](https://nostarch.com/designing-secure-software/) 链接访问）。

## 良好、安全的乐趣

在我们开始之前，我想先提醒一下关于如何负责任地使用本书所提供的安全知识的一些重要警告。为了说明如何使软件安全，我不得不描述各种漏洞是如何工作的，以及攻击者是如何可能利用这些漏洞的。实验是一种很好的方式，可以从攻击和防御的角度提升技能，但使用这些知识时必须小心谨慎。

切勿在生产系统上随便进行安全测试。例如，当你阅读跨站脚本攻击（XSS）时，你可能会想尝试使用一些复杂的 URL 来浏览你最喜欢的网站，看看会发生什么。请不要这样做。即使出于最好的意图，这些实验也可能被网站管理员误认为是真正的攻击。尊重他人可能会将你的行为解读为威胁是非常重要的——当然，在某些国家，你可能还会违反法律。请运用你的常识，考虑你的行为可能会被如何解读，以及可能发生的错误和意外后果，并且要倾向于避免。相反，如果你想进行 XSS 实验，可以搭建自己的 Web 服务器并使用虚拟数据，然后尽情地进行实验。

此外，尽管本书基于我多年在软件安全领域的经验，提供了我能给出的最佳通用建议，但没有任何指导是完美无缺的，也并不适用于所有可能的情境。书中提到的解决方案从来不是“灵丹妙药”：它们只是建议，或者是值得了解的常见方法示例。在评估安全决策时，依赖你最好的判断力。没有任何一本书可以为你做出这些选择，但本书可以帮助你做出正确的决定。
