# 前言

![](img/chapterart.png)

今天的研究人员估计，应用程序编程接口（API）的调用占所有 Web 流量的 80% 以上。然而，尽管 API 无处不在，Web 应用程序的黑客往往忽视对其进行测试。而这些至关重要的商业资产却可能存在致命的弱点。

正如你将在本书中看到的，API 是一个绝佳的攻击途径。毕竟，API 是为了暴露信息给其他应用程序而设计的。为了获取一个组织最敏感的数据，你可能不需要巧妙地突破网络防火墙的边界、绕过先进的杀毒软件并释放零日漏洞；相反，你的任务可能只是向正确的端点发送一个 API 请求。

本书的目标是向你介绍 Web API，并展示如何测试它们的各种弱点。我们将主要关注测试 REST API 的安全性，这是 Web 应用程序中最常用的 API 格式，但也会涉及攻击 GraphQL API。你将首先学习如何按照 API 的预期使用它们的工具和技术。接下来，你将探测它们的漏洞，并学习如何利用这些漏洞。然后，你可以报告你的发现，并帮助防止下一次数据泄露。

## 黑客攻击 Web API 的魅力

2017 年，《经济学人》杂志（*The Economist*）发布了以下标题：“世界上最宝贵的资源不再是石油，而是数据。” API 是数字化的管道，能够在眨眼之间将这一宝贵的资源传播到世界各地。

简单来说，API 是一种使不同应用程序之间能够进行通信的技术。例如，当一个 Python 应用需要与 Java 应用的功能进行交互时，事情可能会迅速变得复杂。通过依赖 API，开发人员可以设计模块化应用程序，利用其他应用程序的专业功能。例如，他们不再需要自己编写定制软件来实现地图、支付处理、机器学习算法或身份验证过程。

因此，许多现代 Web 应用程序迅速采用了 API。然而，新技术往往会在网络安全有机会提出问题之前，先取得显著的进展，而 API 极大地扩展了这些应用程序的攻击面。它们防御薄弱，攻击者可以利用它们直接进入数据。此外，许多 API 缺乏其他攻击途径所具备的安全控制，使它们成为类似死星热废气口的存在：对企业来说，这是通往灾难和毁灭的道路。

由于这些原因，Gartner 早在几年之前就预测到，到 2022 年，API 将成为主要的攻击向量。作为黑客，我们需要通过穿上溜冰鞋、将 Acme 火箭绑在背上，赶上技术创新的速度来保护它们。通过攻击 API，报告我们的发现，并向企业传达风险，我们可以为打击网络犯罪贡献自己的一份力量。

## 本书的方法

攻击 API 并不像你想象的那样具有挑战性。一旦你理解了它们的运作方式，黑客攻击它们就只是发出正确的 HTTP 请求的问题。然而，通常用于漏洞狩猎和 Web 应用程序渗透测试的工具和技术并不适用于 API。比如，你不能将通用的漏洞扫描程序对着 API 运行，然后期待有用的结果。我经常将这些扫描程序对着易受攻击的 API 进行扫描，结果只是得到了错误的否定结果。当 API 没有经过适当测试时，组织就会产生虚假的安全感，进而面临被攻破的风险。

本书的每一部分都会在前一部分的基础上进行扩展：

1.  **第一部分：Web API 安全工作原理** 首先，我将向你介绍你需要了解的关于 Web 应用程序和驱动它们的 API 的基本知识。你将学习到 REST API，这是本书的主要主题，以及日益流行的 GraphQL API 格式。我还将介绍你可能会遇到的最常见的 API 相关漏洞。

1.  **第二部分：构建 API 测试实验室** 在这一部分中，你将构建你的 API 黑客攻击系统，并理解所使用的工具，包括 Burp Suite、Postman 和其他多种工具。你还将设置一个易受攻击目标的实验室，供你在本书中练习攻击。

1.  **第三部分：攻击 API** 在第三部分中，我们将转向 API 黑客攻击方法，我将带你完成对 API 进行常见攻击的过程。在这里，乐趣开始了：你将通过使用开源情报技术发现 API，分析它们以理解攻击面，并最终深入各种攻击，例如注入攻击。你将学习如何反向工程 API，绕过其认证，并对其进行模糊测试，以发现各种安全问题。

1.  **第四部分：真实世界的 API 黑客攻击** 本书的最后一部分致力于展示 API 弱点是如何在数据泄露和漏洞悬赏中被利用的。你将了解黑客是如何在真实世界的情境中使用书中介绍的技术的。你还将走一遍对 GraphQL API 的示范攻击，将书中之前介绍的许多技术适应到 GraphQL 格式中。

1.  **实验室** 第二部分和第三部分的每一章都包括一个动手实验，允许你亲自练习书中的技术。当然，你可以使用本书之外的工具来完成这些活动。我鼓励你利用这些实验作为跳板，试验我提供的技术，并尝试自己的攻击。

本书适合任何想要开始学习 Web 应用攻破的人员，也适合渗透测试人员和漏洞赏金猎人，他们希望增加另一项技能。我设计了这本书，让即使是初学者也能在第一部分学习到关于 Web 应用的基础知识，在第二部分搭建自己的黑客实验室，并在第三部分开始实际攻破。

## 攻克 API 餐厅

在我们开始之前，让我给你一个比喻。想象一个应用程序是一个餐厅。就像 API 文档一样，菜单描述了你可以点的菜品。作为顾客和厨师之间的中介，服务员就像 API 本身；你可以根据菜单向服务员发出请求，服务员会把你点的菜送给你。

至关重要的是，API 用户并不需要知道厨师是如何准备菜肴的，或者后台应用是如何运作的。相反，他们应该能够按照一组指令发出请求并接收到相应的响应。开发者可以根据需求编程，任意方式实现请求的响应。

作为一个 API 黑客，你将探查比喻中的每一个部分。你将学习餐厅的运作方式。你可能尝试绕过餐厅的“保安”或者提供一个被盗的认证令牌。此外，你还会分析菜单，找出欺骗 API 将你没有权限访问的数据交给你的方法，或许是通过欺骗服务员把他们所有的东西交给你。你甚至可能说服 API 所有者把餐厅的钥匙交给你。

本书采用整体的方法，通过以下主题引导你深入了解如何攻克 API：

+   理解 Web 应用的工作原理以及 Web API 的构成

+   从黑客的角度掌握最常见的 API 漏洞

+   学习最有效的 API 攻击工具

+   执行被动和主动的 API 侦查，发现 API 的存在，寻找暴露的秘密，并分析 API 的功能

+   与 API 互动并利用模糊测试的力量对其进行测试

+   执行各种攻击以利用你发现的 API 漏洞

在本书的学习过程中，你将运用对抗性思维，利用任何 API 的功能和特点。我们越能模拟对手的行为，就越能发现可以向 API 提供者报告的弱点。我相信，我们甚至能够共同防止下一次重大 API 数据泄露事件的发生。
