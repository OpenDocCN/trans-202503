# 前言

想象一下，如果给朋友汇款不仅仅是打开一个应用并点击几下。或者，如果监控你的日常步数、锻炼数据和营养信息意味着要查看三个独立的应用程序。又或者，如果比较机票价格需要手动访问每家航空公司的官网。

当然，想象这个世界并不难：我们曾经生活在其中。然而，API 改变了这一切。它们是促进公司间合作的纽带，彻底改变了企业构建和运行应用程序的方式。事实上，API 已经变得无处不在，2018 年 10 月的 Akamai 报告显示，API 调用占据了所有网页流量的惊人 83%。

但与互联网中的大多数事情一样，只要有好的东西，网络犯罪分子就会注意到它。对于这些犯罪分子来说，API 是一个极为肥沃且有利可图的领域，原因很简单。这些服务提供了两大非常吸引人的特点：（1）丰富的敏感信息来源，和（2）频繁的安全漏洞。

考虑一下 API 在典型应用架构中的角色。当你在移动应用上查看银行余额时，后台的 API 会请求该信息并将其发送到应用程序。同样，当你申请贷款时，API 使银行能够请求你的信用历史记录。API 位于用户和后台敏感系统之间的关键位置。如果网络犯罪分子能够攻破 API 层，他们就能直接访问到极其有价值的信息。

尽管 API 已经达到了前所未有的应用程度，但它们的安全性依然滞后。我最近与一家拥有 100 年历史的能源公司首席信息安全官交谈时，惊讶地得知他们在整个组织中都使用 API。但他很快指出：“每当我们深入检查时，都会发现它们常常拥有过多的权限。”

这并不让人感到意外。开发者们在修复漏洞、发布新版本、向用户添加新功能的压力下生存。他们不能像以前那样每几个月发布一次版本，而是必须在每晚构建和每日提交中循环进行。实际上，他们根本没有足够的时间去考虑每次更改的安全影响，因此未被发现的漏洞悄悄地渗透到产品中。

不幸的是，宽松的 API 安全实践往往会导致意想不到的后果。以美国邮政服务（USPS）为例，该机构发布了一个名为 Informed Visibility 的 API，允许组织和用户追踪包裹。恰当地说，API 要求用户验证身份并进行身份认证才能通过 API 访问任何信息。然而，一旦认证通过，用户就可以查看任何其他用户的账户信息，从而泄露了 6000 万用户的信息。

健身公司 Peloton 也通过 API 为其应用程序（甚至是设备）提供支持。但是，由于其中一个 API 在发出请求并从 Peloton 服务器获取响应时不需要身份验证，它允许请求者查看任何其他 Peloton 设备（共有四百万台）的帐户信息，并访问潜在的敏感用户信息。即使是美国总统乔·拜登，一个著名的 Peloton 用户，他的信息也通过这个不安全的端点被泄露了。

这是第三个例子：电子支付公司 Venmo 依赖于 API 来驱动其应用程序并与金融机构连接。它的一个 API 执行了一个营销功能，展示了最近的匿名交易。虽然用户界面负责去除任何敏感信息，但该 API 在被直接调用时会返回所有交易详情。恶意用户通过这个 API 获取了大约 2 亿笔交易。

像这样的事件已变得非常普遍，分析公司 Gartner 预测，到 2022 年，API 漏洞将成为“最频繁的攻击途径”，而 IBM 报告称，三分之二的云漏洞是由于 API 配置错误引起的。这些漏洞也突显了为 API 安全提供新方法的必要性。过去的应用安全解决方案仅关注最常见的攻击类型和漏洞。例如，自动化扫描工具会搜索公共漏洞和暴露（CVE）数据库中的 IT 系统缺陷，Web 应用防火墙实时监控流量，阻止包含已知漏洞的恶意请求。这些工具非常适合检测传统威胁，但它们无法解决 API 面临的核心安全挑战。

问题在于，API 漏洞并不常见。它们不仅在不同的 API 之间差异很大，而且通常与传统应用程序中的漏洞有所不同。美国邮政服务（USPS）发生的漏洞并不是安全配置错误，而是一个业务逻辑漏洞。也就是说，应用逻辑包含了一个意外的漏洞，允许经过身份验证的有效用户访问其他用户的数据。这种类型的漏洞被称为破坏性对象级授权，是因为应用逻辑未能控制授权用户可以访问的内容。

简而言之，这些独特的 API 逻辑漏洞实际上是零日漏洞，每一个漏洞都只属于特定的 API。由于这些威胁的范围，像这样的书籍对于教育渗透测试员和有兴趣保持 API 安全的漏洞赏金猎人来说至关重要。此外，随着安全性逐渐向“左”转移到工程和开发过程中，API 安全性不再仅仅是公司信息安全部门的领域。这本书可以成为任何现代工程团队的指南，帮助他们在进行功能和单元测试的同时进行安全测试。

当 API 安全测试项目得当执行时，它们是持续的、全面的。每年进行一次或两次的测试无法跟上新版本发布的步伐。相反，测试应当成为开发周期的一部分，以确保每个版本在上线前都经过验证，并覆盖 API 的整个范围。发现 API 漏洞需要新的技能、新的工具和新的方法。现在，世界比以往任何时候都更需要*黑客攻击 API*。

丹·巴拉霍纳

APIsec.ai 公司首席战略官

美国加利福尼亚州旧金山
