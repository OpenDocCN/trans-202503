- en: '11'
  id: totrans-0
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: '11'
- en: 'NATURE BOX: MOTION-SENSING CAMERA'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 自然盒子：运动感应相机
- en: IN THIS CHAPTER, YOU’LL BUILD AND CODE A NATURE BOX CAMERA THAT CAN SNAP A PHOTO
    WHEN IT SENSES MOVEMENT. YOU’LL THEN PLACE THE NATURE BOX IN THE WILD TO PHOTOGRAPH
    LOCAL WILDLIFE. YOU NEVER KNOW—YOU MAY SNAP A BIRD, A BADGER, OR EVEN A FOX!
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，你将构建并编写一个自然盒子相机，当它感应到运动时可以拍照。然后，你将把自然盒子放置在野外，拍摄当地的野生动物。你永远不知道——你可能会拍到一只鸟、一只獾，甚至是一只狐狸！
- en: The box will contain a motion sensor. Whenever animals come close to it, the
    sensor triggers the built-in Pi Camera to take a photo. The Raspberry Pi then
    uploads each image to an online Dropbox folder for you to view and share with
    your friends. You can leave the camera running from morning to evening and see
    what kind of visitors you get ([Figure 11-1](ch11.xhtml#ch11fig01)).
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 该盒子将包含一个运动传感器。每当动物接近时，传感器会触发内置的树莓派相机拍照。然后，树莓派会将每张图片上传到一个在线Dropbox文件夹，供你查看并与朋友分享。你可以让相机从早到晚一直工作，看看有哪些“访客”来到（[图11-1](ch11.xhtml#ch11fig01)）。
- en: '![Image](../images/11fig01.jpg)'
  id: totrans-4
  prefs: []
  type: TYPE_IMG
  zh: '![图片](../images/11fig01.jpg)'
- en: '**FIGURE 11-1** Build a nature box that takes animal photos like this one.'
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: '**图11-1** 构建一个像这样拍摄动物照片的自然盒子。'
- en: WHAT YOU’LL NEED
  id: totrans-6
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 你将需要的物品
- en: 'Here are a few items you’ll need to complete the project:'
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是完成项目所需的几样物品：
- en: Raspberry Pi (You can build the nature box with any of the Pi models. The Pi
    2, 3 A+, and Zero W work well because they are small and can be hidden in a smaller
    space.)
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 树莓派（你可以用任何树莓派型号来构建自然盒子。Pi 2、3 A+和Zero W非常适合，因为它们小巧，可以隐藏在较小的空间中。）
- en: Pi Camera
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Pi相机
- en: Passive infrared sensor (PIR)
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 被动红外传感器（PIR）
- en: Jumper wires
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 跳线
- en: Clear plastic box to hold the hardware
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 透明塑料盒，用于容纳硬件
- en: Dropbox account
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Dropbox账户
- en: USB portable battery
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: USB便携电池
- en: Drill
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 电钻
- en: SETTING UP THE PASSIVE INFRARED SENSOR
  id: totrans-16
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 设置被动红外传感器
- en: A PIR ([Figure 11-2](ch11.xhtml#ch11fig02)) is more commonly referred to as
    a *movement detector*. It detects infrared light emitted from warm objects and
    bodies, such as humans, animals, and even vehicles; it measures changes in that
    light. You can write code to respond to the detection of certain levels of change
    and trigger events in response, such as turning on lights, sounding alarms, or
    opening doors automatically.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 一个PIR传感器（[图11-2](ch11.xhtml#ch11fig02)）更常被称为*运动探测器*。它探测从温暖物体和生物（如人类、动物，甚至是车辆）释放出的红外光，并测量光的变化。你可以编写代码来响应某些变化级别的检测，并触发相应的事件，如打开灯光、发出警报或自动打开门。
- en: As an object passes by the PIR, it emits heat that changes the surrounding temperature.
    This difference in the surrounding infrared radiation is picked up by the PIR
    and changes the internal voltage, which means it has detected something. Inside
    the sensor’s dome are small mirrors that help the PIR to detect changes in infrared
    light from as far away as 30 feet.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 当物体经过PIR时，它会释放热量，改变周围的温度。PIR感应到周围红外辐射的差异，并改变内部电压，这意味着它已经检测到某物。在传感器的圆顶内有小镜子，帮助PIR从远至30英尺的地方探测红外光的变化。
- en: '![Image](../images/11fig02.jpg)'
  id: totrans-19
  prefs: []
  type: TYPE_IMG
  zh: '![图片](../images/11fig02.jpg)'
- en: '**FIGURE 11-2** A PIR'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: '**图11-2** 一款PIR传感器'
- en: Wiring the PIR
  id: totrans-21
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 连接PIR传感器
- en: You need just three wires to connect the PIR to the Raspberry Pi. Connect the
    VCC PIR pin, which provides power, to the 5V GPIO pin located at the top of the
    Pi’s board. The diagram in [Figure 11-3](ch11.xhtml#ch11fig03) uses the 5V pin,
    which is physical pin 2\. Connect the OUT pin to GPIO pin 4, which is physical
    pin 7, on the Pi. Then connect the ground (GND) pin on the PIR to a ground pin
    on the Pi.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 你只需要三根电线就可以将PIR连接到树莓派。将VCC PIR引脚（提供电源）连接到树莓派板上方的5V GPIO引脚。图[11-3](ch11.xhtml#ch11fig03)中使用的是物理引脚2的5V引脚。将OUT引脚连接到树莓派上的GPIO引脚4（物理引脚7）。然后，将PIR上的接地（GND）引脚连接到树莓派上的接地引脚。
- en: '![Image](../images/11fig03.jpg)'
  id: totrans-23
  prefs: []
  type: TYPE_IMG
  zh: '![图片](../images/11fig03.jpg)'
- en: '**FIGURE 11-3** Wiring the PIR'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: '**图11-3** 连接PIR传感器'
- en: Testing the PIR
  id: totrans-25
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 测试PIR
- en: Let’s write a simple program to test that your PIR works correctly. Your body
    gives off heat, and when you move about, you disturb and move the heat surrounding
    your body. The code in [Listing 11-1](ch11.xhtml#ch11ex01) initializes the PIR
    and then checks for a change in heat. If the PIR detects a significant change,
    according to a threshold you’ll set, the program indicates that it has *seen you*.
    Open your Python editor and enter the code in [Listing 11-1](ch11.xhtml#ch11ex01).
    Save it as *PIR_test.py*.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们编写一个简单的程序来测试PIR是否正常工作。你的身体会散发热量，当你四处移动时，你会扰动并移动包围你身体的热量。[Listing 11-1](ch11.xhtml#ch11ex01)中的代码初始化了PIR传感器，然后检查热量是否发生变化。如果PIR传感器检测到显著的变化，按照你设定的阈值，程序将指示它已经*看见你了*。打开你的Python编辑器，输入[Listing
    11-1](ch11.xhtml#ch11ex01)中的代码。将其保存为*PIR_test.py*。
- en: '[PRE0]'
  id: totrans-27
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: '**LISTING 11-1** Detecting movement with the PIR'
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: '**LISTING 11-1** 使用PIR检测运动'
- en: Import the `time` module and the `RPi.GPIO` module to control and code the GPIO
    pins ❶. Because there are two GPIO pin numbering systems, define which one you’re
    using by setting the mode to `BCM`.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 导入`time`模块和`RPi.GPIO`模块，以控制和编写GPIO引脚的代码❶。因为有两种GPIO引脚编号系统，你需要通过设置模式为`BCM`来定义你使用的编号系统。
- en: Next, declare a variable to define the GPIO pin number you’re using to check
    for a response. This is the GPIO 4 pin that you connected to the PIR ❷. Tell the
    program to check for input on GPIO pin 4 by using `GPIO.IN`.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，声明一个变量来定义你用于检测响应的GPIO引脚编号。这是你连接到PIR传感器的GPIO 4引脚❷。通过使用`GPIO.IN`告诉程序检查GPIO
    4引脚的输入。
- en: Because this is a test program, print a line indicating that the sensor is ready
    to find you and then provide a short time delay before retrieving the data from
    the PIR. This gives you a moment to prepare before you move about or wave your
    hands, triggering the sensor.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 因为这是一个测试程序，打印一行表示传感器已准备好寻找你，然后在从PIR传感器获取数据之前提供一个短暂的时间延迟。这样你就有时间准备，开始移动或挥动手臂，从而触发传感器。
- en: Then define a function that responds to any sensed movement or motion ❸. In
    this test program, the response is a simple statement indicating that you’ve been
    seen.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 然后定义一个响应任何感应到的运动或变化的函数❸。在这个测试程序中，响应是一个简单的语句，表示你已经被看到。
- en: Next, the program tries to detect motion ❹. You use the `try` and `except` method
    to avoid causing an error if the PIR doesn’t work correctly or takes an odd data
    reading. This ensures that the program will continue to run if the PIR malfunctions.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，程序尝试检测运动❹。你使用`try`和`except`方法来避免当PIR传感器工作不正常或读取到异常数据时引发错误。这样可以确保程序在PIR发生故障时仍然继续运行。
- en: Then you take the reading from the PIR ❺. This code checks GPIO pin 4 to see
    whether the voltage is rising. If it is, something has triggered the PIR. So you
    use the `callback` method to run the function that responds to any sensed movement
    or motion ❸ and print `We see you`.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，你从PIR传感器读取数据❺。这段代码检查GPIO 4引脚的电压是否上升。如果是，说明有东西触发了PIR传感器。所以你使用`callback`方法运行响应任何感应到的运动或变化的函数❸，并打印`We
    see you`。
- en: To keep the PIR from reading the same input multiple times, you add a 1-second
    delay ❻. This allows enough time for the PIR to reset before it checks for a change
    in temperature again. Remember that you’re looking for motion, not presence; therefore,
    the camera doesn’t have to be constantly active.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 为了防止PIR传感器多次读取相同的输入，你添加了一个1秒的延迟❻。这样可以为PIR传感器重置提供足够的时间，然后再检查温度是否发生变化。记住，你是在寻找运动，而不是存在；因此，摄像头不需要始终保持活动状态。
- en: Finally, you need a way to stop the program. You add the `except` response,
    which checks whether any key on the keyboard has been pressed ❼. If it detects
    a keypress, it prints `Quit`, resets the GPIO pins, and stops the program.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，你需要一种停止程序的方法。你添加了`except`响应，它检查是否按下了键盘上的任何按键❼。如果检测到按键，它会打印`Quit`，重置GPIO引脚，并停止程序。
- en: Save the program and press **F5** to run it. Alternate between moving and staying
    still to make sure the PIR detects you. If you want, you can turn this into a
    game. Can you stand so still that you don’t trigger the PIR? Can you walk into
    a room without having the PIR spot you?
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 保存程序并按**F5**键运行它。你可以交替进行移动和保持静止的操作，确保PIR能够检测到你。如果你愿意，你可以将这变成一个游戏。你能保持如此静止，以至于不会触发PIR吗？你能进入一个房间而不被PIR探测到吗？
- en: SETTING UP THE PI CAMERA
  id: totrans-38
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 设置Pi Camera
- en: With a working PIR that can detect motion, you can set up the Pi Camera to capture
    images of whatever triggers the sensor.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 有了能够检测运动的PIR传感器，你就可以设置Pi Camera来捕捉任何触发传感器的影像。
- en: Attaching the Pi Camera
  id: totrans-40
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 连接Pi Camera
- en: If you completed the Pi Camera projects in [Chapter 4](ch04.xhtml#ch04), you
    might already have the hardware set up. Use the ribbon cable to connect the camera
    to the Pi, as shown in [Figure 11-4](ch11.xhtml#ch11fig04), and remember to ensure
    that the Pi Camera is enabled in the Configuration tool. This requires you to
    restart the Raspberry Pi. If you get stuck or need more detailed instructions,
    refer to “Interfaces” on [page 16](ch01.xhtml#page_16).
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你在[第4章](ch04.xhtml#ch04)中完成了Pi Camera项目，你可能已经设置好了硬件。使用排线将相机连接到Pi，如[Figure
    11-4](ch11.xhtml#ch11fig04)所示，并记得确保Pi Camera在配置工具中启用。这需要你重新启动Raspberry Pi。如果遇到问题或需要更详细的说明，请参阅[第16页](ch01.xhtml#page_16)的“接口”部分。
- en: '![Image](../images/11fig04.jpg)'
  id: totrans-42
  prefs: []
  type: TYPE_IMG
  zh: '![Image](../images/11fig04.jpg)'
- en: '**FIGURE 11-4** Setting up the Pi Camera'
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: '**FIGURE 11-4** 设置Pi Camera'
- en: Creating a New Folder to Store the Images
  id: totrans-44
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 创建一个新文件夹来存储图片
- en: 'To keep the nature box project organized, you’ll want to store the images and
    program files in one place. Create a new folder named *Nature_Box* by opening
    the terminal and entering the following command:'
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 为了保持自然盒子项目的有序性，你会希望将图片和程序文件存储在一个地方。通过打开终端并输入以下命令，创建一个名为*Nature_Box*的新文件夹：
- en: '[PRE1]'
  id: totrans-46
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: Making a project folder will prevent your home folder from becoming cluttered
    with hundreds of images.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 创建一个项目文件夹可以防止你的主文件夹被成百上千的图片弄得乱七八糟。
- en: WRITING THE TEST CODE
  id: totrans-48
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 编写测试代码
- en: With the Pi Camera attached, you can now start a new Python file or adapt the
    code in [Listing 11-1](ch11.xhtml#ch11ex01) to make the camera take a picture
    each time the PIR senses movement. You can photograph birds, cats, or other native
    wildlife—maybe even a fox—as they move past your nature box setup. Enter the code
    in [Listing 11-2](ch11.xhtml#ch11ex02) and save it as *Cam_PIR.py*.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 在连接了Pi Camera之后，你可以开始一个新的Python文件，或者修改[Listing 11-1](ch11.xhtml#ch11ex01)中的代码，让相机在PIR传感器检测到运动时拍照。你可以拍摄鸟类、猫或其他本地野生动物——甚至可能是狐狸——它们经过你的自然盒子设置时。输入[Listing
    11-2](ch11.xhtml#ch11ex02)中的代码，并将其保存为*Cam_PIR.py*。
- en: '[PRE2]'
  id: totrans-50
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: '**LISTING 11-2** Taking a picture whenever the PIR detects motion'
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: '**LISTING 11-2** 每当PIR检测到运动时拍照'
- en: Edit the program code by importing the `sleep()` function from the `time` module
    and import the `picamera` class too ❶.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 编辑程序代码，导入`time`模块中的`sleep()`函数，并导入`picamera`类❶。
- en: Then, to stop each new image from overwriting the previous one, create a variable
    to hold the current `Image_Number` ❷. Make this a global variable so you can use
    this data later in the main program function to save each file with a different
    name. Set the `Image_Number` variable to `0`, which means the first image taken
    will be named *Nature0.jpg*.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，为了防止每张新图片覆盖之前的图片，创建一个变量来存储当前的`Image_Number`❷。将其设置为全局变量，以便稍后在主程序功能中使用这些数据，保存每个文件时使用不同的名称。将`Image_Number`变量设置为`0`，这意味着拍摄的第一张图片将命名为*Nature0.jpg*。
- en: 'Then add the `PiCamera()` function to the `camera` variable. Replace `time.sleep(2)`
    with the simpler code `sleep(2)` ❸. This is a better way of writing the code,
    as you have less text to type and therefore reduce the chance of an error. You
    can use this simpler code in your other programs and projects. It serves the same
    purpose: it pauses the program for 2 seconds, creating a small delay before the
    next line of code runs.'
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 然后将`PiCamera()`函数添加到`camera`变量中。将`time.sleep(2)`替换为更简洁的代码`sleep(2)`❸。这种写法更好，因为你输入的文本更少，从而减少了出错的机会。你可以在其他程序和项目中使用这种简洁的代码。它的作用相同：暂停程序2秒，在下一行代码运行之前创建一个小的延迟。
- en: Next, within the `Motion_Sensing(PIR)` function, add the code to trigger the
    Pi Camera and take a picture. At ❹, you add the global variable you created at
    ❷. Then you set the camera resolution ❺ and add the code to capture the image
    ❻.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，在`Motion_Sensing(PIR)`函数内，添加触发Pi Camera并拍照的代码。在❹处，你添加了在❷处创建的全局变量。然后你设置了相机的分辨率❺，并添加了捕捉图像的代码❻。
- en: Note that the code that captures the image ❻ combines the string `"Nature"`
    and the `Image_Number` value ❷, which is currently set to `0`. This creates a
    file named *Nature0*, to which you add the *.jpg* file extension to save the image
    as *Nature0.jpg*.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 注意，捕获图像的代码❻将字符串`"Nature"`与当前设置为`0`的`Image_Number`值❷结合起来。这会创建一个名为*Nature0*的文件，并加上*.jpg*文件扩展名，将图像保存为*Nature0.jpg*。
- en: Then add a value of `1` to the current image value ❼, so the program will save
    the next file as *Nature1.jpg*, the following as *Nature2.jpg*, and so on until
    the program stops. You also change the final line from `time.sleep(1)` to `sleep(1)`
    ❽.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，向当前的图片值❼添加`1`，这样程序将保存下一个文件为*Nature1.jpg*，接下来的是*Nature2.jpg*，以此类推，直到程序停止。你还将最后一行代码从`time.sleep(1)`更改为`sleep(1)`❽。
- en: Save the program in the *Nature_Box* folder so all the images will be stored
    there, making it easy to access them later. Press **F5** to run the program. Each
    time something triggers the PIR, the Pi Camera will take a picture and save it
    in the folder. You could set up your nature box near your most prized possessions
    or chocolate stash. If anyone steals from you, you’ll have photographic evidence
    of the culprit.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 将程序保存在 *Nature_Box* 文件夹中，这样所有图片都会存储在那里，便于稍后访问。按 **F5** 运行程序。每当有物体触发 PIR 时，Pi
    摄像头将拍摄一张照片并保存在文件夹中。你可以将你的自然盒子放在最珍贵的物品或巧克力储藏处附近。如果有人偷了你的东西，你将有盗窃者的照片证据。
- en: If the PIR triggers too easily, you can adjust its sensitivity. On warm days,
    tree branches can move infrared radiation around, which the PIR can pick up. If
    the box is near a road, cars driving past might alter the surrounding air.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 如果 PIR 传感器触发过于灵敏，可以调整其灵敏度。在温暖的日子里，树枝的摆动可能会移动红外辐射，PIR 可能会感应到。如果盒子靠近道路，经过的汽车可能会改变周围的空气。
- en: To avoid triggering the camera in those cases, locate the two small dials ([Figure
    11-5](ch11.xhtml#ch11fig05)) on the back of the PIR (they’re usually orange).
    One is the *Delay Time Adjust* dial, which changes how long it takes to reset
    the PIR each time it’s triggered. The other is the *Distance Adjust* dial, which
    increases or decreases the sensitivity; basically, it determines how much of a
    change in heat is required to trigger the PIR. Experiment with adjusting these
    dials to find the perfect settings for your nature box and your local environment.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 为了避免在这些情况下触发相机，找到 PIR 后面两个小旋钮（见[图 11-5](ch11.xhtml#ch11fig05)）（通常是橙色的）。一个是 *延迟时间调整*
    旋钮，调整每次触发 PIR 后的重置时间。另一个是 *距离调整* 旋钮，用来增加或减少灵敏度；基本上，它决定了触发 PIR 所需的温度变化量。你可以调整这些旋钮，找到适合你自然盒子和当地环境的完美设置。
- en: '![Image](../images/11fig05.jpg)'
  id: totrans-61
  prefs: []
  type: TYPE_IMG
  zh: '![Image](../images/11fig05.jpg)'
- en: '**FIGURE 11-5** Adjusting the PIR sensitivity on the back of the PIR'
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: '**图 11-5** 调整 PIR 后部的灵敏度'
- en: RETRIEVING THE IMAGES FROM THE RASPBERRY PI
  id: totrans-63
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 从 Raspberry Pi 获取图片
- en: Now you need to figure out how to retrieve your images. If you leave your hardware
    in the wild, you won’t be able to access the images until you collect your nature
    box. Depending on your setup or the type of wildlife you’re trying to monitor,
    you might want to leave it out for a few days. But waiting that long to view images
    isn’t ideal. The solution is to connect your nature box to the internet so that
    you can use the file-sharing website Dropbox and a simple Python program to upload
    each image in real time. You’ll be able to access the photos remotely by using
    a tablet, a laptop, or a mobile phone.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 现在你需要弄清楚如何检索你的图片。如果你将硬件放置在野外，直到你收回自然盒子之前将无法访问图片。根据你的设置或你想监测的野生动物类型，你可能希望将其放置几天。但等待这么长时间查看图片并不是理想的选择。解决方案是将你的自然盒子连接到互联网，这样你就可以使用文件共享网站
    Dropbox 和一个简单的 Python 程序实时上传每张图片。你将能通过平板、笔记本电脑或手机远程访问这些照片。
- en: Setting Up a Dropbox Account
  id: totrans-65
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 设置 Dropbox 账户
- en: If you already have a Dropbox account, you can skip this step. If not, head
    over to the Dropbox website at [*https://www.dropbox.com/*](https://www.dropbox.com/)
    and register for a new account. Click **Create an account** and fill in the sign-up
    form ([Figure 11-6](ch11.xhtml#ch11fig06)). Alternatively, you can use your Google
    account details to sign up.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你已经拥有 Dropbox 账户，可以跳过此步骤。如果没有，前往 Dropbox 网站 [*https://www.dropbox.com/*](https://www.dropbox.com/)，注册一个新账户。点击
    **创建账户** 并填写注册表单（见[图 11-6](ch11.xhtml#ch11fig06)）。另外，你也可以使用 Google 账户信息进行注册。
- en: '![Image](../images/11fig06.jpg)'
  id: totrans-67
  prefs: []
  type: TYPE_IMG
  zh: '![Image](../images/11fig06.jpg)'
- en: '**FIGURE 11-6** Signing up or logging in to Dropbox'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: '**图 11-6** 注册或登录 Dropbox'
- en: Once you’ve logged in, navigate to the Dropbox Developers page ([Figure 11-7](ch11.xhtml#ch11fig07))
    at [*https://www.dropbox.com/developers/*](https://www.dropbox.com/developers/)
    to create an app.
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 登录后，前往 Dropbox 开发者页面 ([图 11-7](ch11.xhtml#ch11fig07))，网址是 [*https://www.dropbox.com/developers/*](https://www.dropbox.com/developers/)
    创建一个应用。
- en: '![Image](../images/11fig07.jpg)'
  id: totrans-70
  prefs: []
  type: TYPE_IMG
  zh: '![Image](../images/11fig07.jpg)'
- en: '**FIGURE 11-7** Going to the Dropbox Developers page'
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: '**图 11-7** 访问 Dropbox 开发者页面'
- en: Click the **Create your app** option. Dropbox presents you with several options.
    When it prompts you to choose an API, select **Dropbox API**. Then select **App
    folder** as the access type. Name your app; I called mine *Nature Box*. Agree
    to the terms and conditions, and click the blue **Confirm** button to access the
    next page of configuration settings ([Figure 11-8](ch11.xhtml#ch11fig08)).
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 点击 **创建你的应用** 选项。Dropbox 会为你提供几个选项。当它提示你选择 API 时，选择 **Dropbox API**。然后选择 **应用文件夹**
    作为访问类型。为你的应用命名；我将其命名为 *Nature Box*。同意条款和条件，并点击蓝色的 **确认** 按钮以访问下一个配置设置页面（[图 11-8](ch11.xhtml#ch11fig08)）。
- en: '![Image](../images/11fig08.jpg)'
  id: totrans-73
  prefs: []
  type: TYPE_IMG
  zh: '![Image](../images/11fig08.jpg)'
- en: '**FIGURE 11-8** Configuring your app’s settings'
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: '**图 11-8** 配置应用程序的设置'
- en: Keep the Status row set to **Development**, and the Development users row set
    to **Only you**. This means only you will have permission to edit the app. You
    can also edit the app folder name.
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 保持状态行设置为 **开发**，将开发用户行设置为 **仅限你**。这意味着只有你可以编辑该应用。你还可以编辑应用文件夹的名称。
- en: Ignore the App key and App secret rows; you don’t need these for this project.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 忽略应用密钥和应用密钥行；此项目不需要这些。
- en: Select the **Generated access token** box to create a code that will enable
    your Raspberry Pi to send image files to the Dropbox app. You’ll need to use this
    token in your Python program later. Remember that this token keeps your account
    secure, so don’t share it with others.
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 选择 **生成的访问令牌** 选项，生成一个代码，使你的 Raspberry Pi 能够将图像文件发送到 Dropbox 应用。稍后你需要在 Python
    程序中使用这个令牌。记住，这个令牌确保你的账户安全，因此不要与他人分享。
- en: With your Dropbox app set up, you can now use it to upload the nature box images.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 配置好 Dropbox 应用后，你现在可以使用它上传自然盒子图像。
- en: Installing Dropbox for Python
  id: totrans-79
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 安装 Dropbox Python 库
- en: 'You need to install a Python Dropbox library so you can access your Dropbox
    app and folder from the Python program code. To install the required software,
    open the terminal and enter the following command:'
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 你需要安装一个 Python Dropbox 库，这样你就可以从 Python 程序代码访问你的 Dropbox 应用和文件夹。要安装所需的软件，请打开终端并输入以下命令：
- en: '[PRE3]'
  id: totrans-81
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'Then, to make sure you’re using the newest updates, enter this command:'
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，为了确保你使用的是最新的更新，输入以下命令：
- en: '[PRE4]'
  id: totrans-83
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: Creating a Test Program
  id: totrans-84
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 创建测试程序
- en: Before you connect the PIR and Pi Camera to Dropbox, you need to create a simple
    program to test whether the Dropbox app and token are functioning correctly. But
    first, save a JPEG image in the *Nature_Box* folder to test with. In the program
    in [Listing 11-3](ch11.xhtml#ch11ex03), I’ve used an image of a cute squirrel
    ([Figure 11-9](ch11.xhtml#ch11fig09)) and named the file *squirrel.jpg*.
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 在你将 PIR 和 Pi Camera 连接到 Dropbox 之前，你需要创建一个简单的程序来测试 Dropbox 应用和令牌是否正常工作。但首先，在
    *Nature_Box* 文件夹中保存一张 JPEG 图像以供测试。在[列表 11-3](ch11.xhtml#ch11ex03)中的程序里，我使用了一张可爱的松鼠图片（[图
    11-9](ch11.xhtml#ch11fig09)），并将文件命名为 *squirrel.jpg*。
- en: '![Image](../images/11fig09.jpg)'
  id: totrans-86
  prefs: []
  type: TYPE_IMG
  zh: '![Image](../images/11fig09.jpg)'
- en: '**FIGURE 11-9** Saving an image in the *Nature_Box* folder'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: '**图 11-9** 将图像保存到 *Nature_Box* 文件夹'
- en: Open your Python editor, create a new file, and add the following code. Save
    it as *DB_uploader.py*.
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 打开你的 Python 编辑器，创建一个新文件，并添加以下代码。将其保存为 *DB_uploader.py*。
- en: '[PRE5]'
  id: totrans-89
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: '**LISTING 11-3** Testing your Dropbox app and token'
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: '**列表 11-3** 测试你的 Dropbox 应用和令牌'
- en: Import the `dropbox` module ❶. Create a variable named `token`, and enter the
    app token you acquired earlier within quotation marks ❷. Next, create another
    variable named `dbx` to hold the `Dropbox` class ❸, which enables your Python
    program code to communicate with your Dropbox account.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 导入 `dropbox` 模块 ❶。创建一个名为 `token` 的变量，并将你之前获得的应用令牌用引号括起来 ❷。接下来，创建另一个名为 `dbx`
    的变量来存储 `Dropbox` 类 ❸，它使你的 Python 程序能够与你的 Dropbox 账户进行通信。
- en: Now you’re ready to locate and open the image file you want to upload ❹. Open
    the folder where the image is stored by using `with open`. Next, read from the
    file and use the Dropbox API to upload the image to your account ❺. Then print
    a short confirmation message ❻ so you know the file upload is complete.
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，你准备好定位并打开你想要上传的图像文件 ❹。通过使用 `with open` 打开图像存储的文件夹。接下来，从文件中读取并使用 Dropbox API
    上传图像到你的账户 ❺。然后打印一个简短的确认信息 ❻，以便你知道文件上传完成。
- en: Running the Program
  id: totrans-93
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 运行程序
- en: Go to the Dropbox website, log in, and navigate to your app folder. Then return
    to your Raspberry Pi and run the test program. The test will attempt to upload
    your image file (in this example, the image of the squirrel), so check your Dropbox
    folder for the upload ([Figure 11-10](ch11.xhtml#ch11fig10)).
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 访问 Dropbox 网站，登录并导航到你的应用程序文件夹。然后返回到你的 Raspberry Pi，运行测试程序。测试将尝试上传你的图像文件（在此示例中是松鼠的图像），因此请检查你的
    Dropbox 文件夹以查看上传情况（[图 11-10](ch11.xhtml#ch11fig10)）。
- en: '![Image](../images/11fig10.jpg)'
  id: totrans-95
  prefs: []
  type: TYPE_IMG
  zh: '![Image](../images/11fig10.jpg)'
- en: '**FIGURE 11-10** The uploaded image in the *Nature_Box* folder'
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: '**FIGURE 11-10** 上传到 *Nature_Box* 文件夹中的图像'
- en: CODING THE FINAL NATURE BOX
  id: totrans-97
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 编写最终的自然盒子程序
- en: 'So far, you’ve created three separate programs: a first to test that the PIR
    is working correctly, a second to trigger the Pi Camera whenever the PIR senses
    motion, and a third to allow the Raspberry Pi to upload the images to your linked
    Dropbox folder. Now let’s combine everything you’ve learned so far in this chapter
    to make the final nature box program.'
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止，你已经创建了三个独立的程序：第一个测试 PIR 是否正常工作，第二个在 PIR 检测到运动时触发 Pi Camera，第三个则允许 Raspberry
    Pi 将图像上传到你关联的 Dropbox 文件夹。现在，让我们将你本章所学的所有内容结合起来，制作最终的自然盒子程序。
- en: Setting Up the Final Program
  id: totrans-99
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 设置最终程序
- en: Save and rename your previous *DB_uploader.py* file or start a new Python file
    and save it as *NatureBox.py*. Then enter the code in [Listing 11-4](ch11.xhtml#ch11ex04).
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 保存并重命名你之前的 *DB_uploader.py* 文件，或者开始一个新的 Python 文件并将其保存为 *NatureBox.py*。然后输入
    [Listing 11-4](ch11.xhtml#ch11ex04) 中的代码。
- en: '[PRE6]'
  id: totrans-101
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: '**LISTING 11-4** Beginning the final nature box program'
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: '**LISTING 11-4** 开始最终的自然盒子程序'
- en: Import the `dropbox` module ❶, which lets you interact with Dropbox via the
    Python code. Also import the usual `sleep()` function to add small delays, then
    the `picamera` library, and finally the `Rpi.GPIO` module to control the PIR.
    Then you set the GPIO numbering system to `BCM`.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 导入 `dropbox` 模块 ❶，该模块允许你通过 Python 代码与 Dropbox 进行交互。还需导入常用的 `sleep()` 函数以增加小的延迟，然后导入
    `picamera` 库，最后导入 `Rpi.GPIO` 模块以控制 PIR。接着，你需要将 GPIO 编号系统设置为 `BCM`。
- en: Combining the Camera and Sensor
  id: totrans-104
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 结合相机和传感器
- en: The next section of the code, shown in [Listing 11-5](ch11.xhtml#ch11ex05),
    combines the PIR code and the camera code, so when movement is sensed, the Pi
    Camera is triggered. It takes a picture and then creates and saves the image file.
    The first lines should be familiar to you because they’re from the *Cam_PIR.py*
    test program you created.
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来的代码部分，如[Listing 11-5](ch11.xhtml#ch11ex05)所示，结合了 PIR 代码和相机代码，所以当检测到运动时，Pi
    Camera 会被触发。它拍摄一张照片，然后创建并保存图像文件。前几行代码应该对你来说并不陌生，因为它们来自你创建的 *Cam_PIR.py* 测试程序。
- en: '[PRE7]'
  id: totrans-106
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: '**LISTING 11-5** Capturing and saving an image'
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: '**LISTING 11-5** 捕捉并保存图像'
- en: Add a value of 1 to the image file variable ❶ (which you set to 0 earlier),
    so the first image saved is named *Nature1.jpg*.
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 给图像文件变量 ❶（你之前设置为 0）加 1，这样第一个保存的图像将命名为 *Nature1.jpg*。
- en: After the Pi Camera captures an image, it saves the image file, but not the
    filename. To save the filename as well, create a new variable named `pic` ❷ to
    hold the image’s filename as a string. This means the program can access it later
    when it’s selecting and uploading the image file to Dropbox.
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 在 Pi Camera 捕捉图像后，它会保存图像文件，但不保存文件名。为了同时保存文件名，创建一个名为 `pic` ❷ 的新变量，将图像的文件名作为字符串存储。这意味着程序可以在稍后上传图像文件到
    Dropbox 时访问它。
- en: Creating the try and except
  id: totrans-110
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 创建 try 和 except
- en: Next, in [Listing 11-6](ch11.xhtml#ch11ex06), you use the `try` and `except`
    method. The `try` part attempts to run the section of code responsible for uploading
    the image files to Dropbox. If for some reason the nature box is unable to access
    Dropbox—say, because the site is unavailable or because the nature box is no longer
    online—the program will bypass this section by using the `except` part and continue
    to run without halting or causing an error.
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，在 [Listing 11-6](ch11.xhtml#ch11ex06) 中，你将使用 `try` 和 `except` 方法。`try` 部分尝试运行负责将图像文件上传到
    Dropbox 的代码。如果由于某些原因自然盒子无法访问 Dropbox——比如网站不可用，或自然盒子不再在线——程序将通过 `except` 部分跳过这一部分并继续运行，而不会停止或产生错误。
- en: '[PRE8]'
  id: totrans-112
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: '**LISTING 11-6** Saving the image filename'
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: '**LISTING 11-6** 保存图像文件名'
- en: Add your Dropbox token ❶ and assign it to a variable named `dbx` ❷, which you
    use to authenticate your account credentials and enable interaction with Dropbox.
    At ❸, open the image file that the camera just took by combining the folder location
    of the image and the `pic` variable, which holds the filename of the most recent
    image. The code `rb` opens the image as a binary file and reads the contents as
    bytes rather than strings. This is important because the file contains an image,
    not text. Then assign this data to a variable named `file`, as in the physical
    data that makes up the image in the file stored on your Raspberry Pi.
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 添加你的Dropbox令牌❶并将其分配给一个名为`dbx`的变量❷，你用它来验证账户凭据并启用与Dropbox的交互。在❸处，通过将图片的文件夹位置和`pic`变量（它保存最新图片的文件名）结合起来，打开相机刚拍摄的图片。代码`rb`将图片作为二进制文件打开，并以字节形式读取其内容，而不是字符串。这一点很重要，因为文件包含的是图像，而不是文本。然后将这些数据赋值给一个名为`file`的变量，就像存储在树莓派上的文件中构成图像的实际数据。
- en: The program reads the bytes from `file` and tries to upload the data ❹. The
    code `'/Nature%s.jpg' %(Image_Number)` adds the filename to Dropbox, because the
    binary data you uploaded doesn’t contain a filename otherwise. The code `mute
    = True` prevents the user from being notified of the upload. You can imagine how
    distracting receiving hundreds of notifications about uploaded files would be.
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 程序从`file`读取字节并尝试上传数据❹。代码`'/Nature%s.jpg' %(Image_Number)`将文件名添加到Dropbox，因为你上传的二进制数据本身不包含文件名。代码`mute
    = True`会防止用户收到上传通知。你可以想象，收到成百上千条上传文件的通知会是多么让人分心。
- en: 'After the upload, close the file: open files use processor resources and can
    slow your Raspberry Pi, especially if there are a lot of them. Finally, add the
    `except` section of the program’s `try` and `except` method ❺. If the program
    can’t upload the image, it responds by passing and printing a notification before
    looping back, resetting the PIR, and waiting for the sensor to be triggered again.
    The image is still saved in the *Nature_Box* folder on the Pi but just won’t be
    uploaded.'
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 上传后，关闭文件：打开的文件会占用处理器资源，并且可能会减慢你的树莓派，尤其是在文件很多的情况下。最后，添加程序的`try`和`except`方法的`except`部分❺。如果程序无法上传图片，它会通过跳过并打印通知来响应，然后进入循环，重置PIR并等待传感器再次触发。图像仍然保存在树莓派的*Nature_Box*文件夹中，只是不会被上传。
- en: Running the Motion Sensor
  id: totrans-117
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 运行运动传感器
- en: The final section of the program, shown in [Listing 11-7](ch11.xhtml#ch11ex07),
    is identical to the *PIR_test.py* program you created earlier. It tells the PIR
    to wait for an input and, upon receiving one, runs the `Motion_Sensing()` function.
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 程序的最后部分，如[Listing 11-7](ch11.xhtml#ch11ex07)所示，与你之前创建的*PIR_test.py*程序完全相同。它指示PIR等待输入，并在接收到输入时运行`Motion_Sensing()`函数。
- en: '[PRE9]'
  id: totrans-119
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: '**LISTING 11-7** Ending the program'
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: '**LISTING 11-7** 结束程序'
- en: 'Once you’ve copied the complete program, save and run it. Test that it’s working
    by moving around to trigger the PIR. Open your internet browser and navigate to
    your Dropbox folder to check out the uploaded images ([Figure 11-11](ch11.xhtml#ch11fig11)).
    Before you deploy your nature box into the wild, you can test your program in
    fun ways: compete with your friends to see who can walk into a room without triggering
    the sensor, or position your nature box at the front door and check to see who
    is knocking. Look for the evidence in the Dropbox folder before you decide to
    open the door!'
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦你复制了完整的程序，保存并运行它。通过四处移动触发PIR传感器来测试它是否工作。打开你的互联网浏览器并导航到你的Dropbox文件夹，查看上传的图片（[图11-11](ch11.xhtml#ch11fig11)）。在将你的自然盒子投入实际使用之前，你可以通过有趣的方式测试你的程序：和朋友竞争，看谁能不触发传感器进入房间，或者将你的自然盒子放在前门，检查是谁在敲门。在决定开门之前，可以先在Dropbox文件夹中寻找证据！
- en: '![Image](../images/11fig11.jpg)'
  id: totrans-122
  prefs: []
  type: TYPE_IMG
  zh: '![Image](../images/11fig11.jpg)'
- en: '**FIGURE 11-11** Your photos should appear the Dropbox folder when you run
    the program.'
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: '**FIGURE 11-11** 当你运行程序时，你的照片应该出现在Dropbox文件夹中。'
- en: 'If the nature box doesn’t function correctly, consider the following common
    errors:'
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 如果自然盒子没有正常工作，考虑以下常见错误：
- en: Is the Dropbox token used in your program correct?
  id: totrans-125
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 程序中使用的Dropbox令牌是否正确？
- en: Is the Raspberry Pi connected to the internet? Otherwise, all image files will
    remain stored in the *Nature_Box* folder.
  id: totrans-126
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 树莓派是否已连接到互联网？否则，所有图像文件将保留在*Nature_Box*文件夹中。
- en: Do the folder names in the code match the actual folder names?
  id: totrans-127
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 代码中的文件夹名称是否与实际文件夹名称匹配？
- en: Do the filenames in the code match the actual filenames?
  id: totrans-128
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 代码中的文件名是否与实际的文件名匹配？
- en: Is the PIR’s sensitivity adjusted so the proper amount of motion triggers it?
  id: totrans-129
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: PIR的灵敏度是否调整得当，以便适当的动作触发它？
- en: When uploading to Dropbox, you can’t overwrite the same file. Therefore, whenever
    you run the program again after the first time, make sure you’ve either moved
    the first batch of image files to a different folder or deleted them.
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 上传到 Dropbox 时，无法覆盖相同的文件。因此，每次在首次运行程序后再次运行时，请确保你已将第一批图像文件移动到其他文件夹或将其删除。
- en: STARTING THE PROGRAM AUTOMATICALLY
  id: totrans-131
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 自动启动程序
- en: Because you’ll set up the nature box outside, you won’t have a monitor attached
    to it. The program will need to execute whenever you plug power into the Raspberry
    Pi. Recall that I covered how to start programs automatically in [Chapters 7](ch07.xhtml#ch07),
    [9](ch09.xhtml#ch09), and [10](ch10.xhtml#ch10). Now you’ll do it again for the
    nature box program.
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 由于你将在户外设置 Nature Box，因此不会连接显示器。每次插入 Raspberry Pi 电源时，程序都需要执行。回想一下，我在[第 7 章](ch07.xhtml#ch07)、[9
    章](ch09.xhtml#ch09)和[10 章](ch10.xhtml#ch10)中已经介绍过如何自动启动程序。现在，你将为 Nature Box 程序再次设置。
- en: You’ll use cron to run the program automatically by creating instructions in
    the crontab file specifying what event you want to run and when you want to run
    it. Refer to [Chapter 9](ch09.xhtml#ch09) if you need a refresher on using cron.
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 你将使用 cron 来自动运行程序，通过在 crontab 文件中创建指令，指定你想运行的事件及其执行时间。如果你需要复习如何使用 cron，请参考[第
    9 章](ch09.xhtml#ch09)。
- en: 'Open the terminal and enter the following command to open the cron console:'
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 打开终端并输入以下命令以打开 cron 控制台：
- en: '[PRE10]'
  id: totrans-135
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: The cron console presents you with three methods of editing the crontab file.
    Select option 2 and press ENTER to open the crontab file with the nano text editor.
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: cron 控制台为你提供了三种编辑 crontab 文件的方法。选择第二个选项并按回车键，使用 nano 文本编辑器打开 crontab 文件。
- en: 'Scroll to the bottom of the text in the crontab file and locate the blank space.
    Then add the following code line to run the program automatically:'
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 滚动到 crontab 文件底部，找到空白区域。然后添加以下代码行以自动运行程序：
- en: '[PRE11]'
  id: totrans-138
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: The command states that every time the Raspberry Pi reboots, it should run Python
    in super user mode, open the */home/pi/Nature_Box* folder, and execute your *NatureBox.py*
    program.
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 该命令表示每次 Raspberry Pi 重启时，应该以超级用户模式运行 Python，打开*/home/pi/Nature_Box*文件夹，并执行你的*NatureBox.py*程序。
- en: If you named your code file something else, replace *NatureBox.py* with your
    filename. Also, check that the folder path is correct by opening the folder where
    your *NatureBox.py* program is stored and noting the file path.
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你将代码文件命名为其他名称，请将*NatureBox.py*替换为你的文件名。还要通过打开存储*NatureBox.py*程序的文件夹并注意文件路径，检查文件夹路径是否正确。
- en: The `&` at the end of the code line tells your program to run in the background,
    so you can do other tasks with your Raspberry Pi at the same time.
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 代码行末尾的`&`告诉你的程序在后台运行，这样你就可以同时使用 Raspberry Pi 做其他任务。
- en: Once you have checked the command details and are confident they’re correct,
    press CTRL-X to save and exit the crontab file. Now, each time you turn on or
    reboot your Raspberry Pi, the crontab file will run, starting up the nature box.
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 检查命令详情并确保它们正确无误后，按 CTRL-X 保存并退出 crontab 文件。现在，每次打开或重启 Raspberry Pi 时，crontab
    文件都会运行，启动 Nature Box。
- en: 'If you want to stop the program from automatically running, reopen the crontab
    file from the terminal and delete the line of code you added, like this:'
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你想停止程序的自动运行，请从终端重新打开 crontab 文件，并删除你添加的代码行，如下所示：
- en: '[PRE12]'
  id: totrans-144
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: Then save the file and reboot.
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 然后保存文件并重新启动。
- en: 'The nature box is designed to run without a monitor, so you don’t need the
    Raspberry Pi to boot to the desktop interface and display the background wallpaper
    and icons. Because you won’t see the desktop, you don’t need to load it. Instead,
    you can configure the Pi to boot to the command line. Open the terminal window
    and enter this command:'
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: Nature Box 设计为无需显示器即可运行，因此你无需让 Raspberry Pi 启动到桌面界面并显示背景墙纸和图标。因为你不会看到桌面，所以不需要加载它。相反，你可以配置
    Pi 启动到命令行界面。打开终端窗口并输入以下命令：
- en: '[PRE13]'
  id: totrans-147
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: Select the third option, **Boot Options**, and press ENTER. Then select the
    **B1 Desktop / CLI** option, followed by the **B1 Console** option. Click the
    **Save** option and then reboot your Raspberry Pi.
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 选择第三个选项，**启动选项**，然后按回车键。接着选择**B1 桌面 / CLI**选项，再选择**B1 控制台**选项。点击**保存**选项，然后重新启动
    Raspberry Pi。
- en: 'Once this is set, select the **<Finish>** option and press ENTER: you’ll be
    prompted to save the config file and reboot. Press **Yes** to restart your Pi.
    As your Raspberry Pi boots up, the nature box will load. Before you place the
    box in the wild, run a quick test and check that it’s working and uploading images
    to your Dropbox account.'
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 设置完成后，选择**<完成>**选项并按下ENTER键：系统会提示你保存配置文件并重启。按**是**来重启你的Pi。当树莓派启动时，自然盒子会加载。在你把盒子放到野外之前，先进行一个快速测试，确保它正常工作并将图片上传到你的Dropbox账户。
- en: PUTTING IT ALL TOGETHER
  id: totrans-150
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 整合所有部分
- en: Now that you have a working program, you can set up your box and then leave
    it in your garden, at a local park, or elsewhere. Using a plastic case for the
    box is ideal ([Figure 11-12](ch11.xhtml#ch11fig12)) because you can seal it with
    tape, and it will remain fairly watertight—although I don’t recommend that you
    lower the nature box into a pond or leave it out during a thunderstorm.
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 现在你有了一个可用的程序，可以设置好盒子并将其放置在你的花园、当地公园或其他地方。使用塑料盒作为盒子的外壳是理想的选择（[图11-12](ch11.xhtml#ch11fig12)），因为你可以用胶带密封它，它会保持相当的防水性——不过我不建议你将自然盒子放入池塘中或在雷雨天气下将其放置在外面。
- en: 'Preparing your nature box is fairly easy:'
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 准备自然盒子相当简单：
- en: Use a drill to create a small hole for the camera lens to poke through.
  id: totrans-153
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用电钻打一个小孔，以便相机镜头可以穿透。
- en: Use a drill to create a larger hole so that the PIR can poke through. It’s best
    to drill a small hole to start with and then increase the size of the drill bit
    so that you don’t split the plastic. If you’re using a wooden box, this shouldn’t
    be an issue. The hole needs to be just big enough for the PIR to poke through.![Image](../images/11fig12.jpg)
  id: totrans-154
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用电钻打一个更大的孔，让PIR可以穿透。最好先钻一个小孔，然后逐渐扩大钻头的尺寸，这样就不会裂开塑料。如果你使用的是木盒，应该没有问题。孔只需要大到足够让PIR穿透即可。![Image](../images/11fig12.jpg)
- en: '**FIGURE 11-12** An example of the finished nature box'
  id: totrans-155
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '**图11-12** 完成的自然盒子示例'
- en: Use mounting putty or double-sided tape to secure the Pi Camera and PIR *inside*
    your box. Alternatively, the Pi Camera and some PIRs have small screw holes that
    you could use to mount them.
  id: totrans-156
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用挂钩胶或双面胶带将Pi Camera和PIR*固定在*你的盒子内。或者，Pi Camera和一些PIR上有小螺丝孔，你也可以用它们进行安装。
- en: Happy nature hunting!
  id: totrans-157
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 祝你自然狩猎愉快！
- en: WRAPPING UP
  id: totrans-158
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 总结
- en: 'Well done, excellent work–you now have a nature box that can sense movement,
    triggering the Pi Camera to take a picture. This image is then uploaded to your
    Dropbox account for you to view and share. Now try the following:'
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 干得好，做得非常棒——现在你拥有一个可以感知运动的自然盒子，触发Pi Camera拍照。然后，这张图片会被上传到你的Dropbox账户，你可以查看并分享。现在试试以下操作：
- en: Use your setup in your bedroom to see who goes in and hopefully out.
  id: totrans-160
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用你的设置放在卧室中，看看谁进来了，并希望能看到他们出去。
- en: Place it near the cookie jar or your stash of chocolate to gather photographic
    evidence of who keeps stealing from you.
  id: totrans-161
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将它放在饼干罐或巧克力藏匿处附近，以便收集拍摄证据，查看是谁一直偷吃你的东西。
- en: Purchase the Pi NoIR Camera, which can be used to take photos at night, in the
    dark.
  id: totrans-162
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 购买Pi NoIR Camera，它可以在夜间或黑暗中拍摄照片。
