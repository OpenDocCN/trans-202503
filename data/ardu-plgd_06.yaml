- en: '**5'
  id: totrans-0
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: '**5'
- en: THE GARAGE SENTRY PARKING ASSISTANT**
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: '**Garage Sentry 停车助手**'
- en: '![image](../images/common-01.jpg)'
  id: totrans-2
  prefs: []
  type: TYPE_IMG
  zh: '![image](../images/common-01.jpg)'
- en: 'This project is a reliable electronic device to gauge the distance you need
    to pull your car into your garage. If you park in a garage, you’re probably familiar
    with the problem: how far do you pull your car into the garage to make sure there’s
    room in front for whatever is there and enough space behind so the garage door
    will close? Some people suspend a tennis ball on a string from the ceiling and
    stop at the point when the ball meets the windshield. That works fine, but the
    ball is a pain to set up and adjust, and it often gets in the way if you want
    to use the garage for something other than parking the car.'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 这个项目是一个可靠的电子设备，用于测量你需要将车开进车库的距离。如果你停车在车库里，可能会遇到这个问题：你应该把车开到车库多远，才能确保前面有足够的空间放置物品，后面又有足够的空间让车库门关上？有些人会在天花板上悬挂一个网球，并在网球接触到挡风玻璃时停车。这种方法有效，但网球的安装和调整很麻烦，且如果你想将车库用于除停车外的其他用途时，网球常常会妨碍你。
- en: Arduino offers a better solution. This Garage Sentry project is the electronic
    version of the classic tennis-ball-on-a-string device, only better. The Garage
    Sentry accurately detects when your car reaches exactly the right position in
    the garage and sets off an alarm that blinks so you know when to hit the brakes.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: Arduino 提供了更好的解决方案。这个 Garage Sentry 项目是经典的“网球挂绳”装置的电子版，只是做得更好。Garage Sentry
    准确地检测你的车是否到达车库的正确位置，并触发一个警报，闪烁的灯光提示你何时踩刹车。
- en: In addition, at the end of the chapter, I’ll show you how to modify the basic
    Garage Sentry into a deluxe version that alerts you when you’re getting close
    to the perfect stopping point.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，在本章末尾，我将展示如何将基本的 Garage Sentry 改造为豪华版，当你接近完美停车位置时，它会发出警报。
- en: '**INSPIRATION BEHIND THE GARAGE SENTRY**'
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: '**Garage Sentry 背后的灵感**'
- en: This project evolved out of playing with an *ultrasonic transceiver module*,
    a device that emits sound waves and then detects them after they travel to an
    object, reflect off that object, and travel back to the module. The output of
    the module allows a microcontroller to measure the time it takes to travel to
    and from the object and, knowing the speed of sound, determine the distance. To
    test the ultrasonic transceiver’s sensitivity and limits, I used the battery-operated
    breadboard version in my garage, which had enough space to move objects around
    for different distances. It turns out cars are great reflectors for ultrasonic
    energy. From this experimentation, I was inspired to turn my test apparatus into
    a Garage Sentry.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 这个项目来源于我玩 *超声波收发模块* 的经验，该设备发出声波并在声波到达物体后被反射回来，模块接收到反射波。模块的输出使得微控制器能够测量声波的往返时间，进而根据已知的声速来计算距离。为了测试超声波收发器的灵敏度和极限，我使用了在车库中的电池供电面包板版本，那里有足够的空间可以测试不同的距离。事实证明，汽车是超声波能量的极好反射体。通过这些实验，我受到了启发，将测试设备转化为
    Garage Sentry。
- en: '**Required Tools**'
  id: totrans-8
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: '**必需工具**'
- en: 'This project doesn’t require many tools or materials, but you will need the
    following tools for both the standard and deluxe versions:'
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 这个项目不需要太多工具或材料，但无论是标准版还是豪华版，你都需要以下工具：
- en: Drill with a 3/8-inch or 1/2-inch chuck (powered by battery or with 110/220V
    from the wall)
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 配备 3/8 英寸或 1/2 英寸夹头的电钻（可由电池驱动，或通过 110/220V 电源）
- en: Drill bits for potentiometer (9/32 inches), power input (1/4 inches), and LED
    (3/8 inches)
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 用于电位器（9/32英寸）、电源输入（1/4英寸）和LED（3/8英寸）的钻头
- en: Soldering iron and solder
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 焊接铁和焊锡
- en: Tapered reamer set
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 锥形扩孔器套件
- en: Philips head and slotted screwdrivers
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 十字螺丝刀和一字螺丝刀
- en: Pliers (I recommend needle nose.)
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 钳子（我推荐使用尖嘴钳。）
- en: (Optional) 1/4-inch tap
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: （可选）1/4英寸螺纹 tapping
- en: '**Parts List**'
  id: totrans-17
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: '**零件清单**'
- en: 'You’ll need the following parts to build the basic Garage Sentry:'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 你将需要以下零件来构建基本版 Garage Sentry：
- en: One Arduino Nano (or clone)
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 一块 Arduino Nano（或克隆版）
- en: One HC-SR04 ultrasonic sensor
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 一只 HC-SR04 超声波传感器
- en: Two high-intensity LEDs (>12,000 MCD)
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 两个高强度 LED（>12,000 MCD）
- en: Two 270-ohm, 1/4 W (or more) resistors (to limit current to the LEDs)
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 两个 270 欧姆、1/4 W（或更多）电阻（用于限制 LED 的电流）
- en: One 20-ohm, 1/8 W potentiometer
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 一只 20 欧姆、1/8 W 的电位器
- en: Two NPN-signal transistors rated for a collector current of at least 1.5 A (I
    used ZTX649 transistors.)
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 两个额定集电极电流至少为 1.5 A 的 NPN 信号晶体管（我使用了 ZTX649 晶体管。）
- en: One enclosure (I recommend a blue Hammond 1591 ATBU, clear 1591 ATCL, or something
    similar.)
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 一个外壳（我推荐使用蓝色的 Hammond 1591 ATBU，透明的 1591 ATCL，或类似的外壳。）
- en: (Optional) One 0.80-inch aluminum strip for mounting bracket
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: （可选）一条0.80英寸的铝条用于安装支架
- en: (Optional) Two 1/4-inch × 20-inch × 3/4-inch bolts with nuts
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: （可选）两颗1/4英寸×20英寸×3/4英寸的螺栓和螺母
- en: One section (approximately 1×1 inch) perforated board (can include copper-foil
    rings on one side)
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 一块大约1×1英寸的打孔板（可以在一侧包含铜箔环）
- en: One 3.5 mm jack
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 一个3.5 mm插孔
- en: Two 2-56×3/8-inch screws and nuts
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 两颗2-56×3/8英寸螺丝和螺母
- en: Two additional 2-56 nuts to use as spacers
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 两颗额外的2-56螺母，用作垫片
- en: One 9V, 100 mA plug-in wall adapter power supply (Anything from 7.5V to 12V
    DC at 100 mA or upward should work well.)
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 一个9V、100 mA插头式墙壁适配器电源（任何7.5V至12V DC，100 mA或更大都应能正常工作）
- en: One piece of double-sided foam tape about 3-inches long
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 一段大约3英寸长的双面泡沫胶带
- en: One LM78L05 (TO-92 package) regulator (for the breadboard build only)
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 一个LM78L05（TO-92封装）调节器（仅适用于面包板版）
- en: 28- or 30-gauge hookup wire
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 28或30号连接线
- en: (Optional) Wire-wrap tool and wire
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: （可选）线包工具和线材
- en: Because the basic version doesn’t require a lot of additional components, I
    suggest building the circuit on a standard perforated circuit board instead of
    a shield. To power your circuit, you can use a 9V, 100 mA wall adapter plugged
    into a 3.5 mm jack (see [Figure 5-1](ch05.xhtml#ch05fig1)). You shouldn’t need
    an on/off switch.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 因为基础版不需要太多额外组件，我建议在标准打孔电路板上构建电路，而不是使用扩展板。为了为电路供电，您可以使用一个9V、100 mA的墙壁适配器，通过3.5
    mm插孔连接（参见[图5-1](ch05.xhtml#ch05fig1)）。您应该不需要开关。
- en: '![image](../images/f05-01.jpg)'
  id: totrans-38
  prefs: []
  type: TYPE_IMG
  zh: '![image](../images/f05-01.jpg)'
- en: '*Figure 5-1: I used a Magnavox AC adapter, but any similar power supply with
    a DC output from 7.5V to 12V should work. These are readily available online and
    cost from under $1.00 to about $3.00*.'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: '*图5-1：我使用的是Magnavox的交流适配器，但任何类似的7.5V至12V的直流输出电源都可以使用。这些电源在网上很容易买到，价格从不到1美元到大约3美元不等*。'
- en: Be sure to use two bright LEDs that are clearly visible, even when a car’s headlights
    are on. Bright LEDs range from 10,000 MCD (milli candela) to more than 200,000
    MCD. The brighter, the better; just remember that brighter LEDs require more power,
    so the current-limiting resistor will need a higher power rating for the brighter
    lamps. The 270-ohm current-limiting resistors result in a current drain of about
    30–40 mA each with the 12,000 MCD LEDs I used at 5V. (Power equals volts times
    amps, or *P* = *VI*, so at 40 mA and 5V, you’d have 0.20 W.) It’s best to use
    a 1/2 W or greater resistor even though you can easily get by with a smaller value—as
    I did with 1/4 W—because the LEDs are on only intermittently.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 请确保使用两颗明亮的LED，即使在汽车前灯开启时也能清晰可见。亮度较高的LED范围从10,000 MCD（毫坎德拉）到超过200,000 MCD。亮度越高越好；不过要记住，亮度更高的LED需要更多的电力，因此限流电阻器需要有更高的功率额定值来配合更亮的灯。使用270欧姆的限流电阻器，在5V时，我使用的12,000
    MCD的LED电流消耗大约是30-40 mA。（功率等于电压乘以电流，或者*P* = *VI*，所以在40 mA和5V的情况下，功率就是0.20 W。）即使您可以用更小的功率值（如1/4
    W）轻松应对，因为LED仅间歇性亮起，还是最好使用1/2 W或更大功率的电阻器。
- en: '**Deluxe Parts**'
  id: totrans-41
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: '**豪华版配件**'
- en: 'In addition to the components for the basic Garage Sentry, you’ll need the
    following extra components if you want to build the deluxe version:'
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 除了基础版车库守卫的组件外，如果您想要构建豪华版，还需要以下额外组件：
- en: Two high-intensity green LEDs
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 两颗高亮度绿色LED
- en: Two high-intensity amber LEDs
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 两颗高亮度琥珀色LED
- en: Two additional 270-ohm, 1/4 W resistors
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 两颗额外的270欧姆、1/4 W电阻器
- en: Two additional NPN-signal transistors One Hammond 1591 BTCL enclosure (to replace
    the 1591 ATCL)
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 两个额外的NPN信号晶体管，一个Hammond 1591 BTCL外壳（替代1591 ATCL）
- en: One PCB (shield)
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 一块PCB（扩展板）
- en: '**Downloads**'
  id: totrans-48
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: '**下载**'
- en: '**Sketches**    *GarageSentry.ino* and *GarageSentryDeluxe.ino*'
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: '**程序文件**    *GarageSentry.ino* 和 *GarageSentryDeluxe.ino*'
- en: '**Drilling template**    *Transducer.pdf*'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: '**钻孔模板**    *Transducer.pdf*'
- en: '**Mechanical drawing**    *Handle.pdf*'
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: '**机械图**    *Handle.pdf*'
- en: '**Shield file for Deluxe Garage Sentry**    *GarageSentryDeluxe.pcb*'
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: '**豪华车库守卫的扩展板文件**    *GarageSentryDeluxe.pcb*'
- en: '**The Schematic**'
  id: totrans-53
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: '**原理图**'
- en: '[Figure 5-2](ch05.xhtml#ch05fig2) shows the schematic for the Garage Sentry.
    R1 and R3 are the 270-ohm resistors for the LEDs and should be 1/4 W or larger.
    If a higher wattage resistor is not available, you could place several resistors
    in parallel to gain the required wattage. First, find the right resistor value
    with the formula:'
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: '[图5-2](ch05.xhtml#ch05fig2)显示了车库守卫的原理图。R1和R3是LED的270欧姆电阻器，应该是1/4 W或更大功率。如果没有更大功率的电阻器，可以将几个电阻器并联使用来达到所需的功率。首先，使用公式找出正确的电阻值：'
- en: '![image](../images/e0132-01.jpg)'
  id: totrans-55
  prefs: []
  type: TYPE_IMG
  zh: '![image](../images/e0132-01.jpg)'
- en: You can also use an automatic calculator, such as the one at *[http://www.1728.org/resistrs.htm](http://www.1728.org/resistrs.htm)*,
    which is a lot easier than doing the math yourself.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 你还可以使用自动计算器，例如 *[http://www.1728.org/resistrs.htm](http://www.1728.org/resistrs.htm)*，这比自己做数学计算要容易得多。
- en: '![image](../images/f05-02.jpg)'
  id: totrans-57
  prefs: []
  type: TYPE_IMG
  zh: '![image](../images/f05-02.jpg)'
- en: '*Figure 5-2: Schematic diagram of the Garage Sentry*'
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: '*图 5-2：车库哨兵的示意图*'
- en: To avoid extra calculations, select resistors of the same value. This way, the
    same amount of current flows through each one. For example, two 1/8 W resistors
    in parallel will give you a 1/4 W value.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 为了避免额外的计算，选择相同值的电阻器。这样，相同数量的电流会通过每个电阻器。例如，两个 1/8 W 的电阻并联将得到 1/4 W 的值。
- en: If you do use resistors of different values, you will have to calculate the
    current flowing through each and the total dissipation.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你使用不同值的电阻器，你将不得不计算每个电阻器通过的电流以及总的功耗。
- en: This schematic also leaves you with room to customize your alarm. While this
    version of the project uses LEDs to create a visual alarm, with a slight modification,
    you can easily create an audible alarm as well. Simply replace either the red
    or blue LED with an audible device, such as a Sonotone Sonalert, and the alarm
    will sound. To replace an LED, you would need to connect the Sonalert across that
    LED’s connections; just make sure to get the polarity correct. Alternatively,
    you could keep both LEDs and add an audible device for a third warning.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 这个原理图还为你定制报警提供了空间。虽然该版本的项目使用 LED 来创建视觉报警，但只需稍作修改，你也可以轻松创建可听到的报警。只需将红色或蓝色 LED
    替换为可听设备，例如 Sonotone Sonalert，报警就会响起。要替换 LED，你需要将 Sonalert 连接到该 LED 的两端；只需确保极性正确。或者，你可以保留两个
    LED 并为第三个警告添加可听设备。
- en: '**NOTE**'
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: '**注意**'
- en: '*In this project, the Nano takes advantage of its on-board voltage regulator,
    which is why there’s no external regulator in the schematic*.'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: '*在这个项目中，Nano 利用了其板载电压调节器，这就是为什么原理图中没有外部调节器的原因*。'
- en: '**Basics of Calculating Distance**'
  id: totrans-64
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: '**计算距离的基础**'
- en: This project measures the time it takes for a sound to originate, bounce off
    an object, and be received back at the point of origin, and it uses that time
    to calculate the distance between the object and the sensor.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 这个项目测量声音从起点发出、反射回物体并重新传回起点所需的时间，并利用该时间计算物体与传感器之间的距离。
- en: 'The basic distance calculation is not much different from determining the distance
    of a storm by counting the seconds between a lightning flash and a thunderclap.
    Each second represents a distance of 1,125 feet, or about 0.2 miles. Given that
    sound travels at 1,125 feet per second in air at sea level, if there’s a five-second
    delay between a lightning flash and the thunderclap, you can determine that the
    storm is roughly a mile away. In the case of the Garage Sentry, once you know
    how long it takes for the sound to make a round trip and know the speed of sound,
    you can calculate the distance according to the time-speed-distance formula:'
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 基本的距离计算与通过计算闪电和雷声之间的秒数来确定暴风雨的距离差不多。每一秒钟代表 1,125 英尺的距离，约合 0.2 英里。由于声音在海平面上的传播速度为每秒
    1,125 英尺，如果闪电和雷声之间有五秒钟的延迟，你可以确定暴风雨大约离你 1 英里远。在车库哨兵的情况下，一旦你知道声音来回所需的时间，并知道声音的传播速度，你可以根据时间-速度-距离公式计算出距离：
- en: Distance = Speed × Time
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 距离 = 速度 × 时间
- en: '**How the Garage Sentry Works**'
  id: totrans-68
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: '**车库哨兵的工作原理**'
- en: This project takes advantage of *ultrasonic sound*, which, unlike thunder, is
    above the hearing range of most individuals. If your hearing is good, you can
    detect sound ranging from about 30 Hz to close to 20 kHz, although hearing attenuates
    quickly above 10 kHz or 15 kHz.
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 这个项目利用了*超声波*，它与雷声不同，超出了大多数人的听力范围。如果你的听力很好，你可以检测到约 30 Hz 到接近 20 kHz 之间的声音，尽管听力在超过
    10 kHz 或 15 kHz 后会迅速衰退。
- en: '**NOTE**'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: '**注意**'
- en: '*For reference, middle C on the piano is 261.6 Hz. Young children (and most
    dogs) can often hear high frequencies, but hearing, especially in the upper registers,
    deteriorates quickly with age*.'
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: '*作为参考，钢琴上的中央 C 是 261.6 Hz。幼儿（以及大多数狗）通常能够听到高频声音，但随着年龄的增长，听力，特别是高频部分，会迅速下降*。'
- en: 'The ultrasonic transceiver module used in this project sends out pulses at
    a frequency of about 25 kHz and listens for an echo with a microphone. If there
    is something for the signal to bounce off, the system receives the return echo
    and tells the microcontroller a signal has been received and to calculate the
    distance. For the Garage Sentry, the unit is placed in the front of the garage,
    and the signal is sent out to bounce off the front—or rear if you are backing
    in—of your vehicle. To calculate your car’s distance from the ultrasonic transceiver,
    the Arduino measures the time it takes for the signal’s round trip from the transceiver
    to the target and back. For example, if the Arduino measures a time of 10 milliseconds
    (0.010 seconds), you might calculate the distance as:'
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 本项目中使用的超声波收发模块以大约 25 kHz 的频率发出脉冲，并通过麦克风监听回声。如果信号碰到物体反射回波，系统会接收返回的回声，并告知微控制器已接收到信号，并进行距离计算。对于
    Garage Sentry，该模块被放置在车库前方，信号会发射并反射到汽车的前部——如果你是倒车，则是反射到后部。为了计算汽车距离超声波收发器的距离，Arduino
    会测量信号从收发器到目标并返回的往返时间。例如，如果 Arduino 测得时间为 10 毫秒（0.010 秒），你可以这样计算距离：
- en: '![image](../images/e0134-01.jpg)'
  id: totrans-73
  prefs: []
  type: TYPE_IMG
  zh: '![image](../images/e0134-01.jpg)'
- en: 'Ah, but not so fast. Remember the signal is traveling to the car and then back
    to the microphone. To get the correct distance to the vehicle, we will have to
    divide by two. If the controller measures 10 milliseconds, then the distance to
    your car would be:'
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 啊，但别急。记住，信号是先到达汽车再返回到麦克风的。为了获得正确的车辆距离，我们需要将测得的时间除以二。如果控制器测得 10 毫秒，那么到汽车的距离就是：
- en: '![image](../images/e0134-02.jpg)'
  id: totrans-75
  prefs: []
  type: TYPE_IMG
  zh: '![image](../images/e0134-02.jpg)'
- en: The HC-SR04 ultrasonic module sends out a signal at the instruction of the Arduino
    (see [Figure 5-3](ch05.xhtml#ch05fig3)). Then, the sketch instructs the transmitter
    to shut down, and the microphone listens for an echo.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: HC-SR04 超声波模块在 Arduino 的指令下发送信号（见 [图 5-3](ch05.xhtml#ch05fig3)）。然后，草图指示发射器关闭，麦克风监听回声。
- en: '![image](../images/f05-03.jpg)'
  id: totrans-77
  prefs: []
  type: TYPE_IMG
  zh: '![image](../images/f05-03.jpg)'
- en: '*Figure 5-3: The ultrasonic sensor module. The back of the module (bottom)
    has connection terminals at the bottom*.'
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: '*图 5-3：超声波传感器模块。模块的背面（底部）有连接端子*。'
- en: If there is an object for the signal to bounce off, the microphone picks up
    the reflected signal. The Arduino marks the exact time the signal is sent out
    and the time it is received and then calculates the delay.
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 如果有物体让信号反射，麦克风就会接收到反射的信号。Arduino 记录信号发送和接收的准确时间，然后计算延迟。
- en: 'The HC-SR04 module is more than a speaker and microphone, though. The module
    includes transducers—a loudspeaker and mic—and a lot of electronics, including
    at least three integrated circuits, a crystal, and several passive components.
    These components simplify its interface to the Arduino: the 25 kHz tone is actually
    generated by the module and turned on and off with the microcontroller. Some of
    the components also enhance the receiver’s, or the microphone’s, sensitivity,
    which gives it a better range.'
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: HC-SR04 模块不仅仅是一个扬声器和麦克风。该模块包含换能器——扬声器和麦克风——以及大量电子元件，包括至少三个集成电路、一个晶体和若干个无源元件。这些元件简化了其与
    Arduino 的接口：25 kHz 的音调实际上是由模块生成，并通过微控制器打开和关闭。一些组件还增强了接收器或麦克风的灵敏度，使其具有更好的探测范围。
- en: The range of the HC-SR04 ultrasonic transducer is approximately 10 to 12 feet.
    The returning signal is always a lot weaker than the transmitted signal because
    some of the sound wave’s energy dissipates in the air (see the dotted lines in
    [Figure 5-4](ch05.xhtml#ch05fig4)).
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: HC-SR04 超声波换能器的范围大约是 10 到 12 英尺。返回的信号总是比发送的信号要弱，因为一些声波能量在空气中散失（见 [图 5-4](ch05.xhtml#ch05fig4)
    中的虚线）。
- en: '![image](../images/f05-04.jpg)'
  id: totrans-82
  prefs: []
  type: TYPE_IMG
  zh: '![image](../images/f05-04.jpg)'
- en: '*Figure 5-4: In this project, sound is transmitted from a sender, bounces off
    an object, and is received*.'
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: '*图 5-4：在本项目中，声音从发射器传出，碰到物体后反射并被接收*。'
- en: The arithmetic to calculate the distance between the sender and the object is
    not difficult. You take the number of microseconds it takes for the signal to
    return, divide by the 73.746 microseconds it takes sound to travel an inch, and
    then divide by two because the signal is going out and coming back. The full arithmetic
    for this appears later in “[Determining Distance](ch05.xhtml#ch05lev2sec3)” on
    [page 141](ch05.xhtml#page_141).
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 计算发射器与物体之间的距离并不困难。你只需要拿到信号返回所需的微秒数，除以声音在1英寸中传播所需的73.746微秒，然后再除以2，因为信号是先出去再返回的。这个完整的计算方法将在“[确定距离](ch05.xhtml#ch05lev2sec3)”一节的[第141页](ch05.xhtml#page_141)中详细介绍。
- en: The sketch provides a response in inches or centimeters depending on your preference.
    We’ll use inches for setting up the distance for the alarm, but converting to
    centimeters simply requires a remapping of the analog input and setting the numbers
    a bit differently. The sketch also does the basic arithmetic for determining the
    centimeter measurement for you.
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 这个草图提供了一个以英寸或厘米为单位的响应，具体取决于你的偏好。我们将使用英寸来设置报警的距离，但转换为厘米只需要重新映射模拟输入，并略微调整数字。这个草图还会为你执行基本的算术运算，以确定厘米的测量值。
- en: With the high-level overview out of the way, let’s dig in to how you’ll wire
    the Garage Sentry.
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 在高层概述之后，让我们深入了解如何接线Garage Sentry。
- en: '**The Breadboard**'
  id: totrans-87
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: '**面包板**'
- en: The entire Garage Sentry fits on a small breadboard, so you can set it up, program
    it, power it with a battery, and walk around to test it out. As you play with
    it, I’m sure other applications of ultrasonic technology will come to mind.
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 整个Garage Sentry可以放在一个小型面包板上，你可以将它搭建好，进行编程，用电池供电，并四处走动进行测试。随着你玩这个项目，我相信会想到超声波技术的其他应用。
- en: The breadboard I assembled, shown in [Figure 5-5](ch05.xhtml#ch05fig5), is powered
    by a 9V battery. Usually, you could wire the battery directly to the VIN of the
    Nano and use the Nano’s built-in voltage regulator. But you’ll power the Nano
    with a USB cable when you program and test it for the first time, so on the breadboard,
    you’ll set up the positive and negative rails for 5V for both the Nano and the
    ultrasonic module. To avoid risking damage to the Nano or the module and avoid
    overcomplicating the build, I included a single-chip external voltage regulator
    (LM78L05) so the entire breadboard runs on 5V. Take a look at [Figure 5-6](ch05.xhtml#ch05fig6)
    to see how it’s wired up.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 我组装的面包板，如[图 5-5](ch05.xhtml#ch05fig5)所示，使用了9V电池供电。通常，你可以将电池直接接到Nano的VIN引脚，并使用Nano内置的电压调节器。但在第一次编程和测试时，你将通过USB电缆为Nano供电，所以在面包板上，你需要为Nano和超声波模块分别设置5V的正负轨。为了避免损坏Nano或模块，并避免使电路过于复杂，我加入了一个单芯片外部电压调节器（LM78L05），使整个面包板都能稳定在5V电压下工作。请查看[图
    5-6](ch05.xhtml#ch05fig6)，看看它是如何接线的。
- en: '![image](../images/f05-05.jpg)'
  id: totrans-90
  prefs: []
  type: TYPE_IMG
  zh: '![image](../images/f05-05.jpg)'
- en: '*Figure 5-5: Here’s the breadboard wired up. I used a 9V battery so I could
    experiment in different environments. Both LEDs look illuminated because of the
    length of the exposure of the camera*.'
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: '*图 5-5：这是已经接线的面包板。我使用了一块9V电池，这样可以在不同环境下进行实验。由于相机曝光时间的长度，两颗LED都显得亮着。*'
- en: '![image](../images/f05-06.jpg)'
  id: totrans-92
  prefs: []
  type: TYPE_IMG
  zh: '![image](../images/f05-06.jpg)'
- en: '*Figure 5-6: This is how the LM78L05 TO-92 regulator is wired up on the breadboard.
    Bypass/filter capacitors are not required*.'
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: '*图 5-6：这是LM78L05 TO-92电压调节器在面包板上的接线方式。旁路/滤波电容器不是必需的。*'
- en: 'Here’s a blow-by-blow list of the steps to wire the breadboard:'
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 下面是接线面包板的详细步骤列表：
- en: First, put the ultrasonic module at the lower end of the breadboard facing out,
    and plug the Nano in to the breadboard, leaving four rows of connections above
    it.
  id: totrans-95
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 首先，将超声波模块放置在面包板的下端，面向外侧，然后将Nano插入面包板，确保其上方留出四行连接。
- en: Make sure the positive and negative rails (red and blue stripes) on the left
    and right are connected properly—red to red, blue to blue. If you connect red
    to blue, it will cause a major problem.
  id: totrans-96
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 确保左侧和右侧的正负轨（红色和蓝色条纹）连接正确——红接红，蓝接蓝。如果将红色连接到蓝色，将会导致严重的问题。
- en: Connect the red positive rail to the 5V power supply (pin 27 of the Nano, labeled
    *5V*). This is necessary if you are operating from the USB connector.
  id: totrans-97
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将红色正轨连接到5V电源（Nano的引脚27，标记为*5V*）。如果你通过USB连接供电，这一步是必要的。
- en: Connect pin 4 of the Nano (labeled *GND*) to the breadboard’s blue negative
    rail.
  id: totrans-98
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将Nano的引脚4（标记为*GND*）连接到面包板的蓝色负轨。
- en: Connect VCC of the HC-SR04 transducer to the red positive rail.
  id: totrans-99
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将HC-SR04传感器的VCC引脚连接到红色正轨。
- en: Connect GND of the HC-SR04 transducer to the blue negative rail.
  id: totrans-100
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将HC-SR04传感器的GND引脚连接到蓝色负电源轨。
- en: Connect TRIG of the HC-SR04 transducer to pin 15 (D12) of the Nano.
  id: totrans-101
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将HC-SR04传感器的TRIG引脚连接到Nano的第15号引脚（D12）。
- en: Connect ECHO of the HC-SR04 transducer to pin 14 (D11) of the Nano.
  id: totrans-102
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将HC-SR04传感器的ECHO引脚连接到Nano的第14号引脚（D11）。
- en: Insert two ZTX649 transistors into the breadboard. Select an area where all
    three pins of each transistor can have their own row.
  id: totrans-103
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将两只ZTX649晶体管插入面包板中。选择一个区域，使每只晶体管的三个引脚都有自己的行。
- en: Connect pin 12 (D9) of the Nano to the base of transistor Q1.
  id: totrans-104
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将Nano的第12号引脚（D9）连接到晶体管Q1的基极。
- en: Connect pin 13 (D10) of the Nano to the base of transistor Q2.
  id: totrans-105
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将Nano的第13号引脚（D10）连接到晶体管Q2的基极。
- en: Connect the collectors of both transistors to the red positive rail.
  id: totrans-106
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将两个晶体管的集电极连接到红色正电源轨。
- en: Connect the emitter of transistor Q1 to one end of a 270-ohm resistor.
  id: totrans-107
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将晶体管Q1的发射极连接到一个270欧姆电阻的一端。
- en: Connect the other end of the 270-ohm resistor connected to the emitter of transistor
    Q1 to a blank row on the breadboard.
  id: totrans-108
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将连接到晶体管Q1发射极的270欧姆电阻的另一端连接到面包板上的一个空白行。
- en: Connect the emitter of transistor Q2 to one end of another 270-ohm resistor.
    Connect the other end of the 270-ohm resistor connected to the emitter of transistor
    Q2 to another blank row on the breadboard.
  id: totrans-109
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将晶体管Q2的发射极连接到另一个270欧姆电阻的一端。将连接到晶体管Q2发射极的270欧姆电阻的另一端连接到面包板上的另一个空白行。
- en: Connect the + (long end) of LED (D1) to the 270-ohm resistor and the other end
    to the blue negative rail.
  id: totrans-110
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将LED（D1）的+（长端）连接到270欧姆电阻，并将另一端连接到蓝色负电源轨。
- en: Connect the + (long end) of LED (D2) to the second 270-ohm resistor and the
    other end to the blue negative rail.
  id: totrans-111
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将LED（D2）的+（长端）连接到第二个270欧姆电阻，并将另一端连接到蓝色负电源轨。
- en: Connect one end of the 20-ohm potentiometer to the red positive rail.
  id: totrans-112
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将一个20欧姆电位器的一端连接到红色正电源轨。
- en: Connect the opposite end of the potentiometer to the blue negative rail.
  id: totrans-113
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将电位器的另一端连接到蓝色负电源轨。
- en: Connect the wiper (center) of the potentiometer to analog pin A0 (26) of the
    Nano.
  id: totrans-114
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将电位器的滑动端（中间引脚）连接到Nano的模拟引脚A0（26）。
- en: '![image](../images/f05-07.jpg)'
  id: totrans-115
  prefs: []
  type: TYPE_IMG
  zh: '![image](../images/f05-07.jpg)'
- en: '*Figure 5-7: Pinout of the 78L05 regulator*'
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: '*图5-7：78L05稳压器的引脚图*'
- en: You should be good to go! If you use the AC connection, simply connect it to
    the VCC connection of the Nano.
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 你应该准备好开始了！如果使用交流电连接，只需将其连接到Nano的VCC引脚。
- en: To add a battery connection, include the 78L05 with its center pin to ground
    (negative rail), the input to the positive side of the battery, and the output
    to the positive rail (see [Figure 5-7](ch05.xhtml#ch05fig7)). Connect the negative
    terminal of the battery to the negative rail.
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 要添加电池连接，需将78L05的中心引脚连接到地（负电源轨），输入端连接到电池的正极，输出端连接到正电源轨（参见[图5-7](ch05.xhtml#ch05fig7)）。将电池的负极连接到负电源轨。
- en: '**The Sketch**'
  id: totrans-119
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: '**草图**'
- en: Once the breadboard is complete, the sketch can be loaded onto the Nano. Download
    the *GarageSentry.ino* file from *[https://www.nostarch.com/arduinoplayground/](https://www.nostarch.com/arduinoplayground/)*.
    To load the file onto the Nano, follow the instructions outlined in “[Uploading
    Sketches to Your Arduino](ch00.xhtml#ch00lev1sec3)” on [page 5](ch00.xhtml#page_5).
    Remember to select the correct board type. Once it’s loaded, the unit is ready
    for experimentation.
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦面包板完成，草图可以加载到Nano上。下载*GarageSentry.ino*文件，地址为*[https://www.nostarch.com/arduinoplayground/](https://www.nostarch.com/arduinoplayground/)*。要将文件加载到Nano上，按照“[上传草图到你的Arduino](ch00.xhtml#ch00lev1sec3)”中的说明操作，详见[第5页](ch00.xhtml#page_5)。记得选择正确的板类型。加载完成后，设备即可进行实验。
- en: The sketch for the Garage Sentry serves several functions. It tells the ultrasonic
    sensor to generate a wave and detects how long it takes the echo to return. It
    then calculates the distance based on that time and, if necessary, alerts you
    to stop by turning on the LEDs. Here’s the sketch in full; I’ll walk you through
    it next.
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: Garage Sentry的草图有多个功能。它告诉超声波传感器生成一个波，并检测回波返回的时间。然后，基于该时间计算距离，并在必要时通过点亮LED发出停止警报。以下是完整的草图；接下来我会详细讲解。
- en: '[PRE0]'
  id: totrans-122
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: First, we define several variables, establish parameters, and load libraries
    (if any). In this case, define `ledPin` and `ledPin1`, which will serve as the
    alarm. Other definitions (`int`) include `cm` and `count` (a variable that will
    be used internally), `analogPin` (as A0), `val` (to hold the limit information),
    and `y` (used in the loop).
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们定义几个变量，设置参数，并加载库（如果有的话）。在此情况下，定义`ledPin`和`ledPin1`，它们将作为警报。其他定义（`int`）包括`cm`和`count`（一个将在内部使用的变量）、`analogPin`（作为A0）、`val`（用于存储限制信息）和`y`（用于循环中）。
- en: '***Inside the setup() Function***'
  id: totrans-124
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: '***在 setup() 函数内部***'
- en: Next is the `setup()` function. Here, you set up Arduino features that you might
    want to use; this sketch includes the serial monitor, which you probably will
    not need in the final product but is often useful in debugging code, particularly
    if you want to change the code. This sketch sets the rate of the monitor at 9600
    baud, which is standard in many applications. It also defines the mode of the
    pins you’ll use as either input or output. You could set the `pinMode` values
    at almost any point in the code, including before or inside the setup; they’re
    also often defined within the main loop, particularly if the definitions are expected
    to change.
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来是 `setup()` 函数。在这里，你设置你可能需要使用的 Arduino 特性；这个草图包括串口监视器，尽管你可能在最终产品中不需要它，但它在调试代码时通常非常有用，尤其是当你想修改代码时。这个草图将监视器的速率设置为
    9600 波特，这是许多应用程序中的标准设置。它还定义了你将使用的引脚模式，设定为输入或输出。你可以在代码中的几乎任何位置设置 `pinMode` 的值，包括在
    setup 之前或其中；它们也常常在主循环中定义，特别是当这些定义预期会发生变化时。
- en: '***Inside the loop() Function***'
  id: totrans-126
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: '***在 loop() 函数内部***'
- en: The `loop()` function is where everything really happens. The loop continually
    executes unless it’s delayed or halted by a command. So even when it appears that
    nothing is happening, the controller is continually cycling through the code.
    In this application, one of the first tasks the controller performs in the loop
    is to set the variable `val` to store the input from the potentiometer connected
    to the analog pin (`analogPin`).
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: '`loop()` 函数是所有操作真正发生的地方。循环会不断执行，除非被命令延迟或暂停。所以即使看起来什么也没发生，控制器也会不断循环执行代码。在这个应用程序中，控制器在循环中的第一项任务是设置变量
    `val` 来存储来自连接到模拟引脚（`analogPin`）的电位计输入。'
- en: In order to initiate the ultrasonic module’s transmit/receive function, the
    sketch first calls for a low signal to be sent to the transmitter (`TRIG`) to
    purge the module to assure that the following high signal will be clean. You can
    see this in the lines starting at ➊.
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 为了启动超声模块的发送/接收功能，草图首先会调用低信号发送给发射器（`TRIG`），清除模块以确保接下来的高信号是干净的。你可以在从 ➊ 开始的几行代码中看到这一点。
- en: Next, there’s a delay to let things settle before the sketch writes a high to
    the transmit pin, which orders the transmitter to transmit an ultrasonic signal.
    This is followed by another delay, and then the sketch drives digital pin 12 low
    to turn off the transmitter and activates the receiver by calling the `pulseIn()`
    method.
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，会有一个延迟，让系统稳定下来，然后草图会向传输引脚写入高电平，命令发射器发送超声波信号。紧接着是另一个延迟，然后草图将数字引脚 12 设置为低电平，关闭发射器，并通过调用
    `pulseIn()` 方法激活接收器。
- en: '***Determining Distance***'
  id: totrans-130
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: '***确定距离***'
- en: If there’s no echo—that is, if `inches == 0` or inches approaches infinity—the
    controller continues to run the code until it reaches the end and then starts
    again at the beginning. If it detects an echo, the number of microseconds between
    turning the transmitter on and receiving signal (`duration`) is then converted
    to both inches and centimeters. This gives us a measurement of how far the transceiver
    is from the object. Note that throughout this explanation, I will refer to inches,
    but you could follow along in centimeters, too.
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 如果没有回声——也就是说，如果 `inches == 0` 或者英寸接近无穷大——控制器会继续运行代码，直到它到达结束位置，然后从头开始。如果检测到回声，微秒数（`duration`）会从发射器开启到接收到信号的时间，这个值会转换成英寸和厘米。这给了我们一个测量值，表示收发器距离物体的距离。请注意，在整个解释过程中，我将使用英寸单位，但你也可以使用厘米单位来理解。
- en: The `microsecondsToInches()` and `microsecondsToCentimeters()` commands convert
    the time measurement to inches and centimeters, respectively, according to the
    arithmetic discussed in “[How the Garage Sentry Works](ch05.xhtml#ch05lev1sec7)”
    on [page 134](ch05.xhtml#page_134). The data type `long` is used, as opposed to
    `int`, because it provides 4 bytes of data storage instead of just 2, and the
    number of microseconds could exceed the 2-byte limit of 32,767 bits. So far, so
    good.
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: '`microsecondsToInches()` 和 `microsecondsToCentimeters()` 命令根据“[车库哨兵工作原理](ch05.xhtml#ch05lev1sec7)”一节的算式，将时间测量值分别转换为英寸和厘米，详见
    [第 134 页](ch05.xhtml#page_134)。使用 `long` 数据类型，而不是 `int`，是因为 `long` 提供 4 字节的数据存储，而不是仅有的
    2 字节，并且微秒数可能会超过 2 字节的限制 32,767 位。到目前为止，一切顺利。'
- en: 'In a regular formula, the distance arithmetic looks like this:'
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 在常规公式中，距离的计算看起来是这样的：
- en: '![image](../images/e0141-01.jpg)![image](../images/e0141-02.jpg)'
  id: totrans-134
  prefs: []
  type: TYPE_IMG
  zh: '![image](../images/e0141-01.jpg)![image](../images/e0141-02.jpg)'
- en: In either case, we first divide by 2 because the signal travels from the transducer
    to the target and back, as previously discussed. In the inches function, we then
    divide the halved number of microseconds by 74, and in the centimeters function,
    we divide by 29\. (It takes 74 microseconds for the signal to travel 1 inch, and
    29 microseconds for it to travel 1 centimeter; I arrived at those numbers by following
    the arithmetic in “[Time-to-Distance Conversion Factors](ch05.xhtml#ch05note1)”
    on [page 142](ch05.xhtml#page_142).)
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 在任一情况下，我们首先除以2，因为信号从换能器传到目标再返回，正如之前所讨论的那样。在英寸函数中，我们将折半后的微秒数除以74，在厘米函数中，我们除以29。（信号传播1英寸需要74微秒，传播1厘米需要29微秒；我通过遵循“[时间与距离转换系数](ch05.xhtml#ch05note1)”中的算式得出了这些数字，详见[第142页](ch05.xhtml#page_142)）
- en: '**TIME-TO-DISTANCE CONVERSION FACTORS**'
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: '**时间与距离转换系数**'
- en: You could simply trust my math and copy the time-to-distance conversion code,
    but you can apply this arithmetic to any project using a similar ultrasonic module
    or other sensor, so I encourage you to work through the math yourself.
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以直接相信我的数学计算并复制时间到距离的转换代码，但你也可以将这段算式应用到任何使用类似超声模块或其他传感器的项目中，因此我鼓励你自己计算一下。
- en: As I describe in “[How the Garage Sentry Works](ch05.xhtml#ch05lev1sec7)” on
    [page 134](ch05.xhtml#page_134), the speed of sound is roughly 1,125 feet per
    second. Multiply that by 12 inches per foot to get 13,500 inches per second.
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 如我在“[车库监控器工作原理](ch05.xhtml#ch05lev1sec7)”中所述，声音速度大约是每秒1,125英尺。将其乘以每英尺12英寸，得到每秒13,500英寸。
- en: 'To get the number of seconds per inch, you simply divide this value by 13,500
    inches:'
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 要得到每英寸的秒数，只需将此值除以13,500英寸：
- en: '![image](../images/e0142-01.jpg)'
  id: totrans-140
  prefs: []
  type: TYPE_IMG
  zh: '![image](../images/e0142-01.jpg)'
- en: It takes about 74 microseconds, or 0.000074 seconds, for sound to travel an
    inch. To determine the distance in centimeters, go through the same exercise,
    but use 343 meters per second for the speed of sound, multiply it by 100 centimeters
    per meter, and take the reciprocal.
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 声音传播1英寸大约需要74微秒，即0.000074秒。要计算厘米的距离，可以进行相同的操作，但使用343米每秒的声音传播速度，乘以每米100厘米，并取倒数。
- en: '*Triggering the Alarm*'
  id: totrans-142
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: '*触发警报*'
- en: The sketch is not done yet. Now we have to look at the number of inches (or
    centimeters) measured and compare it to the predetermined value—`val`, in this
    case—to see whether the alarm should be activated. To establish the variable `val`
    as a numeric value, take a potentiometer (R2) straddling the power supply on either
    end and tie the wiper to pin A0 (see [Figure 5-2](ch05.xhtml#ch05fig2)). Because
    A0 is the input to a 10-bit analog-to-digital converter, it converts that voltage
    (between 0V and 5V) to a numeric digital value between 0 and 1,023\. Reading that
    value with an `analogRead()` command results in a value between 0 and 1,023 depending
    on the position of the potentiometer.
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 草图还没有完成。现在我们需要查看测量的英寸（或厘米）数，并将其与预定的值——在此案例中是`val`——进行比较，以确定是否应激活警报。为了将变量`val`设定为数值，取一个跨越电源的电位器（R2），将刮片连接到A0引脚（见[图5-2](ch05.xhtml#ch05fig2)）。因为A0是一个10位模拟到数字转换器的输入，它将电压（介于0V和5V之间）转换为介于0和1,023之间的数字值。使用`analogRead()`命令读取该值时，结果将在0到1,023之间，具体取决于电位器的位置。
- en: That value is then used to establish the trigger point for the alarm. But allowing
    all 1,024 values would essentially allow the distance to be set from 0 to 1,023
    inches. Because the control rotates only 270 degrees, to adjust between, say,
    40 and 42 inches would represent a very minuscule rotation—beyond the granularity
    of most potentiometers.
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 然后将该值用于设定警报的触发点。但允许所有1,024个值实际上会使距离范围从0到1,023英寸。由于控制器仅旋转270度，因此调整例如40到42英寸之间的距离将代表一个非常微小的旋转——超出了大多数电位器的分辨率。
- en: 'To scale this for the potentiometer, the sketch maps the value so the entire
    rotation of the potentiometer represents a distance of only about 100 inches with
    the following line of code:'
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 为了将此应用于电位器，草图将该值映射，使电位器的整个旋转表示大约100英寸的距离，代码如下：
- en: '[PRE1]'
  id: totrans-146
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: Mapping the potentiometer value changes the maximum distance from 1,023 inches
    down to 100 inches while leaving the minimum distance of 0 inches unchanged. You
    can map any set of values so the Garage Sentry’s target distance can be from *X*
    to *Y*, with full rotation of the potentiometer, so when you set up your Garage
    Sentry, you may want to test it and this range until it’s right for your garage.
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 映射电位器的值会将最大距离从1,023英寸缩小到100英寸，同时保持最小距离0英寸不变。你可以映射任何一组值，这样车库卫士的目标距离可以从*X*到*Y*，电位器完全旋转时，设置好车库卫士后，你可能需要测试这个范围，直到它适合你的车库。
- en: 'A conditional control structure sets the limit for the alarm. This structure
    makes sure that the LED is turned off when the measured distance is 0, regardless
    of whether the sketch is using inches or centimeters. First, the value `inches`
    is compared to `val` in the following expression:'
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 一个条件控制结构设置了警报的限制。这个结构确保当测量的距离为0时，无论草图使用的是英寸还是厘米，LED都会关闭。首先，`inches`的值会与`val`进行比较，表达式如下：
- en: '[PRE2]'
  id: totrans-149
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: If this statement is true, the alarm is set off and the `for` loop at ➋ is activated
    (see [page 139](ch05.xhtml#page_139)), which alternately blinks the LEDs 200 times
    before timing out and turning the LEDs off.
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 如果该语句为真，警报会被触发，且➋处的`for`循环会被激活（见[第139页](ch05.xhtml#page_139)），该循环交替闪烁LED 200次，直到超时并将LED关闭。
- en: The `for` loop just counts from 0 to 200, but that can be easily changed. After
    each count, it turns on an LED, delays briefly and turns off the same LED, delays
    slightly and turns on a second LED, delays slightly and turns off the LED, and
    then goes to the next count. At the end of the 200 count, the system turns off
    the LEDs and the program continues to the next line where it is reset. That is,
    the program starts again at the beginning.
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: '`for`循环仅从0数到200，但可以很容易地修改。每次计数后，它会打开一个LED，短暂延迟后关闭该LED，再稍微延迟打开第二个LED，再稍微延迟关闭该LED，然后进入下一个计数。在200次计数结束时，系统会关闭LED，程序继续到下一行，重新开始。也就是说，程序会从头开始。'
- en: '**Construction**'
  id: totrans-152
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: '**结构**'
- en: '[Figure 5-8](ch05.xhtml#ch05fig8) shows the enclosure for the Garage Sentry.'
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: '[图 5-8](ch05.xhtml#ch05fig8)显示了车库卫士的外壳。'
- en: '![image](../images/f05-08.jpg)'
  id: totrans-154
  prefs: []
  type: TYPE_IMG
  zh: '![image](../images/f05-08.jpg)'
- en: '*Figure 5-8: The basic Garage Sentry uses wire wrap for the final connections*.'
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: '*图 5-8：基础车库卫士使用导线包绕进行最终连接*。'
- en: The trickiest part of the Garage Sentry is mounting the ultrasonic module on
    the enclosure. Because the module can send out sound waves only in a straight
    line, you need to be able to adjust its direction so that the ultrasonic sensor
    can hit its target and receive the echo. But the module includes only two mounting
    holes, diagonally opposed from each other, so there’s no easy way to fasten it
    to a flexible mounting. We’ll tackle that first.
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 车库卫士最棘手的部分是将超声波模块安装到外壳上。由于该模块只能沿直线发射声波，因此你需要能够调整其方向，以便超声波传感器能够击中目标并接收回波。但该模块仅包括两个对角安装孔，因此没有简单的方法将其固定到一个灵活的安装架上。我们将首先解决这个问题。
- en: '***Drilling Holes for the Electronics***'
  id: totrans-157
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: '***为电子设备钻孔***'
- en: To solve this problem, I mounted the transceiver directly to the enclosure and
    just aimed the enclosure as required. To mount the module, drill 5/8-inch holes
    in the enclosure and use standoffs to hold the board securely. See the template
    in [Figure 5-9](ch05.xhtml#ch05fig9) for drilling measurements. A PDF of the template
    is available in this book’s online resources at *[https://www.nostarch.com/arduinoplayground/](https://www.nostarch.com/arduinoplayground/)*,
    in case you want to print it and lay it over your enclosure as a guide. The enclosure
    I recommend is made of polycarbonate plastic and is less likely to crack than
    styrene or acrylic; however, it tends to catch the drill, so be careful.
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 为了解决这个问题，我将收发器直接安装到外壳上，并根据需要调整外壳的方向。为了安装模块，需要在外壳上钻5/8英寸的孔，并使用支撑柱牢固地固定电路板。可以参见[图
    5-9](ch05.xhtml#ch05fig9)中的模板来进行钻孔测量。本书的在线资源中有该模板的PDF文件，网址是*[https://www.nostarch.com/arduinoplayground/](https://www.nostarch.com/arduinoplayground/)*，如果你想打印它并将其作为指南放在外壳上，可以访问该网站。推荐使用的外壳是聚碳酸酯塑料，比苯乙烯或有机玻璃更不容易开裂；但它容易卡住钻头，所以要小心。
- en: '![image](../images/f05-09.jpg)'
  id: totrans-159
  prefs: []
  type: TYPE_IMG
  zh: '![image](../images/f05-09.jpg)'
- en: '*Figure 5-9: Template for drilling transducer holes*'
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: '*图 5-9：钻孔模板，用于安装传感器孔*'
- en: There are several ways to drill the 5/8-inch holes. If you are good at drilling,
    you could simply use a 5/8-inch drill bit and bore the holes directly. But I discovered
    that the holes can be bored safely and easily by first drilling a hole about 1/4
    to 3/8 inches in diameter and then enlarging it with a tapered reamer, available
    from Amazon for under $15\. The larger reamer in the Amazon set will ream a hole
    up to 7/8 inches in diameter, and it is handy to have around for other projects.
    Use a 1/8-inch drill to drill the holes for the standoffs, as shown in the drawing,
    which you can use as a template.
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 有几种方法可以钻出5/8英寸的孔。如果你擅长钻孔，可以直接使用5/8英寸的钻头钻孔。但是我发现，通过先钻一个直径约为1/4到3/8英寸的孔，然后用锥形扩孔器扩大孔径，可以安全且轻松地钻孔。亚马逊上不到15美元就能买到锥形扩孔器套件，里面较大的扩孔器可以将孔扩展到7/8英寸直径，对于其他项目也很有用。使用1/8英寸的钻头钻孔，用作支撑垫的孔，可以参考图纸来作为模板。
- en: If you ream out the hole, make sure to ream from both sides. Enlarge the hole
    to a size that holds the transducer elements tightly—but not too tightly. While
    this is not the most precise way to bore a hole and would probably be frowned
    upon by professional machinists, it works well enough here.
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你扩孔时要确保从两侧进行扩孔。将孔扩大到一个能够紧固换能器元件的大小，但不要过于紧密。虽然这不是一种非常精确的打孔方式，专业的机械师可能会对这种方法不以为然，但在这里效果还不错。
- en: '**WARNING**'
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: '**警告**'
- en: '*Regardless of the size of the hole, do not hold your work piece with your
    hand when drilling. Always clamp it securely. If the drill binds, the work will
    want to spin or climb up the drill. Drill at a slow speed and go gently*.'
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: '*无论孔的大小如何，钻孔时不要用手直接握住工件。始终将其固定在夹具中。如果钻头卡住，工件会想要旋转或向上攀升。钻孔时应使用较慢的速度，轻轻操作*。'
- en: Next, drill the holes for the potentiometer, power jack, and two LEDs. Select
    a drill size based on the particular power jack and potentiometer you have. I
    used a 9/32-inch drill for the potentiometer, a 1/4-inch drill for the 3.5 mm
    jack, and a bit of approximately 25/64 inches for the LEDs. The size of the 10
    mm LEDs tends to vary a bit from manufacturer to manufacturer, so I would recommend
    that you select a smaller drill bit, say 3/8 inches, and ream until the LED fits
    tightly. Because the LED is tapered, ream from the rear of the enclosure so that
    the LED will fit better.
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，钻孔以安装电位器、电源插孔和两个LED灯。根据你使用的电源插孔和电位器选择合适的钻头尺寸。我使用了9/32英寸的钻头用于电位器，1/4英寸的钻头用于3.5毫米插孔，以及大约25/64英寸的钻头用于LED。10毫米LED的尺寸可能会因制造商不同而有所不同，因此我建议你选择一个较小的钻头，比如3/8英寸，然后逐渐扩孔直到LED能够紧密安装。由于LED是锥形的，最好从外壳的后部扩孔，这样LED会更好地适应。
- en: The location of both the potentiometer and power jack is not important, but
    make sure that neither crowds the transducer or Nano. You want them to be on the
    bottom of the enclosure so that they are accessible after the enclosure is mounted
    (see [Figure 5-12](ch05.xhtml#ch05fig12)).
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 电位器和电源插孔的位置并不重要，但要确保它们不会挤压换能器或Nano。你希望它们位于外壳的底部，这样在外壳安装后可以方便访问（见[图 5-12](ch05.xhtml#ch05fig12)）。
- en: '***Mounting Options***'
  id: totrans-167
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: '***安装选项***'
- en: Before you stuff the Arduino, ultrasonic sensor, and perforated board circuit
    into your enclosure, figure out how you want to mount the Garage Sentry. There
    are several ways to mount the enclosure onto whatever surface you need.
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 在将Arduino、超声波传感器和打孔板电路塞进外壳之前，先弄清楚你想如何安装Garage Sentry。有几种方法可以将外壳安装到你需要的表面上。
- en: '**Velcro Strips**'
  id: totrans-169
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: '**魔术贴条**'
- en: If you have a good flat surface to mount the assembly to, you could simply affix
    the enclosure with adhesive Velcro (see [Figure 5-10](ch05.xhtml#ch05fig10)).
    Two sentries have been in place in my garage that way for several months, with
    no sign of slippage or deterioration.
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你有一个平整的表面来安装组装好的设备，可以直接使用粘性魔术贴将外壳固定（见[图 5-10](ch05.xhtml#ch05fig10)）。我车库里已经用这种方式安装了两个警戒器几个月，没有出现滑动或老化的迹象。
- en: '![image](../images/f05-10.jpg)'
  id: totrans-171
  prefs: []
  type: TYPE_IMG
  zh: '![image](../images/f05-10.jpg)'
- en: '*Figure 5-10: Adhesive Velcro mounting strips used to mount the Garage Sentry
    enclosure*'
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: '*图 5-10：使用粘性魔术贴条安装Garage Sentry外壳*'
- en: '**A U Bracket That Can Be Aimed**'
  id: totrans-173
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: '**一个可以调节的U型支架**'
- en: If you don’t have a good surface and need to aim the module at an angle, mounting
    it on a U bracket that lets the sensors swing up and down or left and right will
    work. In this section, I’ll describe how to build the U bracket mount shown in
    [Figure 5-11](ch05.xhtml#ch05fig11).
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你没有合适的表面并且需要将模块以一定角度进行调节，可以将其安装在一个U型支架上，这样传感器就可以上下或左右摆动。在这一节中，我将描述如何构建[图 5-11](ch05.xhtml#ch05fig11)所示的U型支架安装架。
- en: '![image](../images/f05-11.jpg)'
  id: totrans-175
  prefs: []
  type: TYPE_IMG
  zh: '![image](../images/f05-11.jpg)'
- en: '*Figure 5-11: This drawing illustrates the size and shape of the optional U
    bracket handle and how it connects to the enclosure. Where you see two measurements
    for a single dimension, the smaller applies to the basic Garage Sentry, while
    the larger applies to the deluxe version*.'
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: '*图5-11：此图说明了可选的U型支架把手的大小和形状，以及它如何连接到外壳。当你看到一个维度有两个测量值时，较小的适用于基本车库警卫，而较大的适用于豪华版本*。'
- en: To make the U bracket for the basic Garage Sentry with the 1591 ATCL 2×4-inch
    enclosure, take a strip of 3/4-inch × 0.080-inch × 5 1/2-inch long aluminum (available
    at Ace Hardware, Home Depot, or Lowe’s), and drill 1/4-inch holes 5/16 inches
    from the ends of the aluminum strip. Drill corresponding holes with a No. 7 or
    15/64 drill in the side of the enclosure centered on the ends, and thread the
    holes with a 1/4-inch-20 tap. Bend the aluminum strip 1.5 inches from each end
    for the standard version and 2 inches for the deluxe version (see [Figure 5-11](ch05.xhtml#ch05fig11)).
    Using a vise is the easiest way to bend the metal, but if that’s not convenient,
    you can sandwich it between a bench and piece of metal, clamp it down, and bend
    it by hand.
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 为了制作适用于1591 ATCL 2×4英寸外壳的基本车库警卫U型支架，取一条3/4英寸×0.080英寸×5 1/2英寸长的铝条（可在Ace Hardware、Home
    Depot或Lowe’s购买），并在铝条的两端5/16英寸处钻1/4英寸孔。然后，在外壳的侧面钻对应的孔，使用7号或15/64钻头，并在孔中螺纹加工1/4英寸-20螺纹。对于标准版本，将铝条在每端1.5英寸处弯曲，而豪华版则在每端2英寸处弯曲（参见[图5-11](ch05.xhtml#ch05fig11)）。使用台钳弯曲金属是最简单的方法，但如果不方便，也可以将铝条夹在工作台和金属板之间，夹紧后手工弯曲。
- en: To make the U bracket for the Deluxe Garage Sentry with the 1591 BTCL 2.2×4.4-inch
    enclosure, use a 6 3/8-inch long strip of the same material, and drill the 1/4-inch
    holes 1/2 inches from the ends. Then, bend the aluminum at right angles at 3/4
    inches from either end for the standard version and 1 inch from each end for the
    deluxe version.
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: 为了制作适用于1591 BTCL 2.2×4.4英寸外壳的豪华车库警卫U型支架，使用一条6 3/8英寸长的相同材料条，且在距两端1/2英寸的位置钻1/4英寸孔。然后，在距离每端3/4英寸的位置将铝材弯曲成直角，以适应标准版本；对于豪华版，则在每端1英寸处弯曲。
- en: To fasten the U bracket to either enclosure, you can start by drilling a hole
    in the center of each end of the enclosure. It’s simplest to drill a No. 7—15/64
    is close enough—hole at either end of the enclosure. The easiest way to center
    the holes is to draw a line along each diagonal on both ends. Where the lines
    intersect is the center. Thread the holes with a 1/4-inch-20 tap, and you’ll be
    able to fasten the enclosure to the U bracket directly. The threads in the thin
    ABS plastic will not be very strong, so be careful not to overtighten the bolts.
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: 要将U型支架固定到任何外壳上，可以先在外壳每端的中心钻孔。最简单的方法是分别在外壳的两端钻一个7号孔——15/64号也足够接近——为了准确定位孔位，最好在两端沿对角线画一条线，交点即为中心。接着，将孔螺纹化，使用1/4英寸-20螺纹tap，这样你就可以直接将外壳固定到U型支架上。由于薄ABS塑料的螺纹强度不高，请小心避免过度拧紧螺栓。
- en: When you’re finished attaching the bracket to your enclosure, it should look
    like [Figure 5-12](ch05.xhtml#ch05fig12).
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 完成将支架安装到外壳上后，外观应与[图5-12](ch05.xhtml#ch05fig12)相符。
- en: '![image](../images/f05-12.jpg)'
  id: totrans-181
  prefs: []
  type: TYPE_IMG
  zh: '![image](../images/f05-12.jpg)'
- en: '*Figure 5-12: The enclosure for the basic Garage Sentry can be mounted with
    the bracket so it can be tilted or rotated to point the transducers in the correct
    direction*.'
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: '*图5-12：基本车库警卫的外壳可以通过支架安装，从而使其能够倾斜或旋转，将传感器指向正确的方向*。'
- en: '***Soldering the Transistors and Current-Limiting Resistors***'
  id: totrans-183
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: '***焊接晶体管和限流电阻***'
- en: After testing your circuit on a breadboard and deciding how to mount the Garage
    Sentry, solder the driver transistors and current-limiting resistors to a small
    section of perforated phenolic or FR-4 predrilled board. Use the schematic in
    [Figure 5-2](ch05.xhtml#ch05fig2) or the instructions in “[The Breadboard](ch01.xhtml#ch01lev1sec7)”
    on [page 136](ch05.xhtml#page_136) as a guide to wiring and soldering the components
    in the perforated board.
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 在面包板上测试完电路并决定如何安装车库警卫后，将驱动晶体管和限流电阻焊接到一小块打孔的酚醛板或FR-4预钻孔板上。使用[图5-2](ch05.xhtml#ch05fig2)中的原理图或“[面包板](ch01.xhtml#ch01lev1sec7)”中的说明，参考[第136页](ch05.xhtml#page_136)作为焊接和布线元件的指南。
- en: Make the connections in the schematic, but otherwise, there is no right or wrong
    way to assemble the perf board. I do recommend using perforated board with copper
    pads for each hole to simplify soldering. Solder all the hookup wires for the
    power, potentiometer, Nano, ultrasonic module, and LEDs before attempting to mount
    the board on the inside of the enclosure.
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 按照原理图进行连接，除此之外，组装打孔板没有对错之分。我推荐使用带有铜垫的打孔板，这样可以简化焊接。在尝试将板子安装到外壳内之前，先焊接好电源、可调电阻、Nano板、超声波模块和LED的连接线。
- en: When you’re done soldering, mount the perforated board anywhere in the enclosure
    where you can find room. I used double-sided foam adhesive, and it worked well.
    Mount the Nano, LEDs, and ultrasonic module next.
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: 完成焊接后，将打孔板安装在外壳中任何有足够空间的地方。我使用了双面泡沫胶粘剂，效果很好。接下来，安装Nano板、LED和超声波模块。
- en: '***Wiring the Pieces Together***'
  id: totrans-187
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: '***连接各部分***'
- en: Finally, use 30-gauge hookup wire to connect the Nano, ultrasonic sensor, perforated
    board circuit, and LEDs according to the schematic in [Figure 5-2](ch05.xhtml#ch05fig2).
    Optionally, you can use wire-wrap wire and a wire-wrap tool to wire up the sections,
    but it is not necessary and can be expensive if you don’t already have the tool
    and wire. Wiring the components and fitting them in the enclosure may be a little
    messy, but it saves building a shield.
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，使用30号连接线根据[图5-2](ch05.xhtml#ch05fig2)中的原理图，将Nano板、超声波传感器、打孔板电路和LED连接起来。你也可以选择使用线绕线和线绕工具来连接各部分，但这不是必需的，如果你没有工具和线，可能会比较昂贵。连接组件并将其安装在外壳内可能会有些杂乱，但这样可以省去做外壳的步骤。
- en: '**The Deluxe Garage Sentry**'
  id: totrans-189
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: '**豪华车库守卫**'
- en: That’s it! Or is it?
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
  zh: 就这样！或者说，这就完了吗？
- en: I have been using the standard model in my garage for several months; it does
    what it’s supposed to do and does it well. But it seems like something’s missing.
    The alarm goes off when you reach the desired spot in the garage, but why not
    have it give you a little warning before you get there so you can slow down as
    you approach the stopping point?
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 我在车库里使用标准模型已经好几个月了；它能做到它应该做的事，并且做得很好。但是似乎少了点什么。当你到达车库里指定的位置时，警报会响起，但为什么不在你到达之前就给你一个小警告，这样你就可以在接近停靠点时慢下来呢？
- en: The idea is to have the system warn you at some pre-established distance from
    the stopping point so you don’t have to stop suddenly. It isn’t much extra effort
    to add two more LEDs to go off at different distances. [Figure 5-13](ch05.xhtml#ch05fig13)
    shows the Deluxe Garage Sentry.
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: 这个设计的想法是让系统在停靠点的预设距离内发出警告，这样你就不需要突然停车了。增加两个LED，让它们在不同距离时亮起，并不会增加太多的额外工作。[图5-13](ch05.xhtml#ch05fig13)展示了豪华车库守卫。
- en: '![image](../images/f05-13.jpg)'
  id: totrans-193
  prefs: []
  type: TYPE_IMG
  zh: '![image](../images/f05-13.jpg)'
- en: '*Figure 5-13: The Deluxe Garage Sentry sets off three stages of alarms*.'
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
  zh: '*图5-13：豪华车库守卫设置了三个阶段的警报*。'
- en: Now, let’s discuss how to assemble the Deluxe Garage Sentry.
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，让我们讨论如何组装豪华车库守卫。
- en: '***The Deluxe Schematic***'
  id: totrans-196
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: '***豪华原理图***'
- en: Hand-wiring everything in the standard version is tedious. So for the deluxe
    version, I developed a shield (PCB) that holds the LEDs, potentiometer, Nano,
    transistors, and current-limiting resistors. Adding the LEDs and extra transistors
    required some changes in the circuitry. [Figure 5-14](ch05.xhtml#ch05fig14) shows
    the revised schematic.
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
  zh: 手工焊接标准版的所有组件非常繁琐。所以，在豪华版中，我开发了一个集成板（PCB），它可以容纳LED、可调电阻、Nano板、晶体管和限流电阻。增加LED和额外晶体管需要对电路做一些修改。[图5-14](ch05.xhtml#ch05fig14)展示了修改后的原理图。
- en: Note that this circuit drives the transistors as emitter followers. As such,
    the base shows a high resistance, and therefore no resistor is required between
    the Arduino and the resistors Q1 through Q4\. If you were driving using a common
    emitter, however, you would need a resistor, as current would flow through the
    base-emitter junction, short out the driver, and burn out the transistor.
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，这个电路是以发射极跟随器的方式驱动晶体管。因此，基极显示出较高的电阻，因此不需要在Arduino与Q1至Q4的电阻之间添加电阻。如果使用共射极驱动，则需要电阻，因为电流会流经基极-发射极结，导致驱动器短路并烧毁晶体管。
- en: '![image](../images/f05-14.jpg)'
  id: totrans-199
  prefs: []
  type: TYPE_IMG
  zh: '![image](../images/f05-14.jpg)'
- en: '*Figure 5-14: The deluxe schematic has additional LEDs, driver transistors,
    and current-limiting resistors on the right-hand side*.'
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: '*图5-14：豪华原理图在右侧增加了LED、驱动晶体管和限流电阻*。'
- en: '**NOTE**'
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: '**注意**'
- en: '*To improve the Garage Sentry further, you could also conceivably double or
    otherwise increase the range using special transducers and electronics, but in
    this application, the 10-foot operating range is more than enough*.'
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: '*为了进一步改进车库哨兵，你也可以考虑使用特殊的换能器和电子设备将范围加倍或以其他方式增加，但在此应用中，10 英尺的工作范围已经足够。*'
- en: '***The Deluxe Sketch***'
  id: totrans-203
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: '***豪华版草图***'
- en: Before you build the Deluxe Garage Sentry, download *GarageSentryDeluxe.ino*
    from this book’s resource files at *[https://www.nostarch.com/arduinoplayground/](https://www.nostarch.com/arduinoplayground/)*,
    and upload it onto your Arduino Nano according to the instructions provided in
    “[Uploading Sketches to Your Arduino](ch00.xhtml#ch00lev1sec3)” on [page 5](ch00.xhtml#page_5).
    The sketch is basically the same as the basic Garage Sentry sketch, but it’s updated
    to include the new LEDs.
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: 在构建豪华版车库哨兵之前，从本书的资源文件中下载 *GarageSentryDeluxe.ino*，并根据 “[将草图上传到你的 Arduino](ch00.xhtml#ch00lev1sec3)”
    中的说明，在 [第 5 页](ch00.xhtml#page_5) 上传到你的 Arduino Nano。该草图与基本的车库哨兵草图基本相同，但已更新以包含新的
    LED。
- en: '[PRE3]'
  id: totrans-205
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: The most notable difference between the deluxe sketch and the standard sketch
    is that in the two `if-else` statements at ➊ and ➋, the green and amber LEDs are
    activated at different distances, based on the stopping point. For example, if
    the stopping point is set to 36 inches, or `Val` in the sketch, then the green
    LED turns on at `VAL + 15`, or 52 inches, and the amber LED turns on at `VAL +
    7.5`, or 43.5 inches. This way the green LEDs will turn on when the car is 15
    inches from the final stopping point, and the amber LEDs will turn on when the
    car is 7.5 inches from the stopping point. These numbers were selected arbitrarily,
    and you can change them.
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: 豪华版草图和标准版草图的最显著区别在于，在 ➊ 和 ➋ 处的两个 `if-else` 语句中，绿色和琥珀色的 LED 在不同的距离处被激活，取决于停止点。例如，如果停止点设置为
    36 英寸，或者草图中的 `Val`，那么绿色 LED 会在 `VAL + 15`，即 52 英寸时亮起，琥珀色 LED 会在 `VAL + 7.5`，即
    43.5 英寸时亮起。这样，当汽车距离最终停止点 15 英寸时，绿色 LED 会亮起，而当汽车距离停止点 7.5 英寸时，琥珀色 LED 会亮起。这些数字是随意选择的，你可以更改它们。
- en: The red and blue LEDs start flashing when the car has reached the stopping point.
    You can see how the LEDs are flashed at ➌.
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
  zh: 当汽车到达停止点时，红色和蓝色的 LED 开始闪烁。你可以在 ➌ 处看到 LED 的闪烁方式。
- en: '***The Deluxe Shield***'
  id: totrans-208
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: '***豪华版屏蔽***'
- en: '[Figure 5-15](ch05.xhtml#ch05fig15) shows the shield for the Deluxe Garage
    Sentry. If you want to build this shield, download this book’s resource files,
    look for the file *GarageSentryDeluxe.pcb*, follow the etching instructions in
    “[Making Your Own PCBs](ch00.xhtml#ch00lev1sec5)” on [page 13](ch00.xhtml#page_13),
    and solder your components to the board. You can also take the file and send it
    out to one of the service bureaus to have the board made for you.'
  id: totrans-209
  prefs: []
  type: TYPE_NORMAL
  zh: '[图 5-15](ch05.xhtml#ch05fig15) 显示了豪华版车库哨兵的屏蔽。如果你想制作这个屏蔽，下载本书的资源文件，找到文件 *GarageSentryDeluxe.pcb*，按照
    “[制作你自己的 PCB](ch00.xhtml#ch00lev1sec5)” 中的蚀刻说明，在 [第 13 页](ch00.xhtml#page_13)
    上操作，并将你的组件焊接到电路板上。你也可以将文件发送给服务机构，让他们为你制作电路板。'
- en: The potentiometer is soldered directly to the shield, though you’ll still have
    to solder wires to the power jack and to the ultrasonic module. As you can see
    in [Figure 5-15](ch05.xhtml#ch05fig15), the connections for the ultrasonic sensor
    are located on the left-hand side.
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: 电位器直接焊接到屏蔽上，尽管你仍然需要将电线焊接到电源插口和超声波模块上。如[图 5-15](ch05.xhtml#ch05fig15)所示，超声波传感器的连接位于左侧。
- en: '![image](../images/f05-15.jpg)'
  id: totrans-211
  prefs: []
  type: TYPE_IMG
  zh: '![image](../images/f05-15.jpg)'
- en: '*Figure 5-15: This is the shield for the Deluxe Garage Sentry, which simplifies
    the individual wires that had to be soldered to complete the earlier version*.'
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: '*图 5-15：这是豪华版车库哨兵的屏蔽，它简化了早期版本中必须焊接的各个电线。*'
- en: The green LEDs are on the outermost edges, the amber LEDs are next, and the
    flashing red and blue LEDs are in the middle. The connections for the potentiometer
    are on the lower right-hand side, next to the first two connections, which are
    ground and VIN (from left to right). The potentiometer helps hold the shield in
    place in the enclosure.
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
  zh: 绿色 LED 位于最外侧，琥珀色 LED 紧随其后，闪烁的红色和蓝色 LED 位于中间。电位器的连接位于右下方，靠近前两个连接端口，分别是地线和 VIN（从左到右）。电位器帮助将屏蔽固定在外壳内。
- en: This version uses high-power LEDs that draw a fair amount of current. Because
    the sentry uses the 5V voltage regulator on the Nano, the transistors driving
    the LEDs are wired directly to the 9V input voltage, allowing the unit to function
    without a separate voltage regulator. The LEDs are configured with the driver
    transistors as emitter followers, so the voltage to the LEDs will “follow” the
    voltage on the base of the transistor—that is, 5V—and not present LEDs with 9V.
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: 这个版本使用了高功率LED，这些LED需要相当大的电流。由于哨兵使用了Nano上的5V电压调节器，驱动LED的晶体管直接与9V输入电压连接，这样该设备就不需要单独的电压调节器。LED与驱动晶体管配置为发射极跟随器，因此LED的电压将“跟随”晶体管基极的电压——即5V，而不会给LED提供9V电压。
- en: There are several jumpers required on this shield, including the jumper for
    the power, which connects to the collectors of the transistors and connects the
    raw input to the (VIN) Nano. There are also jumpers to connect the ground to the
    LEDs.
  id: totrans-215
  prefs: []
  type: TYPE_NORMAL
  zh: 这个扩展板上需要几个跳线，包括用于电源的跳线，它连接到晶体管的集电极并将原始输入连接到Nano的（VIN）端口。还需要跳线将地线连接到LED。
- en: I mounted the transistors and current-limiting resistors under the Nano to save
    some space. Also, note that the connections for the ultrasonic module in the standard
    version call for a right-angle female header, but doing that in the deluxe version
    means the length of the male part gets in the way of the LEDs, so I simply soldered
    the connections to the PC board and to the ultrasonic module to keep the wires
    out of the way.
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: 我将晶体管和限流电阻器安装在Nano板下方以节省空间。另外，注意标准版中的超声波模块连接使用了一个直角女性头，而在豪华版中这样做会导致公头部分的长度挡住LED，因此我直接将连接焊接到PC板和超声波模块上，以避免电线干扰。
- en: '***A Bigger Box***'
  id: totrans-217
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: '***更大的盒子***'
- en: Both the green and amber LEDs operate as pairs, so only a single driver transistor
    is required for each pair. But with all this new circuitry, the deluxe board does
    not easily fit in the same enclosure as the standard version.
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: 绿色和琥珀色LED作为一对工作，因此每对LED只需要一个驱动晶体管。但由于所有这些新的电路，豪华版的电路板不容易适应与标准版相同的外壳。
- en: 'You’ll need to find a larger enclosure for the deluxe version, which provides
    you with some other benefits. With a larger, clear polycarbonate enclosure, like
    Hammond 1591 BTCL, the LEDs can stay inside the enclosure and still be visible
    so you won’t have to drill holes to mate with the LEDs in the PC board. You’ll
    have to drill only four holes: the two large holes for the ultrasonic sensor,
    a hole for the power jack, and one for the potentiometer. These holes make it
    possible to mount the ultrasonic sensor on top of the Nano board with double-sided
    foam tape, which is in turn mounted to the shield (see [Figure 5-16](ch05.xhtml#ch05fig16)).
    In other words, you create a sandwich with the Nano in the middle, the shield
    on the bottom, and the ultrasonic module on the top. This design eliminates the
    need for the mounting screws used in the first version.'
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
  zh: 你需要为豪华版找到一个更大的外壳，这样可以带来一些额外的好处。使用更大且透明的聚碳酸酯外壳，比如Hammond 1591 BTCL，LED可以保持在外壳内并且仍然可见，这样你就不需要在PC板上钻孔来安装LED。你只需要钻四个孔：两个大孔用于超声波传感器，一个孔用于电源插座，一个孔用于电位器。这些孔使得可以使用双面泡沫胶带将超声波传感器安装在Nano板上，并且Nano板又被安装到扩展板上（见[图5-16](ch05.xhtml#ch05fig16)）。换句话说，你需要将Nano板夹在中间，底部是扩展板，顶部是超声波模块。这个设计消除了第一版中使用的安装螺丝的需要。
- en: '![image](../images/f05-16.jpg)'
  id: totrans-220
  prefs: []
  type: TYPE_IMG
  zh: '![image](../images/f05-16.jpg)'
- en: '*Figure 5-16: Compared to the basic Garage Sentry, there is virtually no hand
    wiring in the deluxe version. The driver transistors and current-limiting resistors
    for the LEDs are located under the Nano board*.'
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
  zh: '*图5-16：与基本版的车库哨兵相比，豪华版几乎没有手工接线。驱动LED的晶体管和限流电阻器位于Nano板下方*。'
- en: Simply use the same template you used in the standard version, and drill (and/or
    ream) the two 5/8-inch holes for the two ultrasonic elements. The shield itself
    can be fastened to the bottom of the enclosure with small flathead screws and
    nuts or with more double-sided foam tape. When you affix the potentiometer to
    the enclosure, it should hold the board in place, as its leads are soldered to
    the shield. [Figure 5-16](ch05.xhtml#ch05fig16) shows the deluxe version; note
    how much neater it is than the basic version from [Figure 5-8](ch05.xhtml#ch05fig8).
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
  zh: 只需使用标准版中使用的相同模板，钻（和/或扩孔）两个 5/8 英寸的孔用于两个超声波元件。屏蔽本身可以用小型平头螺钉和螺母或更多的双面泡沫胶带固定到底部。当你将电位器固定在外壳上时，它应该会把电路板固定到位，因为它的引脚已经焊接到屏蔽上。[图
    5-16](ch05.xhtml#ch05fig16) 显示了豪华版；请注意它比[图 5-8](ch05.xhtml#ch05fig8)中的基础版要整洁得多。
- en: Before drilling the hole for the potentiometer, carefully measure the height
    of the potentiometer hole and drill the hole slightly oversized so that the shaft
    and screw can be inserted at an angle into the enclosure. You’ll also note in
    [Figure 5-16](ch05.xhtml#ch05fig16) that the corners of the printed circuit board
    have been clipped off so as not to get in the way of the studs used for the top
    screws of the enclosure.
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
  zh: 在为电位器钻孔之前，仔细测量电位器孔的高度，并稍微钻一个较大的孔，以便轴和螺丝可以以角度插入外壳。你还会注意到，在[图 5-16](ch05.xhtml#ch05fig16)中，印刷电路板的角落已经被剪去，以免妨碍外壳顶部螺丝使用的螺柱。
- en: I suggest mounting the power connection on the same surface of the enclosure
    as the potentiometer—that is, the bottom. Here, the power connection and potentiometer
    will be accessible after mounting, leaving the top free to fit snugly against
    a shelf. The unit can just as easily be mounted upside down with the adjustment
    and power jack on the top.
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: 我建议将电源连接安装在与电位器相同的外壳表面——即底部。在这里，电源连接和电位器在安装后可以方便接触，而顶部可以紧密贴合在架子上。该单元也可以轻松地倒置安装，将调整和电源插孔置于顶部。
- en: '[Figure 5-17](ch05.xhtml#ch05fig17) shows the completed Deluxe Garage Sentry
    mounted on my garage workbench with the car in place.'
  id: totrans-225
  prefs: []
  type: TYPE_NORMAL
  zh: '[图 5-17](ch05.xhtml#ch05fig17) 显示了安装在我车库工作台上的完成版豪华车库哨兵，车子已经到位。'
- en: '![image](../images/f05-17.jpg)'
  id: totrans-226
  prefs: []
  type: TYPE_IMG
  zh: '![image](../images/f05-17.jpg)'
- en: '*Figure 5-17: Completed Deluxe Garage Sentry mounted on my garage workbench
    with the car in place*'
  id: totrans-227
  prefs: []
  type: TYPE_NORMAL
  zh: '*图 5-17：安装在我车库工作台上的完成版豪华车库哨兵，车子已经到位*'
- en: The completed sentry unit works flawlessly. Depending on your particular garage
    and where you place the unit, you might want to adjust the sketch to make the
    green and amber lights turn on at different distances. The unit pictured has been
    working perfectly for almost six months now, and I don’t know how I’d be able
    to pull my car in the garage without it.
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
  zh: 完整的哨兵单元运行完美无缺。根据你特定的车库以及单元放置的位置，你可能需要调整草图，使得绿色和琥珀色的灯在不同的距离上亮起。图片中的单元已经完美运行了近六个月，我简直无法想象没有它，我怎么把车开进车库。
