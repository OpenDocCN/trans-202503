- en: A
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: A
- en: Sample Design Document
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 示例设计文档
- en: '![](image_fi/book_art/chapterart.png)'
  id: totrans-2
  prefs: []
  type: TYPE_IMG
  zh: '![](image_fi/book_art/chapterart.png)'
- en: The following document is a hypothetical design provided to illustrate the process
    of performing a security design review (SDR) on an actual design. Intended as
    a learning tool, it omits many details that would be present in a real design,
    focusing instead on security aspects. As such, it is not a complete example of
    a real software design document.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 以下文档为假设性设计，旨在说明如何对实际设计执行安全设计评审（SDR）。作为学习工具，它省略了在真实设计中会出现的许多细节，重点放在安全方面。因此，它并不是一个完整的真实软件设计文档示例。
- en: Title – Private Data Logging Component Design Document
  id: totrans-4
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 标题 – 私有数据日志记录组件设计文档
- en: '**Table of Contents**'
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: '**目录**'
- en: Section 1 – Product Description
  id: totrans-6
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 第1节 – 产品描述
- en: Section 2 – Overview
  id: totrans-7
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 第2节 – 概述
- en: 2.1 Purpose
  id: totrans-8
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 2.1 目的
- en: 2.2 Scope
  id: totrans-9
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 2.2 范围
- en: 2.3 Concepts
  id: totrans-10
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 2.3 概念
- en: 2.4 Requirements
  id: totrans-11
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 2.4 需求
- en: 2.5 Non-Goals
  id: totrans-12
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 2.5 非目标
- en: 2.6 Outstanding Issues
  id: totrans-13
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 2.6 未解决的问题
- en: 2.7 Alternative Designs
  id: totrans-14
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 2.7 替代设计
- en: Section 3 – Use Cases
  id: totrans-15
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 第3节 – 用例
- en: Section 4 – System Architecture
  id: totrans-16
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 第4节 – 系统架构
- en: Section 5 – Data Design
  id: totrans-17
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 第5节 – 数据设计
- en: Section 6 – API
  id: totrans-18
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 第6节 – API
- en: 6.1 Hello Request
  id: totrans-19
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 6.1 Hello请求
- en: 6.2 Schema Definition Request
  id: totrans-20
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 6.2 架构定义请求
- en: 6.3 Event Log Request
  id: totrans-21
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 6.3 事件日志请求
- en: 6.4 Goodbye Request
  id: totrans-22
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 6.4 Goodbye请求
- en: Section 7 – User Interface Design
  id: totrans-23
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 第7节 – 用户界面设计
- en: Section 8 – Technical Design
  id: totrans-24
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 第8节 – 技术设计
- en: Section 9 – Configuration
  id: totrans-25
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 第9节 – 配置
- en: Section 10 – References
  id: totrans-26
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 第10节 – 参考文献
- en: Section 1 – Product Description
  id: totrans-27
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 第1节 – 产品描述
- en: This document describes a logging component (herein called Logger) that provides
    standard software event logging facilities to support auditing, system monitoring,
    and debugging, designed to mitigate risks of inadvertent information disclosure.
    **Logger will explicitly handle private data within logs so that non-private data
    can be freely accessed for routine uses. In rare cases when this access level
    is insufficient, limited access to protected, private log data can be provided,
    subject to explicit approval and with restrictions to minimize potential exposure.**
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 本文档描述了一个日志记录组件（以下简称为Logger），该组件提供标准的软件事件日志记录功能，以支持审计、系统监控和调试，旨在减少无意信息泄露的风险。**Logger将明确处理日志中的私有数据，以便非私有数据可以自由访问进行常规使用。在少数情况下，当这种访问级别不足时，可以提供对受保护的私有日志数据的有限访问，但需经过明确批准，并采取限制措施以最小化潜在的暴露风险。**
- en: '*The notion of explicitly handling private data separately within the context
    of a logging system is an example of security-centric design thinking. Adding
    this feature to an existing system would be less efficient and require considerable
    code churn, compared to designing it in from the start.*'
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: '*在日志记录系统中明确单独处理私有数据的概念是安全为中心的设计思维的一个例子。与从一开始就设计此功能相比，将其添加到现有系统中将效率较低，并且需要大量的代码修改。*'
- en: Section 2 – Overview
  id: totrans-30
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 第2节 – 概述
- en: For baseline project design assumptions, see the documents listed in Section
    10.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 有关基础项目设计假设，请参见第10节中列出的文档。
- en: 2.1 Purpose
  id: totrans-32
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 2.1 目的
- en: All applications in the datacenter need to log details of important software
    events, and since these logs potentially contain private data, careful access
    control needs to be enforced. Logger provides standard components to generate
    logs, store logs, and enforce appropriate access to authorized staff while maintaining
    a reliable and **non-repudiable** record of what access does occur. Since the
    logging, access, and retention requirements of systems vary, Logger operates based
    on a simple policy configuration that specifies an access policy.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 数据中心中的所有应用程序需要记录重要软件事件的详细信息，由于这些日志可能包含私有数据，因此需要实施严格的访问控制。Logger提供了生成日志、存储日志以及对授权人员执行适当访问控制的标准组件，同时保持对发生的访问行为可靠且**不可否认**的记录。由于系统的日志记录、访问和保留要求各不相同，Logger基于简单的策略配置运行，并指定访问策略。
- en: 2.2 Scope
  id: totrans-34
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 2.2 范围
- en: This document explains the design of the software components of Logger without
    mandating the choice of implementation language, deployment, or operational considerations.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 本文档解释了Logger软件组件的设计，但并未强制要求选择实现语言、部署或操作考虑因素。
- en: 2.3 Concepts
  id: totrans-36
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 2.3 概念
- en: The notion of a filtered view of logs is core to the design. The idea is to
    allow relatively free inspection of the logs with any private details filtered
    out, an access level which should suffice for most uses. Additionally, when needed,
    sensitive data that is logged can be inspected, subject to additional authorization.
    The access event is logged too, making the fact of inspection auditable. This
    graduated access lets applications log important private details while still minimizing
    how that data is exposed for legitimate uses by internal staff. Data so sensitive
    that it should never appear in logs simply should not be logged in the first place.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 日志的过滤视图的概念是设计的核心。其想法是允许相对自由地检查日志，同时过滤掉所有私密细节，这种访问级别应适用于大多数用途。此外，在需要时，可以检查记录的敏感数据，需经过额外授权。访问事件也会被记录下来，确保检查过程是可审计的。这种分级访问允许应用程序记录重要的私密细节，同时最大程度地减少这些数据在内部员工的合法使用中暴露的方式。对于那些敏感到绝不应出现在日志中的数据，根本就不应该将其记录在日志中。
- en: For example, web applications routinely log HTTPS requests as a record of system
    usage and for many other reasons. Often these logs contain private information
    (including IP addresses, cookies, and much more) that must be captured but is
    rarely needed. For example, IP addresses are useful when investigating malicious
    attacks (to identify the origin of an attack), but for other uses are immaterial.
    A filtered view of logs hides, or “wraps,” private data while showing nonsensitive
    data. Designated pseudonyms in a filtered view can show that, for instance, the
    IP addresses of all events labeled “IP7” are identical without disclosing the
    actual address. Such a filtered view often provides sufficient information for
    the purposes of monitoring, gathering statistics, or debugging. When that is the
    case, it’s advantageous to have avoided exposing any private data at all. The
    logs still contain the full data, and in rare cases when the protected information
    is required, the unfiltered view is available in a controlled manner with proper
    authorization.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，Web 应用程序通常会记录 HTTPS 请求，作为系统使用的记录以及其他许多原因。这些日志通常包含私密信息（包括 IP 地址、Cookie 以及更多），这些信息必须捕获，但很少需要。例如，IP
    地址在调查恶意攻击时非常有用（用来识别攻击的来源），但对于其他用途并不重要。日志的过滤视图隐藏或“包装”私密数据，同时显示非敏感数据。在过滤视图中指定的化名可以显示，例如，所有标记为“IP7”的事件的
    IP 地址是相同的，而不披露实际地址。这样的过滤视图通常为监控、统计收集或调试提供足够的信息。如果是这种情况，避免暴露任何私密数据是有利的。日志仍然包含完整的数据，在少数情况下，当需要保护的信息时，可以在经过适当授权的情况下以控制方式访问未过滤的视图。
- en: 'Suppose that a web application receives a user login attempt which triggers
    a bug that causes the process to crash. Here is a simplified example of what the
    log might contain:'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 假设一个 Web 应用程序接收到一个用户登录尝试，触发了一个错误，导致过程崩溃。以下是日志可能包含的简化示例：
- en: '[PRE0]'
  id: totrans-40
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'The items in this log are: timestamp (not sensitive), IP address (sensitive),
    HTTP verb and URL (not sensitive), username (sensitive), and password (very sensitive).
    An investigation potentially needs to consider all this information in order to
    reproduce the bug, but you don’t want to display this data in plaintext unless
    absolutely necessary, and then only to authorized agents.'
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 此日志中的项包括：时间戳（不敏感）、IP 地址（敏感）、HTTP 动词和 URL（不敏感）、用户名（敏感）以及密码（非常敏感）。调查时可能需要考虑所有这些信息以重现错误，但除非绝对必要，否则不应以明文显示这些数据，且只有授权的人员才能查看。
- en: To address the security needs of a wide range of systems, the sensitivity of
    various kinds of log data should be configurable, and the logging system should
    only selectively reveal confidential data. For example, as a best practice URLs
    should not contain sensitive information, but a legacy system might be known to
    violate this rule of thumb and require protection not usually necessary—which
    makes the filtered view less useful for some debugging. In the case of a URL,
    regular expressions could facilitate configuring certain URLs as more sensitive
    than others.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 为了满足各种系统的安全需求，各种日志数据的敏感度应该是可配置的，且日志系统应仅选择性地揭示机密数据。例如，作为最佳实践，URL 不应包含敏感信息，但一个旧系统可能被认为违反了这一经验规则，需要额外的保护，而这种保护通常是不必要的——这使得过滤后的视图在某些调试时不太有用。在
    URL 的情况下，正则表达式可以帮助配置某些 URL 为比其他 URL 更加敏感。
- en: 'A filtered view of the previous example log that omits or wraps the sensitive
    data might look like this:'
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 之前示例日志的过滤视图，省略或包装敏感数据，可能看起来是这样的：
- en: '[PRE1]'
  id: totrans-44
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'The IP address, username, and password are all wrapped as identifiers to hide
    the data, but the substituted identifiers could be used in context to query other
    requests with matching values. In this example, `US1` designates an IP address
    in the US; `USER1` designates the username associated with the event without divulging
    it specifically; and `PW1` stands for the password submitted. The suffixes in
    parentheses indicate the format or length of the actual data, adding a hint without
    revealing specific details: we can see that it’s an IPv4 address, the username
    has 3 characters, and the password has 12\. **For example, if an excessively long
    password caused a problem, this fact would be apparent from its surprising length
    alone. Knowing the length of the password leaks a little information but should
    not be compromising in practice.**'
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: IP地址、用户名和密码都被包装为标识符以隐藏数据，但替代的标识符可以在上下文中用于查询其他具有匹配值的请求。例如，`US1`表示美国的IP地址；`USER1`表示与事件关联的用户名，但不具体透露；`PW1`表示提交的密码。括号中的后缀表示实际数据的格式或长度，添加了一个提示而不透露具体细节：我们可以看到它是一个IPv4地址，用户名有3个字符，密码有12个字符。**例如，如果一个过长的密码导致了问题，仅凭其惊人的长度就能显现这一点。知道密码的长度会泄露一些信息，但在实际操作中不应构成安全威胁。**
- en: When the filtered view is insufficient for the task at hand, an additional request
    to unwrap an identifier such as `US1` can be made. This makes seeing the sensitive
    data an explicit choice, and allows a graduated revealing of data. For example,
    if only the IP address is needed, the username and password values remain undisclosed.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 当过滤后的视图不足以完成当前任务时，可以发出额外请求来解包标识符，如`US1`。这使得查看敏感数据成为一个明确的选择，并允许逐步揭示数据。例如，如果只需要IP地址，则用户名和密码的值将保持不公开。
- en: 2.4 Requirements
  id: totrans-47
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 2.4 要求
- en: Logs are reliably stored, immediately accessible with authorization, and destroyed
    after the required retention period. To support high volumes of use, the log capture
    interface must be fast, and once it reports success, the generating application
    is rightly assured that the log is stored.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 日志可靠存储，在获得授权后可以立即访问，并在保留期结束后销毁。为了支持高频使用，日志捕获接口必须快速，一旦报告成功，生成应用程序可以合理地保证日志已存储。
- en: Logs can be monitored without knowledge of private details, so a filtered log
    view can be made widely available for most uses, with special authorization needed
    to see the full data (including private data) only when strictly necessary.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 可以在不知道私人详情的情况下监控日志，因此可以广泛提供过滤后的日志视图供大多数用途使用，仅在绝对必要时，才需要特殊授权才能查看完整数据（包括私人数据）。
- en: An important goal of this design is to allow the logging of very sensitive private
    data that can be made available for investigating possible security incidents
    or, in rare cases, debugging issues that only occur in production. Complete mitigation
    against an insider attack is an impractical goal, but it’s important to take all
    reasonable precautions and preserve a reliable audit trail as a deterrent.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 该设计的一个重要目标是允许记录非常敏感的私人数据，这些数据可以用于调查可能的安全事件，或在极少数情况下，用于调试仅在生产环境中发生的问题。完全防范内部攻击是不切实际的目标，但采取所有合理的预防措施并保留可靠的审计跟踪作为威慑是非常重要的。
- en: Storage for logs is encrypted to protect against leaks if the physical media
    is stolen.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 日志存储经过加密，以防止在物理介质被盗的情况下泄露。
- en: Software generating logs is fully trusted; it must correctly identify private
    data in order for Logger to handle it correctly.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 生成日志的软件完全信任；它必须正确识别私人数据，以便Logger能正确处理它。
- en: 2.5 Non-Goals
  id: totrans-53
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 2.5 非目标
- en: As Logger is intended for use by admins, a slick UI is unnecessary.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 由于Logger是为管理员使用而设计的，因此无需华丽的用户界面。
- en: '**Insider attacks such as code tampering or abuse of admin root privilege are
    out of scope.**'
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: '**内部攻击，例如代码篡改或滥用管理员root权限，超出了本设计的范围。**'
- en: '**To be effective, Logger requires careful configuration and oversight. How
    this is implemented must be defined by system management but should include a
    review process and auditing with checks and balances.**'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: '**为了有效，Logger需要仔细的配置和监督。如何实现这一点必须由系统管理定义，但应包括审查过程和检查与平衡的审计。**'
- en: 2.6 Outstanding Issues
  id: totrans-57
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 2.6 未解决的问题
- en: Details of log access configuration, user authentication, and grants of unfiltered
    access authorization remain to be specified.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 日志访问配置、用户认证和未过滤访问授权的授予细节尚待确定。
- en: '**Querying encrypted private data is inherently slow. This design envisions
    that log data volumes are sufficiently small that a brute-force pass (that is,
    without reliance on an index) decrypting records on demand will be performant.
    A more ambitious future version might tackle indexing and fast querying over encrypted
    data.**'
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: '**查询加密的私密数据本身是很慢的。该设计设想日志数据量足够小，能够通过暴力破解（即不依赖索引）按需解密记录，并保持良好的性能。未来一个更为雄心勃勃的版本可能会解决加密数据的索引和快速查询问题。**'
- en: Error cases need to be identified and handling specified.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 需要识别错误情况并指定处理方法。
- en: 'Enhancements for future versions of Logger to consider include:'
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: Logger未来版本可以考虑的增强功能包括：
- en: Defining levels of filtered views that provide more or less detailed information
  id: totrans-62
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 定义提供更多或更少详细信息的过滤视图级别
- en: Providing a facility to capture portions of the log for long-term secure storage
    that would eventually be routinely deleted
  id: totrans-63
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 提供一种设施来捕获日志的部分内容进行长期安全存储，最终会定期删除
- en: 2.7 Alternative Designs
  id: totrans-64
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 2.7 替代设计
- en: '**The final design chosen is based on fully trusting Logger to store all sensitive
    information in logs, putting “all eggs in one basket.” An alternative was considered
    that allowed sensitive information to be compartmentalized by source. This was
    not pursued for a few reasons (briefly explained below) that did not appear compatible
    with important use scenarios, but it is important to note that this would arguably
    be a more secure logging solution.**'
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: '**最终选择的设计是完全信任Logger来存储所有敏感信息在日志中，”把所有鸡蛋放在一个篮子里“。曾考虑过一个替代方案，允许根据来源对敏感信息进行隔离。这种方案未被采纳，原因有几点（简要解释如下），这些原因似乎与重要的使用场景不兼容，但值得注意的是，这种方案可能会是一个更安全的日志记录解决方案。**'
- en: '**Alternative design**'
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: '**替代设计**'
- en: Log sources would create an asymmetric cryptographic key pair and use it to
    encrypt the sensitive data portions of log records before sending to Logger. If
    this were done carefully, Logger could (probably) still generate pseudonyms for
    filtered views (for example, `US1` for a certain IP address in the US). Authorized
    access to unfiltered views would then require the private key in order to decrypt
    the data. The main advantage of this approach is that disclosure of stored log
    data would not leak sensitive data that was encrypted, and Logger would not even
    have the necessary key(s).
  id: totrans-67
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 日志源将创建一对非对称加密密钥，并使用该密钥加密日志记录中敏感数据部分后发送给Logger。如果小心处理，Logger可能仍然能够为过滤后的视图生成化名（例如，将某个美国IP地址映射为`US1`）。授权访问未过滤视图则需要使用私钥来解密数据。这种方法的主要优点是，存储的日志数据泄露不会泄露已加密的敏感数据，且Logger甚至没有必要的密钥。
- en: '**Reasons not chosen**'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: '**未选择的原因**'
- en: This design puts the burden of encryption and key management on both log sources
    and authorized accessors. The designation of what data is sensitive and how it
    should be partitioned is determined by the log source and fixed at that time.
    By centralizing trust in Logger, both of these aspects can be reconfigured as
    needed, and fine-grained access can be controlled by authenticating the log viewer.
  id: totrans-69
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 该设计将加密和密钥管理的责任放在日志源和授权访问者身上。数据敏感性及其如何进行分区的定义由日志源决定，并在那个时候固定。通过将信任集中在Logger上，可以根据需要重新配置这两个方面，并通过认证日志查看者来控制精细的访问权限。
- en: Section 3 – Use Cases
  id: totrans-70
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 第3节 – 使用场景
- en: Applications in the datacenter generate logs of important software events using
    Logger. Routine monitoring software and appropriate operational staff are allowed
    filtered access (data views without disclosure of any private data) for their
    routine duties. Operational statistics including traffic levels, active users,
    error rates, and so forth are all generated from filtered log views.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 数据中心的应用程序使用Logger生成重要软件事件的日志。常规监控软件和适当的操作人员可以访问过滤后的数据（无任何私密数据披露）以完成常规任务。操作统计数据，包括流量水平、活跃用户、错误率等，均来自过滤后的日志视图。
- en: Rarely, when support or debugging requires access to the unfiltered logs, authorized
    staff may get limited access subject to policy. Access requests specify the subset
    of logs needed, their time window, and the reason for the access. Once approved,
    a token is issued that permits the access, which is logged for audit. Upon completion,
    the requester adds a note describing the result of the investigation, which is
    reviewed by the approver to ensure propriety.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 在少数情况下，当支持或调试需要访问未过滤的日志时，授权的人员可以根据策略获得有限的访问权限。访问请求指定所需日志的子集、它们的时间窗口以及访问原因。一旦批准，发放一个令牌，允许访问，并且会记录用于审计。完成后，请求者会添加一条描述调查结果的备注，审批人会审查该备注以确保合规性。
- en: Reports detailing summaries of requests, approvals, audit reviews, log volume
    trends, and confirmation of expired log data deletion are generated to inform
    management.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 生成报告，详细总结请求、批准、审计审查、日志量趋势以及已过期日志数据删除的确认，以便向管理层提供信息。
- en: Section 4 – System Architecture
  id: totrans-74
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 第四部分 – 系统架构
- en: 'Within the datacenter, Logger service **instances run on physically separate
    machines operated independently** from the applications they serve, via a standard
    publish/subscribe protocol. Logger is constituted from three new services organized
    as the following functions:'
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 在数据中心内，Logger 服务的**实例运行在物理上独立的机器上，与它们所服务的应用程序独立运行**，通过标准的发布/订阅协议进行通信。Logger
    由三个新服务组成，组织如下：
- en: '**Logger Recorder**'
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: '**Logger Recorder**'
- en: A log storage service. Applications stream log event data **over an encrypted
    channel** to the Logger Recorder service, where they are written to persistent
    storage. One instance may be configured to handle logs for more than one application.
  id: totrans-77
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一个日志存储服务。应用程序通过**加密通道**将日志事件数据流式传输到 Logger Recorder 服务，在那里它们被写入持久化存储。可以配置一个实例来处理多个应用程序的日志。
- en: '**Logger Viewer**'
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: '**Logger Viewer**'
- en: A web application that technical staff use to manually inspect filtered logs,
    with the ability to reveal unfiltered views subject to authorization according
    to policy.
  id: totrans-79
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一个 web 应用程序，技术人员使用它手动检查过滤后的日志，并且根据策略授权可以显示未过滤的视图。
- en: '**Logger Root Recorder**'
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: '**Logger Root Recorder**'
- en: '*1.  A special instance of Logger Recorder that logs events of Logger Recorder
    and Viewer. *For simplicity we omit the details of filtered and unfiltered views
    of this log.*'
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: '*1.  Logger Recorder 的一个特殊实例，用于记录 Logger Recorder 和 Viewer 的事件。*为了简化，我们省略了这个日志的过滤和未过滤视图的细节。*'
- en: Section 5 – Data Design
  id: totrans-82
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 第五部分 – 数据设计
- en: Log data is collected directly from applications that determine what events,
    with what details, should be logged. **Logs are append-only records of software
    events and are never modified other than being deleted upon expiration.**
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 日志数据直接从应用程序收集，应用程序决定哪些事件以及哪些详细信息应该被记录。**日志是只追加的记录，记录软件事件，除了在过期时被删除外，从不被修改。**
- en: Applications define a schema of log event types, with zero or more items of
    preconfigured data, as illustrated by the following example. All log events must
    have a timestamp and at least one other identifying data item.
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 应用程序定义了日志事件类型的模式，其中包含零个或多个预配置的数据项，如以下示例所示。所有日志事件必须具有时间戳和至少一个其他标识数据项。
- en: '[PRE2]'
  id: totrans-85
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: '*Many details regarding built-in types, formatting, and so forth are omitted
    since the basic idea of how these would be defined should be clear from this partial
    example.*'
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: '*关于内建类型、格式化等的许多细节被省略，因为这些内容如何定义的基本思路应该从这个部分示例中可以清楚地看出。*'
- en: '**Requests and responses must be UTF-8-encoded valid JSON expressions less
    than 1 million characters in length. Individual field values are limited to at
    most 10,000 characters.**'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: '**请求和响应必须是 UTF-8 编码的有效 JSON 表达式，且长度不得超过 100 万字符。单个字段值的最大长度为 10,000 字符。**'
- en: 'The first line (`LogTypes`) enumerates the types of log events this application
    will produce. For each type, a JSON record with the corresponding `LogType` entry
    (the second line is for `LogType: login`) lists the allowable data items that
    may be provided with such a log.'
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: '第一行（`LogTypes`）列出了该应用程序将产生的日志事件类型。对于每种类型，带有相应 `LogType` 条目的 JSON 记录（第二行是 `LogType:
    login`）列出了可以随日志提供的允许数据项。'
- en: 'The fourth line (`Filters`) declares the disposition of each data item: `0`
    for nonsensitive data, `private` for private data to be “wrapped,” and other special
    types of data handling, including:'
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 第四行（`Filters`）声明了每个数据项的处理方式：`0` 表示非敏感数据，`private` 表示要“包装”的私密数据，以及其他特殊类型的数据处理，包括：
- en: '**`minute`**'
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: '**`minute`**'
- en: Time value is rounded to the nearest minute (obscuring precise times)
  id: totrans-91
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 时间值四舍五入到最接近的分钟（遮蔽了精确时间）
- en: '**`country`**'
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: '**`country`**'
- en: IP addresses are mapped to country of origin in the filtered view
  id: totrans-93
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在过滤视图中，IP 地址会映射到原始国家。
- en: Filters should be defined by pluggable components and easily extended to support
    custom data types that various applications will require.
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 过滤器应通过可插拔组件定义，并且容易扩展以支持各种应用程序所需的自定义数据类型。
- en: '**Note that “nonsensitive” data should be used for limited internal viewing
    only; this designation does not mean that this data should be publicly disclosed.**
    The requirement that all data items be declared, including disposition (private
    or not), is to ensure that explicit decisions are made about each one in the context
    of the application. **It is critical that these definitions and any updates have
    careful scrutiny to ensure the integrity of the log processing.**'
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: '**请注意，“非敏感”数据仅应供有限的内部查看；此标签并不意味着这些数据应公开披露。** 所有数据项必须声明，包括处置方式（私密或公开），这一要求是为了确保在应用程序上下文中对每项数据做出明确的决策。**这些定义及其任何更新必须经过仔细审查，以确保日志处理的完整性。**'
- en: 'Here is an example log entry in the unfiltered view for this schema:'
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 这是该模式在未过滤视图中的日志条目示例：
- en: '[PRE3]'
  id: totrans-97
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'And this is the corresponding filtered view:'
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 这是相应的过滤视图：
- en: '[PRE4]'
  id: totrans-99
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: Data is stored persistently and available until the policy-configured expiration
    date is reached, measured as time elapsed since the event log timestamp.
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 数据会被持久存储，并且在策略配置的到期日期之前可用，时间以事件日志时间戳为基准。
- en: Logs are transient data only intended for monitoring and debugging or for forensic
    purposes in the case of a security breach, and as such are only kept for a limited
    time. **Potential data loss is mitigated by storing the data on a dedicated machine,
    using a RAID (or similar) disk array for redundant persistent storage. Logs are
    intended as short-term storage for auditing and diagnostic purposes. Long-term
    storage of any of this data should be stored separately.**
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 日志仅为瞬时数据，旨在用于监控、调试或在发生安全漏洞时进行取证，因此只会保留有限的时间。**通过将数据存储在专用机器上，并使用 RAID（或类似）磁盘阵列进行冗余持久存储，可以降低潜在的数据丢失风险。日志作为短期存储用于审计和诊断目的。任何此类数据的长期存储应单独存储。**
- en: Section 6 – API
  id: totrans-102
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 第 6 节 – API
- en: 'The Logger Recorder’s network interface accepts the following remote procedure
    calls:'
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: Logger 记录器的网络接口接受以下远程过程调用：
- en: '**Hello**'
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: '**你好**'
- en: Must be the first API call of the session; identifies the application and version
  id: totrans-105
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 必须是会话的第一个 API 调用；标识应用程序和版本
- en: '**Schema**'
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: '**模式**'
- en: Defines the log data schema (see Section 5)
  id: totrans-107
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 定义日志数据模式（参见第 5 节）
- en: '**Log**'
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: '**日志**'
- en: Sends event data (see Section 5) to be recorded to the specified log
  id: totrans-109
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 发送事件数据（参见第 5 节）以记录到指定的日志中
- en: '**Goodbye**'
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: '**再见**'
- en: Sent when the application terminates, ending the session
  id: totrans-111
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 当应用程序终止时发送，结束会话
- en: Each application connects to its logging service via a dedicated channel. **HTTPS
    secures API invocations between authenticated endpoints; the preconfigured server
    name authenticates (by its digital certificate) that clients are connected to
    valid Logger service instances.** The following are the request types.
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 每个应用程序通过专用通道连接到其日志服务。**HTTPS 通过认证的端点确保 API 调用的安全；预配置的服务器名称通过其数字证书验证客户端是否连接到有效的
    Logger 服务实例。** 以下是请求类型。
- en: 6.1 Hello Request
  id: totrans-113
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 6.1 你好请求
- en: 'Any process that will use the Logger service sends this request to initiate
    the logging:'
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 任何将使用 Logger 服务的进程都需要发送此请求以启动日志记录：
- en: '[PRE5]'
  id: totrans-115
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'The following response acknowledges the request with an OK or error message
    and provides a string token for the session:'
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 以下响应确认请求并提供 OK 或错误消息，并为会话提供一个字符串令牌：
- en: '[PRE6]'
  id: totrans-117
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'The token is used in subsequent requests to identify the context of the initiating
    application corresponding to the `Hello`. **Tokens are generated randomly with
    sufficient complexity and entropy to preclude guessing: the minimum recommended
    token size is 120 bits, or about 20 characters in base64 encoding. Shorter tokens
    are used here for brevity.**'
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 该令牌用于后续请求中，以识别与 `你好` 对应的启动应用程序的上下文。**令牌是随机生成的，具有足够的复杂性和熵以避免猜测：推荐的最小令牌大小为 120
    位，或约 20 个字符的 base64 编码。为了简洁起见，这里使用了较短的令牌。**
- en: 6.2 Schema Definition Request
  id: totrans-119
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 6.2 模式定义请求
- en: 'This request defines the data schema for subsequent logging, as described in
    Section 5:'
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 本请求定义了后续日志记录的数据模式，如第 5 节所述：
- en: '[PRE7]'
  id: totrans-121
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: '*Details of this request are omitted for brevity.*'
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: '*为了简洁，省略了此请求的详细信息。*'
- en: The schema defines the field names, types, and other attributes that will appear
    in the log contents, as illustrated by the sample event log request shown in the
    following section (which includes the fields `timestamp`, `ipaddr`, `http`, `url`,
    and `error`).
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 架构定义了将在日志内容中出现的字段名称、类型和其他属性，如下节中显示的示例事件日志请求所示（其中包括字段`timestamp`、`ipaddr`、`http`、`url`和`error`）。
- en: 6.3 Event Log Request
  id: totrans-124
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 6.3 事件日志请求
- en: 'This request actually logs one record with the Logger service:'
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 此请求实际上会记录一个条目到Logger服务中：
- en: '[PRE8]'
  id: totrans-126
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: The `log` JSON presents content to be recorded to the log that must match the
    schema.
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: '`log` JSON展示需要记录到日志中的内容，必须符合架构要求。'
- en: 'The response acknowledges the request with an OK or error message:'
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 响应确认请求，返回OK或错误消息：
- en: '[PRE9]'
  id: totrans-129
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: '*Error details are omitted for brevity.* **Logging errors (for example, insufficient
    storage space) are serious and require immediate attention, since system operation
    is not auditable in the absence of logging.**'
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: '*为了简洁，错误详情被省略。* **日志错误（例如，存储空间不足）是严重的，需要立即处理，因为在没有日志记录的情况下，系统操作无法审核。**'
- en: 6.4 Goodbye Request
  id: totrans-131
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 6.4 告别请求
- en: 'This request completes a session of logging:'
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 此请求完成了日志记录的一个会话：
- en: '[PRE10]'
  id: totrans-133
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'The response acknowledges the request with an OK or error message:'
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 响应确认请求，返回OK或错误消息：
- en: '[PRE11]'
  id: totrans-135
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: The token thereafter is no longer valid. To resume logging, the client must
    first make a `Hello` request.
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 之后的令牌将不再有效。要恢复日志记录，客户端必须首先发送`Hello`请求。
- en: Section 7 – User Interface Design
  id: totrans-137
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 第7节 - 用户界面设计
- en: The user interface to the Logger is a web interface served by Logger Viewer
    that is used to examine the logs. **The web app is only accessible by authorized
    operations staff and authenticated by enterprise single sign-on.** Authenticated
    users see a selection of logs they are allowed to access, with links to browse
    or search the most recent filtered log entries or, when allowed, to request access
    to unfiltered logs subject to approval.
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 日志记录器的用户界面是由Logger Viewer提供的Web界面，用于查看日志。**Web应用程序仅限授权操作人员访问，并通过企业单点登录进行身份验证。**
    经过身份验证的用户将看到他们被允许访问的日志，并可通过链接浏览或搜索最新的过滤日志条目，或者在允许的情况下，请求访问未过滤的日志，需经批准。
- en: '*For brevity, only a high-level description of the web interface is provided
    for this example.*'
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: '*为简洁起见，本文仅提供Web界面的高层描述。*'
- en: 'Approval requests are queued for processing in a web form that provides basic
    information:'
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 审批请求排队等待处理，Web表单提供基本信息：
- en: The reason access is requested, including specifics such as customer issue ticket
    numbers
  id: totrans-141
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 请求访问的原因，包括如客户问题票号等具体信息
- en: The scope of access requested (typically a specific user account or IP address)
  id: totrans-142
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 请求的访问范围（通常是特定的用户账户或IP地址）
- en: 'Approval requests trigger automated emails sent to approvers with a link to
    the web app page to review these requests. When each decision is taken, an email
    notifies the requester with the following:'
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 审批请求会触发自动邮件，发送给审批人，并提供一个链接，指向Web应用页面以审查这些请求。当每个决定作出时，系统会通过邮件通知请求者，内容如下：
- en: An approval or denial
  id: totrans-144
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 审批或拒绝
- en: Reason for denial, if applicable
  id: totrans-145
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 拒绝的原因（如果适用）
- en: Time window for approved access
  id: totrans-146
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 批准访问的时间窗口
- en: Filtered and unfiltered logs are visible on a page corresponding to each log.
    Queries may be entered specifying which log entries to view. An empty query shows
    the most recent entries with Next/Previous links for paging through the results.
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 过滤和未过滤的日志在与每个日志对应的页面上可见。可以输入查询，指定要查看哪些日志条目。空查询显示最近的条目，并带有“下一页/上一页”链接，用于翻阅结果。
- en: Queries specify log entry fields and values, combined with Boolean operators
    to select matching log entries. Most recent first is the default order, unless
    an explicit ordering is given in the query. *For brevity, the details of query
    syntax are omitted.*
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 查询指定日志条目字段和值，并结合布尔运算符选择匹配的日志条目。默认情况下，最先显示最新的条目，除非查询中明确指定排序顺序。*为简洁起见，查询语法的详细内容被省略。*
- en: Filtered logs are displayed with symbolic identifiers (see Section 2.3) instead
    of the raw log contents. Queries may use symbolic identifiers present in filtered
    log content; for example, if a filtered log entry shows the IP address `US1`,
    a query of `[IP = US1]` would find other logs from that IP address without disclosing
    the address itself.
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 过滤后的日志使用符号标识符显示（参见第2.3节），而不是原始日志内容。查询可以使用过滤日志内容中的符号标识符；例如，如果一个过滤后的日志条目显示IP地址`US1`，则查询`[IP
    = US1]`将找到来自该IP地址的其他日志，而不会透露实际的IP地址。
- en: '**Queries over filtered logs must disallow searches on filtered fields with
    exact values. For example, even if IP addresses are not shown, if the user can
    guess** `[IP = 1.1.1.1]` **(and so forth) they may eventually hit a log entry
    that will show it as something like** **USA888 and then be able to infer the actual
    value.**'
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: '**对过滤日志的查询必须禁止对具有精确值的过滤字段进行搜索。例如，即使IP地址未显示，如果用户能够猜到** `[IP = 1.1.1.1]` **（等等），他们最终可能会找到一条日志条目，其中显示为**
    **USA888，然后能够推断出实际值。**'
- en: Even when unfiltered access is approved, users must select an option to begin
    unfiltered viewing and querying. **Best practice maximizes use of filtered logs,
    only revealing filtered values on an as-needed basis, and it is important that
    the user interface encourage this.**
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 即使批准了未过滤的访问，用户也必须选择一个选项才能开始未过滤的查看和查询。**最佳实践是最大限度地使用过滤日志，仅在需要时才揭示过滤后的值，且重要的是用户界面应鼓励这种做法。**
- en: Users can renounce the right to unfiltered log access when the task is completed.
    The user interface should promote this after a period of inactivity to minimize
    risk of unnecessary access.
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 用户在任务完成后可以放弃对未过滤日志的访问权。用户界面应在一段时间不活跃后提示此操作，以减少不必要访问的风险。
- en: '**Web pages displaying log contents should not be locally cached by user agents
    to avoid inadvertent disclosure and to ensure that, on expiry, the log data is
    no longer available.**'
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: '**显示日志内容的网页不应被用户代理本地缓存，以避免无意的泄露，并确保在过期后，日志数据不再可用。**'
- en: Section 8 – Technical Design
  id: totrans-154
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 第8节 – 技术设计
- en: The Logger Recorder service consists of a write-only interface for applications
    to stream log event data that will be written to persistent storage, and a query
    interface to get views of those logs. Storage is a sequence of write-append files
    consisting of UTF-8 lines of text, with one line per log event. Log data as described
    by the relevant schema (see above) maps to/from a canonical representation as
    text. *Details of formatting are omitted for this example.*
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: Logger Recorder 服务包括一个仅写接口，用于让应用程序流式传输日志事件数据，并将其写入持久化存储，同时提供查询接口以查看这些日志。存储是一个按顺序写入追加的文件序列，包含UTF-8文本行，每行代表一个日志事件。日志数据根据相关模式（见上文）映射到/从规范表示作为文本。*格式化的细节在本示例中省略。*
- en: '**Log data fields subject to filtering should be stored in the filtered representation
    in addition to the raw data encrypted with an AES key generated by the service,
    using a new key every day. Use a hardware key storage or suitable means of securely
    protecting these keys.**'
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: '**受过滤影响的日志数据字段应存储为过滤后的表示形式，并与使用服务生成的AES密钥加密的原始数据一起保存，每天使用一个新的密钥。使用硬件密钥存储或其他合适的方式来安全保护这些密钥。**'
- en: Since exhausting available storage represents a fatal error for a logging service,
    the write rate is measured against free space (`free_storage_MB` / `avg_logging_MB_per_hour`)
    and a priority operational alert is raised if space for fewer than 10 hours of
    data, assuming constant write volumes, remains (this number of hours to alert
    is configurable).
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 由于存储空间耗尽会导致日志服务发生致命错误，因此写入速率是基于可用空间进行衡量的（`free_storage_MB` / `avg_logging_MB_per_hour`），如果空间不足以存储10小时的数据（假设写入量恒定），则会触发优先级操作警报（此警报的小时数可以配置）。
- en: For performance, consider a SQL database recording filtered log event information
    (timestamp, log type, filename, and offset), supplementing the actual log files
    for efficient access.
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 为了提高性能，可以考虑使用SQL数据库记录过滤后的日志事件信息（时间戳、日志类型、文件名和偏移量），以补充实际的日志文件，便于高效访问。
- en: Filtered logs hide private data with symbolic identifiers (for example, `US1`
    for an IP address in the US). **To avoid storing unfiltered private data, these
    maps go from a secure digest of the unfiltered data value to the filtered moniker.**
    This mapping is temporary and maintained by Logger Viewer separately for each
    user context per log. Users have the ability to clear mappings for a fresh start,
    or after 24 hours of non-use, they are automatically cleared to prevent useless
    buildup over time.
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 过滤日志通过符号标识符隐藏私人数据（例如，`US1`代表美国的IP地址）。**为了避免存储未过滤的私人数据，这些映射从未过滤数据值的安全摘要映射到过滤后的标识符。**
    这种映射是临时的，由Logger Viewer根据每个日志的用户上下文单独维护。用户可以清除映射以重新开始，或者在24小时不使用后，它们会自动清除，以防止随着时间的推移积累无用数据。
- en: Section 9 – Configuration
  id: totrans-160
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 第9节 – 配置
- en: Log retention is configured as follows. **Data is automatically, securely, and
    permanently deleted beyond the retention period (not just moved to trash; use
    the** `shred(1)` **command or similar).**
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 日志保留配置如下。**数据将在保留期结束后自动、安全并永久删除（不仅仅是移至回收站；请使用`shred(1)`命令或类似工具）。**
- en: '[PRE12]'
  id: totrans-162
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'Log access is granted by configuring lists of authorized users:'
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 通过配置授权用户列表来授予日志访问权限：
- en: '[PRE13]'
  id: totrans-164
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: Users allowed filtered access to the log denoted `Log1` are listed within brackets,
    as shown above (for example, `u1`, `u2`, `u3`). Users permitted unfiltered access
    are then similarly listed. These users will be granted access only following an
    approved request. Finally, users with the power to grant approval for limited
    unfiltered access are listed in the same manner.
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 被允许过滤访问名为`Log1`的日志的用户将以括号表示，如上所示（例如，`u1`，`u2`，`u3`）。被允许不经过过滤访问的用户将以类似方式列出。这些用户只有在批准请求后才能获得访问权限。最后，有权授予有限不经过过滤访问权限的用户将以相同的方式列出。
- en: Section 10 – References
  id: totrans-166
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 第10节 – 参考文献
- en: The following documents are useful for understanding this design document.
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 以下文档对于理解本设计文档非常有用。
- en: '*These are fictional.*'
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: '*这些是虚构的。*'
- en: Enterprise baseline design assumptions document (referenced in Section 2)
  id: totrans-169
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 企业基线设计假设文档（在第2节中引用）
- en: Enterprise general data protection policy and guidelines
  id: totrans-170
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 企业一般数据保护政策和指南
- en: Publish/subscribe protocol design document (referenced in Section 4)
  id: totrans-171
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 发布/订阅协议设计文档（在第4节中引用）
- en: END OF DOCUMENT*
  id: totrans-172
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 文件结束*
