- en: Chapter 6. Juniper Olive and VSRX Firefly
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第6章. Juniper Olive和VSRX Firefly
- en: You can install and run Juniper routers with GNS3 in several ways. In this chapter,
    I show you how to use VirtualBox and Quick Emulator (QEMU) to create GNS3-ready
    Juniper devices and then install Juniper’s vSRX Firefly firewall.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以通过几种方式在GNS3中安装并运行Juniper路由器。在本章中，我将向你展示如何使用VirtualBox和快速仿真器（QEMU）来创建GNS3可用的Juniper设备，并安装Juniper的vSRX
    Firefly防火墙。
- en: QEMU is an open source PC emulator similar to VirtualBox. It’s less polished
    but has many powerful features and is fully integrated into GNS3\. Using QEMU,
    you can run many network operating systems including Cisco ASA, IDS, IOS-XR, NX-OSv,
    and a special version of Juniper’s Junos OS known as Juniper Olive. In this chapter,
    I focus only on Juniper.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: QEMU是一个开源的PC仿真器，类似于VirtualBox。它的界面不如VirtualBox精致，但有许多强大的功能，并且与GNS3完全集成。使用QEMU，你可以运行许多网络操作系统，包括Cisco
    ASA、IDS、IOS-XR、NX-OSv，以及一种特别版本的Juniper的Junos OS，称为Juniper Olive。在本章中，我只关注Juniper。
- en: Installing QEMU on Windows and OS X
  id: totrans-3
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 在Windows和OS X上安装QEMU
- en: 'If you installed GNS3 on Windows or OS X, then QEMU should have been installed
    for you already. The GNS3 installer may have installed two versions of QEMU: a
    stable version that was configured automatically during the GNS3 installation
    and a newer version that contains additional, untested features. If you need your
    projects to be completely stable, I recommend using only the preconfigured version.'
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你在Windows或OS X上安装了GNS3，那么QEMU应该已经为你安装好了。GNS3安装程序可能已经安装了两个版本的QEMU：一个稳定版本，已经在GNS3安装过程中自动配置，另一个是包含额外未经过测试功能的更新版本。如果你需要项目完全稳定，我建议只使用预配置的版本。
- en: If you installed GNS3 using the defaults outlined in [Chapter 2](ch02.html "Chapter 2. Installing
    a Basic GNS3 System"), you should find the QEMU applications under *C:\Program
    Files\GNS3\qemu-0.13.0* on both 32-bit and 64-bit Windows systems, but keep in
    mind that this directory will change as new versions of QEMU are introduced and
    added to GNS3\. On OS X, you should find QEMU under */Applications/GNS3.app/Contents/Resources/qemu/bin/*.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你按照[第2章](ch02.html "第2章. 安装基础的GNS3系统")中概述的默认设置安装了GNS3，那么你应该可以在32位和64位Windows系统下的*C:\Program
    Files\GNS3\qemu-0.13.0*目录中找到QEMU应用程序，但请记住，随着QEMU的新版本引入并加入到GNS3中，这个目录可能会发生变化。在OS
    X上，你应该可以在*/Applications/GNS3.app/Contents/Resources/qemu/bin/*目录下找到QEMU。
- en: Installing QEMU on Linux
  id: totrans-6
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 在Linux上安装QEMU
- en: QEMU on Ubuntu can be installed using a package or compiled from source code.
    To install from a package, update your package manager and install QEMU from the
    command line.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 在Ubuntu上，QEMU可以通过包管理器安装或从源代码编译安装。要通过包管理器安装，更新你的包管理器并通过命令行安装QEMU。
- en: '[PRE0]'
  id: totrans-8
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'Alternatively, you can install the `qemu-system-x86` package. This is a much
    smaller installation that should be capable of running any operating system that
    you want to use with GNS3\. To install the x86 architecture–only version of QEMU,
    use the following commands:'
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 另外，你也可以安装`qemu-system-x86`包。这是一个更小的安装，应该能够运行你想要在GNS3中使用的任何操作系统。要安装x86架构版本的QEMU，可以使用以下命令：
- en: '[PRE1]'
  id: totrans-10
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: You may want to compile QEMU from source code, depending on what version of
    QEMU is available for your system. Although precompiled packages of QEMU exist
    on many Linux distributions, they may not be the newest version available and
    may not include the GTK toolkit that provides the QEMU graphical user interface.
    In that case, you can access the QEMU interface by installing a VNC viewer program,
    like GNC Viewer.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 你可能想要从源代码编译QEMU，具体取决于你系统上可用的QEMU版本。尽管许多Linux发行版上有预编译的QEMU包，但它们可能不是最新版本，并且可能不包括提供QEMU图形用户界面的GTK工具包。在这种情况下，你可以通过安装VNC查看器程序（如GNC
    Viewer）来访问QEMU界面。
- en: 'When you install from source code, you also have to install other packages
    required by QEMU before compiling the source. Update your package manager and
    install these packages now:'
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 当你从源代码安装时，你还需要在编译源代码之前安装QEMU所需的其他软件包。现在更新你的包管理器并安装这些软件包：
- en: '[PRE2]'
  id: totrans-13
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'Next, download the QEMU source code from the QEMU website (*[http://www.qemu-project.org/](http://www.qemu-project.org/)*)
    and unzip the file, as shown here:'
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，从QEMU官网（*[http://www.qemu-project.org/](http://www.qemu-project.org/)）下载QEMU源代码并解压文件，如下所示：
- en: '[PRE3]'
  id: totrans-15
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: After unzipping the files, move to the QEMU installation directory and enter
    the `configure` and `make` commands to compile the source code.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 解压文件后，进入QEMU安装目录，并输入`configure`和`make`命令来编译源代码。
- en: '[PRE4]'
  id: totrans-17
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: Finally, complete the process by installing the compiled files on your system.
    This must be done using elevated root privileges.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，通过使用提升的root权限安装编译后的文件来完成安装过程。
- en: '[PRE5]'
  id: totrans-19
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: When the installation is complete, you should find QEMU binaries under */usr/local/bin/*,
    and the QEMU support files should be in the */usr/local/share/qemu/* directory.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 安装完成后，您应该可以在*/usr/local/bin/*目录下找到QEMU二进制文件，QEMU支持文件应位于*/usr/local/share/qemu/*目录中。
- en: With QEMU installed, you’re ready to start creating and using QEMU devices in
    GNS3.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 安装了QEMU后，您就可以开始在GNS3中创建和使用QEMU设备了。
- en: Introducing Juniper
  id: totrans-22
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 介绍Juniper
- en: Most people have heard of Cisco, but relatively few have heard of Juniper Networks.
    Like Cisco, Juniper produces a wide range of networking hardware, and Internet
    service providers use its extremely high-throughput devices to efficiently route
    billions of packets for their customers.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 大多数人都听说过思科（Cisco），但相对较少人听说过Juniper Networks。像思科一样，Juniper生产广泛的网络硬件，互联网服务提供商使用其超高吞吐量的设备来高效地为客户路由数十亿个数据包。
- en: All Juniper devices are designed around a common FreeBSD code base, though not
    every Juniper device runs the FreeBSD operating system. Instead, they use its
    kernel only as a framework for another operating system known as Junos OS. However,
    because Junos OS is designed around FreeBSD, you can run a special version of
    the software on your PC called Juniper Olive.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 所有Juniper设备都基于一个共同的FreeBSD代码库设计，尽管并非所有Juniper设备都运行FreeBSD操作系统。相反，它们仅使用FreeBSD的内核作为另一个操作系统——Junos
    OS的框架。然而，由于Junos OS是基于FreeBSD设计的，您可以在PC上运行一个特别版本的软件，称为Juniper Olive。
- en: Juniper Olive is a functional version of Junos OS. Because it runs on a regular
    PC and not an actual Juniper chassis, it lacks the proprietary ASIC hardware to
    achieve the high throughput of a real Juniper device. Otherwise, it’s the real
    deal and not a simulation of the operating system. This makes it well suited for
    studying for the Juniper Networks Certified Associate (JNCIA) certification and
    other entry-level certifications.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: Juniper Olive是Junos OS的一个功能版本。因为它运行在普通PC上，而不是实际的Juniper机箱，所以它缺乏专有的ASIC硬件来实现与真实Juniper设备相同的高吞吐量。除此之外，它就是Junos
    OS的真实版本，而不是操作系统的模拟版本。这使得它非常适合用于学习Juniper Networks认证助理（JNCIA）认证以及其他入门级认证。
- en: Note
  id: totrans-26
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: '*Juniper provides another virtual router called vMX that runs on bare-metal
    x86 hardware or as a virtual machine using QEMU, VirtualBox, or VMware, which
    allows it to be integrated into GNS3\. It’s what Juniper calls a scalable “pay
    as you grow” solution.*'
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: '*Juniper还提供了另一款虚拟路由器，叫做vMX，它可以在裸机x86硬件上运行，也可以通过QEMU、VirtualBox或VMware作为虚拟机运行，允许它集成到GNS3中。这就是Juniper所称的可扩展“按需付费”解决方案。*'
- en: Juniper Extends an Olive Branch
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: Juniper伸出橄榄枝
- en: Juniper Olive is rumored to be an in-house version of Junos OS that’s meant
    to be used only by Juniper developers and not intended for public consumption,
    but only Juniper knows for sure. If you contact the company, you’ll be told it’s
    an “unsupported version.” Juniper won’t provide you with the software, and Juniper
    certainly won’t give you any support. However, GNS3 fully supports Juniper Olive
    integration, allowing you to add Juniper routers to your GNS3 projects.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: Juniper Olive据说是Juniper公司内部版本的Junos OS，仅供Juniper开发人员使用，不面向公众，但只有Juniper公司知道确切情况。如果您联系公司，他们会告诉您这是一个“未支持版本”。Juniper不会向您提供软件，也不会为您提供任何支持。然而，GNS3完全支持Juniper
    Olive集成，允许您将Juniper路由器添加到GNS3项目中。
- en: Installing Juniper
  id: totrans-30
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 安装Juniper
- en: It’s been said that if you give a person a fish, you feed them for a day, but
    if you teach a person to fish, you feed them for a lifetime. This adage holds
    true when creating a Juniper Olive, so let’s go fishing! Although there are many
    ways to configure and install Olive (including scripts that automate the process
    or preconfigured virtual machines that can be found on the Internet), learning
    to do it manually allows you to adjust the parameters as necessary when new Olive
    versions become available.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 有人说过，如果你给一个人一条鱼，你就喂饱他一天；但如果你教会一个人钓鱼，你就喂饱他一辈子。这句谚语在创建Juniper Olive时非常适用，所以让我们一起去钓鱼吧！尽管有许多方式可以配置和安装Olive（包括自动化过程的脚本或可以在互联网上找到的预配置虚拟机），但手动学习可以让你在新版本的Olive发布时根据需要调整参数。
- en: 'When used with GNS3, the Juniper Olive software is often installed using VirtualBox
    or QEMU. In this section, you’ll work with QEMU, but before you can create an
    Olive, your system must meet the following requirements:'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 在与GNS3一起使用时，Juniper Olive软件通常通过VirtualBox或QEMU安装。在本节中，您将使用QEMU，但在创建Olive之前，您的系统必须满足以下要求：
- en: 8GB available disk space
  id: totrans-33
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 8GB可用磁盘空间
- en: 1024MB available memory for QEMU/Juniper
  id: totrans-34
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 1024MB可用内存用于QEMU/Juniper
- en: QEMU installed on your system
  id: totrans-35
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 您的系统上已安装QEMU
- en: FreeBSD-4.11 mini ISO
  id: totrans-36
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: FreeBSD-4.11 mini ISO
- en: Juniper Olive software
  id: totrans-37
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Juniper Olive 软件
- en: Let’s look at how to create an Olive and where to get the software to do it.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们来看一下如何创建 Olive 并获取相关软件。
- en: Process Overview
  id: totrans-39
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 流程概述
- en: The Juniper Olive installation software works a lot like a common parasite,
    with FreeBSD as its unsuspecting host. To create an Olive, you’ll install a copy
    of FreeBSD using QEMU or VirtualBox. Next, you’ll copy a gzipped tarball of the
    Juniper Olive software to your FreeBSD virtual machine. There, you’ll unzip the
    package and make a small modification, and then you’ll zip the files back into
    a FreeBSD installable package. Finally, you’ll install the package and reboot
    the FreeBSD system.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: Juniper Olive 安装软件的工作方式有点像一个常见的寄生虫，以 FreeBSD 为其不知情的宿主。为了创建 Olive，你需要使用 QEMU
    或 VirtualBox 安装一份 FreeBSD。接下来，你需要将 Juniper Olive 软件的 gzipped tarball 文件复制到 FreeBSD
    虚拟机中。在那里，你将解压包并进行一些小的修改，然后将文件重新打包成 FreeBSD 可安装包。最后，你将安装该包并重启 FreeBSD 系统。
- en: This is where things get interesting. The first time you boot your system, the
    Juniper Olive software invades its FreeBSD host. It will repartition the FreeBSD
    hard disk, copy new files to the system, and keep any FreeBSD files that it needs.
    When it’s finished, you should have a functional Juniper router.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 到这里，事情变得有趣了。第一次启动系统时，Juniper Olive 软件将入侵 FreeBSD 宿主系统。它会重新分区 FreeBSD 硬盘，复制新文件到系统，并保留任何它需要的
    FreeBSD 文件。完成后，你应该会拥有一个功能正常的 Juniper 路由器。
- en: Acquiring FreeBSD
  id: totrans-42
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 获取 FreeBSD
- en: A FreeBSD CD image is required to install FreeBSD with QEMU. Several versions
    are available that are suitable for creating Juniper Olive, but I recommend a
    mini ISO. It contains all the necessary files, and it’s the fastest to download.
    Download the *4.11-RELEASE-i386-miniinst.iso* file from the FreeBSD archive (*[ftp://ftp-archive.freebsd.org/](ftp://ftp-archive.freebsd.org/)*).
    I recommend this FreeBSD version instead of more recent ones because it seems
    to work well with almost any Olive version.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 安装 FreeBSD 需要一个 FreeBSD CD 镜像。可以找到多个适合创建 Juniper Olive 的版本，但我推荐使用迷你 ISO。它包含所有必要的文件，并且下载速度最快。从
    FreeBSD 存档中下载 *4.11-RELEASE-i386-miniinst.iso* 文件 (*[ftp://ftp-archive.freebsd.org/](ftp://ftp-archive.freebsd.org/)*)。我推荐使用这个版本的
    FreeBSD，而不是更新版本，因为它似乎与几乎所有 Olive 版本兼容。
- en: Note
  id: totrans-44
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: '*You can find a ready-to-use QEMU (and VirtualBox) image with FreeBSD already
    installed at the GNS3 website* ([http://www.gns3.com/](http://www.gns3.com/))
    *in the Download section, under QEMU appliances.*'
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: '*你可以在 GNS3 网站的下载区找到一个已经安装了 FreeBSD 的 QEMU（和 VirtualBox）镜像* ([http://www.gns3.com/](http://www.gns3.com/))
    *，在 QEMU 设备下。*'
- en: Acquiring Juniper Olive Software
  id: totrans-46
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 获取 Juniper Olive 软件
- en: Next, you need to acquire the Juniper Olive software. The software is available
    as a FreeBSD installable package and should have a name like *jinstall-12.1R1.9-domestic-olive.tgz*.
    Because Juniper Olive is not supported by Juniper, you cannot get a copy of the
    software directly from Juniper.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，你需要获取 Juniper Olive 软件。该软件可以作为 FreeBSD 可安装包提供，文件名应类似于 *jinstall-12.1R1.9-domestic-olive.tgz*。由于
    Juniper Olive 不再由 Juniper 官方支持，因此无法直接从 Juniper 获取该软件。
- en: Creating a Juniper Olive CD Image File
  id: totrans-48
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 创建 Juniper Olive CD 镜像文件
- en: After you have the Juniper Olive software, you need a way to copy the package
    to your FreeBSD virtual machine to install it. There’s more than one way to do
    this, but the simplest way is to mount an ISO image file on your FreeBSD virtual
    machine, just as you would a regular CD. Before you can do that, you have to create
    your own ISO image of the Olive software.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 拥有 Juniper Olive 软件后，你需要一种方法将该软件包复制到 FreeBSD 虚拟机中进行安装。有多种方法可以实现这一点，但最简单的方法是将
    ISO 镜像文件挂载到 FreeBSD 虚拟机上，就像挂载常规 CD 一样。在此之前，你需要创建自己的 Olive 软件 ISO 镜像文件。
- en: Creating an ISO in Windows
  id: totrans-50
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 在 Windows 中创建 ISO
- en: To create an ISO image file using Windows, you first need to install ISO image
    creation software. I recommend ISO Recorder (*[http://isorecorder.alexfeinman.com/isorecorder.htm](http://isorecorder.alexfeinman.com/isorecorder.htm)*).
    It’s free, easy to install, and works well. Download the software and launch the
    installer. Then click **Next** and follow the prompts to complete the installation.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 要在 Windows 中创建 ISO 镜像文件，首先需要安装 ISO 镜像创建软件。我推荐使用 ISO Recorder (*[http://isorecorder.alexfeinman.com/isorecorder.htm](http://isorecorder.alexfeinman.com/isorecorder.htm)*).
    它是免费的，易于安装，而且工作良好。下载该软件并启动安装程序。然后点击 **下一步** 并按照提示完成安装。
- en: After installing ISO Recorder, you should be able to create an ISO image of
    the Juniper Olive software. Create a folder and copy your gzipped Olive file into
    the folder (named *juniper-olive*, for example). Then, right-click the folder
    and select **Create ISO image file**.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 安装 ISO Recorder 后，你应该能够创建 Juniper Olive 软件的 ISO 镜像。创建一个文件夹并将你的 gzipped Olive
    文件复制到该文件夹中（例如命名为*juniper-olive*）。然后，右键点击该文件夹并选择**创建 ISO 镜像文件**。
- en: The ISO Recorder Creation Wizard appears, as shown in [Figure 6-1](ch06.html#iso_recorder_creation_wizard
    "Figure 6-1. ISO Recorder Creation Wizard").
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 如图 [6-1](ch06.html#iso_recorder_creation_wizard "图 6-1. ISO Recorder 创建向导")
    所示，ISO Recorder 创建向导会出现。
- en: '![ISO Recorder Creation Wizard](httpatomoreillycomsourcenostarchimages2208969.png.jpg)'
  id: totrans-54
  prefs: []
  type: TYPE_IMG
  zh: '![ISO Recorder Creation Wizard](httpatomoreillycomsourcenostarchimages2208969.png.jpg)'
- en: Figure 6-1. ISO Recorder Creation Wizard
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 图 6-1. ISO Recorder 创建向导
- en: Under Create image, select the **Directory** radio button, change the Image
    format to **CD**, click **Next**, and follow the prompts to create your ISO image.
    After you have a Juniper ISO, you’re ready to install Juniper Olive on Windows.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 在创建镜像下，选择**目录**单选按钮，将镜像格式更改为**CD**，点击**下一步**，并按照提示创建 ISO 镜像。在你拥有 Juniper ISO
    后，你就可以在 Windows 上安装 Juniper Olive。
- en: Creating an ISO in OS X
  id: totrans-57
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 在 OS X 中创建 ISO 镜像
- en: 'On computers running OS X, copy your Juniper image file to a folder and use
    `hdiutil` to create an ISO image of the folder’s contents. In the following listing,
    I’ve created an ISO image file named *juniper-olive.iso* using a folder named
    *JUNOS*:'
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 在运行 OS X 的计算机上，将你的 Juniper 镜像文件复制到一个文件夹中，并使用`hdiutil`创建该文件夹内容的 ISO 镜像。在以下列表中，我使用名为*JUNOS*的文件夹创建了一个名为*juniper-olive.iso*的
    ISO 镜像文件：
- en: '[PRE6]'
  id: totrans-59
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: Now that you have a suitable ISO of the Olive software, you’re ready to install
    Juniper Olive on OS X.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 现在你已经拥有适合的 Olive 软件 ISO 镜像，你可以准备在 OS X 上安装 Juniper Olive。
- en: Creating an ISO in Linux
  id: totrans-61
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 在 Linux 中创建 ISO
- en: 'Creating an ISO image on Ubuntu Linux is almost the same as on OS X, except
    you use the `mkisofs` application. Copy your Juniper image file to a folder (*JUNOS*,
    for example) and enter the following commands to create the ISO:'
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 在 Ubuntu Linux 上创建 ISO 镜像与在 OS X 上几乎相同，不同之处在于你使用的是`mkisofs`应用程序。将你的 Juniper
    镜像文件复制到一个文件夹中（例如命名为*JUNOS*），然后输入以下命令来创建 ISO：
- en: '[PRE7]'
  id: totrans-63
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: Now that you have your ISO, there are only a few things left to do before you
    create a Juniper Olive.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 现在你已经有了 ISO 镜像，剩下的就是做几个步骤，然后就可以创建 Juniper Olive。
- en: Installing and Configuring FreeBSD Using QEMU
  id: totrans-65
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用 QEMU 安装和配置 FreeBSD
- en: The first step in creating a Juniper Olive is to create a QEMU virtual machine
    of FreeBSD. QEMU doesn’t have a graphical user interface, so you’ll do everything
    from the command line. You will use the `qemu-img` program to create a virtual
    disk image file and the `qemu` program to install and test your virtual machine.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 创建 Juniper Olive 的第一步是创建一个 FreeBSD 的 QEMU 虚拟机。QEMU 没有图形用户界面，所以你将通过命令行完成所有操作。你将使用`qemu-img`程序创建虚拟磁盘镜像文件，并使用`qemu`程序来安装和测试你的虚拟机。
- en: Note
  id: totrans-67
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: '*Not all QEMU installations are alike. On some installations, the QEMU application
    file might be named* qemu-system-i386 *or* qemu-system-x86_64*, or you may have
    both installed. If you’re unsure, check your QEMU installation directory.*'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: '*并非所有 QEMU 安装都相同。在某些安装中，QEMU 应用程序文件可能被命名为* qemu-system-i386 *或* qemu-system-x86_64*，或者你可能同时安装了这两个版本。如果不确定，请检查你的
    QEMU 安装目录。*'
- en: Preparing Your Build Directory
  id: totrans-69
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备你的构建目录
- en: 'Start by creating a build directory and then copy the FreeBSD installation
    ISO and the Juniper Olive ISO files to the directory, as in the following example:'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 首先创建一个构建目录，然后将 FreeBSD 安装 ISO 和 Juniper Olive ISO 文件复制到该目录，示例如下：
- en: '[PRE8]'
  id: totrans-71
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'If you’re using Windows, open a command prompt window and enter the following
    commands instead:'
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你使用的是 Windows，请打开命令提示符窗口并输入以下命令：
- en: '[PRE9]'
  id: totrans-73
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: Now that everything is prepped in your build directory, you can begin installing
    the system.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 现在你的构建目录中的所有准备工作都已完成，可以开始安装系统了。
- en: Installing a Junos-Friendly FreeBSD System
  id: totrans-75
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 安装一个适用于 Junos 的 FreeBSD 系统
- en: In this section, you’ll create a virtual hard disk using `qemu-img` and install
    FreeBSD on the virtual disk. I’ll only cover the basics of preparing FreeBSD for
    Olive and won’t go into a lot of detail about FreeBSD itself.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，你将使用`qemu-img`创建虚拟硬盘，并在该虚拟硬盘上安装 FreeBSD。我将只涵盖为 Olive 准备 FreeBSD 的基本步骤，不会详细讲解
    FreeBSD 本身。
- en: Preliminary Checks for Windows and OS X
  id: totrans-77
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: Windows 和 OS X 的初步检查
- en: If you’re a Windows user, install the Telnet Client application from the Programs
    and Features Control Panel before you begin.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你是 Windows 用户，请在开始之前从“程序和功能”控制面板安装 Telnet 客户端应用程序。
- en: If you’re a OS X user, you’ll want to add the QEMU file directory to your OS
    X search path. Verify the installation path to your QEMU files. If you installed
    QEMU manually, you should look for the *qemu-img* file in */opt/local/bin* or
    */usr/local/bin*. If you’re using QEMU that was installed with GNS3, you should
    find the file under */Applications/GNS3.app/Contents/Resources/qemu/bin/*. Enter
    the following commands to add the QEMU binaries to your OS X search path. Make
    a backup copy of your `.bash_profile` file before you begin.
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你是 OS X 用户，你需要将 QEMU 文件目录添加到 OS X 的搜索路径中。验证 QEMU 文件的安装路径。如果你是手动安装 QEMU，应该在
    */opt/local/bin* 或 */usr/local/bin* 中找到 *qemu-img* 文件。如果你使用的是与 GNS3 一起安装的 QEMU，应该在
    */Applications/GNS3.app/Contents/Resources/qemu/bin/* 目录下找到该文件。输入以下命令将 QEMU 二进制文件添加到你的
    OS X 搜索路径中。开始之前，先备份 `.bash_profile` 文件。
- en: '[PRE10]'
  id: totrans-80
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'After entering the commands, close and reopen a terminal window to enable the
    new search path. To verify your path is correct, enter the following command:'
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 输入命令后，关闭并重新打开一个终端窗口以启用新的搜索路径。为了验证路径是否正确，输入以下命令：
- en: '[PRE11]'
  id: totrans-82
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: The previous command will display your path configuration. If it’s not correct,
    you may need to restore your *.bash_profile-backup* file and try again. If it
    is correct, then you’re ready to move on.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 上一个命令将显示你的路径配置。如果路径不正确，你可能需要恢复你的 *.bash_profile-backup* 文件并重新尝试。如果路径正确，那么你就可以继续操作了。
- en: Getting Started
  id: totrans-84
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 开始使用
- en: Begin the installation by creating an 8GB virtual disk image file named *juniper.img*
    in your build directory. The *qemu-img* command options used here should work
    on all Unix-like systems.
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 通过在构建目录中创建一个名为 *juniper.img* 的 8GB 虚拟磁盘映像文件来开始安装。这里使用的 *qemu-img* 命令选项适用于所有类
    Unix 系统。
- en: '[PRE12]'
  id: totrans-86
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'Next, boot QEMU from the FreeBSD mini ISO using the following command:'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，使用以下命令从 FreeBSD mini ISO 启动 QEMU：
- en: '[PRE13]'
  id: totrans-88
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: Windows users should open a command prompt window and use the following commands
    instead. Be sure to enter the `path` command if QEMU isn’t already in your Windows
    path.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: Windows 用户应打开命令提示符窗口，并使用以下命令代替。如果 QEMU 未在你的 Windows 路径中，记得输入 `path` 命令。
- en: '[PRE14]'
  id: totrans-90
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: When FreeBSD boots, the Kernel Configuration Menu appears, as shown in [Figure 6-2](ch06.html#freebsd_kernel_configuration_menu
    "Figure 6-2. FreeBSD Kernel Configuration Menu").
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 当 FreeBSD 启动时，内核配置菜单将出现，如[图6-2](ch06.html#freebsd_kernel_configuration_menu
    "图6-2. FreeBSD 内核配置菜单")所示。
- en: '![FreeBSD Kernel Configuration Menu](httpatomoreillycomsourcenostarchimages2208971.png.jpg)'
  id: totrans-92
  prefs: []
  type: TYPE_IMG
  zh: '![FreeBSD 内核配置菜单](httpatomoreillycomsourcenostarchimages2208971.png.jpg)'
- en: Figure 6-2. FreeBSD Kernel Configuration Menu
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 图6-2. FreeBSD 内核配置菜单
- en: Press ENTER to skip the kernel configuration and continue with the installation.
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 按 ENTER 键跳过内核配置并继续安装。
- en: Next, the FreeBSD sysinstall Main Menu appears, shown in [Figure 6-3](ch06.html#sysinstall_main_menu
    "Figure 6-3. sysinstall Main Menu").
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，FreeBSD sysinstall 主菜单将出现，如[图6-3](ch06.html#sysinstall_main_menu "图6-3.
    sysinstall 主菜单")所示。
- en: '![sysinstall Main Menu](httpatomoreillycomsourcenostarchimages2208973.png.jpg)'
  id: totrans-96
  prefs: []
  type: TYPE_IMG
  zh: '![sysinstall 主菜单](httpatomoreillycomsourcenostarchimages2208973.png.jpg)'
- en: Figure 6-3. sysinstall Main Menu
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 图6-3. sysinstall 主菜单
- en: Use the arrow to move down, select **Standard** to begin a standard installation,
    and then press ENTER to continue.
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 使用箭头向下移动，选择 **Standard** 开始标准安装，然后按 ENTER 继续。
- en: Partitioning the Filesystem
  id: totrans-99
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 分区文件系统
- en: The next screen, shown in [Figure 6-4](ch06.html#fdisk_partitioning_message_screen
    "Figure 6-4. FDISK partitioning message screen"), displays basic information about
    using the FDISK Partition Editor.
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 下一屏幕，如[图6-4](ch06.html#fdisk_partitioning_message_screen "图6-4. FDISK 分区信息屏幕")所示，显示了使用
    FDISK 分区编辑器的基本信息。
- en: '![FDISK partitioning message screen](httpatomoreillycomsourcenostarchimages2208975.png.jpg)'
  id: totrans-101
  prefs: []
  type: TYPE_IMG
  zh: '![FDISK 分区信息屏幕](httpatomoreillycomsourcenostarchimages2208975.png.jpg)'
- en: Figure 6-4. FDISK partitioning message screen
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 图6-4. FDISK 分区信息屏幕
- en: Read the instructions and press ENTER to continue to the FDISK Partition Editor
    menu, shown in [Figure 6-5](ch06.html#fdisk_partition_editor_menu "Figure 6-5. FDISK
    Partition Editor menu").
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 阅读说明并按 ENTER 继续进入 FDISK 分区编辑器菜单，如[图6-5](ch06.html#fdisk_partition_editor_menu
    "图6-5. FDISK 分区编辑器菜单")所示。
- en: '![FDISK Partition Editor menu](httpatomoreillycomsourcenostarchimages2208977.png.jpg)'
  id: totrans-104
  prefs: []
  type: TYPE_IMG
  zh: '![FDISK 分区编辑器菜单](httpatomoreillycomsourcenostarchimages2208977.png.jpg)'
- en: Figure 6-5. FDISK Partition Editor menu
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 图6-5. FDISK 分区编辑器菜单
- en: The FDISK Partition Editor allows you to choose how much disk space you want
    to allocate to FreeBSD. Choose **A** to use the entire disk and then select **Q**
    to finish.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: FDISK 分区编辑器允许你选择分配给 FreeBSD 的磁盘空间。选择 **A** 使用整个磁盘，然后选择 **Q** 完成。
- en: The Install Boot Manager menu should appear next, as shown in [Figure 6-6](ch06.html#install_boot_manager_menu
    "Figure 6-6. Install Boot Manager menu").
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来应该出现安装引导管理器菜单，如[图6-6](ch06.html#install_boot_manager_menu "图6-6. 安装引导管理器菜单")所示。
- en: '![Install Boot Manager menu](httpatomoreillycomsourcenostarchimages2208979.png.jpg)'
  id: totrans-108
  prefs: []
  type: TYPE_IMG
  zh: '![安装引导管理器菜单](httpatomoreillycomsourcenostarchimages2208979.png.jpg)'
- en: Figure 6-6. Install Boot Manager menu
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 图6-6. 安装引导管理器菜单
- en: Use the arrow to move down, select **Standard** to install a standard master
    boot record (MBR), and press ENTER to continue.
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 使用箭头键向下移动，选择**Standard**来安装标准的主引导记录（MBR），然后按ENTER继续。
- en: FreeBSD then displays a message about creating BSD partitions inside your newly
    created FDISK partition, as shown in [Figure 6-7](ch06.html#bsd_partition_message
    "Figure 6-7. BSD partition message").
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 然后FreeBSD会显示一条关于在你新创建的FDISK分区内创建BSD分区的消息，如[图6-7](ch06.html#bsd_partition_message
    "图6-7. BSD分区消息")所示。
- en: '![BSD partition message](httpatomoreillycomsourcenostarchimages2208981.png.jpg)'
  id: totrans-112
  prefs: []
  type: TYPE_IMG
  zh: '![BSD分区消息](httpatomoreillycomsourcenostarchimages2208981.png.jpg)'
- en: Figure 6-7. BSD partition message
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 图6-7. BSD分区消息
- en: After reading the message, press ENTER to continue to the FreeBSD Disklabel
    Editor.
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 阅读完消息后，按ENTER继续进入FreeBSD磁盘标签编辑器。
- en: The next step is to create *Juniper-compatible partitions*. It’s important to
    pay close attention to how you partition the virtual hard disk because the Juniper
    Olive package must see the correct FreeBSD partitions or the installation will
    fail. You also must create your partitions in a specific order.
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 下一步是创建*适用于Juniper的分区*。你需要特别注意虚拟硬盘的分区方式，因为Juniper Olive包必须能够看到正确的FreeBSD分区，否则安装会失败。你还必须按特定顺序创建分区。
- en: To create your first partition, select **C** and type the partition size in
    the field provided, as shown in [Figure 6-8](ch06.html#specify_a_partition_size
    "Figure 6-8. Specify a partition size.").
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 要创建你的第一个分区，选择**C**并在提供的字段中输入分区大小，如[图6-8](ch06.html#specify_a_partition_size
    "图6-8. 指定分区大小.")所示。
- en: '![Specify a partition size.](httpatomoreillycomsourcenostarchimages2208983.png.jpg)'
  id: totrans-117
  prefs: []
  type: TYPE_IMG
  zh: '![指定分区大小。](httpatomoreillycomsourcenostarchimages2208983.png.jpg)'
- en: Figure 6-8. Specify a partition size.
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 图6-8. 指定分区大小。
- en: I entered 1024M to create a 1GB partition. Press ENTER to accept this value,
    and you’ll see the partition type option screen, shown in [Figure 6-9](ch06.html#choose_a_partition_type
    "Figure 6-9. Choose a partition type.").
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 我输入了1024M以创建一个1GB的分区。按ENTER接受此值，然后你将看到分区类型选择屏幕，如[图6-9](ch06.html#choose_a_partition_type
    "图6-9. 选择分区类型.")所示。
- en: '![Choose a partition type.](httpatomoreillycomsourcenostarchimages2208985.png.jpg)'
  id: totrans-120
  prefs: []
  type: TYPE_IMG
  zh: '![选择分区类型。](httpatomoreillycomsourcenostarchimages2208985.png.jpg)'
- en: Figure 6-9. Choose a partition type.
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 图6-9. 选择分区类型。
- en: Press ENTER to create a filesystem (FS) partition type, and you’ll be given
    the option to choose the mount point for the partition, as shown in [Figure 6-10](ch06.html#choose_a_mount_point_for_the_partitiondo
    "Figure 6-10. Choose a mount point for the partition.").
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 按ENTER创建文件系统（FS）分区类型，然后你将看到选择分区挂载点的选项，如[图6-10](ch06.html#choose_a_mount_point_for_the_partitiondo
    "图6-10. 选择分区的挂载点.")所示。
- en: '![Choose a mount point for the partition.](httpatomoreillycomsourcenostarchimages2208987.png.jpg)'
  id: totrans-123
  prefs: []
  type: TYPE_IMG
  zh: '![选择分区的挂载点。](httpatomoreillycomsourcenostarchimages2208987.png.jpg)'
- en: Figure 6-10. Choose a mount point for the partition.
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 图6-10. 选择分区的挂载点。
- en: To create a mount point for your root partition, type a forward slash (**`/`**)
    and press ENTER to complete the configuration of your first partition.
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 要为根分区创建挂载点，输入正斜杠（**`/`**），然后按ENTER完成第一个分区的配置。
- en: Using [Table 6-1](ch06.html#freebsd_partitioning_for_juniper_olive "Table 6-1. FreeBSD
    Partitioning for Juniper Olive"), follow the same procedure to create the complete
    filesystem layout. The order is important! After creating your root partition
    (`/`), work your way down the list, finishing with the `/var` partition. When
    you get to the swap partition, make sure you choose `swap` and not `FS` as your
    partition type. The `/var` partition is last, so when you create it, accept the
    default partition block size. This value uses the remaining free space on your
    partition. Remember, if the partitions are not created in sequential order, the
    partition names won’t match the mount points, and Juniper Olive won’t install
    properly.
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 使用[表 6-1](ch06.html#freebsd_partitioning_for_juniper_olive "表 6-1. Juniper Olive
    的 FreeBSD 分区")，按照相同的步骤创建完整的文件系统布局。顺序很重要！在创建根分区 (`/`) 后，按照顺序继续往下创建，最后创建 `/var`
    分区。当到达交换分区时，确保选择 `swap` 而不是 `FS` 作为分区类型。`/var` 分区是最后一个，所以创建时接受默认的分区块大小。此值使用分区上的剩余空间。记住，如果分区没有按顺序创建，分区名称将与挂载点不匹配，Juniper
    Olive 将无法正确安装。
- en: Table 6-1. FreeBSD Partitioning for Juniper Olive
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 表 6-1. Juniper Olive 的 FreeBSD 分区
- en: '| Part | Mount | Size |'
  id: totrans-128
  prefs: []
  type: TYPE_TB
  zh: '| 分区 | 挂载点 | 大小 |'
- en: '| --- | --- | --- |'
  id: totrans-129
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- |'
- en: '| ad0s1a | `/` | 1024 MB |'
  id: totrans-130
  prefs: []
  type: TYPE_TB
  zh: '| ad0s1a | `/` | 1024 MB |'
- en: '| ad0s1b | `swap` | 1024 MB |'
  id: totrans-131
  prefs: []
  type: TYPE_TB
  zh: '| ad0s1b | `swap` | 1024 MB |'
- en: '| ad0s1e | `/config` | 1024 MB |'
  id: totrans-132
  prefs: []
  type: TYPE_TB
  zh: '| ad0s1e | `/config` | 1024 MB |'
- en: '| ad0s1f | `/var` | remaining space |'
  id: totrans-133
  prefs: []
  type: TYPE_TB
  zh: '| ad0s1f | `/var` | 剩余空间 |'
- en: There are many ways to partition FreeBSD in preparation for the Olive install,
    but I’ve found this method to be the most reliable across different versions of
    Juniper Olive. When you’re done, the filesystem should look exactly like the one
    in [Figure 6-11](ch06.html#fully_configured_partition_layout_suitab "Figure 6-11. Fully
    configured partition layout suitable for Juniper Olive").
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 有很多方法可以在准备安装 Olive 时对 FreeBSD 进行分区，但我发现这种方法在不同版本的 Juniper Olive 中最为可靠。完成后，文件系统应与[图
    6-11](ch06.html#fully_configured_partition_layout_suitab "图 6-11. 完全配置的适用于 Juniper
    Olive 的分区布局")中的布局完全相同。
- en: '![Fully configured partition layout suitable for Juniper Olive](httpatomoreillycomsourcenostarchimages2208989.png.jpg)'
  id: totrans-135
  prefs: []
  type: TYPE_IMG
  zh: '![完全配置的适用于 Juniper Olive 的分区布局](httpatomoreillycomsourcenostarchimages2208989.png.jpg)'
- en: Figure 6-11. Fully configured partition layout suitable for Juniper Olive
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 图 6-11. 完全配置的适用于 Juniper Olive 的分区布局
- en: Once you’ve configured all the partitions, choose **Q** to complete the partitioning
    process and then choose your distribution set, as shown in [Figure 6-12](ch06.html#freebsd_distribution_choices
    "Figure 6-12. FreeBSD distribution choices").
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦配置好所有分区，选择**Q**完成分区过程，然后选择你的发行版，如[图 6-12](ch06.html#freebsd_distribution_choices
    "图 6-12. FreeBSD 发行版选择")所示。
- en: '![FreeBSD distribution choices](httpatomoreillycomsourcenostarchimages2208991.png.jpg)'
  id: totrans-138
  prefs: []
  type: TYPE_IMG
  zh: '![FreeBSD 发行版选择](httpatomoreillycomsourcenostarchimages2208991.png.jpg)'
- en: Figure 6-12. FreeBSD distribution choices
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 图 6-12. FreeBSD 发行版选择
- en: Use the arrow keys to scroll down, select **Minimal**, and then press the spacebar
    to make the selection. Now press TAB to select **OK** and press ENTER to finish.
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 使用箭头键向下滚动，选择**Minimal**，然后按空格键进行选择。现在按 TAB 键选择**OK**，然后按 ENTER 完成操作。
- en: Finishing Installation of FreeBSD
  id: totrans-141
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 完成 FreeBSD 安装
- en: Next, choose your installation media, as shown in [Figure 6-13](ch06.html#choosing_an_installation_media
    "Figure 6-13. Choosing an installation media").
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，选择你的安装介质，如[图 6-13](ch06.html#choosing_an_installation_media "图 6-13. 选择安装介质")所示。
- en: '![Choosing an installation media](httpatomoreillycomsourcenostarchimages2208993.png.jpg)'
  id: totrans-143
  prefs: []
  type: TYPE_IMG
  zh: '![选择安装介质](httpatomoreillycomsourcenostarchimages2208993.png.jpg)'
- en: Figure 6-13. Choosing an installation media
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 图 6-13. 选择安装介质
- en: Press ENTER to choose **CD/DVD** as your installation media, and the installation
    will begin. When it’s finished, the message shown in [Figure 6-14](ch06.html#file_installation_complete_message
    "Figure 6-14. File installation complete message") appears.
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 按 ENTER 选择**CD/DVD**作为安装介质，安装将开始。完成后，将显示[图 6-14](ch06.html#file_installation_complete_message
    "图 6-14. 文件安装完成消息")中的消息。
- en: '![File installation complete message](httpatomoreillycomsourcenostarchimages2208995.png.jpg)'
  id: totrans-146
  prefs: []
  type: TYPE_IMG
  zh: '![文件安装完成消息](httpatomoreillycomsourcenostarchimages2208995.png.jpg)'
- en: Figure 6-14. File installation complete message
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 图 6-14. 文件安装完成消息
- en: Because you’re using FreeBSD as a host for Junos OS, you don’t need to concern
    yourself with any of the FreeBSD configuration questions that follow this screen.
    Answer “no” to all remaining questions, and when asked to create a password for
    the root account, press ENTER to leave it blank. When you’re finished answering
    questions, allow the system to reboot, log on as *root*, and shut down FreeBSD
    using the `halt` command. Then close the window and quit the QEMU program.
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 因为你正在使用 FreeBSD 作为 Junos OS 的主机，所以你不需要关注此屏幕后面的任何 FreeBSD 配置问题。对所有剩余的问题回答“no”，当系统询问是否为
    root 账户创建密码时，按 ENTER 键保持空白。回答完所有问题后，允许系统重启，登录为*root*，并使用`halt`命令关闭 FreeBSD。然后关闭窗口并退出
    QEMU 程序。
- en: Installing the Juniper Olive Package in FreeBSD
  id: totrans-149
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 在 FreeBSD 中安装 Juniper Olive 包
- en: Now that the FreeBSD installation is complete, you can install the Juniper Olive
    package.
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 现在 FreeBSD 安装完成，你可以安装 Juniper Olive 包。
- en: Getting Your Olive Up and Running
  id: totrans-151
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 启动并运行你的 Olive
- en: Boot FreeBSD using QEMU with the following command to ensure that you can mount
    the *juniper-olive.iso* CD image file you created earlier. (On Windows, replace
    `qemu-system-i386` with `qemu-system-i386w`.)
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 使用以下命令通过 QEMU 启动 FreeBSD，以确保你可以挂载之前创建的*juniper-olive.iso* CD 镜像文件。（在 Windows
    上，将 `qemu-system-i386` 替换为 `qemu-system-i386w`。）
- en: '[PRE15]'
  id: totrans-153
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: If FreeBSD loads correctly, a login prompt should appear. Log in as *root* at
    the prompt; you shouldn’t need to enter a password, so just press ENTER. Then
    use the `mount` command to mount the *juniper-olive.iso* CD image.
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 如果 FreeBSD 正常加载，应该会出现登录提示。按照提示以*root*身份登录；你不需要输入密码，只需按 ENTER 键。然后使用 `mount`
    命令挂载*juniper-olive.iso* CD 镜像。
- en: '[PRE16]'
  id: totrans-155
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: Create a temporary directory named *olive* on the `/var` partition and extract
    the Juniper Olive package into the temporary directory.
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 在 `/var` 分区上创建一个名为*olive*的临时目录，并将 Juniper Olive 包解压到该临时目录中。
- en: '[PRE17]'
  id: totrans-157
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: Next, modify Junos OS to allow you to install the software on your QEMU virtual
    machine.
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，修改 Junos OS，以允许你在 QEMU 虚拟机上安装软件。
- en: '[PRE18]'
  id: totrans-159
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: Extract the *pkgtools* directory from *pkgtools.tgz* to another *temp* directory
    within the *olive* directory, and replace the *checkpic* file with the FreeBSD
    *true* file. This removes the Junos OS checkpic protection.
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 从*pkgtools.tgz*中提取*pkgtools*目录到*olive*目录中的另一个*temp*目录，并用 FreeBSD 的*true*文件替换*checkpic*文件。这将移除
    Junos OS 的 checkpic 保护。
- en: After the modification, gzip the *temp* directory contents back into a tarball
    named *pkgtools.tgz* and remove the *temp* directory you created.
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 修改后，将*temp*目录中的内容重新压缩为名为*pkgtools.tgz*的 tarball，并删除你创建的*temp*目录。
- en: '[PRE19]'
  id: totrans-162
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: 'Next, create a new Olive installation package and install it on your FreeBSD
    system. In the following listing, I’ve named the installation package *olive.tgz*:'
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，创建一个新的 Olive 安装包，并将其安装到你的 FreeBSD 系统中。在以下清单中，我将安装包命名为*olive.tgz*：
- en: '[PRE20]'
  id: totrans-164
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: After you install the Olive package, you should see an error message followed
    by some warning messages, which tell you that the package will erase any files
    that aren’t Junos configuration files and that you need to reboot to load the
    Junos OS software.
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 安装 Olive 包后，你应该看到一个错误信息，后面跟着一些警告信息，这些信息告诉你该包将删除任何非 Junos 配置文件，并且你需要重启以加载 Junos
    OS 软件。
- en: Any other onscreen instructions displayed can be ignored because they apply
    to an actual Juniper router, not an Olive installation on a PC. However, before
    continuing, you need to shut down the FreeBSD system using the `halt` command
    and quit QEMU.
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 屏幕上显示的其他任何指示可以忽略，因为它们适用于实际的 Juniper 路由器，而不是 PC 上的 Olive 安装。然而，在继续之前，你需要使用 `halt`
    命令关闭 FreeBSD 系统并退出 QEMU。
- en: '[PRE21]'
  id: totrans-167
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: The final step in installing Olive is to reboot the system and give the package
    time to complete its takeover of FreeBSD. At this point, you must provide the
    installer with extra memory, or the install will fail. Although Junos OS runs
    comfortably with 512MB of RAM, the installer needs 1024MB of RAM to create the
    RAM disk that it uses during installation.
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 安装 Olive 的最后一步是重启系统，并给予安装包足够的时间来完成对 FreeBSD 的接管。在这一点上，你必须为安装程序提供额外的内存，否则安装将失败。虽然
    Junos OS 在 512MB 的 RAM 下可以正常运行，但安装程序需要 1024MB 的 RAM 来创建它在安装过程中使用的 RAM 磁盘。
- en: 'In Linux and OS X, boot Juniper Olive with 1024MB of RAM to complete the installation,
    as follows:'
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 在 Linux 和 OS X 中，用 1024MB 的 RAM 启动 Juniper Olive 来完成安装，具体如下：
- en: '[PRE22]'
  id: totrans-170
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: 'Windows users should enter the following command instead:'
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: Windows 用户应输入以下命令：
- en: '[PRE23]'
  id: totrans-172
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: 'After you boot the system, you can watch the Olive software being installed
    by using telnet to connect to port 1001 of your localhost. (On Windows you may
    have to install the Telnet Client program from the Programs and Features Control
    Panel first.) Open a second Windows command prompt or terminal window, and enter
    the following command to see the installation output displayed on the console:'
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 系统启动后，你可以通过 telnet 连接到本地主机的 1001 端口，来观看 Olive 软件的安装过程。（在 Windows 上，你可能需要先从“程序和功能”控制面板安装
    Telnet 客户端程序。）打开第二个 Windows 命令提示符或终端窗口，输入以下命令，查看安装输出显示在控制台上：
- en: '[PRE24]'
  id: totrans-174
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: I highly recommend monitoring your install. It’s a great way to troubleshoot
    whether something goes wrong. Otherwise, you won’t know why an installation failed.
    A common problem is that not enough memory has been allocated to your virtual
    machine; another is that your partition sizes are too small or were created incorrectly.
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 我强烈建议你监控安装过程。这是排查问题的好方法，万一出现问题，你也能知道为什么安装失败。一个常见的问题是没有为虚拟机分配足够的内存；另一个问题是你的分区大小太小或创建不正确。
- en: The Juniper Olive installation can take 15 minutes or longer, depending on your
    hardware, because the installer performs a lot of tasks, such as repartitioning
    your FreeBSD hard drive and extracting various packages. When everything is complete,
    the system should automatically reboot, load Junos OS, and present you with what
    appears to be a FreeBSD login prompt, shown in [Figure 6-15](ch06.html#successful_junos_os_boot_messages_and_lo
    "Figure 6-15. Successful Junos OS boot messages and login").
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: Juniper Olive 的安装可能需要 15 分钟或更长时间，这取决于你的硬件，因为安装程序需要执行很多任务，例如重新分区你的 FreeBSD 硬盘并提取各种软件包。当一切完成后，系统应该会自动重启，加载
    Junos OS，并呈现一个看起来像是 FreeBSD 登录提示符的界面，见 [图 6-15](ch06.html#successful_junos_os_boot_messages_and_lo
    "图 6-15. 成功的 Junos OS 启动消息和登录")。
- en: '![Successful Junos OS boot messages and login](httpatomoreillycomsourcenostarchimages2208997.png.jpg)'
  id: totrans-177
  prefs: []
  type: TYPE_IMG
  zh: '![成功的 Junos OS 启动消息和登录](httpatomoreillycomsourcenostarchimages2208997.png.jpg)'
- en: Figure 6-15. Successful Junos OS boot messages and login
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: 图 6-15. 成功的 Junos OS 启动消息和登录
- en: This prompt is where you’ll log in to Junos OS. If you see the previous messages
    and the login prompt, then your Juniper router is ready to use.
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: 这个提示符是你登录 Junos OS 的地方。如果你看到之前的消息和登录提示符，那么你的 Juniper 路由器已准备好使用。
- en: Backing Up Juniper Olive
  id: totrans-180
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 备份 Juniper Olive
- en: After you create a working Olive, make a backup copy of the image for safekeeping.
    After all, who wants to go through all that work again? Not me!
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 在你创建了一个有效的 Olive 之后，为了安全起见，制作镜像的备份副本。毕竟，谁想再做一遍那些工作呢？我可不想！
- en: First, properly shut down Junos OS to prevent triggering a dirty filesystem.
    A dirty filesystem occurs when files have not been properly closed. This condition
    can cause file corruption and can even break the Junos operating system. If the
    filesystem is marked as dirty, a filesystem check is triggered the next time you
    start Junos OS, and it may take longer than usual to boot until the system is
    checked and marked clean again (meaning no errors were found, or all errors were
    fixed).
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，正确关闭 Junos OS，以防触发脏文件系统。脏文件系统是指文件未正确关闭时发生的情况。这种情况可能导致文件损坏，甚至可能损坏 Junos 操作系统。如果文件系统被标记为脏，下次启动
    Junos OS 时会触发文件系统检查，直到系统检查并重新标记为干净（意味着没有发现错误，或者所有错误已被修复）之前，启动过程可能比平时更长。
- en: 'To shut down Junos OS, log in as *root* (no password necessary) and enter the
    following commands:'
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 要关闭 Junos OS，作为 *root* 用户登录（无需密码），然后输入以下命令：
- en: '[PRE25]'
  id: totrans-184
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: 'It’s safe to quit QEMU after you see a message indicating that the operating
    system has halted, as shown here:'
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 在看到操作系统已停止的消息后，可以安全退出 QEMU，如下所示：
- en: '[PRE26]'
  id: totrans-186
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: 'To make a backup copy of your Juniper image, enter the following command from
    the directory where your image file is saved:'
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: 要备份你的 Juniper 镜像，请在保存镜像文件的目录中输入以下命令：
- en: '[PRE27]'
  id: totrans-188
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: 'Windows users can use this command instead:'
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: Windows 用户可以使用以下命令替代：
- en: '[PRE28]'
  id: totrans-190
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: Now that you have a Juniper router, you need to configure GNS3 so it can be
    used in your projects.
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 现在你已经拥有了 Juniper 路由器，你需要配置 GNS3 以便在项目中使用它。
- en: Configuring a Juniper Router in GNS3
  id: totrans-192
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 在 GNS3 中配置 Juniper 路由器
- en: To configure a Juniper router in GNS3, select **Edit** ▸ **Preferences** on
    Windows and Linux or **GNS3** ▸ **Preferences** on OS X. Double-click [*QEMU*](apd.html#gloss01_050)
    from the sidebar and select **QEMU VMs** to open the QEMU VMs preferences window,
    shown in [Figure 6-16](ch06.html#qemu_vms_preferences_window "Figure 6-16. QEMU
    VMs preferences window").
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: 要在 GNS3 中配置 Juniper 路由器，选择 **编辑** ▸ **偏好设置**（Windows 和 Linux）或 **GNS3** ▸ **偏好设置**（OS
    X）。从侧边栏双击 [*QEMU*](apd.html#gloss01_050)，并选择 **QEMU 虚拟机** 以打开 QEMU 虚拟机偏好设置窗口，如
    [图 6-16](ch06.html#qemu_vms_preferences_window "图 6-16. QEMU 虚拟机偏好设置窗口") 所示。
- en: '![QEMU VMs preferences window](httpatomoreillycomsourcenostarchimages2208999.png.jpg)'
  id: totrans-194
  prefs: []
  type: TYPE_IMG
  zh: '![QEMU 虚拟机偏好设置窗口](httpatomoreillycomsourcenostarchimages2208999.png.jpg)'
- en: Figure 6-16. QEMU VMs preferences window
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: 图 6-16. QEMU 虚拟机偏好设置窗口
- en: From here you can create, edit, and delete QEMU virtual machines, allowing you
    to bring your Juniper virtual machine into GNS3.
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里你可以创建、编辑和删除 QEMU 虚拟机，从而将你的 Juniper 虚拟机引入 GNS3。
- en: Adding the Juniper Virtual Machine to GNS3
  id: totrans-197
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 将 Juniper 虚拟机添加到 GNS3
- en: To add your Juniper virtual machine to GNS3, click **New** to start the New
    QEMU VM wizard. Enter a name for your virtual machine and leave Type set to **Default**.
    Click **Next** to set the QEMU binary and memory options, shown in [Figure 6-17](ch06.html#setting_qemu_binary_and_memory
    "Figure 6-17. Setting QEMU binary and memory").
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: 要将你的 Juniper 虚拟机添加到 GNS3 中，点击 **新建** 来启动新建 QEMU 虚拟机向导。为虚拟机输入一个名称，并保持类型设置为 **默认**。点击
    **下一步** 以设置 QEMU 二进制文件和内存选项，如 [图 6-17](ch06.html#setting_qemu_binary_and_memory
    "图 6-17. 设置 QEMU 二进制文件和内存") 所示。
- en: '![Setting QEMU binary and memory](httpatomoreillycomsourcenostarchimages2209001.png.jpg)'
  id: totrans-199
  prefs: []
  type: TYPE_IMG
  zh: '![设置 QEMU 二进制文件和内存](httpatomoreillycomsourcenostarchimages2209001.png.jpg)'
- en: Figure 6-17. Setting QEMU binary and memory
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: 图 6-17. 设置 QEMU 二进制文件和内存
- en: Select **qemu-system-i386** from the Qemu binary drop-down menu. You’re choosing
    this QEMU program because Juniper Olive runs on a 32-bit version of FreeBSD. Give
    your Olive 512MB of RAM and then click **Next**. Click **Browse** to locate and
    select the *juniper.img* file that you created previously, and then click **Finish**.
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: 从 QEMU 二进制文件下拉菜单中选择 **qemu-system-i386**。你之所以选择这个 QEMU 程序，是因为 Juniper Olive
    在 32 位版本的 FreeBSD 上运行。给你的 Olive 分配 512MB 的内存，然后点击 **下一步**。点击 **浏览** 定位并选择之前创建的
    *juniper.img* 文件，然后点击 **完成**。
- en: Note
  id: totrans-202
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: '*Two QEMU binary applications are often used in GNS3: `qemu-system-i386` and
    `qemu-system-x86_64`. The difference between them is that `qemu-system-i386` is
    designed to emulate 32-bit architecture, and `qemu-system-x86_64` is designed
    to emulate 64-bit architecture. The `qemu-system-x86_64` application is supposed
    to be 32-bit backward compatible, but it is not compatible with all 32-bit virtual
    machines (including IOS-XRv, for example).*'
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: '*在 GNS3 中常用的两个 QEMU 二进制应用程序是 `qemu-system-i386` 和 `qemu-system-x86_64`。它们的区别在于，`qemu-system-i386`
    是用于模拟 32 位架构的，而 `qemu-system-x86_64` 是用于模拟 64 位架构的。`qemu-system-x86_64` 应用程序理论上应支持
    32 位的向后兼容，但它并不与所有 32 位虚拟机兼容（例如 IOS-XRv）。*'
- en: Adding Ethernet Interfaces
  id: totrans-204
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 添加以太网接口
- en: After creating your virtual machine, go back and add more Ethernet interfaces.
    I recommend using six interfaces. Highlight your virtual machine and select **Edit**.
    Click the **Network** tab and change the number of interfaces to 6\. Now select
    the **Advanced settings** tab and enter the **-nographic** option under Additional
    settings, as shown in [Figure 6-18](ch06.html#qemu_advanced_options "Figure 6-18. QEMU
    advanced options").
  id: totrans-205
  prefs: []
  type: TYPE_NORMAL
  zh: 创建虚拟机后，返回并添加更多以太网接口。我推荐使用六个接口。高亮显示你的虚拟机并选择 **编辑**。点击 **网络** 标签页，将接口数量更改为 6。现在选择
    **高级设置** 标签页，并在附加设置中输入 **-nographic** 选项，如 [图 6-18](ch06.html#qemu_advanced_options
    "图 6-18. QEMU 高级选项") 所示。
- en: '![QEMU advanced options](httpatomoreillycomsourcenostarchimages2209003.png.jpg)'
  id: totrans-206
  prefs: []
  type: TYPE_IMG
  zh: '![QEMU 高级选项](httpatomoreillycomsourcenostarchimages2209003.png.jpg)'
- en: Figure 6-18. QEMU advanced options
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
  zh: 图 6-18. QEMU 高级选项
- en: The -nographic option prevents the QEMU GUI interface from displaying when you
    start your QEMU virtual machine. Although the GUI can be useful in troubleshooting
    a virtual machine, it’s more often a nuisance and should be disabled. This option
    can be used with any QEMU virtual machine, not only Juniper. When you’re done,
    click **OK** to close the window and then click **Apply** and **OK** to save all
    your changes.
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: -nographic 选项可防止在启动 QEMU 虚拟机时显示 QEMU 图形界面。尽管 GUI 在故障排除虚拟机时可能有用，但它更常见的是成为一种干扰，应该禁用。这个选项可以与任何
    QEMU 虚拟机一起使用，而不仅仅是 Juniper。完成后，点击 **确定** 关闭窗口，然后点击 **应用** 和 **确定** 以保存所有更改。
- en: Testing a Juniper Router
  id: totrans-209
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 测试 Juniper 路由器
- en: Before creating projects that include Juniper routers, it’s a good idea to test
    connectivity between a Cisco router and a Juniper router. If you’re unable to
    successfully ping between the devices, there might be a problem with your installation,
    and it’s better to find out early before you spend hours designing a project that
    doesn’t work.
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: 在创建包含Juniper路由器的项目之前，最好先测试Cisco路由器与Juniper路由器之间的连通性。如果你无法成功ping通设备之间的连接，可能是安装过程中出了问题，最好尽早发现，以免花费数小时设计一个无法工作的项目。
- en: Drag a Cisco router node and a Juniper router node to your workspace from the
    Devices toolbar, and create a link from the Cisco router to interface e0 of the
    Juniper router, as shown in [Figure 6-19](ch06.html#connecting_a_cisco_router_to_a_juniper_r
    "Figure 6-19. Connecting a Cisco router to a Juniper router").
  id: totrans-211
  prefs: []
  type: TYPE_NORMAL
  zh: 从设备工具栏拖动一个Cisco路由器节点和一个Juniper路由器节点到工作区，并创建从Cisco路由器到Juniper路由器的e0接口的连接，如[图6-19](ch06.html#connecting_a_cisco_router_to_a_juniper_r
    "图6-19. 将Cisco路由器连接到Juniper路由器")所示。
- en: Start the routers and open a console to the Cisco router. Assign an IP address
    to the interface that’s connected to your Juniper router (f0/0, in this example).
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: 启动路由器，并打开Cisco路由器的控制台。为与Juniper路由器相连的接口（在本例中是f0/0）分配一个IP地址。
- en: '![Connecting a Cisco router to a Juniper router](httpatomoreillycomsourcenostarchimages2209005.png.jpg)'
  id: totrans-213
  prefs: []
  type: TYPE_IMG
  zh: '![将Cisco路由器连接到Juniper路由器](httpatomoreillycomsourcenostarchimages2209005.png.jpg)'
- en: Figure 6-19. Connecting a Cisco router to a Juniper router
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: 图6-19. 将Cisco路由器连接到Juniper路由器
- en: '[PRE29]'
  id: totrans-215
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: Now open a console to your Juniper router, log on, and configure an IP address
    using the same subnet as your Cisco router.
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，打开Juniper路由器的控制台，登录并配置一个与Cisco路由器相同子网的IP地址。
- en: '[PRE30]'
  id: totrans-217
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: For security, Junos OS requires that you assign a root password ➊ before you
    can commit any other configuration changes to the router, so do that now. I set
    the password to *olive1*, but you can enter any password you want.
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: 出于安全考虑，Junos操作系统要求你在提交任何其他配置更改之前先设置一个root密码➊，因此现在就进行设置。我将密码设置为*olive1*，但你可以输入任何你想要的密码。
- en: Note
  id: totrans-219
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注释
- en: '*In this example, you can see that Juniper syntax is entirely different from
    Cisco syntax. If Juniper syntax is new to you, visit the Juniper website* ([http://www.juniper.net/](http://www.juniper.net/))
    *for detailed information about configuring Juniper routers.*'
  id: totrans-220
  prefs: []
  type: TYPE_NORMAL
  zh: '*在这个例子中，你可以看到Juniper的语法与Cisco的语法完全不同。如果Juniper语法对你来说是新鲜的，可以访问Juniper网站*（[http://www.juniper.net/](http://www.juniper.net/)）*，获取有关配置Juniper路由器的详细信息。*'
- en: After configuring both devices, ping your Cisco router to test connectivity.
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
  zh: 配置好两个设备后，ping一下你的Cisco路由器以测试连通性。
- en: '[PRE31]'
  id: totrans-222
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: If the ping test fails, there could be a problem with your IP addresses or QEMU
    installation. If you compiled QEMU from source code, verify that you installed
    a version known to work with Juniper Olive. If necessary, compile and reinstall
    QEMU again. If the problem persists, try installing or compiling another version
    of QEMU.
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
  zh: 如果ping测试失败，可能是你的IP地址或QEMU安装存在问题。如果你是从源代码编译QEMU，检查你是否安装了一个已知与Juniper Olive兼容的版本。如果需要，重新编译并安装QEMU。如果问题仍然存在，尝试安装或编译另一个版本的QEMU。
- en: You can also create an Olive using VirtualBox. The procedure is basically the
    same as QEMU, but you’ll use the VirtualBox GUI tools instead of the command line.
    When you create your VirtualBox virtual machine, set Type to BSD and set Version
    to FreeBSD (32-bit).
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: 你也可以使用VirtualBox创建一个Olive。过程基本与QEMU相同，但你将使用VirtualBox的GUI工具，而不是命令行。当你创建VirtualBox虚拟机时，设置类型为BSD，版本为FreeBSD（32位）。
- en: Running Juniper vSRX Firefly
  id: totrans-225
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 运行Juniper vSRX Firefly
- en: In addition to Junos OS, you can run a virtual version of Juniper’s SRX Firewall,
    called *vSRX Firefly*. If you register with Juniper, you can download an evaluation
    of Firefly from the website for free (*[http://www.juniper.net/](http://www.juniper.net/)*).
    You’ll want to download the Firefly VMware Appliance - FOR EVALUATION! package.
    As you can see from the name, it’s designed to run on VMware, but you can tweak
    it to run on VirtualBox or QEMU. I’m covering VirtualBox here, so make sure the
    VirtualBox program is installed on your system before you begin.
  id: totrans-226
  prefs: []
  type: TYPE_NORMAL
  zh: 除了Junos操作系统之外，你还可以运行Juniper的SRX防火墙虚拟版，名为*vSRX Firefly*。如果你在Juniper注册，你可以从网站上免费下载Firefly的评估版（*[http://www.juniper.net/](http://www.juniper.net/)*）。你需要下载Firefly
    VMware Appliance - FOR EVALUATION!包。如你所见，名字中提到它是为VMware设计的，但你可以调整它以在VirtualBox或QEMU上运行。我在这里讲解的是VirtualBox，所以在开始之前，请确保你的系统上已安装VirtualBox程序。
- en: 'After you’ve downloaded the Firefly software, notice that it’s an Open Virtual
    Appliance (OVA) file, named something like *junos-vsrx-ver.x-domestic.ova*. An
    OVA file is a special package file that can be unarchived using the `tar` command.
    To extract the contents from the file on Linux or OS X, use the following command:'
  id: totrans-227
  prefs: []
  type: TYPE_NORMAL
  zh: 下载Firefly软件后，注意它是一个Open Virtual Appliance（OVA）文件，文件名类似于*junos-vsrx-ver.x-domestic.ova*。OVA文件是一种特殊的包文件，可以使用`tar`命令解压缩。在Linux或OS
    X上提取文件内容，请使用以下命令：
- en: '[PRE32]'
  id: totrans-228
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: Note
  id: totrans-229
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: '*If you’re running Windows, you can use the 7-zip application* ([http://www.7-zip.org/](http://www.7-zip.org/))
    *to extract the files.*'
  id: totrans-230
  prefs: []
  type: TYPE_NORMAL
  zh: '*如果您正在使用Windows，您可以使用7-zip应用程序* ([http://www.7-zip.org/](http://www.7-zip.org/))
    *来提取文件。*'
- en: After all the files have been extracted, you need to convert the VMware virtual
    machine disk file (the file with extension *.vmdk*) to a virtual disk image (VDI)
    file that can be used by VirtualBox. To convert the file, use the `vboxmanage`
    utility that comes with VirtualBox.
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
  zh: 所有文件提取完成后，您需要将VMware虚拟机磁盘文件（扩展名为*.vmdk*的文件）转换为VirtualBox可以使用的虚拟磁盘镜像（VDI）文件。要转换文件，请使用VirtualBox附带的`vboxmanage`工具。
- en: '[PRE33]'
  id: totrans-232
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: After converting the disk image, you can delete all the Firefly files except
    the new VDI image file (*junos-vsrx-ver.x-domestic-disk1.vdi* in this example).
    This is the hard disk image file that you will import into VirtualBox.
  id: totrans-233
  prefs: []
  type: TYPE_NORMAL
  zh: 转换磁盘镜像后，您可以删除所有Firefly文件，除了新的VDI镜像文件（本示例中的*junos-vsrx-ver.x-domestic-disk1.vdi*）。这是您将导入到VirtualBox中的硬盘镜像文件。
- en: Creating a Firefly Virtual Machine with VirtualBox
  id: totrans-234
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用VirtualBox创建Firefly虚拟机
- en: You need to create a new virtual machine in VirtualBox and import the Firefly
    hard disk image file. Launch VirtualBox and click **New** to open the Create Virtual
    Machine dialog, shown in [Figure 6-20](ch06.html#create_virtual_machine_dialog
    "Figure 6-20. Create Virtual Machine dialog").
  id: totrans-235
  prefs: []
  type: TYPE_NORMAL
  zh: 您需要在VirtualBox中创建一个新的虚拟机，并导入Firefly硬盘镜像文件。启动VirtualBox并点击**新建**以打开创建虚拟机对话框，如[图6-20](ch06.html#create_virtual_machine_dialog
    "图6-20. 创建虚拟机对话框")所示。
- en: '![Create Virtual Machine dialog](httpatomoreillycomsourcenostarchimages2209007.png.jpg)'
  id: totrans-236
  prefs: []
  type: TYPE_IMG
  zh: '![创建虚拟机对话框](httpatomoreillycomsourcenostarchimages2209007.png.jpg)'
- en: Figure 6-20. Create Virtual Machine dialog
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
  zh: 图6-20. 创建虚拟机对话框
- en: Give the virtual machine a name (*Firefly* in this example), set Type to [*BSD*](apd.html#gloss01_009),
    and set Version to **FreeBSD (32-bit)**. When you’re done, click **Next** to assign
    the memory size, as shown in [Figure 6-21](ch06.html#adjust_the_memory_size "Figure 6-21. Adjust
    the memory size.").
  id: totrans-238
  prefs: []
  type: TYPE_NORMAL
  zh: 为虚拟机命名（本示例中为*Firefly*），将类型设置为[*BSD*](apd.html#gloss01_009)，并将版本设置为**FreeBSD（32位）**。完成后，点击**下一步**以分配内存大小，如[图6-21](ch06.html#adjust_the_memory_size
    "图6-21. 调整内存大小")所示。
- en: '![Adjust the memory size.](httpatomoreillycomsourcenostarchimages2209009.png.jpg)'
  id: totrans-239
  prefs: []
  type: TYPE_IMG
  zh: '![调整内存大小。](httpatomoreillycomsourcenostarchimages2209009.png.jpg)'
- en: Figure 6-21. Adjust the memory size.
  id: totrans-240
  prefs: []
  type: TYPE_NORMAL
  zh: 图6-21. 调整内存大小。
- en: Follow the instructions from Juniper to set the proper memory size. In this
    example, I’ve chosen 2048 MB, because that’s what Juniper recommends for my version
    of Firefly. When you’re done, click **Next**, and check **Use an existing virtual
    hard drive file**, as shown in [Figure 6-22](ch06.html#choose_the_junos_vsrx_firefly_vdi_hard_d
    "Figure 6-22. Choose the Junos vSRX Firefly VDI hard disk image file.").
  id: totrans-241
  prefs: []
  type: TYPE_NORMAL
  zh: 按照Juniper的说明设置合适的内存大小。在本示例中，我选择了2048 MB，因为这是Juniper为我的Firefly版本推荐的大小。完成后，点击**下一步**，并勾选**使用现有的虚拟硬盘文件**，如[图6-22](ch06.html#choose_the_junos_vsrx_firefly_vdi_hard_d
    "图6-22. 选择Junos vSRX Firefly VDI硬盘镜像文件")所示。
- en: Use the browse icon to locate and choose the VDI image file you created previously.
    When you’re finished, click the **Create** button to create the virtual machine.
  id: totrans-242
  prefs: []
  type: TYPE_NORMAL
  zh: 使用浏览图标定位并选择您之前创建的VDI镜像文件。完成后，点击**创建**按钮以创建虚拟机。
- en: '![Choose the Junos vSRX Firefly VDI hard disk image file.](httpatomoreillycomsourcenostarchimages2209011.png.jpg)'
  id: totrans-243
  prefs: []
  type: TYPE_IMG
  zh: '![选择Junos vSRX Firefly VDI硬盘镜像文件。](httpatomoreillycomsourcenostarchimages2209011.png.jpg)'
- en: Figure 6-22. Choose the Junos vSRX Firefly VDI hard disk image file.
  id: totrans-244
  prefs: []
  type: TYPE_NORMAL
  zh: 图6-22. 选择Junos vSRX Firefly VDI硬盘镜像文件。
- en: Giving Your Virtual Machine More Processors
  id: totrans-245
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 为虚拟机分配更多处理器
- en: After creating the virtual machine, you have to increase the number of processors
    to two because vSRX Firefly needs two processors to run properly. If your virtual
    machine is configured with only one processor, Firefly will boot and run, but
    you will not be able to see or configure any Ethernet interfaces.
  id: totrans-246
  prefs: []
  type: TYPE_NORMAL
  zh: 创建虚拟机后，您需要增加处理器数量至两个，因为vSRX Firefly需要两个处理器才能正常运行。如果您的虚拟机配置只有一个处理器，Firefly将能够启动并运行，但您将无法查看或配置任何以太网接口。
- en: Select your virtual machine name in VirtualBox, go to **Settings** ▸ **System**,
    and click the **Processor** tab, shown in [Figure 6-23](ch06.html#processor_tab_under_system
    "Figure 6-23. The Processor tab under System").
  id: totrans-247
  prefs: []
  type: TYPE_NORMAL
  zh: 在VirtualBox中选择你的虚拟机名称，进入**设置** ▸ **系统**，并点击**处理器**选项卡，如[图6-23](ch06.html#processor_tab_under_system
    "图6-23. 系统下的处理器选项卡")所示。
- en: '![The Processor tab under System](httpatomoreillycomsourcenostarchimages2209013.png.jpg)'
  id: totrans-248
  prefs: []
  type: TYPE_IMG
  zh: '![系统下的处理器选项卡](httpsatomoreillycomsourcenostarchimages2209013.png.jpg)'
- en: Figure 6-23. The Processor tab under System
  id: totrans-249
  prefs: []
  type: TYPE_NORMAL
  zh: 图6-23. 系统下的处理器选项卡
- en: Use the slider tool to select two processors, and click **OK**. After you’ve
    configured your Firefly virtual machine, right-click your virtual machine in VirtualBox
    and select **Clone** to create a copy of it to work with in GNS3\. The original
    virtual machine will remain unused, and you’ll always have a clean, unconfigured
    master of your virtual machine.
  id: totrans-250
  prefs: []
  type: TYPE_NORMAL
  zh: 使用滑块工具选择两个处理器，然后点击**确定**。配置好Firefly虚拟机后，右键单击虚拟机，在VirtualBox中选择**克隆**，以便创建一个副本，在GNS3中进行使用。原始虚拟机将保持未使用状态，你将始终拥有一个干净且未配置的虚拟机主机。
- en: Once you’re done creating the Firefly virtual machine, you’ll need to add it
    to GNS3 before you can use it in your projects.
  id: totrans-251
  prefs: []
  type: TYPE_NORMAL
  zh: 创建好Firefly虚拟机后，你需要将其添加到GNS3中，才能在项目中使用它。
- en: Adding vSRX Firefly to GNS3
  id: totrans-252
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 将vSRX Firefly添加到GNS3
- en: Launch GNS3 and select **Edit** ▸ **Preferences** on Windows and Linux or **GNS3**
    ▸ **Preferences** on OS X. Double-click **VirtualBox** in the pane on the left,
    and select **VirtualBox VMs** to open the VirtualBox VMs preferences window, shown
    in [Figure 6-24](ch06.html#virtualbox_vms_preferences_window "Figure 6-24. VirtualBox
    VMs preferences window").
  id: totrans-253
  prefs: []
  type: TYPE_NORMAL
  zh: 启动GNS3，在Windows和Linux上选择**编辑** ▸ **首选项**，在OS X上选择**GNS3** ▸ **首选项**。双击左侧窗格中的**VirtualBox**，然后选择**VirtualBox虚拟机**以打开VirtualBox虚拟机首选项窗口，如[图6-24](ch06.html#virtualbox_vms_preferences_window
    "图6-24. VirtualBox虚拟机首选项窗口")所示。
- en: To add your Firefly VirtualBox virtual machine to GNS3, click **New** to start
    the New Virtual VM wizard. Select your Firefly virtual machine from the drop-down
    menu and click **Finish**. Next, click **Edit**.
  id: totrans-254
  prefs: []
  type: TYPE_NORMAL
  zh: 要将Firefly VirtualBox虚拟机添加到GNS3，请点击**新建**，启动新虚拟机向导。从下拉菜单中选择你的Firefly虚拟机并点击**完成**。接着，点击**编辑**。
- en: '![VirtualBox VMs preferences window](httpatomoreillycomsourcenostarchimages2209015.png.jpg)'
  id: totrans-255
  prefs: []
  type: TYPE_IMG
  zh: '![VirtualBox虚拟机首选项窗口](httpsatomoreillycomsourcenostarchimages2209015.png.jpg)'
- en: Figure 6-24. VirtualBox VMs preferences window
  id: totrans-256
  prefs: []
  type: TYPE_NORMAL
  zh: 图6-24. VirtualBox虚拟机首选项窗口
- en: On the General settings tab, place a check next to **Enable remote console**
    and **Start VM in headless mode**. This will allow you to use the console to log
    on to Firefly. Finally, click the **Network** tab, change the number of interfaces
    to 6, and set the network type to **Paravirtualized Network (virtio net)**. You’re
    now ready to create a project using Firefly.
  id: totrans-257
  prefs: []
  type: TYPE_NORMAL
  zh: 在“常规设置”选项卡中，勾选**启用远程控制台**和**以无头模式启动虚拟机**。这将允许你使用控制台登录Firefly。最后，点击**网络**选项卡，将接口数量更改为6，并将网络类型设置为**Paravirtualized
    Network（virtio net）**。现在，你可以开始使用Firefly创建项目了。
- en: Creating a Project with a Zone-Based Firewall
  id: totrans-258
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 创建一个带有区域防火墙的项目
- en: In this section, you’ll create a simple project using vSRX Firefly as a network
    firewall. Firefly is similar in functionality to Cisco’s ASA firewall, but it’s
    different to configure. I won’t go into a lot of detail, but this project should
    get you started. If you want to learn more about Juniper SRX, you can find plenty
    of detailed documents at Juniper’s website (*[https://www.juniper.net/](https://www.juniper.net/)*).
  id: totrans-259
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，你将创建一个使用vSRX Firefly作为网络防火墙的简单项目。Firefly的功能类似于Cisco的ASA防火墙，但配置方式有所不同。我不会详细讨论，但这个项目应该能帮助你入门。如果你想了解更多关于Juniper
    SRX的内容，可以访问Juniper官网，那里有很多详细的文档（* [https://www.juniper.net/](https://www.juniper.net/)
    *）。
- en: Let’s start by creating the GNS3 project shown in [Figure 6-25](ch06.html#vsrx_firefly_project
    "Figure 6-25. vSRX Firefly project"). Drag a Firefly device from the End Devices
    toolbar to your workspace. Next, drag two Cisco routers to your workspace and
    link the devices together. Link R1’s interface f0/0 to interface e1 of vSRX Firefly.
    Link R2’s interface f0/0 to interface e0 of vSRX Firefly.
  id: totrans-260
  prefs: []
  type: TYPE_NORMAL
  zh: 我们从创建[GNS3项目](ch06.html#vsrx_firefly_project "图6-25. vSRX Firefly项目")开始。将Firefly设备从“终端设备”工具栏拖到工作区。接着，拖动两个Cisco路由器到工作区，并将设备连接在一起。将R1的接口f0/0连接到vSRX
    Firefly的e1接口，将R2的接口f0/0连接到vSRX Firefly的e0接口。
- en: '![vSRX Firefly project](httpatomoreillycomsourcenostarchimages2209017.png.jpg)'
  id: totrans-261
  prefs: []
  type: TYPE_IMG
  zh: '![vSRX Firefly项目](httpsatomoreillycomsourcenostarchimages2209017.png.jpg)'
- en: Figure 6-25. vSRX Firefly project
  id: totrans-262
  prefs: []
  type: TYPE_NORMAL
  zh: 图6-25. vSRX Firefly项目
- en: Router R1 will be configured to use a Firefly trust zone. R1 represents a trusted
    host on your LAN. Router R2 will be configured to use a Firefly untrust zone.
    The untrust zone represents an untrusted network, like the Internet. You’ll configure
    Firefly so that your trusted host (R1) can ping your untrusted host (R2) through
    the vSRX Firefly firewall using NAT.
  id: totrans-263
  prefs: []
  type: TYPE_NORMAL
  zh: 路由器R1将配置为使用Firefly信任区。R1代表您LAN中的受信主机。路由器R2将配置为使用Firefly的不受信任区。不受信任区代表一个不受信任的网络，如互联网。您将配置Firefly，以便受信主机（R1）可以通过vSRX
    Firefly防火墙使用NAT与不受信主机（R2）进行ping测试。
- en: Begin by configuring router R1 with an IP address and default gateway.
  id: totrans-264
  prefs: []
  type: TYPE_NORMAL
  zh: 首先为路由器R1配置IP地址和默认网关。
- en: '[PRE34]'
  id: totrans-265
  prefs: []
  type: TYPE_PRE
  zh: '[PRE34]'
- en: Next, configure an IP address on the untrusted router R2\. No gateway configuration
    is necessary here.
  id: totrans-266
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，配置不受信任路由器R2的IP地址。这里不需要配置网关。
- en: '[PRE35]'
  id: totrans-267
  prefs: []
  type: TYPE_PRE
  zh: '[PRE35]'
- en: 'With the router IP addresses configured, you can turn your attention to Firefly.
    Log on using the root account to configure the vSRX Firefly firewall. Because
    this is a new installation, you should not be asked for a password. After logging
    on, enter the following commands to create your firewall; you’ll start by creating
    a password and configuring the network settings:'
  id: totrans-268
  prefs: []
  type: TYPE_NORMAL
  zh: 配置好路由器IP地址后，您可以将注意力转向Firefly。使用root账户登录，以配置vSRX Firefly防火墙。由于这是新安装，系统应该不会要求您输入密码。登录后，输入以下命令以创建您的防火墙；首先创建密码并配置网络设置：
- en: '[PRE36]'
  id: totrans-269
  prefs: []
  type: TYPE_PRE
  zh: '[PRE36]'
- en: Like a Juniper router, you cannot save any configuration changes on an SRX device
    until you’ve assigned a password to the root account, so start by going to edit
    mode and creating a root password ➊. I’ve entered *firefly1*, but you can choose
    any password you’d like.
  id: totrans-270
  prefs: []
  type: TYPE_NORMAL
  zh: 就像在Juniper路由器上一样，您不能在SRX设备上保存任何配置更改，直到您为root账户分配了密码，因此首先进入编辑模式并创建root密码 ➊。我输入了*firefly1*，但您可以选择任何您喜欢的密码。
- en: Next, at ➋, you set the IP address on the WAN interface (ge-0/0/0.0), and at
    ➌, you set the LAN interface (ge-0/0/1.0). Finally, at ➍, set the default gateway
    address using the untrusted router’s IP address (100.1.1.1).
  id: totrans-271
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，在➋处，您需要在WAN接口（ge-0/0/0.0）上设置IP地址，在➌处，您需要设置LAN接口（ge-0/0/1.0）。最后，在➍处，使用不受信任路由器的IP地址（100.1.1.1）设置默认网关地址。
- en: Complete the configuration by defining your security zones and security trust
    policies.
  id: totrans-272
  prefs: []
  type: TYPE_NORMAL
  zh: 通过定义您的安全区域和安全信任策略来完成配置。
- en: '[PRE37]'
  id: totrans-273
  prefs: []
  type: TYPE_PRE
  zh: '[PRE37]'
- en: Assign your LAN interface to the `trust` zone ➊. Set the interface-nat source
    zone to `trust` ➋ and the interface-nat destination zone to `untrust` ➌, and create
    a rule that matches any source and destination IP addresses (0.0.0.0/0) ➍. In
    a production environment, you would tighten this up a bit, but for your practice
    GNS3 lab, it’s fine. Now configure NAT overloading on the WAN interface ➎.
  id: totrans-274
  prefs: []
  type: TYPE_NORMAL
  zh: 将您的LAN接口分配到`trust`区域 ➊。将接口-nat源区域设置为`trust` ➋，将接口-nat目标区域设置为`untrust` ➌，并创建一个匹配任何源和目标IP地址（0.0.0.0/0）的规则
    ➍。在生产环境中，您可能需要稍微收紧一些，但对于您的GNS3实验室来说，这样配置是可以的。现在，在WAN接口上配置NAT过载 ➎。
- en: Note
  id: totrans-275
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: '*vSRX Firefly’s `interface-nat` command is used to achieve the equivalent of
    Cisco NAT/PAT overloading.*'
  id: totrans-276
  prefs: []
  type: TYPE_NORMAL
  zh: '*vSRX Firefly的`interface-nat`命令用于实现类似于Cisco NAT/PAT过载的功能。*'
- en: To finish the configuration, define the type of traffic that’s allowed to go
    between the zones ➏. In this case, you’re allowing all protocols and applications
    from the `trust` zone to the `untrust` zone. Finally, create the security policy
    ➐ and commit your changes ➑, and you’re done!
  id: totrans-277
  prefs: []
  type: TYPE_NORMAL
  zh: 为完成配置，定义允许在不同区域之间传输的流量类型 ➏。在本例中，您允许所有协议和应用从`trust`区域流向`untrust`区域。最后，创建安全策略
    ➐ 并提交更改 ➑，这样就完成了！
- en: Verify your configuration by entering the `show security nat source summary`
    command.
  id: totrans-278
  prefs: []
  type: TYPE_NORMAL
  zh: 通过输入`show security nat source summary`命令来验证您的配置。
- en: '[PRE38]'
  id: totrans-279
  prefs: []
  type: TYPE_PRE
  zh: '[PRE38]'
- en: This information indicates that `rule1` ➊ allows packets via NAT ➋ from the
    `trust` zone ➌ to the `untrust` zone ➍, and IP data sourced from the `trust` zone
    will be overloaded onto the untrusted interface ➎. By default, that’s interface
    ge-0/0/0.0 (your WAN interface). If your summary matches the one in this book
    after entering the command, then you’re ready to test the connection. If your
    output looks different, then you’ve probably mistyped something, so you need to
    go back and check all your configuration settings.
  id: totrans-280
  prefs: []
  type: TYPE_NORMAL
  zh: 这些信息表明`rule1` ➊允许通过NAT ➋从`trust`区域 ➌到`untrust`区域 ➍的包，且来自`trust`区域的IP数据将被过载到不受信任的接口
    ➎。默认情况下，接口是ge-0/0/0.0（您的WAN接口）。如果在输入命令后，您的总结与本书中的相符，那么您可以开始测试连接。如果输出看起来不同，那么您可能输入错误，需要回去检查所有配置设置。
- en: Log on to router R1 and enter the `ping` command to test connectivity with router
    R2.
  id: totrans-281
  prefs: []
  type: TYPE_NORMAL
  zh: 登录到路由器R1并输入`ping`命令，以测试与路由器R2的连接。
- en: '[PRE39]'
  id: totrans-282
  prefs: []
  type: TYPE_PRE
  zh: '[PRE39]'
- en: If your ping is successful, as indicated by `!!!!!`, then you’ve done everything
    correctly. If it failed, then you may need to go back and check your configuration
    settings. You should also make sure your Cisco routers have the correct IP addresses
    and subnet masks and that the Ethernet interfaces are not shut down.
  id: totrans-283
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你的 ping 测试成功，显示为 `!!!!!`，那么你就已经完成了所有正确的操作。如果失败了，你可能需要回去检查你的配置设置。你还应该确保你的 Cisco
    路由器配置了正确的 IP 地址和子网掩码，并且以太网接口没有被关闭。
- en: Final Thoughts
  id: totrans-284
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 最后的思考
- en: In this chapter, you learned about Juniper and Juniper Olive, and I showed you
    how to create a Juniper Olive using QEMU and VirtualBox. I also introduced you
    to vSRX Firefly, and I provided some insight about how to configure a basic zone-based
    firewall using an SRX device.
  id: totrans-285
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，你了解了 Juniper 和 Juniper Olive，我向你展示了如何使用 QEMU 和 VirtualBox 创建 Juniper Olive。我还介绍了
    vSRX Firefly，并为你提供了如何使用 SRX 设备配置基础的基于区域的防火墙的一些见解。
- en: In most cases, Juniper runs a little slower using QEMU than using VirtualBox.
    However, QEMU allows you to add an unlimited number of Juniper routers to your
    projects without cloning, and GNS3 will store your Juniper configurations with
    your projects. As a rule, VirtualBox loads and runs devices faster than QEMU,
    but your configurations are saved with each virtual machine instance in VirtualBox,
    not in GNS3\. Because of this, you have to create a unique virtual machine instance
    of your devices using the VirtualBox clone feature. The cloned devices are then
    used in your GNS3 projects.
  id: totrans-286
  prefs: []
  type: TYPE_NORMAL
  zh: 在大多数情况下，使用 QEMU 运行 Juniper 会比使用 VirtualBox 稍慢。然而，QEMU 允许你在不进行克隆的情况下将无限数量的 Juniper
    路由器添加到你的项目中，而且 GNS3 会将你的 Juniper 配置与项目一起存储。通常来说，VirtualBox 加载和运行设备的速度要快于 QEMU，但你的配置会保存在
    VirtualBox 中每个虚拟机实例中，而不是 GNS3 中。因此，你必须使用 VirtualBox 的克隆功能来创建设备的唯一虚拟机实例。然后，克隆的设备会在你的
    GNS3 项目中使用。
- en: Juniper is less popular than Cisco in the corporate world, but it’s a big player
    in larger environments, like campus sites and the ISP routing and switching market.
    If you take your networking career into one of those realms, Juniper certification
    could set you apart from other applicants, and GNS3 is a great way to learn Juniper
    routers and SRX devices! You should start with JNCIA certification, which is the
    entry-level Juniper certification (Juniper’s equivalent to Cisco CCNA), and it’s
    a prerequisite for more advanced certifications. Juniper’s training website (*[http://www.juniper.net/us/en/training/](http://www.juniper.net/us/en/training/)*)
    provides all the information you need to get started.
  id: totrans-287
  prefs: []
  type: TYPE_NORMAL
  zh: Juniper 在企业界的受欢迎程度不及 Cisco，但在更大的环境中，比如校园站点和 ISP 路由交换市场，它依然是一个重要的参与者。如果你将自己的网络职业发展方向定位于这些领域，Juniper
    认证可能会让你在其他应聘者中脱颖而出，而 GNS3 是学习 Juniper 路由器和 SRX 设备的绝佳方式！你应该从 JNCIA 认证开始，它是入门级的
    Juniper 认证（相当于 Cisco 的 CCNA），并且是更高级别认证的前提条件。Juniper 的培训网站（*[http://www.juniper.net/us/en/training/](http://www.juniper.net/us/en/training/)*)
    提供了你所需的所有信息，帮助你开始学习。
