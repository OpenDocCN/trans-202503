- en: '6'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '6'
- en: Remote Hacking with Malware
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 远程黑客攻击与恶意软件
- en: '![](image_fi/book_art/chapterart.png)'
  id: totrans-2
  prefs: []
  type: TYPE_IMG
  zh: '![](image_fi/book_art/chapterart.png)'
- en: In this chapter, you’ll learn how attackers use malware over the internet to
    infect and control all kinds of computing devices from anywhere in the world.
    Short for *malicious software*, *malware* is any software designed to steal or
    damage data or to disrupt computer systems or users.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，你将学习攻击者如何利用互联网恶意软件感染并控制各种计算设备，从世界任何地方发起攻击。*恶意软件*（*malware*）是指任何旨在窃取或损坏数据、破坏计算机系统或用户的软件。
- en: If an attacker can trick you into opening a malicious attachment, video, or
    app, they can take control of your computer, smartphone, or other internet-connected
    device. To protect yourself, you need to understand how easy it is for a black
    hat hacker to create a virus and infect your computer. Once a device is infected,
    the attacker can often see *everything*—including your files, your keystrokes,
    your screen, and even what your webcam sees!
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 如果攻击者能诱使你打开一个恶意附件、视频或应用程序，他们就能控制你的计算机、智能手机或其他联网设备。为了保护自己，你需要了解黑帽黑客是如何轻松创建病毒并感染你的计算机的。一旦设备被感染，攻击者通常可以看到
    *一切*——包括你的文件、你的击键、你的屏幕，甚至是你摄像头看到的内容！
- en: In this chapter, you’ll safely create a virus on your Kali VM and infect your
    Windows VM across your virtual network. Then you’ll take control of the Windows
    VM from your Kali workstation and steal data, keystrokes, webcam video, and more—just
    like an attacker would. You’ll do this responsibly so the malware doesn’t escape
    your virtual environment. Along the way, you’ll learn to protect yourself from
    most malware on the internet.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，你将安全地在你的 Kali 虚拟机上创建一个病毒，并通过虚拟网络感染你的 Windows 虚拟机。然后，你将从 Kali 工作站控制 Windows
    虚拟机，窃取数据、击键、摄像头视频等——就像攻击者一样。你将负责任地进行操作，确保恶意软件不会逃脱你的虚拟环境。在这个过程中，你还将学习如何保护自己免受大多数互联网恶意软件的侵害。
- en: To perform our hack, we’ll use one of Kali’s most famous tools, Metasploit.
    The Metasploit Framework is an open source penetration-testing toolkit maintained
    by computer security company Rapid7\. It’s called a framework because it’s a complete
    software platform for developing, testing, and executing exploits. An *exploit*
    is an attack designed to take advantage of a vulnerability in a computer system.
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 为了执行我们的黑客攻击，我们将使用 Kali 最著名的工具之一——Metasploit。Metasploit 框架是一个开源渗透测试工具包，由计算机安全公司
    Rapid7 维护。之所以称其为框架，是因为它是一个完整的软件平台，用于开发、测试和执行漏洞利用工具。*漏洞利用*是指利用计算机系统中的漏洞进行攻击的行为。
- en: Metasploit has been called the hacker’s Swiss Army knife because it comes with
    so many useful tools built in. In fact, Metasploit contains a whopping 2,000 exploits
    and counting, including ones that target Windows, macOS, Linux, Microsoft Office,
    Adobe products, most browsers, iOS, Android, and more.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: Metasploit 被称为黑客的瑞士军刀，因为它内置了许多有用的工具。实际上，Metasploit 包含了多达 2,000 个漏洞利用工具，且数量仍在增加，包括针对
    Windows、macOS、Linux、Microsoft Office、Adobe 产品、大多数浏览器、iOS、Android 等平台的漏洞利用工具。
- en: Building Your Own Virus
  id: totrans-8
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 创建你自己的病毒
- en: We’ll start by building malware on your Kali VM to take over your Windows VM
    across the PublicNAT network we created in Chapter 3\. Specifically, we’ll create
    a *trojan*, a type of malware that looks harmless but can give an attacker control
    of your computer. Trojans are sometimes called *remote access trojans* *(RATs)*
    because they allow an attacker to control the target computer through the internet
    from anywhere in the world—no physical access needed.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将从在 Kali 虚拟机上构建恶意软件开始，通过我们在第 3 章中创建的 PublicNAT 网络来接管你的 Windows 虚拟机。具体来说，我们将创建一个
    *木马*，这是一种看似无害但能让攻击者控制计算机的恶意软件。木马有时被称为 *远程访问木马* (*RATs*)，因为它们允许攻击者通过互联网从世界任何地方控制目标计算机——无需物理访问。
- en: Trojans are typically disguised as files someone would be tempted to download
    and run, such as a pirated copy of the latest hit song or movie or a cheat for
    a popular video game. As an example, we’ll call our trojan *Fortnite_cheat_mode.exe*.
    Log in to your Kali VM and let’s create some malware! You might be surprised by
    how easy it is.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 木马通常伪装成诱使用户下载并运行的文件，比如最新热门歌曲或电影的盗版副本，或是某个流行视频游戏的作弊程序。例如，我们将把我们的木马命名为 *Fortnite_cheat_mode.exe*。登录到你的
    Kali 虚拟机，让我们开始创建恶意软件吧！你可能会惊讶于它是多么简单。
- en: In your Kali VM, click the Kali icon in the top left and go to **08 - Exploitation
    Tools**▶**Metasploit Framework**. If you’re asked for the sudo password, enter
    `kali`. The Metasploit Framework console (msfconsole) will start up, typically
    with a fun piece of ASCII text art at the top, like the one shown in [Figure 6-1](#figure6-1).
  id: totrans-11
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在你的Kali虚拟机中，点击左上角的Kali图标，然后进入**08 - Exploitation Tools**▶**Metasploit Framework**。如果系统提示输入sudo密码，请输入`kali`。Metasploit框架控制台（msfconsole）将启动，通常会在顶部显示一段有趣的ASCII艺术文本，如[图6-1](#figure6-1)所示。
- en: 'You should see a command prompt labeled `msf6 >`, short for “Metasploit Framework,
    version 6.” Enter `ip` `addr` to check your Kali VM’s IP address and make sure
    it’s connected to the PublicNAT network:'
  id: totrans-12
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你应该看到一个标有`msf6 >`的命令提示符，表示“Metasploit框架，版本6”。输入`ip` `addr`来检查Kali虚拟机的IP地址，并确保它已连接到PublicNAT网络：
- en: '[PRE0]'
  id: totrans-13
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE0]'
- en: '![f06001](image_fi/502000c06/f06001.png)'
  id: totrans-14
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![f06001](image_fi/502000c06/f06001.png)'
- en: 'Figure 6-1: Startup information for the Metasploit Framework console, with
    the Metasploit `msf``6` `>` command prompt at the bottom left'
  id: totrans-15
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图6-1：Metasploit框架控制台的启动信息，左下角是Metasploit `msf` `6` `>`命令提示符
- en: 'Look for a line under the section `eth0:` that begins with `inet` followed
    by an IP address:'
  id: totrans-16
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 查找`eth0:`部分下以`inet`开头的行，后面跟着一个IP地址：
- en: '[PRE1]'
  id: totrans-17
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE1]'
- en: As long as the address begins with `10.0.9` 1, you’re on the PublicNAT network
    you created in Chapter 3 and ready to go. Take note of the IP address; you’ll
    need to enter it as part of several commands. If you don’t see `10.0.9.``x` as
    your IP address, go back to Chapter 3, page 26, to create the PublicNAT network,
    or page 27 to connect your Kali VM to it correctly.
  id: totrans-18
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 只要地址以`10.0.9`开头，你就连接到了你在第3章中创建的PublicNAT网络，并且准备就绪。请注意IP地址；你将在多个命令中使用它。如果你没有看到`10.0.9.x`作为你的IP地址，请回到第3章第26页重新创建PublicNAT网络，或者第27页正确地将Kali虚拟机连接到该网络。
- en: 'Enter the following two lines, replacing the `x` in the IP address with the
    number you just looked up:'
  id: totrans-19
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入以下两行命令，将IP地址中的`x`替换为你刚刚查到的数字：
- en: '[PRE2]'
  id: totrans-20
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE2]'
- en: You should now see a file called *Fortnite_cheat_mode.exe* on your desktop,
    as shown in [Figure 6-2](#figure6-2). If you don’t see the file, open File Explorer
    and go to */home/kali/Desktop/* to find it.
  id: totrans-21
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在你应该在桌面上看到一个名为*Fortnite_cheat_mode.exe*的文件，如[图6-2](#figure6-2)所示。如果你没有看到这个文件，打开文件资源管理器，前往*/home/kali/Desktop/*来查找它。
- en: '![f06002](image_fi/502000c06/f06002.png)'
  id: totrans-22
  prefs: []
  type: TYPE_IMG
  zh: '![f06002](image_fi/502000c06/f06002.png)'
- en: 'Figure 6-2: The `msfvenom` tool creates a trojan named *Fortnite_cheat_mode.exe*
    and places it on the desktop (lower-left).'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 图6-2：`msfvenom`工具创建了一个名为*Fortnite_cheat_mode.exe*的木马并将其放在桌面上（左下角）。
- en: You’ve now created your first trojan—nicely done! All it took was the two lines
    we entered at the `msf6 >` command prompt in step 4\. Actually, it was just one
    long command, but the backslash (`\`) at the end of the first line let us continue
    the command onto the second line.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 你现在已经创建了第一个木马——做得不错！这只用了我们在第4步的`msf6 >`命令提示符下输入的两行命令。实际上，这只是一个长命令，但第一行末尾的反斜杠（`\`）允许我们将命令延续到第二行。
- en: 'So what did the command actually do? It told Metasploit’s `msfvenom` tool to
    create a piece of malware containing the Meterpreter shell, an interface that
    will give us command line (shell) control over the Windows VM from Kali. We told
    the Meterpreter shell where to receive commands from by typing `LHOST=` followed
    by the Kali VM’s IP address. The `-f` `exe` option told `msfvenom` that the format
    (`-f`) of the output should be a Windows executable (`exe`) program file. The
    `-o` option told `msfvenom` the name and location of the file to output: a file
    called *Fortnite_cheat_mode.exe* saved to the desktop (`~/Desktop/`).'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 那么这个命令到底做了什么呢？它告诉Metasploit的`msfvenom`工具创建一个包含Meterpreter shell的恶意软件，这是一个接口，可以让我们从Kali中通过命令行（shell）控制Windows虚拟机。我们通过输入`LHOST=`后跟Kali虚拟机的IP地址，告诉Meterpreter
    shell从哪里接收命令。`-f` `exe`选项告诉`msfvenom`输出的格式（`-f`）应该是Windows可执行程序（`exe`）文件。`-o`选项告诉`msfvenom`输出文件的名称和位置：一个名为*Fortnite_cheat_mode.exe*的文件，将保存在桌面（`~/Desktop/`）上。
- en: Sharing the Malware
  id: totrans-26
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 共享恶意软件
- en: Now that we have a trojan Windows executable file, we need to get it onto your
    Windows VM. Often an attacker would try sending the trojan by email, but a lot
    of email programs scan attachments for malware, plus you wouldn’t want to send
    a trojan through your personal email account anyway. Instead, we’ll create a shared
    folder that the Windows user can surf to through their web browser.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经有了一个木马Windows可执行文件，我们需要将它传输到你的Windows虚拟机上。通常攻击者会尝试通过电子邮件发送木马，但许多电子邮件程序会扫描附件中的恶意软件，而且你也不希望通过个人电子邮件账户发送木马。相反，我们将创建一个共享文件夹，Windows用户可以通过其网页浏览器访问。
- en: 'Enter this command into the msfconsole window to create a folder called *share*
    at the default location for a shared web folder on most Linux computers:'
  id: totrans-28
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 msfconsole 窗口中输入此命令，在大多数 Linux 计算机上创建一个名为 *share* 的文件夹，作为共享网页文件夹的默认位置：
- en: '[PRE3]'
  id: totrans-29
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'Copy the trojan into the new folder:'
  id: totrans-30
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将木马复制到新文件夹中：
- en: '[PRE4]'
  id: totrans-31
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'Start the Apache web server application so the folder will be accessible through
    the web:'
  id: totrans-32
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启动 Apache 网络服务器应用程序，这样文件夹就能通过网络访问：
- en: '[PRE5]'
  id: totrans-33
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE5]'
- en: To confirm that the trojan is now available for download, open the web browser
    in your Kali VM and go to *http://<10.0.9.x>/share*, replacing *<10.0.9.x>* with
    your Kali VM’s IP address. You’ll see a web page like the one shown in [Figure
    6-3](#figure6-3).
  id: totrans-34
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为了确认木马现在可以下载，请在你的 Kali 虚拟机中打开浏览器，访问 *http://<10.0.9.x>/share*，将 *<10.0.9.x>*
    替换为你的 Kali 虚拟机的 IP 地址。你将看到类似于 [图 6-3](#figure6-3) 所示的网页。
- en: '![f06003](image_fi/502000c06/f06003.png)'
  id: totrans-35
  prefs: []
  type: TYPE_IMG
  zh: '![f06003](image_fi/502000c06/f06003.png)'
- en: 'Figure 6-3: Thanks to Kali’s Apache web server, our trojan malware is now available
    on the (virtual) web!'
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 图 6-3：感谢 Kali 的 Apache 网络服务器，我们的木马恶意软件现在可以通过（虚拟）网络访问！
- en: Listening for the Trojan to Phone Home
  id: totrans-37
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 监听木马回家的连接
- en: We now need to prepare Metasploit to receive incoming connections from infected
    Windows machines (we sometimes call this *phoning home*). An incoming connection
    will let us send malicious commands to control a machine remotely. Typically,
    an attacker would send a virus email attachment to thousands of potential victims,
    waiting to see which ones open the attachment and get infected. In our case, we’ll
    infect only the one Windows VM. However, by following these steps, we could receive
    connections for controlling several infected computers at once just as easily.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们需要准备 Metasploit，以便接收来自感染的 Windows 机器的传入连接（我们有时称之为*回家*）。一个传入连接将让我们发送恶意命令来远程控制一台机器。通常，攻击者会向成千上万的潜在受害者发送病毒邮件附件，等待看看哪些人打开附件并感染。在我们的案例中，我们只感染一个
    Windows 虚拟机。然而，按照这些步骤，我们也能轻松地接收多个感染计算机的连接来控制它们。
- en: 'Enter this command at the `msf6` `>` prompt to tell Metasploit to handle, or
    accept, multiple incoming connections from infected computers:'
  id: totrans-39
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 `msf6` `>` 提示符下输入此命令，告诉 Metasploit 处理或接受来自感染计算机的多个传入连接：
- en: '[PRE6]'
  id: totrans-40
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE6]'
- en: The msfconsole prompt will change to let us know the *multi/handler* exploit
    is active.
  id: totrans-41
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: msfconsole 提示符将发生变化，以告诉我们 *multi/handler* 漏洞利用已经激活。
- en: 'Now tell Metasploit that the Trojan’s *payload*—that is, the malicious program
    we’re delivering—is a Meterpreter shell:'
  id: totrans-42
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在告诉 Metasploit 木马的*有效载荷*——也就是我们传送的恶意程序——是一个 Meterpreter shell：
- en: '[PRE7]'
  id: totrans-43
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE7]'
- en: The msfconsole will respond with `PAYLOAD` `=>` `windows/meterpreter/reverse_tcp`
    to let us know the Meterpreter payload has been selected.
  id: totrans-44
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: msfconsole 会响应 `PAYLOAD` `=>` `windows/meterpreter/reverse_tcp`，表示我们已选择 Meterpreter
    有效载荷。
- en: 'Enter your Kali VM’s IP address to indicate the local host where connections
    will be coming in (remember to fill in the last number):'
  id: totrans-45
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入你的 Kali 虚拟机的 IP 地址，以指示连接将要到达的本地主机（记得填写最后一个数字）：
- en: '[PRE8]'
  id: totrans-46
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE8]'
- en: Metasploit will respond with `LHOST =>` `10.0.9.x` to indicate that the local
    host option is set correctly.
  id: totrans-47
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: Metasploit 会响应 `LHOST =>` `10.0.9.x`，表示本地主机选项已正确设置。
- en: 'Finally, the moment we’ve been waiting for: launch the exploit!'
  id: totrans-48
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后，等了这么久的时刻终于到了：启动漏洞利用！
- en: '[PRE9]'
  id: totrans-49
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE9]'
- en: The `-j` option tells Metasploit to run the handler in the background so you
    can use the msfconsole while you wait for infected machines to connect to your
    Kali VM. Metasploit will confirm that the exploit is running in the background,
    ready to accept incoming connections on `10.0.9.``x``:4444`, or port 4444 on your
    Kali VM.
  id: totrans-50
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '`-j` 选项告诉 Metasploit 将处理程序放到后台运行，这样你就可以在等待感染的机器连接到 Kali 虚拟机时继续使用 msfconsole。Metasploit
    会确认漏洞利用在后台运行，准备接受来自 `10.0.9.x:4444` 或你 Kali 虚拟机的端口 4444 上的传入连接。'
- en: Infecting Your Windows VM
  id: totrans-51
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 感染你的 Windows 虚拟机
- en: Our trojan is primed and ready to go. Now it’s time to infect your Windows VM.
    First, we’ll disable a couple of Windows security features that would normally
    make it harder for users to do something stupid like download and open a questionable
    file from the internet. Then, with those safeguards turned off, that something
    stupid is exactly what we’ll do.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 我们的木马已经准备就绪，接下来是时候感染你的 Windows 虚拟机了。首先，我们将禁用几个 Windows 安全功能，这些功能通常会让用户难以做出像下载并打开互联网上可疑文件这样愚蠢的行为。然后，关闭这些安全功能后，我们就正是要做这些愚蠢的事情。
- en: Remember, your Windows VM was created for you to practice hacking safely. If
    you mess it up, such as by infecting it with a trojan, you can simply delete the
    Windows VM and create a new one. With that in mind, start your Windows 10 VM in
    VirtualBox, entering the username `IEUser` and password `Passw0rd!` if prompted,
    and let’s get going.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 记住，你的 Windows 虚拟机是为了让你安全地练习黑客技能而创建的。如果你搞砸了，比如感染了木马，你可以简单地删除 Windows 虚拟机并创建一个新的。考虑到这一点，启动你的
    Windows 10 虚拟机，在提示时输入用户名 `IEUser` 和密码 `Passw0rd!`，然后开始吧。
- en: Enter `cmd` in the Windows/Cortana search bar to find the command prompt. Right-click
    it and select **Run as administrator**. In the pop-up window asking if you want
    to allow this app to make changes to your device, click **Yes**.
  id: totrans-54
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 Windows/Cortana 搜索栏中输入 `cmd` 查找命令提示符。右键点击并选择 **以管理员身份运行**。在弹出的窗口中询问你是否允许该应用程序对设备进行更改时，点击
    **是**。
- en: 'In the Administrator: Command Prompt window that appears, enter this command
    to turn off your Windows VM’s firewall:'
  id: totrans-55
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在出现的“管理员：命令提示符”窗口中，输入此命令来关闭 Windows 虚拟机的防火墙：
- en: '[PRE10]'
  id: totrans-56
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE10]'
- en: Normally, a *firewall* would block unwanted or malicious traffic from outside
    computers, and it can keep your computer from making suspicious connections to
    malicious servers. After running this command, you might see the pop-up message
    “Turn on Windows Firewall.” Windows is warning you that it’s dangerous to leave
    your firewall turned off—and it is!—but that’s what we want for this first remote
    hack.
  id: totrans-57
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 通常，*防火墙* 会阻止外部计算机的恶意或不必要流量，并且它可以防止你的计算机与恶意服务器建立可疑连接。执行此命令后，你可能会看到弹出的消息“打开 Windows
    防火墙。” Windows 正在警告你关闭防火墙是危险的——确实如此！——但这正是我们第一次远程攻击所需要的。
- en: Next, we’ll turn off Windows Defender, another safety tool. Enter `virus` in
    the search bar and open the **Virus & threat protection** settings.
  id: totrans-58
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，我们将关闭 Windows Defender，这是另一种安全工具。在搜索栏中输入 `virus`，然后打开 **病毒与威胁防护** 设置。
- en: Click **Manage settings** and slide the toggle buttons for Real-time protection
    and Cloud-delivered protection to **Off**. Windows will ask again if you want
    to allow this app to make changes to your device. Click **Yes**. Your Windows
    10 VM is now as vulnerable as one-fourth of all PCs on the planet.
  id: totrans-59
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击 **管理设置**，将实时保护和云端防护的切换按钮滑到 **关闭**。Windows 会再次询问你是否允许此应用程序对设备进行更改。点击 **是**。你的
    Windows 10 虚拟机现在和地球上四分之一的计算机一样脆弱。
- en: Open the Edge web browser and go to *http://<10.0.9.x>/share/*.
  id: totrans-60
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开 Edge 浏览器，访问 *http://<10.0.9.x>/share/*。
- en: Click your trojan and choose **Save** to download the file to your Windows VM’s
    *Downloads* folder.
  id: totrans-61
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击你的木马并选择**保存**，将文件下载到你的 Windows 虚拟机的 *下载* 文件夹中。
- en: 'The moment of truth: open the Windows VM’s *Downloads* folder and double-click
    the trojan executable file to run it.'
  id: totrans-62
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 关键时刻：打开 Windows 虚拟机的 *下载* 文件夹，双击木马可执行文件运行它。
- en: 'It turns out that Windows 10 PCs have one more layer of virus protection to
    prevent boneheaded mistakes like the one we just made: Windows Defender SmartScreen
    will pop up a warning that it “prevented an unrecognized app from starting,” as
    shown in [Figure 6-4](#figure6-4). Click **More info** and then **Run anyway**.'
  id: totrans-63
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 事实证明，Windows 10 计算机有一层额外的病毒保护，以防止像我们刚刚犯的愚蠢错误：Windows Defender SmartScreen 会弹出警告，显示“已阻止一个无法识别的应用程序启动”，如[图
    6-4](#figure6-4)所示。点击 **更多信息** 然后选择 **继续运行**。
- en: 'You’ve now taken control of your first computer! You won’t see anything happen
    on the Windows VM, but if you switch back to the Kali VM, you should see something
    like the following in msfconsole:'
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 你现在已经控制了你的第一台计算机！你不会在 Windows 虚拟机上看到任何变化，但如果你切换回 Kali 虚拟机，应该会在 msfconsole 中看到类似以下内容：
- en: '[PRE11]'
  id: totrans-65
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'The infected Windows VM called back to Kali and established a connection (also
    called a *session*). Congratulations: the Windows VM is now awaiting your commands!'
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 被感染的 Windows 虚拟机已回拨到 Kali 并建立了连接（也叫做 *会话*）。恭喜你：Windows 虚拟机现在正在等待你的命令！
- en: '![f06004a](image_fi/502000c06/f06004a.png)'
  id: totrans-67
  prefs: []
  type: TYPE_IMG
  zh: '![f06004a](image_fi/502000c06/f06004a.png)'
- en: 'Figure 6-4: Windows Defender SmartScreen tries to protect your Windows VM one
    last time.'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 图 6-4：Windows Defender SmartScreen 尝试最后一次保护你的 Windows 虚拟机。
- en: Controlling Your Windows VM with Meterpreter
  id: totrans-69
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用 Meterpreter 控制你的 Windows 虚拟机
- en: 'Now that we’ve established a connection between your Kali and Windows VMs,
    we’re ready to start manipulating the Windows machine from Metasploit. To begin,
    enter `sessions` in the Metasploit terminal window to see the list of active Metasploit
    connections:'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们已经在 Kali 和 Windows 虚拟机之间建立了连接，准备开始从 Metasploit 操控 Windows 机器。首先，在 Metasploit
    终端窗口中输入 `sessions` 查看活动的 Metasploit 连接列表：
- en: '[PRE12]'
  id: totrans-71
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: As you can see, we’re connected to an infected Windows 10 machine named MSEdgeWin10
    under a username *IEUser*—that’s your Windows 10 VM! Our session has an ID number
    of 1\. If you ran the trojan on other machines as well, you’d see multiple sessions
    listed, each with its own ID number. Similarly, if you have to reestablish the
    connection with the Windows VM, it’ll be listed with a different ID number, such
    as 2.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 如你所见，我们连接到一台名为MSEdgeWin10的受感染Windows 10计算机，用户名为*IEUser*——这就是你的Windows 10虚拟机！我们的会话ID号是1。如果你在其他计算机上也运行了木马，你会看到多个会话列出，每个都有自己的ID号。同样，如果你需要重新建立与Windows虚拟机的连接，它将以不同的ID号列出，例如2。
- en: 'Enter `sessions -i` `1` to start interacting with the Windows VM:'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 输入`sessions -i` `1`来开始与Windows虚拟机交互：
- en: '[PRE13]'
  id: totrans-74
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'The command prompt changes to `meterpreter` `>` to indicate that we’re interacting
    with the Meterpreter shell on the remote Windows VM. Let’s try a few commands.
    Enter `sysinfo` to view some information about the computer, such as its operating
    system (OS), the system language, and more:'
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 命令提示符变为`meterpreter` `>`，表明我们正在与远程Windows虚拟机上的Meterpreter shell交互。让我们试几个命令。输入`sysinfo`来查看计算机的一些信息，比如操作系统（OS）、系统语言等：
- en: '[PRE14]'
  id: totrans-76
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'Now let’s try another command, `pwd`, short for *print working directory*,
    to see where the Meterpreter shell is running from:'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，让我们尝试另一个命令，`pwd`，是*print working directory*的缩写，用来查看Meterpreter shell运行的路径：
- en: '[PRE15]'
  id: totrans-78
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: This tells us that the Meterpreter shell is running from the Windows VM’s *Downloads*
    directory—where our trojan is located.
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 这告诉我们Meterpreter shell是从Windows虚拟机的*Downloads*目录运行的——我们木马所在的位置。
- en: Enter `help` to list some of the most common commands you can run on your Windows
    VM remotely from the Meterpreter shell. There are commands to run programs, terminate
    running processes, shut down or reboot the remote computer, clear event logs (to
    cover your tracks while hacking), capture keystrokes, take screenshots, and spy
    on the remote user’s desktop or webcam, just to name a few. In total, there are
    over 100 commands an attacker could use to take almost complete control of a computer.
    A partial listing of these commands is shown in [Figure 6-5](#figure6-5).
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 输入`help`以列出你可以从Meterpreter shell远程运行的一些最常见的命令。这里有用于运行程序、终止正在运行的进程、关闭或重启远程计算机、清除事件日志（在黑客攻击时掩盖踪迹）、捕捉按键、截屏、监视远程用户的桌面或摄像头等命令，仅举几例。总共有100多条命令，攻击者可以利用这些命令几乎完全控制一台计算机。部分命令列表请参见[图6-5](#figure6-5)。
- en: To find out how serious the threat really is, let’s see how easily an attacker
    could hack our files, keyboard, webcam, and more through an infected file. Not
    every command we’ll use will work every time you try it; you may have to make
    multiple attempts. However, exploring the damage these commands can do should
    motivate you *never* to install software from a random web page or email attachment.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 为了了解威胁的严重性，让我们看看攻击者如何通过受感染的文件轻松地黑掉我们的文件、键盘、摄像头等。并非每个命令在每次尝试时都能成功；你可能需要多次尝试。然而，探索这些命令可能造成的破坏应该会促使你*永远*不要从随机网页或电子邮件附件安装软件。
- en: '![f06005a](image_fi/502000c06/f06005a.png)'
  id: totrans-82
  prefs: []
  type: TYPE_IMG
  zh: '![f06005a](image_fi/502000c06/f06005a.png)'
- en: 'Figure 6-5: A selection of frighteningly cool Meterpreter commands we can use
    to control the infected Windows VM'
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 图6-5：我们可以用来控制受感染的Windows虚拟机的一些令人惊叹的Meterpreter命令
- en: Viewing and Uploading Files
  id: totrans-84
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 查看和上传文件
- en: We’ll start our exploitation of the Windows VM by browsing the computer’s files
    and uploading a backup copy of our trojan to the Windows VM.
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将通过浏览计算机文件并上传我们的木马备份文件来开始对Windows虚拟机的利用。
- en: 'At the `meterpreter >` command prompt, enter these commands to change the directory
    to the infected VM’s *Documents* folder and list the folder’s contents:'
  id: totrans-86
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在`meterpreter >`命令提示符下，输入以下命令将目录更改为受感染的虚拟机的*Documents*文件夹，并列出该文件夹的内容：
- en: '[PRE16]'
  id: totrans-87
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE16]'
- en: You’ll see folders for music, pictures, videos, and more, just like on any other
    Windows computer. Attackers can use these commands to browse the target computer
    and look for interesting files to steal.
  id: totrans-88
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 你将看到音乐、图片、视频等文件夹，和任何其他Windows计算机一样。攻击者可以使用这些命令浏览目标计算机，寻找感兴趣的文件进行窃取。
- en: 'Upload a copy of the *Fortnite_cheat_mode.exe* malware file from your Kali
    VM into the *Documents* folder:'
  id: totrans-89
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将*Fortnite_cheat_mode.exe*恶意文件从你的Kali虚拟机上传到*Documents*文件夹：
- en: '[PRE17]'
  id: totrans-90
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE17]'
- en: Switch back to your Windows 10 VM and open your *Documents* folder. You should
    see the newly uploaded trojan file, as shown in [Figure 6-6](#figure6-6).
  id: totrans-91
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 切换回你的Windows 10虚拟机并打开*Documents*文件夹。你应该能看到新上传的木马文件，如[图6-6](#figure6-6)所示。
- en: '![f06006](image_fi/502000c06/f06006.png)'
  id: totrans-92
  prefs: []
  type: TYPE_IMG
  zh: '![f06006](image_fi/502000c06/f06006.png)'
- en: 'Figure 6-6: We can upload files to the infected Windows 10 VM from Kali.'
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 图 6-6：我们可以从 Kali 向感染的 Windows 10 虚拟机上传文件。
- en: Now that you have a backup of the trojan on the Windows VM, you can always copy
    and paste it from *Documents* into *Downloads* if Windows Defender ever starts
    back up and deletes the trojan in the *Downloads* folder. Once someone opens a
    single infected file over the web or through email, an attacker will often upload
    multiple viruses in different locations on a computer to ensure that they can
    maintain control of the target machine.
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 现在你已经在 Windows 虚拟机上备份了特洛伊木马，你可以随时将其从*Documents*文件夹复制并粘贴到*Downloads*文件夹中，防止 Windows
    Defender 重启后删除*Downloads*文件夹中的特洛伊木马。一旦某人通过网络或电子邮件打开一个被感染的文件，攻击者通常会在计算机的不同位置上传多个病毒，以确保他们能够持续控制目标机器。
- en: Downloading Files from the Victim Computer
  id: totrans-95
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 从受害者计算机下载文件
- en: The `download` command in Meterpreter allows you to download a file from the
    victim computer. To try it out, we’ll create a sample text file on the Windows
    VM and then steal it.
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: Meterpreter 中的 `download` 命令允许你从受害者计算机下载文件。为了尝试，我们将在 Windows 虚拟机上创建一个示例文本文件，然后偷取它。
- en: Enter this command at the `meterpreter >` prompt to take remote control of the
    victim computer’s Windows command line terminal, or *shell*.
  id: totrans-97
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 `meterpreter >` 提示符下输入此命令，以远程控制受害者计算机的 Windows 命令行终端，或*shell*。
- en: '[PRE18]'
  id: totrans-98
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE18]'
- en: Now create a file named *hacked.txt* that contains the text “You’ve been hacked!”
  id: totrans-99
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在创建一个名为*hacked.txt*的文件，内容为“你已经被黑客攻击！”
- en: '[PRE19]'
  id: totrans-100
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE19]'
- en: Check the *Documents* folder on the Windows VM. You should see the *hacked.txt*
    file that we just created remotely from Kali.
  id: totrans-101
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 检查 Windows 虚拟机上的*Documents*文件夹。你应该能看到我们刚刚从 Kali 远程创建的*hacked.txt*文件。
- en: 'Back in Kali, exit the Windows shell and return to Meterpreter:'
  id: totrans-102
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 回到 Kali，退出 Windows shell，返回到 Meterpreter：
- en: '[PRE20]'
  id: totrans-103
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'Now download the file from Windows onto your Kali VM:'
  id: totrans-104
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在将文件从 Windows 下载到你的 Kali 虚拟机上：
- en: '[PRE21]'
  id: totrans-105
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE21]'
- en: Finally, use the following command to view the file’s contents, our “You’ve
    been hacked!” message.
  id: totrans-106
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后，使用以下命令查看文件内容，即我们的“你已经被黑客攻击！”消息。
- en: '[PRE22]'
  id: totrans-107
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE22]'
- en: 'We have successfully downloaded a file from the victim’s computer! In this
    case, it was a file that we created (remotely) from our attacking VM, but a real
    attacker could download much more important information. Any files the Windows
    user has access to become downloadable by the attacker when the Windows user runs
    the Meterpreter trojan: customer lists, family photos, budget spreadsheets, tax
    forms, bank statements, employee data, medical records, valuable intellectual
    property, or sensitive files of *any* kind can be stolen with just a few keystrokes.'
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 我们已经成功从受害者的计算机上下载了一个文件！在这个例子中，是我们在攻击虚拟机上（远程）创建的文件，但真正的攻击者可能会下载更重要的信息。任何 Windows
    用户有权限访问的文件都可以被攻击者下载，当 Windows 用户运行 Meterpreter 木马时：客户名单、家庭照片、预算表格、税务表单、银行对账单、员工数据、病历记录、宝贵的知识产权或任何*敏感*文件，都可以在几次按键之间被窃取。
- en: Viewing the Victim Computer’s Screen
  id: totrans-109
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 查看受害者计算机的屏幕
- en: 'Trojans like the Meterpreter shell are often called *backdoors* because they
    give the attacker access to your computer in a way that bypasses all your other
    security measures (including logging in). It’s like sneaking in through the back
    door of a movie theater. When you clicked the Meterpreter trojan file on your
    Windows VM, you opened a secret door into your computer that allowed us to upload
    and download files. But it gets worse: you’ve given our attacking VM a backdoor
    to view your computer screen, record your keystrokes, and even turn on your webcam!
    To prove it, we’ll try viewing the Windows VM’s screen from within Kali.'
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 像 Meterpreter shell 这样的特洛伊木马通常被称为*后门*，因为它们使攻击者能够绕过所有其他安全措施（包括登录）以访问你的计算机。这就像是通过电影院的后门偷偷溜进去。当你在
    Windows 虚拟机上点击 Meterpreter 木马文件时，你就打开了一个秘密门，使我们能够上传和下载文件。但事情变得更糟：你为我们的攻击虚拟机提供了一个后门，使我们能够查看你的计算机屏幕、记录你的按键，甚至开启你的摄像头！为了证明这一点，我们将尝试从
    Kali 中查看 Windows 虚拟机的屏幕。
- en: Enter `screenshot -v true` into the Meterpreter shell. With this command, an
    attacker can find out what the user of the victim machine is seeing.
  id: totrans-111
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 Meterpreter shell 中输入 `screenshot -v true` 命令。使用此命令，攻击者可以发现受害者计算机用户看到的内容。
- en: '[PRE23]'
  id: totrans-112
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE23]'
- en: A window should pop up showing a screenshot from the Windows VM, as shown in
    [Figure 6-7](#figure6-7).![f06007](image_fi/502000c06/f06007.png)
  id: totrans-113
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 应该会弹出一个窗口，显示来自 Windows 虚拟机的截图，如[图 6-7](#figure6-7)所示。![f06007](image_fi/502000c06/f06007.png)
- en: 'Figure 6-7: Capturing a screenshot from the Windows VM'
  id: totrans-114
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 6-7：从 Windows 虚拟机捕获屏幕截图
- en: 'You might even be able to take it one step further and spy on the user’s computer
    screen in real time. In Meterpreter, enter the `screenshare` command:'
  id: totrans-115
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你甚至可能能够更进一步，实时监视用户的计算机屏幕。在 Meterpreter 中，输入 `screenshare` 命令：
- en: '[PRE24]'
  id: totrans-116
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE24]'
- en: This command doesn’t always work, and it may slow both your VMs (and your host
    computer) to a crawl because it attempts to stream real-time video of the Windows
    10 VM’s computer screen over the virtual network to the Kali VM. But if it does
    work, you’ll see the Windows 10 VM’s desktop through a browser window in Kali,
    as shown in [Figure 6-8](#figure6-8).
  id: totrans-117
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 这个命令并不总是有效，而且它可能会让你的虚拟机（以及宿主计算机）变得非常缓慢，因为它试图将 Windows 10 虚拟机的计算机屏幕实时视频通过虚拟网络流传输到
    Kali 虚拟机。但如果它成功了，你将能够通过 Kali 中的浏览器窗口看到 Windows 10 虚拟机的桌面，如[图 6-8](#figure6-8)所示。
- en: Switch over to your Windows VM and move some files or windows around, empty
    the Recycle Bin, or open a web page. If you have multiple monitors or enough room
    to show both VMs, you can watch everything you do in the Windows VM through the
    streaming video in the browser in Kali. Creepy, right?
  id: totrans-118
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 切换到你的 Windows 虚拟机，移动一些文件或窗口，清空回收站，或打开一个网页。如果你有多个显示器，或者有足够的空间同时显示两个虚拟机，你可以通过
    Kali 中浏览器中的流媒体视频观看你在 Windows 虚拟机中的一切操作。很毛骨悚然，对吧？
- en: Click back into the Meterpreter terminal window in Kali and press CTRL-C to
    stop the screenshare.
  id: totrans-119
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击回到 Kali 中的 Meterpreter 终端窗口，然后按 CTRL-C 停止屏幕共享。
- en: '![f06008](image_fi/502000c06/f06008.png)'
  id: totrans-120
  prefs: []
  type: TYPE_IMG
  zh: '![f06008](image_fi/502000c06/f06008.png)'
- en: 'Figure 6-8: The `screenshare` command lets an attacker on Kali spy on your
    Windows desktop over the internet.'
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 图 6-8：`screenshare` 命令让 Kali 上的攻击者能够通过互联网监视你的 Windows 桌面。
- en: Logging Keystrokes
  id: totrans-122
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 记录按键
- en: Once in control of a machine, an attacker can log the user’s every keystroke.
    This gives the attacker a record of what the user is typing, including searches,
    commands, passwords, and more. Let’s see how it works.
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦控制了计算机，攻击者就可以记录用户的每一个按键。这使得攻击者能够获得用户输入的记录，包括搜索、命令、密码等。让我们看看它是如何工作的。
- en: 'Type `keyscan_start` into the Meterpreter shell to begin recording keystrokes
    from the target computer:'
  id: totrans-124
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 Meterpreter shell 中输入 `keyscan_start` 命令，以开始记录目标计算机的按键：
- en: '[PRE25]'
  id: totrans-125
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE25]'
- en: Switch back to your Windows VM, enter **notepad** in the search bar, and open
    the Notepad app.
  id: totrans-126
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 切换回 Windows 虚拟机，在搜索栏中输入 **notepad** 并打开记事本应用。
- en: 'Enter this information into Notepad:'
  id: totrans-127
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将此信息输入记事本：
- en: '[PRE26]'
  id: totrans-128
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE26]'
- en: Of course, you should never store sensitive information like this in plaintext
    on your computer, but many people in the world do.
  id: totrans-129
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 当然，你永远不应将敏感信息以明文形式存储在计算机上，但世界上许多人确实这样做。
- en: 'Switch back over to the Kali VM and enter `keyscan_dump` to view the logged
    keystrokes:'
  id: totrans-130
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 切换回 Kali 虚拟机并输入 `keyscan_dump` 查看记录的按键：
- en: '[PRE27]'
  id: totrans-131
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE27]'
- en: Meterpreter captured all of the Windows 10 user’s keystrokes, including special
    keys like `<CR>` (short for *carriage return*, another name for the ENTER key).
    Typing into a text file might seem like an unrealistic example, but you can imagine
    instead that the user was typing their credit card number into an online shopping
    site or entering their username and password to log in to their bank’s web portal.
  id: totrans-132
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: Meterpreter 捕获了 Windows 10 用户的所有按键，包括特殊键，如 `<CR>`（即*回车键*，是 ENTER 键的另一种称呼）。虽然在文本文件中输入可能看起来是一个不太现实的例子，但你可以想象，用户可能正在向一个在线购物网站输入他们的信用卡号，或在银行的网页门户登录时输入用户名和密码。
- en: 'Enter `keyscan_stop` in the Meterpreter shell to stop capturing keystrokes
    from the Windows computer:'
  id: totrans-133
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 Meterpreter shell 中输入 `keyscan_stop` 命令，以停止捕获来自 Windows 计算机的按键：
- en: '[PRE28]'
  id: totrans-134
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: Spying Through Webcams
  id: totrans-135
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 通过摄像头进行间谍监视
- en: If logging keystrokes wasn’t creepy enough for you, viewing a victim computer’s
    webcam should make you want to move to a remote island with no internet (or at
    least convince you to cover your webcam with a sticky note). Connecting a webcam
    to the Windows VM might not work, but even if you can’t try this attack yourself,
    it works reliably against real Windows computers with webcams. To proceed, you’ll
    need a webcam (the one built into your laptop or a USB webcam attached to your
    desktop) and the patience to rerun the entire hack a few times following the steps
    in the Warning just given.
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 如果记录按键还不足以让你感到毛骨悚然，那么查看受害者计算机的摄像头应该会让你想搬到一个没有互联网的偏远岛屿（或者至少让你决定用便签纸覆盖住摄像头）。将摄像头连接到
    Windows 虚拟机可能无法成功，但即便你无法亲自尝试这个攻击，它在真实的带有摄像头的 Windows 计算机上却能可靠地执行。继续进行此操作时，你需要一台摄像头（笔记本电脑自带的摄像头或连接到台式机的
    USB 摄像头）以及耐心，按照警告中给出的步骤多次重新运行整个黑客操作。
- en: Check if your webcam appears under Devices▶Webcams on the Windows VM’s menu
    bar. If it does, select its name and skip ahead to step 6\. Otherwise, we’ll need
    to connect your webcam to the VM.
  id: totrans-137
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 检查你的摄像头是否出现在 Windows 虚拟机菜单栏的 **设备**▶**摄像头**下。如果有，选择它的名称并跳至第 6 步。否则，我们需要将摄像头连接到虚拟机。
- en: Close the Windows VM and select **Power off the machine**.
  id: totrans-138
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 关闭 Windows 虚拟机并选择 **关闭机器电源**。
- en: In VirtualBox Manager, select the Windows VM and go to **Machine**▶**Settings**
    or **Machine**▶**Settings**▶**Ports** (on macOS). Select **USB** in the Settings
    menu and select the checkbox next to **Enable USB Controller**.
  id: totrans-139
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 VirtualBox 管理器中，选择 Windows 虚拟机并进入 **机器**▶**设置**，或者在 macOS 上选择 **机器**▶**设置**▶**端口**。在设置菜单中选择
    **USB**，然后勾选 **启用 USB 控制器** 旁边的复选框。
- en: Restart the Windows VM. Go to the menu bar, select **Devices**▶**Webcams** or
    **Devices**▶**USB**, and select the name of your webcam.
  id: totrans-140
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 重启 Windows 虚拟机。进入菜单栏，选择 **设备**▶**摄像头**或 **设备**▶**USB**，然后选择你的摄像头名称。
- en: Turn off the Windows VM’s Firewall and Defender. Then run the trojan again.
  id: totrans-141
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 关闭 Windows 虚拟机的防火墙和防御程序。然后重新运行木马。
- en: 'Enter `webcam_list` at the Meterpreter prompt in Kali to find out if the webcam
    is available. You should see something like this:'
  id: totrans-142
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 Kali 中的 Meterpreter 提示符下输入 `webcam_list`，查看摄像头是否可用。你应该看到类似如下内容：
- en: '[PRE29]'
  id: totrans-143
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE29]'
- en: My webcam is showing up as `VirtualBox Webcam - Logitech HD Webcam C310`, for
    example.
  id: totrans-144
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 例如，我的摄像头显示为 `VirtualBox Webcam - Logitech HD Webcam C310`。
- en: Enter `webcam_stream` to connect to the webcam via Meterpreter.
  id: totrans-145
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入 `webcam_stream` 通过 Meterpreter 连接到摄像头。
- en: '[PRE30]'
  id: totrans-146
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE30]'
- en: Meterpreter will open Firefox and stream video from the Windows VM’s webcam,
    as shown in [Figure 6-9](#figure6-9).
  id: totrans-147
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: Meterpreter 将打开 Firefox，并从 Windows 虚拟机的摄像头流式传输视频，如[图 6-9](#figure6-9)所示。
- en: '![f06009](image_fi/502000c06/f06009.png)'
  id: totrans-148
  prefs: []
  type: TYPE_IMG
  zh: '![f06009](image_fi/502000c06/f06009.png)'
- en: 'Figure 6-9: The webcam stream shows me and the bookshelf in my office.'
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 图 6-9：摄像头流显示我和办公室里的书架。
- en: 'You should see your webcam’s LED light up, showing that the camera is active.
    Unlike the `screenshare` and `keyscan` commands, the webcam hack lets you know
    someone’s spying on you. If your webcam light is ever on when you’re not using
    it, run a *thorough* antivirus scan and reboot your computer to see if the light
    turns off. However, don’t rely on the webcam LED: some advanced hacks enable spying
    through the webcam *without turning on* the LED. That’s why it’s important to
    practice the safety measures described in the next section.'
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 你应该能看到摄像头的 LED 灯亮起，表明摄像头正在工作。与 `screenshare` 和 `keyscan` 命令不同，摄像头黑客攻击会让你知道有人在监视你。如果摄像头灯在你未使用它时亮起，请运行
    *彻底* 的杀毒扫描并重启计算机，看看灯是否会熄灭。然而，不要只依赖摄像头的 LED 灯：一些高级黑客手段能够在 *不亮起* LED 灯的情况下进行间谍监视。这就是为什么练习下一节中描述的安全措施非常重要。
- en: To stop streaming video from the Windows 10 VM’s webcam, close Firefox and press
    CTRL-C in the Meterpreter window to interrupt the `webcam_stream` command. Then
    grab a sticky note or a piece of masking tape and cover the webcam on your laptop!
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 要停止从 Windows 10 虚拟机摄像头流式传输视频，关闭 Firefox 并在 Meterpreter 窗口按 CTRL-C 来中断 `webcam_stream`
    命令。然后拿一个便签或一段胶带，覆盖掉你笔记本上的摄像头！
- en: Defending Against Malware
  id: totrans-152
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 防御恶意软件
- en: As you’ve seen in this chapter, viruses are incredibly easy to create and distribute.
    Any suspicious email attachment, link, web page, app, or video that you receive
    or open could contain malware waiting to be launched. Attackers don’t even need
    a lot of skill; they just need to use Metasploit and trick people into downloading
    the virus. Once a computer is infected, the attacks an unethical hacker can use
    against it are downright frightening.
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 如你在本章中所见，病毒的创建和传播极其简单。你收到或打开的任何可疑邮件附件、链接、网页、应用或视频，都可能包含等待启动的恶意软件。攻击者甚至不需要太多技能，只需使用
    Metasploit 并诱使人们下载病毒。一旦计算机被感染，恶意黑客可以对其进行的攻击简直让人不寒而栗。
- en: 'Your best defenses are the following:'
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 你最好的防御措施如下：
- en: Update software often. Update your operating system and applications, from your
    word processor and web browser to your PDF reader—at least monthly. Pick a certain
    day of the month, like the 1st, 15th, or 30th, and mark your calendar to update
    your devices and all applications. Think of it as another must-do task, like paying
    bills or mowing the lawn. Most of the 2,000+ exploits in Kali attack older versions
    of software, so you’ll be less vulnerable to an attack if you keep the latest
    security patches installed for the software you use.
  id: totrans-155
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 经常更新软件。定期更新你的操作系统和应用程序，从文字处理软件、网页浏览器到PDF阅读器——至少每月一次。选择一个固定的日期，比如每月的1号、15号或30号，在日历上标记更新你的设备和所有应用程序。把它当作另一项必须完成的任务，就像支付账单或修剪草坪一样。Kali中的2000多个漏洞大多攻击的是软件的旧版本，所以如果你保持安装最新的安全补丁，你的设备就会减少遭受攻击的风险。
- en: Use a firewall and antivirus software. Keep your firewall turned on and update
    your antivirus software regularly. There are several free and low-cost antivirus
    tools out there. Research which ones stop the most malware and then update your
    antivirus tool weekly, or turn on automatic updates, to give it the best shot
    at protecting you.
  id: totrans-156
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用防火墙和杀毒软件。保持防火墙开启，并定期更新你的杀毒软件。有很多免费的或者低成本的杀毒工具可供选择。研究哪些杀毒软件能够阻止最多的恶意软件，然后每周更新你的杀毒工具，或者开启自动更新，以确保它能够有效地保护你。
- en: Think before you click. Malware can be launched through infected program files,
    bootlegged videos, or even Office documents and PDFs. Peer-to-peer file-sharing
    sites are filled with “free” malware-infected files, waiting for unsuspecting
    victims. Run VirusTotal or another virus scan on *any* files from sources you
    don’t trust and don’t download suspicious or illegal files at all.
  id: totrans-157
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在点击之前先思考。恶意软件可以通过感染的程序文件、盗版视频，甚至是Office文档和PDF文件来传播。点对点文件共享网站上充斥着“免费”的恶意软件感染文件，等待着毫无戒心的受害者。对来自不信任来源的*任何*文件运行VirusTotal或其他病毒扫描工具，并且不要下载任何可疑或非法的文件。
- en: These measures won’t make you invincible, but they’ll help you avoid most malware-based
    attacks, and they’ll make you a difficult enough target that most hackers will
    move on to other victims. Most attacks rely on the concept of *low-hanging fruit*—easy
    opportunities for a malicious hacker to break into your system, such as out-of-date
    software, a disabled firewall or antivirus program, or a user who opens links
    or downloads files without scanning them first. Unfortunately, there is enough
    low-hanging fruit to keep hackers busy, so taking a few smart precautions like
    these can keep you safe from more than 90 percent of attacks.
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 这些措施不能让你变得无敌，但它们可以帮助你避免大多数基于恶意软件的攻击，并且使你成为一个足够困难的目标，让大多数黑客选择攻击其他受害者。大多数攻击依赖于*低垂的果实*——这是指黑客可以轻松进入你系统的机会，比如过时的软件、禁用的防火墙或杀毒程序，或者是点击链接或下载文件时没有先进行扫描的用户。不幸的是，低垂的果实足够多，足以让黑客忙碌，因此采取一些像这样的明智预防措施，能让你避免超过90%的攻击。
- en: Oh . . . and cover that webcam when you’re not using it!
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 哦……在不使用摄像头时，记得遮住它！
- en: The Takeaway
  id: totrans-160
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 关键提示
- en: In this chapter, you learned how attackers create malware and how easily an
    unprotected computer can be infected. Using the Metasploit framework, you created
    a Meterpreter remote-access trojan (RAT), a special kind of malware that gives
    an attacker control of your computer from anywhere in the world as long as they
    have an internet connection. You shared your malware across a network by turning
    on the Apache web server in your Kali Linux VM and placing the trojan in a shared
    web folder. Then you downloaded the malware onto your Windows VM and opened the
    file to infect your machine.
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，你学习了攻击者是如何创建恶意软件的，以及一台没有保护的计算机是多么容易被感染。使用Metasploit框架，你创建了一个Meterpreter远程访问木马（RAT），这是一种特殊类型的恶意软件，只要攻击者有互联网连接，就可以从世界任何地方控制你的计算机。你通过在Kali
    Linux虚拟机上启动Apache Web服务器，并将木马放置在共享的网页文件夹中，将你的恶意软件共享到网络中。然后，你将恶意软件下载到Windows虚拟机上并打开文件，从而感染了你的计算机。
- en: Next, you took control of the Windows VM from the Meterpreter remote shell in
    Kali. You learned how an attacker can upload and download files, steal screenshots,
    log keystrokes, and spy through a webcam using only a command or two. For most
    of the attacks, your Windows VM didn’t even show it was being hacked.
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，你通过Kali中的Meterpreter远程shell控制了Windows虚拟机。你学习了攻击者是如何通过简单的命令上传和下载文件、窃取截图、记录按键、以及通过摄像头进行间谍活动的。在大多数攻击中，你的Windows虚拟机甚至没有显示出被黑的迹象。
- en: Finally, you learned how to prevent many malware-based attacks. Avoiding suspicious
    downloads, links, and websites; keeping your firewall and antivirus software turned
    on and current; and regularly updating your operating system and applications
    are important precautions. If you employ multiple layers of security, you are
    a much more difficult target, and most attackers will move on to easier prey.
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，你已经学会了如何防止许多基于恶意软件的攻击。避免可疑的下载、链接和网站；保持你的防火墙和杀毒软件开启并保持最新；定期更新你的操作系统和应用程序，这些都是重要的预防措施。如果你使用多重安全防护，你将成为一个更难攻击的目标，大多数攻击者会转向更容易的猎物。
- en: In the next chapter, we’ll take our skills one level higher and see how unethical
    hackers use Meterpreter and other tools to steal and crack passwords.
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章，我们将把我们的技能提高一个层次，看看不道德的黑客如何利用Meterpreter和其他工具窃取和破解密码。
