- en: —16—
  id: totrans-0
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: —16—
- en: 'Inverted Indexes: The Search Narrows'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 倒排索引：搜索变得更加精确
- en: The gentle tinkle of a bell announced Frank’s arrival at Cloaks and More in
    the center of the capital the next morning. Nearly every square inch of the small
    shop was packed tight with racks of cloaks. Frank forced his way through a narrow
    gap between racks toward the counter in the back.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 第二天早晨，随着铃声的轻响，弗兰克来到了位于首都中心的“斗篷与更多”商店。商店里几乎每一寸地方都被密密麻麻的斗篷架占据着。弗兰克穿过架子之间狭窄的缝隙，朝后方的柜台走去。
- en: A small balding man peered up through thick glasses. “Welcome to Cloaks and
    More. I am Gilbert Cloaksworth. How can I help you today?”
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 一位小个子秃顶男人透过厚厚的眼镜抬起头。“欢迎光临‘斗篷与更多’，我是吉尔伯特·克洛克斯沃斯。今天我能为您提供什么帮助？”
- en: He looked Frank up and down. His eyes flicked repeatedly to Frank’s well-worn
    trench cloak, and when he noticed a patch near the shoulder, the shop owner shuddered.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 他上下打量了弗兰克一番。眼睛不断地扫向弗兰克那件破旧的风衣，当他注意到肩膀处的一个补丁时，店主不禁打了个寒战。
- en: “I see you are in the market for a new cloak,” he ventured with the fake cheeriness
    perfected by snobby shopkeepers the world over. “You have come to the right place.
    We’ve just received a wonderful shipment of forest green traveling cloaks.”
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: “我看你是打算买一件新斗篷了，”他带着那种世界各地高傲店主都擅长的虚假热情说道，“你来对地方了。我们刚收到了一批极好的森林绿旅行斗篷。”
- en: “I’m looking for information,” said Frank. He pulled out the threads from the
    ArrayCart and held them out to the man. “I need to know what cloak these came
    from.”
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: “我在找信息，”弗兰克说道。他从ArrayCart中拿出线头，递给店主。“我需要知道这些线头来自哪件斗篷。”
- en: Mr. Cloaksworth didn’t move. “Not a new cloak?”
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 克洛克斯沃斯没有动。“不是新斗篷吗？”
- en: “Just information.”
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: “只是一些信息。”
- en: '![image](../images/f0128-01.jpg)'
  id: totrans-9
  prefs: []
  type: TYPE_IMG
  zh: '![image](../images/f0128-01.jpg)'
- en: “A pity,” said Cloaksworth coldly. “But I guess you still came to the right
    place. I am the city’s foremost expert in cloaks.” The shop owner took the threads
    and peered at them for a moment. Then he pulled a large magnifying glass from
    under the counter and examined them at length.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: “真可惜，”克洛克斯沃斯冷冷地说，“但我猜您还是来对地方了。我是这座城市斗篷方面的顶级专家。”店主接过那根线头，仔细观察了一会儿。然后他从柜台下拿出一只大放大镜，仔细地检查了它们。
- en: “Black and orange with a cross-weave stitch,” Cloaksworth muttered. “Reasonable
    quality. Not up to my standards, of course, but reasonable.”
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: “黑色和橙色交织的十字形针脚，”克洛克斯沃斯嘀咕道，“质量还算可以。当然，比不上我的标准，但也算合理。”
- en: “Can you tell me anything else?” prompted Frank. “Something useful perhaps?”
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: “你能告诉我其他信息吗？”弗兰克继续问道，“也许有什么有用的？”
- en: The shop owner scowled, but continued studying the threads. “A trace of charring,”
    he said finally.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 店主皱了皱眉，但继续研究着线头。“有烧焦痕迹，”他终于说道。
- en: “It was in a fire?” Frank asked.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: “是被火烧过吗？”弗兰克问道。
- en: “No. It’s too patterned for that. I’ve only seen this type of charring a few
    times in my life. Always on wizards’ cloaks. This cloak had a spell placed on
    it.”
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: “不。这太复杂了。我一生中只见过几次这种烧焦痕迹。总是在巫师的斗篷上。这个斗篷上施了魔法。”
- en: “Do you know what type?” asked Frank.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: “你知道是哪种类型吗？”弗兰克问道。
- en: Cloaksworth shook his head. “You should ask a wizard. I am the region’s foremost
    expert in cloaks, not spells.”
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 克洛克斯沃斯摇了摇头。“你应该去问问巫师。我是本地区斗篷方面的顶级专家，不是魔法。”
- en: “How about the coloring?” asked Frank. “I haven’t seen many cloaks with those
    colors. Can you tell me anything about where it might be from?”
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: “那颜色怎么样？”弗兰克问道，“我没见过多少斗篷是这种颜色的。你能告诉我它可能来自哪里吗？”
- en: Cloaksworth smiled. “Of course I can. I am the kingdom’s foremost expert in
    cloaks.”
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 克洛克斯沃斯微笑道：“当然可以。我是王国斗篷方面的顶级专家。”
- en: He turned and pulled a gigantic book from a shelf and dropped it on the counter
    with a loud thud. He flipped to the back.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 他转过身，从书架上抽出一本巨大的书，重重地放到柜台上。然后翻到了最后一页。
- en: “What are you doing?” asked Frank.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: “你在做什么？”弗兰克问道。
- en: “Looking up these colors in *The Registry of Cloaks and Heraldry, Volume 5*,”
    responded the shop owner. “You wanted to know where they came from, didn’t you?”
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: “正在查阅《斗篷与纹章登记册，第五卷》中的这些颜色，”商店老板回答道，“你不是想知道它们来自哪里吗？”
- en: “But why are you reading the back of the book?” said Frank. “Shouldn’t you be
    starting at the table of contents?”
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: “但是你为什么在读书的后面？”弗兰克说道，“你不应该从目录开始吗？”
- en: 'Cloaksworth finally gave a genuine smile. “There have been wonderful advances
    in heraldry tracking the past few years!” he exclaimed. “Traditionally, we did
    exactly what you suggested: scanned the table of contents for the subject of interest
    and then flipped to the correct page—using binary search, of course.'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 克洛克斯沃思终于露出了真诚的微笑。“过去几年，在纹章学追踪方面有了巨大的进展！”他惊叹道，“传统上，我们正如你所建议的那样：扫描目录以寻找感兴趣的主题，然后翻到正确的页面——当然，使用的是二分查找。”
- en: “And it is true that the table of contents provides an index into books’ subjects.
    But the table of contents is organized all wrong for this type of search. It lists
    topics by the order in which they occur. That’s a fine ordering if you want to
    know what comes next, but not if you are looking for a very particular subject.
    The kingdom now has over 10,000 cloak patterns! It can take a long time just to
    search the table of contents.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: “确实，目录提供了对书本主题的索引。但是，目录的组织方式对于这种类型的搜索完全不合适。它按主题出现的顺序列出内容。如果你想知道接下来是什么，这种顺序很合适，但如果你正在寻找一个非常具体的主题就不行了。王国现在有超过10,000种披风样式！光是搜索目录就可能需要很长时间。”
- en: “So Amanda Cloakington, the author *The Registry of Cloaks and Heraldry* and
    a personal hero of mine, developed the inverted index. She tracked important terms,
    such as cloak colors, and indexed them in back of the book—almost like a second
    table of contents.”
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: “所以，阿曼达·克洛金顿，《披风与纹章登记册》的作者，也是我的个人英雄，发明了倒排索引。她追踪了重要的术语，比如披风的颜色，并将它们编入书的后面——几乎就像是第二个目录。”
- en: '![image](../images/f0129-01.jpg)'
  id: totrans-27
  prefs: []
  type: TYPE_IMG
  zh: '![image](../images/f0129-01.jpg)'
- en: “How does that help?” asked Frank. “She’s just repeating the information that’s
    in the table of contents.”
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: “那有什么帮助呢？”弗兰克问，“她只是在重复目录里的信息。”
- en: “Yes. She repeated information, but she used a different order. She organized
    the index at the back in order of the terms. Then for each term, she listed the
    pages where it occurred.”
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: “是的。她重复了信息，但用了不同的顺序。她按术语的顺序组织了书后面的索引。然后，对于每个术语，她列出了它出现的页面。”
- en: Frank stared at him, waiting. But the owner seemed to have finished. “So?” Frank
    prompted.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 弗兰克盯着他，等待着。但店主似乎已经讲完了。“那么？”弗兰克促使道。
- en: “You only need to look up the term you want, and the index directs you to the
    corresponding pages!” he exclaimed. “No more muddling through the table of contents.
    Your search becomes a lookup.”
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: “你只需要查找你想要的术语，索引会引导你到相应的页面！”他惊呼道，“再也不用在目录中翻来翻去了。你的搜索就变成了查找。”
- en: “But you still need to search the index to find the correct term, right?” asked
    Frank.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: “但是你还是需要查找索引来找到正确的术语，对吧？”弗兰克问道。
- en: “Well, yes. But since the index is sorted alphabetically by the terms, you can
    just use binary search.”
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: “嗯，是的。但是，由于索引是按术语的字母顺序排序的，你可以直接使用二分查找。”
- en: “What if the item appears on a lot of pages?”
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: “如果某个条目出现在很多页面上呢？”
- en: “You need to check them all,” Cloaksworth conceded.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: “你需要检查所有的。”克洛克斯沃思承认道。
- en: “What if you are looking for a few terms?” asked Frank. “Like three colors of
    thread?”
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: “如果你要查找几个术语呢？”弗兰克问道，“比如三种不同颜色的线？”
- en: “Ah! Now that’s where it gets interesting,” said Cloaksworth. “You just need
    to check the pages they have in common. You can find those by *intersecting* the
    sets of page numbers. That means going through the lists and finding the elements
    that occur in *every* list. If you have enough terms, you can usually narrow down
    the pages they’re on to just one or two.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: “啊！这才是有趣的地方，”克洛克斯沃思说道，“你只需要检查它们共同的页面。你可以通过*交集*页面号的集合来找到这些页面。这意味着需要逐一浏览列表，找出在*每一个*列表中都出现的元素。如果你有足够的术语，通常可以将它们所在的页面缩小到只有一两页。”
- en: “The other day I had to look up a navy blue and royal blue cloak with wooden
    buttons. I can tell you that there aren’t many of those in the world. In fact,
    just one group uses that combination—the Association of Amateur Weather Forecasters.
    Until last year, they had been using navy blue and dark turquoise, but they were
    forced to change. The Association of Semiprofessional Weather Forecasters claimed,
    rightfully, that the colors were too similar to their own navy blue and light
    turquoise.”
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: “前几天我不得不查找一件海军蓝和皇家蓝的披风，带有木质扣子。我可以告诉你，这样的披风在世界上不多。事实上，只有一个群体使用这种组合——业余气象预报员协会。直到去年，他们还在使用海军蓝和深绿色，但是他们被迫更换了颜色。半专业气象预报员协会合理地声称，这些颜色与他们的海军蓝和浅绿色太相似了。”
- en: '![image](../images/f0131-01.jpg)'
  id: totrans-39
  prefs: []
  type: TYPE_IMG
  zh: '![image](../images/f0131-01.jpg)'
- en: Frank thought about it for a moment and nodded. “Interesting idea,” he allowed.
    He could immediately see how such inverted indexes could be applied to other information
    sources. Police records were always sorted by date. Using this new technique,
    you could also index them by the type of crime or the location. These indexes
    could make research orders of magnitude more efficient.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 弗兰克思索了一下，点了点头。“有趣的想法，”他表示认可。他立刻看到了如何将这种倒排索引应用于其他信息源。警察记录总是按日期排序。使用这种新技术，你还可以按犯罪类型或地点对其进行索引。这些索引可以使研究效率提高数倍。
- en: “I wonder if it’ll catch on for other books,” Frank mused.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: “我想知道它是否会被其他书籍采用，”弗兰克沉思道。
- en: “Unlikely,” the shop owner scoffed. “Few topics in this world are complicated
    enough to require an index. Not every topic is as rich as cloakology.”
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: “不太可能，”店主嗤笑道。“这个世界上很少有话题复杂到需要索引的程度。不是每个话题都像风衣学那样丰富。”
- en: As he spoke, the shop owner searched through the index and proceeded to flip
    rapidly through the book. “Police cloak,” he said at last. “The departments of
    Bool and Functionia use those colors. So do a few of the capital police force’s
    departments. Accounting, Payroll, Records, and Advisory Signage, I believe. All
    different designs, of course. I expect the cloak is a new issue, given the state
    of the threads. Police officers have a tendency to wear out cloaks quickly, especially
    in the Department of Advisory Signage.”
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 他说着，店主翻阅着索引，迅速翻动着书本。“警察风衣，”他最后说。“布尔和函数尼亚的部门使用这些颜色。首都警察局的几个部门也使用这些颜色。会计、薪资、记录和咨询标识部门，我记得是这些。设计当然各不相同。我猜这件风衣是新款，考虑到线头的状态。警察往往穿坏风衣，尤其是在咨询标识部门。”
- en: “A new police cloak?” Frank confirmed.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: “一件新的警察风衣？”弗兰克确认道。
- en: “Most likely,” said Cloaksworth. “I doubt it is a custom design. Those colors
    were popular 20 years ago, but fell out of favor with the rise of pastels. It’s
    a shame, really—there were some beautiful cloaks back in those days. I once made
    a riding cloak with double fastenings and—”
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: “很可能吧，”克洛克斯沃斯说道。“我怀疑它是定制设计的。那些颜色20年前很流行，但随着浅色调的兴起，它们渐渐失宠了。真的很可惜——那时候有些风衣真是美丽极了。我曾经做过一件骑行风衣，有双重扣带——”
- en: Frank interrupted him, “Anything else you can tell me about the threads?”
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 弗兰克打断了他，“你能告诉我关于这些线头的更多信息吗？”
- en: The shop owner looked at him. “Aside from the fact that they are probably from
    a new police cloak from one of four departments and it was enchanted with a magic
    spell?”
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 店主看着他说：“除了它们可能来自四个部门中的新警察风衣，而且上面施了魔法咒语之外？”
- en: Frank waited.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 弗兰克等待着。
- en: “Uh . . . no,” said Cloaksworth finally. “That’s everything.”
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: “呃……不，”克洛克斯沃斯最终说道。“就这些。”
- en: Frank nodded. “Thanks,” he said. He picked up the threads and turned to leave.
    He heard a soft gasp as he opened the door and knew the shop owner had seen the
    ragged edge at the bottom of his trench cloak.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 弗兰克点了点头。“谢谢，”他说。他捡起线头，转身准备离开。门一开，他听到一声轻微的倒吸气声，知道店主已经看到他风衣下摆的破损边缘。
- en: '**POLICE ALGORITHMS 101: INVERTED INDEXES**'
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: '**警察算法 101：倒排索引**'
- en: '***Excerpt from Professor Drecker’s Lecture***'
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: '***德雷克教授讲座摘录***'
- en: An inverted index is a computational data structure similar to the index of
    a book. It provides a mapping from target values to the location in the data where
    those values occur. Inverted indexes are especially useful when a given value
    occurs, or might occur, repeatedly throughout the data.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 倒排索引是一种计算数据结构，类似于书籍的索引。它提供了一种从目标值到数据中该值出现位置的映射。倒排索引特别有用，当一个特定的值在数据中多次出现或可能出现时。
- en: Consider an example from our lecture on binary search—checking an accounting
    ledger for transactions with a particular merchant. The ledgers are sorted by
    increasing transaction number, indicating the order in which the transactions
    were recorded.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 考虑我们在二分查找讲座中的一个例子——检查会计账簿中与特定商家的交易。账簿按交易号递增排序，表示交易记录的顺序。
- en: '![image](../images/f0132-01.jpg)'
  id: totrans-55
  prefs: []
  type: TYPE_IMG
  zh: '![image](../images/f0132-01.jpg)'
- en: While this ordering allows us to efficiently find information for a given transaction
    ID, it doesn’t help us trace transactions to a particular merchant. One option
    would be to re-sort the entries by merchant name. However, this requires us to
    make a copy of the entire ledger, which can be costly.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然这种排序可以帮助我们高效地找到某个交易ID的相关信息，但它并不能帮助我们追踪交易到特定的商家。一种选择是按商家名称重新排序条目。然而，这需要我们复制整个账簿，这可能是很昂贵的。
- en: 'Instead, we can build an additional data structure: an inverted index, keyed
    by merchant name. For each merchant, we then store just a list of all the relevant
    transaction IDs. Since we already know how to efficiently look up any transaction
    given its ID, we can now get from merchant name to transaction information via
    an additional lookup in our index.'
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 相反，我们可以构建一个额外的数据结构：一个倒排索引，以商户名称为键。对于每个商户，我们只需存储所有相关交易ID的列表。由于我们已经知道如何高效地查找任何给定ID的交易，现在我们可以通过在索引中进行额外的查找，从商户名称获取交易信息。
- en: '![image](../images/f0133-01.jpg)'
  id: totrans-58
  prefs: []
  type: TYPE_IMG
  zh: '![image](../images/f0133-01.jpg)'
- en: Inverted indexes are a great example of a common tradeoff between running time
    and memory usage. An algorithm can trade an increase in memory usage, in the form
    of an additional index, for significantly more efficient searches along a new
    dimension.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 倒排索引是一个很好的例子，展示了运行时间与内存使用之间常见的权衡。一个算法可以通过增加内存使用（例如新增一个索引），来换取在新维度上显著更高效的搜索。
