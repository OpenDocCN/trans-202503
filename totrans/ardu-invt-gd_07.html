<html><head></head><body>
<h2 class="h2" id="ch06"><span epub:type="pagebreak" id="page_152"/><span class="num">6</span> Balance Beam</h2>&#13;
<p class="noindent1"><span epub:type="pagebreak" id="page_153"/><span class="red">In this project, you’ll build a desktop balance beam game using a turn knob and a <span class="underline">servo motor</span> (a small motor capable of making precise movements). The aim of the game is to roll a ball back and forth along the beam without it falling off. You’ll do this by using the turn knob to control the position of the servo. As the servo moves, so will the beam! Ready to get started?</span></p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_154"/><a href="ch06.xhtml#ch06fig01">Figure 6-1</a> shows the finished project. This is a simple mechanism that is made entirely of cardboard and a few household materials.</p>&#13;
<p class="figuret"><a id="ch06fig01"/><strong>FIGURE 6-1:</strong> The finished Balance Beam project</p>&#13;
<div class="image"><img alt="Image" src="../images/fig6_1.jpg"/></div>&#13;
<h3 class="h3" id="ch06lev1sec1"><strong>MATERIALS TO GATHER</strong></h3>&#13;
<p class="noindent">The circuit for this project uses relatively few parts, though we will introduce two new pieces of hardware: the servo motor and the potentiometer. Take a look at the electronic parts and other materials you’ll need, shown in <a href="ch06.xhtml#ch06fig02">Figures 6-2</a> through <a href="ch06.xhtml#ch06fig04">6-4</a>.</p>&#13;
<h4 class="h4" id="ch06lev2sec1"><strong>Electronic Parts</strong></h4>&#13;
<p class="bull">• One SparkFun RedBoard (DEV-13975), Arduino Uno (DEV-11021), or any other Arduino-compatible board</p>&#13;
<p class="bull">• One USB Mini-B cable (CAB-11301 or your board’s USB cable; not shown)</p>&#13;
<p class="bull">• One solderless breadboard (PRT-12002)</p>&#13;
<p class="bull">• One 10 kΩ potentiometer (COM-09806)</p>&#13;
<p class="bull">• One submicro size servo motor (ROB-09065)</p>&#13;
<p class="bull">• Male-to-male jumper wires (PRT-11026)</p>&#13;
<div class="noter">&#13;
<p class="notet"><strong>NOTE</strong></p>&#13;
<p class="notep"><em>All of the parts used in this project are standard in the SparkFun Inventor’s Kit.</em></p>&#13;
</div>&#13;
<p class="figuret"><span epub:type="pagebreak" id="page_155"/><a id="ch06fig02"/><strong>FIGURE 6-2:</strong> Components for the Balance Beam</p>&#13;
<div class="image"><img alt="Image" src="../images/fig6_2.jpg"/></div>&#13;
<h4 class="h4" id="ch06lev2sec2"><strong>Other Materials and Tools</strong></h4>&#13;
<p class="bull">• Pencil or marker</p>&#13;
<p class="bull">• Craft knife</p>&#13;
<p class="bull">• Metal ruler</p>&#13;
<p class="bull">• Needle-nose pliers</p>&#13;
<p class="bull">• Wire cutters</p>&#13;
<p class="bull">• Glue (hot glue gun or craft glue)</p>&#13;
<p class="bull">• Mini screwdriver</p>&#13;
<p class="bull">• Scissors (not shown)</p>&#13;
<p class="bull">• (Optional) Drill and 1/4-inch, 1/8-inch, and 1/16-inch bits</p>&#13;
<p class="bull">• Two sheets of cardboard (roughly 8.5 × 11 inches in size)</p>&#13;
<p class="bull">• Balance Beam template (see <a href="ch06.xhtml#ch06fig16">Figure 6-16</a> on page <a href="ch06.xhtml#page_167">167</a>)</p>&#13;
<p class="bull">• One bamboo skewer</p>&#13;
<p class="bull">• One small drinking straw (the bamboo skewer should fit into the straw loosely)</p>&#13;
<p class="bull">• One ping-pong ball</p>&#13;
<p class="bull">• One medium-size paper clip</p>&#13;
<p class="figuret"><span epub:type="pagebreak" id="page_156"/><a id="ch06fig03"/><strong>FIGURE 6-3:</strong> Recommended building materials</p>&#13;
<div class="image"><img alt="Image" src="../images/fig6_3.jpg"/></div>&#13;
<p class="figuret"><a id="ch06fig04"/><strong>FIGURE 6-4:</strong> Recommended tools</p>&#13;
<div class="image"><img alt="Image" src="../images/fig6_4.jpg"/></div>&#13;
<h3 class="h3" id="ch06lev1sec2"><strong>NEW COMPONENTS</strong></h3>&#13;
<p class="noindent">In the previous projects, you’ve mostly used your Arduino to control LEDs, but now it’s time to branch out and explore other components. This project introduces a new sensor, called a <em>potentiometer</em>, and motors, specifically the <em>servo motor</em>.</p>&#13;
<h4 class="h4" id="ch06lev2sec3"><strong>The Potentiometer</strong></h4>&#13;
<p class="noindent">In this project, you’ll use a potentiometer to control the movement of the Balance Beam. A potentiometer is a kind of sensor known as a <em>variable resistor</em>, which just means it’s a resistor whose value can vary.</p>&#13;
<p class="indent">A potentiometer generally has three legs or connection points and is represented by the symbol shown in <a href="ch06.xhtml#ch06fig05">Figure 6-5</a>.</p>&#13;
<p class="figuret"><span epub:type="pagebreak" id="page_157"/><a id="ch06fig05"/><strong>FIGURE 6-5:</strong> Schematic diagram for a potentiometer</p>&#13;
<div class="image"><img alt="Image" src="../images/fig6_5.jpg"/></div>&#13;
<p class="indent">Potentiometers come in many shapes and sizes, a few of which are shown in <a href="ch06.xhtml#ch06fig06">Figure 6-6</a>. Some look like turn knobs, some are sliders, and others require a small screwdriver to manipulate. Regardless of their appearance, they all work in the same way. And they are all around you—at home, you might find them in the dimmer switch of your dining room light, in the volume knob on your stereo, or inside devices like DVD players.</p>&#13;
<p class="figuret"><a id="ch06fig06"/><strong>FIGURE 6-6:</strong> Various shapes and sizes of potentiometers. We’ll be using the one on the left.</p>&#13;
<div class="image"><img alt="Image" src="../images/fig6_6.jpg"/></div>&#13;
<p class="indent"> A potentiometer has a fixed resistance between the two opposite legs marked A and B in <a href="ch06.xhtml#ch06fig07">Figure 6-7</a>. Potentiometers can come in all sorts of resistance values, but for this project you’ll use a 10 kΩ potentiometer. As you turn the knob or move the slider, the third leg of the potentiometer (marked C), called the <em>wiper</em>, moves up or down the resistor, and the resistance between B and C changes. It’s this resistance value that’s applied to the circuit.</p>&#13;
<p class="indent">If you turn the knob clockwise, the wiper moves toward A and the resistance between C and B increases; if you turn the knob counterclockwise, the wiper moves toward B and the resistance decreases. <a href="ch06.xhtml#ch06fig07">Figure 6-7</a> shows how moving the wiper affects the resistance.</p>&#13;
<p class="figuret"><a id="ch06fig07"/><strong>FIGURE 6-7:</strong> Various positions on a potentiometer</p>&#13;
<div class="image"><img alt="Image" src="../images/fig6_7.jpg"/></div>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_158"/>If you connect A to 5 V, B to GND, and C to an analog input pin on your Arduino, this circuit starts to resemble the voltage divider you used in <a href="ch05.xhtml#ch05">Project 5</a>. As you turn the knob, you can vary the voltage on C between 0 V and 5 V. This setup is also sometimes called an <em>adjustable voltage divider.</em></p>&#13;
<h4 class="h4" id="ch06lev2sec4"><strong>The Servo Motor</strong></h4>&#13;
<p class="noindent">A servo motor (or just <em>servo</em> for short) is a special type of motor designed to rotate an arm (or <em>horn</em>) to a particular angle, which you will determine in your sketch. Most servo motors have a given range of 180 degrees, though some can rotate a full 360 degrees; these are called <em>continuous rotation servos</em>. In this project, you’ll be using a standard 180-degree hobby servo, shown in <a href="ch06.xhtml#ch06fig08">Figure 6-8</a>.</p>&#13;
<p class="figuret"><a id="ch06fig08"/><strong>FIGURE 6-8:</strong> A standard hobby servo</p>&#13;
<div class="image"><img alt="Image" src="../images/fig6_8.jpg"/></div>&#13;
<p class="indent">Servo motors are used in thousands of different products, from model cars and airplanes to the speedometer in your car and the robotic arms that built it.</p>&#13;
<p class="indent">What’s inside that black box? We opened one up so you don’t have to—see <a href="ch06.xhtml#ch06fig09">Figure 6-9</a>.</p>&#13;
<p class="figuret"><a id="ch06fig09"/><strong>FIGURE 6-9:</strong> The inside of a servo motor</p>&#13;
<div class="image"><img alt="Image" src="../images/fig6_9.jpg"/></div>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_159"/>Inside a servo are three main parts: the motor, gear train, and control circuit. When voltage is applied to the motor, it turns the gear train, which turns the hub of the servo motor. The rotational position of the hub is controlled by the control circuit. Part of the gear train is a potentiometer that rotates as the motor rotates. Remember that a potentiometer is a simple sensor that changes resistance based on how much it rotates, and when it’s connected up as an adjustable voltage divider, the voltage varies as the potentiometer rotates. The control circuit reads both the value in the input signal coming into the servo (from the Arduino, in this case) and the potentiometer value and compares them. When the two values are equal, the motor stops and holds its position.</p>&#13;
<p class="indent">A servo motor relies on PWM, a concept we introduced in “<a href="ch05.xhtml#ch05lev1sec6">Create More Colors with <code>analogWrite()</code></a>” on page <a href="ch05.xhtml#page_138">138</a>. To control the position of a servo, the Arduino sends out a PWM signal that pulses every 20 ms. The width of the pulse corresponds to a specific rotational position for the servo motor. <a href="ch06.xhtml#ch06fig10">Figure 6-10</a> illustrates this by showing the minimum PWM pulse widths for 0 degrees of a servo, the midpoint of 90 degrees, and the maximum of 180 degrees. Similar to blinking an LED, you can use the Arduino to create a very short pulse that is on for 1 ms and off for 19 ms to move the servo to an angle of 0 degrees.</p>&#13;
<p class="figuret"><a id="ch06fig10"/><strong>FIGURE 6-10:</strong> The PWM duty cycles for the standard range of a servo</p>&#13;
<div class="image"><img alt="Image" src="../images/fig6_10.jpg"/></div>&#13;
<p class="indent">To set the angle of a servo motor to 0 degrees, you could use code like the following:</p>&#13;
<div class="pre">&#13;
<pre><span class="green">void</span> <span class="green1">setup</span>()<br/>{<br/>  <span class="orange">pinMode</span>(9, <span class="green">OUTPUT</span>);<br/>}<br/><span epub:type="pagebreak" id="page_160"/><br/><span class="green">void</span> <span class="green1">loop</span>()<br/>{<br/>  <span class="orange">digitalWrite</span>(9, <span class="green">HIGH</span>);<br/>  <span class="orange">delay</span>(1);<br/>  <span class="orange">digitalWrite</span>(9, <span class="green">LOW</span>)<br/>  <span class="orange">delay</span>(19);<br/>}</pre>&#13;
</div>&#13;
<p class="indent">This code drives pin 9 <code>HIGH</code> for 1 ms, and then immediately sets the pin <code>LOW</code> for 19 ms. As soon as the 19 ms are over, it has to drive the pin <code>HIGH</code> again for 1 ms to maintain the timing cycle. If your code is busy managing timing like this, you can’t add anything else to it without affecting the timing of the pulses and control of the servo. Thankfully, the Arduino has a trick to simplify the way you control the servo motor: using a <em>library</em>. A library is a file containing extra code that you can use with your sketch to perform specific tasks or make it easier to use particular parts. The Servo library handles all of the pulse timing needed to drive the servo motor to a specific angle.</p>&#13;
<p class="indent">In this project, you’ll be using the Arduino to move a balance beam based on the voltage output of a sensor—your potentiometer. The code will use the voltage reading of the sensor to set the appropriate pulse width length for a given rotation for the servo, which will determine the angle of the beam.</p>&#13;
<p class="indent">The good news is that the Arduino, and more specifically the Servo library, does all of the hard work for you! It is great to understand how the pulse width controls the position of the servo, but, in the end, the software takes care of it for you.</p>&#13;
<h3 class="h3" id="ch06lev1sec3"><strong>BUILD THE BALANCE BEAM PROTOTYPE</strong></h3>&#13;
<p class="noindent">Now that you know the theory, you’ll build the circuit for the Balance Beam. You’ll start by connecting the servo, and then you’ll add a potentiometer; <a href="ch06.xhtml#ch06fig11">Figure 6-11</a> shows the full circuit.</p>&#13;
<p class="indent">Notice that the servo has a single three-pin female header. To connect this to your circuit, you’ll need to use male-to-male jumper wires. Take three short male-to-male jumper wires and connect these to the female pins, as shown in <a href="ch06.xhtml#ch06fig12">Figure 6-12</a>. It’s good practice to use the colors that correspond to the servo wires to make it easier to see which is which: black, red, and white represent the ground, power, and signal lines, respectively. Now, hook the servo up to the Arduino.</p>&#13;
<p class="figuret"><span epub:type="pagebreak" id="page_161"/><a id="ch06fig11"/><strong>FIGURE 6-11:</strong> Balance Beam prototype circuit</p>&#13;
<div class="image"><img alt="Image" src="../images/fig6_11.jpg"/></div>&#13;
<p class="figuret"><a id="ch06fig12"/><strong>FIGURE 6-12:</strong> Adding male-to-male jumper wire extensions to the servo motor</p>&#13;
<div class="image"><img alt="Image" src="../images/fig6_12.jpg"/></div>&#13;
<p class="indent">The circuit connection is pretty simple: connect 5 V and GND from the Arduino to the power rails on the left side of the breadboard. Connect the servo’s ground (black) wire to the ground rail on the breadboard and the power (red) wire to the 5 V rail. Connect the signal wire directly to pin 9 on the Arduino. A complete diagram is shown in <a href="ch06.xhtml#ch06fig13">Figure 6-13</a>.</p>&#13;
<p class="figuret"><a id="ch06fig13"/><strong>FIGURE 6-13:</strong> Servo hooked up to signal, power, and ground</p>&#13;
<div class="image"><img alt="Image" src="../images/fig6_13.jpg"/></div>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_162"/>Finally, add the servo <em>horn</em> onto the hub of the servo. Horns are different-shaped arms for a servo that rotate with the hub to make it easier to use and attach things to the servo. At this point, select any one of the horns that come with the servo, and press-fit it onto the hub of the servo, as shown in <a href="ch06.xhtml#ch06fig14">Figure 6-14</a>. You will add a specific horn later, but for now we just want to make it easier to see rotation.</p>&#13;
<p class="figuret"><a id="ch06fig14"/><strong>FIGURE 6-14:</strong> Press-fitting a servo horn from the included options</p>&#13;
<div class="image"><img alt="Image" src="../images/fig6_14.jpg"/></div>&#13;
<p class="indent">If the servo starts moving or acting erratically, simply disconnect its black wire from the ground rail to stop it. It’s good safety practice to keep the black wire disconnected until you upload code.</p>&#13;
<p class="indent">Now, wire up the potentiometer. The breadboard has plenty of room, so place the potentiometer anywhere you like, making sure each leg is in its own row. Connect the two outside pins to the 5 V and ground rails, with the center pin connected to analog input pin A0 directly on the Arduino, as shown in <a href="ch06.xhtml#ch06fig15">Figure 6-15</a>.</p>&#13;
<p class="figuret"><a id="ch06fig15"/><strong>FIGURE 6-15:</strong> The full Balance Beam circuit</p>&#13;
<div class="image"><img alt="Image" src="../images/fig6_15.jpg"/></div>&#13;
<p class="indent">At the moment, you just have a servo connected to a potentiometer. To give the project its balancing powers, you need to program it.</p>&#13;
<h3 class="h3" id="ch06lev1sec4"><span epub:type="pagebreak" id="page_163"/><strong>PROGRAM THE BALANCE BEAM</strong></h3>&#13;
<p class="noindent">To use the servo with an Arduino, you need to use the Servo library— which, as mentioned earlier, is a collection of prewritten code that expands the commands and capabilities of the code in your sketch. It gives you more features and functions to work with and simplifies using external hardware with your Arduino. For example, the Servo library includes code that attaches the servo to a specific Arduino pin, moves the servo to specific angles, and even detaches the servo from a pin.</p>&#13;
<p class="indent">Before you program the full project, you’ll upload a quick test sketch to check that your servo is working correctly.</p>&#13;
<h4 class="h4" id="ch06lev2sec5"><strong>Test the Servo</strong></h4>&#13;
<p class="noindent">Here’s a simple example sketch for controlling your servo. Start a new sketch by selecting <strong>File <span class="ent">▸</span> New</strong>, and then enter the sketch in <a href="ch06.xhtml#ch06ex01">Listing 6-1</a>:</p>&#13;
<p class="ex-caption"><a id="ch06ex01"/><strong>LISTING 6-1:</strong> A servo “Hello world”</p>&#13;
<div class="pre">&#13;
<pre><span class="ent">➊</span> <span class="green1">#include</span>&lt;<span class="orange"><strong>Servo</strong></span>.h&gt;<br/><br/><span class="ent">➋</span> <span class="orange"><strong>Servo</strong></span> myServo;<br/>  <span class="green">void</span> <span class="green1">setup</span>()<br/>  {<br/><span class="ent">➌</span>   myServo.<span class="orange">attach</span>(9);<br/>  }<br/><br/>  <span class="green">void</span> <span class="green1">loop</span>()<br/>  {<br/><span class="ent">➍</span>   myServo.<span class="orange">write</span>(90);<br/>  }</pre>&#13;
</div>&#13;
<p class="indent">To use the Servo library, call <code>#include&lt;Servo.h&gt;</code> <span class="ent">➊</span>, which tells the Arduino to include the <em>Servo.h</em> file containing the Servo library code. This adds the functions and definitions of the library to the sketch. Notice that this is one of the rare instances where there isn’t a semicolon at the end of the line. In Arduino programming, the <code>#</code> symbol indicates that the following code is a <em>preprocessor directive</em>, a special piece of code that should be executed before the rest of the sketch. When you compile a sketch, the first thing that runs is the <em>preprocessor</em>, which searches for any lines that start with a <code>#</code> symbol and don’t end with the semicolon and runs those lines first. The <code>#include</code> directive tells the preprocessor to include all of the code in the named file before compiling the code in your sketch.</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_164"/>You can also use the drop-down menu to add a library by selecting <strong>Sketch <span class="ent">▸</span> Include Library…</strong> and then selecting the library you want to use (in this case, <strong>Servo</strong>). This will automatically add the <code>#include</code> statement to your sketch. This option is great if you can’t remember the precise syntax of the <code>#include</code> command or the library name—for example, when you use a library for the first time.</p>&#13;
<p class="indent">The library allows you to create a type of data structure called an <em>object</em>. An object is simply a container for variables and functions that are predefined. Functions that are associated with the object are referred to as <em>methods</em>. In this sketch, the line <code>Servo myServo;</code> creates a new <code>Servo</code> object named <code>myServo</code> <span class="ent">➋</span>.</p>&#13;
<p class="indent">You can give an object any name you like, but we recommend using a descriptive name, like <code>myServo</code>, so it’s recognizable. Now you can use that name to reference all the servo commands that are available to you in the Servo library. For example, the method <code>myServo.attach()</code> tells the Arduino which pin the servo is attached to. If you had multiple servos, each one would get a unique name so that you could control all of them independently.</p>&#13;
<p class="indent">As an example, think of a robot arm that moves at the shoulder, elbow, and wrist, using a servo for each joint. The code for it would create three <code>Servo</code> objects named <code>shoulderServo</code>, <code>elbowServo</code>, and <code>wristServo</code> so that you could position each one accurately and at a different orientation from the others. Each one of those <code>Servo</code> objects would have its own set of methods that you could use separately.</p>&#13;
<p class="indent">For the Balance Beam, you’ll use only one servo. The setup of the sketch tells the Arduino that you have a servo attached to pin 9 with the method <code>myServo.attach(9)</code> <span class="ent">➌</span>. It then tells the Arduino to move the servo to a position of 90 degrees via the method <code>myServo.write(90)</code> <span class="ent">➍</span>. The Servo library converts the angle in degrees of rotation to the appropriate pulse width behind the scenes. This is built into the <code>write()</code> method.</p>&#13;
<p class="indent">Now, plug the black wire of your servo into ground and upload your code to the Arduino, and the servo will rotate to 90 degrees. It’s safe for now to leave your servo wired up.</p>&#13;
<div class="noter">&#13;
<p class="notet"><strong>NOTE</strong></p>&#13;
<p class="notep"><em>Although the servo’s full range of motion is 180 degrees, we recommend keeping the</em> <em><code>write()</code></em> <em>value between 10 and 170 degrees, especially for servos with plastic gears. Overextending a servo’s range can do irreparable damage.</em></p>&#13;
</div>&#13;
<p class="indent">To move the servo again, just pass another number within the bounds of the servo’s range of motion (10–170) to the <code>write()</code> method and upload the sketch again. Play with your servo for a bit, passing in different values.</p>&#13;
<p class="indent">Okay, so you know how to get the servo to move just once. Now, here’s some code that really gets it moving. <a href="ch06.xhtml#ch06ex02">Listing 6-2</a> moves the control of the servo into a loop and repeats a motion.</p>&#13;
<p class="ex-caption"><span epub:type="pagebreak" id="page_165"/><a id="ch06ex02"/><strong>LISTING 6-2:</strong> Servo blink sketch</p>&#13;
<div class="pre">&#13;
<pre><span class="green1">#include</span>&lt;<span class="orange"><strong>Servo</strong></span>.h&gt;<br/><span class="orange"><strong>Servo</strong></span> myServo;<br/><span class="green">void</span> <span class="green1">setup</span>()<br/>{<br/>  myServo.<span class="orange">attach</span>(9);<br/>}<br/><br/><span class="green">void</span> <span class="green1">loop</span>()<br/>{<br/>  myServo.<span class="orange">write</span>(10);<br/>  <span class="orange">delay</span>(1000);<br/>  myServo.<span class="orange">write</span>(170);<br/>  <span class="orange">delay</span>(1000);<br/>}</pre>&#13;
</div>&#13;
<p class="indent">This piece of code is a servo version of the blink sketch from <a href="ch01.xhtml#ch01">Project 1</a>. The servo moves to 10 degrees, waits for 1 second, moves to 170 degrees, waits for 1 second, and then repeats. We fondly refer to this as “robot march,” because when you have 20+ people doing it at once, it sounds like a robot army marching to take over the world.</p>&#13;
<p class="indent">Wow! You’re on a roll here. But servos really become interesting when you can control the servo yourself, without having to reprogram it each time. It’s time to get the potentiometer involved.</p>&#13;
<h4 class="h4" id="ch06lev2sec6"><strong>Complete the Balance Beam Sketch</strong></h4>&#13;
<p class="noindent">For the final sketch, you’ll program the potentiometer to control the rotation of the servo. Modify your sketch as shown in <a href="ch06.xhtml#ch06ex03">Listing 6-3</a>:</p>&#13;
<p class="ex-caption"><a id="ch06ex03"/><strong>LISTING 6-3:</strong> Using the <code>map()</code> function to control a servo with a potentiometer</p>&#13;
<div class="pre">&#13;
<pre>  <span class="green1">#include</span>&lt;<span class="orange"><strong>Servo</strong></span>.h&gt;<br/>  <span class="orange"><strong>Servo</strong></span> myServo;<br/><span class="ent">➊</span> <span class="green">int</span> potVal;<br/>  <span class="green">int</span> anglePosition;<br/>  <span class="green">void</span> <span class="green1">setup</span>()<br/>  {<br/>    myServo.<span class="orange">attach</span>(9);<br/>  }<br/><br/>  <span class="green">void</span> <span class="green1">loop</span>()<br/>  {<br/>    potVal = <span class="orange">analogRead</span>(A0);<br/><span class="ent">➋</span>   anglePosition = <span class="orange">map</span>(potVal, 0, 1023, 10, 170);<br/>    myServo.<span class="orange">write</span>(anglePosition);<br/>    <span class="orange">delay</span>(20);<br/>}</pre>&#13;
</div>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_166"/>This sketch reads the value of the potentiometer, translates it into an angle value, and then writes that value to the servo. There are some new commands in here, so we’ll go over it step-by-step.</p>&#13;
<p class="indent">The top portion of this code looks just like the first two example listings. It includes the Servo library and creates a <code>Servo</code> object named <code>myServo</code>. It also declares two global variables <span class="ent">➊</span> named <code>potVal</code> and <code>anglePosition</code>. These variables will be used to store the raw value of the potentiometer and a calculated angle position for the servo, respectively.</p>&#13;
<p class="indent">In the <code>loop()</code> function, the variable <code>potVal</code> stores the raw analog-to-digital converter value from the <code>analogRead(A0)</code> function. As you turn the knob on the potentiometer, the voltage on the wiper pin will vary between 0 V and 5 V. Remember that <code>analogRead()</code> will convert a voltage from 0 V to 5 V to a number between 0 and 1,023. However, the values 0 to 1,023 aren’t very useful for controlling the servo. As we mentioned before, the servo needs to stay between 10 and 170 degrees.</p>&#13;
<p class="indent">Thankfully, Arduino has a built-in <code>map()</code> function that allows you to take one range of numbers and find the equivalent value in a different range. The variable <code>anglePosition</code> stores an angle position that is calculated from <code>potVal</code> using the <code>map()</code> function <span class="ent">➋</span>. The <code>map()</code> function uses five parameters: <code>map(input, fromLow, fromHigh, toLow, toHigh)</code>. In this example, it maps the value of <code>potVal</code> from the range of 0 to 1,023 to a new range of 10 to 170. This is a really nifty function in Arduino that makes scaling and translating between value ranges super easy!</p>&#13;
<p class="indent">The sketch also adds a short delay of 20 ms to give the servo enough time to move before it reads the potentiometer again. A 20 ms delay is the minimum delay that the servo needs. You may also recall that it’s the time period of the PWM signal that’s used to control the angle.</p>&#13;
<p class="indent">Once you have this sketch updated, upload it to your Arduino. Now when you turn the potentiometer, the servo moves with it. Pretty sweet! Next you’ll take your newfound superpower and build a balancing game out of it.</p>&#13;
<h3 class="h3" id="ch06lev1sec5"><span epub:type="pagebreak" id="page_167"/><strong>BUILD THE BALANCE BEAM</strong></h3>&#13;
<p class="noindent">With this cool way to control a servo, we thought it would be fun to create a desktop game. You’ll create a balance beam that you control using the potentiometer and servo. A ping-pong ball will roll on the balance beam, and your goal is to get the ball as close as possible to the ends of the beam without it falling off.</p>&#13;
<h4 class="h4" id="ch06lev2sec7"><strong>Cut Out the Parts</strong></h4>&#13;
<p class="noindent">Download the template provided at <em><a href="https://www.nostarch.com/arduinoinventor/">https://www.nostarch.com/arduinoinventor/</a></em> (shown in <a href="ch06.xhtml#ch06fig16">Figure 6-16</a>), print it out, and then trace it onto your cardboard. We designed this project to fit on as small a piece of cardboard as we could.</p>&#13;
<p class="figuret"><a id="ch06fig16"/><strong>FIGURE 6-16:</strong> Balance Beam frame template (not full size)</p>&#13;
<div class="image"><img alt="Image" src="../images/fig6_16.jpg"/></div>&#13;
<p class="indent">Using a craft knife, cut all the solid lines along the perimeter of each shape, as well as the cut-out for the motor mount. Don’t score any of the pieces just yet; you’ll do that as you go along. Remember to exercise safety when cutting. Use a metal ruler and a sharp craft knife, as shown in <a href="ch06.xhtml#ch06fig17">Figure 6-17</a>, and take your time. Use a drill or a craft knife to make the six different holes in this design. If you’re using a drill, you’ll need a 1/4-inch drill bit for the screwdriver access hole, a 1/8-inch drill bit for the axle holes, and a 1/16-inch drill bit for the armature mount hole and the two motor mount holes.</p>&#13;
<p class="figuret"><span epub:type="pagebreak" id="page_168"/><a id="ch06fig17"/><strong>FIGURE 6-17:</strong> Cutting out the frame pieces from the template</p>&#13;
<div class="image"><img alt="Image" src="../images/fig6_17.jpg"/></div>&#13;
<p class="indent">Once you’ve finished cutting, you should have six pieces like those shown in <a href="ch06.xhtml#ch06fig18">Figure 6-18</a>.</p>&#13;
<p class="figuret"><a id="ch06fig18"/><strong>FIGURE 6-18:</strong> All cardboard parts cut out</p>&#13;
<div class="image"><img alt="Image" src="../images/fig6_18.jpg"/></div>&#13;
<h4 class="h4" id="ch06lev2sec8"><strong>Build the Beam</strong></h4>&#13;
<p class="noindent">Take the longest piece, which will be the actual beam, and carefully score the dotted line that runs along its length. This will allow you to curve the beam so that it cradles the ball. We designed the template so that the beam is 11 inches long, the length of a standard sheet of 8.5 × 11-inch paper.</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_169"/>Next, prepare the armature mount. This is a small trapezoidal piece about 2 1/4 inches wide by 1 inch tall. You will use this piece to connect the servo motor to the beam. Score it and bend it into a right angle, as shown in <a href="ch06.xhtml#ch06fig19">Figure 6-19</a>.</p>&#13;
<p class="figuret"><a id="ch06fig19"/><strong>FIGURE 6-19:</strong> Preparing the armature mount</p>&#13;
<div class="image"><img alt="Image" src="../images/fig6_19.jpg"/></div>&#13;
<p class="indent">Next, cut down the drinking straw so that it’s 1 3/4 inches long, and glue it down along the center line of the beam, as shown in <a href="ch06.xhtml#ch06fig20">Figure 6-20</a>.</p>&#13;
<p class="figuret"><a id="ch06fig20"/><strong>FIGURE 6-20:</strong> Gluing down the straw at the midpoint of the beam</p>&#13;
<div class="image"><img alt="Image" src="../images/fig6_20.jpg"/></div>&#13;
<p class="indent">Now, glue down the half of the armature mount without the drilled hole. This goes just to the left of the drinking straw, as shown in <a href="ch06.xhtml#ch06fig21">Figure 6-21</a>; make sure the half with the hole is facing you when the straw is at the right. This is important so that it fits with the servo mounting arm.</p>&#13;
<p class="figuret"><span epub:type="pagebreak" id="page_170"/><a id="ch06fig21"/><strong>FIGURE 6-21:</strong> Gluing the armature mount to the beam</p>&#13;
<div class="image"><img alt="Image" src="../images/fig6_21.jpg"/></div>&#13;
<p class="indent">Next, bend the sides of the beam up to form a cradle that will hold the ball, as shown in <a href="ch06.xhtml#ch06fig22">Figure 6-22</a>.</p>&#13;
<p class="figuret"><a id="ch06fig22"/><strong>FIGURE 6-22:</strong> Bending the sides of the beam to form a cradle</p>&#13;
<div class="image"><img alt="Image" src="../images/fig6_22.jpg"/></div>&#13;
<p class="indent">Use the smaller trapezoidal pieces to secure the ends of the beam and hold the beam together to keep the shape of the cradle. We suggest using a hot glue gun so that the pieces are secure, like in <a href="ch06.xhtml#ch06fig23">Figure 6-23</a>.</p>&#13;
<p class="figuret"><a id="ch06fig23"/><strong>FIGURE 6-23:</strong> Gluing the end pieces onto the beam</p>&#13;
<div class="image"><img alt="Image" src="../images/fig6_23.jpg"/></div>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_171"/>Next, use the wire cutters to cut down the bamboo skewer to about 3 1/4 inches. We suggest using the blunt end of the skewer. Insert the bamboo skewer into the drinking straw to form the axle for the balance beam (<a href="ch06.xhtml#ch06fig24">Figure 6-24</a>).</p>&#13;
<p class="figuret"><a id="ch06fig24"/><strong>FIGURE 6-24:</strong> Positioning the cut bamboo skewer so that it sticks out evenly on both sides</p>&#13;
<div class="image"><img alt="Image" src="../images/fig6_24.jpg"/></div>&#13;
<h4 class="h4" id="ch06lev2sec9"><strong>Build the Base and Attach the Servo</strong></h4>&#13;
<p class="noindent">Now you’ll build the base of the balance beam. Score the sides of the base pieces, as shown in <a href="ch06.xhtml#ch06fig25">Figure 6-25</a>, so that you can bend them into shape.</p>&#13;
<p class="figuret"><a id="ch06fig25"/><strong>FIGURE 6-25:</strong> Scoring the sides of the base pieces</p>&#13;
<div class="image"><img alt="Image" src="../images/fig6_25.jpg"/></div>&#13;
<p class="indent">After scoring, bend the sides to form a U shape as shown in <a href="ch06.xhtml#ch06fig26">Figure 6-26</a>. Repeat this for both pieces.</p>&#13;
<p class="figuret"><span epub:type="pagebreak" id="page_172"/><a id="ch06fig26"/><strong>FIGURE 6-26:</strong> Bending the sides</p>&#13;
<div class="image"><img alt="Image" src="../images/fig6_26.jpg"/></div>&#13;
<p class="indent">Before gluing together the base, you’ll mount the servo motor. Remove the servo motor from the breadboard circuit. There is a small, square cutout in one of the templates that should match the submicro-sized servo perfectly. Insert the servo so that the motor is facing inward, as shown in <a href="ch06.xhtml#ch06fig27">Figure 6-27</a>.</p>&#13;
<p class="figuret"><a id="ch06fig27"/><strong>FIGURE 6-27:</strong> Inserting the servo motor</p>&#13;
<div class="image"><img alt="Image" src="../images/fig6_27.jpg"/></div>&#13;
<p class="indent">Your servo should have come with three small screws, one short and the other two longer. Use the two longer screws to secure the servo motor in place, like in <a href="ch06.xhtml#ch06fig28">Figure 6-28</a>. If you don’t have screws, you can also use a small amount of hot glue to secure the motor.</p>&#13;
<p class="figuret"><span epub:type="pagebreak" id="page_173"/><a id="ch06fig28"/><strong>FIGURE 6-28:</strong> Securing the servo motor in place using the two longer screws</p>&#13;
<div class="image"><img alt="Image" src="../images/fig6_28.jpg"/></div>&#13;
<p class="indent">Now, select a servo horn that’s about 0.5 inches long and single sided. Gently push this into place on the end of the servo motor, as shown in <a href="ch06.xhtml#ch06fig29">Figure 6-29</a>. Once you have it securely on the servo, orient the servo to 0 degrees. Gently rotate the servo counterclockwise with your fingers until it stops. You’ll hear the little gears inside the servo turn. Make sure that you move the servo slowly; the gears are often made of plastic and can break.</p>&#13;
<p class="figuret"><a id="ch06fig29"/><strong>FIGURE 6-29:</strong> Attaching the single-sided servo horn</p>&#13;
<div class="image"><img alt="Image" src="../images/fig6_29.jpg"/></div>&#13;
<p class="indent">With the servo horn rotated as far as it can go counterclockwise, remove the horn and reposition it so that it is pointed straight up, as shown in <a href="ch06.xhtml#ch06fig30">Figure 6-30</a>. This will make it easier to connect the linkage to the beam.</p>&#13;
<p class="figuret"><span epub:type="pagebreak" id="page_174"/><a id="ch06fig30"/><strong>FIGURE 6-30:</strong> Servo horn aligned at 0 degrees</p>&#13;
<div class="image"><img alt="Image" src="../images/fig6_30.jpg"/></div>&#13;
<p class="indent">Finally, secure the horn in place using the last small screw that comes with the servo to ensure that the horn does not accidentally pop out. The horn may turn as you tighten the screw. This is okay—it won’t damage anything, but you may want to hold the servo horn in place with your fingers when tightening the screw to keep the horn from rotating. If you lost the screw, it’s not a big deal; you can leave it out and just reattach the horn if it does slip out. If you have to reposition the servo arm, you’ll need to remove this screw, which is why we included a hole on the other side of the base template.</p>&#13;
<p class="indent">Next, you need a linkage to connect the servo horn to the beam. To make this, you’ll shape a medium-size paper clip with a pair of needle-nose pliers. <a href="ch06.xhtml#ch06fig31">Figure 6-31</a> shows all the steps of this process.</p>&#13;
<p class="figuret"><a id="ch06fig31"/><strong>FIGURE 6-31:</strong> The steps to cutting, bending, and shaping the servo linkage</p>&#13;
<div class="image"><img alt="Image" src="../images/fig6_31.jpg"/></div>&#13;
<p class="olist"><strong>1.</strong> Use the pliers to straighten the paper clip out, leaving all but the small hook on one end.</p>&#13;
<p class="olist"><strong>2.</strong> Trim the paper clip down so that it is about 2 inches long from one end to the other.</p>&#13;
<p class="olist"><span epub:type="pagebreak" id="page_175"/><strong>3.</strong> Bend the straight end of the paper clip away from the hook at about 1 1/2 inches from the hooked end.</p>&#13;
<p class="olist"><strong>4.</strong> Add the final bend to create another hook about 3/8 inches deep. When complete, the servo linkage should be about 1 1/2 inches long (<a href="ch06.xhtml#ch06fig32">Figure 6-32</a>). This length is perfect given the geometry of our template. If you’re designing your own enclosure, you might have to play around with this length a bit to get the servo horn connected to the beam properly.</p>&#13;
<p class="figuret"><a id="ch06fig32"/><strong>FIGURE 6-32:</strong> Final bend in the paper clip linkage</p>&#13;
<div class="image"><img alt="Image" src="../images/fig6_32.jpg"/></div>&#13;
<h4 class="h4" id="ch06lev2sec10"><strong>Final Assembly</strong></h4>&#13;
<p class="noindent">Now for the final assembly! First, glue together the two base pieces. Glue two of the square tabs together, starting with the side opposite the servo motor (<a href="ch06.xhtml#ch06fig33">Figures 6-33</a> and <a href="ch06.xhtml#ch06fig34">6-34</a>). This will give you room to get your hands in there and connect the servo horn linkage.</p>&#13;
<p class="figuret"><a id="ch06fig33"/><strong>FIGURE 6-33:</strong> The best way to adhere two pieces together is to use a snake or S-shaped pattern with the glue.</p>&#13;
<div class="image"><img alt="Image" src="../images/fig6_33.jpg"/></div>&#13;
<p class="figuret"><span epub:type="pagebreak" id="page_176"/><a id="ch06fig34"/><strong>FIGURE 6-34:</strong> Secure the far side of the base first.</p>&#13;
<div class="image"><img alt="Image" src="../images/fig6_34.jpg"/></div>&#13;
<p class="indent">With the servo side open, take the original hooked end of the bent paper clip linkage and hook it through the last hole on the servo horn, as shown in <a href="ch06.xhtml#ch06fig35">Figure 6-35</a>.</p>&#13;
<p class="figuret"><a id="ch06fig35"/><strong>FIGURE 6-35:</strong> Hooking the paper clip through the last hole in the servo horn</p>&#13;
<div class="image"><img alt="Image" src="../images/fig6_35.jpg"/></div>&#13;
<div class="sidebar">&#13;
<p class="sidebart"><span epub:type="pagebreak" id="page_177"/><strong>FOUR-BAR LINKAGES AND CONNECTING SERVOS TO DO COOL THINGS</strong></p>&#13;
<p class="noindent">The mechanism used to turn the rotational movement of the servo horn into the up-and-down movement of the balance beam is called a <em>four-bar linkage</em>. We designed this template so that the length of the linkage should be about 1 1/2 inches, and it assumes that the servo horn is 1/2 inch long. We used these measurements to calculate the movements of the servo and beam. If you’re picturing circles, arcs, pivot points, and a lot of crazy geometry, don’t worry: we’ve done all the hard stuff already. The following figure shows a four-bar linkage in action, with the linkage itself and the pivot of the beam highlighted.</p>&#13;
<div class="image"><img alt="Image" src="../images/177fig01.jpg"/></div>&#13;
<p class="indent">Four-bar linkages are an amazing way of converting the rotation of an object (like the servo) into a different motion (like the up-and-down motion of the beam). Engineers and roboticists use these kinds of mechanisms and linkages all the time to make things move.</p>&#13;
</div>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_178"/>Hook the other end of the linkage through the hole in the armature mount, as shown in <a href="ch06.xhtml#ch06fig36">Figure 6-36</a>.</p>&#13;
<p class="figuret"><a id="ch06fig36"/><strong>FIGURE 6-36:</strong> Hooking the other end of the paper clip linkage to the armature mount</p>&#13;
<div class="image"><img alt="Image" src="../images/fig6_36.jpg"/></div>&#13;
<p class="indent">Now, insert the axle through one side of the base, carefully line up the second side, insert the axle through the matching hole, and glue the tabs at the other end of the base together (<a href="ch06.xhtml#ch06fig37">Figures 6-37</a> and <a href="ch06.xhtml#ch06fig38">6-38</a>).</p>&#13;
<p class="figuret"><a id="ch06fig37"/><strong>FIGURE 6-37:</strong> Mounting the balance beam to the base</p>&#13;
<div class="image"><img alt="Image" src="../images/fig6_37.jpg"/></div>&#13;
<p class="figuret"><span epub:type="pagebreak" id="page_179"/><a id="ch06fig38"/><strong>FIGURE 6-38:</strong> Completed Balance Beam project</p>&#13;
<div class="image"><img alt="Image" src="../images/fig6_38.jpg"/></div>&#13;
<p class="indent">Finally, connect the servo motor back to the breadboard circuit (<a href="ch06.xhtml#ch06fig39">Figure 6-39</a>). Power up your Arduino, and the servo motor should move into place. Turn the potentiometer and test to make sure that the linkage and the pivot points all move as expected. If they don’t, check that everything is still in place and nothing has fallen out.</p>&#13;
<p class="indent">As a final step, we suggest an extra rectangular base support piece. The base should measure about 2 × 3.75 inches. Insert this piece at the base of your enclosure to add extra support.</p>&#13;
<p class="figuret"><a id="ch06fig39"/><strong>FIGURE 6-39:</strong> Reconnecting the servo motor to the breadboard circuit</p>&#13;
<div class="image"><img alt="Image" src="../images/fig6_39.jpg"/></div>&#13;
<p class="indent">With that, your project is complete! Now, find a ping-pong ball or marble and test your skills of control and precision. You now have a game to play when you should be doing something a little more productive. How many times can you roll the ball back and forth before dropping it? Challenge a friend, and see who’s better!</p>&#13;
<h3 class="h3" id="ch06lev1sec6"><span epub:type="pagebreak" id="page_180"/><strong>GOING FURTHER</strong></h3>&#13;
<p class="noindent">This project is a great introduction to the world of servos and libraries in Arduino. There’s a lot of potential here, so we would like to share some launching points for you to play with servos.</p>&#13;
<h4 class="h4" id="ch06lev2sec11"><strong>Hack</strong></h4>&#13;
<p class="noindent">Swap out the potentiometer with the light sensor circuit from <a href="ch05.xhtml#ch05">Project 5</a>. You’ll have to include a 10 kΩ resistor and adjust the scaling values you use. Now, move your hand up and down above the light sensor to control the ball. Go challenge a friend! Are you better with the light sensor or the potentiometer?</p>&#13;
<h4 class="h4" id="ch06lev2sec12"><strong>Modify</strong></h4>&#13;
<p class="noindent">You can add an “autopilot” mode for your Balance Beam that will balance the ball on its own. To do this, you’re going to add a switch to your circuit. As you saw in <a href="ch05.xhtml#ch05">Project 5</a>, a switch is similar to a push button in that it makes or breaks a connection in a circuit, but in a switch the connection stays in place until it is switched again. The switch you’ll use is called a <em>single-pole, double-throw (SPDT)</em> switch, shown in <a href="ch06.xhtml#ch06fig40">Figure 6-40</a>. This is a fancy way of saying there’s a single common pin and two options that it can be connected to. When the switch is in the leftmost position, it connects the center pin and the left pin. When the switch is in the rightmost position, it connects the center pin and the right pin.</p>&#13;
<p class="figuret"><a id="ch06fig40"/><strong>FIGURE 6-40:</strong> The single-pole, double-throw switch</p>&#13;
<div class="image"><img alt="Image" src="../images/fig6_40.jpg"/></div>&#13;
<p class="indent">This switch, when wired correctly, will act as an on-off switch, allowing you to read whether it is set on 5 V or ground. Place the switch in the breadboard, making sure each leg gets its own row of holes. We placed ours at the top of the breadboard in <a href="ch06.xhtml#ch06fig41">Figure 6-41</a>. As with the potentiometer, connect the two outer pins of the switch to the 5 V and ground power rails of the breadboard using two shorter jumper wires. Use a third jumper wire to connect the center pin of the switch to pin 12 of the Arduino. A complete diagram of this circuit is shown in <a href="ch06.xhtml#ch06fig41">Figure 6-41</a>.</p>&#13;
<p class="figuret"><span epub:type="pagebreak" id="page_181"/><a id="ch06fig41"/><strong>FIGURE 6-41:</strong> The final circuit with the mode selection switch</p>&#13;
<div class="image"><img alt="Image" src="../images/fig6_41.jpg"/></div>&#13;
<p class="indent">The center pin is the signal pin and will read either <code>HIGH</code> or <code>LOW</code> depending on the position of the switch. You’ll use this paired with some basic logic to switch between manual control, which uses the potentiometer, and autopilot, which sets the servo to move back and forth on its own.</p>&#13;
<p class="indent">From the book’s resources at <em><a href="https://www.nostarch.com/arduinoinventor/">https://www.nostarch.com/arduinoinventor/</a></em>, upload the <em>P6_AutoBalanceBeam.ino</em> sketch to your Arduino. Take a look at the comments in the sketch to see how it works.</p>&#13;
<p class="indent">Remember that if the beam’s not centered when you switch autopilot on, the ball will likely fall off. It may take a few tries, but when you get it, it looks like magic! Take a look at a video of ours running here: <em><a href="https://www.nostarch.com/arduinoinventor/">https://www.nostarch.com/arduinoinventor/</a></em>.</p>&#13;
</body></html>