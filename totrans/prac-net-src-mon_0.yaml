- en: '**Yes, skip network configuration!** , as shown in Figure 3-16\.'
  id: totrans-0
  prefs: []
  type: TYPE_NORMAL
  zh: '**是的，跳过网络配置！**，如图 3-16 所示\。'
- en: '*Figure 3-16: Skipping network configuration*'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: '*图 3-16：跳过网络配置*'
- en: To simplify setup for this first example, choose the Quick Setup option,
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 为了简化第一次示例的设置，选择快速设置选项，
- en: as shown in Figure 3-17\. This will have the server running SO as a stand-
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 如图 3-17 所示。这样服务器将作为一个独立
- en: alone system with minimum configuration.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 独立系统，配置最小。
- en: '*Figure 3-17: Choosing Quick Setup*'
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: '*图 3-17：选择快速设置*'
- en: You will need to tell SO the interface for some of its components to
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 你需要告诉 SO 一些组件的接口
- en: mon itor. As shown in Figure 3-18, I tell SO that I want Snort to sniff traffic
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 监控。如图 3-18 所示，我告诉 SO 我希望 Snort 在 eth1 上嗅探流量
- en: on eth1\. (As part of Quick Setup, SO chooses to use the Snort network IDS
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 在 eth1 上。 (作为快速设置的一部分，SO 选择使用 Snort 网络 IDS
- en: to generate alert data.)
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 用于生成警报数据。)
- en: Now provide a username for accessing the NSM software component
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 现在提供一个用户名，用于访问 NSM 软件组件
- en: Sguil (covered in Chapter 8), as shown in Figure 3-19\. SO will use this
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: Sguil（在第 8 章中讨论），如图 3-19 所示。SO 将使用此
- en: username for several other NSM tools.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 多个 NSM 工具的用户名。
- en: '**68** Chapter 3'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: '**68** 第 3 章'
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
- en: '![Image 38](index-103_1.jpg)'
  id: totrans-15
  prefs: []
  type: TYPE_IMG
  zh: '![Image 38](index-103_1.jpg)'
- en: '![Image 39](index-103_2.jpg)'
  id: totrans-16
  prefs: []
  type: TYPE_IMG
  zh: '![Image 39](index-103_2.jpg)'
- en: '![Image 40](index-103_3.jpg)'
  id: totrans-17
  prefs: []
  type: TYPE_IMG
  zh: '![Image 40](index-103_3.jpg)'
- en: '![Image 41](index-103_4.jpg)'
  id: totrans-18
  prefs: []
  type: TYPE_IMG
  zh: '![Image 41](index-103_4.jpg)'
- en: '*Figure 3-18: Tel ing SO where Snort*'
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: '*图 3-18：告诉 SO 使用 Snort*'
- en: '*Figure 3-19: Entering a Sguil username*'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: '*图 3-19：输入 Sguil 用户名*'
- en: '*should sniff*'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: '*应嗅探*'
- en: At the next screen, enter an email address for SO to use for logging
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一个屏幕上，输入一个供 SO 用于日志记录的电子邮件地址
- en: into the Snorby NSM console and authenticating users. (SO will not use
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 进入 Snorby NSM 控制台并验证用户。（SO 不会使用
- en: this email address to send spam to you! In fact, the SO project does not
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 此电子邮件地址不会向你发送垃圾邮件！事实上，SO 项目并不
- en: track users in any way.) Snorby (also covered in Chapter 8) is a tool for pre-
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 以任何方式跟踪用户。）Snorby（也在第 8 章中讨论）是一个用于预先
- en: senting NSM data to analysts, and it uses a separate authentication mecha-
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 向分析师呈现 NSM 数据，它使用单独的身份验证机制
- en: nism based on email addresses.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 基于电子邮件地址的身份验证。
- en: Now you’ll choose an alphanumeric password for use in authenticat-
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 现在你将选择一个字母数字密码，用于验证
- en: ing to NSM software installed with SO, as shown in Figure 3-20\. (You can
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 运行 SO 的 NSM 软件， 如图 3-20 所示。（你可以
- en: change this password later through the Sguil and Snorby interfaces.)
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 稍后通过 Sguil 和 Snorby 界面更改此密码。）
- en: '*Figure 3-20: Entering a password for SO NSM applications*'
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: '*图 3-20：为 SO NSM 应用输入密码*'
- en: After you create credentials for SO NSM applications, the configu-
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 在你为 SO NSM 应用创建凭证后，配置
- en: ration script asks if you want to install the Enterprise Log Search and
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 脚本会询问你是否要安装企业日志搜索与
- en: Archive (ELSA) software, as shown in Figure 3-21\. Choose **Yes, enable**
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 存档（ELSA）软件，如图 3-21 所示。选择 **是的，启用**
- en: '**ELSA!** unless you are working with very constrained hardware. ELSA'
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: '**ELSA!** 除非你使用的是硬件资源非常有限的系统。ELSA'
- en: provides a search engine interface to NSM log data.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 提供一个搜索引擎接口，用于 NSM 日志数据。
- en: '*Figure 3-21: Choosing to enable ELSA*'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: '*图 3-21：选择启用 ELSA*'
- en: Stand-alone NSM Deployment and Installation **69**
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 独立 NSM 部署与安装 **69**
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
- en: '![Image 42](index-104_1.jpg)'
  id: totrans-40
  prefs: []
  type: TYPE_IMG
  zh: '![Image 42](index-104_1.jpg)'
- en: '![Image 43](index-104_2.jpg)'
  id: totrans-41
  prefs: []
  type: TYPE_IMG
  zh: '![Image 43](index-104_2.jpg)'
- en: '![Image 44](index-104_3.jpg)'
  id: totrans-42
  prefs: []
  type: TYPE_IMG
  zh: '![Image 44](index-104_3.jpg)'
- en: SO should now summarize the changes it is about to make. If you like
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: SO 现在应该总结它即将进行的更改。如果你喜欢
- en: the results, select **Yes, proceed with the changes!** , as shown in Figure
    3-22\.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 结果，选择 **是的，继续更改！**，如图 3-22 所示\。
- en: '*Figure 3-22: SO is ready to proceed with changes.*'
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: '*图 3-22：SO 已准备好继续更改。*'
- en: Next, SO configures the system’s time zone to use UTC, and then sets
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，SO 配置系统的时区为 UTC，然后设置
- en: up all the NSM applications packaged with it. When finished, it should
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 完成时，它应该会启动所有与之捆绑的 NSM 应用。
- en: report some helpful information about your system. You can check the sta-
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 报告一些有关系统的有用信息。你可以在 */var/log/nsm/sosetup.log* 文件中检查设置状态，如图 3-23 所示\。
- en: tus of the setup in the */var/log/nsm/sosetup.log* file, as shown in Figure
    3-23\.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 安装状态
- en: Finally, you’ll see information on IDS rule management, as shown in
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，你将看到有关 IDS 规则管理的信息，如下所示
- en: Figure 3-24\.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 图 3-24\。
- en: '*Figure 3-23: SO setup is now complete.*'
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: '*图 3-23：SO 设置已完成。*'
- en: '*Figure 3-24: Notes concerning IDS rule*'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: '*图 3-24：关于 IDS 规则的说明*'
- en: '*management*'
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: '*管理*'
- en: '***Checking Your Instal ation***'
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: '***检查你的安装***'
- en: Once you’ve finished installing your stand-alone system, you should take
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 完成独立系统安装后，你应该进行一些
- en: some steps to make sure that it’s functioning as expected.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 执行一些步骤，确保其按预期运行。
- en: '**70** Chapter 3'
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: '**70** 第3章'
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
- en: First, open a terminal and run the following command to see if all the NSM agents
    are live. Remember that you run a terminal by executing the
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，打开终端并运行以下命令以查看所有NSM代理是否正常运行。记得通过执行
- en: Terminal application on the desktop.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 桌面上的终端应用程序。
- en: $ **sudo service nsm status**
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: $ **sudo service nsm status**
- en: '[sudo] password for sademo:'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: '[sudo] 输入sademo的密码：'
- en: 'Status: securityonion'
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 状态：securityonion
- en: '* sguil server [ OK ]'
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: '* sguil server [ OK ]'
- en: 'Status: HIDS'
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 状态：HIDS
- en: '* ossec_agent (sguil) [ OK ]'
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: '* ossec_agent (sguil) [ OK ]'
- en: 'Status: Bro'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 状态：Bro
- en: Name Type Host Status Pid Peers Started
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 名称 类型 主机 状态 Pid 对等节点 启动时间
- en: bro standalone localhost running 5813 0 10 Feb 11:10:32
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: bro独立本地主机正在运行 5813 0 10月11日 11:10:32
- en: 'Status: sademo-eth1'
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 状态：sademo-eth1
- en: '* netsniff-ng (full packet data) [ OK ]'
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: '* netsniff-ng (完整数据包) [ OK ]'
- en: '* pcap_agent (sguil) [ OK ]'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: '* pcap_agent (sguil) [ OK ]'
- en: '* snort_agent-1 (sguil) [ OK ]'
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: '* snort_agent-1 (sguil) [ OK ]'
- en: '* snort-1 (alert data) [ OK ]'
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: '* snort-1 (警报数据) [ OK ]'
- en: '* barnyard2-1 (spooler, unified2 format) [ OK ]'
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: '* barnyard2-1 (spooler，unified2格式) [ OK ]'
- en: '* prads (sessions/assets) [ OK ]'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: '* prads (会话/资产) [ OK ]'
- en: '* sancp_agent (sguil) [ OK ]'
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: '* sancp_agent (sguil) [ OK ]'
- en: '* pads_agent (sguil) [ OK ]'
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: '* pads_agent (sguil) [ OK ]'
- en: '* argus [ OK ]'
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: '* argus [ OK ]'
- en: '* http_agent (sguil) [ OK ]'
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: '* http_agent (sguil) [ OK ]'
- en: Now, in the same window, run the following command to generate
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，在同一窗口中运行以下命令生成
- en: activity that will trigger a Snort alert. I’m assuming that your sensor can
    see
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 活动将触发Snort警报。我假设你的传感器能够看到
- en: traffic to and from the stand-alone system’s management port. If not, run
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 到独立系统管理端口的流量。如果没有，请运行
- en: this command from a system monitored by the new sensor, or visit the URL
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 这个命令来自一个由新传感器监控的系统，或者访问URL
- en: with a web browser on a system monitored by the new sensor.
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 在由新传感器监控的系统上使用Web浏览器。
- en: '**$ curl www.testmyids.com**'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: '**$ curl www.testmyids.com**'
- en: uid=0(root) gid=0(root) groups=0(root)
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: uid=0(root) gid=0(root) groups=0(root)
- en: To determine if at least part of your NSM setup is working, visit the
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 为了确定你的NSM设置是否部分正常工作，访问
- en: Snorby NSM application using a web browser. Point your web browser to
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 使用Web浏览器访问Snorby NSM应用程序。将Web浏览器指向
- en: the IP address of your stand-alone sensor that you assigned earlier. You will
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 你之前分配给独立传感器的IP地址。你将看到
- en: receive an error saying the certificate for HTTPS is not trusted because
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 收到一个错误，表示HTTPS证书不被信任，因为
- en: it is not signed, as shown in Figure 3-25\. Unless you suspect that an inter-
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 它没有签名，如图3-25所示。除非你怀疑有中间人攻击，
- en: nal user is conducting a man-in-the-middle attack against you, it is safe to
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 普通用户正在对你进行中间人攻击时，如果确认安全，可以
- en: choose **Proceed Anyway** or the equivalent. (If you later choose to deploy
    a
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 选择**继续执行**或等效选项。（如果你稍后选择部署
- en: certificate trusted by the browser, you will not see these warnings.)
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 如果浏览器信任该证书，你将不会看到这些警告。
- en: You will now see the SO welcome page, as shown in Figure 3-26, with
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 现在你将看到SO欢迎页面，如图3-26所示，内容如下：
- en: links to SO applications accessible via the web servers running on the SO
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 访问SO应用程序的链接通过SO上运行的Web服务器可用
- en: system. Click the link for Snorby to determine if it captured data triggered
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 系统。点击Snorby链接以确定是否捕获到数据触发的
- en: by visiting *http://www.testmyids.com/*.
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 通过访问*http://www.testmyids.com/*。
- en: Stand-alone NSM Deployment and Installation **71**
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 独立NSM部署和安装 **71**
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
- en: '![Image 45](index-106_1.png)'
  id: totrans-103
  prefs: []
  type: TYPE_IMG
  zh: '![Image 45](index-106_1.png)'
- en: '![Image 46](index-106_2.jpg)'
  id: totrans-104
  prefs: []
  type: TYPE_IMG
  zh: '![Image 46](index-106_2.jpg)'
- en: '*Figure 3-25: Certificate warning*'
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: '*图3-25：证书警告*'
- en: '*Figure 3-26: SO welcome page*'
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: '*图3-26：SO欢迎页面*'
- en: Clicking the Snorby link should open a new tab or window to your SO
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 点击Snorby链接应打开SO系统的一个新标签页或窗口。
- en: IP address and port 444\. Snorby should ask for the email address and pass-
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: IP地址和端口444。Snorby应该会要求输入电子邮件地址和密码
- en: word you chose during setup, as shown in Figure 3-27\. Enter them and click
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 你在设置时选择的单词，如图3-27所示。输入这些信息并点击
- en: '**Welcome, Sign In**.'
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: '**欢迎，登录**。'
- en: '**72** Chapter 3'
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: '**72** 第3章'
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
- en: '![Image 47](index-107_1.jpg)'
  id: totrans-113
  prefs: []
  type: TYPE_IMG
  zh: '![Image 47](index-107_1.jpg)'
- en: '![Image 48](index-107_2.jpg)'
  id: totrans-114
  prefs: []
  type: TYPE_IMG
  zh: '![Image 48](index-107_2.jpg)'
- en: '*Figure 3-27: Snorby login screen*'
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: '*图3-27：Snorby登录界面*'
- en: Depending on where you deployed your sensor and the amount of
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 根据你部署传感器的位置和网络上活跃的
- en: traffic active on the network, you will see different amounts of infor-
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 网络上活跃的流量，你将看到不同量的信息
- en: mation on the initial dashboard. We’re interested in seeing two specific
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: '初始仪表板上的信息。我们希望看到两个特定的  '
- en: 'alerts at the right side of the screen: either ET Policy curl User-Agent or
    GPL'
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: '屏幕右侧的警报：要么是ET Policy curl User-Agent，要么是GPL  '
- en: ATTACK_RESPONSE id ch. If you see either or both (as shown in Figure 3-28),
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 'ATTACK_RESPONSE id ch。如果你看到其中任何一个或两个（如图3-28所示），  '
- en: your sensor is seeing traffic and at least one NSM application (in this case,
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: '你的传感器正在看到流量，并且至少有一个NSM应用程序（在此案例中，  '
- en: Snort) observed and reported it correctly.
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 'Snort）观察并正确报告了它。  '
- en: '*Figure 3-28: Snorby dashboard confirms stand-alone sensor operation.*'
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: '*图3-28：Snorby仪表板确认独立传感器操作。*  '
- en: Stand-alone NSM Deployment and Installation **73**
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: '独立NSM部署和安装 **73**  '
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: '[www.it-ebooks.info](http://www.it-ebooks.info/)  '
- en: '**conclusion**'
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: '**结论**'
- en: In this chapter, we created a stand-alone SO platform. We booted the SO
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: '在本章中，我们创建了一个独立的SO平台。我们启动了SO  '
- en: '*.iso* file and installed the Xubuntu Linux distribution to a hard drive. Next,
    we updated the operating system and began the process of installing the'
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: '*.iso*文件并将Xubuntu Linux发行版安装到硬盘上。接下来，我们更新了操作系统，并开始了安装过程  '
- en: SO software. We began by configuring the network interfaces, choosing
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 'SO软件。我们从配置网络接口开始，选择  '
- en: one for system management and the other for data collection or sniffing.
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: '一个用于系统管理，另一个用于数据收集或嗅探。  '
- en: With the network interfaces prepared, we turned to configuring a variety
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: '在准备好网络接口后，我们转向配置多种  '
- en: of SO tools via a helpful wizard process. Once all the software was installed
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: '通过一个有用的向导过程来安装SO工具。一旦所有软件安装完成  '
- en: and configured, we viewed the Snorby console to ensure it could see at least
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: '并配置完毕后，我们查看了Snorby控制台，确保它至少能够看到  '
- en: some data derived from the network.
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: '从网络中获取一些数据。  '
- en: In Chapter 4, we’ll advance from the world of the stand-alone platform
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: '在第4章中，我们将从独立平台的世界向前推进  '
- en: into one where distributed systems rule. Stand-alone platforms work well
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: '进入一个由分布式系统主导的世界。独立平台在  '
- en: for isolated deployments, but some of the power of the NSM model is appar-
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: '用于隔离部署，但NSM模型的某些功能在此显现  '
- en: ent only when analysts can interact with data from multiple vantage points.
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: '仅当分析师能够从多个角度与数据交互时，才会有效。  '
- en: Stand-alone platforms can sometimes watch more than one network seg-
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: '独立平台有时可以监视多个网络段  '
- en: ment if those segments are physically nearby. When monitored segments
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: '当监控段物理接近时表现良好。  '
- en: are geographically dispersed, a distributed deployment works best to unify
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: '如果系统地理位置分散，分布式部署能够最有效地统一  '
- en: collection and presentation of NSM data. Chapter 4 will show how to make
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 'NSM数据的收集和展示。第4章将展示如何使  '
- en: that a reality.
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: '使其成为现实。  '
- en: '**74** Chapter 3'
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: '**74** 第3章  '
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: '[www.it-ebooks.info](http://www.it-ebooks.info/)  '
- en: '**4**'
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: '**4**  '
- en: '**D i S T r i B u T e D D e P l oy M e N T**'
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: '**分 布 式 部 署**  '
- en: Chapter 3 discussed NSM platforms built
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: '第3章讨论了构建NSM平台  '
- en: on the open source SO project, focusing on
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: '基于开源SO项目，专注于  '
- en: how to install SO as a stand-alone platform.
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: '如何将SO安装为独立平台。  '
- en: Single-system solutions are a great starting point
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: '单系统解决方案是一个很好的起点  '
- en: for newcomers to the NSM world, but most organi-
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: '对于NSM世界的新手来说，这是一个很好的起点，但大多数组织  '
- en: zations have more than one network to manage and
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: '许多组织有多个网络需要管理，  '
- en: monitor. Based on what you learned in Chapters 2 and 3, you may recognize
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: '监视。根据你在第2章和第3章中学到的内容，你可能已经识别出  '
- en: locations in your environment where you need multiple sensors cooperat-
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: '在你的环境中需要多个传感器协同工作的位置  '
- en: ing to provide multisite visibility. Thankfully, as described in the previous
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: '提供多站点可视性。幸运的是，正如前面所述  '
- en: chapter, SO supports distributed deployment models (server-plus-sensor
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: '本章，SO支持分布式部署模型（服务器加传感器  '
- en: platforms) to accommodate these requirements.
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: '平台）以适应这些需求。  '
- en: In addition to covering distributed SO deployments, this chapter also
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: '除了涵盖分布式SO部署，本章还  '
- en: explains how to use SO Personal Package Archives (PPA) to build SO plat-
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: '解释了如何使用SO个人包存档（PPA）来构建SO平台  '
- en: forms without using the SO *.iso* image. Installing SO using the project’s official
    *.iso* file is probably the easiest way to get started, but some organizations
    prefer to begin with their own version of Ubuntu Linux. The SO project’s
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: '而不使用SO *.iso*镜像。使用项目的官方*.iso*文件安装SO可能是开始的最简单方法，但有些组织更倾向于从自己版本的Ubuntu Linux开始。SO项目的  '
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: '[www.it-ebooks.info](http://www.it-ebooks.info/)  '
- en: PPAs allow administrators to install SO packages on Ubuntu Linux-derived systems.
    You can install your own version of Ubuntu Linux, add SO PPAs,
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
- en: and then enjoy full SO functionality.
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
- en: We’ll begin by building a distributed SO setup.
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
- en: '**installing an So Server using the So .iso image**'
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
- en: If you followed the instructions in Chapter 3, you now have a stand-alone
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
- en: SO platform collecting and interpreting network traffic. More challenging
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
- en: situations require a server-plus-sensors deployment.
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
- en: As explained in Chapter 3, in a server-plus-sensors configuration, one
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
- en: or more sensors collect NSM data, and a server acts as the central “brain”
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
- en: for the operation, as well as an aggregation and storage point for certain
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
- en: types of NSM data. This section describes how to install an SO server. After
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
- en: setting up the server, we’ll install a sensor that will cooperate with the server
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
- en: to collect and present NSM data.
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
- en: '***SO Server Considerations***'
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
- en: When considering an SO server, remember that the server will be the cen-
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
- en: tral collection and storage point for certain types of NSM data. Keep the
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
- en: 'following in mind:'
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
- en: • An *SO server* operates a central MySQL database to which all SO sensors
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
- en: transmit session data. The aggregate session data is a key factor when
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
- en: considering RAM and hard drive requirements for the SO server.
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
- en: • An *SO sensor* stores network traffic as pcap files. The SO sensor stores
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
- en: this data locally until it’s copied to the SO server. This locally stored
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
- en: data is a key factor when considering hard drive requirements for the
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
- en: SO sensor.
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
- en: You also need to understand what data resides where and know how
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
- en: many sensors will likely contribute data to the server. You will need the
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
- en: 'following:'
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
- en: • A lot of hard drive space in a RAID configuration that you’ll use to
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
- en: store session and associated NSM data
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
- en: • At least 4GB of RAM, with more RAM available to satisfy MySQL’s needs
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
- en: • A multicore CPU
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
- en: • At least one network interface for management purposes
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
- en: Because the server is not connected to network taps or SPAN ports, you
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
- en: can think of it more as a traditional server system. Clients, like SO sensors
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
- en: or CIRT analysts, will connect to the SO server to access data. The number
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
- en: of clients accessing the server and the amount of centralized data you want
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
- en: available to them are the primary factors to consider when designing an SO
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
- en: server.
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
- en: '**76** Chapter 4'
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
- en: '![Image 49](index-111_1.jpg)'
  id: totrans-203
  prefs: []
  type: TYPE_IMG
- en: '**N o T e**'
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
- en: '*Some CIRTs choose to separate functions on their central servers. For example,
    they* *run separate database systems that cooperate with the central server. SO
    does not* *support this sort of configuration out-of-the-box. Therefore, we leave
    that sort of* *configuration out of this discussion. The configuration described
    here works well in* *production for many CIRTs.*'
  id: totrans-205
  prefs: []
  type: TYPE_NORMAL
- en: '***Building Your SO Server***'
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
- en: To build your server, boot the SO *.iso* image, choose **Live**, and wait until
    you see the SO desktop. Begin the installation process by clicking the Install
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
- en: Security Onion 12.04 icon. Follow the configuration process explained in
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: 安全洋葱12.04图标。按照配置过程中的说明操作
- en: '[“Installing SO to a Hard Drive” on page 62\.](index_split_001.html#p94) In
    summary, you will perform the following steps, as in the previous chapter:'
  id: totrans-209
  prefs: []
  type: TYPE_NORMAL
  zh: '[“安装 SO 到硬盘”在第62页](index_split_001.html#p94) 总结来说，您将执行以下步骤，和上一章相似：'
- en: 1\. Validate space, connectivity, updates, and third-party software.
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: 1\. 验证空间、连接、更新和第三方软件。
- en: 2\. Choose to erase the disk to install SO.
  id: totrans-211
  prefs: []
  type: TYPE_NORMAL
  zh: 2\. 选择擦除磁盘以安装SO。
- en: 3\. Choose a username, computer name, and password.
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: 3\. 选择用户名、计算机名和密码。
- en: 4\. Complete installation and reboot the system.
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
  zh: 4\. 完成安装并重启系统。
- en: 5\. Update installed software using **sudo apt-get update && sudo apt-get**
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: 5\. 使用**sudo apt-get update && sudo apt-get**更新已安装的软件
- en: '**dist-upgrade**.'
  id: totrans-215
  prefs: []
  type: TYPE_NORMAL
  zh: '**dist-upgrade**。'
- en: After completing this process, the SO software should be installed on
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: 完成此过程后，SO软件应已安装在
- en: the server, but nothing is configured for NSM duties. This is the point at
  id: totrans-217
  prefs: []
  type: TYPE_NORMAL
  zh: 服务器已安装，但尚未配置用于NSM的任务。此时
- en: which we turn the system into a live SO server.
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将系统转换为一个实时SO服务器。
- en: The first task is to manually assign a static IP address to the system. To
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
  zh: 第一个任务是手动为系统分配一个静态IP地址。
- en: 'do so, follow these steps:'
  id: totrans-220
  prefs: []
  type: TYPE_NORMAL
  zh: 按照以下步骤操作：
- en: 1\. Click the blue-and-white mouse icon at the upper-left side of the screen,
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
  zh: 1\. 点击屏幕左上角的蓝白色鼠标图标，
- en: select **Settings**, and then choose **Network Connections**, as shown in
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
  zh: 选择**设置**，然后选择**网络连接**，如图所示
- en: Figure 4-1\.
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
  zh: 图4-1\。
- en: '*Figure 4-1: Selecting to view set ings for Network Connections*'
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: '*图4-1：选择查看网络连接的设置*'
- en: Distributed Deployment **77**
  id: totrans-225
  prefs: []
  type: TYPE_NORMAL
  zh: 分布式部署 **77**
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-226
  prefs: []
  type: TYPE_NORMAL
  zh: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
- en: '![Image 50](index-112_1.jpg)'
  id: totrans-227
  prefs: []
  type: TYPE_IMG
  zh: '![图像 50](index-112_1.jpg)'
- en: 2\. Highlight **Wired connection 1**, and then click **Edit**. Click the **IPv4**
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
  zh: 2\. 高亮**有线连接1**，然后点击**编辑**。点击**IPv4**
- en: '**Settings** tab, and then change the Method to **Manual**. Enter values'
  id: totrans-229
  prefs: []
  type: TYPE_NORMAL
  zh: '**设置**选项卡中，然后将方法更改为**手动**。输入值'
- en: appropriate for your server by clicking **Add** and then entering the
  id: totrans-230
  prefs: []
  type: TYPE_NORMAL
  zh: 通过点击**添加**，然后输入适合您服务器的
- en: information required, as shown in Figure 4-2\. (These values represent
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
  zh: 输入所需的信息，如图4-2所示。（这些值代表
- en: choices appropriate for my sample network; be sure to use values that
  id: totrans-232
  prefs: []
  type: TYPE_NORMAL
  zh: 为我的示例网络选择合适的选项；确保使用与
- en: match your environment.)
  id: totrans-233
  prefs: []
  type: TYPE_NORMAL
  zh: 与您的环境匹配。）
- en: '*Figure 4-2: Configuring Wired connection 1 with*'
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: '*图4-2：配置有线连接1的*'
- en: '*static IP addressing*'
  id: totrans-235
  prefs: []
  type: TYPE_NORMAL
  zh: '*静态IP地址配置*'
- en: 3\. When you’re finished, click **Save**. The dialog will turn gray while the
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
  zh: 3\. 完成后，点击**保存**。对话框在过程中会变灰，直到
- en: system reconfigures networking.
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
  zh: 系统重新配置网络。
- en: 4\. Click **Close** to complete the process.
  id: totrans-238
  prefs: []
  type: TYPE_NORMAL
  zh: 4\. 点击**关闭**以完成此过程。
- en: 5\. Reboot the system.
  id: totrans-239
  prefs: []
  type: TYPE_NORMAL
  zh: 5\. 重启系统。
- en: At this point, the server is running the correct operating system, with
  id: totrans-240
  prefs: []
  type: TYPE_NORMAL
  zh: 此时，服务器正在运行正确的操作系统，
- en: updated components, and is reachable via a static management IP address.
  id: totrans-241
  prefs: []
  type: TYPE_NORMAL
  zh: 更新的组件，并可以通过静态管理IP地址访问。
- en: '***Configuring Your SO Server***'
  id: totrans-242
  prefs: []
  type: TYPE_NORMAL
  zh: '***配置您的SO服务器***'
- en: Now we can begin configuring the system as an SO server. To do so, follow
  id: totrans-243
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们可以开始将系统配置为SO服务器。为此，请按照以下步骤操作：
- en: 'these steps:'
  id: totrans-244
  prefs: []
  type: TYPE_NORMAL
  zh: 以下步骤：
- en: 1\. Click the **Setup** icon and enter your password to perform administra-
  id: totrans-245
  prefs: []
  type: TYPE_NORMAL
  zh: 1\. 点击**设置**图标并输入您的密码以执行管理
- en: tive tasks. Select **Yes, Continue!** when prompted.
  id: totrans-246
  prefs: []
  type: TYPE_NORMAL
  zh: 选择性任务。在提示时选择**是，继续！**。
- en: 2\. When asked if you want to configure interfaces, choose **No, not right now**.
  id: totrans-247
  prefs: []
  type: TYPE_NORMAL
  zh: 2\. 当询问是否要配置接口时，选择**否，暂时不配置**。
- en: 3\. When prompted, choose **Advanced Setup**.
  id: totrans-248
  prefs: []
  type: TYPE_NORMAL
  zh: 3\. 在提示时选择**高级设置**。
- en: '**78** Chapter 4'
  id: totrans-249
  prefs: []
  type: TYPE_NORMAL
  zh: '**78** 第4章'
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-250
  prefs: []
  type: TYPE_NORMAL
  zh: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
- en: '![Image 51](index-113_1.jpg)'
  id: totrans-251
  prefs: []
  type: TYPE_IMG
  zh: '![图像 51](index-113_1.jpg)'
- en: '![Image 52](index-113_2.jpg)'
  id: totrans-252
  prefs: []
  type: TYPE_IMG
  zh: '![图像 52](index-113_2.jpg)'
- en: 4\. The next screen asks what sort of system you want to build. Select **Server**,
    as shown in Figure 4-3, and then click **OK**.
  id: totrans-253
  prefs: []
  type: TYPE_NORMAL
  zh: 4\. 下一屏幕会询问您想要构建什么样的系统。选择**服务器**，如图4-3所示，然后点击**确定**。
- en: '*Figure 4-3: Choosing to build a server*'
  id: totrans-254
  prefs: []
  type: TYPE_NORMAL
  zh: '*图4-3：选择构建服务器*'
- en: 5\. Now choose between running the Snort or Suricata IDS engine. Select
  id: totrans-255
  prefs: []
  type: TYPE_NORMAL
  zh: 5\. 现在选择运行Snort或Suricata IDS引擎。选择
- en: the IDS engine you plan to run on your sensors, and then click **OK**.
  id: totrans-256
  prefs: []
  type: TYPE_NORMAL
  zh: 选择您计划在传感器上运行的IDS引擎，然后点击**确定**。
- en: 6\. When asked to choose an IDS ruleset, choose **Emerging Threats GPL**,
  id: totrans-257
  prefs: []
  type: TYPE_NORMAL
  zh: 6\. 当提示选择一个IDS规则集时，选择**Emerging Threats GPL**，
- en: as shown in Figure 4-4\. (The Emerging Threats ruleset is free and per-
  id: totrans-258
  prefs: []
  type: TYPE_NORMAL
  zh: 如图4-4所示。（Emerging Threats规则集是免费的，并且
- en: fect for our purposes.)
  id: totrans-259
  prefs: []
  type: TYPE_NORMAL
  zh: 适合我们用途的配置。）
- en: '*Figure 4-4: Choosing the Emerging Threats GPL ruleset*'
  id: totrans-260
  prefs: []
  type: TYPE_NORMAL
  zh: '*图4-4：选择Emerging Threats GPL规则集*'
- en: 7\. The setup wizard asks for a Sguil username, Snorby email address, and
  id: totrans-261
  prefs: []
  type: TYPE_NORMAL
- en: password. Enter the responses appropriate for your environment. When
  id: totrans-262
  prefs: []
  type: TYPE_NORMAL
- en: asked if you want to enable ELSA, choose **Yes, enable ELSA!** . The setup
  id: totrans-263
  prefs: []
  type: TYPE_NORMAL
- en: wizard summarizes your choices and asks if you’re ready to proceed, as
  id: totrans-264
  prefs: []
  type: TYPE_NORMAL
- en: shown in Figure 4-5\.
  id: totrans-265
  prefs: []
  type: TYPE_NORMAL
- en: Distributed Deployment **79**
  id: totrans-266
  prefs: []
  type: TYPE_NORMAL
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-267
  prefs: []
  type: TYPE_NORMAL
- en: '![Image 53](index-114_1.jpg)'
  id: totrans-268
  prefs: []
  type: TYPE_IMG
- en: '*Figure 4-5: Setup summary before proceeding with SO server changes*'
  id: totrans-269
  prefs: []
  type: TYPE_NORMAL
- en: 8\. Click **Yes, proceed with the changes!** , and the setup wizard will com-
  id: totrans-270
  prefs: []
  type: TYPE_NORMAL
- en: plete the SO server installation. The script should report that the setup
  id: totrans-271
  prefs: []
  type: TYPE_NORMAL
- en: is complete.
  id: totrans-272
  prefs: []
  type: TYPE_NORMAL
- en: 9\. To confirm that installation succeeded, visit the web page hosted on the
  id: totrans-273
  prefs: []
  type: TYPE_NORMAL
- en: server, and then access a web-enabled NSM application, such as Snorby.
  id: totrans-274
  prefs: []
  type: TYPE_NORMAL
- en: At this point, you have only an SO server active. It is not running any
  id: totrans-275
  prefs: []
  type: TYPE_NORMAL
- en: tools that collect and interpret NSM data. The Snorby console will be empty
  id: totrans-276
  prefs: []
  type: TYPE_NORMAL
- en: until you build an SO sensor, as described next.
  id: totrans-277
  prefs: []
  type: TYPE_NORMAL
- en: '**installing an So Sensor using the So .iso image**'
  id: totrans-278
  prefs: []
  type: TYPE_NORMAL
- en: Our SO server won’t do us much good without one or more sensors to col-
  id: totrans-279
  prefs: []
  type: TYPE_NORMAL
- en: lect and interpret NSM data. In this section, we’ll build an SO sensor using
  id: totrans-280
  prefs: []
  type: TYPE_NORMAL
- en: the SO *.iso* file. For hardware, choose the same sort of equipment you used
  id: totrans-281
  prefs: []
  type: TYPE_NORMAL
- en: in the stand-alone scenario.
  id: totrans-282
  prefs: []
  type: TYPE_NORMAL
- en: To build your sensor, boot the *.iso* image, choose **Live**, and wait until
    you see the SO desktop. Begin the installation process by clicking the
  id: totrans-283
  prefs: []
  type: TYPE_NORMAL
- en: Install Security Onion 12.04 icon, and then follow the configuration pro-
  id: totrans-284
  prefs: []
  type: TYPE_NORMAL
- en: cess explained i[n “Installing SO to a Hard Drive” on page 62](index_split_001.html#p94).
  id: totrans-285
  prefs: []
  type: TYPE_NORMAL
- en: 'In summary, you will perform the following steps:'
  id: totrans-286
  prefs: []
  type: TYPE_NORMAL
- en: 1\. Validate space, connectivity, updates, and third-party software.
  id: totrans-287
  prefs: []
  type: TYPE_NORMAL
- en: 2\. Choose to erase the disk to install SO.
  id: totrans-288
  prefs: []
  type: TYPE_NORMAL
- en: 3\. Choose a username, computer name, and password.
  id: totrans-289
  prefs: []
  type: TYPE_NORMAL
- en: 4\. Complete installation and reboot the system.
  id: totrans-290
  prefs: []
  type: TYPE_NORMAL
- en: 5\. Update installed software using **sudo apt-get update && sudo apt-get**
  id: totrans-291
  prefs: []
  type: TYPE_NORMAL
- en: '**dist-upgrade**.'
  id: totrans-292
  prefs: []
  type: TYPE_NORMAL
- en: '**80** Chapter 4'
  id: totrans-293
  prefs: []
  type: TYPE_NORMAL
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-294
  prefs: []
  type: TYPE_NORMAL
- en: '![Image 54](index-115_1.jpg)'
  id: totrans-295
  prefs: []
  type: TYPE_IMG
- en: After completing this process, the SO software should be installed on
  id: totrans-296
  prefs: []
  type: TYPE_NORMAL
- en: the sensor, but nothing is configured for NSM duties. In the next section,
  id: totrans-297
  prefs: []
  type: TYPE_NORMAL
- en: we will choose a static IP address within the SO setup wizard, since that is
  id: totrans-298
  prefs: []
  type: TYPE_NORMAL
- en: part of a larger network configuration process required for SO sensors. We
  id: totrans-299
  prefs: []
  type: TYPE_NORMAL
- en: are ready to turn the system into a live SO sensor, and tell it to cooperate
  id: totrans-300
  prefs: []
  type: TYPE_NORMAL
- en: with the SO server we just created.
  id: totrans-301
  prefs: []
  type: TYPE_NORMAL
- en: '***Configuring the SO Sensor***'
  id: totrans-302
  prefs: []
  type: TYPE_NORMAL
- en: 'To configure the system as an SO sensor, follow these steps:'
  id: totrans-303
  prefs: []
  type: TYPE_NORMAL
- en: 1\. Click the Setup icon and enter your password to perform administra-
  id: totrans-304
  prefs: []
  type: TYPE_NORMAL
- en: tive tasks. Select **Yes, Continue!** when prompted.
  id: totrans-305
  prefs: []
  type: TYPE_NORMAL
- en: 2\. When prompted, select **eth0** for the management interface (or whatever
  id: totrans-306
  prefs: []
  type: TYPE_NORMAL
- en: interface you choose for management), configure a static IP address,
  id: totrans-307
  prefs: []
  type: TYPE_NORMAL
- en: and choose **eth1** for sniffing (or whatever interface(s) you want to use
  id: totrans-308
  prefs: []
  type: TYPE_NORMAL
- en: to collect and interpret traffic).
  id: totrans-309
  prefs: []
  type: TYPE_NORMAL
- en: 3\. Accept your selections by choosing **Yes, make changes and reboot!** .
  id: totrans-310
  prefs: []
  type: TYPE_NORMAL
  zh: 3\. 通过选择**是，进行更改并重启！**来接受您的选择。
- en: When the system reboots, it will be ready to be configured as an SO
  id: totrans-311
  prefs: []
  type: TYPE_NORMAL
  zh: 当系统重启时，它将准备好作为 SO 传感器进行配置
- en: 'sensor. To configure the sensor, follow these steps:'
  id: totrans-312
  prefs: []
  type: TYPE_NORMAL
  zh: 传感器。要配置传感器，请按照以下步骤操作：
- en: 1\. Click the Setup icon and enter your password to perform administra-
  id: totrans-313
  prefs: []
  type: TYPE_NORMAL
  zh: 1\. 点击设置图标并输入密码以执行管理任务
- en: tive tasks. Select **Yes, Continue!** when prompted.
  id: totrans-314
  prefs: []
  type: TYPE_NORMAL
  zh: 执行管理任务。当提示时，选择**是，继续！**
- en: 2\. The setup script should notice that you’ve already configured network
  id: totrans-315
  prefs: []
  type: TYPE_NORMAL
  zh: 2\. 设置脚本应该注意到您已经配置了网络
- en: interfaces, so choose **Yes, skip network configuration!** .
  id: totrans-316
  prefs: []
  type: TYPE_NORMAL
  zh: 接口，因此选择**是，跳过网络配置！**。
- en: 3\. Select **Sensor**, as shown in Figure 4-6\.
  id: totrans-317
  prefs: []
  type: TYPE_NORMAL
  zh: 3\. 选择**传感器**，如图 4-6 所示\。
- en: '*Figure 4-6: Choosing to build a sensor*'
  id: totrans-318
  prefs: []
  type: TYPE_NORMAL
  zh: '*图 4-6：选择构建传感器*'
- en: 4\. As an SO sensor, this system will cooperate with our SO server. Accord-
  id: totrans-319
  prefs: []
  type: TYPE_NORMAL
  zh: 4\. 作为 SO 传感器，本系统将与我们的 SO 服务器协作。根据
- en: ingly, the setup wizard should prompt you to enter the hostname or IP
  id: totrans-320
  prefs: []
  type: TYPE_NORMAL
  zh: 设置向导应该提示您输入 SO 服务器的主机名或 IP 地址
- en: address of the SO server, as shown in Figure 4-7\. As you can see, I enter
  id: totrans-321
  prefs: []
  type: TYPE_NORMAL
  zh: 如图 4-7 所示。正如您所见，我输入了
- en: 192.168.2.129, which I statically assigned to the SO server earlier. Enter
  id: totrans-322
  prefs: []
  type: TYPE_NORMAL
  zh: 192.168.2.129，这是我之前为 SO 服务器静态分配的地址。输入
- en: the IP address for your SO server.
  id: totrans-323
  prefs: []
  type: TYPE_NORMAL
  zh: SO 服务器的 IP 地址。
- en: Distributed Deployment **81**
  id: totrans-324
  prefs: []
  type: TYPE_NORMAL
  zh: 分布式部署**81**
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-325
  prefs: []
  type: TYPE_NORMAL
  zh: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
- en: '![Image 55](index-116_1.jpg)'
  id: totrans-326
  prefs: []
  type: TYPE_IMG
  zh: '![Image 55](index-116_1.jpg)'
- en: '![Image 56](index-116_2.jpg)'
  id: totrans-327
  prefs: []
  type: TYPE_IMG
  zh: '![Image 56](index-116_2.jpg)'
- en: '![Image 57](index-116_3.jpg)'
  id: totrans-328
  prefs: []
  type: TYPE_IMG
  zh: '![Image 57](index-116_3.jpg)'
- en: '*Figure 4-7: Providing the SO sensor setup wzard program with the IP address*'
  id: totrans-329
  prefs: []
  type: TYPE_NORMAL
  zh: '*图 4-7：为 SO 传感器设置向导提供 IP 地址*'
- en: '*of the SO server*'
  id: totrans-330
  prefs: []
  type: TYPE_NORMAL
  zh: '*SO 服务器的*'
- en: 5\. The setup wizard will ask for a username for the SO sensor processes
  id: totrans-331
  prefs: []
  type: TYPE_NORMAL
  zh: 5\. 设置向导将询问 SO 传感器进程的用户名
- en: to use to connect via OpenSSH. SO uses OpenSSH for communica-
  id: totrans-332
  prefs: []
  type: TYPE_NORMAL
  zh: 用于通过 OpenSSH 连接的用户名。SO 使用 OpenSSH 进行通信
- en: tion between the server and one or more sensors. The username you
  id: totrans-333
  prefs: []
  type: TYPE_NORMAL
  zh: 服务器与一个或多个传感器之间的通信。您选择的用户名
- en: selected when building the SO server will suffice for demo purposes, but
  id: totrans-334
  prefs: []
  type: TYPE_NORMAL
  zh: 在构建 SO 服务器时选择的用户名对于演示目的足够了，但
- en: in production environments, you should create a new user on the server
  id: totrans-335
  prefs: []
  type: TYPE_NORMAL
  zh: 在生产环境中，您应在服务器上创建一个新用户
- en: for each sensor that you expect to report. Separate users will limit your
  id: totrans-336
  prefs: []
  type: TYPE_NORMAL
  zh: 为每个您期望报告的传感器设置。单独的用户将限制您的
- en: system’s exposure if any single sensor is compromised. I enter **svrdemiso**
    for
  id: totrans-337
  prefs: []
  type: TYPE_NORMAL
  zh: 如果任何单个传感器被攻击，将会暴露系统。 我输入**svrdemiso**作为
- en: the user account, as shown in Figure 4-8\. Use a value appropriate for
  id: totrans-338
  prefs: []
  type: TYPE_NORMAL
  zh: 用户账户，如图 4-8 所示。使用适合的值
- en: your setup.
  id: totrans-339
  prefs: []
  type: TYPE_NORMAL
  zh: 您的设置。
- en: '*Figure 4-8: Configuring the username to connect to the SO server*'
  id: totrans-340
  prefs: []
  type: TYPE_NORMAL
  zh: '*图 4-8：配置用户名以连接到 SO 服务器*'
- en: 6\. The setup wizard asks for the interface(s) to be monitored, as in the
  id: totrans-341
  prefs: []
  type: TYPE_NORMAL
  zh: 6\. 设置向导会询问要监视的接口，如图中所示
- en: stand-alone setup. I choose **eth1**, and then I choose to enable **ELSA** and
  id: totrans-342
  prefs: []
  type: TYPE_NORMAL
  zh: 独立设置。我选择**eth1**，然后选择启用**ELSA**并
- en: automatically update the ELSA server (which helps the ELSA server on
  id: totrans-343
  prefs: []
  type: TYPE_NORMAL
  zh: 自动更新 ELSA 服务器（这有助于 ELSA 服务器）
- en: the SO server know that a new node is checking in with data), as shown
  id: totrans-344
  prefs: []
  type: TYPE_NORMAL
  zh: 让 SO 服务器知道有一个新节点正在检查并传送数据，如图所示
- en: in Figure 4-9\.
  id: totrans-345
  prefs: []
  type: TYPE_NORMAL
  zh: 如图 4-9 所示\。
- en: '*Figure 4-9: Tel ing the setup script to update the ELSA server*'
  id: totrans-346
  prefs: []
  type: TYPE_NORMAL
  zh: '*图 4-9：告诉设置脚本更新 ELSA 服务器*'
- en: 7\. It’s time to commit these changes. The setup script summarizes the
  id: totrans-347
  prefs: []
  type: TYPE_NORMAL
  zh: 7\. 现在是提交这些更改的时候了。设置脚本总结了
- en: results. If you’re satisfied with the output, click **Yes, proceed with the**
  id: totrans-348
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您对输出结果满意，请点击**是，继续进行**
- en: '**changes!** , as shown in Figure 4-10\.'
  id: totrans-349
  prefs: []
  type: TYPE_NORMAL
  zh: '**更改！**，如图 4-10 所示\。'
- en: '**82** Chapter 4'
  id: totrans-350
  prefs: []
  type: TYPE_NORMAL
  zh: '**82** 第四章'
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-351
  prefs: []
  type: TYPE_NORMAL
  zh: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
- en: '![Image 58](index-117_1.jpg)'
  id: totrans-352
  prefs: []
  type: TYPE_IMG
  zh: '![Image 58](index-117_1.jpg)'
- en: '![Image 59](index-117_2.png)'
  id: totrans-353
  prefs: []
  type: TYPE_IMG
  zh: '![Image 59](index-117_2.png)'
- en: '*Figure 4-10: SO summary before proceeding with SO sensor*'
  id: totrans-354
  prefs: []
  type: TYPE_NORMAL
  zh: '*图 4-10：继续进行 SO 传感器之前的 SO 概览*'
- en: '*changes*'
  id: totrans-355
  prefs: []
  type: TYPE_NORMAL
  zh: '*更改*'
- en: '***Completing Setup***'
  id: totrans-356
  prefs: []
  type: TYPE_NORMAL
  zh: '***完成设置***'
- en: As noted earlier, distributed SO deployments rely on OpenSSH for commu-
  id: totrans-357
  prefs: []
  type: TYPE_NORMAL
  zh: 如前所述，分布式 SO 部署依赖于 OpenSSH 进行通信。
- en: nication. During setup, the OpenSSH client will likely report that it can’t
  id: totrans-358
  prefs: []
  type: TYPE_NORMAL
  zh: 通信。在设置过程中，OpenSSH 客户端可能会报告它无法
- en: verify the authenticity of the SO server. It will probably show the ECDSA key
  id: totrans-359
  prefs: []
  type: TYPE_NORMAL
  zh: 验证 SO 服务器的真实性。它可能会显示 ECDSA 密钥
- en: fingerprint of the SO server and ask if you want to continue connecting.
  id: totrans-360
  prefs: []
  type: TYPE_NORMAL
  zh: SO 服务器的指纹，并询问是否继续连接。
- en: Log in to the SO server locally and run the following commands to
  id: totrans-361
  prefs: []
  type: TYPE_NORMAL
  zh: 本地登录到 SO 服务器并运行以下命令以
- en: obtain a fingerprint of the ECDSA key. (Your key will differ from the output
  id: totrans-362
  prefs: []
  type: TYPE_NORMAL
  zh: 获取 ECDSA 密钥的指纹。（你的密钥与输出的内容会不同）
- en: in Listing 4-1.)
  id: totrans-363
  prefs: []
  type: TYPE_NORMAL
  zh: 在列表 4-1 中的命令。)
- en: $ **ls /etc/ssh/*key***
  id: totrans-364
  prefs: []
  type: TYPE_NORMAL
  zh: $ **ls /etc/ssh/*key***
- en: /etc/ssh/ssh_host_dsa_key /etc/ssh/ssh_host_ecdsa_key.pub
  id: totrans-365
  prefs: []
  type: TYPE_NORMAL
  zh: /etc/ssh/ssh_host_dsa_key /etc/ssh/ssh_host_ecdsa_key.pub
- en: /etc/ssh/ssh_host_dsa_key.pub /etc/ssh/ssh_host_rsa_key
  id: totrans-366
  prefs: []
  type: TYPE_NORMAL
  zh: /etc/ssh/ssh_host_dsa_key.pub /etc/ssh/ssh_host_rsa_key
- en: /etc/ssh/ssh_host_ecdsa_key /etc/ssh/ssh_host_rsa_key.pub
  id: totrans-367
  prefs: []
  type: TYPE_NORMAL
  zh: /etc/ssh/ssh_host_ecdsa_key /etc/ssh/ssh_host_rsa_key.pub
- en: $ **ssh-keygen -lf /etc/ssh/ssh_host_ecdsa_key.pub**
  id: totrans-368
  prefs: []
  type: TYPE_NORMAL
  zh: $ **ssh-keygen -lf /etc/ssh/ssh_host_ecdsa_key.pub**
- en: 256 33:6c:38:9a:48:ce:fc:b2:c2:26:57:c3:81:a7:9d:b9 root@svrdemiso (ECDSA)
  id: totrans-369
  prefs: []
  type: TYPE_NORMAL
  zh: 256 33:6c:38:9a:48:ce:fc:b2:c2:26:57:c3:81:a7:9d:b9 root@svrdemiso (ECDSA)
- en: '*Listing 4-1: Examining SSH keys*'
  id: totrans-370
  prefs: []
  type: TYPE_NORMAL
  zh: '*列表 4-1：检查 SSH 密钥*'
- en: Verify that the key fingerprint you see matches the key on your SO
  id: totrans-371
  prefs: []
  type: TYPE_NORMAL
  zh: 验证你看到的密钥指纹是否与 SO 中的密钥匹配
- en: server, and then type **yes** and press enter, as shown in Figure 4-11\.
  id: totrans-372
  prefs: []
  type: TYPE_NORMAL
  zh: 服务器，然后输入**yes**并按回车，如图 4-11 所示。
- en: '*Figure 4-11: Validating the OpenSSH ECDSA key fingerprint*'
  id: totrans-373
  prefs: []
  type: TYPE_NORMAL
  zh: '*图 4-11：验证 OpenSSH ECDSA 密钥指纹*'
- en: A few more configuration messages will pass by, and another termi-
  id: totrans-374
  prefs: []
  type: TYPE_NORMAL
  zh: 几条更多的配置消息会通过，接着会出现另一个终端
- en: nal will appear, prompting you to enter your password to log in to the SO
  id: totrans-375
  prefs: []
  type: TYPE_NORMAL
  zh: 终端会出现，提示你输入密码以登录 SO
- en: server. Once you’ve entered your password correctly, the setup wizard will
  id: totrans-376
  prefs: []
  type: TYPE_NORMAL
  zh: 服务器。正确输入密码后，安装向导会
- en: report that it is complete.
  id: totrans-377
  prefs: []
  type: TYPE_NORMAL
  zh: 报告显示它已完成。
- en: Distributed Deployment **83**
  id: totrans-378
  prefs: []
  type: TYPE_NORMAL
  zh: 分布式部署 **83**
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-379
  prefs: []
  type: TYPE_NORMAL
  zh: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
- en: '***Verifying that the Sensors Are Working***'
  id: totrans-380
  prefs: []
  type: TYPE_NORMAL
  zh: '***验证传感器是否正常工作***'
- en: Now verify that the sensors are running with the **sudo service nsm status**
  id: totrans-381
  prefs: []
  type: TYPE_NORMAL
  zh: 现在通过 **sudo service nsm status** 验证传感器是否正常运行
- en: command. If you see output like that in Listing 4-2, everything is probably
  id: totrans-382
  prefs: []
  type: TYPE_NORMAL
  zh: 命令。如果你看到像列表 4-2 中那样的输出，一切可能正常
- en: 'working fine:'
  id: totrans-383
  prefs: []
  type: TYPE_NORMAL
  zh: 正常工作：
- en: $ **sudo service nsm status**
  id: totrans-384
  prefs: []
  type: TYPE_NORMAL
  zh: $ **sudo service nsm status**
- en: 'Status: HIDS'
  id: totrans-385
  prefs: []
  type: TYPE_NORMAL
  zh: 状态：HIDS
- en: '* ossec_agent (sguil) [ OK ]'
  id: totrans-386
  prefs: []
  type: TYPE_NORMAL
  zh: '* ossec_agent (sguil) [ OK ]'
- en: 'Status: Bro'
  id: totrans-387
  prefs: []
  type: TYPE_NORMAL
  zh: 状态：Bro
- en: Name Type Host Status Pid Peers Started
  id: totrans-388
  prefs: []
  type: TYPE_NORMAL
  zh: 名称 类型 主机 状态 进程号 对等 启动时间
- en: manager manager 192.168.2.130 running 2501 2 10 Feb 17:17:26
  id: totrans-389
  prefs: []
  type: TYPE_NORMAL
  zh: 管理员 管理员 192.168.2.130 正在运行 2501 2 10 2月 17:17:26
- en: proxy proxy 192.168.2.130 running 2659 2 10 Feb 17:17:28
  id: totrans-390
  prefs: []
  type: TYPE_NORMAL
  zh: 代理代理 192.168.2.130 正在运行 2659 2 10 2月 17:17:28
- en: sendemiso-eth1-1 worker 192.168.2.130 running 3275 2 10 Feb 17:17:31
  id: totrans-391
  prefs: []
  type: TYPE_NORMAL
  zh: sendemiso-eth1-1 工作站 192.168.2.130 正在运行 3275 2 10 2月 17:17:31
- en: 'Status: sendemiso-eth1'
  id: totrans-392
  prefs: []
  type: TYPE_NORMAL
  zh: 状态：sendemiso-eth1
- en: '* netsniff-ng (full packet data) [ OK ]'
  id: totrans-393
  prefs: []
  type: TYPE_NORMAL
  zh: '* netsniff-ng (完整数据包数据) [ OK ]'
- en: '* pcap_agent (sguil) [ OK ]'
  id: totrans-394
  prefs: []
  type: TYPE_NORMAL
  zh: '* pcap_agent (sguil) [ OK ]'
- en: '* snort_agent (sguil) [ OK ]'
  id: totrans-395
  prefs: []
  type: TYPE_NORMAL
  zh: '* snort_agent (sguil) [ OK ]'
- en: '* suricata (alert data) [ OK ]'
  id: totrans-396
  prefs: []
  type: TYPE_NORMAL
  zh: '* suricata (警报数据) [ OK ]'
- en: '* barnyard2 (spooler, unified2 format) [ OK ]'
  id: totrans-397
  prefs: []
  type: TYPE_NORMAL
  zh: '* barnyard2 (排队器，统一2格式) [ OK ]'
- en: '* prads (sessions/assets) [ OK ]'
  id: totrans-398
  prefs: []
  type: TYPE_NORMAL
  zh: '* prads (会话/资产) [ OK ]'
- en: '* sancp_agent (sguil) [ OK ]'
  id: totrans-399
  prefs: []
  type: TYPE_NORMAL
  zh: '* sancp_agent (sguil) [ OK ]'
- en: '* pads_agent (sguil) [ OK ]'
  id: totrans-400
  prefs: []
  type: TYPE_NORMAL
  zh: '* pads_agent (sguil) [ OK ]'
- en: '* argus [ OK ]'
  id: totrans-401
  prefs: []
  type: TYPE_NORMAL
  zh: '* argus [ OK ]'
- en: '* http_agent (sguil) [ OK ]'
  id: totrans-402
  prefs: []
  type: TYPE_NORMAL
  zh: '* http_agent (sguil) [ OK ]'
- en: '*Listing 4-2: Checking NSM service status*'
  id: totrans-403
  prefs: []
  type: TYPE_NORMAL
  zh: '*列表 4-2：检查 NSM 服务状态*'
- en: '***Verifying that the Autossh Tunnel Is Working***'
  id: totrans-404
  prefs: []
  type: TYPE_NORMAL
  zh: '***验证 Autossh 隧道是否正常工作***'
- en: If you notice that one or more NSM components aren’t working, try running
  id: totrans-405
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你注意到一个或多个 NSM 组件没有正常工作，尝试运行
- en: the **sudo service nsm restart** command to stop and start each application.
    If
  id: totrans-406
  prefs: []
  type: TYPE_NORMAL
  zh: '**sudo service nsm restart** 命令停止并启动每个应用程序。如果'
- en: that doesn’t result in each component working as expected, you may have a
  id: totrans-407
  prefs: []
  type: TYPE_NORMAL
  zh: 如果每个组件没有按预期工作，你可能遇到了
- en: more serious problem. You might need to restart your setup, or consult the
  id: totrans-408
  prefs: []
  type: TYPE_NORMAL
  zh: 更严重的问题。你可能需要重新启动你的设置，或者咨询
- en: online SO mailing list for assistance. You should also verify that the autossh
  id: totrans-409
  prefs: []
  type: TYPE_NORMAL
  zh: 在线 SO 邮件列表寻求帮助。你还应该验证 autossh
- en: tunnel that connects the sensor to the server is operational. Use the follow-
  id: totrans-410
  prefs: []
  type: TYPE_NORMAL
  zh: 连接传感器到服务器的隧道是正常工作的。使用以下
- en: ing command as shown in Listing 4-3\.
  id: totrans-411
  prefs: []
  type: TYPE_NORMAL
  zh: 按照列表 4-3 中所示的命令继续执行。
- en: $ **ps aux | grep autoss[h]**
  id: totrans-412
  prefs: []
  type: TYPE_NORMAL
  zh: $ **ps aux | grep autoss[h]**
- en: root 9775 0.0 0.0 4308 324 ? Ss 17:01 0:00 /usr/lib/
  id: totrans-413
  prefs: []
  type: TYPE_NORMAL
  zh: root 9775 0.0 0.0 4308 324 ? Ss 17:01 0:00 /usr/lib/
- en: autossh/autossh -M 0 -q -N -o ServerAliveInterval 60 -o ServerAliveCountMax
  id: totrans-414
  prefs: []
  type: TYPE_NORMAL
  zh: autossh/autossh -M 0 -q -N -o ServerAliveInterval 60 -o ServerAliveCountMax
- en: 3 -i /root/.ssh/securityonion -L 3306:127.0.0.1:3306 -R 50000:localhost:50000
  id: totrans-415
  prefs: []
  type: TYPE_NORMAL
  zh: 3 -i /root/.ssh/securityonion -L 3306:127.0.0.1:3306 -R 50000:localhost:50000
- en: -R 50001:localhost:9306 svrdemiso@192.168.2.129
  id: totrans-416
  prefs: []
  type: TYPE_NORMAL
  zh: -R 50001:localhost:9306 svrdemiso@192.168.2.129
- en: '*Listing 4-3: Looking for autossh processes*'
  id: totrans-417
  prefs: []
  type: TYPE_NORMAL
  zh: '*列表 4-3：查找 autossh 进程*'
- en: You can get similar results with **pgrep -lf autossh**. If the output is blank,
    you do not have an autossh tunnel established. Try rerunning the SO setup script.
  id: totrans-418
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以使用 **pgrep -lf autossh** 获取类似的结果。如果输出为空，则说明你没有建立 autossh 隧道。尝试重新运行 SO 安装脚本。
- en: You can run a test by visiting *http://www.testmyids.com/*. If you see results
  id: totrans-419
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以通过访问 *http://www.testmyids.com/* 来进行测试。如果你看到结果
- en: in the Snorby application, your SO sensor is communicating events to your
  id: totrans-420
  prefs: []
  type: TYPE_NORMAL
  zh: 在 Snorby 应用程序中，您的 SO 传感器正在将事件传递到您的
- en: SO server. Congratulations—you have built a distributed NSM system!
  id: totrans-421
  prefs: []
  type: TYPE_NORMAL
  zh: SO 服务器。恭喜您—您已构建了一个分布式 NSM 系统！
- en: '**84** Chapter 4'
  id: totrans-422
  prefs: []
  type: TYPE_NORMAL
  zh: '**84** 第 4 章'
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-423
  prefs: []
  type: TYPE_NORMAL
  zh: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
- en: '**building an So Server using PPas**'
  id: totrans-424
  prefs: []
  type: TYPE_NORMAL
  zh: '**使用 PPA 构建 SO 服务器**'
- en: The previous installations used the SO *.iso* file provided by the SO project,
  id: totrans-425
  prefs: []
  type: TYPE_NORMAL
  zh: 上述安装使用了 SO 项目提供的 SO *.iso* 文件，
- en: but that’s not the only installation option. You can also build SO function-
  id: totrans-426
  prefs: []
  type: TYPE_NORMAL
  zh: 但这不是唯一的安装选项。您还可以使用 SO 功能
- en: ality on a locally installed Ubuntu Linux-based operating system using
  id: totrans-427
  prefs: []
  type: TYPE_NORMAL
  zh: 在本地安装的基于 Ubuntu Linux 的操作系统上构建
- en: the SO project’s PPAs, available at *https://launchpad.net/~securityonion/*.
  id: totrans-428
  prefs: []
  type: TYPE_NORMAL
  zh: SO 项目的 PPA，网址为 *https://launchpad.net/~securityonion/*。
- en: Some organizations prefer to avoid using Linux distributions built by other
  id: totrans-429
  prefs: []
  type: TYPE_NORMAL
  zh: 一些组织倾向于避免使用其他人构建的 Linux 发行版
- en: teams. If your organization follows this model and uses its own Ubuntu
  id: totrans-430
  prefs: []
  type: TYPE_NORMAL
  zh: 团队。如果您的组织遵循这种模式并使用自己的 Ubuntu
- en: Linux-derived base installation, you can use SO PPAs to deploy SO on your
  id: totrans-431
  prefs: []
  type: TYPE_NORMAL
  zh: 基于 Linux 的基础安装，您可以使用 SO PPA 将 SO 部署到您的
- en: platforms.
  id: totrans-432
  prefs: []
  type: TYPE_NORMAL
  zh: 平台。
- en: The SO project builds stable, test, and development PPAs. You should
  id: totrans-433
  prefs: []
  type: TYPE_NORMAL
  zh: SO 项目构建了稳定、测试和开发 PPA。您应该
- en: use stable in production environments. If you want to help keep SO mov-
  id: totrans-434
  prefs: []
  type: TYPE_NORMAL
  zh: 在生产环境中使用稳定版本。如果您想帮助保持 SO 的发展
- en: ing forward, run the test PPA. The development PPA is best suited to SO
  id: totrans-435
  prefs: []
  type: TYPE_NORMAL
  zh: 向前运行，使用测试 PPA。开发 PPA 最适合用于 SO
- en: developers.
  id: totrans-436
  prefs: []
  type: TYPE_NORMAL
  zh: 开发人员。
- en: In the remainder of this chapter, we’ll build an entirely new server-plus-
  id: totrans-437
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章的剩余部分，我们将构建一个全新的服务器加
- en: sensor deployment solely for the purpose of demonstrating an alternative
  id: totrans-438
  prefs: []
  type: TYPE_NORMAL
  zh: 仅为演示替代方案而部署传感器
- en: setup option. Instead of using an *.iso* image from the SO project, we’ll use
  id: totrans-439
  prefs: []
  type: TYPE_NORMAL
  zh: 设置选项。我们将使用 SO 项目提供的 *.iso* 镜像
- en: the 64-bit, Long Term Support (LTS) version of Ubuntu Server 12.04 as the
  id: totrans-440
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 64 位的 Ubuntu Server 12.04 LTS 版本作为
- en: base operating system for an SO server and sensor.
  id: totrans-441
  prefs: []
  type: TYPE_NORMAL
  zh: 用作 SO 服务器和传感器的基础操作系统。
- en: You can download the *.iso* file for this distribution from the Ubuntu
  id: totrans-442
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以从 Ubuntu 下载此发行版的 *.iso* 文件
- en: project website at *http://www.ubuntu.com/download/server/*. When visiting
  id: totrans-443
  prefs: []
  type: TYPE_NORMAL
  zh: 项目网站地址 *http://www.ubuntu.com/download/server/*。访问时
- en: that page, you’ll see a Get Ubuntu 12.04 LTS option, which will be avail-
  id: totrans-444
  prefs: []
  type: TYPE_NORMAL
  zh: 在该页面上，您将看到一个获取 Ubuntu 12.04 LTS 选项，该选项将可用
- en: able through April 2017\. I chose this distribution because the SO project
  id: totrans-445
  prefs: []
  type: TYPE_NORMAL
  zh: 直到 2017 年 4 月。选择此发行版是因为 SO 项目
- en: tests against the LTS and cannot guarantee support for other variants.
  id: totrans-446
  prefs: []
  type: TYPE_NORMAL
  zh: 针对 LTS 进行测试，无法保证对其他变体的支持。
- en: This is a popular option that your organization may use itself, thanks to
  id: totrans-447
  prefs: []
  type: TYPE_NORMAL
  zh: 这是一个您的组织可能会使用的流行选项，感谢
- en: the extended availability of the release.
  id: totrans-448
  prefs: []
  type: TYPE_NORMAL
  zh: 该版本的扩展可用性。
- en: '**N o T e**'
  id: totrans-449
  prefs: []
  type: TYPE_NORMAL
  zh: '**注意**'
- en: '*Building your own system using PPAs requires knowledge of Linux that exceeds
    that* *required for using the SO* .iso *installation method. For example, you
    need to know* *how to forward X sessions. (I show how to accomplish that task,
    and other Linux*'
  id: totrans-450
  prefs: []
  type: TYPE_NORMAL
  zh: '*使用 PPA 构建自己的系统需要比使用 SO .iso 安装方法更多的 Linux 知识。例如，您需要知道* *如何转发 X 会话。（我将展示如何完成此任务，以及其他
    Linux*'
- en: '*steps, later in the chapter.) If you are not comfortable with this process,
    or don’t understand what it means, ask a Linux-experienced friend or install SO
    from the* .iso *files* *as previously described.*'
  id: totrans-451
  prefs: []
  type: TYPE_NORMAL
  zh: '*步骤，在本章稍后部分。如果您对这个过程不熟悉，或者不理解其含义，请向一位有 Linux 经验的朋友请教，或者按照前面描述的方式从 .iso 文件安装
    SO。*'
- en: '***Instal ing Ubuntu Server as the SO Server Operating System***'
  id: totrans-452
  prefs: []
  type: TYPE_NORMAL
  zh: '***将 Ubuntu Server 安装为 SO 服务器操作系统***'
- en: Begin the Ubuntu server installation process by booting the Ubuntu Server
  id: totrans-453
  prefs: []
  type: TYPE_NORMAL
  zh: 通过启动 Ubuntu 服务器安装过程开始安装 Ubuntu 服务器
- en: LTS *.iso* image on the hardware chosen to run the SO server. The installation
  id: totrans-454
  prefs: []
  type: TYPE_NORMAL
  zh: 在选定硬件上安装 LTS *.iso* 镜像，以运行 SO 服务器。安装
- en: wizard will prompt you to make a number of choices. Make the following
  id: totrans-455
  prefs: []
  type: TYPE_NORMAL
  zh: 向导将提示您做出若干选择。请做出以下选择
- en: selections, adjusted as appropriate for your environment.
  id: totrans-456
  prefs: []
  type: TYPE_NORMAL
  zh: 根据您的环境，调整相应的选择。
- en: '1\. Language: **English**'
  id: totrans-457
  prefs: []
  type: TYPE_NORMAL
  zh: 1\. 语言：**英语**
- en: 2\. **Install Ubuntu Server**
  id: totrans-458
  prefs: []
  type: TYPE_NORMAL
  zh: 2\. **安装 Ubuntu Server**
- en: '3\. Select a language: **English**'
  id: totrans-459
  prefs: []
  type: TYPE_NORMAL
  zh: 3\. 选择语言：**英语**
- en: '4\. Select your location: **United States**'
  id: totrans-460
  prefs: []
  type: TYPE_NORMAL
  zh: 4\. 选择您的位置：**美国**
- en: Distributed Deployment **85**
  id: totrans-461
  prefs: []
  type: TYPE_NORMAL
  zh: 分布式部署 **85**
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-462
  prefs: []
  type: TYPE_NORMAL
  zh: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
- en: '5\. Configure the keyboard:'
  id: totrans-463
  prefs: []
  type: TYPE_NORMAL
  zh: 5\. 配置键盘：
- en: • Detect keyboard layout? **No**
  id: totrans-464
  prefs: []
  type: TYPE_NORMAL
  zh: • 检测键盘布局？**否**
- en: • **English (US)**
  id: totrans-465
  prefs: []
  type: TYPE_NORMAL
  zh: • **英语（美国）**
- en: '• Keyboard layout: **English (US)**'
  id: totrans-466
  prefs: []
  type: TYPE_NORMAL
  zh: • 键盘布局：**英语（美国）**
- en: '6\. Hostname: **serverdemo**'
  id: totrans-467
  prefs: []
  type: TYPE_NORMAL
  zh: 6\. 主机名：**serverdemo**
- en: '7\. Set up users and passwords:'
  id: totrans-468
  prefs: []
  type: TYPE_NORMAL
  zh: 7\. 设置用户和密码：
- en: '• Full name for the new user: **serverdemo**'
  id: totrans-469
  prefs: []
  type: TYPE_NORMAL
  zh: • 新用户的全名：**serverdemo**
- en: '• Username for your account: **serverdemo**'
  id: totrans-470
  prefs: []
  type: TYPE_NORMAL
  zh: • 您账户的用户名：**serverdemo**
- en: '• Choose a password for the new user: **<enter password>**'
  id: totrans-471
  prefs: []
  type: TYPE_NORMAL
  zh: • 为新用户选择一个密码：**<输入密码>**
- en: '• Reenter password to verify: **<enter password>**'
  id: totrans-472
  prefs: []
  type: TYPE_NORMAL
  zh: • 重新输入密码进行验证：**<输入密码>**
- en: • Encrypt your home directory? **No**
  id: totrans-473
  prefs: []
  type: TYPE_NORMAL
  zh: • 是否加密您的主目录？**否**
- en: 8\. Configure the clock. Is this time zone correct? **Yes**
  id: totrans-474
  prefs: []
  type: TYPE_NORMAL
  zh: 8\. 配置时钟。这个时区正确吗？**是**
- en: '9\. Partition disks:'
  id: totrans-475
  prefs: []
  type: TYPE_NORMAL
  zh: 9\. 分区磁盘：
- en: '• Partitioning method: **Guided – use entire disk and set up LVM**'
  id: totrans-476
  prefs: []
  type: TYPE_NORMAL
  zh: • 分区方法：**引导 – 使用整个磁盘并设置 LVM**
- en: '• Select disk to partition: **<choose your disk>**'
  id: totrans-477
  prefs: []
  type: TYPE_NORMAL
  zh: • 选择要分区的磁盘：**<选择您的磁盘>**
- en: • Write the changes to disks and configure LVM? **Yes**
  id: totrans-478
  prefs: []
  type: TYPE_NORMAL
  zh: • 将更改写入磁盘并配置 LVM？**是**
- en: '• Amount of volume group to use for guided partitioning: **<accept**'
  id: totrans-479
  prefs: []
  type: TYPE_NORMAL
  zh: • 用于引导分区的卷组大小：**<接受>**
- en: '**default>, Continue**'
  id: totrans-480
  prefs: []
  type: TYPE_NORMAL
  zh: '**default>，继续**'
- en: • Write the changes to disks? **Yes**
  id: totrans-481
  prefs: []
  type: TYPE_NORMAL
  zh: • 将更改写入磁盘？**是**
- en: 10\. Configure the package manager. HTTP proxy information (blank for
  id: totrans-482
  prefs: []
  type: TYPE_NORMAL
  zh: 10\. 配置软件包管理器。HTTP 代理信息（空白为
- en: 'none): **<blank>, Continue**'
  id: totrans-483
  prefs: []
  type: TYPE_NORMAL
  zh: 无：**<空白>，继续**
- en: 11\. Configure tasksel. How do you want to manage upgrades on this system?
  id: totrans-484
  prefs: []
  type: TYPE_NORMAL
  zh: 11\. 配置 tasksel。您希望如何管理此系统的升级？
- en: '**No automatic updates.**'
  id: totrans-485
  prefs: []
  type: TYPE_NORMAL
  zh: '**无自动更新。**'
- en: '12\. Software selection. Choose software to install: **<click spacebar on**'
  id: totrans-486
  prefs: []
  type: TYPE_NORMAL
  zh: 12\. 软件选择。选择要安装的软件：**<点击空格键选择>**
- en: '**OpenSSH server>, Continue**'
  id: totrans-487
  prefs: []
  type: TYPE_NORMAL
  zh: '**OpenSSH 服务器>，继续**'
- en: 13\. Install the GRUB boot loader on a hard disk. Install the GRUB boot
  id: totrans-488
  prefs: []
  type: TYPE_NORMAL
  zh: 13\. 将 GRUB 引导加载程序安装到硬盘上。安装 GRUB 引导
- en: loader to the master boot record? **Yes**
  id: totrans-489
  prefs: []
  type: TYPE_NORMAL
  zh: 将引导加载程序安装到主引导记录中？**是**
- en: 14\. Finish the installation. **Continue**
  id: totrans-490
  prefs: []
  type: TYPE_NORMAL
  zh: 14\. 完成安装。**继续**
- en: When installation is complete, the system will reboot. When you log in,
  id: totrans-491
  prefs: []
  type: TYPE_NORMAL
  zh: 安装完成后，系统将重启。重新登录时，
- en: you should see the IP address assigned via DHCP, as well as messages about
  id: totrans-492
  prefs: []
  type: TYPE_NORMAL
  zh: 您应该看到通过 DHCP 分配的 IP 地址，以及关于
- en: the number of updates that can be applied, as shown in Figure 4-12\.
  id: totrans-493
  prefs: []
  type: TYPE_NORMAL
  zh: 可以应用的更新数量，如图 4-12 所示\。
- en: In some cases, Ubuntu may not show you an IP address or other system
  id: totrans-494
  prefs: []
  type: TYPE_NORMAL
  zh: 在某些情况下，Ubuntu 可能不会显示 IP 地址或其他系统
- en: information. In these cases, the login script determined that the system is
  id: totrans-495
  prefs: []
  type: TYPE_NORMAL
  zh: 信息。在这些情况下，登录脚本会确定系统的状态。
- en: under load, and it will report that condition. This is normal for systems that
  id: totrans-496
  prefs: []
  type: TYPE_NORMAL
  zh: 在负载下，它会报告这种情况。对于一些系统来说，这是正常现象，
- en: start a significant number of input/output (I/O) sensitive operations after
  id: totrans-497
  prefs: []
  type: TYPE_NORMAL
  zh: 启动大量的输入/输出 (I/O) 敏感操作后
- en: booting.
  id: totrans-498
  prefs: []
  type: TYPE_NORMAL
  zh: 启动中。
- en: '**86** Chapter 4'
  id: totrans-499
  prefs: []
  type: TYPE_NORMAL
  zh: '**86** 第 4 章'
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-500
  prefs: []
  type: TYPE_NORMAL
  zh: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
- en: '![Image 60](index-121_1.png)'
  id: totrans-501
  prefs: []
  type: TYPE_IMG
  zh: '![Image 60](index-121_1.png)'
- en: '*Figure 4-12: Ubuntu server is instal ed.*'
  id: totrans-502
  prefs: []
  type: TYPE_NORMAL
  zh: '*图 4-12：Ubuntu 服务器已安装。*'
- en: '***Choosing a Static IP Address***'
  id: totrans-503
  prefs: []
  type: TYPE_NORMAL
  zh: '***选择静态 IP 地址***'
- en: We installed the operating system and allowed a dynamic IP address,
  id: totrans-504
  prefs: []
  type: TYPE_NORMAL
  zh: 我们安装了操作系统并允许动态 IP 地址，
- en: but now we want to transition from DHCP to static IP addressing. In this
  id: totrans-505
  prefs: []
  type: TYPE_NORMAL
  zh: 但现在我们想将 DHCP 转换为静态 IP 地址。在此
- en: example, we’ll edit a specific configuration file, which is one of the ways
    to
  id: totrans-506
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，我们将编辑一个特定的配置文件，这也是配置的一种方式。
- en: set a static IP address. (Earlier I showed you how to set a static IP address
  id: totrans-507
  prefs: []
  type: TYPE_NORMAL
  zh: 设置静态 IP 地址。（我之前已经展示了如何设置静态 IP 地址）
- en: 'using a GUI menu.) First open the */etc/network/interfaces* file to edit it
    with the vi editor like this (enter your password when prompted):'
  id: totrans-508
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 GUI 菜单进行配置。）首先，使用 vi 编辑器打开 */etc/network/interfaces* 文件进行编辑，如下所示（提示时输入您的密码）：
- en: $ **sudo vi /etc/network/interfaces**
  id: totrans-509
  prefs: []
  type: TYPE_NORMAL
  zh: $ **sudo vi /etc/network/interfaces**
- en: The file should contain entries like those in Listing 4-4\.
  id: totrans-510
  prefs: []
  type: TYPE_NORMAL
  zh: 该文件应包含如列 4-4 所示的条目。
- en: This file describes the network interfaces available on your system
  id: totrans-511
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 该文件描述了您系统上可用的网络接口
- en: and how to activate them. For more information, see interfaces(5).
  id: totrans-512
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 以及如何激活它们。更多信息，请参阅 interfaces(5)。
- en: The loopback network interface
  id: totrans-513
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 回环网络接口
- en: auto lo
  id: totrans-514
  prefs: []
  type: TYPE_NORMAL
  zh: auto lo
- en: iface lo inet loopback
  id: totrans-515
  prefs: []
  type: TYPE_NORMAL
  zh: iface lo inet loopback
- en: The primary network interface
  id: totrans-516
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 主要网络接口
- en: auto eth0
  id: totrans-517
  prefs: []
  type: TYPE_NORMAL
  zh: auto eth0
- en: iface eth0 inet dhcp
  id: totrans-518
  prefs: []
  type: TYPE_NORMAL
  zh: iface eth0 inet dhcp
- en: '*Listing 4-4: Default contents of* /etc/network/interfaces'
  id: totrans-519
  prefs: []
  type: TYPE_NORMAL
  zh: '*列 4-4：默认的* /etc/network/interfaces 内容'
- en: Distributed Deployment **87**
  id: totrans-520
  prefs: []
  type: TYPE_NORMAL
  zh: 分布式部署 **87**
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-521
  prefs: []
  type: TYPE_NORMAL
  zh: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
- en: Comment out the entries in the eth0 section with hashmarks (#) and
  id: totrans-522
  prefs: []
  type: TYPE_NORMAL
  zh: 使用井号 (#) 注释掉 eth0 部分中的条目，并
- en: add entries like the ones shown in Listing 4-5 in bold to match your setup.
  id: totrans-523
  prefs: []
  type: TYPE_NORMAL
  zh: 添加如列 4-5 所示的粗体条目，以匹配您的设置。
- en: (Ask your administrators for the settings most compatible with your net-
  id: totrans-524
  prefs: []
  type: TYPE_NORMAL
  zh: （请向您的管理员询问最适合您的网络设置）
- en: work, if necessary.)
  id: totrans-525
  prefs: []
  type: TYPE_NORMAL
- en: The primary network interface
  id: totrans-526
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: '**#** auto eth0'
  id: totrans-527
  prefs: []
  type: TYPE_NORMAL
- en: '**#** iface eth0 inet dhcp'
  id: totrans-528
  prefs: []
  type: TYPE_NORMAL
- en: auto eth0
  id: totrans-529
  prefs: []
  type: TYPE_NORMAL
- en: iface eth0 inet static
  id: totrans-530
  prefs: []
  type: TYPE_NORMAL
- en: '**address 192.168.2.128**'
  id: totrans-531
  prefs: []
  type: TYPE_NORMAL
- en: '**netmask 255.255.255.0**'
  id: totrans-532
  prefs: []
  type: TYPE_NORMAL
- en: '**network 192.168.2.0**'
  id: totrans-533
  prefs: []
  type: TYPE_NORMAL
- en: '**broadcast 192.168.2.255**'
  id: totrans-534
  prefs: []
  type: TYPE_NORMAL
- en: '**gateway 192.168.2.1**'
  id: totrans-535
  prefs: []
  type: TYPE_NORMAL
- en: '**dns-search taosecurity.com**'
  id: totrans-536
  prefs: []
  type: TYPE_NORMAL
- en: '**dns-nameservers 172.16.2.1**'
  id: totrans-537
  prefs: []
  type: TYPE_NORMAL
- en: '*Listing 4-5: Edited contents of* /etc/network/interfaces'
  id: totrans-538
  prefs: []
  type: TYPE_NORMAL
- en: Finally, restart the networking services to enable the static IP address
  id: totrans-539
  prefs: []
  type: TYPE_NORMAL
- en: with the command shown in Listing 4-6\.
  id: totrans-540
  prefs: []
  type: TYPE_NORMAL
- en: $ **sudo /etc/init.d/networking restart**
  id: totrans-541
  prefs: []
  type: TYPE_NORMAL
- en: '* Running /etc/init.d/networking restart is deprecated because it may not'
  id: totrans-542
  prefs: []
  type: TYPE_NORMAL
- en: enable again some interfaces
  id: totrans-543
  prefs: []
  type: TYPE_NORMAL
- en: '* Reconfiguring network interfaces...'
  id: totrans-544
  prefs: []
  type: TYPE_NORMAL
- en: ssh stop/waiting
  id: totrans-545
  prefs: []
  type: TYPE_NORMAL
- en: ssh start/running, process 16814 [ OK ]
  id: totrans-546
  prefs: []
  type: TYPE_NORMAL
- en: '*Listing 4-6: Restarting network services to use a static IP address*'
  id: totrans-547
  prefs: []
  type: TYPE_NORMAL
- en: Now reboot the system to kill the virtual dhclient process, which assigns
  id: totrans-548
  prefs: []
  type: TYPE_NORMAL
- en: IP addresses via DHCP. After rebooting, your system should have a static IP
  id: totrans-549
  prefs: []
  type: TYPE_NORMAL
- en: address.
  id: totrans-550
  prefs: []
  type: TYPE_NORMAL
- en: To confirm that your static IP address is configured as expected, connect
  id: totrans-551
  prefs: []
  type: TYPE_NORMAL
- en: via OpenSSH to the IP address of the server to continue with the next tasks.
  id: totrans-552
  prefs: []
  type: TYPE_NORMAL
- en: From a different workstation, open a terminal and execute **ssh *username*****@
    *server***
  id: totrans-553
  prefs: []
  type: TYPE_NORMAL
- en: '***IP***, where ***username*** is the username you configured, and ***server
    IP*** is the static management IP address you applied to the server.'
  id: totrans-554
  prefs: []
  type: TYPE_NORMAL
- en: '***Updating the Software***'
  id: totrans-555
  prefs: []
  type: TYPE_NORMAL
- en: 'Next, update the software running on your server. Run these commands:'
  id: totrans-556
  prefs: []
  type: TYPE_NORMAL
- en: $ **sudo apt-get update && sudo apt-get dist-upgrade**
  id: totrans-557
  prefs: []
  type: TYPE_NORMAL
- en: When asked if you want to continue, type **Y** and press enter. The
  id: totrans-558
  prefs: []
  type: TYPE_NORMAL
- en: server will download and install any updates. Once it’s finished, enter
  id: totrans-559
  prefs: []
  type: TYPE_NORMAL
- en: '**sudo reboot** to complete the process and reboot the server.'
  id: totrans-560
  prefs: []
  type: TYPE_NORMAL
- en: '**88** Chapter 4'
  id: totrans-561
  prefs: []
  type: TYPE_NORMAL
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-562
  prefs: []
  type: TYPE_NORMAL
- en: '***Beginning MySQL and PPA Setup on the SO Server***'
  id: totrans-563
  prefs: []
  type: TYPE_NORMAL
- en: After rebooting, log in. Now we’ll start configuring our system as an SO
  id: totrans-564
  prefs: []
  type: TYPE_NORMAL
- en: server. First, issue the following command to tell MySQL not to prompt for
  id: totrans-565
  prefs: []
  type: TYPE_NORMAL
- en: a root password during installation.
  id: totrans-566
  prefs: []
  type: TYPE_NORMAL
- en: $ **echo "debconf debconf/frontend select noninteractive" | sudo debconf-set-selections**
    Now install the python-software-properties package.
  id: totrans-567
  prefs: []
  type: TYPE_NORMAL
- en: $ **sudo apt-get -y install python-software-properties**
  id: totrans-568
  prefs: []
  type: TYPE_NORMAL
- en: Next, add the securityonion/stable PPA to the list of repositories recog-
  id: totrans-569
  prefs: []
  type: TYPE_NORMAL
- en: nized by this Ubuntu server, as shown in Listing 4-7\.
  id: totrans-570
  prefs: []
  type: TYPE_NORMAL
- en: $ **sudo add-apt-repository -y ppa:securityonion/stable**
  id: totrans-571
  prefs: []
  type: TYPE_NORMAL
- en: 'gpg: keyring `/tmp/tmpnOilj5/secring.gpg'' created'
  id: totrans-572
  prefs: []
  type: TYPE_NORMAL
- en: 'gpg: keyring `/tmp/tmpnOilj5/pubring.gpg'' created'
  id: totrans-573
  prefs: []
  type: TYPE_NORMAL
- en: 'gpg: requesting key 23F386C7 from hkp server keyserver.ubuntu.com'
  id: totrans-574
  prefs: []
  type: TYPE_NORMAL
- en: 'gpg: /tmp/tmpnOilj5/trustdb.gpg: trustdb created'
  id: totrans-575
  prefs: []
  type: TYPE_NORMAL
- en: 'gpg: key 23F386C7: public key "Launchpad PPA for Security Onion" imported'
  id: totrans-576
  prefs: []
  type: TYPE_NORMAL
- en: 'gpg: Total number processed: 1'
  id: totrans-577
  prefs: []
  type: TYPE_NORMAL
- en: 'gpg: imported: 1 (RSA: 1)'
  id: totrans-578
  prefs: []
  type: TYPE_NORMAL
- en: OK
  id: totrans-579
  prefs: []
  type: TYPE_NORMAL
- en: '*Listing 4-7: Adding the securityonion/stable PPA to the list of repositories*'
  id: totrans-580
  prefs: []
  type: TYPE_NORMAL
- en: Update the package listing with the following command.
  id: totrans-581
  prefs: []
  type: TYPE_NORMAL
- en: $ **sudo apt-get update**
  id: totrans-582
  prefs: []
  type: TYPE_NORMAL
- en: Now install the securityonion-server package.
  id: totrans-583
  prefs: []
  type: TYPE_NORMAL
- en: $ **sudo apt-get install securityonion-server**
  id: totrans-584
  prefs: []
  type: TYPE_NORMAL
- en: Notice in Listing 4-8 that in addition to many dependencies, the system
  id: totrans-585
  prefs: []
  type: TYPE_NORMAL
- en: plans to install a lot of SO-specific packages. This is normal during software
  id: totrans-586
  prefs: []
  type: TYPE_NORMAL
- en: installation.
  id: totrans-587
  prefs: []
  type: TYPE_NORMAL
- en: '*-- snip --*'
  id: totrans-588
  prefs: []
  type: TYPE_NORMAL
- en: securityonion-capme securityonion-daq securityonion-et-rules
  id: totrans-589
  prefs: []
  type: TYPE_NORMAL
- en: securityonion-limits securityonion-login-screen
  id: totrans-590
  prefs: []
  type: TYPE_NORMAL
- en: securityonion-nsmnow-admin-scripts securityonion-ossec-rules
  id: totrans-591
  prefs: []
  type: TYPE_NORMAL
- en: securityonion-passenger securityonion-passenger-conf
  id: totrans-592
  prefs: []
  type: TYPE_NORMAL
- en: securityonion-pfring-daq securityonion-pfring-ld securityonion-pfring-module
  id: totrans-593
  prefs: []
  type: TYPE_NORMAL
- en: securityonion-pfring-userland securityonion-pulledpork
  id: totrans-594
  prefs: []
  type: TYPE_NORMAL
- en: securityonion-rule-update securityonion-server securityonion-setup
  id: totrans-595
  prefs: []
  type: TYPE_NORMAL
- en: securityonion-sguil-agent-ossec securityonion-sguil-db-purge
  id: totrans-596
  prefs: []
  type: TYPE_NORMAL
- en: securityonion-sguil-server securityonion-sguild-add-user
  id: totrans-597
  prefs: []
  type: TYPE_NORMAL
- en: securityonion-snorby securityonion-snort securityonion-sostat
  id: totrans-598
  prefs: []
  type: TYPE_NORMAL
- en: Distributed Deployment **89**
  id: totrans-599
  prefs: []
  type: TYPE_NORMAL
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-600
  prefs: []
  type: TYPE_NORMAL
- en: securityonion-squert securityonion-squert-cron securityonion-web-page securityonion-wkhtmltopdf
    shared-mime-info sound-theme-freedesktop sox
  id: totrans-601
  prefs: []
  type: TYPE_NORMAL
- en: sqlite3 ssl-cert tcl-tls tcl8.5 tcllib tclx8.4 tcpflow tcpflow-no-tags
  id: totrans-602
  prefs: []
  type: TYPE_NORMAL
- en: tshark ttf-dejavu-core ttf-liberation wireshark-common x11-common xplico
  id: totrans-603
  prefs: []
  type: TYPE_NORMAL
- en: zenity zenity-common
  id: totrans-604
  prefs: []
  type: TYPE_NORMAL
- en: 0 upgraded, 288 newly installed, 0 to remove and 0 not upgraded.
  id: totrans-605
  prefs: []
  type: TYPE_NORMAL
- en: Need to get 287 MB of archives.
  id: totrans-606
  prefs: []
  type: TYPE_NORMAL
- en: After this operation, 643 MB of additional disk space will be used.
  id: totrans-607
  prefs: []
  type: TYPE_NORMAL
- en: Do you want to continue [Y/n]?
  id: totrans-608
  prefs: []
  type: TYPE_NORMAL
- en: '*Listing 4-8: Instal ing the securityonion-server package*'
  id: totrans-609
  prefs: []
  type: TYPE_NORMAL
- en: Type **Y** and press enter to continue. You will probably need to wait sev-
  id: totrans-610
  prefs: []
  type: TYPE_NORMAL
- en: eral minutes while the server downloads and installs the required software.
  id: totrans-611
  prefs: []
  type: TYPE_NORMAL
- en: Once it’s finished, install the securityonion-elsa and securityonion-elsa-extras
  id: totrans-612
  prefs: []
  type: TYPE_NORMAL
- en: packages.
  id: totrans-613
  prefs: []
  type: TYPE_NORMAL
- en: $ **sudo apt-get install securityonion-elsa securityonion-elsa-extras**
  id: totrans-614
  prefs: []
  type: TYPE_NORMAL
- en: '***Configuring Your SO Server via PPA***'
  id: totrans-615
  prefs: []
  type: TYPE_NORMAL
- en: Now set up this server using sosetup. Connect via SSH from a Linux system
  id: totrans-616
  prefs: []
  type: TYPE_NORMAL
- en: to take advantage of X forwarding. Here, I’m connecting from a separate
  id: totrans-617
  prefs: []
  type: TYPE_NORMAL
- en: Linux system named ubuntu. Notice the use of the capital -X switch to enable
  id: totrans-618
  prefs: []
  type: TYPE_NORMAL
- en: X forwarding. X is a protocol for displaying graphical user interfaces. For-
  id: totrans-619
  prefs: []
  type: TYPE_NORMAL
- en: warding means sending a GUI window someplace other than the computer
  id: totrans-620
  prefs: []
  type: TYPE_NORMAL
- en: on which it is run. The -X switch tells the remote server to display client
    win-
  id: totrans-621
  prefs: []
  type: TYPE_NORMAL
- en: dows through the SSH connection so that they appear on the local desktop,
  id: totrans-622
  prefs: []
  type: TYPE_NORMAL
- en: not the remote system. This allows you to interact with those client windows
  id: totrans-623
  prefs: []
  type: TYPE_NORMAL
- en: and configure software as necessary. Listing 4-9 explains the details.
  id: totrans-624
  prefs: []
  type: TYPE_NORMAL
- en: richard@ubuntu:~$ **ssh -X serverdemo@192.168.2.128**
  id: totrans-625
  prefs: []
  type: TYPE_NORMAL
- en: The authenticity of host '192.168.2.128 (192.168.2.128)' can't be established.
  id: totrans-626
  prefs: []
  type: TYPE_NORMAL
- en: ECDSA key fingerprint is 7f:a5:75:69:66:07:d9:1a:90:e5:42:1a:91:5a:ab:65\.
  id: totrans-627
  prefs: []
  type: TYPE_NORMAL
- en: Are you sure you want to continue connecting (yes/no)? **yes**
  id: totrans-628
  prefs: []
  type: TYPE_NORMAL
- en: 'Warning: Permanently added ''192.168.2.128'' (ECDSA) to the list of known hosts.'
  id: totrans-629
  prefs: []
  type: TYPE_NORMAL
- en: 'serverdemo@192.168.2.128''s password: **********'
  id: totrans-630
  prefs: []
  type: TYPE_NORMAL
- en: Welcome to Ubuntu 12.04.2 LTS (GNU/Linux 3.2.0-37-generic x86_64)
  id: totrans-631
  prefs: []
  type: TYPE_NORMAL
- en: '* Documentation: https://help.ubuntu.com/'
  id: totrans-632
  prefs: []
  type: TYPE_NORMAL
- en: System information as of Sun Feb 10 10:02:59 EST 2014
  id: totrans-633
  prefs: []
  type: TYPE_NORMAL
- en: 'System load: 0.0 Processes: 94'
  id: totrans-634
  prefs: []
  type: TYPE_NORMAL
- en: 'Usage of /: 7.2% of 35.20GB Users logged in: 1'
  id: totrans-635
  prefs: []
  type: TYPE_NORMAL
- en: 'Memory usage: 7% IP address for eth0: 192.168.2.128'
  id: totrans-636
  prefs: []
  type: TYPE_NORMAL
- en: 'Swap usage: 0%'
  id: totrans-637
  prefs: []
  type: TYPE_NORMAL
- en: Graph this data and manage this system at https://landscape.canonical.com/
  id: totrans-638
  prefs: []
  type: TYPE_NORMAL
- en: '**90** Chapter 4'
  id: totrans-639
  prefs: []
  type: TYPE_NORMAL
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-640
  prefs: []
  type: TYPE_NORMAL
- en: '![Image 61](index-125_1.jpg)'
  id: totrans-641
  prefs: []
  type: TYPE_IMG
- en: '![Image 62](index-125_2.png)'
  id: totrans-642
  prefs: []
  type: TYPE_IMG
- en: 'Last login: Sun Feb 10 09:59:57 2014'
  id: totrans-643
  prefs: []
  type: TYPE_NORMAL
- en: '/usr/bin/xauth: file /home/serverdemo/.Xauthority does not exist'
  id: totrans-644
  prefs: []
  type: TYPE_NORMAL
- en: serverdemo@serverdemo:~$ **sudo sosetup**
  id: totrans-645
  prefs: []
  type: TYPE_NORMAL
- en: '[sudo] password for serverdemo: ***********'
  id: totrans-646
  prefs: []
  type: TYPE_NORMAL
- en: '*Listing 4-9: Connecting to the SO server and configuring X forwarding*'
  id: totrans-647
  prefs: []
  type: TYPE_NORMAL
- en: When you run **sudo sosetup**, you will see a screen appear on your local
  id: totrans-648
  prefs: []
  type: TYPE_NORMAL
- en: workstation, like the one shown in Figure 4-13\.
  id: totrans-649
  prefs: []
  type: TYPE_NORMAL
- en: '*Figure 4-13: Preparing to run SO Setup*'
  id: totrans-650
  prefs: []
  type: TYPE_NORMAL
- en: Now configure this SO server in the same manner as when configur-
  id: totrans-651
  prefs: []
  type: TYPE_NORMAL
- en: ing the SO server built on the *.iso* file earlier in this chapter, i[n “Configuring](#p112)
  id: totrans-652
  prefs: []
  type: TYPE_NORMAL
- en: '[Your SO Server” on page 78](#p112). Once you’ve made your choices, the setup
    wizard will summarize them and ask whether you want to proceed with'
  id: totrans-653
  prefs: []
  type: TYPE_NORMAL
- en: the changes, as shown in Figure 4-14\.
  id: totrans-654
  prefs: []
  type: TYPE_NORMAL
- en: '*Figure 4-14: SO summary before proceeding with SO server changes*'
  id: totrans-655
  prefs: []
  type: TYPE_NORMAL
- en: After you click **Yes, proceed with the changes!** , the setup wizard will
  id: totrans-656
  prefs: []
  type: TYPE_NORMAL
- en: complete installation.
  id: totrans-657
  prefs: []
  type: TYPE_NORMAL
- en: As discussed i[n “Configuring Your SO Server” on page 78, t](#p112)o confirm
    the installation was successful, visit the web page hosted on the server and
  id: totrans-658
  prefs: []
  type: TYPE_NORMAL
- en: access a web-enabled NSM application like Snorby.
  id: totrans-659
  prefs: []
  type: TYPE_NORMAL
- en: With your server active, it’s time to build a sensor.
  id: totrans-660
  prefs: []
  type: TYPE_NORMAL
- en: Distributed Deployment **91**
  id: totrans-661
  prefs: []
  type: TYPE_NORMAL
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-662
  prefs: []
  type: TYPE_NORMAL
- en: '![Image 63](index-126_1.png)'
  id: totrans-663
  prefs: []
  type: TYPE_IMG
- en: '**building an So Sensor using PPas**'
  id: totrans-664
  prefs: []
  type: TYPE_NORMAL
- en: With the server running, we can turn to building an SO sensor using PPAs.
  id: totrans-665
  prefs: []
  type: TYPE_NORMAL
- en: This sensor will cooperate with the server we just built. We’ll continue the
  id: totrans-666
  prefs: []
  type: TYPE_NORMAL
- en: theme of using an Ubuntu server distribution as our operating system, and
  id: totrans-667
  prefs: []
  type: TYPE_NORMAL
- en: add SO components using PPAs.
  id: totrans-668
  prefs: []
  type: TYPE_NORMAL
- en: '***Instal ing Ubuntu Server as the SO Sensor Operating System***'
  id: totrans-669
  prefs: []
  type: TYPE_NORMAL
- en: Begin the Ubuntu server installation process by booting the Ubuntu Server
  id: totrans-670
  prefs: []
  type: TYPE_NORMAL
- en: LTS *.iso* file on the hardware chosen to run the SO sensor. The installation
  id: totrans-671
  prefs: []
  type: TYPE_NORMAL
- en: wizard will prompt you to make a number of choices. Make the following
  id: totrans-672
  prefs: []
  type: TYPE_NORMAL
- en: 'selections, adjusted as appropriate for your environment:'
  id: totrans-673
  prefs: []
  type: TYPE_NORMAL
- en: '1\. Language: **English**'
  id: totrans-674
  prefs: []
  type: TYPE_NORMAL
- en: 2\. **Install Ubuntu Server**
  id: totrans-675
  prefs: []
  type: TYPE_NORMAL
- en: '3\. Select a language: **English**'
  id: totrans-676
  prefs: []
  type: TYPE_NORMAL
- en: '4\. Select your location: **United States**'
  id: totrans-677
  prefs: []
  type: TYPE_NORMAL
- en: '5\. Configure the keyboard:'
  id: totrans-678
  prefs: []
  type: TYPE_NORMAL
- en: • Detect keyboard layout? **No**
  id: totrans-679
  prefs: []
  type: TYPE_NORMAL
- en: • **English (US)**
  id: totrans-680
  prefs: []
  type: TYPE_NORMAL
- en: '• Keyboard layout: **English (US)**'
  id: totrans-681
  prefs: []
  type: TYPE_NORMAL
- en: '6\. Configure the network. Hostname: **sensordemo**'
  id: totrans-682
  prefs: []
  type: TYPE_NORMAL
- en: When prompted to choose a primary network interface (as in Fig-
  id: totrans-683
  prefs: []
  type: TYPE_NORMAL
- en: ure 4-15), you must tell the setup wizard which NIC to use for management.
  id: totrans-684
  prefs: []
  type: TYPE_NORMAL
- en: In Figure 4-15, I select eth0 for management as the primary network inter-
  id: totrans-685
  prefs: []
  type: TYPE_NORMAL
- en: face. The setup wizard should automatically look for an IP address from a
  id: totrans-686
  prefs: []
  type: TYPE_NORMAL
- en: DHCP server for eth0\. (We’ll set a static IP when we run the SO setup script.)
  id: totrans-687
  prefs: []
  type: TYPE_NORMAL
- en: '*Figure 4-15: Selecting the primary network interface*'
  id: totrans-688
  prefs: []
  type: TYPE_NORMAL
- en: Now follow these steps to continue installing the operating system.
  id: totrans-689
  prefs: []
  type: TYPE_NORMAL
- en: I’ve entered values like usernames and passwords for demonstration only.
  id: totrans-690
  prefs: []
  type: TYPE_NORMAL
- en: Choose values that meet your needs in production.
  id: totrans-691
  prefs: []
  type: TYPE_NORMAL
- en: '**92** Chapter 4'
  id: totrans-692
  prefs: []
  type: TYPE_NORMAL
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-693
  prefs: []
  type: TYPE_NORMAL
- en: '![Image 64](index-127_1.png)'
  id: totrans-694
  prefs: []
  type: TYPE_IMG
- en: '1\. Set up users and passwords:'
  id: totrans-695
  prefs: []
  type: TYPE_NORMAL
- en: '• Full name for the new user: **sensordemo**'
  id: totrans-696
  prefs: []
  type: TYPE_NORMAL
- en: '• Username for your account: **sensordemo**'
  id: totrans-697
  prefs: []
  type: TYPE_NORMAL
- en: '• Choose a password for the new user: **<enter password>**'
  id: totrans-698
  prefs: []
  type: TYPE_NORMAL
- en: '• Reenter password to verify: **<enter password>**'
  id: totrans-699
  prefs: []
  type: TYPE_NORMAL
- en: • Encrypt your home directory? **No**
  id: totrans-700
  prefs: []
  type: TYPE_NORMAL
- en: 2\. Configure the clock. Is this time zone correct? **Yes**
  id: totrans-701
  prefs: []
  type: TYPE_NORMAL
- en: '3\. Partition disks:'
  id: totrans-702
  prefs: []
  type: TYPE_NORMAL
- en: '• Partitioning method: **Guided – use entire disk and set up LVM**'
  id: totrans-703
  prefs: []
  type: TYPE_NORMAL
- en: '• Select disk to partition: **<choose your disk>**'
  id: totrans-704
  prefs: []
  type: TYPE_NORMAL
- en: • Write the changes to disks and configure LVM? **Yes**
  id: totrans-705
  prefs: []
  type: TYPE_NORMAL
- en: '• Amount of volume group to use for guided partitioning: **<accept**'
  id: totrans-706
  prefs: []
  type: TYPE_NORMAL
- en: '**default>, Continue**'
  id: totrans-707
  prefs: []
  type: TYPE_NORMAL
- en: • Write the changes to disks? **Yes**
  id: totrans-708
  prefs: []
  type: TYPE_NORMAL
- en: 4\. Configure the package manager. HTTP proxy information (blank for
  id: totrans-709
  prefs: []
  type: TYPE_NORMAL
- en: 'none): **<blank>, Continue**'
  id: totrans-710
  prefs: []
  type: TYPE_NORMAL
- en: 5\. Configure tasksel. How do you want to manage upgrades on this sys-
  id: totrans-711
  prefs: []
  type: TYPE_NORMAL
- en: tem? **No automatic updates.**
  id: totrans-712
  prefs: []
  type: TYPE_NORMAL
- en: '6\. Software select ion. Choose software to install: **<click spacebar on**'
  id: totrans-713
  prefs: []
  type: TYPE_NORMAL
- en: '**OpenSSH server>, Continue**'
  id: totrans-714
  prefs: []
  type: TYPE_NORMAL
- en: 7\. Install the GRUB boot loader on a hard disk. Install the GRUB boot
  id: totrans-715
  prefs: []
  type: TYPE_NORMAL
- en: loader to the master boot record? **Yes**
  id: totrans-716
  prefs: []
  type: TYPE_NORMAL
- en: 8\. Finish the installation. **Continue**
  id: totrans-717
  prefs: []
  type: TYPE_NORMAL
- en: When the installation is complete, the system will reboot.
  id: totrans-718
  prefs: []
  type: TYPE_NORMAL
- en: Upon log in, you may see the IP address assigned via DHCP, along with
  id: totrans-719
  prefs: []
  type: TYPE_NORMAL
- en: various messages. Note the IP address if it’s displayed. If the system is under
  id: totrans-720
  prefs: []
  type: TYPE_NORMAL
- en: load, you may not see the system information screen that reports an IP
  id: totrans-721
  prefs: []
  type: TYPE_NORMAL
- en: address. To get the IP address of the management NIC, run **ifconfig eth0**
  id: totrans-722
  prefs: []
  type: TYPE_NORMAL
- en: at the command prompt, as shown in Figure 4-16\.
  id: totrans-723
  prefs: []
  type: TYPE_NORMAL
- en: '*Figure 4-16: Running ifconfig eth0 to learn the management IP address*'
  id: totrans-724
  prefs: []
  type: TYPE_NORMAL
- en: Distributed Deployment **93**
  id: totrans-725
  prefs: []
  type: TYPE_NORMAL
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-726
  prefs: []
  type: TYPE_NORMAL
- en: 'Now it’s time to update the sensor software. Connect to the server with OpenSSH
    and enter this command:'
  id: totrans-727
  prefs: []
  type: TYPE_NORMAL
- en: $ **sudo apt-get update && sudo apt-get dist-upgrade**
  id: totrans-728
  prefs: []
  type: TYPE_NORMAL
- en: Type **Y** to continue when prompted, and then press enter. The sensor
  id: totrans-729
  prefs: []
  type: TYPE_NORMAL
- en: should download and install updates. When it’s finished, enter the **sudo**
  id: totrans-730
  prefs: []
  type: TYPE_NORMAL
- en: '**reboot** command to restart the server and complete the process.'
  id: totrans-731
  prefs: []
  type: TYPE_NORMAL
- en: '***Configuring the System as a Sensor***'
  id: totrans-732
  prefs: []
  type: TYPE_NORMAL
- en: Our next task is to configure the SO sensor. First, enter the following com-
  id: totrans-733
  prefs: []
  type: TYPE_NORMAL
- en: mand to tell MySQL not to prompt for a root password during installation.
  id: totrans-734
  prefs: []
  type: TYPE_NORMAL
- en: $ **echo "debconf debconf/frontend select noninteractive" | sudo debconf-set-selections**
    Now install the python-software-properties package.
  id: totrans-735
  prefs: []
  type: TYPE_NORMAL
- en: $ **sudo apt-get -y install python-software-properties**
  id: totrans-736
  prefs: []
  type: TYPE_NORMAL
- en: Next, add the securityonion/stable PPA to the list of repositories recog-
  id: totrans-737
  prefs: []
  type: TYPE_NORMAL
- en: nized by this Ubuntu system, as shown in Listing 4-10\.
  id: totrans-738
  prefs: []
  type: TYPE_NORMAL
- en: $ **sudo add-apt-repository -y ppa:securityonion/stable**
  id: totrans-739
  prefs: []
  type: TYPE_NORMAL
- en: 'gpg: keyring `/tmp/tmpBByK4H/secring.gpg'' created'
  id: totrans-740
  prefs: []
  type: TYPE_NORMAL
- en: 'gpg: keyring `/tmp/tmpBByK4H/pubring.gpg'' created'
  id: totrans-741
  prefs: []
  type: TYPE_NORMAL
- en: 'gpg: requesting key 23F386C7 from hkp server keyserver.ubuntu.com'
  id: totrans-742
  prefs: []
  type: TYPE_NORMAL
- en: 'gpg: /tmp/tmpBByK4H/trustdb.gpg: trustdb created'
  id: totrans-743
  prefs: []
  type: TYPE_NORMAL
- en: 'gpg: key 23F386C7: public key "Launchpad PPA for Security Onion" imported'
  id: totrans-744
  prefs: []
  type: TYPE_NORMAL
- en: 'gpg: Total number processed: 1'
  id: totrans-745
  prefs: []
  type: TYPE_NORMAL
- en: 'gpg: imported: 1 (RSA: 1)'
  id: totrans-746
  prefs: []
  type: TYPE_NORMAL
- en: OK
  id: totrans-747
  prefs: []
  type: TYPE_NORMAL
- en: '*Listing 4-10: Adding the securityonion/stable PPA to the list of repositories*'
  id: totrans-748
  prefs: []
  type: TYPE_NORMAL
- en: Update the package listing with the following command.
  id: totrans-749
  prefs: []
  type: TYPE_NORMAL
- en: $ **sudo apt-get update**
  id: totrans-750
  prefs: []
  type: TYPE_NORMAL
- en: Install the following packages.
  id: totrans-751
  prefs: []
  type: TYPE_NORMAL
- en: $ **sudo apt-get install securityonion-sensor securityonion-elsa securityonion-elsa-extras**
    When asked whether you want to continue, answer **Y** and press enter.
  id: totrans-752
  prefs: []
  type: TYPE_NORMAL
- en: '**94** Chapter 4'
  id: totrans-753
  prefs: []
  type: TYPE_NORMAL
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-754
  prefs: []
  type: TYPE_NORMAL
- en: '![Image 65](index-129_1.png)'
  id: totrans-755
  prefs: []
  type: TYPE_IMG
- en: '***Running the Setup Wizard***'
  id: totrans-756
  prefs: []
  type: TYPE_NORMAL
- en: In order to run the setup wizard we need to use OpenSSH and X forward-
  id: totrans-757
  prefs: []
  type: TYPE_NORMAL
- en: ing. Do the following, but use the username and IP address appropriate for
  id: totrans-758
  prefs: []
  type: TYPE_NORMAL
- en: your environment. In Listing 4-11, I chose sensordemo as the username, and
  id: totrans-759
  prefs: []
  type: TYPE_NORMAL
- en: the IP address assigned via DHCP was 192.168.2.147\.
  id: totrans-760
  prefs: []
  type: TYPE_NORMAL
- en: richard@ubuntu:~$ **ssh -X sensordemo@192.168.2.147**
  id: totrans-761
  prefs: []
  type: TYPE_NORMAL
- en: The authenticity of host '192.168.2.147 (192.168.2.147)' can't be established.
  id: totrans-762
  prefs: []
  type: TYPE_NORMAL
- en: ECDSA key fingerprint is a5:a9:08:16:b5:d2:3c:ce:59:f7:08:91:a0:04:0b:47\.
  id: totrans-763
  prefs: []
  type: TYPE_NORMAL
- en: Are you sure you want to continue connecting (yes/no)? **yes**
  id: totrans-764
  prefs: []
  type: TYPE_NORMAL
- en: 'Warning: Permanently added ''192.168.2.147'' (ECDSA) to the list of known hosts.'
  id: totrans-765
  prefs: []
  type: TYPE_NORMAL
- en: 'sensordemo@192.168.2.147''s password: ***********'
  id: totrans-766
  prefs: []
  type: TYPE_NORMAL
- en: Welcome to Ubuntu 12.04.2 LTS (GNU/Linux 3.2.0-37-generic x86_64)
  id: totrans-767
  prefs: []
  type: TYPE_NORMAL
- en: '* Documentation: https://help.ubuntu.com/'
  id: totrans-768
  prefs: []
  type: TYPE_NORMAL
- en: System information as of Sun Feb 10 13:06:46 EST 2013
  id: totrans-769
  prefs: []
  type: TYPE_NORMAL
- en: 'System load: 0.11 Processes: 82'
  id: totrans-770
  prefs: []
  type: TYPE_NORMAL
- en: 'Usage of /: 5.3% of 35.20GB Users logged in: 1'
  id: totrans-771
  prefs: []
  type: TYPE_NORMAL
- en: 'Memory usage: 1% IP address for eth0: 192.168.2.147'
  id: totrans-772
  prefs: []
  type: TYPE_NORMAL
- en: 'Swap usage: 0%'
  id: totrans-773
  prefs: []
  type: TYPE_NORMAL
- en: Graph this data and manage this system at https://landscape.canonical.com/
  id: totrans-774
  prefs: []
  type: TYPE_NORMAL
- en: 'Last login: Sun Feb 10 13:03:59 2013'
  id: totrans-775
  prefs: []
  type: TYPE_NORMAL
- en: '/usr/bin/xauth: file /home/sensordemo/.Xauthority does not exist'
  id: totrans-776
  prefs: []
  type: TYPE_NORMAL
- en: sensordemo@sensordemo:~$ **sudo sosetup**
  id: totrans-777
  prefs: []
  type: TYPE_NORMAL
- en: '[sudo] password for sensordemo: **********'
  id: totrans-778
  prefs: []
  type: TYPE_NORMAL
- en: '*Listing 4-11: Connecting to the SO sensor and configuring X forwarding*'
  id: totrans-779
  prefs: []
  type: TYPE_NORMAL
- en: When you run this command, you will see a screen like the one shown
  id: totrans-780
  prefs: []
  type: TYPE_NORMAL
- en: in Figure 4-17\. You will need to configure network interfaces because this
  id: totrans-781
  prefs: []
  type: TYPE_NORMAL
- en: platform is a sensor.
  id: totrans-782
  prefs: []
  type: TYPE_NORMAL
- en: '*Figure 4-17: Prompt to configure network interfaces*'
  id: totrans-783
  prefs: []
  type: TYPE_NORMAL
- en: Distributed Deployment **95**
  id: totrans-784
  prefs: []
  type: TYPE_NORMAL
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-785
  prefs: []
  type: TYPE_NORMAL
- en: '![Image 66](index-130_1.png)'
  id: totrans-786
  prefs: []
  type: TYPE_IMG
- en: '![Image 67](index-130_2.png)'
  id: totrans-787
  prefs: []
  type: TYPE_IMG
- en: Remember to use the IP address, username, and password of the SO
  id: totrans-788
  prefs: []
  type: TYPE_NORMAL
- en: server from the PPAs. The setup wizard will summarize your configuration
  id: totrans-789
  prefs: []
  type: TYPE_NORMAL
- en: choices and ask whether you wish to proceed with the changes, as shown in
  id: totrans-790
  prefs: []
  type: TYPE_NORMAL
- en: Figure 4-18\.
  id: totrans-791
  prefs: []
  type: TYPE_NORMAL
- en: '*Figure 4-18: SO summary before proceeding with changes to the network interface*'
  id: totrans-792
  prefs: []
  type: TYPE_NORMAL
- en: After the system reboots, connect to the SO sensor again via
  id: totrans-793
  prefs: []
  type: TYPE_NORMAL
- en: OpenSSH and enable X forwarding. Rerun the setup wizard, and then
  id: totrans-794
  prefs: []
  type: TYPE_NORMAL
- en: choose **Advanced Setup**4**Sensor**. Enter the IP or hostname of the SO
  id: totrans-795
  prefs: []
  type: TYPE_NORMAL
- en: server, followed by the username that can connect via OpenSSH and run
  id: totrans-796
  prefs: []
  type: TYPE_NORMAL
- en: sudo. Choose the appropriate NIC to monitor, enable ELSA, update the
  id: totrans-797
  prefs: []
  type: TYPE_NORMAL
- en: ELSA server, and then review the summarization of changes, which will
  id: totrans-798
  prefs: []
  type: TYPE_NORMAL
- en: look similar to Figure 4-19\.
  id: totrans-799
  prefs: []
  type: TYPE_NORMAL
- en: '*Figure 4-19: SO summary before proceeding with sensor changes*'
  id: totrans-800
  prefs: []
  type: TYPE_NORMAL
- en: '**96** Chapter 4'
  id: totrans-801
  prefs: []
  type: TYPE_NORMAL
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-802
  prefs: []
  type: TYPE_NORMAL
- en: You will be prompted to continue connecting via OpenSSH when the
  id: totrans-803
  prefs: []
  type: TYPE_NORMAL
- en: authenticity of the SO server’s ECDSA key cannot be verified. You will also
  id: totrans-804
  prefs: []
  type: TYPE_NORMAL
- en: need to log in to the SO server, and then enter the sudo password. Once
  id: totrans-805
  prefs: []
  type: TYPE_NORMAL
- en: you’ve finished, the setup wizard will report that it is complete. After the
  id: totrans-806
  prefs: []
  type: TYPE_NORMAL
- en: GUI disappears, run the status script to see if the NSM applications are
  id: totrans-807
  prefs: []
  type: TYPE_NORMAL
- en: running, as shown in Listing 4-12\.
  id: totrans-808
  prefs: []
  type: TYPE_NORMAL
- en: $ **sudo service nsm status**
  id: totrans-809
  prefs: []
  type: TYPE_NORMAL
- en: 'Status: HIDS'
  id: totrans-810
  prefs: []
  type: TYPE_NORMAL
- en: '* ossec_agent (sguil) [ OK ]'
  id: totrans-811
  prefs: []
  type: TYPE_NORMAL
- en: 'Status: Bro'
  id: totrans-812
  prefs: []
  type: TYPE_NORMAL
- en: Name Type Host Status Pid Peers Started
  id: totrans-813
  prefs: []
  type: TYPE_NORMAL
- en: manager manager 192.168.2.131 running 3173 2 10 Feb 18:18:27
  id: totrans-814
  prefs: []
  type: TYPE_NORMAL
- en: proxy proxy 192.168.2.131 running 3228 2 10 Feb 18:18:29
  id: totrans-815
  prefs: []
  type: TYPE_NORMAL
- en: sensordemo-eth1-1 worker 192.168.2.131 running 3275 2 10 Feb 18:18:32
  id: totrans-816
  prefs: []
  type: TYPE_NORMAL
- en: 'Status: sensordemo-eth1'
  id: totrans-817
  prefs: []
  type: TYPE_NORMAL
- en: '* netsniff-ng (full packet data) [ OK ]'
  id: totrans-818
  prefs: []
  type: TYPE_NORMAL
- en: '* pcap_agent (sguil) [ OK ]'
  id: totrans-819
  prefs: []
  type: TYPE_NORMAL
- en: '* snort_agent (sguil) [ OK ]'
  id: totrans-820
  prefs: []
  type: TYPE_NORMAL
- en: '* suricata (alert data) [ OK ]'
  id: totrans-821
  prefs: []
  type: TYPE_NORMAL
- en: '* barnyard2 (spooler, unified2 format) [ OK ]'
  id: totrans-822
  prefs: []
  type: TYPE_NORMAL
- en: '* prads (sessions/assets) [ OK ]'
  id: totrans-823
  prefs: []
  type: TYPE_NORMAL
- en: '* sancp_agent (sguil) [ OK ]'
  id: totrans-824
  prefs: []
  type: TYPE_NORMAL
- en: '* pads_agent (sguil) [ OK ]'
  id: totrans-825
  prefs: []
  type: TYPE_NORMAL
- en: '* argus [ OK ]'
  id: totrans-826
  prefs: []
  type: TYPE_NORMAL
- en: '* http_agent (sguil) [ OK ]'
  id: totrans-827
  prefs: []
  type: TYPE_NORMAL
- en: '*Listing 4-12: Checking NSM service status*'
  id: totrans-828
  prefs: []
  type: TYPE_NORMAL
- en: Also check for the establishment of the autossh tunnel as shown in
  id: totrans-829
  prefs: []
  type: TYPE_NORMAL
- en: Listing 4-13\.
  id: totrans-830
  prefs: []
  type: TYPE_NORMAL
- en: $ **ps aux | grep autoss[h]**
  id: totrans-831
  prefs: []
  type: TYPE_NORMAL
- en: root 3046 0.0 0.0 4308 320 ? Ss 18:18 0:00 /usr/lib/
  id: totrans-832
  prefs: []
  type: TYPE_NORMAL
- en: autossh/autossh -M 0 -q -N -o ServerAliveInterval 60 -o ServerAliveCountMax
  id: totrans-833
  prefs: []
  type: TYPE_NORMAL
- en: 3 -i /root/.ssh/securityonion -L 3306:127.0.0.1:3306 -R 50000:localhost:50000
  id: totrans-834
  prefs: []
  type: TYPE_NORMAL
- en: -R 50001:localhost:9306 serverdemo@192.168.2.128
  id: totrans-835
  prefs: []
  type: TYPE_NORMAL
- en: '*Listing 4-13: Looking for autossh processes*'
  id: totrans-836
  prefs: []
  type: TYPE_NORMAL
- en: These results (with OK in every field) are all good signs. If you get differ-
  id: totrans-837
  prefs: []
  type: TYPE_NORMAL
- en: ent results, try rerunning the setup wizard.
  id: totrans-838
  prefs: []
  type: TYPE_NORMAL
- en: To verify that everything is working as expected, access the web server
  id: totrans-839
  prefs: []
  type: TYPE_NORMAL
- en: running on your new SO server, and then run Snorby and look for events
  id: totrans-840
  prefs: []
  type: TYPE_NORMAL
- en: captured by the Suricata IDS engine. If you see events, congratulations—
  id: totrans-841
  prefs: []
  type: TYPE_NORMAL
- en: you’ve built a distributed NSM system using Ubuntu Linux PPAs!
  id: totrans-842
  prefs: []
  type: TYPE_NORMAL
- en: Distributed Deployment **97**
  id: totrans-843
  prefs: []
  type: TYPE_NORMAL
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-844
  prefs: []
  type: TYPE_NORMAL
- en: '**conclusion**'
  id: totrans-845
  prefs: []
  type: TYPE_NORMAL
- en: In this chapter, you took a step beyond the normal stand-alone SO model
  id: totrans-846
  prefs: []
  type: TYPE_NORMAL
- en: and entered the world of distributed NSM operations. We looked at two
  id: totrans-847
  prefs: []
  type: TYPE_NORMAL
- en: 'possible ways to deploy server-plus-sensor systems:'
  id: totrans-848
  prefs: []
  type: TYPE_NORMAL
- en: • Using the *.iso* images provided by the SO project to build an SO server,
  id: totrans-849
  prefs: []
  type: TYPE_NORMAL
- en: and then using the same *.iso* file to build an SO sensor.
  id: totrans-850
  prefs: []
  type: TYPE_NORMAL
- en: • Using a standard *.iso* image from the Ubuntu Server distribution to
  id: totrans-851
  prefs: []
  type: TYPE_NORMAL
- en: replace the SO project *.iso* file. We used SO project PPAs to build an
  id: totrans-852
  prefs: []
  type: TYPE_NORMAL
- en: SO server and an SO sensor.
  id: totrans-853
  prefs: []
  type: TYPE_NORMAL
- en: Using each approach—an *.iso* file from the SO project or a “stock” *.iso*
  id: totrans-854
  prefs: []
  type: TYPE_NORMAL
- en: from the Ubuntu developers—we built a distributed NSM setup.
  id: totrans-855
  prefs: []
  type: TYPE_NORMAL
- en: In Chapter 5, we’ll take a brief look at a variety of SO housekeeping
  id: totrans-856
  prefs: []
  type: TYPE_NORMAL
- en: issues, such as keeping platforms up-to-date, limiting network access for
  id: totrans-857
  prefs: []
  type: TYPE_NORMAL
- en: security purposes, and managing platform storage.
  id: totrans-858
  prefs: []
  type: TYPE_NORMAL
- en: '**98** Chapter 4'
  id: totrans-859
  prefs: []
  type: TYPE_NORMAL
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-860
  prefs: []
  type: TYPE_NORMAL
- en: '**5**'
  id: totrans-861
  prefs: []
  type: TYPE_NORMAL
- en: '**S o P l aT f o r M h o u S e k e e P i N g**'
  id: totrans-862
  prefs: []
  type: TYPE_NORMAL
- en: In Chapters 3 and 4, we built stand-alone,
  id: totrans-863
  prefs: []
  type: TYPE_NORMAL
- en: server, and sensor SO platforms. All of
  id: totrans-864
  prefs: []
  type: TYPE_NORMAL
- en: these platforms are Linux systems that
  id: totrans-865
  prefs: []
  type: TYPE_NORMAL
- en: require a certain amount of care and house-
  id: totrans-866
  prefs: []
  type: TYPE_NORMAL
- en: keeping. This chapter explains key tasks common to
  id: totrans-867
  prefs: []
  type: TYPE_NORMAL
- en: all three systems. These administrative duties include
  id: totrans-868
  prefs: []
  type: TYPE_NORMAL
- en: keeping software up-to-date, limiting network access to promote security,
  id: totrans-869
  prefs: []
  type: TYPE_NORMAL
- en: and managing system storage. By following the recommendations in this
  id: totrans-870
  prefs: []
  type: TYPE_NORMAL
- en: chapter, you’ll keep your SO platforms running smoothly while providing
  id: totrans-871
  prefs: []
  type: TYPE_NORMAL
- en: vital data to NSM analysts.
  id: totrans-872
  prefs: []
  type: TYPE_NORMAL
- en: '**keeping So up-to-date**'
  id: totrans-873
  prefs: []
  type: TYPE_NORMAL
- en: All NSM platforms run code that may need to be updated periodically,
  id: totrans-874
  prefs: []
  type: TYPE_NORMAL
- en: and SO is no different. If you don’t periodically update the operating sys-
  id: totrans-875
  prefs: []
  type: TYPE_NORMAL
- en: tem and various applications, you could find yourself running code with
  id: totrans-876
  prefs: []
  type: TYPE_NORMAL
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-877
  prefs: []
  type: TYPE_NORMAL
- en: '![Image 68](index-134_1.jpg)'
  id: totrans-878
  prefs: []
  type: TYPE_IMG
- en: '![Image 69](index-134_2.jpg)'
  id: totrans-879
  prefs: []
  type: TYPE_IMG
- en: vulnerabilities. Thankfully, SO is not difficult to update. The easiest path
    is
  id: totrans-880
  prefs: []
  type: TYPE_NORMAL
- en: to use the GUI, but the SO team recommends updating from the command
  id: totrans-881
  prefs: []
  type: TYPE_NORMAL
- en: line because that approach provides a little more control over the update
  id: totrans-882
  prefs: []
  type: TYPE_NORMAL
- en: process. We’ll start with the simplest method, and then look at using the
  id: totrans-883
  prefs: []
  type: TYPE_NORMAL
- en: recommended one.
  id: totrans-884
  prefs: []
  type: TYPE_NORMAL
- en: '***Updating via the GUI***'
  id: totrans-885
  prefs: []
  type: TYPE_NORMAL
- en: To update via the GUI, log in to the SO console. You may see a notice like
  id: totrans-886
  prefs: []
  type: TYPE_NORMAL
- en: the one shown in Figure 5-1, informing you that updates are available.
  id: totrans-887
  prefs: []
  type: TYPE_NORMAL
- en: '*Figure 5-1: SO informs you when updates are available.*'
  id: totrans-888
  prefs: []
  type: TYPE_NORMAL
- en: Click the exclamation point icon to open a menu with update options,
  id: totrans-889
  prefs: []
  type: TYPE_NORMAL
- en: and select **Show Updates**. You will likely see both important and recom-
  id: totrans-890
  prefs: []
  type: TYPE_NORMAL
- en: mended updates, as shown in Figure 5-2\.
  id: totrans-891
  prefs: []
  type: TYPE_NORMAL
- en: '*Figure 5-2: Important security updates and recommended updates are available.*'
  id: totrans-892
  prefs: []
  type: TYPE_NORMAL
- en: '**100** Chapter 5'
  id: totrans-893
  prefs: []
  type: TYPE_NORMAL
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-894
  prefs: []
  type: TYPE_NORMAL
- en: I suggest installing all updates. The exception is if the SO project has encountered
    problems with certain updates, in which case it may suggest
  id: totrans-895
  prefs: []
  type: TYPE_NORMAL
- en: additional procedures to follow or certain updates to avoid. If there are warn-
  id: totrans-896
  prefs: []
  type: TYPE_NORMAL
- en: ings, they will be posted on the SO website at *http://securityonion.blogspot.com/*.
  id: totrans-897
  prefs: []
  type: TYPE_NORMAL
- en: To continue, click **Install Updates**. When finished, the Update Manager
  id: totrans-898
  prefs: []
  type: TYPE_NORMAL
- en: will report that the software is up-to-date, and it may require a system reboot.
  id: totrans-899
  prefs: []
  type: TYPE_NORMAL
- en: Follow any additional instructions.
  id: totrans-900
  prefs: []
  type: TYPE_NORMAL
- en: As you can see, updates via the GUI are easy. However, you can find
  id: totrans-901
  prefs: []
  type: TYPE_NORMAL
- en: yourself accepting updates that might not be compatible with the recom-
  id: totrans-902
  prefs: []
  type: TYPE_NORMAL
- en: mendations of the SO project. For example, MySQL database updates can
  id: totrans-903
  prefs: []
  type: TYPE_NORMAL
- en: 'be tricky. For this reason, I suggest following the SO project’s suggestion:'
  id: totrans-904
  prefs: []
  type: TYPE_NORMAL
- en: update via the command line.
  id: totrans-905
  prefs: []
  type: TYPE_NORMAL
- en: '***Updating via the Command Line***'
  id: totrans-906
  prefs: []
  type: TYPE_NORMAL
- en: The SO project blog posts usually tell users to conduct updates via the com-
  id: totrans-907
  prefs: []
  type: TYPE_NORMAL
- en: mand line, and provide specific syntax. To perform a generic update, open
  id: totrans-908
  prefs: []
  type: TYPE_NORMAL
- en: 'a terminal on the desktop and enter the following:'
  id: totrans-909
  prefs: []
  type: TYPE_NORMAL
- en: $ **sudo apt-get update**
  id: totrans-910
  prefs: []
  type: TYPE_NORMAL
- en: Now check for outdated software with the command shown in Listing 5-1\.
  id: totrans-911
  prefs: []
  type: TYPE_NORMAL
- en: $ **sudo apt-get upgrade**
  id: totrans-912
  prefs: []
  type: TYPE_NORMAL
- en: Reading package lists... Done
  id: totrans-913
  prefs: []
  type: TYPE_NORMAL
- en: Building dependency tree
  id: totrans-914
  prefs: []
  type: TYPE_NORMAL
- en: Reading state information... Done
  id: totrans-915
  prefs: []
  type: TYPE_NORMAL
- en: 'The following packages will be upgraded:'
  id: totrans-916
  prefs: []
  type: TYPE_NORMAL
- en: ecryptfs-utils fonts-opensymbol gstreamer0.10-plugins-good
  id: totrans-917
  prefs: []
  type: TYPE_NORMAL
- en: gstreamer0.10-pulseaudio language-selector-common language-selector-gnome
  id: totrans-918
  prefs: []
  type: TYPE_NORMAL
- en: libecryptfs0 libpciaccess0 libpq5
  id: totrans-919
  prefs: []
  type: TYPE_NORMAL
- en: 9 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
  id: totrans-920
  prefs: []
  type: TYPE_NORMAL
- en: Need to get 2,861 kB of archives.
  id: totrans-921
  prefs: []
  type: TYPE_NORMAL
- en: After this operation, 114 kB disk space will be freed.
  id: totrans-922
  prefs: []
  type: TYPE_NORMAL
- en: Do you want to continue [Y/n]?
  id: totrans-923
  prefs: []
  type: TYPE_NORMAL
- en: '*Listing 5-1: Running sudo apt-get upgrade*'
  id: totrans-924
  prefs: []
  type: TYPE_NORMAL
- en: Remembering to heed any warnings about updates from the SO team,
  id: totrans-925
  prefs: []
  type: TYPE_NORMAL
- en: decide if you want to continue, and respond with yes or no. If you answer **Y**,
  id: totrans-926
  prefs: []
  type: TYPE_NORMAL
- en: Apt will download and install updates.
  id: totrans-927
  prefs: []
  type: TYPE_NORMAL
- en: Reboot to make sure that your SO applications are working correctly.
  id: totrans-928
  prefs: []
  type: TYPE_NORMAL
- en: '**N o T e**'
  id: totrans-929
  prefs: []
  type: TYPE_NORMAL
- en: '*See the appendix for more guidance on updating SO.*'
  id: totrans-930
  prefs: []
  type: TYPE_NORMAL
- en: SO Platform Housekeeping **101**
  id: totrans-931
  prefs: []
  type: TYPE_NORMAL
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-932
  prefs: []
  type: TYPE_NORMAL
- en: '**limiting access to So**'
  id: totrans-933
  prefs: []
  type: TYPE_NORMAL
- en: By default, SO ships with the Linux iptables firewall enabled. A local fire-
  id: totrans-934
  prefs: []
  type: TYPE_NORMAL
- en: wall like iptables helps enforce a network security policy appropriate for a
  id: totrans-935
  prefs: []
  type: TYPE_NORMAL
- en: server. To see the default access control settings, run the Uncomplicated
  id: totrans-936
  prefs: []
  type: TYPE_NORMAL
- en: Firewall (UFW) configuration program with **sudo ufw status**. (I added the
  id: totrans-937
  prefs: []
  type: TYPE_NORMAL
- en: rightmost column to Listing 5-2 manually to show the services associated
  id: totrans-938
  prefs: []
  type: TYPE_NORMAL
- en: with each open port.)
  id: totrans-939
  prefs: []
  type: TYPE_NORMAL
- en: $ **sudo ufw status**
  id: totrans-940
  prefs: []
  type: TYPE_NORMAL
- en: '[sudo] password for sademo: **********'
  id: totrans-941
  prefs: []
  type: TYPE_NORMAL
- en: 'Status: active'
  id: totrans-942
  prefs: []
  type: TYPE_NORMAL
- en: To Action From
  id: totrans-943
  prefs: []
  type: TYPE_NORMAL
- en: -- ------ ----
  id: totrans-944
  prefs: []
  type: TYPE_NORMAL
- en: 22/tcp ALLOW Anywhere OpenSSH
  id: totrans-945
  prefs: []
  type: TYPE_NORMAL
- en: 514 ALLOW Anywhere Syslog
  id: totrans-946
  prefs: []
  type: TYPE_NORMAL
- en: 1514/udp ALLOW Anywhere OSSEC
  id: totrans-947
  prefs: []
  type: TYPE_NORMAL
- en: 443/tcp ALLOW Anywhere Apache
  id: totrans-948
  prefs: []
  type: TYPE_NORMAL
- en: 444/tcp ALLOW Anywhere Snorby
  id: totrans-949
  prefs: []
  type: TYPE_NORMAL
- en: 7734/tcp ALLOW Anywhere Sguil client to server
  id: totrans-950
  prefs: []
  type: TYPE_NORMAL
- en: 7736/tcp ALLOW Anywhere Sguil agents to server
  id: totrans-951
  prefs: []
  type: TYPE_NORMAL
- en: 3154/tcp ALLOW Anywhere ELSA
  id: totrans-952
  prefs: []
  type: TYPE_NORMAL
- en: 22/tcp ALLOW Anywhere (v6) OpenSSH
  id: totrans-953
  prefs: []
  type: TYPE_NORMAL
- en: 514 ALLOW Anywhere (v6) Syslog
  id: totrans-954
  prefs: []
  type: TYPE_NORMAL
- en: 1514/udp ALLOW Anywhere (v6) OSSEC
  id: totrans-955
  prefs: []
  type: TYPE_NORMAL
- en: 443/tcp ALLOW Anywhere (v6) Apache
  id: totrans-956
  prefs: []
  type: TYPE_NORMAL
- en: 444/tcp ALLOW Anywhere (v6) Snorby
  id: totrans-957
  prefs: []
  type: TYPE_NORMAL
- en: 7734/tcp ALLOW Anywhere (v6) Sguil client to server
  id: totrans-958
  prefs: []
  type: TYPE_NORMAL
- en: 7736/tcp ALLOW Anywhere (v6) Sguil agents to server
  id: totrans-959
  prefs: []
  type: TYPE_NORMAL
- en: 3154/tcp ALLOW Anywhere (v6) ELSA
  id: totrans-960
  prefs: []
  type: TYPE_NORMAL
- en: '*Listing 5-2: Firewal policy*'
  id: totrans-961
  prefs: []
  type: TYPE_NORMAL
- en: The firewall policy listed by this command shows all of the ALLOW state-
  id: totrans-962
  prefs: []
  type: TYPE_NORMAL
- en: ments permitting network traffic to designated ports. The firewall policy
  id: totrans-963
  prefs: []
  type: TYPE_NORMAL
- en: implicitly denies inbound access to any other ports. That means that if, for
  id: totrans-964
  prefs: []
  type: TYPE_NORMAL
- en: example, you need to modify the configuration to start your Apache web
  id: totrans-965
  prefs: []
  type: TYPE_NORMAL
- en: server on another port, you will need to change the iptables firewall access
  id: totrans-966
  prefs: []
  type: TYPE_NORMAL
- en: control lists accordingly.
  id: totrans-967
  prefs: []
  type: TYPE_NORMAL
- en: In the default configuration, Apache listens on port 443 TCP, and
  id: totrans-968
  prefs: []
  type: TYPE_NORMAL
- en: remote systems are allowed to connect to port 443 TCP per the firewall
  id: totrans-969
  prefs: []
  type: TYPE_NORMAL
- en: policy. Apache listening on port 4443, however, would be unreachable
  id: totrans-970
  prefs: []
  type: TYPE_NORMAL
- en: unless an administrator changed the firewall policy.
  id: totrans-971
  prefs: []
  type: TYPE_NORMAL
- en: Rather than expose more ports to remote access, some administrators
  id: totrans-972
  prefs: []
  type: TYPE_NORMAL
- en: choose to limit the number of services that listen on public interfaces. Instead
  id: totrans-973
  prefs: []
  type: TYPE_NORMAL
- en: of letting applications listen on the public network interface, administrators
  id: totrans-974
  prefs: []
  type: TYPE_NORMAL
- en: “bind” them to nonpublic interfaces.
  id: totrans-975
  prefs: []
  type: TYPE_NORMAL
- en: One way to use nonpublic interfaces for tighter security is to configure
  id: totrans-976
  prefs: []
  type: TYPE_NORMAL
- en: an application to listen only on localhost (127.0.0.1). When an application
  id: totrans-977
  prefs: []
  type: TYPE_NORMAL
- en: '**102** Chapter 5'
  id: totrans-978
  prefs: []
  type: TYPE_NORMAL
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-979
  prefs: []
  type: TYPE_NORMAL
- en: is listening only on localhost, it can’t be reached remotely; it can be reached
    only via the local system (hence the localhost, nonpublic IP address).
  id: totrans-980
  prefs: []
  type: TYPE_NORMAL
- en: However, you can “simulate” local access by cleverly configuring OpenSSH.
  id: totrans-981
  prefs: []
  type: TYPE_NORMAL
- en: You can set up an SSH proxy from an authorized remote client to the sen-
  id: totrans-982
  prefs: []
  type: TYPE_NORMAL
- en: sor running the application listening on localhost.
  id: totrans-983
  prefs: []
  type: TYPE_NORMAL
- en: '***Connecting via a SOCKS Proxy***'
  id: totrans-984
  prefs: []
  type: TYPE_NORMAL
- en: To demonstrate accessing an application listening only on localhost, we’ll
  id: totrans-985
  prefs: []
  type: TYPE_NORMAL
- en: work with the Xplico application. You may remember seeing a warning
  id: totrans-986
  prefs: []
  type: TYPE_NORMAL
- en: on the SO welcome page that says port 9876 TCP for Xplico isn’t available
  id: totrans-987
  prefs: []
  type: TYPE_NORMAL
- en: remotely. By default, if you try to connect from a remote computer to port
  id: totrans-988
  prefs: []
  type: TYPE_NORMAL
- en: 9876 TCP on an SO system, iptables will deny the connection. Port 9876 TCP
  id: totrans-989
  prefs: []
  type: TYPE_NORMAL
- en: is available locally. If you open a web browser on the SO platform itself and
  id: totrans-990
  prefs: []
  type: TYPE_NORMAL
- en: point it to port 9876 TCP, Xplico is listening.
  id: totrans-991
  prefs: []
  type: TYPE_NORMAL
- en: If you want to access Xplico from your desktop, though, you need
  id: totrans-992
  prefs: []
  type: TYPE_NORMAL
- en: to simulate local access. You can connect to that port if you use SSH as a
  id: totrans-993
  prefs: []
  type: TYPE_NORMAL
- en: SOCKS proxy (a protocol designed to allow this sort of “tunnel” that simu-
  id: totrans-994
  prefs: []
  type: TYPE_NORMAL
- en: lates local access).
  id: totrans-995
  prefs: []
  type: TYPE_NORMAL
- en: Setting up a SOCKS proxy using SSH will allow you to remotely access
  id: totrans-996
  prefs: []
  type: TYPE_NORMAL
- en: an application listening only on localhost. You can achieve this goal using
  id: totrans-997
  prefs: []
  type: TYPE_NORMAL
- en: either a Microsoft Windows desktop or a Linux desktop.
  id: totrans-998
  prefs: []
  type: TYPE_NORMAL
- en: If your remote client runs Microsoft Windows, you can use the free PuTTY
  id: totrans-999
  prefs: []
  type: TYPE_NORMAL
- en: ( *http://www.chiark.greenend.org.uk/~sgtatham/putty/*) SSH client. PuTTY is
  id: totrans-1000
  prefs: []
  type: TYPE_NORMAL
- en: 'available as a single *.exe* binary that doesn’t require any sort of installation
    procedure. Follow these steps:'
  id: totrans-1001
  prefs: []
  type: TYPE_NORMAL
- en: 1\. Run the *putty.exe* program and navigate to **Connection**4**SSH**4**Tunnels**.
  id: totrans-1002
  prefs: []
  type: TYPE_NORMAL
- en: In the Source port field, enter a TCP port that will listen on your local
  id: totrans-1003
  prefs: []
  type: TYPE_NORMAL
- en: system. (In this example, I use 8080 TCP).
  id: totrans-1004
  prefs: []
  type: TYPE_NORMAL
- en: 2\. Select the **Dynamic** and **Auto** radio buttons, and then click **Add**.
    Your setup should look like Figure 5-3\.
  id: totrans-1005
  prefs: []
  type: TYPE_NORMAL
- en: 3\. Return to PuTTY’s Session section and enter the hostname or IP address
  id: totrans-1006
  prefs: []
  type: TYPE_NORMAL
- en: and port of your remote SO stand-alone system, and then click **Open**.
  id: totrans-1007
  prefs: []
  type: TYPE_NORMAL
- en: 4\. Log in to the SO system with the username and password you chose
  id: totrans-1008
  prefs: []
  type: TYPE_NORMAL
- en: during setup.
  id: totrans-1009
  prefs: []
  type: TYPE_NORMAL
- en: 5\. Open your web browser and choose the option for configuring network
  id: totrans-1010
  prefs: []
  type: TYPE_NORMAL
- en: settings. For example, if you’re using Firefox, choose **Options**4**Network**4
  id: totrans-1011
  prefs: []
  type: TYPE_NORMAL
- en: '**Settings**, and then configure the connection settings for Manual Proxy'
  id: totrans-1012
  prefs: []
  type: TYPE_NORMAL
- en: Configuration with SOCKS Host set to 127.0.0.1 and Port set to the port
  id: totrans-1013
  prefs: []
  type: TYPE_NORMAL
- en: you configured in PuTTY. Figure 5-4 shows my settings. Click **OK** to
  id: totrans-1014
  prefs: []
  type: TYPE_NORMAL
- en: continue.
  id: totrans-1015
  prefs: []
  type: TYPE_NORMAL
- en: 6\. Point Firefox to *https://127.0.0.1:9876*. Your browser should redirect
    to
  id: totrans-1016
  prefs: []
  type: TYPE_NORMAL
- en: '*https://127.0.0.1:9876/users/login* and warn that Xplico is not running.'
  id: totrans-1017
  prefs: []
  type: TYPE_NORMAL
- en: This is okay; you’ve accessed the web server at port 9876 TCP, which
  id: totrans-1018
  prefs: []
  type: TYPE_NORMAL
- en: was previously not reachable remotely.
  id: totrans-1019
  prefs: []
  type: TYPE_NORMAL
- en: SO Platform Housekeeping **103**
  id: totrans-1020
  prefs: []
  type: TYPE_NORMAL
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-1021
  prefs: []
  type: TYPE_NORMAL
- en: '![Image 70](index-138_1.png)'
  id: totrans-1022
  prefs: []
  type: TYPE_IMG
- en: '![Image 71](index-138_2.png)'
  id: totrans-1023
  prefs: []
  type: TYPE_IMG
- en: '*Figure 5-3: Configuring PuTTY for SSH port forwarding*'
  id: totrans-1024
  prefs: []
  type: TYPE_NORMAL
- en: '*Figure 5-4: Configuring proxy set ings in Firefox*'
  id: totrans-1025
  prefs: []
  type: TYPE_NORMAL
- en: '**104** Chapter 5'
  id: totrans-1026
  prefs: []
  type: TYPE_NORMAL
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-1027
  prefs: []
  type: TYPE_NORMAL
- en: If your remote client is a Linux system, you can achieve the same goal using
    the integrated SSH client. On your Linux desktop, run the following
  id: totrans-1028
  prefs: []
  type: TYPE_NORMAL
- en: 'command:'
  id: totrans-1029
  prefs: []
  type: TYPE_NORMAL
- en: '**ssh -L 9876:localhost:9876 *username*****@ *SO server IP***'
  id: totrans-1030
  prefs: []
  type: TYPE_NORMAL
- en: With your tunnel established, follow steps 4 and 5 in the preceding pro-
  id: totrans-1031
  prefs: []
  type: TYPE_NORMAL
- en: cedure for configuring the Firefox web browser for a Windows remote client
  id: totrans-1032
  prefs: []
  type: TYPE_NORMAL
- en: and accessing the web server.
  id: totrans-1033
  prefs: []
  type: TYPE_NORMAL
- en: '***Changing the Firewall Policy***'
  id: totrans-1034
  prefs: []
  type: TYPE_NORMAL
- en: If you don’t want to tunnel traffic to bypass the firewall, you could modify
  id: totrans-1035
  prefs: []
  type: TYPE_NORMAL
- en: the firewall rules. For example, the following command changes the ruleset
  id: totrans-1036
  prefs: []
  type: TYPE_NORMAL
- en: to permit remote access to port 9876 TCP.
  id: totrans-1037
  prefs: []
  type: TYPE_NORMAL
- en: $ **sudo ufw allow 9876/tcp**
  id: totrans-1038
  prefs: []
  type: TYPE_NORMAL
- en: Rule added
  id: totrans-1039
  prefs: []
  type: TYPE_NORMAL
- en: Rule added (v6)
  id: totrans-1040
  prefs: []
  type: TYPE_NORMAL
- en: 'To disallow that port again, enter this:'
  id: totrans-1041
  prefs: []
  type: TYPE_NORMAL
- en: $ **sudo ufw deny 9876/tcp**
  id: totrans-1042
  prefs: []
  type: TYPE_NORMAL
- en: Rule updated
  id: totrans-1043
  prefs: []
  type: TYPE_NORMAL
- en: Rule updated (v6)
  id: totrans-1044
  prefs: []
  type: TYPE_NORMAL
- en: See the SO wiki for more information about configuring the firewall
  id: totrans-1045
  prefs: []
  type: TYPE_NORMAL
- en: ( *https://code.google.com/p/security-onion/wiki/Firewall*).
  id: totrans-1046
  prefs: []
  type: TYPE_NORMAL
- en: '**Managing So data Storage**'
  id: totrans-1047
  prefs: []
  type: TYPE_NORMAL
- en: As soon as you install and configure SO and cable its sniffing interface to
    a
  id: totrans-1048
  prefs: []
  type: TYPE_NORMAL
- en: live network, the NSM software begins collecting and interpreting traffic.
  id: totrans-1049
  prefs: []
  type: TYPE_NORMAL
- en: The SO sensors store a variety of NSM datatypes, but two directories are of
  id: totrans-1050
  prefs: []
  type: TYPE_NORMAL
- en: 'particular interest:'
  id: totrans-1051
  prefs: []
  type: TYPE_NORMAL
- en: • The */nsm* directory stores logs and full content data.
  id: totrans-1052
  prefs: []
  type: TYPE_NORMAL
- en: • The */var/lib/mysql* directory holds SO’s databases.
  id: totrans-1053
  prefs: []
  type: TYPE_NORMAL
- en: The */nsm* directory typically uses more drive space than */var/lib/mysql*.
  id: totrans-1054
  prefs: []
  type: TYPE_NORMAL
- en: SO saves full content data in the */nsm/sensor_data/<sensorname-interface>/*
  id: totrans-1055
  prefs: []
  type: TYPE_NORMAL
- en: '*dailylogs/YYYY-MM-DD* directories with filenames in *snort.log.<Unix timestamp>*
    format. Although the filenames have *snort* in the title, the content is in the
    familiar pcap format. Listing 5-3 shows full content data stored on a standalone
    demo SO platform in two directories.'
  id: totrans-1056
  prefs: []
  type: TYPE_NORMAL
- en: SO Platform Housekeeping **105**
  id: totrans-1057
  prefs: []
  type: TYPE_NORMAL
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-1058
  prefs: []
  type: TYPE_NORMAL
- en: sademo@sademo:/nsm/sensor_data/sademo-eth1/dailylogs$ **ls -alR**
  id: totrans-1059
  prefs: []
  type: TYPE_NORMAL
- en: '.:'
  id: totrans-1060
  prefs: []
  type: TYPE_NORMAL
- en: total 16
  id: totrans-1061
  prefs: []
  type: TYPE_NORMAL
- en: drwxrwxr-x 4 sguil sguil 4096 Feb 16 12:28 .
  id: totrans-1062
  prefs: []
  type: TYPE_NORMAL
- en: drwxrwxr-x 7 sguil sguil 4096 Feb 10 11:12 ..
  id: totrans-1063
  prefs: []
  type: TYPE_NORMAL
- en: drwxrwxr-x 2 sguil sguil 4096 Feb 10 13:09 2014-02-10
  id: totrans-1064
  prefs: []
  type: TYPE_NORMAL
- en: drwxrwxr-x 2 sguil sguil 4096 Feb 16 20:15 2014-02-16
  id: totrans-1065
  prefs: []
  type: TYPE_NORMAL
- en: './2013-02-10:'
  id: totrans-1066
  prefs: []
  type: TYPE_NORMAL
- en: total 118060
  id: totrans-1067
  prefs: []
  type: TYPE_NORMAL
- en: drwxrwxr-x 2 sguil sguil 4096 Feb 10 13:09 .
  id: totrans-1068
  prefs: []
  type: TYPE_NORMAL
- en: drwxrwxr-x 4 sguil sguil 4096 Feb 16 12:28 ..
  id: totrans-1069
  prefs: []
  type: TYPE_NORMAL
- en: -rw-r--r-- 1 root root 108390541 Feb 10 11:31 snort.log.1360494635
  id: totrans-1070
  prefs: []
  type: TYPE_NORMAL
- en: -rw-r--r-- 1 root root 12485022 Feb 10 13:17 snort.log.1360501765
  id: totrans-1071
  prefs: []
  type: TYPE_NORMAL
- en: './2014-02-16:'
  id: totrans-1072
  prefs: []
  type: TYPE_NORMAL
- en: total 645312
  id: totrans-1073
  prefs: []
  type: TYPE_NORMAL
- en: drwxrwxr-x 2 sguil sguil 4096 Feb 16 20:15 .
  id: totrans-1074
  prefs: []
  type: TYPE_NORMAL
- en: drwxrwxr-x 4 sguil sguil 4096 Feb 16 12:28 ..
  id: totrans-1075
  prefs: []
  type: TYPE_NORMAL
- en: -rw-r--r-- 1 root root 10637153 Feb 16 12:41 snort.log.1361017706
  id: totrans-1076
  prefs: []
  type: TYPE_NORMAL
- en: -rw-r--r-- 1 root root 122264262 Feb 16 14:29 snort.log.1361019690
  id: totrans-1077
  prefs: []
  type: TYPE_NORMAL
- en: '*-- snip --*'
  id: totrans-1078
  prefs: []
  type: TYPE_NORMAL
- en: '*Listing 5-3: Directory contents for* /nsm/sensor_data/sademo-eth1/dailylogs'
  id: totrans-1079
  prefs: []
  type: TYPE_NORMAL
- en: The date on the directory listing is the time the file was last modified.
  id: totrans-1080
  prefs: []
  type: TYPE_NORMAL
- en: The date in the *snort.log<Unix timestamp>* filename is the time the file was
    created, in Unix timestamp format. This format is expressed as the number
  id: totrans-1081
  prefs: []
  type: TYPE_NORMAL
- en: of seconds elapsed since January 1, 1970\.
  id: totrans-1082
  prefs: []
  type: TYPE_NORMAL
- en: You can translate the Unix timestamp into more familiar terms with the
  id: totrans-1083
  prefs: []
  type: TYPE_NORMAL
- en: date command. For example, running date against the file *snort.log.1360494635*,
    we learn that the trace was created about 21 minutes before the system stopped
  id: totrans-1084
  prefs: []
  type: TYPE_NORMAL
- en: writing to it. We know this because the timestamp on the file is Feb 10 11:31,
  id: totrans-1085
  prefs: []
  type: TYPE_NORMAL
- en: and the “translated” date from the filename is Feb 10 11:10:35\. We can see
  id: totrans-1086
  prefs: []
  type: TYPE_NORMAL
- en: that the file was opened at roughly 11:10, and it was last written to 21 minutes
  id: totrans-1087
  prefs: []
  type: TYPE_NORMAL
- en: later, at 11:31\.
  id: totrans-1088
  prefs: []
  type: TYPE_NORMAL
- en: $ **date --date='@1360494635'**
  id: totrans-1089
  prefs: []
  type: TYPE_NORMAL
- en: Sun Feb 10 11:10:35 UTC 2013
  id: totrans-1090
  prefs: []
  type: TYPE_NORMAL
- en: '***Managing Sensor Storage***'
  id: totrans-1091
  prefs: []
  type: TYPE_NORMAL
- en: To manage sensor storage, SO scripts check the amount of available hard
  id: totrans-1092
  prefs: []
  type: TYPE_NORMAL
- en: drive space regularly. As the used space hits the 90 percent threshold, the
  id: totrans-1093
  prefs: []
  type: TYPE_NORMAL
- en: scripts remove old full content (pcap) files from the */nsm/ sensor_data/*
  id: totrans-1094
  prefs: []
  type: TYPE_NORMAL
- en: '*<sensorname-interface>/dailylogs* directories, old Bro logs from */nsm/bro/logs*,
    old Argus session data from */nsm/sensor_data/<sensorname-interface>/*'
  id: totrans-1095
  prefs: []
  type: TYPE_NORMAL
- en: '*dailylogs/argus*, and old Snort Unified2 alert files from */nsm/sensor_data/*'
  id: totrans-1096
  prefs: []
  type: TYPE_NORMAL
- en: '*<sensorname-interface>/snort-<instancenumber>* . Part III of this book covers
    these and other SO tools. For now, it’s important to know that these logs'
  id: totrans-1097
  prefs: []
  type: TYPE_NORMAL
- en: exist and how the system manages them.
  id: totrans-1098
  prefs: []
  type: TYPE_NORMAL
- en: '**106** Chapter 5'
  id: totrans-1099
  prefs: []
  type: TYPE_NORMAL
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-1100
  prefs: []
  type: TYPE_NORMAL
- en: The system works by having the Linux cron command run the */usr/*
  id: totrans-1101
  prefs: []
  type: TYPE_NORMAL
- en: '*sbin/nsm_sensor_clean* script hourly, which calls the sensor_cleandisk() func-'
  id: totrans-1102
  prefs: []
  type: TYPE_NORMAL
- en: tion found in */usr/lib/nsmnow/lib-nsm-sensor-utils*. The sensor_cleandisk()
  id: totrans-1103
  prefs: []
  type: TYPE_NORMAL
- en: function in *lib-nsm-sensor-utils* contains the 90 percent value that triggers
  id: totrans-1104
  prefs: []
  type: TYPE_NORMAL
- en: deleting old logs. Although this daily check at 90 percent works well for
  id: totrans-1105
  prefs: []
  type: TYPE_NORMAL
- en: most users, you can change it to suit your needs if necessary. If you want
  id: totrans-1106
  prefs: []
  type: TYPE_NORMAL
- en: to change the 90 percent figure, edit it in the *lib-nsm-sensor-utils* file.
  id: totrans-1107
  prefs: []
  type: TYPE_NORMAL
- en: '***Checking Database Drive Usage***'
  id: totrans-1108
  prefs: []
  type: TYPE_NORMAL
- en: To check the size of SO’s databases in */var/lib/mysql*, use MySQL command
  id: totrans-1109
  prefs: []
  type: TYPE_NORMAL
- en: shown in Listing 5-4\. (Thanks to RolandoMySQLdba for posting this at
  id: totrans-1110
  prefs: []
  type: TYPE_NORMAL
- en: '*http://pastebin.com/YFqNaVi3/*.)'
  id: totrans-1111
  prefs: []
  type: TYPE_NORMAL
- en: $ **mysql -u root**
  id: totrans-1112
  prefs: []
  type: TYPE_NORMAL
- en: Welcome to the MySQL monitor. Commands end with ; or \g.
  id: totrans-1113
  prefs: []
  type: TYPE_NORMAL
- en: Your MySQL connection id is 386507
  id: totrans-1114
  prefs: []
  type: TYPE_NORMAL
- en: 'Server version: 5.5.29-0ubuntu0.12.04.1 (Ubuntu)'
  id: totrans-1115
  prefs: []
  type: TYPE_NORMAL
- en: Copyright (c) 2000, 2012, Oracle and/or its affiliates. All rights reserved.
  id: totrans-1116
  prefs: []
  type: TYPE_NORMAL
- en: Oracle is a registered trademark of Oracle Corporation and/or its
  id: totrans-1117
  prefs: []
  type: TYPE_NORMAL
- en: affiliates. Other names may be trademarks of their respective owners.
  id: totrans-1118
  prefs: []
  type: TYPE_NORMAL
- en: Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.
  id: totrans-1119
  prefs: []
  type: TYPE_NORMAL
- en: mysql> **SELECT DBName,CONCAT(LPAD(FORMAT(SDSize/POWER(1024,pw),3),17,' '),'
    ',**
  id: totrans-1120
  prefs: []
  type: TYPE_NORMAL
- en: '**-> SUBSTR('' KMGTP'',pw+1,1),''B'') "Data Size",CONCAT(LPAD(**'
  id: totrans-1121
  prefs: []
  type: TYPE_NORMAL
- en: '**-> FORMAT(SXSize/POWER(1024,pw),3),17,'' ''),'' '',SUBSTR('' KMGTP'',pw+1,1),''B'')
    "Index Size",**'
  id: totrans-1122
  prefs: []
  type: TYPE_NORMAL
- en: '**-> CONCAT(LPAD(FORMAT(STSize/POWER(1024,pw),3),17,'' ''),'' '',**'
  id: totrans-1123
  prefs: []
  type: TYPE_NORMAL
- en: '**-> SUBSTR('' KMGTP'',pw+1,1),''B'') "Total Size" FROM**'
  id: totrans-1124
  prefs: []
  type: TYPE_NORMAL
- en: '**-> (SELECT IFNULL(DB,''All Databases'') DBName,SUM(DSize) SDSize,SUM(XSize)
    SXSize,**'
  id: totrans-1125
  prefs: []
  type: TYPE_NORMAL
- en: '**-> SUM(TSize) STSize FROM (SELECT table_schema DB,data_length DSize,**'
  id: totrans-1126
  prefs: []
  type: TYPE_NORMAL
- en: '**-> index_length XSize,data_length+index_length TSize FROM information_schema.tables**'
  id: totrans-1127
  prefs: []
  type: TYPE_NORMAL
- en: '**-> WHERE table_schema NOT IN (''mysql'',''information_schema'',''performance_schema''))
    AAA**'
  id: totrans-1128
  prefs: []
  type: TYPE_NORMAL
- en: '**-> GROUP BY DB WITH ROLLUP) AA,(SELECT 3 pw) BB ORDER BY (SDSize+SXSize);**'
  id: totrans-1129
  prefs: []
  type: TYPE_NORMAL
- en: +------------------+----------------------+----------------------+----------------------+
  id: totrans-1130
  prefs: []
  type: TYPE_NORMAL
- en: '| DBName | Data Size | Index Size | Total Size |'
  id: totrans-1131
  prefs: []
  type: TYPE_TB
- en: +------------------+----------------------+----------------------+----------------------+
  id: totrans-1132
  prefs: []
  type: TYPE_NORMAL
- en: '| elsa_web | 0.000 GB | 0.000 GB | 0.000 GB |'
  id: totrans-1133
  prefs: []
  type: TYPE_TB
- en: '| syslog | 0.014 GB | 0.007 GB | 0.021 GB |'
  id: totrans-1134
  prefs: []
  type: TYPE_TB
- en: '| snorby | 0.059 GB | 0.020 GB | 0.079 GB |'
  id: totrans-1135
  prefs: []
  type: TYPE_TB
- en: '| syslog_data | 1.625 GB | 0.050 GB | 1.675 GB |'
  id: totrans-1136
  prefs: []
  type: TYPE_TB
- en: '| securityonion_db | 3.384 GB | 0.377 GB | 3.761 GB |'
  id: totrans-1137
  prefs: []
  type: TYPE_TB
- en: '| All Databases | 5.082 GB | 0.454 GB | 5.536 GB |'
  id: totrans-1138
  prefs: []
  type: TYPE_TB
- en: +------------------+----------------------+----------------------+----------------------+
  id: totrans-1139
  prefs: []
  type: TYPE_NORMAL
- en: 6 rows in set (2.20 sec)
  id: totrans-1140
  prefs: []
  type: TYPE_NORMAL
- en: '*Listing 5-4: Displaying storage used by database tables*'
  id: totrans-1141
  prefs: []
  type: TYPE_NORMAL
- en: In this example, the databases in use occupy a total of 5.536GB.
  id: totrans-1142
  prefs: []
  type: TYPE_NORMAL
- en: The securityonion_db database used by Sguil and its components occupies
  id: totrans-1143
  prefs: []
  type: TYPE_NORMAL
- en: 3.761GB, and the syslog_data database used by ELSA occupies 1.675GB.
  id: totrans-1144
  prefs: []
  type: TYPE_NORMAL
- en: SO Platform Housekeeping **107**
  id: totrans-1145
  prefs: []
  type: TYPE_NORMAL
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-1146
  prefs: []
  type: TYPE_NORMAL
- en: '***Managing the Sguil Database***'
  id: totrans-1147
  prefs: []
  type: TYPE_NORMAL
- en: SO also ships with a sguil-db-purge script to manage the Sguil database
  id: totrans-1148
  prefs: []
  type: TYPE_NORMAL
- en: securityonion_db. The configuration file */etc/nsm/securityonion.conf* contains
    a DAYSTOKEEP variable, as shown in Listing 5-5\.
  id: totrans-1149
  prefs: []
  type: TYPE_NORMAL
- en: ENGINE=snort
  id: totrans-1150
  prefs: []
  type: TYPE_NORMAL
- en: DAYSTOKEEP=365
  id: totrans-1151
  prefs: []
  type: TYPE_NORMAL
- en: ELSA=YES
  id: totrans-1152
  prefs: []
  type: TYPE_NORMAL
- en: '*Listing 5-5: DAYSTOKEEP variable in* /etc/nsm/securityonion .conf'
  id: totrans-1153
  prefs: []
  type: TYPE_NORMAL
- en: When SO runs sguil-db-purge, it removes data older than the default
  id: totrans-1154
  prefs: []
  type: TYPE_NORMAL
- en: 365 days from the securityonion_db database. You can edit the DAYSTOKEEP
  id: totrans-1155
  prefs: []
  type: TYPE_NORMAL
- en: variable if you begin to run out of hard drive space.
  id: totrans-1156
  prefs: []
  type: TYPE_NORMAL
- en: To manage the syslog_data database, ELSA offers a configuration vari-
  id: totrans-1157
  prefs: []
  type: TYPE_NORMAL
- en: able that controls how much disk space it will use. The file */etc/elsa_node.conf*
  id: totrans-1158
  prefs: []
  type: TYPE_NORMAL
- en: contains the entry shown in Listing 5-6\.
  id: totrans-1159
  prefs: []
  type: TYPE_NORMAL
- en: Size limit for logs + index size. Set this to be 90-95% of your total data disk
    space.
  id: totrans-1160
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: '"log_size_limit" : 200000000000,'
  id: totrans-1161
  prefs: []
  type: TYPE_NORMAL
- en: '*Listing 5-6: Size limit entry in* /etc/elsa_node .conf'
  id: totrans-1162
  prefs: []
  type: TYPE_NORMAL
- en: The log_size_limit variable is set according to a number of bytes, so the
  id: totrans-1163
  prefs: []
  type: TYPE_NORMAL
- en: default translates to roughly 187GB. Raise or lower this value to manage
  id: totrans-1164
  prefs: []
  type: TYPE_NORMAL
- en: ELSA database storage as necessary.
  id: totrans-1165
  prefs: []
  type: TYPE_NORMAL
- en: '***Tracking Disk Usage***'
  id: totrans-1166
  prefs: []
  type: TYPE_NORMAL
- en: Although SO offers automatic ways to manage hard disk space, it isn’t a
  id: totrans-1167
  prefs: []
  type: TYPE_NORMAL
- en: completely deploy-and-forget appliance. Keep an eye on disk usage using
  id: totrans-1168
  prefs: []
  type: TYPE_NORMAL
- en: the df -h command and the more granular du -csh commands shown in
  id: totrans-1169
  prefs: []
  type: TYPE_NORMAL
- en: Listing 5-7\.
  id: totrans-1170
  prefs: []
  type: TYPE_NORMAL
- en: $ **sudo df -h**
  id: totrans-1171
  prefs: []
  type: TYPE_NORMAL
- en: Filesystem Size Used Avail Use% Mounted on
  id: totrans-1172
  prefs: []
  type: TYPE_NORMAL
- en: /dev/sda1 456G 96G 337G 23% /
  id: totrans-1173
  prefs: []
  type: TYPE_NORMAL
- en: udev 1.5G 4.0K 1.5G 1% /dev
  id: totrans-1174
  prefs: []
  type: TYPE_NORMAL
- en: tmpfs 603M 876K 602M 1% /run
  id: totrans-1175
  prefs: []
  type: TYPE_NORMAL
- en: none 5.0M 0 5.0M 0% /run/lock
  id: totrans-1176
  prefs: []
  type: TYPE_NORMAL
- en: none 1.5G 216K 1.5G 1% /run/shm
  id: totrans-1177
  prefs: []
  type: TYPE_NORMAL
- en: $ **sudo du -csh /nsm**
  id: totrans-1178
  prefs: []
  type: TYPE_NORMAL
- en: 86G /nsm
  id: totrans-1179
  prefs: []
  type: TYPE_NORMAL
- en: 86G total
  id: totrans-1180
  prefs: []
  type: TYPE_NORMAL
- en: '*Listing 5-7: Disk usage commands*'
  id: totrans-1181
  prefs: []
  type: TYPE_NORMAL
- en: '**108** Chapter 5'
  id: totrans-1182
  prefs: []
  type: TYPE_NORMAL
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-1183
  prefs: []
  type: TYPE_NORMAL
- en: As you can see, this sensor has plenty of space available on the hard disk (
    */dev/sda1*), with only 23 percent in use. The */nsm* directory occupies 86GB
  id: totrans-1184
  prefs: []
  type: TYPE_NORMAL
- en: of the 96GB taken up by the whole partition. The example of a database
  id: totrans-1185
  prefs: []
  type: TYPE_NORMAL
- en: size check earlier in this chapter showed that all of the databases occupied
  id: totrans-1186
  prefs: []
  type: TYPE_NORMAL
- en: 5.536GB. Windows users might be more familiar with graphical representa-
  id: totrans-1187
  prefs: []
  type: TYPE_NORMAL
- en: tions of hard disk usage. On Linux, it’s useful to become acquainted with
  id: totrans-1188
  prefs: []
  type: TYPE_NORMAL
- en: the sorts of percentages and listings produced by commands like df.
  id: totrans-1189
  prefs: []
  type: TYPE_NORMAL
- en: '**conclusion**'
  id: totrans-1190
  prefs: []
  type: TYPE_NORMAL
- en: 'This chapter explained a few core administrative chores: keeping software'
  id: totrans-1191
  prefs: []
  type: TYPE_NORMAL
- en: up-to-date, limiting network access to promote security, and managing
  id: totrans-1192
  prefs: []
  type: TYPE_NORMAL
- en: system storage. These are by no means the only skills required for system
  id: totrans-1193
  prefs: []
  type: TYPE_NORMAL
- en: administration, but thankfully, the SO project has made caring for NSM
  id: totrans-1194
  prefs: []
  type: TYPE_NORMAL
- en: platforms easy. With these fundamental skills, you can keep your SO sys-
  id: totrans-1195
  prefs: []
  type: TYPE_NORMAL
- en: tems running smartly with a minimum of effort.
  id: totrans-1196
  prefs: []
  type: TYPE_NORMAL
- en: In the following chapters, we’ll look at the software and data you can
  id: totrans-1197
  prefs: []
  type: TYPE_NORMAL
- en: use to collect and interpret network data.
  id: totrans-1198
  prefs: []
  type: TYPE_NORMAL
- en: SO Platform Housekeeping **109**
  id: totrans-1199
  prefs: []
  type: TYPE_NORMAL
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-1200
  prefs: []
  type: TYPE_NORMAL
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-1201
  prefs: []
  type: TYPE_NORMAL
- en: '**Part III**'
  id: totrans-1202
  prefs: []
  type: TYPE_NORMAL
- en: '**T o o l S**'
  id: totrans-1203
  prefs: []
  type: TYPE_NORMAL
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-1204
  prefs: []
  type: TYPE_NORMAL
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-1205
  prefs: []
  type: TYPE_NORMAL
- en: '**6**'
  id: totrans-1206
  prefs: []
  type: TYPE_NORMAL
- en: '**c o M M a N D l i N e Pa c k e T**'
  id: totrans-1207
  prefs: []
  type: TYPE_NORMAL
- en: '**a N a ly S i S T o o l S**'
  id: totrans-1208
  prefs: []
  type: TYPE_NORMAL
- en: In Chapters 3 and 4 we installed the SO
  id: totrans-1209
  prefs: []
  type: TYPE_NORMAL
- en: software in several configurations, and
  id: totrans-1210
  prefs: []
  type: TYPE_NORMAL
- en: we discussed housekeeping functions in
  id: totrans-1211
  prefs: []
  type: TYPE_NORMAL
- en: Chapter 5\. Now that you have this powerful
  id: totrans-1212
  prefs: []
  type: TYPE_NORMAL
- en: NSM platform collecting data, in this chapter I’ll
  id: totrans-1213
  prefs: []
  type: TYPE_NORMAL
- en: introduce the first set of command line tools used to
  id: totrans-1214
  prefs: []
  type: TYPE_NORMAL
- en: present information to analysts. Some of these tools will be running all
  id: totrans-1215
  prefs: []
  type: TYPE_NORMAL
- en: the time, while others will be invoked on demand. Each has its particular
  id: totrans-1216
  prefs: []
  type: TYPE_NORMAL
- en: strengths and weaknesses. I’ll discuss how I use key features, though I won’t
  id: totrans-1217
  prefs: []
  type: TYPE_NORMAL
- en: cover all tools in exhaustive detail here.
  id: totrans-1218
  prefs: []
  type: TYPE_NORMAL
- en: Because I’ve written this book for new analysts, my discussion of SO
  id: totrans-1219
  prefs: []
  type: TYPE_NORMAL
- en: tools in this part will concentrate on data presentation. In this chapter I
  id: totrans-1220
  prefs: []
  type: TYPE_NORMAL
- en: will look at data presentation tools that use a command line interface. In
  id: totrans-1221
  prefs: []
  type: TYPE_NORMAL
- en: Chapter 7 I’ll address data presentation tools that use a graphical inter-
  id: totrans-1222
  prefs: []
  type: TYPE_NORMAL
- en: face, and in Chapter 8 I’ll examine specialized forms of data presentation
  id: totrans-1223
  prefs: []
  type: TYPE_NORMAL
- en: tools—the NSM consoles. For now, let’s step back and understand how all
  id: totrans-1224
  prefs: []
  type: TYPE_NORMAL
- en: the NSM tools packaged with SO relate to one another.
  id: totrans-1225
  prefs: []
  type: TYPE_NORMAL
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-1226
  prefs: []
  type: TYPE_NORMAL
- en: '**So Tool categories**'
  id: totrans-1227
  prefs: []
  type: TYPE_NORMAL
- en: SO ships with a variety of tools, as listed on the SO wiki ( *http://code.google*
  id: totrans-1228
  prefs: []
  type: TYPE_NORMAL
- en: '*.com/p/security-onion/wiki/Tools*). Some tools present data to analysts, some'
  id: totrans-1229
  prefs: []
  type: TYPE_NORMAL
- en: collect data directly from the network or via messages from other comput-
  id: totrans-1230
  prefs: []
  type: TYPE_NORMAL
- en: ers, and a third category sits between the others as middleware, delivering
  id: totrans-1231
  prefs: []
  type: TYPE_NORMAL
- en: data or providing other essential capabilities. Let’s take a brief look at each
  id: totrans-1232
  prefs: []
  type: TYPE_NORMAL
- en: 'category of tools: data presentation, data collection, and data delivery.'
  id: totrans-1233
  prefs: []
  type: TYPE_NORMAL
- en: '***SO Data Presentation Tools***'
  id: totrans-1234
  prefs: []
  type: TYPE_NORMAL
- en: '*Data presentation tools* expose NSM information to analysts. Two sorts of'
  id: totrans-1235
  prefs: []
  type: TYPE_NORMAL
- en: data presentation tools for packet analysis are available in SO. One relies
    on
  id: totrans-1236
  prefs: []
  type: TYPE_NORMAL
- en: a command line interface, and the other offers analysts a graphical inter-
  id: totrans-1237
  prefs: []
  type: TYPE_NORMAL
- en: face. SO also provides NSM consoles for data presentation.
  id: totrans-1238
  prefs: []
  type: TYPE_NORMAL
- en: '**Packet analysis tools**'
  id: totrans-1239
  prefs: []
  type: TYPE_NORMAL
- en: '*Packet analysis tools* read network traffic from a live interface, or from
    a file containing traffic saved in pcap format. Analysts use packet analysis tools
    to'
  id: totrans-1240
  prefs: []
  type: TYPE_NORMAL
- en: better interpret network traffic, but not necessarily to implement an NSM-
  id: totrans-1241
  prefs: []
  type: TYPE_NORMAL
- en: specific investigation or workflow. Some of these tools help analysts better
  id: totrans-1242
  prefs: []
  type: TYPE_NORMAL
- en: understand individual packets, others group packets into sessions, and still
  id: totrans-1243
  prefs: []
  type: TYPE_NORMAL
- en: others examine application data. The authors of these tools generally did
  id: totrans-1244
  prefs: []
  type: TYPE_NORMAL
- en: not build them with NSM in mind, but nevertheless, they are key to under-
  id: totrans-1245
  prefs: []
  type: TYPE_NORMAL
- en: standing network traffic.
  id: totrans-1246
  prefs: []
  type: TYPE_NORMAL
- en: Two sorts of data presentation tools for packet analysis are available with
  id: totrans-1247
  prefs: []
  type: TYPE_NORMAL
- en: SO. One relies on a command line interface. These tools include Tcpdump,
  id: totrans-1248
  prefs: []
  type: TYPE_NORMAL
- en: Tshark, and the Argus Ra client, all examined in this chapter. Because
  id: totrans-1249
  prefs: []
  type: TYPE_NORMAL
- en: certain uses of Tshark depend on a related data collection tool, Dumpcap,
  id: totrans-1250
  prefs: []
  type: TYPE_NORMAL
- en: I’ll present it along with Tshark. The second sort of tool for packet analysis
  id: totrans-1251
  prefs: []
  type: TYPE_NORMAL
- en: offers analysts a graphical interface. Wireshark, Xplico, and NetworkMiner
  id: totrans-1252
  prefs: []
  type: TYPE_NORMAL
- en: are examples of this sort of software, and I discuss them in Chapter 7\.
  id: totrans-1253
  prefs: []
  type: TYPE_NORMAL
- en: '**NSM Consoles**'
  id: totrans-1254
  prefs: []
  type: TYPE_NORMAL
- en: '*NSM consoles* were built with NSM-specific investigation and workflows in'
  id: totrans-1255
  prefs: []
  type: TYPE_NORMAL
- en: mind. The console authors began with the core NSM principles and imple-
  id: totrans-1256
  prefs: []
  type: TYPE_NORMAL
- en: mented them in software. These tools also function as data presentation
  id: totrans-1257
  prefs: []
  type: TYPE_NORMAL
- en: applications, but they act more as gateways to NSM data. Software in this
  id: totrans-1258
  prefs: []
  type: TYPE_NORMAL
- en: category includes Sguil, Squert, Snorby, and ELSA. I’ll explain how to use
  id: totrans-1259
  prefs: []
  type: TYPE_NORMAL
- en: these NSM consoles in Chapter 8\.
  id: totrans-1260
  prefs: []
  type: TYPE_NORMAL
- en: '**114** Chapter 6'
  id: totrans-1261
  prefs: []
  type: TYPE_NORMAL
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-1262
  prefs: []
  type: TYPE_NORMAL
- en: '***SO Data Col ection Tools***'
  id: totrans-1263
  prefs: []
  type: TYPE_NORMAL
- en: Once NSM analysts become comfortable with the data presentation tools,
  id: totrans-1264
  prefs: []
  type: TYPE_NORMAL
- en: they turn to *data collection tools*. Software in this category includes the
    Argus server, Netsniff-ng, Passive Real-Time Asset Detection System (PRADS),
  id: totrans-1265
  prefs: []
  type: TYPE_NORMAL
- en: Snort, Suricata, and Bro. (Dumpcap belongs in this category as well, but SO
  id: totrans-1266
  prefs: []
  type: TYPE_NORMAL
- en: does not enable it by default.) These applications collect and generate the
  id: totrans-1267
  prefs: []
  type: TYPE_NORMAL
- en: NSM data available to the presentation tools.
  id: totrans-1268
  prefs: []
  type: TYPE_NORMAL
- en: The Argus server and PRADS create and store their own forms of session
  id: totrans-1269
  prefs: []
  type: TYPE_NORMAL
- en: data. Argus data is stored in a proprietary binary format suited for rapid
  id: totrans-1270
  prefs: []
  type: TYPE_NORMAL
- en: command line mining, whereas PRADS data is best read through an NSM
  id: totrans-1271
  prefs: []
  type: TYPE_NORMAL
- en: console. Analysts can choose which form of data suits them best.
  id: totrans-1272
  prefs: []
  type: TYPE_NORMAL
- en: Netsniff-ng simply writes full content data to disk in pcap format. Snort
  id: totrans-1273
  prefs: []
  type: TYPE_NORMAL
- en: and Suricata are network intrusion detection systems, inspecting traffic and
  id: totrans-1274
  prefs: []
  type: TYPE_NORMAL
- en: writing alerts according to the signatures deployed with each tool. Bro
  id: totrans-1275
  prefs: []
  type: TYPE_NORMAL
- en: observes and interprets traffic that has been generated and logged as a
  id: totrans-1276
  prefs: []
  type: TYPE_NORMAL
- en: variety of NSM datatypes.
  id: totrans-1277
  prefs: []
  type: TYPE_NORMAL
- en: In the default configuration enabled by the SO platform, all of these
  id: totrans-1278
  prefs: []
  type: TYPE_NORMAL
- en: applications provide a wealth of NSM data to the presentation tools dis-
  id: totrans-1279
  prefs: []
  type: TYPE_NORMAL
- en: cussed in this chapter and the next two.
  id: totrans-1280
  prefs: []
  type: TYPE_NORMAL
- en: '***SO Data Delivery Tools***'
  id: totrans-1281
  prefs: []
  type: TYPE_NORMAL
- en: Finally, between the data presentation and data collection tools sits a suite
  id: totrans-1282
  prefs: []
  type: TYPE_NORMAL
- en: of *data delivery applications*. Broadly speaking, this middleware enables the
  id: totrans-1283
  prefs: []
  type: TYPE_NORMAL
- en: functionality of the other categories of software on the SO platform. Tools
  id: totrans-1284
  prefs: []
  type: TYPE_NORMAL
- en: like PulledPork, Barnyard2, and CapMe manage IDS rules, alert process-
  id: totrans-1285
  prefs: []
  type: TYPE_NORMAL
- en: ing, and pcap access, respectively.
  id: totrans-1286
  prefs: []
  type: TYPE_NORMAL
- en: A suite of “agents” associated with Sguil—such as pcap_agent, snort_agent,
  id: totrans-1287
  prefs: []
  type: TYPE_NORMAL
- en: and the like—shuttle data from the collection tools to the presentation soft-
  id: totrans-1288
  prefs: []
  type: TYPE_NORMAL
- en: ware. This includes the Apache web server, the MySQL database, and the
  id: totrans-1289
  prefs: []
  type: TYPE_NORMAL
- en: Sphinx index application, which may already be familiar to you.
  id: totrans-1290
  prefs: []
  type: TYPE_NORMAL
- en: Finally, SO includes tools for integrating certain host-centric analysis
  id: totrans-1291
  prefs: []
  type: TYPE_NORMAL
- en: features. These include the OSSEC host IDS and Syslog-ng for transport
  id: totrans-1292
  prefs: []
  type: TYPE_NORMAL
- en: and aggregation of log messages. Because this book concentrates on
  id: totrans-1293
  prefs: []
  type: TYPE_NORMAL
- en: network-centric data, we won’t examine data from OSSEC and Syslog-ng,
  id: totrans-1294
  prefs: []
  type: TYPE_NORMAL
- en: but you should know that those components are running on SO platforms.
  id: totrans-1295
  prefs: []
  type: TYPE_NORMAL
- en: Figure 6-1 shows the core SO tools in relation to one another. This
  id: totrans-1296
  prefs: []
  type: TYPE_NORMAL
- en: chapter covers the tools Tcpdump, Tshark, Dumpcap, and the Argus Ra
  id: totrans-1297
  prefs: []
  type: TYPE_NORMAL
- en: client. Chapter 7 covers Wireshark, Xplico, and NetworkMiner. Chapter 8
  id: totrans-1298
  prefs: []
  type: TYPE_NORMAL
- en: discusses the NSM consoles Sguil, Snorby, Squert, and ELSA. We’ll begin
  id: totrans-1299
  prefs: []
  type: TYPE_NORMAL
- en: our look at data presentation tools with Tcpdump.
  id: totrans-1300
  prefs: []
  type: TYPE_NORMAL
- en: Command Line Packet Analysis Tools **115**
  id: totrans-1301
  prefs: []
  type: TYPE_NORMAL
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-1302
  prefs: []
  type: TYPE_NORMAL
- en: NetworkMiner
  id: totrans-1303
  prefs: []
  type: TYPE_NORMAL
- en: Wireshark,
  id: totrans-1304
  prefs: []
  type: TYPE_NORMAL
- en: Sguil
  id: totrans-1305
  prefs: []
  type: TYPE_NORMAL
- en: Snorby or
  id: totrans-1306
  prefs: []
  type: TYPE_NORMAL
- en: ELSA
  id: totrans-1307
  prefs: []
  type: TYPE_NORMAL
- en: Interface for full
  id: totrans-1308
  prefs: []
  type: TYPE_NORMAL
- en: Interface for Bro
  id: totrans-1309
  prefs: []
  type: TYPE_NORMAL
- en: and Xplico
  id: totrans-1310
  prefs: []
  type: TYPE_NORMAL
- en: Tshark, and
  id: totrans-1311
  prefs: []
  type: TYPE_NORMAL
- en: Squert
  id: totrans-1312
  prefs: []
  type: TYPE_NORMAL
- en: Data
  id: totrans-1313
  prefs: []
  type: TYPE_NORMAL
- en: content data, alert
  id: totrans-1314
  prefs: []
  type: TYPE_NORMAL
- en: and alert data
  id: totrans-1315
  prefs: []
  type: TYPE_NORMAL
- en: Interface for full
  id: totrans-1316
  prefs: []
  type: TYPE_NORMAL
- en: Tcpdump
  id: totrans-1317
  prefs: []
  type: TYPE_NORMAL
- en: Interface for
  id: totrans-1318
  prefs: []
  type: TYPE_NORMAL
- en: presentation content data, alert
  id: totrans-1319
  prefs: []
  type: TYPE_NORMAL
- en: Protocol analyzers
  id: totrans-1320
  prefs: []
  type: TYPE_NORMAL
- en: data, session data,
  id: totrans-1321
  prefs: []
  type: TYPE_NORMAL
- en: alert data and
  id: totrans-1322
  prefs: []
  type: TYPE_NORMAL
- en: and some metadata
  id: totrans-1323
  prefs: []
  type: TYPE_NORMAL
- en: Argus Ra
  id: totrans-1324
  prefs: []
  type: TYPE_NORMAL
- en: data, session data,
  id: totrans-1325
  prefs: []
  type: TYPE_NORMAL
- en: for full content data
  id: totrans-1326
  prefs: []
  type: TYPE_NORMAL
- en: some metadata
  id: totrans-1327
  prefs: []
  type: TYPE_NORMAL
- en: and some metadata
  id: totrans-1328
  prefs: []
  type: TYPE_NORMAL
- en: Client for
  id: totrans-1329
  prefs: []
  type: TYPE_NORMAL
- en: session data
  id: totrans-1330
  prefs: []
  type: TYPE_NORMAL
- en: PulledPork
  id: totrans-1331
  prefs: []
  type: TYPE_NORMAL
- en: pcap_agent
  id: totrans-1332
  prefs: []
  type: TYPE_NORMAL
- en: Apache
  id: totrans-1333
  prefs: []
  type: TYPE_NORMAL
- en: OSSEC
  id: totrans-1334
  prefs: []
  type: TYPE_NORMAL
- en: Sphinx
  id: totrans-1335
  prefs: []
  type: TYPE_NORMAL
- en: Alert data
  id: totrans-1336
  prefs: []
  type: TYPE_NORMAL
- en: snort_agent
  id: totrans-1337
  prefs: []
  type: TYPE_NORMAL
- en: Web server
  id: totrans-1338
  prefs: []
  type: TYPE_NORMAL
- en: Host log alerting
  id: totrans-1339
  prefs: []
  type: TYPE_NORMAL
- en: ELSA log search
  id: totrans-1340
  prefs: []
  type: TYPE_NORMAL
- en: rule updates
  id: totrans-1341
  prefs: []
  type: TYPE_NORMAL
- en: Data
  id: totrans-1342
  prefs: []
  type: TYPE_NORMAL
- en: sancp_agent
  id: totrans-1343
  prefs: []
  type: TYPE_NORMAL
- en: and analysis
  id: totrans-1344
  prefs: []
  type: TYPE_NORMAL
- en: CapMe
  id: totrans-1345
  prefs: []
  type: TYPE_NORMAL
- en: MySQL
  id: totrans-1346
  prefs: []
  type: TYPE_NORMAL
- en: delivery
  id: totrans-1347
  prefs: []
  type: TYPE_NORMAL
- en: Barnyard2
  id: totrans-1348
  prefs: []
  type: TYPE_NORMAL
- en: pads_agent
  id: totrans-1349
  prefs: []
  type: TYPE_NORMAL
- en: Full content and
  id: totrans-1350
  prefs: []
  type: TYPE_NORMAL
- en: Syslog-ng
  id: totrans-1351
  prefs: []
  type: TYPE_NORMAL
- en: Database
  id: totrans-1352
  prefs: []
  type: TYPE_NORMAL
- en: Alert data spool
  id: totrans-1353
  prefs: []
  type: TYPE_NORMAL
- en: http_agent
  id: totrans-1354
  prefs: []
  type: TYPE_NORMAL
- en: transcript
  id: totrans-1355
  prefs: []
  type: TYPE_NORMAL
- en: Log collection
  id: totrans-1356
  prefs: []
  type: TYPE_NORMAL
- en: processing
  id: totrans-1357
  prefs: []
  type: TYPE_NORMAL
- en: Sensor to server
  id: totrans-1358
  prefs: []
  type: TYPE_NORMAL
- en: delivery
  id: totrans-1359
  prefs: []
  type: TYPE_NORMAL
- en: data delivery
  id: totrans-1360
  prefs: []
  type: TYPE_NORMAL
- en: Argus server
  id: totrans-1361
  prefs: []
  type: TYPE_NORMAL
- en: Dumpcap
  id: totrans-1362
  prefs: []
  type: TYPE_NORMAL
- en: PRADS
  id: totrans-1363
  prefs: []
  type: TYPE_NORMAL
- en: Snort or
  id: totrans-1364
  prefs: []
  type: TYPE_NORMAL
- en: Bro
  id: totrans-1365
  prefs: []
  type: TYPE_NORMAL
- en: Session data
  id: totrans-1366
  prefs: []
  type: TYPE_NORMAL
- en: Full content data
  id: totrans-1367
  prefs: []
  type: TYPE_NORMAL
- en: Session data
  id: totrans-1368
  prefs: []
  type: TYPE_NORMAL
- en: Suricata
  id: totrans-1369
  prefs: []
  type: TYPE_NORMAL
- en: Extracted content
  id: totrans-1370
  prefs: []
  type: TYPE_NORMAL
- en: (not running by
  id: totrans-1371
  prefs: []
  type: TYPE_NORMAL
- en: and metadata
  id: totrans-1372
  prefs: []
  type: TYPE_NORMAL
- en: Data
  id: totrans-1373
  prefs: []
  type: TYPE_NORMAL
- en: Alert data
  id: totrans-1374
  prefs: []
  type: TYPE_NORMAL
- en: data, session
  id: totrans-1375
  prefs: []
  type: TYPE_NORMAL
- en: collection
  id: totrans-1376
  prefs: []
  type: TYPE_NORMAL
- en: default)
  id: totrans-1377
  prefs: []
  type: TYPE_NORMAL
- en: data, transaction
  id: totrans-1378
  prefs: []
  type: TYPE_NORMAL
- en: data, statistical
  id: totrans-1379
  prefs: []
  type: TYPE_NORMAL
- en: Netsniff-ng
  id: totrans-1380
  prefs: []
  type: TYPE_NORMAL
- en: data, metadata,
  id: totrans-1381
  prefs: []
  type: TYPE_NORMAL
- en: Full content data
  id: totrans-1382
  prefs: []
  type: TYPE_NORMAL
- en: and alert data
  id: totrans-1383
  prefs: []
  type: TYPE_NORMAL
- en: Monitored interface(s), e.g., eth1
  id: totrans-1384
  prefs: []
  type: TYPE_NORMAL
- en: '*Figure 6-1: Core SO tools*'
  id: totrans-1385
  prefs: []
  type: TYPE_NORMAL
- en: '**running Tcpdump**'
  id: totrans-1386
  prefs: []
  type: TYPE_NORMAL
- en: Tcpdump ( *http://www.tcpdump.org/*) is a command line network traffic
  id: totrans-1387
  prefs: []
  type: TYPE_NORMAL
- en: analyzer. Tcpdump is available on SO, but it is not running by default.
  id: totrans-1388
  prefs: []
  type: TYPE_NORMAL
- en: Analysts can invoke it on demand, most often to view data stored in
  id: totrans-1389
  prefs: []
  type: TYPE_NORMAL
- en: '*/nsm/sensor_data/<sensorname>/dailylogs*.'
  id: totrans-1390
  prefs: []
  type: TYPE_NORMAL
- en: '**N o T e**'
  id: totrans-1391
  prefs: []
  type: TYPE_NORMAL
- en: '*Bill Fenner, David Young, Fulvio Risso, Guy Harris, Hannes Gredler, and Michael*'
  id: totrans-1392
  prefs: []
  type: TYPE_NORMAL
- en: '*Richardson are the current Tcpdump maintainers, and they code under a three-clause*
    *BSD license. (See the Tcpdump* CREDITS *file at* http://svnweb.freebsd.org/base/'
  id: totrans-1393
  prefs: []
  type: TYPE_NORMAL
- en: vendor/tcpdump/4.3.0/CREDITS?revision=241212&view=markup *for all*
  id: totrans-1394
  prefs: []
  type: TYPE_NORMAL
- en: '*contributors.) They also develop the libpcap traffic capture library under
    the same* *license. Van Jacobson, Craig Leres, and Steven McCanne wrote the original
    version in* *1987 while working at the Lawrence Berkeley Laboratory Network Research
    Group.*'
  id: totrans-1395
  prefs: []
  type: TYPE_NORMAL
- en: Tcpdump works against a live network interface or a saved trace file. It
  id: totrans-1396
  prefs: []
  type: TYPE_NORMAL
- en: can display results in real time or write output to a file.
  id: totrans-1397
  prefs: []
  type: TYPE_NORMAL
- en: Tcpdump is a *protocol analyzer* because it can depict multiple layers of
  id: totrans-1398
  prefs: []
  type: TYPE_NORMAL
- en: detail for any traffic it understands. As a protocol analyzer, its rendition
    of
  id: totrans-1399
  prefs: []
  type: TYPE_NORMAL
- en: network traffic depends on its ability to decode the data it sees. Without
  id: totrans-1400
  prefs: []
  type: TYPE_NORMAL
- en: knowledge of the underlying protocols, Tcpdump could produce only a
  id: totrans-1401
  prefs: []
  type: TYPE_NORMAL
- en: byte stream that analysts would need to decode manually.
  id: totrans-1402
  prefs: []
  type: TYPE_NORMAL
- en: '**116** Chapter 6'
  id: totrans-1403
  prefs: []
  type: TYPE_NORMAL
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-1404
  prefs: []
  type: TYPE_NORMAL
- en: '***Displaying, Writing, and Reading Traffic with Tcpdump***'
  id: totrans-1405
  prefs: []
  type: TYPE_NORMAL
- en: Tcpdump runs in a command terminal. To display live traffic in real time,
  id: totrans-1406
  prefs: []
  type: TYPE_NORMAL
- en: 'run it with these options:'
  id: totrans-1407
  prefs: []
  type: TYPE_NORMAL
- en: $ **tcpdump -n -i <interface> -s <snaplen> -c <count>**
  id: totrans-1408
  prefs: []
  type: TYPE_NORMAL
- en: The -n switch tells Tcpdump to not resolve IP addresses to hostnames
  id: totrans-1409
  prefs: []
  type: TYPE_NORMAL
- en: via DNS queries. I always run Tcpdump with the -n switch to avoid waiting
  id: totrans-1410
  prefs: []
  type: TYPE_NORMAL
- en: while the tool resolves IP addresses to hostnames via DNS. The -i switch
  id: totrans-1411
  prefs: []
  type: TYPE_NORMAL
- en: tells it which interface to monitor. The -s switch tells it how many bytes
  id: totrans-1412
  prefs: []
  type: TYPE_NORMAL
- en: to capture from each packet. By default Tcpdump captures 68 bytes for
  id: totrans-1413
  prefs: []
  type: TYPE_NORMAL
- en: IPv4 packets and 96 bytes for IPv6 packets. (Use -s 0 to capture the entire
  id: totrans-1414
  prefs: []
  type: TYPE_NORMAL
- en: packet, or specify a value appropriate for the medium from which you are
  id: totrans-1415
  prefs: []
  type: TYPE_NORMAL
- en: capturing.) Finally, -c tells Tcpdump how many packets to capture. (If you
  id: totrans-1416
  prefs: []
  type: TYPE_NORMAL
- en: forget this switch, Tcpdump will run until you stop it with ctrl-C.)
  id: totrans-1417
  prefs: []
  type: TYPE_NORMAL
- en: Listing 6-1 shows some example output. Tcpdump requires elevated
  id: totrans-1418
  prefs: []
  type: TYPE_NORMAL
- en: privileges to sniff traffic in promiscuous mode, so preface the command
  id: totrans-1419
  prefs: []
  type: TYPE_NORMAL
- en: with sudo.
  id: totrans-1420
  prefs: []
  type: TYPE_NORMAL
- en: $ **sudo tcpdump -n -i eth1 -c 5**
  id: totrans-1421
  prefs: []
  type: TYPE_NORMAL
- en: 'tcpdump: WARNING: eth1: no IPv4 address assigned'
  id: totrans-1422
  prefs: []
  type: TYPE_NORMAL
- en: 'tcpdump: verbose output suppressed, use -v or -vv for full protocol decode'
  id: totrans-1423
  prefs: []
  type: TYPE_NORMAL
- en: listening on eth1, link-type EN10MB (Ethernet), capture size 65535 bytes
  id: totrans-1424
  prefs: []
  type: TYPE_NORMAL
- en: 'u19:48:51.723139 IP 192.168.2.120.55060 > 205.233.0.226.443:'
  id: totrans-1425
  prefs: []
  type: TYPE_NORMAL
- en: UDP, length 461
  id: totrans-1426
  prefs: []
  type: TYPE_NORMAL
- en: 'v19:48:51.886312 IP 69.171.246.17.443 > 192.168.2.104.49608:'
  id: totrans-1427
  prefs: []
  type: TYPE_NORMAL
- en: Flags [P.], seq 928328861:928329246, ack 1080949825, win 39, length 385
  id: totrans-1428
  prefs: []
  type: TYPE_NORMAL
- en: 'w19:48:51.898576 IP 192.168.2.104.49608 > 69.171.246.17.443:'
  id: totrans-1429
  prefs: []
  type: TYPE_NORMAL
- en: Flags [P.], seq 1:978, ack 385, win 4220, length 977
  id: totrans-1430
  prefs: []
  type: TYPE_NORMAL
- en: 'x19:48:51.914324 IP 69.171.246.17.443 > 192.168.2.104.49608:'
  id: totrans-1431
  prefs: []
  type: TYPE_NORMAL
- en: Flags [.], ack 978, win 45, length 0
  id: totrans-1432
  prefs: []
  type: TYPE_NORMAL
- en: 'y19:48:51.915284 IP 69.171.246.17.443 > 192.168.2.104.49608:'
  id: totrans-1433
  prefs: []
  type: TYPE_NORMAL
- en: Flags [P.], seq 385:823, ack 978, win 45, length 438
  id: totrans-1434
  prefs: []
  type: TYPE_NORMAL
- en: 5 packets captured
  id: totrans-1435
  prefs: []
  type: TYPE_NORMAL
- en: 5 packets received by filter
  id: totrans-1436
  prefs: []
  type: TYPE_NORMAL
- en: 0 packets dropped by kernel
  id: totrans-1437
  prefs: []
  type: TYPE_NORMAL
- en: '*Listing 6-1: Capturing five packets with Tcpdump*'
  id: totrans-1438
  prefs: []
  type: TYPE_NORMAL
- en: This traffic includes one User Datagram Protocol (UDP) packet u,
  id: totrans-1439
  prefs: []
  type: TYPE_NORMAL
- en: followed by four Transmission Control Protocol (TCP) packets (v, w, x,
  id: totrans-1440
  prefs: []
  type: TYPE_NORMAL
- en: 'and y). The UDP traffic has the following format:'
  id: totrans-1441
  prefs: []
  type: TYPE_NORMAL
- en: timestamp / layer 3 protocol / source IP address.source port > destination IP
  id: totrans-1442
  prefs: []
  type: TYPE_NORMAL
- en: 'address.destination port: layer 4 protocol / data length'
  id: totrans-1443
  prefs: []
  type: TYPE_NORMAL
- en: Command Line Packet Analysis Tools **117**
  id: totrans-1444
  prefs: []
  type: TYPE_NORMAL
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-1445
  prefs: []
  type: TYPE_NORMAL
- en: 'The format for the TCP traffic is similar:'
  id: totrans-1446
  prefs: []
  type: TYPE_NORMAL
- en: timestamp / layer 3 protocol / source IP address.source port > destination IP
  id: totrans-1447
  prefs: []
  type: TYPE_NORMAL
- en: 'address.destination port: layer 4 protocol / TCP flags, TCP sequence numbers,'
  id: totrans-1448
  prefs: []
  type: TYPE_NORMAL
- en: TCP acknowledgement numbers, TCP window size, data length
  id: totrans-1449
  prefs: []
  type: TYPE_NORMAL
- en: '**N o T e**'
  id: totrans-1450
  prefs: []
  type: TYPE_NORMAL
- en: '*The time in this trace is UTC. When you configure SO, it sets the local clock
    to use* *UTC, so expect to see UTC timestamps in network evidence. In files saved
    in libpcap* *format, time is stored as the number of seconds and microseconds
    since the Unix*'
  id: totrans-1451
  prefs: []
  type: TYPE_NORMAL
- en: '*“epoch time” of January 1, 1970\. The local system then translates this value
    into* *the time displayed by a network tool.*'
  id: totrans-1452
  prefs: []
  type: TYPE_NORMAL
- en: To save traffic to disk while watching a live interface, add the -w switch
  id: totrans-1453
  prefs: []
  type: TYPE_NORMAL
- en: followed by the target filename. Listing 6-2 shows how to accomplish this task.
  id: totrans-1454
  prefs: []
  type: TYPE_NORMAL
- en: $ **sudo tcpdump -n -i eth1 -c 5 -w demo1.pcap**
  id: totrans-1455
  prefs: []
  type: TYPE_NORMAL
- en: 'tcpdump: WARNING: eth1: no IPv4 address assigned'
  id: totrans-1456
  prefs: []
  type: TYPE_NORMAL
- en: 'tcpdump: listening on eth1, link-type EN10MB (Ethernet), capture size 65535
    bytes'
  id: totrans-1457
  prefs: []
  type: TYPE_NORMAL
- en: 5 packets captured
  id: totrans-1458
  prefs: []
  type: TYPE_NORMAL
- en: 5 packets received by filter
  id: totrans-1459
  prefs: []
  type: TYPE_NORMAL
- en: 0 packets dropped by kernel
  id: totrans-1460
  prefs: []
  type: TYPE_NORMAL
- en: '*Listing 6-2: Capturing and storing five packets with Tcpdump*'
  id: totrans-1461
  prefs: []
  type: TYPE_NORMAL
- en: To read the traffic, use the -r switch. (The sudo command isn’t needed
  id: totrans-1462
  prefs: []
  type: TYPE_NORMAL
- en: because you’re reading from a trace, not eth1.) Listing 6-3 shows the results
  id: totrans-1463
  prefs: []
  type: TYPE_NORMAL
- en: of reading five captured packets.
  id: totrans-1464
  prefs: []
  type: TYPE_NORMAL
- en: $ **tcpdump -n -r demo1.pcap**
  id: totrans-1465
  prefs: []
  type: TYPE_NORMAL
- en: reading from file demo1.pcap, link-type EN10MB (Ethernet)
  id: totrans-1466
  prefs: []
  type: TYPE_NORMAL
- en: '20:23:44.858470 IP 74.125.228.54.443 > 192.168.2.104.49945:'
  id: totrans-1467
  prefs: []
  type: TYPE_NORMAL
- en: Flags [P.], seq 1145489012:1145489069, ack 1920080636, win 4132, length 57
  id: totrans-1468
  prefs: []
  type: TYPE_NORMAL
- en: '20:23:44.859134 IP 74.125.228.54.443 > 192.168.2.104.49945:'
  id: totrans-1469
  prefs: []
  type: TYPE_NORMAL
- en: Flags [P.], seq 57:1407, ack 1, win 4132, length 1350
  id: totrans-1470
  prefs: []
  type: TYPE_NORMAL
- en: '20:23:44.859154 IP 74.125.228.54.443 > 192.168.2.104.49945:'
  id: totrans-1471
  prefs: []
  type: TYPE_NORMAL
- en: Flags [P.], seq 1407:2757, ack 1, win 4132, length 1350
  id: totrans-1472
  prefs: []
  type: TYPE_NORMAL
- en: '20:23:44.859505 IP 74.125.228.54.443 > 192.168.2.104.49945:'
  id: totrans-1473
  prefs: []
  type: TYPE_NORMAL
- en: Flags [P.], seq 2757:4107, ack 1, win 4132, length 1350
  id: totrans-1474
  prefs: []
  type: TYPE_NORMAL
- en: '20:23:44.860006 IP 74.125.228.54.443 > 192.168.2.104.49945:'
  id: totrans-1475
  prefs: []
  type: TYPE_NORMAL
- en: Flags [P.], seq 4107:4261, ack 1, win 4132, length 154
  id: totrans-1476
  prefs: []
  type: TYPE_NORMAL
- en: '*Listing 6-3: Reading five packets with Tcpdump*'
  id: totrans-1477
  prefs: []
  type: TYPE_NORMAL
- en: '***Using Filters with Tcpdump***'
  id: totrans-1478
  prefs: []
  type: TYPE_NORMAL
- en: Along with displaying, writing, and reading traffic, the other core usage
  id: totrans-1479
  prefs: []
  type: TYPE_NORMAL
- en: for Tcpdump involves applying filters. *Filters* are a mechanism to limit the
  id: totrans-1480
  prefs: []
  type: TYPE_NORMAL
- en: traffic shown or captured by Tcpdump and other tools. The popular term
  id: totrans-1481
  prefs: []
  type: TYPE_NORMAL
- en: '**118** Chapter 6'
  id: totrans-1482
  prefs: []
  type: TYPE_NORMAL
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-1483
  prefs: []
  type: TYPE_NORMAL
- en: for filters is *BPF*, a nod to the Berkeley Packet Filter virtual machine, which
    translates the human-readable filter syntax into a code syntax suitable for
  id: totrans-1484
  prefs: []
  type: TYPE_NORMAL
- en: machine consumption.
  id: totrans-1485
  prefs: []
  type: TYPE_NORMAL
- en: '**applying Filters**'
  id: totrans-1486
  prefs: []
  type: TYPE_NORMAL
- en: You apply a BPF by appending it to the Tcpdump command line. For
  id: totrans-1487
  prefs: []
  type: TYPE_NORMAL
- en: example, to capture only ICMP traffic, add icmp to the syntax, as shown
  id: totrans-1488
  prefs: []
  type: TYPE_NORMAL
- en: in Listing 6-4 (u).
  id: totrans-1489
  prefs: []
  type: TYPE_NORMAL
- en: $ **sudo tcpdump -n -i eth1 -c 10 -w icmp.pcap icmp**u
  id: totrans-1490
  prefs: []
  type: TYPE_NORMAL
- en: 'tcpdump: WARNING: eth1: no IPv4 address assigned'
  id: totrans-1491
  prefs: []
  type: TYPE_NORMAL
- en: 'tcpdump: listening on eth1, link-type EN10MB (Ethernet), capture size 65535
    bytes'
  id: totrans-1492
  prefs: []
  type: TYPE_NORMAL
- en: 10 packets captured
  id: totrans-1493
  prefs: []
  type: TYPE_NORMAL
- en: 10 packets received by filter
  id: totrans-1494
  prefs: []
  type: TYPE_NORMAL
- en: 0 packets dropped by kernel
  id: totrans-1495
  prefs: []
  type: TYPE_NORMAL
- en: '*Listing 6-4: Capturing 10 ICMP packets with Tcpdump*'
  id: totrans-1496
  prefs: []
  type: TYPE_NORMAL
- en: To read the trace, use Tcpdump again, as shown in Listing 6-5\.
  id: totrans-1497
  prefs: []
  type: TYPE_NORMAL
- en: $ **tcpdump -n -r icmp.pcap**
  id: totrans-1498
  prefs: []
  type: TYPE_NORMAL
- en: reading from file icmp.pcap, link-type EN10MB (Ethernet)
  id: totrans-1499
  prefs: []
  type: TYPE_NORMAL
- en: '20:30:28.203723 IP 172.16.2.1 > 172.16.2.2: ICMP echo request, id 20822, seq
    44313, length 44'
  id: totrans-1500
  prefs: []
  type: TYPE_NORMAL
- en: '20:30:28.204282 IP 172.16.2.2 > 172.16.2.1: ICMP echo reply, id 20822, seq
    44313, length 44'
  id: totrans-1501
  prefs: []
  type: TYPE_NORMAL
- en: '20:30:28.844237 IP 192.168.2.108 > 173.194.75.104: ICMP echo request, id 1,
    seq 5, length 40'
  id: totrans-1502
  prefs: []
  type: TYPE_NORMAL
- en: '20:30:28.871534 IP 173.194.75.104 > 192.168.2.108: ICMP echo reply, id 1, seq
    5, length 40'
  id: totrans-1503
  prefs: []
  type: TYPE_NORMAL
- en: '20:30:29.213917 IP 172.16.2.1 > 172.16.2.2: ICMP echo request, id 20822, seq
    44569, length 44'
  id: totrans-1504
  prefs: []
  type: TYPE_NORMAL
- en: '20:30:29.214475 IP 172.16.2.2 > 172.16.2.1: ICMP echo reply, id 20822, seq
    44569, length 44'
  id: totrans-1505
  prefs: []
  type: TYPE_NORMAL
- en: '20:30:29.850913 IP 192.168.2.108 > 173.194.75.104: ICMP echo request, id 1,
    seq 6, length 40'
  id: totrans-1506
  prefs: []
  type: TYPE_NORMAL
- en: '20:30:29.875103 IP 173.194.75.104 > 192.168.2.108: ICMP echo reply, id 1, seq
    6, length 40'
  id: totrans-1507
  prefs: []
  type: TYPE_NORMAL
- en: '20:30:29.987013 IP 192.168.2.127 > 173.194.75.99: ICMP echo request, id 47441,
    seq 1, length 64'
  id: totrans-1508
  prefs: []
  type: TYPE_NORMAL
- en: '20:30:30.013728 IP 173.194.75.99 > 192.168.2.127: ICMP echo reply, id 47441,
    seq 1, length 64'
  id: totrans-1509
  prefs: []
  type: TYPE_NORMAL
- en: '*Listing 6-5: Reading ICMP packets with Tcpdump*'
  id: totrans-1510
  prefs: []
  type: TYPE_NORMAL
- en: Instead of using icmp, you can capture other specific traffic by using
  id: totrans-1511
  prefs: []
  type: TYPE_NORMAL
- en: options like tcp, udp, and so on. For example, you can collect traffic for a
  id: totrans-1512
  prefs: []
  type: TYPE_NORMAL
- en: specified TCP or UDP port, like port 53, as shown in Listing 6-6\.
  id: totrans-1513
  prefs: []
  type: TYPE_NORMAL
- en: $ **sudo tcpdump -n -i eth1 -s 0 port 53**
  id: totrans-1514
  prefs: []
  type: TYPE_NORMAL
- en: 'tcpdump: WARNING: eth1: no IPv4 address assigned'
  id: totrans-1515
  prefs: []
  type: TYPE_NORMAL
- en: 'tcpdump: verbose output suppressed, use -v or -vv for full protocol decode'
  id: totrans-1516
  prefs: []
  type: TYPE_NORMAL
- en: listening on eth1, link-type EN10MB (Ethernet), capture size 65535 bytes
  id: totrans-1517
  prefs: []
  type: TYPE_NORMAL
- en: '20:53:42.685078 IP 192.168.2.106.33348 > 172.16.2.1.53: 55862+ A? daisy.ubuntu.com.
    (34) 20:53:42.701421 IP 172.16.2.1.53 > 192.168.2.106.33348: 55862 2/0/0 A 91.189.95.54,
    A 91.189.95.55 (66)'
  id: totrans-1518
  prefs: []
  type: TYPE_NORMAL
- en: '*Listing 6-6: Capturing port 53 packets with Tcpdump*'
  id: totrans-1519
  prefs: []
  type: TYPE_NORMAL
- en: Command Line Packet Analysis Tools **119**
  id: totrans-1520
  prefs: []
  type: TYPE_NORMAL
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-1521
  prefs: []
  type: TYPE_NORMAL
- en: Listing 6-6 captures UDP or TCP traffic on port 53\. To capture port 53
  id: totrans-1522
  prefs: []
  type: TYPE_NORMAL
- en: and TCP traffic only, modify the filter as shown in Listing 6-7\.
  id: totrans-1523
  prefs: []
  type: TYPE_NORMAL
- en: $ **sudo tcpdump -n -i eth1 -s 0 port 53 and tcp**
  id: totrans-1524
  prefs: []
  type: TYPE_NORMAL
- en: 'tcpdump: WARNING: eth1: no IPv4 address assigned'
  id: totrans-1525
  prefs: []
  type: TYPE_NORMAL
- en: 'tcpdump: verbose output suppressed, use -v or -vv for full protocol decode'
  id: totrans-1526
  prefs: []
  type: TYPE_NORMAL
- en: listening on eth1, link-type EN10MB (Ethernet), capture size 65535 bytes
  id: totrans-1527
  prefs: []
  type: TYPE_NORMAL
- en: '21:02:06.430169 IP 192.168.2.126.44334 > 8.8.8.8.53: Flags [S], seq 1330246822,
    win 42340, options [mss 1460,sackOK,TS val 157066547 ecr 0,nop,wscale 11], length
    0'
  id: totrans-1528
  prefs: []
  type: TYPE_NORMAL
- en: '*Listing 6-7: Capturing port 53 TCP packets with Tcpdump*'
  id: totrans-1529
  prefs: []
  type: TYPE_NORMAL
- en: The manual page for pcap-filter included with SO shows all available
  id: totrans-1530
  prefs: []
  type: TYPE_NORMAL
- en: options. View it by entering **man pcap-filter** at a command terminal.
  id: totrans-1531
  prefs: []
  type: TYPE_NORMAL
- en: '**Some Common Filters**'
  id: totrans-1532
  prefs: []
  type: TYPE_NORMAL
- en: Now let’s look at some of the more common filters for showing traffic to or
  id: totrans-1533
  prefs: []
  type: TYPE_NORMAL
- en: from particular hosts and even networks.
  id: totrans-1534
  prefs: []
  type: TYPE_NORMAL
- en: To show traffic to or from a specific computer, use the host BPF, as shown
  id: totrans-1535
  prefs: []
  type: TYPE_NORMAL
- en: in Listing 6-8\.
  id: totrans-1536
  prefs: []
  type: TYPE_NORMAL
- en: $ **tcpdump -n -r icmp.pcap host 192.168.2.127**
  id: totrans-1537
  prefs: []
  type: TYPE_NORMAL
- en: reading from file icmp.pcap, link-type EN10MB (Ethernet)
  id: totrans-1538
  prefs: []
  type: TYPE_NORMAL
- en: '20:30:29.987013 IP 192.168.2.127 > 173.194.75.99: ICMP echo request, id 47441,
    seq 1, length 64'
  id: totrans-1539
  prefs: []
  type: TYPE_NORMAL
- en: '20:30:30.013728 IP 173.194.75.99 > 192.168.2.127: ICMP echo reply, id 47441,
    seq 1, length 64'
  id: totrans-1540
  prefs: []
  type: TYPE_NORMAL
- en: '*Listing 6-8: Capturing traffic involving a host via BPF with Tcpdump*'
  id: totrans-1541
  prefs: []
  type: TYPE_NORMAL
- en: To show traffic from a certain source computer, use the src host BPF, as
  id: totrans-1542
  prefs: []
  type: TYPE_NORMAL
- en: shown in Listing 6-9\.
  id: totrans-1543
  prefs: []
  type: TYPE_NORMAL
- en: $ **tcpdump -n -r icmp.pcap src host 192.168.2.127**
  id: totrans-1544
  prefs: []
  type: TYPE_NORMAL
- en: reading from file icmp.pcap, link-type EN10MB (Ethernet)
  id: totrans-1545
  prefs: []
  type: TYPE_NORMAL
- en: '20:30:29.987013 IP 192.168.2.127 > 173.194.75.99: ICMP echo request, id 47441,
    seq 1, length 64'
  id: totrans-1546
  prefs: []
  type: TYPE_NORMAL
- en: '*Listing 6-9: Capturing traffic from a host via BPF with Tcpdump*'
  id: totrans-1547
  prefs: []
  type: TYPE_NORMAL
- en: The dst host BPF works the same way as the src host version, as shown
  id: totrans-1548
  prefs: []
  type: TYPE_NORMAL
- en: in Listing 6-10\.
  id: totrans-1549
  prefs: []
  type: TYPE_NORMAL
- en: $ **tcpdump -n -r icmp.pcap dst host 192.168.2.127**
  id: totrans-1550
  prefs: []
  type: TYPE_NORMAL
- en: reading from file icmp.pcap, link-type EN10MB (Ethernet)
  id: totrans-1551
  prefs: []
  type: TYPE_NORMAL
- en: '20:30:30.013728 IP 173.194.75.99 > 192.168.2.127: ICMP echo reply, id 47441,
    seq 1, length 64'
  id: totrans-1552
  prefs: []
  type: TYPE_NORMAL
- en: '*Listing 6-10: Capturing traffic to a host via BPF with Tcpdump*'
  id: totrans-1553
  prefs: []
  type: TYPE_NORMAL
- en: '**120** Chapter 6'
  id: totrans-1554
  prefs: []
  type: TYPE_NORMAL
- en: '[www.it-ebooks.info](http://www.it-ebooks.info/)'
  id: totrans-1555
  prefs: []
  type: TYPE_NORMAL
- en: You can specify networks instead of hosts with the net BPF, as shown in Listing
    6-11\.
  id: totrans-1556
  prefs: []
  type: TYPE_NORMAL
