<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" epub:prefix="index: http://www.index.com/" lang="en" xml:lang="en">
	<head>
		<title>Chapter 2: Physical Access Hacks</title>
		<link href="NSTemplate_v1.css" rel="stylesheet" type="text/css"/>
<meta content="urn:uuid:af29b7b1-e841-4e64-a1ef-e03d2d2c1d42" name="Adept.expected.resource"/>
	</head>
	<body epub:type="bodymatter chapter">
		<section>
			<header>
				<h1 class="chapter"><span class="ChapterNumber"><span epub:type="pagebreak" id="Page_9" title="9"/>2</span><br/><span class="ChapterTitle">Physical Access Hacks</span></h1>
			</header>
			<figure class="opener">
				<img alt="" src="image_fi/book_art/chapterart.png"/>
			</figure>
			<p class="ChapterIntro">Have you ever left your laptop unattended in a coffee shop, thinking that your private files would be safely protected behind a login screen? It turns out that anyone with physical access to your computer can gain access to your files with just a few keystrokes, without needing to know your login details. In this chapter, I’ll show you two <em>physical access hacks</em>: the <em>Sticky Keys hack</em>, used on Windows PCs, and the <em>Mac root hack</em>, used on Macs. Both hacks give an attacker administrator-level<em> </em>access to the target computer, allowing them to steal files or change important settings.</p>
			<p><span epub:type="pagebreak" id="Page_10" title="10"/>Physical access hacks may sound scary because they can be used maliciously by attackers on stolen or unattended computers. However, they also have constructive applications. Ethical hackers at home and at IT help desks use techniques like the Sticky Keys hack or the Mac root hack to recover files that would otherwise be lost due to a forgotten password. If you have an old computer in the garage or attic with family photos or other important documents that you can’t access because no one remembers the computer’s password, these hacks can help.</p>
			<aside epub:type="sidebar">
				<div class="top hr">
					<hr/>
				</div>
				<section class="note">
					<h2><span class="NoteHead">WARNING</span></h2>
					<p><em>Do not</em> perform either of these hacks on your main computer, because they could leave your machine vulnerable to attack. You can usually find an old desktop or laptop if you ask around. Get creative, but stay ethical; be sure to get the owner’s permission before trying out these hacks on someone else’s computer. If you can’t find an extra Windows or Mac computer to practice on, you can still read this chapter to understand the dangers of physical access attacks.</p>
					<div class="bottom hr">
						<hr/>
					</div>
				</section>
			</aside>
			<h2 id="h1-502000c02-0001">The Sticky Keys Hack</h2>
			<p class="BodyFirst">Sticky Keys is a Windows feature that makes it easier to issue certain keyboard commands, like <span class="KeyCaps">CTRL</span>-<span class="KeyCaps">C</span> to copy or <span class="KeyCaps">CTRL</span>-<span class="KeyCaps">V</span> to paste, by allowing you to press the keys one after another instead of all at once. Sticky Keys is triggered by pressing <span class="KeyCaps">SHIFT</span> five times and can even be turned on from the Windows login screen, before a username or password has been entered.</p>
			<p>
				For this hack, we’ll replace the Sticky Keys<em> </em>program file with another file, <em>cmd.exe</em>. That way, instead of launching the usual Sticky Keys assistant, pressing <span class="KeyCaps">SHIFT</span> five times will launch a <em>command prompt</em>. This is a text-based program that lets us enter commands directly into Windows. By launching a command prompt at the login screen (see <a href="#figure2-1" id="figureanchor2-1">Figure 2-1</a>), you’ll be able to add a new username and password, give yourself administrator-level access to the computer, and access the computer’s files, all without knowing the login information on that computer!</p>
			<p>Since Windows 10 computers that have been updated in 2019 or later are safe from the Sticky Keys hack, you’ll need an older Windows computer to try out the hack for yourself. You’ll also need a Windows 10 installation disc or USB drive. To create one, follow the instructions in Appendix A.</p>
			<h3 id="h2-502000c02-0001">Booting from a Windows 10 Installation Disc</h3>
			<p class="BodyFirst">To replace the Sticky Keys program with the command prompt program, we need to access the hard drive that contains those program files using a Windows 10 installation disc or USB drive. Once you’ve created an installation disc, as described in Appendix A, insert the disc and then restart the computer.</p>
			<span epub:type="pagebreak" id="Page_11" title="11"/>
			<figure>
				<img alt="f02001" class="" src="image_fi/502000c02/f02001.png"/>
				<figcaption>
					<p><a id="figure2-1">Figure 2-1</a>: The Sticky Keys hack brings up a command prompt window instead of the Sticky Keys assistant.</p>
				</figcaption>
			</figure>
			<p>
				We need to tell the computer to load the operating system (OS) from the disc or USB drive instead of from the computer’s hard drive. To do this, we’ll access either the boot menu or the <em>Basic Input/Output System (BIOS)</em>, which contains basic settings that control your computer when it starts up. Different PC manufacturers and different versions of Windows cause the instructions to vary a bit, but the following steps combined with a little web searching will get you into most older Windows computers:</p>
			<ol class="decimal">
				<li value="1">On Windows computers, you press a special key to access the boot menu or BIOS. If your startup screen doesn’t show you which key to press just before the Windows startup logo appears, reboot your computer and quickly press <span class="KeyCaps">ESC</span>, <span class="KeyCaps">DELETE</span>, F8, F9, F10, F11, or F12 right as it begins to start up. Search online for “boot menu” and the specific make and model of your computer to find the right key.</li>
				<li value="2">If the boot menu appears, select the <b>Boot from DVD</b> or <b>Boot from USB</b> option to boot from the Windows installation disc you inserted, then move on to step 5.</li>
				<li value="3">If the boot menu doesn’t appear after a few restarts, try entering the BIOS menu instead: turn the computer off and on again, and press <span class="KeyCaps">DELETE</span>, F2, F9, F10, F12, or <span class="KeyCaps">ESC.</span> Search online for “BIOS” and your computer model to find the right key.</li>
				<li value="4"><span epub:type="pagebreak" id="Page_12" title="12"/>Once you’re inside the BIOS, find the boot options and change the order or priority of your boot devices (often by using your arrow keys) to make the USB or DVD the top option. Then save the changes and exit the BIOS.</li>
				<li value="5">Reboot the computer again. You should briefly see the message <code>Press any key to boot from CD or DVD</code> or <code>Press any key to boot from USB device</code>. Press any key (such as the spacebar) <em>immediately</em> to boot from your DVD or USB.</li>
				<li value="6">When the Windows installation disc starts up, click <b>Next</b><span class="MenuArrow">▶</span><b>Repair your computer</b><span class="MenuArrow">▶</span><b>Troubleshoot</b><span class="MenuArrow">▶</span><b>Command Prompt</b>, as shown in <a href="#figure2-2" id="figureanchor2-2">Figure 2-2</a>. The menu order or the option names might look different, but look for the Windows command prompt.
					<aside epub:type="sidebar">
						<div class="top hr">
							<hr/>
						</div>
						<section class="note">
							<h2><span class="NoteHead">warning</span></h2>
							<p>
									Make sure you <em>don’t install</em> Windows 10—that would wipe out all the files from the PC you’re trying to recover!</p>
							<div class="bottom hr">
								<hr/>
							</div>
						</section>
					</aside>
					<figure>
						<img alt="f02002a" class="" src="image_fi/502000c02/f02002a.png"/>
						<figcaption>
							<p><a id="figure2-2">Figure 2-2</a>: Use the Windows installation disc to access the command prompt.</p>
						</figcaption>
					</figure>
					</li>
				<li value="7"><span epub:type="pagebreak" id="Page_13" title="13"/>Once you’ve reached the Windows command prompt (usually a black, text-based window), type <code class="bold">c:</code> and press <b>ENTER</b> to change to the C: drive, as shown here: 
					<pre><code>X:\&gt; <code class="bold">c:</code></code></pre>
			</li>
				<li value="8">Enter the command <code class="bold">dir</code><b> </b>to see a list of files and folders on the C: drive. Look for a folder called <em>Windows</em> (it will be marked <code>&lt;DIR&gt;</code>, short for <em>directory</em>). 
					<pre><code>C:\&gt; <code class="bold">dir</code> Volume in drive C is Windows 10 Volume Serial Number is B4EF-FAC7 Directory of C:\<em>--snip--</em>
03/15/2018  02:51 AM    &lt;DIR&gt;            Users
05/19/2019  10:09 AM    &lt;DIR&gt;            Windows<code> </code><span aria-label="annotation1" class="CodeAnnotationCode">1</span><em>--snip--</em></code></pre>
					<p class="ListBody">This folder <span aria-label="annotation1" class="CodeAnnotation">1</span> contains the operating system files, including the command prompt application and the Sticky Keys program file that we need to swap out to perform this hack.</p>
					</li>
				<li value="9">If there’s no <em>Windows</em> directory on the C: drive, try the same process in the D: drive by entering <code class="bold">d:</code> and then <code class="bold">dir</code>. If the D: drive doesn’t have the <em>Windows</em> directory either, keep going through the alphabet (E:, F:, G:, and so on) until you find a drive containing <em>Windows</em> in its listing.</li>
			</ol>
			<h3 id="h2-502000c02-0002">Gaining Administrator-Level Access</h3>
			<p class="BodyFirst">Now to replace the <em>sethc.exe</em> Sticky Keys program with the <em>cmd.exe</em> command prompt program. Then we’ll be able to create a new administrator account on the computer.</p>
			<ol class="decimal">
				<li value="1">Enter the following three commands:
					<pre><code>C:\&gt; <code class="bold">cd \Windows\System32\</code>
C:\Windows\System32\&gt; <code class="bold">copy sethc.exe sethc.bak</code>
C:\Windows\System32\&gt; <code class="bold">copy cmd.exe sethc.exe</code></code></pre>
					<p class="ListBody">These commands enter the directory where we can find both <em>sethc.exe</em> and <em>cmd.exe</em>, create a backup copy of the Sticky Keys program, and replace the original Sticky Keys program file with a copy of the command prompt program file. This way, whenever the computer runs <em>sethc.exe</em>, it will open a command prompt window in place of the Sticky Keys program.</p>
					</li>
				<li value="2">After the third command, Windows will ask you if you want to overwrite <em>sethc.exe</em>. Enter <code class="bold">Y</code> to proceed.</li>
				<li value="3"><span epub:type="pagebreak" id="Page_14" title="14"/>Remove the Windows 10 installation DVD or USB and reboot the computer.</li>
				<li value="4">When the PC boots to the login screen, press <b>SHIFT</b> five times. Instead of the usual Sticky Keys program, you should see a command prompt window pop up <em>in front </em>of the login screen, as shown in <a href="#figure2-3" id="figureanchor2-3">Figure 2-3</a>.
					<figure>
						<img alt="f02003" class="" src="image_fi/502000c02/f02003.png"/>
						<figcaption>
							<p><a id="figure2-3">Figure 2-3</a>: Opening a command prompt window</p>
						</figcaption>
					</figure>
					</li>
				<li value="5">Enter the following two commands into the command prompt window:
					<pre><code>C:\Windows\System32\&gt; <code class="bold">net user ironman Jarvis /add</code>
C:\Windows\System32\&gt; <code class="bold">net localgroup administrators ironman /add</code></code></pre>
					<p class="ListBody">The first command adds a user account named <em>ironman</em> with the password <em>Jarvis</em> to the Windows computer. The second command adds the <em>ironman</em> user to the list of local administrators. This means that when we log in as <em>ironman</em>, we’ll have administrator-level access to all the files on the computer.</p>
					</li>
				<li value="6">When you see a success message like the one in <a href="#figure2-4" id="figureanchor2-4">Figure 2-4</a>, close the command prompt.<span epub:type="pagebreak" id="Page_15" title="15"/>
				<figure><img alt="f02004" class="" src="image_fi/502000c02/f02004.png"/><figcaption>
							<p><a id="figure2-4">Figure 2-4</a>: We’ve successfully added a user named <em>ironman</em> as an administrator on this computer.</p>
						</figcaption>
					</figure>
					</li>
			</ol>
			<p>
				In addition to creating a new user account, you can also reset the password of an existing user from the command prompt window by entering <code class="bold">net</code> <code class="bold">user</code> followed by the existing username and the new password you want to set—for example, <code>net</code> <code>user</code> <code>bryson</code> <code>Thisisyournewpassword!</code>. However, you should never reset another person’s password without their permission and the permission of the computer’s owner.</p>
			<h3 id="h2-502000c02-0003">Now You’re an Administrator. Log In!</h3>
			<p class="BodyFirst">Congratulations! You now have access to the machine as an administrator. Go ahead and log in. Enter <code class="bold">.\ironman</code> as the username (or select <b>ironman</b> from the list of accounts, as shown in <a href="#figure2-5" id="figureanchor2-5">Figure 2-5</a>). The dot and backslash before <code>ironman</code> tell Windows the account is local to the computer and not stored on a network server. After entering the username, enter the password, <code class="bold">Jarvis</code>.</p>
			<span epub:type="pagebreak" id="Page_16" title="16"/>
			<figure>
				<img alt="f02005" class="" src="image_fi/502000c02/f02005.png"/>
				<figcaption>
					<p><a id="figure2-5">Figure 2-5</a>: You can now use the <em>ironman</em> user to log in to this Windows PC.</p>
				</figcaption>
			</figure>
			<p>
				Since we made the <em>ironman</em> user a member of the local administrators group, you should have administrator-level access to <em>all</em> files and folders, including all users and documents in <em>C:\Users\</em>, as shown in <a href="#figure2-6" id="figureanchor2-6">Figure 2-6</a>.</p>
			<figure>
				<img alt="f02006" class="" src="image_fi/502000c02/f02006.png"/>
				<figcaption>
					<p><a id="figure2-6">Figure 2-6</a>: As an administrator-level user, you can see <em>all</em> users’ files, not just your own.</p>
				</figcaption>
			</figure>
			<p><span epub:type="pagebreak" id="Page_17" title="17"/>When you click into another user’s folder for the first time, you’ll see a pop-up message saying you need permission to open another user’s files, as shown in <a href="#figure2-7" id="figureanchor2-7">Figure 2-7</a>. Since you’re an administrator, click <b>Continue</b> to grant yourself permanent access!</p>
			<figure>
				<img alt="f02007" class="" src="image_fi/502000c02/f02007.png"/>
				<figcaption>
					<p><a id="figure2-7">Figure 2-7</a>: Administrators can give themselves permission to access anyone’s files on the same computer.</p>
				</figcaption>
			</figure>
			<p>The Sticky Keys hack works only on Windows machines. However, computers running macOS are vulnerable to physical access hacks as well.</p>
			<h2 id="h1-502000c02-0002">The Mac Root Hack</h2>
			<p class="BodyFirst">Like the Sticky Keys hack, the Mac root hack is a physical access attack that will give you administrator-level access to a computer. It makes you a <em>root</em> user, which is the administrator-level account on macOS computers. For this hack, all you need is a Mac computer. We’ll reboot the Mac in <em>single-user mode</em>, a troubleshooting and repair login. From there, we can change the root user’s password, giving us access to all the files on the computer.</p>
			<h3 id="h2-502000c02-0004">Updating the Root User Settings</h3>
			<ol class="decimal">
				<li value="1">To begin, the Mac needs to be completely turned off—not just asleep. If it isn’t off already, press and hold the power button for about six seconds.</li>
				<li value="2">Press the power button again while holding <span class="KeyCaps">COMMAND</span>-S (⌘-S) to enter single-user mode. You should see a text-based command line terminal window with very few features, as shown in <a href="#figure2-8" id="figureanchor2-8">Figure 2-8</a>. 
					<figure>
						<img alt="f02008" class="" src="image_fi/502000c02/f02008.png"/>
						<figcaption>
							<p><a id="figure2-8">Figure 2-8</a>: Part of the single-user mode boot screen on a Mac</p>
						</figcaption>
					</figure>
					<p class="ListBody"><span epub:type="pagebreak" id="Page_18" title="18"/>The terminal prompt should contain <code>root#</code> (press <span class="KeyCaps">enter</span> a few times if it’s not visible on the last line, and it should come up), indicating that we’re logged in to the command line as the root, or administrator, user.</p>
					</li>
				<li value="3">Enter the following commands to mount, or connect to, the hard drive:
					<pre><code>localhost:/ root# <code class="bold">/sbin/fsck -fy</code>
localhost:/ root# <code class="bold">/sbin/mount -uw /</code></code></pre>
			</li>
				<li value="4">Now connect to the Open Directory service’s property list, or <em>plist</em>:
					<pre><code>localhost:/ root# <b>launchctl load /System/Library/LaunchDaemons/com.apple.opendirectoryd.plist</b></code></pre>
					<p class="ListBody">Your Mac uses Open Directory to track users, groups, file sharing, and even Wi-Fi printers. Think of it as a catalog of all the user accounts and permissions on your Mac.</p>
					</li>
				<li value="5">If you get an error after running the previous command, try running the following command instead—it’s the same as step 4, but for older Macs:
					<pre><code>localhost:/ root# <b>launchctl load /System/Library/LaunchDaemons/com.apple.DirectoryServices.plist</b></code></pre>
			</li>
				<li value="6">Now to change the root user’s password. Enter this command:
					<pre><code>localhost:/ root# <code class="bold">passwd</code></code></pre>
			</li>
				<li value="7">Enter a new password. You won’t see the characters of the password on the screen as you type. Then enter the password a second time to confirm the change. (If you mistype the password, start up in single-user mode again and do this same hack—it should reset the root user’s password every time.)</li>
			</ol>
			<aside epub:type="sidebar">
				<div class="top hr">
					<hr/>
				</div>
				<section class="note">
					<h2><span class="NoteHead">NOTE</span></h2>
					<p>
							To change any other user’s password while you’re logged in as <em>root</em>, enter <code>passwd</code> followed by the username you want to change (such as <code>passwd</code><code> </code><code>bryson</code>). You might be prompted for the root user password you just set; if so, enter it. Then type the user’s new password and press <b>ENTER</b>. Type the new password a second time and press <b>ENTER</b> again, and you’ll be able to log in as that user using the password you set.</p>
					<div class="bottom hr">
						<hr/>
					</div>
				</section>
			</aside>
			<h3 id="h2-502000c02-0005">You’re the Root User Now!</h3>
			<p class="BodyFirst">Well done! Now that you’ve changed the root user’s password to something you know, you can log in as the root user anytime you want. Try it out right now: either enter <code class="bold">reboot</code> at the command line<span class="KeyCaps"> </span>to reboot the computer or press the power button to turn the computer off and back on. When the computer boots normally to the Mac login screen, enter <code class="bold">root</code> as the username and type in the new password you’ve just set, as shown in <a href="#figure2-9" id="figureanchor2-9">Figure 2-9</a>.</p>
			<span epub:type="pagebreak" id="Page_19" title="19"/>
			<figure>
				<img alt="f02009" class="" src="image_fi/502000c02/f02009.png"/>
				<figcaption>
					<p><a id="figure2-9">Figure 2-9</a>: After the Mac root hack, you can log in as the root user with the password you set in the hack.</p>
				</figcaption>
			</figure>
			<p>Click through any setup screens you see, and you’ll soon come to the Mac desktop. You should see in the menu bar at the top of the screen that you’re logged in as the system administrator. You now have access to all users’ files and folders on the Mac!</p>
			<h2 id="h1-502000c02-0003">Other Physical Hacks</h2>
			<p class="BodyFirst">There are many physical access hacks besides the Sticky Keys hack and the Mac root hack. In fact, almost any bootable disc—like Ultimate Boot CD, KNOPPIX, SystemRescueCd, or Trinity Rescue Kit—can give you access to the files on the hard drive of a computer you have physical access to. There are also specially made hacking tools, like Rubber Ducky and Bash Bunny, that cost under $100 and look like regular USB drives but contain automated tools for hacking into computers. Some physical access hacks even use voice commands. For example, the Open Sesame! attack used Microsoft’s Cortana voice assistant to bypass the login screen by telling Cortana to open a malicious file on a USB drive or website.</p>
			<h2 id="h1-502000c02-0004">Protecting Against Physical Hacks</h2>
			<p class="BodyFirst">As you’ve seen, physical access hacks can help you recover old photos, copy files, and change users on almost any computer you can physically touch, even without the original password. However, that means anyone who has physical access and knows these hacks can access <em>your</em> private files and information too! That’s why it’s important to keep your devices with you or locked away in a secure area.</p>
			<p><span epub:type="pagebreak" id="Page_20" title="20"/>If someone manages to get access to your computer, however, there are a few ways to protect your data. One is to set a <em>firmware password</em>, also called a <em>BIOS password</em> or <em>EFI password</em>. This option on Macs and most PCs can prevent attackers from tampering with your computer’s BIOS/UEFI settings, neutralizing hacks like the Sticky Keys hack and Mac root hack. Unfortunately, firmware passwords are only one layer of defense and can often be bypassed. For example, motivated attackers can remove a battery from the circuit board in your computer, thereby erasing the stored firmware password on most PCs.</p>
			<p>
				A surer bet is to <em>encrypt</em> your files, scrambling them into an unreadable form that can only be <em>unencrypted</em> (unscrambled) with a password. The encryption password is different from your computer’s login password, so an attacker can’t see what’s inside your encrypted files by changing your user password with the Sticky Keys or Mac root hack. We’ll discuss encryption in more detail in <span class="xref" itemid="xref_target_Chapter 11">Chapter 11</span>.</p>
			<h2 id="h1-502000c02-0005">The Takeaway</h2>
			<p class="BodyFirst">In this chapter, you saw how to use the Windows Sticky Keys hack and Mac root hack to gain administrator-level access to all the files and user accounts on a computer, even when you don’t know the username and password. You also learned that there are other physical hacks and some specialized tools, like Rubber Ducky and Bash Bunny, that make physical hacks even easier. While you can use these hacks to recover lost files or reset a forgotten password, you also discovered that an attacker with physical access to your computer can often gain access to every bit of your information. You can defend against these hacks by limiting who has access to your computer, setting a firmware password, and encrypting your files.</p>
			<p>Now that you understand the importance of physical security, it’s time to start thinking about other attacks that can put your computer in danger—malicious websites, phishing and infected email attachments, and even attacks on the internet-connected smart devices in your daily life. To be able to practice these other types of hacks safely, and to learn to defend against them, you’ll set up your own private virtual hacking lab in Chapter 3.</p>
		</section>
	</body>
</html>