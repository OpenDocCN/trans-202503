- en: <hgroup>
  id: totrans-0
  prefs: []
  type: TYPE_NORMAL
  zh: <hgroup>
- en: <samp class="SANS_Futura_Std_Bold_Condensed_B_11">A</samp> <samp class="SANS_Dogma_OT_Bold_B_11">BUILDING
    A WINDOWS DOMAIN NETWORK FOR TESTING</samp>
  id: totrans-1
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: <samp class="SANS_Futura_Std_Bold_Condensed_B_11">A</samp> <samp class="SANS_Dogma_OT_Bold_B_11">构建一个用于测试的
    Windows 域网络</samp>
- en: </hgroup>
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: </hgroup>
- en: '![](../images/chapter.jpg)'
  id: totrans-3
  prefs: []
  type: TYPE_IMG
  zh: '![](../images/chapter.jpg)'
- en: Several chapters in this book make reference to a Windows domain network you
    can use for testing purposes. While you don’t need to set up such a network to
    follow along with the chapters, you can use it to run the examples, then alter
    the provided commands to observe different outcomes. If you don’t already have
    a suitable Windows domain network on hand to use for testing, this appendix will
    walk you through setting one up with virtual machines.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 本书中的几个章节提到了一个可以用于测试的 Windows 域网络。虽然你不需要设置这样的网络来跟随章节内容，但你可以使用它来运行示例，然后修改提供的命令以观察不同的结果。如果你手头没有合适的
    Windows 域网络用于测试，本附录将带你通过虚拟机设置一个网络。
- en: Running Windows in a virtual machine has many advantages. First, it gives you
    complete flexibility to configure (or misconfigure) Windows without compromising
    the security of your everyday installation. Virtualization platforms typically
    allow you to snapshot your virtual machines so you can roll them back to a known
    good state if something goes wrong. You can also isolate network traffic to prevent
    it from affecting other systems on the same network. Lastly, you can use a virtual
    machine to run Windows in a non-Windows environment.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 在虚拟机中运行 Windows 有许多优点。首先，它可以让你完全灵活地配置（或错误配置）Windows，而不会影响你日常安装的安全性。虚拟化平台通常允许你对虚拟机进行快照，以便在出现问题时将其恢复到已知的良好状态。你还可以隔离网络流量，防止它影响同一网络中的其他系统。最后，你可以在非
    Windows 环境中使用虚拟机运行 Windows。
- en: The domain configuration steps use PowerShell whenever possible. Note that,
    unless otherwise stated, you must run all of these PowerShell commands as an administrator
    user.
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 域配置步骤尽可能使用 PowerShell。请注意，除非另有说明，你必须以管理员身份运行所有这些 PowerShell 命令。
- en: <samp class="SANS_Futura_Std_Bold_B_11">The Domain Network</samp>
  id: totrans-7
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: <samp class="SANS_Futura_Std_Bold_B_11">域网络</samp>
- en: '[Figure A-1](appendix-A.xhtml#figA-1) is a diagram of the network we’ll build.
    For more information about the structure of domain networks in general, consult
    [Chapter 10](chapter10.xhtml).'
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: '[图 A-1](appendix-A.xhtml#figA-1) 是我们将要构建的网络图。如果你想了解更多关于域网络结构的一般信息，可以参考 [第 10
    章](chapter10.xhtml)。'
- en: '![](../images/FigureA-1.jpg)'
  id: totrans-9
  prefs: []
  type: TYPE_IMG
  zh: '![](../images/FigureA-1.jpg)'
- en: '<samp class="SANS_Futura_Std_Book_Oblique_I_11">Figure A-1: The domain network
    configuration</samp>'
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: <samp class="SANS_Futura_Std_Book_Oblique_I_11">图 A-1：域网络配置</samp>
- en: The network includes a forest made up of three domains. The root DNS name for
    the forest is *mineral.local*, and its two child domains are *engineering.mineral.local*
    and *sales.mineral.local*. To create a minimal functional domain for testing,
    you need only *PRIMARYDC*, which is the root domain controller, and *GRAPHITE*,
    a workstation joined to the domain. Anything included in dotted lines is optional.
    The next sections will show you how to set up the domain network and configure
    virtual machines for each of the Windows systems you want to include.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 网络包括一个由三个域组成的森林。该森林的根 DNS 名称是 *mineral.local*，其两个子域分别是 *engineering.mineral.local*
    和 *sales.mineral.local*。为了创建一个用于测试的最小功能域，你只需要 *PRIMARYDC*（根域控制器）和 *GRAPHITE*（加入该域的工作站）。任何包含在虚线中的内容都是可选的。接下来的章节将向你展示如何设置域网络，并配置虚拟机以包含你想要的每个
    Windows 系统。
- en: <samp class="SANS_Futura_Std_Bold_B_11">Installing and Configuring Windows Hyper-V</samp>
  id: totrans-12
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: <samp class="SANS_Futura_Std_Bold_B_11">安装和配置 Windows Hyper-V</samp>
- en: We’ll set up the Windows domain network using Hyper-V, which is virtualization
    software that comes for free on 64-bit versions of Windows Professional, Enterprise,
    and Education. If you’re not running Windows or don’t want to use Hyper-V, another
    good free option is Oracle’s VirtualBox (*[https://<wbr>www<wbr>.virtualbox<wbr>.org](https://www.virtualbox.org)*).
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将使用 Hyper-V 来设置 Windows 域网络，Hyper-V 是一种虚拟化软件，Windows 专业版、企业版和教育版的 64 位版本都提供免费使用。如果你没有运行
    Windows 或不想使用 Hyper-V，另一个很好的免费选项是 Oracle 的 VirtualBox（*[https://<wbr>www<wbr>.virtualbox<wbr>.org](https://www.virtualbox.org)*）。
- en: 'To install Hyper-V and its tools, start an administrator PowerShell console
    and run the following command. Make sure to restart the system after installation:'
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 要安装 Hyper-V 及其工具，启动一个管理员 PowerShell 控制台并运行以下命令。安装后确保重新启动系统：
- en: '[PRE0]'
  id: totrans-15
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: The next step is to configure a new network for the virtual machines, as shown
    in [Listing A-1](appendix-A.xhtml#LisA-1). This allows you to have complete control
    over all aspects of the network configuration for the domain network and isolates
    it from your real network.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 下一步是为虚拟机配置一个新的网络，如[清单 A-1](appendix-A.xhtml#LisA-1)所示。这使你能够完全控制域网络的所有网络配置，并将其与实际网络隔离。
- en: '[PRE1]'
  id: totrans-17
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'Listing A-1: Creating a new virtual machine network switch'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 清单 A-1：创建新的虚拟机网络交换机
- en: We first create a new switch for the domain network using the <samp class="SANS_TheSansMonoCd_W5Regular_11">New-VMSwitch</samp>
    command, which you need to do only once during this initial configuration process.
    We give the switch the name <samp class="SANS_TheSansMonoCd_W7Bold_B_11">"</samp><samp
    class="SANS_TheSansMonoCd_W5Regular_11">Domain Network</samp><samp class="SANS_TheSansMonoCd_W7Bold_B_11">"</samp>
    and set its type to <samp class="SANS_TheSansMonoCd_W5Regular_11">Internal</samp>,
    which means it’s a virtual network that can communicate with the virtual machine
    host.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 我们首先使用<sup class="SANS_TheSansMonoCd_W5Regular_11">New-VMSwitch</sup>命令为域网络创建一个新的交换机，这个过程只需在初始配置时执行一次。我们为该交换机命名为<sup
    class="SANS_TheSansMonoCd_W7Bold_B_11">"</sup><sup class="SANS_TheSansMonoCd_W5Regular_11">Domain
    Network</sup><sup class="SANS_TheSansMonoCd_W7Bold_B_11">"</sup>，并将其类型设置为<sup
    class="SANS_TheSansMonoCd_W5Regular_11">Internal</sup>，这意味着它是一个可以与虚拟机主机通信的虚拟网络。
- en: Next, we need to assign the virtual network adapter that was created for the
    switch with an IP address. The <samp class="SANS_TheSansMonoCd_W5Regular_11">Get-NetAdapter</samp>
    command lists all network adapters and finds the unique index number for the adapter
    for our domain network. We then assign the IP address of 192.168.99.1 to the adapter,
    with a subnet prefix of 24 bits (perhaps more commonly seen as the subnet mask
    255.255.255.0). You’re welcome to set the IP address to any value you like, but
    keep in mind that if you change the address, you’ll also need to update it throughout
    the rest of this appendix.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们需要为为交换机创建的虚拟网络适配器分配一个IP地址。<samp class="SANS_TheSansMonoCd_W5Regular_11">Get-NetAdapter</samp>
    命令列出所有网络适配器，并查找我们域网络适配器的唯一索引号。然后，我们为该适配器分配IP地址192.168.99.1，并设置子网前缀为24位（通常以子网掩码255.255.255.0的形式表示）。你可以将IP地址设置为任何你喜欢的值，但请记住，如果你更改地址，接下来在本附录中的其他地方也需要相应更新它。
- en: The final step is to set up *network address translation (NAT)* for the IP address
    using the <samp class="SANS_TheSansMonoCd_W5Regular_11">New-NetNat</samp> command.
    This will allow computers on the network to access the internet by setting their
    default gateway to the adapter’s IP address, in this case 192.168.99.1.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 最后的步骤是为IP地址设置*网络地址转换（NAT）*，使用<sup class="SANS_TheSansMonoCd_W5Regular_11">New-NetNat</sup>命令。这将允许网络上的计算机通过将默认网关设置为适配器的IP地址（在此案例中为192.168.99.1）来访问互联网。
- en: <samp class="SANS_Dogma_OT_Bold_B_15">NOTE</samp>
  id: totrans-22
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: <samp class="SANS_Dogma_OT_Bold_B_15">注意</samp>
- en: ''
  id: totrans-23
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '*This configuration doesn’t set up a Dynamic Host Configuration Protocol (DHCP)
    server to automatically assign IP addresses to computers on the network. As the
    network is so small, we’ll just statically assign IP addresses to the computers
    as we go.*'
  id: totrans-24
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '*此配置不会设置动态主机配置协议（DHCP）服务器来自动分配IP地址给网络上的计算机。由于网络规模较小，我们将手动为计算机分配IP地址。*'
- en: <samp class="SANS_Futura_Std_Bold_B_11">Creating the Virtual Machines</samp>
  id: totrans-25
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: <samp class="SANS_Futura_Std_Bold_B_11">创建虚拟机</samp>
- en: '[Table A-1](appendix-A.xhtml#tabA-1) lists the virtual machines we’ll set up,
    along with the operating system type and IP address for each. I’ll walk through
    setting up the *PRIMARYDC*, *GRAPHITE*, and optional *SALESDC* virtual machines.
    The other virtual machines in the table are completely optional; if you want to
    create them, you can replace the specified values in the sections on setting up
    each virtual machine with the appropriate values from the table.'
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: '[表 A-1](appendix-A.xhtml#tabA-1)列出了我们将要设置的虚拟机，以及每个虚拟机的操作系统类型和IP地址。我将带你设置*PRIMARYDC*、*GRAPHITE*和可选的*SALESDC*虚拟机。表中的其他虚拟机是完全可选的；如果你想创建它们，可以在设置每个虚拟机的章节中，使用表格中适当的值替换指定的值。'
- en: <samp class="SANS_Futura_Std_Heavy_B_11">Table A-1:</samp> <samp class="SANS_Futura_Std_Book_11">Virtual
    Machine Names and IP Addresses</samp>
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: <samp class="SANS_Futura_Std_Heavy_B_11">表 A-1：</samp> <samp class="SANS_Futura_Std_Book_11">虚拟机名称和IP地址</samp>
- en: '| <samp class="SANS_Futura_Std_Heavy_B_11">Virtual machine name</samp> | <samp
    class="SANS_Futura_Std_Heavy_B_11">Operating system</samp> | <samp class="SANS_Futura_Std_Heavy_B_11">IP
    address</samp> |'
  id: totrans-28
  prefs: []
  type: TYPE_TB
- en: '| --- | --- | --- |'
  id: totrans-29
  prefs: []
  type: TYPE_TB
- en: '| <samp class="SANS_Futura_Std_Book_Oblique_I_11">PRIMARYDC</samp> | <samp
    class="SANS_Futura_Std_Book_11">Windows Server</samp> | <samp class="SANS_Futura_Std_Book_11">192.168.99.10</samp>
    |'
  id: totrans-30
  prefs: []
  type: TYPE_TB
- en: '| <samp class="SANS_Futura_Std_Book_Oblique_I_11">GRAPHITE</samp> | <samp class="SANS_Futura_Std_Book_11">Windows
    Professional or Enterprise</samp> | <samp class="SANS_Futura_Std_Book_11">192.168.99.50</samp>
    |'
  id: totrans-31
  prefs: []
  type: TYPE_TB
- en: '| <samp class="SANS_Futura_Std_Book_Oblique_I_11">CINNABAR</samp> | <samp class="SANS_Futura_Std_Book_11">Windows
    Server</samp> | <samp class="SANS_Futura_Std_Book_11">192.168.99.20</samp> |'
  id: totrans-32
  prefs: []
  type: TYPE_TB
- en: '| <samp class="SANS_Futura_Std_Book_Oblique_I_11">SALESDC</samp> | <samp class="SANS_Futura_Std_Book_11">Windows
    Server</samp> | <samp class="SANS_Futura_Std_Book_11">192.168.99.110</samp> |'
  id: totrans-33
  prefs: []
  type: TYPE_TB
- en: '| <samp class="SANS_Futura_Std_Book_Oblique_I_11">GOLD</samp> | <samp class="SANS_Futura_Std_Book_11">Windows
    Professional or Enterprise</samp> | <samp class="SANS_Futura_Std_Book_11">192.168.99.150</samp>
    |'
  id: totrans-34
  prefs: []
  type: TYPE_TB
- en: '| <samp class="SANS_Futura_Std_Book_Oblique_I_11">ENGDC</samp> | <samp class="SANS_Futura_Std_Book_11">Windows
    Server</samp> | <samp class="SANS_Futura_Std_Book_11">192.168.99.210</samp> |'
  id: totrans-35
  prefs: []
  type: TYPE_TB
- en: '| <samp class="SANS_Futura_Std_Book_Oblique_I_11">STEEL</samp> | <samp class="SANS_Futura_Std_Book_11">Windows
    Professional or Enterprise</samp> | <samp class="SANS_Futura_Std_Book_11">192.168.99.220</samp>
    |'
  id: totrans-36
  prefs: []
  type: TYPE_TB
- en: Microsoft provides trial editions of Windows Enterprise and Windows Server as
    virtual machines. I’d recommend using your favorite search engine to find the
    latest links on Microsoft’s website. For each machine, install the correct Windows
    version and then use PowerShell to configure it.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
- en: To use Windows virtual machines with Hyper-V, you’ll need the installation media
    and license keys for Windows Professional or Enterprise and Windows Server. A
    common way to get access to these is through a Microsoft Visual Studio subscription.
    The versions of Windows and Server you use won’t matter for the topics we’ll discuss.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
- en: <samp class="SANS_Dogma_OT_Bold_B_15">NOTE</samp>
  id: totrans-39
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  id: totrans-40
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '*Server installations include a long-term service branch that comes with the
    Windows desktop and a more up-to-date version, called a* server core version*,
    that has only a command line. As we’ll configure the server installation with
    PowerShell, either version will work. However, if you’re more comfortable with
    a GUI, use the long-term service branch with a desktop instead.*'
  id: totrans-41
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '[Listing A-2](appendix-A.xhtml#LisA-2) defines the function we’ll use to do
    most of the work of setting up a virtual machine, <samp class="SANS_TheSansMonoCd_W5Regular_11">New-TestVM</samp>.'
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  id: totrans-43
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'Listing A-2: Defining the New-TestVM function'
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
- en: The <samp class="SANS_TheSansMonoCd_W5Regular_11">New-TestVM</samp> function
    takes the name of the virtual machine so it can create the path to the DVD image
    to install and the base directory for the virtual machine’s assets. We start by
    calling the <samp class="SANS_TheSansMonoCd_W5Regular_11">New-VM</samp> command
    to create the virtual machine ❶. We set its memory to 4GB and create an 80GB virtual
    hard disk. (You can increase these sizes if you like.) We also assign the default
    network adapter to use the <samp class="SANS_TheSansMonoCd_W7Bold_B_11">"</samp><samp
    class="SANS_TheSansMonoCd_W5Regular_11">Domain Network</samp><samp class="SANS_TheSansMonoCd_W7Bold_B_11">"</samp>
    switch we created in [Listing A-1](appendix-A.xhtml#LisA-1).
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: <samp class="SANS_TheSansMonoCd_W5Regular_11">New-TestVM</samp> 函数接受虚拟机的名称，以便它能够创建安装
    DVD 镜像的路径以及虚拟机资产的基本目录。我们首先调用 <samp class="SANS_TheSansMonoCd_W5Regular_11">New-VM</samp>
    命令来创建虚拟机 ❶。我们将其内存设置为 4GB，并创建一个 80GB 的虚拟硬盘。（如果需要，可以增加这些大小。）我们还分配了默认的网络适配器，使用我们在
    [列表 A-1](appendix-A.xhtml#LisA-1) 中创建的 <samp class="SANS_TheSansMonoCd_W7Bold_B_11">"</samp><samp
    class="SANS_TheSansMonoCd_W5Regular_11">Domain Network</samp><samp class="SANS_TheSansMonoCd_W7Bold_B_11">"</samp>
    开关。
- en: Next, we use the <samp class="SANS_TheSansMonoCd_W5Regular_11">Set-VM</samp>
    command to configure some virtual machine options not exposed through <samp class="SANS_TheSansMonoCd_W5Regular_11">New-VM</samp>
    ❷. We assign two CPUs to the virtual machine, as I find modern versions of Windows
    struggle with only one CPU. You can increase the number of CPUs if your base machine
    has many CPU cores.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们使用 <samp class="SANS_TheSansMonoCd_W5Regular_11">Set-VM</samp> 命令配置一些
    <samp class="SANS_TheSansMonoCd_W5Regular_11">New-VM</samp> ❷ 命令未显示的虚拟机选项。我们为虚拟机分配两个
    CPU，因为我发现现代版本的 Windows 在只有一个 CPU 时运行困难。如果你的主机有多个 CPU 核心，可以增加 CPU 数量。
- en: We also enable dynamic memory. This allows Windows to scale the virtual machines’
    memory usage as needed. I’ve found that typically a server installation uses only
    around 2GB of memory when running, but it could be more, especially for clients.
    Dynamic memory can both increase and decrease allocated memory as needed.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 我们还启用了动态内存。这使得 Windows 能根据需要调整虚拟机的内存使用量。我发现，通常服务器安装时运行时只需要大约 2GB 的内存，但特别是对于客户端，可能会更多。动态内存可以根据需要增加或减少分配的内存。
- en: Finally, we set up a DVD drive on a virtual SCSI controller and assign the DVD
    image to it ❸. We’ll use this as the primary boot drive, so we can install the
    operating system from the DVD image.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，我们在虚拟 SCSI 控制器上设置 DVD 驱动器，并将 DVD 镜像分配给它 ❸。我们将使用这个驱动器作为主要启动驱动器，从 DVD 镜像安装操作系统。
- en: We now need to create each virtual machine using the function we defined and
    start the installation process.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们需要使用我们定义的函数创建每个虚拟机，并开始安装过程。
- en: <samp class="SANS_Futura_Std_Bold_Condensed_Oblique_BI_11">The PRIMARYDC Server</samp>
  id: totrans-50
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: <samp class="SANS_Futura_Std_Bold_Condensed_Oblique_BI_11">PRIMARYDC 服务器</samp>
- en: The *PRIMARYDC* machine is a Windows server that will act as the root domain
    controller for our forest. In [Listing A-3](appendix-A.xhtml#LisA-3), we start
    by creating the virtual machine as an administrator.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: '*PRIMARYDC* 机器是一个 Windows 服务器，将作为我们森林的根域控制器。在 [列表 A-3](appendix-A.xhtml#LisA-3)
    中，我们首先作为管理员创建虚拟机。'
- en: '[PRE3]'
  id: totrans-52
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'Listing A-3: Creating and starting the <samp class="SANS_Futura_Std_Book_11">PRIMARYDC</samp>
    virtual machine'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 列表 A-3：创建并启动 <samp class="SANS_Futura_Std_Book_11">PRIMARYDC</samp> 虚拟机
- en: We install the *PRIMARYDC* virtual machine from the DVD image file *C:\iso\server.iso*
    and create the virtual machine in the *C:\vms* directory. This should create a
    new directory under the virtual machine directory for the *PRIMARYDC* server’s
    files, which allows us to separate our resources for each of our virtual machines.
    Next, we start the virtual machine’s user interface so we can interact with the
    installation process, and then start the virtual machine.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 我们从 DVD 镜像文件 *C:\iso\server.iso* 安装 *PRIMARYDC* 虚拟机，并在 *C:\vms* 目录下创建虚拟机。这将会在虚拟机目录下为
    *PRIMARYDC* 服务器的文件创建一个新的目录，从而使我们能够为每个虚拟机分隔资源。接下来，我们启动虚拟机的用户界面，以便与安装过程进行交互，然后启动虚拟机。
- en: Now that you can interact with the virtual machine, you can follow the installation
    steps as for any other Window Server installation. I won’t provide detailed instructions
    for this, as it’s mostly a case of selecting your region and the installation
    drive and following the default process.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 现在你可以与虚拟机进行交互，你可以像其他 Windows Server 安装一样按照安装步骤进行。我不会提供详细的步骤，因为它基本上是选择你的区域和安装驱动器，并按照默认流程进行。
- en: When asked for the *Administrator* user’s password during the installation,
    you can set anything you like, but in this book I’ve assumed it will be set to
    <samp class="SANS_TheSansMonoCd_W5Regular_11">Passw0rd</samp>. As this is a weak
    password, do not expose these virtual machines to a network where untrusted users
    can access them. However, for testing and demonstration purposes, having easily
    memorable passwords is usually a good idea.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 在安装过程中，如果系统询问 *Administrator* 用户的密码，你可以设置任意密码，但在本书中我假设它将设置为 <samp class="SANS_TheSansMonoCd_W5Regular_11">Passw0rd</samp>。由于这是一个弱密码，请勿将这些虚拟机暴露到不可信的网络中。然而，出于测试和演示的目的，使用易于记忆的密码通常是个不错的选择。
- en: Once you’ve gained access to either a desktop (if using the long-term service
    branch version of the server) or a command line (if using the server core version),
    you can finish the basic setup. All subsequent PowerShell commands will be run
    on the VM itself, not the host. First start an administrator copy of PowerShell
    to run the commands in [Listing A-4](appendix-A.xhtml#LisA-4).
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦你获得了桌面访问权限（如果使用的是长期服务分支版本的服务器）或命令行访问权限（如果使用的是服务器核心版本），你可以完成基本设置。所有后续的 PowerShell
    命令都将在虚拟机本身上运行，而不是在主机上。首先启动一个管理员权限的 PowerShell 来运行 [清单 A-4](appendix-A.xhtml#LisA-4)
    中的命令。
- en: '[PRE4]'
  id: totrans-58
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'Listing A-4: Setting up the <samp class="SANS_Futura_Std_Book_11">PRIMARYDC</samp>
    virtual machine network'
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 清单 A-4：设置 <samp class="SANS_Futura_Std_Book_11">PRIMARYDC</samp> 虚拟机网络
- en: As the network switch we created earlier doesn’t include support for DHCP, it
    won’t automatically assign an IP address during installation. Thus, we need to
    set up the network with static IP addresses. [Listing A-4](appendix-A.xhtml#LisA-4)
    starts by setting the IP address of the network adapter; you should use the IP
    address from [Table A-1](appendix-A.xhtml#tabA-1) for the virtual machine you’re
    configuring. The <samp class="SANS_TheSansMonoCd_W5Regular_11">DefaultGateway</samp>
    parameter should be the IP address you set on the host in [Listing A-1](appendix-A.xhtml#LisA-1)
    so that traffic can be routed to the external network.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 由于我们之前创建的网络交换机不支持 DHCP，它在安装过程中不会自动分配 IP 地址。因此，我们需要使用静态 IP 地址来设置网络。[清单 A-4](appendix-A.xhtml#LisA-4)
    从设置网络适配器的 IP 地址开始；你应该使用 [表 A-1](appendix-A.xhtml#tabA-1) 中为你正在配置的虚拟机指定的 IP 地址。<samp
    class="SANS_TheSansMonoCd_W5Regular_11">DefaultGateway</samp> 参数应该是你在 [清单 A-1](appendix-A.xhtml#LisA-1)
    中为主机设置的 IP 地址，以便流量能够路由到外部网络。
- en: You’ll also need to specify a DNS server address for the network adapter. In
    [Listing A-4](appendix-A.xhtml#LisA-4) we set this to the address of the public
    Google DNS server, 8.8.8.8\. If you know the IP address of your internet provider
    or another preferred DNS server, use that instead. Once we’ve finished setting
    up the domain controller, we’ll no longer need this DNS server, as the domain
    controller has its own DNS server.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 你还需要为网络适配器指定一个 DNS 服务器地址。在 [清单 A-4](appendix-A.xhtml#LisA-4) 中，我们将其设置为公共 Google
    DNS 服务器的地址 8.8.8.8。如果你知道你的互联网服务提供商的 IP 地址或其他首选 DNS 服务器的地址，可以使用那个。设置完域控制器后，我们将不再需要这个
    DNS 服务器，因为域控制器有自己的 DNS 服务器。
- en: You should now be able to access an external network. At this point, you might
    need to activate your copy of Windows Server if you’re not using a trial version.
    You’ll also want to ensure that the copy of Windows is up to date, including all
    security patches. While the network will isolate the virtual machines from external
    networks to a degree, this doesn’t mean they can’t be compromised, so it’s best
    to be certain.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 现在你应该能够访问外部网络。如果你没有使用试用版的 Windows Server，你可能需要激活你的 Windows Server 副本。你还需要确保
    Windows 版本是最新的，包括所有安全补丁。尽管网络会在一定程度上将虚拟机与外部网络隔离，但这并不意味着它们不能被攻破，因此最好确保一切安全。
- en: Next, rename the computer using the <samp class="SANS_TheSansMonoCd_W5Regular_11">Rename-Computer</samp>
    command, as shown in [Listing A-5](appendix-A.xhtml#LisA-5).
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，使用 <samp class="SANS_TheSansMonoCd_W5Regular_11">Rename-Computer</samp>
    命令重命名计算机，如 [清单 A-5](appendix-A.xhtml#LisA-5) 所示。
- en: '[PRE5]'
  id: totrans-64
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'Listing A-5: Renaming the computer'
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 清单 A-5：重命名计算机
- en: This name will be used on the domain network, so it helps to have memorable
    names. Replace *PRIMARYDC* with your own name if you prefer.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 这个名称将用于域网络，因此使用容易记住的名称会很有帮助。如果你更喜欢，可以将 *PRIMARYDC* 替换为你自己的名称。
- en: Once you’ve renamed the computer, you need to configure the server as the domain
    controller for the *mineral.local* domain. Log in to the server as an administrator
    and run the commands in [Listing A-6](appendix-A.xhtml#LisA-6).
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦你重命名了计算机，就需要将服务器配置为 *mineral.local* 域的域控制器。以管理员身份登录服务器并运行 [清单 A-6](appendix-A.xhtml#LisA-6)
    中的命令。
- en: '[PRE6]'
  id: totrans-68
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'Listing A-6: Installing and configuring the Active Directory domain services'
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 清单 A-6：安装和配置活动目录域服务
- en: First, we install the <samp class="SANS_TheSansMonoCd_W5Regular_11">AD-Domain-Services</samp>
    feature. This feature installs the Active Directory server and associated services
    to run the server as a domain controller. Next, we run the <samp class="SANS_TheSansMonoCd_W5Regular_11">Install-ADDSForest</samp>
    command to set up the forest and create the root domain. We specify the DNS name
    of the domain, which in this case is *mineral.local*. We also specify the simple
    name of the domain as *MINERAL* and request that a local DNS server be installed.
    Active Directory can’t work without a DNS server, and as this is an isolated network,
    it makes sense to run the DNS server on the domain controller server.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们安装 <samp class="SANS_TheSansMonoCd_W5Regular_11">AD-Domain-Services</samp>
    功能。该功能会安装活动目录服务器及相关服务，将服务器作为域控制器运行。接下来，我们运行 <samp class="SANS_TheSansMonoCd_W5Regular_11">Install-ADDSForest</samp>
    命令来设置林并创建根域。我们指定域的 DNS 名称，在此案例中为 *mineral.local*。我们还指定域的简单名称为 *MINERAL* 并请求安装本地
    DNS 服务器。活动目录在没有 DNS 服务器的情况下无法工作，而由于这是一个隔离网络，在域控制器服务器上运行 DNS 服务器是有意义的。
- en: When setting up the forest, you’ll be asked to specify a safe-mode administrator
    password. This password allows you to recover the Active Directory database. In
    such a small, non-production domain, you’re unlikely to need this feature, but
    you should still specify a password you can remember. You’re likely to see a few
    warnings during the installation; you can safely ignore these. Once the command
    has completed, the server will reboot automatically.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 在设置森林时，你将被要求指定一个安全模式管理员密码。这个密码允许你恢复活动目录数据库。在如此小的、非生产域中，你不太可能需要此功能，但仍然应该指定一个你能记住的密码。你在安装过程中可能会看到一些警告，这些可以放心忽略。一旦命令完成，服务器将自动重启。
- en: When it has finished rebooting you should reauthenticate to the server, but
    make sure to use the username *MINERAL\Administrator* so that you can use the
    domain administrator account. The password for the domain administrator should
    be the same as the one you initially configured when installing the server. Then,
    start an instance of PowerShell and run the commands in [Listing A-7](appendix-A.xhtml#LisA-7)
    to do some basic user setup.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 重启完成后，你需要重新验证服务器身份，但请确保使用用户名*MINERAL\Administrator*，以便你可以使用域管理员账户。域管理员的密码应该与你最初安装服务器时配置的密码相同。然后，启动
    PowerShell 实例并运行[清单 A-7](appendix-A.xhtml#LisA-7)中的命令，进行一些基本的用户设置。
- en: '[PRE7]'
  id: totrans-73
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'Listing A-7: Configuring the domain password policy and adding users and groups'
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 清单 A-7：配置域密码策略及添加用户和组
- en: First, we set the domain’s password policy to prevent passwords from expiring
    ❶. There’s nothing worse than coming back to your virtual machines after a few
    months and being faced with changing the passwords, which you immediately forget.
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们设置域的密码策略，以防止密码过期❶。没有什么比几个月后回到虚拟机时，看到需要更改密码，而你立刻忘记密码更糟糕的了。
- en: <samp class="SANS_Dogma_OT_Bold_B_15">NOTE</samp>
  id: totrans-76
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: <samp class="SANS_Dogma_OT_Bold_B_15">注意</samp>
- en: ''
  id: totrans-77
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '*Even though the default password expiry for a new domain is 42 days, Microsoft
    no longer recommends having forced password expiry enabled. This is because making
    users change their password frequently can cause more harm than good by encouraging
    them to use trivial passwords, so they don’t forget them.*'
  id: totrans-78
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '*尽管新域的默认密码过期时间为42天，微软不再建议启用强制密码过期功能。这是因为频繁要求用户更改密码可能会适得其反，促使用户使用简单的密码，以免忘记。*'
- en: 'We then create two domain users, *alice* and *bob*, assigning each of them
    a password ❷. We also set a few Active Directory attributes for each user: specifically,
    their name and country. I’ve summarized the values to specify in [Table A-2](appendix-A.xhtml#tabA-2).
    Of course, you can set the names and values to anything you prefer.'
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们创建两个域用户，*alice* 和 *bob*，并为每个用户分配一个密码❷。我们还为每个用户设置了一些活动目录属性：具体来说，他们的姓名和国家。我已经在[表
    A-2](appendix-A.xhtml#tabA-2)中总结了要指定的值。当然，你可以根据需要设置任何名称和值。
- en: <samp class="SANS_Futura_Std_Heavy_B_11">Table A-2:</samp> <samp class="SANS_Futura_Std_Book_11">Default
    Users for the Root Domain</samp>
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: <samp class="SANS_Futura_Std_Heavy_B_11">表 A-2：</samp> <samp class="SANS_Futura_Std_Book_11">根域的默认用户</samp>
- en: '| <samp class="SANS_Futura_Std_Heavy_B_11">Username</samp> | <samp class="SANS_Futura_Std_Heavy_B_11">Given
    name</samp> | <samp class="SANS_Futura_Std_Heavy_B_11">Country</samp> | <samp
    class="SANS_Futura_Std_Heavy_B_11">Password</samp> |'
  id: totrans-81
  prefs: []
  type: TYPE_TB
  zh: '| <samp class="SANS_Futura_Std_Heavy_B_11">用户名</samp> | <samp class="SANS_Futura_Std_Heavy_B_11">姓名</samp>
    | <samp class="SANS_Futura_Std_Heavy_B_11">国家</samp> | <samp class="SANS_Futura_Std_Heavy_B_11">密码</samp>
    |'
- en: '| --- | --- | --- | --- |'
  id: totrans-82
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- | --- |'
- en: '| <samp class="SANS_Futura_Std_Book_Oblique_I_11">alice</samp> | <samp class="SANS_Futura_Std_Book_11">Alice
    Bombas</samp> | <samp class="SANS_Futura_Std_Book_11">USA</samp> | <samp class="SANS_TheSansMonoCd_W5Regular_11">Passw0rd1</samp>
    |'
  id: totrans-83
  prefs: []
  type: TYPE_TB
  zh: '| <samp class="SANS_Futura_Std_Book_Oblique_I_11">alice</samp> | <samp class="SANS_Futura_Std_Book_11">Alice
    Bombas</samp> | <samp class="SANS_Futura_Std_Book_11">USA</samp> | <samp class="SANS_TheSansMonoCd_W5Regular_11">Passw0rd1</samp>
    |'
- en: '| <samp class="SANS_Futura_Std_Book_Oblique_I_11">bob</samp> | <samp class="SANS_Futura_Std_Book_11">Bob
    Cordite</samp> | <samp class="SANS_Futura_Std_Book_11">JP</samp> | <samp class="SANS_TheSansMonoCd_W5Regular_11">Passw0rd2</samp>
    |'
  id: totrans-84
  prefs: []
  type: TYPE_TB
  zh: '| <samp class="SANS_Futura_Std_Book_Oblique_I_11">bob</samp> | <samp class="SANS_Futura_Std_Book_11">Bob
    Cordite</samp> | <samp class="SANS_Futura_Std_Book_11">JP</samp> | <samp class="SANS_TheSansMonoCd_W5Regular_11">Passw0rd2</samp>
    |'
- en: The final task in [Listing A-7](appendix-A.xhtml#LisA-7) is to create three
    Active Directory groups ❸, one for each group scope. We also assign the two users
    to a combination of these groups.
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: '[列表 A-7](appendix-A.xhtml#LisA-7)中的最终任务是创建三个 Active Directory 组 ❸，每个组对应一个作用域。我们还将这两个用户分配到这些组的组合中。'
- en: <samp class="SANS_Futura_Std_Bold_Condensed_Oblique_BI_11">The GRAPHITE Workstation</samp>
  id: totrans-86
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: <samp class="SANS_Futura_Std_Bold_Condensed_Oblique_BI_11">GRAPHITE 工作站</samp>
- en: With the domain controller configured, we can now set up a workstation. Run
    the script in [Listing A-8](appendix-A.xhtml#LisA-8) to create the virtual machine,
    as we did with *PRIMARYDC*.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 配置好域控制器后，我们可以开始设置工作站。运行 [列表 A-8](appendix-A.xhtml#LisA-8) 中的脚本创建虚拟机，正如我们在 *PRIMARYDC*
    上所做的那样。
- en: '[PRE8]'
  id: totrans-88
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'Listing A-8: Creating and starting the <samp class="SANS_Futura_Std_Book_11">GRAPHITE</samp>
    virtual machine'
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 列表 A-8：创建并启动 <samp class="SANS_Futura_Std_Book_11">GRAPHITE</samp> 虚拟机
- en: In this case, you’ll use a disk image of Windows Professional or Enterprise,
    rather than a server installation. Any currently supported version of Windows
    10 or greater is sufficient. Proceed with the installation as you normally would,
    creating the machine’s username and password. This book assumes you’ll use the
    username *admin* and a password of <samp class="SANS_TheSansMonoCd_W5Regular_11">Passw0rd</samp>,
    but you can pick any username and password you prefer.
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 在这种情况下，你将使用 Windows Professional 或 Enterprise 的磁盘镜像，而不是服务器安装。任何当前支持的 Windows
    10 或更高版本都足够了。按照正常的方式进行安装，创建机器的用户名和密码。本书假设你将使用用户名 *admin* 和密码 <samp class="SANS_TheSansMonoCd_W5Regular_11">Passw0rd</samp>，但你可以选择任何你喜欢的用户名和密码。
- en: '[Listing A-9](appendix-A.xhtml#LisA-9) sets up the network, as in [Listing
    A-4](appendix-A.xhtml#LisA-4).'
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: '[列表 A-9](appendix-A.xhtml#LisA-9)像[列表 A-4](appendix-A.xhtml#LisA-4)一样设置网络。'
- en: '[PRE9]'
  id: totrans-92
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'Listing A-9: Setting the domain DNS server and checking that it resolves'
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 列表 A-9：设置域 DNS 服务器并检查其解析
- en: The only difference here is that we configure the DNS server to use the one
    we installed on the domain controller at 192.168.99.10\. You can verify that the
    DNS server is working correctly by attempting to resolve the *primarydc.mineral.local*
    server address. You should also be able to resolve internet domain names, as the
    domain controller will forward the requests onward.
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 唯一的不同之处在于我们将 DNS 服务器配置为使用我们在域控制器上安装的服务器地址 192.168.99.10\。你可以通过尝试解析 *primarydc.mineral.local*
    服务器地址来验证 DNS 服务器是否正常工作。你还应该能够解析互联网域名，因为域控制器会将请求转发。
- en: Again, once you’ve configured this network, you’ll want to ensure that you’ve
    activated your Windows installation if necessary and downloaded any updates. If
    desired, you can rename the workstation to your chosen name before continuing.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 再次提醒，配置好网络后，如果需要，确保激活 Windows 安装并下载任何更新。如果需要，你可以在继续之前将工作站重命名为你选择的名称。
- en: In [Listing A-10](appendix-A.xhtml#LisA-10), we join the workstation to the
    domain.
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 在 [列表 A-10](appendix-A.xhtml#LisA-10) 中，我们将工作站加入域。
- en: '[PRE10]'
  id: totrans-97
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'Listing A-10: Joining the <samp class="SANS_Futura_Std_Book_11">GRAPHITE</samp>
    workstation to the domain'
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 列表 A-10：将 <samp class="SANS_Futura_Std_Book_11">GRAPHITE</samp> 工作站加入域
- en: The first thing we need are the credentials for a user in the domain. As I explained
    in [Chapter 11](chapter11.xhtml), this user doesn’t need to be a domain administrator;
    it can be a normal user. For example, you can enter the credentials for the *alice*
    user when prompted by the <samp class="SANS_TheSansMonoCd_W5Regular_11">Get-Credential</samp>
    command’s GUI.
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 我们首先需要的是域中用户的凭据。正如我在 [第 11 章](chapter11.xhtml) 中解释的那样，这个用户不需要是域管理员；它可以是一个普通用户。例如，你可以在
    <samp class="SANS_TheSansMonoCd_W5Regular_11">Get-Credential</samp> 命令的图形界面提示中输入
    *alice* 用户的凭据。
- en: Next, we call the <samp class="SANS_TheSansMonoCd_W5Regular_11">Add-Computer</samp>
    command to join the workstation to the *MINERAL* domain with the user’s credentials.
    If this succeeds, it will print a warning telling you to restart the computer.
    However, don’t restart it just yet; you first need to add a domain user, such
    as *alice*, to the local *Administrators* group using the <samp class="SANS_TheSansMonoCd_W5Regular_11">Add-LocalGroupMember</samp>
    command. If you don’t do this step, you’ll subsequently have to authenticate to
    the workstation using either a domain administrator or the original local administrator
    account. Adding a user to this group allows you to authenticate as that user and
    be a local administrator. Once this is done, you can reboot.
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们调用 <samp class="SANS_TheSansMonoCd_W5Regular_11">Add-Computer</samp> 命令，将工作站加入
    *MINERAL* 域，并使用用户的凭据。如果成功，它会打印出一条警告，提示你重启计算机。然而，此时不要重启；你需要先使用 <samp class="SANS_TheSansMonoCd_W5Regular_11">Add-LocalGroupMember</samp>
    命令将域用户（例如 *alice*）添加到本地 *Administrators* 组。如果你不执行此步骤，之后你将必须使用域管理员或原始的本地管理员账户来验证工作站的身份。将用户添加到此组可以使你以该用户身份进行验证，并成为本地管理员。完成此操作后，你可以重新启动计算机。
- en: That’s all there is to setting up a workstation. You can configure the rest
    of the workstation’s settings through the group policy on the domain controller.
    Once the workstation has restarted, you should be able to authenticate as any
    domain user.
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 这就是设置工作站的全部内容。你可以通过域控制器上的组策略配置工作站的其余设置。一旦工作站重新启动，你应该能够以任何域用户身份进行身份验证。
- en: <samp class="SANS_Futura_Std_Bold_Condensed_Oblique_BI_11">The SALESDC Server</samp>
  id: totrans-102
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: <samp class="SANS_Futura_Std_Bold_Condensed_Oblique_BI_11">SALESDC 服务器</samp>
- en: 'The *SALESDC* virtual machine is a Windows server that serves a domain controller
    for the *sales.mineral.local* domain within the forest. Setting up this machine
    (or its sibling, *ENGDC*) is optional: you don’t need multiple domain forests
    to run most of the examples in this book. However, it will allow you to test different
    behaviors.'
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: '*SALESDC* 虚拟机是一个 Windows 服务器，它为森林内的 *sales.mineral.local* 域提供域控制器服务。设置此机器（或其兄弟机器
    *ENGDC*）是可选的：你不需要多个域森林来运行本书中的大多数示例。然而，它将允许你测试不同的行为。'
- en: '[Listing A-11](appendix-A.xhtml#LisA-11) includes the same commands as those
    run for the *PRIMARYDC* virtual machine, with different values.'
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: '[列表 A-11](appendix-A.xhtml#LisA-11)包括与运行 *PRIMARYDC* 虚拟机相同的命令，但使用不同的值。'
- en: '[PRE11]'
  id: totrans-105
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'Listing A-11: Creating and starting the <samp class="SANS_Futura_Std_Book_11">SALESDC</samp>
    virtual machine'
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 列表 A-11：创建并启动 <samp class="SANS_Futura_Std_Book_11">SALESDC</samp> 虚拟机
- en: Follow the normal installation process, and when asked for the *Administrator*
    user’s password, set it to anything you like. In this book, I’ve assumed it will
    be set to <samp class="SANS_TheSansMonoCd_W5Regular_11">Passw0rd</samp>.
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 按照常规安装过程进行操作，当系统要求输入 *Administrator* 用户的密码时，可以设置为你喜欢的任何值。在本书中，我假设它将被设置为 <samp
    class="SANS_TheSansMonoCd_W5Regular_11">Passw0rd</samp>。
- en: '[Listing A-12](appendix-A.xhtml#LisA-12) configures the virtual machine’s network
    using the DNS server on *PRIMARYDC.*'
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: '[列表 A-12](appendix-A.xhtml#LisA-12) 使用 *PRIMARYDC* 上的 DNS 服务器配置虚拟机的网络。'
- en: '[PRE12]'
  id: totrans-109
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'Listing A-12: Setting up the <samp class="SANS_Futura_Std_Book_11">SALESDC</samp>
    virtual machine network'
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 列表 A-12：设置 <samp class="SANS_Futura_Std_Book_11">SALESDC</samp> 虚拟机网络
- en: It’s crucial that the DNS client point to the root domain controller when creating
    a new domain in the forest so that you can resolve the root domain information.
    Once you’ve renamed the computer, you’ll need to configure the server as the domain
    controller for the *sales.mineral.local* domain. Log in to the server as an administrator
    and run the commands in [Listing A-13](appendix-A.xhtml#LisA-13).
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 在森林中创建新域时，确保 DNS 客户端指向根域控制器，这一点至关重要，以便你能够解析根域信息。重命名计算机后，你需要将服务器配置为 *sales.mineral.local*
    域的域控制器。以管理员身份登录服务器，并运行 [列表 A-13](appendix-A.xhtml#LisA-13) 中的命令。
- en: '[PRE13]'
  id: totrans-112
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'Listing A-13: Installing and configuring the Active Directory domain services
    for a child domain'
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
- en: Here, you first install the <samp class="SANS_TheSansMonoCd_W5Regular_11">AD-Domain-Services</samp>
    feature as before, then run the <samp class="SANS_TheSansMonoCd_W5Regular_11">Install-ADDSDomain</samp>
    command to create a new domain in an existing forest. You’ll be prompted for the
    safe-mode password, as with the root domain. You must also specify an administrator
    account in the root domain to establish the trust relationship. You can use the
    existing *MINERAL\Administrator* account for this.
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
- en: If this succeeds, the server should reboot. When you can reauthenticate as the
    *SALES\Administrator* user, you can verify that you’ve set up a trusted connection
    by using the <samp class="SANS_TheSansMonoCd_W5Regular_11">Get-ADTrust</samp>
    command, as shown in [Listing A-14](appendix-A.xhtml#LisA-14).
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE14]'
  id: totrans-116
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'Listing A-14: Verifying the trust relationship between the <samp class="SANS_Futura_Std_Book_11">SALES</samp>
    and root domains'
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
- en: You should see a single entry for the root *mineral.local* domain. If the command
    fails, wait a few minutes for everything to start and retry.
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
- en: At this point, you can add your own users and groups to the *SALES* domain,
    which will be separate from the root domain, although the users should be able
    to authenticate across domains due to the configured trust relationship. You can
    also install your own workstations using the steps outlined for *GRAPHITE*, making
    sure to specify the DNS server using the *SALESDS* IP address.
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
- en: You can also create a separate engineering domain in the forest, or anything
    else you’d like. Just repeat these steps, changing the IP addresses and names
    you assign. You should then have a basic domain and forest configuration with
    which to run the examples in this book.
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
- en: While we’ve configured every system you’ll need for the book, you are free to
    configure and customize these domains further if you wish. Bear in mind that changing
    certain configurations, such as names or passwords, might change the input you’ll
    need to provide in the book’s examples.
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
