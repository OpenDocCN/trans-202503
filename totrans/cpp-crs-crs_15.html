<html><head></head><body>
<h2 class="h2" id="ch12"><span epub:type="pagebreak" id="page_369"/><strong><span class="big">12</span><br/>UTILITIES</strong></h2>&#13;
<p class="quote">“<em>See, the world is full of things more powerful than us. But if you know how to catch a ride, you can go places,” Raven says.<br/>“Right. I’m totally hip to what you’re saying.”<br/>—Neal Stephenson</em>, Snow Crash</p>&#13;
<div class="image1"><img src="../images/common.jpg" alt="Image"/></div>&#13;
<p class="noindent">The stdlib and Boost libraries provide a throng of types, classes, and functions that satisfy common programming needs. Together, this motley collection of tools is called <em>utilities</em>. Aside from their small, uncomplicated, and focused nature, utilities vary functionally.</p>&#13;
<p class="indent">In this chapter, you’ll learn about several simple <em>data structures</em> that handle many routine situations where you need objects to contain other objects. A discussion of <em>dates and times</em> follows, including coverage of several provisions for encoding calendars and clocks and for measuring elapsed time. The chapter wraps up with a trek through many <em>numerical and mathematical tools</em> available to you.</p>&#13;
<div class="note">&#13;
<p class="notet"><strong><span class="notes">NOTE</span></strong></p>&#13;
<p class="notep"><em>The discussions of dates/times and numerics/math will be of great interest to certain readers and of only passing interest to others. If you are in the latter category, feel free to skim these sections.</em></p>&#13;
</div>&#13;
<h3 class="h3" id="ch12lev1sec1"><strong><span epub:type="pagebreak" id="page_370"/>Data Structures</strong></h3>&#13;
<p class="indent">Between them, the stdlib and Boost libraries provide a venerable collection of useful <em>data structures</em>. A <em>data structure</em> is a type that stores objects and permits some set of operations over those stored objects. There is no magic compiler pixie dust that makes the utility data structures in this section work; you could implement your own versions with sufficient time and effort. But why reinvent the wheel?</p>&#13;
<h4 class="h4" id="ch12lev2sec1"><strong><em>tribool</em></strong></h4>&#13;
<p class="indent">The <em>tribool</em> is a <span class="literal">bool</span>-like type that supports three states rather than two: true, false, and indeterminate. Boost offers <span class="literal">boost::logic::tribool</span> in the <span class="literal">&lt;boost/logic/tribool.hpp&gt;</span> header. <a href="ch12.xhtml#ch12ex01">Listing 12-1</a> demonstrates how to initialize Boost a <span class="literal">tribool</span> using <span class="literal">true</span>, <span class="literal">false</span>, and the <span class="literal">boost::logic::indeterminate</span> type.</p>&#13;
<pre>#include &lt;boost/logic/tribool.hpp&gt;&#13;
&#13;
using boost::logic::indeterminate; <span class="ent">➊</span>&#13;
boost::logic::tribool t = true<span class="ent">➋</span>, f = false<span class="ent">➌</span>, i = indeterminate<span class="ent">➍</span>;</pre>&#13;
<p class="listing"><a id="ch12ex01"/><em>Listing 12-1: Initializing Boost <span class="literal">tribool</span></em></p>&#13;
<p class="indent">For convenience, a <span class="literal">using</span> declaration pulls in <span class="literal">indeterminate</span> from <span class="literal">boost::logic</span> <span class="ent">➊</span>. Then you initialize the <span class="literal">tribool t</span> equal to <span class="literal">true</span> <span class="ent">➋</span>, <span class="literal">f</span> equal to <span class="literal">false</span> <span class="ent">➌</span>, and <span class="literal">i</span> equal to <span class="literal">indeterminate</span> <span class="ent">➍</span>.</p>&#13;
<p class="indent">The <span class="literal">tribool</span> class implicitly converts to <span class="literal">bool</span>. If a <span class="literal">tribool</span> is <span class="literal">true</span>, it converts to <span class="literal">true</span>; otherwise, it converts to <span class="literal">false</span>. The <span class="literal">tribool</span> class also supports <span class="literal">operator!</span>, which returns <span class="literal">true</span> if <span class="literal">tribool</span> is <span class="literal">false</span>; otherwise, it returns <span class="literal">false</span>. Finally, <span class="literal">indeterminate</span> supports <span class="literal">operator()</span>, which takes a single <span class="literal">tribool</span> argument and returns <span class="literal">true</span> if that argument is <span class="literal">indeterminate</span>; otherwise, it returns <span class="literal">false</span>.</p>&#13;
<p class="indent"><a href="ch12.xhtml#ch12ex02">Listing 12-2</a> samples these Boolean conversions.</p>&#13;
<pre>TEST_CASE("Boost tribool converts to bool") {&#13;
  REQUIRE(t); <span class="ent">➊</span>&#13;
  REQUIRE_FALSE(f); <span class="ent">➋</span>&#13;
  REQUIRE(!f); <span class="ent">➌</span>&#13;
  REQUIRE_FALSE(!t); <span class="ent">➍</span>&#13;
  REQUIRE(indeterminate(i)); <span class="ent">➎</span>&#13;
  REQUIRE_FALSE(indeterminate(t)); <span class="ent">➏</span>&#13;
}</pre>&#13;
<p class="listing"><a id="ch12ex02"/><em>Listing 12-2: Converting a <span class="literal">tribool</span> to a <span class="literal">bool</span></em></p>&#13;
<p class="indent">This test demonstrates the basic results from <span class="literal">bool</span> conversion <span class="ent">➊</span><span class="ent">➋</span>, <span class="literal">operator!</span> <span class="ent">➌</span><span class="ent">➍</span>, and <span class="literal">indeterminate</span> <span class="ent">➍➎</span>.</p>&#13;
<h5 class="h5" id="ch12lev3sec1"><strong>Boolean Operations</strong></h5>&#13;
<p class="noindent">The <span class="literal">tribool</span> class supports all the Boolean operators. Whenever a <span class="literal">tribool</span> expression doesn’t involve an <span class="literal">indeterminate</span> value, the result is the same as <span epub:type="pagebreak" id="page_371"/>the equivalent Boolean expression. Whenever an <span class="literal">indeterminate</span> is involved, the result can be <span class="literal">indeterminate</span>, as <a href="ch12.xhtml#ch12ex03">Listing 12-3</a> illustrates.</p>&#13;
<pre>TEST_CASE("Boost Tribool supports Boolean operations") {&#13;
  auto t_or_f = t || f;&#13;
  REQUIRE(t_or_f); <span class="ent">➊</span>&#13;
  REQUIRE(indeterminate(t &amp;&amp; indeterminate)); <span class="ent">➋</span>&#13;
  REQUIRE(indeterminate(f || indeterminate)); <span class="ent">➌</span>&#13;
  REQUIRE(indeterminate(!i)); <span class="ent">➍</span>&#13;
}</pre>&#13;
<p class="listing"><a id="ch12ex03"/><em>Listing 12-3: The <span class="literal">boost::tribool</span> supports Boolean operations.</em></p>&#13;
<p class="indent">Because neither <span class="literal">t</span> nor <span class="literal">f</span> is indeterminate, <span class="literal">t || f</span> evaluates just like an ordinary Boolean expression, so <span class="literal">t_or_f</span> is <span class="literal">true</span> <span class="ent">➊</span>. Boolean expressions that involve an indeterminate can be indeterminate. Boolean AND <span class="ent">➋</span>, OR <span class="ent">➌</span>, and NOT <span class="ent">➍</span> evaluate to <span class="literal">indeterminate</span> if there isn’t enough information.</p>&#13;
<h5 class="h5" id="ch12lev3sec2"><strong>When to Use tribool</strong></h5>&#13;
<p class="noindent">Aside from describing the vital status of Schrödinger’s cat, you can use <span class="literal">tri</span><span class="literal">bool</span> in settings in which operations can take a long time. In such settings, a <span class="literal">tribool</span> could describe whether the operation was successful. An <span class="literal">indeterminate</span> value could model that the operation is still pending.</p>&#13;
<p class="indent">The <span class="literal">tribool</span> class makes for neat, concise <span class="literal">if</span> statements, as shown in <a href="ch12.xhtml#ch12ex04">Listing 12-4</a>.</p>&#13;
<pre>TEST_CASE("Boost Tribool works nicely with if statements") {&#13;
  if (i) FAIL("Indeterminate is true."); <span class="ent">➊</span>&#13;
  else if (!i) FAIL("Indeterminate is <span class="codestrong1">false</span>."); <span class="ent">➋</span>&#13;
  else {} // OK, indeterminate <span class="ent">➌</span>&#13;
}</pre>&#13;
<p class="listing"><a id="ch12ex04"/><em>Listing 12-4: Using an <span class="literal">if</span> statement with <span class="literal">tribool</span></em></p>&#13;
<p class="indent">The first expression <span class="ent">➊</span> evaluates only if the <span class="literal">tribool</span> is <span class="literal">true</span>, the second expression <span class="ent">➋</span> evaluates only if it’s <span class="literal">false</span>, and the third only executes in the <span class="literal">indeterminate</span> case <span class="ent">➌</span>.</p>&#13;
<div class="note">&#13;
<p class="notet"><strong><span class="notes">NOTE</span></strong></p>&#13;
<p class="notep"><em>The mere mention of a <span class="literal">tribool</span> might have caused you to scrunch up your face in disgust. Why, you might ask, couldn’t you just use an integer where 0 is false, 1 is true, and any other value is indeterminate? You could, but consider that the <span class="literal">tribool</span> type supports all the usual Boolean operations while correctly propagating indeterminate values. Again, why reinvent the wheel?</em></p>&#13;
</div>&#13;
<h5 class="h5" id="ch12lev3sec3"><strong>A Partial List of Supported Operations</strong></h5>&#13;
<p class="noindent"><a href="ch12.xhtml#ch12tab01">Table 12-1</a> provides a list of the most supported <span class="literal">boost::tribool</span> operations. In this table, <span class="literal">tb</span> is a <span class="literal">boost::tribool</span>.</p>&#13;
<p class="tabcap"><span epub:type="pagebreak" id="page_372"/><a id="ch12tab01"/><strong>Table 12-1:</strong> The Most Supported <span class="literal">boost::tribool</span> Operations</p>&#13;
<table class="topbot-d">&#13;
<colgroup>&#13;
<col style="width:30%"/>&#13;
<col style="width:70%"/>&#13;
</colgroup>&#13;
<tbody>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-h"><p class="tab_th"><strong>Operation</strong></p></td>&#13;
<td style="vertical-align: top;" class="table-h"><p class="tab_th"><strong>Notes</strong></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">tribool{}</span> <span class="literal">tribool{ false }</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Constructs a <span class="literal">tribool</span> with value <span class="literal">false</span>.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">tribool{ true }</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">Constructs a <span class="literal">tribool</span> with value <span class="literal">true</span>.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">tribool{ indeterminate }</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Constructs a <span class="literal">tribool</span> with value <span class="literal">indeterminate</span>.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="codestrong">tb</span><span class="literal">.safe_bool()</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">Evaluates to <span class="literal">true</span> if <span class="codestrong">tb</span> is <span class="literal">true</span>, else <span class="literal">false</span>.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">indeterminate(</span><span class="codestrong">tb</span><span class="literal">)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Evaluates to <span class="literal">true</span> if <span class="codestrong">tb</span> is <span class="literal">indeterminate</span>, else <span class="literal">false</span>.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="codestrong">!tb</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">Evaluates to <span class="literal">true</span> if <span class="codestrong">tb</span> is <span class="literal">false</span>, else <span class="literal">false</span>.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="codestrong">tb1</span><span class="literal"> &amp;&amp;</span> <span class="codestrong">tb2</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Evaluates to <span class="literal">true</span> if <span class="codestrong">tb1</span> and <span class="codestrong">tb2</span> are <span class="literal">true</span>; evaluates to <span class="literal">false</span> if <span class="codestrong">tb1</span> or <span class="codestrong">tb2</span> are <span class="literal">false</span>; otherwise, <span class="literal">indeterminate</span>.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="codestrong">tb1</span> <span class="literal">||</span> <span class="codestrong">tb2</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">Evaluates to <span class="literal">true</span> if <span class="codestrong">tb1</span> or <span class="codestrong">tb2</span> are <span class="literal">true</span>; evaluates to <span class="literal">false</span> if <span class="codestrong">tb1</span> and <span class="codestrong">tb2</span> are <span class="literal">false</span>; otherwise, <span class="literal">indeterminate</span>.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-ba"><p class="taba"><span class="literal">bool{</span> <span class="codestrong">tb</span> <span class="literal">}</span></p></td>&#13;
<td style="vertical-align: top;" class="table-ba"><p class="taba">Evaluates to <span class="literal">true</span> if <span class="codestrong">tb</span> is true, else <span class="literal">false</span>.</p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<h4 class="h4" id="ch12lev2sec2"><strong><em>optional</em></strong></h4>&#13;
<p class="indent">An <em>optional</em> is a class template that contains a value that might or might not be present. The primary use case for an <span class="literal">optional</span> is the return type of a function that might fail. Rather than throwing an exception or returning multiple values, a function can instead return an <span class="literal">optional</span> that will contain a value if the function succeeded.</p>&#13;
<p class="indent">The stdlib has <span class="literal">std::optional</span> in the <span class="literal">&lt;optional&gt;</span> header, and Boost has <span class="literal">boost::optional</span> in the <span class="literal">&lt;boost/optional.hpp&gt;</span> header.</p>&#13;
<p class="indent">Consider the setup in <a href="ch12.xhtml#ch12ex05">Listing 12-5</a>. The function <span class="literal">take</span> wants to return an instance of <span class="literal">TheMatrix</span> only if you take a <span class="literal">Pill::Blue</span>; otherwise, <span class="literal">take</span> returns a <span class="literal">std::nullopt</span>, which is a stdlib-provided constant <span class="literal">std::optional</span> type with uninitialized state.</p>&#13;
<pre>#include &lt;optional&gt;&#13;
&#13;
struct TheMatrix { <span class="ent">➊</span>&#13;
  TheMatrix(int x) : iteration { x } { }&#13;
  const int iteration;&#13;
};&#13;
&#13;
enum Pill { Red, Blue }; <span class="ent">➋</span>&#13;
&#13;
std::optional&lt;TheMatrix&gt;<span class="ent">➌</span> take(Pill pill<span class="ent">➍</span>) {&#13;
  if(pill == Pill::Blue) return TheMatrix{ 6 }; <span class="ent">➎</span>&#13;
  return std::nullopt; <span class="ent">➏</span>&#13;
}</pre>&#13;
<p class="listing"><a id="ch12ex05"/><em>Listing 12-5: A <span class="literal">take</span> function returning a <span class="literal">std::optional</span></em></p>&#13;
<p class="indent">The <span class="literal">TheMatrix</span> type takes a single <span class="literal">int</span> constructor argument and stores it into the <span class="literal">iteration</span> member <span class="ent">➊</span>. The <span class="literal">enum</span> called <span class="literal">Pill</span> takes the values <span class="literal">Red</span> and <span epub:type="pagebreak" id="page_373"/><span class="literal">Blue</span> <span class="ent">➋</span>. The <span class="literal">take</span> function returns a <span class="literal">std::optional&lt;TheMatrix&gt;</span> <span class="ent">➌</span> and accepts a single <span class="literal">Pill</span> argument <span class="ent">➍</span>. If you pass <span class="literal">Pill::Blue</span> to the take function, it returns a <span class="literal">TheMatrix</span> instance <span class="ent">➎</span>; otherwise, it returns a <span class="literal">std::nullopt</span> <span class="ent">➏</span>.</p>&#13;
<p class="indent">First, consider <a href="ch12.xhtml#ch12ex06">Listing 12-6</a>, where you take the blue pill.</p>&#13;
<pre>TEST_CASE("std::optional contains types") {&#13;
  if (auto matrix_opt = take(Pill::Blue)) { <span class="ent">➊</span>&#13;
    REQUIRE(matrix_opt-&gt;iteration == 6); <span class="ent">➋</span>&#13;
    auto&amp; matrix = matrix_opt.value(); &#13;
    REQUIRE(matrix.iteration == 6); <span class="ent">➌</span>&#13;
  } else {&#13;
    FAIL("The optional evaluated to false.");&#13;
  }&#13;
}</pre>&#13;
<p class="listing"><a id="ch12ex06"/><em>Listing 12-6: A test exploring the <span class="literal">std::optional</span> type with <span class="literal">Pill::Blue</span></em></p>&#13;
<p class="indent">You take the blue pill, which results in the <span class="literal">std::optional</span> result containing an initialized <span class="literal">TheMatrix</span>, so the <span class="literal">if</span> statement’s conditional expression evaluates to <span class="literal">true</span> <span class="ent">➊</span>. <a href="ch12.xhtml#ch12ex06">Listing 12-6</a> also demonstrates the use of <span class="literal">operator-&gt;</span> <span class="ent">➋</span> and <span class="literal">value()</span> <span class="ent">➌</span> to access the underlying value.</p>&#13;
<p class="indent">What happens when you take the red pill? Consider <a href="ch12.xhtml#ch12ex07">Listing 12-7</a>.</p>&#13;
<pre>TEST_CASE("std::optional can be empty") {&#13;
  auto matrix_opt = take(Pill::Red); <span class="ent">➊</span>&#13;
  if (matrix_opt) FAIL("The Matrix is not empty."); <span class="ent">➋</span>&#13;
  REQUIRE_FALSE(matrix_opt.has_value()); <span class="ent">➌</span>&#13;
}</pre>&#13;
<p class="listing"><a id="ch12ex07"/><em>Listing 12-7: A test exploring the <span class="literal">std::optional</span> type with <span class="literal">Pill::Red</span></em></p>&#13;
<p class="indent">You take the red pill <span class="ent">➊</span>, and the resulting <span class="literal">matrix_opt</span> is empty. This means <span class="literal">matrix_opt</span> converts to <span class="literal">false</span> <span class="ent">➋</span> and <span class="literal">has_value()</span> also returns <span class="literal">false</span> <span class="ent">➌</span>.</p>&#13;
<h5 class="h5" id="ch12lev3sec4"><strong>A Partial List of Supported Operations</strong></h5>&#13;
<p class="noindent"><a href="ch12.xhtml#ch12tab02">Table 12-2</a> provides a list of the most supported <span class="literal">std::optional</span> operations. In this table, <span class="literal">opt</span> is a <span class="literal">std::optional&lt;T&gt;</span> and <span class="literal">t</span> is an object of type <span class="literal">T</span>.</p>&#13;
<p class="tabcap"><a id="ch12tab02"/><strong>Table 12-2:</strong> The Most Supported <span class="literal">std::optional</span> Operations</p>&#13;
<table class="topbot-d">&#13;
<colgroup>&#13;
<col style="width:30%"/>&#13;
<col style="width:70%"/>&#13;
</colgroup>&#13;
<tbody>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-h"><p class="tab_th"><strong>Operation</strong></p></td>&#13;
<td style="vertical-align: top;" class="table-h"><p class="tab_th"><strong>Notes</strong></p>&#13;
</td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">optional&lt;T&gt;{}</span><br/><span class="literal">optional&lt;T&gt;{std::nullopt}</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Constructs an empty <span class="literal">optional</span>.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">optional&lt;T&gt;{</span> <span class="codestrong">opt</span> <span class="literal">}</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">Copy constructs an <span class="literal">optional</span> from <span class="codestrong">opt</span>.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">optional&lt;T&gt;{ move(</span><span class="codestrong">opt</span><span class="literal">) }</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Move constructs an <span class="literal">optional</span> from <span class="codestrong">opt</span>, which is empty after the constructor completes.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">optional&lt;T&gt;{</span> <span class="literal">t</span> <span class="literal">}</span> <span class="codestrong">opt</span> <span class="literal">=</span> <span class="codestrong">t</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">Copies <span class="codestrong">t</span> into <span class="literal">optional</span>.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">optional&lt;T&gt;{ move(</span><span class="literal">t</span><span class="literal">) }</span> <span class="codestrong">opt</span> = <span class="literal">move(</span><span class="codestrong">t</span><span class="literal">)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Moves <span class="codestrong">t</span> into <span class="literal">optional</span>.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span epub:type="pagebreak" id="page_374"/><span class="codestrong">opt</span><span class="literal">-&gt;</span><span class="codestrong">mbr</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">Member dereference; accesses the <span class="codestrong">mbr</span> member of object contained by <span class="codestrong">opt</span>.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">*</span><span class="codestrong">opt</span> <span class="codestrong">opt</span><span class="literal">.value()</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Returns a reference to the object contained by <span class="codestrong">opt</span>; <span class="literal">value()</span> checks for empty and throws <span class="literal">bad_optional_access</span>.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="codestrong">opt</span><span class="literal">.value_or(</span><span class="codestrong">T</span><span class="literal">{ ... })</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">If <span class="codestrong">opt</span> contains an object, returns a copy; else returns the argument.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">bool{</span> <span class="codestrong">opt</span> <span class="literal">}</span><br/><span class="codestrong">opt</span><span class="literal">.has_value()</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Returns <span class="literal">true</span> if <span class="codestrong">opt</span> contains an object, else <span class="literal">false</span>.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="codestrong">opt1</span><span class="literal">.swap(</span><span class="codestrong">opt2</span><span class="literal">)</span> <span class="literal">swap(</span><span class="codestrong">opt1</span><span class="literal">,</span> <span class="codestrong">opt2</span><span class="literal">)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">Swaps the objects contained by <span class="codestrong">opt1</span> and <span class="codestrong">opt2</span>.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="codestrong">opt</span><span class="literal">.reset()</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Destroys object contained by <span class="codestrong">opt</span>, which is empty after <span class="literal">reset</span>.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="codestrong">opt</span><span class="literal">.emplace(...)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">Constructs a type in place, forwarding all arguments to the appropriate constructor.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">make_optional&lt;T&gt;(...)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Convenience function for constructing an <span class="literal">optional</span>; forwards arguments to the appropriate constructor.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b2"><p class="taba"><span class="codestrong">opt1</span> <span class="literal">==</span> <span class="codestrong">opt2</span></p>&#13;
<p class="taba"><span class="codestrong">opt1</span> <span class="literal">!=</span> <span class="codestrong">opt2</span></p>&#13;
<p class="taba"><span class="codestrong">opt1</span> <span class="literal">&gt;</span> <span class="codestrong">opt2</span></p>&#13;
<p class="taba"><span class="codestrong">opt1</span> <span class="literal">&gt;=</span> <span class="codestrong">opt2</span></p>&#13;
<p class="taba"><span class="codestrong">opt1</span> <span class="literal">&lt;</span> <span class="codestrong">opt2</span></p>&#13;
<p class="taba"><span class="codestrong">opt1</span> <span class="literal">&lt;=</span> <span class="codestrong">opt2</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b2"><p class="taba">When evaluating equality of two <span class="literal">optional</span> objects, <span class="literal">true</span> if both are empty or if both contain objects and those objects are equal; else <span class="literal">false</span>. For comparison, an empty <span class="literal">optional</span> is always less than an optional containing a value. Otherwise, the result is the comparison of the contained types.</p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<h4 class="h4" id="ch12lev2sec3"><strong><em>pair</em></strong></h4>&#13;
<p class="noindent">A <em>pair</em> is a class template that contains two objects of different types in a single object. The objects are ordered, and you can access them via the members <span class="literal">first</span> and <span class="literal">second</span>. A <span class="literal">pair</span> supports comparison operators, has defaulted copy/move constructors, and works with structured binding syntax.</p>&#13;
<p class="indent">The stdlib has <span class="literal">std::pair</span> in the <span class="literal">&lt;utility&gt;</span> header, and Boost has <span class="literal">boost::pair</span> in the <span class="literal">&lt;boost/pair.hpp&gt;</span> header.</p>&#13;
<div class="note">&#13;
<p class="notet"><strong><span class="notes">NOTE</span></strong></p>&#13;
<p class="notep"><em>Boost also has <span class="literal">boost::compressed_pair</span> available in the <span class="literal">&lt;boost/compressed_pair.hpp&gt;</span> header. It’s slightly more efficient when one of the members is empty.</em></p>&#13;
</div>&#13;
<p class="indent">First, you create some simple types to make a pair out of, such as the simple <span class="literal">Socialite</span> and <span class="literal">Valet</span> classes in <a href="ch12.xhtml#ch12ex08">Listing 12-8</a>.</p>&#13;
<pre>#include &lt;utility&gt;&#13;
&#13;
struct Socialite { const char* birthname; };&#13;
struct Valet { const char* surname; };&#13;
Socialite bertie{ "Wilberforce" };&#13;
Valet reginald{ "Jeeves" };</pre>&#13;
<p class="listing"><a id="ch12ex08"/><em>Listing 12-8: The <span class="literal">Socialite</span> and <span class="literal">Valet</span> classes</em></p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_375"/>Now that you have a <span class="literal">Socialite</span> and a <span class="literal">Valet</span>, <span class="literal">bertie</span> and <span class="literal">reginald</span>, you can construct a <span class="literal">std::pair</span> and experiment with extracting elements. <a href="ch12.xhtml#ch12ex09">Listing 12-9</a> uses the <span class="literal">first</span> and <span class="literal">second</span> members to access the contained types.</p>&#13;
<pre>TEST_CASE("std::pair permits access to members") {&#13;
  std::pair&lt;Socialite, Valet&gt; inimitable_duo{ bertie, reginald }; <span class="ent">➊</span>&#13;
  REQUIRE(inimitable_duo.first.birthname == bertie.birthname); <span class="ent">➋</span>&#13;
  REQUIRE(inimitable_duo.second.surname == reginald.surname); <span class="ent">➌</span>&#13;
}</pre>&#13;
<p class="listing"><a id="ch12ex09"/><em>Listing 12-9: The <span class="literal">std::pair</span> supports member extraction.</em></p>&#13;
<p class="indent">You construct a <span class="literal">std::pair</span> by passing in the objects you want to copy <span class="ent">➊</span>. You use the <span class="literal">first</span> and <span class="literal">second</span> members of <span class="literal">std::pair</span> to extract the <span class="literal">Socialite</span> <span class="ent">➋</span> and <span class="literal">Valet</span> <span class="ent">➌</span> out of <span class="literal">inimitable_duo</span>. Then you can compare the <span class="literal">birthname</span> and <span class="literal">surname</span> members of these to their originals.</p>&#13;
<p class="indent"><a href="ch12.xhtml#ch12ex10">Listing 12-10</a> shows <span class="literal">std::pair</span> member extraction and structured binding syntax.</p>&#13;
<pre>TEST_CASE("std::pair works with structured binding") {&#13;
  std::pair&lt;Socialite, Valet&gt; inimitable_duo{ bertie, reginald };&#13;
  auto&amp; [idle_rich, butler] = inimitable_duo; <span class="ent">➊</span>&#13;
  REQUIRE(idle_rich.birthname == bertie.birthname); <span class="ent">➋</span>&#13;
  REQUIRE(butler.surname == reginald.surname); <span class="ent">➌</span>&#13;
}</pre>&#13;
<p class="listing"><a id="ch12ex10"/><em>Listing 12-10: The <span class="literal">std::pair</span> supports structured binding syntax.</em></p>&#13;
<p class="indent">Here you use the structured binding syntax <span class="ent">➊</span> to extract references to the <span class="literal">first</span> and <span class="literal">second</span> members of <span class="literal">inimitable_duo</span> into <span class="literal">idle_rich</span> and <span class="literal">butler</span>. As in <a href="ch12.xhtml#ch12ex09">Listing 12-9</a>, you ensure that the <span class="literal">birthname</span> <span class="ent">➋</span> and <span class="literal">surname</span> <span class="ent">➌</span> match the originals.</p>&#13;
<h5 class="h5" id="ch12lev3sec5"><strong>A Partial List of Supported Operations</strong></h5>&#13;
<p class="noindent"><a href="ch12.xhtml#ch12tab03">Table 12-3</a> provides a list of the most supported <span class="literal">std::pair</span> operations. In this table, <span class="literal">pr</span> is a <span class="literal">std::pair&lt;A, B&gt;</span>, <span class="literal">a</span> is an object of type <span class="literal">A</span>, and <span class="literal">b</span> is an object of type <span class="literal">B</span>.</p>&#13;
<p class="tabcap"><a id="ch12tab03"/><strong>Table 12-3:</strong> The Most Supported <span class="literal">std::pair</span> Operations</p>&#13;
<table class="topbot-d">&#13;
<colgroup>&#13;
<col style="width:30%"/>&#13;
<col style="width:70%"/>&#13;
</colgroup>&#13;
<tbody>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-h"><p class="tab_th"><strong>Operation</strong></p></td>&#13;
<td style="vertical-align: top;" class="table-h"><p class="tab_th"><strong>Notes</strong></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">pair&lt;...&gt;{}</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Constructs an empty <span class="literal">pair</span>.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">pair&lt;...&gt;{</span> <span class="codestrong">pr</span> <span class="literal">}</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">Copy constructs from <span class="codestrong">pr</span>.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">pair&lt;...&gt;{ move(</span><span class="codestrong">pr</span><span class="literal">) }</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Move constructs from <span class="codestrong">pr</span>.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">pair&lt;...&gt;{</span> <span class="codestrong">a</span><span class="literal">,</span> <span class="codestrong">b</span> <span class="literal">}</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">Constructs a <span class="literal">pair</span> by copying <span class="codestrong">a</span> and <span class="codestrong">b</span>.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">pair&lt;...&gt;{ move(</span><span class="codestrong">a</span><span class="literal">), move(</span><span class="codestrong">b</span><span class="literal">) }</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Constructs a <span class="literal">pair</span> by moving <span class="codestrong">a</span> and <span class="codestrong">b</span>.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="codestrong">pr1</span> <span class="literal">=</span> <span class="codestrong">pr2</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">Copy assigns from <span class="codestrong">pr2</span>.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="codestrong">pr1</span> = <span class="literal">move(</span><span class="codestrong">pr2</span><span class="literal">)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Move assigns from <span class="codestrong">pr2</span>.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span epub:type="pagebreak" id="page_376"/><span class="codestrong">pr</span><span class="literal">.first</span><br/><span class="literal">get&lt;0&gt;(</span><span class="codestrong">pr</span><span class="literal">)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">Returns a reference to the <span class="literal">first</span> element.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="codestrong">pr</span><span class="literal">.second</span><br/><span class="literal">get&lt;1&gt;(</span><span class="codestrong">pr</span><span class="literal">)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Returns a reference to the <span class="literal">second</span> element.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">get&lt;</span><span class="codestrong">T</span><span class="literal">&gt;(</span><span class="codestrong">pr</span><span class="literal">)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">If <span class="literal">first</span> and <span class="literal">second</span> have different types, returns a reference to the element of type <span class="codestrong">T</span>.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="codestrong">pr1</span><span class="literal">.swap(</span><span class="codestrong">pr2</span><span class="literal">)</span><br/><span class="literal">swap(</span><span class="codestrong">pr1</span><span class="literal">,</span> <span class="codestrong">pr2</span><span class="literal">)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Swaps the objects contained by <span class="codestrong">pr1</span> and <span class="codestrong">pr2</span>.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">make_pair&lt;...&gt;(</span><span class="codestrong">a</span><span class="literal">,</span> <span class="codestrong">b</span><span class="literal">)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">Convenience function for constructing a <span class="literal">pair</span>.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-ba"><p class="taba"><span class="codestrong">pr1</span> <span class="literal">==</span> <span class="codestrong">pr2</span></p>&#13;
<p class="taba"><span class="codestrong">pr1</span> <span class="literal">!=</span> <span class="codestrong">pr2</span></p>&#13;
<p class="taba"><span class="codestrong">pr1</span> <span class="literal">&gt;</span> <span class="codestrong">pr2</span></p>&#13;
<p class="taba"><span class="codestrong">pr1</span> <span class="literal">&gt;=</span> <span class="codestrong">pr2</span></p>&#13;
<p class="taba"><span class="codestrong">pr1</span> <span class="literal">&lt;</span> <span class="codestrong">pr2</span></p>&#13;
<p class="taba"><span class="codestrong">pr1</span> <span class="literal">&lt;=</span> <span class="codestrong">pr2</span></p></td>&#13;
<td style="vertical-align: top;" class="table-ba"><p class="taba">Equal if both <span class="literal">first</span> and <span class="literal">second</span> are equal.<br/>Greater than/less than comparisons begin with <span class="literal">first</span>. If <span class="literal">first</span> members are equal, compare <span class="literal">second</span> members.</p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<h4 class="h4" id="ch12lev2sec4"><strong><em>tuple</em></strong></h4>&#13;
<p class="noindent">A <em>tuple</em> is a class template that takes an arbitrary number of heterogeneous elements. It’s a generalization of <span class="literal">pair</span>, but a <span class="literal">tuple</span> doesn’t expose its members as <span class="literal">first</span>, <span class="literal">second</span>, and so on like a <span class="literal">pair</span>. Instead, you use the non-member function template <span class="literal">get</span> to extract elements.</p>&#13;
<p class="indent">The stdlib has <span class="literal">std::tuple</span> and <span class="literal">std::get</span> in the <span class="literal">&lt;tuple&gt;</span> header, and Boost has <span class="literal">boost::tuple</span> and <span class="literal">boost::get</span> in the <span class="literal">&lt;boost/tuple/tuple.hpp&gt;</span> header.</p>&#13;
<p class="indent">Let’s add a third class, <span class="literal">Acquaintance</span>, to test a <span class="literal">tuple</span>:</p>&#13;
<pre>struct Acquaintance { const char* nickname; };&#13;
Acquaintance hildebrand{ "Tuppy" };</pre>&#13;
<p class="indent">To extract these elements, you have two modes of using <span class="literal">get</span>. In the primary case, you can always provide a template parameter corresponding to the zero-based index of the element you want to extract. In the event the <span class="literal">tuple</span> doesn’t contain elements with the same types, you can alternatively provide a template parameter corresponding to the type of the element you want to extract, as <a href="ch12.xhtml#ch12ex11">Listing 12-11</a> illustrates.</p>&#13;
<pre>TEST_CASE("std::tuple permits access to members with std::get") {&#13;
  using Trio = std::tuple&lt;Socialite, Valet, Acquaintance&gt;;&#13;
  Trio truculent_trio{ bertie, reginald, hildebrand };&#13;
  auto&amp; bertie_ref = std::get&lt;0&gt;(truculent_trio); <span class="ent">➊</span>&#13;
  REQUIRE(bertie_ref.birthname == bertie.birthname);&#13;
&#13;
  auto&amp; tuppy_ref = std::get&lt;Acquaintance&gt;(truculent_trio); <span class="ent">➋</span>&#13;
  REQUIRE(tuppy_ref.nickname == hildebrand.nickname);&#13;
}</pre>&#13;
<p class="listing"><a id="ch12ex11"/><em>Listing 12-11: A <span class="literal">std::tuple</span> supports member extraction and structured binding syntax.</em></p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_377"/>You can build a <span class="literal">std::tuple</span> in an analogous way to how you built a <span class="literal">std::pair</span>. First, you extract the <span class="literal">Socialite</span> member with <span class="literal">get&lt;0&gt;</span> <span class="ent">➊</span>. Because <span class="literal">Socialite</span> is the first template parameter, you use 0 for the <span class="literal">std::get</span> template parameter. Then you extract the <span class="literal">Acquaintance</span> member with <span class="literal">std::get&lt;Acquaintance&gt;</span> <span class="ent">➋</span>. Because there’s only one element of type <span class="literal">Acquaintance</span>, you’re permitted to use this mode of <span class="literal">get</span> access.</p>&#13;
<p class="indent">Like <span class="literal">pair</span>, <span class="literal">tuple</span> also allows structured binding syntax.</p>&#13;
<h5 class="h5" id="ch12lev3sec6"><strong>A Partial List of Supported Operations</strong></h5>&#13;
<p class="noindent"><a href="ch12.xhtml#ch12tab04">Table 12-4</a> provides a list of the most supported <span class="literal">std::tuple</span> operations. In this table, <span class="literal">tp</span> is a <span class="literal">std::tuple&lt;A, B&gt;</span>, <span class="literal">a</span> is an object of type <span class="literal">A</span>, and <span class="literal">b</span> is an object of type <span class="literal">B</span>.</p>&#13;
<p class="tabcap"><a id="ch12tab04"/><strong>Table 12-4:</strong> The Most Supported <span class="literal">std::tuple</span> Operations</p>&#13;
<table class="topbot-d">&#13;
<colgroup>&#13;
<col style="width:30%"/>&#13;
<col style="width:70%"/>&#13;
</colgroup>&#13;
<tbody>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-h"><p class="tab_th"><strong>Operation</strong></p></td>&#13;
<td style="vertical-align: top;" class="table-h"><p class="tab_th"><strong>Notes</strong></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">tuple&lt;...&gt;{</span> <span class="codestrong">[alc]</span> <span class="literal">}</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Constructs an empty <span class="literal">tuple</span>. Uses <span class="literal">std::allocate</span> as default allocator <span class="codestrong">alc</span>.</p></td></tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">tuple&lt;...&gt;{</span> <span class="codestrong">[alc]</span><span class="literal">,</span> <span class="codestrong">tp</span><span class="literal"> }</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">Copy constructs from <span class="codestrong">tp</span>. Uses <span class="literal">std::allocate</span> as default allocator <span class="codestrong">alc</span>.</p></td></tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">tuple&lt;...&gt;{</span> <span class="codestrong">[alc]</span><span class="literal">,move(</span><span class="codestrong">tp</span><span class="literal">) }</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Move constructs from <span class="codestrong">tp</span>. Uses <span class="literal">std::allocate</span> as default allocator <span class="codestrong">alc</span>.</p></td></tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">tuple&lt;...&gt;{</span> <span class="codestrong">[alc]</span><span class="literal">,</span> <span class="codestrong">a</span><span class="literal">,</span> <span class="codestrong">b</span><span class="literal"> }</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">Constructs a <span class="literal">tuple</span> by copying <span class="codestrong">a</span> and <span class="codestrong">b</span>. Uses <span class="literal">std::allocate</span> as default allocator <span class="codestrong">alc</span>.</p></td></tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">tuple&lt;...&gt;{</span> <span class="codestrong">[alc]</span><span class="literal">, move(</span><span class="codestrong">a</span><span class="literal">), move(</span><span class="codestrong">b</span><span class="literal">) }</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Constructs a <span class="literal">tuple</span> by moving <span class="codestrong">a</span> and <span class="codestrong">b</span>. Uses <span class="literal">std::allocate</span> as default allocator <span class="codestrong">alc</span>.</p></td></tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="codestrong">tp1</span><span class="literal"> =</span> <span class="codestrong">tp2</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">Copy assigns from <span class="codestrong">tp2</span>.</p></td></tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="codestrong">tp1</span> = <span class="literal">move(</span><span class="codestrong">tp2</span><span class="literal">)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Move assigns from <span class="codestrong">tp2</span>.</p></td></tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">get&lt;</span><span class="codestrong">i</span><span class="literal">&gt;(</span><span class="codestrong">tp</span><span class="literal">)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">Returns a reference to the <span class="codestrong">i</span>th element (zero-based).</p></td></tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">get&lt;</span><span class="codestrong">T</span><span class="literal">&gt;(</span><span class="codestrong">tp</span><span class="literal">)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Returns a reference to the element of type <span class="codestrong">T</span>. Fails to compile if more than one element share this type.</p></td></tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="codestrong">tp1</span><span class="literal">.swap(</span><span class="codestrong">tp2</span><span class="literal">)</span><br/><span class="literal">swap(</span><span class="codestrong">tp1</span><span class="literal">,</span> <span class="codestrong">tp2</span><span class="literal">)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">Swaps the objects contained by <span class="codestrong">tp1</span> and <span class="codestrong">tp2</span>.</p></td></tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">make_tuple&lt;...&gt;(</span><span class="codestrong">a</span><span class="literal">,</span> <span class="codestrong">b</span><span class="literal">)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Convenience function for constructing a <span class="literal">tuple</span>.</p></td></tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">tuple_cat&lt;...&gt;(</span><span class="codestrong">tp1</span><span class="literal">,</span> <span class="codestrong">tp2</span><span class="literal">)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">Concatenates all the tuples passed in as arguments.</p></td></tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-ba"><p class="taba"><span class="codestrong">tp1</span> <span class="literal">==</span> <span class="codestrong">tp2</span></p>&#13;
<p class="taba"><span class="codestrong">tp1</span> <span class="literal">!=</span> <span class="codestrong">tp2</span></p>&#13;
<p class="taba"><span class="codestrong">tp1</span> <span class="literal">&gt;</span> <span class="codestrong">tp2</span></p>&#13;
<p class="taba"><span class="codestrong">tp1</span> <span class="literal">&gt;=</span> <span class="codestrong">tp2</span></p>&#13;
<p class="taba"><span class="codestrong">tp1</span> <span class="literal">&lt;</span> <span class="codestrong">tp2</span></p>&#13;
<p class="taba"><span class="codestrong">tp1</span> <span class="literal">&lt;=</span> <span class="codestrong">tp2</span></p></td>&#13;
<td style="vertical-align: top;" class="table-ba"><p class="taba">Equal if all elements are equal.<br/>Greater than/less than comparisons proceed from first element to last.</p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<h4 class="h4" id="ch12lev2sec5"><strong><em><span epub:type="pagebreak" id="page_378"/>any</em></strong></h4>&#13;
<p class="indent">An <em>any</em> is a class that stores single values of any type. It is <em>not</em> a class template. To convert an <span class="literal">any</span> into a concrete type, you use an <em>any cast</em>, which is a non-member function template. Any cast conversions are type safe; if you attempt to cast an <span class="literal">any</span> and the type doesn’t match, you get an exception. With <span class="literal">any</span>, you can perform some kinds of generic programming <em>without templates</em>.</p>&#13;
<p class="indent">The stdlib has <span class="literal">std::any</span> in the <span class="literal">&lt;any&gt;</span> header, and Boost has <span class="literal">boost::any</span> in the <span class="literal">&lt;boost/any.hpp&gt;</span> header.</p>&#13;
<p class="indent">To store a value into an <span class="literal">any</span>, you use the <span class="literal">emplace</span> method template. It takes a single template parameter corresponding to the type you want to store into <span class="literal">any</span> (the <em>storage type</em>). Any arguments you pass into <span class="literal">emplace</span> get forwarded to an appropriate constructor for the given storage type. To extract the value, you use <span class="literal">any_cast</span>, which takes a template parameter corresponding to the current storage type of <span class="literal">any</span> (called the <em>state</em> of <span class="literal">any</span>). You pass the <span class="literal">any</span> as the sole parameter to <span class="literal">any_cast</span>. As long as the state of <span class="literal">any</span> matches the template parameter, you get the desired type out. If the state doesn’t match, you get a <span class="literal">bad_any_cast</span> exception.</p>&#13;
<p class="indent"><a href="ch12.xhtml#ch12ex12">Listing 12-12</a> illustrates these basic interactions with a <span class="literal">std::any</span>.</p>&#13;
<pre>#include &lt;any&gt;&#13;
&#13;
struct EscapeCapsule {&#13;
  EscapeCapsule(int x) : weight_kg{ x } { }&#13;
  int we<a id="_idTextAnchor481"/>ight_kg;&#13;
}; <span class="ent">➊</span>&#13;
&#13;
TEST_CASE("std::any allows us to std::any_cast into a type") {&#13;
  std::any hagunemnon; <span class="ent">➋</span>&#13;
  hagunemnon.emplace&lt;EscapeCapsule&gt;(600); <span class="ent">➌</span>&#13;
  auto capsule = std::any_cast&lt;EscapeCapsule&gt;(hagunemnon); <span class="ent">➍</span>&#13;
  REQUIRE(capsule.weight_kg == 600);&#13;
  REQUIRE_THROWS_AS(std::any_cast&lt;float&gt;(hagunemnon), std::bad_any_cast); <span class="ent">➎</span>&#13;
}</pre>&#13;
<p class="listing"><a id="ch12ex12"/><em>Listing 12-12: The <span class="literal">std::any</span> and <span class="literal">std::any_cast</span> allow you to extract concrete types.</em></p>&#13;
<p class="indent">You declare the <span class="literal">EscapeCapsule</span> class <span class="ent">➊</span>. Within the test, you construct an empty <span class="literal">std::any</span> called <span class="literal">hagunemnon</span> <span class="ent">➋</span>. Next, you use <span class="literal">emplace</span> to store an <span class="literal">EscapeCapsule</span> with <span class="literal">weight_kg = 600</span> <span class="ent">➌</span>. You can extract the <span class="literal">EscapeCapsule</span> back <span epub:type="pagebreak" id="page_379"/>out using <span class="literal">std::any_cast</span> <span class="ent">➍</span>, which you store into a new <span class="literal">EscapeCapsule</span> called <span class="literal">capsule</span>. Finally, you show that attempting to invoke <span class="literal">any_cast</span> to cast the <span class="literal">hagunemnon</span> into a <span class="literal">float</span> results in a <span class="literal">std::bad_any_cast</span> exception <span class="ent">➎</span>.</p>&#13;
<h5 class="h5" id="ch12lev3sec7"><strong>A Partial List of Supported Operations</strong></h5>&#13;
<p class="noindent"><a href="ch12.xhtml#ch12tab05">Table 12-5</a> provides a list of the most supported <span class="literal">std::any</span> operations. In this table, <span class="literal">ay</span> is a <span class="literal">std::any</span> and <span class="literal">t</span> is an object of type <span class="literal">T</span>.</p>&#13;
<p class="tabcap"><a id="ch12tab05"/><strong>Table 12-5:</strong> The Most Supported <span class="literal">std::any</span> Operations</p>&#13;
<table class="topbot-d">&#13;
<colgroup>&#13;
<col style="width:30%"/>&#13;
<col style="width:70%"/>&#13;
</colgroup>&#13;
<tbody>&#13;
<tr>&#13;
<th style="vertical-align: top;" class="table-h"><p class="taba"><strong>Operation</strong></p></th>&#13;
<th style="vertical-align: top;" class="table-h"><p class="taba"><strong>Notes</strong></p></th>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">any{}</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Constructs an empty <span class="literal">any</span> object.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">any{</span> <span class="codestrong">ay</span> <span class="literal">}</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">Copy constructs from <span class="codestrong">ay</span>.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">any{ move(</span><span class="codestrong">ay</span><span class="literal">) }</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Move constructs from <span class="codestrong">ay</span>.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">any{ move(</span><span class="codestrong">t</span><span class="literal">) }</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">Constructs an <span class="literal">any</span> object containing an in-place constructed object from <span class="codestrong">t</span>.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="codestrong">ay</span> <span class="literal"> =</span> <span class="codestrong">t</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Destructs the object currently contained by <span class="codestrong">ay</span>; copies <span class="codestrong">t</span>.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="codestrong">ay</span> <span class="literal"> = move(</span><span class="codestrong">t</span><span class="literal">)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">Destructs the object currently contained by <span class="codestrong">ay</span>; moves <span class="codestrong">t</span>.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="codestrong">ay1</span> <span class="literal"> =</span> <span class="codestrong">ay2</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Copy assigns from <span class="codestrong">ay2</span>.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="codestrong">ay1</span> <span class="literal"> = move(</span><span class="codestrong">ay2</span><span class="literal">)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">Move assigns from <span class="codestrong">ay2</span>.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="codestrong">ay</span><span class="literal">.emplace&lt;</span><span class="codestrong">T</span><span class="literal">&gt;(...)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Destructs the object currently contained by <span class="codestrong">ay</span>; constructs a <span class="codestrong">T</span> in place, forwarding the arguments <span class="literal">...</span> to the appropriate constructor.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="codestrong">ay</span><span class="literal">.reset()</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">Destroys the currently contained object.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="codestrong">ay1</span><span class="literal">.swap(</span><span class="codestrong">ay2</span><span class="literal">)</span><br/><span class="literal">swap(</span><span class="codestrong">ay1</span><span class="literal">,</span> <span class="codestrong">ay2</span><span class="literal">)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Swaps the objects contained by <span class="codestrong">ay1</span> and <span class="codestrong">ay2</span>.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">make_any&lt;</span><span class="codestrong">T</span><span class="literal">&gt;(...)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">Convenience function for constructing an <span class="literal">any</span> constructs a <span class="codestrong">T</span> in place, forwarding the arguments <span class="literal">...</span> to the appropriate constructor.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-ba"><p class="taba"><span class="codestrong">t</span> <span class="literal"> = any_cast&lt;</span><span class="codestrong">T</span><span class="literal">&gt;(</span><span class="codestrong">ay</span><span class="literal">)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-ba"><p class="taba">Casts <span class="codestrong">ay</span> into type <span class="codestrong">T</span>. Throws a <span class="literal">std::bad_any_cast</span> if the type <span class="codestrong">T</span> doesn’t match the contained object’s type.</p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<h4 class="h4" id="ch12lev2sec6"><strong><em>variant</em></strong></h4>&#13;
<p class="noindent">A <em>variant</em> is a class template that stores single values whose types are restricted to the user-defined list provided as template parameters. The variant is a type-safe <span class="literal">union</span> (refer to “Unions” on <a href="ch02.xhtml#page_53">page 53</a>). It shares a lot of functionality with the <span class="literal">any</span> type, but <span class="literal">variant</span> requires that you explicitly enumerate all the types that you’ll store.</p>&#13;
<p class="indent">The stdlib has <span class="literal">std::variant</span> in the <span class="literal">&lt;variant&gt;</span> header, and Boost has <span class="literal">boost::variant</span> in the <span class="literal">&lt;boost/variant.hpp&gt;</span> header.</p>&#13;
<p class="indent"><a href="ch12.xhtml#ch12ex13">Listing 12-13</a> demonstrates creating another type called <span class="literal">BugblatterBeast</span> for <span class="literal">variant</span> to contain alongside <span class="literal">EscapeCapsule</span>.</p>&#13;
<pre>#include &lt;variant&gt;&#13;
&#13;
struct BugblatterBeast {&#13;
  BugblatterBeast() : is_ravenous{ true }, weight_kg{ 20000 } { }&#13;
  bool is_ravenous;&#13;
  int weight_kg; <span class="ent">➊</span>&#13;
};</pre>&#13;
<p class="listing"><a id="ch12ex13"/><em>Listing 12-13: The <span class="literal">std::variant</span> can hold an object from one of a list of predefined types.</em></p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_380"/>Aside from also containing a <span class="literal">weight_kg</span> member <span class="ent">➊</span>, <span class="literal">BugblatterBeast</span> is totally independent from <span class="literal">EscapeCapsule</span>.</p>&#13;
<h5 class="h5" id="ch12lev3sec8"><strong>Constructing a variant</strong></h5>&#13;
<p class="noindent">A <span class="literal">variant</span> can only be default constructed if one of two conditions is met:</p>&#13;
<ul>&#13;
<li class="noindent">The first template parameter is default constructible.</li>&#13;
<li class="noindent">It is <span class="literal">monostate</span>, a type intended to communicate that a variant can have an empty state.</li>&#13;
</ul>&#13;
<p class="indent">Because <span class="literal">BugblatterBeast</span> is default constructible (meaning it has a default constructor), make it the first type in the template parameter list so your variant is also default constructible, like so:</p>&#13;
<pre>std::variant&lt;BugblatterBeast, EscapeCapsule&gt; hagunemnon;</pre>&#13;
<p class="indent">To store a value into a <span class="literal">variant</span>, you use the <span class="literal">emplace</span> method template. As with <span class="literal">any</span>, a <span class="literal">variant</span> takes a single template parameter corresponding to the type you want to store. This template parameter must be contained in the list of template parameters for the <span class="literal">variant</span>. To extract a value, you use either of the non-member function templates <span class="literal">get</span> or <span class="literal">get_if</span>. These accept either the desired type or the index into the template parameter list corresponding to the desired type. If <span class="literal">get</span> fails, it throws a <span class="literal">bad_variant_access</span> exception, while <span class="literal">get_if</span> returns a <span class="literal">nullptr</span>.</p>&#13;
<p class="indent">You can determine which type corresponds with the current state of <span class="literal">variant</span> using the <span class="literal">index()</span> member, which returns the index of the current object’s type within the template parameter list.</p>&#13;
<p class="indent"><a href="ch12.xhtml#ch12ex14">Listing 12-14</a> illustrates how to use <span class="literal">emplace</span> to change the state of a <span class="literal">vari</span><span class="literal">ant</span> and <span class="literal">index</span> to determine the type of the contained object.</p>&#13;
<pre>TEST_CASE("std::variant") {&#13;
  std::variant&lt;BugblatterBeast, EscapeCapsule&gt; hagunemnon;&#13;
  REQUIRE(hagunemnon.index() == 0); <span class="ent">➊</span>&#13;
&#13;
  hagunemnon.emplace&lt;EscapeCapsule&gt;(600); <span class="ent">➋</span>&#13;
  REQUIRE(hagunemnon.index() == 1); <span class="ent">➌</span>&#13;
&#13;
  REQUIRE(std::get&lt;EscapeCapsule&gt;(hagunemnon).weight_kg == 600); <span class="ent">➍</span>&#13;
  REQUIRE(std::get&lt;1&gt;(hagunemnon).weight_kg == 600); <span class="ent">➎</span>&#13;
  REQUIRE_THROWS_AS(std::get&lt;0&gt;(hagunemnon), std::bad_variant_access); <span class="ent">➏</span>&#13;
}</pre>&#13;
<p class="listing"><a id="ch12ex14"/><em>Listing 12-14: A <span class="literal">std::get</span> allows you to extract concrete types from <span class="literal">std::variant</span>.</em></p>&#13;
<p class="indent">After default constructing <span class="literal">hagunemnon</span>, invoking <span class="literal">index</span> yields 0 because this is the index of the correct template parameter <span class="ent">➊</span>. Next, you emplace <span epub:type="pagebreak" id="page_381"/>an <span class="literal">EscapeCapsule</span> <span class="ent">➋</span>, which causes <span class="literal">index</span> to return 1 instead <span class="ent">➌</span>. Both <span class="literal">std::get&lt;EscapeCapsule&gt;</span> <span class="ent">➍</span> and <span class="literal">std::get&lt;1&gt;</span> <span class="ent">➎</span> illustrate identical ways of extracting the contained type. Finally, attempting to invoke <span class="literal">std::get</span> to obtain a type that doesn’t correspond with the current state of <span class="literal">variant</span> results in a <span class="literal">bad_variant_access</span> <span class="ent">➏</span>.</p>&#13;
<p class="indent">You can use the non-member function <span class="literal">std::visit</span> to apply a callable object to a variant. This has the advantage of dispatching the correct function to handle whatever the contained object is without having to specify it explicitly with <span class="literal">std::get</span>. <a href="ch12.xhtml#ch12ex15">Listing 12-15</a> illustrates the basic usage.</p>&#13;
<pre>TEST_CASE("std::variant") {&#13;
  std::variant&lt;BugblatterBeast, EscapeCapsule&gt; hagunemnon;&#13;
  hagunemnon.emplace&lt;EscapeCapsule&gt;(600); <span class="ent">➊</span>&#13;
  auto lbs = std::visit([](auto&amp; x) { return 2.2*x.weight_kg; }, hagunemnon); <span class="ent">➋</span>&#13;
  REQUIRE(lbs == 1320); <span class="ent">➌</span>&#13;
}</pre>&#13;
<p class="listing"><a id="ch12ex15"/><em>Listing 12-15: The <span class="literal">std::visit</span> allows you to apply a callable object to a contained type of <span class="literal">std::variant</span>.</em></p>&#13;
<p class="indent">First, you invoke <span class="literal">emplace</span> to store the value 600 into <span class="literal">hagunemnon</span> <span class="ent">➊</span>. Because both <span class="literal">BugblatterBeast</span> and <span class="literal">EscapeCapsule</span> have a <span class="literal">weight_kg</span> member, you can use <span class="literal">std::visit</span> on <span class="literal">hagunemnon</span> with a lambda that performs the correct conversion (2.2 lbs per kg) to the <span class="literal">weight_kg</span> field <span class="ent">➋</span> and returns the result <span class="ent">➌</span> (notice that you don’t have to include any type information).</p>&#13;
<h5 class="h5" id="ch12lev3sec9"><strong>Comparing variant and any</strong></h5>&#13;
<p class="noindent">The universe is big enough to accommodate both <span class="literal">any</span> and <span class="literal">variant</span>. It’s not possible to recommend one over the other generally, because each has its strengths and weaknesses.</p>&#13;
<p class="indent">An <span class="literal">any</span> is more flexible; it can take <em>any</em> type, whereas <span class="literal">variant</span> is only allowed to contain an object of a predetermined type. It also mostly avoids templates, so it’s generally easier to program with.</p>&#13;
<p class="indent">A <span class="literal">variant</span> is less flexible, making it safer. Using the <span class="literal">visit</span> function, you can check for the safety of operations at compile time. With <span class="literal">any</span>, you would need to build your own <span class="literal">visit</span>-like functionality, and it would require runtime checking (for example, of the result of <span class="literal">any_cast</span>).</p>&#13;
<p class="indent">Finally, <span class="literal">variant</span> can be more performant than <span class="literal">any</span>. Although <span class="literal">any</span> is allowed to perform dynamic allocation if the contained type is too large, <span class="literal">variant</span> is not.</p>&#13;
<h5 class="h5" id="ch12lev3sec10"><strong>A Partial List of Supported Operations</strong></h5>&#13;
<p class="noindent"><a href="ch12.xhtml#ch12tab06">Table 12-6</a> provides a list of the most supported <span class="literal">std::variant</span> operations. In this table, <span class="literal">vt</span> is a <span class="literal">std::variant</span> and <span class="literal">t</span> is an object of type <span class="literal">T</span>.</p>&#13;
<p class="tabcap"><a id="ch12tab06"/><span epub:type="pagebreak" id="page_382"/><strong>Table 12-6:</strong> The Most Supported <span class="literal">std::variant</span> Operations</p>&#13;
<table class="topbot-d">&#13;
<colgroup>&#13;
<col style="width:40%"/>&#13;
<col style="width:60%"/>&#13;
</colgroup>&#13;
<tbody>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-h"><p class="tab_th"><strong>Operation</strong></p></td>&#13;
<td style="vertical-align: top;" class="table-h"><p class="tab_th"><strong>Notes</strong></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">variant&lt;...&gt;{}</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Constructs an empty <span class="literal">variant</span> object. First template parameter must be default constructible.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">variant&lt;...&gt;{</span> <span class="codestrong">vt</span> <span class="literal"> }</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">Copy constructs from <span class="codestrong">vt</span>.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">variant&lt;...&gt;{ move(</span><span class="codestrong">vt</span><span class="literal">) }</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Move constructs from <span class="codestrong">vt</span>.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">variant&lt;...&gt;{ move(</span><span class="codestrong">t</span><span class="literal">) }</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">Constructs an <span class="literal">variant</span> object containing an in-place constructed object.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="codestrong">vt</span> <span class="literal"> =</span> <span class="codestrong">t</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Destructs the object currently contained by <span class="codestrong">vt</span>; copies <span class="codestrong">t</span>.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="codestrong">vt</span> <span class="literal"> = move(</span><span class="codestrong">t</span><span class="literal">)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">Destructs the object currently contained by <span class="codestrong">vt</span>; moves <span class="codestrong">t</span>.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="codestrong">vt1</span> <span class="literal"> =</span> <span class="codestrong">vt2</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Copy assigns from <span class="codestrong">vt2</span>.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="codestrong">vt1</span> <span class="literal"> = move(</span><span class="codestrong">vt2</span><span class="literal">)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">Move assigns from <span class="codestrong">vt2</span>.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="codestrong">vt</span><span class="literal">.emplace&lt;</span><span class="codestrong">T</span><span class="literal">&gt;(...)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Destructs the object currently contained by <span class="codestrong">vt</span>; constructs a <span class="codestrong">T</span> in place, forwarding the arguments <span class="literal">...</span> to the appropriate constructor.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="codestrong">vt</span><span class="literal">.reset()</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">Destroys the currently contained object.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="codestrong">vt</span><span class="literal">.index()</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Returns the zero-based index of the type of the currently contained object. (Order determined by template parameters of the <span class="literal">std::variant</span>.)</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="codestrong">vt1</span><span class="literal">.swap(</span><span class="codestrong">vt2</span><span class="literal">)</span><br/><span class="literal">swap(</span><span class="codestrong">vt1</span><span class="literal">,</span> <span class="codestrong">vt2</span><span class="literal">)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">Swaps the objects contained by <span class="codestrong">vt1</span> and <span class="codestrong">vt2</span>.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">make_variant&lt;</span><span class="codestrong">T</span><span class="literal">&gt;(...)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Convenience function for constructing a <span class="literal">tuple</span>; constructs a <span class="codestrong">T</span> in place, forwarding the arguments <span class="literal">...</span> to the appropriate constructor.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">std::visit(</span><span class="codestrong">vt</span><span class="literal">,</span> <span class="codestrong">callable</span><span class="literal">)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">Invokes <span class="codestrong">callable</span> with contained object.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">std::holds_alternative&lt;</span><span class="codestrong">T</span><span class="literal">&gt;(</span><span class="codestrong">vt</span><span class="literal">)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Returns <span class="literal">true</span> if the contained object’s type is <span class="codestrong">T</span>.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">std::get&lt;</span><span class="codestrong">I</span><span class="literal">&gt;(</span><span class="codestrong">vt</span><span class="literal">)</span><br/><span class="literal">std::get&lt;</span><span class="codestrong">T</span><span class="literal">&gt;(</span><span class="codestrong">vt</span><span class="literal">)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">Returns contained object if its type is <span class="codestrong">T</span> or the <span class="codestrong">i</span>th type. Otherwise, throws <span class="codestrong">std::bad_variant_access</span> exception.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">std::get_if&lt;</span><span class="codestrong">I</span><span class="literal">&gt;(&amp;</span><span class="codestrong">vt</span><span class="literal">)</span><br/><span class="literal">std::get_if&lt;</span><span class="codestrong">T</span><span class="literal">&gt;(&amp;</span><span class="codestrong">vt</span><span class="literal">)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Returns a pointer to the contained object if its type is <span class="codestrong">T</span> or the <span class="codestrong">i</span>th type. Otherwise, returns <span class="literal">nullptr</span>.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b2"><p class="taba"><span class="codestrong">vt1</span> <span class="literal">==</span> <span class="codestrong">vt2</span></p>&#13;
<p class="taba"><span class="codestrong">vt1</span> <span class="literal">!=</span> <span class="codestrong">vt2</span></p>&#13;
<p class="taba"><span class="codestrong">vt1</span> <span class="literal">&gt;</span> <span class="codestrong">vt2</span></p>&#13;
<p class="taba"><span class="codestrong">vt1</span> <span class="literal">&gt;=</span> <span class="codestrong">vt2</span></p>&#13;
<p class="taba"><span class="codestrong">vt1</span> <span class="literal">&lt;</span> <span class="codestrong">vt2</span></p>&#13;
<p class="taba"><span class="codestrong">vt1</span> <span class="literal">&lt;=</span> <span class="codestrong">vt2</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b2"><p class="taba">Compares the contained objects of <span class="codestrong">vt1</span> and <span class="codestrong">vt2</span>.</p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<h3 class="h3" id="ch12lev1sec2"><strong>Date and Time</strong></h3>&#13;
<p class="noindent">Between stdlib and Boost, a number of libraries are available that handle dates and times. When handling calendar dates and times, look to Boost’s DateTime library. When you’re trying get the current time or measure elapsed time, look to Boost’s or stdlib’s Chrono libraries and to Boost’s Timer library.</p>&#13;
<h4 class="h4" id="ch12lev2sec7"><strong><em><span epub:type="pagebreak" id="page_383"/>Boost DateTime</em></strong></h4>&#13;
<p class="indent">Boost DateTime library supports date programming with a rich system based on the Gregorian calendar, which is the most widely used civil calendar internationally. Calendars are more complicated than they might seem at first glance. For example, consider the following excerpt from the US Naval Observatory’s Introduction to Calendars, which describes the basics of leap years:</p>&#13;
<p class="bq">Every year that is exactly divisible by four is a leap year, except for years that are exactly divisible by 100, but these centurial years are leap years if they are exactly divisible by 400. For example, the years 1700, 1800, and 1900 are not leap years, but the year 2000 is.</p>&#13;
<p class="indent">Rather than attempting to build your own solar calendar functions, just include DateTime’s date-programming facilities with the following header:</p>&#13;
<pre>#include &lt;boost/date_time/gregorian/gregorian.hpp&gt;</pre>&#13;
<p class="indent">The principal type you’ll use is the <span class="literal">boost::gregorian::date</span>, which is the primary interface for date-programming.</p>&#13;
<h5 class="h5" id="ch12lev3sec11"><strong>Constructing a date</strong></h5>&#13;
<p class="noindent">Several options are available for constructing a <span class="literal">date</span>. You can default construct a <span class="literal">date</span>, which sets its value to the special date <span class="literal">boost::gregorian::not_a_</span><span class="literal">date_time</span>. To construct a <span class="literal">date</span> with a valid date, you can use a constructor that accepts three arguments: a year, a month, and a date. The following statement constructs a <span class="literal">date d</span> with the date September 15, 1986:</p>&#13;
<pre>boost::gregorian::date d{ 1986, 9, 15 };</pre>&#13;
<p class="indent">Alternatively, you can construct a date from a string using the <span class="literal">boost:: gregorian::from_string</span> utility function, like this:</p>&#13;
<pre>auto d = boost::gregorian::from_string("1986/9/15");</pre>&#13;
<p class="indent">If you pass an invalid date, the <span class="literal">date</span> constructor will throw an exception, such as <span class="literal">bad_year</span>, <span class="literal">bad_day_of_month</span>, or <span class="literal">bad_month</span>. For example, <a href="ch12.xhtml#ch12ex16">Listing 12-16</a> attempts to construct a date with September 32, 1986.</p>&#13;
<pre>TEST_CASE("Invalid boost::Gregorian::dates throw exceptions") {&#13;
  using boost::gregorian::date;&#13;
  using boost::gregorian::bad_day_of_month;&#13;
&#13;
  REQUIRE_THROWS_AS(date(1986, 9, 32), bad_day_of_month); <span class="ent">➊</span>&#13;
}</pre>&#13;
<p class="listing"><a id="ch12ex16"/><em>Listing 12-16: The <span class="literal">boost::gregorian::date</span> constructor throws exceptions for bad dates.</em></p>&#13;
<p class="indent">Because September 32 isn’t a valid day of the month, the <span class="literal">date</span> constructor throws a <span class="literal">bad_day_of_month</span> exception <span class="ent">➊</span>.</p>&#13;
<div class="note">&#13;
<p class="notet"><strong><span epub:type="pagebreak" id="page_384"/><span class="notes">NOTE</span></strong></p>&#13;
<p class="notep"><em>Due to a limitation in Catch, you cannot use braced initialization for <span class="codeitalic">date</span> in the <span class="literal">REQUIRE_THROWS_AS</span> macro</em> <span class="ent">➊</span>.</p>&#13;
</div>&#13;
<p class="indent">You can obtain the current day from the environment using the non-member function <span class="literal">boost::gregorian::day_clock::local_day</span> or <span class="literal">boost::gregorian:: day_clock::universal_day</span> to obtain the local day based on the system’s time zone settings and the UTC day, respectively:</p>&#13;
<pre>auto d_local = boost::gregorian::day_clock::local_day();&#13;
auto d_univ = boost::gregorian::day_clock::universal_day();</pre>&#13;
<p class="indent">Once you construct a date, you can’t change its value (it’s <em>immutable</em>). However, dates support copy construction and copy assignment.</p>&#13;
<h5 class="h5" id="ch12lev3sec12"><strong>Accessing Date Members</strong></h5>&#13;
<p class="noindent">You can inspect the features of a <span class="literal">date</span> through its many <span class="literal">const</span> methods. <a href="ch12.xhtml#ch12tab07">Table 12-7</a> provides a partial list. In this table, <span class="literal">d</span> is a <span class="literal">date</span>.</p>&#13;
<p class="tabcap"><a id="ch12tab07"/><strong>Table 12-7:</strong> The Most Supported <span class="literal">boost::gregorian::date</span> Accessors</p>&#13;
<table class="topbot-d">&#13;
<colgroup>&#13;
<col style="width:40%"/>&#13;
<col style="width:60%"/>&#13;
</colgroup>&#13;
<tbody>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-h"><p class="tab_th"><strong>Accessor</strong></p></td>&#13;
<td style="vertical-align: top;" class="table-h"><p class="tab_th"><strong>Notes</strong></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="codestrong">d</span><span class="literal">.year()</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Returns the year portion of the <span class="literal">date</span>.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="codestrong">d</span><span class="literal">.month()</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">Returns the month portion of the <span class="literal">date</span>.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="codestrong">d</span><span class="literal">.day()</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Returns the day portion of the <span class="literal">date</span>.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="codestrong">d</span><span class="literal">.day_of_week()</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">Returns the day of the week as an <span class="literal">enum</span> of type <span class="literal">greg_day_of_week</span>.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="codestrong">d</span><span class="literal">.day_of_year()</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Returns the day of the year (from 1 to 366 inclusive).</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="codestrong">d</span><span class="literal">.end_of_month()</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">Returns a date object set to the last day of the month of <span class="codestrong">d</span>.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="codestrong">d</span><span class="literal">.is_not_a_date()</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Returns <span class="literal">true</span> if <span class="codestrong">d</span> is not a date.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b2"><p class="taba"><span class="codestrong">d</span><span class="literal">.week_number()</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b2"><p class="taba">Returns the ISO 8601 week number.</p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<p class="indent"><a href="ch12.xhtml#ch12ex17">Listing 12-17</a> illustrates how to construct a <span class="literal">date</span> and use the accessors in <a href="ch12.xhtml#ch12tab07">Table 12-7</a>.</p>&#13;
<pre>TEST_CASE("boost::gregorian::date supports basic calendar functions") {&#13;
  boost::gregorian::date d{ 1986, 9, 15 }; <span class="ent">➊</span>&#13;
  REQUIRE(d.year() == 1986); <span class="ent">➋</span>&#13;
  REQUIRE(d.month() == 9); <span class="ent">➌</span>&#13;
  REQUIRE(d.day() == 15); <span class="ent">➍</span>&#13;
  REQUIRE(d.day_of_year() == 258); <span class="ent">➎</span>&#13;
  REQUIRE(d.day_of_week() == boost::date_time::Monday); <span class="ent">➏</span>&#13;
}</pre>&#13;
<p class="listing"><a id="ch12ex17"/><em>Listing 12-17: The <span class="literal">boost::gregorian::date</span> supports basic calendar functions.</em></p>&#13;
<p class="indent">Here, you construct a <span class="literal">date</span> from September 15, 1986 <span class="ent">➊</span>. From there, you extract the year <span class="ent">➋</span>, month <span class="ent">➌</span>, day <span class="ent">➍</span>, day of the year <span class="ent">➎</span>, and day of the week <span class="ent">➏</span>.</p>&#13;
<h5 class="h5" id="ch12lev3sec13"><span epub:type="pagebreak" id="page_385"/><strong>Calendar Math</strong></h5>&#13;
<p class="noindent">You can perform simple calendar math on dates. When you subtract one date from another, you get a <span class="literal">boost::gregorian::date_duration</span>. The main functionality of <span class="literal">date_duration</span> is storing an integral number of days, which you can extract using the <span class="literal">days</span> method. <a href="ch12.xhtml#ch12ex18">Listing 12-18</a> illustrates how to compute the number of days elapsed between two <span class="literal">date</span> objects.</p>&#13;
<pre>TEST_CASE("boost::gregorian::date supports calendar arithmetic") {&#13;
  boost::gregorian::date d1{ 1986, 9, 15 }; <span class="ent">➊</span>&#13;
  boost::gregorian::date d2{ 2019, 8, 1 }; <span class="ent">➋</span>&#13;
  auto duration = d2 - d1; <span class="ent">➌</span>&#13;
  REQUIRE(duration.days() == 12008); <span class="ent">➍</span>&#13;
}</pre>&#13;
<p class="listing"><a id="ch12ex18"/><em>Listing 12-18: Subtracting <span class="literal">boost::gregorian::date</span> objects yields a <span class="literal">boost::gregorian:: date_duration</span>.</em></p>&#13;
<p class="indent">Here, you construct a <span class="literal">date</span> for September 15, 1986 <span class="ent">➊</span> and for August 1, 2019 <span class="ent">➋</span>. You subtract these two dates to yield a <span class="literal">date_duration</span> <span class="ent">➌</span>. Using the <span class="literal">days</span> method, you can extract the number of days between the two dates <span class="ent">➍</span>.</p>&#13;
<p class="indent">You can also construct a <span class="literal">date_duration</span> using a <span class="literal">long</span> argument corresponding to the number of days. You can add a <span class="literal">date_duration</span> to a date to obtain another date, as <a href="ch12.xhtml#ch12ex19">Listing 12-19</a> illustrates.</p>&#13;
<pre>TEST_CASE("date and date_duration support addition") {&#13;
  boost::gregorian::date d1{ 1986, 9, 15 }; <span class="ent">➊</span>&#13;
  boost::gregorian::date_duration dur{ 12008 }; <span class="ent">➋</span>&#13;
  auto d2 = d1 + dur; <span class="ent">➌</span>&#13;
  REQUIRE(d2 == boost::gregorian::from_string("2019/8/1")); <span class="ent">➍</span>&#13;
}</pre>&#13;
<p class="listing"><a id="ch12ex19"/><em>Listing 12-19: Adding a <span class="literal">date_duration</span> to a <span class="literal">date</span> yields another <span class="literal">date</span>.</em></p>&#13;
<p class="indent">You construct a <span class="literal">date</span> for September 15, 1986 <span class="ent">➊</span> and 12,008 days for <span class="literal">duration</span> <span class="ent">➋</span>. From <a href="ch12.xhtml#ch12ex18">Listing 12-18</a>, you know that this day plus 12008 yields August 1, 2019. So after adding them <span class="ent">➌</span>, the resulting day is as you expect <span class="ent">➍</span>.</p>&#13;
<h5 class="h5" id="ch12lev3sec14"><strong>Date Periods</strong></h5>&#13;
<p class="noindent">A <em>date period</em> represents the interval between two dates. DateTime provides a <span class="literal">boost::gregorian::date_period</span> class, which has three constructors, as described in <a href="ch12.xhtml#ch12tab08">Table 12-8</a>. In this table, constructors <span class="literal">d1</span> and <span class="literal">d2</span> are <span class="literal">date</span> arguments and <span class="literal">dp</span> is a <span class="literal">date_period</span>.</p>&#13;
<p class="tabcap"><a id="ch12tab08"/><strong>Table 12-8:</strong> Supported <span class="literal">boost::gregorian::date_period</span> Constructors</p>&#13;
<table class="topbot-d">&#13;
<colgroup>&#13;
<col style="width:40%"/>&#13;
<col style="width:60%"/>&#13;
</colgroup>&#13;
<tbody>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-h"><p class="tab_th"><strong>Accessor</strong></p></td>&#13;
<td style="vertical-align: top;" class="table-h"><p class="tab_th"><strong>Notes</strong></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">date_period{</span> <span class="codestrong">d1</span><span class="literal">,</span> <span class="codestrong">d2</span>  <span class="literal">}</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Creates a period including <span class="codestrong">d1</span> but not <span class="codestrong">d2</span>; invalid if <span class="codestrong">d2</span> &lt;= <span class="codestrong">d1</span>.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">date_period{</span>  <span class="codestrong">d</span><span class="literal">,</span> <span class="codestrong">n_days</span>  <span class="literal">}</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">Creates a period frome <span class="codestrong">d</span> to <span class="codestrong">d+n_days</span>.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-ba"><p class="taba"><span class="literal">date_period{</span> <span class="codestrong">dp</span>  <span class="literal">}</span></p></td>&#13;
<td style="vertical-align: top;" class="table-ba"><p class="taba">Copy constructor.</p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_386"/>The <span class="literal">date_period</span> class supports many operations, such as the <span class="literal">contain</span> method, which takes a <span class="literal">date</span> argument and returns <span class="literal">true</span> if the argument is contained in the <span class="literal">period</span>. <a href="ch12.xhtml#ch12ex20">Listing 12-20</a> illustrates this operation.</p>&#13;
<pre>TEST_CASE(+boost::gregorian::date supports periods+) {&#13;
  boost::gregorian::date d1{ 1986, 9, 15 }; <span class="ent">➊</span>&#13;
  boost::gregorian::date d2{ 2019, 8, 1 }; <span class="ent">➋</span>&#13;
  boost::gregorian::date_period p{ d1, d2 }; <span class="ent">➌</span>&#13;
  REQUIRE(p.contains(boost::gregorian::date{ 1987, 10, 27 })); <span class="ent">➍</span>&#13;
}</pre>&#13;
<p class="listing"><a id="ch12ex20"/><em>Listing 12-20: Using the <span class="literal">contains</span> method on a <span class="literal">boost::gregorian::date_period</span> to determine whether a date falls within a particular time interval</em></p>&#13;
<p class="indent">Here, you construct two dates, September 15, 1986 <span class="ent">➊</span> and August 1, 2019 <span class="ent">➋</span>, which you use to construct a <span class="literal">date_period</span> <span class="ent">➌</span>. Using the <span class="literal">contains</span> method, you can determine that the <span class="literal">date_period</span> contains the date October 27, 1987 <span class="ent">➍</span>.</p>&#13;
<p class="indent"><a href="ch12.xhtml#ch12tab09">Table 12-9</a> contains a partial list of other <span class="literal">date_period</span> operations. In this table, <span class="literal">p</span>, <span class="literal">p1</span>, and <span class="literal">p2</span> are <span class="literal">date_period</span> classes and <span class="literal">d</span> is a <span class="literal">date</span>.</p>&#13;
<p class="tabcap"><a id="ch12tab09"/><strong>Table 12-9:</strong> Supported <span class="literal">boost::gregorian::date_period</span> Operations</p>&#13;
<table class="topbot-d">&#13;
<colgroup>&#13;
<col style="width:40%"/>&#13;
<col style="width:60%"/>&#13;
</colgroup>&#13;
<tbody>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-h"><p class="tab_th"><strong>Accessor</strong></p></td>&#13;
<td style="vertical-align: top;" class="table-h"><p class="tab_th"><strong>Notes</strong></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="codestrong">p</span><span class="literal">.begin()</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Returns the first day.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="codestrong">p</span><span class="literal">.last()</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">Returns the last day.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="codestrong">p</span><span class="literal">.length()</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Returns the number of days contained.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="codestrong">p</span><span class="literal">.is_null()</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">Returns <span class="literal">true</span> if the period is invalid (for example, end is before start).</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="codestrong">p</span><span class="literal">.contains(</span><span class="codestrong">d</span><span class="literal">)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Returns <span class="literal">true</span> if <span class="codestrong">d</span> falls within <span class="codestrong">p</span>.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="codestrong">p1</span><span class="literal">.contains(</span><span class="codestrong">p2</span><span class="literal">)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">Returns <span class="literal">true</span> if all of <span class="codestrong">p2</span> falls within <span class="codestrong">p1</span>.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="codestrong">p1</span><span class="literal">.intersects(</span><span class="codestrong">p2</span><span class="literal">)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Returns <span class="literal">true</span> if any of <span class="codestrong">p2</span> falls within <span class="codestrong">p1</span>.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="codestrong">p</span><span class="literal">.is_after(</span><span class="codestrong">d</span><span class="literal">)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">Returns <span class="literal">true</span> if <span class="codestrong">p</span> falls after <span class="codestrong">d</span>.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-ba"><p class="taba"><span class="codestrong">p</span><span class="literal">.is_before(</span><span class="codestrong">d</span><span class="literal">)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-ba"><p class="taba">Returns <span class="literal">true</span> if <span class="codestrong">p</span> falls before <span class="codestrong">d</span>.</p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<h3 class="h3" id="ch12lev1sec3"><strong>Other DateTime Features</strong></h3>&#13;
<p class="noindent">The Boost DateTime library contains three broad categories of programming:</p>&#13;
<p class="bq"><strong>Date</strong> Date programming is the calendar-based programming you just toured.</p>&#13;
<p class="bq"><strong>Time</strong> Time programming, which allows you to work with clocks with microsecond resolution, is available in the <span class="literal">&lt;boost/date_time/posix_time/</span><span class="literal">posix_time.hpp&gt;</span> header. The mechanics are similar to date programming, but you work with clocks instead of Gregorian calendars.</p>&#13;
<p class="bq"><strong>Local-time</strong> Local-time programming is simply time-zone-aware time programming. It’s available in the <span class="literal">&lt;boost/date_time/time_zone_base.hpp&gt;</span> header.</p>&#13;
<div class="note">&#13;
<p class="notet"><span epub:type="pagebreak" id="page_387"/><strong><span class="notes">NOTE</span></strong></p>&#13;
<p class="notep"><em>For brevity, this chapter won’t go into detail about time and local-time programming. See the Boost documentation for information and examples.</em></p>&#13;
</div>&#13;
<h4 class="h4" id="ch12lev2sec8"><strong><em>Chrono</em></strong></h4>&#13;
<p class="noindent">The stdlib Chrono library provides a variety of clocks in the <span class="literal">&lt;chrono&gt;</span> header. You typically use these when you need to program something that depends on time or for timing your code.</p>&#13;
<div class="note">&#13;
<p class="notet"><strong><span class="notes">NOTE</span></strong></p>&#13;
<p class="notep"><em>Boost also offers a Chrono library in the <span class="literal">&lt;boost/chrono.hpp&gt;</span> header. It’s a superset of stdlib’s Chrono library, which includes, for example, process- and thread-specific clocks and user-defined output formats for time.</em></p>&#13;
</div>&#13;
<h5 class="h5" id="ch12lev3sec15"><strong>Clocks</strong></h5>&#13;
<p class="noindent">Three clocks are available in Chrono library; each provides a different guarantee, and all reside in the <span class="literal">std::chrono</span> namespace:</p>&#13;
<ul>&#13;
<li class="noindent">The <span class="literal">std::chrono::system_clock</span> is the system-wide, real-time clock. It’s sometimes also called the <em>wall clock</em>, the elapsed real time since an implementation-specific start date. Most implementations specify the Unix start date of January 1, 1970, at midnight.</li>&#13;
<li class="noindent">The <span class="literal">std::chrono::steady_clock</span> guarantees that its value will never decrease. This might seem absurd to guarantee, but measuring time is more complicated than it seems. For example, a system might have to contend with leap seconds or inaccurate clocks.</li>&#13;
<li class="noindent">The <span class="literal">std::chrono::high_resolution_clock</span> has the shortest <em>tick</em> period available: a tick is the smallest atomic change that the clock can measure.</li></ul>&#13;
<p class="indent">Each of these three clocks supports the static member function <span class="literal">now</span>, which returns a time point corresponding to the current value of the clock.</p>&#13;
<h5 class="h5" id="ch12lev3sec16"><strong>Time Points</strong></h5>&#13;
<p class="indent">A <em>time point</em> represents a moment in time, and Chrono encodes time points using the <span class="literal">std::chrono::time_point</span> type. From a user perspective, <span class="literal">time_point</span> objects are very simple. They provide a <span class="literal">time_since_epoch</span> method that returns the amount of time elapsed between the time point and the clock’s <em>epoch</em>. This elapsed time is called a <em>duration</em>.</p>&#13;
<p class="indent">An epoch is an implementation-defined reference time point denoting the beginning of a clock. The Unix Epoch (or POSIX time) begins on January 1, 1970, whereas the Windows Epoch begins on January 1, 1601 (corresponding with the beginning of a 400-year, Gregorian-calendar cycle).</p>&#13;
<p class="indent">The <span class="literal">time_since_epoch</span> method is not the only way to obtain a duration from a <span class="literal">time_point</span>. You can obtain the duration between two <span class="literal">time_point</span> objects by subtracting them.</p>&#13;
<h5 class="h5" id="ch12lev3sec17"><strong><span epub:type="pagebreak" id="page_388"/>Durations</strong></h5>&#13;
<p class="indent">A <span class="literal">std::chrono::duration</span> represents the time between the two <span class="literal">time_point</span> objects. Durations expose a <span class="literal">count</span> method, which returns the number of clock ticks in the duration.</p>&#13;
<p class="indent"><a href="ch12.xhtml#ch12ex21">Listing 12-21</a> shows how to obtain the current time from each of the three available clocks, extract the time since each clock’s epoch as a&#13;
duration, and then convert them to ticks.</p>&#13;
<pre>TEST_CASE("std::chrono supports several clocks") {&#13;
  auto sys_now = std::chrono::system_clock::now(); <span class="ent">➊</span>&#13;
  auto hires_now = std::chrono::high_resolution_clock::now(); <span class="ent">➋</span>&#13;
  auto steady_now = std::chrono::steady_clock::now(); <span class="ent">➌</span>&#13;
&#13;
  REQUIRE(sys_now.time_since_epoch().count() &gt; 0); <span class="ent">➍</span>&#13;
  REQUIRE(hires_now.time_since_epoch().count() &gt; 0); <span class="ent">➎</span>&#13;
  REQUIRE(steady_now.time_since_epoch().count() &gt; 0); <span class="ent">➏</span>&#13;
}</pre>&#13;
<p class="listing"><a id="ch12ex21"/><em>Listing 12-21: The <span class="literal">std::chrono</span> supports several kinds of clocks.</em></p>&#13;
<p class="indent">You obtain the current time from the <span class="literal">system_clock</span> <span class="ent">➊</span>, the <span class="literal">high_resolu</span><span class="literal">tion&#13;
&#13;
_clock</span> <span class="ent">➋</span>, and the <span class="literal">steady_clock</span> <span class="ent">➌</span>. For each clock, you convert the time point into a <span class="literal">duration</span> since the clock’s epoch using the <span class="literal">time_since_epoch</span> method. You immediately call <span class="literal">count</span> on the resulting duration to yield a tick count, which should be greater than zero <span class="ent">➍ ➎ ➏</span>.</p>&#13;
<p class="indent">In addition to deriving durations from time points, you can construct them directly. The <span class="literal">std::chrono</span> namespace contains helper functions to generate durations. For convenience, Chrono offers a number of user-defined duration literals in the <span class="literal">std::literals::chrono_literals</span> namespace. These provide some syntactic sugar, convenient language syntax that makes life easier for the developer, for defining duration literals.</p>&#13;
<p class="indent"><a href="ch12.xhtml#ch12tab10">Table 12-10</a> shows the helper functions and their literal equivalents, where each expression corresponds to an hour’s duration.</p>&#13;
<p class="tabcap"><a id="ch12tab10"/><strong>Table 12-10:</strong> <span class="literal">std::chrono</span> Helper Functions and User-Defined Literals for Creating Durations</p>&#13;
<table class="topbot-d">&#13;
<colgroup>&#13;
<col style="width:40%"/>&#13;
<col style="width:60%"/>&#13;
</colgroup>&#13;
<tbody>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-h"><p class="tab_th"><strong>Helper function</strong></p></td>&#13;
<td style="vertical-align: top;" class="table-h"><p class="tab_th"><strong>Literal equivalent</strong></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">nanoseconds(3600000000000)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">3600000000000ns</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">microseconds(3600000000)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">3600000000us</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">milliseconds(3600000)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">3600000ms</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">seconds(3600)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">3600s</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">minutes(60)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">60m</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b2"><p class="taba"><span class="literal">hours(1)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b2"><p class="taba"><span class="literal">1h</span></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_389"/>For example, <a href="ch12.xhtml#ch12ex22">Listing 12-22</a> illustrates how to construct a duration of 1 second with <span class="literal">std::chrono::seconds</span> and another duration of 1,000 milliseconds using the <span class="literal">ms</span> duration literal.</p>&#13;
<pre>#include &lt;chrono&gt;&#13;
TEST_CASE("std::chrono supports several units of measurement") {&#13;
  using namespace std::literals::chrono_literals; <span class="ent">➊</span>&#13;
  auto one_s = std::chrono::seconds(1); <span class="ent">➋</span>&#13;
  auto thousand_ms = 1000ms; <span class="ent">➌</span>&#13;
  REQUIRE(one_s == thousand_ms); <span class="ent">➍</span>&#13;
}</pre>&#13;
<p class="listing"><a id="ch12ex22"/><em>Listing 12-22: The <span class="literal">std::chrono</span> supports many units of measurement, which are comparable.</em></p>&#13;
<p class="indent">Here, you bring in the <span class="literal">std::literals::chrono_literals</span> namespace so you have access to the duration literals <span class="ent">➊</span>. You construct a duration called <span class="literal">one_s</span> from the <span class="literal">seconds</span> helper function <span class="ent">➋</span> and another called <span class="literal">thousand_ms</span> from the <span class="literal">ms</span> duration literal <span class="ent">➌</span>. These are equivalent because a second contains a thousand milliseconds <span class="ent">➍</span>.</p>&#13;
<p class="indent">Chrono provides the function template <span class="literal">std::chrono::duration_cast</span> to cast a duration from one unit to another. As with other cast-related function templates, such as <span class="literal">static_cast</span>, <span class="literal">duration_cast</span> takes a single template parameter corresponding to the target duration and a single argument corresponding to the duration you want to cast.</p>&#13;
<p class="indent"><a href="ch12.xhtml#ch12ex23">Listing 12-23</a> illustrates how to cast a <span class="literal">nanosecond</span> duration into a <span class="literal">second</span> duration.</p>&#13;
<pre>TEST_CASE("std::chrono supports duration_cast") {&#13;
  using namespace std::chrono; <span class="ent">➊</span>&#13;
  auto billion_ns_as_s = duration_cast&lt;seconds<span class="ent">➋</span>&gt;(1'000'000'000ns<span class="ent">➌</span>);&#13;
  REQUIRE(billion_ns_as_s.count() == 1); <span class="ent">➍</span>&#13;
}</pre>&#13;
<p class="listing"><a id="ch12ex23"/><em>Listing 12-23: The <span class="literal">std::chrono</span> supports <span class="literal">std::chrono::duration_cast</span>.</em></p>&#13;
<p class="indent">First, you bring in the <span class="literal">std::chrono</span> namespace for easy access to <span class="literal">duration_cast</span>, the duration helper functions, and the duration literals <span class="ent">➊</span>. Next, you use the <span class="literal">ns</span> duration literal to specify a billion-nanosecond duration <span class="ent">➌</span>, which you pass as the argument to <span class="literal">duration_cast</span>. You specify the template parameter of <span class="literal">duration_cast</span> as seconds <span class="ent">➋</span>, so the resulting duration, <span class="literal">billion_ns_as_s</span>, equals 1 second <span class="ent">➍</span>.</p>&#13;
<h5 class="h5" id="ch12lev3sec18"><strong>Waiting</strong></h5>&#13;
<p class="noindent">Sometimes, you’ll use durations to specify some period of time for your program to wait. The stdlib provides concurrency primitives in the <span class="literal">&lt;thread&gt;</span> header, which contains the non-member function <span class="literal">std::this_thread::sleep_</span><span class="literal">for</span>. The <span class="literal">sleep_for</span> function accepts a <span class="literal">duration</span> argument corresponding to how long you want the current thread of execution to wait or “sleep.”</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_390"/><a href="ch12.xhtml#ch12ex24">Listing 12-24</a> shows how to employ <span class="literal">sleep_for</span>.</p>&#13;
<pre>#include &lt;thread&gt;&#13;
#include &lt;chrono&gt;&#13;
TEST_CASE("std::chrono used to sleep") {&#13;
  using namespace std::literals::chrono_literals; <span class="ent">➊</span>&#13;
  auto start = std::chrono::system_clock::now(); <span class="ent">➋</span>&#13;
  std::this_thread::sleep_for(100ms); <span class="ent">➌</span>&#13;
  auto end = std::chrono::system_clock::now(); <span class="ent">➍</span>&#13;
  REQUIRE(end - start &gt;= 100ms); <span class="ent">➎</span>&#13;
}</pre>&#13;
<p class="listing"><a id="ch12ex24"/><em>Listing 12-24: The <span class="literal">std::chrono</span> works with <span class="literal">&lt;thread&gt;</span> to put the current thread to sleep.</em></p>&#13;
<p class="indent">As before, you bring in the <span class="literal">chrono_literals</span> namespace so you have access to the duration literals <span class="ent">➊</span>. You record the current time according to <span class="literal">sys</span><span class="literal">tem_</span><span class="literal">clock</span>, saving the resulting <span class="literal">time_point</span> into the <span class="literal">start</span> variable <span class="ent">➋</span>. Next, you invoke <span class="literal">sleep_for</span> with a 100-millisecond duration (a tenth of a second) <span class="ent">➌</span>. You then record the current time again, saving the resulting <span class="literal">time_point</span> into <span class="literal">end</span> <span class="ent">➍</span>. Because the program slept for 100 milliseconds between calls to <span class="literal">std::chrono::system_clock</span>, the duration resulting from subtracting <span class="literal">start</span> from <span class="literal">end</span> should be at least <span class="literal">100ms</span> <span class="ent">➎</span>.</p>&#13;
<h5 class="h5" id="ch12lev3sec19"><strong>Timing</strong></h5>&#13;
<p class="noindent">To optimize code, you absolutely need accurate measurements. You can use Chrono to measure how long a series of operations takes. This enables you to establish that a particular code path is actually responsible for observed performance issues. It also enables you to establish an objective measure for the progress of your optimization efforts.</p>&#13;
<p class="indent">Boost’s Timer library contains the <span class="literal">boost::timer::auto_cpu_timer</span> class in the <span class="literal">&lt;boost/timer/timer.hpp&gt;</span> header, which is an RAII object that begins timing in its constructor and stops timing in its destructor.</p>&#13;
<p class="indent">You can build your own makeshift <span class="literal">Stopwatch</span> class using just the stdlib Chrono library. The <span class="literal">Stopwatch</span> class can keep a reference to a <span class="literal">duration</span> object. In the <span class="literal">Stopwatch</span> destructor, you can set the <span class="literal">duration</span> via its reference. <a href="ch12.xhtml#ch12ex25">Listing 12-25</a> provides an implementation.</p>&#13;
<pre>#include &lt;chrono&gt;&#13;
&#13;
struct Stopwatch {&#13;
  Stopwatch(std::chrono::nanoseconds&amp; result<span class="ent">➊</span>)&#13;
    : result{ result }, <span class="ent">➋</span>&#13;
    start{ std::chrono::high_resolution_clock::now() } { } <span class="ent">➌</span>&#13;
  ~Stopwatch() {&#13;
    result = std::chrono::high_resolution_clock::now() - start; <span class="ent">➍</span>&#13;
  }&#13;
private:&#13;
  std::chrono::nanoseconds&amp; result;&#13;
<span epub:type="pagebreak" id="page_391"/>  const std::chrono::time_point&lt;std::chrono::high_resolution_clock&gt; start;&#13;
};</pre>&#13;
<p class="listing"><a id="ch12ex25"/><em>Listing 12-25: A simple <span class="literal">Stopwatch</span> class that computes the duration of its lifetime</em></p>&#13;
<p class="indent">The <span class="literal">Stopwatch</span> constructor requires a single <span class="literal">nanoseconds</span> reference <span class="ent">➊</span>, which you store into the <span class="literal">result</span> field with a member initializer <span class="ent">➋</span>. You also save the current time of the <span class="literal">high_resolution_clock</span> by setting the <span class="literal">start</span> field&#13;
&#13;
to the result of <span class="literal">now()</span> <span class="ent">➌</span>. In the <span class="literal">Stopwatch</span> destructor, you again invoke <span class="literal">now()</span> on the <span class="literal">high_resolution_clock</span> and subtract <span class="literal">start</span> to obtain the duration of the lifetime of <span class="literal">Stopwatch</span>. You use the <span class="literal">result</span> reference to write the <span class="literal">duration</span> <span class="ent">➍</span>.</p>&#13;
<p class="indent"><a href="ch12.xhtml#ch12ex26">Listing 12-26</a> shows the <span class="literal">Stopwatch</span> in action, performing a million floating-point divisions within a loop and computing the average time elapsed per iteration.</p>&#13;
<pre>#include &lt;cstdio&gt;&#13;
#include &lt;cstdint&gt;&#13;
#include &lt;chrono&gt;&#13;
&#13;
struct Stopwatch {&#13;
--<span class="codeitalic1">snip</span>--&#13;
};&#13;
int main() {&#13;
  const size_t n = 1'000'000; <span class="ent">➊</span>&#13;
  std::chrono::nanoseconds elapsed; <span class="ent">➋</span>&#13;
  {&#13;
    Stopwatch stopwatch{ elapsed }; <span class="ent">➌</span>&#13;
    volatile double result{ 1.23e45 }; <span class="ent">➍</span>&#13;
    for (double i = 1; i &lt; n; i++) {&#13;
      result /= i; <span class="ent">➎</span>&#13;
    }&#13;
  }&#13;
  auto time_per_division = elapsed.count() / double{ n }; <span class="ent">➏</span>&#13;
  printf("Took %gns per division.", time_per_division); <span class="ent">➐</span>&#13;
}&#13;
--------------------------------------------------------------------------&#13;
<span class="color1">Took 6.49622ns per division. <span class="ent">➐</span></span></pre>&#13;
<p class="listing"><a id="ch12ex26"/><em>Listing 12-26: Using the <span class="literal">Stopwatch</span> to estimate the time taken for <span class="literal">double</span> division</em></p>&#13;
<p class="indent">First, you initialize a variable <span class="literal">n</span> to a million, which stores the total number of iterations your program will make <span class="ent">➊</span>. You declare the <span class="literal">elapsed</span> variable, which will store the time elapsed across all the iterations <span class="ent">➋</span>. Within a block, you declare a <span class="literal">Stopwatch</span> and pass an <span class="literal">elapsed</span> reference to the constructor <span class="ent">➌</span>. Next, you declare a <span class="literal">double</span> called <span class="literal">result</span> with a junk value in it <span class="ent">➍</span>. You declare this variable <span class="literal">volatile</span> so the compiler doesn’t try to optimize the loop away. Within the loop, you do some arbitrary, floating-point division <span class="ent">➎</span>.</p>&#13;
<p class="indent">Once the block completes, <span class="literal">stopwatch</span> destructs. This writes the duration of <span class="literal">stopwatch</span> to <span class="literal">elapsed</span>, which you use to compute the average number of nanoseconds per loop iteration and store into the <span class="literal">time_per_addition</span> variable <span class="ent">➏</span>. You conclude the program by printing <span class="literal">time_per_division</span> with <span class="literal">printf</span> <span class="ent">➐</span>.</p>&#13;
<h3 class="h3" id="ch12lev1sec4"><strong><span epub:type="pagebreak" id="page_392"/>Numerics</strong></h3>&#13;
<p class="noindent">This section discusses handling numbers with a focus on common mathematical functions and constants; handling complex numbers; generating random numbers, numeric limits, and conversions; and computing ratios.</p>&#13;
<h4 class="h4" id="ch12lev2sec9"><strong><em>Numeric Functions</em></strong></h4>&#13;
<p class="noindent">The stdlib Numerics and Boost Math libraries provide a profusion of numeric/mathematical functions. For the sake of brevity, this chapter presents only quick references. For detailed treatment, see [numerics] in the ISO C++ 17 Standard and the Boost Math documentation.</p>&#13;
<p class="indent"><a href="ch12.xhtml#ch12tab11">Table 12-11</a> provides a partial list of many common, non-member mathematical functions available in the stdlib’s Math library.</p>&#13;
<p class="tabcap"><a id="ch12tab11"/><strong>Table 12-11:</strong> A Partial List of Common Math Functions in the stdlib</p>&#13;
<table class="topbot-d">&#13;
<colgroup>&#13;
<col style="width:20%"/>&#13;
<col style="width:40%"/>&#13;
<col style="width:10%"/>&#13;
<col style="width:10%"/>&#13;
<col style="width:20%"/>&#13;
</colgroup>&#13;
<tbody>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-h"><p class="tab_th"><strong>Function</strong></p></td>&#13;
<td style="vertical-align: top;" class="table-h"><p class="tab_th"><strong>Computes the . . .</strong></p></td>&#13;
<td style="vertical-align: top;" class="table-h"><p class="tab_th"><strong>Ints</strong></p></td>&#13;
<td style="vertical-align: top;" class="table-h"><p class="tab_th"><strong>Floats</strong></p></td>&#13;
<td style="vertical-align: top;" class="table-h"><p class="tab_th"><strong>Header</strong></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">abs(</span><span class="codestrong">x</span><span class="literal">)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Absolute value of <span class="codestrong">x</span>.</p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">✓</p></td>&#13;
<td style="vertical-align: top;" class="table-b1"/>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">&lt;cstdlib&gt;</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">div(</span><span class="codestrong">x</span><span class="literal">,</span> <span class="codestrong">y</span><span class="literal">)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">Quotient and remainder of <span class="codestrong">x</span> divided by <span class="codestrong">y</span>.</p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">✓</p></td>&#13;
<td style="vertical-align: top;" class="table-b"/>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">&lt;cstdlib&gt;</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">abs(</span><span class="codestrong">x</span><span class="literal">)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Absolute value of <span class="codestrong">x</span>.</p></td>&#13;
<td style="vertical-align: top;" class="table-b1"/>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">✓</p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">&lt;cmath&gt;</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">fmod(</span><span class="codestrong">x</span><span class="literal">,</span> <span class="codestrong">y</span><span class="literal">)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">Remainder of floating-point division of <span class="codestrong">x</span> by <span class="codestrong">y</span>.</p></td>&#13;
<td style="vertical-align: top;" class="table-b"/>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">✓</p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">&lt;cmath&gt;</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">remainder(</span><span class="codestrong">x</span><span class="literal">,</span> <span class="codestrong">y</span><span class="literal">)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Signed remainder of dividing <span class="codestrong">x</span> by <span class="codestrong">y</span>.</p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">✓</p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">✓</p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">&lt;cmath&gt;</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">fma(</span><span class="codestrong">x</span><span class="literal">,</span> <span class="codestrong">y</span><span class="literal">,</span> <span class="codestrong">z</span><span class="literal">)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">Multiply the first two arguments and add their product to the third argument; also called fused multiplication addition; that is, <span class="codestrong">x</span> <span class="codestrong">* y</span> <span class="literal">+</span> <span class="codestrong">z</span>.</p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">✓</p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">✓</p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">&lt;cmath&gt;</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">max(</span><span class="codestrong">x</span><span class="literal">,</span> <span class="codestrong">y</span><span class="literal">)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Maximum of <span class="codestrong">x</span> and <span class="codestrong">y</span>.</p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">✓</p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">✓</p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">&lt;algorithm&gt;</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">min(</span><span class="codestrong">x</span><span class="literal">,</span> <span class="codestrong">y</span><span class="literal">)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">Minimum of <span class="codestrong">x</span> and <span class="codestrong">y</span>.</p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">✓</p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">✓</p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">&lt;algorithm&gt;</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">exp(</span><span class="codestrong">x</span><span class="literal">)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Value of <span class="literal">e</span><sup><span class="codestrong">x</span></sup>.</p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">✓</p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">✓</p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">&lt;cmath&gt;</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">exp2(</span><span class="codestrong">x</span><span class="literal">)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">Value of <span class="literal">2<sup><span class="codestrong">x</span></sup></span>.</p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">✓</p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">✓</p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">&lt;cmath&gt;</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">log(</span><span class="codestrong">x</span><span class="literal">)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Natural log of x; that is, ln x.</p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">✓</p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">✓</p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">&lt;cmath&gt;</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">log10(</span><span class="codestrong">x</span><span class="literal">)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">Common log of x; that is, log10 x.</p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">✓</p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">✓</p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">&lt;cmath&gt;</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">log2(</span><span class="codestrong">x</span><span class="literal">)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Base 2 log of x; that is, log10 x.</p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">✓</p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">✓</p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">&lt;cmath&gt;</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">gcd(</span><span class="codestrong">x</span><span class="literal">,</span> <span class="codestrong">y</span><span class="literal">)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">Greatest common denominator of <span class="codestrong">x</span> and <span class="codestrong">y</span>.</p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">✓</p></td>&#13;
<td style="vertical-align: top;" class="table-b"/>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">&lt;numeric&gt;</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">lcm(</span><span class="codestrong">x</span><span class="literal">,</span> <span class="codestrong">y</span><span class="literal">)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Least common multiple of <span class="codestrong">x</span> and <span class="codestrong">y</span>.</p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">✓</p></td>&#13;
<td style="vertical-align: top;" class="table-b1"/>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">&lt;numeric&gt;</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">erf(</span><span class="codestrong">x</span><span class="literal">)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">Gauss error function of <span class="codestrong">x</span>.</p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">✓</p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">✓</p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">&lt;cmath&gt;</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">pow(</span><span class="codestrong">x</span><span class="literal">,</span> <span class="codestrong">y</span><span class="literal">)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Value of <span class="codestrong">x<sup>y</sup></span>.</p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">✓</p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">✓</p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">&lt;cmath&gt;</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">sqrt(</span><span class="codestrong">x</span><span class="literal">)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">Square root of <span class="codestrong">x</span>.</p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">✓</p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">✓</p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">&lt;cmath&gt;</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">cbrt(</span><span class="codestrong">x</span><span class="literal">)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Cube root of <span class="codestrong">x</span>.</p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">✓</p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">✓</p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">&lt;cmath&gt;</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">hypot(</span><span class="codestrong">x</span><span class="literal">,</span> <span class="codestrong">y</span><span class="literal">)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">Square root of <span class="codestrong">x</span><sup>2</sup> <span class="literal">+</span> <span class="codestrong">y</span><sup>2</sup>.</p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">✓</p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">✓</p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">&lt;cmath&gt;</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">sin(</span><span class="codestrong">x</span><span class="literal">)</span></p>&#13;
<p class="taba"><span class="literal">cos(</span><span class="codestrong">x</span><span class="literal">)</span></p>&#13;
<p class="taba"><span class="literal">tan(</span><span class="codestrong">x</span><span class="literal">)</span></p>&#13;
<p class="taba"><span class="literal">asin(</span><span class="codestrong">x</span><span class="literal">)</span></p>&#13;
<p class="taba"><span class="literal">acos(</span><span class="codestrong">x</span><span class="literal">)</span></p>&#13;
<p class="taba"><span class="literal">atan(</span><span class="codestrong">x</span><span class="literal">)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Associated trigonometric function value.</p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">✓</p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">✓</p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">&lt;cmath&gt;</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span epub:type="pagebreak" id="page_393"/><span class="literal">sinh(</span><span class="codestrong">x</span><span class="literal">)</span></p>&#13;
<p class="taba"><span class="literal">cosh(</span><span class="codestrong">x</span><span class="literal">)</span></p>&#13;
<p class="taba"><span class="literal">tanh(</span><span class="codestrong">x</span><span class="literal">)</span></p>&#13;
<p class="taba"><span class="literal">asinh(</span><span class="codestrong">x</span><span class="literal">)</span></p>&#13;
<p class="taba"><span class="literal">acosh(</span><span class="codestrong">x</span><span class="literal">)</span></p>&#13;
<p class="taba"><span class="literal">atanh(</span><span class="codestrong">x</span><span class="literal">)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">Associated hyperbolic function value.</p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">✓</p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">✓</p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">&lt;cmath&gt;</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">ceil(</span><span class="codestrong">x</span><span class="literal">)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Nearest integer greater than or equal to <span class="codestrong">x</span>.</p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">✓</p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">✓</p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">&lt;cmath&gt;</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">floor(</span><span class="codestrong">x</span><span class="literal">)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">Nearest integer less than or equal to <span class="codestrong">x</span>.</p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">✓</p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">✓</p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">&lt;cmath&gt;</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">round(</span><span class="codestrong">x</span><span class="literal">)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Nearest integer equal to <span class="codestrong">x</span>; rounds away from zero in midpoint cases.</p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">✓</p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">✓</p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">&lt;cmath&gt;</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">isfinite(</span><span class="codestrong">x</span><span class="literal">)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">Value <span class="literal">true</span> if <span class="codestrong">x</span> is a finite number.</p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">✓</p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">✓</p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">&lt;cmath&gt;</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-ba"><p class="taba"><span class="literal">isinf(</span><span class="codestrong">x</span><span class="literal">)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-ba"><p class="taba">Value <span class="literal">true</span> if <span class="codestrong">x</span> is an infinite number.</p></td>&#13;
<td style="vertical-align: top;" class="table-ba"><p class="taba">✓</p></td>&#13;
<td style="vertical-align: top;" class="table-ba"><p class="taba">✓</p></td>&#13;
<td style="vertical-align: top;" class="table-ba"><p class="taba"><span class="literal">&lt;cmath&gt;</span></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<div class="note">&#13;
<p class="notet"><strong><span class="notes">NOTE</span></strong></p>&#13;
<p class="notep"><em>Other specialized mathematical functions are in the <span class="literal">&lt;cmath&gt;</span> header. For example, functions to compute Laguerre and Hermite polynomials, elliptic integrals, cylindrical Bessel and Neumann functions, and the Riemann zeta function appear in the header.</em></p>&#13;
</div>&#13;
<h4 class="h4" id="ch12lev2sec10"><strong><em>Complex Numbers</em></strong></h4>&#13;
<p class="noindent">A <em>complex number</em> is of the form <span class="literal">a+bi</span>, where <span class="literal">i</span> is an <em>imaginary number</em> that, when multiplied by itself, equals negative one; that is, <span class="literal">i*i=-1</span>. Imaginary numbers have applications in control theory, fluid dynamics, electrical engineering, signal analysis, number theory, and quantum physics, among other fields. The <span class="literal">a</span> portion of a complex number is called its <em>real component</em>, and the <span class="literal">b</span> portion is called the <em>imaginary component</em>.</p>&#13;
<p class="indent">The stdlib offers the <span class="literal">std::complex</span> class template in the <span class="literal">&lt;complex&gt;</span> header. It accepts a template parameter for the underlying type of the real and imaginary component. This template parameter must be one of the fundamental floating-point types.</p>&#13;
<p class="indent">To construct a <span class="literal">complex</span>, you can pass in two arguments: the real and the imaginary components. The <span class="literal">complex</span> class also supports copy construction and copy assignment.</p>&#13;
<p class="indent">The non-member functions <span class="literal">std::real</span> and <span class="literal">std::imag</span> can extract the real and imaginary components from a <span class="literal">complex</span>, respectively, as <a href="ch12.xhtml#ch12ex27">Listing 12-27</a> illustrates.</p>&#13;
<pre>#include &lt;complex&gt;&#13;
&#13;
TEST_CASE("std::complex has a real and imaginary component") {&#13;
  std::complex&lt;double&gt; a{0.5, 14.13}; <span class="ent">➊</span>&#13;
  REQUIRE(std::real(a) == Approx(0.5)); <span class="ent">➋</span>&#13;
  REQUIRE(std::imag(a) == Approx(14.13)); <span class="ent">➌</span>&#13;
}</pre>&#13;
<p class="listing"><a id="ch12ex27"/><em>Listing 12-27: Constructing a <span class="literal">std::complex</span> and extracting its components</em></p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_394"/>You construct a <span class="literal">std::complex</span> with a real component of 0.5 and an imaginary component of 14.13 <span class="ent">➊</span>. You use <span class="literal">std::real</span> to extract the real component <span class="ent">➋</span> and <span class="literal">std::imag</span> to extract the imaginary component <span class="ent">➌</span>.</p>&#13;
<p class="indent"><a href="ch12.xhtml#ch12tab12">Table 12-12</a> contains a partial list of supported operations with <span class="literal">std::complex</span>.</p>&#13;
<p class="tabcap"><a id="ch12tab12"/><strong>Table 12-12:</strong> A Partial List of <span class="literal">std::complex</span> Operations</p>&#13;
<table class="topbot-d">&#13;
<colgroup>&#13;
<col style="width:40%"/>&#13;
<col style="width:60%"/>&#13;
</colgroup>&#13;
<tbody>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-h"><p class="tab_th"><strong>Operation</strong></p></td>&#13;
<td style="vertical-align: top;" class="table-h"><p class="tab_th"><strong>Notes</strong></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="codestrong">c1+c2</span></p>&#13;
<p class="taba"><span class="codestrong">c1-c2</span></p>&#13;
<p class="taba"><span class="codestrong">c1*c2</span></p>&#13;
<p class="taba"><span class="codestrong">c1/c2</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Performs addition, subtraction, multiplication, and division.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="codestrong">c+s</span></p>&#13;
<p class="taba"><span class="codestrong">c-s</span></p>&#13;
<p class="taba"><span class="codestrong">c*s</span></p>&#13;
<p class="taba"><span class="codestrong">c/s</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">Converts the scalar <span class="codestrong">s</span> into a complex number with the real component equal to the scalar value and the imaginary component equal to zero. This conversion supports the corresponding complex operation (addition, subtraction, multiplication, or division) in the preceding row.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">real</span><span class="literal">(</span><span class="codestrong">c</span><span class="literal">)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Extracts real component.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">imag</span><span class="literal">(</span><span class="codestrong">c</span><span class="literal">)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">Extracts imaginary component.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">abs</span><span class="literal">(</span><span class="codestrong">c</span><span class="literal">)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Computes magnitude.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">arg</span><span class="literal">(</span><span class="codestrong">c</span><span class="literal">)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">Computes the phase angle.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">norm</span><span class="literal">(</span><span class="codestrong">c</span><span class="literal">)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Computes the squared magnitude.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">conj</span><span class="literal">(</span><span class="codestrong">c</span><span class="literal">)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">Computes the complex conjugate.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">proj</span><span class="literal">(</span><span class="codestrong">c</span><span class="literal">)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Computes Riemann sphere projection.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">sin</span><span class="literal">(</span><span class="codestrong">c</span><span class="literal">)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">Computes the sine.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">cos</span><span class="literal">(</span><span class="codestrong">c</span><span class="literal">)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Computes the cosine.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">tan</span><span class="literal">(</span><span class="codestrong">c</span><span class="literal">)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">Computes the tangent.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">asin</span><span class="literal">(</span><span class="codestrong">c</span><span class="literal">)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Computes the arcsine.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">acos</span><span class="literal">(</span><span class="codestrong">c</span><span class="literal">)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">Computes the arccosine.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">atan</span><span class="literal">(</span><span class="codestrong">c</span><span class="literal">)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Computes the arctangent.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-ba"><p class="taba"><span class="codestrong">c</span> <span class="literal">= polar(</span><span class="codestrong">m</span><span class="literal">,</span> <span class="codestrong">a</span><span class="literal">)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-ba"><p class="taba">Computes complex number determined by magnitude <span class="codestrong">m</span> and angle <span class="codestrong">a</span>.</p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<h4 class="h4" id="ch12lev2sec11"><strong><em>Mathematical Constants</em></strong></h4>&#13;
<p class="noindent">Boost offers a suite of commonly used mathematical constants in the <span class="literal">&lt;boost /math/constants/constants.hpp&gt;</span> header. More than 70 constants are available,  and you can obtain them in <span class="literal">float</span>, <span class="literal">double</span>, or <span class="literal">long double</span> form by obtaining the relevant global variable from the <span class="literal">boost::math::float_constants</span>, <span class="literal">boost::math::double_constants</span>, and <span class="literal">boost::math::long_double_constants</span> respectively.</p>&#13;
<p class="indent">One of the many constants available is <span class="literal">four_thirds_pi</span>, which approximates 4<span class="literal">π</span>/3. The formula for computing the volume of a sphere of radius <em>r</em> is 4π<em>r</em><sup>3</sup>/3, so you could pull in this constant to make computing such a volume easy. <a href="ch12.xhtml#ch12ex28">Listing 12-28</a> illustrates how to compute the volume of a sphere with radius 10.</p>&#13;
<pre><span epub:type="pagebreak" id="page_395"/>#include &lt;cmath&gt;&#13;
#include &lt;boost/math/constants/constants.hpp&gt;&#13;
&#13;
TEST_CASE("boost::math offers constants") {&#13;
  using namespace boost::math::double_constants; <span class="ent">➊</span>&#13;
  auto sphere_volume = four_thirds_pi * std::pow(10, 3); <span class="ent">➋</span>&#13;
  REQUIRE(sphere_volume == Approx(4188.7902047));&#13;
}</pre>&#13;
<p class="listing"><a id="ch12ex28"/><em>Listing 12-28: The <span class="literal">boost::math</span> namespace offers constants</em></p>&#13;
<p class="indent">Here, you pull in the namespace <span class="literal">boost::math::double_constants</span>, which brings all the <span class="literal">double</span> versions of the Boost Math constants <span class="ent">➊</span>. Next, you calculate the <span class="literal">sphere_volume</span> by computing <span class="literal">four_thirds_pi</span> times 10<sup>3</sup> <span class="ent">➋</span>.</p>&#13;
<p class="indent"><a href="ch12.xhtml#ch12tab13">Table 12-13</a> provides some of the more commonly used constants in Boost Math.</p>&#13;
<p class="tabcap"><a id="ch12tab13"/><strong>Table 12-13:</strong> Some of the Most Common Boost Math Constants</p>&#13;
<table class="topbot-d">&#13;
<colgroup>&#13;
<col style="width:25%"/>&#13;
<col style="width:25%"/>&#13;
<col style="width:25%"/>&#13;
<col style="width:25%"/>&#13;
</colgroup>&#13;
<tbody>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-h"><p class="tab_th"><strong>Constant</strong></p></td>&#13;
<td style="vertical-align: top;" class="table-h"><p class="tab_th"><strong>Value</strong></p></td>&#13;
<td style="vertical-align: top;" class="table-h"><p class="tab_th"><strong>Approx.</strong></p></td>&#13;
<td style="vertical-align: top;" class="table-h"><p class="tab_th"><strong>Note</strong></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">half</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">1/2</p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">0.5</p></td>&#13;
<td style="vertical-align: top;" class="table-b1"/>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">third</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">1/3</p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">0.333333</p></td>&#13;
<td style="vertical-align: top;" class="table-b"/>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">two_thirds</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">2/3</p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">0.66667</p></td>&#13;
<td style="vertical-align: top;" class="table-b1"/>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">three_quarters</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">3/4</p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">0.75</p></td>&#13;
<td style="vertical-align: top;" class="table-b"/>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">root_two</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">√2</p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">1.41421</p></td>&#13;
<td style="vertical-align: top;" class="table-b1"/>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">root_three</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">√3</p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">1.73205</p></td>&#13;
<td style="vertical-align: top;" class="table-b"/>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">half_root_two</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">√2 / 2</p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">0.707106</p></td>&#13;
<td style="vertical-align: top;" class="table-b1"/>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">ln_two</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">ln(2)</p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">0.693147</p></td>&#13;
<td style="vertical-align: top;" class="table-b"/>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">ln_ten</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">ln(10)</p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">2.30258</p></td>&#13;
<td style="vertical-align: top;" class="table-b1"/>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">pi</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">π</p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">3.14159</p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">Archimedes’ constant</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">two_pi</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">2π</p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">6.28318</p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Circumference of unit circle</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">four_thirds_pi</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">4π/3</p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">4.18879</p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">Volume of unit sphere</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">one_div_two_pi</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">1/(2π)</p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">1.59155</p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Gaussian integrals</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">root_pi</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">√ π</p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">1.77245</p></td>&#13;
<td style="vertical-align: top;" class="table-b"/>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">e</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">e</p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">2.71828</p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Euler’s constant e</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">e_pow_pi</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">e<sup>π</sup></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">23.14069</p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">Gelfond’s constant</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">root_e</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">√e</p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">1.64872</p></td>&#13;
<td style="vertical-align: top;" class="table-b1"/>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">log10_e</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">log10(e)</p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">0.434294</p></td>&#13;
<td style="vertical-align: top;" class="table-b"/>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">degree</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">π / 180</p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">0.017453</p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Number of radians per degree</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">radian</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">180 / π</p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">57.2957</p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">Number of degrees per radian</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">sin_one</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">sin(1)</p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">0.84147</p></td>&#13;
<td style="vertical-align: top;" class="table-b1"/>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">cos_one</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">cos(1)</p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">0.5403</p></td>&#13;
<td style="vertical-align: top;" class="table-b"/>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">phi</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">(1 + √5) / 2</p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">1.61803</p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Phidias’ golden ratio φ</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b2"><p class="taba"><span class="literal">ln_phi</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b2"><p class="taba">ln(φ)</p></td>&#13;
<td style="vertical-align: top;" class="table-b2"><p class="taba">0.48121</p></td>&#13;
<td style="vertical-align: top;" class="table-b2"/>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<h4 class="h4" id="ch12lev2sec12"><span epub:type="pagebreak" id="page_396"/><strong><em>Random Numbers</em></strong></h4>&#13;
<p class="indent">In some settings, it’s often necessary to generate random numbers. In scientific computing, you might need to run large numbers of simulations based on random numbers. Such numbers need to emulate draws from random processes with certain characteristics, such as coming from a Poisson or normal distribution. In addition, you usually want these simulations to be repeatable, so the code responsible for generating randomness—the random number engine—should produce the same output given the same input. Such random number engines are sometimes called pseudo-random number engines.</p>&#13;
<p class="indent">In cryptography, you might require random numbers to instead secure information. In such settings, it must be virtually impossible for someone to obtain a similar stream of random numbers; so accidental use of pseudorandom number engines often seriously compromises an otherwise secure&#13;
cryptosystem.</p>&#13;
<p class="indent">For these reasons and others, <em>you should never attempt to build your own random number generator</em>. Building a correct random number generator is surprisingly difficult. It’s too easy to introduce patterns into your random number generator, which can have nasty and hard to diagnose side effects on systems that use your random numbers as input.</p>&#13;
<div class="note">&#13;
<p class="notet"><strong><span class="notes">NOTE</span></strong></p>&#13;
<p class="notep"><em>If you’re interested in random number generation, refer to <a href="ch02.xhtml#ch02">Chapter 2</a> of Stochastic Simulation by Brian D. Ripley for scientific applications and <a href="ch02.xhtml#ch02">Chapter 2</a> of Serious Cryptography by Jean-Philippe Aumasson for cryptographic applications.</em></p>&#13;
</div>&#13;
<p class="indent">If you’re in the market for random numbers, look no further than the Random libraries available in the stdlib in the <span class="literal">&lt;random&gt;</span> header or in Boost in the <span class="literal">&lt;boost/math/...&gt;</span> headers.</p>&#13;
<h5 class="h5" id="ch12lev3sec20"><strong>Random Number Engines</strong></h5>&#13;
<p class="noindent">Random number engines generate random bits. Between Boost and stdlib, there is a dizzying array of candidates. Here’s a general rule: if you need repeatable pseudo-random numbers, consider using the Mersenne Twister engine <span class="literal">std::mtt19937_64</span>. If you need cryptographically secure random numbers, consider using <span class="literal">std::random_device</span>.</p>&#13;
<p class="indent">The Mersenne Twister has some desirable statistical properties for simulations. You provide its constructor with an integer seed value, which completely determines the sequence of random numbers. All random engines are function objects; to obtain a random number, use the function call <span class="literal">operator()</span>. <a href="ch12.xhtml#ch12ex29">Listing 12-29</a> shows how to construct a Mersenne Twister engine with the seed 91586 and invoke the resulting engine three times.</p>&#13;
<pre>#include &lt;random&gt;&#13;
TEST_CASE("mt19937_64 is pseudorandom") {&#13;
  std::mt19937_64 mt_engine{ 91586 }; <span class="ent">➊</span>&#13;
<span epub:type="pagebreak" id="page_397"/>  REQUIRE(mt_engine() == 8346843996631475880); <span class="ent">➋</span>&#13;
  REQUIRE(mt_engine() == 2237671392849523263); <span class="ent">➌</span>&#13;
  REQUIRE(mt_engine() == 7333164488732543658); <span class="ent">➍</span>&#13;
}</pre>&#13;
<p class="listing"><a id="ch12ex29"/><em>Listing 12-29: The <span class="literal">mt19937_64</span> is a pseudo-random number engine.</em></p>&#13;
<p class="indent">Here, you construct an <span class="literal">mt19937_64</span> Mersenne Twister engine with the seed 91586 <span class="ent">➊</span>. Because it’s a pseudo-random engine, you’re guaranteed to get the same sequence of random numbers <span class="ent">➋ ➌ ➍</span> each time. This sequence is determined entirely by the seed.</p>&#13;
<p class="indent"><a href="ch12.xhtml#ch12ex30">Listing 12-30</a> illustrates how to construct a <span class="literal">random_device</span> and invoke it to obtain a cryptographically secure random value.</p>&#13;
<pre>TEST_CASE("std::random_device is invocable") {&#13;
  std::random_device rd_engine{}; <span class="ent">➊</span>&#13;
  REQUIRE_NOTHROW(rd_engine()); <span class="ent">➋</span>&#13;
}</pre>&#13;
<p class="listing"><a id="ch12ex30"/><em>Listing 12-30: The <span class="literal">random_device</span> is a function object.</em></p>&#13;
<p class="indent">You construct a <span class="literal">random_device</span> using the default constructor <span class="ent">➊</span>. The resulting object <span class="literal">rd_engine</span> <span class="ent">➋</span> is invokable, but you should treat the object as opaque. Unlike the Mersenne Twister in <a href="ch12.xhtml#ch12ex29">Listing 12-29</a>, <span class="literal">random_device</span> is unpredictable by design.</p>&#13;
<div class="note">&#13;
<p class="notet"><strong><span class="notes">NOTE</span></strong></p>&#13;
<p class="notep"><em>Because computers are deterministic by design, the <span class="literal">std::random_device</span> cannot make any strong guarantees about cryptographic security.</em></p>&#13;
</div>&#13;
<h5 class="h5" id="ch12lev3sec21"><strong>Random Number Distributions</strong></h5>&#13;
<p class="noindent">A <em>random number distribution</em> is a mathematical function that maps a number to a probability density. Roughly, the idea is that if you take infinite samples from a random variable that has a particular distribution and you plot the relative frequencies of your sample values, that plot would look like the distribution.</p>&#13;
<p class="indent">Distributions break out into two broad categories: <em>discrete</em> and <em>continu</em><em>ous</em>. A simple analogy is that discrete distributions map integral values, and continuous distributions map floating-point values.</p>&#13;
<p class="indent">Most distributions accept customization parameters. For example, the normal distribution is a continuous distribution that accepts two parameters: a mean and a variance. Its density has a familiar bell shape centered around the mean, as shown in <a href="ch12.xhtml#ch12fig01">Figure 12-1</a>. The discrete uniform distribution is a random number distribution that assigns equal probability to the numbers between some minimum and maximum. Its density looks perfectly flat across its range from minimum to maximum, as shown in <a href="ch12.xhtml#ch12fig02">Figure 12-2</a>.</p>&#13;
<div class="image"><img src="../images/fig12_1.jpg" alt="image"/></div>&#13;
<p class="figcap" id="ch12fig01"><em>Figure 12-1: A representation of the normal distribution’s probability density function</em></p>&#13;
<div class="image"><img src="../images/fig12_2.jpg" alt="image"/></div>&#13;
<p class="figcap" id="ch12fig02"><em>Figure 12-2: A representation of the uniform distribution’s probability density function</em></p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_398"/>You can easily generate random numbers from common statistical distributions, such as the uniform and the normal, using the same stdlib Random library. Each distribution accepts some parameters in its constructor, corresponding to the underlying distribution’s parameters. To draw a random variable from the distribution, you use the function call <span class="literal">operator()</span> and pass in an instance of a random number engine, such as a Mersenne Twister.</p>&#13;
<p class="indent">The <span class="literal">std::uniform_int_distribution</span> is a class template available in the <span class="literal">&lt;random&gt;</span> header that takes a single template parameter corresponding to the type you want returned by draws from the distribution, like an <span class="literal">int</span>. You specify the uniform distribution’s minimum and maximum by passing them in as constructor parameters. Each number in the range has equal probability. It’s perhaps the most common distribution to arise in general software engineering contexts.</p>&#13;
<p class="indent"><a href="ch12.xhtml#ch12ex31">Listing 12-31</a> illustrates how to take a million draws from a uniform distribution with a minimum of 1 and a maximum of 10 and compute the sample mean.</p>&#13;
<pre>TEST_CASE("std::uniform_int_distribution produces uniform ints") {&#13;
  std::mt19937_64 mt_engine{ 102787 }; <span class="ent">➊</span>&#13;
  std::uniform_int_distribution&lt;int&gt; int_d{ 0, 10 }; <span class="ent">➋</span>&#13;
  const size_t n{ 1'000'000 }; <span class="ent">➌</span>&#13;
  int sum{}; <span class="ent">➍</span>&#13;
  for (size_t i{}; i &lt; n; i++)&#13;
    sum += int_d(mt_engine); <span class="ent">➎</span>&#13;
  const auto sample_mean = sum / double{ n }; <span class="ent">➏</span>&#13;
  REQUIRE(sample_mean == Approx(5).epsilon(.1)); <span class="ent">➐</span>&#13;
}</pre>&#13;
<p class="listing"><a id="ch12ex31"/><em>Listing 12-31: The <span class="literal">uniform_int_distribution</span> simulates draws from the discrete uniform distribution.</em></p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_399"/>You construct a Mersenne Twister with the seed 102787 <span class="ent">➊</span> and then construct a <span class="literal">uniform_int_distribution</span> with a minimum of 0 and a maximum of 10 <span class="ent">➋</span>. Then you initialize a variable <span class="literal">n</span> to hold the number of iterations <span class="ent">➌</span> and initialize a variable to hold the <span class="literal">sum</span> of all the uniform random variables <span class="ent">➍</span>. In the loop, you draw random variables from the uniform distribution with <span class="literal">operator()</span>, passing in the Mersenne Twister instance <span class="ent">➎</span>.</p>&#13;
<p class="indent">The mean of a discrete uniform distribution is the minimum plus the maximum divided by 2. Here, <span class="literal">int_d</span> has a mean of 5. You can compute a sample mean by dividing <span class="literal">sum</span> by the number of samples <span class="literal">n</span> <span class="ent">➏</span>. With high confidence, you assert that this <span class="literal">sample_mean</span> is approximately 5 <span class="ent">➐</span>.</p>&#13;
<h5 class="h5" id="ch12lev3sec22"><strong>A Partial List of Random Number Distributions</strong></h5>&#13;
<p class="noindent"><a href="ch12.xhtml#ch12tab14">Table 12-14</a> contains a partial list of the random number distributions in <span class="literal">&lt;random&gt;</span>, their default template parameters, and their constructor parameters.</p>&#13;
<p class="tabcap"><a id="ch12tab14"/><strong>Table 12-14:</strong> Random Number Distributions in <span class="literal">&lt;random&gt;</span></p>&#13;
<table class="topbot-d">&#13;
<colgroup>&#13;
<col style="width:40%"/>&#13;
<col style="width:60%"/>&#13;
</colgroup>&#13;
<tbody>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-h"><p class="tab_th"><strong>Distribution</strong></p></td>&#13;
<td style="vertical-align: top;" class="table-h"><p class="tab_th"><strong>Notes</strong></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">uniform_int_distribution&lt;int&gt;{</span> <span class="codestrong">min</span><span class="literal">,</span> <span class="codestrong">max</span> <span class="literal">}</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Discrete uniform distribution with minimum <span class="codestrong">min</span> and maximum <span class="codestrong">max</span>.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">uniform_real_distribution&lt;double&gt;{</span> <span class="codestrong">min</span><span class="literal">,</span> <span class="codestrong">max</span> <span class="literal">}</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">Continuous uniform distribution with minimum <span class="codestrong">min</span> and maximum <span class="codestrong">max</span>.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">normal_distribution&lt;double&gt;{</span> <span class="codestrong">m</span><span class="literal">,</span> <span class="codestrong">s</span> <span class="literal">}</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Normal distribution with mean <span class="codestrong">m</span> and standard deviation <span class="codestrong">s</span>. Commonly used to model the additive product of many independent random variables. Also called the Gaussian distribution.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">lognormal_distribution&lt;double&gt;{</span> <span class="codestrong">m</span><span class="literal">,</span> <span class="codestrong">s</span> <span class="literal">}</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">Log-normal distribution with mean <span class="codestrong">m</span> and standard deviation <span class="codestrong">s</span>. Commonly used to model the multiplicative product of many independent random variables. Also called Galton’s distribution.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">chi_squared_distribution&lt;double&gt;{</span> <span class="codestrong">n</span> <span class="literal">}</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Chi-squared distribution with degrees of freedom <span class="codestrong">n</span>. Commonly used in inferential statistics.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">cauchy_distribution&lt;double&gt;{</span> <span class="codestrong">a</span><span class="literal">,</span> <span class="codestrong">b</span> <span class="literal">}</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">Cauchy distribution with location parameter <span class="codestrong">a</span> and scale parameter <span class="codestrong">b</span>.<br/>Used in physics. Also called the Lorentz distribution.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">fisher_f_distribution&lt;double&gt;{</span> <span class="codestrong">m</span><span class="literal">,</span> <span class="codestrong">n</span> <span class="literal">}</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">F distribution with degrees of freedom <span class="codestrong">m</span> and <span class="codestrong">n</span>. Commonly used in inferential statistics. Also called the Snedecor distribution.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">student_t_distribution&lt;double&gt;{</span> <span class="codestrong">n</span> <span class="literal">}</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">T distribution with degrees of freedom <span class="codestrong">n</span>. Commonly used in inferential statistics. Also called the Student’s T distribution.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span epub:type="pagebreak" id="page_400"/><span class="literal">bernoulli_distribution{</span> <span class="codestrong">p</span> <span class="literal">}</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Bernoulli distribution with success probability <span class="codestrong">p</span>. Commonly used to model the result of a single, Boolean-valued outcome.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">binomial_distribution&lt;int&gt;{</span> <span class="codestrong">n</span><span class="literal">,</span> <span class="codestrong">p</span> <span class="literal">}</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">Binomial distribution with <span class="codestrong">n</span> trials and success probability <span class="codestrong">p</span>. Commonly used to model the number of successes when sampling with replacement in a series of Bernoulli experiments.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">geometric_distribution&lt;int&gt;{</span> <span class="codestrong">p</span> <span class="literal">}</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Geometric distribution with success probability <span class="codestrong">p</span>. Commonly used to model the number of failures occurring before the first success in a series of Bernoulli experiments.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">poisson_distribution&lt;int&gt;{</span> <span class="codestrong">m</span> <span class="literal">}</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">Poisson distribution with mean <span class="codestrong">m</span>. Commonly used to model the number of events occurring in a fixed interval of time.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">exponential_distribution&lt;double&gt;{</span> <span class="codestrong">l</span> <span class="literal">}</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Exponential distribution with mean 1/<span class="codestrong">l</span>, where <span class="codestrong">l</span> is known as the lambda parameter. Commonly used to model the amount of time between events in a Poisson process.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">gamma_distribution&lt;double&gt;{</span> <span class="codestrong">a</span><span class="literal">,</span> <span class="codestrong">b</span> <span class="literal">}</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">Gamma distribution with shape parameter <span class="codestrong">a</span> and scale parameter <span class="codestrong">b</span>. Generalization of the exponential distribution and chi-squared distribution.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">weibull_distribution&lt;double&gt;{</span> <span class="codestrong">k</span><span class="literal">,</span> <span class="codestrong">l</span> <span class="literal">}</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Weibull distribution with shape parameter <span class="codestrong">k</span> and scale parameter <span class="codestrong">l</span>. Commonly used to model time to failure.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b2"><p class="taba"><span class="literal">extreme_value_distribution&lt;double&gt;{</span> <span class="codestrong">a</span><span class="literal">,</span> <span class="codestrong">b</span> <span class="literal"> }</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b2"><p class="taba">Extreme value distribution with location parameter <span class="codestrong">a</span> and scale parameter <span class="codestrong">b</span>. Commonly used to model maxima of independent random variables. Also called the Gumbel type-I distribution.</p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<div class="note">&#13;
<p class="notet"><strong><span class="notes">NOTE</span></strong></p>&#13;
<p class="notep"><em>Boost Math offers more random number distributions in the <span class="literal">&lt;boost/math/...&gt;</span> series of headers, for example, the beta, hypergeometric, logistic, and inverse normal distributions.</em></p>&#13;
</div>&#13;
<h4 class="h4" id="ch12lev2sec13"><strong><em>Numeric Limits</em></strong></h4>&#13;
<p class="noindent">The stdlib offers the class template <span class="literal">std::numeric_limits</span> in the <span class="literal">&lt;limits&gt;</span> header to provide you with compile time information about various <span epub:type="pagebreak" id="page_401"/>properties for arithmetic types. For example, if you want to identify the smallest finite value for a given type <span class="literal">T</span>, you can use the static member function <span class="literal">std::numeric_limits&lt;T&gt;::min()</span> to obtain it.</p>&#13;
<p><a href="ch12.xhtml#ch12ex32">Listing 12-32</a> illustrates how to use <span class="literal">min</span> to facilitate an underflow.</p>&#13;
<pre>#include &lt;limits&gt;&#13;
TEST_CASE("std::numeric_limits::min provides the smallest finite value.") {&#13;
  auto my_cup = std::numeric_limits&lt;int&gt;::min(); <span class="ent">➊</span>&#13;
  auto underfloweth = my_cup - 1; <span class="ent">➋</span>&#13;
  REQUIRE(my_cup &lt; underfloweth); <span class="ent">➌</span>&#13;
}</pre>&#13;
<p class="listing"><a id="ch12ex32"/><em>Listing 12-32: Using <span class="literal">std::numeric_limits&lt;T&gt;::min()</span> to facilitate an <span class="literal">int</span> underflow. Although at press time the major compilers produce code that passes the test, this program contains undefined behavior.</em></p>&#13;
<p class="indent">First, you set the <span class="literal">my_cup</span> variable equal to the smallest possible <span class="literal">int</span> value by using <span class="literal">std::numeric_limits&lt;int&gt;::min()</span> <span class="ent">➊</span>. Next, you intentionally cause an underflow by subtracting 1 from <span class="literal">my_cup</span> <span class="ent">➋</span>. Because <span class="literal">my_cup</span> is the minimum value an <span class="literal">int</span> can take, <span class="literal">my_cup</span> runneth under, as the saying goes. This causes the deranged situation that <span class="literal">underfloweth</span> is greater than <span class="literal">my_cup</span> <span class="ent">➌</span>, even though you initialized <span class="literal">underfloweth</span> by subtracting from <span class="literal">my_cup</span>.</p>&#13;
<div class="note">&#13;
<p class="notet"><strong><span class="notes">NOTE</span></strong></p>&#13;
<p class="notep"><em>Such silent underflows have been the cause of untold numbers of software security vulnerabilities. Don’t rely on this undefined behavior!</em></p>&#13;
</div>&#13;
<p class="indent">Many static member functions and member constants are available on <span class="literal">std::numeric_limits</span>. <a href="ch12.xhtml#ch12tab15">Table 12-15</a> lists some of the most common.</p>&#13;
<p class="tabcap"><a id="ch12tab15"/><strong>Table 12-15:</strong> Some Common Member Constants in <span class="literal">std::numeric_limits</span></p>&#13;
<table class="topbot-d">&#13;
<colgroup>&#13;
<col style="width:40%"/>&#13;
<col style="width:60%"/>&#13;
</colgroup>&#13;
<tbody>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-h"><p class="tab_th">Operation</p></td>&#13;
<td style="vertical-align: top;" class="table-h"><p class="tab_th">Notes</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">numeric_limits&lt;</span><span class="codestrong">T</span><span class="literal">&gt;::is_signed</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">true</span> if <span class="codestrong">T</span> is signed.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">numeric_limits&lt;</span><span class="codestrong">T</span><span class="literal">&gt;::is_integer</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">true</span> if <span class="codestrong">T</span> is an integer.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">numeric_limits&lt;</span><span class="codestrong">T</span><span class="literal">&gt;::has_infinity</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Identifies whether <span class="codestrong">T</span> can encode an infinite value. (Usually, all floating-point types have an infinite value, whereas integral types don’t.)</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">numeric_limits&lt;</span><span class="codestrong">T</span><span class="literal">&gt;::digits10</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">Identifies the number of digits <span class="codestrong">T</span> can represent.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">numeric_limits&lt;</span><span class="codestrong">T</span><span class="literal">&gt;::min()</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Returns the smallest value of <span class="codestrong">T</span>.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b2"><p class="taba"><span class="literal">numeric_limits&lt;</span><span class="codestrong">T</span><span class="literal">&gt;::max()</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b2"><p class="taba">Returns the largest value of <span class="codestrong">T</span>.</p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<div class="note">&#13;
<p class="notet"><strong><span class="notes">NOTE</span></strong></p>&#13;
<p class="notep"><em>Boost Integer provides some additional facilities for introspecting integer types, such as determining the fastest or smallest integer, or the smallest integer with at least <em>N</em> bits.</em></p>&#13;
</div>&#13;
<h4 class="h4" id="ch12lev2sec14"><strong><em>Boost Numeric Conversion</em></strong></h4>&#13;
<p class="noindent">Boost provides the Numeric Conversion library, which contains a collection of tools to convert between numeric objects. The <span class="literal">boost::converter</span> class template in the <span class="literal">&lt;boost/numeric/conversion/converter.hpp&gt;</span> header encapsulates <span epub:type="pagebreak" id="page_402"/>code to perform a specific numeric conversion from one type to another. You must provide two template parameters: the target type <span class="literal">T</span> and the source type <span class="codestrong">S</span>. You can specify a numeric converter that takes a <span class="literal">double</span> and converts it to an <span class="literal">int</span> with the simple type alias <span class="literal">double_to_int</span>:</p>&#13;
<pre>#include &lt;boost/numeric/conversion/converter.hpp&gt;&#13;
using double_to_int = boost::numeric::converter&lt;int<span class="ent">➊</span>, double<span class="ent">➋</span>&gt;;</pre>&#13;
<p class="indent">To convert with your new type alias <span class="literal">double_to_int</span>, you have several options. First, you can use its static method <span class="literal">convert</span>, which accepts a <span class="literal">double</span> <span class="ent">➋</span> and returns an <span class="literal">int</span> <span class="ent">➊</span>, as <a href="ch12.xhtml#ch12ex33">Listing 12-33</a> illustrates.</p>&#13;
<pre>TEST_CASE("boost::converter offers the static method convert") {&#13;
  REQUIRE(double_to_int::convert(3.14159) == 3);&#13;
}</pre>&#13;
<p class="listing"><a id="ch12ex33"/><em>Listing 12-33: The <span class="literal">boost::converter</span> offers the static method <span class="literal">convert</span>.</em></p>&#13;
<p class="indent">Here, you simply invoke the <span class="literal">convert</span> method with the value 3.14159, which <span class="literal">boost::convert</span> converts to 3.</p>&#13;
<p class="indent">Because <span class="literal">boost::convert</span> provides the function call <span class="literal">operator()</span>, you can construct a function object <span class="literal">double_to_int</span> and use it to convert, as in <a href="ch12.xhtml#ch12ex34">Listing 12-34</a>.</p>&#13;
<pre>TEST_CASE("boost::numeric::converter implements operator()") {&#13;
  double_to_int dti; <span class="ent">➊</span>&#13;
  REQUIRE(dti(3.14159) == 3); <span class="ent">➋</span>&#13;
  REQUIRE(double_to_int{}(3.14159) == 3); <span class="ent">➌</span>&#13;
}</pre>&#13;
<p class="listing"><a id="ch12ex34"/><em>Listing 12-34: The <span class="literal">boost::converter</span> implements <span class="literal">operator()</span>.</em></p>&#13;
<p class="indent">You construct a <span class="literal">double_to_int</span> function object called <span class="literal">dti</span> <span class="ent">➊</span>, which you invoke with the same argument, 3.14159 <span class="ent">➋</span>, as in <a href="ch12.xhtml#ch12ex33">Listing 12-33</a>. The result is the same. You also have the option of constructing a temporary function object and using <span class="literal">operator()</span> directly, which yields identical results <span class="ent">➌</span>.</p>&#13;
<p class="indent">A major advantage of using <span class="literal">boost::converter</span> instead of alternatives like <span class="literal">static_cast</span> is runtime bounds checking. If a conversion would cause an overflow, <span class="literal">boost::converter</span> will throw a <span class="literal">boost::numeric::positive_overflow</span> or <span class="literal">boost::numeric::negative_overflow</span>. <a href="ch12.xhtml#ch12ex35">Listing 12-35</a> illustrates this behavior when you attempt to convert a very large <span class="literal">double</span> into an <span class="literal">int</span>.</p>&#13;
<pre>#include &lt;limits&gt;&#13;
TEST_CASE("boost::numeric::converter checks for overflow") {&#13;
  auto yuge = std::numeric_limits&lt;double&gt;::max(); <span class="ent">➊</span>&#13;
  double_to_int dti; <span class="ent">➋</span>&#13;
  REQUIRE_THROWS_AS(dti(yuge)<span class="ent">➌</span>, boost::numeric::positive_overflow<span class="ent">➍</span>);&#13;
}</pre>&#13;
<p class="listing"><a id="ch12ex35"/><em>Listing 12-35: The <span class="literal">boost::converter</span> checks for overflow.</em></p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_403"/>You use <span class="literal">numeric_limits</span> to obtain a <span class="literal">yuge</span> value <span class="ent">➊</span>. You construct a <span class="literal">double _</span><span class="literal">to_int</span> converter <span class="ent">➋</span>, which you use to attempt a conversion of <span class="literal">yuge</span> to an <span class="literal">int</span> <span class="ent">➌</span>. This throws a <span class="literal">positive_overflow</span> exception because the value is too large to store <span class="ent">➍</span>.</p>&#13;
<p class="indent">It’s possible to customize the conversion behavior of <span class="literal">boost::converter</span> using template parameters. For example, you can customize the overflow handling to throw a custom exception or perform some other operation. You can also customize rounding behavior so that rather than truncating off the decimal from a floating-point value, you perform custom rounding. See the Boost Numeric Conversion documentation for details.</p>&#13;
<p class="indent">If you’re happy with the default <span class="literal">boost::converter</span> behavior, you can use the <span class="literal">boost::numeric_cast</span> function template as a shortcut. This function template accepts a single template parameter corresponding to the target type of the conversion and a single argument corresponding to the source number. <a href="ch12.xhtml#ch12ex36">Listing 12-36</a> provides an update to <a href="ch12.xhtml#ch12ex35">Listing 12-35</a> that uses <span class="literal">boost::numeric_cast</span> instead.</p>&#13;
<pre>#include &lt;limits&gt;&#13;
#include &lt;boost/numeric/conversion/cast.hpp&gt;&#13;
&#13;
TEST_CASE("boost::boost::numeric_cast checks overflow") {&#13;
  auto yuge = std::numeric_limits&lt;double&gt;::max(); <span class="ent">➊</span>&#13;
  REQUIRE_THROWS_AS(boost::numeric_cast&lt;int&gt;(yuge), <span class="ent">➋</span>&#13;
                    boost::numeric::positive_overflow <span class="ent">➌</span>);&#13;
}</pre>&#13;
<p class="listing"><a id="ch12ex36"/><em>Listing 12-36: The <span class="literal">boost::numeric_cast</span> function template also performs runtime bounds checking.</em></p>&#13;
<p class="indent">As before, you use <span class="literal">numeric_limits</span> to obtain a <span class="literal">yuge</span> value <span class="ent">➊</span>. When you try to <span class="literal">numeric_cast</span> <span class="literal">yuge</span> into an <span class="literal">int</span> <span class="ent">➋</span>, you get a <span class="literal">positive_overflow</span> exception because the value is too large to store <span class="ent">➌</span>.</p>&#13;
<div class="note">&#13;
<p class="notet"><strong><span class="notes">NOTE</span></strong></p>&#13;
<p class="notep"><em>The <span class="literal">boost::numeric_cast</span> function template is a suitable replacement for the <span class="literal">narrow_cast</span> you hand-rolled in <a href="ch06.xhtml#ch06ex06">Listing 6-6</a> on <a href="ch06.xhtml#page_154">page 154</a>.</em></p>&#13;
</div>&#13;
<h4 class="h4" id="ch12lev2sec15"><strong><em>Compile-Time Rational Arithmetic</em></strong></h4>&#13;
<p class="noindent">The stdlib <span class="literal">std::ratio</span> in the <span class="literal">&lt;ratio&gt;</span> header is a class template that enables you to compute rational arithmetic at compile time. You provide two template parameters to <span class="literal">std::ratio</span>: a numerator and a denominator. This defines a new type that you can use to compute rational expressions.</p>&#13;
<p class="indent">The way you perform compile-time computation with <span class="literal">std::ratio</span> is by using template metaprogramming techniques. For example, to multiply two <span class="literal">ratio</span> types, you can use the <span class="literal">std::ratio_multiply</span> type, which takes the two <span class="literal">ratio</span> types as template parameters. You can extract the numerator and denominator of the result using static member variables on the resulting type.</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_404"/><a href="ch12.xhtml#ch12ex37">Listing 12-37</a> illustrates how to multiply 10 by 2/3 at compile time.</p>&#13;
<pre>#include &lt;ratio&gt;&#13;
&#13;
TEST_CASE("std::ratio") {&#13;
  using ten = std::ratio&lt;10, 1&gt;; <span class="ent">➊</span>&#13;
  using two_thirds = std::ratio&lt;2, 3&gt;; <span class="ent">➋</span>&#13;
  using result = std::ratio_multiply&lt;ten, two_thirds&gt;; <span class="ent">➌</span>&#13;
  REQUIRE(result::num == 20); <span class="ent">➍</span>&#13;
  REQUIRE(result::den == 3); <span class="ent">➎</span>&#13;
}</pre>&#13;
<p class="listing"><a id="ch12ex37"/><em>Listing 12-37: Compile time rational arithmetic with <span class="literal">std::ratio</span></em></p>&#13;
<p class="indent">You declare the <span class="literal">std::ratio</span> types <span class="literal">ten</span> <span class="ent">➊</span> and <span class="literal">two_thirds</span> <span class="ent">➋</span> as type aliases. To compute the product of <span class="literal">ten</span> and <span class="literal">two_thirds</span>, you again declare another type, <span class="literal">result</span>, using the <span class="literal">std::ratio_multiply</span> template <span class="ent">➌</span>. Using the static members <span class="literal">num</span> and <span class="literal">den</span>, you can extract the result, 20/3 <span class="ent">➍ ➎</span>.</p>&#13;
<p class="indent">Of course, it’s always better to do computation at compile time rather than at runtime when you can. Your programs will be more efficient because they’ll need to do less computation when they run.</p>&#13;
<h5 class="h5" id="ch12lev3sec23"><strong>A Partial List of Random Number Distributions</strong></h5>&#13;
<p class="noindent"><a href="ch12.xhtml#ch12tab16">Table 12-16</a> contains a partial list of the operations provided by stdlib’s <span class="literal">&lt;ratio&gt;</span> library.</p>&#13;
<p class="tabcap"><a id="ch12tab16"/><strong>Table 12-16:</strong> A Partial List of Operations Available in <span class="literal">&lt;ratio&gt;</span></p>&#13;
<table class="topbot-d">&#13;
<colgroup>&#13;
<col style="width:40%"/>&#13;
<col style="width:60%"/>&#13;
</colgroup>&#13;
<tbody>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-h"><p class="tab_th">Distribution</p></td>&#13;
<td style="vertical-align: top;" class="table-h"><p class="tab_th">Notes</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">ratio_add&lt;</span><span class="codestrong">r1</span><span class="literal">,</span> <span class="codestrong">r2</span><span class="literal">&gt;</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Adds <span class="codestrong">r1</span> and <span class="codestrong">r2</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">ratio_subtract&lt;</span><span class="codestrong">r1</span><span class="literal">,</span> <span class="codestrong">r2</span><span class="literal">&gt;</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">Subtracts <span class="codestrong">r2</span> from <span class="codestrong">r1</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">ratio_multiply&lt;</span><span class="codestrong">r1</span><span class="literal">,</span> <span class="codestrong">r2</span><span class="literal">&gt;</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Multiplies <span class="codestrong">r1</span> and <span class="codestrong">r2</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">ratio_divide&lt;</span><span class="codestrong">r1</span><span class="literal">,</span> <span class="codestrong">r2</span><span class="literal">&gt;</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">Divides <span class="codestrong">r1</span> by <span class="codestrong">r2</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">ratio_equal&lt;</span><span class="codestrong">r1</span><span class="literal">,</span> <span class="codestrong">r2</span><span class="literal">&gt;</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Tests whether <span class="codestrong">r1</span> equals <span class="codestrong">r2</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">ratio_not_equal&lt;</span><span class="codestrong">r1</span><span class="literal">,</span> <span class="codestrong">r2</span><span class="literal">&gt;</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">Tests whether <span class="codestrong">r1</span> is not equal to <span class="codestrong">r2</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">ratio_less&lt;</span><span class="codestrong">r1</span><span class="literal">,</span> <span class="codestrong">r2</span><span class="literal">&gt;</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Tests whether <span class="codestrong">r1</span> is less than <span class="codestrong">r2</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">ratio_greater&lt;</span><span class="codestrong">r1</span><span class="literal">,</span> <span class="codestrong">r2</span><span class="literal">&gt;</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">Tests whether <span class="codestrong">r1</span> is greater than <span class="codestrong">r2</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">ratio_less_equal&lt;</span><span class="codestrong">r1</span><span class="literal">,</span> <span class="codestrong">r2</span><span class="literal">&gt;</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Tests whether <span class="codestrong">r1</span> is less than or equal to <span class="codestrong">r2</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">ratio_greater_equal&lt;</span><span class="codestrong">r1</span><span class="literal">,</span> <span class="codestrong">r2</span><span class="literal">&gt;</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">Tests whether <span class="codestrong">r1</span> is greater than or equal to <span class="codestrong">r2</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">micro</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Literal: <span class="literal">ratio&lt;1, 1000000&gt;</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">milli</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">Literal: <span class="literal">ratio&lt;1, 1000&gt;</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">centi</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Literal: <span class="literal">ratio&lt;1, 100&gt;</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">deci</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">Literal: <span class="literal">ratio&lt;1, 10&gt;</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">deca</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Literal: <span class="literal">ratio&lt;10, 1&gt;</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span epub:type="pagebreak" id="page_405"/><span class="literal">hecto</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">Literal: <span class="literal">ratio&lt;100, 1&gt;</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba"><span class="literal">kilo</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b1"><p class="taba">Literal: <span class="literal">ratio&lt;1000, 1&gt;</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">mega</span></p></td>&#13;
<td style="vertical-align: top;" class="table-b"><p class="taba">Literal: <span class="literal">ratio&lt;1000000, 1&gt;</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-ba"><p class="taba"><span class="literal">giga</span></p></td>&#13;
<td style="vertical-align: top;" class="table-ba"><p class="taba">Literal: <span class="literal">ratio&lt;1000000000, 1&gt;</span></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<h3 class="h3" id="ch12lev1sec5"><strong>Summary</strong></h3>&#13;
<p class="indent">In this chapter, you examined a potpourri of small, simple, focused utilities that service common programming needs. Data structures, such as <span class="literal">tribool</span>, <span class="literal">optional</span>, <span class="literal">pair</span>, <span class="literal">tuple</span>, <span class="literal">any</span>, and <span class="literal">variant</span> handle many commonplace scenarios in which you need to contain objects within a common structure. In the coming chapters, a few of these data structures will make repeat appearances throughout the stdlib. You also learned about date/time and numerics/math facilities. These libraries implement very specific functionality, but when you have such requirements, these libraries are invaluable.</p>&#13;
<div class="box5" id="bm01">&#13;
<p class="boxtitle-d"><strong>EXERCISES</strong></p>&#13;
<p class="noindent"><strong>12-1.</strong> Reimplement the <span class="literal">narrow_cast</span> in <a href="ch06.xhtml#ch06ex06">Listing 6-6</a> to return a <span class="literal">std::optional</span>. If the cast would result in a narrowing conversion, return an empty optional rather than throwing an exception. Write a unit test that ensures your solution works.</p>&#13;
<p class="noindent"><strong>12-2.</strong> Implement a program that generates random alphanumeric passwords and writes them to the console. You can store the alphabet of possible characters into a <span class="literal">char[]</span> and use the discrete uniform distribution with a minimum of zero and a maximum of the last index of your alphabet array. Use a cryptographically secure random number engine.</p>&#13;
</div>&#13;
<div class="box6" id="bm02">&#13;
<p class="boxtitle-d"><strong>FURTHER READING</strong></p>&#13;
<ul>&#13;
<li class="noindent"><em>ISO International Standard ISO/IEC (2017) — Programming Language C++</em> (International Organization for Standardization; Geneva, Switzerland; <em><a href="https://isocpp.org/std/the-standard/">https://isocpp.org/std/the-standard/</a></em>)</li>&#13;
<li class="noindent"><em>The Boost C++ Libraries</em>, 2nd Edition, by Boris Schäling (XML Press, 2014)</li>&#13;
<li class="noindent"><em>The C++ Standard Library: A Tutorial and Reference</em>, 2nd Edition, by Nicolai M. Josuttis (Addison-Wesley Professional, 2012)</li>&#13;
</ul>&#13;
</div>&#13;
</body></html>