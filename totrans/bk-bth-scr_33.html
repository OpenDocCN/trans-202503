<html><head></head><body>
<div id="sbo-rt-content" class="calibre1"><section aria-labelledby="ch30" epub:type="chapter" role="doc-chapter">
<hgroup>
<h2 class="title" id="ch30">
<span class="cn"><span aria-label=" Page 363. " epub:type="pagebreak" id="pg_363" role="doc-pagebreak" class="calibre2"/><span class="sans_dogma_ot_bold_b_">30</span></span>
<span class="ct1"><span class="sans_dogma_ot_bold_b_">ODDS AND ENDS</span></span>
</h2>
</hgroup>
<figure class="opener"><img alt="" class="opener1" height="407" src="../images/chapter.jpg" width="408"/>
</figure>
<p class="chapterintro">Throughout this book, I’ve endeavored to write short, concise chapters about pointed topics, while introducing a few related commands along the way. In this chapter, I’ll discuss a few interesting topics that couldn’t find a home in any of the other chapters and were too short to constitute chapters of their own, but these topics are no less important or helpful than the others.</p>
<p class="tx">With these odds and ends, you’ll learn how to sort files and interrogate the registry for useful information. You’ll also learn how to retrieve and set the attributes of files and directories, and I’ll discuss bit manipulation to round out the book’s coverage of Batch arithmetic.</p>
<section aria-labelledby="sec1" epub:type="division">
<h3 class="h" id="sec1"><span id="h1-196"/><span aria-label=" Page 364. " epub:type="pagebreak" id="pg_364" role="doc-pagebreak"/><span class="sans_futura_std_bold_b_">Sorting Files</span></h3>
<p class="tni">The <span class="sans_thesansmonocd_w5regular_">sort</span> command does exactly what you would likely expect it to do; it sorts input files into output files. To demonstrate, consider a small file containing the names of the first eight future captains of the starship <i class="calibre6">Enterprise</i>, listed in the order in which they’ll serve in the post. The first 15 bytes contain a first name, followed by one byte for a middle initial (if they use a middle initial, and only one does). The last name starts in byte 17 and may or may not be followed by a few trailing spaces:</p>
<pre class="pre"><code class="calibre11">Jonathan        Archer
Robert          April
Christopher     Pike
James          TKirk
Willard         Decker
John            Harriman
Rachel          Garrett
Jean-Luc        Picard
</code></pre>
<p class="tx">(<i class="calibre6">Star Trek</i> is famous for its alternate universes and timelines, but this is the list for <i class="calibre6">our</i> universe with one significant omission. Spock, or Mr. Spock, was left off the list for two reasons. First and foremost, he has only one name, which is neither a first nor a last name, but sometimes treated as either, hopelessly complicating the format of the data file. Second, he was captain for only about three minutes of screen time at the beginning of <i class="calibre6">Star Trek II: The Wrath of Khan</i>. As seriously as I take getting every fact about Batch as accurate as possible, I also strive to stay true to the <i class="calibre6">Star Trek</i> canon.)</p>
<p class="tx">The following command accepts the file as its first argument, and the <span class="sans_thesansmonocd_w5regular_">/O</span> option precedes and defines the <i class="calibre6">output</i> file that follows it:</p>
<pre class="pre"><code class="calibre11">sort C:\Batch\Captains.txt /O C:\Batch\SortedByName.txt</code></pre>
<p class="tx">The command very easily sorts the small input file into an output file of the same size. Here’s the complete contents of the <i class="calibre6">SortedByName.txt</i> file following the execution of the prior command:</p>
<pre class="pre"><code class="calibre11">Christopher    Pike
James        TKirk
Jean-Luc        Picard
John            Harriman
Jonathan        Archer
Rachel          Garrett
Robert          April
Willard         Decker
</code></pre>
<p class="tx">The captains are sorted by their first names, because the <span class="sans_thesansmonocd_w5regular_">sort</span> command starts sorting at the first byte of the record by default. If two captains had shared the same first name, they would have been sorted on middle initials and finally on last names, but we can alter the initial character of the sort <span aria-label=" Page 365. " epub:type="pagebreak" id="pg_365" role="doc-pagebreak"/>easily with the <span class="sans_thesansmonocd_w5regular_">/+</span> option. The following command starts sorting in byte 17 where the last name starts:</p>
<pre class="pre"><code class="calibre11">sort C:\Batch\Captains.txt /O C:\Batch\SortedByLastName.txt /+17</code></pre>
<p class="tx">The <i class="calibre6">SortedByLastName.txt</i> file is sorted by last name, as its name more than suggests:</p>
<pre class="pre"><code class="calibre11">Robert          April
Jonathan        Archer
Willard         Decker
Rachel          Garrett
John            Harriman
James          TKirk
Jean-Luc        Picard
Christopher     Pike
</code></pre>
<p class="tx">The command has a few other useful options for customizing sorts. The <span class="sans_thesansmonocd_w5regular_">/R</span> option <i class="calibre6">reverses</i> the order of the sort, so <span class="sans_thesansmonocd_w5regular_">Pike</span> would have come first and <span class="sans_thesansmonocd_w5regular_">April</span> last if you had added <span class="sans_thesansmonocd_w5regular_">/R</span> to the last command. The <span class="sans_thesansmonocd_w5regular_">/UNIQ</span> option writes out only <i class="calibre6">unique</i> lines, which is another way of saying that it drops duplicate records. If some records in the input file might exceed the default maximum length of 4,096 bytes, use <span class="sans_thesansmonocd_w5regular_">/REC</span> to define a different maximum <i class="calibre6">record</i> length up to 65,535 bytes.</p>
<blockquote class="calibre8">
<p class="warning"><span class="sans_dogma_ot_bold_b_1">NOTE</span></p>
</blockquote>
<p class="warning-txt"><i class="calibre6">I must state my displeasure with any option, parameter, or setting denoted by a single letter O; users will invariably enter a zero by mistake. After a blunder in my coding youth, I stay away from this and other ambiguous characters (I and l), but unfortunately, this is what we have with the sort command.</i></p>
<p class="tx">The performance of the <span class="sans_thesansmonocd_w5regular_">sort</span> command is far from great on large files, and you can’t define multiple sort fields, but the command offers an easy way to perform simple sorts on small-to-medium-sized files.</p>
<p class="tx">Commercially available sort utilities are much faster and offer far more functionality than the <span class="sans_thesansmonocd_w5regular_">sort</span> command. With a little effort, you can set up a bat file to execute one or the other depending on whether a utility is registered on a machine. For instance, the bat file can execute a commercial sort utility, such as Syncsort, if it exists; if not, it will execute the slower but still functional <span class="sans_thesansmonocd_w5regular_">sort</span> command. In this way, you’ll reap the benefits of the faster sort utility on the machines where it’s registered, but the primary challenge in this plan is determining whether the utility is installed and registered on a particular machine. Conveniently, this leads directly to our next topic.</p>
</section>
<section aria-labelledby="sec2" epub:type="division">
<h3 class="h" id="sec2"><span id="h1-197"/><span class="sans_futura_std_bold_b_">The Windows Registry</span></h3>
<p class="tni">The Windows Registry is a hierarchical database storing configuration settings and options for the operating system and all installed applications. It’s structured similarly to Windows itself with what looks like a folder <span aria-label=" Page 366. " epub:type="pagebreak" id="pg_366" role="doc-pagebreak"/>structure, but each apparent folder is really a registry key one or more levels beneath a root key or hive.</p>
<p class="tx">If an application is installed on a particular computer, you can find information about that application in the registry. The existence or lack of that information on other machines indicates whether the application is installed on that particular computer, and we can determine this with a few lines of Batch code.</p>
<p class="tx">For instance, if Syncsort is installed on a Windows computer, it has a registry key in the registry, and eventually we’ll interrogate the registry for that key associated with the application with some Batch code. If we find it, Syncsort is installed; if we don’t find it, it isn’t installed. But before we can use that logic, we need to know the registry key associated with the application. The best way to find the key is to look for it in the registry of a computer where you know the software (in this example, Syncsort) is installed.</p>
<section aria-labelledby="sec3" epub:type="division">
<h4 class="h1" id="sec3"><span id="h2-106"/><span class="sans_futura_std_heavy_oblique_bi_">Exploring the Registry</span></h4>
<p class="tni">The <span class="sans_thesansmonocd_w5regular_">regedit</span> command, which stands for <i class="calibre6">Registry Editor</i>, offers a portal into the registry that looks a bit like Windows Explorer. At the command prompt, enter the following and press <small class="calibre5">ENTER</small>:</p>
<pre class="pre"><code class="calibre11"><b class="calibre10">regedit</b></code></pre>
<p class="tni">The Registry Editor should open.</p>
<p class="warning"><span class="sans_dogma_ot_bold_b_1">WARNING</span></p>
<p class="warning-txt"><i class="calibre6">On second thought, hold off a minute. When first using this editor, I felt as though I had stumbled into a secret room behind a trapdoor in an old mansion, but the potential to do some damage exists. There’s no need to be paralyzed with fear, but unless you have a deep understanding of the registry, don’t delete or modify anything from inside the Registry Editor. Caution is a must, but investigating the registry can be illuminating even if much of the data is cryptic.</i></p>
<p class="tx">All of the software loaded onto a computer is in the registry under <i class="calibre6">HKEY_LOCAL_MACHINE\SOFTWARE</i>, so this is the first place to look for an application. If one of the many keys under the <i class="calibre6">SOFTWARE</i> key isn’t obviously for the product in question, you can also right-click the <i class="calibre6">HKEY _LOCAL_MACHINE</i> root key or hive, select <b class="calibre10">FIND</b>, enter the application name or any other search string, and press <small class="calibre5">ENTER</small>. The first key to match the string appears, and pressing <small class="calibre5">F3</small> takes you to the next matching key.</p>
<p class="tx">For the sake of this demonstration, assume that we find the following registry key for the application in question:</p>
<pre class="pre"><code class="calibre11">HKEY_LOCAL_MACHINE\SOFTWARE\Syncsort</code></pre>
<p class="tx"><span aria-label=" Page 367. " epub:type="pagebreak" id="pg_367" role="doc-pagebreak"/>The <span class="sans_thesansmonocd_w5regular_">regedit</span> command is one of the few commands you’ll find in this book that’s used almost exclusively at the command prompt and is of little use inside a bat file. If you were to use it in a bat file, it would simply open the Registry Editor and pause the execution of the bat file until a human closes the Editor. But with this command and a little work, we now have the registry key. What we need next is some Batch code that can determine whether this key exists in the registry of other computers.</p>
</section>
<section aria-labelledby="sec4" epub:type="division">
<h4 class="h1" id="sec4"><span id="h2-107"/><span class="sans_futura_std_heavy_oblique_bi_">Querying the Registry</span></h4>
<p class="tni">The solution to this challenge is the <span class="sans_thesansmonocd_w5regular_">reg</span> command, which simply stands for <i class="calibre6">registry</i>. From a bat file, the <span class="sans_thesansmonocd_w5regular_">reg</span> command can do quite a bit of damage in the registry in its own right. If you go to the <span class="sans_thesansmonocd_w5regular_">help</span> for this command, you’ll see that it sports several operations that can manipulate the registry, including <span class="sans_thesansmonocd_w5regular_">add</span>, <span class="sans_thesansmonocd_w5regular_">delete</span>, <span class="sans_thesansmonocd_w5regular_">copy</span>, and <span class="sans_thesansmonocd_w5regular_">import</span>, that someone with ill intent could easily exploit to build a bat virus. It’s important to know that these commands exist but use them only if you truly and fully understand the registry and any possible impacts of your actions. I’ll be strictly focusing on reading from or querying the registry—that is, performing the <span class="sans_thesansmonocd_w5regular_">query</span> operation of the <span class="sans_thesansmonocd_w5regular_">reg</span> command.</p>
<p class="tx">The most basic <span class="sans_thesansmonocd_w5regular_">reg query</span> command accepts a possible registry key as an argument. Conveniently, Batch allows us to abbreviate the <span class="sans_thesansmonocd_w5regular_">HKEY_LOCAL_MACHINE</span> root key as <span class="sans_thesansmonocd_w5regular_">HKLM</span>. This command is looking for Syncsort in the registry:</p>
<pre class="pre"><code class="calibre11">reg query "HKLM\SOFTWARE\Syncsort"</code></pre>
<p class="tx">This command returns a list of the argument’s registry key values and other registry keys immediately subordinate to it. More important for our purposes, if this command finds the argument key in the registry, it sets <span class="sans_thesansmonocd_w5regular_">errorlevel</span> to <span class="sans_thesansmonocd_w5regular_">0</span>; if it doesn’t find it, the value returned is <span class="sans_thesansmonocd_w5regular_">1</span>. With this in mind, consider this code using the same command with conditional execution to set a boolean:</p>
<pre class="pre"><code class="calibre11">reg query "HKLM\SOFTWARE\Syncsort" &amp;&amp; (
   set bSyncsort=true==true
) || (
   set bSyncsort=false==x
)
</code></pre>
<p class="tni">After this executes, you can reference the boolean elsewhere in the process flow to determine whether the particular application is installed and available.</p>
<p class="tx">We can also interrogate the registry for other types of information. For instance, the following command uses the <span class="sans_thesansmonocd_w5regular_">/V</span> option to look for one specific registry key <i class="calibre6">value</i>, <span class="sans_thesansmonocd_w5regular_">ProductName</span>, of the current version of Windows:</p>
<pre class="pre"><code class="calibre11">reg query "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion" /V ProductName</code></pre>
<p class="tx"><span aria-label=" Page 368. " epub:type="pagebreak" id="pg_368" role="doc-pagebreak"/>Without the <span class="sans_thesansmonocd_w5regular_">/V</span> option, the command will likely write many key values and subordinate keys to stdout, but with this option in place, it writes precisely two lines of output if it finds the key value. One example might be:</p>
<pre class="pre"><code class="calibre11">HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion
    ProductName    REG_SZ    Windows 10 Home
</code></pre>
<p class="tni">The registry key in the argument is the first line of output, and the desired information about the <span class="sans_thesansmonocd_w5regular_">ProductName</span> is contained in the second.</p>
<p class="tx">The following <span class="sans_thesansmonocd_w5regular_">for /F</span> command nicely parses out the Windows version and assigns it to a variable:</p>
<pre class="pre"><code class="calibre11">set key=HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion
for /F "usebackq tokens=1,2*" %%i in (`reg query "%key%" /V ProductName`) do (
   if /i "%%i" equ "ProductName" (
      set winVersion=%%k
)  )
</code></pre>
<p class="tx">Since the <span class="sans_thesansmonocd_w5regular_">for /F</span> command processes two lines of text and we care only about the second, the <span class="sans_thesansmonocd_w5regular_">if</span> command isolates just the line containing <span class="sans_thesansmonocd_w5regular_">ProductName</span> as the first token. (We also could have ignored the first line with the <span class="sans_thesansmonocd_w5regular_">skip=1</span> clause from <span class="xref"><a href="chapter19.xhtml" class="calibre3">Chapter 19</a></span>.)</p>
<p class="tx">Because of the asterisk in the <span class="sans_thesansmonocd_w5regular_">tokens</span> clause, the third token, <span class="sans_thesansmonocd_w5regular_">%%k</span>, contains everything, including embedded spaces, after the unused and discarded second token. Thus, the value of <span class="sans_thesansmonocd_w5regular_">winVersion</span> becomes <span class="sans_thesansmonocd_w5regular_">Windows 10 Home</span>. If you were to run this on a different machine, this code might assign <span class="sans_thesansmonocd_w5regular_">Windows 7 Enterprise</span> to the variable.</p>
<p class="tx">Much more can and has been written about the registry. I’ve just touched on it here from the perspective of Batch to show how you can safely interrogate it for some very useful information. The <span class="sans_thesansmonocd_w5regular_">help</span> for the <span class="sans_thesansmonocd_w5regular_">reg</span> command provides far more information for the curious.</p>
</section>
</section>
<section aria-labelledby="sec5" epub:type="division">
<h3 class="h" id="sec5"><span id="h1-198"/><span class="sans_futura_std_bold_b_">File Attributes</span></h3>
<p class="tni">Just as you can use the <span class="sans_thesansmonocd_w5regular_">reg</span> command for evil as well as good, you can do the same with another interesting command, the <span class="sans_thesansmonocd_w5regular_">attrib</span> command. Its name is short for <i class="calibre6">attribute</i>, and it both retrieves and assigns file and directory attributes. Ne’er-do-wells can use this command to create and hide malignant files on a computer for any number of nefarious purposes, although such actions do violate the Batch coders’ oath to use their powers only for good.</p>
<section aria-labelledby="sec6" epub:type="division">
<h4 class="h1" id="sec6"><span id="h2-108"/><span class="sans_futura_std_heavy_oblique_bi_">Retrieving Attributes</span></h4>
<p class="tni">If the command’s only argument is a file, it returns the file’s attributes. Consider this:</p>
<pre class="pre"><code class="calibre11">attrib C:\Batch\SomeFile.txt</code></pre>
<p class="tx"><span aria-label=" Page 369. " epub:type="pagebreak" id="pg_369" role="doc-pagebreak"/>This command writes the following result to stdout if the file is, from left to right, ready to archive (<span class="sans_thesansmonocd_w5regular_">A</span>, byte 1), a system file (<span class="sans_thesansmonocd_w5regular_">S</span>, byte 4), hidden (<span class="sans_thesansmonocd_w5regular_">H</span>, byte 5), and read-only (<span class="sans_thesansmonocd_w5regular_">R</span>, byte 6):</p>
<pre class="pre"><code class="calibre11">A  SHR                C:\Batch\SomeFile.txt</code></pre>
<p class="tni">The second and third bytes are always blank.</p>
<p class="tx">Each position in the string represents a predefined attribute. For instance, the value of <span class="sans_thesansmonocd_w5regular_">H</span> in the fifth byte means that the file is hidden or that you can’t see it in Windows Explorer, at least by default. In contrast, a space in that position means that the file isn’t hidden.</p>
<p class="tx">To determine whether a particular file is read-only, the following <span class="sans_thesansmonocd_w5regular_">for /F</span> command uses the <span class="sans_thesansmonocd_w5regular_">attrib</span> command as its input:</p>
<pre class="pre"><code class="calibre11">for /F "usebackq tokens=*" %%a in (`attrib C:\Batch\SomeFile.txt`) do (
   set attrs=%%a
   if "!attrs:~5,1!" equ "R" (
      set bReadOnly=true==true
   ) else (
      set bReadOnly=false==x
)  )
</code></pre>
<p class="tni">The logic in the code block sets the <span class="sans_thesansmonocd_w5regular_">bReadOnly</span> boolean to true or false based on the existence or nonexistence of the file attribute associated with the sixth byte.</p>
<p class="tx">A file mask with wildcards can return results for multiple files. The <span class="sans_thesansmonocd_w5regular_">/S</span> option matches the filename or mask on all files in the directory and all of its subdirectories, giving the results for each. Also, the <span class="sans_thesansmonocd_w5regular_">/D</span> option handles directory attributes in lieu of the attributes of a file.</p>
</section>
<section aria-labelledby="sec7" epub:type="division">
<h4 class="h1" id="sec7"><span id="h2-109"/><span class="sans_futura_std_heavy_oblique_bi_">Setting Attributes</span></h4>
<p class="tni">The command’s real power comes in its ability to reset attributes. A negative sign in front of the attribute character turns the attribute off, and a plus sign turns it on. For instance, the following command ensures that the file isn’t a system file (<span class="sans_thesansmonocd_w5regular_">-S</span>) and not a hidden file (<span class="sans_thesansmonocd_w5regular_">-H</span>), while also being read-only (<span class="sans_thesansmonocd_w5regular_">+R</span>):</p>
<pre class="pre"><code class="calibre11">attrib -S -H +R C:\Batch\SomeFile.txt</code></pre>
<p class="tx">This can be very useful. If you create a Batch process that creates or modifies a file where users might have access to it and if those users are not to be trusted with the file, you can protect and hide it when not in use with the <span class="sans_thesansmonocd_w5regular_">attrib</span> command. To make the file accessible, run the command with the <span class="sans_thesansmonocd_w5regular_">-H -R</span> argument string just before updating the file, followed by another command with the <span class="sans_thesansmonocd_w5regular_">+H +R</span> argument string after the update, thus leaving the file hidden and read-only until the code needs it again. It’s the digital equivalent of unlocking the shed, getting and using the mower, putting it away, and relocking the shed until the lawn grows long again.</p>
<p class="tx"><span aria-label=" Page 370. " epub:type="pagebreak" id="pg_370" role="doc-pagebreak"/>Interestingly, the <span class="sans_thesansmonocd_w5regular_">attrib</span> command fails to set attributes when a file is a system file or a hidden file—except for the actual system and hidden file attributes themselves. Thus, if a file is hidden and you use <span class="sans_thesansmonocd_w5regular_">+R</span> alone in the argument string, the <span class="sans_thesansmonocd_w5regular_">attrib</span> command fails to set the file to read-only. However, the previous command with the <span class="sans_thesansmonocd_w5regular_">-S -H +R</span> argument string ensures that these two file attributes are not set, thus enabling the use of the last attribute. If need be, you can execute a second <span class="sans_thesansmonocd_w5regular_">attrib</span> command to reset the system and/or hidden attributes: <span class="sans_thesansmonocd_w5regular_">+S +H</span>. You’ll find the full set of attributes that you can set and unset with the <span class="sans_thesansmonocd_w5regular_">help</span> command.</p>
<p class="tx">To demonstrate a final use, the <span class="sans_thesansmonocd_w5regular_">del</span> command (<span class="xref"><a href="chapter7.xhtml" class="calibre3">Chapter 7</a></span>) does a great job of deleting a particular file, but not of deleting everything <i class="calibre6">but</i> a particular file. Assuming that your work directory doesn’t have any hidden files, these three lines of code delete everything except the lone file:</p>
<pre class="pre"><code class="calibre11">attrib +H C:\Work\Noah.txt
del C:\Work\* /Q /A-H
attrib -H C:\Work\Noah.txt
</code></pre>
<p class="tx">The first <span class="sans_thesansmonocd_w5regular_">attrib</span> command flips the <i class="calibre6">Noah.txt</i> file to hidden; then the <span class="sans_thesansmonocd_w5regular_">del</span> command deletes everything in the directory that isn’t hidden thanks to the <span class="sans_thesansmonocd_w5regular_">/A-H</span> option. Finally, the second <span class="sans_thesansmonocd_w5regular_">attrib</span> command restores the file to its prior state without a scratch on it and without any other files in the directory.</p>
<p class="tx">Once you’ve mastered the art of manipulating the attributes of a file, you can move on to the manipulation of bits.</p>
</section>
</section>
<section aria-labelledby="sec8" epub:type="division">
<h3 class="h" id="sec8"><span id="h1-199"/><span class="sans_futura_std_bold_b_">Bit Manipulation</span></h3>
<p class="tni">In <span class="xref"><a href="chapter6.xhtml" class="calibre3">Chapter 6</a></span>, I promised to return to the last remaining arithmetic operators supported in Batch: three bitwise operators and two logical shift operators. These operators work on the bit level, so you need to make a cognitive shift to the binary world to understand their behavior. A <i class="calibre6">nibble</i>, or half of a byte, is comprised of four bits, each representing a decreasing power of two. Setting a bit’s value to 1 turns it on, and setting its value to 0 turns it off.</p>
<p class="tx">When you turn on the first or leftmost of the four bits, it represents the decimal 8—the second bit is 4, the third bit is 2, and the final bit is 1. Therefore, the binary number 0001 equals the decimal number of 1, and binary 1000 is equivalent to decimal 8.</p>
<p class="tx">You can derive other numbers by turning on a combination of bits. Binary 1111 is equivalent to decimal 15—that is, 8 + 4 + 2 + 1. The complete byte consisting of two nibbles has 256 unique values, but for this discussion, I’ll stay with the much more manageable nibble and its 16 unique values for most of the upcoming examples.</p>
<section aria-labelledby="sec9" epub:type="division">
<h4 class="h1" id="sec9"><span id="h2-110"/><span class="sans_futura_std_heavy_oblique_bi_">Bitwise Operations</span></h4>
<p class="tni">The <i class="calibre6">bitwise and</i> operation accepts two operands and returns a 1 in each bit position for which the corresponding bits of both operands are set to 1. For this example, consider the decimal numbers 3 and 6. The decimal number <span aria-label=" Page 371. " epub:type="pagebreak" id="pg_371" role="doc-pagebreak"/>3 equals binary 0011, having the bits for 2 and 1 turned on, and the decimal 6 equals the binary 0110, having the bits for 4 and 2 turned on. The only common bit set to 1 is the third bit, which has a value of 2, so the result of a bitwise and of 3 and 6 is binary 0010 or decimal 2.</p>
<p class="tx">The <i class="calibre6">bitwise or</i> operator looks for bits being set to 1 in <i class="calibre6">either</i> operand. There are three such bits between 3 and 6, resulting in binary 0111 or decimal 7. The <i class="calibre6">bitwise exclusive or</i> turns on the bits that <i class="calibre6">differ</i> in the two operands. Using the same numbers, only the second and fourth bits differ, so the result is binary 0101 or decimal 5 (that is, 4 + 1).</p>
<p class="tx">This is much easier to visualize in tabular form. <a href="#tab30-1" class="calibre3">Table 30-1</a> also introduces the Batch operator for each bitwise arithmetic operation.</p>
<table class="basic-table">
<caption class="calibre19"><p class="tt" id="tab30-1"><span class="sans_futura_std_bold_b_">Table 30-1:</span> <span class="sans_futura_std_book_">Bitwise Arithmetic and Operators</span></p></caption>
<thead class="calibre15">
<tr class="calibre16">
<td class="tch1"/>
<th class="tch" scope="col"><p class="tableheader"><span class="sans_futura_std_bold_b_">Operator</span></p></th>
<th class="tch" scope="col"><p class="tableheader"><span class="sans_futura_std_bold_b_">Example</span></p></th>
</tr>
</thead>
<tbody class="calibre17">
<tr class="calibre18">
<td class="basic-table1"><p class="tableheader"><span class="sans_futura_std_bold_b_">Bitwise and</span></p></td>
<td class="basic-table1"><p class="tableheader"><span class="sans_thesansmonocd_w5regular_">&amp;</span></p></td>
<td class="basic-table1"><p class="tableheader"><span class="sans_thesansmonocd_w5regular_">3 &amp; 6 = 0011 &amp; 0110 = 0010 = 2</span></p></td>
</tr>
<tr class="calibre16">
<td class="basic-table2"><p class="tableheader"><span class="sans_futura_std_bold_b_">Bitwise or</span></p></td>
<td class="basic-table2"><p class="tableheader"><span class="sans_thesansmonocd_w5regular_">|</span></p></td>
<td class="basic-table2"><p class="tableheader"><span class="sans_thesansmonocd_w5regular_">3 | 6 = 0011 | 0110 = 0111 = 7</span></p></td>
</tr>
<tr class="calibre18">
<td class="basic-table3"><p class="tableheader"><span class="sans_futura_std_bold_b_">Bitwise exclusive or</span></p></td>
<td class="basic-table3"><p class="tableheader"><span class="sans_thesansmonocd_w5regular_">^</span></p></td>
<td class="basic-table3"><p class="tableheader"><span class="sans_thesansmonocd_w5regular_">3 ^ 6 = 0011 ^ 0110 = 0101 = 5</span></p></td>
</tr>
</tbody>
</table>
<p class="tx">After grasping the machinations of bitwise logic, you might balk at the choice of operators. One ampersand usually terminates a command, the caret is an escape character, and the character used for the bitwise or is most often used to pipe data from one command to another (and I haven’t even mentioned conditional execution). Surely, you can’t use these characters in arithmetic calculations?</p>
<p class="tx">You can, but you need to take some action to ensure that these characters don’t trigger their other uses. There are actually three different methods, all of which I show in these three functionally equivalent examples of bitwise and arithmetic:</p>
<pre class="pre"><code class="calibre11">set /A bitAnd = "3 &amp; 6"
set /A "bitAnd = 3 &amp; 6"
set /A bitAnd = 3 ^&amp; 6
</code></pre>
<p class="tx">My preference is to encase just the arithmetic in double quotes as demonstrated in the first example. You can also use double quotes to surround the variable name, the equality operator, and the arithmetic, as shown in the second example. Finally, you can escape the operator with a caret.</p>
<p class="tx">The following demonstrates all three bitwise arithmetic operations using my preferred method:</p>
<pre class="pre"><code class="calibre11">set /A bitAnd = "3 &amp; 6"
set /A bitOr = "3 | 6"
set /A bitXOr = "3 ^ 6"
</code></pre>
<p class="tni">After these commands execute, <span class="sans_thesansmonocd_w5regular_">bitAnd</span>, <span class="sans_thesansmonocd_w5regular_">bitOr</span>, and <span class="sans_thesansmonocd_w5regular_">bitXOr</span> contain the values <span class="sans_thesansmonocd_w5regular_">2</span>, <span class="sans_thesansmonocd_w5regular_">7</span>, and <span class="sans_thesansmonocd_w5regular_">5</span>, respectively, the same results calculated earlier.</p>
<p class="tx"><span aria-label=" Page 372. " epub:type="pagebreak" id="pg_372" role="doc-pagebreak"/>This is where I usually detail the many uses for what I’ve just discussed, but I can’t say that I manipulate bits on a daily basis. Actually, I’ve never used any of the bitwise operators in Batch. In the early days of computing, coders would often concatenate a set of flags at the bit level to create just one condensed field. They could then set and retrieve the individual bits representing individual flags with bit manipulation.</p>
<p class="tx">Cheap and plentiful memory has made this technique a distant memory, but I can still share one use. The following code determines whether a particular number is a power of two:</p>
<pre class="pre"><code class="calibre11">set /A bitAnd = "nbr &amp; (nbr - 1)"
if %bitAnd% equ 0  &gt; con echo %nbr% is a power of 2.
</code></pre>
<p class="tni">Only if <span class="sans_thesansmonocd_w5regular_">nbr</span> equals <span class="sans_thesansmonocd_w5regular_">0</span>, <span class="sans_thesansmonocd_w5regular_">1</span>, <span class="sans_thesansmonocd_w5regular_">2</span>, <span class="sans_thesansmonocd_w5regular_">4</span>, <span class="sans_thesansmonocd_w5regular_">8</span>, <span class="sans_thesansmonocd_w5regular_">16</span>, and so on, does the <span class="sans_thesansmonocd_w5regular_">echo</span> command write its message.</p>
<p class="tx">Any number that’s a power of 2 has exactly one bit turned on, and the number one less than it has that bit turned off with all the bits to its right turned on. For instance, decimal 8 = binary 1000, and 7 = 0111. The result of a bitwise and operation on these two operands is <span class="sans_thesansmonocd_w5regular_">0</span>, because there are no common bits turned on or set to 1. But if a number isn’t a power of 2, at least one corresponding bit is turned on in both it and the number one less than it. For instance, 6 = 0110, and 5 = 0101; the second bit is turned on in both numbers, so the result of the bitwise and operation is nonzero: 4 = 0100.</p>
</section>
<section aria-labelledby="sec10" epub:type="division">
<h4 class="h1" id="sec10"><span id="h2-111"/><span class="sans_futura_std_heavy_oblique_bi_">Logical Shift Operations</span></h4>
<p class="tni">Batch has two more tools for manipulating bits. The <i class="calibre6">logical left shift</i> operator shifts all of the bits in the first operand to the left by an amount dictated by the right operand, replacing the bits on the right with zeros. The <i class="calibre6">logical right shift</i> operator behaves similarly except that it shifts to the right and replaces the vacated bits on the left with zeros while discarding the same number of bits on the right.</p>
<p class="tx">Here are the logical shift operators, both with an example:</p>
<table class="basic-table">
<thead class="calibre15">
<tr class="calibre16">
<td class="tch1"/>
<th class="tch" scope="col"><p class="tableheader"><span class="sans_futura_std_bold_b_">Operator</span></p></th>
<th class="tch" scope="col"><p class="tableheader"><span class="sans_futura_std_bold_b_">Example</span></p></th>
</tr>
</thead>
<tbody class="calibre17">
<tr class="calibre16">
<td class="basic-table1"><p class="tableheader"><span class="sans_futura_std_bold_b_">Logical left shift</span></p></td>
<td class="basic-table1"><p class="tableheader"><span class="sans_thesansmonocd_w5regular_">&lt;&lt;</span></p></td>
<td class="basic-table1"><p class="tableheader"><span class="sans_thesansmonocd_w5regular_">3 &lt;&lt; 2 = 0011</span> <span class="copyright_accent">→</span> <span class="sans_thesansmonocd_w5regular_">11</span><span class="sans_thesansmonocd_w7bold_b_">00</span> <span class="sans_thesansmonocd_w5regular_">= 12</span></p></td>
</tr>
<tr class="calibre16">
<td class="basic-table3"><p class="tableheader"><span class="sans_futura_std_bold_b_">Logical right shift</span></p></td>
<td class="basic-table3"><p class="tableheader"><span class="sans_thesansmonocd_w5regular_">&gt;&gt;</span></p></td>
<td class="basic-table3"><p class="tableheader"><span class="sans_thesansmonocd_w5regular_">9 &gt;&gt; 1 = 1001</span> <span class="copyright_accent">→</span> <span class="sans_thesansmonocd_w7bold_b_">0</span><span class="sans_thesansmonocd_w5regular_">100 = 4</span></p></td>
</tr>
</tbody>
</table>
<p class="tni">The bits that the logical shift inserted into the result are shown in bold. The first command appends two zeros after shifting the bits two places to the left. The second command prepends one zero after shifting the bits one place to the right, while also dropping the rightmost <span class="sans_thesansmonocd_w5regular_">1</span> in the process.</p>
<p class="tx">The following two commands implement both of these examples in Batch:</p>
<pre class="pre"><code class="calibre11">set /A logicLeftShift = "3 &lt;&lt; 2"
set /A logicRightShift = "9 &gt;&gt; 1"
</code></pre>
<p class="tni"><span aria-label=" Page 373. " epub:type="pagebreak" id="pg_373" role="doc-pagebreak"/>(To handle the less-than and greater-than signs, we either need escape characters or one of the two double-quote techniques mentioned in reference to the bitwise operators.)</p>
<p class="tx">I’m equally nonplussed attempting to find logical shift applications because I’ve never used these operators in the real world. However, since Batch doesn’t support exponentials, we can use the logical left shift to raise a number to a power ... if that base is two. Think of it as a very narrowly defined power function. Consider these examples that compute <span class="sans_thesansmonocd_w5regular_">2</span><span class="sans_thesansmonocd_w5regular_sup_">3</span> and <span class="sans_thesansmonocd_w5regular_">2</span><span class="sans_thesansmonocd_w5regular_sup_">9</span>:</p>
<pre class="pre"><code class="calibre11">set /A TwoCubed = "1 &lt;&lt; 3"
set /A TwoToTheNinth = "1 &lt;&lt; 9"
&gt; con set Two
</code></pre>
<p class="tni">Every bit in a nibble (and a byte) represents a power of 2, so the first command shifts 0001 to the left <span class="sans_thesansmonocd_w5regular_">3</span> bits, resulting in 1000 or the decimal number 8, which is two cubed. The trailing <span class="sans_thesansmonocd_w5regular_">set</span> command writes the following to the console:</p>
<pre class="pre"><code class="calibre11">TwoCubed=8
TwoToTheNinth=512
</code></pre>
<p class="tni">The second command uses more than one nibble in its calculation. Notice that a binary <span class="sans_thesansmonocd_w5regular_">1</span> followed by <span class="sans_thesansmonocd_w5regular_">9</span> zeros equals <span class="sans_thesansmonocd_w5regular_">512</span> or two to the ninth power.</p>
<p class="tx">If you have used these operators in the wild, drop me a line and I’ll see about adding your application to the next edition of this book.</p>
</section>
</section>
<section aria-labelledby="sec11" epub:type="division">
<h3 class="h" id="sec11"><span id="h1-200"/><span class="sans_futura_std_bold_b_">Summary</span></h3>
<p class="tni">In this chapter, I discussed a set of topics that I simply had to share even though they’re too short for chapters of their own. You learned how to sort small-to-medium-sized data files and how to customize that sort. I gave a brief overview of the Windows Registry and demonstrated how to interrogate it with a couple interesting commands. You also learned how to set and retrieve file attributes and how to manipulate bits with the bitwise and logical shift operators.</p>
<p class="tx">The next chapter might be the most important and, eventually, the most referenced in this book. Troubleshooting tips and testing techniques are important in any language, but especially in a scripting language without a compiler—and without an animator or debugger.</p>
</section>
</section>
</div></body></html>