<html><head></head><body>
<div id="sbo-rt-content"><section aria-labelledby="ch13" epub:type="chapter" role="doc-chapter">
<span aria-label="239" epub:type="pagebreak" id="pg_239" role="doc-pagebreak"/>
<hgroup>
<h2 class="CHAPTER" id="ch13">
<span class="CN"><span class="SANS_Futura_Std_Bold_Condensed_B_11">13</span></span>
<span class="CT"><span class="SANS_Dogma_OT_Bold_B_11">ORGANIZING A WEB APPLICATION</span></span>
</h2>
</hgroup>
<figure class="opener"><img alt="" class="opener" height="380" src="../images/opener.jpg" width="380"/>
</figure>
<p class="INTRO">In this chapter, we’ll progressively explore a structured approach to dividing a web application’s responsibilities among multiple scripts while also developing a project folder architecture that gives every script a clearly defined home. You’ll be introduced to the <i>front-controller</i> design pattern, which requires the sending of every request to the web server through a single script that decides how to respond, then delegates the responsibility for generating that response to other server scripts.</p>
<p class="TX"><span class="Xref"><a href="chapter11.xhtml">Chapters 11</a></span> and <span class="Xref"><a href="chapter12.xhtml">12</a></span> introduced differing approaches to designing a web application. One is to write multiple scripts for each web form that separately handle displaying, validating, and confirming the form; another is to create a single postback script that does all those tasks. Both approaches have advantages and disadvantages, but neither is scalable for web applications that may grow in size and complexity over time. You wouldn’t want to <span aria-label="240" epub:type="pagebreak" id="pg_240" role="doc-pagebreak"/>have tens, hundreds, or even thousands of PHP scripts sitting in your application’s <i>public</i> folder, as might happen with the first approach, for reasons of maintenance as well as security (malicious users may attempt to execute public scripts out of sequence to bypass validation checks, for example). But neither would you want an individual script to become overly complex, as might happen with the second approach.</p>
<p class="TX">The architecture we’ll discuss in this chapter addresses these problems by focusing all decision-making logic on the single front-controller script while using other scripts or functions to carry out all other tasks. The front controller acts much like the receptionist in a large office building, whom every guest must visit; it identifies and interprets each request (who the visitor is and what they’re asking for), and directs it to the appropriate server script (a room in the building) that satisfies the request. With this architecture, no one script is overly complicated, and while an application can grow to include many scripts, they’re organized in such a way that the application is easy to maintain and extend.</p>
<section aria-labelledby="sec1" epub:type="division">
<h3 class="H1"><span id="sec1"/><span id="toc-link_178"/><span class="SANS_Futura_Std_Bold_B_11">Front Controllers and the MVC Architecture</span></h3>
<p class="TNI1"><span class="Xref"><a href="chapter10.xhtml">Chapter 10</a></span> introduced the model-view-controller (MVC) architecture, a design pattern that divides a web application into three main components. The <i>model</i> represents the data underlying the application, typically stored in a database; the <i>view</i> uses templating to determine how the data is displayed to the user; and the <i>controller</i> makes decisions about what data to display when. The front-controller scripts we’ll explore in this chapter are the core piece of the controller portion of the MVC architecture, as they take in every HTTP request to the application and determine how to respond. <a href="#fig13-1">Figure 13-1</a> illustrates how a front controller fits into the MVC pattern.</p>
<span aria-label="241" epub:type="pagebreak" id="pg_241" role="doc-pagebreak"/>
<figure class="IMG"><a id="fig13-1"/><img alt="" class="img60" height="905" src="../images/figure13-1.jpg" width="811"/>
<figcaption><p class="CAP"><span class="SANS_Futura_Std_Book_Oblique_11">Figure 13-1: The MVC architecture, featuring a front controller</span></p></figcaption>
</figure>
<p class="TX">The <i>front controller</i> <span aria-label="annotation1" class="CodeAnnotation">❶</span> handles every HTTP request received from web clients, deciding which <i>action controller</i> should be invoked. These action controllers are more specialized scripts or functions, also part of the controller component of the MVC architecture, that carry out particular tasks for the application, such as checking stored security credentials or manipulating data like shopping-cart contents. An action controller may need to read the contents of a data store, such as a database system (more about this in <span class="Xref"><a href="part6.xhtml">Part VI</a></span>). The action controller then invokes the view (templating) component <span aria-label="annotation2" class="CodeAnnotation">❷</span> to create the contents of the response to be returned to the user, passing along the data from the model if appropriate. The action controller then receives the output from the view component <span aria-label="annotation3" class="CodeAnnotation">❸</span> and adds any appropriate headers or response codes. Finally, the response is sent back to the web client <span aria-label="annotation4" class="CodeAnnotation">❹</span>.</p>
</section>
<section aria-labelledby="sec2" epub:type="division">
<span aria-label="242" epub:type="pagebreak" id="pg_242" role="doc-pagebreak"/>
<h3 class="H1"><span id="sec2"/><span id="toc-link_179"/><span class="SANS_Futura_Std_Bold_B_11">Separating Display and Logic Files</span></h3>
<p class="TNI1">We’ll revisit the simple <i>Hello &lt;name&gt;</i> form developed in the preceding two chapters to start the process of separating the display code from the decision-making logic in an application. See <span class="Xref">“A Simple Example” on <a href="chapter11.xhtml#pg_199">page 199</a></span> to review how we initially created and processed that form with separate scripts, and <span class="Xref">“Simple Validation Logic” on <a href="chapter12.xhtml#pg_231">page 231</a></span> for how we validated and displayed the form with a single postback script. In this version, the application will have three possible responses it may return:</p>
<ul class="ul">
<li class="ListBullet">The blank form if the HTTP request used the <span class="SANS_TheSansMonoCd_W5Regular_11">GET</span> method</li>
<li class="ListBullet">A <i>Hello &lt;name&gt;</i> confirmation message if a valid name was received</li>
<li class="ListBullet">An error message if an invalid name (less than three characters long) was received</li>
</ul>
<p class="BodyContinued">The decision-making logic and possible outputs are modeled in the flowchart in <a href="#fig13-2">Figure 13-2</a>.</p>
<figure class="IMG"><a id="fig13-2"/><img alt="" class="img80" height="953" src="../images/figure13-2.jpg" width="1119"/>
<figcaption><p class="CAP"><span class="SANS_Futura_Std_Book_Oblique_11">Figure 13-2: Modeling the logic and outputs of the</span> <span class="SANS_Futura_Std_Book_11">Hello &lt;name&gt;</span> <span class="SANS_Futura_Std_Book_Oblique_11">application</span></p></figcaption>
</figure>
<p class="TX">We’ll create a separate file for each of the three possible outputs. Meanwhile, every request will be routed to the front controller in the <i>index.php</i> file. The logic in the front controller will decide what to do (that is, which of the other three files to draw upon to generate the output to be returned to the user). The file structure for the project will therefore look as follows when we’ve finished:</p>
<span aria-label="243" epub:type="pagebreak" id="pg_243" role="doc-pagebreak"/>
<figure class="IMG-1"><img alt="" class="img100" height="246" src="../images/pg243.jpg" width="1390"/>
</figure>
<p class="BodyContinued">Notice that all the files are located in the project’s <i>public</i> folder.</p>
<section aria-labelledby="sec3" epub:type="division">
<h4 class="H2"><span id="sec3"/><span id="toc-link_180"/><span class="SANS_Futura_Std_Bold_Condensed_Oblique_11">Creating the Front Controller</span></h4>
<p class="TNI1">We’ll first write the <i>index.php</i> front-controller script. All requests for this project will be for <i>index.php</i>, some with the <span class="SANS_TheSansMonoCd_W5Regular_11">GET</span> method, some with the <span class="SANS_TheSansMonoCd_W5Regular_11">POST</span> method, some containing valid submitted data, and some containing invalid submitted data. Depending on the type of HTTP method (<span class="SANS_TheSansMonoCd_W5Regular_11">GET</span> or <span class="SANS_TheSansMonoCd_W5Regular_11">POST</span>) and whether the submitted data is valid, this script decides which of the three display pages to return as the response. <a href="#lis13-1">Listing 13-1</a> shows the code.</p>
<span id="lis13-1"/>
<pre><code>&lt;?php&#13;
$isGetMethod = ($_SERVER['REQUEST_METHOD'] === 'GET');&#13;
&#13;
if ($isGetMethod) {&#13;
  <span aria-label="annotation1" class="Code_CodeAnnotation">❶</span> require_once 'displayForm.php';&#13;
} else {&#13;
    $firstName = filter_input(INPUT_POST, 'firstName');&#13;
&#13;
    if (strlen($firstName) &lt; 3) {&#13;
        $errorMessage = 'invalid - name must contain at least letters';&#13;
      <span aria-label="annotation2" class="Code_CodeAnnotation">❷</span> require_once 'displayError.php';&#13;
    } else {&#13;
      <span aria-label="annotation3" class="Code_CodeAnnotation">❸</span> require_once 'displayHello.php';&#13;
    }&#13;
}</code></pre>
<p class="CodeListingCaption"><span class="SANS_Futura_Std_Book_Oblique_11">Listing 13-1: The front-controller script in</span> <span class="SANS_Futura_Std_Book_11">index.php</span> <span class="SANS_Futura_Std_Book_Oblique_11">deciding which page to display</span></p>
<p class="TX">First, we test whether the request received was via the <span class="SANS_TheSansMonoCd_W5Regular_11">GET</span> method and set the <span class="SANS_TheSansMonoCd_W5Regular_11">$isGetMethod</span> Boolean flag accordingly. Then we pass this flag to an <span class="SANS_TheSansMonoCd_W5Regular_11">if...else</span> statement. If <span class="SANS_TheSansMonoCd_W5Regular_11">true</span>, we display the form by requiring the file <i>displayForm.php</i> <span aria-label="annotation1" class="CodeAnnotation">❶</span>. Otherwise, we must be processing a <span class="SANS_TheSansMonoCd_W5Regular_11">POST</span> request containing the form submission, so we use the logic in the <span class="SANS_TheSansMonoCd_W5Regular_11">else</span> branch (the rest of the script) to read and validate the data. For that, we use <span class="SANS_TheSansMonoCd_W5Regular_11">filter_input()</span> to extract a <span class="SANS_TheSansMonoCd_W5Regular_11">$firstName</span> value from the <span class="SANS_TheSansMonoCd_W5Regular_11">POST</span> variables. Then we test the validity of the received name. If it’s too short, we set <span class="SANS_TheSansMonoCd_W5Regular_11">$errorMessage</span> to a suitable message, then read in the <i>displayError.php</i> file to show the error page <span aria-label="annotation2" class="CodeAnnotation">❷</span>. If the name is valid, we read in the <i>displayHello.php</i> file to show the <i>Hello &lt;name&gt;</i> confirmation message <span aria-label="annotation3" class="CodeAnnotation">❸</span>.</p>
</section>
<section aria-labelledby="sec4" epub:type="division">
<h4 class="H2"><span id="sec4"/><span id="toc-link_181"/><span class="SANS_Futura_Std_Bold_Condensed_Oblique_11">Writing the Display Scripts</span></h4>
<p class="TNI1">Next, we’ll create the three display scripts, starting with the web form itself. Enter the contents of <a href="#lis13-2">Listing 13-2</a> into a file named <i>displayForm.php</i> in the <i>public</i> folder.</p>
<span id="lis13-2"/>
<pre><code><span aria-label="244" epub:type="pagebreak" id="pg_244" role="doc-pagebreak"/>&lt;!doctype html&gt;&lt;html&gt;&lt;head&gt;&lt;title&gt;Tiny Form&lt;/title&gt;&lt;/head&gt;&#13;
&lt;body&gt;&#13;
    &lt;form method="POST"&gt;&#13;
        &lt;input name="firstName"&gt;&#13;
        &lt;input type="submit"&gt;&#13;
    &lt;/form&gt;&#13;
&lt;/body&gt;&lt;/html&gt;</code></pre>
<p class="CodeListingCaption"><span class="SANS_Futura_Std_Book_Oblique_11">Listing 13-2: The</span> <span class="SANS_Futura_Std_Book_11">displayForm.php</span> <span class="SANS_Futura_Std_Book_Oblique_11">script to display the form to the user</span></p>
<p class="TX">This script consists entirely of HTML template text, namely a <span class="SANS_TheSansMonoCd_W5Regular_11">POST</span>-method form with a <span class="SANS_TheSansMonoCd_W5Regular_11">name</span> input and a Submit button. Because we don’t give the form an <span class="SANS_TheSansMonoCd_W5Regular_11">action</span> attribute, the form will be submitted to the same URL as the request that displayed the form. In this case, that’s our <i>index.php</i> front-controller script.</p>
<p class="TX">Next, <a href="#lis13-3">Listing 13-3</a> creates the page confirming a valid submission. Copy the listing into a file called <i>displayHello.php</i>.</p>
<span id="lis13-3"/>
<pre><code>&lt;!doctype html&gt;&lt;html&gt;&#13;
&lt;head&gt;&lt;title&gt;hello&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&#13;
    Hello &lt;?= $firstName ?&gt;&#13;
&lt;/body&gt;&lt;/html&gt;</code></pre>
<p class="CodeListingCaption"><span class="SANS_Futura_Std_Book_Oblique_11">Listing 13-3: The</span> <span class="SANS_Futura_Std_Book_11">displayHello.php</span> <span class="SANS_Futura_Std_Book_Oblique_11">script to confirm that a valid name has been received</span></p>
<p class="TX">Within the HTML template text, we use the PHP short echo tag to output the value of the <span class="SANS_TheSansMonoCd_W5Regular_11">$firstName</span> variable. Notice that this variable hasn’t been declared in <i>displayHello.php</i> itself, but that’s okay. This file isn’t written as a stand-alone script but rather is intended to be required from another script: <i>index.php</i>. As long as we’ve set the <span class="SANS_TheSansMonoCd_W5Regular_11">$firstName</span> variable in <i>index.php</i> before reading in this script (which we have), the variable will be accessible within <i>displayHello.php</i> as well.</p>
<p class="TX">Finally, we’ll write the third display page that outputs an error message. Create <i>displayError.php</i> and enter the contents of <a href="#lis13-4">Listing 13-4</a>.</p>
<span id="lis13-4"/>
<pre><code>&lt;!doctype html&gt;&lt;html&gt;&lt;head&gt;&#13;
    &lt;title&gt;error&lt;/title&gt;&#13;
    &lt;style&gt;.error {background-color: pink; padding: 1rem;}&lt;/style&gt;&#13;
&lt;/head&gt;&lt;body&gt;&#13;
&lt;div class="error"&gt;&#13;
    &lt;p&gt;Sorry, there was a problem with your form submission&lt;/p&gt;&#13;
    &lt;p&gt;&lt;?= $errorMessage ?&gt;&lt;/p&gt;&#13;
&lt;/div&gt;&#13;
&lt;/body&gt;&lt;/html&gt;</code></pre>
<p class="CodeListingCaption"><span class="SANS_Futura_Std_Book_Oblique_11">Listing 13-4: The</span> <span class="SANS_Futura_Std_Book_11">displayError.php</span> <span class="SANS_Futura_Std_Book_Oblique_11">script to show an error message to the user</span></p>
<p class="TX">We again use a PHP short echo tag to output the value of a variable (in this case, <span class="SANS_TheSansMonoCd_W5Regular_11">$errorMessage</span>). Once again, we need to ensure that this variable has been assigned a value in <i>index.php</i> before the front-controller script references the <i>displayError.php</i> display script.</p>
<p class="TX"><span aria-label="245" epub:type="pagebreak" id="pg_245" role="doc-pagebreak"/>We now have four PHP scripts in our project. This may seem like a lot, but each script has the advantage of having a single core responsibility. We have three scripts to display the application’s three possible pages, along with an <i>index.php</i> front-controller script that pulls together the main program logic.</p>
</section>
</section>
<section aria-labelledby="sec5" epub:type="division">
<h3 class="H1"><span id="sec5"/><span id="toc-link_182"/><span class="SANS_Futura_Std_Bold_B_11">Moving Website Logic into Functions</span></h3>
<p class="TNI1">We can further organize our project by taking each task or decision in the <i>index.php</i> front controller and encapsulating it in its own function. While the current level of complexity of <i>index.php</i> is suitable for this small project, multipage websites with multiple forms would become much too complex for a single script to handle. We’ll create a PHP file named <i>controllerFunctions.php</i> to store the functions, thereby streamlining the front-controller script.</p>
<p class="TX">Also, at present all the files are in the project’s <i>public</i> folder, meaning any of them can be directly requested and served to a user. For example, you could enter <i>localhost:8000/displayHello.php</i> in your browser’s address bar and the display script would be executed without the <span class="SANS_TheSansMonoCd_W5Regular_11">$firstName</span> variable first having been assigned a value, since the form-processing logic in <i>index.php</i> wouldn’t have been executed. This would trigger a notice-level error flagging the undefined variable.</p>
<p class="TX">This file structure would be messy and unmanageable for a larger project, with potentially hundreds of directly accessible files in the <i>public</i> folder. In addition, we’re exposing PHP scripts that the user shouldn’t ever be able to directly request. The solution, as first discussed in <span class="Xref"><a href="chapter10.xhtml">Chapter 10</a></span>, is to use folders to separate public scripts (generally the <i>index.php</i> front controller) from those that shouldn’t be directly accessible to the public. We’ll implement this change as well.</p>
<section aria-labelledby="sec6" epub:type="division">
<h4 class="H2"><span id="sec6"/><span id="toc-link_183"/><span class="SANS_Futura_Std_Bold_Condensed_Oblique_11">Designing a Secure Folder Structure</span></h4>
<p class="TNI1">To make the application more secure, move the three output scripts (<i>displayHello.php</i>, <i>displayError.php</i>, and <i>displayForm.php</i>) from <i>public</i> to a new folder named <i>templates</i>. Likewise, we don’t want users to be able to directly request our new <i>controllerFunctions.php</i> file. This file will contain only function declarations, so there’s no reason for it to be published in the <i>public</i> folder. Instead, we’ll put <i>controllerFunctions.php</i> in its own folder, which by convention we’ll name <i>src</i> (short for <i>source code</i>). The file structure for our refactored project will therefore look as follows:</p>
<figure class="IMG-1"><img alt="" class="img100" height="399" src="../images/pg245.jpg" width="1390"/>
</figure>
<p class="TX"><span aria-label="246" epub:type="pagebreak" id="pg_246" role="doc-pagebreak"/>Using separate folders like this not only makes the application more secure but also keeps it better organized, with the scripts grouped into folders based on their purpose.</p>
</section>
<section aria-labelledby="sec7" epub:type="division">
<h4 class="H2"><span id="sec7"/><span id="toc-link_184"/><span class="SANS_Futura_Std_Bold_Condensed_Oblique_11">Simplifying the Front-Controller Script</span></h4>
<p class="TNI1">Now let’s simplify our front-controller script by replacing some of the logic with function calls. The main task the front controller needs to do is check whether the received request used the <span class="SANS_TheSansMonoCd_W5Regular_11">GET</span> method (in which case the form should be displayed) or the <span class="SANS_TheSansMonoCd_W5Regular_11">POST</span> method (in which case the form should be processed).</p>
<p class="TX">We’ll update the script to focus just on this decision and leave the remaining details to separate functions (which we’ll write next). <a href="#lis13-5">Listing 13-5</a> shows how to modify the <i>index.php</i> file.</p>
<span id="lis13-5"/>
<pre><code><span class="TheSansMonoCd_W5Regular_Grey_11">&lt;?php</span>&#13;
require_once '../src/controllerFunctions.php';&#13;
&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">$isGetMethod = ($_SERVER['REQUEST_METHOD'] === 'GET');</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">if ($isGetMethod) {</span>&#13;
    displayForm();&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">} else {</span>&#13;
    processForm();&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">}</span></code></pre>
<p class="CodeListingCaption"><span class="SANS_Futura_Std_Book_Oblique_11">Listing 13-5: The simplified front-controller script in</span> <span class="SANS_Futura_Std_Book_11">index.php</span></p>
<p class="TX">We read in the definitions for all the functions we’ll be using from <i>src/controllerFunctions.php</i>. The two dots (<span class="SANS_TheSansMonoCd_W5Regular_11">..</span>) at the start of the filepath signify the parent directory relative to the current script’s directory (that is, the overall project folder that contains both <i>public</i> and <i>src</i>). As before, we next set the <span class="SANS_TheSansMonoCd_W5Regular_11">$isGetMethod</span> Boolean flag and use it to control an <span class="SANS_TheSansMonoCd_W5Regular_11">if...else</span> statement. This time, however, the <span class="SANS_TheSansMonoCd_W5Regular_11">if...else</span> statement simply invokes the <span class="SANS_TheSansMonoCd_W5Regular_11">displayForm()</span> function if the server receives a <span class="SANS_TheSansMonoCd_W5Regular_11">GET</span> request or invokes the <span class="SANS_TheSansMonoCd_W5Regular_11">processForm()</span> function if it is a <span class="SANS_TheSansMonoCd_W5Regular_11">POST</span> request.</p>
</section>
<section aria-labelledby="sec8" epub:type="division">
<h4 class="H2"><span id="sec8"/><span id="toc-link_185"/><span class="SANS_Futura_Std_Bold_Condensed_Oblique_11">Writing the Functions</span></h4>
<p class="TNI1">All that remains is to declare the functions handling the more granular front-controller logic in the new <i>src/controllerFunctions.php</i> file. First, let’s write the <span class="SANS_TheSansMonoCd_W5Regular_11">displayForm()</span> function, as in <a href="#lis13-6">Listing 13-6</a>.</p>
<span id="lis13-6"/>
<pre><code>&lt;?php&#13;
function displayForm(): void&#13;
{&#13;
    require_once '../templates/displayForm.php';&#13;
}</code></pre>
<p class="CodeListingCaption"><span class="SANS_Futura_Std_Book_Oblique_11">Listing 13-6: A function to display the form</span></p>
<p class="BodyContinued">This function simply reads in and executes the contents of the <i>templates/ displayForm.php</i> file by using <span class="SANS_TheSansMonoCd_W5Regular_11">require_once</span>.</p>
<p class="TX"><span aria-label="247" epub:type="pagebreak" id="pg_247" role="doc-pagebreak"/>Next, let’s write the <span class="SANS_TheSansMonoCd_W5Regular_11">processForm()</span> function that will extract the name from the <span class="SANS_TheSansMonoCd_W5Regular_11">POST</span> variables and decide what to do depending on whether it’s valid, as in <a href="#lis13-7">Listing 13-7</a>.</p>
<span id="lis13-7"/>
<pre><code>function processForm(): void&#13;
{&#13;
    $firstName = filter_input(INPUT_POST, 'firstName');&#13;
&#13;
    if (strlen($firstName) &lt; 3) {&#13;
        displayErrorMessage();&#13;
    } else {&#13;
        displayHello($firstName);&#13;
    }&#13;
}</code></pre>
<p class="CodeListingCaption"><span class="SANS_Futura_Std_Book_Oblique_11">Listing 13-7: A function to process the form</span></p>
<p class="TX">This function reads the <span class="SANS_TheSansMonoCd_W5Regular_11">$firstName</span> variable from the incoming request and tests whether it’s less than three characters long. We invoke another custom function depending on the result: either <span class="SANS_TheSansMonoCd_W5Regular_11">displayErrorMessage()</span> or <span class="SANS_TheSansMonoCd_W5Regular_11">displayHello()</span>. Notice that the latter takes the <span class="SANS_TheSansMonoCd_W5Regular_11">$firstName</span> variable as an argument; you’ll learn more about this shortly. We’ll define these two functions in <a href="#lis13-8">Listing 13-8</a>.</p>
<span id="lis13-8"/>
<pre><code>function displayHello($firstName) : void&#13;
{&#13;
    require_once '../templates/displayHello.php';&#13;
}&#13;
&#13;
function displayErrorMessage(): void&#13;
{&#13;
    $errorMessage = 'invalid - name must contain at least 3 letters';&#13;
    require_once '../templates/displayError.php';&#13;
}</code></pre>
<p class="CodeListingCaption"><span class="SANS_Futura_Std_Book_Oblique_11">Listing 13-8: Functions to display the</span> <span class="SANS_Futura_Std_Book_11">Hello &lt;name&gt;</span> <span class="SANS_Futura_Std_Book_Oblique_11">greeting or an error message</span></p>
<p class="TX">The <span class="SANS_TheSansMonoCd_W5Regular_11">displayHello()</span> function receives the valid first-name string, then reads in and displays the <i>displayHello.php</i> page. The <span class="SANS_TheSansMonoCd_W5Regular_11">displayErrorMessage()</span> function assigns an error message string to the <span class="SANS_TheSansMonoCd_W5Regular_11">$errorMessage</span> variable, then reads in and displays the <i>displayError.php</i> page.</p>
<p class="TX">The <span class="SANS_TheSansMonoCd_W5Regular_11">displayHello()</span> function has a <span class="SANS_TheSansMonoCd_W5Regular_11">$firstName</span> parameter because of the scoping of variables in PHP. When a function reads in and executes a PHP script file by using a <span class="SANS_TheSansMonoCd_W5Regular_11">require_once</span> statement, any variables expected by that script must be either parameters received by the function or variables created within the function. In this case, since the <i>displayHello.php</i> script needs access to <span class="SANS_TheSansMonoCd_W5Regular_11">$firstName</span>, a value for that variable must be passed to the <span class="SANS_TheSansMonoCd_W5Regular_11">displayHello()</span> function. If <span class="SANS_TheSansMonoCd_W5Regular_11">$firstName</span> weren’t a function parameter, no variable of that name would be available to output in the <i>displayHello.php</i> script, and we would see the error displayed in <a href="#fig13-2">Figure 13-2</a>.</p>
<p class="TX">Overall, the functionality of our application is just the same as before, but it has a much better architecture that’s easier to maintain, more <span aria-label="248" epub:type="pagebreak" id="pg_248" role="doc-pagebreak"/>secure, and more scalable in the event the project requirements expand in the future. Our only public script is the front controller in <i>public/index.php</i>, and every HTTP request to the server goes through this script. The front controller determines whether the user wants the form displayed (via a <span class="SANS_TheSansMonoCd_W5Regular_11">GET</span> request) or has submitted the form for processing (a <span class="SANS_TheSansMonoCd_W5Regular_11">POST</span> request). The remaining controller logic is encapsulated in a collection of functions declared in the <i>src/controllerFunctions.php</i> file. Meanwhile, the three responses that can be returned to the client are defined in scripts in the <i>templates</i> folder: <i>displayForm.php</i>, <i>displayHello.php</i>, and <i>displayError.php</i>.</p>
</section>
</section>
<section aria-labelledby="sec9" epub:type="division">
<h3 class="H1"><span id="sec9"/><span id="toc-link_186"/><span class="SANS_Futura_Std_Bold_B_11">Generalizing the Front-Controller Structure</span></h3>
<p class="TNI1">You’ve seen how much simpler scripts and functions become once you start breaking an application into individual responsibilities. Let’s now test the architecture we’ve developed on a new, more complex website project with several pages. You’ll see how a front-controller script can cope with several <span class="SANS_TheSansMonoCd_W5Regular_11">GET</span> requests as well as a <span class="SANS_TheSansMonoCd_W5Regular_11">POST</span> form submission and its validation logic.</p>
<p class="TX"><a href="#fig13-3">Figure 13-3</a> shows the three-page site we’ll create, including a home page, a contact details page, and an inquiry form. The <i>MGW</i> name is a placeholder, standing for <i>My Great Website</i>.</p>
<figure class="IMG"><a id="fig13-3"/><img alt="" class="img100" height="1072" src="../images/figure13-3.jpg" width="1691"/>
<figcaption><p class="CAP"><span class="SANS_Futura_Std_Book_Oblique_11">Figure 13-3: A three-page web application displayed in the browser</span></p></figcaption>
</figure>
<p class="TX"><span aria-label="249" epub:type="pagebreak" id="pg_249" role="doc-pagebreak"/>Each page has a navigation bar at the top with the current page highlighted, followed by a level 1 heading and some page content. To give the pages the nice styling shown in the figure, we’ll link to the prewritten Bootstrap CSS stylesheet, as we did in <span class="Xref"><a href="chapter11.xhtml">Chapter 11</a></span>.</p>
<section aria-labelledby="sec10" epub:type="division">
<h4 class="H2"><span id="sec10"/><span id="toc-link_187"/><span class="SANS_Futura_Std_Bold_Condensed_Oblique_11">Distinguishing Between Requested Pages</span></h4>
<p class="TNI1">Each of the three pages in our application will be displayed in response to a <span class="SANS_TheSansMonoCd_W5Regular_11">GET</span> request, so we need a way to determine which page is being requested. This is a bit different from our <i>Hello &lt;name&gt;</i> application, where we knew a <span class="SANS_TheSansMonoCd_W5Regular_11">GET</span> request could only be for displaying the web form. One simple and common solution is to add an <span class="SANS_TheSansMonoCd_W5Regular_11">action</span> query-string variable to every request, regardless of whether the <span class="SANS_TheSansMonoCd_W5Regular_11">GET</span> or <span class="SANS_TheSansMonoCd_W5Regular_11">POST</span> method is used, and give the variable a value indicating the desired action or page. The request URLs will therefore look something like <i>index.php?action=contactUs</i> to display the contact details page and <i>index.php?action=inquiryForm</i> to display the inquiry form page.</p>
<p class="TX">As we build our new site, we’ll be sure to present links to the user that will pass such an <span class="SANS_TheSansMonoCd_W5Regular_11">action</span> variable to the server with each <span class="SANS_TheSansMonoCd_W5Regular_11">GET</span> request. We’ll also set an <span class="SANS_TheSansMonoCd_W5Regular_11">action</span> query-string variable to <span class="SANS_TheSansMonoCd_W5Regular_11">processForm</span> when the inquiry form is being submitted with the <span class="SANS_TheSansMonoCd_W5Regular_11">POST</span> method. All the requests will go to the <i>index.php</i> front-controller script, which simply has to detect the value of the <span class="SANS_TheSansMonoCd_W5Regular_11">action</span> variable to determine what to do. If no value for <span class="SANS_TheSansMonoCd_W5Regular_11">action</span> is received, or if the value isn’t recognized, the home page will be displayed by default.</p>
<p class="TX">Notice that the different values for the <span class="SANS_TheSansMonoCd_W5Regular_11">action</span> query-string variable can also be seen in the URL address bars in <a href="#fig13-3">Figure 13-3</a>. The home page, which is also the website root, is simply <i>localhost:8000</i>; the Contact Us page ends with <i>index.php?action=contact</i>; and the Enquiry Form page ends with <i>index.php?action=enquiryForm</i>.</p>
</section>
<section aria-labelledby="sec11" epub:type="division">
<h4 class="H2"><span id="sec11"/><span id="toc-link_188"/><span class="SANS_Futura_Std_Bold_Condensed_Oblique_11">Building a Multipage Application</span></h4>
<p class="TNI1">We’ll now build a three-page web application like the one illustrated in <a href="#fig13-3">Figure 13-3</a>. Create a new folder for this project, and create the <i>public</i>, <i>src</i>, and <i>templates</i> subfolders inside it. We’ll follow the same directory structure used for the simpler application earlier in the chapter. We’ll start by writing the application’s front-controller script.</p>
<section aria-labelledby="sec12" epub:type="division">
<h5 class="H3"><span id="sec12"/><span class="SANS_Futura_Std_Bold_Condensed_B_11">Creating the Front Controller</span></h5>
<p class="TNI1">We’ll structure our <i>public/index.php</i> script around a straightforward PHP <span class="SANS_TheSansMonoCd_W5Regular_11">switch</span> statement (see <span class="Xref"><a href="chapter4.xhtml">Chapter 4</a></span>) based on the value of the <span class="SANS_TheSansMonoCd_W5Regular_11">action</span> query-string variable. <a href="#lis13-9">Listing 13-9</a> shows the script. It includes calls to some functions we’ll write in a moment.</p>
<span id="lis13-9"/>
<pre><code>&lt;?php&#13;
require_once '../src/controllerFunctions.php';&#13;
&#13;
$action = filter_input(INPUT_GET, 'action');&#13;
&#13;
switch ($action) {&#13;
<span aria-label="250" epub:type="pagebreak" id="pg_250" role="doc-pagebreak"/>    case 'contactUs':&#13;
        displayContactUs();&#13;
        break;&#13;
&#13;
    case 'inquiryForm':&#13;
        displayInquiryForm();&#13;
        break;&#13;
&#13;
   case 'processForm':&#13;
        processForm();&#13;
        break;&#13;
&#13;
    default:&#13;
        displayHomePage();&#13;
}</code></pre>
<p class="CodeListingCaption"><span class="SANS_Futura_Std_Book_Oblique_11">Listing 13-9: The front-controller logic in</span> <span class="SANS_Futura_Std_Book_11">index.php</span> <span class="SANS_Futura_Std_Book_Oblique_11">for a three-page website</span></p>
<p class="TX">The front controller reads in the function declarations in <i>controller Functions.php</i>, then extracts the value of the <span class="SANS_TheSansMonoCd_W5Regular_11">action</span> query-string variable and passes it to a <span class="SANS_TheSansMonoCd_W5Regular_11">switch</span> statement. The statement has cases for displaying each of the pages (including the default case of displaying the home page), as well as a case for processing the submitted inquiry form. Each case simply calls a custom function that will handle the actual work of carrying out the desired action, such as <span class="SANS_TheSansMonoCd_W5Regular_11">displayContactDetails()</span> to show the contact details page.</p>
<p class="TX">Designing the front controller around a <span class="SANS_TheSansMonoCd_W5Regular_11">switch</span> statement makes it quite simple to expand the application if necessary. To add another page to the website, all we’d have to do is insert another case into the <span class="SANS_TheSansMonoCd_W5Regular_11">switch</span> statement, write a corresponding function in <i>controllerFunctions.php</i>, and add a template for displaying the page to the <i>templates</i> folder. For more complex websites, we could break things up even further by having different collections of functions for different types of website actions. For example, manager actions could be in a file named <i>managerFunctions.php</i>, and so on.</p>
</section>
<section aria-labelledby="sec13" epub:type="division">
<h5 class="H3"><span id="sec13"/><span class="SANS_Futura_Std_Bold_Condensed_B_11">Writing the Display Functions</span></h5>
<p class="TNI1">Now we’ll write simple functions to display the three basic pages. Create <i>src/controllerFunctions.php</i> containing the code in <a href="#lis13-10">Listing 13-10</a>.</p>
<span id="lis13-10"/>
<pre><code>&lt;?php&#13;
function displayHomePage(): void&#13;
{&#13;
    require_once '../templates/homePage.php';&#13;
}&#13;
&#13;
function displayContactUs(): void&#13;
{&#13;
    require_once '../templates/contactDetails.php';&#13;
}&#13;
&#13;
function displayInquiryForm(): void&#13;
{&#13;
<span aria-label="251" epub:type="pagebreak" id="pg_251" role="doc-pagebreak"/>    require_once '../templates/inquiryForm.php';&#13;
}</code></pre>
<p class="CodeListingCaption"><span class="SANS_Futura_Std_Book_Oblique_11">Listing 13-10: The functions to display the three basic pages</span></p>
<p class="TX">Each of the functions uses a <span class="SANS_TheSansMonoCd_W5Regular_11">require_once</span> statement to read in and display the contents of the corresponding template file. (We’ll make those template files next.) For example, the <span class="SANS_TheSansMonoCd_W5Regular_11">displayHomePage()</span> function reads in and displays the <i>templates/homepage.php</i> script.</p>
</section>
<section aria-labelledby="sec14" epub:type="division">
<h5 class="H3"><span id="sec14"/><span class="SANS_Futura_Std_Bold_Condensed_B_11">Creating the Page Templates</span></h5>
<p class="TNI1">We’ll now create the templates for the application’s various pages, starting with the project’s home page in <i>templates/homePage.php</i>. Create the file as shown in <a href="#lis13-11">Listing 13-11</a>.</p>
<span id="lis13-11"/>
<pre><code>&lt;!doctype html&gt;&lt;html&gt;&lt;head&gt;&lt;title&gt;MGW Home Page&lt;/title&gt;&#13;
&lt;link rel="stylesheet"&#13;
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"&#13;
&gt;&#13;
&lt;/head&gt;&lt;body class="container"&gt;&#13;
&lt;ul class="nav nav-pills"&gt; <span aria-label="annotation1" class="codewide_CodeAnnotation">❶</span>&#13;
    &lt;li class="nav-item"&gt;&lt;a class="nav-link active" href="/"&gt;Home&lt;/a&gt;&lt;/li&gt; <span aria-label="annotation2" class="codewide_CodeAnnotation">❷</span>&#13;
    &lt;li class="nav-item"&gt;&lt;a class="nav-link"&#13;
        href="/index.php?action=contact"&gt;Contact Us&lt;/a&gt;&lt;/li&gt;&#13;
    &lt;li class="nav-item"&gt;&lt;a class="nav-link"&#13;
        href="/index.php?action=inquiryForm"&gt;Inquiry Form&lt;/a&gt;&lt;/li&gt;&#13;
&lt;/ul&gt;&#13;
&#13;
&lt;h1&gt;Welcome to MGW&lt;/h1&gt;&#13;
&lt;p&gt;Great products at great prices!&lt;/p&gt;&#13;
&lt;/body&gt;&lt;/html&gt;</code></pre>
<p class="CodeListingCaption"><span class="SANS_Futura_Std_Book_Oblique_11">Listing 13-11: The</span> <span class="SANS_Futura_Std_Book_11">homePage.php</span> <span class="SANS_Futura_Std_Book_Oblique_11">template</span></p>
<p class="TX">After linking to the Bootstrap stylesheet, we create a navigation bar at the top of the page by using an unordered list with the Bootstrap <span class="SANS_TheSansMonoCd_W5Regular_11">nav</span> and <span class="SANS_TheSansMonoCd_W5Regular_11">nav-pills</span> styles <span aria-label="annotation1" class="CodeAnnotation">❶</span>. Each list item, styled with the <span class="SANS_TheSansMonoCd_W5Regular_11">nav-item</span> class, contains a link to one of the three pages. Each link is styled with the <span class="SANS_TheSansMonoCd_W5Regular_11">nav-link</span> class. The link for the currently displayed page (home) is also styled with the <span class="SANS_TheSansMonoCd_W5Regular_11">active</span> class so it will be highlighted <span aria-label="annotation2" class="CodeAnnotation">❷</span>. Notice that we include an <span class="SANS_TheSansMonoCd_W5Regular_11">action</span> query-string variable in the hyperlinks for the Contact Us and Inquiry Form pages. The hyperlink for the home page is simply a forward slash (<span class="SANS_TheSansMonoCd_W5Regular_11">/</span>). We could have used <span class="SANS_TheSansMonoCd_W5Regular_11">/index.php</span> instead, but since the <i>index.php</i> script loads by default, this isn’t necessary.</p>
<p class="TX">We can now copy our home-page script and alter its code to create the contact details page in <i>templates/contactUs.php</i>, as shown in <a href="#lis13-12">Listing 13-12</a>.</p>
<span id="lis13-12"/>
<pre><code><span class="TheSansMonoCd_W5Regular_Grey_11">&lt;!doctype html&gt;&lt;html&gt;&lt;head&gt;&lt;title&gt;</span>MGW: Contact Us<span class="TheSansMonoCd_W5Regular_Grey_11">&lt;/title&gt;</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">&lt;link rel="stylesheet"</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">&gt;</span>&#13;
<span aria-label="252" epub:type="pagebreak" id="pg_252" role="doc-pagebreak"/><span class="TheSansMonoCd_W5Regular_Grey_11">&lt;/head&gt;&lt;body class="container"&gt;</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">&lt;ul class="nav nav-pills"&gt;</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">    &lt;li class="nav-item"&gt;</span>&lt;a class="nav-link" <span class="TheSansMonoCd_W5Regular_Grey_11">href="/"&gt;Home&lt;/a&gt;&lt;/li&gt;</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">    &lt;li class="nav-item"&gt;</span>&lt;a class="nav-link active"&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">        href="/index.php?action=contact"&gt;Contact Us&lt;/a&gt;&lt;/li&gt;</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">    &lt;li class="nav-item"&gt;&lt;a class="nav-link"</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">        href="/index.php?action=inquiryForm"&gt;Inquiry Form&lt;/a&gt;&lt;/li&gt;</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">&lt;/ul&gt;</span>&#13;
&lt;h1&gt;MGW Contact Details&lt;/h1&gt;&#13;
&lt;p&gt;email: info@my-great-website.com&lt;br&gt;&#13;
   Phone: +353 1 888 2233&lt;br&gt;&#13;
   Post: 198 Main Street, Dublin, Ireland&#13;
&lt;/p&gt;&#13;
&lt;/body&gt;&lt;/html&gt;</code></pre>
<p class="CodeListingCaption"><span class="SANS_Futura_Std_Book_Oblique_11">Listing 13-12: The</span> <span class="SANS_Futura_Std_Book_11">contactUs.php</span> <span class="SANS_Futura_Std_Book_Oblique_11">template</span></p>
<p class="TX">We’ve kept the boilerplate HTML at the start of the file the same, except for changing the page title and styling the Contact Us page link in the navigation bar as <span class="SANS_TheSansMonoCd_W5Regular_11">active</span> instead of the home-page link. Then we’ve filled in some contact information for the body of the page.</p>
<p class="TX">Next, we’ll write the code for the inquiry form. Once again, start by copying one of your other templates into a new <i>templates/inquiryForm.php</i> file. Then change the page title and set the Inquiry Form link in the navigation bar to <span class="SANS_TheSansMonoCd_W5Regular_11">active</span>. Use the HTML code in <a href="#lis13-13">Listing 13-13</a> to create the inquiry form itself.</p>
<span id="lis13-13"/>
<pre><code><span class="TheSansMonoCd_W5Regular_Italic_11">--snip--</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">&lt;ul class="nav nav-pills"&gt;</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">    &lt;li class="nav-item"&gt;&lt;a class="nav-link" href="/"&gt;Home&lt;/a&gt;&lt;/li&gt;</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">    &lt;li class="nav-item"&gt;</span>&lt;a class="nav-link"&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">        href="/index.php?action=contact"&gt;Contact Us&lt;/a&gt;&lt;/li&gt;</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">    &lt;li class="nav-item"&gt;</span>&lt;a class="nav-link active" <span aria-label="annotation1" class="codewide_CodeAnnotation">❶</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">        href="/index.php?action=inquiryForm"&gt;Inquiry Form&lt;/a&gt;&lt;/li&gt;</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">&lt;/ul&gt;</span>&#13;
&#13;
&lt;h1&gt;MGW Sales Inquiry&lt;/h1&gt;&#13;
&lt;form method="POST" action="/index.php?action=processForm"&gt; <span aria-label="annotation2" class="codewide_CodeAnnotation">❷</span>&#13;
&lt;div class="form-group"&gt;&#13;
    &lt;label for="customerName"&gt;Your name&lt;/label&gt;&#13;
    &lt;input class="form-control" name="customerName" id="customerName"&gt;&#13;
&lt;/div&gt;&#13;
&#13;
&lt;div class="form-group"&gt;&#13;
    &lt;label for="customerEmail"&gt;Email address&lt;/label&gt;&#13;
    &lt;input type="email" class="form-control" name="customerEmail"&#13;
        id="customerEmail"&gt;&#13;
    &lt;small class="form-text text-muted"&gt;&#13;
        We'll never share your email with anyone else.&#13;
    &lt;/small&gt;&#13;
&lt;/div&gt;&#13;
&#13;
&lt;div class="form-group"&gt;&#13;
    &lt;label for="inquiry"&gt;Your inquiry&lt;/label&gt;&#13;
<span aria-label="253" epub:type="pagebreak" id="pg_253" role="doc-pagebreak"/>    &lt;textarea class="form-control" name="inquiry" id="inquiry" rows="3"&gt;&lt;/textarea&gt;&#13;
&lt;/div&gt;&#13;
&#13;
&lt;input type="submit" value="Submit inquiry" class="btn btn-success"&gt;&#13;
&lt;/form&gt;</code></pre>
<p class="CodeListingCaption"><span class="SANS_Futura_Std_Book_Oblique_11">Listing 13-13: The</span> <span class="SANS_Futura_Std_Book_11">inquiryForm.php</span> <span class="SANS_Futura_Std_Book_Oblique_11">template</span></p>
<p class="TX">We make the Submit an Inquiry link active in the navigation bar <span aria-label="annotation1" class="CodeAnnotation">❶</span>. We declare the form with the <span class="SANS_TheSansMonoCd_W5Regular_11">POST</span> method and define its action as <span class="SANS_TheSansMonoCd_W5Regular_11">/index.php?action=processForm</span> <span aria-label="annotation2" class="CodeAnnotation">❷</span>, so when the form is submitted, it will pass an <span class="SANS_TheSansMonoCd_W5Regular_11">action</span> query-string variable with the value <span class="SANS_TheSansMonoCd_W5Regular_11">processForm</span>. The rest of the HTML adds form inputs for a customer name, an email address, and the text of an inquiry (as a <span class="SANS_TheSansMonoCd_W5Regular_11">textarea</span> input), plus a Submit button, all decorated with more Bootstrap CSS classes.</p>
</section>
<section aria-labelledby="sec15" epub:type="division">
<h5 class="H3"><span id="sec15"/><span class="SANS_Futura_Std_Bold_Condensed_B_11">Confirming Receipt of Valid Form Data</span></h5>
<p class="TNI1">If the user enters valid data (we’ll just test for non-empty form fields for this project), we’ll display a confirmation page stating that the inquiry has been received and echoing the submitted values back to the user. One simple way to do this is to present a similar form prefilled with the submitted values, with each field set to <span class="SANS_TheSansMonoCd_W5Regular_11">disabled</span> so the user can’t edit the information and attempt to resubmit it.</p>
<p class="TX"><a href="#fig13-4">Figure 13-4</a> shows an inquiry form complete with valid values (left) and the corresponding read-only confirmation form page (right). Users will understand that the page is read-only because the boxes are grayed out, there isn’t a Submit button, and nothing happens when they click the mouse cursor in the fields.</p>
<figure class="IMG"><a id="fig13-4"/><img alt="" class="img80" height="687" src="../images/figure13-4.jpg" width="1161"/>
<figcaption><p class="CAP"><span class="SANS_Futura_Std_Book_Oblique_11">Figure 13-4: Comparing the form submission and confirmation pages</span></p></figcaption>
</figure>
<p class="TX">Enter the content in <a href="#lis13-14">Listing 13-14</a> into a new template file called <i>templates/confirmData.php</i> to create the valid form confirmation. Much of the code can be copied from the inquiry form script <i>inquiryForm.php</i>. You’ll <span aria-label="254" epub:type="pagebreak" id="pg_254" role="doc-pagebreak"/>also need to add our standard HTML head and navigation bar at the beginning of the file.</p>
<span id="lis13-14"/>
<pre><code><span class="TheSansMonoCd_W5Regular_Italic_11">--snip--</span>&#13;
&lt;h1&gt;Inquiry received&lt;/h1&gt;&#13;
&lt;p&gt;Thank you for your inquiry - we aim to respond within 2 working days.&lt;/p&gt;&#13;
&lt;p&gt;Data received:&#13;
&#13;
&lt;div class="form-group"&gt;&#13;
    &lt;label for="customerName"&gt;Your name&lt;/label&gt;&#13;
    &lt;input class="form-control" name="customerName" value="&lt;?= $customerName ?&gt;"&#13;
           id="customerName" disabled&gt; <span aria-label="annotation1" class="codewide_CodeAnnotation">❶</span>&#13;
&lt;/div&gt;&#13;
&#13;
&lt;div class="form-group"&gt;&#13;
    &lt;label for="customerEmail"&gt;Email address&lt;/label&gt;&#13;
    &lt;input type="email" class="form-control" name="customerEmail"&#13;
        id="customerEmail" value="&lt;?= $customerEmail ?&gt;" disabled &gt;&#13;
    &lt;small class="form-text text-muted"&gt;&#13;
        We'll never share your email with anyone else.&#13;
    &lt;/small&gt;&#13;
&lt;/div&gt;&#13;
&#13;
&lt;div class="form-group"&gt;&#13;
    &lt;label for="inquiry"&gt;Your inquiry&lt;/label&gt;&#13;
    &lt;textarea class="form-control" name="inquiry" rows="3" id="inquiry"&#13;
        disabled&gt; &lt;?= $inquiry ?&gt;&lt;/textarea&gt;&#13;
&lt;/div&gt;</code></pre>
<p class="CodeListingCaption"><span class="SANS_Futura_Std_Book_Oblique_11">Listing 13-14: The</span> <span class="SANS_Futura_Std_Book_11">confirmData.php</span> <span class="SANS_Futura_Std_Book_Oblique_11">template</span></p>
<p class="TX">We use the PHP short echo tag to insert the value of the <span class="SANS_TheSansMonoCd_W5Regular_11">$customerName</span> variable into the <span class="SANS_TheSansMonoCd_W5Regular_11">customerName</span> input field, setting the field to <span class="SANS_TheSansMonoCd_W5Regular_11">disabled</span> so it can’t be edited <span aria-label="annotation1" class="CodeAnnotation">❶</span>. We use the same mechanism to show the received <span class="SANS_TheSansMonoCd_W5Regular_11">$customerEmail</span> and <span class="SANS_TheSansMonoCd_W5Regular_11">$inquiry</span> values. We don’t need to add a <span class="SANS_TheSansMonoCd_W5Regular_11">&lt;form&gt;</span> element or a Submit button to this template page; we’re just echoing the data back to the user, so this isn’t an interactive form.</p>
</section>
<section aria-labelledby="sec16" epub:type="division">
<h5 class="H3"><span id="sec16"/><span class="SANS_Futura_Std_Bold_Condensed_B_11">Processing the Submitted Data</span></h5>
<p class="TNI1">Let’s now write the <span class="SANS_TheSansMonoCd_W5Regular_11">processForm()</span> function to receive the form data submitted with the <span class="SANS_TheSansMonoCd_W5Regular_11">POST</span> request and decide what to do depending on whether the data is valid. Add the function shown in <a href="#lis13-15">Listing 13-15</a> to the end of the <i>src/controllerFunctions.php</i> file (although it doesn’t actually matter in what order functions are declared in files like this).</p>
<span id="lis13-15"/>
<pre><code><span class="TheSansMonoCd_W5Regular_Italic_11">--snip--</span>&#13;
function processForm(): void&#13;
{&#13;
  <span aria-label="annotation1" class="Code_CodeAnnotation">❶</span> $customerName = filter_input(INPUT_POST, 'customerName',&#13;
                                 FILTER_SANITIZE_SPECIAL_CHARS);&#13;
    $customerEmail = filter_input(INPUT_POST, 'customerEmail',&#13;
                                  FILTER_SANITIZE_EMAIL);&#13;
<span aria-label="255" epub:type="pagebreak" id="pg_255" role="doc-pagebreak"/>    $inquiry = filter_input(INPUT_POST, 'inquiry',&#13;
                            FILTER_SANITIZE_SPECIAL_CHARS);&#13;
&#13;
  <span aria-label="annotation2" class="Code_CodeAnnotation">❷</span> $errors = [];&#13;
    if (empty($customerName)) {&#13;
        $errors[] = 'missing customer name';&#13;
    }&#13;
&#13;
    if (empty($customerEmail)) {&#13;
        $errors[] = 'missing or invalid customer email';&#13;
    }&#13;
&#13;
    if (empty($inquiry)) {&#13;
        $errors[] = 'missing inquiry message';&#13;
    }&#13;
&#13;
  <span aria-label="annotation3" class="Code_CodeAnnotation">❸</span> if (sizeof($errors) &gt; 0) {&#13;
        require_once '../templates/displayError.php';&#13;
    } else {&#13;
        confirmData($customerName, $customerEmail, $inquiry);&#13;
    }&#13;
}</code></pre>
<p class="CodeListingCaption"><span class="SANS_Futura_Std_Book_Oblique_11">Listing 13-15: A function to process the form data</span></p>
<p class="TX">First, we use three <span class="SANS_TheSansMonoCd_W5Regular_11">filter_input()</span> calls <span aria-label="annotation1" class="CodeAnnotation">❶</span> to attempt to extract the received <span class="SANS_TheSansMonoCd_W5Regular_11">POST</span> form data for the three expected values. Notice that for the two strings (name and inquiry), we use a <span class="SANS_TheSansMonoCd_W5Regular_11">FILTER_SANITIZE_SPECIAL_CHAR</span> filter as the third function argument, and we use <span class="SANS_TheSansMonoCd_W5Regular_11">FILTER_SANITIZE_EMAIL</span> for the customer email input. These filters remove any unsafe characters submitted through the form, protecting against cross-site scripting (XSS) attacks, where JavaScript code is submitted through forms to attempt to gain entry to website data.</p>
<p class="TX">We next implement the array-based approach to data validation discussed in <span class="Xref"><a href="chapter12.xhtml">Chapter 12</a></span>. We declare <span class="SANS_TheSansMonoCd_W5Regular_11">$errors</span> as an empty array <span aria-label="annotation2" class="CodeAnnotation">❷</span>, then use three <span class="SANS_TheSansMonoCd_W5Regular_11">if</span> statements to test whether any of the received form variables are empty, adding an appropriate error message to the array if necessary. Finally, we test the size of the <span class="SANS_TheSansMonoCd_W5Regular_11">$errors</span> array <span aria-label="annotation3" class="CodeAnnotation">❸</span>, and if any errors have been found, we display the file <i>templates/displayError.php</i> (which we’ll create next). Otherwise, if the submitted data is all valid, we invoke the <span class="SANS_TheSansMonoCd_W5Regular_11">confirmData()</span> function, passing <span class="SANS_TheSansMonoCd_W5Regular_11">$customerName</span>, <span class="SANS_TheSansMonoCd_W5Regular_11">$customerEmail</span>, and <span class="SANS_TheSansMonoCd_W5Regular_11">$inquiry</span> as arguments. <a href="#lis13-16">Listing 13-16</a> shows the code for this function. Enter the code at the end of <i>src/controllerFunctions.php</i>.</p>
<span id="lis13-16"/>
<pre><code>function confirmData($customerName, $customerEmail, $inquiry): void&#13;
{&#13;
    require_once '../templates/confirmData.php';&#13;
}</code></pre>
<p class="CodeListingCaption"><span class="SANS_Futura_Std_Book_Oblique_11">Listing 13-16: A function confirming valid data to the user</span></p>
<p class="TX"><span aria-label="256" epub:type="pagebreak" id="pg_256" role="doc-pagebreak"/>This function reads in and executes the <i>templates/confirmData.php</i> file. As before, the function must take in the variables needed within the template script as parameters.</p>
</section>
<section aria-labelledby="sec17" epub:type="division">
<h5 class="H3"><span id="sec17"/><span class="SANS_Futura_Std_Bold_Condensed_B_11">Creating the Error Page</span></h5>
<p class="TNI1">As a final step, we need to create the template file for a page displaying any error messages to the user. <a href="#fig13-5">Figure 13-5</a> shows this error page when all three validation checks have failed.</p>
<figure class="IMG"><a id="fig13-5"/><img alt="" class="img80" height="469" src="../images/figure13-5.jpg" width="1228"/>
<figcaption><p class="CAP"><span class="SANS_Futura_Std_Book_Oblique_11">Figure 13-5: The error page</span></p></figcaption>
</figure>
<p class="TX">Create a new file called <i>templates/displayError.php</i> containing the error output script shown in <a href="#lis13-17">Listing 13-17</a>. Once again, you’ll have to also add the standard HTML head and navigation bar code to the start of the script.</p>
<span id="lis13-17"/>
<pre><code><span class="TheSansMonoCd_W5Regular_Italic_11">--snip--</span>&#13;
&lt;h1&gt;Errors in data for inquiry form&lt;/h1&gt;&#13;
<span aria-label="annotation1" class="codeannotated_CodeAnnotation">❶</span> &lt;div class="alert alert-danger" role="alert"&gt;&#13;
    Sorry, there was a problem with your form submission:&#13;
&#13;
    &lt;ul&gt;&#13;
      <span aria-label="annotation2" class="Code_CodeAnnotation">❷</span> &lt;?php foreach ($errors as $error): ?&gt;&#13;
          <span aria-label="annotation3" class="Code_CodeAnnotation">❸</span> &lt;li&gt;&lt;?= $error ?&gt;&lt;/li&gt;&#13;
        &lt;?php endforeach; ?&gt;&#13;
    &lt;/ul&gt;&#13;
&lt;/div&gt;</code></pre>
<p class="CodeListingCaption"><span class="SANS_Futura_Std_Book_Oblique_11">Listing 13-17: A</span> <span class="SANS_Futura_Std_Book_11">displayError.php</span> <span class="SANS_Futura_Std_Book_Oblique_11">template</span></p>
<p class="TX">We set the CSS style of the page’s main <span class="SANS_TheSansMonoCd_W5Regular_11">&lt;div&gt;</span> to the Bootstrap classes <span class="SANS_TheSansMonoCd_W5Regular_11">"alert alert-danger"</span> <span aria-label="annotation1" class="CodeAnnotation">❶</span>, a typical website error style with a pink background. Then we use a <span class="SANS_TheSansMonoCd_W5Regular_11">foreach</span> loop with alternative syntax to cycle through each message in the <span class="SANS_TheSansMonoCd_W5Regular_11">$errors</span> array <span aria-label="annotation2" class="CodeAnnotation">❷</span> and display it as a list item <span aria-label="annotation3" class="CodeAnnotation">❸</span>.</p>
</section>
</section>
</section>
<section aria-labelledby="sec18" epub:type="division">
<span aria-label="257" epub:type="pagebreak" id="pg_257" role="doc-pagebreak"/>
<h3 class="H1"><span id="sec18"/><span id="toc-link_189"/><span class="SANS_Futura_Std_Bold_B_11">Summary</span></h3>
<p class="TNI1">In this chapter, we’ve worked toward a well-organized and extensible web application architecture, which we’ve applied to a multipage website featuring both static pages and a web form. The architecture hinges on a single <i>public/index.php</i> front-controller script, which at its core is a straightforward <span class="SANS_TheSansMonoCd_W5Regular_11">switch</span> statement deciding what to do based on the <span class="SANS_TheSansMonoCd_W5Regular_11">action</span> query-string variable sent with each incoming HTTP request. We’ve delegated other, more granular logic to custom functions, which we’ve safely declared outside the <i>public</i> folder in <i>src/controllerFunctions.php</i>. Meanwhile, all the scripts that output HTML content to the user are located in the <i>templates</i> folder. These scripts harness Bootstrap CSS to achieve professional-looking formatting with minimal code.</p>
<p class="TX">Although this project has many more pages and features than the previous form-processing projects from the last few chapters, none of our scripts or functions are complex or long-winded, demonstrating that the architecture we’ve adopted is suitable for more sophisticated websites, while still being readily understandable and easy to maintain.</p>
</section>
<section aria-labelledby="sec19" epub:type="division">
<h3 class="H1"><span id="sec19"/><span id="toc-link_190"/><span class="SANS_Futura_Std_Bold_B_11">Exercises</span></h3>
<p class="ListNumber">1.   Create a website containing four simple page templates (no forms): a home page (<i>home.php</i>), an about page (<i>about.php</i>), a contact details page (<i>contact.php</i>), and a customer recommendations page (<i>recommendations.php</i>). These pages should be accessed from the index page through the value of the <span class="SANS_TheSansMonoCd_W5Regular_11">action</span> query-string parameter, like this:</p>
<pre><code>index.php?action=home&#13;
index.php?action=about&#13;
index.php?action=contact&#13;
index.php?action=recommendations</code></pre>
<p class="ListBody">Structure your project by using the front-controller architecture demonstrated in this chapter and the functions declared in <i>src/controllerFunctions.php</i>. You should have the following file structure:</p>
<figure class="IMG-1"><img alt="" class="img100" height="449" src="../images/pg257.jpg" width="1373"/>
</figure>
<p class="ListNumber"><span aria-label="258" epub:type="pagebreak" id="pg_258" role="doc-pagebreak"/>2.   Using the front-controller architecture from this chapter, create a new website with a home-page template (<i>home.php</i>), containing a link to a staff login page. The staff login page template (<i>loginStaff.php</i>) should display a standard username/password login form. The values for a successful staff login are the username <span class="SANS_TheSansMonoCd_W5Regular_11">author</span> and the password <span class="SANS_TheSansMonoCd_W5Regular_11">words</span>. If correct values are entered, display a staff login success page (<i>successStaff.php</i>), but if the received username and password don’t match the correct ones, display a login error page (<i>loginError.php</i>). The error page should contain a link back to the home page.</p>
<p class="ListBody">The website pages should be accessed from the index page through the value of the <span class="SANS_TheSansMonoCd_W5Regular_11">action</span> query-string parameter, like this:</p>
<pre><code>index.php?action=home&#13;
index.php?action=loginStaff</code></pre>
<p class="ListNumber">3.   Copy and extend your solution for Exercise 2, adding a second login page for clients (<i>loginClient.php</i>), with a link to this page also offered on the home page. Values for the client login are the username <span class="SANS_TheSansMonoCd_W5Regular_11">customer</span> and the password <span class="SANS_TheSansMonoCd_W5Regular_11">paying</span>. If correct client login values are received, display a client login success page (<i>successClient.php</i>), but if the values are invalid, display the login error page (<i>loginError.php</i>).</p>
<p class="ListBody">The website pages should be accessed from the index page through the value of the <span class="SANS_TheSansMonoCd_W5Regular_11">action</span> query-string parameter, like this:</p>
<pre><code>index.php?action=home&#13;
index.php?action=loginStaff&#13;
index.php?action=loginClient</code></pre>
<p class="ListNumber">4.   Copy and extend your solution for Exercise 3, placing the staff and client login forms into the home page. The home page should contain welcome text and two login forms, one for staff and one for clients.</p>
<p class="ListNumber">5.   Copy and extend your solution for Exercise 4, now offering a single login form on the home page, but two Submit buttons: one for staff and one for clients.</p>
<p class="ListBody">Hint: See <span class="Xref"><a href="chapter11.xhtml">Chapter 11</a></span> to review how to detect which of the two Submit buttons has been clicked.</p>
</section>
</section>
</div></body></html>