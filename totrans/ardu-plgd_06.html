<html><head></head><body>
<h2 class="h2" id="ch05"><span epub:type="pagebreak" id="page_129"/><strong><span class="big">5</span><br/>THE GARAGE SENTRY PARKING ASSISTANT</strong></h2>&#13;
<div class="image1"><img alt="image" src="../images/common-01.jpg"/></div>&#13;
<p class="noindent">This project is a reliable electronic device to gauge the distance you need to pull your car into your garage. If you park in a garage, you’re probably familiar with the problem: how far do you pull your car into the garage to make sure there’s room in front for whatever is there and enough space behind so the garage door will close? Some people suspend a tennis ball on a string from the ceiling and stop at the point when the ball meets the windshield. That works fine, but the ball is a pain to set up and adjust, and it often gets in the way if you want to use the garage for something other than parking the car.</p>&#13;
<p class="indent">Arduino offers a better solution. This Garage Sentry project is the electronic version of the classic tennis-ball-on-a-string device, only better. The Garage Sentry accurately detects when your car reaches exactly the right position in the garage and sets off an alarm that blinks so you know when to hit the brakes.</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_130"/>In addition, at the end of the chapter, I’ll show you how to modify the basic Garage Sentry into a deluxe version that alerts you when you’re getting close to the perfect stopping point.</p>&#13;
<div class="box1">&#13;
<p class="boxtitle"><strong>INSPIRATION BEHIND THE GARAGE SENTRY</strong></p>&#13;
<p class="noindent">This project evolved out of playing with an <em>ultrasonic transceiver module</em>, a device that emits sound waves and then detects them after they travel to an object, reflect off that object, and travel back to the module. The output of the module allows a microcontroller to measure the time it takes to travel to and from the object and, knowing the speed of sound, determine the distance. To test the ultrasonic transceiver’s sensitivity and limits, I used the battery-operated breadboard version in my garage, which had enough space to move objects around for different distances. It turns out cars are great reflectors for ultrasonic energy. From this experimentation, I was inspired to turn my test apparatus into a Garage Sentry.</p>&#13;
</div>&#13;
<h3 class="h3" id="ch05lev1sec1"><strong>Required Tools</strong></h3>&#13;
<p class="noindentb">This project doesn’t require many tools or materials, but you will need the following tools for both the standard and deluxe versions:</p>&#13;
<p class="uln">Drill with a 3/8-inch or 1/2-inch chuck (powered by battery or with 110/220V from the wall)</p>&#13;
<p class="uln">Drill bits for potentiometer (9/32 inches), power input (1/4 inches), and LED (3/8 inches)</p>&#13;
<p class="uln">Soldering iron and solder</p>&#13;
<p class="uln">Tapered reamer set</p>&#13;
<p class="uln">Philips head and slotted screwdrivers</p>&#13;
<p class="uln">Pliers (I recommend needle nose.)</p>&#13;
<p class="uln">(Optional) 1/4-inch tap</p>&#13;
<h3 class="h3" id="ch05lev1sec2"><strong>Parts List</strong></h3>&#13;
<p class="noindentb">You’ll need the following parts to build the basic Garage Sentry:</p>&#13;
<p class="uln">One Arduino Nano (or clone)</p>&#13;
<p class="uln">One HC-SR04 ultrasonic sensor</p>&#13;
<p class="uln">Two high-intensity LEDs (&gt;12,000 MCD)</p>&#13;
<p class="uln"><span epub:type="pagebreak" id="page_131"/>Two 270-ohm, 1/4 W (or more) resistors (to limit current to the LEDs)</p>&#13;
<p class="uln">One 20-ohm, 1/8 W potentiometer</p>&#13;
<p class="uln">Two NPN-signal transistors rated for a collector current of at least 1.5 A (I used ZTX649 transistors.)</p>&#13;
<p class="uln">One enclosure (I recommend a blue Hammond 1591 ATBU, clear 1591 ATCL, or something similar.)</p>&#13;
<p class="uln">(Optional) One 0.80-inch aluminum strip for mounting bracket</p>&#13;
<p class="uln">(Optional) Two 1/4-inch × 20-inch × 3/4-inch bolts with nuts</p>&#13;
<p class="uln">One section (approximately 1×1 inch) perforated board (can include copper-foil rings on one side)</p>&#13;
<p class="uln">One 3.5 mm jack</p>&#13;
<p class="uln">Two 2-56×3/8-inch screws and nuts</p>&#13;
<p class="uln">Two additional 2-56 nuts to use as spacers</p>&#13;
<p class="uln">One 9V, 100 mA plug-in wall adapter power supply (Anything from 7.5V to 12V DC at 100 mA or upward should work well.)</p>&#13;
<p class="uln">One piece of double-sided foam tape about 3-inches long</p>&#13;
<p class="uln">One LM78L05 (TO-92 package) regulator (for the breadboard build only)</p>&#13;
<p class="uln">28- or 30-gauge hookup wire</p>&#13;
<p class="uln">(Optional) Wire-wrap tool and wire</p>&#13;
<p class="indentt">Because the basic version doesn’t require a lot of additional components, I suggest building the circuit on a standard perforated circuit board instead of a shield. To power your circuit, you can use a 9V, 100 mA wall adapter plugged into a 3.5 mm jack (see <a href="ch05.xhtml#ch05fig1">Figure 5-1</a>). You shouldn’t need an on/off switch.</p>&#13;
<div class="image"><img alt="image" src="../images/f05-01.jpg"/></div>&#13;
<p class="figcap"><a id="ch05fig1"/><em>Figure 5-1: I used a Magnavox AC adapter, but any similar power supply with a DC output from 7.5V to 12V should work. These are readily available online and cost from under $1.00 to about $3.00</em>.</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_132"/>Be sure to use two bright LEDs that are clearly visible, even when a car’s headlights are on. Bright LEDs range from 10,000 MCD (milli candela) to more than 200,000 MCD. The brighter, the better; just remember that brighter LEDs require more power, so the current-limiting resistor will need a higher power rating for the brighter lamps. The 270-ohm current-limiting resistors result in a current drain of about 30–40 mA each with the 12,000 MCD LEDs I used at 5V. (Power equals volts times amps, or <em>P</em> = <em>VI</em>, so at 40 mA and 5V, you’d have 0.20 W.) It’s best to use a 1/2 W or greater resistor even though you can easily get by with a smaller value—as I did with 1/4 W—because the LEDs are on only intermittently.</p>&#13;
<h3 class="h3" id="ch05lev1sec3"><strong>Deluxe Parts</strong></h3>&#13;
<p class="noindentb">In addition to the components for the basic Garage Sentry, you’ll need the following extra components if you want to build the deluxe version:</p>&#13;
<p class="uln">Two high-intensity green LEDs</p>&#13;
<p class="uln">Two high-intensity amber LEDs</p>&#13;
<p class="uln">Two additional 270-ohm, 1/4 W resistors</p>&#13;
<p class="uln">Two additional NPN-signal transistors One Hammond 1591 BTCL enclosure (to replace the 1591 ATCL)</p>&#13;
<p class="uln">One PCB (shield)</p>&#13;
<h3 class="h3" id="ch05lev1sec4"><strong>Downloads</strong></h3>&#13;
<p class="uln"><strong>Sketches</strong>    <em>GarageSentry.ino</em> and <em>GarageSentryDeluxe.ino</em></p>&#13;
<p class="uln"><strong>Drilling template</strong>    <em>Transducer.pdf</em></p>&#13;
<p class="uln"><strong>Mechanical drawing</strong>    <em>Handle.pdf</em></p>&#13;
<p class="uln"><strong>Shield file for Deluxe Garage Sentry</strong>    <em>GarageSentryDeluxe.pcb</em></p>&#13;
<h3 class="h3" id="ch05lev1sec5"><strong>The Schematic</strong></h3>&#13;
<p class="noindent"><a href="ch05.xhtml#ch05fig2">Figure 5-2</a> shows the schematic for the Garage Sentry. R1 and R3 are the 270-ohm resistors for the LEDs and should be 1/4 W or larger. If a higher wattage resistor is not available, you could place several resistors in parallel to gain the required wattage. First, find the right resistor value with the formula:</p>&#13;
<div class="center"><img alt="image" src="../images/e0132-01.jpg"/></div>&#13;
<p class="indent">You can also use an automatic calculator, such as the one at <em><a href="http://www.1728.org/resistrs.htm">http://www.1728.org/resistrs.htm</a></em>, which is a lot easier than doing the math yourself.</p>&#13;
<div class="image"><span epub:type="pagebreak" id="page_133"/><img alt="image" src="../images/f05-02.jpg"/></div>&#13;
<p class="figcap"><a id="ch05fig2"/><em>Figure 5-2: Schematic diagram of the Garage Sentry</em></p>&#13;
<p class="indent">To avoid extra calculations, select resistors of the same value. This way, the same amount of current flows through each one. For example, two 1/8 W resistors in parallel will give you a 1/4 W value.</p>&#13;
<p class="indent">If you do use resistors of different values, you will have to calculate the current flowing through each and the total dissipation.</p>&#13;
<p class="indent">This schematic also leaves you with room to customize your alarm. While this version of the project uses LEDs to create a visual alarm, with a slight modification, you can easily create an audible alarm as well. Simply replace either the red or blue LED with an audible device, such as a Sonotone Sonalert, and the alarm will sound. To replace an LED, you would need to connect the Sonalert across that LED’s connections; just make sure to get the polarity correct. Alternatively, you could keep both LEDs and add an audible device for a third warning.</p>&#13;
<div class="note">&#13;
<p class="notet"><strong><span class="bgblack">NOTE</span></strong></p>&#13;
<p class="notep"><em>In this project, the Nano takes advantage of its on-board voltage regulator, which is why there’s no external regulator in the schematic</em>.</p>&#13;
</div>&#13;
<h3 class="h3" id="ch05lev1sec6"><strong>Basics of Calculating Distance</strong></h3>&#13;
<p class="noindent">This project measures the time it takes for a sound to originate, bounce off an object, and be received back at the point of origin, and it uses that time to calculate the distance between the object and the sensor.</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_134"/>The basic distance calculation is not much different from determining the distance of a storm by counting the seconds between a lightning flash and a thunderclap. Each second represents a distance of 1,125 feet, or about 0.2 miles. Given that sound travels at 1,125 feet per second in air at sea level, if there’s a five-second delay between a lightning flash and the thunderclap, you can determine that the storm is roughly a mile away. In the case of the Garage Sentry, once you know how long it takes for the sound to make a round trip and know the speed of sound, you can calculate the distance according to the time-speed-distance formula:</p>&#13;
<p class="center">Distance = Speed × Time</p>&#13;
<h3 class="h3" id="ch05lev1sec7"><strong>How the Garage Sentry Works</strong></h3>&#13;
<p class="noindent">This project takes advantage of <em>ultrasonic sound</em>, which, unlike thunder, is above the hearing range of most individuals. If your hearing is good, you can detect sound ranging from about 30 Hz to close to 20 kHz, although hearing attenuates quickly above 10 kHz or 15 kHz.</p>&#13;
<div class="note">&#13;
<p class="notet"><strong><span class="bgblack">NOTE</span></strong></p>&#13;
<p class="notep"><em>For reference, middle C on the piano is 261.6 Hz. Young children (and most dogs) can often hear high frequencies, but hearing, especially in the upper registers, deteriorates quickly with age</em>.</p>&#13;
</div>&#13;
<p class="indent">The ultrasonic transceiver module used in this project sends out pulses at a frequency of about 25 kHz and listens for an echo with a microphone. If there is something for the signal to bounce off, the system receives the return echo and tells the microcontroller a signal has been received and to calculate the distance. For the Garage Sentry, the unit is placed in the front of the garage, and the signal is sent out to bounce off the front—or rear if you are backing in—of your vehicle. To calculate your car’s distance from the ultrasonic transceiver, the Arduino measures the time it takes for the signal’s round trip from the transceiver to the target and back. For example, if the Arduino measures a time of 10 milliseconds (0.010 seconds), you might calculate the distance as:</p>&#13;
<div class="center"><img alt="image" src="../images/e0134-01.jpg"/></div>&#13;
<p class="indent">Ah, but not so fast. Remember the signal is traveling to the car and then back to the microphone. To get the correct distance to the vehicle, we will have to divide by two. If the controller measures 10 milliseconds, then the distance to your car would be:</p>&#13;
<div class="center"><img alt="image" src="../images/e0134-02.jpg"/></div>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_135"/>The HC-SR04 ultrasonic module sends out a signal at the instruction of the Arduino (see <a href="ch05.xhtml#ch05fig3">Figure 5-3</a>). Then, the sketch instructs the transmitter to shut down, and the microphone listens for an echo.</p>&#13;
<div class="image"><img alt="image" src="../images/f05-03.jpg"/></div>&#13;
<p class="figcap"><a id="ch05fig3"/><em>Figure 5-3: The ultrasonic sensor module. The back of the module (bottom) has connection terminals at the bottom</em>.</p>&#13;
<p class="indent">If there is an object for the signal to bounce off, the microphone picks up the reflected signal. The Arduino marks the exact time the signal is sent out and the time it is received and then calculates the delay.</p>&#13;
<p class="indent">The HC-SR04 module is more than a speaker and microphone, though. The module includes transducers—a loudspeaker and mic—and a lot of electronics, including at least three integrated circuits, a crystal, and several passive components. These components simplify its interface to the Arduino: the 25 kHz tone is actually generated by the module and turned on and off with the microcontroller. Some of the components also enhance the receiver’s, or the microphone’s, sensitivity, which gives it a better range.</p>&#13;
<p class="indent">The range of the HC-SR04 ultrasonic transducer is approximately 10 to 12 feet. The returning signal is always a lot weaker than the transmitted signal because some of the sound wave’s energy dissipates in the air (see the dotted lines in <a href="ch05.xhtml#ch05fig4">Figure 5-4</a>).</p>&#13;
<div class="image"><span epub:type="pagebreak" id="page_136"/><img alt="image" src="../images/f05-04.jpg"/></div>&#13;
<p class="figcap"><a id="ch05fig4"/><em>Figure 5-4: In this project, sound is transmitted from a sender, bounces off an object, and is received</em>.</p>&#13;
<p class="indent">The arithmetic to calculate the distance between the sender and the object is not difficult. You take the number of microseconds it takes for the signal to return, divide by the 73.746 microseconds it takes sound to travel an inch, and then divide by two because the signal is going out and coming back. The full arithmetic for this appears later in “<a href="ch05.xhtml#ch05lev2sec3">Determining Distance</a>” on <a href="ch05.xhtml#page_141">page 141</a>.</p>&#13;
<p class="indent">The sketch provides a response in inches or centimeters depending on your preference. We’ll use inches for setting up the distance for the alarm, but converting to centimeters simply requires a remapping of the analog input and setting the numbers a bit differently. The sketch also does the basic arithmetic for determining the centimeter measurement for you.</p>&#13;
<p class="indent">With the high-level overview out of the way, let’s dig in to how you’ll wire the Garage Sentry.</p>&#13;
<h3 class="h3" id="ch05lev1sec8"><strong>The Breadboard</strong></h3>&#13;
<p class="noindent">The entire Garage Sentry fits on a small breadboard, so you can set it up, program it, power it with a battery, and walk around to test it out. As you play with it, I’m sure other applications of ultrasonic technology will come to mind.</p>&#13;
<p class="indent">The breadboard I assembled, shown in <a href="ch05.xhtml#ch05fig5">Figure 5-5</a>, is powered by a 9V battery. Usually, you could wire the battery directly to the VIN of the Nano and use the Nano’s built-in voltage regulator. But you’ll power the Nano with a USB cable when you program and test it for the first time, so on the breadboard, you’ll set up the positive and negative rails for 5V for both the Nano and the ultrasonic module. To avoid risking damage to the Nano or the module and avoid overcomplicating the build, I included a single-chip external voltage regulator (LM78L05) so the entire breadboard runs on 5V. Take a look at <a href="ch05.xhtml#ch05fig6">Figure 5-6</a> to see how it’s wired up.</p>&#13;
<div class="image"><span epub:type="pagebreak" id="page_137"/><img alt="image" src="../images/f05-05.jpg"/></div>&#13;
<p class="figcap"><a id="ch05fig5"/><em>Figure 5-5: Here’s the breadboard wired up. I used a 9V battery so I could experiment in different environments. Both LEDs look illuminated because of the length of the exposure of the camera</em>.</p>&#13;
<div class="image"><img alt="image" src="../images/f05-06.jpg"/></div>&#13;
<p class="figcap"><a id="ch05fig6"/><em>Figure 5-6: This is how the LM78L05 TO-92 regulator is wired up on the breadboard. Bypass/filter capacitors are not required</em>.</p>&#13;
<p class="indent">Here’s a blow-by-blow list of the steps to wire the breadboard:</p>&#13;
<ol>&#13;
<li><p class="noindent">First, put the ultrasonic module at the lower end of the breadboard facing out, and plug the Nano in to the breadboard, leaving four rows of connections above it.</p></li>&#13;
<li><p class="noindent">Make sure the positive and negative rails (red and blue stripes) on the left and right are connected properly—red to red, blue to blue. If you connect red to blue, it will cause a major problem.</p></li>&#13;
<li><p class="noindent">Connect the red positive rail to the 5V power supply (pin 27 of the Nano, labeled <em>5V</em>). This is necessary if you are operating from the USB connector.</p></li>&#13;
<li><p class="noindent">Connect pin 4 of the Nano (labeled <em>GND</em>) to the breadboard’s blue negative rail.</p></li>&#13;
<li><p class="noindent">Connect VCC of the HC-SR04 transducer to the red positive rail.</p></li>&#13;
<li><p class="noindent">Connect GND of the HC-SR04 transducer to the blue negative rail.</p></li>&#13;
<li><p class="noindent"><span epub:type="pagebreak" id="page_138"/>Connect TRIG of the HC-SR04 transducer to pin 15 (D12) of the Nano.</p></li>&#13;
<li><p class="noindent">Connect ECHO of the HC-SR04 transducer to pin 14 (D11) of the Nano.</p></li>&#13;
<li><p class="noindent">Insert two ZTX649 transistors into the breadboard. Select an area where all three pins of each transistor can have their own row.</p></li>&#13;
<li><p class="noindent">Connect pin 12 (D9) of the Nano to the base of transistor Q1.</p></li>&#13;
<li><p class="noindent">Connect pin 13 (D10) of the Nano to the base of transistor Q2.</p></li>&#13;
<li><p class="noindent">Connect the collectors of both transistors to the red positive rail.</p></li>&#13;
<li><p class="noindent">Connect the emitter of transistor Q1 to one end of a 270-ohm resistor.</p></li>&#13;
<li><p class="noindent">Connect the other end of the 270-ohm resistor connected to the emitter of transistor Q1 to a blank row on the breadboard.</p></li>&#13;
<li><p class="noindent">Connect the emitter of transistor Q2 to one end of another 270-ohm resistor. Connect the other end of the 270-ohm resistor connected to the emitter of transistor Q2 to another blank row on the breadboard.</p></li>&#13;
<li><p class="noindent">Connect the + (long end) of LED (D1) to the 270-ohm resistor and the other end to the blue negative rail.</p></li>&#13;
<li><p class="noindent">Connect the + (long end) of LED (D2) to the second 270-ohm resistor and the other end to the blue negative rail.</p></li>&#13;
<li><p class="noindent">Connect one end of the 20-ohm potentiometer to the red positive rail.</p></li>&#13;
<li><p class="noindent">Connect the opposite end of the potentiometer to the blue negative rail.</p></li>&#13;
<li><p class="noindent">Connect the wiper (center) of the potentiometer to analog pin A0 (26) of the Nano.</p></li>&#13;
</ol>&#13;
<div class="image"><img alt="image" src="../images/f05-07.jpg"/></div>&#13;
<p class="figcap"><a id="ch05fig7"/><em>Figure 5-7: Pinout of the 78L05 regulator</em></p>&#13;
<p class="indent">You should be good to go! If you use the AC connection, simply connect it to the VCC connection of the Nano.</p>&#13;
<p class="indent">To add a battery connection, include the 78L05 with its center pin to ground (negative rail), the input to the positive side of the battery, and the output to the positive rail (see <a href="ch05.xhtml#ch05fig7">Figure 5-7</a>). Connect the negative terminal of the battery to the negative rail.</p>&#13;
<h3 class="h3" id="ch05lev1sec9"><strong>The Sketch</strong></h3>&#13;
<p class="noindent">Once the breadboard is complete, the sketch can be loaded onto the Nano. Download the <em>GarageSentry.ino</em> file from <em><a href="https://www.nostarch.com/arduinoplayground/">https://www.nostarch.com/arduinoplayground/</a></em>. To load the file onto the Nano, follow the instructions outlined in “<a href="ch00.xhtml#ch00lev1sec3">Uploading Sketches to Your Arduino</a>” on <a href="ch00.xhtml#page_5">page 5</a>. Remember to select the correct board type. Once it’s loaded, the unit is ready for experimentation.</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_139"/>The sketch for the Garage Sentry serves several functions. It tells the ultrasonic sensor to generate a wave and detects how long it takes the echo to return. It then calculates the distance based on that time and, if necessary, alerts you to stop by turning on the LEDs. Here’s the sketch in full; I’ll walk you through it next.</p>&#13;
<pre>    <br/>      /* Garage Sentry  <br/>      */  <br/><br/>      int ledPin = 10;  <br/>      int ledPin1 = 9;  <br/>      int count;  <br/>      int analogPin = A0;  <br/>      int val;  <br/>      int y;  <br/><br/>      void setup() {  <br/>        Serial.begin(9600);  <br/>        pinMode(ledPin, OUTPUT);  <br/>        pinMode(ledPin1, OUTPUT);  <br/>        pinMode(analogPin, INPUT);  <br/>      }  <br/><br/>      void loop() {  <br/>        val = analogRead(analogPin);  <br/>        long duration, inches, cm;  <br/>        //Give a short LOW pulse beforehand to ensure a clean HIGH pulse:  <br/><span class="ent">➊</span>   pinMode(12, OUTPUT);  //Attach pin 12 to TRIG  <br/>        digitalWrite(12, LOW);  <br/>        delayMicroseconds(2);  <br/>        digitalWrite(12, HIGH);  <br/>        delayMicroseconds(5);  <br/>        digitalWrite(12, LOW);  <br/><br/>        pinMode(11, INPUT);  //Pin 11 to receive ECHO  <br/>        duration = pulseIn(11, HIGH);  <br/><br/>        //Convert the time into a distance  <br/>        inches = microsecondsToInches(duration);  <br/>        cm = microsecondsToCentimeters(duration);  <br/>        val = map(val, 0, 1023, 0, 100);  <br/>        if(inches == 0)  <br/>          digitalWrite(ledPin, LOW);  <br/><br/>        if(count == 0  inches &gt; 0  inches &lt; val) {  <br/><span class="ent">➋</span>      for(y = 0; y &lt; 200; y++)  <br/>         {  <br/>           digitalWrite(ledPin, HIGH);  <br/>           digitalWrite(ledPin1, LOW);  <br/>           delay(100);  <br/>           digitalWrite(ledPin, LOW);  <br/>           digitalWrite(ledPin1, HIGH);  <br/>           delay(100);  <br/>         }  <br/><br/>        count = count + 1;    <br/>      }    <br/><br/>      digitalWrite(ledPin1, LOW);    <br/>      if(inches &gt; 10) {    <br/>        //delay(1000);    <br/>        count = 0;    <br/>      }    <br/>      Serial.print(inches);    <br/>      Serial.print("   inches ");    <br/>      Serial.print(count);    <br/>      Serial.print(" count   ");    <br/>      Serial.println();    <br/>      Serial.print(" Val       ");    <br/>      Serial.println (val);    <br/>      delay(100);    <br/>  }    <br/>  long microsecondsToInches(long microseconds) {    <br/>    return microseconds / 74 / 2;    <br/>  }    <br/>  long microsecondsToCentimeters(long microseconds) {    <br/>    return microseconds / 29 / 2;    <br/>  }</pre>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_140"/>First, we define several variables, establish parameters, and load libraries (if any). In this case, define <code>ledPin</code> and <code>ledPin1</code>, which will serve as the alarm. Other definitions (<code>int</code>) include <code>cm</code> and <code>count</code> (a variable that will be used internally), <code>analogPin</code> (as A0), <code>val</code> (to hold the limit information), and <code>y</code> (used in the loop).</p>&#13;
<h4 class="h4" id="ch05lev2sec1"><em><strong>Inside the setup() Function</strong></em></h4>&#13;
<p class="noindent">Next is the <code>setup()</code> function. Here, you set up Arduino features that you might want to use; this sketch includes the serial monitor, which you probably will not need in the final product but is often useful in debugging code, particularly if you want to change the code. This sketch sets the rate of the monitor at 9600 baud, which is standard in many applications. It also defines the mode of the pins you’ll use as either input or output. You could set the <code>pinMode</code> values at almost any point in the code, including before or inside the setup; they’re also often defined within the main loop, particularly if the definitions are expected to change.</p>&#13;
<h4 class="h4" id="ch05lev2sec2"><em><strong>Inside the loop() Function</strong></em></h4>&#13;
<p class="noindent">The <code>loop()</code> function is where everything really happens. The loop continually executes unless it’s delayed or halted by a command. So even when it appears that nothing is happening, the controller is continually cycling <span epub:type="pagebreak" id="page_141"/>through the code. In this application, one of the first tasks the controller performs in the loop is to set the variable <code>val</code> to store the input from the potentiometer connected to the analog pin (<code>analogPin</code>).</p>&#13;
<p class="indent">In order to initiate the ultrasonic module’s transmit/receive function, the sketch first calls for a low signal to be sent to the transmitter (<code>TRIG</code>) to purge the module to assure that the following high signal will be clean. You can see this in the lines starting at <span class="ent">➊</span>.</p>&#13;
<p class="indent">Next, there’s a delay to let things settle before the sketch writes a high to the transmit pin, which orders the transmitter to transmit an ultrasonic signal. This is followed by another delay, and then the sketch drives digital pin 12 low to turn off the transmitter and activates the receiver by calling the <code>pulseIn()</code> method.</p>&#13;
<h4 class="h4" id="ch05lev2sec3"><em><strong>Determining Distance</strong></em></h4>&#13;
<p class="noindent">If there’s no echo—that is, if <code>inches == 0</code> or inches approaches infinity—the controller continues to run the code until it reaches the end and then starts again at the beginning. If it detects an echo, the number of microseconds between turning the transmitter on and receiving signal (<code>duration</code>) is then converted to both inches and centimeters. This gives us a measurement of how far the transceiver is from the object. Note that throughout this explanation, I will refer to inches, but you could follow along in centimeters, too.</p>&#13;
<p class="indent">The <code>microsecondsToInches()</code> and <code>microsecondsToCentimeters()</code> commands convert the time measurement to inches and centimeters, respectively, according to the arithmetic discussed in “<a href="ch05.xhtml#ch05lev1sec7">How the Garage Sentry Works</a>” on <a href="ch05.xhtml#page_134">page 134</a>. The data type <code>long</code> is used, as opposed to <code>int</code>, because it provides 4 bytes of data storage instead of just 2, and the number of microseconds could exceed the 2-byte limit of 32,767 bits. So far, so good.</p>&#13;
<p class="indent">In a regular formula, the distance arithmetic looks like this:</p>&#13;
<div class="center"><img alt="image" src="../images/e0141-01.jpg"/></div>&#13;
<div class="center"><img alt="image" src="../images/e0141-02.jpg"/></div>&#13;
<p class="indent">In either case, we first divide by 2 because the signal travels from the transducer to the target and back, as previously discussed. In the inches function, we then divide the halved number of microseconds by 74, and in the centimeters function, we divide by 29. (It takes 74 microseconds for the signal to travel 1 inch, and 29 microseconds for it to travel 1 centimeter; I arrived at those numbers by following the arithmetic in “<a href="ch05.xhtml#ch05note1">Time-to-Distance Conversion Factors</a>” on <a href="ch05.xhtml#page_142">page 142</a>.)</p>&#13;
<div class="box1">&#13;
<p class="boxtitle" id="ch05note1"><span epub:type="pagebreak" id="page_142"/><strong>TIME-TO-DISTANCE CONVERSION FACTORS</strong></p>&#13;
<p class="noindent">You could simply trust my math and copy the time-to-distance conversion code, but you can apply this arithmetic to any project using a similar ultrasonic module or other sensor, so I encourage you to work through the math yourself.</p>&#13;
<p class="indent">As I describe in “<a href="ch05.xhtml#ch05lev1sec7">How the Garage Sentry Works</a>” on <a href="ch05.xhtml#page_134">page 134</a>, the speed of sound is roughly 1,125 feet per second. Multiply that by 12 inches per foot to get 13,500 inches per second.</p>&#13;
<p class="indent">To get the number of seconds per inch, you simply divide this value by 13,500 inches:</p>&#13;
<div class="center"><img alt="image" src="../images/e0142-01.jpg"/></div>&#13;
<p class="indent">It takes about 74 microseconds, or 0.000074 seconds, for sound to travel an inch. To determine the distance in centimeters, go through the same exercise, but use 343 meters per second for the speed of sound, multiply it by 100 centimeters per meter, and take the reciprocal.</p>&#13;
</div>&#13;
<h4 class="h4" id="ch05lev2sec4"><em>Triggering the Alarm</em></h4>&#13;
<p class="noindent">The sketch is not done yet. Now we have to look at the number of inches (or centimeters) measured and compare it to the predetermined value—<code>val</code>, in this case—to see whether the alarm should be activated. To establish the variable <code>val</code> as a numeric value, take a potentiometer (R2) straddling the power supply on either end and tie the wiper to pin A0 (see <a href="ch05.xhtml#ch05fig2">Figure 5-2</a>). Because A0 is the input to a 10-bit analog-to-digital converter, it converts that voltage (between 0V and 5V) to a numeric digital value between 0 and 1,023. Reading that value with an <code>analogRead()</code> command results in a value between 0 and 1,023 depending on the position of the potentiometer.</p>&#13;
<p class="indent">That value is then used to establish the trigger point for the alarm. But allowing all 1,024 values would essentially allow the distance to be set from 0 to 1,023 inches. Because the control rotates only 270 degrees, to adjust between, say, 40 and 42 inches would represent a very minuscule rotation—beyond the granularity of most potentiometers.</p>&#13;
<p class="indent">To scale this for the potentiometer, the sketch maps the value so the entire rotation of the potentiometer represents a distance of only about 100 inches with the following line of code:</p>&#13;
<pre>val = map(val,   0,   1023,   0,   100);</pre>&#13;
<p class="indent">Mapping the potentiometer value changes the maximum distance from 1,023 inches down to 100 inches while leaving the minimum distance of 0 inches unchanged. You can map any set of values so the Garage Sentry’s target distance can be from <em>X</em> to <em>Y</em>, with full rotation of the potentiometer, <span epub:type="pagebreak" id="page_143"/>so when you set up your Garage Sentry, you may want to test it and this range until it’s right for your garage.</p>&#13;
<p class="indent">A conditional control structure sets the limit for the alarm. This structure makes sure that the LED is turned off when the measured distance is 0, regardless of whether the sketch is using inches or centimeters. First, the value <code>inches</code> is compared to <code>val</code> in the following expression:</p>&#13;
<pre>count  ==  0 &amp;&amp; inches  &gt;  0  &amp;&amp;  inches  &lt;  val</pre>&#13;
<p class="indent">If this statement is true, the alarm is set off and the <code>for</code> loop at <span class="ent">➋</span> is activated (see <a href="ch05.xhtml#page_139">page 139</a>), which alternately blinks the LEDs 200 times before timing out and turning the LEDs off.</p>&#13;
<p class="indent">The <code>for</code> loop just counts from 0 to 200, but that can be easily changed. After each count, it turns on an LED, delays briefly and turns off the same LED, delays slightly and turns on a second LED, delays slightly and turns off the LED, and then goes to the next count. At the end of the 200 count, the system turns off the LEDs and the program continues to the next line where it is reset. That is, the program starts again at the beginning.</p>&#13;
<h3 class="h3" id="ch05lev1sec10"><strong>Construction</strong></h3>&#13;
<p class="noindent"><a href="ch05.xhtml#ch05fig8">Figure 5-8</a> shows the enclosure for the Garage Sentry.</p>&#13;
<div class="image"><img alt="image" src="../images/f05-08.jpg"/></div>&#13;
<p class="figcap"><a id="ch05fig8"/><em>Figure 5-8: The basic Garage Sentry uses wire wrap for the final connections</em>.</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_144"/>The trickiest part of the Garage Sentry is mounting the ultrasonic module on the enclosure. Because the module can send out sound waves only in a straight line, you need to be able to adjust its direction so that the ultrasonic sensor can hit its target and receive the echo. But the module includes only two mounting holes, diagonally opposed from each other, so there’s no easy way to fasten it to a flexible mounting. We’ll tackle that first.</p>&#13;
<h4 class="h4" id="ch05lev2sec5"><em><strong>Drilling Holes for the Electronics</strong></em></h4>&#13;
<p class="noindent">To solve this problem, I mounted the transceiver directly to the enclosure and just aimed the enclosure as required. To mount the module, drill 5/8-inch holes in the enclosure and use standoffs to hold the board securely. See the template in <a href="ch05.xhtml#ch05fig9">Figure 5-9</a> for drilling measurements. A PDF of the template is available in this book’s online resources at <em><a href="https://www.nostarch.com/arduinoplayground/">https://www.nostarch.com/arduinoplayground/</a></em>, in case you want to print it and lay it over your enclosure as a guide. The enclosure I recommend is made of polycarbonate plastic and is less likely to crack than styrene or acrylic; however, it tends to catch the drill, so be careful.</p>&#13;
<div class="image"><img alt="image" src="../images/f05-09.jpg"/></div>&#13;
<p class="figcap"><a id="ch05fig9"/><em>Figure 5-9: Template for drilling transducer holes</em></p>&#13;
<p class="indent">There are several ways to drill the 5/8-inch holes. If you are good at drilling, you could simply use a 5/8-inch drill bit and bore the holes directly. But I discovered that the holes can be bored safely and easily by first drilling a hole about 1/4 to 3/8 inches in diameter and then enlarging it with a tapered reamer, available from Amazon for under $15. The larger reamer in the Amazon set will ream a hole up to 7/8 inches in diameter, and it is handy to have around for other projects. Use a 1/8-inch drill to drill the holes for the standoffs, as shown in the drawing, which you can use as a template.</p>&#13;
<p class="indent">If you ream out the hole, make sure to ream from both sides. Enlarge the hole to a size that holds the transducer elements tightly—but not too tightly. While this is not the most precise way to bore a hole and would probably be frowned upon by professional machinists, it works well enough here.</p>&#13;
<div class="note">&#13;
<p class="notet"><span epub:type="pagebreak" id="page_145"/><strong><span class="bgblack">WARNING</span></strong></p>&#13;
<p class="notep"><em>Regardless of the size of the hole, do not hold your work piece with your hand when drilling. Always clamp it securely. If the drill binds, the work will want to spin or climb up the drill. Drill at a slow speed and go gently</em>.</p>&#13;
</div>&#13;
<p class="indent">Next, drill the holes for the potentiometer, power jack, and two LEDs. Select a drill size based on the particular power jack and potentiometer you have. I used a 9/32-inch drill for the potentiometer, a 1/4-inch drill for the 3.5 mm jack, and a bit of approximately 25/64 inches for the LEDs. The size of the 10 mm LEDs tends to vary a bit from manufacturer to manufacturer, so I would recommend that you select a smaller drill bit, say 3/8 inches, and ream until the LED fits tightly. Because the LED is tapered, ream from the rear of the enclosure so that the LED will fit better.</p>&#13;
<p class="indent">The location of both the potentiometer and power jack is not important, but make sure that neither crowds the transducer or Nano. You want them to be on the bottom of the enclosure so that they are accessible after the enclosure is mounted (see <a href="ch05.xhtml#ch05fig12">Figure 5-12</a>).</p>&#13;
<h4 class="h4" id="ch05lev2sec6"><em><strong>Mounting Options</strong></em></h4>&#13;
<p class="noindent">Before you stuff the Arduino, ultrasonic sensor, and perforated board circuit into your enclosure, figure out how you want to mount the Garage Sentry. There are several ways to mount the enclosure onto whatever surface you need.</p>&#13;
<h5 class="h5"><strong>Velcro Strips</strong></h5>&#13;
<p class="noindent">If you have a good flat surface to mount the assembly to, you could simply affix the enclosure with adhesive Velcro (see <a href="ch05.xhtml#ch05fig10">Figure 5-10</a>). Two sentries have been in place in my garage that way for several months, with no sign of slippage or deterioration.</p>&#13;
<div class="image"><img alt="image" src="../images/f05-10.jpg"/></div>&#13;
<p class="figcap"><a id="ch05fig10"/><em>Figure 5-10: Adhesive Velcro mounting strips used to mount the Garage Sentry enclosure</em></p>&#13;
<h5 class="h5"><span epub:type="pagebreak" id="page_146"/><strong>A U Bracket That Can Be Aimed</strong></h5>&#13;
<p class="noindent">If you don’t have a good surface and need to aim the module at an angle, mounting it on a U bracket that lets the sensors swing up and down or left and right will work. In this section, I’ll describe how to build the U bracket mount shown in <a href="ch05.xhtml#ch05fig11">Figure 5-11</a>.</p>&#13;
<div class="image"><img alt="image" src="../images/f05-11.jpg"/></div>&#13;
<p class="figcap"><a id="ch05fig11"/><em>Figure 5-11: This drawing illustrates the size and shape of the optional U bracket handle and how it connects to the enclosure. Where you see two measurements for a single dimension, the smaller applies to the basic Garage Sentry, while the larger applies to the deluxe version</em>.</p>&#13;
<p class="indent">To make the U bracket for the basic Garage Sentry with the 1591 ATCL 2×4-inch enclosure, take a strip of 3/4-inch × 0.080-inch × 5 1/2-inch long aluminum (available at Ace Hardware, Home Depot, or Lowe’s), and drill 1/4-inch holes 5/16 inches from the ends of the aluminum strip. Drill corresponding holes with a No. 7 or 15/64 drill in the side of the enclosure centered on the ends, and thread the holes with a 1/4-inch-20 tap. Bend the aluminum strip 1.5 inches from each end for the standard version and 2 inches for the deluxe version (see <a href="ch05.xhtml#ch05fig11">Figure 5-11</a>). Using a vise is the easiest way to bend the metal, but if that’s not convenient, you can sandwich it between a bench and piece of metal, clamp it down, and bend it by hand.</p>&#13;
<p class="indent">To make the U bracket for the Deluxe Garage Sentry with the 1591 BTCL 2.2×4.4-inch enclosure, use a 6 3/8-inch long strip of the same material, and drill the 1/4-inch holes 1/2 inches from the ends. Then, bend the aluminum at right angles at 3/4 inches from either end for the standard version and 1 inch from each end for the deluxe version.</p>&#13;
<p class="indent">To fasten the U bracket to either enclosure, you can start by drilling a hole in the center of each end of the enclosure. It’s simplest to drill a No. 7—15/64 is close enough—hole at either end of the enclosure. The easiest way to center the holes is to draw a line along each diagonal on both ends. Where the lines intersect is the center. Thread the holes with a 1/4-inch-20 tap, and you’ll be able to fasten the enclosure to the U bracket directly. The threads in the thin ABS plastic will not be very strong, so be careful not to overtighten the bolts.</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_147"/>When you’re finished attaching the bracket to your enclosure, it should look like <a href="ch05.xhtml#ch05fig12">Figure 5-12</a>.</p>&#13;
<div class="image"><img alt="image" src="../images/f05-12.jpg"/></div>&#13;
<p class="figcap"><a id="ch05fig12"/><em>Figure 5-12: The enclosure for the basic Garage Sentry can be mounted with the bracket so it can be tilted or rotated to point the transducers in the correct direction</em>.</p>&#13;
<h4 class="h4" id="ch05lev2sec7"><em><strong>Soldering the Transistors and Current-Limiting Resistors</strong></em></h4>&#13;
<p class="noindent">After testing your circuit on a breadboard and deciding how to mount the Garage Sentry, solder the driver transistors and current-limiting resistors to a small section of perforated phenolic or FR-4 predrilled board. Use the schematic in <a href="ch05.xhtml#ch05fig2">Figure 5-2</a> or the instructions in “<a href="ch01.xhtml#ch01lev1sec7">The Breadboard</a>” on <a href="ch05.xhtml#page_136">page 136</a> as a guide to wiring and soldering the components in the perforated board.</p>&#13;
<p class="indent">Make the connections in the schematic, but otherwise, there is no right or wrong way to assemble the perf board. I do recommend using perforated board with copper pads for each hole to simplify soldering. Solder all the hookup wires for the power, potentiometer, Nano, ultrasonic module, and LEDs before attempting to mount the board on the inside of the enclosure.</p>&#13;
<p class="indent">When you’re done soldering, mount the perforated board anywhere in the enclosure where you can find room. I used double-sided foam adhesive, and it worked well. Mount the Nano, LEDs, and ultrasonic module next.</p>&#13;
<h4 class="h4" id="ch05lev2sec8"><em><strong>Wiring the Pieces Together</strong></em></h4>&#13;
<p class="noindent">Finally, use 30-gauge hookup wire to connect the Nano, ultrasonic sensor, perforated board circuit, and LEDs according to the schematic in <a href="ch05.xhtml#ch05fig2">Figure 5-2</a>. Optionally, you can use wire-wrap wire and a wire-wrap tool to wire up the sections, but it is not necessary and can be expensive if you don’t already have the tool and wire. Wiring the components and fitting them in the enclosure may be a little messy, but it saves building a shield.</p>&#13;
<h3 class="h3" id="ch05lev1sec11"><span epub:type="pagebreak" id="page_148"/><strong>The Deluxe Garage Sentry</strong></h3>&#13;
<p class="noindent">That’s it! Or is it?</p>&#13;
<p class="indent">I have been using the standard model in my garage for several months; it does what it’s supposed to do and does it well. But it seems like something’s missing. The alarm goes off when you reach the desired spot in the garage, but why not have it give you a little warning before you get there so you can slow down as you approach the stopping point?</p>&#13;
<p class="indent">The idea is to have the system warn you at some pre-established distance from the stopping point so you don’t have to stop suddenly. It isn’t much extra effort to add two more LEDs to go off at different distances. <a href="ch05.xhtml#ch05fig13">Figure 5-13</a> shows the Deluxe Garage Sentry.</p>&#13;
<div class="image"><img alt="image" src="../images/f05-13.jpg"/></div>&#13;
<p class="figcap"><a id="ch05fig13"/><em>Figure 5-13: The Deluxe Garage Sentry sets off three stages of alarms</em>.</p>&#13;
<p class="indent">Now, let’s discuss how to assemble the Deluxe Garage Sentry.</p>&#13;
<h4 class="h4" id="ch05lev2sec9"><strong><em>The Deluxe Schematic</em></strong></h4>&#13;
<p class="noindent">Hand-wiring everything in the standard version is tedious. So for the deluxe version, I developed a shield (PCB) that holds the LEDs, potentiometer, Nano, transistors, and current-limiting resistors. Adding the LEDs and extra transistors required some changes in the circuitry. <a href="ch05.xhtml#ch05fig14">Figure 5-14</a> shows the revised schematic.</p>&#13;
<p class="indent">Note that this circuit drives the transistors as emitter followers. As such, the base shows a high resistance, and therefore no resistor is required between the Arduino and the resistors Q1 through Q4. If you were driving using a common emitter, however, you would need a resistor, as current would flow through the base-emitter junction, short out the driver, and burn out the transistor.</p>&#13;
<div class="image"><span epub:type="pagebreak" id="page_149"/><img alt="image" src="../images/f05-14.jpg"/></div>&#13;
<p class="figcap"><a id="ch05fig14"/><em>Figure 5-14: The deluxe schematic has additional LEDs, driver transistors, and current-limiting resistors on the right-hand side</em>.</p>&#13;
<div class="note">&#13;
<p class="notet"><strong><span class="bgblack">NOTE</span></strong></p>&#13;
<p class="notep"><em>To improve the Garage Sentry further, you could also conceivably double or otherwise increase the range using special transducers and electronics, but in this application, the 10-foot operating range is more than enough</em>.</p>&#13;
</div>&#13;
<h4 class="h4" id="ch05lev2sec10"><em><strong>The Deluxe Sketch</strong></em></h4>&#13;
<p class="noindent">Before you build the Deluxe Garage Sentry, download <em>GarageSentryDeluxe.ino</em> from this book’s resource files at <em><a href="https://www.nostarch.com/arduinoplayground/">https://www.nostarch.com/arduinoplayground/</a></em>, and upload it onto your Arduino Nano according to the instructions provided in “<a href="ch00.xhtml#ch00lev1sec3">Uploading Sketches to Your Arduino</a>” on <a href="ch00.xhtml#page_5">page 5</a>. The sketch is basically the same as the basic Garage Sentry sketch, but it’s updated to include the new LEDs.</p>&#13;
<pre>        /* Deluxe Garage Sentry: goes with the shield PCB      <br/>       */  <br/><br/>        int ledPin = 8;  <br/>        int ledPin1 = 7;  <br/>        int ledPin2 = 10;  <br/>        int ledPin3 = 9;  <br/>        int count;  <br/>        int analogPin = A0;  <br/>        int val;  <br/>        int y;  <br/><br/>        void setup() {  <br/>          //Initialize serial communication:  <br/>          Serial.begin(9600);  <br/>          pinMode(ledPin, OUTPUT);  <br/>          pinMode(ledPin1, OUTPUT);  <br/>          pinMode(ledPin2,OUTPUT);  <br/>          pinMode(ledPin3,OUTPUT);  <br/>          pinMode(analogPin, INPUT);  <br/>        }  <br/><br/>        void loop() {  <br/>          val = analogRead(analogPin);  <br/><br/>          long duration, inches, cm;  <br/><br/>          pinMode(12, OUTPUT);  <br/>          digitalWrite(12, LOW);  <br/>          delayMicroseconds(2);  <br/>          digitalWrite(12, HIGH);  <br/>          delayMicroseconds(5);  <br/>          digitalWrite(12, LOW);  <br/><br/>          pinMode(11, INPUT);   //Attached to ECHO  <br/>          duration = pulseIn(11, HIGH);  <br/><br/>          //Convert the time into a distance  <br/>          inches = microsecondsToInches(duration);  <br/>          cm = microsecondsToCentimeters(duration);  <br/><br/>          val = map(val, 0, 1023, 0, 100);  <br/>          //Map the value of the potentiometer to 0 to 100  <br/><br/>          if(inches == 0)  <br/>            digitalWrite(ledPin, LOW);  <br/><br/>  <span class="ent">➊</span>   if(count == 0  inches &gt; 0  inches &lt; val + 15)   <br/>             digitalWrite(ledPin2, HIGH);  <br/>          else digitalWrite(ledPin2, LOW);  <br/><br/>  <span class="ent">➋</span>   if(count == 0  inches &gt; 0  inches &lt; val + 7.5)  <br/>             digitalWrite(ledPin3, HIGH);  <br/>          else digitalWrite(ledPin3, LOW);  <br/><br/>       if(count == 0  inches &gt; 0  inches &lt; val) {  <br/>  <span class="ent">➌</span>     for(y = 0; y &lt; 200; y++) { //Repeating blink sequence  <br/>           digitalWrite(ledPin, HIGH);  <br/>           digitalWrite(ledPin1, LOW);  <br/>           delay(100);  <br/>           digitalWrite(ledPin, LOW);  <br/>           digitalWrite(ledPin1, HIGH);  <br/>           delay(100);  <br/>        }  <br/>        count = count + 1; //Turn off instruction  <br/>      }  <br/><br/>            digitalWrite(ledPin1, LOW);  <br/><br/>         if(inches &gt; 10) { //Reset if inches &gt; 10  <br/>              delay(1000);  <br/>              count = 0;  <br/>         }  <br/><br/>         Serial.print(inches);  <br/>         Serial.print("   inches ");  <br/>         Serial.print(count);  <br/>         Serial.print(" count   ");  <br/>         Serial.println();  <br/>         Serial.print(" val       ");  <br/>         Serial.println(val);  <br/>         delay(100);  <br/>      }  <br/><br/>      long microsecondsToInches(long microseconds) {  <br/>          return microseconds / 74 / 2;      <br/>      }  <br/><br/>      long microsecondsToCentimeters(long microseconds)         {        <br/>          return microseconds / 29 / 2;  <br/>      }  </pre>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_150"/><span epub:type="pagebreak" id="page_151"/>The most notable difference between the deluxe sketch and the standard sketch is that in the two <code>if-else</code> statements at <span class="ent">➊</span> and <span class="ent">➋</span>, the green and amber LEDs are activated at different distances, based on the stopping point. For example, if the stopping point is set to 36 inches, or <code>Val</code> in the sketch, then the green LED turns on at <code>VAL + 15</code>, or 52 inches, and the amber LED turns on at <code>VAL + 7.5</code>, or 43.5 inches. This way the green LEDs will turn on when the car is 15 inches from the final stopping point, and the amber LEDs will turn on when the car is 7.5 inches from the stopping point. These numbers were selected arbitrarily, and you can change them.</p>&#13;
<p class="indent">The red and blue LEDs start flashing when the car has reached the stopping point. You can see how the LEDs are flashed at <span class="ent">➌</span>.</p>&#13;
<h4 class="h4" id="ch05lev2sec11"><em><strong>The Deluxe Shield</strong></em></h4>&#13;
<p class="noindent"><a href="ch05.xhtml#ch05fig15">Figure 5-15</a> shows the shield for the Deluxe Garage Sentry. If you want to build this shield, download this book’s resource files, look for the file <em>GarageSentryDeluxe.pcb</em>, follow the etching instructions in “<a href="ch00.xhtml#ch00lev1sec5">Making Your Own PCBs</a>” on <a href="ch00.xhtml#page_13">page 13</a>, and solder your components to the board. You can also take the file and send it out to one of the service bureaus to have the board made for you.</p>&#13;
<p class="indent">The potentiometer is soldered directly to the shield, though you’ll still have to solder wires to the power jack and to the ultrasonic module. As you can see in <a href="ch05.xhtml#ch05fig15">Figure 5-15</a>, the connections for the ultrasonic sensor are located on the left-hand side.</p>&#13;
<div class="image"><span epub:type="pagebreak" id="page_152"/><img alt="image" src="../images/f05-15.jpg"/></div>&#13;
<p class="figcap"><a id="ch05fig15"/><em>Figure 5-15: This is the shield for the Deluxe Garage Sentry, which simplifies the individual wires that had to be soldered to complete the earlier version</em>.</p>&#13;
<p class="indent">The green LEDs are on the outermost edges, the amber LEDs are next, and the flashing red and blue LEDs are in the middle. The connections for the potentiometer are on the lower right-hand side, next to the first two connections, which are ground and VIN (from left to right). The potentiometer helps hold the shield in place in the enclosure.</p>&#13;
<p class="indent">This version uses high-power LEDs that draw a fair amount of current. Because the sentry uses the 5V voltage regulator on the Nano, the transistors driving the LEDs are wired directly to the 9V input voltage, allowing the unit to function without a separate voltage regulator. The LEDs are configured with the driver transistors as emitter followers, so the voltage to the LEDs will “follow” the voltage on the base of the transistor—that is, 5V—and not present LEDs with 9V.</p>&#13;
<p class="indent">There are several jumpers required on this shield, including the jumper for the power, which connects to the collectors of the transistors and connects the raw input to the (VIN) Nano. There are also jumpers to connect the ground to the LEDs.</p>&#13;
<p class="indent">I mounted the transistors and current-limiting resistors under the Nano to save some space. Also, note that the connections for the ultrasonic module in the standard version call for a right-angle female header, but doing that in the deluxe version means the length of the male part gets in the way of the LEDs, so I simply soldered the connections to the PC board and to the ultrasonic module to keep the wires out of the way.</p>&#13;
<h4 class="h4" id="ch05lev2sec12"><em><strong>A Bigger Box</strong></em></h4>&#13;
<p class="noindent">Both the green and amber LEDs operate as pairs, so only a single driver transistor is required for each pair. But with all this new circuitry, the deluxe board does not easily fit in the same enclosure as the standard version.</p>&#13;
<p class="indent">You’ll need to find a larger enclosure for the deluxe version, which provides you with some other benefits. With a larger, clear polycarbonate enclosure, like Hammond 1591 BTCL, the LEDs can stay inside the enclosure <span epub:type="pagebreak" id="page_153"/>and still be visible so you won’t have to drill holes to mate with the LEDs in the PC board. You’ll have to drill only four holes: the two large holes for the ultrasonic sensor, a hole for the power jack, and one for the potentiometer. These holes make it possible to mount the ultrasonic sensor on top of the Nano board with double-sided foam tape, which is in turn mounted to the shield (see <a href="ch05.xhtml#ch05fig16">Figure 5-16</a>). In other words, you create a sandwich with the Nano in the middle, the shield on the bottom, and the ultrasonic module on the top. This design eliminates the need for the mounting screws used in the first version.</p>&#13;
<div class="image"><img alt="image" src="../images/f05-16.jpg"/></div>&#13;
<p class="figcap"><a id="ch05fig16"/><em>Figure 5-16: Compared to the basic Garage Sentry, there is virtually no hand wiring in the deluxe version. The driver transistors and current-limiting resistors for the LEDs are located under the Nano board</em>.</p>&#13;
<p class="indent">Simply use the same template you used in the standard version, and drill (and/or ream) the two 5/8-inch holes for the two ultrasonic elements. The shield itself can be fastened to the bottom of the enclosure with small flathead screws and nuts or with more double-sided foam tape. When you affix the potentiometer to the enclosure, it should hold the board in place, as its leads are soldered to the shield. <a href="ch05.xhtml#ch05fig16">Figure 5-16</a> shows the deluxe version; note how much neater it is than the basic version from <a href="ch05.xhtml#ch05fig8">Figure 5-8</a>.</p>&#13;
<p class="indent">Before drilling the hole for the potentiometer, carefully measure the height of the potentiometer hole and drill the hole slightly oversized so that the shaft and screw can be inserted at an angle into the enclosure. You’ll also note in <a href="ch05.xhtml#ch05fig16">Figure 5-16</a> that the corners of the printed circuit board have been clipped off so as not to get in the way of the studs used for the top screws of the enclosure.</p>&#13;
<p class="indent">I suggest mounting the power connection on the same surface of the enclosure as the potentiometer—that is, the bottom. Here, the power connection and potentiometer will be accessible after mounting, leaving the top free to fit snugly against a shelf. The unit can just as easily be mounted upside down with the adjustment and power jack on the top.</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_154"/><a href="ch05.xhtml#ch05fig17">Figure 5-17</a> shows the completed Deluxe Garage Sentry mounted on my garage workbench with the car in place.</p>&#13;
<div class="image"><img alt="image" src="../images/f05-17.jpg"/></div>&#13;
<p class="figcap"><a id="ch05fig17"/><em>Figure 5-17: Completed Deluxe Garage Sentry mounted on my garage workbench with the car in place</em></p>&#13;
<p class="indent">The completed sentry unit works flawlessly. Depending on your particular garage and where you place the unit, you might want to adjust the sketch to make the green and amber lights turn on at different distances. The unit pictured has been working perfectly for almost six months now, and I don’t know how I’d be able to pull my car in the garage without it.</p>&#13;
</body></html>