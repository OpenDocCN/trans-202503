<html><head></head><body>
<div id="sbo-rt-content" class="calibre1"><section aria-labelledby="appA" epub:type="appendix" role="doc-appendix">
<hgroup>
<h2 class="title" id="appA">
<span class="cn"><span aria-label=" Page 427. " epub:type="pagebreak" id="pg_427" role="doc-pagebreak" class="calibre2"/><span class="sans_dogma_ot_bold_b_">A</span></span>
<span class="ct1"><span class="sans_dogma_ot_bold_b_">FULLY FUNCTIONAL BATCH IMPROV</span></span>
</h2>
</hgroup>
<figure class="opener"><img alt="" class="opener1" height="407" src="../images/chapter.jpg" width="408"/></figure>
<p class="chapterintro">In <span class="xref1"><a href="chapter15.xhtml" class="calibre4">Chapter 15</a></span>, I built a rudimentary version of <i class="calibre13">BatchImprov.bat</i> that shared a single joke, riddle, or pun. In later chapters, you learned several tools to enhance this process, such as reading files, loading arrays, and using a random number to select an arbitrary element from an array.</p>
<p class="tx">Now let’s put it all together into an enhanced bat file that first reads library files containing any number of jokes, riddles, and puns, and loads them into arrays. Then the BUI will randomly retrieve and share one example of the user’s requested humor before asking if they want another offering.</p>
<p class="tx">Starting with the data, here are the full contents of <i class="calibre6">BatJokes.txt</i>:</p>
<pre class="pre"><code class="calibre11">Why are bats so active at night?|They charge their bat-teries by day.
How do bats flirt?|They bat their eyes.
What's a good pick-up line for a bat?|Let's hang.
Why did the bat cross the road?|To prove he wasn't chicken.
</code></pre>
<p class="tx"><span aria-label=" Page 428. " epub:type="pagebreak" id="pg_428" role="doc-pagebreak"/><i class="calibre6">BatRiddles.txt</i> similarly contains the riddles:</p>
<pre class="pre"><code class="calibre11">This type of bat is silly.|A Dingbat.
This circus performer can see in the dark.|An Acro-bat.
This is the strongest and meanest bat in the cave.|The Alpha-bat.
This sport uses bats and is also food for bats.|Cricket.
</code></pre>
<p class="tx">The puns are formatted differently, so each record of <i class="calibre6">BatPuns.txt</i> doesn’t contain an answer delimited by a pipe:</p>
<pre class="pre"><code class="calibre11">Crossing a vampire bat with a computer means love at first byte.
The first thing bat pups learn at school is the alpha-bat.
Bat pups are trained to go potty in the bat-room.
</code></pre>
<p class="tx">Finally, place these three library files in the same directory as this version of <i class="calibre6">BatchImprov.bat</i>:</p>
<pre class="pre"><code class="calibre11"> @setlocal EnableExtensions EnableDelayedExpansion
 @echo off
 color 1F
 title Batch Improv Theater

 call :LoadArray joke
 call :LoadArray riddle
 call :LoadArray pun
 pause

:Again
 cls
 &gt; con echo.
 &gt; con choice /C:JPR /M:"Do you want a Joke, Pun, or Riddle"
 &gt; con echo.
 if %errorlevel% equ 1 (
    call :Joke
 ) else if %errorlevel% equ 2 (
    call :Pun
 ) else if %errorlevel% equ 3 (
    call :Riddle
 )
 &gt; con echo.
 &gt; con choice /M:"Do you want to try again"
 if %errorlevel% equ 1  goto :Again
 goto :eof

:Joke
 call :GetRandNbr joke
 &gt; con echo Please give an answer to the joke:
 &gt; con set /P yourAns=!joke[%randNbr%]!  &amp;
 &gt; con echo ** !jokeAns[%randNbr%]!
 &gt; con echo ** You said: "%yourAns%"
 goto :eof

<span aria-label=" Page 429. " epub:type="pagebreak" id="pg_429" role="doc-pagebreak"/>:Pun
 call :GetRandNbr pun
 &gt; con echo We hope you find this punny:
 &gt; con echo !pun[%randNbr%]!
 goto :eof

:Riddle
 call :GetRandNbr riddle
 &gt; con echo Please give an answer to the riddle:
 &gt; con set /P yourAns=!riddle[%randNbr%]!  &amp;
 &gt; con echo ** !riddleAns[%randNbr%]!
 &gt; con echo ** You said: "%yourAns%"
 goto :eof

:LoadArray
 set %1sTot=0
 for /F "tokens=1-2 delims=|" %%b in (Bat%1s.txt) do (
    set %1[!%1sTot!]=%%~b
    set %1Ans[!%1sTot!]=%%~c
    set /A %1sTot += 1
 )
 &gt; con echo.
 &gt; con echo Results of array load of %1s:
 &gt; con set %1
 goto :eof

:GetRandNbr
 set nbrPossVal=!%1sTot!
 set /A maxRandNbr = 32768 / %nbrPossVal% * %nbrPossVal% - 1
:GetAnotherRand
 set randNbr=%random%
 if %randNbr% gtr %maxRandNbr%  goto :GetAnotherRand
 set /A randNbr = %randNbr% %% %nbrPossVal%
 goto :eof
</code></pre>
<p class="tx">Much of this bat file should look familiar, but plenty is new. I perform multiple calls to <span class="sans_thesansmonocd_w5regular_">:LoadArray</span> passing either <span class="sans_thesansmonocd_w5regular_">joke</span>, <span class="sans_thesansmonocd_w5regular_">riddle</span>, or <span class="sans_thesansmonocd_w5regular_">pun</span> as the argument. The routine, which is similar to some code in <span class="xref"><a href="chapter29.xhtml" class="calibre3">Chapter 29</a></span>, uses this text to find and read a specific file in the current directory and build appropriately named arrays.</p>
<p class="tx">An unartful coder might get this to work for the jokes before cloning it for the riddles and puns. Instead, I use common code where the first call populates the <span class="sans_thesansmonocd_w5regular_">joke</span> and <span class="sans_thesansmonocd_w5regular_">jokeAns</span> arrays and sets <span class="sans_thesansmonocd_w5regular_">jokesTot</span> to the total number of jokes loaded into the arrays, even though the actual variable name never appears in the bat file. I create the variable by resolving the parameter as part of <span class="sans_thesansmonocd_w5regular_">%1sTot</span>.</p>
<p class="tx">The second call similarly populates the <span class="sans_thesansmonocd_w5regular_">riddle</span> and <span class="sans_thesansmonocd_w5regular_">riddleAns</span> arrays, along with the <span class="sans_thesansmonocd_w5regular_">riddlesTot</span> variable. But the puns are formatted differently. Since there’s no pipe and no answer, there’s no second parameter and the code doesn’t populate the answer array. Instead, the same logic builds the <span class="sans_thesansmonocd_w5regular_">pun</span> array and sets <span class="sans_thesansmonocd_w5regular_">punsTot</span> to the number of puns in the array.</p>
<p class="tx"><span aria-label=" Page 430. " epub:type="pagebreak" id="pg_430" role="doc-pagebreak"/>You can remove this later, but for testing purposes, I display the results of each load to the console:</p>
<pre class="pre"><code class="calibre11">Results of array load of jokes:
jokeAns[0]=They charge their bat-teries by day.
jokeAns[1]=They bat their eyes.
jokeAns[2]=Let's hang.
jokeAns[3]=To prove he wasn't chicken.
jokesTot=4
joke[0]=Why are bats so active at night?
joke[1]=How do bats flirt?
joke[2]=What's a good pick-up line for a bat?
joke[3]=Why did the bat cross the road?

Results of array load of riddles:
riddleAns[0]=A Dingbat.
riddleAns[1]=An Acro-bat.
riddleAns[2]=The Alpha-bat.
riddleAns[3]=Cricket.
riddlesTot=4
riddle[0]=This type of bat is silly.
riddle[1]=This circus performer can see in the dark.
riddle[2]=This is the strongest and meanest bat in the cave.
riddle[3]=This sport uses bats and is also food for bats.

Results of array load of puns:
punsTot=3
pun[0]=Crossing a vampire bat with a computer means love at first byte.
pun[1]=The first thing bat pups learn at school is the alpha-bat.
pun[2]=Bat pups are trained to go potty in the bat-room.
Press any key to continue ...
</code></pre>
<p class="tni">The <span class="sans_thesansmonocd_w5regular_">cls</span> command clears the screen before starting the user interface portion of the bat file.</p>
<p class="tx">The main logic under the <span class="sans_thesansmonocd_w5regular_">:Again</span> label is unchanged from the prior version of the bat file. The <span class="sans_thesansmonocd_w5regular_">:Joke</span>, <span class="sans_thesansmonocd_w5regular_">:Riddle</span>, and <span class="sans_thesansmonocd_w5regular_">:Pun</span> routines all retrieve a random number by calling <span class="sans_thesansmonocd_w5regular_">:GetRandNbr</span>. To get the total number of elements in the appropriate array, the routine resolves its parameter as part of <span class="sans_thesansmonocd_w5regular_">!%1sTot!</span>. The rest of the logic is similar to what you saw in <span class="xref"><a href="chapter21.xhtml" class="calibre3">Chapter 21</a></span>.</p>
<p class="tx">After getting a pointer for their array (or arrays), these routines look similar to their earlier counterparts except that these get their content from arrays. For example, <span class="sans_thesansmonocd_w5regular_">!joke[%randNbr%]!</span> resolves to a joke, and <span class="sans_thesansmonocd_w5regular_">!jokeAns[%randNbr%]!</span> resolves to its answer. (Delayed expansion is awesome.)</p>
<p class="tx">Now you can run <i class="calibre6">BatchImprov.bat</i> to retrieve multiple jokes, riddles, and puns. You can even add more content to the library files without changing the code. Better yet, use this as a template for your applications that use a BUI, arrays, delimited data files, and random numbers. Enjoy.</p>
</section>
</div></body></html>