<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" epub:prefix="index: http://www.index.com/" lang="en" xml:lang="en">
	<head>
		<title>Chapter 3: Building Your Own Virtual Hacking Lab</title>
		<link href="NSTemplate_v1.css" rel="stylesheet" type="text/css"/>
<meta content="urn:uuid:af29b7b1-e841-4e64-a1ef-e03d2d2c1d42" name="Adept.expected.resource"/>
	</head>
	<body epub:type="bodymatter chapter">
		<section>
			<header>
				<h1 class="chapter"><span class="ChapterNumber"><span epub:type="pagebreak" id="Page_21" title="21"/>3</span><br/><span class="ChapterTitle">Building Your Own Virtual Hacking Lab</span></h1>
			</header>
			<figure class="opener">
				<img alt="" src="image_fi/book_art/chapterart.png"/>
			</figure>
			<p class="ChapterIntro">To learn hacking safely and ethically, you’ll use <em>virtual machines (VMs)</em>, programs that emulate separate computers within your physical desktop or laptop. You can isolate a VM so anything you do in it won’t affect your computer or your network. For example, if you open a file with a virus in a VM, the virus would infect only the virtual machine, not your real computer.</p>
			<p><em>Virtualization software</em> lets you run a virtual machine (called a <em>guest</em>) on your desktop or laptop (the <em>host</em>). In this chapter, we’ll install VirtualBox, a free virtualization program, and the VirtualBox Extension Pack. Then we’ll create two VMs. The first will be an <em>attacking</em> VM running the Kali Linux operating system. You’ll use this VM to launch your hacks. The other virtual machine will be a <em>target</em> VM running Windows. You’ll direct your hacks at this machine. After setting up these two VMs, you’ll be able to safely try out hacking tools without affecting your computer or anyone else’s.</p>
			<h2 id="h1-502000c03-0001"><span epub:type="pagebreak" id="Page_22" title="22"/>Setting Up VirtualBox</h2>
			<p class="BodyFirst">Follow these instructions to download and set up VirtualBox.</p>
			<ol class="decimal">
				<li value="1">Go to the VirtualBox home page at <a class="LinkURL" href="https://www.virtualbox.org/">https://www.virtualbox.org/</a> and click the <b>Download VirtualBox</b> button.</li>
				<li value="2">The VirtualBox Downloads page lists options for Windows, macOS, and multiple Linux host operating systems. Click the option that matches your computer to download the latest version of VirtualBox.</li>
				<li value="3">Open the downloaded file and follow the onscreen instructions to install VirtualBox. (Windows users should choose to run the file as an administrator; you must have administrator privileges to run VirtualBox.)</li>
			</ol>
			<aside epub:type="sidebar">
				<div class="top hr">
					<hr/>
				</div>
				<section class="note">
					<h2><span class="NoteHead">NOTE</span></h2>
					<p>	If you run into errors, try searching the internet for “How to install VirtualBox on [your particular operating system]” or paste the error text into a search engine.</p>
					<div class="bottom hr">
						<hr/>
					</div>
				</section>
			</aside>
			<p>In addition to VirtualBox itself, you need to install the VirtualBox Extension Pack, which adds required features like support for attaching newer USB devices to your VMs. Go ahead and install it now.</p>
			<ol class="decimal">
				<li value="1">Return to the VirtualBox Downloads page (<a class="LinkURL" href="https://www.virtualbox.org/wiki/Downloads">https://www.virtualbox.org/wiki/Downloads</a>), find the VirtualBox Extension Pack section, and click <b>All supported platforms</b> to download the Extension Pack.</li>
				<li value="2">Open VirtualBox. (On Windows, be sure to right-click the VirtualBox icon and choose <b>Run as administrator</b>.)</li>
				<li value="3">Open the Extension Pack from your <em>Downloads</em> folder.</li>
				<li value="4">Once the VirtualBox Extension Pack installation window opens, click <b>Install</b>.</li>
			</ol>
			<h2 id="h1-502000c03-0002">Creating a Kali Linux Virtual Machine</h2>
			<p class="BodyFirst">Now that you have VirtualBox, you’ll create your Kali Linux virtual machine. Kali is a version of the Linux operating system used by ethical hackers worldwide. It includes over 600 security and hacking tools, so it’s a perfect operating system for your attacking VM.</p>
			<ol class="decimal">
				<li value="1">Go to <a class="LinkURL" href="https://www.kali.org/downloads/">https://www.kali.org/downloads/</a>, scroll down to the Virtual Machines section, and click the link to go to the VM Download Page.</li>
				<li value="2">Click the <b>Kali Linux VirtualBox Images</b> tab to see the download options compatible with VirtualBox. Make sure to look for VirtualBox images—there are also images made for VMware, a different software package that’s not compatible with VirtualBox.</li>
				<li value="3">Click <b>Kali Linux VirtualBox 64-Bit</b> to download the VM. The file is around 4GB, so download it somewhere with a fast internet connection.</li>
				<li value="4"><span epub:type="pagebreak" id="Page_23" title="23"/>Start VirtualBox and select <b>File</b><span class="MenuArrow">▶</span><b>Import Appliance</b>.</li>
				<li value="5">Click the folder icon on the right and find your Kali Linux file. Select the file, click <b>Open</b>, and then click <b>Next</b> (on a PC) or <b>Continue</b> (on a Mac).</li>
				<li value="6">You should now see a list of settings for the Kali Linux VM you’re importing. Click <b>Import</b> to continue.</li>
				<li value="7">When the VM has finished importing, you’ll see it listed on the left in the Oracle VM VirtualBox Manager, as shown in <a href="#figure3-1" id="figureanchor3-1">Figure 3-1</a>.</li>
			</ol>
			<figure>
				<img alt="f03001" class="" src="image_fi/502000c03/f03001.png"/>
				<figcaption>
					<p><a id="figure3-1">Figure 3-1</a>: The Kali Linux VM appears in the list on the left of the VirtualBox Manager.</p>
				</figcaption>
			</figure>
			<p>As you add other VMs, they’ll appear in the list alongside Kali. For now, let’s test the new Kali VM to make sure it runs on your system.</p>
			<h2 id="h1-502000c03-0003">Running the Kali VM</h2>
			<p class="BodyFirst">Double-click the Kali Linux VM entry in your VirtualBox Manager panel to start up the Kali Linux virtual machine. The first time you run a VM in VirtualBox, you may encounter errors due to different settings on your Mac or PC. If you have any trouble running VirtualBox or starting your Kali VM, see Appendix B.</p>
			<p>
				When the VM finishes booting, you’ll come to a login screen. Log in with the username <code class="bold">kali</code> and the password <code class="bold">kali</code>. After you log in, you’ll see a screen with the signature Kali dragon logo like the one shown in <a href="#figure3-2" id="figureanchor3-2">Figure 3-2</a>. Welcome to Kali Linux!</p>
			<p>
				Using a computer within a computer takes some getting used to. Once you click inside the VM window, your keyboard and mouse are “captured” for use within the VM. To return your mouse and keyboard to your physical (host) computer, click your mouse outside the VM window or press the <em>host key</em> on your keyboard. This should be the <em>right</em> <span class="KeyCaps">CTRL</span> key on a PC/Linux machine or the <em>left</em> <span class="KeyCaps">COMMAND</span> key on a Mac. If you ever need a reminder, the host key should also be identified in the bottom-right corner of the VM window.</p>
				<span epub:type="pagebreak" id="Page_24" title="24"/>
				<figure>
				<img alt="f03002" class="" src="image_fi/502000c03/f03002.png"/>
				<figcaption>
					<p><a id="figure3-2">Figure 3-2</a>: Your Kali Linux VM is ready to go!</p>
				</figcaption>
			</figure>
			<p>
				If you find that the VM screen and icons are too small, go to <b>View</b><span class="MenuArrow">▶</span><b>Virtual Screen 1</b> and try changing the scale or resolution. Additionally, if you leave your VM alone for a while, the VM window may go blank. If this happens, click in the Kali window and press the spacebar to wake up the machine.</p>
			<p>
				Take some time to explore Kali Linux. You won’t be able to connect to the internet until we set up the network later in the chapter, but you can still take a look around. Click the <b>Applications</b> menu at the top of the screen (the button with the dragon logo) to see some of Kali’s hundreds of programs and tools. They may seem intimidating now, but this book will teach you to use several of them, helping you become more confident in exploring others.</p>
			<p>
				After you’ve looked around a bit, close the Kali Linux VM window. You should see the Close Virtual Machine pop-up window. Choose <b>Save the machine state</b> and click <b>OK</b>. Saving the machine state lets you pick up where you left off the next time you open the VM, like putting your computer to sleep instead of powering it completely down. However, if you ever need to reboot a VM after installing software or changing settings, you’ll need to choose <b>Power off the machine</b> instead.</p>
			<p>
				Congratulations! You’ve set up your first virtual machine! If this is your first experience with Linux, give yourself a high five! With this Kali VM, you’ll be able to test dozens (or even hundreds) of hacks against other, <span epub:type="pagebreak" id="Page_25" title="25"/>target virtual machines to see how online attacks happen and how to defend against them. We’ll set up one of those target VMs next.</p>
			<h2 id="h1-502000c03-0004">Creating a Windows VM</h2>
			<p class="BodyFirst">You’ll now create a second VM that runs Windows. As the most common desktop and laptop operating system in the world, Windows is the number one target for both ethical and unethical hackers, so it’s an important operating system to learn to attack and defend. We’ll download a fully functional Windows 10 VM from the Microsoft Edge Developer website.</p>
			<ol class="decimal">
				<li value="1">Go to <a class="LinkURL" href="https://developer.microsoft.com/en-us/microsoft-edge/tools/vms/">https://developer.microsoft.com/en-us/microsoft-edge/tools/vms/ </a>(or search for the Microsoft Edge Developer Virtual Machines website).</li>
				<li value="2">Choose a Windows 10 virtual machine, select VirtualBox as your platform, and download the VM. The file is over 6GB, so download this VM somewhere with a fast internet connection.</li>
				<li value="3">Unzip the downloaded file. 
					<aside epub:type="sidebar">
						<div class="top hr">
							<hr/>
						</div>
						<section class="note">
							<h2><span class="NoteHead">NOTE</span></h2>
							<p>
									If you’re using macOS, you may need to use the Unarchiver app (<a class="LinkURL" href="https://theunarchiver.com">https://theunarchiver.com</a>) or another utility that can unzip files larger than 4GB.</p>
							<div class="bottom hr">
								<hr/>
							</div>
						</section>
					</aside>
			</li>
				<li value="4">Open VirtualBox and select <b>File</b><span class="MenuArrow">▶</span><b>Import Appliance</b>.</li>
				<li value="5">Click the file icon on the right and find your Windows 10 VM. It will either be a <em>.ova</em> file or a <em>.ovf</em> file. Choose the file, then click <b>Continue</b>.</li>
				<li value="6">You should now see a list of settings for the Windows 10 VM. Click <b>Import</b> to continue.</li>
				<li value="7">When it’s done importing, the Windows VM will appear in the VirtualBox Manager list along with your Kali VM, as shown in <a href="#figure3-3" id="figureanchor3-3">Figure 3-3</a>. 
					<figure>
						<img alt="f03003" class="" src="image_fi/502000c03/f03003.png"/>
						<figcaption>
							<p><a id="figure3-3">Figure 3-3</a>: After you import the Windows VM, you’ll have two VMs in your virtual ethical hacking lab!</p>
						</figcaption>
					</figure>
					</li>
			</ol>
			<p>
				Now let’s turn on the Windows 10 VM to make sure it works. Double-click the Windows 10 VM in the VirtualBox Manager list. Once the VM loads, click within the window to show the Windows login prompt. Log <span epub:type="pagebreak" id="Page_26" title="26"/>in with the default username, <code class="bold">IEUser</code>, and the default password, <code class="bold">Passw0rd!</code> (with a zero in place of the letter <em>o</em>). If the password doesn’t work, check the Microsoft VM download page. The default password should be listed under the Download button.</p>
			<aside epub:type="sidebar">
				<div class="top hr">
					<hr/>
				</div>
				<section class="note">
					<h2><span class="NoteHead">NOTE</span></h2>
					<p>	If the VM takes more than a few minutes to load the first time or if it freezes on a blank screen, power it off and open it again.</p>
					<div class="bottom hr">
						<hr/>
					</div>
				</section>
			</aside>
			<p>
				Once the virtual desktop loads, click around and explore a bit. It’s just like a regular Windows computer. You won’t be able to surf the internet yet, but we’ll set up the virtual network in the next section. Once you’ve finished exploring the Windows VM, close the VM and select <b>Power off the machine</b>. You need to power off the VM completely to change the network settings.</p>
			<p>You now have two virtual machines, a Kali Linux VM and a Windows 10 VM, in your ethical hacking lab. We’ll add more VMs as we need them in future chapters. As soon as we connect these two VMs together, you’ll be able to practice hacking and defending without endangering your laptop or desktop.</p>
			<h2 id="h1-502000c03-0005">Connecting Your VMs to a Virtual Network</h2>
			<p class="BodyFirst">By default, new VMs are connected to a <em>host-only network</em>, meaning you can access them only from your host computer. To connect your VMs to each other and to the internet, we’ll create a <em>virtual network</em>. Connecting your Windows and Kali machines to a virtual network is like connecting them to the same Wi-Fi network.</p>
			<ol class="decimal">
				<li value="1">In VirtualBox, go to <b>File</b><span class="MenuArrow">▶</span><b>Preferences</b> (or <b>VirtualBox</b><span class="MenuArrow">▶</span><b>Preferences</b> on a Mac).</li>
				<li value="2">Go to the <b>Network</b> tab and click the green Add icon (the one with the plus sign) to create a new virtual network.</li>
				<li value="3">A new network (with a name like <em>NatNetwork</em>) should appear in the list. Make sure the box under the Active column next to the network name is checked.</li>
				<li value="4">Select the network, then click the Settings icon (the one with the yellow gear).</li>
				<li value="5">Enter <code class="bold">PublicNAT</code> into the Network Name box and change the Network CIDR text box by typing <b>10.0.9.0/24</b> to set the IP addresses for the VMs. 
					<aside epub:type="sidebar">
						<div class="top hr">
							<hr/>
						</div>
						<section class="note">
							<h2><span class="NoteHead">NOTE</span></h2>
							<p><em>	</em><em>IP addresses</em> are unique numerical addresses for every device on the internet. They’re sort of like the phone numbers of the internet. Traditional IP addresses consist of four numbers between 0 and 255 separated by dots (periods). The 10.0.9.0/24 entry means that your VMs will have addresses between 10.0.9.0 and 10.0.9.255, like 10.0.9.4.</p>
							<div class="bottom hr">
								<hr/>
							</div>
						</section>
					</aside>
			</li>
				<li value="6">Leave the Supports DHCP checkbox selected and click <b>OK</b> twice to finish creating your network.</li>
			</ol>
			<p><span epub:type="pagebreak" id="Page_27" title="27"/>Our next task is to connect your VMs to the PublicNAT network you’ve created.</p>
			<h3 id="h2-502000c03-0001">Connecting Your Kali VM</h3>
			<p class="BodyFirst">We’ll start by connecting your Kali VM to the network and testing out the connection.</p>
			<ol class="decimal">
				<li value="1">In the Oracle VM VirtualBox Manager, click your Kali VM and then click <b>Settings</b>.</li>
				<li value="2">Select the <b>Network</b> tab and choose <b>NAT Network</b> from the Attached to:<b> </b>drop-down list. In the Name: drop-down list, choose <b>PublicNAT</b>. Then click <b>OK</b> to save your changes.</li>
				<li value="3">Start the Kali VM and log in with the username <code class="bold">kali</code> and the password <code class="bold">kali</code>, as before.</li>
				<li value="4">Once the Kali VM desktop appears, open the command line Terminal program by clicking the black box icon in the panel at the top left of your screen, circled in <a href="#figure3-4" id="figureanchor3-4">Figure 3-4</a>.</li>
				<li value="5">Type the command <code class="bold">ip</code> <code class="bold">addr</code> and press <b>ENTER</b> to see information about your VM’s network connections.
					<figure>
						<img alt="f03004" class="" src="image_fi/502000c03/f03004.png"/>
						<figcaption>
							<p><a id="figure3-4">Figure 3-4</a>: Checking the Kali VM’s IP address</p>
						</figcaption>
					</figure>
					</li>
				<li value="6">You should see an IP address starting with <code>10.0.9</code> under the <code>eth0:</code> section, like the one circled in <a href="#figure3-4">Figure 3-4</a>.</li>
			</ol>
			<p>
				When Kali shows an IP address starting with 10.0.9, it’s connected to the PublicNAT network. If you don’t see an address like 10.0.9.<em>x</em>, go to <b>Machine</b><span class="MenuArrow">▶</span><b>Reset</b> to restart your Kali VM. When the VM reboots, run the <code class="bold">ip</code> <code class="bold">addr</code> command in the terminal again. If you still don’t see a 10.0.9.<em>x</em> IP address, go back and check yo<em>u</em>r Kali VM’s network settings in the VirtualBox Manager.</p>
			<h3 id="h2-502000c03-0002"><span epub:type="pagebreak" id="Page_28" title="28"/>Connecting Your Windows VM</h3>
			<p class="BodyFirst">Connecting your Windows VM to the PublicNAT network works almost exactly like connecting your Kali VM.</p>
			<ol class="decimal">
				<li value="1">Go to the VirtualBox Manager, select your Windows VM, and click <b>Settings</b>.</li>
				<li value="2">Click the <b>Network</b> tab, select <b>NAT Network</b> from the Attached to: drop-down list, and choose <b>PublicNAT </b>from the Name: drop-down list. Click <b>OK </b>to apply these settings.</li>
				<li value="3">Start your Windows VM and log in with the default password (<code class="bold">Passw0rd!</code>) as before.</li>
				<li value="4">When the VM loads, click the Windows search bar (in the lower left of <a href="#figure3-5" id="figureanchor3-5">Figure 3-5</a>), type <code class="bold">CMD</code>, and press <b>ENTER</b> to open the Windows command prompt, which is similar to the Kali Linux Terminal program.</li>
				<li value="5">Enter the command <code class="bold">ipconfig</code> to check the VM’s network settings.</li>
				<li value="6">You should see an IP address in the 10.0.9.<em>x</em> range, like the <code>10.0.9.5</code> address in <a href="#figure3-5">Figure 3-5</a>.
					<p class="ListBody">If your address starts with 10.0.9, you’ve successfully connected the Windows VM to the PublicNAT network. If not, go to <b>Machine</b><span class="MenuArrow">▶</span><b>Reset</b> to restart your Windows VM. Try the <code class="bold">ipconfig</code> command again. If you still don’t see a 10.0.9.<em>x</em> IP address, go back and check your VM’s network settings in the VirtualBox Manager.</p>
					<figure>
						<img alt="f03005" class="" src="image_fi/502000c03/f03005.png"/>
						<figcaption>
							<p><a id="figure3-5">Figure 3-5</a>: Checking your Windows VM’s network settings</p>
						</figcaption>
					</figure>
					</li>
				<li value="7"><span epub:type="pagebreak" id="Page_29" title="29"/>Finally, try testing your network’s internet connection. In your Windows VM, open the Microsoft Edge web browser and surf to any web address, like <a class="LinkURL" href="https://www.nostarch.com/go-hck-yourself/">https://www.nostarch.com/go-hck-yourself/</a>.</li>
			</ol>
			<p>If you can’t access any websites, run through the previous steps one more time and try closing and restarting the Windows VM.</p>
			<h2 id="h1-502000c03-0006">Updating Your VM Operating Systems</h2>
			<p class="BodyFirst">Now that your virtual machines are connected to the internet, we can update their operating systems to ensure they have access to the latest features. It’s always a good idea to update a computer’s operating system often, either by enabling automatic updates or by checking for updates at least once a month. Updating your operating system protects you against viruses, hackers, and other online threats. It’s one of the most important things you can do to defend against the latest cyberattacks.</p>
			<aside epub:type="sidebar">
				<div class="top hr">
					<hr/>
				</div>
				<section class="note">
					<h2><span class="NoteHead">WARNING</span></h2>
					<p>	Updating your Kali and Windows VMs can take several hours on a slow internet connection. If you don’t have access to high-speed internet, skip updating your OS until you can connect via a fast library or coffee shop network. Alternatively, let your machine update overnight.</p>
					<div class="bottom hr">
						<hr/>
					</div>
				</section>
			</aside>
			<h3 id="h2-502000c03-0003">Updating Kali Linux</h3>
			<p class="BodyFirst">Follow these instructions to update Kali Linux:</p>
			<ol class="decimal">
				<li value="1">Start your Kali VM and open the terminal command line application again.</li>
				<li value="2">At the terminal prompt, enter the following command to find out what software needs to be updated:
					<pre><code>kali@kali:~$ <code class="bold">sudo apt update</code></code></pre>
			</li>
				<li value="3">Kali will ask for your password the first time you use <code>sudo</code>. This command, short for “superuser do,” lets you run commands with administrator (or <em>superuser</em>) privileges. Type <code class="bold">kali</code> as your password and press <b>ENTER</b>.</li>
				<li value="4">Now use this command to perform the updates:
					<pre><code>kali@kali:~$ <code class="bold">sudo apt upgrade</code></code></pre>
			</li>
				<li value="5">You may have to press <code>Y</code> to confirm certain updates. As the various software packages are updated, they’ll be listed in the terminal window, followed by the message <code>Done</code>.</li>
				<li value="6">When <code>apt</code> finishes updating Kali, close the machine and save the machine state.</li>
			</ol>
			<h3 id="h2-502000c03-0004"><span epub:type="pagebreak" id="Page_30" title="30"/>Updating Windows</h3>
			<p class="BodyFirst">Next we’ll update your Windows VM.</p>
			<ol class="decimal">
				<li value="1">Launch the Windows VM, type <code class="bold">updates</code> into the Windows search bar, and choose <b>Check for updates</b> from the list of options.</li>
				<li value="2">If updates are available for Windows, you should see an Install now or a Restart now button. Click the button to install updates. You may have to restart your VM, just like you have to do sometimes for updates to your real computer.</li>
				<li value="3">After your Windows VM finishes updating, close it and save the machine state.</li>
			</ol>
			<h2 id="h1-502000c03-0007">The Takeaway</h2>
			<p class="BodyFirst">In this chapter, you set up the VirtualBox virtualization software and created two virtual machines, software functioning as computers within your actual computer. One of your VMs runs Kali Linux and will act as your attacking computer, while the other runs Windows and will act as your target computer. You also created a virtual network, named PublicNAT, to connect both VMs to the internet and to each other. Then you applied updates to your Kali and Windows VMs.</p>
			<p>You’ve now set up a fully functional virtual hacking lab. Well done! With your two VMs and your virtual network, you’re ready to safely and ethically try out different hacks without affecting your physical computer. In the next chapter, we’ll start putting your lab to use by conducting some reconnaissance to see what kind of information can be turned up using just a search engine and social media.</p>
			<p/>
		</section>
	</body>
</html>