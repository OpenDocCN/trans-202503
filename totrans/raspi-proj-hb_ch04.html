<?xml version='1.0' encoding='utf-8'?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" epub:prefix="z3998: http://www.daisy.org/z3998/2012/vocab/structure/#" lang="en" xml:lang="en">
  <head>
    <title>Project 4: A Graphical user Interface for a Multicolor LED</title>
    <link href="../styles/9781593278717.css" rel="stylesheet" type="text/css"/>
    <link href="../68851547a55f.css" rel="stylesheet" type="text/css"/>
  </head>
  <body>
    <div id="sbo-rt-content"><h2 class="h2" id="ch04"><span epub:type="pagebreak" id="page_61"/><strong>4<br/>A Graphical User Interface for a Multicolor LED</strong></h2>
<p class="noindent"><span class="green1">In this project, we’ll introduce you to the multicolor RGB LED, and you’ll learn how to build a simple graphical user interface in Tkinter to control your electronics.</span></p>
<div class="image"><span epub:type="pagebreak" id="page_62"/><img src="../images/f0062-01.jpg" alt="image"/></div>
<p class="cap"><span class="green1"><strong>PARTS REQUIRED</strong></span></p>
<p class="cap1">Raspberry Pi</p>
<p class="cap1">Breadboard</p>
<p class="cap1">Common cathode RGB LED</p>
<p class="cap1">Three 330 Ω resistors</p>
<p class="cap1">Jumper wires</p>
<h3 class="h3" id="lev48"><span epub:type="pagebreak" id="page_63"/><span class="green1"><strong>INTRODUCING RGB LEDS</strong></span></h3>
<p class="noindent">RGB LEDs are three LEDs in one—red, green, and blue—that can produce almost any color by combining those three colors.</p>
<p class="indent">With an RGB LED you can, of course, produce red, green, and blue light, and by configuring the intensity of each LED, you can produce other colors as well. For example, to produce purely blue light, you’d set the blue LED to the highest intensity and the green and red LEDs to the lowest intensity. For a white light, you’d set all three LEDs to the highest intensity. <a href="ch04.xhtml#ch04fig1">Figure 4-1</a> shows a simplified RGB color-mixing chart to give you an idea of how to combine red, green, and blue to produce different colors.</p>
<div class="image"><a id="ch04fig1"/><img src="../images/f0063-01.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 4-1:</strong> Simple RGB color mixing</p>
<p class="indent">There are two kinds of RGB LEDs: a <em>common cathode</em> LED, where each color LED shares a negative connection, and a <em>common anode</em>, where each LED shares a positive connection. <a href="ch04.xhtml#ch04fig2">Figure 4-2</a> illustrates a common anode and a common cathode LED.</p>
<div class="image"><a id="ch04fig2"/><img src="../images/f0063-02.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 4-2:</strong> Common anode and common cathode RGB LEDs</p>
<p class="indent"><span epub:type="pagebreak" id="page_64"/>RGB LEDs have four leads—one for each LED and another for the common anode or cathode. You can identify each lead by its length, as shown in <a href="ch04.xhtml#ch04fig3">Figure 4-3</a>.</p>
<div class="image"><a id="ch04fig3"/><img src="../images/f0064-01.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 4-3:</strong> Common anode and common cathode RGB LED leads</p>
<p class="indent">With the LED facing you so the anode or cathode (the longest lead) is second from the left, the leads should be in the following order: red, anode or cathode, green, and blue. We’ll be using a common cathode LED for this project, but if you already have a common anode LED it’s fine to use that; just watch out for the differences noted in the circuit wiring.</p>
<h3 class="h3" id="lev49"><span class="green1"><strong>WIRING THE CIRCUIT</strong></span></h3>
<p class="noindent">Wiring an RGB LED to the Raspberry Pi is really straightforward and not much different than wiring a simple LED. You’ll need three current limiting resistors—one for each LED color.</p>
<p class="indent">Follow these instructions, using <a href="ch04.xhtml#ch04fig4">Figure 4-4</a> as a reference.</p>
<ol>
<li class="noindent"><p class="list">Connect the LED pins in the breadboard and add a 330 Ω current-limiting resistor in series for each color lead.</p></li>
<li class="noindent"><p class="list">Connect GND to the breadboard blue rail, and wire the RGB LED to the Raspberry Pi’s GPIO according to the following table, with red connected to GPIO 23, the cathode to GND, green to GPIO 24, and blue to GPIO 25. Check <a href="ch04.xhtml#ch04fig3">Figure 4-3</a> to make sure you’re orienting the LED correctly.</p></li>
</ol>
<div class="note">
<p class="notet"><strong>NOTE</strong></p>
<p class="notep">If you’re using a common anode RGB LED, connect the longest lead (the anode) to 3.3 V.</p>
</div>
<table class="topbot-d">
<thead>
<tr>
<td style="vertical-align: top;" class="border_thb"><p class="tab_th"><span epub:type="pagebreak" id="page_65"/><strong>RGB LED</strong></p></td>
<td style="vertical-align: top;" class="border_tha"><p class="tab_th"><strong>RASPBERRY PI</strong></p></td>
</tr>
</thead>
<tbody>
<tr>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">First lead: red</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="green1">GPIO 23</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">Second lead: cathode</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="green1">GND</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">Third lead: green</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="green1">GPIO 24</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">Fourth lead: blue</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="green1">GPIO 25</span></p></td>
</tr>
</tbody>
</table>
<div class="image"><a id="ch04fig4"/><img src="../images/f0065-01.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 4-4:</strong> Wiring a common cathode RGB LED to the Raspberry Pi</p>
<h3 class="h3" id="lev50"><span class="green1"><strong>WRITING THE SCRIPT</strong></span></h3>
<p class="noindent">In your script, you’ll use a library called Tkinter to create a user interface window in your desktop environment that you can use to control the RGB LED. Tkinter is already installed with your Raspbian system, so you just need to import it in your script.</p>
<p class="indent">The interface window will have three sliders (with values of <code>0</code> to <code>1</code>) to control the intensity of the built-in red, green, and blue LEDs, and a close button to shut down the program. By adjusting the values’ intensities with the sliders, you can change the color of the RGB LED.</p>
<p class="indent"><span epub:type="pagebreak" id="page_66"/>Now, open <strong>Python 3 (IDLE)</strong> and go to <strong>File</strong> <span class="ent">▸</span> <strong>New File</strong> to create a new script. Then, enter the following code into the Python Editor and save the script as <em>rgb_led_controller.py</em> inside the <em>LEDs</em> folder (remember that you can download all the scripts at <em><a href="https://www.nostarch.com/RaspberryPiProject/">https://www.nostarch.com/RaspberryPiProject/</a></em>):</p>
<div class="box">
<pre>  <span class="red1">#import necessary libraries</span><br/><span class="ent">➊</span> <span class="orange">from</span> gpiozero <span class="orange">import</span> PWMLED<br/>  <span class="orange">from</span> tkinter <span class="orange">import</span> *<br/><br/>  <span class="red1">#change the RGB LED color</span><br/><span class="ent">➎</span> <span class="orange">def</span> <span class="blue">change_color</span>(self):<br/>      red.value = red_slider.get()<br/>      green.value = green_slider.get()<br/>      blue.value = blue_slider.get()<br/>      <span class="purple">print</span>(self)<br/><br/>  <span class="red1">#close the window</span><br/><span class="ent">➌</span> <span class="orange">def</span> <span class="blue">close_window()</span>:<br/>      window.destroy()<br/><br/><br/>  <span class="red1">#create a PWMLED object for each color</span><br/><span class="ent">➍</span> red = PWMLED(23)<br/>  green = PWMLED(24)<br/>  blue = PWMLED(25)<br/><br/>  <span class="red1">#create window</span><br/><span class="ent">➎</span> window = Tk()<br/>  window.title(<span class="green">'RGB LED Controller'</span>)<br/>  window.geometry(<span class="green">'300x200'</span>)<br/><br/>  <span class="red1">#create three sliders to control each RGB LED lead</span><br/><span class="ent">➏</span> red_slider = Scale(window, from_=0, to=1, resolution = 0.01,<br/>  orient=HORIZONTAL, label=<span class="green">'Red'</span>, troughcolor=<span class="green">'red'</span>, length=200,<br/>  command=change_color)<br/>  red_slider.pack()<br/><br/>  green_slider = Scale(window, from_=0, to=1, resolution = 0.01,<br/>  orient=HORIZONTAL, label=<span class="green">'Green'</span>, troughcolor=<span class="green">'green'</span>, length=200,<br/>  command=change_color)<br/>  green_slider.pack()<br/><br/>  blue_slider = Scale(window, from_=0, to=1, resolution = 0.01,<br/>  orient=HORIZONTAL, label=<span class="green">'Blue'</span>, troughcolor=<span class="green">'blue'</span>, length=200,<br/>  command=change_color)<br/>  blue_slider.pack()<br/><br/>  <span class="red1">#create close button</span><br/><span class="ent">➐</span> close_button = Button(window, text=<span class="green">'Close'</span>, command=close_window)<br/>  close_button.pack()<br/><br/><span class="ent">➑</span> mainloop()</pre>
</div>
<div class="box2">
<p class="box-title" id="ch04box1"><span epub:type="pagebreak" id="page_67"/><span class="green1"><strong>USER-DEFINED FUNCTIONS</strong></span></p>
<p class="box-p">To define a new function, you use the word <code>def</code> followed by the name you want to give the function and a set of parentheses.</p>
<p class="box-pi">After the parentheses you add a colon (<code>:</code>) and then tell the function what instructions to perform. Python knows which instructions are part of the function definition by the use of the colon and indentation: every indented line after the colon is part of the function. Later, you can run the instructions you’ve set inside the function by entering the name of the function, also known as <em>calling</em> the function.</p>
</div>
<p class="indent">First, you import <code>PWMLED</code> from the gpiozero library to control the LED with PWM, and import the tkinter library to build the user interface <span class="ent">➊</span>. Next, you create the function to control the LED color. Remember that a function is basically a block of reusable code that will perform a certain action. Python has many built-in functions, like <code>print()</code>, <code>int()</code>, and <code>input()</code>, but you can also build your own <em>user-defined functions</em>, as in this script. Read the <a href="ch04.xhtml#ch04box1">“User-Defined Functions”</a> box to learn more.</p>
<h4 class="h4" id="lev51"><span class="green1"><strong>Controlling the Intensity and Closing the Window</strong></span></h4>
<p class="noindent">The <code>change_color()</code> function <span class="ent">➋</span> changes the LED’s duty cycle as you adjust the value of the slider, which in turn changes the intensity of the LED and therefore the color it produces. This function is called every time the sliders move, so you should see an instantaneous change on the LED when you move the slider. At <span class="ent">➍</span>, you create <code>PWMLED</code> objects to refer to each color of the RGB LED.</p>
<p class="indent">The <code>close_window()</code> function <span class="ent">➌</span> closes the window with <code>window.destroy()</code>. This function is called when you press the Close button in the Tkinter interface. We’ll look at how to create the Tkinter interface next.</p>
<h4 class="h4" id="lev52"><span class="green1"><strong>Designing the User Interface with Tkinter</strong></span></h4>
<p class="noindent">At <span class="ent">➎</span>, you define the main window of your interface. You create a variable called <code>window</code> that is a <code>tkinter</code> window with the line <code>window = Tk()</code>. You then give your window a title and set the window dimensions with the <code>title()</code> and <code>geometry()</code> methods, respectively.</p>
<h5 class="h5"><span epub:type="pagebreak" id="page_68"/><strong>Creating Sliders and Buttons</strong></h5>
<p class="noindent">After creating the window, you can start adding the controls, known as <em>widgets</em>, like buttons, labels, and sliders. You’re using a <code>Button</code> widget to close the window and three <code>Scale</code> widgets to add the sliders to your window.</p>
<p class="indent">You then create three sliders, one for each RGB color <span class="ent">➏</span>, using the following syntax:</p>
<div class="box">
<pre><em>slider_name</em> = Scale(<em>master</em>, <em>option</em>, <em>option</em>, ...)</pre>
</div>
<p class="indent">The <span class="codeitalic">master</span> argument is the window you’ll add the widget to, and each <span class="codeitalic">option</span> argument allows you to personalize your sliders. In the <em>rgb_led_controller.py</em> script, you use the following options:</p>
<ul>
<li class="noindent"><code>from_</code> defines the lower end of the scale’s range.</li>
<li class="noindent"><code>to</code> defines the upper end of the scale’s range. In our case, the range is 0 to 1.</li>
<li class="noindent"><code>resolution</code> sets the resolution of the slider—the minimum difference between two consecutive values. Here, the resolution is <code>0.01</code>.</li>
<li class="noindent"><code>orient</code> defines the slider orientation, either <code>HORIZONTAL</code> or <code>VERTICAL</code>. This script sets the sliders to <code>HORIZONTAL</code>.</li>
<li class="noindent"><code>label</code> sets the slider label. You label each slider in this script according to the LED color it controls.</li>
<li class="noindent"><code>troughcolor</code> sets the background color of the slider. Each slider background is the color of the LED it controls.</li>
<li class="noindent"><code>length</code> defines the length of the slider in pixels. All of the sliders are set to <code>200</code>.</li>
<li class="noindent"><code>command</code> dictates the procedure that will be called every time the slider is moved. In this case, moving the slider calls the <code>change_color()</code> function, which changes the LED’s duty cycle and thus the color it produces.</li>
</ul>
<p class="indent">After creating the slider, you use the <code>pack()</code> method to place the widgets in the main <code>window</code>. As you’re not passing any argument to the <code>pack()</code> method, the widgets are placed in the window according to the default settings: widgets fill only their minimal dimension, and they are packed against the top of the window or against the widget above.</p>
<p class="indent">Next, you create the Close button <span class="ent">➐</span> using the following syntax:</p>
<div class="box">
<pre><em>Button_name</em> = Button(<em>master</em>, <em>option</em>, <em>option</em>, ...)</pre>
</div>
<p class="indent"><span epub:type="pagebreak" id="page_69"/>In your code, you use these options:</p>
<ul>
<li class="noindent"><code>text</code> defines the text that will be displayed on the button.</li>
<li class="noindent"><code>command</code> dictates the procedure that will be called when the button is pressed—here, the <code>close_window()</code> function, which closes the window.</li>
</ul>
<h5 class="h5"><strong>Using the Main Loop</strong></h5>
<p class="noindent">The script’s final statement calls the <code>mainloop()</code> function <span class="ent">➑</span>, which is an infinite loop that allows windows to be drawn and events to be processed. The <code>mainloop()</code> function is what keeps your program running.</p>
<h4 class="h4" id="lev53"><span class="green1"><strong>Running the Script</strong></span></h4>
<p class="noindent">Press <strong>F5</strong> or go to <strong>Run</strong> <span class="ent">▸</span> <strong>Run Module</strong> to run the script. Your interface window should pop up, as shown in <a href="ch04.xhtml#ch04fig5">Figure 4-5</a>.</p>
<div class="image"><a id="ch04fig5"/><img src="../images/f0069-01.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 4-5:</strong> The RGB LED controller user interface</p>
<p class="indent">Congratulations! You’ve made your own component user interface! Now try moving the sliders to change the LED color. When you change each slider’s position, the RGB LED color should change accordingly.</p>
<p class="indent">To close the program, just press the Close button.</p>
<h3 class="h3" id="lev54"><span class="green1"><strong>TAKING IT FURTHER</strong></span></h3>
<p class="noindent">Now that you know how to make a graphical user interface, we encourage you to edit its parameters to customize its look to suit your tastes. Here are some other project ideas you could try:</p>
<ul>
<li class="noindent">Build a graphical user interface that controls turning an LED on and off.</li>
<li class="noindent">Make a graphical user interface that controls the brightness of the LED.</li>
<li class="noindent">Alter the user interface to control several LEDs.</li>
</ul>
</div>
  </body>
</html>
