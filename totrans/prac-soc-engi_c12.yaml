- en: '12'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '12'
- en: Producing Threat Intelligence
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 生成威胁情报
- en: '![](image_fi/book_art/chapterart.png)'
  id: totrans-2
  prefs: []
  type: TYPE_IMG
  zh: '![](image_fi/book_art/chapterart.png)'
- en: So your organization has defended against a phishing threat. Congrats! Now how
    do you repeat this outcome when faced with future attacks? Does your organization
    want to share this intelligence with other organizations? Will your organization
    capture and store data about this attempt to prevent further attempts? Will you
    record any exploit kit code found in the phishing emails used to spread a malware
    dropper, and ultimately ransomware?
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 所以你的组织成功防御了钓鱼攻击，恭喜！那么，如何在面对未来的攻击时重复这种结果呢？你的组织是否希望与其他组织共享这些情报？你的组织是否会捕获并存储关于此次攻击的数据，以防止进一步的尝试？你是否会记录在钓鱼邮件中发现的任何恶意软件投放器代码，最终传播勒索软件的？
- en: When an incident occurs, three useful things should happen. First, the organization
    should automate the organization’s response by using software that either proactively
    blocks the attack or runs a script to halt an incident in progress. Second, the
    organization could collect information about each attack to decrease its future
    detection and response time. Finally, the organization could share parts of this
    information with other organizations, allowing everyone to reduce their detection
    and response times.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 当发生安全事件时，应该有三件有用的事情发生。首先，组织应该通过使用软件自动化响应，软件要么主动阻止攻击，要么运行脚本来停止正在进行的事件。其次，组织可以收集每次攻击的信息，以减少未来的检测和响应时间。最后，组织可以将部分信息共享给其他组织，让大家共同减少检测和响应时间。
- en: While some threat intelligence feeds are snake oil, many are legitimately useful
    products. But relying solely on someone else to provide your organization with
    intelligence, to help defend the environment that the organization built and is
    responsible for, is naive. While taking inputs from experts who have insight into
    trends and actors is a sound move, it should not be the only move.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管一些威胁情报源可能是空头支票，但许多情报源确实是有用的产品。然而，单靠他人提供情报来帮助你的组织防御其所建设并负责的环境，显得过于天真。虽然采纳那些具有趋势和行动者洞察力的专家的意见是一个明智之举，但这不应该是唯一的选择。
- en: 'In this chapter, we’ll walk through the process of creating threat intelligence
    about a phishing email by using a free intelligence-sharing platform: AT&T Alien
    Labs OTX, sometimes still referred to as AlienVault OTX. We’ll also reuse many
    of the OSINT techniques you learned about earlier in this book, this time for
    the much different purpose of verifying whether a URL or email is malicious.'
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将通过使用一个免费的情报共享平台：AT&T Alien Labs OTX（有时仍被称为AlienVault OTX），来创建有关钓鱼邮件的威胁情报。我们还将重用你在本书前面学到的许多OSINT技术，这一次的目的是验证一个URL或邮件是否具有恶意。
- en: Before you follow along, I recommend setting up a virtual machine. That way,
    you can avoid opening any attached files and prevent possible malware infections
    on your workstation.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 在你跟着操作之前，我建议先设置一个虚拟机。这样，你可以避免打开任何附带的文件，从而防止可能的恶意软件感染你的工作站。
- en: Using Alien Labs OTX
  id: totrans-8
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用Alien Labs OTX
- en: Some threat intelligence vendors charge the organization to consume threat intelligence,
    while others charge the organization to produce it. But one vendor that is universally
    free and allows anyone to contribute is AT&T Cybersecurity. Formerly known as
    AlienVault, this company runs the Alien Labs Open Threat Exchange (OTX) platform,
    which lets you subscribe to intelligence feeds and post your own information.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 一些威胁情报供应商会向组织收费以获取情报，而其他供应商则向组织收费以生成情报。但有一家供应商是完全免费的，并允许任何人贡献情报，那就是AT&T Cybersecurity。前身为AlienVault，这家公司运营着Alien
    Labs Open Threat Exchange（OTX）平台，允许你订阅情报源并发布你自己的信息。
- en: Admittedly, its main strength (that it’s free) is also its main weakness, but
    a positive point is that you do not have to consume any intelligence just because
    it is on the platform; you must select which feeds you choose to follow and subscribe
    to (for free).
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 不可否认，它的主要优点（即免费）也是其主要缺点，但一个积极的方面是，你不必仅仅因为情报出现在平台上就消费它；你必须选择你希望订阅的情报源（免费）。
- en: If an organization uses AT&T Cybersecurity’s Unified Security Monitoring (USM)
    or Open Source SEIM (OSSIM) as its SEIM, the organization can directly input pulses
    you subscribe to into USM by synching the SEIM with the OTX API. If the organization
    is not using USM, it can directly connect OTX with Suricata, Bro, and Trusted
    Automated Exchange of Indicator Information (TAXII); otherwise, it may use the
    Java, Python, or Go APIs.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 如果组织使用 AT&T Cybersecurity 的统一安全监控（USM）或开源 SEIM（OSSIM）作为其 SEIM，组织可以通过将 SEIM 与
    OTX API 同步，直接将你订阅的脉冲输入到 USM 中。如果组织没有使用 USM，它可以将 OTX 直接与 Suricata、Bro 和受信任的自动化指标信息交换（TAXII）连接；否则，它可以使用
    Java、Python 或 Go API。
- en: Once the organization has the indicators in the desired format, it can immediately
    search for them using its method of choice—custom scripts, YARA, STIX, TAXII,
    or something similar. This will allow the organization to identify and respond
    to known threats.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦组织拥有所需格式的指标，它可以立即使用其选择的方法进行搜索——自定义脚本、YARA、STIX、TAXII 或类似的工具。这将使组织能够识别并应对已知的威胁。
- en: Analyzing a Phishing Email in OTX
  id: totrans-13
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 在 OTX 中分析钓鱼邮件
- en: 'What about threats that only your organization has observed? How can your organization
    better detect future attempts and possibly save other organizations from the same
    headaches later? Here is the simple answer: produce threat intelligence.'
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 那些只有你所在的组织观察到的威胁怎么办？你的组织如何更好地检测未来的攻击，并可能帮助其他组织避免今后遇到相同的问题？这里有一个简单的答案：生成威胁情报。
- en: Knowing where to start is one of the significant barriers to entry. Since this
    is a single chapter in a book about social engineering and OSINT, I will spare
    you the philosophical justifications for producing threat intelligence. Instead,
    let’s walk through an exercise.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 知道从哪里开始是进入的一个重大障碍。由于这只是一本关于社会工程学和 OSINT 的书中的一章，我将省略关于生成威胁情报的哲学性辩护。相反，让我们一起完成一个练习。
- en: First, you need some data about which to produce intelligence. This could be
    an email, a website, or a file. For the sake of covering all three aspects, let’s
    assume that the organization receives an email directing users to a website that
    prompts them to enter credentials and then downloads and attempts to execute a
    file when the user submits the credentials. You can use the file called *invoice.eml*
    in the GitHub repo at [https://cti.seosint.xyz/](https://cti.seosint.xyz/).
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，你需要一些数据来生成威胁情报。这可以是电子邮件、网站或文件。为了涵盖这三方面，假设组织收到一封电子邮件，指示用户访问一个网站，网站提示他们输入凭证，并在用户提交凭证后下载并尝试执行一个文件。你可以使用
    GitHub 仓库中的名为*invoice.eml*的文件，访问地址为[https://cti.seosint.xyz/](https://cti.seosint.xyz/)。
- en: Creating a Pulse
  id: totrans-17
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 创建脉冲
- en: Log in to OTX and select **Create Pulse** on the OTX dashboard,which is where
    you’ll land each time you log in ([Figure 12-1](#figure12-1)). In OTX, a *pulse*
    is a set of indicators of compromise for a specific attack.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 登录到 OTX 并在 OTX 仪表板上选择**创建脉冲**，这是你每次登录后会进入的页面（[图 12-1](#figure12-1)）。在 OTX 中，*脉冲*是特定攻击的妥协指标集。
- en: '![<<OTX Dashboard shows tab listing pulses to which the user is subscribed,
    including "IcedID GZIPLoader Analysis," “Dearcry Ransomware used against unpatched
    exchange servers,” and “Fin8 returns with improved BADHATCH Toolkit". >>](image_fi/500983c12/f12001.png)'
  id: totrans-19
  prefs: []
  type: TYPE_IMG
  zh: '![<<OTX 仪表板显示用户订阅的脉冲标签列表，包括“ IcedID GZIPLoader 分析”、“针对未修补的交换服务器使用的 Dearcry
    勒索软件”以及“Fin8 带着改进的 BADHATCH 工具包回归”。>>](image_fi/500983c12/f12001.png)'
- en: 'Figure 12-1: OTX Dashboard'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 图 12-1：OTX 仪表板
- en: You should be presented with a few options for creating the pulse ([Figure 12-2](#figure12-2)).
    You can import text or a website or manually input the indicators.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 你将看到一些选项来创建脉冲（[图 12-2](#figure12-2)）。你可以导入文本或网站，或者手动输入指标。
- en: '![<<OTX Create New Pulse page. Left, option to enter text/source URL which
    OTX automatically extracts to pull indicators of compromise. Right, option to
    drag and drop or manually browse files to add indicators.>>](image_fi/500983c12/f12002.png)'
  id: totrans-22
  prefs: []
  type: TYPE_IMG
  zh: '![<<OTX 创建新脉冲页面。左侧，输入文本/源 URL 的选项，OTX 会自动提取该 URL 来获取妥协指标。右侧，拖放或手动浏览文件以添加指标的选项。>>](image_fi/500983c12/f12002.png)'
- en: 'Figure 12-2: Creating a pulse in OTX'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 图 12-2：在 OTX 中创建脉冲
- en: Let’s start by copying and pasting the whole source of the email.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们从复制并粘贴电子邮件的完整源代码开始。
- en: Analyzing the Email Source
  id: totrans-25
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 分析电子邮件源代码
- en: I like to use Thunderbird for viewing the email source. It’s a free and open
    source mail client maintained by Mozilla. Once Thunderbird is installed and running,
    you can import any saved emails to OTX in *.eml* format and start analyzing. In
    Thunderbird, first open the email. Then in the top-right corner, select **More**▶**View
    Source** ([Figure 12-3](#figure12-3)).
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 我喜欢使用 Thunderbird 查看电子邮件源代码。这是一个由 Mozilla 维护的免费开源邮件客户端。安装并运行 Thunderbird 后，你可以将任何保存的
    *.eml* 格式电子邮件导入到 OTX 并开始分析。在 Thunderbird 中，首先打开电子邮件。然后在右上角，选择 **更多**▶**查看源代码**
    ([图 12-3](#figure12-3))。
- en: '![<<Thunderbird window shows email stating that the user’s PayPal account has
    been suspended and the user needs to confirm their identity. In top-right corner
    under the More drop-down menu, "View Source" is highlighted.>>](image_fi/500983c12/f12003.png)'
  id: totrans-27
  prefs: []
  type: TYPE_IMG
  zh: '![<<Thunderbird 窗口显示电子邮件，声明用户的 PayPal 账户已被暂停，并且用户需要确认他们的身份。在右上角的更多下拉菜单中，“查看源代码”被高亮显示。>>](image_fi/500983c12/f12003.png)'
- en: 'Figure 12-3: Viewing the source of an email in Thunderbird'
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 图 12-3：在 Thunderbird 中查看电子邮件源代码
- en: Once the email is opened as the source, you should see something like the excerpt
    in [Figure 12-4](#figure12-4). This is the underlying trail of data that gets
    transmitted when you send an email, including all checks performed and the email’s
    source and destinations. You can view any downloadable email in this way, sometimes
    even in the mail client itself. For example, in Gmail, you’d click the three dots
    in the top-right corner of an email and then select Show original.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦电子邮件以源代码形式打开，你应该能看到类似 [图 12-4](#figure12-4) 中的摘录。这是发送电子邮件时传输的底层数据轨迹，包括执行的所有检查和电子邮件的源地址与目标地址。你可以通过这种方式查看任何可下载的电子邮件，有时甚至在邮件客户端本身中。例如，在
    Gmail 中，你可以点击电子邮件右上角的三个点，然后选择“显示原始邮件”。
- en: '![<<Excerpt of email source file located in file:///Users/joegray/Downloads/Invoice%20_Remittance%2010022.eml?type=application/x-message-display.
    Partially censored by author.>>](image_fi/500983c12/f12004.png)'
  id: totrans-30
  prefs: []
  type: TYPE_IMG
  zh: '![<<电子邮件源文件摘录，位置在 file:///Users/joegray/Downloads/Invoice%20_Remittance%2010022.eml?type=application/x-message-display。作者部分审查。>>](image_fi/500983c12/f12004.png)'
- en: 'Figure 12-4: The source of a phishing email'
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 图 12-4：钓鱼电子邮件的来源
- en: It’s important to view an email’s source. This lets you see where an email really
    came from, rather than relying on a potentially spoofed source address. You’ll
    see both the real email address and the spoofed email address, as well as the
    sender’s IP address.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 查看电子邮件的源代码非常重要。这样你可以看到电子邮件真正来自哪里，而不是依赖于可能被伪造的源地址。你将看到真实的电子邮件地址和伪造的电子邮件地址，以及发件人的
    IP 地址。
- en: When copying and pasting this email into the pulse, be careful not to include
    your mail server’s IP address or any other addresses belonging to reputable mail
    vendors. If you add these and start searching, you will receive an overwhelmingly
    high number of false positives, which, if not tuned, will breed complacency.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 当将此电子邮件复制并粘贴到脉冲中时，要小心不要包含你邮件服务器的 IP 地址或任何其他来自信誉良好的邮件供应商的地址。如果你添加了这些并开始搜索，你将收到大量的误报，如果没有调优，这些误报将导致自满。
- en: Inputting Indicators
  id: totrans-34
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 输入指标
- en: Now that you’ve obtained information from the source, you’re ready to import
    some indicators. *Indicators* are data points related to the activity that you
    are capturing in the pulse. [Table 12-1](#table12-1) lists the indicators that
    OTX accepts.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 现在你已经从源代码中获得信息，准备好导入一些指标了。*指标*是与正在捕捉的脉冲活动相关的数据点。[表 12-1](#table12-1)列出了 OTX
    接受的指标。
- en: 'Table 12-1: Indicators Accepted by OTX'
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 表 12-1：OTX 接受的指标
- en: '| **Indicator type** | **Description** |'
  id: totrans-37
  prefs: []
  type: TYPE_TB
  zh: '| **指标类型** | **描述** |'
- en: '| --- | --- |'
  id: totrans-38
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| IPv4 | The IPv4 address of the source email server or site hosting the phishing
    or malware. |'
  id: totrans-39
  prefs: []
  type: TYPE_TB
  zh: '| IPv4 | 托管钓鱼或恶意软件的源电子邮件服务器或网站的 IPv4 地址。 |'
- en: '| IPv6 | The IPv6 address of the source email server or site hosting the phishing
    or malware. |'
  id: totrans-40
  prefs: []
  type: TYPE_TB
  zh: '| IPv6 | 托管钓鱼或恶意软件的源电子邮件服务器或网站的 IPv6 地址。 |'
- en: '| Domain | The domain of the source email server or site hosting the phishing
    or malware. |'
  id: totrans-41
  prefs: []
  type: TYPE_TB
  zh: '| 域名 | 源电子邮件服务器或托管钓鱼或恶意软件的网站的域名。 |'
- en: '| Hostname | The hostname or subdomain of the source email server or site hosting
    the phishing or malware. |'
  id: totrans-42
  prefs: []
  type: TYPE_TB
  zh: '| 主机名 | 托管钓鱼或恶意软件的源电子邮件服务器或网站的主机名或子域名。 |'
- en: '| Email | The source email address. |'
  id: totrans-43
  prefs: []
  type: TYPE_TB
  zh: '| 电子邮件 | 源电子邮件地址。 |'
- en: '| URL | The Uniform Resource Locator of the site hosting the phishing or malware.
    |'
  id: totrans-44
  prefs: []
  type: TYPE_TB
  zh: '| URL | 托管钓鱼或恶意软件的网站的统一资源定位符（URL）。 |'
- en: '| URI | The Uniform Resource Identifier of the precise location within the
    site hosting the phishing or malware. |'
  id: totrans-45
  prefs: []
  type: TYPE_TB
  zh: '| URI | 托管钓鱼或恶意软件的网站的精确位置的统一资源标识符（URI）。 |'
- en: '| File hash | The one-way cryptographic representation of the malicious file
    contained within the phishing email. This can be accomplished in various formats
    including these:'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: '| 文件哈希 | 对钓鱼邮件中包含的恶意文件进行的一种单向加密表示。可以通过多种格式完成，包括以下几种： |'
- en: 'MD5: 128-bit cryptographic representation of a file using the Message Digest
    5 Algorithm'
  id: totrans-47
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: MD5：使用消息摘要5算法（MD5）对文件进行的128位加密表示。 |
- en: 'SHA-1: 160-bit cryptographic representation of a file using the Secure Hashing
    Algorithm'
  id: totrans-48
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: SHA-1：使用安全哈希算法（SHA-1）对文件进行的160位加密表示。 |
- en: 'SHA-256: 256-bit cryptographic representation of a file using the Secure Hashing
    265-bit Algorithm'
  id: totrans-49
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: SHA-256：使用安全哈希算法256位（SHA-256）对文件进行的256位加密表示。 |
- en: '|'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '| PEHASH | Portable Executable Hash (peHash) method of fuzzy hashing, which
    instead of hashing the entire file accomplishes byte-by-byte hashing by taking
    several variables from within the executable and hashing them. |'
  id: totrans-51
  prefs: []
  type: TYPE_TB
  zh: '| PEHASH | 可移植可执行哈希（peHash）是一种模糊哈希方法，与其对整个文件进行哈希不同，它通过提取可执行文件中的多个变量并对其逐字节哈希来完成。
    |'
- en: '| IMPASH | Import Hash; similar to peHash, but tracks the DLLs and other files
    that the code imports. |'
  id: totrans-52
  prefs: []
  type: TYPE_TB
  zh: '| IMPASH | 导入哈希（IMPASH）；类似于peHash，但跟踪代码导入的DLL和其他文件。 |'
- en: '| CIDR | The classless interdomain routing address of the network IP address
    range that a domain owns, expressed as a base IP and the number of possible subnets.
    The format is typically *xxx.xxx.xxx.xxx*/*yy*, where *xxx.xxx.xxx.xxx* is the
    base IPv4 address and *yy* is a number between 1 and 32 that denotes the number
    of possible subnets and hosts within this block. You will typically see numbers
    between 24 and 32 in this range. |'
  id: totrans-53
  prefs: []
  type: TYPE_TB
  zh: '| CIDR | 无类域间路由（CIDR）是一个网络IP地址范围的地址，表示域拥有的基础IP和可能的子网数量。格式通常为 *xxx.xxx.xxx.xxx*/*yy*，其中
    *xxx.xxx.xxx.xxx* 是基础IPv4地址，*yy* 是一个介于1和32之间的数字，表示该块内可能的子网和主机数量。你通常会看到该范围内的数字在24到32之间。
    |'
- en: '| File path | A unique location within the workstation where the malicious
    files are discovered. This shows the behavior of uniformity, likely through a
    script. |'
  id: totrans-54
  prefs: []
  type: TYPE_TB
  zh: '| 文件路径 | 工作站中发现恶意文件的唯一位置。此路径显示了统一行为，可能是通过脚本实现的。 |'
- en: '| MUTEX | A mutual exclusion object (MUTEX) is an object within a program designed
    to allow multiple threads to share the resource such as file access, but not at
    the same time. |'
  id: totrans-55
  prefs: []
  type: TYPE_TB
  zh: '| MUTEX | 互斥对象（MUTEX）是程序中的一个对象，旨在允许多个线程共享资源（如文件访问），但不能同时共享。 |'
- en: '| CVE | Common Vulnerabilities and Exposures are responsibly disclosed vulnerabilities.
    Including a CVE in the pulse allows others to search for the CVE when subscribing
    to feeds. This is especially helpful when the phishing email attempts to perform
    some level of technical exploitation based on an existing vulnerability. |'
  id: totrans-56
  prefs: []
  type: TYPE_TB
  zh: '| CVE | 公共漏洞与暴露（CVE）是负责任地披露的漏洞。将CVE包括在脉冲中，可以让其他人在订阅信息流时搜索该CVE。这在钓鱼邮件试图基于现有漏洞进行某种程度的技术利用时尤其有用。
    |'
- en: '| YARA | YARA is either Yet Another Recursive Acronym or Yet Another Regular
    Expression (REGEX) Analyzer. This is a means to match patterns within files and
    iterate across an environment either using a SEIM or a custom YARA tool, which
    supports Windows, macOS, and Linux. |'
  id: totrans-57
  prefs: []
  type: TYPE_TB
  zh: '| YARA | YARA是“又一个递归缩写”或“又一个正则表达式（REGEX）分析器”的缩写。这是一种匹配文件中的模式并在环境中迭代的方式，通常使用SEIM或自定义的YARA工具，支持Windows、macOS和Linux。
    |'
- en: Copy the entire email source and paste it in the left-hand box in the image,
    and then select **Extract Indicators** ([Figure 12-5](#figure12-5)). This will
    do the parsing automatically, but you’ll need to go through the indicators and
    sanity-check them.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 将整个电子邮件源复制并粘贴到图像中的左侧框中，然后选择 **提取指示器**（[图12-5](#figure12-5)）。这会自动进行解析，但你仍然需要检查这些指示器并确保它们的准确性。
    |
- en: '![<<OTX Create New Pulse page zoomed in on "Enter Source URL or Text" field
    with email source entered. "Extract Indicators" button is below field.>>](image_fi/500983c12/f12005.png)'
  id: totrans-59
  prefs: []
  type: TYPE_IMG
  zh: '![<<OTX 创建新脉冲页面，聚焦于“输入来源URL或文本”字段，已输入邮箱来源，字段下方是“提取指示器”按钮。>>](image_fi/500983c12/f12005.png)'
- en: 'Figure 12-5: OTX Indicator extraction'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 图12-5：OTX指示器提取 |
- en: As you can see in [Figure 12-6](#figure12-6), the parser extracted three indicators
    from the email you pasted.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 如你在[图12-6](#figure12-6)中看到的，解析器从你粘贴的电子邮件中提取了三个指示器。 |
- en: '![<<“Included IOCs” tab of Parser Results displays three extracted indicators
    with their types—IPv4, Hostname, and Email—outlined in red.>>](image_fi/500983c12/f12006.png)'
  id: totrans-62
  prefs: []
  type: TYPE_IMG
  zh: '![<<“包含的IOC”标签在解析结果中显示了三个提取的指示器及其类型—IPv4、主机名和电子邮件，类型通过红色框标出。>>](image_fi/500983c12/f12006.png)'
- en: 'Figure 12-6: Included indicators'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 图12-6：包含的指示器 |
- en: You need to verify that these indicators belong in the pulse. Since you know
    from inspecting the email source that the listed email is the sender’s, you don’t
    need to check it again. But you do need to check the domains and IP addresses.
    To accomplish this, let’s do a little OSINT.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 你需要验证这些指标是否属于该脉冲。由于你通过检查邮件源知道列出的邮件是发件人的，你不需要再次检查它。但你需要检查这些域名和 IP 地址。为了完成这一点，我们做一点
    OSINT（开放源情报收集）。
- en: 'You need to determine the following: Who owns each domain and IP address? Does
    the domain and IP address serve a legitimate purpose? Does the domain owner have
    any control over the data passed through their services? Do the IP addresses belong
    to email providers? Or do we own the domain or IP address?'
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 你需要确定以下内容：每个域名和 IP 地址的所有者是谁？该域名和 IP 地址是否有合法用途？域名所有者是否控制其服务中传递的数据？这些 IP 地址是否属于邮件提供商？或者我们是否拥有该域名或
    IP 地址？
- en: The possible IOCs in [Figure 12-7](#figure12-7) are not valuable pieces of threat
    intelligence, so if OTX doesn’t, you will need to exclude them. You’ll do this
    later in the process, to avoid analyzing them twice.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: '[图 12-7](#figure12-7) 中的可能 IOC 并不是有价值的威胁情报，因此如果 OTX 没有排除它们，你将需要将它们排除。你将在后续过程进行排除，以避免重复分析这些指标。'
- en: '![<<"Excluded IOCs" tab of parser results displays 13 excluded indicators with
    their types (IPv4, URL, and Hostname) and reasons for exclusion, which include
    “Manually excluded,” "Private IP Address," and "whitelisted domain outlook.com."
    >>](image_fi/500983c12/f12007.png)'
  id: totrans-67
  prefs: []
  type: TYPE_IMG
  zh: '![<<"排除的 IOC" 解析结果标签显示了 13 个被排除的指标及其类型（IPv4、URL 和主机名）以及排除原因，包括“手动排除”、“私有 IP
    地址”和“白名单域 outlook.com。” >>](image_fi/500983c12/f12007.png)'
- en: 'Figure 12-7: Excluded indicators'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 图 12-7：排除的指标
- en: Now, you move to the list of *Excluded IOCs*. You repeat the process you used
    for the Included IOCs for each item in the Excluded IOCs list. Off the bat, you
    can tell that some of these do not belong on the list of indicators.
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，你转到*排除的 IOC* 列表。你对每个排除的 IOC 项目，重复你对已包含 IOC 所采用的相同过程。一开始，你就能看出这些项目中有些并不属于指标列表。
- en: 'From this extraction, go ahead and remove the following: three obvious Microsoft
    addresses (*by5pr19mb3713.namprd19.prod.outlook.com*, *by5pr19mb3970.namprd19.prod.outlook.com*,
    and *nam12-mw2-obe.outbound.protection.outlook.com*); two obvious Google addresses
    (*mail-sor-f41.google.com* and *mx.google.com*); a series of GoDaddy addresses
    (*p3plibsmtp01-08.prod.phx3.secureserver.net*, *p3plsmtp21-01-26.prod.phx3.secureserver.net*,
    and *p3plsmtp21-01.prod.phx3.secureserver.net*); and 10.186.134.206, which is
    a Class A, private, non-routable, internal IP address.'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 从这个提取结果中，继续移除以下内容：三个明显的微软地址（*by5pr19mb3713.namprd19.prod.outlook.com*、*by5pr19mb3970.namprd19.prod.outlook.com*
    和 *nam12-mw2-obe.outbound.protection.outlook.com*）；两个明显的谷歌地址（*mail-sor-f41.google.com*
    和 *mx.google.com*）；一系列 GoDaddy 地址（*p3plibsmtp01-08.prod.phx3.secureserver.net*、*p3plsmtp21-01-26.prod.phx3.secureserver.net*
    和 *p3plsmtp21-01.prod.phx3.secureserver.net*）；以及 10.186.134.206，这是一个 A 类私有、不可路由的内部
    IP 地址。
- en: Testing a Potentially Malicious Domain in Burp
  id: totrans-71
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 在 Burp 中测试潜在恶意域名
- en: OTX claims that *docsend.com* is a whitelisted domain, but it does allow users
    to upload files. This means it’s prudent to go ahead and check what the sender
    is trying to coerce victims into opening. In the digital forensics and malware
    world, this is part of what is known as *detonating*. Detonating can be dangerous
    if you’re on an unprotected system, as it can get infected. I recommend using
    a dedicated system for this, or at minimum a dedicated virtual machine.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: OTX 声称 *docsend.com* 是一个被列入白名单的域名，但它确实允许用户上传文件。这意味着，最好继续检查发送者试图迫使受害者打开的内容。在数字取证和恶意软件领域，这被称为*引爆*。如果你在一个没有保护的系统上进行引爆，可能会受到感染，所以我建议使用专门的系统，或者至少使用专用的虚拟机来处理此类操作。
- en: In addition to a virtual machine, I recommend ensuring that you have malware
    protection installed (if applicable), a firewall enabled at the host and network
    level, the use of a VPN, and (if you are comfortable with it), the Tor browser
    (or Brave—which offers a similar functionality), though you have to select Open
    a New Private Window with Tor. You may find yourself dealing with some nasty stuff,
    and you do not want to find yourself on the wrong side of the law while trying
    to conduct legitimate security research.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 除了虚拟机外，我建议确保安装了恶意软件防护（如果适用），启用主机和网络级别的防火墙，使用 VPN，并且（如果你对它感到舒服的话）使用 Tor 浏览器（或
    Brave 浏览器——它提供类似的功能），不过你需要选择“使用 Tor 打开新隐私窗口”。你可能会遇到一些麻烦的东西，而你可不希望在进行合法的安全研究时，自己掉进法律的陷阱。
- en: Open your virtual machine on a separate system and network segment than your
    main network, with a firewall and security appliance running between the system
    and the rest of your home lab and network. Depending on the level of analysis
    you intend on performing, you could choose to use a Linux virtual machine or a
    Windows one. If you want a good sense of how the attack is supposed to work, you
    may want to use a vulnerable Windows system.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 打开您的虚拟机，确保它与您的主网络处于不同的系统和网络段，并且在该系统与其他家庭实验室和网络之间运行防火墙和安全设备。根据您计划执行的分析级别，您可以选择使用
    Linux 虚拟机或 Windows 虚拟机。如果您希望更好地理解攻击的运作方式，可能想使用一个易受攻击的 Windows 系统。
- en: 'Install Burp Suite on your host. *Burp* is a web proxy that allows you to intercept
    and alter data transmitted between you and the website. It will allow you to see
    calls made from your system to the website and the responses. You can also control
    any pop-ups and many unintended actions, like redirects to malicious sites. To
    install Burp, download a copy of the free Community Edition from [https://portswigger.net/burp/communitydownload/](https://portswigger.net/burp/communitydownload/).
    This will include a script similar to `burpsuite_community_linux_v<#>_#_##.sh`.
    Input the most recent version into the commands shown here:'
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 在您的主机上安装 Burp Suite。*Burp* 是一个网页代理，允许您拦截和更改在您和网站之间传输的数据。它使您能够查看系统向网站发出的请求及其响应。您还可以控制任何弹出窗口和许多意外的动作，比如重定向到恶意网站。要安装
    Burp，下载免费版社区版的副本，网址为[https://portswigger.net/burp/communitydownload/](https://portswigger.net/burp/communitydownload/)。这将包含一个类似于
    `burpsuite_community_linux_v<#>_#_##.sh` 的脚本。输入最新版本到这里显示的命令中：
- en: '[PRE0]'
  id: totrans-76
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: Once it’s installed, you can use the GUI to open Burp by either clicking the
    Burp icon or typing *Burp* into the operating system menu. Burp will prompt you
    to create a project. Click **Next**, and you should be prompted to accept the
    Burp default configurations or load a configuration file. Sticking with the defaults
    should be fine.
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 安装完成后，您可以通过点击 Burp 图标或在操作系统菜单中输入*Burp*来使用图形界面打开 Burp。Burp 会提示您创建一个项目。点击**下一步**，接着您将被提示接受
    Burp 默认配置或加载配置文件。保持默认设置应该没有问题。
- en: Next, you have to route your browser’s traffic through Burp. To do this, open
    Firefox and click the Menu icon and then scroll to the bottom. Click **Network
    Settings**. You should be prompted to enter information about your proxy, as shown
    in [Figure 12-8](#figure12-8). Select **Manual proxy configuration** and then
    enter the IP address `127.0.0.1` as the HTTP Proxy and `8080` as the Port. Select
    the option to use this proxy server for all protocols.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，您需要将浏览器的流量通过 Burp 路由。为此，打开 Firefox，点击菜单图标，然后滚动到页面底部。点击**网络设置**。您应该会被提示输入代理信息，如[图
    12-8](#figure12-8)所示。选择**手动代理配置**，然后输入 IP 地址`127.0.0.1`作为 HTTP 代理和端口`8080`。选择使用此代理服务器进行所有协议的选项。
- en: Now that you have Burp installed and Firefox configured to route your traffic
    through Burp, open Burp and make sure that it is configured for intercepting traffic.
    To accomplish this, select the **Proxy** tab, then **Intercept**. Finally, ensure
    that Intercept is on.
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 现在您已安装 Burp 并配置 Firefox 通过 Burp 路由流量，打开 Burp 并确保它已配置为拦截流量。为此，选择**Proxy**标签页，然后点击**Intercept**。最后，确保
    Intercept 已开启。
- en: '![<<Firefox preferences page shows "Connection Settings" box with options to
    "Configure Proxy Access to the Internet." Outlined in red: "Manual proxy configuration"
    option, "127.0.0.1" HTTP Proxy, "8080" port, and "Also use this proxy for FTP
    and HTTPS." checkbox.>>](image_fi/500983c12/f12008.png)'
  id: totrans-80
  prefs: []
  type: TYPE_IMG
  zh: '![<<Firefox 首选项页面显示“连接设置”框，其中有“配置代理访问互联网”的选项。红框标出： “手动代理配置”选项、“127.0.0.1”HTTP
    代理、“8080”端口，以及“也将此代理用于 FTP 和 HTTPS。”复选框。>>](image_fi/500983c12/f12008.png)'
- en: 'Figure 12-8: Configuring a network proxy in Firefox'
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 图 12-8：在 Firefox 中配置网络代理
- en: Once you’ve verified that Burp is configured correctly, you can use it to intercept
    your browser’s traffic (see [Figure 12-9](#figure12-9)). As long as Intercept
    is on, you’ll need to choose whether to forward or drop each web request*.* This
    means you can drop malicious (or legitimate) traffic instead of sending it to
    your browser.
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦确认 Burp 已正确配置，您可以使用它来拦截浏览器的流量（参见[图 12-9](#figure12-9)）。只要 Intercept 开启，您需要选择是转发还是丢弃每个网页请求*.*
    这意味着您可以丢弃恶意（或合法）流量，而不是将其发送到浏览器。
- en: '![<<Burp Suite Community Edition dashboard with sections for Tasks, Event log,
    and Issue Activity (pro version only).>>](image_fi/500983c12/f12009.png)'
  id: totrans-83
  prefs: []
  type: TYPE_IMG
  zh: '![<<Burp Suite Community Edition仪表板，包含任务、事件日志和问题活动（仅限专业版）部分。>>](image_fi/500983c12/f12009.png)'
- en: 'Figure 12-9: Intercepting traffic with Burp'
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 图 12-9：使用 Burp 截取流量
- en: 'Now, let’s visit the website found in the email. When you forward it using
    Burp, a website loads. This appears to be a PayPal site, but in [Figure 12-10](#figure12-10),
    you can easily spot that it’s not legitimate: notice the URL lacks the word *PayPal*
    and has an *.es* top-level domain. In addition, the *code=US&id=8799879&country=United
    States* at the end shows that some sort of tracking is in use.'
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，让我们访问电子邮件中找到的网站。当你使用 Burp 转发它时，会加载一个网站。这看起来像是一个 PayPal 网站，但在[图 12-10](#figure12-10)中，你可以很容易地发现它并不合法：注意
    URL 中没有 *PayPal* 字样，而且使用的是 *.es* 顶级域名。此外，URL 末尾的 *code=US&id=8799879&country=United
    States* 表示正在使用某种追踪手段。
- en: '![<<Web page shows what appears to be a PayPal login screen. Highlighted in
    red: link''s redirect location shows the URL http://nurrahmahgroup.esy.es/pjj/creer/Adeit.">>](image_fi/500983c12/f12010.png)'
  id: totrans-86
  prefs: []
  type: TYPE_IMG
  zh: '![<<网页显示的似乎是 PayPal 登录屏幕。红色高亮：链接的重定向位置显示 URL http://nurrahmahgroup.esy.es/pjj/creer/Adeit。>>](image_fi/500983c12/f12010.png)'
- en: 'Figure 12-10: The example phishing landing page'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 图 12-10：示例钓鱼登陆页面
- en: The complete omission of *PayPal* from the URL is probably the biggest red flag.
    If you try to open this link in the sandbox system (the isolated system or virtual
    machine discussed earlier in this chapter), the host should be unknown. And, as
    you can see in [Figure 12-11](#figure12-11), Burp shows us that entering information
    and clicking the link is a dead end—likely pointing to a failed attempt at *credential
    harvesting*.
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: URL 中完全没有 *PayPal* 字样可能是最大的警示信号。如果你尝试在沙箱系统（本章前面提到的隔离系统或虚拟机）中打开该链接，主机应该是未知的。而且，如你在[图
    12-11](#figure12-11)中看到的，Burp 显示我们输入信息并点击链接后没有任何反应——很可能是一次 *凭证盗取* 失败的尝试。
- en: '![<<Burp Suite Community Edition window shows message "Error: Request was dropped
    by user” with redirect to http://nurrahmahgroup.esy.es/pjj/creer/Adeit.>>](image_fi/500983c12/f12011.png)'
  id: totrans-89
  prefs: []
  type: TYPE_IMG
  zh: '![<<Burp Suite Community Edition 窗口显示信息“错误：请求被用户丢弃”，并重定向至 http://nurrahmahgroup.esy.es/pjj/creer/Adeit。>>](image_fi/500983c12/f12011.png)'
- en: 'Figure 12-11: Broken phishing redirect'
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 图 12-11：断开的钓鱼重定向
- en: The fact that the site does nothing might indicate that PayPal or another vendor
    took action, probably leveraging the DMCA. It could also indicate an adversary
    that lacks the sophistication to expand their efforts. It’s important to avoid
    dismissing the threat associated with credential harvesting, however. As noted
    time and time again, people still routinely use the same password on multiple
    platforms, both personal and professional accounts. Many sites either do not force
    or do not support multifactor authentication, compounding this threat.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 该网站什么都不做，可能表明 PayPal 或其他供应商已采取了行动，可能利用了 DMCA。也可能表明攻击者缺乏扩展其攻击的技术能力。然而，重要的是不要忽视与凭证盗取相关的威胁。如反复所述，很多人仍然在多个平台上使用相同的密码，包括个人和工作账户。许多网站要么不强制，要么不支持多因素认证，从而加剧了这一威胁。
- en: Although the link is broken, you should still add it to the OTX pulse. Before
    you move on, add the four IP addresses we identified as irrelevant to the excluded
    indicators by checking the boxes next to them and clicking **Exclude**.
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管链接失效，你仍然应该将其添加到 OTX pulse 中。在继续之前，通过勾选我们标识出的四个无关的 IP 地址旁边的框，并点击 **排除**，将它们添加到排除指标中。
- en: Analyzing Downloadable Files
  id: totrans-93
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 分析可下载文件
- en: This phishing campaign did not include any downloadable files. But what if it
    did? Let’s briefly discuss analyzing them. To start, you’ll need to get cryptographic
    hashes of those files. Having the cryptographic hashes of files allows you to
    compare the files in known states to other versions to see if anything changed.
    When a file is created (or in the case of malware, observed), you take a cryptographic
    hash of the file to help you search for it faster. You compare the hashes of files
    on your systems to the known bad file (in the case of malware) and alert on any
    matches. In some cases, the file changes itself, and so the hash will not remain
    the same. We call this *polymorphic malware*, and it’s a discussion for a completely
    different book.
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 这个钓鱼攻击活动没有包括任何可下载的文件。但如果有呢？我们来简要讨论一下如何分析这些文件。首先，你需要获取这些文件的加密哈希值。拥有文件的加密哈希值可以让你将已知状态的文件与其他版本进行对比，看看是否发生了变化。当一个文件被创建（或者在恶意软件的情况下被观察到）时，你会对文件进行加密哈希处理，帮助你更快地搜索它。你可以将系统中的文件哈希与已知的恶意文件哈希进行对比，并在发现匹配时发出警报。在某些情况下，文件会自行变化，因此哈希值可能不再相同。我们称之为
    *变种恶意软件*，这是另一本书的话题。
- en: You can hash a file by using a variety of tools. Some, like the following, come
    already installed on Linux. It’s sometimes worth entering multiple hash kinds,
    because some systems will check files using only one algorithm.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以使用多种工具来生成文件的哈希值。像以下这些工具，Linux上通常已经预装。有时候输入多个哈希类型是值得的，因为某些系统只会使用单一算法来检查文件。
- en: 'To produce an MD5 hash of the file, enter the following command:'
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 要生成文件的MD5哈希值，请输入以下命令：
- en: '[PRE1]'
  id: totrans-97
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'To produce a SHA-1 hash of the file, enter this:'
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 要生成文件的SHA-1哈希值，请输入以下命令：
- en: '[PRE2]'
  id: totrans-99
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'To produce a SHA-256 hash of the file, enter this:'
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 要生成文件的SHA-256哈希值，请输入以下命令：
- en: '[PRE3]'
  id: totrans-101
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'To produce a SHA-512 hash of the file, enter this:'
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 要生成文件的SHA-512哈希值，请输入以下命令：
- en: '[PRE4]'
  id: totrans-103
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: Then add each hash to OTX. If you choose to write up this incident and publish
    a report, you might import the pulse from the URL and list the URL as a resource.
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 然后将每个哈希值添加到OTX。如果你选择编写此事件并发布报告，你可以从URL导入脉冲数据并将该URL列为资源。
- en: In the following sections, we will further analyze the *esy.es* domain.
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 在接下来的章节中，我们将进一步分析*esy.es*域名。
- en: Conducting OSINT for Threat Intelligence
  id: totrans-106
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 进行威胁情报的OSINT分析
- en: OTX isn’t the only resource you can use to analyze malicious links or emails.
    In this section, we’ll explore a few others. You might recognize some of these
    tools and techniques from the OSINT chapters of this book. Here, you’ll use these
    resources to figure out whether a site is harmful.
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: OTX并不是唯一可以用来分析恶意链接或电子邮件的资源。在本节中，我们将探索其他一些工具和资源。你可能会在本书的OSINT章节中认出一些这些工具和技术。在这里，你将使用这些资源来判断一个网站是否有害。
- en: Searching VirusTotal
  id: totrans-108
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 在VirusTotal中搜索
- en: 'A website owned by Chronicle Security, [https://www.virustotal.com/](https://www.virustotal.com/),
    allows researchers and threat intelligence professionals to analyze whether a
    file is listed as malicious on more than 60 antivirus platforms without having
    to buy every one of them. It also allows you to check the status of any URLs.
    VirusTotal also has an API for scripted analysis. Its web-based GUI search function
    accepts the following input types: the actual uploaded file, a URL, an IP address,
    a domain, or a file hash.'
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 一个由Chronicle Security公司拥有的网站，[https://www.virustotal.com/](https://www.virustotal.com/)，允许研究人员和威胁情报专家分析一个文件是否在超过60个杀毒平台上被列为恶意文件，而无需购买所有这些平台。它还允许你检查任何URL的状态。VirusTotal还提供了API进行脚本化分析。它的基于Web的GUI搜索功能支持以下输入类型：实际上传的文件、URL、IP地址、域名或文件哈希值。
- en: Identifying Malicious Sites on WHOIS
  id: totrans-110
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 通过WHOIS识别恶意网站
- en: You ran the WHOIS command when collecting OSINT. But when using WHOIS to analyze
    malware, you’ll want to look for additional information. Notably, in addition
    to the usual WHOIS information, you want to see the country where a domain is
    registered and its autonomous system number (ASN). The ASN will help later when
    you use PhishTank to analyze the systems from which the phishing email originates.
    [Figure 12-12](#figure12-12) shows the WHOIS record for the sketchy-seeming domain
    *esy.es*.
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 当你收集OSINT时，你运行了WHOIS命令。但在使用WHOIS分析恶意软件时，你需要寻找额外的信息。特别是，除了常规的WHOIS信息外，你还需要查看域名注册的国家和其自治系统号码（ASN）。ASN将在你使用PhishTank分析网络钓鱼邮件来源系统时发挥作用。[图12-12](#figure12-12)展示了看似可疑的域名*esy.es*的WHOIS记录。
- en: '![<<DomainTools Whois Record for “Esy.es.” Entries include Registrar Status
    ("taken"), Name Servers (four with 455 domains each), and IP Location ("Noord
    Holland Jordaan OpenTid Bv").>>](image_fi/500983c12/f12012.png)'
  id: totrans-112
  prefs: []
  type: TYPE_IMG
  zh: '![<<DomainTools Whois记录：“Esy.es”域名的记录，包含注册商状态（“已注册”）、名称服务器（每个有455个域名的四个服务器）和IP位置（“荷兰北部乔尔丹OpenTid
    Bv”）。>>](image_fi/500983c12/f12012.png)'
- en: 'Figure 12-12: *esy.es’*s WHOIS record'
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 图12-12：*esy.es*的WHOIS记录
- en: You can see that the domain was registered in an area of the Netherlands called
    Jordaan and last updated on 2021-06-09, and that it uses name servers hosted through
    main-hosting.com. In turn, performing a WHOIS search of main-hosting.com shows
    that it is being hosted on godaddy.com, whereas a reputable firm would likely
    host it in-house. You should also be wary of recently registered domains. Young
    domains warrant skepticism and analysis, as many are malicious. An 8-day-old domain
    and a 43-day-old name server are not automatically up to no good, but they do
    require additional investigation. In this instance, you should include both domains
    and any related IP addresses in your OTX pulse.
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以看到，该域名注册在荷兰一个叫做Jordaan的地区，并且最后更新于2021年6月9日，使用的是通过main-hosting.com托管的名称服务器。进一步进行main-hosting.com的WHOIS查询显示，它托管在godaddy.com上，而一家信誉良好的公司通常会在内部托管该域名。你还应该对最近注册的域名保持警惕。年轻的域名需要审慎分析，因为很多都是恶意的。一个注册仅8天的域名和一个43天的名称服务器并不意味着它们一定是有问题的，但它们确实需要额外的调查。在这种情况下，你应该将这两个域名和任何相关的IP地址包含在你的OTX脉冲中。
- en: What would a legitimate site’s WHOIS record show? For comparison, [Figure 12-13](#figure12-13)
    is the WHOIS output for *nostarch.com*.
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 合法网站的WHOIS记录会显示什么？为了比较，[图12-13](#figure12-13)是*nostarch.com*的WHOIS输出。
- en: '![<<DomainTools Whois Record for "NostArch.com". Outlined in red are Registrant
    Country (is), ASN (AS13335 CLOUDFLARENET, US (registered Jul 14, 2010)), Domain
    Status (Registered and Active Website), and Hosting History (3 changes on 4 unique
    name servers over 17 years).>>](image_fi/500983c12/f12013_updated.png)'
  id: totrans-116
  prefs: []
  type: TYPE_IMG
  zh: '![<<DomainTools Whois记录显示“nostarch.com”的WHOIS记录。红框中显示了注册人国家（冰岛）、ASN（AS13335
    CLOUDFLARENET，美国（注册于2010年7月14日））、域名状态（已注册且活跃网站）和托管历史（17年内发生3次更换，涉及4个独立的名称服务器）。>>](image_fi/500983c12/f12013_updated.png)'
- en: 'Figure 12-13: NoStarch’s WHOIS record'
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 图12-13：NoStarch的WHOIS记录
- en: First note that the registrant country is Iceland. This is common when organizations
    use services like WhoisGuard or domain privacy to conceal their location, and
    this is not an immediate cause for alarm or further analysis. If you review the
    date, you should see that this domain was created in 1996 and includes a registered
    and active website.
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 首先注意到注册人国家为冰岛。当组织使用WhoisGuard或域名隐私等服务来隐藏其位置时，这是常见的情况，这并不意味着需要立即警惕或进一步分析。如果你查看日期，你会看到该域名创建于1996年，并且包括一个注册并活跃的网站。
- en: Second, the ASN is listed as Cloudflare. The use of Cloudflare indicates that
    the site likely isn’t malicious, as content distribution networks typically remove
    anything they verify to be harmful. We also see that this domain has had three
    changes over four name servers in 17 years. This is normal and typically is indicative
    of changing providers. Technology has changed a lot since 1996, so it makes sense
    to switch providers and records to implement new technologies.
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 其次，ASN列出了Cloudflare。使用Cloudflare表明该网站很可能不是恶意的，因为内容分发网络通常会删除它们验证为有害的任何内容。我们还看到这个域名在17年里经历了四个不同的名称服务器的三次更改。这是正常的，通常表示更换了服务提供商。自1996年以来，技术发生了很大变化，因此更换服务商和记录以实现新技术是合乎逻辑的。
- en: Discovering Phishes with PhishTank
  id: totrans-120
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 使用PhishTank发现钓鱼网站
- en: PhishTank ([https://phishtank.com/](https://phishtank.com/)) is a free phishing
    verification platform operated by OpenDNS. It lets you search by domain, URL,
    or ASN. In my experience, searching by ASN is the most efficient. But since you
    don’t have an ASN for the potentially malicious *nurrahmahgroup.esy.es* domain,
    you’ll need to search by domain and URL. [Figure 12-14](#figure12-14) shows this
    search.
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: PhishTank ([https://phishtank.com/](https://phishtank.com/)) 是由OpenDNS运营的一个免费的钓鱼验证平台。它允许你按域名、URL或ASN进行搜索。根据我的经验，按ASN搜索最为高效。但由于你没有*nurrahmahgroup.esy.es*域名的ASN，你需要按域名和URL进行搜索。[图12-14](#figure12-14)显示了这一搜索结果。
- en: '![<<PhishTank "Home" tab reads "Join the fight against phishing. Submit suspected
    phishes. Track the status of your submissions. Verify other users'' submissions.
    Develop software with our free API." Shows search box for searching phishing database
    by URL with contents http://nurrahmahgroup.esy.es/pjj/creer/Adeit/signin.>>](image_fi/500983c12/f12014.png)'
  id: totrans-122
  prefs: []
  type: TYPE_IMG
  zh: '![<<PhishTank "首页"标签显示“加入反钓鱼战斗。提交可疑钓鱼网站。跟踪提交状态。验证其他用户的提交。通过我们的免费API开发软件。”显示用于按URL搜索钓鱼数据库的搜索框，内容为http://nurrahmahgroup.esy.es/pjj/creer/Adeit/signin。>>](image_fi/500983c12/f12014.png)'
- en: 'Figure 12-14: PhishTank search for *nurrahmahgroup.esy.es* phish'
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 图12-14：PhishTank搜索*nurrahmahgroup.esy.es*钓鱼网站
- en: As you can see in [Figure 12-15](#figure12-15), the search yields nothing. That
    doesn’t mean that it isn’t a phishing attempt—just that no one has reported it.
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 正如你在[图 12-15](#figure12-15)中看到的，搜索结果为空。这并不意味着它不是钓鱼尝试——只是目前没有人报告过。
- en: '![<<PhishTank web page shows message “Nothing known about http://nurrahmahgroup.esy.es/pjj/creer/Adeit.”>>](image_fi/500983c12/f12015.png)'
  id: totrans-125
  prefs: []
  type: TYPE_IMG
  zh: '![<<PhishTank 网页显示消息“未知 http://nurrahmahgroup.esy.es/pjj/creer/Adeit.”>>](image_fi/500983c12/f12015.png)'
- en: 'Figure 12-15: A valid phish on *PhishTank.com*'
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 图 12-15：*PhishTank.com* 上的有效钓鱼
- en: Since the site is down, I will walk through reporting it, but not submit the
    report. To start the report, click the **Add it to the Tank?** link below the
    statement that says that nothing is known. Next, enter the URL of the phish. In
    this case, you will need to paste the body of the email into three reports to
    the Tank (if you were submitting) to associate all three domains used. You also
    select Microsoft as the organization referenced in the email, since it claimed
    to be from Office 365\. Once it’s complete, click **Submit**.
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 由于该站点已关闭，我将演示如何报告，但不会提交报告。首先，点击声明“没有已知信息”下方的**将其添加到 Tank 中？**链接。接下来，输入钓鱼网站的
    URL。在这种情况下，你需要将电子邮件的正文粘贴到三个报告中提交给 Tank（如果你要提交的话），以便关联使用的所有三个域名。你还需要选择电子邮件中提到的组织
    Microsoft，因为它声称来自 Office 365。一旦完成，点击**提交**。
- en: '[Figure 12-16](#figure12-16) is an instance of entering the information associated
    with the phish into PhishTank for inclusion in its database.'
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: '[图 12-16](#figure12-16) 是将与钓鱼相关的信息输入到 PhishTank 中，以便将其纳入数据库的实例。'
- en: '![<<PhishTank "Add A Phish" tab. Outlined in red: fields for entering Phish
    URL (http://nurrahmahgroup.esy.es/pjj/creer/Adeit) and organization reference
    in the phishing email (PayPal). Also shows field for entering full email contents.>>](image_fi/500983c12/f12016.png)'
  id: totrans-129
  prefs: []
  type: TYPE_IMG
  zh: '![<<PhishTank "添加钓鱼"标签。红框突出显示：输入钓鱼 URL（http://nurrahmahgroup.esy.es/pjj/creer/Adeit）和钓鱼电子邮件中提到的组织（PayPal）的字段。同时显示输入完整电子邮件内容的字段。>>](image_fi/500983c12/f12016.png)'
- en: 'Figure 12-16: Submitting a phishing sample to PhishTank'
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 图 12-16：向 PhishTank 提交钓鱼样本
- en: Browsing ThreatCrowd
  id: totrans-131
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 浏览 ThreatCrowd
- en: Part of AT&T Cybersecurity, ThreatCrowd ([https://www.threatcrowd.org/](https://www.threatcrowd.org/))
    provides visualization regarding the legitimacy of domains, IP addresses, and
    other details like hashes. As with OTX and other platforms, you can access it
    independently or via links in ThreatMiner (discussed in the next section). [Figure
    12-17](#figure12-17) shows the visualization for the *nurrahmahgroup.esy.es* domain.
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 作为 AT&T 网络安全的一部分，ThreatCrowd ([https://www.threatcrowd.org/](https://www.threatcrowd.org/))
    提供关于域名、IP 地址以及其他细节（如哈希）的合法性可视化。与 OTX 及其他平台一样，你可以独立访问它，也可以通过 ThreatMiner 中的链接访问它（将在下一部分讨论）。[图
    12-17](#figure12-17) 显示了 *nurrahmahgroup.esy.es* 域名的可视化。
- en: In this visualization, you can see how various systems, hashes, domains, and
    other features interact with our system of interest. This can be very useful when
    building out a cyber threat intelligence program or doing a deep dive on a potential
    adversary. The graphical output also makes for some excellent artifacts when writing
    reports.
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个可视化中，你可以看到各种系统、哈希、域名和其他特征如何与我们的关注系统互动。当构建网络威胁情报程序或深入分析潜在对手时，这非常有用。图形输出也能作为写报告时的出色素材。
- en: '![<<ThreatCrowd visualization shows connected nodes of varying sizes displaying
    color-coded domains, IP addresses, and hashes. Outlined in red: a medium-sized
    blue node labeled "NURRAHMAHGROUP.ESY.ES," which connects to a large gray central
    node labeled with an IP address.>>](image_fi/500983c12/f12017.png)'
  id: totrans-134
  prefs: []
  type: TYPE_IMG
  zh: '![<<ThreatCrowd 可视化显示不同大小的连接节点，展示着色编码的域名、IP 地址和哈希。红框突出显示：一个中等大小的蓝色节点，标记为“NURRAHMAHGROUP.ESY.ES”，它连接到一个标记有
    IP 地址的大型灰色中心节点。>>](image_fi/500983c12/f12017.png)'
- en: 'Figure 12-17: ThreatCrowd visualization for *nurrahmahgroup.esy.es*'
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 图 12-17：*nurrahmahgroup.esy.es* 的 ThreatCrowd 可视化
- en: Consolidating Information in ThreatMiner
  id: totrans-136
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 在 ThreatMiner 中整合信息
- en: ThreatMiner ([https://www.threatminer.org/](https://www.threatminer.org/)) takes
    an input and pulls from several other threat intelligence sources to produce a
    single-pane view of what other platforms are saying. ThreatMiner allows you to
    get an idea of the likelihood of malice rather quickly. Like anything else, it
    is not a perfect solution, but it is one of the best, especially since it is free.
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: ThreatMiner ([https://www.threatminer.org/](https://www.threatminer.org/)) 接收输入并从多个其他威胁情报来源拉取信息，提供一个单一视图，展示其他平台的看法。ThreatMiner
    让你能迅速了解恶意的可能性。像其他任何工具一样，它不是完美的解决方案，但它是其中最好的之一，尤其是因为它是免费的。
- en: The ThreatMiner website allows you to search for either indicators or APT Notes.
    *APT Notes* is a repository of publicly available papers and blogs, sorted by
    year and related to malicious campaigns, activity, or software associated with
    vendor-defined advanced persistent threat groups or toolsets. Since you already
    have some indicators, let’s search for them first. Like OTX, ThreatMiner can process
    a variety of indicator types, some of which differ from OTX’s. They include domains,
    IP addresses, hashes (MD5, SHA-1, and SHA-256), email address, APT Notes, SSL/TLS
    certificates, user-agents, antivirus names, filenames, URIs, registry keys, and
    mutexes.
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: ThreatMiner 网站允许你搜索指示符或 APT 笔记。*APT 笔记* 是一个包含公开可用论文和博客的资料库，按年份排序，涉及与供应商定义的高级持续威胁（APT）组或工具集相关的恶意活动、攻击或软件。由于你已经有一些指示符，先让我们搜索这些。与
    OTX 类似，ThreatMiner 可以处理多种类型的指示符，其中一些与 OTX 的有所不同。它们包括域名、IP 地址、哈希（MD5、SHA-1 和 SHA-256）、电子邮件地址、APT
    笔记、SSL/TLS 证书、用户代理、杀毒软件名称、文件名、URI、注册表项和互斥体。
- en: 'Here’s one of ThreatMiner’s unique features: it opens a pane on the left side
    of the screen that shows possibly related Google search results. There, you should
    see WHOIS data for the indicator submitted, if appropriate. Further down the screen,
    you’ll see links to other resources, like RiskIQ, PassiveTotal, VirusTotal, DomainTools,
    ThreatCrowd, OTX, SecurityTrails, and Robtex.'
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 这是 ThreatMiner 的独特功能之一：它在屏幕左侧打开一个窗格，显示可能相关的 Google 搜索结果。在那里，你应该能看到与提交的指示符相关的
    WHOIS 数据（如果适用）。在屏幕下方，你还会看到其他资源的链接，如 RiskIQ、PassiveTotal、VirusTotal、DomainTools、ThreatCrowd、OTX、SecurityTrails
    和 Robtex。
- en: '[Figure 12-18](#figure12-18) shows a search for *nurrahmahgroup.esy.es*.'
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: '[图 12-18](#figure12-18) 显示了对 *nurrahmahgroup.esy.es* 的搜索。'
- en: '![<<ThreatMiner web page shows results for "nurrahmahgroup.esy.es" domain.
    Left pane displays possibly related Google search results (empty). Main page displays
    results for WHOIS information and related resources.>>](image_fi/500983c12/f12018_updated.png)'
  id: totrans-141
  prefs: []
  type: TYPE_IMG
  zh: '![<<ThreatMiner 网站显示“nurrahmahgroup.esy.es”域的结果。左侧窗格显示可能相关的 Google 搜索结果（为空）。主页面显示
    WHOIS 信息和相关资源的结果。>>](image_fi/500983c12/f12018_updated.png)'
- en: 'Figure 12-18: ThreatMiner results for *nurrahmahgroup.esy.es*'
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 图 12-18：*nurrahmahgroup.esy.es* 的 ThreatMiner 结果
- en: Below the related resources, you’ll notice that there are no APT Notes for the
    domain. Nor are there any related passive DNS, subdomains, associated URLs, Robtex,
    or malware samples. Given that the phishing email you analyzed is old and the
    domain was recently registered, this makes sense. For a more mature indicator,
    or a domain that has not been taken down, expect to see more information here.
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 在相关资源下方，你会注意到该域名没有 APT 笔记。也没有相关的被动 DNS、子域名、关联 URL、Robtex 或恶意软件样本。考虑到你分析的钓鱼邮件比较旧，而且该域名是最近注册的，这很有道理。对于一个更加成熟的指示符，或者尚未被撤下的域名，预计会在这里看到更多信息。
- en: 'Now, if ThreatMiner searches all of these sites for you, why did I wait until
    the end to show you its capabilities? To help you understand how to perform the
    analysis by yourself. When I’m performing threat intelligence analysis on phishing
    emails, I often start with two windows open: OTX and ThreatMiner. To use the information
    that ThreatMiner identifies as related, simply click the link.'
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，如果 ThreatMiner 为你搜索所有这些网站，为什么我等到最后才展示它的功能？是为了帮助你理解如何自己进行分析。当我在进行钓鱼邮件的威胁情报分析时，我通常会同时打开两个窗口：OTX
    和 ThreatMiner。要使用 ThreatMiner 识别的相关信息，只需点击链接。
- en: Conclusion
  id: totrans-145
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 结论
- en: Threat intelligence is more than snake oil and more than just consuming vendor
    feeds. It empowers you to analyze your own experiences and collect actionable
    information that not only helps you, but can help your clients, partners, and
    the community as a whole. In this chapter, you consumed and produced threat intelligence
    by using OTX, and then transitioned through defensive uses of WHOIS, ThreatCrowd,
    ThreatMiner, VirusTotal, and more. This is only the beginning of your threat intelligence
    efforts. Still, it is a solid foundation for you to be able to see beyond vendor
    hype, as well as produce high-quality materials to enhance your organization’s
    security.
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 威胁情报不仅仅是花言巧语，也不仅仅是消费供应商的情报源。它让你能够分析自己的经验，并收集可操作的信息，这些信息不仅能帮助你，还能帮助你的客户、合作伙伴以及整个社区。在本章中，你通过使用
    OTX 消耗和生成了威胁情报，然后通过 WHOIS、ThreatCrowd、ThreatMiner、VirusTotal 等工具过渡到防御性应用。这只是你威胁情报工作的开始，但它为你能够看清供应商炒作之外的真相，并制作高质量的材料来增强组织的安全性奠定了坚实的基础。
