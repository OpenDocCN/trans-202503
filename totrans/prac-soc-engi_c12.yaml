- en: '12'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Producing Threat Intelligence
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
- en: '![](image_fi/book_art/chapterart.png)'
  id: totrans-2
  prefs: []
  type: TYPE_IMG
- en: So your organization has defended against a phishing threat. Congrats! Now how
    do you repeat this outcome when faced with future attacks? Does your organization
    want to share this intelligence with other organizations? Will your organization
    capture and store data about this attempt to prevent further attempts? Will you
    record any exploit kit code found in the phishing emails used to spread a malware
    dropper, and ultimately ransomware?
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
- en: When an incident occurs, three useful things should happen. First, the organization
    should automate the organization’s response by using software that either proactively
    blocks the attack or runs a script to halt an incident in progress. Second, the
    organization could collect information about each attack to decrease its future
    detection and response time. Finally, the organization could share parts of this
    information with other organizations, allowing everyone to reduce their detection
    and response times.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
- en: While some threat intelligence feeds are snake oil, many are legitimately useful
    products. But relying solely on someone else to provide your organization with
    intelligence, to help defend the environment that the organization built and is
    responsible for, is naive. While taking inputs from experts who have insight into
    trends and actors is a sound move, it should not be the only move.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
- en: 'In this chapter, we’ll walk through the process of creating threat intelligence
    about a phishing email by using a free intelligence-sharing platform: AT&T Alien
    Labs OTX, sometimes still referred to as AlienVault OTX. We’ll also reuse many
    of the OSINT techniques you learned about earlier in this book, this time for
    the much different purpose of verifying whether a URL or email is malicious.'
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
- en: Before you follow along, I recommend setting up a virtual machine. That way,
    you can avoid opening any attached files and prevent possible malware infections
    on your workstation.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
- en: Using Alien Labs OTX
  id: totrans-8
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Some threat intelligence vendors charge the organization to consume threat intelligence,
    while others charge the organization to produce it. But one vendor that is universally
    free and allows anyone to contribute is AT&T Cybersecurity. Formerly known as
    AlienVault, this company runs the Alien Labs Open Threat Exchange (OTX) platform,
    which lets you subscribe to intelligence feeds and post your own information.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
- en: Admittedly, its main strength (that it’s free) is also its main weakness, but
    a positive point is that you do not have to consume any intelligence just because
    it is on the platform; you must select which feeds you choose to follow and subscribe
    to (for free).
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
- en: If an organization uses AT&T Cybersecurity’s Unified Security Monitoring (USM)
    or Open Source SEIM (OSSIM) as its SEIM, the organization can directly input pulses
    you subscribe to into USM by synching the SEIM with the OTX API. If the organization
    is not using USM, it can directly connect OTX with Suricata, Bro, and Trusted
    Automated Exchange of Indicator Information (TAXII); otherwise, it may use the
    Java, Python, or Go APIs.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 如果组织使用 AT&T Cybersecurity 的统一安全监控（USM）或开源 SEIM（OSSIM）作为其 SEIM，组织可以通过将 SEIM 与
    OTX API 同步，直接将你订阅的脉冲输入到 USM 中。如果组织没有使用 USM，它可以将 OTX 直接与 Suricata、Bro 和受信任的自动化指标信息交换（TAXII）连接；否则，它可以使用
    Java、Python 或 Go API。
- en: Once the organization has the indicators in the desired format, it can immediately
    search for them using its method of choice—custom scripts, YARA, STIX, TAXII,
    or something similar. This will allow the organization to identify and respond
    to known threats.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦组织拥有所需格式的指标，它可以立即使用其选择的方法进行搜索——自定义脚本、YARA、STIX、TAXII 或类似的工具。这将使组织能够识别并应对已知的威胁。
- en: Analyzing a Phishing Email in OTX
  id: totrans-13
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 在 OTX 中分析钓鱼邮件
- en: 'What about threats that only your organization has observed? How can your organization
    better detect future attempts and possibly save other organizations from the same
    headaches later? Here is the simple answer: produce threat intelligence.'
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 那些只有你所在的组织观察到的威胁怎么办？你的组织如何更好地检测未来的攻击，并可能帮助其他组织避免今后遇到相同的问题？这里有一个简单的答案：生成威胁情报。
- en: Knowing where to start is one of the significant barriers to entry. Since this
    is a single chapter in a book about social engineering and OSINT, I will spare
    you the philosophical justifications for producing threat intelligence. Instead,
    let’s walk through an exercise.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 知道从哪里开始是进入的一个重大障碍。由于这只是一本关于社会工程学和 OSINT 的书中的一章，我将省略关于生成威胁情报的哲学性辩护。相反，让我们一起完成一个练习。
- en: First, you need some data about which to produce intelligence. This could be
    an email, a website, or a file. For the sake of covering all three aspects, let’s
    assume that the organization receives an email directing users to a website that
    prompts them to enter credentials and then downloads and attempts to execute a
    file when the user submits the credentials. You can use the file called *invoice.eml*
    in the GitHub repo at [https://cti.seosint.xyz/](https://cti.seosint.xyz/).
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，你需要一些数据来生成威胁情报。这可以是电子邮件、网站或文件。为了涵盖这三方面，假设组织收到一封电子邮件，指示用户访问一个网站，网站提示他们输入凭证，并在用户提交凭证后下载并尝试执行一个文件。你可以使用
    GitHub 仓库中的名为*invoice.eml*的文件，访问地址为[https://cti.seosint.xyz/](https://cti.seosint.xyz/)。
- en: Creating a Pulse
  id: totrans-17
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 创建脉冲
- en: Log in to OTX and select **Create Pulse** on the OTX dashboard,which is where
    you’ll land each time you log in ([Figure 12-1](#figure12-1)). In OTX, a *pulse*
    is a set of indicators of compromise for a specific attack.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 登录到 OTX 并在 OTX 仪表板上选择**创建脉冲**，这是你每次登录后会进入的页面（[图 12-1](#figure12-1)）。在 OTX 中，*脉冲*是特定攻击的妥协指标集。
- en: '![<<OTX Dashboard shows tab listing pulses to which the user is subscribed,
    including "IcedID GZIPLoader Analysis," “Dearcry Ransomware used against unpatched
    exchange servers,” and “Fin8 returns with improved BADHATCH Toolkit". >>](image_fi/500983c12/f12001.png)'
  id: totrans-19
  prefs: []
  type: TYPE_IMG
  zh: '![<<OTX 仪表板显示用户订阅的脉冲标签列表，包括“ IcedID GZIPLoader 分析”、“针对未修补的交换服务器使用的 Dearcry
    勒索软件”以及“Fin8 带着改进的 BADHATCH 工具包回归”。>>](image_fi/500983c12/f12001.png)'
- en: 'Figure 12-1: OTX Dashboard'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 图 12-1：OTX 仪表板
- en: You should be presented with a few options for creating the pulse ([Figure 12-2](#figure12-2)).
    You can import text or a website or manually input the indicators.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 你将看到一些选项来创建脉冲（[图 12-2](#figure12-2)）。你可以导入文本或网站，或者手动输入指标。
- en: '![<<OTX Create New Pulse page. Left, option to enter text/source URL which
    OTX automatically extracts to pull indicators of compromise. Right, option to
    drag and drop or manually browse files to add indicators.>>](image_fi/500983c12/f12002.png)'
  id: totrans-22
  prefs: []
  type: TYPE_IMG
  zh: '![<<OTX 创建新脉冲页面。左侧，输入文本/源 URL 的选项，OTX 会自动提取该 URL 来获取妥协指标。右侧，拖放或手动浏览文件以添加指标的选项。>>](image_fi/500983c12/f12002.png)'
- en: 'Figure 12-2: Creating a pulse in OTX'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 图 12-2：在 OTX 中创建脉冲
- en: Let’s start by copying and pasting the whole source of the email.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们从复制并粘贴电子邮件的完整源代码开始。
- en: Analyzing the Email Source
  id: totrans-25
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 分析电子邮件源代码
- en: I like to use Thunderbird for viewing the email source. It’s a free and open
    source mail client maintained by Mozilla. Once Thunderbird is installed and running,
    you can import any saved emails to OTX in *.eml* format and start analyzing. In
    Thunderbird, first open the email. Then in the top-right corner, select **More**▶**View
    Source** ([Figure 12-3](#figure12-3)).
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
- en: '![<<Thunderbird window shows email stating that the user’s PayPal account has
    been suspended and the user needs to confirm their identity. In top-right corner
    under the More drop-down menu, "View Source" is highlighted.>>](image_fi/500983c12/f12003.png)'
  id: totrans-27
  prefs: []
  type: TYPE_IMG
- en: 'Figure 12-3: Viewing the source of an email in Thunderbird'
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
- en: Once the email is opened as the source, you should see something like the excerpt
    in [Figure 12-4](#figure12-4). This is the underlying trail of data that gets
    transmitted when you send an email, including all checks performed and the email’s
    source and destinations. You can view any downloadable email in this way, sometimes
    even in the mail client itself. For example, in Gmail, you’d click the three dots
    in the top-right corner of an email and then select Show original.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
- en: '![<<Excerpt of email source file located in file:///Users/joegray/Downloads/Invoice%20_Remittance%2010022.eml?type=application/x-message-display.
    Partially censored by author.>>](image_fi/500983c12/f12004.png)'
  id: totrans-30
  prefs: []
  type: TYPE_IMG
- en: 'Figure 12-4: The source of a phishing email'
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
- en: It’s important to view an email’s source. This lets you see where an email really
    came from, rather than relying on a potentially spoofed source address. You’ll
    see both the real email address and the spoofed email address, as well as the
    sender’s IP address.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
- en: When copying and pasting this email into the pulse, be careful not to include
    your mail server’s IP address or any other addresses belonging to reputable mail
    vendors. If you add these and start searching, you will receive an overwhelmingly
    high number of false positives, which, if not tuned, will breed complacency.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
- en: Inputting Indicators
  id: totrans-34
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Now that you’ve obtained information from the source, you’re ready to import
    some indicators. *Indicators* are data points related to the activity that you
    are capturing in the pulse. [Table 12-1](#table12-1) lists the indicators that
    OTX accepts.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
- en: 'Table 12-1: Indicators Accepted by OTX'
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
- en: '| **Indicator type** | **Description** |'
  id: totrans-37
  prefs: []
  type: TYPE_TB
- en: '| --- | --- |'
  id: totrans-38
  prefs: []
  type: TYPE_TB
- en: '| IPv4 | The IPv4 address of the source email server or site hosting the phishing
    or malware. |'
  id: totrans-39
  prefs: []
  type: TYPE_TB
- en: '| IPv6 | The IPv6 address of the source email server or site hosting the phishing
    or malware. |'
  id: totrans-40
  prefs: []
  type: TYPE_TB
- en: '| Domain | The domain of the source email server or site hosting the phishing
    or malware. |'
  id: totrans-41
  prefs: []
  type: TYPE_TB
- en: '| Hostname | The hostname or subdomain of the source email server or site hosting
    the phishing or malware. |'
  id: totrans-42
  prefs: []
  type: TYPE_TB
- en: '| Email | The source email address. |'
  id: totrans-43
  prefs: []
  type: TYPE_TB
- en: '| URL | The Uniform Resource Locator of the site hosting the phishing or malware.
    |'
  id: totrans-44
  prefs: []
  type: TYPE_TB
- en: '| URI | The Uniform Resource Identifier of the precise location within the
    site hosting the phishing or malware. |'
  id: totrans-45
  prefs: []
  type: TYPE_TB
- en: '| File hash | The one-way cryptographic representation of the malicious file
    contained within the phishing email. This can be accomplished in various formats
    including these:'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
- en: 'MD5: 128-bit cryptographic representation of a file using the Message Digest
    5 Algorithm'
  id: totrans-47
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'SHA-1: 160-bit cryptographic representation of a file using the Secure Hashing
    Algorithm'
  id: totrans-48
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'SHA-256: 256-bit cryptographic representation of a file using the Secure Hashing
    265-bit Algorithm'
  id: totrans-49
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '|'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
- en: '| PEHASH | Portable Executable Hash (peHash) method of fuzzy hashing, which
    instead of hashing the entire file accomplishes byte-by-byte hashing by taking
    several variables from within the executable and hashing them. |'
  id: totrans-51
  prefs: []
  type: TYPE_TB
- en: '| IMPASH | Import Hash; similar to peHash, but tracks the DLLs and other files
    that the code imports. |'
  id: totrans-52
  prefs: []
  type: TYPE_TB
- en: '| CIDR | The classless interdomain routing address of the network IP address
    range that a domain owns, expressed as a base IP and the number of possible subnets.
    The format is typically *xxx.xxx.xxx.xxx*/*yy*, where *xxx.xxx.xxx.xxx* is the
    base IPv4 address and *yy* is a number between 1 and 32 that denotes the number
    of possible subnets and hosts within this block. You will typically see numbers
    between 24 and 32 in this range. |'
  id: totrans-53
  prefs: []
  type: TYPE_TB
- en: '| File path | A unique location within the workstation where the malicious
    files are discovered. This shows the behavior of uniformity, likely through a
    script. |'
  id: totrans-54
  prefs: []
  type: TYPE_TB
- en: '| MUTEX | A mutual exclusion object (MUTEX) is an object within a program designed
    to allow multiple threads to share the resource such as file access, but not at
    the same time. |'
  id: totrans-55
  prefs: []
  type: TYPE_TB
- en: '| CVE | Common Vulnerabilities and Exposures are responsibly disclosed vulnerabilities.
    Including a CVE in the pulse allows others to search for the CVE when subscribing
    to feeds. This is especially helpful when the phishing email attempts to perform
    some level of technical exploitation based on an existing vulnerability. |'
  id: totrans-56
  prefs: []
  type: TYPE_TB
- en: '| YARA | YARA is either Yet Another Recursive Acronym or Yet Another Regular
    Expression (REGEX) Analyzer. This is a means to match patterns within files and
    iterate across an environment either using a SEIM or a custom YARA tool, which
    supports Windows, macOS, and Linux. |'
  id: totrans-57
  prefs: []
  type: TYPE_TB
- en: Copy the entire email source and paste it in the left-hand box in the image,
    and then select **Extract Indicators** ([Figure 12-5](#figure12-5)). This will
    do the parsing automatically, but you’ll need to go through the indicators and
    sanity-check them.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
- en: '![<<OTX Create New Pulse page zoomed in on "Enter Source URL or Text" field
    with email source entered. "Extract Indicators" button is below field.>>](image_fi/500983c12/f12005.png)'
  id: totrans-59
  prefs: []
  type: TYPE_IMG
- en: 'Figure 12-5: OTX Indicator extraction'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
- en: As you can see in [Figure 12-6](#figure12-6), the parser extracted three indicators
    from the email you pasted.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
- en: '![<<“Included IOCs” tab of Parser Results displays three extracted indicators
    with their types—IPv4, Hostname, and Email—outlined in red.>>](image_fi/500983c12/f12006.png)'
  id: totrans-62
  prefs: []
  type: TYPE_IMG
- en: 'Figure 12-6: Included indicators'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
- en: You need to verify that these indicators belong in the pulse. Since you know
    from inspecting the email source that the listed email is the sender’s, you don’t
    need to check it again. But you do need to check the domains and IP addresses.
    To accomplish this, let’s do a little OSINT.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 你需要验证这些指标是否属于该脉冲。由于你通过检查邮件源知道列出的邮件是发件人的，你不需要再次检查它。但你需要检查这些域名和 IP 地址。为了完成这一点，我们做一点
    OSINT（开放源情报收集）。
- en: 'You need to determine the following: Who owns each domain and IP address? Does
    the domain and IP address serve a legitimate purpose? Does the domain owner have
    any control over the data passed through their services? Do the IP addresses belong
    to email providers? Or do we own the domain or IP address?'
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 你需要确定以下内容：每个域名和 IP 地址的所有者是谁？该域名和 IP 地址是否有合法用途？域名所有者是否控制其服务中传递的数据？这些 IP 地址是否属于邮件提供商？或者我们是否拥有该域名或
    IP 地址？
- en: The possible IOCs in [Figure 12-7](#figure12-7) are not valuable pieces of threat
    intelligence, so if OTX doesn’t, you will need to exclude them. You’ll do this
    later in the process, to avoid analyzing them twice.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: '[图 12-7](#figure12-7) 中的可能 IOC 并不是有价值的威胁情报，因此如果 OTX 没有排除它们，你将需要将它们排除。你将在后续过程进行排除，以避免重复分析这些指标。'
- en: '![<<"Excluded IOCs" tab of parser results displays 13 excluded indicators with
    their types (IPv4, URL, and Hostname) and reasons for exclusion, which include
    “Manually excluded,” "Private IP Address," and "whitelisted domain outlook.com."
    >>](image_fi/500983c12/f12007.png)'
  id: totrans-67
  prefs: []
  type: TYPE_IMG
  zh: '![<<"排除的 IOC" 解析结果标签显示了 13 个被排除的指标及其类型（IPv4、URL 和主机名）以及排除原因，包括“手动排除”、“私有 IP
    地址”和“白名单域 outlook.com。” >>](image_fi/500983c12/f12007.png)'
- en: 'Figure 12-7: Excluded indicators'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 图 12-7：排除的指标
- en: Now, you move to the list of *Excluded IOCs*. You repeat the process you used
    for the Included IOCs for each item in the Excluded IOCs list. Off the bat, you
    can tell that some of these do not belong on the list of indicators.
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，你转到*排除的 IOC* 列表。你对每个排除的 IOC 项目，重复你对已包含 IOC 所采用的相同过程。一开始，你就能看出这些项目中有些并不属于指标列表。
- en: 'From this extraction, go ahead and remove the following: three obvious Microsoft
    addresses (*by5pr19mb3713.namprd19.prod.outlook.com*, *by5pr19mb3970.namprd19.prod.outlook.com*,
    and *nam12-mw2-obe.outbound.protection.outlook.com*); two obvious Google addresses
    (*mail-sor-f41.google.com* and *mx.google.com*); a series of GoDaddy addresses
    (*p3plibsmtp01-08.prod.phx3.secureserver.net*, *p3plsmtp21-01-26.prod.phx3.secureserver.net*,
    and *p3plsmtp21-01.prod.phx3.secureserver.net*); and 10.186.134.206, which is
    a Class A, private, non-routable, internal IP address.'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 从这个提取结果中，继续移除以下内容：三个明显的微软地址（*by5pr19mb3713.namprd19.prod.outlook.com*、*by5pr19mb3970.namprd19.prod.outlook.com*
    和 *nam12-mw2-obe.outbound.protection.outlook.com*）；两个明显的谷歌地址（*mail-sor-f41.google.com*
    和 *mx.google.com*）；一系列 GoDaddy 地址（*p3plibsmtp01-08.prod.phx3.secureserver.net*、*p3plsmtp21-01-26.prod.phx3.secureserver.net*
    和 *p3plsmtp21-01.prod.phx3.secureserver.net*）；以及 10.186.134.206，这是一个 A 类私有、不可路由的内部
    IP 地址。
- en: Testing a Potentially Malicious Domain in Burp
  id: totrans-71
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 在 Burp 中测试潜在恶意域名
- en: OTX claims that *docsend.com* is a whitelisted domain, but it does allow users
    to upload files. This means it’s prudent to go ahead and check what the sender
    is trying to coerce victims into opening. In the digital forensics and malware
    world, this is part of what is known as *detonating*. Detonating can be dangerous
    if you’re on an unprotected system, as it can get infected. I recommend using
    a dedicated system for this, or at minimum a dedicated virtual machine.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: OTX 声称 *docsend.com* 是一个被列入白名单的域名，但它确实允许用户上传文件。这意味着，最好继续检查发送者试图迫使受害者打开的内容。在数字取证和恶意软件领域，这被称为*引爆*。如果你在一个没有保护的系统上进行引爆，可能会受到感染，所以我建议使用专门的系统，或者至少使用专用的虚拟机来处理此类操作。
- en: In addition to a virtual machine, I recommend ensuring that you have malware
    protection installed (if applicable), a firewall enabled at the host and network
    level, the use of a VPN, and (if you are comfortable with it), the Tor browser
    (or Brave—which offers a similar functionality), though you have to select Open
    a New Private Window with Tor. You may find yourself dealing with some nasty stuff,
    and you do not want to find yourself on the wrong side of the law while trying
    to conduct legitimate security research.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 除了虚拟机外，我建议确保安装了恶意软件防护（如果适用），启用主机和网络级别的防火墙，使用 VPN，并且（如果你对它感到舒服的话）使用 Tor 浏览器（或
    Brave 浏览器——它提供类似的功能），不过你需要选择“使用 Tor 打开新隐私窗口”。你可能会遇到一些麻烦的东西，而你可不希望在进行合法的安全研究时，自己掉进法律的陷阱。
- en: Open your virtual machine on a separate system and network segment than your
    main network, with a firewall and security appliance running between the system
    and the rest of your home lab and network. Depending on the level of analysis
    you intend on performing, you could choose to use a Linux virtual machine or a
    Windows one. If you want a good sense of how the attack is supposed to work, you
    may want to use a vulnerable Windows system.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
- en: 'Install Burp Suite on your host. *Burp* is a web proxy that allows you to intercept
    and alter data transmitted between you and the website. It will allow you to see
    calls made from your system to the website and the responses. You can also control
    any pop-ups and many unintended actions, like redirects to malicious sites. To
    install Burp, download a copy of the free Community Edition from [https://portswigger.net/burp/communitydownload/](https://portswigger.net/burp/communitydownload/).
    This will include a script similar to `burpsuite_community_linux_v<#>_#_##.sh`.
    Input the most recent version into the commands shown here:'
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  id: totrans-76
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: Once it’s installed, you can use the GUI to open Burp by either clicking the
    Burp icon or typing *Burp* into the operating system menu. Burp will prompt you
    to create a project. Click **Next**, and you should be prompted to accept the
    Burp default configurations or load a configuration file. Sticking with the defaults
    should be fine.
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
- en: Next, you have to route your browser’s traffic through Burp. To do this, open
    Firefox and click the Menu icon and then scroll to the bottom. Click **Network
    Settings**. You should be prompted to enter information about your proxy, as shown
    in [Figure 12-8](#figure12-8). Select **Manual proxy configuration** and then
    enter the IP address `127.0.0.1` as the HTTP Proxy and `8080` as the Port. Select
    the option to use this proxy server for all protocols.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
- en: Now that you have Burp installed and Firefox configured to route your traffic
    through Burp, open Burp and make sure that it is configured for intercepting traffic.
    To accomplish this, select the **Proxy** tab, then **Intercept**. Finally, ensure
    that Intercept is on.
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
- en: '![<<Firefox preferences page shows "Connection Settings" box with options to
    "Configure Proxy Access to the Internet." Outlined in red: "Manual proxy configuration"
    option, "127.0.0.1" HTTP Proxy, "8080" port, and "Also use this proxy for FTP
    and HTTPS." checkbox.>>](image_fi/500983c12/f12008.png)'
  id: totrans-80
  prefs: []
  type: TYPE_IMG
- en: 'Figure 12-8: Configuring a network proxy in Firefox'
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
- en: Once you’ve verified that Burp is configured correctly, you can use it to intercept
    your browser’s traffic (see [Figure 12-9](#figure12-9)). As long as Intercept
    is on, you’ll need to choose whether to forward or drop each web request*.* This
    means you can drop malicious (or legitimate) traffic instead of sending it to
    your browser.
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
- en: '![<<Burp Suite Community Edition dashboard with sections for Tasks, Event log,
    and Issue Activity (pro version only).>>](image_fi/500983c12/f12009.png)'
  id: totrans-83
  prefs: []
  type: TYPE_IMG
- en: 'Figure 12-9: Intercepting traffic with Burp'
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
- en: 'Now, let’s visit the website found in the email. When you forward it using
    Burp, a website loads. This appears to be a PayPal site, but in [Figure 12-10](#figure12-10),
    you can easily spot that it’s not legitimate: notice the URL lacks the word *PayPal*
    and has an *.es* top-level domain. In addition, the *code=US&id=8799879&country=United
    States* at the end shows that some sort of tracking is in use.'
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
- en: '![<<Web page shows what appears to be a PayPal login screen. Highlighted in
    red: link''s redirect location shows the URL http://nurrahmahgroup.esy.es/pjj/creer/Adeit.">>](image_fi/500983c12/f12010.png)'
  id: totrans-86
  prefs: []
  type: TYPE_IMG
- en: 'Figure 12-10: The example phishing landing page'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
- en: The complete omission of *PayPal* from the URL is probably the biggest red flag.
    If you try to open this link in the sandbox system (the isolated system or virtual
    machine discussed earlier in this chapter), the host should be unknown. And, as
    you can see in [Figure 12-11](#figure12-11), Burp shows us that entering information
    and clicking the link is a dead end—likely pointing to a failed attempt at *credential
    harvesting*.
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
- en: '![<<Burp Suite Community Edition window shows message "Error: Request was dropped
    by user” with redirect to http://nurrahmahgroup.esy.es/pjj/creer/Adeit.>>](image_fi/500983c12/f12011.png)'
  id: totrans-89
  prefs: []
  type: TYPE_IMG
- en: 'Figure 12-11: Broken phishing redirect'
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
- en: The fact that the site does nothing might indicate that PayPal or another vendor
    took action, probably leveraging the DMCA. It could also indicate an adversary
    that lacks the sophistication to expand their efforts. It’s important to avoid
    dismissing the threat associated with credential harvesting, however. As noted
    time and time again, people still routinely use the same password on multiple
    platforms, both personal and professional accounts. Many sites either do not force
    or do not support multifactor authentication, compounding this threat.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
- en: Although the link is broken, you should still add it to the OTX pulse. Before
    you move on, add the four IP addresses we identified as irrelevant to the excluded
    indicators by checking the boxes next to them and clicking **Exclude**.
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
- en: Analyzing Downloadable Files
  id: totrans-93
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: This phishing campaign did not include any downloadable files. But what if it
    did? Let’s briefly discuss analyzing them. To start, you’ll need to get cryptographic
    hashes of those files. Having the cryptographic hashes of files allows you to
    compare the files in known states to other versions to see if anything changed.
    When a file is created (or in the case of malware, observed), you take a cryptographic
    hash of the file to help you search for it faster. You compare the hashes of files
    on your systems to the known bad file (in the case of malware) and alert on any
    matches. In some cases, the file changes itself, and so the hash will not remain
    the same. We call this *polymorphic malware*, and it’s a discussion for a completely
    different book.
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
- en: You can hash a file by using a variety of tools. Some, like the following, come
    already installed on Linux. It’s sometimes worth entering multiple hash kinds,
    because some systems will check files using only one algorithm.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
- en: 'To produce an MD5 hash of the file, enter the following command:'
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  id: totrans-97
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'To produce a SHA-1 hash of the file, enter this:'
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  id: totrans-99
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'To produce a SHA-256 hash of the file, enter this:'
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  id: totrans-101
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'To produce a SHA-512 hash of the file, enter this:'
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  id: totrans-103
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: Then add each hash to OTX. If you choose to write up this incident and publish
    a report, you might import the pulse from the URL and list the URL as a resource.
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
- en: In the following sections, we will further analyze the *esy.es* domain.
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
- en: Conducting OSINT for Threat Intelligence
  id: totrans-106
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: OTX isn’t the only resource you can use to analyze malicious links or emails.
    In this section, we’ll explore a few others. You might recognize some of these
    tools and techniques from the OSINT chapters of this book. Here, you’ll use these
    resources to figure out whether a site is harmful.
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
- en: Searching VirusTotal
  id: totrans-108
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'A website owned by Chronicle Security, [https://www.virustotal.com/](https://www.virustotal.com/),
    allows researchers and threat intelligence professionals to analyze whether a
    file is listed as malicious on more than 60 antivirus platforms without having
    to buy every one of them. It also allows you to check the status of any URLs.
    VirusTotal also has an API for scripted analysis. Its web-based GUI search function
    accepts the following input types: the actual uploaded file, a URL, an IP address,
    a domain, or a file hash.'
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
- en: Identifying Malicious Sites on WHOIS
  id: totrans-110
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: You ran the WHOIS command when collecting OSINT. But when using WHOIS to analyze
    malware, you’ll want to look for additional information. Notably, in addition
    to the usual WHOIS information, you want to see the country where a domain is
    registered and its autonomous system number (ASN). The ASN will help later when
    you use PhishTank to analyze the systems from which the phishing email originates.
    [Figure 12-12](#figure12-12) shows the WHOIS record for the sketchy-seeming domain
    *esy.es*.
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
- en: '![<<DomainTools Whois Record for “Esy.es.” Entries include Registrar Status
    ("taken"), Name Servers (four with 455 domains each), and IP Location ("Noord
    Holland Jordaan OpenTid Bv").>>](image_fi/500983c12/f12012.png)'
  id: totrans-112
  prefs: []
  type: TYPE_IMG
- en: 'Figure 12-12: *esy.es’*s WHOIS record'
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
- en: You can see that the domain was registered in an area of the Netherlands called
    Jordaan and last updated on 2021-06-09, and that it uses name servers hosted through
    main-hosting.com. In turn, performing a WHOIS search of main-hosting.com shows
    that it is being hosted on godaddy.com, whereas a reputable firm would likely
    host it in-house. You should also be wary of recently registered domains. Young
    domains warrant skepticism and analysis, as many are malicious. An 8-day-old domain
    and a 43-day-old name server are not automatically up to no good, but they do
    require additional investigation. In this instance, you should include both domains
    and any related IP addresses in your OTX pulse.
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
- en: What would a legitimate site’s WHOIS record show? For comparison, [Figure 12-13](#figure12-13)
    is the WHOIS output for *nostarch.com*.
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
- en: '![<<DomainTools Whois Record for "NostArch.com". Outlined in red are Registrant
    Country (is), ASN (AS13335 CLOUDFLARENET, US (registered Jul 14, 2010)), Domain
    Status (Registered and Active Website), and Hosting History (3 changes on 4 unique
    name servers over 17 years).>>](image_fi/500983c12/f12013_updated.png)'
  id: totrans-116
  prefs: []
  type: TYPE_IMG
- en: 'Figure 12-13: NoStarch’s WHOIS record'
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
- en: First note that the registrant country is Iceland. This is common when organizations
    use services like WhoisGuard or domain privacy to conceal their location, and
    this is not an immediate cause for alarm or further analysis. If you review the
    date, you should see that this domain was created in 1996 and includes a registered
    and active website.
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
- en: Second, the ASN is listed as Cloudflare. The use of Cloudflare indicates that
    the site likely isn’t malicious, as content distribution networks typically remove
    anything they verify to be harmful. We also see that this domain has had three
    changes over four name servers in 17 years. This is normal and typically is indicative
    of changing providers. Technology has changed a lot since 1996, so it makes sense
    to switch providers and records to implement new technologies.
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
- en: Discovering Phishes with PhishTank
  id: totrans-120
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: PhishTank ([https://phishtank.com/](https://phishtank.com/)) is a free phishing
    verification platform operated by OpenDNS. It lets you search by domain, URL,
    or ASN. In my experience, searching by ASN is the most efficient. But since you
    don’t have an ASN for the potentially malicious *nurrahmahgroup.esy.es* domain,
    you’ll need to search by domain and URL. [Figure 12-14](#figure12-14) shows this
    search.
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
- en: '![<<PhishTank "Home" tab reads "Join the fight against phishing. Submit suspected
    phishes. Track the status of your submissions. Verify other users'' submissions.
    Develop software with our free API." Shows search box for searching phishing database
    by URL with contents http://nurrahmahgroup.esy.es/pjj/creer/Adeit/signin.>>](image_fi/500983c12/f12014.png)'
  id: totrans-122
  prefs: []
  type: TYPE_IMG
- en: 'Figure 12-14: PhishTank search for *nurrahmahgroup.esy.es* phish'
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
- en: As you can see in [Figure 12-15](#figure12-15), the search yields nothing. That
    doesn’t mean that it isn’t a phishing attempt—just that no one has reported it.
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
- en: '![<<PhishTank web page shows message “Nothing known about http://nurrahmahgroup.esy.es/pjj/creer/Adeit.”>>](image_fi/500983c12/f12015.png)'
  id: totrans-125
  prefs: []
  type: TYPE_IMG
- en: 'Figure 12-15: A valid phish on *PhishTank.com*'
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
- en: Since the site is down, I will walk through reporting it, but not submit the
    report. To start the report, click the **Add it to the Tank?** link below the
    statement that says that nothing is known. Next, enter the URL of the phish. In
    this case, you will need to paste the body of the email into three reports to
    the Tank (if you were submitting) to associate all three domains used. You also
    select Microsoft as the organization referenced in the email, since it claimed
    to be from Office 365\. Once it’s complete, click **Submit**.
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
- en: '[Figure 12-16](#figure12-16) is an instance of entering the information associated
    with the phish into PhishTank for inclusion in its database.'
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
- en: '![<<PhishTank "Add A Phish" tab. Outlined in red: fields for entering Phish
    URL (http://nurrahmahgroup.esy.es/pjj/creer/Adeit) and organization reference
    in the phishing email (PayPal). Also shows field for entering full email contents.>>](image_fi/500983c12/f12016.png)'
  id: totrans-129
  prefs: []
  type: TYPE_IMG
- en: 'Figure 12-16: Submitting a phishing sample to PhishTank'
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
- en: Browsing ThreatCrowd
  id: totrans-131
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Part of AT&T Cybersecurity, ThreatCrowd ([https://www.threatcrowd.org/](https://www.threatcrowd.org/))
    provides visualization regarding the legitimacy of domains, IP addresses, and
    other details like hashes. As with OTX and other platforms, you can access it
    independently or via links in ThreatMiner (discussed in the next section). [Figure
    12-17](#figure12-17) shows the visualization for the *nurrahmahgroup.esy.es* domain.
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
- en: In this visualization, you can see how various systems, hashes, domains, and
    other features interact with our system of interest. This can be very useful when
    building out a cyber threat intelligence program or doing a deep dive on a potential
    adversary. The graphical output also makes for some excellent artifacts when writing
    reports.
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
- en: '![<<ThreatCrowd visualization shows connected nodes of varying sizes displaying
    color-coded domains, IP addresses, and hashes. Outlined in red: a medium-sized
    blue node labeled "NURRAHMAHGROUP.ESY.ES," which connects to a large gray central
    node labeled with an IP address.>>](image_fi/500983c12/f12017.png)'
  id: totrans-134
  prefs: []
  type: TYPE_IMG
- en: 'Figure 12-17: ThreatCrowd visualization for *nurrahmahgroup.esy.es*'
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
- en: Consolidating Information in ThreatMiner
  id: totrans-136
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: ThreatMiner ([https://www.threatminer.org/](https://www.threatminer.org/)) takes
    an input and pulls from several other threat intelligence sources to produce a
    single-pane view of what other platforms are saying. ThreatMiner allows you to
    get an idea of the likelihood of malice rather quickly. Like anything else, it
    is not a perfect solution, but it is one of the best, especially since it is free.
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
- en: The ThreatMiner website allows you to search for either indicators or APT Notes.
    *APT Notes* is a repository of publicly available papers and blogs, sorted by
    year and related to malicious campaigns, activity, or software associated with
    vendor-defined advanced persistent threat groups or toolsets. Since you already
    have some indicators, let’s search for them first. Like OTX, ThreatMiner can process
    a variety of indicator types, some of which differ from OTX’s. They include domains,
    IP addresses, hashes (MD5, SHA-1, and SHA-256), email address, APT Notes, SSL/TLS
    certificates, user-agents, antivirus names, filenames, URIs, registry keys, and
    mutexes.
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
- en: 'Here’s one of ThreatMiner’s unique features: it opens a pane on the left side
    of the screen that shows possibly related Google search results. There, you should
    see WHOIS data for the indicator submitted, if appropriate. Further down the screen,
    you’ll see links to other resources, like RiskIQ, PassiveTotal, VirusTotal, DomainTools,
    ThreatCrowd, OTX, SecurityTrails, and Robtex.'
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
- en: '[Figure 12-18](#figure12-18) shows a search for *nurrahmahgroup.esy.es*.'
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
- en: '![<<ThreatMiner web page shows results for "nurrahmahgroup.esy.es" domain.
    Left pane displays possibly related Google search results (empty). Main page displays
    results for WHOIS information and related resources.>>](image_fi/500983c12/f12018_updated.png)'
  id: totrans-141
  prefs: []
  type: TYPE_IMG
- en: 'Figure 12-18: ThreatMiner results for *nurrahmahgroup.esy.es*'
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
- en: Below the related resources, you’ll notice that there are no APT Notes for the
    domain. Nor are there any related passive DNS, subdomains, associated URLs, Robtex,
    or malware samples. Given that the phishing email you analyzed is old and the
    domain was recently registered, this makes sense. For a more mature indicator,
    or a domain that has not been taken down, expect to see more information here.
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
- en: 'Now, if ThreatMiner searches all of these sites for you, why did I wait until
    the end to show you its capabilities? To help you understand how to perform the
    analysis by yourself. When I’m performing threat intelligence analysis on phishing
    emails, I often start with two windows open: OTX and ThreatMiner. To use the information
    that ThreatMiner identifies as related, simply click the link.'
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
- en: Conclusion
  id: totrans-145
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Threat intelligence is more than snake oil and more than just consuming vendor
    feeds. It empowers you to analyze your own experiences and collect actionable
    information that not only helps you, but can help your clients, partners, and
    the community as a whole. In this chapter, you consumed and produced threat intelligence
    by using OTX, and then transitioned through defensive uses of WHOIS, ThreatCrowd,
    ThreatMiner, VirusTotal, and more. This is only the beginning of your threat intelligence
    efforts. Still, it is a solid foundation for you to be able to see beyond vendor
    hype, as well as produce high-quality materials to enhance your organization’s
    security.
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
