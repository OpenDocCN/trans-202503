<html><head></head><body>
<div id="sbo-rt-content">
<section epub:type="chapter" role="doc-chapter" aria-labelledby="ch4">

<hgroup>
<h2 class="CHAPTER" id="ch4">

<span class="CN"><span role="doc-pagebreak" epub:type="pagebreak" id="pg_87" aria-label=" Page 87. "/><samp class="SANS_Futura_Std_Bold_Condensed_B_11">4</samp></span>

<span class="CT"><samp class="SANS_Dogma_OT_Bold_B_11">EXPLORING DATASETS IN THE TERMINAL</samp></span>

</h2>
</hgroup>

<p class="COS">In this chapter, you’ll build on the command line skills you’ve learned so far and begin investigating real datasets. You’ll use <samp class="SANS_TheSansMonoCd_W5Regular_11">for</samp> loops to unzip the BlueLeaks files, then search the files to determine which fusion centers have the most data and which documents contain the keywords <i>antifa</i> and <i>Black Lives Matter</i>. I’ll also give an overview of the mysterious encrypted data in the dataset and describe my hypothesis of how the hacker collected the data.</p>

<p class="TX">You’ll also learn to create Linux cloud servers and connect to them securely for faster internet and extra disk space. As practice, you’ll use a remote server to download and briefly examine hacked data from the Oath Keepers militia, a far-right extremist group that participated in the January 6, 2021, US Capitol insurrection.</p>

<section epub:type="division" aria-labelledby="sec1">

<h3 class="H1" id="sec1"><span id="h-83"/><span role="doc-pagebreak" epub:type="pagebreak" id="pg_88" aria-label=" Page 88. "/><samp class="SANS_Futura_Std_Bold_B_11">Introducing for Loops</samp></h3>

<p class="TNI">The BlueLeaks torrent you downloaded in Exercise 2-1 is 269GB and contains 168 different ZIP files ranging from 49GB to half a kilobyte each. In theory, you could manually unzip these 168 files one at a time to access the data. However, this slow, tedious process becomes impractical with even larger datasets (imagine individually extracting 10,000 ZIP files). In this section, you’ll learn to speed up this task by automating it with <samp class="SANS_TheSansMonoCd_W5Regular_11">for</samp> loops.</p>

<p class="TX">A <samp class="SANS_TheSansMonoCd_W5Regular_11">for</samp> loop is a type of command that runs a piece of code once for every item in a list. Each time the code loops, it stores the current item in a <i>variable</i>, which you can think of as a placeholder for some value. Code variables are similar to those in math, where the value of <i>x</i> might be different for different problems, but in shell scripting, the values can be text or numbers. Even though each loop runs the same code, the results may be different, because the value of the variable changes with each loop.</p>

<p class="TX">For example, the following <samp class="SANS_TheSansMonoCd_W5Regular_11">for</samp> loop displays the numbers 1, 2, and 3:</p>

<pre id="pre-85"><code>for NUMBER in 1 2 3

do

    echo $NUMBER

done</code></pre>

<p class="TX">This <samp class="SANS_TheSansMonoCd_W5Regular_11">for</samp> loop starts with the syntax <samp class="SANS_TheSansMonoCd_W5Regular_11">for</samp> <samp class="SANS_TheSansMonoCd_W5Regular_Italic_I_11">variable_name</samp> <samp class="SANS_TheSansMonoCd_W5Regular_11">in</samp> <samp class="SANS_TheSansMonoCd_W5Regular_Italic_I_11">list_of_items</samp>, followed by <samp class="SANS_TheSansMonoCd_W5Regular_11">do</samp>, followed by the commands to run for each item in the list, followed by <samp class="SANS_TheSansMonoCd_W5Regular_11">done</samp>. In this case, <samp class="SANS_TheSansMonoCd_W5Regular_Italic_I_11">variable_name</samp> is <samp class="SANS_TheSansMonoCd_W5Regular_11">NUMBER</samp> and <samp class="SANS_TheSansMonoCd_W5Regular_Italic_I_11">list_of_items</samp> is <samp class="SANS_TheSansMonoCd_W5Regular_11">1 2 3</samp>. The value of the <samp class="SANS_TheSansMonoCd_W5Regular_11">NUMBER</samp> variable will be <samp class="SANS_TheSansMonoCd_W5Regular_11">1</samp> the first time the code loops, <samp class="SANS_TheSansMonoCd_W5Regular_11">2</samp> during the second loop, and <samp class="SANS_TheSansMonoCd_W5Regular_11">3</samp> during the third loop.</p>

<p class="TX">The <samp class="SANS_TheSansMonoCd_W5Regular_11">echo</samp> command displays something, in this case <samp class="SANS_TheSansMonoCd_W5Regular_11">$NUMBER</samp>, to the terminal. The dollar sign (<samp class="SANS_TheSansMonoCd_W5Regular_11">$</samp>) means the code should display the value of the <samp class="SANS_TheSansMonoCd_W5Regular_11">NUMBER</samp> variable, rather than the word <samp class="SANS_TheSansMonoCd_W5Regular_11">NUMBER</samp>.</p>
<blockquote>

<p class="NOTE"><span class="NoteHead"><samp class="SANS_Dogma_OT_Bold_B_21">NOTE</samp></span></p>
</blockquote>

<p class="NOTE-TXT"><i>Using all caps is a common convention for variable names, but it’s not required. For example, you could call the variable <samp class="mono">number</samp> instead of <samp class="mono">NUMBER</samp> and display it with <samp class="mono">echo $number</samp> instead of <samp class="mono">echo $NUMBER</samp>. Variable names are case sensitive.</i></p>

<p class="TX">When you run the previous <samp class="SANS_TheSansMonoCd_W5Regular_11">for</samp> loop in your terminal, you should see the following output:</p>

<pre id="pre-86"><code>1

2

3</code></pre>

<p class="TX">You can also use a <samp class="SANS_TheSansMonoCd_W5Regular_11">for</samp> loop to loop through the output of another shell command, as shown in the following code:</p>

<pre id="pre-87"><code>for FILENAME in $(ls *.zip)

do

    echo "ZIP filename: $FILENAME"

done</code></pre>

<p class="TX"><span role="doc-pagebreak" epub:type="pagebreak" id="pg_89" aria-label=" Page 89. "/>The variable name in this code is <samp class="SANS_TheSansMonoCd_W5Regular_11">FILENAME</samp>. Next, <samp class="SANS_TheSansMonoCd_W5Regular_11">$(ls *.zip)</samp> tells your machine to run the <samp class="SANS_TheSansMonoCd_W5Regular_11">ls *.zip</samp> command. This command outputs a list of all of the ZIP files in the current folder, producing a list of filenames. The <samp class="SANS_TheSansMonoCd_W5Regular_11">for</samp> loop cycles through that list and runs the code between <samp class="SANS_TheSansMonoCd_W5Regular_11">do</samp> and <samp class="SANS_TheSansMonoCd_W5Regular_11">done</samp> for each filename. In this case, the <samp class="SANS_TheSansMonoCd_W5Regular_11">echo</samp> command prints the filenames to the terminal in <samp class="SANS_TheSansMonoCd_W5Regular_11">ZIP filename:</samp> <samp class="SANS_TheSansMonoCd_W5Regular_Italic_I_11">filename</samp> format.</p>

<p class="TX">For example, here’s what it looks like when I run this code in the <i>BlueLeaks</i> folder in my terminal on macOS:</p>

<pre id="pre-88"><code>micah@trapdoor BlueLeaks % <b>for FILENAME in $(ls *.zip)</b>

for&gt; <b>do</b>

for&gt;     <b>echo "ZIP filename: $FILENAME"</b>

for&gt; <b>done</b>

ZIP filename: 211sfbay.zip

ZIP filename: Securitypartnership.zip

ZIP filename: acprlea.zip

<var>--snip--</var></code></pre>

<p class="TX">Each time the code loops, the value of <samp class="SANS_TheSansMonoCd_W5Regular_11">FILENAME</samp> is the name of one of the ZIP files. When the <samp class="SANS_TheSansMonoCd_W5Regular_11">echo</samp> command runs, it displays those filenames, one after another.</p>

</section>

<section epub:type="division" aria-labelledby="sec2">

<h3 class="H1F" id="sec2"><span id="h-84"/><samp class="SANS_Futura_Std_Heavy_B_21">Exercise 4-1: Unzip the BlueLeaks Dataset</samp></h3>

<p class="TNI">In this exercise, you’ll write a script to unzip all the ZIP files in BlueLeaks so you can work with the data they contain. Once unzipped, the files will take 271GB of additional space on your <i>datasets</i> USB.</p>

<p class="TX">If you’re using macOS or Linux, follow the instructions in <span class="Xref">“Unzip Files on macOS or Linux”</span> next. If you’re using Windows, read that subsection to learn how to write <samp class="SANS_TheSansMonoCd_W5Regular_11">for</samp> loops in bash since you’ll need that skill later in the book, but you won’t need to follow along until <span class="Xref">“Unzip Files on Windows”</span> on <span class="Xref">page 92</span>.</p>

<section epub:type="division" aria-labelledby="sec3">

<h4 class="H2" id="sec3"><span id="h-85"/><samp class="SANS_Futura_Std_Bold_Condensed_Oblique_BI_11">Unzip Files on macOS or Linux</samp></h4>

<p class="TNI">Open a terminal and navigate to your <i>BlueLeaks</i> folder by running the following command, replacing <samp class="SANS_TheSansMonoCd_W5Regular_Italic_I_11">blueleaks_path</samp> with your own folder path:</p>

<pre id="pre-89"><code><b>cd </b><b><var>blueleaks_path</var></b></code></pre>

<p class="TX">On Linux, I’d use this command (your path will be different):</p>

<pre id="pre-90"><code>cd /media/micah/datasets/BlueLeaks</code></pre>

<p class="TX">On macOS, I’d use the following (again, your path will vary):</p>

<pre id="pre-91"><code>cd /Volumes/datasets/BlueLeaks</code></pre>

<p class="TX"><span role="doc-pagebreak" epub:type="pagebreak" id="pg_90" aria-label=" Page 90. "/>Run <samp class="SANS_TheSansMonoCd_W7Bold_B_11">ls</samp> to see the list of files in this folder and <samp class="SANS_TheSansMonoCd_W7Bold_B_11">ls -lh</samp> to see detailed information about these files, like their sizes.</p>

<p class="TX">To unzip single files, you use the following syntax:</p>

<pre id="pre-92"><code><b>unzip</b><b><var> filename</var></b></code></pre>

<p class="TX">For example, run this command to unzip the first file in BlueLeaks:</p>

<pre id="pre-93"><code><b>unzip 211sfbay.zip</b></code></pre>

<p class="TX">This should extract the 2.6GB <i>211sfbay.zip</i> file into the folder called <i>211sfbay</i>. Run <samp class="SANS_TheSansMonoCd_W7Bold_B_11">ls</samp> again and you should see the new folder containing all of the hacked data from one of the BlueLeaks sites.</p>

<p class="TX">However, you want to unzip <i>all</i> of the BlueLeaks files. Delete the <i>211sfbay</i> folder:</p>

<pre id="pre-94"><code><b>rm -r 211sfbay</b></code></pre>

<p class="TX">The <samp class="SANS_TheSansMonoCd_W5Regular_11">rm</samp> command on its own deletes files; to delete entire folders, you include <samp class="SANS_TheSansMonoCd_W5Regular_11">-r</samp> (short for <samp class="SANS_TheSansMonoCd_W5Regular_11">--recursive</samp>). The <samp class="SANS_TheSansMonoCd_W5Regular_11">-r</samp> option deletes all the files in that folder, and all the files in folders in that folder, and so on, before finally deleting the target folder.</p>

<p class="TX">Navigate to your text editor, create a new folder in your <i>exercises</i> folder called <i>chapter-4</i>, and create a new file in the <i>chapter-4</i> folder called <i>exercise -4-1-unzip.sh</i>. (Storing your script i<span class="Index-Link">n a separate folder prevents you from polluting the dataset with your own files.)</span> In your new file, enter the following code:</p>

<pre id="pre-95"><code>#!/bin/bash

for FILENAME in $(ls *.zip)

do

    echo "Unzipping $FILENAME..."

    unzip -o $FILENAME

done</code></pre>

<p class="TX">Since <i>exercise-4-1-unzip.sh</i> is a shell script, it begins with the same <samp class="SANS_TheSansMonoCd_W5Regular_11">#!/bin/bash</samp> shebang as the script in <span class="Xref"><a href="chapter3.xhtml">Chapter 3</a></span>. After you define this <samp class="SANS_TheSansMonoCd_W5Regular_11">for</samp> loop, the script starts it with <samp class="SANS_TheSansMonoCd_W5Regular_11">do</samp> and ends it with <samp class="SANS_TheSansMonoCd_W5Regular_11">done</samp>, running the <samp class="SANS_TheSansMonoCd_W5Regular_11">echo "Unzipping $FILENAME…"</samp> and <samp class="SANS_TheSansMonoCd_W5Regular_11">unzip -o $FILENAME</samp> commands over and over. The <samp class="SANS_TheSansMonoCd_W5Regular_11">echo</samp> command displays the value of the <samp class="SANS_TheSansMonoCd_W5Regular_11">FILENAME</samp> variable, which changes to a new filename with each loop, and the <samp class="SANS_TheSansMonoCd_W5Regular_11">unzip</samp> command unzips that file. The <samp class="SANS_TheSansMonoCd_W5Regular_11">-o</samp> argument tells <samp class="SANS_TheSansMonoCd_W5Regular_11">unzip</samp> to <i>overwrite</i> files if necessary, meaning that if any file being unzipped already exists, the script will replace it with the newer version.</p>

<p class="TX">For example, when you run this code on BlueLeaks, the value of <samp class="SANS_TheSansMonoCd_W5Regular_11">FILENAME</samp> during the first loop is <samp class="SANS_TheSansMonoCd_W5Regular_11">211sfbay.zip</samp>. The code that runs in this loop is equivalent to the following commands:</p>

<pre id="pre-96"><code>echo "Unzipping 211sfbay.zip..."

unzip -o 211sfbay.zip</code></pre>

<p class="TX"><span role="doc-pagebreak" epub:type="pagebreak" id="pg_91" aria-label=" Page 91. "/>The second time the code loops, it runs the same code with <samp class="SANS_TheSansMonoCd_W5Regular_11">acprlea.zip</samp> as the <samp class="SANS_TheSansMonoCd_W5Regular_11">FILENAME</samp> value, and so on.</p>

<p class="TX">Change to your <i>BlueLeaks</i> folder. On my Mac, I do this by running the following command:</p>

<pre id="pre-97"><code>cd /Volumes/datasets/BlueLeaks</code></pre>

<p class="TX">Next, make this shell script executable and run it as follows:</p>

<pre id="pre-98"><code><b>chmod</b> <b>+</b><b>x ../exercises/chapter-4/exercise-4-1-unzip.sh</b>

<b>../exercises/chapter-4/exercise-4-1-unzip.sh</b></code></pre>

<p class="TX">These commands assume that your <i>exercises</i> folder is in the same folder as the <i>BlueLeaks</i> folder. The relative path to your <i>exercises</i> folder is <i>../exercises</i>, and the relative path to the shell script you just saved is <i>../exercises/chapter-4/exercise-4-1-unzip.sh</i>.</p>

<p class="TX">After you run these commands, your script should begin unzipping all 168 BlueLeaks files. Sit back, relax, and perhaps enjoy a beverage while you wait for it to finish, which could take hours.</p>
<aside class="box" aria-labelledby="box-13">

<h5 class="BH" id="box-13"><samp class="SANS_Dogma_OT_Bold_B_11">LOOPING THROUGH FILENAMES WITH SPACES</samp></h5>

<p class="BoxBodyFirst"><samp class="SANS_Futura_Std_Book_11">Looping over the output of</samp> <samp class="SANS_TheSansMonoCd_W5Regular_11">ls</samp> <samp class="SANS_Futura_Std_Book_11">as you’ve just done works only if the filenames don’t contain spaces. If they did, your script would fail due to invalid filenames. For example, if you had a file called</samp> <samp class="SANS_Futura_Std_Book_Oblique_I_11">Work Documents.zip</samp> <samp class="SANS_Futura_Std_Book_11">in the folder, the</samp> <samp class="SANS_TheSansMonoCd_W5Regular_11">for</samp> <samp class="SANS_Futura_Std_Book_11">loop would consider it two files,</samp> <samp class="SANS_Futura_Std_Book_Oblique_I_11">Work</samp> <samp class="SANS_Futura_Std_Book_11">and</samp> <samp class="SANS_Futura_Std_Book_Oblique_I_11">Documents.zip</samp><samp class="SANS_Futura_Std_Book_11">, as discussed in <a href="chapter3.xhtml">Chapter 3</a>.</samp></p>

<p class="BoxBody"><samp class="SANS_Futura_Std_Book_11">The output of the</samp> <samp class="SANS_TheSansMonoCd_W5Regular_11">ls</samp> <samp class="SANS_Futura_Std_Book_11">command is a</samp> <samp class="SANS_Futura_Std_Book_Oblique_I_11">string</samp><samp class="SANS_Futura_Std_Book_11">—that is, a list of characters—with each filename separated by a newline character (</samp><samp class="SANS_TheSansMonoCd_W5Regular_11">\n</samp><samp class="SANS_Futura_Std_Book_11">), which represents a line break. If you have two files in a folder,</samp> <samp class="SANS_Futura_Std_Book_Oblique_I_11">readme.txt</samp> <samp class="SANS_Futura_Std_Book_11">and</samp> <samp class="SANS_Futura_Std_Book_Oblique_I_11">Work Documents.zip</samp><samp class="SANS_Futura_Std_Book_11">, the</samp> <samp class="SANS_TheSansMonoCd_W5Regular_11">ls</samp> <samp class="SANS_Futura_Std_Book_11">command outputs a string like</samp> <samp class="SANS_TheSansMonoCd_W5Regular_11">readme.txt\nWork Documents.zip</samp><samp class="SANS_Futura_Std_Book_11">.</samp></p>

<p class="BoxBody"><samp class="SANS_Futura_Std_Book_11">The bash shell includes an environment variable called</samp> <samp class="SANS_TheSansMonoCd_W5Regular_11">IFS</samp> <samp class="SANS_Futura_Std_Book_11">(short for “internal field separator”), which the shell uses to figure out how to split strings in a</samp> <samp class="SANS_TheSansMonoCd_W5Regular_11">for</samp> <samp class="SANS_Futura_Std_Book_11">loop. By default, strings are split by any whitespace: spaces, tabs, or newlines. This is why, if you loop through the string</samp> <samp class="SANS_TheSansMonoCd_W5Regular_11">1 2 3</samp><samp class="SANS_Futura_Std_Book_11">, you get three smaller strings—</samp><samp class="SANS_TheSansMonoCd_W5Regular_11">1</samp><samp class="SANS_Futura_Std_Book_11">,</samp> <samp class="SANS_TheSansMonoCd_W5Regular_11">2</samp><samp class="SANS_Futura_Std_Book_11">, and</samp> <samp class="SANS_TheSansMonoCd_W5Regular_11">3</samp><samp class="SANS_Futura_Std_Book_11">—separated with spaces. Likewise, looping through the string</samp> <samp class="SANS_TheSansMonoCd_W5Regular_11">readme.txt\nWork Documents.zip</samp> <samp class="SANS_Futura_Std_Book_11">results in the smaller strings</samp> <samp class="SANS_TheSansMonoCd_W5Regular_11">readme.txt</samp><samp class="SANS_Futura_Std_Book_11">,</samp> <samp class="SANS_TheSansMonoCd_W5Regular_11">Work</samp><samp class="SANS_Futura_Std_Book_11">, and</samp> <samp class="SANS_TheSansMonoCd_W5Regular_11">Documents.zip</samp><samp class="SANS_Futura_Std_Book_11">, separated with a newline character and a space.</samp></p>

<p class="BoxBody"><samp class="SANS_Futura_Std_Book_11">To work with filenames with spaces, you change the value of the</samp> <samp class="SANS_TheSansMonoCd_W5Regular_11">IFS</samp> <samp class="SANS_Futura_Std_Book_11">variable so that it splits strings only on newline characters, but not on spaces or tabs. Then you change it back after the loop. Here’s an example:</samp></p>

<pre id="pre-99"><code>#!/bin/bash

ORIGINAL_IFS=$IFS

IFS=$(echo -n "\n")<span role="doc-pagebreak" epub:type="pagebreak" id="pg_92" aria-label=" Page 92. "/>

for FILENAME in $(ls)

do

    echo "$FILENAME"

done

IFS=$ORIGINAL_IFS</code></pre>

<p class="BoxBody"><samp class="SANS_Futura_Std_Book_11">Inside the</samp> <samp class="SANS_TheSansMonoCd_W5Regular_11">for</samp> <samp class="SANS_Futura_Std_Book_11">loop, the</samp> <samp class="SANS_TheSansMonoCd_W5Regular_11">FILENAME</samp> <samp class="SANS_Futura_Std_Book_11">variable will contain the full filename, even if it includes spaces. You can use code like this to unzip files (as long as they’re all ZIP files) or open them using any other CLI program.</samp></p>

<p class="BoxBodyLast"><samp class="SANS_Futura_Std_Book_11">None of the ZIP filenames in the BlueLeaks data have spaces, but you may need to use this script on filenames with spaces for future projects.</samp></p>
</aside>

<p class="TX">If you’re not using Windows, skip ahead to the <span class="Xref">“Organize Your Files”</span> section on <span class="Xref">page 93</span>. Otherwise, read on.</p>

</section>

<section epub:type="division" aria-labelledby="sec4">

<h4 class="H2" id="sec4"><span id="h-86"/><samp class="SANS_Futura_Std_Bold_Condensed_Oblique_BI_11">Unzip Files on Windows</samp></h4>

<p class="BodyNoIndent">Unzipping files in WSL from a USB disk formatted for Windows might be <i>very</i> slow, due to WSL performance problems. Fortunately, there’s a much faster way to unzip all 168 files in BlueLeaks, using PowerShell and a program called 7-Zip.</p>

<section epub:type="division" aria-labelledby="sec5">

<h5 class="H3" id="sec5"><samp class="SANS_Futura_Std_Bold_Condensed_B_11">Install 7-Zip</samp></h5>

<p class="BodyNoIndent">The open source Windows archiving program 7-Zip lets you extract various types of compressed files<i>.</i> Download and install 7-Zip from <a href="https://www.7-zip.org"><i>https://<wbr/>www<wbr/>.7<wbr/>-zip<wbr/>.org</i></a>. You’ll receive a warning saying that the program is made by an unknown publisher, but it’s safe to install as long as you’ve downloaded it from the official website.</p>

<p class="TX">After you install 7-Zip, you can use its <i>7z.exe</i> program to extract files directly from PowerShell. By default, <i>7z.exe</i> should be located in <i>C:\Program Files\7-Zip\7z.exe</i>. However, to run the program from any directory, add <i>C:\Program Files\7-Zip</i> to your <samp class="SANS_TheSansMonoCd_W5Regular_11">Path</samp> environment variable.</p>

<p class="TX"><i>Environment variables</i> are variables that already exist when you open your shell, as opposed to ones that you create in a <samp class="SANS_TheSansMonoCd_W5Regular_11">for</samp> loop or by other methods. The <samp class="SANS_TheSansMonoCd_W5Regular_11">Path</samp> environment variable is a list of folders that contain programs. It contains some folders by default, but you can also add your own. When you run <samp class="SANS_TheSansMonoCd_W5Regular_11">7z</samp>, PowerShell looks in each folder listed in <samp class="SANS_TheSansMonoCd_W5Regular_11">Path</samp> and checks for a file called <i>7z.exe</i>, then runs that program for you.</p>

<p class="TX">To add <i>7z.exe</i> to <samp class="SANS_TheSansMonoCd_W5Regular_11">Path</samp>, click <b>Start</b>, search for <b>environment variables</b>, and click <b>Edit the System Environment Variables</b>. In the window that opens, click <b>Environment Variables</b>, and you should see a window with lists of user variables and system variables. Double-click <b>Path</b> in the User Variables box, which should show you all of the folders stored in <samp class="SANS_TheSansMonoCd_W5Regular_11">Path</samp>. Click <b>New</b>, add <i>C:\Program Files\7-Zip</i>, and click <b>OK</b> to save. If you have a PowerShell window <span role="doc-pagebreak" epub:type="pagebreak" id="pg_93" aria-label=" Page 93. "/>open, close PowerShell and open it again, forcing the shell to use the new changes to the <samp class="SANS_TheSansMonoCd_W5Regular_11">Path</samp> environment variable.</p>

<p class="TX">You can now use the <samp class="SANS_TheSansMonoCd_W5Regular_11">7z</samp> command to run 7-Zip.</p>

</section>

<section epub:type="division" aria-labelledby="sec6">

<h5 class="H3" id="sec6"><samp class="SANS_Futura_Std_Bold_Condensed_B_11">Unzip in PowerShell with 7-Zip</samp></h5>

<p class="TNI">In a PowerShell terminal, change to the <i>BlueLeaks</i> folder on your <i>datasets</i> USB disk. For example, on my computer, I run:</p>

<pre id="pre-100"><code>cd D:\BlueLeaks</code></pre>

<p class="TX">Next, run the following PowerShell commands (this is the PowerShell version of the <i>exercise-4-1-unzip.sh</i> shell script in the previous subsection):</p>

<pre id="pre-101"><code>$ZipFiles<b> </b>=<b> </b>Get-ChildItem -Path . -Filter "*.zip"

foreach ($ZipFile in $ZipFiles) {

    7z x $ZipFile.FullName

}</code></pre>

<p class="TX">The first line sets the PowerShell variable <samp class="SANS_TheSansMonoCd_W5Regular_11">$ZipFiles</samp> to the list of ZIP files it finds in the current folder, represented by the dot (<samp class="SANS_TheSansMonoCd_W5Regular_11">.</samp>). This is followed by a <samp class="SANS_TheSansMonoCd_W5Regular_11">foreach</samp> loop, which loops through this list, setting the variable <samp class="SANS_TheSansMonoCd_W5Regular_11">$ZipFile</samp> to the name of each file. The <samp class="SANS_TheSansMonoCd_W5Regular_11">7z</samp> command runs over and over again for each different filename, unzipping each file.</p>

<p class="TX">When I run these commands in my PowerShell terminal, I get the following output:</p>

<pre id="pre-102"><code>Scanning the drive for archives:

1 file, 2579740749 bytes (2461 MiB)



Extracting archive: D:\BlueLeaks\211sfbay.zip

--

Path = D:\BlueLeaks\211sfbay.zip

Type = zip

Physical Size = 2579740749

<var>--snip--</var></code></pre>

<p class="TX">Your PowerShell window should likewise begin unzipping all 168 BlueLeaks files.</p>
<blockquote>

<p class="NOTE"><span class="NoteHead"><samp class="SANS_Dogma_OT_Bold_B_21">NOTE</samp></span></p>
</blockquote>

<p class="NOTE-TXT"><i>Once you’re finished with this chapter, read <a href="appendixA.xhtml">Appendix A</a> and implement one of the solutions it describes for avoiding WSL performance problems to make it easier to work with big datasets like BlueLeaks in Windows going forward. You’ll use WSL for the remainder of the book, so you’ll need a plan to resolve any issues you encounter.</i></p>

</section>
</section>

<section epub:type="division" aria-labelledby="sec7">

<h4 class="H2" id="sec7"><span id="h-87"/><samp class="SANS_Futura_Std_Bold_Condensed_Oblique_BI_11">Organize Your Files</samp></h4>

<p class="TNI">Your <i>BlueLeaks</i> folder should now be full of both ZIP files and extracted folders. Now you’ll make a separate <i>BlueLeaks-extracted</i> folder for the <span role="doc-pagebreak" epub:type="pagebreak" id="pg_94" aria-label=" Page 94. "/>extracted data and keep the ZIP files themselves in the <i>BlueLeaks</i> folder so that you can continue to seed the torrent with them if you like.</p>

<p class="TX">Open a terminal (if you’re in Windows, switch to a WSL Ubuntu terminal again), change folders to your <i>datasets</i> USB disk, and run the following commands:</p>

<pre id="pre-103"><code><b>mv BlueLeaks BlueLeaks-extracted</b>

<b>mkdir BlueLeaks</b>

<b>mv BlueLeaks-extracted/*.zip BlueLeaks</b></code></pre>

<p class="TX">The <samp class="SANS_TheSansMonoCd_W5Regular_11">mv</samp> command moves or renames files. On the first line, it renames the <i>BlueLeaks</i> folder <i>BlueLeaks-extracted</i>. The <samp class="SANS_TheSansMonoCd_W5Regular_11">mkdir</samp> command, which you used in <span class="Xref"><a href="chapter3.xhtml">Chapter 3</a></span>, creates a new empty folder called <i>BlueLeaks</i>. The third command moves all of the ZIP files in the <i>BlueLeaks-extracted</i> folder into the newly created <i>BlueLeaks</i> folder.</p>

<p class="TX">Your <i>datasets</i> USB disk should now contain a folder called <i>BlueLeaks</i> with 250GB of ZIP files, along with another folder called <i>BlueLeaks-extracted</i> with 269GB of extracted hacked police data.</p>

</section>
</section>

<section epub:type="division" aria-labelledby="sec8">

<h3 class="H1" id="sec8"><span id="h-88"/><samp class="SANS_Futura_Std_Bold_B_11">How the Hacker Obtained the BlueLeaks Data</samp></h3>

<p class="TNI">We don’t know how the hacker hacked and leaked the BlueLeaks files, but we can make an educated guess based on clues from the dataset.</p>

<p class="TX">Imagine that it’s June 6, 2020, less than two weeks after Minneapolis cop Derek Chauvin murdered George Floyd by kneeling on his neck for over nine minutes while Floyd struggled to breathe, triggering the summer’s Black Lives Matter uprising against police violence. Millions of people took to the streets to demand police accountability and the end of racist police violence in what was “the largest movement in the country’s history,” according to the <i>New York Times</i>.</p>

<p class="TX">Now imagine you’re a hacktivist. In addition to confronting police in the streets, you’re confronting them on the internet. Using OSINT, you’ve discovered that hundreds of police websites use the same shoddy web application developed by the Texas web development firm Netsential. All these sites run on Windows, use Microsoft’s Internet Information Services (IIS) web server software, and are programmed using Microsoft’s web framework ASP.NET. They’re also all hosted from IP addresses in the same data center in Texas.</p>

<p class="TX">After you spend some time poking around one of these sites, the Arizona High Intensity Drug Trafficking Area (AZHIDTA), you find what you were looking for: a <i>remote code execution vulnerability</i>, a type of bug that lets you run commands on a remote server, like the Windows server running the AZHIDTA website. (My guess is that the vulnerability started with SQL injection, a technology beyond the scope of this book.)</p>

<p class="Warning"><span class="NoteHead"><samp class="SANS_Dogma_OT_Bold_B_21">WARNING</samp></span></p>

<p class="NOTE-TXT"><i>I’m about to tell you about a potential URL for a hacking tool left behind by the hacker, but don’t actually try loading it in your browser because it might be illegal. Attempting to access someone else’s hacking tools is definitely a legal gray area.</i></p>

<p class="TX"><span role="doc-pagebreak" epub:type="pagebreak" id="pg_95" aria-label=" Page 95. "/>To open a shell on this web server, you use a <i>web shell</i>, a web page that, when you submit a form with a command in it, runs that command on the web server and responds with its output. Using the vulnerability you discovered, you save a web shell into a file called <i>blug.aspx</i> on the web server’s disk. Loading <i>/blug.aspx</i> on the <a href="https://www.azhidta.org"><i>https://<wbr/>www<wbr/>.azhidta<wbr/>.org</i></a> website in your browser allows you to run whatever commands you want on the server.</p>

<p class="TX">The web shell <i>blug.aspx</i> is included in the BlueLeaks dataset. In order to understand how this web shell works, I set up a Windows virtual machine with an IIS server to test it, as shown in <a href="#fig4-1">Figure 4-1</a>. The left side of the screenshot is the shell (in which I ran the command <samp class="SANS_TheSansMonoCd_W5Regular_11">dir c:\</samp>). The right side let me browse the server’s filesystem and upload new files.</p>
<figure class="IMG"><img class="img100" id="fig4-1" src="Images/Figure4-1.png" alt="This screenshot shows the “ASPX Shell” web shell from BlueLeaks, loaded in a web browser in Windows." width="846" height="286"/>

<figcaption><p class="CAP"><samp class="SANS_Futura_Std_Book_Oblique_I_11">Figure 4-1: Testing the</samp> <samp class="SANS_Futura_Std_Book_11">blug.aspx</samp> <samp class="SANS_Futura_Std_Book_Oblique_I_11">web shell in a Windows VM</samp></p></figcaption>

</figure>

<p class="TX">I don’t know for sure if this is how the BlueLeaks hack happened, but I think it’s very likely. While researching BlueLeaks, I found the following web shell files, all timestamped late on June 6, 2020, making them among the most recently created files in the dataset:</p>

<p class="RunInPara"><b><i>azhidta/ntdaddy.aspx</i></b> The Classic ASP web shell NTDaddy, developed around 2001 by a hacker named obzerve</p>

<p class="RunInPara"><b><i>azhidta/blug.aspx</i></b> The ASP.NET web shell called ASPX Shell, developed in 2007 by a hacker named LT</p>

<p class="RunInPara"><b><i>azhidta/pscp64.exe</i></b> A program that comes with PuTTY, a popular Windows tool for securely copying files to and from remote servers</p>

<p class="RunInPara"><b><i>icefishx/7z.exe</i></b> A copy of the 7-Zip compression and extraction program</p>

<p class="TX">My guess is that the hacktivist first tried to create a <i>ntdaddy.aspx</i> web shell, but found that it didn’t work because it was developed using an earlier version of ASP called Classic ASP, while the BlueLeaks site used the modern version, ASP.NET. They then created the <i>blug.aspx</i> web shell instead, used that shell to upload <i>pscp64.exe</i> and <i>7z.exe</i>, used <i>7z.exe</i> to compress all of the files for a given police website, and uploaded that data to their own server with <i>pscp64.exe</i>.</p>

<p class="TX"><span role="doc-pagebreak" epub:type="pagebreak" id="pg_96" aria-label=" Page 96. "/>After manually hacking one of the BlueLeaks sites, the hacker likely automated the process for the rest of the BlueLeaks sites. Perhaps they created a shell script that used cURL instead of a web browser to perform the same steps. They could have run that script in a <samp class="SANS_TheSansMonoCd_W5Regular_11">for</samp> loop targeting all 251 websites, uploading hundreds of gigabytes of data to themselves, in a single Saturday evening. They then likely forgot to delete the <i>blug.aspx</i>, <i>pscp64.exe</i>, <i>7z.exe</i>, and <i>ntdaddy.aspx</i> files before submitting the dataset to DDoSecrets.</p>

</section>

<section epub:type="division" aria-labelledby="sec9">

<h3 class="H1F" id="sec9"><span id="h-89"/><samp class="SANS_Futura_Std_Heavy_B_21">Exercise 4-2: Explore BlueLeaks on the Command Line</samp></h3>

<p class="TNI">In this exercise, you’ll start exploring the contents of your unzipped BlueLeaks files, using commands and advanced shell features that let you quickly measure file and folder size and sort and count lines of output.</p>

<section epub:type="division" aria-labelledby="sec10">

<h4 class="H2" id="sec10"><span id="h-90"/><samp class="SANS_Futura_Std_Bold_Condensed_Oblique_BI_11">Calculate How Much Disk Space Folders Use</samp></h4>

<p class="TNI">The <samp class="SANS_TheSansMonoCd_W5Regular_11">du</samp> command (short for “disk usage”) is a powerful tool for assessing a new dataset. Linux and macOS come with slightly different versions of <samp class="SANS_TheSansMonoCd_W5Regular_11">du</samp>. The Linux version, which is part of a software package called GNU coreutils, is better and more up to date at the time of writing, so you’ll use it for this exercise.</p>

<p class="TX">Users of Linux and Windows with WSL should already have the correct built-in <samp class="SANS_TheSansMonoCd_W5Regular_11">du</samp> tool. If you’re using macOS, run <samp class="SANS_TheSansMonoCd_W7Bold_B_11">brew install coreutils</samp> in the terminal to install coreutils. After this, the <samp class="SANS_TheSansMonoCd_W5Regular_11">du</samp> command will run the macOS version of the tool, while the <samp class="SANS_TheSansMonoCd_W5Regular_11">gdu</samp> command will run the coreutils version that you just installed. In the following commands, macOS users should replace <samp class="SANS_TheSansMonoCd_W5Regular_11">du</samp> with <samp class="SANS_TheSansMonoCd_W5Regular_11">gdu</samp>.</p>

<p class="TX">To find out how much space the extracted BlueLeaks dataset takes, open your terminal and run this command, using the path to the <i>BlueLeaks-extracted</i> folder on your computer:</p>

<pre id="pre-104"><code><b>du -sh --apparent-size </b><b><var>/media/micah/datasets/BlueLeaks-extracted</var></b></code></pre>

<p class="TX">The <samp class="SANS_TheSansMonoCd_W5Regular_11">-s</samp> argument in this command (short for <samp class="SANS_TheSansMonoCd_W5Regular_11">--summarize</samp>) displays the total disk space of a folder rather than how much space each file inside it takes up. The <samp class="SANS_TheSansMonoCd_W5Regular_11">-h</samp> argument (short for <samp class="SANS_TheSansMonoCd_W5Regular_11">--human-readable</samp>) shows file sizes in units like kilobytes, megabytes, or gigabytes, rather than in terms of system blocks (a unit that changes depending on how your disk is set up). Finally, the <samp class="SANS_TheSansMonoCd_W5Regular_11">--apparent-size</samp> argument shows you how big the files actually are, as opposed to how much space they take up on your disk.</p>

<p class="TX"><span class="Index-Link">The command checks the size of every file in BlueLeaks and adds them all together, so it takes a while to run. When it’s done, it should tell you that the</span> <i>BlueLeaks-extracted</i> <span class="Index-Link">folder takes up 269GB.</span></p>
<blockquote>

<p class="NOTE"><span class="NoteHead"><samp class="SANS_Dogma_OT_Bold_B_21">NOTE</samp></span></p>
</blockquote>

<p class="NOTE-TXT"><i>In addition to using <samp class="mono">-h</samp> to generate human-readable units, you can specify which units you want to use. The <samp class="mono">-b</samp> argument, short for <samp class="mono">--bytes</samp>, shows file sizes in bytes, <samp class="mono">-k</samp> shows them in kilobytes, and <samp class="mono">-m</samp> shows them in megabytes.</i></p>

<p class="TX"><span role="doc-pagebreak" epub:type="pagebreak" id="pg_97" aria-label=" Page 97. "/>Next, you’ll measure the size of an individual folder in BlueLeaks. Change to your <i>BlueLeaks-extracted</i> folder; for example, I’d run <samp class="SANS_TheSansMonoCd_W5Regular_11">cd /media/micah/datasets/BlueLeaks-extracted</samp> on my Linux computer. From there, run the following command to measure the size of the <i>ncric</i> folder, which contains documents from the Northern California Regional Intelligence Center (NCRIC), the fusion center I’ve spent the most time researching:</p>

<pre id="pre-105"><code><b>du -sh --apparent-size ncric</b></code></pre>

<p class="TX">The output should tell you that the <i>ncric</i> folder takes 19GB.</p>

<p class="TX">To find out the size of each folder in BlueLeaks, you could run the <samp class="SANS_TheSansMonoCd_W5Regular_11">du -sh --apparent-size</samp> <samp class="SANS_TheSansMonoCd_W5Regular_Italic_I_11">path</samp> command for each folder, but it’s quicker to use another <samp class="SANS_TheSansMonoCd_W5Regular_11">for</samp> loop. Run the following code in the terminal:</p>

<pre id="pre-106"><code><b>for FOLDER in $(ls); do du -sh --apparent-size $FOLDER; done</b></code></pre>

<p class="TX">As shown here, you can run multiple commands on the same line by separating them with semicolons (<samp class="SANS_TheSansMonoCd_W5Regular_11">;</samp>). This one-liner loops through the output of the <samp class="SANS_TheSansMonoCd_W5Regular_11">ls</samp> command, which, since you’re currently in the <i>BlueLeaks-extracted</i> folder, is the name of each BlueLeaks folder. The code stores these names in the <samp class="SANS_TheSansMonoCd_W5Regular_11">FOLDER</samp> variable and then, inside each iteration of the loop, runs the <samp class="SANS_TheSansMonoCd_W5Regular_11">du -sh --apparent-size $FOLDER</samp> command.</p>

<p class="TX">Here are the first few lines of output:</p>

<pre id="pre-107"><code>2.8G    211sfbay

29M     Securitypartnership

216M    acprlea

65M     acticaz

748M    akorca

<var>--snip--</var></code></pre>

<p class="TX">This shows you how much disk space each folder uses.</p>

</section>

<section epub:type="division" aria-labelledby="sec11">

<h4 class="H2" id="sec11"><span id="h-91"/><samp class="SANS_Futura_Std_Bold_Condensed_Oblique_BI_11">Use Pipes and Sort Output</samp></h4>

<p class="TNI">You now know the size of each folder in the BlueLeaks dataset. Next, you’ll sort the 168 folders in order of disk space. By determining which folders are the largest, you can quickly tell which fusion centers have the most data and therefore are probably the biggest or most active.</p>

<p class="TX">To sort this list of folders by the smallest file size to the largest, use the <samp class="SANS_TheSansMonoCd_W5Regular_11">sort</samp> command, which takes a list of text lines and, by default, sorts them <i>alphanumerically</i>; that is, text is sorted alphabetically and numbers are sorted by their first numeral. For example, the list <samp class="SANS_TheSansMonoCd_W5Regular_11">file1</samp>, <samp class="SANS_TheSansMonoCd_W5Regular_11">file10</samp>, <samp class="SANS_TheSansMonoCd_W5Regular_11">file2</samp>, …, <samp class="SANS_TheSansMonoCd_W5Regular_11">file9</samp> is sorted alphanumerically: since text lines are sorted one character at a time, and since <samp class="SANS_TheSansMonoCd_W5Regular_11">1</samp> is less than <samp class="SANS_TheSansMonoCd_W5Regular_11">2</samp>, <samp class="SANS_TheSansMonoCd_W5Regular_11">file10</samp> comes before <samp class="SANS_TheSansMonoCd_W5Regular_11">file2</samp>.</p>

<p class="TX">To sort your BlueLeaks files by file size, modify the command with the <samp class="SANS_TheSansMonoCd_W5Regular_11">-h</samp> (<samp class="SANS_TheSansMonoCd_W5Regular_11">--human-numeric-sort</samp>) argument. This argument pays attention to the <i>value</i> of numbers, not just characters, so it correctly places smaller numerical values before larger ones. It also takes file size units into account, <span role="doc-pagebreak" epub:type="pagebreak" id="pg_98" aria-label=" Page 98. "/>meaning it will place 2MB before 1GB, even though 2 is numerically greater than 1.</p>

<p class="TX">In shell scripting, the <i>pipe</i> operator (<samp class="SANS_TheSansMonoCd_W5Regular_11">|</samp>) lets you take the output of a command to the left of the operator and pipe it into the command on the right. When you pipe input into the <samp class="SANS_TheSansMonoCd_W5Regular_11">sort</samp> command, it outputs a sorted version of that input. Run the <samp class="SANS_TheSansMonoCd_W5Regular_11">for</samp> loop from the previous subsection, this time piping the output into <samp class="SANS_TheSansMonoCd_W5Regular_11">sort</samp>:</p>

<pre id="pre-108"><code><b>for FOLDER in $(ls); do du -sh –apparent-size $FOLDER; done | sort -h</b></code></pre>

<p class="TX">This line first runs the <samp class="SANS_TheSansMonoCd_W5Regular_11">for</samp> loop that measures the space each BlueLeaks folder takes up. The output of this code is a list of lines of text, where each line starts with the human-readable size of a folder. Piping those lines of text as input into the <samp class="SANS_TheSansMonoCd_W5Regular_11">sort -h</samp> command sorts those lines numerically while paying attention to the file size units.</p>

<p class="TX">Your output should look like this:</p>

<pre id="pre-109"><code>256     miacxold

256     ncric-history-good

256     ncricSteveBackup

259K    terrorismtip

548K    oaktac

625K    sccpca

<var>--snip--</var>

13G     lacleartraining

14G     jric

19G     ncric

36G     miacx

46G     repo</code></pre>

<p class="TX">The folders that have the least data should be at the top: <i>miacxold</i>, <i>ncric-history-good</i>, and <i>ncricSteveBackup</i> contain only empty subfolders. The <i>repo</i> folder, the largest folder in BlueLeaks, should appear at the bottom of the list, right after <i>miacx</i>, the second-largest folder.</p>
<aside class="box" aria-labelledby="box-14">

<h5 class="BH" id="box-14"><samp class="SANS_Dogma_OT_Bold_B_11">FILE SIZE UNITS AND CONVERSIONS</samp></h5>

<p class="BoxBodyFirst"><samp class="SANS_Futura_Std_Book_11">You’re likely familiar with file size units like megabytes and gigabytes, and you might have a mental model of how much information those units can hold: Office documents are often a few megabytes, a two-hour video file might be a gigabyte or two, and a video game might be hundreds of gigabytes. Being able to convert between the different units of disk space is an important skill for working with large datasets.</samp></p>

<p class="BoxBody"><samp class="SANS_Futura_Std_Book_11">Units like kilobyte, megabyte, gigabyte, and terabyte sound metric, but they’re not. For instance, the</samp> <samp class="SANS_Futura_Std_Book_Oblique_I_11">kilo-</samp> <samp class="SANS_Futura_Std_Book_11">prefix denotes a factor of 1,000, but there are 1,024 bytes in a kilobyte. Here’s a list of common conversions:</samp></p>
<ul class="BOXBL">

<li class="BoxListBullet"><span role="doc-pagebreak" epub:type="pagebreak" id="pg_99" aria-label=" Page 99. "/><samp class="SANS_Futura_Std_Book_11">1 byte (B): 8 bits, or 8 ones and zeros in binary</samp></li>
<li class="BoxListBullet"><samp class="SANS_Futura_Std_Book_11">1 kilobyte (KB): 1,024 bytes</samp></li>
<li class="BoxListBullet"><samp class="SANS_Futura_Std_Book_11">1 megabyte (MB): 1,024 kilobytes</samp></li>
<li class="BoxListBullet"><samp class="SANS_Futura_Std_Book_11">1 gigabyte (GB): 1,024 megabytes</samp></li>
<li class="BoxListBullet"><samp class="SANS_Futura_Std_Book_11">1 terabyte (TB): 1,024 gigabytes</samp></li>
<li class="BoxListBullet"><samp class="SANS_Futura_Std_Book_11">1 petabyte (PB): 1,024 terabytes</samp></li>
</ul>

<p class="BoxBodyLast"><samp class="SANS_Futura_Std_Book_11">As an example, the</samp> <samp class="SANS_Futura_Std_Book_Oblique_I_11">ncric</samp> <samp class="SANS_Futura_Std_Book_11">folder in BlueLeaks is 20,008,051,852 bytes, which is 19,539,113.1KB, or 19,081.2MB, or 18.6GB—about 160 billion bits.</samp></p>
</aside>
</section>

<section epub:type="division" aria-labelledby="sec12">

<h4 class="H2" id="sec12"><span id="h-92"/><samp class="SANS_Futura_Std_Bold_Condensed_Oblique_BI_11">Create an Inventory of Filenames in a Dataset</samp></h4>

<p class="TNI">When you’re working with an enormous dataset like BlueLeaks, it’s helpful to create an inventory of all of the files it contains by listing them in a text file. This way you can easily count the number of files in the dataset or search for filenames without having to go through the much slower process of looping through the dataset itself.</p>

<p class="TX">You can create this inventory with the <samp class="SANS_TheSansMonoCd_W5Regular_11">find</samp> command, which outputs a list of files and folders in a folder. From within the <i>BlueLeaks-extracted</i> folder, run the following command to list all of the files in BlueLeaks:</p>

<pre id="pre-110"><code><b>find . -type f</b></code></pre>

<p class="TX">The first argument after <samp class="SANS_TheSansMonoCd_W5Regular_11">find</samp> is the folder whose contents you want to list. This command uses a dot to find files in the current folder, but you could use any relative or absolute path. The <samp class="SANS_TheSansMonoCd_W5Regular_11">-type f</samp> arguments filters the list so it includes only files. (To include only folders, add the <samp class="SANS_TheSansMonoCd_W5Regular_11">-type d</samp> arguments.)</p>

<p class="TX">When you run this command, the names of the many files in BlueLeaks should start rapidly scrolling across your terminal. To make the output more manageable, run the command again, this time redirecting the output into the file <i>../BlueLeaks-filenames.txt</i>:</p>

<pre id="pre-111"><code><b>find . -type f &gt; ../BlueLeaks-filenames.txt</b></code></pre>

<p class="TX">As discussed in <span class="Xref"><a href="chapter3.xhtml">Chapter 3</a></span>, redirection tells your shell to take the output from the left side of the redirection operator (<samp class="SANS_TheSansMonoCd_W5Regular_11">&gt;</samp>) and save it into the file at the path you specify on the right. In this case, the shell sends the list of filenames from the <samp class="SANS_TheSansMonoCd_W5Regular_11">find</samp> command to the <i>BlueLeaks-filenames.txt</i> file on your <i>datasets</i> USB disk, rather than displaying the filenames across your terminal.</p>

<p class="TX">To read through these filenames at your leisure, open <i>BlueLeaks-filenames.txt</i> in VS Code by running this command:</p>

<pre id="pre-112"><code><b>code ../BlueLeaks-filenames.txt</b></code></pre>

<p class="TX"><span role="doc-pagebreak" epub:type="pagebreak" id="pg_100" aria-label=" Page 100. "/>It’s easier to slowly scroll through these files in your text editor, but there are too many to count with the naked eye.</p>

</section>

<section epub:type="division" aria-labelledby="sec13">

<h4 class="H2" id="sec13"><span id="h-93"/><samp class="SANS_Futura_Std_Bold_Condensed_Oblique_BI_11">Count the Files in a Dataset</samp></h4>

<p class="TNI">The <samp class="SANS_TheSansMonoCd_W5Regular_11">wc</samp> command takes some input and tells you how many characters, words, or lines it contains. When used with the <samp class="SANS_TheSansMonoCd_W5Regular_11">-l</samp> (or <samp class="SANS_TheSansMonoCd_W5Regular_11">--lines</samp>) argument, it counts the number of lines. To count the lines in the <i>BlueLeaks-filenames.txt</i> file you created, and by extension count the number of files in BlueLeaks, run the following command:</p>

<pre id="pre-113"><code><b>cat ../BlueLeaks-filenames.txt | wc -l</b></code></pre>

<p class="TX">The <samp class="SANS_TheSansMonoCd_W5Regular_11">cat</samp> command outputs the contents of a file—in this case, <i>BlueLeaks-filenames.txt</i>. Instead of displaying it, the command pipes the output into <samp class="SANS_TheSansMonoCd_W5Regular_11">wc</samp> to count the number of lines that it contains. It should tell you that there are just over <i>one million</i> files in BlueLeaks.</p>

<p class="TX">Another way to get the same result is to run the <samp class="SANS_TheSansMonoCd_W5Regular_11">find</samp> command from the previous section again, and pipe its output into <samp class="SANS_TheSansMonoCd_W5Regular_11">wc</samp>, like this:</p>

<pre id="pre-114"><code><b>find . -type f | wc -l</b></code></pre>

<p class="TX">That command takes longer to run, though, since it searches through the whole dataset again (press <small>CTRL</small><span class="Character_20_style">-C</span> to cancel this command before it finishes).</p>

</section>
</section>

<section epub:type="division" aria-labelledby="sec14">

<h3 class="H1F" id="sec14"><span id="h-94"/><samp class="SANS_Futura_Std_Heavy_B_21">Exercise 4-3: Find Revelations in BlueLeaks with grep</samp></h3>

<p class="TNI">In the summer of 2020, while American society was going through a long-due reckoning about the scale of racist police killings, right-wing media (and police) instead focused on the dangers of the protesters themselves. They lumped the modern civil rights movement into two categories: “Black Lives Matter” and “antifa,” the latter a label used by antifascist activists since the 1930s. The modern American antifa movement grew in response to the 2016 election of Donald Trump and the mainstreaming of white supremacy in the US.</p>

<p class="TX">The <samp class="SANS_TheSansMonoCd_W5Regular_11">grep</samp> command will filter input for keywords, letting you search the content of datasets for newsworthy information. In this exercise, you’ll use <samp class="SANS_TheSansMonoCd_W5Regular_11">grep</samp> to find out what police had to say about antifa during the protests.</p>

<section epub:type="division" aria-labelledby="sec15">

<h4 class="H2" id="sec15"><span id="h-95"/><samp class="SANS_Futura_Std_Bold_Condensed_Oblique_BI_11">Filter for Documents Mentioning Antifa</samp></h4>

<p class="TNI">You’ll start by grepping your list of filenames to find any that include the word <i>antifa</i>. From the <i>BlueLeaks-extracted</i> folder, search the <i>BlueLeaks-filenames.txt</i> file that you created in Exercise 4-2 by running the following command:</p>

<pre id="pre-115"><code><b>cat ../BlueLeaks-filenames.txt | grep antifa</b></code></pre>

<p class="TX"><span role="doc-pagebreak" epub:type="pagebreak" id="pg_101" aria-label=" Page 101. "/>This command pipes the output of <samp class="SANS_TheSansMonoCd_W5Regular_11">cat ../BlueLeaks-filenames.txt</samp>, which is a list of a million filenames, into <samp class="SANS_TheSansMonoCd_W5Regular_11">grep antifa</samp>. This should filter the huge list of filenames to show you only those that include the word <i>antifa</i>. However, it returns no results.</p>

<p class="TX">Since the <samp class="SANS_TheSansMonoCd_W5Regular_11">grep</samp> command is case sensitive, try again using the <samp class="SANS_TheSansMonoCd_W5Regular_11">-i</samp> (or <samp class="SANS_TheSansMonoCd_W5Regular_11">--ignore-case</samp>) argument:</p>

<pre id="pre-116"><code><b>cat ../BlueLeaks-filenames.txt | grep -i antifa</b></code></pre>

<p class="TX">When I run this command, I get the following output:</p>

<pre id="pre-117"><code>./ociac/files/EBAT1/U-FOUO_CFIX__OCIAC_JRA_DVE Use of Social Media_<b>ANTIFA</b>_ANTI-<b>ANTIFA</b> MOVEMENTS

.pdf

./arictexas/files/DDF/ARIC-LES - Situational Awareness - <b>Antifa</b> Activity.pdf

./arictexas/files/DDF/SWTFC-LES - Situational Awareness - <b>ANTIFA</b> Event Notification.pdf

./arictexas/files/DPI/ARIC-LES - Situational Awareness - <b>Antifa</b> Activity.png

./arictexas/files/DPI/SWTFC-LES - Situational Awareness - <b>ANTIFA</b> Event Notification.png

./dediac/files/DDF/<b>ANTIFA</b> - Fighting in the Streets.pdf

./dediac/files/DDF/<b>ANTIFA</b> Sub Groups and Indicators - LES.pdf

./dediac/files/DDF/FBI_PH_SIR_Tactics_and_Targets_Identified_for_4_November_2017_<b>ANTIFA</b>_Rally_in _Philadelphia_PA-2.pdf

./dediac/files/EBAT1/<b>ANTIFA</b> - Fighting in the Streets.pdf

./dediac/files/EBAT1/<b>ANTIFA</b> Sub Groups and Indicators - LES.pdf

./dediac/files/DPI/<b>ANTIFA</b> - Fighting in the Streets.png

./dediac/files/DPI/FBI_PH_SIR_Tactics_and_Targets_Identified_for_4_November_2017_<b>ANTIFA</b>_Rally_in _Philadelphia_PA-2.png</code></pre>

<p class="TX">This command returns 12 results, all files that have the term <i>antifa</i> in their filenames. The <samp class="SANS_TheSansMonoCd_W5Regular_11">grep</samp> command might highlight your search terms in each line of output by coloring them differently; I’ve highlighted them here in bold. Open a few of the documents in this list to see what they contain.</p>
<blockquote>

<p class="NOTE"><span class="NoteHead"><samp class="SANS_Dogma_OT_Bold_B_21">NOTE</samp></span></p>
</blockquote>

<p class="NOTE-TXT"><i>You can run BlueLeaks documents through Dangerzone if you like, but the risks are low with this dataset. These documents are now all public, so if any have tracking technology that lets the original file owner know someone is looking at the document, it doesn’t matter much. Given that these are hacked documents from police fusion centers, not attachments on phishing email messages or something similar, they’re also unlikely to be malicious.</i></p>

<p class="TX">I often combine <samp class="SANS_TheSansMonoCd_W5Regular_11">find</samp> and <samp class="SANS_TheSansMonoCd_W5Regular_11">grep</samp> to make lists of filenames and filter those lists down, which allows me to locate files on my computer more quickly and precisely than with my operating system’s graphical file search tools. For example, suppose you’re looking into the <i>azhidta</i> folder for the Arizona High Intensity Drug Trafficking Area site. To quickly find any documents that have the word <i>marijuana</i> in their filename, you could run <samp class="SANS_TheSansMonoCd_W5Regular_11">find azhidta | grep -i marijuana</samp>. To count the number of files with <i>marijuana</i> in the filenames, you could pipe all of that into the <samp class="SANS_TheSansMonoCd_W5Regular_11">wc -l</samp> command.</p>

</section>

<section epub:type="division" aria-labelledby="sec16">

<h4 class="H2" id="sec16"><span id="h-96"/><span role="doc-pagebreak" epub:type="pagebreak" id="pg_102" aria-label=" Page 102. "/><samp class="SANS_Futura_Std_Bold_Condensed_Oblique_BI_11">Filter for Certain Types of Files</samp></h4>

<p class="TNI">In addition to searching for keywords like <i>antifa</i> or <i>marijuana</i>, <samp class="SANS_TheSansMonoCd_W5Regular_11">grep</samp> can help you filter a list of filenames to include only certain file types. Grep for Microsoft Word documents, filenames that end in <i>.docx</i>, by running the following command:</p>

<pre id="pre-118"><code><b>cat ../BlueLeaks-filenames.txt | grep -i .docx</b></code></pre>

<p class="TX">This command uses <samp class="SANS_TheSansMonoCd_W5Regular_11">cat</samp> to display the list of filenames in BlueLeaks, then filters it down for those that contain <i>.docx</i>. You should see thousands of filenames scroll by. To learn exactly how many, run the command again, this time piping the output into <samp class="SANS_TheSansMonoCd_W5Regular_11">wc -l</samp>:</p>

<pre id="pre-119"><code><b>cat ../BlueLeaks-filenames.txt | grep -i .docx | wc -l</b></code></pre>

<p class="TX">The <samp class="SANS_TheSansMonoCd_W5Regular_11">wc</samp> command should tell you that the previous command had 8,861 results.</p>

</section>

<section epub:type="division" aria-labelledby="sec17">

<h4 class="H2" id="sec17"><span id="h-97"/><samp class="SANS_Futura_Std_Bold_Condensed_Oblique_BI_11">Use grep with Regular Expressions</samp></h4>

<p class="TNI">If you scroll through the <i>.docx</i> filenames you just found, you’ll see that a few of them aren’t actually Word documents. For example, the filename <i>./arictexas/files/DDF/2014 Austin City Limits Festival - APD Threat Overview.docx.pdf</i> contains <i>.docx</i> but is actually a PDF.</p>

<p class="TX">When you use <samp class="SANS_TheSansMonoCd_W5Regular_11">grep</samp>, you can pass a regular expression (regex for short) into it as an argument. A <i>regex</i> is a character or sequence of characters that defines a search pattern. For example, the caret character (<samp class="SANS_TheSansMonoCd_W5Regular_11">^</samp>) represents the beginning of a line, and the dollar sign character (<samp class="SANS_TheSansMonoCd_W5Regular_11">$</samp>) represents the end of a line. Grepping for <samp class="SANS_TheSansMonoCd_W5Regular_11">something$</samp> will show you only results that end with <i>something</i>. Grepping for <samp class="SANS_TheSansMonoCd_W5Regular_11">^something</samp> will show you only results that begin with <i>something</i>.</p>

<p class="TX">To search just for filenames that end with <i>.docx</i>, add a dollar sign (<samp class="SANS_TheSansMonoCd_W5Regular_11">$</samp>) to the end of the text you’re grepping for. For example, try running the following command:</p>

<pre id="pre-120"><code><b>cat ../BlueLeaks-filenames.txt | grep -i .docx$ | wc -l</b></code></pre>

<p class="TX">The output should tell you that there are 8,737 results, 124 less than the previous command. That means there are 8,737 Word docs in this dataset.</p>

<p class="TX">Run the following command to find out how many Word docs are in the <i>ncric</i> folder:</p>

<pre id="pre-121"><code><b>cat ../BlueLeaks-filenames.txt | grep ^./ncric/ | grep -i .docx$ | wc -l</b></code></pre>

<p class="TX">The <samp class="SANS_TheSansMonoCd_W5Regular_11">cat</samp> command outputs the list of filenames in BlueLeaks, which is then piped into the first <samp class="SANS_TheSansMonoCd_W5Regular_11">grep</samp> command, which in turn filters your output down to files that begin with <i>./ncric</i>, using <samp class="SANS_TheSansMonoCd_W5Regular_11">^</samp>. Next, that output is piped into the second <samp class="SANS_TheSansMonoCd_W5Regular_11">grep</samp> command, which further filters the output to files that end <span role="doc-pagebreak" epub:type="pagebreak" id="pg_103" aria-label=" Page 103. "/>with <i>.docx</i>, using <samp class="SANS_TheSansMonoCd_W5Regular_11">$</samp>. Finally, the remaining output is piped into the <samp class="SANS_TheSansMonoCd_W5Regular_11">wc -l</samp> command, which tells you how many lines are left. The output of the full command should tell you that there are 600 Word docs in the <i>ncric</i> folder.</p>

<p class="TX">On your own, try using <samp class="SANS_TheSansMonoCd_W5Regular_11">find</samp>, <samp class="SANS_TheSansMonoCd_W5Regular_11">grep</samp>, and <samp class="SANS_TheSansMonoCd_W5Regular_11">wc</samp> to find out how many PDFs (<i>.pdf</i>) and Excel documents (<i>.xlsx</i>) are in the dataset. You can also experiment with other file types.</p>

</section>

<section epub:type="division" aria-labelledby="sec18">

<h4 class="H2" id="sec18"><span id="h-98"/><samp class="SANS_Futura_Std_Bold_Condensed_Oblique_BI_11">Search Files in Bulk with grep</samp></h4>

<p class="TNI">In addition to piping output from other commands into <samp class="SANS_TheSansMonoCd_W5Regular_11">grep</samp>, you can use <samp class="SANS_TheSansMonoCd_W5Regular_11">grep</samp> to search directly within text files by using the following syntax:</p>

<pre id="pre-122"><code><b>grep</b> <b><var>search_term filename</var></b></code></pre>

<p class="TX">For example, Linux comes with a file called <i>/etc/passwd</i>, which includes a list of users on the system. To find just the line about my own user in that file, I can use one of the following commands:</p>

<pre id="pre-123"><code>  grep micah /etc/passwd

  cat /etc/passwd | grep micah</code></pre>

<p class="TX">The <samp class="SANS_TheSansMonoCd_W5Regular_11">grep</samp> command opens the <i>/etc/passwd</i> file and then searches it, while the <samp class="SANS_TheSansMonoCd_W5Regular_11">cat</samp> command opens that file and then pipes its contents into <samp class="SANS_TheSansMonoCd_W5Regular_11">grep</samp>, which searches it. Both of these commands output the following result:</p>

<pre id="pre-124"><code>micah:x:1000:1000:,,,:/home/micah:/bin/bash</code></pre>

<p class="TX">You can use <samp class="SANS_TheSansMonoCd_W5Regular_11">grep</samp> to search multiple files, or even folders full of files, for hits all at once. As noted earlier, to search a folder, you use the <samp class="SANS_TheSansMonoCd_W5Regular_11">-r</samp> (or <samp class="SANS_TheSansMonoCd_W5Regular_11">--recursive</samp>) argument and specify the name of a folder. To specify multiple files at once, use an asterisk (<samp class="SANS_TheSansMonoCd_W5Regular_11">*</samp>) as a wildcard character. For example, you can use <samp class="SANS_TheSansMonoCd_W5Regular_11">*.txt</samp> as the filename to search all text files in your current folder.</p>

<p class="TX">There are CSV spreadsheets in every BlueLeaks folder that contain the contents of the websites’ databases. Now that you’ve grepped for filenames that contain the keyword <i>antifa</i>, use the following command to bulk-search the term <i>Black Lives Matter</i> in the contents of the files, not just in their filenames:</p>

<pre id="pre-125"><code><b>grep -i "black lives matter" */*.csv</b></code></pre>

<p class="TX">The <samp class="SANS_TheSansMonoCd_W5Regular_11">-i</samp> argument in this command makes the search case insensitive. The <samp class="SANS_TheSansMonoCd_W5Regular_11">black lives matter</samp> argument is the search term (in quotation marks, because it has spaces). The <samp class="SANS_TheSansMonoCd_W5Regular_11">*/*.csv</samp> argument is the path to search, which uses two wildcard characters. These arguments tell <samp class="SANS_TheSansMonoCd_W5Regular_11">grep</samp> to open every folder, then each file within those folders that ends in <i>.csv</i>, and search for the <i>black lives matter</i> keyword.</p>

<p class="TX">This command takes some time to run because it’s searching all 158,232 CSV files in BlueLeaks. When it’s finished, it should show you the lines from CSV files that mention <i>black lives matter</i> and tell you in which files <span role="doc-pagebreak" epub:type="pagebreak" id="pg_104" aria-label=" Page 104. "/>it found those lines. For example, here are snippets from a few of the lines of the output from that command:</p>

<pre id="pre-126"><code><b>arictexas/IncidentMap.csv</b>:834,"10/26/16 00:00:00",-9.7735716800000006e+01,3.0267881299999999e+0

1,"TX",,"TLO","An APD Police Explorer received a call from a blocked number in which the caller

identified himself as an activist for <b>Black Lives Matter</b>, and identified the recipient by name,

address, and personal descriptors before calling him a racist for having an interest in a LE

career.  No explicit threats were made during the call<var>...</var>

<b>bostonbric/EmailBuilder.csv</b>:&lt;p&gt;

&lt;strong&gt;BRIC SHIELD Alert: &lt;/strong&gt;To promote public safety and situational awareness for

events taking place in the City of Boston tonight, the BRIC is sharing the information below

regarding planned activities. &lt;/p&gt;<var>...</var><var> </var>&lt;p&gt;&lt;b&gt;<b>Known</b> COB Activities for Tuesday, June 2nd&lt;/b&gt;&lt;/p&gt;

&lt;ul&gt;&lt;li&gt;Violence in Boston Inc &amp; <b>Black Lives Matter</b> Rally and Vigil - 4:45 PM at 624 Blue Hill

Avenue. &lt;/li&gt;&lt;li&gt;Not One More! - 5:00 PM to 8:00 PM. Meeting at Franklin Park Road &amp; Blue Hill

Ave and marching to Franklin Park. &lt;/li&gt;<var>...</var>

<b>chicagoheat/Blog.csv</b>:Media sources report that the online activist group Anonymous, or a group

claiming to be Anonymous, has called for a collective 'Day of Rage' to take place in numerous

cities across the United States on Friday, July 15th. The action has been called in solidarity

with the <b>Black Lives Matter</b> movement in light of the recent controversial officer-involved

shootings that resulted in the deaths of Alton Sterling and Philando Castile. The group that

posted the call for action states that acts of violence or rioting are to be condemned.

<b>ncric/Requests.csv</b>:Organizer of a <b>Black Lives Matter</b> Protest for 06/02.  Currently scheduled

1PM meet time at Sears parking lot of Newpark Mall.  They plan to march to City Hall and then

to Fremont PD.  She has repeated she intends for a peaceful protest.  She further claims she

reached out to City and PD to join the march.  Recent graphics encourage non-descript clothing,

heat resistant gloves, turning off Face Id on iPhone etc.</code></pre>

<p class="TX">The command finds a total of 178 lines in BlueLeaks CSVs that contain the term <i>black lives matter</i>. Each is a potential lead for further investigative research.</p>
<blockquote>

<p class="NOTE"><span class="NoteHead"><samp class="SANS_Dogma_OT_Bold_B_21">NOTE</samp></span></p>
</blockquote>

<p class="NOTE-TXT"><i>The <samp class="SANS_TheSansMonoCd_W5Regular_Italic_I_11">grep</samp> command is a great tool for searching the content of text files, but it doesn’t work with binary files, like Microsoft Office documents or PDFs. To search those in bulk, you’ll need more sophisticated tools, which you’ll learn about in <a href="chapter5.xhtml">Chapter 5</a>.</i></p>

<p class="TX">On your own, try using <samp class="SANS_TheSansMonoCd_W5Regular_11">grep</samp> to filter the list of BlueLeaks filenames for specific words or bulk-search terms within the CSV files. If you find any interesting documents, read them to see if they’re newsworthy. Consider narrowing your searches once you find a lead by looking for other related documents. You might focus on a single fusion center or a topic like antifa that spans different centers. Individual documents may contain law enforcement lingo you can use as search terms for related documents. Take detailed notes on what’s most revealing in each document, then rely on these notes if you decide to write about your findings.</p>

</section>
</section>

<section epub:type="division" aria-labelledby="sec19">

<h3 class="H1" id="sec19"><span id="h-99"/><samp class="SANS_Futura_Std_Bold_B_11">Encrypted Data in the BlueLeaks Dataset</samp></h3>

<p class="TNI">As you dig around in the BlueLeaks dataset, you’ll notice some patterns. Most folders contain many CSVs, as well as.<i>aspx</i> files, the source code of the hacked websites. They also contain <i>files</i> subfolders containing the bulk <span role="doc-pagebreak" epub:type="pagebreak" id="pg_105" aria-label=" Page 105. "/>of the files and folders uploaded to each site, including PDFs and Microsoft Office documents.</p>

<p class="TX">However, one folder, <i>repo</i>, contains just a <i>config</i> file and <i>data</i>, <i>index</i>, <i>keys</i>, <i>locks</i>, and <i>snapshots</i> subfolders. Inside those subfolders are other subfolders and files with apparently random names. There are no documents that can be opened—no spreadsheets or similar files. As you discovered in Exercise 4-2, the <i>repo</i> folder is the largest folder in BlueLeaks, at 46GB. Its timestamps are from June 8, 2020, although the latest timestamps for most of the rest of the dataset are from June 6. Without more information, it’s not clear what these files mean or how to access them.</p>

<p class="TX">When I discover a mystery like this in a dataset, I search the internet. In this case, I searched for the names of the files and folders within the <i>repo</i> folder by entering <i>config data index keys locks snapshots</i> into a search engine, and found documentation for a CLI program called restic. A restic repository, according to the documentation I found at <a href="https://restic.readthedocs.io/en/latest/100_references.html"><i>https://<wbr/>restic<wbr/>.readthedocs<wbr/>.io<wbr/>/en<wbr/>/latest<wbr/>/100<wbr/>_references<wbr/>.html</i></a>, is a folder that holds backup data. Restic repositories contain a <i>config</i> file and folders called <i>data</i>, <i>index</i>, <i>keys</i>, <i>locks</i>, and <i>snapshots</i>, as shown in <a href="#fig4-2">Figure 4-2</a>.</p>
<figure class="IMG"><img class="img100" id="fig4-2" src="Images/Figure4-2.png" alt="Documentation for the CLI program restic. This describes the “Repository Layout” of a restic repository, which has the same folder names as in the repo folder." width="696" height="500"/>

<figcaption><p class="CAP"><samp class="SANS_Futura_Std_Book_Oblique_I_11">Figure 4-2: The layout of a restic respository</samp></p></figcaption>

</figure>

<p class="TX">This suggests that the <i>repo</i> folder in BlueLeaks contains backup data in restic format. To find out what’s inside this backup, I installed the <samp class="SANS_TheSansMonoCd_W5Regular_11">restic</samp> package. Users of Linux or Windows with WSL can install <samp class="SANS_TheSansMonoCd_W5Regular_11">restic</samp> using apt:</p>

<pre id="pre-127"><code><b>sudo apt install restic</b></code></pre>

<p class="TX"><span role="doc-pagebreak" epub:type="pagebreak" id="pg_106" aria-label=" Page 106. "/>Mac users can install <samp class="SANS_TheSansMonoCd_W5Regular_11">restic</samp> from Homebrew with the following command:</p>

<pre id="pre-128"><code><b>brew install restic</b></code></pre>

<p class="TX">I ran <samp class="SANS_TheSansMonoCd_W5Regular_11">restic --help</samp> and found that I could view the snapshots in a repository with the <samp class="SANS_TheSansMonoCd_W5Regular_11">restic snapshots</samp> command, which I then used to try to view the snapshots in the <i>repo</i> folder like so:</p>

<pre id="pre-129"><code>restic snapshots --repo repo/</code></pre>

<p class="TX">I was then confronted with a password prompt:</p>

<pre id="pre-130"><code>enter password for repository:</code></pre>

<p class="TX">This prompt indicates that the backup is encrypted. The only way to proceed is to guess the password, which I haven’t been able to do.</p>

<p class="TX">While a 46GB folder full of encrypted data in a public leak is rare, it’s not uncommon to stumble upon other encrypted files in datasets like Office documents or ZIP files. I can’t help but imagine that the most interesting details in any dataset might be the encrypted parts. Password-cracking is outside the scope of this book, but if you can figure out the password for <i>repo</i>, please let me know.</p>

</section>

<section epub:type="division" aria-labelledby="sec20">

<h3 class="H1" id="sec20"><span id="h-100"/><samp class="SANS_Futura_Std_Bold_B_11">Data Analysis with Servers in the Cloud</samp></h3>

<p class="TNI">So far, you’ve used the CLI <i>locally</i> on your own computer, but you can also use it <i>remotely</i> via servers to which you connect through a cloud network. DigitalOcean, AWS, Microsoft Azure, and countless other cloud hosting companies rent virtual private servers (VPSes) to the public, usually for a few dollars a month or a few cents an hour. All the command line skills you’ve learned so far apply to remote servers, too.</p>

<p class="TX">There are many advantages to working with massive datasets in the cloud:</p>
<ul class="BL">

<li class="BL">Instead of dealing with USB hard disks, you can attach virtual hard disks to your virtual servers, increasing their size if you’re running low on disk space.</li>
<li class="BL">VPS bandwidth is generally much better than residential or commercial internet service, speeding up large dataset downloads.</li>
<li class="BL">You can also pay for more powerful VPSes for scripts that require significant computational resources, so they no longer take hours or days to finish running.</li>
<li class="BL">Rather than being forced to wait while a script runs on your local machine, you can do whatever you want on your computer, even suspending it or shutting it down, while your remote server is crunching data.</li>
<li class="BL"><span class="listbulletlast_Index-Link">If your source has the required technical skills, you can ask them to upload data to a VPS with a large hard disk, as discussed in</span> <span class="listbulletlast_Xref"><a href="chapter2.xhtml">Chapter 2</a></span><span class="listbulletlast_Index-Link">.</span> <span role="doc-pagebreak" epub:type="pagebreak" id="pg_107" aria-label=" Page 107. "/><span class="listbulletlast_Index-Link">They can even do this anonymously using Tor. You can then download the dataset or choose to analyze it remotely on the VPS.</span></li>
</ul>

<p class="Warning"><span class="NoteHead"><samp class="SANS_Dogma_OT_Bold_B_21">WARNING</samp></span></p>

<p class="NOTE-TXT"><i>Avoid working on cloud servers with high- or medium-sensitivity datasets. The cloud hosting provider has total access over your VPS and the data on it and can even give copies of that data to law enforcement or other parties in response to legal requests.</i></p>

<p class="TX">This section will go into more detail on <i>SSH (Secure Shell)</i> software (introduced in <span class="Xref"><a href="chapter2.xhtml">Chapter 2</a></span>), which allows you to securely get a shell on a VPS, as well as two tools that are essential for working remotely on the command line: text-based window managers and CLI text editors. This should prepare you to set up a VPS in the next exercise.</p>

<p class="TX">The SSH protocol is a method for securely logging in to another computer remotely. You can connect to a VPS remotely by running the <samp class="SANS_TheSansMonoCd_W5Regular_11">ssh</samp> command with a username and the IP address or domain name of the server to which you want to connect. For example, to log in as the root user to the server with the hostname <i>example.com</i>, you run:</p>

<pre id="pre-131"><code><b>ssh root@example.com</b></code></pre>

<p class="TX">You then need to <i>authenticate</i> to the server, or prove that you have permission to log in, by typing the user password or using <i>SSH keys</i>. Similar to PGP keys (discussed in <span class="Xref"><a href="chapter2.xhtml">Chapter 2</a></span>), generating an SSH key on your computer gives you two files: a public key and a secret key. Once you put your public key on the remote server, only people with your secret key on their computer (hopefully just you) can remotely log in to that server using SSH. If someone spies on your internet, they can’t see anything you’re doing in your SSH session—they’ll just see garbled encrypted data. Every SSH key also has a <i>fingerprint</i>, a unique string of characters that identifies that specific key. SSH keys are more secure than passwords, so cloud providers often require that you use them. Once you SSH into a remote server, you’ll be dropped into a shell just like the one on your own computer, but running on a computer across the internet.</p>

<p class="TX">A <i>text-based window manager</i> is software that lets you open and switch between separate shells in the same terminal window, all in the same SSH session. Text-based window managers also allow you to keep programs running in the background even if you disconnect from SSH, by maintaining an active shell session on your VPS. This protects your work if, for example, your laptop dies, you lose internet access, or you close your terminal window by mistake.</p>

<p class="TX">For example, say you want to download BlueLeaks on your VPS and then unzip it with a <samp class="SANS_TheSansMonoCd_W5Regular_11">for</samp> loop. If you close your terminal window before the loop is done, you’ll quit the remote shell, which will close the <samp class="SANS_TheSansMonoCd_W5Regular_11">unzip</samp> program, and your remote work will stop. However, if you SSH to your VPS, connect to a window manager session, and then start unzipping BlueLeaks files, you can safely close the terminal window without stopping your work. If you open a new terminal later, SSH back into your server, and open your window manager again, your previous session with all your running <span role="doc-pagebreak" epub:type="pagebreak" id="pg_108" aria-label=" Page 108. "/>programs should reappear. In the upcoming exercise, you’ll use the Byobu window manager, which comes with Ubuntu.</p>

<p class="TX">When you SSH into a remote server, you don’t have easy access to a graphical text editor like VS Code. To edit files—to modify a shell script, for example—you’ll need to use a CLI text editor instead. Two popular CLI text editors are nano and vim. The nano text editor is relatively easy to use but doesn’t have advanced features, while vim is more powerful but has a steeper learning curve. For simplicity’s sake, in the following exercise you’ll use nano.</p>
<blockquote>

<p class="NOTE"><span class="NoteHead"><samp class="SANS_Dogma_OT_Bold_B_21">NOTE</samp></span></p>
</blockquote>

<p class="NOTE-TXT"><i>Technically, you can use VS Code to edit files remotely over SSH, but there are some limitations. See</i> <a href="https://code.visualstudio.com/docs/remote/ssh"><span class="note_LinkURL_Italic">https://<wbr/>code<wbr/>.visualstudio<wbr/>.com<wbr/>/docs<wbr/>/remote<wbr/>/ssh</span></a> <i>for more information on VS Code’s support for editing files over SSH.</i></p>

</section>

<section epub:type="division" aria-labelledby="sec21">

<h3 class="H1F" id="sec21"><span id="h-101"/><samp class="SANS_Futura_Std_Heavy_B_21">Exercise 4-4: Set Up a VPS</samp></h3>

<p class="TNI">In this exercise, you’ll create an account on a cloud hosting provider, generate an SSH key, create a VPS on your cloud provider, SSH into it, start a Byobu session, and install updates. To follow along you’ll need to spend a small amount of money. I provide detailed instructions for using DigitalOcean in this exercise, but use whatever cloud hosting provider you prefer, keeping in mind that the initial steps will likely be slightly different.</p>

<p class="TX">Go to <a href="https://www.digitalocean.com"><i>https://<wbr/>www<wbr/>.digitalocean<wbr/>.com</i></a> and create an account, providing a credit card number while signing up. Use a strong password, store it in your password manager, and turn on two-factor authentication.</p>

<section epub:type="division" aria-labelledby="sec22">

<h4 class="H2" id="sec22"><span id="h-102"/><samp class="SANS_Futura_Std_Bold_Condensed_Oblique_BI_11">Generate an SSH Key</samp></h4>

<p class="TNI">To generate an SSH key, open a terminal on your local computer (if you’re using Windows, use a WSL terminal) and run:</p>

<pre id="pre-132"><code><b>ssh-keygen -t ed25519</b></code></pre>

<p class="TX">The <samp class="SANS_TheSansMonoCd_W5Regular_11">ssh-keygen</samp> command generates an SSH key, while the options specify the type of encryption key you want to generate—in this case, <samp class="SANS_TheSansMonoCd_W5Regular_11">ed25519</samp>, which uses modern elliptic curve encryption and is the most secure option.</p>

<p class="TX">After you run this command, the program will ask you a few questions, starting with where you want to save your key. For example, I get the following output on my Mac:</p>

<pre id="pre-133"><code>Generating public/private ed25519 key pair.

Enter file in which to save the key (/Users/micah/.ssh/id_ed25519):</code></pre>

<p class="TX">Press <small>ENTER</small> to use the default location for the key, <i>~/.ssh/id_ed25519</i>. Next, the program should ask you for a passphrase:</p>

<pre id="pre-134"><code>Enter passphrase (empty for no passphrase):</code></pre>

<p class="TX">I recommend generating a random passphrase in your password manager, saving it as <i>SSH key passphrase</i>, then copying and pasting the passphrase <span role="doc-pagebreak" epub:type="pagebreak" id="pg_109" aria-label=" Page 109. "/>into your terminal. After pressing <small>ENTER</small>, re-enter your passphrase and press <small>ENTER</small> again.</p>

<p class="TX">When you’re done, the <samp class="SANS_TheSansMonoCd_W5Regular_11">ssh-keygen</samp> command should have created two new files: your SSH secret key in <i>~/.ssh/id_ed25519</i> and your SSH public key in <i>~/.ssh/id_ed25519.pub</i>.</p>
<blockquote>

<p class="NOTE"><span class="NoteHead"><samp class="SANS_Dogma_OT_Bold_B_21">NOTE</samp></span></p>
</blockquote>

<p class="NOTE-TXT"><i>If you’re using Windows and prefer to SSH from PowerShell, you can install the OpenSSH client directly in Windows. Open a PowerShell window as an administrator and run</i> <samp class="SANS_TheSansMonoCd_W7Bold_Italic_BI_11">Add-WindowsCapability -Online -Name OpenSSH.Client~~~~0.0.1.0</samp> <i>to enable using the ssh command from PowerShell.</i></p>

</section>

<section epub:type="division" aria-labelledby="sec23">

<h4 class="H2" id="sec23"><span id="h-103"/><samp class="SANS_Futura_Std_Bold_Condensed_Oblique_BI_11">Add Your Public Key to the Cloud Provider</samp></h4>

<p class="TNI">Next, add your public key to your new DigitalOcean account. After logging in to the web console, go to the Settings page and switch to the Security tab. Click <b>Add SSH Key</b>, then copy and paste your SSH public key into the form.</p>

<p class="TX">Back in your terminal, display the content of your public key by running this command:</p>

<pre id="pre-135"><code><b>cat ~/.ssh/id_ed25519.pub</b></code></pre>

<p class="TX">Here’s the output I get:</p>

<pre id="pre-136"><code>ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAILxYgUq1ePSRSv7LTITG5hecwNBQzs3EZmo4PRzsV4yT micah@trapdoor

.local</code></pre>

<p class="TX">Your output should look similar, with the last word being your username and the hostname of your own computer. Copy this whole string, starting with <samp class="SANS_TheSansMonoCd_W5Regular_11">ssh-ed25519</samp>, and paste it into DigitalOcean, then give it a name, as shown in <a href="#fig4-3">Figure 4-3</a>.</p>
<figure class="IMG"><img class="img80" id="fig4-3" src="Images/Figure4-3.png" alt="A screenshot of the DigitalOcean console, where you can copy and paste the SSH public key to add it to your account." width="526" height="403"/>

<figcaption><p class="CAP"><samp class="SANS_Futura_Std_Book_Oblique_I_11">Figure 4-3: The form for adding a new SSH key to a DigitalOcean account</samp></p></figcaption>

</figure>

<p class="TX"><span role="doc-pagebreak" epub:type="pagebreak" id="pg_110" aria-label=" Page 110. "/>Name your SSH keys after the computer on which you generated them, since they’re allowing this specific computer to access remote computers. For example, I’ve called my key <i>trapdoor</i>, the name of my Mac.</p>

</section>

<section epub:type="division" aria-labelledby="sec24">

<h4 class="H2" id="sec24"><span id="h-104"/><samp class="SANS_Futura_Std_Bold_Condensed_Oblique_BI_11">Create a VPS</samp></h4>

<p class="TNI">Now that DigitalOcean has your SSH public key, you can create a new VPS. Click <b>Create</b> at the top of the DigitalOcean console and follow the instructions to create a new <i>droplet</i>, DigitalOcean’s term for a VPS. Choose the following settings for your VPS:</p>
<ol class="NL">

<li class="ListNumber">For Choose an Image, pick <b>Ubuntu</b>.</li>
<li class="ListNumber">For Choose a Plan, pick <b>Shared CPU</b><span class="MenuArrow">▸</span><b>Basic</b> and choose how much memory, CPU power, hard disk space, and internet bandwidth you want. Less powerful machines are cheaper; more powerful ones are more expensive. For this exercise, choose a relatively cheap option like 1GB of RAM, 1 CPU, 25GB of disk space, and 1TB of bandwidth for $7 per month.</li>
<li class="ListNumber">For Add Block Storage, you can choose to attach an additional hard disk to your droplet. You don’t need to do this now, but in the future, to work with a large dataset like BlueLeaks, you can add more disk space.</li>
<li class="ListNumber">For Choose a Datacenter Region, choose the host city for your VPS. File transfers between your computer and your server will be fastest if you choose a nearby location, but feel free to create your VPS anywhere you’d like.</li>
<li class="ListNumber">For Authentication, choose <b>SSH Keys</b> and select the SSH key that you just added to your DigitalOcean account.</li>
<li class="ListNumber">For Select Additional Options, check the box beside Monitoring to see statistics about how much memory and processor power the VPS is using over time from the DigitalOcean console.</li>
<li class="ListNumber">For Finalize and Create, choose one droplet and give it the hostname <i>test-vps</i>.</li>
</ol>

<p class="TX">Click <b>Create Droplet</b> and wait a minute or two for DigitalOcean to provision your new VPS, then find its IP address. <a href="#fig4-4">Figure 4-4</a> shows the Droplets page of my DigitalOcean account with my new server’s IP address, 178.128.22.151.</p>
<figure class="IMG"><img class="img100" id="fig4-4" src="Images/Figure4-4.png" alt="Screenshot from the DigitalOcean console that lists my VPS and its IP address." width="695" height="130"/>

<figcaption><p class="CAP"><samp class="SANS_Futura_Std_Book_Oblique_I_11">Figure 4-4: My test-vps IP address</samp></p></figcaption>

</figure>

<p class="TX">Click the IP address to copy it to your clipboard.</p>

</section>

<section epub:type="division" aria-labelledby="sec25">

<h4 class="H2" id="sec25"><span id="h-105"/><span role="doc-pagebreak" epub:type="pagebreak" id="pg_111" aria-label=" Page 111. "/><samp class="SANS_Futura_Std_Bold_Condensed_Oblique_BI_11">SSH into Your Server</samp></h4>

<p class="TNI">Run the following command to SSH into your server:</p>

<pre id="pre-137"><code><b>ssh </b><b><var>username@hostname</var></b></code></pre>

<p class="BodyContinued">Here, <samp class="SANS_TheSansMonoCd_W5Regular_Italic_I_11">username</samp> is the user you want to connect to on the remote server, and <samp class="SANS_TheSansMonoCd_W5Regular_Italic_I_11">hostname</samp> is either the hostname or IP address of the remote server. With DigitalOcean, the username is <samp class="SANS_TheSansMonoCd_W5Regular_11">root</samp> and the hostname is the IP address of your server.</p>

<p class="TX">Here’s what it looks like when I SSH into my server for the first time:</p>

<pre id="pre-138"><code>micah@trapdoor ~ % <b>ssh root@178.128.22.151</b>

The authenticity of host '178.128.22.151 (178.128.22.151)' can't be established.

ED25519 key fingerprint is SHA256:062oSOXq+G1sGLIzoQdFnQvJE/BU8GLLWnNr5WUOmAs.

This key is not known by any other names

Are you sure you want to continue connecting (yes/no/[fingerprint])?</code></pre>

<p class="TX">A remote server has its own SSH key, a <i>server key.</i> This output shows you the server key’s fingerprint and asks whether you want to trust it. If you enter <samp class="SANS_TheSansMonoCd_W5Regular_11">yes</samp>, your SSH software will store this fingerprint in the <i>~/.ssh/known_hosts</i> file containing all the fingerprints for the SSH servers to which you’ve connected in the past, so that when you SSH into your server in the future, it shouldn’t prompt you again. You can also enter <samp class="SANS_TheSansMonoCd_W5Regular_11">no</samp> to cancel, or copy and paste the fingerprint of the server key that you’re expecting.</p>
<blockquote>

<p class="NOTE"><span class="NoteHead"><samp class="SANS_Dogma_OT_Bold_B_21">NOTE</samp></span></p>
</blockquote>

<p class="NOTE-TXT"><i>If you SSH into a server and the fingerprint isn’t what your software expects it to be, SSH will show you a warning message, which could mean that the server key has changed or that your SSH connection is being attacked. This authentication scheme is known as</i> <span class="note_Italic">trust on first use (TOFU)</span><i>: you trust the first fingerprint you see and deny all other fingerprints for that server in the future.</i></p>

<p class="TX">Enter <samp class="SANS_TheSansMonoCd_W7Bold_B_11">yes</samp> and press <small>ENTER</small> to continue. You should be dropped into a root shell on your remote server:</p>

<pre id="pre-139"><code>root@test-vps:~#</code></pre>

<p class="TX">Since you provided DigitalOcean with your SSH public key, you don’t need to enter a password to log in. If anyone else tries SSHing to your server, they’ll get the <samp class="SANS_TheSansMonoCd_W5Regular_11">Permission denied (publickey)</samp> error.</p>

<p class="TX">Take a look around your new cloud-based system. Run <samp class="SANS_TheSansMonoCd_W7Bold_B_11">ls</samp> to list files, <samp class="SANS_TheSansMonoCd_W7Bold_B_11">ls -al</samp> to see hidden files, and <samp class="SANS_TheSansMonoCd_W7Bold_B_11">cd</samp> to change to folders.</p>

</section>

<section epub:type="division" aria-labelledby="sec26">

<h4 class="H2" id="sec26"><span id="h-106"/><samp class="SANS_Futura_Std_Bold_Condensed_Oblique_BI_11">Start a Byobu Session</samp></h4>

<p class="TNI">If you used the Ubuntu image to set up your droplet, the Byobu window manager should be installed. Run the <samp class="SANS_TheSansMonoCd_W7Bold_B_11">byobu</samp> command to start a Byobu session. (If you’re using a different operating system, or if for some reason Byobu isn’t installed, you’ll get a <samp class="SANS_TheSansMonoCd_W5Regular_11">Command 'byobu' not found</samp> error message. Run <samp class="SANS_TheSansMonoCd_W7Bold_B_11">apt update</samp>, followed by <samp class="SANS_TheSansMonoCd_W7Bold_B_11">apt install byobu</samp>, to install the program.)</p>

<p class="TX"><span role="doc-pagebreak" epub:type="pagebreak" id="pg_112" aria-label=" Page 112. "/>The <samp class="SANS_TheSansMonoCd_W5Regular_11">byobu</samp> command should drop you into a shell inside of your new session. A line at the bottom of your terminal shows which window you’ve opened, along with information like the date and time. Each Byobu window is like its own separate shell in the same Byobu session, and you can open as many windows as you want.</p>

<p class="TX">To demonstrate how Byobu works, run <samp class="SANS_TheSansMonoCd_W7Bold_B_11">whoami</samp> (which should tell you that you’re the root user) and <samp class="SANS_TheSansMonoCd_W7Bold_B_11">ls -l /</samp> (which should show you a list of files in your server’s root folder). Now press <small>CTRL</small>-A. Byobu will ask you how you want this keyboard command to operate:</p>

<pre id="pre-140"><code>Configure Byobu's ctrl-a behavior...



When you press ctrl-a in Byobu, do you want it to operate in:

    (1) Screen mode (GNU Screen's default escape sequence)

    (2) Emacs mode  (go to beginning of line)



Note that:

  - F12 also operates as an escape in Byobu

  - You can press F9 and choose your escape character

  - You can run 'byobu-ctrl-a' at any time to change your selection



Select [1 or 2]:</code></pre>

<p class="TX">Enter <samp class="SANS_TheSansMonoCd_W7Bold_B_11">1</samp> and press <small>ENTER</small>. This allows you to open a new window in Byobu by pressing <small>CTRL</small>-A, followed by C (for “create”). Try that now to open a new empty shell. Press <small>CTRL</small>-A followed by N (for “next”) to switch back to your first window. To exit a Byobu window, you run the <samp class="SANS_TheSansMonoCd_W5Regular_11">exit</samp> command in that shell.</p>
<blockquote>

<p class="NOTE"><span class="NoteHead"><samp class="SANS_Dogma_OT_Bold_B_21">NOTE</samp></span></p>
</blockquote>

<p class="NOTE-TXT"><i>See</i> <a href="https://www.byobu.org"><span class="note_LinkURL_Italic">https://<wbr/>www<wbr/>.byobu<wbr/>.org</span></a> <i>for more complete documentation about this program, including a video tutorial.</i></p>

<p class="TX">Completely close your terminal window and click through any warnings saying that your active programs will close if you do this. Open a new terminal window and SSH back into your server using the <samp class="SANS_TheSansMonoCd_W7Bold_B_11">ssh</samp> <samp class="SANS_TheSansMonoCd_W7Bold_Italic_BI_11">username@hostname</samp> command. Then run <samp class="SANS_TheSansMonoCd_W7Bold_B_11">byobu</samp> again to attach your previous session. Any programs you run inside this Byobu session won’t quit when you disconnect from SSH.</p>

</section>

<section epub:type="division" aria-labelledby="sec27">

<h4 class="H2" id="sec27"><span id="h-107"/><samp class="SANS_Futura_Std_Bold_Condensed_Oblique_BI_11">Install Updates</samp></h4>

<p class="TNI">Always install updates when you set up a new server to keep it secure. Run the following commands (you don’t need to use <samp class="SANS_TheSansMonoCd_W5Regular_11">sudo</samp>, since you’re the root user):</p>

<pre id="pre-141"><code><b>apt update</b>

<b>apt upgrade</b></code></pre>

<p class="TX">Follow the instructions to finish installing updates.</p>

<p class="TX">If you ever need to reboot your server (such as after updating the Linux kernel), run the <samp class="SANS_TheSansMonoCd_W5Regular_11">reboot</samp> command. You’ll get kicked out of your SSH session, <span role="doc-pagebreak" epub:type="pagebreak" id="pg_113" aria-label=" Page 113. "/>but you should be able to SSH back in shortly when the reboot completes. You can also reboot your VPS from DigitalOcean’s web console—for example, if the entire server crashed and you can’t SSH into it.</p>

</section>
</section>

<section epub:type="division" aria-labelledby="sec28">

<h3 class="H1F" id="sec28"><span id="h-108"/><samp class="SANS_Futura_Std_Heavy_B_21">Exercise 4-5: Explore the Oath Keepers Dataset Remotely</samp></h3>

<p class="TNI">In this exercise, you’ll use BitTorrent to download the Oath Keepers dataset to your cloud server and explore it using the skills you’ve gained in this chapter. You’ll also learn to copy data from your remote server to your laptop using the <samp class="SANS_TheSansMonoCd_W5Regular_11">rsync</samp> command. Finally, you’ll delete your VPS to avoid getting charged for time when you’re not using it.</p>

<p class="TX">The Oath Keepers dataset contains data from the far-right extremist group that participated in the January 6, 2021, US Capitol insurrection. In September 2021, a hacktivist broke into the Oath Keepers servers and made off with the group’s email messages, chat logs, membership lists, and other data, and then leaked it to DDoSecrets. You’ll continue working with this dataset when you learn to analyze email dumps in <span class="Xref"><a href="chapter6.xhtml">Chapter 6</a></span>.</p>
<blockquote>

<p class="NOTE"><span class="NoteHead"><samp class="SANS_Dogma_OT_Bold_B_21">NOTE</samp></span></p>
</blockquote>

<p class="NOTE-TXT"><i>This book works only with the publicly available part of the Oath Keepers dataset, which contains email messages and chat logs. To access content like the Oath Keepers’ donor and membership lists, which contain PII, contact DDoSecrets.</i></p>

<p class="TX">Because your home or office internet connection is likely significantly slower than a cloud provider’s, it’s inefficient to download a dataset to your laptop and then upload it to your remote server. To download the dataset directly to your VPS, you’ll use <samp class="SANS_TheSansMonoCd_W5Regular_11">transmission-cli</samp>, the command line version of the BitTorrent client you used to download BlueLeaks in <span class="Xref"><a href="chapter2.xhtml">Chapter 2</a></span>. In your VPS, run the following command to install <samp class="SANS_TheSansMonoCd_W5Regular_11">transmission-cli</samp>:</p>

<pre id="pre-142"><code><b>apt install transmission-cli</b></code></pre>

<p class="TX">You can now use the <samp class="SANS_TheSansMonoCd_W5Regular_11">transmission-cli</samp> command to download files. You must pass in either the path to a <i>.torrent</i> file or a magnet link as an argument. In this exercise, you’ll use the torrent file available at <a href="https://ddosecrets.com/wiki/Oath_Keepers"><i>https://<wbr/>ddosecrets<wbr/>.com<wbr/>/wiki<wbr/>/Oath<wbr/>_Keepers</i></a>.</p>

<p class="TX">Run the following commands:</p>

<pre id="pre-143"><code><b>mkdir ~/datasets</b>

<b>cd ~/datasets</b></code></pre>

<p class="TX">This creates a new folder called <i>datasets</i> on your server, then changes to it. Download the torrent file from the link on the DDoSecrets page and load it into your BitTorrent client with the following commands:</p>

<pre id="pre-144"><code><b>wget </b><b>https://ddosecrets.com/images/0/02/Oath_Keepers.torrent</b>

<b>transmission-cli -w . Oath_Keepers.torrent</b></code></pre>

<p class="TX"><span role="doc-pagebreak" epub:type="pagebreak" id="pg_114" aria-label=" Page 114. "/>The <samp class="SANS_TheSansMonoCd_W5Regular_11">wget</samp> command downloads files—in this case, <i>Oath_Keepers.torrent</i>—and saves them in the current folder. The <samp class="SANS_TheSansMonoCd_W5Regular_11">transmission-cli</samp> command downloads the 3.9GB torrent to your server from the BitTorrent swarm and uploads parts of it to other parts of the swarm. The <samp class="SANS_TheSansMonoCd_W5Regular_11">-w .</samp> arguments tell <samp class="SANS_TheSansMonoCd_W5Regular_11">transmission-cli</samp> to download the torrent into the current working folder. (You could change that to <samp class="SANS_TheSansMonoCd_W5Regular_11">-w ~/Downloads</samp>, for example, if you wanted to download it into the <i>~/Downloads</i> folder instead.)</p>
<blockquote>

<p class="NOTE"><span class="NoteHead"><samp class="SANS_Dogma_OT_Bold_B_21">NOTE</samp></span></p>
</blockquote>

<p class="NOTE-TXT"><i>If no torrent file is available for a dataset, you can replace the torrent filename with a magnet link in double quotes as an argument in the <samp class="SANS_TheSansMonoCd_W5Regular_Italic_I_11">transmission-cli</samp> command.</i></p>

<p class="TX">When you’ve finished downloading the torrent, your server will be a seed until you quit the program by pressing <small>CTRL</small>-C. While you’re waiting for the dataset to finish downloading, or if you’ve finished but want to continue seeding the torrent, you can work on your VPS in a separate Byobu shell.</p>

<p class="TX">To check how much free space your server has left, run the following command after the download is complete:</p>

<pre id="pre-145"><code><b>df -h</b></code></pre>

<p class="TX">The <samp class="SANS_TheSansMonoCd_W5Regular_11">df</samp> command tells you how much disk space is free on each connected drive, and the <samp class="SANS_TheSansMonoCd_W5Regular_11">-h</samp> argument displays these numbers in human-readable units. After downloading the Oath Keepers dataset, I got the following output from these commands on my server:</p>

<pre id="pre-146"><code>Filesystem      Size  Used Avail Use% Mounted on

tmpfs            98M 1000K   97M   2% /run

<b>/dev/vda1</b>        <b>25G</b>  <b>5.8G</b>   <b>19G</b>  <b>24% /</b>

tmpfs           486M   80K  486M   1% /dev/shm

tmpfs           5.0M     0  5.0M   0% /run/lock

/dev/vda15      105M  5.3M  100M   5% /boot/efi

tmpfs            98M  4.0K   98M   1% /run/user/0</code></pre>

<p class="BodyContinued">As shown in bold, my root partition mounted on <samp class="SANS_TheSansMonoCd_W5Regular_11">/</samp> has 25GB of space, has used 5.8GB, and has 19GB free.</p>

<p class="TX">Change your working directory to <i>~/datasets/Oath Keepers</i>, remembering to put the filepath in quotes or escape the space in the path. For example, you could run this command from the <i>~/datasets</i> folder:</p>

<pre id="pre-147"><code><b>cd Oath\ Keepers</b></code></pre>

<p class="TX">Run the following command to find that the Oath Keepers dataset takes up 3.9GB of space:</p>

<pre id="pre-148"><code>root@test-vps:~/datasets/Oath Keepers# <b>du -sh --apparent-size .</b>

3.9G    .</code></pre>

<p class="TX"><span role="doc-pagebreak" epub:type="pagebreak" id="pg_115" aria-label=" Page 115. "/>Next, run the <samp class="SANS_TheSansMonoCd_W7Bold_B_11">ls</samp> command to list the files in the <i>Oath Keepers</i> folder:</p>

<pre id="pre-149"><code>root@test-vps:~/datasets/Oath Keepers# <b>ls -lh</b>

total 13M

drwxr-xr-x 2 root root 4.0K Aug  2 23:47 'Oath Keepers.sbd'

-rw-r--r-- 1 root root  12M Aug  2 23:47  messages.json

-rw-r--r-- 1 root root 1.4M Aug  2 23:44  messages_old.json</code></pre>

<p class="TX">The output shows that this folder contains a folder called <i>Oath Keepers.sbd</i>, a 12MB file called <i>messages.json</i>, and a 1.4MB file called <i>messages_old.json</i>. These JSON files are chat logs.</p>

<p class="TX">Switch to the <i>Oath Keepers.sbd</i> folder and run <samp class="SANS_TheSansMonoCd_W7Bold_B_11">ls</samp> again:</p>

<pre id="pre-150"><code>root@test-vps:~/datasets/Oath Keepers# <b>cd Oath\ Keepers.sbd/</b>

root@test-vps:~/datasets/Oath Keepers/Oath Keepers.sbd# <b>ls -lh</b>

total 3.9G

-rw-r--r-- 1 root root 2.2M Aug  2 23:45  Archive

-rw-r--r-- 1 root root  23K Aug  2 23:44 'Saved Correspondence'

-rw-r--r-- 1 root root  25K Aug  2 23:44  Systems

-rw-r--r-- 1 root root 2.8M Aug  2 23:44  ak

<var>--snip--</var></code></pre>

<p class="TX">The output shows that this folder contains 100 files, each representing a different inbox full of email.</p>

<p class="TX">Since you’ll use the Oath Keepers dataset later in the book, next you’ll copy it from your VPS to your <i>datasets</i> USB disk with the <samp class="SANS_TheSansMonoCd_W5Regular_11">rsync</samp> program, which synchronizes local folders and remote folders using SSH.</p>
<blockquote>

<p class="NOTE"><span class="NoteHead"><samp class="SANS_Dogma_OT_Bold_B_21">NOTE</samp></span></p>
</blockquote>

<p class="NOTE-TXT"><i>The</i> <i><samp class="SANS_TheSansMonoCd_W5Regular_Italic_I_11">scp</samp> command (short for “secure copy”) also copies files and folders from your computer to a remote server, or vice versa, over SSH. The BlueLeaks hacker likely used a Windows version of <samp class="SANS_TheSansMonoCd_W5Regular_Italic_I_11">scp</samp>,</i> <span class="note_Italic">pscp64.exe</span><i>, to exfiltrate data from the hacked police web servers to a server they controlled. For very large folders, however, <samp class="SANS_TheSansMonoCd_W5Regular_Italic_I_11">rsync</samp> is often a better choice than <samp class="SANS_TheSansMonoCd_W5Regular_Italic_I_11">scp</samp>, since if it fails halfway through, you can rerun the command and it will start where it left off.</i></p>

<p class="TX">Open a terminal running locally on your computer (not SSHed to your VPS) and run <samp class="SANS_TheSansMonoCd_W7Bold_B_11">which rsync</samp> to check whether <samp class="SANS_TheSansMonoCd_W5Regular_11">rsync</samp> is installed. If so, the command returns the path to the program, something like <i>/usr/bin/rsync</i>. If not, you’ll see no output. Windows with WSL and Linux users can install <samp class="SANS_TheSansMonoCd_W5Regular_11">rsync</samp> with the following command:</p>

<pre id="pre-151"><code><b>sudo apt install rsync</b></code></pre>

<p class="TX">macOS users can install it with the following command:</p>

<pre id="pre-152"><code><b>brew install rsync</b></code></pre>

<p class="TX"><span role="doc-pagebreak" epub:type="pagebreak" id="pg_116" aria-label=" Page 116. "/>To copy a file from a remote server to your local computer, run the following command:</p>

<pre id="pre-153"><code><b>rsync -av --progress</b> <b><var>remote_user@remote_host:remote_path local_path</var></b></code></pre>

<p class="TX">The <samp class="SANS_TheSansMonoCd_W5Regular_11">-av</samp> argument is a combination of <samp class="SANS_TheSansMonoCd_W5Regular_11">-a</samp> (short for <samp class="SANS_TheSansMonoCd_W5Regular_11">--archive</samp>), which preserves the file permissions in the copy you’re making, and <samp class="SANS_TheSansMonoCd_W5Regular_11">-v</samp> (short for - -<samp class="SANS_TheSansMonoCd_W5Regular_11">verbose</samp>), which outputs each filename as it copies the files. The <samp class="SANS_TheSansMonoCd_W5Regular_11">--progress</samp> argument displays progress bars for each file as it’s copying. The <samp class="SANS_TheSansMonoCd_W5Regular_11">rsync</samp> command will SSH into the server <samp class="SANS_TheSansMonoCd_W5Regular_Italic_I_11">remote_host</samp> with the username <samp class="SANS_TheSansMonoCd_W5Regular_Italic_I_11">remote_user</samp>. If it authenticates successfully, it will download the file or folder at <samp class="SANS_TheSansMonoCd_W5Regular_Italic_I_11">remote_path</samp> and save it on your computer at <samp class="SANS_TheSansMonoCd_W5Regular_Italic_I_11">local_path</samp>.</p>

<p class="TX">For example, here’s how I’d download the Oath Keepers dataset from my VPS to my <i>datasets</i> USB disk:</p>

<pre id="pre-154"><code>rsync -av --progress root@178.128.22.151:"~/datasets/Oath\ Keepers" /Volumes/datasets/</code></pre>

<p class="TX">In this case, <samp class="SANS_TheSansMonoCd_W5Regular_11">root@178.128.22.151:"~/datasets/Oath\ Keepers"</samp> is the <samp class="SANS_TheSansMonoCd_W5Regular_Italic_I_11">remote _user</samp><samp class="SANS_TheSansMonoCd_W5Regular_11">@</samp><samp class="SANS_TheSansMonoCd_W5Regular_Italic_I_11">remote_host</samp><samp class="SANS_TheSansMonoCd_W5Regular_11">:</samp><samp class="SANS_TheSansMonoCd_W5Regular_Italic_I_11">remote_path</samp> argument, since the <i>Oath Keepers</i> folder is in the <i>datasets</i> folder in the root user’s home folder on my VPS. I put the remote path in quotes and escape the space in the filename, telling my local shell that <samp class="SANS_TheSansMonoCd_W5Regular_11">root@178.128.22.151:"~/datasets/Oath\ Keepers"</samp> is a single argument. The <samp class="SANS_TheSansMonoCd_W5Regular_Italic_I_11">local_path</samp> argument is the <samp class="SANS_TheSansMonoCd_W5Regular_11">/media/micah/datasets/</samp> path to my <i>datasets</i> USB disk.</p>
<blockquote>

<p class="NOTE"><span class="NoteHead"><samp class="SANS_Dogma_OT_Bold_B_21">NOTE</samp></span></p>
</blockquote>

<p class="NOTE-TXT"><i>You can also use <samp class="mono">rsync</samp> to upload files from your computer to a remote server—just put the <samp class="mono">local_path</samp> argument first, as the source, and put the <samp class="mono">remote_user@remote_host:remote_path</samp> argument second, as the destination.</i></p>

<p class="TX">Here’s the output I get when I run this command:</p>

<pre id="pre-155"><code>receiving incremental file list

Oath Keepers/

Oath Keepers/messages.json

     12,109,624 100%    1.89MB/s    0:00:06 (xfr#1, to-chk=102/104)

Oath Keepers/messages_old.json

      1,393,296 100%    1.65MB/s    0:00:00 (xfr#2, to-chk=101/104)

Oath Keepers/Oath Keepers.sbd/

Oath Keepers/Oath Keepers.sbd/Archive

      2,288,916 100%   	1.81MB/s    0:00:01 (xfr#3, to-chk=99/104)

Oath Keepers/Oath Keepers.sbd/Saved Correspondence

        23,192 100%   111.02kB/s    0:00:00 (xfr#4, to-chk=98/104)

Oath Keepers/Oath Keepers.sbd/Systems

        25,382 100%   121.51kB/s    0:00:00 (xfr#5, to-chk=97/104)

Oath Keepers/Oath Keepers.sbd/ak

      2,921,276 100%    4.33MB/s    0:00:00 (xfr#6, to-chk=96/104)

Oath Keepers/Oath Keepers.sbd/al

     41,772,536 100%    6.57MB/s    0:00:06 (xfr#7, to-chk=95/104)

<var>--snip--</var></code></pre>

<p class="TX"><span role="doc-pagebreak" epub:type="pagebreak" id="pg_117" aria-label=" Page 117. "/>The <samp class="SANS_TheSansMonoCd_W5Regular_11">rsync</samp> command copies every file, one at a time, from the remote folder to the local folder over SSH, displaying a line after each filename that shows the file’s download speed and progress. You can press <small>CTRL</small>-C to cancel the command, then rerun that command, and <samp class="SANS_TheSansMonoCd_W5Regular_11">rsync</samp> should continue where it left off. This is especially useful when you need to copy gigabytes or terabytes of data spread across millions of files—if the file transfer fails, you can pick up where you left off.</p>

<p class="TX">Once <samp class="SANS_TheSansMonoCd_W5Regular_11">rsync</samp> finishes running, you’ll have downloaded a local copy of the Oath Keepers dataset to your <i>datasets</i> USB disk. You’ll use this dataset again in <span class="Xref"><a href="chapter6.xhtml">Chapter 6</a></span>, when you learn techniques for researching email dumps.</p>

<p class="Warning"><span class="NoteHead"><samp class="SANS_Dogma_OT_Bold_B_21">WARNING</samp></span></p>

<p class="NOTE-TXT"><i>Destroy your VPS from the DigitalOcean web console when you’re done with it. Using it for an hour or two should cost you only a few cents, but the bill can get expensive if you don’t pay attention.</i></p>

</section>

<section epub:type="division" aria-labelledby="sec29">

<h3 class="H1" id="sec29"><span id="h-109"/><samp class="SANS_Futura_Std_Bold_B_11">Summary</samp></h3>

<p class="TNI">In this chapter, you’ve put your command line skills to the test, unzipping the compressed files in BlueLeaks and learning to quickly search and sort datasets. You also worked with servers in the cloud and briefly explored the Oath Keepers dataset.</p>

<p class="TX">In the next chapter, you’ll continue expanding your command line skills and learn two new tools: Docker, which allows you to run Linux software on any operating system, and Aleph, which allows you to search datasets by keyword.</p>

</section>
</section>

</div></body></html>