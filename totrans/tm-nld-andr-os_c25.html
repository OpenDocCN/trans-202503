<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" epub:prefix="index: http://www.index.com/" lang="en" xml:lang="en">
<head>
<title>Chapter 25: Lean Code</title>
<link href="NSTemplate_v1.css" rel="stylesheet" type="text/css"/>
<meta content="urn:uuid:c2f206e1-36e8-4f89-b533-508263d6ec16" name="Adept.expected.resource"/>
</head>
<body epub:type="bodymatter chapter">
<section>
<header>
<h1 class="chapter">
<span class="ChapterNumber"><span epub:type="pagebreak" id="Page_245" title="245"/>25</span><br/>
<span class="ChapterTitle">Lean Code</span></h1>
</header>
<blockquote class="Epigraph" epub:type="epigraph">
<p class="Epigraph">Once you’ve written it all, you can’t go back and re-optimize.</p>
<p class="EpigraphSource">—Bob Lee</p>
</blockquote>
<p class="ChapterIntro"><span class="dropCap">O</span>ne of the aspects that defined Android from the very early days was that it was incredibly optimized so that it would work on the very limited mobile devices of that time. The performance mindset of the team affected everything from the APIs (many of which were written in a specific way so as to avoid allocating memory) to the coding recommendations given to external developers. It was all about writing optimal code because every cycle, every kilobyte, takes away resources or spends battery life that is needed elsewhere.</p>
<p>At least part of this performance-first focus can be attributed to the background of the early team members. The engineers that had previously worked at Danger had made their operating system work on devices that were even more limited than Android’s G1. And engineers from PalmSource were also familiar with mobile constraints and realities.</p>
<p>Bob Lee observed, “They [former PalmSource engineers] would say that one of the reasons it failed was that they were just trying to do more than the hardware could handle. Once you’ve written it, you can’t go back and optimize. I just think they were avoiding that same mistake on Android. This was one of the reasons why Dianne [Hackborn] and everyone else were so anal about performance, and micro-optimized a lot of stuff. The phones were so slow back then.</p>
<p>“I remember everybody—me, Dianne, Dan [Bornstein]—would be in this war room, because over the course of a release there’d be all these places <span epub:type="pagebreak" id="Page_246" title="246"/>where people were using too much memory. We didn’t have swap,<sup class="FootnoteReference"><a href="#c25-footnote-1" id="c25-footnoteref-1">1</a></sup> because it didn’t make sense to have swap. Things would run out of memory and crash. It was this kind of heroic session in a war room where we’d just go on for days sometimes, and you would never know when the end was going to be, just trying to stamp out memory problems.</p>
<p>“It was all about allocating memory pages. Dianne, or Brian Swetland, had written these tools to see dirty pages, and which pages were getting touched. We just had to stamp it out. It was a lot of grinding to see which apps were causing the problems and try to pinpoint them.”</p>
<p>Ficus reflected on how his time at Be and Danger impacted his work on Android: “A lot of us came from these embedded systems, this philosophy of extreme frugality when it comes to CPU cycles or memory. I think that’s an interesting lens to look at a lot of the early Android decisions from. I look at a lot of these engineers like they were raised during the Depression and they learned to scrape the bottom of the pot.”</p>
<p>The mindset of the entire platform team was performance-first. This came from a combination of the limited memory on those early devices, along with slower CPUs, the lack of GPU rendering (Android didn’t use a GPU for UI graphics until the Honeycomb release), and Dalvik’s garbage collector (which took time allocating and collecting memory). This attitude continues internally even to this day, even though every device is much bigger and faster. Everything the phone does spends battery power, so optimizing the platform code is still worthwhile. Recommendations for external developers have been relaxed since those early days, but the Android APIs and implementation still reflect the original performance constraints.</p>
</section>
<section class="footnotes">
<aside class="FootnoteEntry"><p><sup class="FootnoteReference"><a href="#c25-footnoteref-1" id="c25-footnote-1">1.</a></sup>  <em>Swap</em> space enables applications to allocate more memory than is physically present. The operating system will “swap” out chunks of memory to disk to handle this larger overall amount, allowing the application to access a much larger memory heap, by handling it through a combination of physical RAM plus disk storage.</p></aside>
</section>
</body>
</html>