<html><head></head><body>
<h2 class="h2" id="ch02"><span epub:type="pagebreak" id="page_23"/><strong><span class="big">2</span><br/>APP INVENTOR AND EVENT-DRIVEN PROGRAMMING</strong></h2>
<div class="imagel"><img alt="Image" src="../images/common.jpg"/></div>
<p class="noindent">App Inventor apps use a model called <em>event-driven programming</em>, where we program behaviors to respond to certain events. An <em>event</em> can be something the user does or something that happens within or to the device.</p>
<p class="indent">As App Inventor programmers, we use <em>event handlers</em> called <code>when</code>…<code>do</code> blocks to tell the app how to respond to an event. For each <code>when</code>…<code>do</code> block, we can include one or more commands for the app to follow in sequence once the event occurs. Those commands include blocks to get and set values as well as <code>call</code> blocks to start built-in <em>methods</em> or our own written <em>procedures</em>, which are a series of defined tasks for the app to execute.</p>
<p class="indent">In fact, you already used event handlers to create the “Hi, World!” app in <a href="ch01.xhtml#ch01">Chapter 1</a>. Let’s review all the blocks you used for “Hi, World!”.</p>
<div class="image"><span epub:type="pagebreak" id="page_24"/><img alt="Image" src="../images/f0024-01.jpg"/></div>
<p class="indent">We can see the app’s three events <span class="ent">➊</span>, which are the two button <em>clicks</em> on <code>SayMessageBtn</code> and <code>SendTextBtn</code> and the <em>touch down</em> event on <code>PhoneNumberPicker1</code>. You used three <code>when</code>…<code>do</code> event handlers <span class="ent">➋</span> to program the actions the app should take in response to those events, such as calling the <code>SpeechRecognizer</code> method to get text from speech, calling the <code>PhoneNumberPicker.Open</code> method to open the phone’s contact list, and setting the <code>Texting</code> component’s required properties before calling the method that sends a text.</p>
<p class="indent">Although the user triggered all the events in “Hi, World!”, that’s not always the case. Some events are caused when something happens to the device. For instance, when a phone receives a call, you can use an event handler to deal with that event. You also can use event handlers to respond to automatic events or events that happen to screens or components in your apps. For instance, you can add blocks to program actions that should occur when the screen of an app first opens.</p>
<p class="indent">We’ll play with several event handlers as we build the next app.</p>
<h3 class="h3" id="ch00lev1sec14"><strong>BUILDING THE “PRACTICE MAKES PERFECT” APP</strong></h3>
<p class="noindent">In this chapter, you’ll create the “Practice Makes Perfect” app, which uses the <code>Clock</code>, <code>Camcorder</code>, and <code>VideoPlayer</code> components to let users repeatedly record videos of themselves practicing speeches or songs and then watch the videos to review their performance. For convenience, we’ll program “Practice Makes Perfect” to automatically open the device’s video camera, getting it ready to record right away. That’s different from many camera apps, which require the user to open the app, switch to video mode, and then record.</p>
<p class="indent">We’ll program six event handlers for “Practice Makes Perfect,” one to direct the action after a timer goes off five seconds after the app opens, another that tells the app what to do after the video camera records, and four that respond to the user’s button clicks.</p>
<p class="indent">Let’s get started! Log into App Inventor following the instructions outlined in “Getting Started with App Inventor” on <a href="intro.xhtml#page_xviii">page xviii</a>. App <span epub:type="pagebreak" id="page_25"/>Inventor should open to the last app you worked on. To start a new app, click <strong>Projects</strong> <span class="ent">▸</span> <strong>Start new project</strong> to open the dialog where you enter the project name, enter <span class="codestrong">PracticeMakesPerfect</span> without any spaces, and click <strong>OK</strong>.</p>
<h4 class="h4" id="ch00lev2sec10"><strong>DECOMPOSING “PRACTICE MAKES PERFECT”</strong></h4>
<p class="noindent">“Practice Makes Perfect” will automatically open the device’s video camera to record a video and then play the video back on the app’s own video player. After that, the app will let users record and view as many additional videos as they want. The app will also display a decorative temporary, or <em>splash</em>, title screen when the user first opens it.</p>
<p class="indent">We can break this action down into four steps:</p>
<ol>
<li><p class="noindent">When a user opens the app, display the splash screen for 5 seconds before displaying the Record button, Watch button, and the VideoPlayer. Open the device’s video recorder so the user can record.</p></li>
<li><p class="noindent">When the user clicks the Record button, open the device’s video camera so the user can record.</p></li>
<li><p class="noindent">Once the user records a video, set the recorded clip to play the next time the app’s VideoPlayer starts.</p></li>
<li><p class="noindent">When the user clicks the Watch button, play the user’s video clip in the app’s VideoPlayer.</p></li>
</ol>
<p class="indent">You’ll need the following components:</p>
<ul>
<li><p class="noindent"><span class="codestrong">Button</span> (2) for the user to click to manually start action</p></li>
<li><p class="noindent"><span class="codestrong">Camcorder</span> to open the app’s video camera</p></li>
<li><p class="noindent"><span class="codestrong">Clock</span> to automatically start the action after a set interval</p></li>
<li><p class="noindent"><span class="codestrong">Image</span> displaying the temporary splash graphic</p></li>
<li><p class="noindent"><span class="codestrong">VerticalScrollArrangement</span> to hold the app’s <code>Button</code> and <code>VideoPlayer</code> components</p></li>
<li><p class="noindent"><span class="codestrong">VideoPlayer</span> to play video clips within the app</p></li>
</ul>
<h4 class="h4" id="ch00lev2sec11"><strong>LAYING OUT “PRACTICE MAKES PERFECT” IN THE DESIGNER</strong></h4>
<p class="noindent">Let’s begin by laying out all the components, keeping in mind that we want the app to start with a separate splash screen and then automatically open the video camera to record the first video clip. We also want to arrange the components so that the app’s easy to use and understand.</p>
<h5 class="h5" id="ch00lev3sec15"><strong>Adding the Components</strong></h5>
<p class="noindent">Go to the Designer window and drag the listed components from their drawers in the Palette pane onto the Viewer pane. From the User Interface drawer, drag an <span class="codestrong">Image</span> and two <span class="codestrong">Button</span> components; from the Layout drawer, <span epub:type="pagebreak" id="page_26"/>drag a <span class="codestrong">VerticalScrollArrangement</span>; from the Media drawer, drag a <span class="codestrong">VideoPlayer</span> and a <span class="codestrong">Camcorder</span> component; and from the Sensors drawer, drag a <span class="codestrong">Clock</span> component. Your screen should now look like <a href="ch02.xhtml#ch2fig1">Figure 2-1</a>.</p>
<div class="image" id="ch2fig1"><img alt="Image" src="../images/02fig01.jpg"/></div>
<p class="figcap"><em>Figure 2-1: The screen after you drag the “Practice Makes Perfect” app components into the Viewer pane</em></p>
<p class="indent">In the Viewer pane, all visible components should show on <code>Screen1</code> <span class="ent">➊</span>, and the non-visible components (<code>Camcorder</code> and <code>Clock</code>) should show below the Screen <span class="ent">➋</span>. In the Components pane <span class="ent">➌</span>, you should see a list of all the components you’ve dragged onto the Viewer pane.</p>
<h5 class="h5" id="ch00lev3sec16"><strong>Creating a Splash Screen</strong></h5>
<p class="noindent">As mentioned, we’ll display a full-screen introductory graphic that creatively illustrates the app’s name and purpose, but we’ll show it only temporarily to keep it from taking up too much screen space. We’ll use <code>Image1</code> as the splash screen, and we need to adjust several properties to get it to display as desired.</p>
<p class="indent">First, click <span class="codestrong">Image1</span> in the Components pane, and set its height and width to fill the screen by clicking the text boxes under both <strong>Height</strong> and <strong>Width</strong> in the Properties pane. When you click each text box, you should see the dialog shown in <a href="ch02.xhtml#ch2fig2">Figure 2-2</a>.</p>
<div class="image" id="ch2fig2"><span epub:type="pagebreak" id="page_27"/><img alt="Image" src="../images/02fig02.jpg"/></div>
<p class="figcap"><em>Figure 2-2: The Properties dialog that allows you to change a component’s height or width</em></p>
<p class="indent">Click the <strong>Fill parent</strong> radio button and then click <strong>OK</strong>. This will make the height and width of <code>Image1</code> take up the entire height and width of the screen once the picture is uploaded.</p>
<h5 class="h5" id="ch00lev3sec17"><strong>Uploading a Picture</strong></h5>
<p class="noindent">We now need to upload the picture we want to display as <code>Image1</code> on the app screen. To upload a picture, click the text box under <strong>Picture</strong> and click the <strong>Upload File …</strong> button shown on the left in <a href="ch02.xhtml#ch2fig3">Figure 2-3</a>, which should open the dialog shown on the right.</p>
<div class="image" id="ch2fig3"><img alt="Image" src="../images/02fig03.jpg"/></div>
<p class="figcap"><em>Figure 2-3: The Picture and Upload File … dialogs</em></p>
<p class="indent">Click the <strong>Choose File</strong> button. The file manager should open to show the files on your computer and allow you to find the picture you want to upload, as shown in <a href="ch02.xhtml#ch2fig4">Figure 2-4</a>.</p>
<div class="image" id="ch2fig4"><span epub:type="pagebreak" id="page_28"/><img alt="Image" src="../images/02fig04.jpg"/></div>
<p class="figcap"><em>Figure 2-4: The file manager window allows you to select a file from your computer.</em></p>
<p class="indent">Click the image you want to use, click the <strong>Open</strong> button, and then click <strong>OK</strong> on the Upload File … dialog shown on the right in <a href="ch02.xhtml#ch2fig3">Figure 2-3</a>.</p>
<div class="note">
<p class="notet"><span class="noteh1"><strong>NOTE</strong></span></p>
<p class="notep"><em>For some of the apps in this book, I created the decorative images we’re using by searching the web for pictures, saving them, and then adding text to them using a graphics editor. Before saving any images from the web, however, I made sure I had the <span class="roman">license</span>, or right, to use and modify them, and I checked whether the license requires <span class="roman">attribution</span>, which means I’d need to give credit to the original artist when using the pictures. If you use images or other files you find on the web, always make sure that they are labeled as free to use in the way you intend and that you give credit to the creator if directed.</em></p>
</div>
<p class="indent">You should now see the picture on <code>Screen1</code> in the Viewer pane. Its width fills the screen, just as we want, but its height doesn’t because the other visible components are taking up most of the screen’s vertical space. We’ll adjust this later when we make those components invisible.</p>
<p class="indent">You’ll also notice in the Properties pane that, by default, the checkbox under the <code>Image1 Visible</code> property is checked, meaning users should see <code>Image1</code> when the app opens. But because we want <code>Image1</code> to show only temporarily, soon we’ll program the app to change the value of the <code>Image1 Visible</code> property to hide the splash screen when we no longer want it to show.</p>
<p class="indent">Finally, while in the <code>Image1</code> Properties pane, click the checkbox under <span class="codestrong">ScalePicturetoFit</span>. This will distort <code>Image1</code> for now, making it take up even more of the screen width, but later, when <code>Image1</code> is the only visible component on the screen as planned, you’ll see that this is the effect we want.</p>
<h5 class="h5" id="ch00lev3sec18"><span epub:type="pagebreak" id="page_29"/><strong>Creating the Record and Watch Buttons</strong></h5>
<p class="noindent">Next, let’s set the properties for both <code>Button</code> components. To avoid confusion, let’s give each <code>Button</code> a name that describes its function in the app, as we did in <a href="ch01.xhtml#ch01">Chapter 1</a>.</p>
<p class="indent">Click <span class="codestrong">Button1</span> in the Components pane and then click the <strong>Rename</strong> button near the bottom of the pane. Replace <code>Button1</code> with <span class="codestrong">RecordBtn</span> in the <strong>New name:</strong> text box and click <strong>OK</strong>. You should now see <code>RecordBtn</code> in the Components and Properties panes in the Designer window. Follow the same steps to change the name of <code>Button2</code> to <code>WatchBtn</code>.</p>
<h5 class="h5" id="ch00lev3sec19"><strong>Using Images as Buttons</strong></h5>
<p class="noindent">Let’s also change the look of the buttons. For that, we’ll use images with text and icons instead of the default App Inventor buttons. Click the text box under <strong>Image</strong> in the Properties pane for each button. Then upload the picture you want to use by following the steps just described in “Uploading a Picture” on <a href="ch02.xhtml#page_27">page 27</a>.</p>
<p class="indent">Once you upload the button images, be sure to delete the default text that’s displayed on the buttons. To do so, click the text box under <strong>Text</strong> in the Properties pane for each button, delete the existing text, and then remove your cursor from the text box.</p>
<p class="indent">Finally, let’s make each <code>Button</code> component and the <code>VideoPlayer</code> the width of the screen by clicking the text box under <strong>Width</strong> in the Properties pane for each component, clicking the <strong>Fill parent</strong> radio button and then clicking <strong>OK</strong>.</p>
<h5 class="h5" id="ch00lev3sec20"><strong>Grouping Components Vertically</strong></h5>
<p class="noindent">As outlined earlier, step 1 of this app requires the <code>Button</code> components and <code>VideoPlayer</code> to be invisible for 5 seconds after the app opens. We can accomplish this by using the <code>VerticalScrollArrangement</code> component from the Layout drawer. Layout components allow you not only to uniformly align other components but also to combine components so you can program them as a group.</p>
<p class="indent">In this app, we’re grouping all the components we want to hide temporarily when the app opens—<code>RecordBtn</code>, <code>WatchBtn</code>, and <code>VideoPlayer1</code>—inside a <code>VerticalScrollArrangement</code>. We’re using the <code>VerticalScrollArrangement</code> in particular because we want to stack the components on top of each other, and we want to allow users to scroll vertically if necessary to see the videos in <code>VideoPlayer1</code>.</p>
<p class="indent">To group <code>RecordBtn</code>, <code>WatchBtn</code>, and <code>VideoPlayer1</code> inside <code>VerticalScrollArrangement1</code> in that order, click each component in the Viewer pane, and drag it into <strong>VerticalScrollArrangement1</strong>. You should then see the components <em>nested within</em>, or contained inside, VerticalScrollArrangement1 in the Viewer and in the Components pane, as shown in <a href="ch02.xhtml#ch2fig5">Figure 2-5</a>.</p>
<div class="image" id="ch2fig5"><span epub:type="pagebreak" id="page_30"/><img alt="Image" src="../images/02fig05.jpg"/></div>
<p class="figcap"><em>Figure 2-5: The Designer window after you drag <code>RecordBtn</code>, <code>WatchBtn</code>, and <code>VideoPlayer1</code> inside <code>VerticalScrollArrangement1</code></em></p>
<p class="indent">Let’s now change the <code>Visible</code> property of <code>VerticalScrollArrangement1</code>. Click that component in the Components pane, and then click the checkbox in the Properties pane under <strong>Visible</strong> to remove the check mark. This should make <code>VerticalScrollArrangement1</code> and all its contents invisible in the Viewer now and when the app starts. When we program the app, we’ll have it adjust this setting while it’s running to display these components 5 seconds after the app starts. Also, you’ll see that because <code>VerticalScrollArrangement1</code> is invisible, <code>Image1</code> now fills the screen as planned.</p>
<p class="indent">The last component we need to adjust before we can start programming is the <code>Clock</code>. Click the <span class="codestrong">Clock</span> component in the Components pane to change its <code>TimerInterval</code> property, as shown in <a href="ch02.xhtml#ch2fig6">Figure 2-6</a>.</p>
<div class="image" id="ch2fig6"><span epub:type="pagebreak" id="page_31"/><img alt="Image" src="../images/02fig06.jpg"/></div>
<p class="figcap"><em>Figure 2-6: The Designer window after you lay out “Practice Makes Perfect,” showing the adjusted property pane for <code>Clock1</code></em></p>
<p class="indent">To make the change, click the text box under <strong>TimerInterval</strong>, replace the default value of 1000 with <span class="codestrong">5000</span>, and then click your cursor outside of the text box. This sets the <code>Clock</code> component’s timer interval to 5,000 milliseconds, or 5 seconds. This means that, as long as the <code>Clock</code> component’s timer is enabled and set to <em>fire</em>, or go off, as in <a href="ch02.xhtml#ch2fig6">Figure 2-6</a>, it will automatically do what we program it to do every 5 seconds. But for your app, you’ll need to adjust the <code>Clock1</code> properties while the app’s running so the timer fires just once to make <code>Image1</code> disappear after 5 seconds when the <code>Button</code>, <code>VideoPlayer</code>, and <code>Camcorder</code> components appear, instead of firing every 5 seconds without stopping.</p>
<h3 class="h3" id="ch00lev1sec15"><strong>PROGRAMMING “PRACTICE MAKES PERFECT” IN THE BLOCKS EDITOR</strong></h3>
<p class="noindent">Now that you’ve laid out all the components, you can move to the Blocks Editor to program the app. Click the <strong>Blocks</strong> button to switch to the Blocks Editor, and let’s begin programming the four steps in order.</p>
<h4 class="h4" id="ch00lev2sec12"><span epub:type="pagebreak" id="page_32"/><strong>STEP 1: STARTING THE APP</strong></h4>
<p class="noindent">We start by telling the app what to do when it opens with the splash screen, <code>Image1</code>, displayed. We want it to wait 5 seconds before hiding <code>Image1</code>, showing the <code>Button</code> and <code>VideoPlayer</code> components for the remaining time that the app is open, and opening the <code>Camcorder</code>.</p>
<p class="indent">This code shows how to set up this first step using the <code>Clock</code> component’s <em>timer</em> event handler.</p>
<div class="image"><img alt="Image" src="../images/f0032-01.jpg"/></div>
<p class="indent">In the Blocks pane, click <span class="codestrong">Clock1</span>, and when the blocks for the component appear, drag the <span class="codestrong">whenClock1.Timer</span> event handler block <span class="ent">➊</span> to the Viewer. Next, in the Blocks pane, click <span class="codestrong">Image1</span> and drag the <span class="codestrong">setImage1.Visibleto</span> block <span class="ent">➋</span> to the Viewer and snap it inside the <span class="codestrong">whenClock1.Timer</span> block next to the word <code>do</code>. Then, return to the Blocks pane, click the <strong>Logic</strong> blocks drawer, and drag the <span class="codestrong">false</span> block <span class="ent">➌</span> to the Viewer and snap it to the right side of the <code>setImage1.Visibleto</code> block. These are the blocks that set the value of the <code>Image1 Visible</code> property to <code>false</code> after the <code>Clock</code> component’s timer fires, which hides the <code>Image1</code> splash screen after the 5-second time interval we set for the <code>Clock</code> in the Designer.</p>
<div class="note">
<p class="notet"><span class="noteh1"><strong>NOTE</strong></span></p>
<p class="notep"><em>In the Logic blocks drawer, App Inventor provides two <span class="roman">Boolean</span> value blocks, one with a value of <span class="codeitalic">true</span> and the other with a value of <span class="codeitalic">false</span>. Boolean variables and properties—such as the <span class="codeitalic">Visible</span> property of most visible components and the <span class="codeitalic">Clock</span> component’s <span class="codeitalic">TimerEnabled</span> property—have only two possible values, <span class="codeitalic">true</span> and <span class="codeitalic">false</span>. You can set the initial values of these properties in the Properties pane by checking or unchecking the property’s checkbox, and you can change the values with the blocks while the app’s running.</em></p>
</div>
<p class="indent">Now that we’ve programmed the splash screen to disappear after 5 seconds, we need to make the buttons and video player visible. To do this, click <span class="codestrong">VerticalScrollArrangement1</span>, drag the <span class="codestrong">setVerticalScrollArrangement1.Visibleto</span> block <span class="ent">➍</span> to the Viewer, and snap it inside the <span class="codestrong">whenClock1.Timer</span> block under the <code>setImage1.Visibleto</code> block. Then, in the Blocks pane, click the <strong>Logic</strong> blocks drawer, and drag the <span class="codestrong">true</span> block <span class="ent">➎</span> to the Viewer and snap it to the right side of the <code>setVerticalScrollArrangement1.Visibleto</code> block. These blocks set the value of the <code>VerticalScrollArrangement1 Visible</code> property to <code>true</code> after the <code>Clock</code> component’s timer fires, which makes <code>VerticalScrollArrangement1</code> and everything inside of it visible after the 5-second time interval we set for the <code>Clock</code> in the Designer.</p>
<p class="indent">Next, in the Blocks pane, click <span class="codestrong">Camcorder1</span>, drag the <span class="codestrong">callCamcorder1.RecordVideo</span> block <span class="ent">➏</span> to the Viewer, and snap it inside the <span class="codestrong">whenClock1.Timer</span> <span epub:type="pagebreak" id="page_33"/>block under the <code>setVerticalScrollArrangement1.Visibleto</code> block. These blocks call the <code>Camcorder</code> component’s built-in <code>RecordVideo</code> method to automatically open the user’s video camera after the <code>Clock</code>’s 5-second time interval.</p>
<p class="indent">Finally, click <span class="codestrong">Clock1</span>, scroll down to find the <span class="codestrong">setClock1.TimerEnabledto</span> block <span class="ent">➐</span>, drag it to the Viewer, and snap it inside the <span class="codestrong">whenClock1.Timer</span> block under the <code>callCamcorder1.RecordVideo</code> block. Then, in the Blocks pane, click the <strong>Logic</strong> blocks drawer, and drag the <span class="codestrong">false</span> block <span class="ent">➑</span> to the Viewer and snap it to the right side of the <code>setClock1.TimerEnabledto</code> block. These blocks set the value of the <code>TimerEnabled</code> property for <code>Clock1</code> to <code>false</code>, which stops the <code>Clock1</code> timer. This means that the timer will fire only once to execute the commands in this event handler after the first 5 seconds the app is open, and will not fire again until the app reopens.</p>
<p class="indent">In plain English, for step 1, you set the Designer properties to display the splash screen (<code>Image1</code>) when the app opens. Then, after 5 seconds, the code blocks tell the app to hide the image, display the buttons and video player, and open the video recorder to record a video.</p>
<p class="indent">Now live-test to see how these blocks work, preferably with your phone using the MIT AI2 Companion app, as outlined in “Live-Testing Your Apps” on <a href="intro.xhtml#page_xxii">page xxii</a>.</p>
<p class="indent">Once you click <strong>Connect</strong> <span class="ent">▸</span> <strong>AI Companion</strong> in the top menu bar and scan the QR code with your phone’s Companion app, your “Practice Makes Perfect” app should open on your phone. As long as your blocks are placed as shown in the code example, you should see <code>Image1</code> for 5 seconds before the buttons and video player appear and the video camera opens. You should not see the buttons and video player until you close the video camera. If you close the video camera without recording, you’ll likely see an error saying you didn’t record a video, which is true and fine for now. Leave the app open on your phone so you can keep live-testing.</p>
<h4 class="h4" id="ch00lev2sec13"><strong>STEP 2: OPENING THE VIDEO RECORDER</strong></h4>
<p class="noindent">So far we’ve programmed what the app should do when the user first opens it. Now let’s program step 2 of the app, which lets the user manually open the video camera to record a video when needed.</p>
<p class="indent">Here’s where we tell the app what to do when users click <code>RecordBtn</code>, which is the way users reopen the video camera after it closes. When <code>RecordBtn</code> is clicked, we want the app to open the device’s video camera so the user can record.</p>
<div class="image"><img alt="Image" src="../images/f0033-01.jpg"/></div>
<p class="indent"><span epub:type="pagebreak" id="page_34"/>In the Blocks pane, click <span class="codestrong">RecordBtn</span>, and when the blocks for the component appear, drag the <span class="codestrong">whenRecordBtn.Click</span> block <span class="ent">➊</span> to the Viewer. Then, in the Blocks pane, click <span class="codestrong">Camcorder1</span>, drag another <span class="codestrong">callCamcorder1.RecordVideo</span> block <span class="ent">➋</span> to the Viewer, and snap it inside the <span class="codestrong">whenRecordBtn.Click</span> block next to the word <code>do</code>. These blocks call the <code>Camcorder</code> component’s built-in <code>RecordVideo</code> method to open the phone’s video camera when the <code>RecordBtn</code> is clicked, just as we planned.</p>
<div class="note">
<p class="notet"><span class="noteh1"><strong>NOTE</strong></span></p>
<p class="notep"><em>Seeing the <span class="codeitalic">RecordVideo</span> method call in two different event handlers might initially confuse other programmers who see these blocks. To explain why you’re calling the method in two places, you can <span class="roman">comment</span> your code by right-clicking the second <span class="codeitalic">when...do</span> block, selecting <strong><em>Add Comment</em></strong>, clicking the blue question mark icon that appears, and entering your explanation in the text area that opens. Readers can open and close your comment by clicking the question mark icon. Programmers often comment their code to add reminders for themselves and explanations for other coders.</em></p>
</div>
<p class="indent">Now live-test to see how these blocks work. When you click <strong>Record</strong>, your phone’s video camera opens and you can then click the camera’s record button to record a video. But don’t record just yet! First we need to tell the app what to do after the camera records. If you close the video camera again without recording, you’ll likely see the error saying you didn’t record a video, which is okay for now.</p>
<h4 class="h4" id="ch00lev2sec14"><strong>STEP 3: CHOOSING THE VIDEO CLIP TO PLAY</strong></h4>
<p class="noindent">Let’s program step 3 of the app so that, after the user records a video, the app knows what to do with the recording. We want the app to set the <em>path</em> or storage location of the video as the source for the <code>VideoPlayer</code> component, which will ensure the recording will play next in the video player. Here are the blocks that handle this <em>after recording</em> event.</p>
<div class="image"><img alt="Image" src="../images/f0034-01.jpg"/></div>
<p class="indent">In the Blocks pane, click <span class="codestrong">Camcorder1</span>, and when the blocks for the component appear, drag the <span class="codestrong">whenCamcorder1.AfterRecording</span> block <span class="ent">➊</span> to the Viewer. Then, in the Blocks pane, click the <span class="codestrong">VideoPlayer1</span> component, drag the <span class="codestrong">setVideoPlayer1.Sourceto</span> block <span class="ent">➌</span> to the Viewer, and snap it inside the <span class="codestrong">whenCamcorder1.AfterRecording</span> block next to the word <code>do</code>.</p>
<p class="indent">The <code>clip</code> <span class="ent">➋</span> on the <code>whenCamcorder1.AfterRecording</code> block is an <em>event parameter</em>, which is a container that holds an <em>argument</em> or information provided about an event. This information can only be used in the event handler that provides it. The <code>clip</code> parameter holds the path to the video clip recorded by <code>Camcorder1</code> in part 1 or 2 of the app, and the video player can’t play the video until you set its <em>source</em>—the path to the file for it to play—to the path of the recorded clip.</p>
<p class="indent"><span epub:type="pagebreak" id="page_35"/>To set the source, mouse over the <span class="codestrong">clip</span> parameter until you see a <code>get clip</code> block <span class="ent">➍</span>. Drag the <span class="codestrong">get clip</span> block to the Viewer, and snap it to the right side of the <span class="codestrong">setVideoPlayer1.Sourceto</span> block. The blocks in this step set the path to the last recorded video clip as the source for <code>VideoPlayer1</code>.</p>
<h4 class="h4" id="ch00lev2sec15"><strong>STEP 4: PLAYING THE VIDEO CLIP</strong></h4>
<p class="noindent">Finally, let’s program step 4 of the app, telling it what to do when the user clicks <code>WatchBtn</code>. When the user clicks this button, we want the app’s video player to start playing the user’s recorded video. Here is the code for programming this event handler.</p>
<div class="image"><img alt="Image" src="../images/f0035-01.jpg"/></div>
<p class="indent">In the Blocks pane, click <span class="codestrong">WatchBtn</span>, and when the blocks for the component appear, drag the <span class="codestrong">whenWatchBtn.Click</span> block <span class="ent">➊</span> to the Viewer. Then, in the Blocks pane, click <span class="codestrong">VideoPlayer1</span>, drag the <span class="codestrong">callVideoPlayer1.Start</span> block <span class="ent">➋</span> to the screen, and snap it inside the <span class="codestrong">whenWatchBtn.Click</span> block next to the word <code>do</code>. These blocks tell the app to call the built-in <code>Start</code> method for <code>VideoPlayer1</code> to start the video player when the watch button is clicked, as planned.</p>
<p class="indent">Now live-test your completed app! Open the app on your phone, and you should see the splash screen for 5 seconds before the record and watch buttons and <code>VideoPlayer1</code> appear and your phone’s video camera opens. Take a video and then click <strong>Watch</strong> to view the video in the app’s integrated video player. If you placed your blocks as shown in the code examples, you should be able to record and watch videos over and over again, and you’ve successfully created the “Practice Makes Perfect” app!</p>
<h3 class="h3" id="ch00lev1sec16"><strong>SUMMARY</strong></h3>
<p class="noindent">In this chapter, you built the “Practice Makes Perfect” app, where users can record, watch, and re-record temporary video clips of themselves practicing speeches or songs. In the process, you examined how App Inventor uses event-driven programming to set app behavior, and you became familiar with different types of events and event handlers. You also learned about App Inventor’s Boolean value blocks and event parameters and used both to set values in this app.</p>
<p class="indent">In the next chapter, you’ll learn how to animate images; use random numbers; and create, set, and change the values of <em>variables</em> using App Inventor’s Animation, Math, and Variables blocks. We’ll use these tools to create a noisy, animated “Fruit Loot” game app, where players get points for catching fruit as it drops down the screen.</p>
<h3 class="h3" id="ch00lev1sec17"><span epub:type="pagebreak" id="page_36"/><strong>ON YOUR OWN</strong></h3>
<p class="noindent">Save new versions of “Practice Makes Perfect” as you modify and extend it working on these exercises. You can find solutions online at <em><a href="https://nostarch.com/programwithappinventor/">https://nostarch.com/programwithappinventor/</a></em>.</p>
<ol>
<li><p class="noindent">Extend the app so that the user can record, watch, and compare two practice video clips side by side. Which Layout and other component(s) would you need to drag to the Viewer to enable this? How will your blocks change?</p></li>
<li><p class="noindent">Change the app so that it records and plays sound clips instead of videos. What components and blocks would you use to record and play sound?</p></li>
</ol>
</body></html>