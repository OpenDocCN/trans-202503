<html><head></head><body>
<div id="sbo-rt-content"><section aria-labelledby="ch31" epub:type="chapter" role="doc-chapter">
<span aria-label="631" epub:type="pagebreak" id="pg_631" role="doc-pagebreak"/>
<hgroup>
<h2 class="CHAPTER" id="ch31">
<span class="CN"><span class="SANS_Futura_Std_Bold_Condensed_B_11">31</span></span>
<span class="CT"><span class="SANS_Dogma_OT_Bold_B_11">WORKING WITH DATES AND TIMES</span></span>
</h2>
</hgroup>
<figure class="opener"><img alt="" class="opener" height="380" src="../images/opener.jpg" width="380"/>
</figure>
<p class="INTRO">Web applications use dates and times in many ways: to maintain calendars, log when invoices are created, record when a message has been sent, and so on. In this chapter, we’ll explore PHP’s built-in resources for storing and manipulating dates and times, including ways to handle complexities such as time zones and daylight saving time. We’ll also look at how to send date-time information back and forth between PHP and a database system like MySQL, which has its own, separate way of storing that information.</p>
<section aria-labelledby="sec1" epub:type="division">
<span aria-label="632" epub:type="pagebreak" id="pg_632" role="doc-pagebreak"/>
<h3 class="H1" id="sec1"><span id="toc-link_401"/><span class="SANS_Futura_Std_Bold_B_11">The ISO 8601 Standard</span></h3>
<p class="TNI1">Countries have varying conventions for representing dates and times in day-to-day life. For example, people in the United States write 11/2 for November 2, but people in Ireland and the United Kingdom write 2/11 for that date. Likewise, some countries use 24-hour time, while others use 12-hour time with <small>AM</small> and <small>PM</small> designations. Computer programs have no room for such ambiguity when storing and manipulating dates and times, so it’s important to agree on a standard. These days, pretty much everyone in computing uses the date-time formats declared in <i>ISO 8601</i>, a standard originally published in 1988 and updated several times since.</p>
<p class="TX">Two key principles of ISO 8601 are that dates and times are represented with numbers and that they’re ordered from most to least significant. Dates therefore start with the year, then the month, then the day. For example, November 22, 1968, would typically be written as <span class="SANS_TheSansMonoCd_W5Regular_11">1968-11-22</span>, with four digits for the year, two for the month, and two for the day, adding leading zeros if required (such as <span class="SANS_TheSansMonoCd_W5Regular_11">03</span> for March rather than just <span class="SANS_TheSansMonoCd_W5Regular_11">3</span>). Following the same principle of most to least significance, times are written as hours, then minutes, then seconds. For example, 5 minutes and 30 seconds past 9 <small>AM</small> would be written as <span class="SANS_TheSansMonoCd_W5Regular_11">09:05:30</span>. You can add a decimal point and more digits for fractions of a second if needed, so <span class="SANS_TheSansMonoCd_W5Regular_11">09:05:30.01</span> is one-hundredth of a second after <span class="SANS_TheSansMonoCd_W5Regular_11">09:05:30</span>. The standard uses 24-hour time, so 11 <small>PM</small> is given as <span class="SANS_TheSansMonoCd_W5Regular_11">23:00:00</span>.</p>
<blockquote>
<p class="Note"><span class="SANS_Dogma_OT_Bold_B_15">NOTE</span></p>
</blockquote>
<p class="NOTE-TXT"><i>The creator of PHP, Rasmus Lerdorf, was born on November 22, 1968. The web doesn’t say what time he was born, so I’ve made up the time of 9:05</i> <i><small>AM</small></i> <i>and 30 seconds for the examples in this chapter.</i></p>
<p class="TX">These examples illustrate the <i>extended version</i> of ISO 8601’s date and time formatting, which adds dashes between the fields in the date, and colons between the fields in the time, to aid with human readability. Internally, the computer might not use these separators, but it’s recommended to always use them when presenting a date or time to a human, since something like <span class="SANS_TheSansMonoCd_W5Regular_11">1968-11-22</span> is a lot easier for a human to interpret than <span class="SANS_TheSansMonoCd_W5Regular_11">19681122</span>.</p>
<p class="TX">When combining a date and a time, ISO 8601 calls for a capital <span class="SANS_TheSansMonoCd_W5Regular_11">T</span> between the date and time components. Therefore 5 minutes and 30 seconds past 9 <small>AM</small> on November 22, 1968, would be written as <span class="SANS_TheSansMonoCd_W5Regular_11">1968-11-22T09:05:30</span>. That said, the original ISO 8601 standard allowed the use of a space between the date and time rather than a <span class="SANS_TheSansMonoCd_W5Regular_11">T</span>, so many computer implementations will also accept <span class="SANS_TheSansMonoCd_W5Regular_11">1968-22-22 09:05:30</span> as a valid format.</p>
<blockquote>
<p class="Note"><span class="SANS_Dogma_OT_Bold_B_15">NOTE</span></p>
</blockquote>
<p class="NOTE-TXT"><i>A concept found in most programming languages is</i> <span class="note">date-time</span><i>. So while we humans think about dates and times separately, or might talk about a</i> <span class="note">date and time</span><i>, in computer programming we typically work with objects that store data about a date and time all together. If we’re interested in only the date, we ignore the time components in our code, often defaulting to a zeroed time component for the beginning of a new day (</i><span class="SANS_TheSansMonoCd_W5Regular_Italic_11">00:00:00</span><i>). If we’re interested in only the time, we ignore the date components in our code and often default to the current date.</i></p>
<p class="TX"><span aria-label="633" epub:type="pagebreak" id="pg_633" role="doc-pagebreak"/>Time-zone characters or time offsets can be added to the end of a date-time string; we’ll look at how this works in <span class="Xref">“Formatting the Date-Time Information” on <a href="#pg_634">page 634</a></span>. ISO 8601 also defines other date and time components (such as week numbers), but the components I’ve described cover 99 percent of the date and time formatting needed to create and work with temporal data in PHP programs.</p>
</section>
<section aria-labelledby="sec2" epub:type="division">
<h3 class="H1" id="sec2"><span id="toc-link_402"/><span class="SANS_Futura_Std_Bold_B_11">Creating Dates and Times</span></h3>
<p class="TNI1">The fundamental PHP class for working with individual dates and times is <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeImmutable</span>. If you create a <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeImmutable</span> object without providing arguments to the constructor, the new object defaults to the current time and day at the moment of its creation, based on the local time-zone settings for your computer system. <a href="#lis31-1">Listing 31-1</a> illustrates how to instantiate this class.</p>
<span id="lis31-1"/>
<pre><code>&lt;?php&#13;
$today = new DateTimeImmutable();&#13;
var_dump($today);</code></pre>
<p class="CodeListingCaption"><span class="SANS_Futura_Std_Book_Oblique_11">Listing 31-1: Creating a</span> <span class="TheSansMonoCd_W5Regular_Italic_11">DateTimeImmutable</span> <span class="SANS_Futura_Std_Book_Oblique_11">object for the current date and time</span></p>
<p class="TX">We create a new <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeImmutable</span> object without any arguments and output its value by using the <span class="SANS_TheSansMonoCd_W5Regular_11">var_dump()</span> function. If you execute this script at the command line, you should see something similar to the following:</p>
<pre><code>object(DateTimeImmutable)#1 (3) {&#13;
  ["date"]=&gt;&#13;
  string(26) "1968-11-22 09:05:30.000000"&#13;
  ["timezone_type"]=&gt;&#13;
  int(3)&#13;
  ["timezone"]=&gt;&#13;
  string(3) "Europe/Dublin"&#13;
}</code></pre>
<p class="TX">The <span class="SANS_TheSansMonoCd_W5Regular_11">var_dump()</span> function returns the object’s internal <span class="SANS_TheSansMonoCd_W5Regular_11">date</span> value as a date-time string. Notice that this string output uses a space rather than a <span class="SANS_TheSansMonoCd_W5Regular_11">T</span> between the date and the time to aid in human readability, and that the time component uses six decimal places to capture the time down to the nearest microsecond (millionth of a second). The object’s remaining properties pertain to the time zone (I’m in Dublin, Ireland, for example), as we’ll discuss in detail in <span class="Xref">“Time Zones” on <a href="#pg_641">page 641</a></span>.</p>
<blockquote>
<p class="Note"><span class="SANS_Dogma_OT_Bold_B_15">NOTE</span></p>
</blockquote>
<p class="NOTE-TXT"><i>To get the current date and time, you can also use</i> <span class="SANS_TheSansMonoCd_W5Regular_Italic_11">new DateTimeImmutable('now')</span><i>. The</i> <span class="SANS_TheSansMonoCd_W5Regular_Italic_11">'now'</span> <i>argument is useful if you need to provide a second argument specifying a different time zone from the default.</i></p>
<p class="TX"><span aria-label="634" epub:type="pagebreak" id="pg_634" role="doc-pagebreak"/>To create a <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeImmutable</span> object holding another (noncurrent) date and time, pass a string containing the desired date and time to the constructor, like this:</p>
<pre><code>$rasmusBirthdate = new DateTimeImmutable('1968-11-22T09:05:30');</code></pre>
<p class="BodyContinued">This creates a new <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeImmutable</span> object holding the date November 22, 1968, and the time 9:05 and 30 seconds.</p>
<section aria-labelledby="sec3" epub:type="division">
<h4 class="H2" id="sec3"><span id="toc-link_403"/><span class="SANS_Futura_Std_Bold_Condensed_Oblique_11">Formatting the Date-Time Information</span></h4>
<p class="TNI1">The <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeImmutable</span> class’s <span class="SANS_TheSansMonoCd_W5Regular_11">format()</span> method makes it possible to adjust the output style for dates and times in different ways. For example, <a href="#lis31-2">Listing 31-2</a> shows how to format a date-time string to the ISO 8601 standard.</p>
<span id="lis31-2"/>
<pre><code>&lt;?php&#13;
$now = new DateTimeImmutable();&#13;
&#13;
$atomDateString = $now-&gt;format(DateTimeInterface::ATOM);&#13;
print 'now (ISO-8601): ' . $atomDateString . PHP_EOL;</code></pre>
<p class="CodeListingCaption"><span class="SANS_Futura_Std_Book_Oblique_11">Listing 31-2: Formatting a</span> <span class="TheSansMonoCd_W5Regular_Italic_11">DateTimeImmutable</span> <span class="SANS_Futura_Std_Book_Oblique_11">object constant</span></p>
<p class="TX">We instantiate <span class="SANS_TheSansMonoCd_W5Regular_11">$now</span> as a default <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeImmutable</span> object, then call its <span class="SANS_TheSansMonoCd_W5Regular_11">format()</span> method, passing in the <span class="SANS_TheSansMonoCd_W5Regular_11">ATOM</span> constant from <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeInterface</span> (the <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeImmutable</span> class is an implementation of this interface). This constant indicates that the date and time should be formatted according to the ISO 8601 standard. The <span class="SANS_TheSansMonoCd_W5Regular_11">format()</span> method returns a string, which we store in <span class="SANS_TheSansMonoCd_W5Regular_11">$atomDateString</span> and print. The output should look something like this:</p>
<pre><code>now (ISO-8601): 1968-11-22T09:05:30 + 00:00</code></pre>
<p class="BodyContinued">Notice that the output follows ISO 8601 format, including the <span class="SANS_TheSansMonoCd_W5Regular_11">T</span> between the date and the time. The <span class="SANS_TheSansMonoCd_W5Regular_11">+00:00</span> at the end has to do with time zones, which we’ll discuss later.</p>
<p class="TX">The <span class="SANS_TheSansMonoCd_W5Regular_11">format()</span> method can also take in a string specifying custom formatting. This allows you to create more readable date-time output. For example, you can tell <span class="SANS_TheSansMonoCd_W5Regular_11">format()</span> to spell out the name of the month, include the day of the week, convert from 24-hour to 12-hour time, add a suffix to the date number (as in <i>1st</i>, <i>2nd</i>, or <i>23rd</i>), and so on. <a href="#lis31-3">Listing 31-3</a> illustrates how it’s done.</p>
<span id="lis31-3"/>
<pre><code>&lt;?php&#13;
$now = new DateTimeImmutable();&#13;
&#13;
$formattedDateString = $now-&gt;&#13;
    format('l \t\h\e jS \o\f F Y \a\t i \m\i\n\s \p\a\s\t ga');&#13;
print 'now (nice format): ' . $formattedDateString . PHP_EOL;</code></pre>
<p class="CodeListingCaption"><span class="SANS_Futura_Std_Book_Oblique_11">Listing 31-3: Customizing the output string format for a date-time</span></p>
<p class="TX"><span aria-label="635" epub:type="pagebreak" id="pg_635" role="doc-pagebreak"/>This time, we provide a string to <span class="SANS_TheSansMonoCd_W5Regular_11">format()</span> that defines a custom format for the date-time information. The string uses letter codes, such as <span class="SANS_TheSansMonoCd_W5Regular_11">l</span>, <span class="SANS_TheSansMonoCd_W5Regular_11">j</span>, and <span class="SANS_TheSansMonoCd_W5Regular_11">S</span>, to stand in for parts of the date and time. Here’s what the letters in <a href="#lis31-3">Listing 31-3</a> mean:</p>
<p class="RunInPara"><span class="SANS_TheSansMonoCd_W7Bold_11">l</span>   The full name of the day of the week (Monday, Tuesday, and so on)</p>
<p class="RunInPara"><span class="SANS_TheSansMonoCd_W7Bold_11">j</span>   The day of the month as an integer with no leading space (1, 4, 20, 31, and so on)</p>
<p class="RunInPara"><span class="SANS_TheSansMonoCd_W7Bold_11">S</span>   A two-letter suffix for the numeric date of the month (<i>st</i> for 1st, <i>nd</i> for 2nd, and so on)</p>
<p class="RunInPara"><span class="SANS_TheSansMonoCd_W7Bold_11">F</span>   The full name of the month (January, May, and so on)</p>
<p class="RunInPara"><span class="SANS_TheSansMonoCd_W7Bold_11">Y</span>   The four-digit year (2000, 2019, 2025, and so on)</p>
<p class="RunInPara"><span class="SANS_TheSansMonoCd_W7Bold_11">i</span>   Minutes with leading zeros (00 through 59)</p>
<p class="RunInPara"><span class="SANS_TheSansMonoCd_W7Bold_11">g</span>   The hour in 12-hour format without leading zeros (1 through 12)</p>
<p class="RunInPara"><span class="SANS_TheSansMonoCd_W7Bold_11">a</span>   The appropriate <small>AM</small> or <small>PM</small> abbreviation</p>
<p class="BodyContinued">The case of each character is important, since several characters represent different values depending on whether they’re upper- or lowercase. For example, a lowercase <span class="SANS_TheSansMonoCd_W5Regular_11">d</span> represents the date of the month (with a leading zero if required to ensure that it’s two digits), while an uppercase <span class="SANS_TheSansMonoCd_W5Regular_11">D</span> is the three-letter abbreviation of the day of the week (Mon, Tue, and so on).</p>
<blockquote>
<p class="Note"><span class="SANS_Dogma_OT_Bold_B_15">NOTE</span></p>
</blockquote>
<p class="NOTE-TXT"><i>The PHP documentation provides a full list of all these special formatting characters at</i> <span class="note_LinkURL"><a href="https://www.php.net/manual/en/datetime.format.php">https://www.php.net/manual/en/datetime.format.php</a></span><i>.</i></p>
<p class="TX">Any text that you want to be included verbatim in the formatted string needs to be escaped (preceded by a backslash), character by character. Thus, the string argument to <span class="SANS_TheSansMonoCd_W5Regular_11">format()</span> in <a href="#lis31-3">Listing 31-3</a> includes character sequences like <span class="SANS_TheSansMonoCd_W5Regular_11">\t\h\e</span> (the word <i>the</i>) and <span class="SANS_TheSansMonoCd_W5Regular_11">\o\f</span> (the word <i>of</i>). <a href="#lis31-3">Listing 31-3</a> should output something like this:</p>
<pre><code>now (nice format): Friday the 22nd of November 1968 at 05 mins past 9am</code></pre>
<p class="TX">You can also use letter codes with the <span class="SANS_TheSansMonoCd_W5Regular_11">createFromFormat()</span> static method to create new <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeImmutable</span> objects based on formatted strings. Consider this example:</p>
<pre><code>$date = DateTimeImmutable::createFromFormat('j-M-Y', '15-Feb-2009');</code></pre>
<p class="BodyContinued">The <span class="SANS_TheSansMonoCd_W5Regular_11">createFromFormat()</span> method takes two arguments. The first is a formatter string built using the letter codes we’ve discussed. The second is a string that follows the indicated format and sets the value for the new <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeImmutable</span> object.</p>
</section>
<section aria-labelledby="sec4" epub:type="division">
<h4 class="H2" id="sec4"><span id="toc-link_404"/><span class="SANS_Futura_Std_Bold_Condensed_Oblique_11">Using DateTimeImmutable vs. DateTime</span></h4>
<p class="TNI1">Our focus has been on the <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeImmutable</span> class, but PHP also offers the similar <span class="SANS_TheSansMonoCd_W5Regular_11">DateTime</span> class. The only difference (but an important one) is that <span aria-label="636" epub:type="pagebreak" id="pg_636" role="doc-pagebreak"/>once created, a <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeImmutable</span> object won’t change the values it contains, whereas a <span class="SANS_TheSansMonoCd_W5Regular_11">DateTime</span> object’s value can be updated. One consequence is that <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeImmutable</span> methods that might change the date or time return a new <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeImmutable</span> object rather than modifying the original object’s values.</p>
<p class="TX">Use <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeImmutable</span> whenever possible rather than <span class="SANS_TheSansMonoCd_W5Regular_11">DateTime</span> to avoid the unexpected behavior of an object changing and returning a reference to itself. To see why, look at <a href="#lis31-4">Listing 31-4</a>.</p>
<span id="lis31-4"/>
<pre><code>&lt;?php&#13;
$today = new DateTime();&#13;
print 'today (before modify) = ' . $today-&gt;format('Y-m-d') . PHP_EOL;&#13;
&#13;
$tomorrow = $today-&gt;modify('+1 day');&#13;
print 'today = ' . $today-&gt;format('Y-m-d') . PHP_EOL;&#13;
print 'tomorrow = ' . $tomorrow-&gt;format('Y-m-d') . PHP_EOL;</code></pre>
<p class="CodeListingCaption"><span class="SANS_Futura_Std_Book_Oblique_11">Listing 31-4: Creating a</span> <span class="TheSansMonoCd_W5Regular_Italic_11">DateTime</span> <span class="SANS_Futura_Std_Book_Oblique_11">object and modifying it</span></p>
<p class="TX">We create a new <span class="SANS_TheSansMonoCd_W5Regular_11">DateTime</span> (rather than <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeImmutable</span>) object called <span class="SANS_TheSansMonoCd_W5Regular_11">$today</span> and print its value (in year-month-day format). Then we invoke the object’s <span class="SANS_TheSansMonoCd_W5Regular_11">modify()</span> method to move the date one day forward, storing the result in the <span class="SANS_TheSansMonoCd_W5Regular_11">$tomorrow</span> variable. Rather than creating a new <span class="SANS_TheSansMonoCd_W5Regular_11">DateTime</span> object for the next day, however, calling <span class="SANS_TheSansMonoCd_W5Regular_11">modify()</span> changes the original <span class="SANS_TheSansMonoCd_W5Regular_11">DateTime</span> object and returns a reference to that same object. To confirm this, we print both <span class="SANS_TheSansMonoCd_W5Regular_11">$today</span> and <span class="SANS_TheSansMonoCd_W5Regular_11">$tomorrow</span>. The output will look something like this:</p>
<pre><code>today (before modify) = 1968-11-22&#13;
today = 1968-11-23&#13;
tomorrow = 1968-11-23</code></pre>
<p class="TX">Initially, the value of <span class="SANS_TheSansMonoCd_W5Regular_11">$today</span> indicates November 22. After calling <span class="SANS_TheSansMonoCd_W5Regular_11">modify()</span>, both <span class="SANS_TheSansMonoCd_W5Regular_11">$today</span> and <span class="SANS_TheSansMonoCd_W5Regular_11">$tomorrow</span> indicate November 23. Both variables reference the same <span class="SANS_TheSansMonoCd_W5Regular_11">DateTime</span> object, whose value was changed by the <span class="SANS_TheSansMonoCd_W5Regular_11">modify()</span> method.</p>
<p class="TX">While having changeable date-time information may sometimes be desirable, it’s important to make sure that’s what you want before using <span class="SANS_TheSansMonoCd_W5Regular_11">DateTime</span> over <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeImmutable</span>. The example also illustrates how inappropriate variable names can make code hard to understand and debug. If we deliberately create a mutable <span class="SANS_TheSansMonoCd_W5Regular_11">DateTime</span> object and make a change to its date, that object shouldn’t be named for a particular date (like <span class="SANS_TheSansMonoCd_W5Regular_11">$today</span> or <span class="SANS_TheSansMonoCd_W5Regular_11">$tomorrow</span>), since at some point the name of the variable won’t correctly refer to its value.</p>
<p class="TX">To really see the difference between the two PHP date-time classes, try changing the class from <span class="SANS_TheSansMonoCd_W5Regular_11">DateTime</span> to <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeImmutable</span> in <a href="#lis31-4">Listing 31-4</a> and then run the script again. Here’s the output:</p>
<pre><code>today (before modify) = 1968-11-22&#13;
today = 1968-11-22&#13;
tomorrow = 1968-11-23</code></pre>
<p class="TX">This time, the value of <span class="SANS_TheSansMonoCd_W5Regular_11">$today</span> remains the same, even as <span class="SANS_TheSansMonoCd_W5Regular_11">$tomorrow</span> moves one day ahead. This is because the <span class="SANS_TheSansMonoCd_W5Regular_11">modify()</span> method of a <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeImmutable</span> <span aria-label="637" epub:type="pagebreak" id="pg_637" role="doc-pagebreak"/>object creates and returns a completely new <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeImmutable</span> object with the modified value while leaving the original object unchanged. Therefore, <span class="SANS_TheSansMonoCd_W5Regular_11">$today</span> and <span class="SANS_TheSansMonoCd_W5Regular_11">$tomorrow</span> refer to two different <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeImmutable</span> objects, and both variable names are reasonable, since they always correctly refer to the values of the object they reference.</p>
</section>
</section>
<section aria-labelledby="sec5" epub:type="division">
<h3 class="H1" id="sec5"><span id="toc-link_405"/><span class="SANS_Futura_Std_Bold_B_11">Manipulating Dates and Times</span></h3>
<p class="TNI1">PHP’s <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeImmutable</span> class features several methods that create a new <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeImmutable</span> object based on the value of an existing one. These methods make it possible to programmatically manipulate date and time information.</p>
<p class="TX">You already saw one example, the <span class="SANS_TheSansMonoCd_W5Regular_11">modify()</span> method, in <a href="#lis31-4">Listing 31-4</a>. This method takes a string argument indicating how to set a new date or time relative to the current <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeImmutable</span> object’s value. For instance, the strings <span class="SANS_TheSansMonoCd_W5Regular_11">'yesterday'</span> and <span class="SANS_TheSansMonoCd_W5Regular_11">'tomorrow'</span> yield midnight (time <span class="SANS_TheSansMonoCd_W5Regular_11">00:00:00</span>) on the previous or next day; the <span class="SANS_TheSansMonoCd_W5Regular_11">'noon'</span> and <span class="SANS_TheSansMonoCd_W5Regular_11">'midnight'</span> strings yield noon (<span class="SANS_TheSansMonoCd_W5Regular_11">12:00:00</span>) or midnight on the current day; and <span class="SANS_TheSansMonoCd_W5Regular_11">'first day of this month'</span> or <span class="SANS_TheSansMonoCd_W5Regular_11">'last day of this month'</span> change the date as appropriate while leaving the time the same. These modifier strings can be combined; for example, <span class="SANS_TheSansMonoCd_W5Regular_11">'tomorrow noon'</span> and <span class="SANS_TheSansMonoCd_W5Regular_11">'first day of this month midnight'</span> are both valid.</p>
<p class="TX">Other modifier strings use <span class="SANS_TheSansMonoCd_W5Regular_11">+</span> or <span class="SANS_TheSansMonoCd_W5Regular_11">-</span> followed by a quantity and unit of time to give more granular control over the new <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeImmutable</span> object’s value, as in <span class="SANS_TheSansMonoCd_W5Regular_11">'+1 day'</span>, <span class="SANS_TheSansMonoCd_W5Regular_11">'-2 hours'</span>, or <span class="SANS_TheSansMonoCd_W5Regular_11">'+30 seconds'</span>. These can also be combined into longer strings, such as <span class="SANS_TheSansMonoCd_W5Regular_11">'+1 day +30 seconds'</span>. <a href="#lis31-5">Listing 31-5</a> shows some of these modifiers in action.</p>
<span id="lis31-5"/>
<pre><code>&lt;?php&#13;
function showModify(string $modifier): void&#13;
{&#13;
    print PHP_EOL. $modifier . PHP_EOL;&#13;
    $date1 = new DateTimeImmutable();&#13;
    $date2 = $date1-&gt;modify($modifier);&#13;
    print 'date1 = ' . $date1-&gt;format(DateTimeInterface::ATOM) . PHP_EOL;&#13;
    print 'date2 = ' . $date2-&gt;format(DateTimeInterface::ATOM) . PHP_EOL;&#13;
}&#13;
&#13;
showModify('first day of this month');&#13;
showModify('+1 day');&#13;
showModify('+30 seconds');&#13;
showModify('-10 seconds');&#13;
showModify('+1 month +3 days +1 seconds');</code></pre>
<p class="CodeListingCaption"><span class="SANS_Futura_Std_Book_Oblique_11">Listing 31-5: Passing relative date-time strings to the</span> <span class="TheSansMonoCd_W5Regular_Italic_11">modify()</span> <span class="SANS_Futura_Std_Book_Oblique_11">method</span></p>
<p class="TX">To help show the date-times before and after modification, we first declare a <span class="SANS_TheSansMonoCd_W5Regular_11">showModify()</span> function that takes in a modifier string as an argument. The function prints the modifier string itself, creates a new <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeImmutable</span> object with the current time, and passes the string to the <span class="SANS_TheSansMonoCd_W5Regular_11">modify()</span> method to create another, modified <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeImmutable</span> object. Then it prints both objects <span aria-label="638" epub:type="pagebreak" id="pg_638" role="doc-pagebreak"/>in ISO 8601 format. Next, we make a series of <span class="SANS_TheSansMonoCd_W5Regular_11">showModify()</span> calls to demonstrate various modifier strings. The output should be something like this:</p>
<pre><code>first day of this month&#13;
date1 = 1968-11-22T09:05:30 + 00:00&#13;
<span aria-label="annotation1" class="codeannotated_CodeAnnotation">❶</span> date2 = 1968-11-01T09:05:30 + 00:00&#13;
&#13;
+1 day&#13;
date1 = 1968-11-22T09:05:30 + 00:00&#13;
<span aria-label="annotation2" class="codeannotated_CodeAnnotation">❷</span> date2 = 1968-11-23T09:05:30 + 00:00&#13;
&#13;
+30 seconds&#13;
date1 = 1968-11-22T09:05:30 + 00:00&#13;
date2 = 1968-11-22T09:06:00 + 00:00&#13;
&#13;
-10 seconds&#13;
date1 = 1968-11-22T09:05:30 + 00:00&#13;
date2 = 1968-11-22T09:05:20 + 00:00&#13;
&#13;
+1 month +3 days +1 seconds&#13;
date1 = 1968-11-22T09:05:30 + 00:00&#13;
date2 = 1968-12-25T09:05:31 + 00:00</code></pre>
<p class="TX">The value of <span class="SANS_TheSansMonoCd_W5Regular_11">$date1</span> is the same for each function call, November 22, 1968, at 9:05 and 30 seconds. With the <span class="SANS_TheSansMonoCd_W5Regular_11">'first day of this month'</span> modifier, the date component of <span class="SANS_TheSansMonoCd_W5Regular_11">$date2</span> ends up as November 1, but the time component is left unchanged <span aria-label="annotation1" class="CodeAnnotation">❶</span>. With <span class="SANS_TheSansMonoCd_W5Regular_11">'+1 day'</span>, the date component moves forward to November 23, but again the time component is unchanged <span aria-label="annotation2" class="CodeAnnotation">❷</span>. The <span class="SANS_TheSansMonoCd_W5Regular_11">'+30 seconds'</span> and <span class="SANS_TheSansMonoCd_W5Regular_11">'-10 seconds'</span> strings move the time component forward and backward without changing the date component, while <span class="SANS_TheSansMonoCd_W5Regular_11">'+1 month +3 days +1 seconds'</span> changes both the date and time.</p>
<p class="TX">If you provide a date to the <span class="SANS_TheSansMonoCd_W5Regular_11">modify()</span> method, that date will replace the original one in the new <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeImmutable</span> object created, leaving the time unchanged. For example, the <span class="SANS_TheSansMonoCd_W5Regular_11">'2000-12-31'</span> string applied to an object holding <span class="SANS_TheSansMonoCd_W5Regular_11">1968-11-22T09:05:30</span> would result in a new object of <span class="SANS_TheSansMonoCd_W5Regular_11">2000-12-31 T09:05:30</span>, the same time but for December 31, 2000. Likewise, providing a time results in a new object with the original date but the new time.</p>
<p class="TX">That said, modifying just the date or time component of a <span class="SANS_TheSansMonoCd_W5Regular_11">DateTime Immutable</span> object can be accomplished more easily using the <span class="SANS_TheSansMonoCd_W5Regular_11">setDate()</span> and <span class="SANS_TheSansMonoCd_W5Regular_11">setTime()</span> methods. For example, if <span class="SANS_TheSansMonoCd_W5Regular_11">$date1</span> is a <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeImmutable</span> object, both the following statements result in the same new object being created:</p>
<pre><code>$date2 = $date1-&gt;modify('2000-12-31');&#13;
$date2 = $date1-&gt;setDate(2000, 12, 31);</code></pre>
<p class="TX">Notice that the <span class="SANS_TheSansMonoCd_W5Regular_11">setDate()</span> method takes three separate integers as arguments, rather than a single string. These integers represent the desired year, month, and day. Similarly, the <span class="SANS_TheSansMonoCd_W5Regular_11">setTime()</span> method takes four integers for the new hour, minute, second, and microsecond. The latter two default to <span class="SANS_TheSansMonoCd_W5Regular_11">0</span>.</p>
<section aria-labelledby="sec6" epub:type="division">
<span aria-label="639" epub:type="pagebreak" id="pg_639" role="doc-pagebreak"/>
<h4 class="H2" id="sec6"><span id="toc-link_406"/><span class="SANS_Futura_Std_Bold_Condensed_Oblique_11">Using Date-Time Intervals</span></h4>
<p class="TNI1">The <span class="SANS_TheSansMonoCd_W5Regular_11">DateInterval</span> class represents a span of time rather than a specific date-time. This class provides another useful way of manipulating date-time information and of thinking about the relationship between different date-times. For example, the <span class="SANS_TheSansMonoCd_W5Regular_11">add()</span> and <span class="SANS_TheSansMonoCd_W5Regular_11">sub()</span> methods of the <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeImmutable</span> class take in a <span class="SANS_TheSansMonoCd_W5Regular_11">DateInterval</span> object and return a new <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeImmutable</span> object offset forward or backward in time from the original object by the specified interval. <a href="#lis31-6">Listing 31-6</a> illustrates how this works.</p>
<span id="lis31-6"/>
<pre><code>&lt;?php&#13;
$interval1 = DateInterval::createFromDateString('30 seconds');&#13;
$interval2 = DateInterval::createFromDateString('1 day');&#13;
&#13;
$date1 = new DateTimeImmutable();&#13;
$date2 = $date1-&gt;add($interval1);&#13;
$date3 = $date1-&gt;sub($interval2);&#13;
&#13;
print '$date1 = ' . $date1-&gt;format(DateTimeInterface::ATOM) . PHP_EOL;&#13;
print '$date2 = ' . $date2-&gt;format(DateTimeInterface::ATOM) . PHP_EOL;&#13;
print '$date3 = ' . $date3-&gt;format(DateTimeInterface::ATOM) . PHP_EOL;</code></pre>
<p class="CodeListingCaption"><span class="SANS_Futura_Std_Book_Oblique_11">Listing 31-6: Creating new</span> <span class="TheSansMonoCd_W5Regular_Italic_11">DateTimeImmutable</span> <span class="SANS_Futura_Std_Book_Oblique_11">objects offset by time intervals</span></p>
<p class="TX">First, we use the <span class="SANS_TheSansMonoCd_W5Regular_11">createFromDateString()</span> static method to create two <span class="SANS_TheSansMonoCd_W5Regular_11">Date Interval</span> objects. With this method, we can express the desired interval by using strings like <span class="SANS_TheSansMonoCd_W5Regular_11">'30 seconds'</span> or <span class="SANS_TheSansMonoCd_W5Regular_11">'1 day'</span>. Next, we create a <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeImmutable</span> object for the current date and time, then call its <span class="SANS_TheSansMonoCd_W5Regular_11">add()</span> and <span class="SANS_TheSansMonoCd_W5Regular_11">sub()</span> methods, passing in the <span class="SANS_TheSansMonoCd_W5Regular_11">DateInterval</span> objects. This creates two more <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeImmutable</span> objects, offset according to the given time intervals. The three date-time strings in the output should look something like this:</p>
<pre><code>$date1 = 1968-11-22T09:05:30 + 00:00&#13;
$date2 = 1968-11-22T09:06:00 + 00:00&#13;
$date3 = 1968-11-21T09:05:30 + 00:00</code></pre>
<p class="TX">Notice that <span class="SANS_TheSansMonoCd_W5Regular_11">$date2</span> has the same date, but its time is <span class="SANS_TheSansMonoCd_W5Regular_11">09:06:00</span>, 30 seconds later than <span class="SANS_TheSansMonoCd_W5Regular_11">$date1</span>. Meanwhile, <span class="SANS_TheSansMonoCd_W5Regular_11">$date3</span> has the same time, but its date is one day earlier: November 21 instead of November 22. Note that we can create negative as well as positive <span class="SANS_TheSansMonoCd_W5Regular_11">DateInterval</span> objects. For example, we could create a <span class="SANS_TheSansMonoCd_W5Regular_11">DateInterval</span> by using the string <span class="SANS_TheSansMonoCd_W5Regular_11">'-1 day'</span>.</p>
<p class="TX">A more common way of creating a <span class="SANS_TheSansMonoCd_W5Regular_11">DateInterval</span> object is to use the <span class="SANS_TheSansMonoCd_W5Regular_11">diff()</span> method of the <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeImmutable</span> class. Given one <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeImmutable</span> object, you call its <span class="SANS_TheSansMonoCd_W5Regular_11">diff()</span> method, passing in a second <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeImmutable</span> object, and the method returns a <span class="SANS_TheSansMonoCd_W5Regular_11">DateInterval</span> object representing the difference between those two date-times. This is useful when a user has provided a start and end date, and some logic or calculation needs to be performed based on the size of the date interval between them. For example, a hotel-booking web application might calculate the cost of a stay based on the number of days between the desired start and end date. <a href="#lis31-7">Listing 31-7</a> shows how this mechanism works.</p>
<span id="lis31-7"/>
<pre><code><span aria-label="640" epub:type="pagebreak" id="pg_640" role="doc-pagebreak"/>&lt;?php&#13;
$date1 = new DateTimeImmutable('1968-11-22');&#13;
$date2 = new DateTimeImmutable('1968-11-16');&#13;
&#13;
$interval = $date1-&gt;diff($date2);&#13;
print '$interval = ' . $interval-&gt;&#13;
    format('%m months, %d days, %i minutes, %s seconds');</code></pre>
<p class="CodeListingCaption"><span class="SANS_Futura_Std_Book_Oblique_11">Listing 31-7: Obtaining the interval between two</span> <span class="TheSansMonoCd_W5Regular_Italic_11">DateTimeImmutable</span> <span class="SANS_Futura_Std_Book_Oblique_11">objects</span></p>
<p class="TX">We create two <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeImmutable</span> objects, <span class="SANS_TheSansMonoCd_W5Regular_11">$date1</span> and <span class="SANS_TheSansMonoCd_W5Regular_11">$date2</span>, specifying just the date for each; the objects are six days apart. Then we call the <span class="SANS_TheSansMonoCd_W5Regular_11">diff()</span>method on <span class="SANS_TheSansMonoCd_W5Regular_11">$date1</span>, passing <span class="SANS_TheSansMonoCd_W5Regular_11">$date2</span> as an argument. This produces a <span class="SANS_TheSansMonoCd_W5Regular_11">DateInterval</span> object holding the difference between the two dates, which we format and print. Here’s the result:</p>
<pre><code>$interval = 0 months, 6 days, 0 minutes, 0 seconds</code></pre>
<p class="TX">As expected, the <span class="SANS_TheSansMonoCd_W5Regular_11">DateInterval</span> object indicates that the two dates are four days apart. Note that the <span class="SANS_TheSansMonoCd_W5Regular_11">format()</span> method of the <span class="SANS_TheSansMonoCd_W5Regular_11">DateInterval</span> class works differently from formatting actual dates. It takes in a string using the percent character (<span class="SANS_TheSansMonoCd_W5Regular_11">%</span>) to indicate where values from the <span class="SANS_TheSansMonoCd_W5Regular_11">DateInterval</span> object should be inserted. For example, <span class="SANS_TheSansMonoCd_W5Regular_11">%d</span> is replaced by the number of days (<span class="SANS_TheSansMonoCd_W5Regular_11">6</span>) in the output string.</p>
</section>
<section aria-labelledby="sec7" epub:type="division">
<h4 class="H2" id="sec7"><span id="toc-link_407"/><span class="SANS_Futura_Std_Bold_Condensed_Oblique_11">Looping at Regular Intervals</span></h4>
<p class="TNI1">For displaying a series of date-time values, updating calendars, or generating historical reports, it’s often useful to loop at a regular interval between two dates. PHP’s <span class="SANS_TheSansMonoCd_W5Regular_11">DatePeriod</span> class makes this possible. An object of this class can be iterated through with a <span class="SANS_TheSansMonoCd_W5Regular_11">foreach</span> loop, just like an array. Each iteration turns up a new <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeImmutable</span> object, with all the objects evenly spaced in time.</p>
<p class="TX">To create a <span class="SANS_TheSansMonoCd_W5Regular_11">DatePeriod</span> object, you must provide a start and end date, plus a <span class="SANS_TheSansMonoCd_W5Regular_11">DateInterval</span> object defining the rate of iteration. <a href="#lis31-8">Listing 31-8</a> shows an example of using this class to automatically list the first seven days of a month.</p>
<span id="lis31-8"/>
<pre><code>&lt;?php&#13;
$today = new DateTimeImmutable();&#13;
print 'today: ' . $today-&gt;format('l \t\h\e jS \o\f F Y') . PHP_EOL;&#13;
$firstOfMonth = $today-&gt;modify('first day of this month');&#13;
$oneWeekLater = $firstOfMonth-&gt;modify('+1 week');&#13;
&#13;
$interval = DateInterval::createFromDateString("1 day");&#13;
<span aria-label="annotation1" class="codeannotated_CodeAnnotation">❶</span> $period = new DatePeriod($firstOfMonth, $interval, $oneWeekLater);&#13;
&#13;
print '--- first 7 days of current month ---'. PHP_EOL;&#13;
<span aria-label="annotation2" class="codeannotated_CodeAnnotation">❷</span> foreach ($period as $date) {&#13;
    print $date-&gt;format('l \t\h\e jS \o\f F Y') . PHP_EOL;&#13;
}</code></pre>
<p class="CodeListingCaption"><span class="SANS_Futura_Std_Book_Oblique_11">Listing 31-8: Iterating through a</span> <span class="TheSansMonoCd_W5Regular_Italic_11">DatePeriod</span> <span class="SANS_Futura_Std_Book_Oblique_11">object</span></p>
<p class="TX"><span aria-label="641" epub:type="pagebreak" id="pg_641" role="doc-pagebreak"/>First, we create and print a <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeImmutable</span> object for the current day (<span class="SANS_TheSansMonoCd_W5Regular_11">$today</span>). Then we use the <span class="SANS_TheSansMonoCd_W5Regular_11">modify()</span> method to create two more <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeImmutable</span> objects, <span class="SANS_TheSansMonoCd_W5Regular_11">$firstOfMonth</span> for the first day of the current month, and <span class="SANS_TheSansMonoCd_W5Regular_11">$oneWeekLater</span> for a week after that. These will be the start and end points for the iteration. Next, we create a one-day <span class="SANS_TheSansMonoCd_W5Regular_11">DateInterval</span> object, which we use, along with the start and end points, to create a <span class="SANS_TheSansMonoCd_W5Regular_11">DatePeriod</span> object <span aria-label="annotation1" class="CodeAnnotation">❶</span>. The order of arguments is the start date, the interval, and then the end date. Finally, we run a <span class="SANS_TheSansMonoCd_W5Regular_11">foreach</span> loop to iterate through the <span class="SANS_TheSansMonoCd_W5Regular_11">DatePeriod</span> object <span aria-label="annotation2" class="CodeAnnotation">❷</span>, printing a formatted string for each date as it comes up. The output should look something like the following:</p>
<pre><code>today: Friday the 22nd of November 1968&#13;
--- first 7 days of current month ---&#13;
Friday the 1st of November 1968&#13;
Saturday the 2nd of November 1968&#13;
Sunday the 3rd of November 1968&#13;
Monday the 4th of November 1968&#13;
Tuesday the 5th of November 1968&#13;
Wednesday the 6th of November 1968&#13;
Thursday the 7th of November 1968</code></pre>
<p class="BodyContinued">Based on a start day of November 22, 1968, the script successfully looped through and displayed the first seven days of that month.</p>
<p class="TX">Rather than a start and end date, another way to create <span class="SANS_TheSansMonoCd_W5Regular_11">DatePeriod</span> objects is to give the start date, the interval, and the number of recurrences. This third argument doesn’t count the start date itself, so to list the first seven days of a month, the number of recurrences would be <span class="SANS_TheSansMonoCd_W5Regular_11">6</span>. The <span class="SANS_TheSansMonoCd_W5Regular_11">DatePeriod</span> constructor also has an optional parameter to exclude the start date by passing a fourth argument of the constant <span class="SANS_TheSansMonoCd_W5Regular_11">DatePeriod::EXCLUDE_START_DATE</span>.</p>
<blockquote>
<p class="Note"><span class="SANS_Dogma_OT_Bold_B_15">NOTE</span></p>
</blockquote>
<p class="NOTE-TXT"><i>At present,</i> <span class="SANS_TheSansMonoCd_W5Regular_Italic_11">DatePeriod</span> <i>works only for positive</i> <span class="SANS_TheSansMonoCd_W5Regular_Italic_11">DateInterval</span> <i>objects, so loops have to move forward in time.</i></p>
</section>
</section>
<section aria-labelledby="sec8" epub:type="division">
<h3 class="H1" id="sec8"><span id="toc-link_408"/><span class="SANS_Futura_Std_Bold_B_11">Time Zones</span></h3>
<p class="TNI1">A <i>time zone</i> is a geographical area that observes the same time. These days, all time zones worldwide are defined relative to the time standard of <i>Coordinated Universal Time (UTC)</i>. This is the time at the International Reference Meridian (0° longitude), which passes through Greenwich, England. For example, UTC +3 and UTC –2 indicate three hours ahead and two hours behind UTC, respectively. UTC is also nicknamed <i>Zulu time</i>, with <i>Zulu</i> being the standard codeword for the letter <i>Z</i> in the NATO phonetic alphabet. (The <i>Z</i> is for <i>zero</i>.) <a href="#tab31-1">Table 31-1</a> lists some example UTC offsets and their associated time zones.</p>
<span aria-label="642" epub:type="pagebreak" id="pg_642" role="doc-pagebreak"/>
<p class="TT"><a id="tab31-1"/><span class="Heavy"><span class="SANS_Futura_Std_Heavy_11">Table 31-1:</span></span> <span class="SANS_Futura_Std_Book_11">Example Time Zones</span></p>
<table class="Basic-Table">
<thead>
<tr>
<th class="TCH" scope="col"><p class="TCH1"><span class="SANS_Futura_Std_Heavy_11">UTC offset</span></p></th>
<th class="TCH" scope="col"><p class="TCH1"><span class="SANS_Futura_Std_Heavy_11">Abbreviation</span></p></th>
<th class="TCH" scope="col"><p class="TCH1"><span class="SANS_Futura_Std_Heavy_11">Common name</span></p></th>
</tr>
</thead>
<tbody>
<tr>
<td class="TBF"><p class="TB_Grey"><span class="SANS_Futura_Std_Book_11">UTC +0</span></p></td>
<td class="TBF"><p class="TB_Grey"><span class="SANS_Futura_Std_Book_11">GMT</span></p></td>
<td class="TBF"><p class="TB_Grey"><span class="SANS_Futura_Std_Book_11">Greenwich Mean Time</span></p></td>
</tr>
<tr>
<td class="TB"><p class="TB1"><span class="SANS_Futura_Std_Book_11">UTC +1</span></p></td>
<td class="TB"><p class="TB1"><span class="SANS_Futura_Std_Book_11">BST</span></p></td>
<td class="TB"><p class="TB1"><span class="SANS_Futura_Std_Book_11">British Summer Time</span></p></td>
</tr>
<tr>
<td class="TB"><p class="TB_Grey"><span class="SANS_Futura_Std_Book_11">UTC +1</span></p></td>
<td class="TB"><p class="TB_Grey"><span class="SANS_Futura_Std_Book_11">IST</span></p></td>
<td class="TB"><p class="TB_Grey"><span class="SANS_Futura_Std_Book_11">Irish Standard Time</span></p></td>
</tr>
<tr>
<td class="TB"><p class="TB1"><span class="SANS_Futura_Std_Book_11">UTC +11</span></p></td>
<td class="TB"><p class="TB1"><span class="SANS_Futura_Std_Book_11">AEDT</span></p></td>
<td class="TB"><p class="TB1"><span class="SANS_Futura_Std_Book_11">Australian Eastern Daylight Time (Tasmania is where my twin brother lives)</span></p></td>
</tr>
<tr>
<td class="TB"><p class="TB_Grey"><span class="SANS_Futura_Std_Book_11">UTC –5</span></p></td>
<td class="TB"><p class="TB_Grey"><span class="SANS_Futura_Std_Book_11">EST</span></p></td>
<td class="TB"><p class="TB_Grey"><span class="SANS_Futura_Std_Book_11">Eastern Standard Time</span></p></td>
</tr>
<tr>
<td class="TBL"><p class="TB1"><span class="SANS_Futura_Std_Book_11">UTC +2</span></p></td>
<td class="TBL"><p class="TB1"><span class="SANS_Futura_Std_Book_11">CEST</span></p></td>
<td class="TBL"><p class="TB1"><span class="SANS_Futura_Std_Book_11">Central European Summer Time</span></p></td>
</tr>
</tbody>
</table>
<p class="TX">You can set the default time zone for your system’s PHP setup in the <i>php.ini</i> configuration file. The time zone itself is given with a <i>time-zone identifier</i>, a string that includes a region (such as America, Europe, or Pacific) and a city located in the desired time zone, separated by a forward slash. <a href="#lis31-9">Listing 31-9</a>, for example, shows I’ve set up my system to the <span class="SANS_TheSansMonoCd_W5Regular_11">Europe/Dublin</span> time zone.</p>
<span id="lis31-9"/>
<pre><code><span class="TheSansMonoCd_W5Regular_Italic_11">--snip--</span>&#13;
[Date]&#13;
; Defines the default timezone used by the date functions&#13;
; https://php.net/date.timezone&#13;
date.timezone = Europe/Dublin&#13;
<span class="TheSansMonoCd_W5Regular_Italic_11">--snip--</span></code></pre>
<p class="CodeListingCaption"><span class="SANS_Futura_Std_Book_Oblique_11">Listing 31-9: An excerpt of a</span> <span class="SANS_Futura_Std_Book_11">php.ini</span> <span class="SANS_Futura_Std_Book_Oblique_11">file setting the default time zone to</span> <span class="TheSansMonoCd_W5Regular_Italic_11">Europe/Dublin</span></p>
<p class="TX">You use <span class="SANS_TheSansMonoCd_W5Regular_11">date.timezone</span> to set a time-zone identifier for the PHP engine. To verify that your system’s time zone has been set correctly, use the <span class="SANS_TheSansMonoCd_W5Regular_11">date _default_timezone_get()</span> function. This returns <span class="SANS_TheSansMonoCd_W5Regular_11">Europe/Dublin</span> for me.</p>
<blockquote>
<p class="Note"><span class="SANS_Dogma_OT_Bold_B_15">NOTE</span></p>
</blockquote>
<p class="NOTE-TXT"><i>You can find a full list of acceptable time-zone identifiers in the PHP documentation at</i> <span class="note_LinkURL"><a href="https://www.php.net/manual/en/timezones.php">https://www.php.net/manual/en/timezones.php</a></span><i>. However, avoid using any of the identifiers listed in the Others region, apart from</i> <span class="TheSansMonoCd_W5Regular_Italic_11">UTC</span><i>. These identifiers are for backward compatibility only and may be changed in the future.</i></p>
<p class="TX">When you create a <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeImmutable</span> object in a PHP script, it defaults to the time zone of your system. My preferred way to specify a time zone is to pass a <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeZone</span> object as a second argument to the <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeImmutable</span> constructor. Another common method is to append a UTC offset to the end of an ISO 8601 string. For example, adding <span class="SANS_TheSansMonoCd_W5Regular_11">+03:00</span> to the end of the string indicates that the date-time is three hours ahead of UTC. <a href="#lis31-10">Listing 31-10</a> illustrates each of these methods.</p>
<span id="lis31-10"/>
<pre><code>&lt;?php&#13;
function prettyPrintDatetime(string $name, DateTimeImmutable $date)&#13;
{&#13;
    print '---------' . $name . '---------' . PHP_EOL;&#13;
    print $date-&gt;format(DATE_ATOM) . ' ' . $date-&gt;getTimezone()-&gt;getName(). PHP_EOL . PHP_EOL;&#13;
}&#13;
&#13;
<span aria-label="643" epub:type="pagebreak" id="pg_643" role="doc-pagebreak"/>$iceCreamDay = '2009-08-02';&#13;
$localDatetime = new DateTimeImmutable($iceCreamDay); <span aria-label="annotation1" class="codewide_CodeAnnotation">❶</span>&#13;
$utcDatetime = new DateTimeImmutable($iceCreamDay, new DateTimeZone('UTC')); <span aria-label="annotation2" class="codewide_CodeAnnotation">❷</span>&#13;
$londonDatetime = new DateTimeImmutable($iceCreamDay, new DateTimeZone('Europe/London'));&#13;
$parisDatetime = new DateTimeImmutable($iceCreamDay, new DateTimeZone('Europe/Paris'));&#13;
$hobartDatetime = new DateTimeImmutable($iceCreamDay, new DateTimeZone('Australia/Hobart'));&#13;
$threeHoursAhead = new DateTimeImmutable('2000-01-01T10:00:00 + 03:00'); <span aria-label="annotation3" class="codewide_CodeAnnotation">❸</span>&#13;
&#13;
print 'local time zone = ' . date_default_timezone_get() . PHP_EOL; <span aria-label="annotation4" class="codewide_CodeAnnotation">❹</span>&#13;
prettyPrintDatetime('local', $localDatetime); <span aria-label="annotation5" class="codewide_CodeAnnotation">❺</span>&#13;
prettyPrintDatetime('UTC', $utcDatetime);&#13;
prettyPrintDatetime('London', $londonDatetime);&#13;
prettyPrintDatetime('Paris', $parisDatetime);&#13;
prettyPrintDatetime('Hobart', $hobartDatetime);&#13;
prettyPrintDatetime('+03', $threeHoursAhead);</code></pre>
<p class="CodeListingCaption"><span class="SANS_Futura_Std_Book_Oblique_11">Listing 31-10: Creating</span> <span class="TheSansMonoCd_W5Regular_Italic_11">DateTimeImmutable</span> <span class="SANS_Futura_Std_Book_Oblique_11">objects with different time zones</span></p>
<p class="TX">We declare a <span class="SANS_TheSansMonoCd_W5Regular_11">prettyPrintDatetime()</span> function to nicely print out a <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeImmutable</span> object and its time zone, along with a string label passed in as the <span class="SANS_TheSansMonoCd_W5Regular_11">$name</span> parameter. The time zone is accessed using the <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeImmutable</span> object’s <span class="SANS_TheSansMonoCd_W5Regular_11">getTimezone()</span> method, which returns a <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeZone</span> object. Then we have to call the <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeZone</span> object’s <span class="SANS_TheSansMonoCd_W5Regular_11">getName()</span> method, which returns the name of the time zone as a string.</p>
<p class="TX">Next, we declare a series of <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeImmutable</span> objects with different time zones, all for the date August 2, 2009 (<span class="SANS_TheSansMonoCd_W5Regular_11">2009-08-02</span>), the first occurrence of National Ice Cream Sandwich Day in the United States. The <span class="SANS_TheSansMonoCd_W5Regular_11">$localDatetime</span> object <span aria-label="annotation1" class="CodeAnnotation">❶</span> holds the date according to the system’s default time zone (<span class="SANS_TheSansMonoCd_W5Regular_11">Europe/Dublin</span> for me, per my <i>php.ini</i> file). Since we didn’t specify a time, the time will default to midnight.</p>
<p class="TX">The <span class="SANS_TheSansMonoCd_W5Regular_11">$utcDatetime</span> object <span aria-label="annotation2" class="CodeAnnotation">❷</span> is set to UTC by passing two arguments to the <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeImmutable</span> constructor: <span class="SANS_TheSansMonoCd_W5Regular_11">$iceCreamDay</span> to specify the date, and a <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeZone</span> object set to <span class="SANS_TheSansMonoCd_W5Regular_11">'UTC'</span> to specify the time zone. We use this same technique to create objects for the time in London, Paris, and Hobart. The <span class="SANS_TheSansMonoCd_W5Regular_11">$threeHoursAhead</span> object <span aria-label="annotation3" class="CodeAnnotation">❸</span> is created by appending the UTC offset <span class="SANS_TheSansMonoCd_W5Regular_11">+03:00</span> to the date-time string <span class="SANS_TheSansMonoCd_W5Regular_11">2000-01-01T10:00:00</span> passed to the <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeImmutable</span> constructor, indicating the time is three hours ahead of UTC.</p>
<p class="TX">We print confirmation of the computer system’s time-zone setting by using the <span class="SANS_TheSansMonoCd_W5Regular_11">date_default_timezone_get()</span> built-in function <span aria-label="annotation4" class="CodeAnnotation">❹</span>. Then we pass our <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeImmutable</span> objects one at a time to the <span class="SANS_TheSansMonoCd_W5Regular_11">prettyPrintDatetime()</span> function <span aria-label="annotation5" class="CodeAnnotation">❺</span>. The output should look something like this:</p>
<pre><code><span aria-label="annotation1" class="codeannotated_CodeAnnotation">❶</span> local time zone = Europe/Dublin&#13;
---------local---------&#13;
2009-08-02T00:00:00 + 01:00 Europe/Dublin&#13;
&#13;
---------UTC---------&#13;
2009-08-02T00:00:00 + 00:00 UTC&#13;
&#13;
---------London---------&#13;
2009-08-02T00:00:00 + 01:00 Europe/London&#13;
&#13;
<span aria-label="644" epub:type="pagebreak" id="pg_644" role="doc-pagebreak"/>---------Paris---------&#13;
2009-08-02T00:00:00 + 02:00 Europe/Paris&#13;
&#13;
---------Hobart---------&#13;
2009-08-02T00:00:00 + 10:00 Australia/Hobart&#13;
&#13;
---------+03---------&#13;
<span aria-label="annotation2" class="codeannotated_CodeAnnotation">❷</span> 2000-01-01T10:00:00 + 03:00 +03:00</code></pre>
<p class="TX">The first data printed is the system’s time-zone setting, <span class="SANS_TheSansMonoCd_W5Regular_11">Europe/Dublin</span> for me <span aria-label="annotation1" class="CodeAnnotation">❶</span>. Then as each of our <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeImmutable</span> objects is printed, its time-zone information is visible in the output in two ways: in the UTC offset at the end of the date-time string (for example, <span class="SANS_TheSansMonoCd_W5Regular_11">+01:00</span> for London and Dublin, and <span class="SANS_TheSansMonoCd_W5Regular_11">+10:00</span> for Hobart), and in the separate time-zone string we extract as part of the <span class="SANS_TheSansMonoCd_W5Regular_11">prettyPrintDatetime()</span> function. Notice, however, that when we specify the time zone by using a generic UTC offset like <span class="SANS_TheSansMonoCd_W5Regular_11">+03:00</span> rather than a more specific time-zone identifier, that’s how the <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeImmutable</span> object records the time zone <span aria-label="annotation2" class="CodeAnnotation">❷</span>. This is because PHP doesn’t know which region and city to associate with the offset. For example, <span class="SANS_TheSansMonoCd_W5Regular_11">+03:00</span> could be <span class="SANS_TheSansMonoCd_W5Regular_11">Europe/Moscow</span>, <span class="SANS_TheSansMonoCd_W5Regular_11">Asia/Riyadh</span>, or <span class="SANS_TheSansMonoCd_W5Regular_11">Africa/Mogadishu</span>.</p>
</section>
<section aria-labelledby="sec9" epub:type="division">
<h3 class="H1" id="sec9"><span id="toc-link_409"/><span class="SANS_Futura_Std_Bold_B_11">Daylight Saving Time</span></h3>
<p class="TNI1">Around a quarter of all countries worldwide operate a system of daylight saving time: clocks are set forward by one hour in the spring (“spring forward”), then set back by one hour in the autumn (“fall back”). PHP’s <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeImmutable</span> objects automatically account for these changes if the location designated by an object’s time-zone identifier observes daylight saving time.</p>
<p class="TX">The <span class="SANS_TheSansMonoCd_W5Regular_11">format()</span> method of the <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeImmutable</span> class has a special value for identifying whether daylight saving time is in effect for that object: an uppercase letter <span class="SANS_TheSansMonoCd_W5Regular_11">I</span>. Calling <span class="SANS_TheSansMonoCd_W5Regular_11">format('I')</span> returns <span class="SANS_TheSansMonoCd_W5Regular_11">1</span> (true) if daylight saving time applies, or <span class="SANS_TheSansMonoCd_W5Regular_11">0</span> (false) if not. <a href="#lis31-11">Listing 31-11</a> shows an updated version of the time-zone script from <a href="#lis31-10">Listing 31-10</a>, with an expanded <span class="SANS_TheSansMonoCd_W5Regular_11">prettyPrintDatetime()</span> function that displays additional information about daylight saving time.</p>
<span id="lis31-11"/>
<pre><code><span class="TheSansMonoCd_W5Regular_Grey_11">&lt;?php</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">function prettyPrintDatetime(string $name, DateTimeImmutable $date)</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">{</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">    print '---------' . $name . '---------' . PHP_EOL;</span>&#13;
  <span aria-label="annotation1" class="Code_CodeAnnotation">❶</span> $isDaylightSaving = $date-&gt;format('I');&#13;
    if ($isDaylightSaving) {&#13;
        $dstString = ' (daylight saving time = TRUE)';&#13;
    } else {&#13;
        $dstString = ' (daylight saving time = FALSE)';&#13;
    }&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">    print $date-&gt;format(DATE_ATOM) . ' ' . $date-&gt;getTimezone()-&gt;getName()</span>&#13;
        . $dstString<b> </b><span class="TheSansMonoCd_W5Regular_Grey_11">. PHP_EOL . PHP_EOL;</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">}</span>&#13;
&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">$iceCreamDay = '2009-08-02';</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">$localDatetime = new DateTimeImmutable($iceCreamDay);</span>&#13;
<span aria-label="645" epub:type="pagebreak" id="pg_645" role="doc-pagebreak"/><span class="TheSansMonoCd_W5Regular_Grey_11">$utcDatetime = new DateTimeImmutable(</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">    $iceCreamDay, new DateTimeZone('UTC'));</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">$londonDatetime = new DateTimeImmutable(</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">    $iceCreamDay, new DateTimeZone('Europe/London'));</span>&#13;
<span class="TheSansMonoCd_W5Regular_Italic_11">--snip--</span></code></pre>
<p class="CodeListingCaption"><span class="SANS_Futura_Std_Book_Oblique_11">Listing 31-11: An updated</span> <span class="TheSansMonoCd_W5Regular_Italic_11">prettyPrintDatetime()</span> <span class="SANS_Futura_Std_Book_Oblique_11">function to output a message about daylight saving time</span></p>
<p class="TX">We call <span class="SANS_TheSansMonoCd_W5Regular_11">format('I')</span> on the <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeImmutable</span> object passed into the <span class="SANS_TheSansMonoCd_W5Regular_11">prettyPrintDatetime()</span> function, storing the resulting <span class="SANS_TheSansMonoCd_W5Regular_11">1</span> or <span class="SANS_TheSansMonoCd_W5Regular_11">0</span> in the <span class="SANS_TheSansMonoCd_W5Regular_11">$isDaylight Saving</span> variable <span aria-label="annotation1" class="CodeAnnotation">❶</span>. Then we use an <span class="SANS_TheSansMonoCd_W5Regular_11">if...else</span> statement to create an appropriate true/false message about daylight saving time based on this variable. All the <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeImmutable</span> objects have again been created for National Ice Cream Sandwich Day, a useful summertime date in the northern hemisphere for demonstrating whether daylight saving applies in different time zones. Here’s the output when this updated script is executed:</p>
<pre><code>local time zone = Europe/Dublin&#13;
---------local---------&#13;
2009-08-02T00:00:00 + 01:00 Europe/Dublin (daylight saving time = FALSE)&#13;
&#13;
---------UTC---------&#13;
2009-08-02T00:00:00 + 00:00 UTC (daylight saving time = FALSE)&#13;
&#13;
---------London---------&#13;
2009-08-02T00:00:00 + 01:00 Europe/London (daylight saving time = TRUE)&#13;
&#13;
---------Paris---------&#13;
2009-08-02T00:00:00 + 02:00 Europe/Paris (daylight saving time = TRUE)&#13;
&#13;
---------Hobart---------&#13;
2009-08-02T00:00:00 + 10:00 Australia/Hobart (daylight saving time = FALSE)&#13;
&#13;
---------+03---------&#13;
2000-01-01T10:00:00 + 03:00 +03:00 (daylight saving time = FALSE)</code></pre>
<p class="TX">Daylight saving time never applies to UTC, so the UTC line is shown as <span class="SANS_TheSansMonoCd_W5Regular_11">FALSE</span>. The United Kingdom and France observe daylight saving time starting in late March, so London and Paris both show <span class="SANS_TheSansMonoCd_W5Regular_11">TRUE</span>.</p>
<p class="TX">Strangely, while the clocks in Ireland do shift forward as well, Dublin is shown to be <span class="SANS_TheSansMonoCd_W5Regular_11">FALSE</span>. This appears to be due to the way the Republic of Ireland’s time zone is legally defined as being GMT in the winter and IST (Irish Standard Time) in the summer. By contrast, the United Kingdom and France are defined as being in a <i>summer</i> time rather than a <i>standard</i> time when daylight saving is in effect (BST, or British Summer Time, for London, and CEST, or Central European Summer Time, for Paris). Therefore, while the <span class="SANS_TheSansMonoCd_W5Regular_11">UTC+01:00</span> offset is correct in the summer for the time zones identified by <span class="SANS_TheSansMonoCd_W5Regular_11">Europe/Dublin</span> and <span class="SANS_TheSansMonoCd_W5Regular_11">Europe/London</span>, one is considered daylight saving time and the other is not by the <span class="SANS_TheSansMonoCd_W5Regular_11">format('I')</span> method.</p>
</section>
<section aria-labelledby="sec10" epub:type="division">
<span aria-label="646" epub:type="pagebreak" id="pg_646" role="doc-pagebreak"/>
<h3 class="H1" id="sec10"><span id="toc-link_410"/><span class="SANS_Futura_Std_Bold_B_11">Epochs and Unix Time</span></h3>
<p class="TNI1">Many computer systems measure time relative to an <i>epoch</i>, a fixed point in time that’s treated as time 0. For example, Unix systems (including macOS) use the <i>time_t</i> format, commonly known as <i>Unix time</i>, which represents time in terms of the number of seconds that have elapsed since the beginning (00:00:00) of Thursday, January 1, 1970. <a href="#tab31-2">Table 31-2</a> shows a few Unix timestamps and their equivalent ISO 8601 date-times. Notice that timestamps before 1970 are represented as negative values.</p>
<p class="TT"><a id="tab31-2"/><span class="Heavy"><span class="SANS_Futura_Std_Heavy_11">Table 31-2:</span></span> <span class="SANS_Futura_Std_Book_11">Example Unix Timestamps</span></p>
<table class="Basic-Table">
<thead>
<tr>
<th class="TCH" scope="col"><p class="TCH1"><span class="SANS_Futura_Std_Heavy_11">Date</span></p></th>
<th class="TCH" scope="col"><p class="TCH1"><span class="SANS_Futura_Std_Heavy_11">Timestamp</span></p></th>
</tr>
</thead>
<tbody>
<tr>
<td class="TBF"><p class="TB_Grey"><span class="SANS_Futura_Std_Book_11">1969-12-31 23:59:00</span></p></td>
<td class="TBF"><p class="TB_Grey"><span class="SANS_Futura_Std_Book_11">–60</span></p></td>
</tr>
<tr>
<td class="TB"><p class="TB1"><span class="SANS_Futura_Std_Book_11">1970-01-01 00:00:00</span></p></td>
<td class="TB"><p class="TB1"><span class="SANS_Futura_Std_Book_11">0</span></p></td>
</tr>
<tr>
<td class="TB"><p class="TB_Grey"><span class="SANS_Futura_Std_Book_11">1970-01-01 00:02:00</span></p></td>
<td class="TB"><p class="TB_Grey"><span class="SANS_Futura_Std_Book_11">120</span></p></td>
</tr>
<tr>
<td class="TBL"><p class="TB1"><span class="SANS_Futura_Std_Book_11">2009-08-02 00:00:00</span></p></td>
<td class="TBL"><p class="TB1"><span class="SANS_Futura_Std_Book_11">1249171200</span></p></td>
</tr>
</tbody>
</table>
<p class="TX">PHP’s built-in <span class="SANS_TheSansMonoCd_W5Regular_11">time()</span> function returns the current date and time as a Unix timestamp. While modern PHP programmers typically use <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeImmutable</span> objects, you may encounter the <span class="SANS_TheSansMonoCd_W5Regular_11">time()</span> function in older code or code from non-object-oriented programmers. Therefore, it’s useful to be able to work with code that stores these Unix timestamps. If you have a <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeImmutable</span> object, you can get its equivalent Unix timestamp by using the object’s <span class="SANS_TheSansMonoCd_W5Regular_11">getTimestamp()</span> method. <a href="#lis31-12">Listing 31-12</a> shows a script to create objects and print the corresponding timestamps for each row in <a href="#tab31-2">Table 31-2</a>.</p>
<span id="lis31-12"/>
<pre><code>&lt;?php&#13;
function print_timestamp(string $dateString): void&#13;
{&#13;
    $date = new DateTimeImmutable($dateString);&#13;
    print $date-&gt;format('D, F j, Y  g.i:s');&#13;
    print ' / timestamp = ' . $date-&gt;getTimestamp() . PHP_EOL;&#13;
}&#13;
print_timestamp('1969-12-31T23:59:00');&#13;
print_timestamp('1970-01-01T00:00:00');&#13;
print_timestamp('1970-01-01T00:02:00');&#13;
print_timestamp('2009-08-02T00:00:00');</code></pre>
<p class="CodeListingCaption"><span class="SANS_Futura_Std_Book_Oblique_11">Listing 31-12: Converting</span> <span class="TheSansMonoCd_W5Regular_Italic_11">DateTimeImmutable</span> <span class="SANS_Futura_Std_Book_Oblique_11">objects to Unix timestamps</span></p>
<p class="TX">First, we declare a <span class="SANS_TheSansMonoCd_W5Regular_11">print_timestamp()</span> function that takes in a date-time string, creates a <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeImmutable</span> object for that string, and prints the equivalent timestamp (along with a custom-formatted, human-readable version of the date-time) by using the <span class="SANS_TheSansMonoCd_W5Regular_11">getTimestamp()</span> method. Then we invoke the function four times, once for each row from <a href="#tab31-2">Table 31-2</a>. Here’s the result:</p>
<pre><code>Wed, December 31, 1969  11.59:00 / timestamp = -60&#13;
Thu, January 1, 1970  12.00:00 / timestamp = 0&#13;
<span aria-label="647" epub:type="pagebreak" id="pg_647" role="doc-pagebreak"/>Thu, January 1, 1970  12.02:00 / timestamp = 120&#13;
Sun, August 2, 2009  12.00:00 / timestamp = 1249171200</code></pre>
<p class="TX">The reverse of <span class="SANS_TheSansMonoCd_W5Regular_11">getTimestamp()</span> is the <span class="SANS_TheSansMonoCd_W5Regular_11">setTimeStamp()</span> method, which creates a new <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeImmutable</span> object corresponding to a given Unix timestamp, as shown here:</p>
<pre><code>$datetime = (new DateTimeImmutable())-&gt;setTimeStamp($timestamp);</code></pre>
<p class="BodyContinued">Notice the extra set of parentheses around <span class="SANS_TheSansMonoCd_W5Regular_11">(new DateTimeImmutable())</span>. This creates a new default <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeImmutable</span> object, which we then use to call the <span class="SANS_TheSansMonoCd_W5Regular_11">setTimeStamp()</span> method, passing the relevant timestamp in the <span class="SANS_TheSansMonoCd_W5Regular_11">$timestamp</span> variable. This in turn creates another new <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeImmutable</span> object set to correspond with the timestamp, which we store in the <span class="SANS_TheSansMonoCd_W5Regular_11">$datetime</span> variable. Without the extra parentheses, the statement would look as follows, and the PHP engine wouldn’t understand the syntax:</p>
<pre><code>// This will not work&#13;
$datetime = new DateTimeImmutable()-&gt;setTimeStamp($timestamp);</code></pre>
<p class="TX">When working with code that uses Unix timestamps, I recommend refactoring the code to use <span class="SANS_TheSansMonoCd_W5Regular_11">setTimeStamp()</span> to create an equivalent <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeImmutable</span> object, then do all the logic with that object. You can then use the <span class="SANS_TheSansMonoCd_W5Regular_11">getTime stamp()</span> method to convert the final result back to a timestamp. Or, better still, refactor all the code to use <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeImmutable</span> objects with no reference whatsoever to timestamps.</p>
<blockquote>
<p class="Note"><span class="SANS_Dogma_OT_Bold_B_15">NOTE</span></p>
</blockquote>
<p class="NOTE-TXT"><i>Unix timestamps were originally stored using 32-bit integers, a shortsighted scheme. The last timestamp that can be correctly stored in the original 32-bit format will be</i> <span class="SANS_TheSansMonoCd_W5Regular_Italic_11">+2147483647</span> <i>(2</i><i><sup>31</sup></i> <i>– 1), the equivalent of 3:14</i> <i><small>AM</small></i> <i>and 7 seconds on January 19, 2038. Ticking forward one more second would result in an overflow error and a timestamp of</i> <span class="SANS_TheSansMonoCd_W5Regular_Italic_11">-2147483648</span><i>, or 8:45</i> <i><small>PM</small></i> <i>and 52 seconds on December 13, 1901. Fortunately, most systems have already been upgraded to use 64 bits for Unix timestamps, which postpones the overflow error by 292 billion years.</i></p>
</section>
<section aria-labelledby="sec11" epub:type="division">
<h3 class="H1" id="sec11"><span id="toc-link_411"/><span class="SANS_Futura_Std_Bold_B_11">Date-Time Information in a Web Application</span></h3>
<p class="TNI1">In this section, we’ll build a simple web application to synthesize what we’ve covered so far about working with date-time information in PHP. The application will provide a form for the user to enter an address and a date, and it will display the sunrise and sunset times for that day and location, along with the total duration of daylight for that day as determined by the <span class="SANS_TheSansMonoCd_W5Regular_11">DateInterval</span> class.</p>
<p class="TX">As it happens, PHP has a built-in <span class="SANS_TheSansMonoCd_W5Regular_11">date_sun_info()</span> function that reports the sunrise and sunset times (along with other information) for a given date and location. The function requires the location to be specified as latitude and longitude coordinates rather than a street address, however. Our application will therefore also demonstrate how to obtain data from <span aria-label="648" epub:type="pagebreak" id="pg_648" role="doc-pagebreak"/>an external API, as we’ll rely on OpenStreetMap to convert the address to coordinates. We’ll use a popular open source PHP library called Guzzle to communicate with OpenStreetMap. Guzzle provides an HTTP client, allowing code to send and receive HTTP requests. This makes it straightforward to integrate PHP web applications with external web services.</p>
<p class="TX"><a href="#fig31-1">Figure 31-1</a> features screenshots of the pages we’ll create.</p>
<figure class="IMG"><a id="fig31-1"/><img alt="" class="img100" height="658" src="../images/figure31-1.jpg" width="1679"/>
<figcaption><p class="CAP"><span class="SANS_Futura_Std_Book_Oblique_11">Figure 31-1: Screenshots of the sunrise-sunset web application</span></p></figcaption>
</figure>
<p class="TX">The home page allows the user to submit a street address and a date. This leads to a results page showing the calculated information. The results page will also have a link to view the specified location in OpenStreetMap.</p>
<p class="TX">To get started, create a new project with the usual <i>composer.json</i> file and <i>public/index.php</i> script that creates an <span class="SANS_TheSansMonoCd_W5Regular_11">Application</span> object and calls its <span class="SANS_TheSansMonoCd_W5Regular_11">run()</span> method. Then enter <span class="SANS_TheSansMonoCd_W7Bold_11">composer require guzzlehttp/guzzle</span> at the command line to add the third-party Guzzle library to the project. Since we’re running Composer and have created the <i>composer.json</i> file for our namespace, Composer will also create our namespaced class autoloader at this time.</p>
<section aria-labelledby="sec12" epub:type="division">
<h4 class="H2" id="sec12"><span id="toc-link_412"/><span class="SANS_Futura_Std_Bold_Condensed_Oblique_11">The Application Class</span></h4>
<p class="TNI1">Now we’ll declare the <span class="SANS_TheSansMonoCd_W5Regular_11">Application</span> class for our site in <i>src/Application.php</i>. The class will handle requests by either displaying the home page or processing data from the application’s web form. <a href="#lis31-13">Listing 31-13</a> shows the code.</p>
<span id="lis31-13"/>
<pre><code>&lt;?php&#13;
namespace Mattsmithdev;&#13;
&#13;
class Application&#13;
{&#13;
    public function run(): void&#13;
    {&#13;
        $action = filter_input(INPUT_GET, 'action');&#13;
        switch ($action) {&#13;
            case 'processForm': <span aria-label="annotation1" class="codewide_CodeAnnotation">❶</span>&#13;
<span aria-label="649" epub:type="pagebreak" id="pg_649" role="doc-pagebreak"/>                $address = filter_input(INPUT_POST, 'address');&#13;
                $date = filter_input(INPUT_POST, 'date');&#13;
                if (empty($address) || empty($date)) {<span aria-label="annotation2" class="codewide_CodeAnnotation">❷</span>&#13;
                    $this-&gt;homepage('you must enter a valid address and a date');&#13;
                } else {&#13;
                    $this-&gt;processForm($date, $address);&#13;
                }&#13;
                break;&#13;
&#13;
            default: <span aria-label="annotation3" class="codewide_CodeAnnotation">❸</span>&#13;
                $this-&gt;homepage();&#13;
        }&#13;
    }&#13;
&#13;
    private function homepage(string $errorMessage = ''): void <span aria-label="annotation4" class="codewide_CodeAnnotation">❹</span>&#13;
    {&#13;
        require_once __DIR__ . '/../templates/homepage.php';&#13;
    }&#13;
&#13;
    private function processForm(string $dateString, string $address): void&#13;
    {&#13;
        try {&#13;
            $streetMapper = new StreetMap();&#13;
            $latLongArray = $streetMapper-&gt;getOpenStreetMapData($address); <span aria-label="annotation5" class="codewide_CodeAnnotation">❺</span>&#13;
            $latitude = $latLongArray['latitude'];&#13;
            $longitude = $latLongArray['longitude'];&#13;
&#13;
            $date = new \DateTimeImmutable($dateString);&#13;
            $sunData = new SunData($date, $latitude, $longitude); <span aria-label="annotation6" class="codewide_CodeAnnotation">❻</span>&#13;
            $sunrise = $sunData-&gt;getSunrise()-&gt;format('g:ia');&#13;
            $sunset = $sunData-&gt;getSunset()-&gt;format('g:ia');&#13;
            $hoursDaylight = $sunData-&gt;getHoursDaylight()-&gt;format("%h hours %i minutes"); <span aria-label="annotation7" class="codewide_CodeAnnotation">❼</span>&#13;
&#13;
            require_once __DIR__ . '/../templates/result.php'; <span aria-label="annotation8" class="codewide_CodeAnnotation">❽</span>&#13;
        }   catch (\Exception) {<span aria-label="annotation9" class="codewide_CodeAnnotation">❾</span>&#13;
            print 'sorry - an error occurred trying to retrieve data from Open Street Map';&#13;
            print '&lt;br&gt;';&#13;
            print '&lt;a href="/"&gt;home&lt;/a&gt;';&#13;
        }&#13;
    }&#13;
}</code></pre>
<p class="CodeListingCaption"><span class="SANS_Futura_Std_Book_Oblique_11">Listing 31-13: The</span> <span class="TheSansMonoCd_W5Regular_Italic_11">Application</span> <span class="SANS_Futura_Std_Book_Oblique_11">class declaring two routes</span></p>
<p class="TX">As usual, the class’s <span class="SANS_TheSansMonoCd_W5Regular_11">run()</span> method uses a <span class="SANS_TheSansMonoCd_W5Regular_11">switch</span> statement to handle incoming requests. First, we declare the case for when <span class="SANS_TheSansMonoCd_W5Regular_11">$action</span> is <span class="SANS_TheSansMonoCd_W5Regular_11">'processForm'</span> <span aria-label="annotation1" class="CodeAnnotation">❶</span>. For this case, we attempt to extract the <span class="SANS_TheSansMonoCd_W5Regular_11">address</span> and <span class="SANS_TheSansMonoCd_W5Regular_11">date</span> variables from the <span class="SANS_TheSansMonoCd_W5Regular_11">POST</span> data in the request. If either is empty <span aria-label="annotation2" class="CodeAnnotation">❷</span>, we invoke the <span class="SANS_TheSansMonoCd_W5Regular_11">homepage()</span> method, passing in an error message. Otherwise, we pass along the address and date to the <span class="SANS_TheSansMonoCd_W5Regular_11">processForm()</span> method.</p>
<p class="TX">The only other case in the <span class="SANS_TheSansMonoCd_W5Regular_11">switch</span> statement is the default route <span aria-label="annotation3" class="CodeAnnotation">❸</span>, which simply invokes the <span class="SANS_TheSansMonoCd_W5Regular_11">homepage()</span> method without any arguments. The <span class="SANS_TheSansMonoCd_W5Regular_11">homepage()</span> method itself <span aria-label="annotation4" class="CodeAnnotation">❹</span> uses <span class="SANS_TheSansMonoCd_W5Regular_11">require_once</span> to display the <i>homepage.php</i> template (we’re <span aria-label="650" epub:type="pagebreak" id="pg_650" role="doc-pagebreak"/>using regular PHP files for templating rather than Twig for simplicity). The method has an <span class="SANS_TheSansMonoCd_W5Regular_11">$errorMessage</span> parameter with a default value of an empty string. This variable will be in the scope of the template for printing.</p>
<p class="TX">The meat of this class is the <span class="SANS_TheSansMonoCd_W5Regular_11">processForm()</span> method, which takes in the submitted address and date as strings and uses them to obtain sunrise and sunset times, along with a total duration of daylight. We first need to convert the address into latitude and longitude coordinates. For that, we create a new <span class="SANS_TheSansMonoCd_W5Regular_11">StreetMap</span> object (we’ll look at this class shortly) and invoke its <span class="SANS_TheSansMonoCd_W5Regular_11">getOpenStreetMapData()</span> method <span aria-label="annotation5" class="CodeAnnotation">❺</span>, passing in the <span class="SANS_TheSansMonoCd_W5Regular_11">$address</span> string. The result, in the <span class="SANS_TheSansMonoCd_W5Regular_11">$latLongArray</span> variable, is an array with <span class="SANS_TheSansMonoCd_W5Regular_11">'latitude'</span> and <span class="SANS_TheSansMonoCd_W5Regular_11">'longitude'</span> keys holding the necessary coordinates, which we extract into separate variables.</p>
<p class="TX">Next, we use the date string submitted through the web form to create a corresponding <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeImmutable</span> object called <span class="SANS_TheSansMonoCd_W5Regular_11">$date</span>. We then create a new <span class="SANS_TheSansMonoCd_W5Regular_11">SunData</span> object (another class we’ll look at shortly), passing <span class="SANS_TheSansMonoCd_W5Regular_11">$date</span>, <span class="SANS_TheSansMonoCd_W5Regular_11">$latitude</span>, and <span class="SANS_TheSansMonoCd_W5Regular_11">$longitude</span> as arguments <span aria-label="annotation6" class="CodeAnnotation">❻</span>. The <span class="SANS_TheSansMonoCd_W5Regular_11">SunData</span> object uses the provided information to calculate the sunrise and sunset times and the daylight duration. We extract this data into individual variables via the appropriate getter methods, which are chained with calls to <span class="SANS_TheSansMonoCd_W5Regular_11">format()</span> to convert the date-time information into strings. The <span class="SANS_TheSansMonoCd_W5Regular_11">$sunrise</span> and <span class="SANS_TheSansMonoCd_W5Regular_11">$sunset</span> variables are given in the form <span class="SANS_TheSansMonoCd_W5Regular_11">8.35am</span>. The <span class="SANS_TheSansMonoCd_W5Regular_11">$hoursDaylight</span> variable is a <span class="SANS_TheSansMonoCd_W5Regular_11">DateInterval</span> object presented in the form <span class="SANS_TheSansMonoCd_W5Regular_11">16 hours 39 minutes</span>, using <span class="SANS_TheSansMonoCd_W5Regular_11">%h</span> for the hours and <span class="SANS_TheSansMonoCd_W5Regular_11">%i</span> for minutes <span aria-label="annotation7" class="CodeAnnotation">❼</span>. With all these variables in scope, we display the <i>result.php</i> template <span aria-label="annotation8" class="CodeAnnotation">❽</span>.</p>
<p class="TX">All this activity in the <span class="SANS_TheSansMonoCd_W5Regular_11">processForm()</span> method is embedded inside a <span class="SANS_TheSansMonoCd_W5Regular_11">try</span> block. If something goes wrong, such as a failure to connect to OpenStreetMap, the <span class="SANS_TheSansMonoCd_W5Regular_11">catch</span> statement at the end of the method <span aria-label="annotation9" class="CodeAnnotation">❾</span> displays an error message along with a link back to the home page.</p>
</section>
<section aria-labelledby="sec13" epub:type="division">
<h4 class="H2" id="sec13"><span id="toc-link_413"/><span class="SANS_Futura_Std_Bold_Condensed_Oblique_11">The Supporting Classes</span></h4>
<p class="TNI1">We’ll next declare the supporting classes for the application, starting with <span class="SANS_TheSansMonoCd_W5Regular_11">StreetMap</span>, which manages working with the OpenStreetMap web server. Create <i>src/StreetMap.php</i> as shown in <a href="#lis31-14">Listing 31-14</a>.</p>
<span id="lis31-14"/>
<pre><code>&lt;?php&#13;
namespace Mattsmithdev;&#13;
&#13;
use GuzzleHttp\Client;&#13;
&#13;
class StreetMap&#13;
{&#13;
    private Client $client;&#13;
&#13;
    public function __construct()&#13;
    {&#13;
        $this-&gt;client = new Client([&#13;
            'timeout' =&gt; 10.0,&#13;
            'headers' =&gt; [&#13;
                'User-Agent' =&gt; 'matt smith demo',&#13;
              <span aria-label="annotation1" class="Code_CodeAnnotation">❶</span> 'Accept'     =&gt; 'application/json',&#13;
            ],&#13;
<span aria-label="651" epub:type="pagebreak" id="pg_651" role="doc-pagebreak"/>            'verify' =&gt; true,&#13;
        ]);&#13;
    }&#13;
&#13;
    public function getOpenStreetMapData(&#13;
        string $address = 'grafton street, dublin, ireland'&#13;
    ): array&#13;
    {&#13;
        $url = $this-&gt;buildQueryString($address);&#13;
      <span aria-label="annotation2" class="Code_CodeAnnotation">❷</span> $response = $this-&gt;client-&gt;request('GET', $url);&#13;
&#13;
        if ($response-&gt;getStatusCode() == 200) {&#13;
            $responseBody = $response-&gt;getBody();&#13;
          <span aria-label="annotation3" class="Code_CodeAnnotation">❸</span> $jsonData = json_decode($responseBody, true);&#13;
            if (empty($jsonData)) {&#13;
                throw new \Exception('no JSON data received');&#13;
            }&#13;
        } else {&#13;
          <span aria-label="annotation4" class="Code_CodeAnnotation">❹</span> throw new \Exception('Invalid status code');&#13;
        }&#13;
&#13;
      <span aria-label="annotation5" class="Code_CodeAnnotation">❺</span> return [&#13;
            'latitude' =&gt; $jsonData[0]['lat'],&#13;
            'longitude' =&gt; $jsonData[0]['lon'],&#13;
        ];&#13;
    }&#13;
&#13;
    private function buildQueryString(string $address): string&#13;
    {&#13;
      <span aria-label="annotation6" class="Code_CodeAnnotation">❻</span> $query = http_build_query([&#13;
            'format'         =&gt; 'jsonv2',&#13;
            'q'              =&gt; $address,&#13;
            'addressdetails' =&gt; 1,&#13;
        ]);&#13;
&#13;
        $url = "https://nominatim.openstreetmap.org/search?$query";&#13;
&#13;
        return $url;&#13;
    }&#13;
}</code></pre>
<p class="CodeListingCaption"><span class="SANS_Futura_Std_Book_Oblique_11">Listing 31-14: The</span> <span class="TheSansMonoCd_W5Regular_Italic_11">StreetMap</span> <span class="SANS_Futura_Std_Book_Oblique_11">class for accessing the OpenStreetMap server</span></p>
<p class="TX">First, the <span class="SANS_TheSansMonoCd_W5Regular_11">use</span> statement allows us to draw on the Guzzle library’s <span class="SANS_TheSansMonoCd_W5Regular_11">Client</span> class, which is in the <span class="SANS_TheSansMonoCd_W5Regular_11">GuzzleHttp</span> namespace. This class will manage the details of making an HTTP request to an external site. We then declare the <span class="SANS_TheSansMonoCd_W5Regular_11">client</span> instance variable and initialize it as a <span class="SANS_TheSansMonoCd_W5Regular_11">Client</span> object in the constructor. We provide various Guzzle <span class="SANS_TheSansMonoCd_W5Regular_11">Client</span> parameters, such as the time-out (the amount of time to wait for a response) and the sending agent name (<span class="SANS_TheSansMonoCd_W5Regular_11">'matt smith demo'</span> is fine for this project). We take care to configure the <span class="SANS_TheSansMonoCd_W5Regular_11">Client</span> to accept JSON data <span aria-label="annotation1" class="CodeAnnotation">❶</span>, since that’s the format returned by the OpenStreetMap API.</p>
<p class="TX"><span aria-label="652" epub:type="pagebreak" id="pg_652" role="doc-pagebreak"/>Next, we declare the <span class="SANS_TheSansMonoCd_W5Regular_11">getOpenStreetMapData()</span> method. It takes in an address (I’ve provided a default value for testing purposes) and uses it to build an appropriate query string via the <span class="SANS_TheSansMonoCd_W5Regular_11">buildQueryString()</span> method. Then it uses the <span class="SANS_TheSansMonoCd_W5Regular_11">request()</span> method of the <span class="SANS_TheSansMonoCd_W5Regular_11">Client</span> object to send the request to the OpenStreetMap API and store the received response <span aria-label="annotation2" class="CodeAnnotation">❷</span>. If the response code is valid (<span class="SANS_TheSansMonoCd_W5Regular_11">200</span>), the received data is decoded into a <span class="SANS_TheSansMonoCd_W5Regular_11">$jsonData</span> array <span aria-label="annotation3" class="CodeAnnotation">❸</span>. If either the response code isn’t <span class="SANS_TheSansMonoCd_W5Regular_11">200</span> or an empty array is received, we throw an exception to signal to the calling code that there has been a problem getting data from the OpenStreetMap API <span aria-label="annotation4" class="CodeAnnotation">❹</span>. If the code gets through the <span class="SANS_TheSansMonoCd_W5Regular_11">if...else</span> statement without throwing an exception, the latitude and longitude are extracted from the received <span class="SANS_TheSansMonoCd_W5Regular_11">$jsonData</span> and returned as an array <span aria-label="annotation5" class="CodeAnnotation">❺</span>.</p>
<p class="TX">Finally, we declare the <span class="SANS_TheSansMonoCd_W5Regular_11">buildQueryString()</span> method. It uses PHP’s built-in <span class="SANS_TheSansMonoCd_W5Regular_11">http_build_query()</span> function to encode the address and other details into an appropriate query string for the Nominatim OpenStreetMap API <span aria-label="annotation6" class="CodeAnnotation">❻</span>. We provide the query information to <span class="SANS_TheSansMonoCd_W5Regular_11">http_build_query()</span> as key/value pairs in an array, then attach the encoded query string, in variable <span class="SANS_TheSansMonoCd_W5Regular_11">$query</span>, to the end of a <span class="SANS_TheSansMonoCd_W5Regular_11">$url</span>.</p>
<blockquote>
<p class="Note"><span class="SANS_Dogma_OT_Bold_B_15">NOTE</span></p>
</blockquote>
<p class="NOTE-TXT"><i>For more about the requirements of the Nominatim OpenStreetMap API, see</i> <span class="note_LinkURL"><a href="https://nominatim.org">https://nominatim.org</a></span><i>.</i> <span class="note">Nominatim</span> <i>(Latin for “by name”) is an open source software project that offers searching of OpenStreetMap data. It facilitates both</i> <span class="note">geocoding</span> <i>(location from a given name and address) and</i> <span class="note">reverse geocoding</span> <i>(address from a given location).</i></p>
<p class="TX">Now we’ll look at the <span class="SANS_TheSansMonoCd_W5Regular_11">SunData</span> class, which is designed to simplify the process of working with PHP’s built-in <span class="SANS_TheSansMonoCd_W5Regular_11">date_sun_info()</span> function. Declare the class in <i>src/SunData.php</i> as in <a href="#lis31-15">Listing 31-15</a>.</p>
<span id="lis31-15"/>
<pre><code>&lt;?php&#13;
namespace Mattsmithdev;&#13;
&#13;
class SunData&#13;
{&#13;
    private \DateTimeImmutable $sunrise;&#13;
    private \DateTimeImmutable $sunset;&#13;
    private \DateInterval $hoursDaylight;&#13;
&#13;
    public function __construct(\DateTimeImmutable $date, float $latitude, float $longitude)&#13;
    {&#13;
        $timestamp = $date-&gt;getTimestamp(); <span aria-label="annotation1" class="codewide_CodeAnnotation">❶</span>&#13;
        $data = date_sun_info($timestamp, $latitude, $longitude); <span aria-label="annotation2" class="codewide_CodeAnnotation">❷</span>&#13;
&#13;
        $this-&gt;sunrise = $this-&gt;dateFromTimestamp($data['sunrise']);&#13;
        $this-&gt;sunset = $this-&gt;dateFromTimestamp($data['sunset']);&#13;
        $this-&gt;hoursDaylight = $this-&gt;sunset-&gt;diff($this-&gt;sunrise); <span aria-label="annotation3" class="codewide_CodeAnnotation">❸</span>&#13;
    }&#13;
&#13;
    private function dateFromTimestamp(int $timestamp): \DateTimeImmutable&#13;
    {&#13;
        return (new \DateTimeImmutable())-&gt;setTimeStamp($timestamp); <span aria-label="annotation4" class="codewide_CodeAnnotation">❹</span>&#13;
    }&#13;
&#13;
<span aria-label="653" epub:type="pagebreak" id="pg_653" role="doc-pagebreak"/>    public function getSunrise(): \DateTimeImmutable&#13;
    {&#13;
        return $this-&gt;sunrise;&#13;
    }&#13;
&#13;
    public function getSunset(): \DateTimeImmutable&#13;
    {&#13;
        return $this-&gt;sunset;&#13;
    }&#13;
&#13;
    public function getHoursDaylight(): \DateInterval&#13;
    {&#13;
        return $this-&gt;hoursDaylight;&#13;
    }&#13;
}</code></pre>
<p class="CodeListingCaption"><span class="SANS_Futura_Std_Book_Oblique_11">Listing 31-15: The</span> <span class="TheSansMonoCd_W5Regular_Italic_11">SunData</span> <span class="SANS_Futura_Std_Book_Oblique_11">class for working with the</span> <span class="TheSansMonoCd_W5Regular_Italic_11">date_sun_info()</span> <span class="SANS_Futura_Std_Book_Oblique_11">function</span></p>
<p class="TX">We give the <span class="SANS_TheSansMonoCd_W5Regular_11">SunData</span> class three instance variables: <span class="SANS_TheSansMonoCd_W5Regular_11">sunrise</span> and <span class="SANS_TheSansMonoCd_W5Regular_11">sunset</span> are <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeImmutable</span> objects for the sunrise and sunset times, and <span class="SANS_TheSansMonoCd_W5Regular_11">hoursDaylight</span> is a <span class="SANS_TheSansMonoCd_W5Regular_11">DateInterval</span> object for the duration of daylight. The <span class="SANS_TheSansMonoCd_W5Regular_11">SunData</span> constructor takes in three arguments: the date (a <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeImmutable</span> object) and the latitude and longitude of the location of interest. These are the pieces of information the <span class="SANS_TheSansMonoCd_W5Regular_11">date_sun_info()</span> function needs, although the date must be in the form of a Unix timestamp, so the constructor starts by calling <span class="SANS_TheSansMonoCd_W5Regular_11">getTime stamp()</span> to make the conversion <span aria-label="annotation1" class="CodeAnnotation">❶</span>.</p>
<p class="TX">Then we call <span class="SANS_TheSansMonoCd_W5Regular_11">date_sun_info()</span>, storing the result, an array of information, in the <span class="SANS_TheSansMonoCd_W5Regular_11">$data</span> variable <span aria-label="annotation2" class="CodeAnnotation">❷</span>. We extract the sunrise and sunset times from the <span class="SANS_TheSansMonoCd_W5Regular_11">$data</span> array, storing them in the appropriate instance variables. Because <span class="SANS_TheSansMonoCd_W5Regular_11">date_sun_info()</span> returns date-time information as Unix timestamps, we use the <span class="SANS_TheSansMonoCd_W5Regular_11">dateFromTimestamp()</span> helper method to convert back from timestamps to <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeImmutable</span> objects. (In this method, notice once again that we have to add extra parentheses around the creation of the new <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeImmutable</span> object before we can call its <span class="SANS_TheSansMonoCd_W5Regular_11">setTimeStamp()</span> method <span aria-label="annotation4" class="CodeAnnotation">❹</span>.)</p>
<p class="TX">For the duration of daylight, we simply take the difference between the sunset and sunrise times <span aria-label="annotation3" class="CodeAnnotation">❸</span>. The remainder of the <span class="SANS_TheSansMonoCd_W5Regular_11">SunData</span> class consists of simple getter methods to return the three instance variables.</p>
</section>
<section aria-labelledby="sec14" epub:type="division">
<h4 class="H2" id="sec14"><span id="toc-link_414"/><span class="SANS_Futura_Std_Bold_Condensed_Oblique_11">The Templates</span></h4>
<p class="TNI1">We’re now ready to create the templates for the home page (with the web form) and the results page. We’ll start with the Home page template in <i>templates/homepage.php</i>. <a href="#lis31-16">Listing 31-16</a> shows the code.</p>
<span id="lis31-16"/>
<pre><code>&lt;!doctype html&gt;&#13;
&lt;html lang="en"&gt;&#13;
&lt;head&gt;&lt;title&gt;Sun Data&lt;/title&gt;&lt;/head&gt;&#13;
&lt;body&gt;&#13;
<span aria-label="annotation1" class="codeannotated_CodeAnnotation">❶</span> &lt;?php if (!empty($errorMessage)): ?&gt;&#13;
    &lt;p style="background-color: pink; padding: 2rem"&gt;&#13;
        &lt;?= $errorMessage ?&gt;&#13;
    &lt;/p&gt;&#13;
<span aria-label="654" epub:type="pagebreak" id="pg_654" role="doc-pagebreak"/>&lt;?php endif; ?&gt;&#13;
&#13;
&lt;form action="/?action=processForm" method="post"&gt;&#13;
    &lt;p&gt;&#13;
        Address:&#13;
        &lt;input name="address"&gt;&#13;
    &lt;/p&gt;&#13;
    &lt;p&gt;&#13;
      <span aria-label="annotation2" class="Code_CodeAnnotation">❷</span> &lt;input name="date" type="date"&gt;&#13;
    &lt;/p&gt;&#13;
    &lt;input type="submit"&gt;&#13;
&lt;/form&gt;&#13;
&lt;/body&gt;&#13;
&lt;/html&gt;</code></pre>
<p class="CodeListingCaption"><span class="SANS_Futura_Std_Book_Oblique_11">Listing 31-16: The form to input an address and date from the user</span></p>
<p class="TX">In the body of the page, we first use the alternative <span class="SANS_TheSansMonoCd_W5Regular_11">if</span> statement syntax to display a pink-styled paragraph containing an error message string, provided the <span class="SANS_TheSansMonoCd_W5Regular_11">$errorMessage</span> variable isn’t empty <span aria-label="annotation1" class="CodeAnnotation">❶</span>. Then we create a form with an action of <span class="SANS_TheSansMonoCd_W5Regular_11">processForm</span> and fields for the address and date. For the latter, we use an <span class="SANS_TheSansMonoCd_W5Regular_11">&lt;input&gt;</span> element of type <span class="SANS_TheSansMonoCd_W5Regular_11">date</span> <span aria-label="annotation2" class="CodeAnnotation">❷</span>, which most web browsers display as a user-friendly calendar date-picker widget, as shown earlier in <a href="#fig31-1">Figure 31-1</a>.</p>
<p class="TX">The second template is for displaying the results to the user. Create <i>templates/result.php</i> with the code in <a href="#lis31-17">Listing 31-17</a>.</p>
<span id="lis31-17"/>
<pre><code>&lt;!doctype html&gt;&#13;
&lt;html lang="en"&gt;&#13;
&lt;head&gt;&lt;title&gt;results&lt;/title&gt;&lt;/head&gt;&#13;
&lt;body&gt;&#13;
&lt;a href="/"&gt;(back to home page)&lt;/a&gt; <span aria-label="annotation1" class="codewide_CodeAnnotation">❶</span>&#13;
&lt;hr&gt;&#13;
&#13;
&lt;h1&gt;Latitude and Longitude&lt;/h1&gt;&#13;
Date = &lt;?= $dateString ?&gt;&lt;br&gt;&#13;
Latitude = &lt;?= $latitude ?&gt;&lt;br&gt;&#13;
Longitude = &lt;?= $longitude ?&gt;&lt;br&gt;&#13;
&#13;
&lt;a href="http://www.openstreetmap.org/?zoom=17&amp;mlat=&lt;?= $latitude ?&gt;&amp;mlon=&lt;?= $longitude ?&gt;"&gt; <span aria-label="annotation2" class="codewide_CodeAnnotation">❷</span>&#13;
    Open maps link to: &lt;?= $address ?&gt;&#13;
&lt;/a&gt;&#13;
&#13;
&lt;hr&gt;&#13;
Sunrise &lt;img src="/images/sunrise.png" width="50" alt="Sunrise"&gt;&#13;
&lt;?= $sunrise ?&gt;&#13;
&lt;br&gt;&#13;
Sunset &lt;img src="/images/sunset.png" width="50" alt="Sunset"&gt;&#13;
&lt;?= $sunset ?&gt;&#13;
&lt;p&gt;&#13;
    so there will be &lt;?= $hoursDaylight ?&gt; of daylight&#13;
&lt;/p&gt;&#13;
&#13;
<span aria-label="655" epub:type="pagebreak" id="pg_655" role="doc-pagebreak"/>&lt;footer&gt; <span aria-label="annotation3" class="codewide_CodeAnnotation">❸</span>&#13;
    icon attribution:&#13;
    &lt;a href="https://www.flaticon.com/free-icon/sunrise_3920688" title="sunrise icons"&gt;&#13;
        Sunrise&lt;/a&gt;&#13;
    &lt;a href="https://www.flaticon.com/free-icon/sunset_3920799" title="sunset icons"&gt;&#13;
        Sunset&lt;/a&gt;&#13;
    icons created by Mehwish - Flaticon&#13;
&lt;/footer&gt;&#13;
&lt;/body&gt;&#13;
&lt;/html&gt;</code></pre>
<p class="CodeListingCaption"><span class="SANS_Futura_Std_Book_Oblique_11">Listing 31-17: The template to present sun data results to the user</span></p>
<p class="TX">In this template, we first offer the user a link back the home page <span aria-label="annotation1" class="CodeAnnotation">❶</span>. Then we display the provided date and the latitude and longitude corresponding to the provided address.</p>
<p class="TX">Next, we offer a link to view the location in OpenStreetMap, with the values of the <span class="SANS_TheSansMonoCd_W5Regular_11">$latitude</span> and <span class="SANS_TheSansMonoCd_W5Regular_11">$longitude</span> variables inserted into the link for the <span class="SANS_TheSansMonoCd_W5Regular_11">mlat</span> and <span class="SANS_TheSansMonoCd_W5Regular_11">mlon</span> query fields <span aria-label="annotation2" class="CodeAnnotation">❷</span>. We then output the sunrise, sunset, and hours of daylight values, along with appropriate images next to the sunrise and sunset times (<i>sunrise.png</i> and <i>sunset.png</i>, from user Mehwish at <i><a href="https://www.flaticon.com">https://www.flaticon.com</a></i>).</p>
<p class="TX">Links to these images, with acknowledgment to the publisher, are provided in the page’s footer element <span aria-label="annotation3" class="CodeAnnotation">❸</span>. Download these images and copy them into the <i>public/images</i> directory to complete the creation of the web application. Then try running the web server and testing out the application with different dates and addresses.</p>
<p class="TX">This project has brought together lots of the concepts from this chapter, demonstrating a practical use for the <span class="SANS_TheSansMonoCd_W5Regular_11">DateInterval</span> class and showing how to juggle between <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeImmutable</span> objects and Unix timestamps. It also illustrates the power of open source libraries, in this case showing how Guzzle makes it easy to send requests to external APIs and process the returned JSON data.</p>
</section>
</section>
<section aria-labelledby="sec15" epub:type="division">
<h3 class="H1" id="sec15"><span id="toc-link_415"/><span class="SANS_Futura_Std_Bold_B_11">MySQL Dates</span></h3>
<p class="TNI1">When working in PHP, using native PHP date and time objects and functions makes sense. When storing temporal data in a database, however, it’s best to use the database system’s native format. This way, database queries can be performed on the fields, and applications written in other programming languages can also work with the stored database data. It’s therefore important to understand the database formats for date-time information and learn how to convert between PHP and the relevant database formats when reading and writing to the database system. In this section, we’ll look at how MySQL handles date-time information, but the principles are the same for any DBMS.</p>
<p class="TX">MySQL can store dates, date-times, and timestamps, but we’ll focus on date-times here. The basic individual date and time formats for MySQL are the same as ISO 8601, with dates in the form <span class="SANS_TheSansMonoCd_W5Regular_Italic_11">YYYY</span><span class="SANS_TheSansMonoCd_W5Regular_11">-</span><span class="SANS_TheSansMonoCd_W5Regular_Italic_11">MM</span><span class="SANS_TheSansMonoCd_W5Regular_11">-</span><span class="SANS_TheSansMonoCd_W5Regular_Italic_11">DD</span> and times in the <span aria-label="656" epub:type="pagebreak" id="pg_656" role="doc-pagebreak"/>form <span class="SANS_TheSansMonoCd_W5Regular_Italic_11">HH</span><span class="SANS_TheSansMonoCd_W5Regular_11">:</span><span class="SANS_TheSansMonoCd_W5Regular_Italic_11">MM</span><span class="SANS_TheSansMonoCd_W5Regular_11">:</span><span class="SANS_TheSansMonoCd_W5Regular_Italic_11">SS</span>. However, MySQL uses a space rather than the letter <span class="SANS_TheSansMonoCd_W5Regular_11">T</span> as the separator between the date and time components, so <span class="SANS_TheSansMonoCd_W5Regular_11">1968-11-22T09:05:30</span> in ISO 8601 format would appear as <span class="SANS_TheSansMonoCd_W5Regular_11">1968-11-22 09:05:30</span> when stored in MySQL. Like PHP, MySQL can add decimal places to the time component to store fractions of seconds, down to microseconds (six decimal places).</p>
<p class="TX">To specify that you want a column in a MySQL table to store date-times, declare the column with the <span class="SANS_TheSansMonoCd_W5Regular_11">DATETIME</span> data type. Modern MySQL systems default to zero decimal places for the time component (whole seconds). To include fractions of a second, add the desired number of decimal places in parentheses after the data type. For example, to store date-times down to the microsecond, you’d declare a column of type <span class="SANS_TheSansMonoCd_W5Regular_11">DATETIME(6)</span>.</p>
<p class="TX">MySQL stores date-time data as UTC values. Therefore, if the MySQL server is set to a time zone that isn’t UTC, it will convert any date-times to UTC for storage and then convert them back from UTC upon retrieval. In practice, it’s common to create UTC <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeImmutable</span> objects for storage in the database, and to have the web application logic convert retrieved date-times to any other desired time zone.</p>
<blockquote>
<p class="Note"><span class="SANS_Dogma_OT_Bold_B_15">NOTE</span></p>
</blockquote>
<p class="NOTE-TXT"><i>If you’re using the</i> <span class="SANS_TheSansMonoCd_W5Regular_Italic_11">TIMESTAMP</span> <i>data type in MySQL, be aware that MySQL will automatically convert it to UTC, using the time-zone settings of your MySQL server.</i></p>
<p class="TX">To create a MySQL <span class="SANS_TheSansMonoCd_W5Regular_11">datetime</span> string for insertion into a table from a PHP script, start with a <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeImmutable</span> object and use its <span class="SANS_TheSansMonoCd_W5Regular_11">format()</span> method, with the format string <span class="SANS_TheSansMonoCd_W5Regular_11">'Y-m-d H:i:s'</span> for whole seconds or <span class="SANS_TheSansMonoCd_W5Regular_11">'Y-m-d H:i:s.u'</span> for fractional seconds. Notice in particular the space between the <span class="SANS_TheSansMonoCd_W5Regular_11">d</span> and the <span class="SANS_TheSansMonoCd_W5Regular_11">H</span>. Likewise, having retrieved a date-time string from MySQL, you can use the <span class="SANS_TheSansMonoCd_W5Regular_11">createFromFormat()</span> static method of the <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeImmutable</span> class to get an equivalent <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeImmutable</span> object for that MySQL data.</p>
<p class="TX">To demonstrate how to go back and forth between <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeImmutable</span> objects and MySQL <span class="SANS_TheSansMonoCd_W5Regular_11">DATETIME</span> fields, let’s create a project with an <span class="SANS_TheSansMonoCd_W5Regular_11">Appointment</span> entity class and a corresponding <span class="SANS_TheSansMonoCd_W5Regular_11">appointment</span> database table to hold the names and date-times of appointments. Start a new project with the usual <i>composer.json</i> file, and enter <span class="SANS_TheSansMonoCd_W7Bold_11">composer dump-autoload</span> at the command line to generate the autoloader. Then create a new MySQL database schema called <span class="SANS_TheSansMonoCd_W5Regular_11">date1</span>, and create an <span class="SANS_TheSansMonoCd_W5Regular_11">appointment</span> table in that schema by using the SQL statement in <a href="#lis31-18">Listing 31-18</a>. (See <span class="Xref">“Setting Up the Database Schema” on <a href="chapter28.xhtml#pg_543">page 543</a></span> to review how to integrate this SQL statement into a PHP script.)</p>
<span id="lis31-18"/>
<pre><code>CREATE TABLE IF NOT EXISTS appointment (&#13;
    id integer PRIMARY KEY AUTO_INCREMENT,&#13;
    title text,&#13;
    startdatetime datetime(6)&#13;
)</code></pre>
<p class="CodeListingCaption"><span class="SANS_Futura_Std_Book_Oblique_11">Listing 31-18: The SQL to create the</span> <span class="TheSansMonoCd_W5Regular_Italic_11">appointment</span> <span class="SANS_Futura_Std_Book_Oblique_11">MySQL database table</span></p>
<p class="TX">The table has an auto-incrementing <span class="SANS_TheSansMonoCd_W5Regular_11">id</span> field for the primary key, a <span class="SANS_TheSansMonoCd_W5Regular_11">title</span> field for a description of the appointment, and a <span class="SANS_TheSansMonoCd_W5Regular_11">startdatetime</span> field for when it begins. We declare the <span class="SANS_TheSansMonoCd_W5Regular_11">startdatetime</span> field to be of type <span class="SANS_TheSansMonoCd_W5Regular_11">datetime(6)</span> to <span aria-label="657" epub:type="pagebreak" id="pg_657" role="doc-pagebreak"/>illustrate working with fractions of a second, but note that MySQL’s default of zero decimal places would be sufficient for the majority of real-world meeting or appointment applications.</p>
<p class="TX">Now we’ll declare the <span class="SANS_TheSansMonoCd_W5Regular_11">Appointment</span> class corresponding to this table. Enter the contents of <a href="#lis31-19">Listing 31-19</a> into <i>src/Appointment.php</i>.</p>
<span id="lis31-19"/>
<pre><code>&lt;?php&#13;
namespace Mattsmithdev;&#13;
&#13;
class Appointment&#13;
{&#13;
    private int $id;&#13;
    private string $title;&#13;
    private \DateTimeImmutable $startDateTime; <span aria-label="annotation1" class="codewide_CodeAnnotation">❶</span>&#13;
&#13;
    public function getId(): int&#13;
    {&#13;
        return $this-&gt;id;&#13;
    }&#13;
&#13;
    public function setId(int $id): void&#13;
    {&#13;
        $this-&gt;id = $id;&#13;
    }&#13;
&#13;
    public function getTitle(): string&#13;
    {&#13;
        return $this-&gt;title;&#13;
    }&#13;
&#13;
    public function setTitle(string $title): void&#13;
    {&#13;
        $this-&gt;title = $title;&#13;
    }&#13;
&#13;
    public function getStartDateTime(): \DateTimeImmutable&#13;
    {&#13;
        return $this-&gt;startDateTime;&#13;
    }&#13;
&#13;
    public function setStartDateTime(\DateTimeImmutable|string $startDateTime): void <span aria-label="annotation2" class="codewide_CodeAnnotation">❷</span>&#13;
    {&#13;
        if (is_string($startDateTime)) {&#13;
            $startDateTime = \DateTimeImmutable::createFromFormat(&#13;
                AppointmentRepository::MYSQL_DATE_FORMAT_STRING, $startDateTime);&#13;
        }&#13;
&#13;
        $this-&gt;startDateTime = $startDateTime;&#13;
    }&#13;
}</code></pre>
<p class="CodeListingCaption"><span class="SANS_Futura_Std_Book_Oblique_11">Listing 31-19: The</span> <span class="TheSansMonoCd_W5Regular_Italic_11">Appointment</span> <span class="SANS_Futura_Std_Book_Oblique_11">entity class, containing a</span> <span class="TheSansMonoCd_W5Regular_Italic_11">DateTimeImmutable</span> <span class="SANS_Futura_Std_Book_Oblique_11">property</span></p>
<p class="TX"><span aria-label="658" epub:type="pagebreak" id="pg_658" role="doc-pagebreak"/>The <span class="SANS_TheSansMonoCd_W5Regular_11">Appointment</span> class has <span class="SANS_TheSansMonoCd_W5Regular_11">id</span>, <span class="SANS_TheSansMonoCd_W5Regular_11">title</span>, and <span class="SANS_TheSansMonoCd_W5Regular_11">startDateTime</span> properties to match the columns in the <span class="SANS_TheSansMonoCd_W5Regular_11">appointment</span> table. Notice that the <span class="SANS_TheSansMonoCd_W5Regular_11">startDateTime</span> property is a <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeImmutable</span> object <span aria-label="annotation1" class="CodeAnnotation">❶</span>. We give each property appropriate getter and setter methods. This includes a special setter method for the <span class="SANS_TheSansMonoCd_W5Regular_11">startDateTime</span> property that uses the union type <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeImmutable|string</span> to allow either a <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeImmutable</span> object or a string to be provided as an argument <span aria-label="annotation2" class="CodeAnnotation">❷</span>.</p>
<p class="TX">If the received argument is a string, we convert it to a <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeImmutable</span> object by using the public constant <span class="SANS_TheSansMonoCd_W5Regular_11">MYSQL_DATE_FORMAT_STRING</span> to help with the formatting. (We’ll declare this constant later in the <span class="SANS_TheSansMonoCd_W5Regular_11">AppointmentRepository</span> class.) This mechanism allows the same setter method to work with PHP <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeImmutable</span> objects as well as the MySQL date-time strings received from the database. The extra logic could be avoided by using an ORM library such as Doctrine, which would seamlessly convert between PHP data types and their database equivalents.</p>
<p class="TX">We’ll next create an <span class="SANS_TheSansMonoCd_W5Regular_11">AppointmentRepository</span> class with methods to insert a new appointment into the <span class="SANS_TheSansMonoCd_W5Regular_11">appointments</span> table and fetch all the appointments. For simplicity, we’ll combine the database connection and repository methods into this one class, but see <span class="Xref"><a href="chapter28.xhtml">Chapter 28</a></span> for examples of managing the database connection in a separate <span class="SANS_TheSansMonoCd_W5Regular_11">Database</span> class. Create <i>src/AppointmentRepository.php</i> containing the code in <a href="#lis31-20">Listing 31-20</a>.</p>
<span id="lis31-20"/>
<pre><code>&lt;?php&#13;
namespace Mattsmithdev;&#13;
&#13;
class AppointmentRepository&#13;
{&#13;
    public const MYSQL_DATE_FORMAT_STRING = 'Y-m-d H:i:s.u'; <span aria-label="annotation1" class="codewide_CodeAnnotation">❶</span>&#13;
&#13;
    public const MYSQL_DATABASE = '<span class="TheSansMonoCd_W5Regular_Italic_11">date1</span>';&#13;
    public const MYSQL_HOST = '<span class="TheSansMonoCd_W5Regular_Italic_11">localhost:3306</span>';&#13;
    public const MYSQL_USER = '<span class="TheSansMonoCd_W5Regular_Italic_11">root</span>';&#13;
    public const MYSQL_PASS = '<span class="TheSansMonoCd_W5Regular_Italic_11">passpass</span>';&#13;
&#13;
    private ?\PDO $connection = NULL;&#13;
&#13;
    public function __construct()&#13;
    {&#13;
        try {&#13;
            $this-&gt;connection = new \PDO('mysql:dbname='&#13;
                . self::MYSQL_DATABASE . ';host='&#13;
                . self::MYSQL_HOST , self::MYSQL_USER, self::MYSQL_PASS&#13;
            ); <span aria-label="annotation2" class="codewide_CodeAnnotation">❷</span>&#13;
        } catch (\Exception) {&#13;
            print 'sorry - there was a problem connecting to database ' . self::MYSQL_DATABASE;&#13;
        }&#13;
    }&#13;
&#13;
    public function insert(Appointment $appointment): int&#13;
    {&#13;
        if (NULL == $this-&gt;connection) return -1;&#13;
&#13;
<span aria-label="659" epub:type="pagebreak" id="pg_659" role="doc-pagebreak"/>        $title = $appointment-&gt;getTitle();&#13;
        $startDateTime = $appointment-&gt;getStartDateTime();&#13;
        $dateString = $startDateTime-&gt;format(self::MYSQL_DATE_FORMAT_STRING); <span aria-label="annotation3" class="codewide_CodeAnnotation">❸</span>&#13;
&#13;
        // Prepare SQL&#13;
        $sql = 'INSERT INTO appointment (title, startdatetime) VALUES (:title,&#13;
                                                                       :startdatetime)';&#13;
        $stmt = $this-&gt;connection-&gt;prepare($sql);&#13;
&#13;
        // Bind parameters to statement variables&#13;
        $stmt-&gt;bindParam(':title', $title);&#13;
        $stmt-&gt;bindParam(':startdatetime', $dateString);&#13;
&#13;
        // Execute statement&#13;
        $success = $stmt-&gt;execute();&#13;
&#13;
        if ($success) {&#13;
            return $this-&gt;connection-&gt;lastInsertId();&#13;
        } else {&#13;
            return -1;&#13;
        }&#13;
    }&#13;
&#13;
    public function findAll(): array&#13;
    {&#13;
        $sql = 'SELECT * FROM appointment';&#13;
        $stmt = $this-&gt;connection-&gt;prepare($sql);&#13;
        $stmt-&gt;execute();&#13;
        $objects = $stmt-&gt;fetchAll(); <span aria-label="annotation4" class="codewide_CodeAnnotation">❹</span>&#13;
&#13;
        $appointments = [];&#13;
        foreach ($objects as $object) {&#13;
            $appointment = new Appointment();&#13;
            $appointment-&gt;setId($object['id']);&#13;
            $appointment-&gt;setTitle($object['title']);&#13;
            $appointment-&gt;setStartDateTime($object['startdatetime']);&#13;
            $appointments[] = $appointment;&#13;
        }&#13;
&#13;
        return $appointments;&#13;
    }&#13;
}</code></pre>
<p class="CodeListingCaption"><span class="SANS_Futura_Std_Book_Oblique_11">Listing 31-20: The</span> <span class="TheSansMonoCd_W5Regular_Italic_11">AppointmentRepository</span> <span class="SANS_Futura_Std_Book_Oblique_11">class for MySQL database interaction</span></p>
<p class="TX">We declare a public <span class="SANS_TheSansMonoCd_W5Regular_11">MYSQL_DATE_FORMAT_STRING</span> constant holding the string with the necessary formatting for compatibility between MySQL datetimes and PHP <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeImmutable</span> objects <span aria-label="annotation1" class="CodeAnnotation">❶</span>. We then declare more constants for the database credentials (be sure to fill in your own values for these), along with a private <span class="SANS_TheSansMonoCd_W5Regular_11">connection</span> property to hold the <span class="SANS_TheSansMonoCd_W5Regular_11">PDO</span> database connection object. In the constructor, we create the database connection and store it in the <span class="SANS_TheSansMonoCd_W5Regular_11">connection</span> property <span aria-label="annotation2" class="CodeAnnotation">❷</span>, using a <span class="SANS_TheSansMonoCd_W5Regular_11">try...catch</span> structure to handle any problems.</p>
<p class="TX">We next declare the <span class="SANS_TheSansMonoCd_W5Regular_11">insert()</span> method, which takes in an <span class="SANS_TheSansMonoCd_W5Regular_11">Appointment</span> object and extracts its <span class="SANS_TheSansMonoCd_W5Regular_11">title</span> and <span class="SANS_TheSansMonoCd_W5Regular_11">startDateTime</span> properties into individual <span aria-label="660" epub:type="pagebreak" id="pg_660" role="doc-pagebreak"/>variables. To create the MySQL date string <span class="SANS_TheSansMonoCd_W5Regular_11">$dateString</span>, we pass the <span class="SANS_TheSansMonoCd_W5Regular_11">MYSQL _DATE_FORMAT_STRING</span> constant to the <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeImmutable</span> object’s <span class="SANS_TheSansMonoCd_W5Regular_11">format()</span> method to get the proper string formatting <span aria-label="annotation3" class="CodeAnnotation">❸</span>. We then prepare a SQL <span class="SANS_TheSansMonoCd_W5Regular_11">INSERT</span> statement, populate it with values, and execute the statement to add a new row into the <span class="SANS_TheSansMonoCd_W5Regular_11">appointment</span> table.</p>
<p class="TX">In the <span class="SANS_TheSansMonoCd_W5Regular_11">findAll()</span> method, we use PDO’s <span class="SANS_TheSansMonoCd_W5Regular_11">fetchAll()</span> method to retrieve all the entries from the <span class="SANS_TheSansMonoCd_W5Regular_11">appointment</span> table as an associative array of keys and values <span aria-label="annotation4" class="CodeAnnotation">❹</span>. The method then loops through this array, creating an <span class="SANS_TheSansMonoCd_W5Regular_11">Appointment</span> object from each element and adding it to the <span class="SANS_TheSansMonoCd_W5Regular_11">$appointments</span> array, which is then returned.</p>
<p class="TX">Finally, we’ll create an index script that we can run at the command line to create a few sample <span class="SANS_TheSansMonoCd_W5Regular_11">Appointment</span> objects, add their data to the database, and then retrieve the entries back out of the database as an array of <span class="SANS_TheSansMonoCd_W5Regular_11">Appointment</span> objects. Create <i>public/index.php</i> as in <a href="#lis31-21">Listing 31-21</a>.</p>
<span id="lis31-21"/>
<pre><code>&lt;?php&#13;
require_once __DIR__ . '/../vendor/autoload.php';&#13;
&#13;
use Mattsmithdev\Appointment;&#13;
use Mattsmithdev\AppointmentRepository;&#13;
&#13;
$appointmentRepository = new AppointmentRepository();&#13;
&#13;
$appointment = new Appointment();&#13;
$appointment-&gt;setTitle('get an ice cream sandwich');&#13;
$appointment-&gt;setStartDateTime(new DateTimeImmutable('2009-08-02T11:00:00.5'));&#13;
$appointmentRepository-&gt;insert($appointment);&#13;
&#13;
$appointment2 = new Appointment();&#13;
$appointment2-&gt;setTitle('celebrate birthday');&#13;
$appointment2-&gt;setStartDateTime(new DateTimeImmutable('2025-11-22T09:05:30.77'));&#13;
$appointmentRepository-&gt;insert($appointment2);&#13;
&#13;
$appointments = $appointmentRepository-&gt;findAll();&#13;
foreach ($appointments as $appointment) {&#13;
    var_dump($appointment);&#13;
}</code></pre>
<p class="CodeListingCaption"><span class="SANS_Futura_Std_Book_Oblique_11">Listing 31-21: The index script</span> <span class="SANS_Futura_Std_Book_11">/public/index.php</span> <span class="SANS_Futura_Std_Book_Oblique_11">testing our MySQL date example</span></p>
<p class="TX">We require the autoloader and declare <span class="SANS_TheSansMonoCd_W5Regular_11">use</span> statements for the <span class="SANS_TheSansMonoCd_W5Regular_11">Mattsmithdev</span> namespaced <span class="SANS_TheSansMonoCd_W5Regular_11">AppointmentRepository</span> and <span class="SANS_TheSansMonoCd_W5Regular_11">Appointment</span> classes. Then we create an <span class="SANS_TheSansMonoCd_W5Regular_11">AppointmentRepository</span> object called <span class="SANS_TheSansMonoCd_W5Regular_11">$appointmentRepository</span>, along with two sample <span class="SANS_TheSansMonoCd_W5Regular_11">Appointment</span> objects, which we insert into the database by using the <span class="SANS_TheSansMonoCd_W5Regular_11">$appointmentRepository</span> object’s <span class="SANS_TheSansMonoCd_W5Regular_11">insert()</span> method. Each object is given a time with a fractional second component and is specified using ISO 8601 formatting, including the <span class="SANS_TheSansMonoCd_W5Regular_11">T</span> separator between the date and the time. This formatting doesn’t matter, however, since we’ve written the <span class="SANS_TheSansMonoCd_W5Regular_11">AppointmentRepository</span> class with logic to convert to MySQL date-time formatting. We finish the script by calling the <span class="SANS_TheSansMonoCd_W5Regular_11">findAll()</span> method of the repository object to retrieve all database rows as an array of <span class="SANS_TheSansMonoCd_W5Regular_11">Appointment</span> objects, which we loop through and pass to <span class="SANS_TheSansMonoCd_W5Regular_11">var_dump()</span>.</p>
<p class="TX"><span aria-label="661" epub:type="pagebreak" id="pg_661" role="doc-pagebreak"/>Here’s the output when the index script is executed:</p>
<pre><code>object(Mattsmithdev\Appointment)#9 (3) {&#13;
  ["id":"Mattsmithdev\Appointment":private]=&gt;&#13;
  int(1)&#13;
  ["title":"Mattsmithdev\Appointment":private]=&gt;&#13;
  string(25) "get an ice cream sandwich"&#13;
  ["startDateTime":"Mattsmithdev\Appointment":private]=&gt;&#13;
  object(DateTimeImmutable)#10 (3) {&#13;
    ["date"]=&gt;&#13;
    string(26) "2009-08-02 11:00:00.500000"&#13;
    ["timezone_type"]=&gt;&#13;
    int(3)&#13;
    ["timezone"]=&gt;&#13;
    string(13) "Europe/Dublin"&#13;
  }&#13;
}&#13;
object(Mattsmithdev\Appointment)#11 (3) {&#13;
  ["id":"Mattsmithdev\Appointment":private]=&gt;&#13;
  int(2)&#13;
  ["title":"Mattsmithdev\Appointment":private]=&gt;&#13;
  string(18) "celebrate birthday"&#13;
  ["startDateTime":"Mattsmithdev\Appointment":private]=&gt;&#13;
  object(DateTimeImmutable)#12 (3) {&#13;
    ["date"]=&gt;&#13;
    string(26) "2025-11-22 09:05:30.770000"&#13;
    ["timezone_type"]=&gt;&#13;
    int(3)&#13;
    ["timezone"]=&gt;&#13;
    string(13) "Europe/Dublin"&#13;
  }&#13;
}</code></pre>
<p class="TX">Two appointments have been retrieved from the database and output to the console. The first is the <span class="SANS_TheSansMonoCd_W5Regular_11">'get an ice cream sandwich'</span> appointment, with a start date-time of <span class="SANS_TheSansMonoCd_W5Regular_11">2009-08-02 11:00:00.500000</span>. The second is the <span class="SANS_TheSansMonoCd_W5Regular_11">'celebrate birthday'</span> appointment, with a start date-time of <span class="SANS_TheSansMonoCd_W5Regular_11">2025-11-22 09:05:30.770000</span>. The date components for both have been stored to six decimal places for fractions of a second. Notice that the time zones are Europe/Dublin, the setting for my PHP setup that is applied by default when new <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeImmutable</span> objects are created. If the web application was working with dates from different time zones, one solution would be to store the time zone along with the UTC version of each date-time in the database, then convert the retrieved date-times back to that time zone upon retrieval.</p>
</section>
<section aria-labelledby="sec16" epub:type="division">
<h3 class="H1" id="sec16"><span id="toc-link_416"/><span class="SANS_Futura_Std_Bold_B_11">Summary</span></h3>
<p class="TNI1">Manipulating dates and times is often a necessary part of developing applications, since date-time information provides useful functionality to users (such as maintaining a calendar) and is valuable for recording data about when actions and requests have occurred. In this chapter, we explored the <span aria-label="662" epub:type="pagebreak" id="pg_662" role="doc-pagebreak"/>most useful PHP classes and functions relating to dates and times, including the <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeImmutable</span> and <span class="SANS_TheSansMonoCd_W5Regular_11">DateInterval</span> classes.</p>
<p class="TX">We put these language features to work in a web application that reported sunrise and sunset information, which relied on the Guzzle library to make HTTP requests to an external site. We also looked at how to move date-time information back and forth between PHP scripts and MySQL database tables, converting formats as appropriate.</p>
</section>
<section aria-labelledby="sec17" epub:type="division">
<h3 class="H1" id="sec17"><span id="toc-link_417"/><span class="SANS_Futura_Std_Bold_B_11">Exercises</span></h3>
<p class="ListNumber">1.   Write a script to create (and <span class="SANS_TheSansMonoCd_W5Regular_11">var_dump</span>) <span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeImmutable</span> objects in UTC (Zulu time), Irish Standard Time, and Eastern Standard Time for the following:</p>
<p class="ListPlainSub"><span class="SANS_TheSansMonoCd_W5Regular_11">2025-01-01 10:00:00</span></p>
<p class="ListPlainSub"><span class="SANS_TheSansMonoCd_W5Regular_11">2025-01-02 12:00:00.05</span></p>
<p class="ListNumber">2.   Write a script to create (and <span class="SANS_TheSansMonoCd_W5Regular_11">var_dump</span>) <span class="SANS_TheSansMonoCd_W5Regular_11">DateInterval</span> objects between <span class="SANS_TheSansMonoCd_W5Regular_11">2000-01-01 22:00:00</span> and the following:</p>
<p class="ListPlainSub"><span class="SANS_TheSansMonoCd_W5Regular_11">2000-01-02 22:00:00</span></p>
<p class="ListPlainSub"><span class="SANS_TheSansMonoCd_W5Regular_11">2010-05-06 00:00:00</span></p>
<p class="ListPlainSub"><span class="SANS_TheSansMonoCd_W5Regular_11">2010-05-06 00:00:30</span></p>
<p class="ListPlainSub"><span class="SANS_TheSansMonoCd_W5Regular_11">2020-01-01 22:00:00</span></p>
<p class="ListNumber">3.   Develop a project to create, store, and retrieve patient meetings with doctors. The project should use a MySQL database for storing the records. Base your project around a <span class="SANS_TheSansMonoCd_W5Regular_11">Consultation</span> entity class containing the following properties:</p>
<p class="ListPlainSub">Patient name (<span class="SANS_TheSansMonoCd_W5Regular_11">string</span>)</p>
<p class="ListPlainSub">Doctor name (<span class="SANS_TheSansMonoCd_W5Regular_11">string</span>)</p>
<p class="ListPlainSub">Consultation date and time (<span class="SANS_TheSansMonoCd_W5Regular_11">DateTimeImmutable</span>)</p>
<p class="ListPlainSub">Duration in minutes (<span class="SANS_TheSansMonoCd_W5Regular_11">integer</span>)</p>
<p class="ListBody">Here’s a SQL statement to create a database table for such records:</p>
<pre><code>CREATE TABLE IF NOT EXISTS consultation (&#13;
    id integer PRIMARY KEY AUTO_INCREMENT,&#13;
    patient text,&#13;
    doctor text,&#13;
    duration integer,&#13;
    consultationdatetime datetime&#13;
)</code></pre>
<p class="ListNumber">4.   Create a new project to find the hours of daylight in New York and Dublin on the last day of the previous millennium, December 31, 1999.</p>
</section>
</section>
</div></body></html>