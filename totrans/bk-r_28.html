<html><head></head><body>
<h2 class="h2" id="ch23"><span epub:type="pagebreak" id="page_575"/><span class="big"><strong>23</strong></span><br/><strong>ADVANCED PLOT CUSTOMIZATION</strong></h2>&#13;
<div class="image"><img src="../images/common-01.jpg" alt="image"/></div>&#13;
<p class="noindent">Many users are first drawn to R because of its impressive graphical flexibility and the ease with which you can control and tailor the resulting visuals. In this chapter, you’ll take a closer look at the base R graphics device, and at how you can fine-tune the plots you’re already familiar with, to get the most use out of your visualizations. In the chapters that follow, you’ll then expand your repertoire in both <code>ggplot2</code> and traditional R graphics.</p>&#13;
<p class="indent">Much of this chapter will assume you’re familiar with the content of <a href="ch07.xhtml#ch07">Chapters 7</a> and <a href="ch14.xhtml#ch14">14</a>. In general, I’ll also assume you’re using the standard base R application (for example, <em>R.app</em> on a Mac or <em>Rgui.exe</em> in Windows—see <a href="app01.xhtml#app01">Appendix A</a>), since the behavior and availability of some of the commands can vary if you’re working with R in a different context.</p>&#13;
<p class="indent">Depending on your operating system, the default software drivers used to render graphical displays on your computer screen are also different. In the standard <em>R.app</em> application on a Mac, for example, you’ll notice <span epub:type="pagebreak" id="page_576"/>that producing a live plot will open a window with a banner title that looks something like <em>Quartz 2 [*]</em>—the default graphics device driver for OS X is the Quartz window system. On a Windows machine, you’ll see <em>R Graphics: Device 2 (ACTIVE)</em>. The numbering of any graphics devices always starts at 2; Device 1 is referred to as the <em>null device</em>, meaning there’s nothing active currently.</p>&#13;
<div class="note">&#13;
<p class="notet"><strong><span class="notes">NOTE</span></strong></p>&#13;
<p class="notep"><em>For a list of devices your R session has available, enter</em> <code><span class="codeitalic">?Devices</code></span> <em>at the prompt. You’ll note that the list includes commands such as</em> <code><span class="codeitalic">png</code></span> <em>and</em> <code><span class="codeitalic">pdf</code></span><em>, which are the so-called silent graphics devices that enable direct-to-file plotting, as detailed in <a href="ch08.xhtml#ch08">Chapter 8</a>. You can use a different device for any given plot if you want, though the default is almost always appropriate if you’re plotting directly to your screen.</em></p>&#13;
</div>&#13;
<h3 class="h3" id="ch23lev1sec76"><strong>23.1 Handling the Graphics Device</strong></h3>&#13;
<p class="noindent">So far, your plotting has dealt with one image at a time. It’s possible to have multiple graphics devices open, but only one will be deemed active at any given time (the banner titles highlight the currently active device with the <em>[*]</em> or the <em>(ACTIVE)</em>). This is useful when you’re working on several plots at once or want to view or alter one plot without closing any others.</p>&#13;
<h4 class="h4" id="ch23lev2sec222"><strong><em>23.1.1 Manually Opening a New Device</em></strong></h4>&#13;
<p class="noindent">The typical base R commands you’ve met already (such as <code>plot</code>, <code>hist</code>, <code>boxplot</code>, and so on) will automatically open a device for plotting and draw the desired plot, if nothing is currently open. You can also open new device windows using <code>dev.new</code>; this newest window will immediately become active, and any subsequent plotting commands will affect that particular device.</p>&#13;
<p class="indent">As an example, first close any open graphics windows and then enter the following at the R prompt:</p>&#13;
<pre>R&gt; plot(quakes$long,quakes$lat)</pre>&#13;
<p class="indent">This will generate a plot of the spatial locations of the occurrences of the 1000 seismic events in the ready-to-use <code>quakes</code> data frame. If the only device currently available is Device 1, the null device, any plotting command that refreshes a plotting window and produces a new image (such as <code>plot</code> here or more specialized commands such as <code>hist</code> or <code>boxplot</code>) will automatically open a new instance of the default graphics device before actually plotting the data. On my machine, I see <em>Quartz 2 [*]</em> open and display the plot of the spatial coordinates.</p>&#13;
<p class="indent">Now, let’s say you’d also like to see a histogram of the number of stations that detected each event. Execute the following to open a new plotting window:</p>&#13;
<pre>R&gt; dev.new()</pre>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_577"/>This new window will be numbered 3 (it usually sits itself on top of the previously open window, so you may want to move it to one side with your mouse). Importantly, you’ll see that this becomes the active device: on a Mac the <em>[*]</em> is now on the Device 3 banner; in Windows, Device 3 will say <em>(ACTIVE)</em>, and Device 2 will now say <em>(inactive)</em>.</p>&#13;
<p class="indent">At this point, you can enter the usual command to bring up the desired histogram in Device 3:</p>&#13;
<pre>R&gt; hist(quakes$stations)</pre>&#13;
<p class="indent">If you hadn’t used <code>dev.new</code>, the histogram would’ve just overwritten the plot of the spatial locations in Device 2.</p>&#13;
<h4 class="h4" id="ch23lev2sec223"><strong><em>23.1.2 Switching Between Devices</em></strong></h4>&#13;
<p class="noindent">To change something in Device 2 without closing Device 3, use <code>dev.set</code> followed by the device number you want to make active. The following code activates Device 2 and replots the locations of the seismic events so that the size of each point is proportional to the number of stations that detected the event. It also tidies up the axis labels.</p>&#13;
<pre>R&gt; dev.set(2)<br/>quartz<br/>     2<br/>R&gt; plot(quakes$long,quakes$lat,cex=0.02*quakes$stations,<br/>        xlab="Longitude",ylab="Latitude")</pre>&#13;
<p class="indent">Using <code>dev.set</code> always confirms the newly active device by printing to the console; the specific text will vary according to your operating system and type of device.</p>&#13;
<p class="indent">Switching back to Device 3, as a final tweak, add a vertical line marking off the mean number of detecting stations.</p>&#13;
<pre>R&gt; dev.set(3)<br/>quartz<br/>     3<br/>R&gt; abline(v=mean(quakes$stations),lty=2)</pre>&#13;
<p class="indent"><a href="ch23.xhtml#ch23fig1">Figure 23-1</a> shows the two graphics devices after making these modifications.</p>&#13;
<div class="image"><span epub:type="pagebreak" id="page_578"/><img src="../images/f23-01.jpg" alt="image"/></div>&#13;
<p class="figt"><em><a id="ch23fig1"/>Figure 23-1: My two visible graphics devices, Device 2 (left) and Device 3 (right), showing the final results of producing and manipulating two plots of the</em> <code>quakes</code> <em>data</em></p>&#13;
<h4 class="h4" id="ch23lev2sec224"><strong><em>23.1.3 Closing a Device</em></strong></h4>&#13;
<p class="noindent">To close a graphics device, either click the <em>X</em> with your mouse as you would to close any window or use the <code>dev.off</code> function (you originally saw this command in <a href="ch08.xhtml#ch08">Chapter 8</a> when closing a direct-to-file device). Calling <code>dev.off()</code> with no arguments simply closes the currently active device. Otherwise, you can specify the device number just as when using <code>dev.set</code>. To close the plot of the spatial locations, leaving the histogram as the active device, call <code>dev.off</code> with an argument of 2:</p>&#13;
<pre>R&gt; dev.off(2)<br/>quartz<br/>     3</pre>&#13;
<p class="indent">Then repeat the call without an argument to close the remaining device:</p>&#13;
<pre>R&gt; dev.off()<br/>null device<br/>          1</pre>&#13;
<p class="indent">Similar to <code>dev.set</code>, the printed output tells you what the newly active device is after you close one. When you close the last available actionable device, you’re returned to the null device.</p>&#13;
<h4 class="h4" id="ch23lev2sec225"><strong><em>23.1.4 Multiple Plots in One Device</em></strong></h4>&#13;
<p class="noindent">You can also control the number of individual plots in any one device. There are a few ways to do this; I’ll describe the two easiest ways here.</p>&#13;
<h5 class="h5" id="ch23lev3sec105"><span epub:type="pagebreak" id="page_579"/><strong>Setting the mfrow Parameter</strong></h5>&#13;
<p class="noindent">Recall the <code>par</code> function is used to control various graphical parameters of traditional R plots. The <code>mfrow</code> argument instructs a new (or the currently active) device to “invisibly” divide itself into a grid of the specified dimensions, with each cell holding one plot. You pass the <code>mfrow</code> option a numeric integer vector of length 2 in the order of <code>c(<span class="codeitalic">rows</code>,<span class="codeitalic">columns</span>)</span>; as you might guess, its default is <code>c(1,1)</code>.</p>&#13;
<p class="indent">In your R session, make sure there are no plotting windows open. Now, say you want the two plots of the <code>quakes</code> data side by side in the same device. You would set <code>mfrow</code> as a 1 × 2 grid with the vector <code>c(1,2)</code>—one row of plots and two columns.</p>&#13;
<pre>R&gt; dev.new(width=8,height=4)<br/>R&gt; par(mfrow=c(1,2))<br/>R&gt; plot(quakes$long,quakes$lat,cex=0.02*quakes$stations,<br/>        xlab="Longitude",ylab="Latitude")<br/>R&gt; hist(quakes$stations)<br/>R&gt; abline(v=mean(quakes$stations),lty=2)</pre>&#13;
<p class="indent">The first line uses the optional arguments <code>width</code> and <code>height</code> to preset the dimensions of the new device, in inches, so it is twice as wide as it is high. <a href="ch23.xhtml#ch23fig2">Figure 23-2</a> shows exactly how the images are displayed, with the creation of a new plot filling the available cells as governed by the value of <code>mfrow</code>.</p>&#13;
<div class="image"><img src="../images/f23-02.jpg" alt="image"/></div>&#13;
<p class="figt"><em><a id="ch23fig2"/>Figure 23-2: Using</em> <code>mfrow</code> <em>in</em> <code>par</code> <em>to generate a grid of plots in a single graphics device, showing the two plots of the</em> <code>quakes</code> <em>data</em></p>&#13;
<p class="indent">If you close any graphics devices and rerun this code without the lead-in call to <code>dev.new</code>, executing <code>par(mfrow=c(1,2))</code> will automatically open a graphics device of the default square size of 7 × 7 inches. The two plots will still appear side by side but will be squashed. You can manually resize the device with your mouse to something more appropriate to the set value of <code>mfrow</code>, <span epub:type="pagebreak" id="page_580"/>and then when you replot, the visualizations and their axes will be clearer. You’ll find you use this trial-and-error approach quite often to produce multiple plots in a single device, especially if you don’t want to be concerned with explicitly calling <code>dev.new</code> and setting <code>width</code> and <code>height</code>.</p>&#13;
<p class="indent">Note that any use of <code>par</code> in this way will affect <em>only</em> the currently active device. Subsequent calls to <code>dev.new</code> will open new devices with, for example, <code>mfrow</code> set back to be the default “one plot only” with <code>c(1,1)</code>. In other words, if you want to tailor the options of any new graphics device (including the direct-to-file devices), you need to set the required values of <code>par</code> after opening the device but before executing any plotting commands.</p>&#13;
<h5 class="h5" id="ch23lev3sec106"><strong>Defining a Particular Layout</strong></h5>&#13;
<p class="noindent">You can refine the arrangements of plots in a single device using the <code>layout</code> function, which offers more ways to individualize the panels into which the plots will be drawn.</p>&#13;
<p class="indent">Return to the student survey data in <code>survey</code> in the <code>MASS</code> package. Suppose you want an array of three statistical plots—a scatterplot of height on writing handspan, side-by-side boxplots of height split by smoking status, and a barplot of the frequencies of exercise of the students. If you want the plots arranged in a square device (as opposed to a single row or column of three plots), using only <code>mfrow</code> in <code>par</code> may not work best. You could set a square grid with <code>par(mfrow=c(2,2))</code>, but you’d end up with a blank space for the cell with no image assigned to it.</p>&#13;
<p class="indent">When you use <code>layout</code>, you provide the dimensions in a matrix <code>mat</code> as the first argument; these govern an invisible rectangular grid, just like controlling the <code>mfrow</code> option. The difference now is that you can use numeric integer entries in <code>mat</code> to tell <code>layout</code> which plot number will go where. Examine the following object:</p>&#13;
<pre>R&gt; lay.mat &lt;- matrix(c(1,3,2,3),2,2)<br/>R&gt; lay.mat<br/>     [,1] [,2]<br/>[1,]    1    2<br/>[2,]    3    3</pre>&#13;
<p class="indent">The dimensions of this matrix create a 2 × 2 grid of plotting cells, but the values inside <code>lay.mat</code> tell R that you want plot 1 to take the upper-left cell, plot 2 to take the upper-right cell, and plot 3 to stretch itself over the two bottom cells.</p>&#13;
<p class="indent">Calling <code>layout</code> as follows will either silently initialize the active device based on <code>lay.mat</code> or open a new one (if the null device is the only device currently available) and initialize it.</p>&#13;
<pre>R&gt; layout(mat=lay.mat)</pre>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_581"/>If you’re ever unsure of the result of your specification, you can use the <code>layout.show</code> function to see how plots will be placed. The following line produces the image on the left of <a href="ch23.xhtml#ch23fig3">Figure 23-3</a>.</p>&#13;
<pre>R&gt; layout.show(n=max(lay.mat))</pre>&#13;
<p class="indent">Then, once you’ve loaded the <code>MASS</code> package by calling <code>library("MASS")</code> so you can access <code>survey</code>, run the following lines to place the plots in the order the plotting commands are executed, matched to the integers in <code>lay.mat</code>.</p>&#13;
<pre>R&gt; plot(survey$Wr.Hnd,survey$Height,<br/>        xlab="Writing handspan",ylab="Height")<br/>R&gt; boxplot(survey$Height~survey$Smoke,<br/>        xlab="Smoking frequency",ylab="Height")<br/>R&gt; barplot(table(survey$Exer),horiz=TRUE,main="Exercise")</pre>&#13;
<p class="indent">Note that if you’ve already closed down the plot arising from <code>layout.show</code>, then you’ll need to reinitialize a new device with the same call to <code>layout</code> for these three plots to display as intended. The result should look like the right of <a href="ch23.xhtml#ch23fig3">Figure 23-3</a>.</p>&#13;
<div class="image"><img src="../images/f23-03.jpg" alt="image"/></div>&#13;
<p class="figt"><em><a id="ch23fig3"/>Figure 23-3: Left: Using</em> <code>layout.show</code> <em>to visualize the planned plotting layout and order. Right: Demonstrating three plots of the</em> <code>survey</code> <em>data arranged according to</em> <code>lay.mat</code> <em>through</em> <code>layout</code>.</p>&#13;
<p class="indent">Probably the biggest benefit of <code>layout</code> is its ability to relax the rigidity of plotting cells when compared to using the <code>mfrow par</code> option, as you’ve just seen. Additional arguments to <code>layout</code>, namely, <code>widths</code> and <code>heights</code>, even allow you to preset the relative widths and heights of the cells as structured in the <code>mat</code> argument. See the documentation in <code>?layout</code> for details; you’ll find some other examples of its flexibility at the bottom of the file.</p>&#13;
<div class="note">&#13;
<p class="notet"><span epub:type="pagebreak" id="page_582"/><strong><span class="notes">NOTE</span></strong></p>&#13;
<p class="notep"><em>An unfortunate consequence of the two methods discussed here is the inability to edit a previous plot once you’ve finished it and moved on to the next. There is a</em> <code><span class="codeitalic">split.screen</code></span> <em>function, which does allow you to set up several “screens” in a single device and switch between them. However, this method requires a lot of extra coding and in general doesn’t behave well with regard to plotting regions and margins (see the next section) in R. Many users (myself included) prefer to remain with</em> <code><span class="codeitalic">layout</code></span><em>, even if it means going through a bit of trial and error.</em></p>&#13;
</div>&#13;
<h3 class="h3" id="ch23lev1sec77"><strong>23.2 Plotting Regions and Margins</strong></h3>&#13;
<p class="noindent">Although the main concern when plotting is of course the data set or model being visualized, it’s additionally important to ensure the plot is annotated clearly and accurately to facilitate correct interpretation. To help do this, you need to know how to manipulate and draw in all visible areas of a given device, not just the area where your data lie.</p>&#13;
<p class="indentb">For any single plot created using base R graphics, there are three regions that make up the image.</p>&#13;
<p class="bull">• The <em>plot region</em> is all you’ve dealt with so far. This is where your actual plot appears and where you’ll usually be drawing your points, lines, text, and so on. The plot region uses the <em>user coordinate system</em>, which reflects the value and scale of the horizontal and vertical axes.</p>&#13;
<p class="bull">• The <em>figure region</em> is the area that contains the space for your axes, their labels, and any titles. These spaces are also referred to as the <em>figure margins</em>.</p>&#13;
<p class="bull">• The <em>outer region</em>, also referred to as the <em>outer margins</em>, is additional space around the figure region that is not included by default but can be specified if it’s needed.</p>&#13;
<p class="indentt">You can explicitly measure and set margin space in a few different ways. One typical way is in terms of <em>lines</em>—specifically, the number of lines of text that can fit on top of one another parallel to each edge. You specify these as vectors of length 4 in a particular order; each of the four elements corresponds to one of the four sides: <code>c(<span class="codeitalic">bottom</code>, <span class="codeitalic">left</span>, <span class="codeitalic">top</span>, <span class="codeitalic">right</span>)</span>. The graphical parameters <code>oma</code> (outer margin) and <code>mar</code> (figure margin) are used to control these amounts; like <code>mfrow</code>, they are initialized through a call to <code>par</code> before you begin to draw any new plot.</p>&#13;
<h4 class="h4" id="ch23lev2sec226"><strong><em>23.2.1 Default Spacing</em></strong></h4>&#13;
<p class="noindent">You can find your default figure margin settings with a call to <code>par</code> in R.</p>&#13;
<pre>R&gt; par()$oma<br/>[1] 0 0 0 0<br/>R&gt; par()$mar<br/>[1] 5.1 4.1 4.1 2.1</pre>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_583"/>You can see here that <code>oma=c(0, 0, 0, 0)</code>—there is no outer margin set by default. The default figure margin space is <code>mar=c(5.1, 4.1, 4.1, 2.1)</code>—in other words, 5.1 lines of text on the bottom, 4.1 on the left and top, and 2.1 on the right.</p>&#13;
<p class="indent">To illustrate these regions, consider the image on the left of <a href="ch23.xhtml#ch23fig4">Figure 23-4</a>, created in a fresh graphics device with the following:</p>&#13;
<pre>R&gt; plot(1:10)<br/>R&gt; box(which="figure",lty=2)</pre>&#13;
<div class="image"><img src="../images/f23-04.jpg" alt="image"/></div>&#13;
<p class="figt"><em><a id="ch23fig4"/>Figure 23-4: Illustrating graphical device regions as treated by traditional (base) R graphics; solid-line boxes show the plot region, dashed-line boxes show the figure region, and a dotted-line box shows the outer region area. Left: Default settings. Right: User specification, through</em> <code>par</code><em>, of the outer and figure margin areas in “lines of text” via</em> <code>oma</code> <em>and</em> <code>mar</code><em>, respectively.</em></p>&#13;
<p class="indent">If you use the <code>box</code> function with the optional argument <code>which</code> set to <code>"figure"</code>, it shows you the figure region (the additional specification of <code>lty=2</code> draws dashed lines).</p>&#13;
<p class="indent">If you’re looking at this plot in your onscreen graphics device, you should note the dashed lines snug up against the window edges. Examining the default values in <code>mar</code>, you can see, relatively speaking, that they correctly correspond to the spacing on the four sides of the plot region (given with the default solid box). The widest figure margin, parallel to the bottom of the plot region, is 5.1 lines; the narrowest figure margin, parallel to the right of the plot region, is 2.1 lines.</p>&#13;
<h4 class="h4" id="ch23lev2sec227"><strong><em>23.2.2 Custom Spacing</em></strong></h4>&#13;
<p class="noindent">Let’s produce the same plot but with tailored outer margins so that the bottom, left, top, and right areas are one, four, three, and two lines, respectively, and the figure margins are four, five, six, and seven lines. The result of the following code is given on the right of <a href="ch23.xhtml#ch23fig4">Figure 23-4</a>.</p>&#13;
<pre><span epub:type="pagebreak" id="page_584"/>R&gt; par(oma=c(1,4,3,2),mar=4:7)<br/>R&gt; plot(1:10)<br/>R&gt; box("figure",lty=2)<br/>R&gt; box("outer",lty=3)</pre>&#13;
<p class="indent">Notice that the irregular margins have squashed the plot region in the default square device to accommodate the defined spacing around the edges. If you set graphical parameters that squash the plot region into nonexistence, R will throw an error stating <code>figure margins too large</code>.</p>&#13;
<p class="indent">Since you’d usually manipulate margin space to accommodate particular annotations of the plot, let’s look at the <code>mtext</code> function, used specifically to produce text in the figure or outer margins. By default, the argument <code>outer</code> is <code>FALSE</code>, meaning the text will be written in the figure margin. Setting <code>outer=TRUE</code> positions the text in the outer region. If you’ve kept the most recent plot open, the following lines provide the additional margin annotation visible on the right of <a href="ch23.xhtml#ch23fig4">Figure 23-4</a>:</p>&#13;
<pre>R&gt; mtext("Figure region margins\nmar[ . ]",line=2)<br/>R&gt; mtext("Outer region margins\noma[ . ]",line=0.5,outer=TRUE)</pre>&#13;
<p class="indent">Here, you provide the text you want written in a character string as the first argument, and the argument line instructs how many lines of space away from the inside border the text should appear. There’s also an optional argument <code>side</code> in <code>mtext</code>, which dictates where the text appears. It defaults to <code>3</code>, setting the text at the top, but you can set <code>side=1</code> to place the text on the bottom, use <code>side=2</code> to set it on the left, and use <code>side=4</code> to set it on the right. Look to <code>?mtext</code> for details on even more arguments available for the margin text.</p>&#13;
<p class="indent">You might also like to investigate the ready-to-use function <code>title</code>, which is a specialized implementation of <code>mtext</code> often used if figure margin annotation for the four axes of a plot (beyond the basic capabilities of specifying things such as <code>main</code>, <code>xlab</code>, or <code>ylab</code>) is the primary concern.</p>&#13;
<h4 class="h4" id="ch23lev2sec228"><strong><em>23.2.3 Clipping</em></strong></h4>&#13;
<p class="noindent">Controlling <em>clipping</em> allows you to draw in or add elements to the margin regions with reference to the user coordinates of the plot itself. For example, you might want to place a legend outside the plotting area, or you might want to draw an arrow that extends beyond the plot region to embellish a particular observation.</p>&#13;
<p class="indent">The graphical parameter <code>xpd</code> controls clipping in base R graphics. By default, <code>xpd</code> is set to <code>FALSE</code>, so all drawing is clipped to the available plot region only (with the exception of special margin-addition functions such as <code>mtext</code>). Setting <code>xpd</code> to <code>TRUE</code> allows you to draw things outside the formally defined plot region into the figure margins but not into any outer margins. <span epub:type="pagebreak" id="page_585"/>Setting <code>xpd</code> to <code>NA</code> will permit drawing in all three areas—plot region, figure margins, and the outer margins.</p>&#13;
<p class="indent">For example, take a look at the images in <a href="ch23.xhtml#ch23fig5">Figure 23-5</a>, showing side-by-side boxplots of mileage split by number of cylinders, created with the following code:</p>&#13;
<pre>R&gt; dev.new()<br/>R&gt; par(oma=c(1,1,5,1),mar=c(2,4,5,4))<br/>R&gt; boxplot(mtcars$mpg~mtcars$cyl,xaxt="n",ylab="MPG")<br/>R&gt; box("figure",lty=2)<br/>R&gt; box("outer",lty=3)<br/>R&gt; arrows(x0=c(2,2.5,3),y0=c(44,37,27),x1=c(1.25,2.25,3),y1=c(31,22,20),<br/>          xpd=FALSE)<br/>R&gt; text(x=c(2,2.5,3),y=c(45,38,28),c("V4 cars","V6 cars","V8 cars"),<br/>        xpd=FALSE)</pre>&#13;
<p class="indent">The particular result of this code is the top-left image in <a href="ch23.xhtml#ch23fig5">Figure 23-5</a>. I’ve defined the device region itself with particular figure and outer margins for the purpose of illustration. The plotting of the horizontal axis is suppressed with <code>xaxt="n"</code> in the call to <code>boxplot</code>; calls to <code>box</code> add the boundaries of the figure and outer margins (dashed and dotted lines, respectively). Lastly, calls to <code>arrows</code> and <code>text</code> point to and annotate each boxplot; the label for V4 cars extends into the outer margin, the label for V6 cars extends into the figure region, and the label for V8 cars remains contained within the plot region.</p>&#13;
<p class="indent">Note that the graphical parameter <code>xpd</code> is specified only in the two “add-to-current-plot” functions <code>arrows</code> and <code>text</code>, explicitly set as the default <code>FALSE</code>. This means all plotting is restricted to the plot region.</p>&#13;
<p class="indent">If you run the code chunk again but now set <code>xpd=TRUE</code> in the calls to <code>arrows</code> and <code>text</code>, you’ll get the image in the top right of <a href="ch23.xhtml#ch23fig5">Figure 23-5</a>. This allows the label for the V6 car to be printed in the margin, instead of being chopped off. Finally, rerunning the code with <code>xpd=NA</code> produces the lower plot in <a href="ch23.xhtml#ch23fig5">Figure 23-5</a>, where all drawing outside the plot region is permitted.</p>&#13;
<p class="indent">This effect is usually desirable when you need to annotate the main plot somehow, especially when there isn’t enough space in the plot region to squeeze in any additions. Plots that I’ve created in earlier chapters, such as the bottom image of <a href="ch16.xhtml#ch16fig6">Figure 16-6</a> on <a href="ch16.xhtml#page_349">page 349</a> (where the legend sits outside the main plot) and <a href="ch17.xhtml#ch17fig3">Figure 17-3</a> on <a href="ch17.xhtml#page_380">page 380</a> (where I annotated the critical values), were created specifying <code>xpd=TRUE</code> in the relevant functions (<code>legend</code>, <code>text</code>, <code>segments</code>, and <code>arrows</code>).</p>&#13;
<p class="indent">As demonstrated, you’d typically set <code>xpd</code> in the specific commands (in other words, on a line-by-line basis), so only the results of that particular command will be produced with the given clipping rule. This offers a bit more control over what is and isn’t visible outside the plot region. You can, however, set <code>xpd</code> alongside <code>oma</code> and <code>mar</code> in the initial call to <code>par</code> to make the value of <code>xpd</code> “universal” to that device.</p>&#13;
<div class="image"><span epub:type="pagebreak" id="page_586"/><img src="../images/f23-05.jpg" alt="image"/></div>&#13;
<p class="figt"><em><a id="ch23fig5"/>Figure 23-5: Illustrating the behavior of setting</em> <code>xpd=FALSE</code> <em>(top left, default),</em> <code>xpd=TRUE</code> <em>(top right), and</em> <code>xpd=NA</code> <em>(bottom) in relevant plotting commands to enable drawing in figure and outer margins with respect to the user coordinates of the plot region</em></p>&#13;
<h3 class="h3" id="ch23lev1sec78"><strong>23.3 Point-and-Click Coordinate Interaction</strong></h3>&#13;
<p class="noindent">Your dealings with the graphics device don’t need to be solely command based. Under typical circumstances, R can read mouse clicks you make inside the device.</p>&#13;
<h4 class="h4" id="ch23lev2sec229"><strong><em>23.3.1 Retrieving Coordinates Silently</em></strong></h4>&#13;
<p class="noindent">The <code>locator</code> command allows you to find and return user coordinates. To see how it works, first execute a call to <code>plot(1,1)</code> to bring up a simple plot with a single point in the middle. To use <code>locator</code>, you simply execute the function (with no arguments for default behavior), which will “hang” the console, without returning you to the prompt. Then, on an active graphics device, your mouse cursor will change to a + symbol (you may need to first click your device once to bring it to the foreground of your computer desktop). With your cursor as the +, you can perform a series of (left) mouse clicks inside the device, and R will silently record the precise user <span epub:type="pagebreak" id="page_587"/>coordinates. To stop this, simply right-click to terminate the command (other options to stop are system dependent and are mentioned in the help file <code>?locator</code>), and once you do, the coordinates you identified in the device are returned as a list with components <code>$x</code> and <code>$y</code>. These are printed to the console screen unless you specifically assign the call to <code>locator</code> to an R object.</p>&#13;
<p class="indent">On my machine, I silently identified four points at arbitrary locations around the plotted point at (1,1), from top left clockwise around to the bottom left. The following is the output printed to my console:</p>&#13;
<pre>R&gt; plot(1,1)<br/>R&gt; locator()<br/>$x<br/>[1] 0.8275456 1.1737525 1.1440526 0.8201909<br/><br/>$y<br/>[1] 1.1581795 1.1534442 0.9003221 0.8630254</pre>&#13;
<p class="indent">This silent use of <code>locator</code> is useful if you need to, for example, identify approximate user coordinates in the plot region where you need to place future annotations.</p>&#13;
<h4 class="h4" id="ch23lev2sec230"><strong><em>23.3.2 Visualizing Selected Coordinates</em></strong></h4>&#13;
<p class="noindent">You can also use <code>locator</code> to plot the points you select as either individual points or as lines. Running the following code produces <a href="ch23.xhtml#ch23fig6">Figure 23-6</a>:</p>&#13;
<pre>R&gt; plot(1,1)<br/>R&gt; Rtist &lt;- locator(type="o",pch=4,lty=2,lwd=3,col="red",xpd=TRUE)<br/>R&gt; Rtist<br/>$x<br/> [1] 0.5013189 0.6267149 0.7384407 0.7172250 1.0386740 1.2765699<br/> [7] 1.4711542 1.2352573 1.2220592 0.8583484 1.0483300 1.0091491<br/><br/>$y<br/> [1] 0.6966016 0.9941945 0.9636752 1.2819852 1.2766579 1.4891270<br/> [7] 1.2439071 0.9630832 0.7625887 0.7541716 0.6394519 0.9618461</pre>&#13;
<p class="indent">Drawing using <code>locator</code> requires you to specify the plot <code>type</code>, as covered in <a href="ch07.xhtml#ch07">Chapter 7</a>. Selecting <code>type="o"</code> (as opposed to the silent default, <code>type="n"</code>) is what produces the overplotted points and lines in <a href="ch23.xhtml#ch23fig6">Figure 23-6</a>. For just points, use <code>type="p"</code>; for just lines, use <code>type="l"</code>. The graphical parameters controlling other relevant features, such as point/line type and color, can also be used, as you’ve seen in conventionally produced plots in <a href="ch07.xhtml#ch07">Chapter 7</a>. I also used <code>xpd=TRUE</code>, shown earlier, to allow the <code>locator</code> points and/or lines to protrude into the figure region margins. The call to <code>locator</code> is directly assigned to a new object <code>Rtist</code>, illustrating how you can use the clicked coordinates later if needed.</p>&#13;
<div class="image"><span epub:type="pagebreak" id="page_588"/><img src="../images/f23-06.jpg" alt="image"/></div>&#13;
<p class="figt"><em><a id="ch23fig6"/>Figure 23-6: Using</em> <code>locator</code> <em>to draw an arbitrary sequence of overplotted points and lines</em></p>&#13;
<h4 class="h4" id="ch23lev2sec231"><strong><em>23.3.3 Ad Hoc Annotation</em></strong></h4>&#13;
<p class="noindent">The <code>locator</code> function also allows you to place ad hoc annotations, such as legends, on your plot—remember, since <code>locator</code> returns valid R user coordinates, these results can directly form the positional argument of most standard annotation functions.</p>&#13;
<p class="indent">Return to the student survey data in the <code>MASS</code> package, first loading the package by calling <code>library("MASS")</code>. The following call produces the scatter-plot used to illustrate a multiple linear model of mean student height as a function of handspan and sex in <a href="ch21.xhtml#ch21lev2sec195">Section 21.3.3</a>.</p>&#13;
<pre>R&gt; plot(survey$Height~survey$Wr.Hnd,pch=16,<br/>        col=c("gray","black")[as.numeric(survey$Sex)],<br/>        xlab="Writing handspan",ylab="Height")</pre>&#13;
<p class="indent">For the plot in <a href="ch21.xhtml#ch21lev2sec195">Section 21.3.3</a> (<a href="ch21.xhtml#ch21fig1">Figure 21-1</a> on <a href="ch21.xhtml#page_495">page 495</a>), I simply used the string <code>"topleft"</code> to position the legend. This time, call the following:</p>&#13;
<pre>R&gt; legend(locator(n=1),legend=levels(survey$Sex),pch=16,<br/>          col=c("gray","black"))</pre>&#13;
<p class="indent">An optional argument to <code>locator</code>, <code>n</code>, takes a positive integer for an upper limit on how many points you want to select; it defaults to <code>512</code>. If you specify <code>n=1</code>, <code>locator</code> will automatically terminate after you left-click once in the device, so you don’t need to manually exit the function with a right-click.</p>&#13;
<p class="indent">When the code is executed, the + cursor will appear on the graphics device, and you simply need to click once for the desired location of the legend. I chose to click the blank space above the cloud of points, producing the image in <a href="ch23.xhtml#ch23fig7">Figure 23-7</a>.</p>&#13;
<div class="image"><span epub:type="pagebreak" id="page_589"/><img src="../images/f23-07.jpg" alt="image"/></div>&#13;
<p class="figt"><em><a id="ch23fig7"/>Figure 23-7: Ad hoc placement of a legend on a scatterplot of the</em> <code>survey</code> <em>data</em></p>&#13;
<div class="ex">&#13;
<p class="ext"><a id="ch23exc1"/><strong>Exercise 23.1</strong></p>&#13;
<ol>&#13;
<li><p class="noindents">In <a href="ch20.xhtml#ch20lev2sec188">Section 20.5.4</a> (<a href="ch20.xhtml#page_478">page 478</a>), I gave you code showing a simple linear model fitted with a categorical predictor being treated as continuous (the <code>mtcars</code> data with <code>mpg</code> as the response and <code>cyl</code> as the explanatory variable). Reproduce the side-by-side boxplots and the scatterplot (with fitted line) from <a href="ch20.xhtml#ch20fig6">Figure 20-6</a>, but this time, use <code>mfrow</code> to present the two plots as a vertical column in one device.</p></li>&#13;
<li><p class="noindents">Create the appropriate layout matrices to reproduce the following three plots (as they appear in a square device):</p>&#13;
<ol type="i">&#13;
<li><p class="noindents"><img src="../images/f0589-01a.jpg" alt="image"/></p></li>&#13;
<li><p class="noindents"><img src="../images/f0589-02a.jpg" alt="image"/></p></li>&#13;
<li><p class="noindents"><img src="../images/f0589-03a.jpg" alt="image"/></p></li>&#13;
</ol></li>&#13;
<li><p class="noindents">By opening a new device of dimension 9 × 4.5 inches, set the following layout:</p>&#13;
<div class="image"><img src="../images/f0589-02.jpg" alt="image"/></div>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_590"/>Then, produce the following combined set of plots exactly:</p>&#13;
<div class="imagec"><img src="../images/f0590-01.jpg" alt="image"/></div>&#13;
<p class="indent">To achieve this, note the following:</p>&#13;
<p class="dash">– After you open the device and setting the layout, the plot margins should be reset to four lines, four lines, two lines, and one line of space on the bottom, left, top, and right, respectively.</p>&#13;
<p class="dash">– After each plot, add a gray box corresponding to the figure region to achieve the visible partitions.</p>&#13;
<p class="dash">– Plots 1 and 4 are the same as the two plots shown in <a href="ch23.xhtml#ch23fig1">Figures 23-1</a> and <a href="ch23.xhtml#ch23fig2">23-2</a>.</p>&#13;
<p class="dash">– Plots 2 and 3 are scatterplots showing the number of detecting stations on the <em>y</em>-axis, with magnitude and depth on the <em>x</em>-axis, respectively.</p>&#13;
<p class="dash">– Do not place main titles on any plots, and ensure the axis titles are neat (that is, compared to their defaults).</p></li>&#13;
<li><p class="noindents">Write a little R function named <code>interactive.arrow</code>. The purpose of this function is to superimpose an arrow upon any base R plot using two clicks of your mouse. The details are as follows:</p>&#13;
<p class="dash">– The crux of your function will be the use of <code>locator</code> to read exactly two mouse clicks. You may assume a suitable active graphics device is already open whenever the function is called. The first click should mean the beginning of the arrow, and the second click should mean the tip of the arrow (where it’s pointing to).</p>&#13;
<p class="dash">– In the function, the coordinates returned by <code>locator</code> should be passed to <code>arrows</code> to do the actual drawing.</p>&#13;
<p class="dash">– The function should take an ellipsis as its first argument, intended to hold additional arguments to be passed directly to <code>arrows</code>.</p>&#13;
<p class="dash"><span epub:type="pagebreak" id="page_591"/>– The function should take an optional logical argument <code>label</code>, which defaults to <code>NA</code> but should be intended to have an optional character string. If <code>label</code> is not <code>NA</code>, then <code>locator</code> should be invoked once more (separately, after drawing the arrow) to select exactly one coordinate. That point will be passed to <code>text</code> so that the user can additionally place the character string given to <code>label</code> as an annotation (intended to be for the interactively placed arrow). The call to <code>text</code> should consistently allow completely relaxed clipping (in other words, any text added in this fashion will still be visible in the figure region and outer margins, if there are any).</p>&#13;
<p class="indent">Take another look at the rightmost plot of <a href="ch14.xhtml#ch14fig6">Figure 14-6</a> on <a href="ch14.xhtml#page_298">page 298</a>, a stand-alone boxplot of the magnitude data from the <code>quakes</code> data frame. Arrows and labels were superimposed externally pointing out the various statistics summarized by a boxplot. Create the same boxplot and use <code>interactive.arrow</code> to annotate the same features to your own satisfaction (you’ll likely have to use the ellipsis to relax the clipping associated with each arrow). My result is given here:</p></li>&#13;
</ol>&#13;
<div class="imagec"><img src="../images/f0591-01.jpg" alt="image"/></div>&#13;
</div>&#13;
<h3 class="h3" id="ch23lev1sec79"><strong>23.4 Customizing Traditional R Plots</strong></h3>&#13;
<p class="noindent">Now that you’re familiar with the way R places and handles plots in the graphics device, it’s time to focus on common features of plots. So far, you’ve largely left the default settings in place.</p>&#13;
<h4 class="h4" id="ch23lev2sec232"><span epub:type="pagebreak" id="page_592"/><strong><em>23.4.1 Graphical Parameters for Style and Suppression</em></strong></h4>&#13;
<p class="noindent">If you want finer control over an R plot, you’ll typically want to begin with a “clean slate.” To do this, you need to be aware of the default settings of certain graphical parameters when calling a plotting function and of how to suppress things such as boxes and axes. This is where you’ll start.</p>&#13;
<p class="indent">For an example image, let’s plot MPG against horsepower (from the ready-to-use <code>mtcars</code> data set) and set each plotted point to be sized proportionally to the weight of each car. For convenience, create the following objects:</p>&#13;
<pre>R&gt; hp &lt;- mtcars$hp<br/>R&gt; mpg &lt;- mtcars$mpg<br/>R&gt; wtcex &lt;- mtcars$wt/mean(mtcars$wt)</pre>&#13;
<p class="indent">The last object is the car weight vector scaled by its sample mean. This creates a vector where cars less than the average weight have a value &lt; 1 and cars more than the average weight have a value &gt; 1, making it ideal for the <code>cex</code> parameter to scale the size of the plotted points accordingly (refer to <a href="ch07.xhtml#ch07">Chapter 7</a>).</p>&#13;
<p class="indent">Let’s start by focusing on some more graphical parameters usually used in the first instance of a call to <code>plot</code>, paving the way for using the <code>box</code> and <code>axis</code> commands. Executing the following line gives you the default appearance of the plot and its box, axes, and labeling; this is shown as the leftmost image in <a href="ch23.xhtml#ch23fig8">Figure 23-8</a>.</p>&#13;
<pre>R&gt; plot(hp,mpg,cex=wtcex)</pre>&#13;
<p class="indent">There are two axis “styles,” controlled by the graphical parameters <code>xaxs</code> and <code>yaxs</code>. Their sole purpose is to decide whether to impose the small amount of additional horizontal and vertical buffer space that’s present at the ends of each axis to prevent points being chopped off at the end of the plotting region. The default, <code>xaxs="r"</code> and <code>yaxis="r"</code>, is to include that space. The alternative, setting one or both of these to <code>"i"</code>, instructs the plot region to be <em>strictly</em> defined by the upper and lower limits of the data (or by those optionally supplied to <code>xlim</code> and/or <code>ylim</code>), that is, with <em>no</em> additional padding space.</p>&#13;
<p class="indent">For example, the following line produces the middle plot in <a href="ch23.xhtml#ch23fig8">Figure 23-8</a>.</p>&#13;
<pre>R&gt; plot(hp,mpg,cex=wtcex,xaxs="i",yaxs="i")</pre>&#13;
<p class="indent">This plot is almost the same as the default, but note now that there’s no padding space at the end of the axes; the most extreme data points sit right on the axes. Generally, the default axis style <code>"r"</code> is fine, but on occasions where you need finer control over the axes’ scales and the corresponding plot region, that additional buffer space can be problematic. On those occasions, you’ll often see <code>xlim</code>/<code>ylim</code> being used in conjunction with <code>xaxs="i"</code>/<code>yaxs="i"</code>.</p>&#13;
<div class="image"><span epub:type="pagebreak" id="page_593"/><img src="../images/f23-08.jpg" alt="image"/></div>&#13;
<p class="figt"><em><a id="ch23fig8"/>Figure 23-8: Plotting MPG against horsepower for the</em> <code>mtcars</code> <em>data; point size proportional to car weight, using a call to</em> <code>plot</code> <em>only. Left: Default appearance. Middle: Setting</em> <code>xaxs="i"</code> <em>and</em> <code>yaxs="i"</code> <em>to prevent the buffer spacing on the limits of the axes. Right: Using</em> <code>xaxt</code>, <code>yaxt</code>, <code>xlab</code>, <code>ylab</code><em>, and</em> <code>bty</code> <em>to suppress all box, axis, and label drawing (alternatively achieved by setting</em> <code>axes=FALSE</code> <em>and</em> <code>ann=FALSE</code><em>).</em></p>&#13;
<p class="indent">If you want total control over the specific appearance of any boxes, axes, and their labels, you’ll want to start a plot with none of these and add them as per your design. The rightmost plot in <a href="ch23.xhtml#ch23fig8">Figure 23-8</a> is the result of suppressing the default drawing of these by a call to either</p>&#13;
<pre>R&gt; plot(hp,mpg,cex=wtcex,xaxt="n",yaxt="n",bty="n",xlab="",ylab="")</pre>&#13;
<p class="noindent">or</p>&#13;
<pre>R&gt; plot(hp,mpg,cex=wtcex,axes=FALSE,ann=FALSE)</pre>&#13;
<p class="indent">You can achieve this either by setting the parameters <code>xaxt</code>, <code>yaxt</code>, and <code>bty</code> to <code>"n"</code> and setting the default axis labels <code>xlab</code> and <code>ylab</code> to the empty string <code>""</code>, or by simply setting both <code>axes</code> and <code>ann</code> to <code>FALSE</code> (the former suppressing all axes and the box, the latter suppressing any annotation). Although the first way might seem overcomplicated, it affords you greater flexibility in suppressing each aspect of a given plot (as opposed to the “total” suppression enforced by the second approach).</p>&#13;
<h4 class="h4" id="ch23lev2sec233"><strong><em>23.4.2 Customizing Boxes</em></strong></h4>&#13;
<p class="noindent">When you’re starting with a suppressed-box or suppressed-axis plot, to add a box specific to the current plot region in the active graphics device, you use <code>box</code> and specify its type with <code>bty</code>. For example, if you start with a plot like the one on the right of <a href="ch23.xhtml#ch23fig8">Figure 23-8</a> (just run the most recent line of code to get this), then additionally calling the following line provides you with the image given on the left of <a href="ch23.xhtml#ch23fig9">Figure 23-9</a>.</p>&#13;
<pre>R&gt; box(bty="u")</pre>&#13;
<p class="indent">The <code>bty</code> argument is supplied a single character: <code>"o"</code> (default), <code>"l"</code>, <code>"7"</code>, <code>"c"</code>, <code>"u"</code>, <code>"]"</code>, or <code>"n"</code>. The help file entry for <code>bty</code> in <code>?par</code> tells you that based on <span epub:type="pagebreak" id="page_594"/>one of these values, the resulting box boundaries will follow the appearance of the corresponding uppercase letter, with the exception of <code>"n"</code> (which, as you saw a moment ago, will suppress the box).</p>&#13;
<div class="image"><img src="../images/f23-09.jpg" alt="image"/></div>&#13;
<p class="figt"><em><a id="ch23fig9"/>Figure 23-9: Various box configurations added to the</em> <code>mtcars</code> <em>scatterplot</em></p>&#13;
<p class="indent">You can use other relevant parameters that you’ve met already, such as <code>lty</code>, <code>lwd</code>, and <code>col</code>, to further control the appearance of a box. Replot the data as on the right of <a href="ch23.xhtml#ch23fig8">Figure 23-8</a> and then call the following to produce the image in the middle of <a href="ch23.xhtml#ch23fig9">Figure 23-9</a>:</p>&#13;
<pre>R&gt; box(bty="l",lty=3,lwd=2)</pre>&#13;
<p class="indent">The final example on the right of <a href="ch23.xhtml#ch23fig9">Figure 23-9</a> is created with this line:</p>&#13;
<pre>R&gt; box(bty="]",lty=2,col="gray")</pre>&#13;
<h4 class="h4" id="ch23lev2sec234"><strong><em>23.4.3 Customizing Axes</em></strong></h4>&#13;
<p class="noindent">Once you have the box the way you want it, you can focus on the axes. The <code>axis</code> function allows you to control the addition and appearance of an axis on any of the four sides of the plot region in greater detail. The first argument it takes is <code>side</code>, provided with a single integer: <code>1</code> (bottom), <code>2</code> (left), <code>3</code> (top), or <code>4</code> (right). These numbers are consistent with the positions of the relevant margin-spacing values when you’re setting graphical parameter vectors like <code>mar</code>.</p>&#13;
<p class="indent">The first thing you might want to change on an axis is where the tick marks are drawn. By default, R uses the built-in function <code>pretty</code> to find a “neat” sequence of values for the scale of each axis, but you can set your own by passing the <code>at</code> argument to <code>axis</code>. The following lines create the plot on the left of <a href="ch23.xhtml#ch23fig10">Figure 23-10</a>.</p>&#13;
<pre>R&gt; hpseq &lt;- seq(min(hp),max(hp),length=10)<br/>R&gt; plot(hp,mpg,cex=wtcex,xaxt="n",bty="n",ann=FALSE)<br/>R&gt; axis(side=1,at=hpseq)<br/>R&gt; axis(side=3,at=round(hpseq))</pre>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_595"/>First, an evenly spaced sequence of 10 values spanning the range of <code>hp</code> is stored as <code>hpseq</code>. The initial call to <code>plot</code> suppresses the <em>x</em>-axis, the box, and any default axis labels; however, the <em>y</em>-axis is permitted to appear as per its default. Then <code>axis</code> is instructed to draw the <em>x</em>-axis (<code>side=1</code>), with tick marks at <code>hpseq</code>. To provide a comparison to that, an axis is also drawn along the top (<code>side=3</code>), but this time the tick marks are drawn at <code>hpseq</code> after it’s rounded to the nearest integer.</p>&#13;
<div class="image"><img src="../images/f23-10.jpg" alt="image"/></div>&#13;
<p class="figt"><em><a id="ch23fig10"/>Figure 23-10: Customizing axes of the</em> <code>mtcars</code> <em>scatterplot</em></p>&#13;
<p class="indent">As you can see on the left of the figure, the custom <em>x</em>-axis I’ve created on the bottom shows 10 tick marks at the sequence of values supplied to <code>at</code>. R may suppress some of the labels so they don’t overlap one another, which is what has occurred here. Since these “decimal” values mightn’t be aesthetically pleasing, the axis that’s been drawn along the top has tick marks drawn at the nearest integers of <code>hpseq</code>, achieved using <code>round</code> in the final call to <code>axis</code> shown earlier. Although, strictly speaking, this now means that the tick marks are no longer exactly evenly spaced, the rounded values mean shorter default axis labels that can all be displayed in the current device.</p>&#13;
<p class="indent">You can see from these difficulties that tick mark locations are generally best left to R, unless you have specific axis values that you know you want marked out—you’ll see an example of this in <a href="ch23.xhtml#ch23lev1sec81">Section 23.6</a>. For now, let’s look at some other tweaks you can make to your axes. In particular, the <code>tcl</code> (length of the ticks), <code>las</code> (orientation of the labels), and <code>mgp</code> (axis spacing) parameters are arguably among those more frequently used. The following code creates the plot on the right of <a href="ch23.xhtml#ch23fig10">Figure 23-10</a>.</p>&#13;
<pre>R&gt; hpseq2 &lt;- seq(50,325,by=25)<br/>R&gt; plot(hp,mpg,cex=wtcex,axes=FALSE)<br/>R&gt; box(bty="l")<br/>R&gt; axis(side=2,tcl=-2,las=1,mgp=c(3,2.5,0))<br/>R&gt; axis(side=1,at=hpseq2,tcl=1.5,mgp=c(3,1.5,1))</pre>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_596"/>After a new sequence—<code>hpseq2</code>—is defined as all integers that lie within the recorded range of the data and are evenly spaced by 25 units, the plot is initialized. The box and axes are suppressed, but the default variable titles (<code>mpg</code> and <code>hp</code>) along the axes remain.</p>&#13;
<p class="indent">Now, an L-shaped box and the <em>y</em>-axis (<code>side=2</code>) are added. In the latter, the <code>tcl</code> parameter governs the length of each tick mark in “parallel lines of text” (recall this is a standard unit measurement for margin spacing in an R plot); it defaults to <code>-0.5</code>. When the value is negative, it draws the tick marks away from the plot region; when it’s positive, the tick marks are drawn inward. For this <code>side=2</code> axis, <code>tcl=-2</code>, meaning that the ticks will point outward from the plot but be four times the length they usually are (two whole lines of text as opposed to half a line).</p>&#13;
<p class="indent">The <code>las</code> parameter controls the way the labels for each tick mark are oriented; setting it to <code>1</code> instructs R to produce all tick labels <em>horizontally</em>, regardless of axis side. The default, <code>las=0</code>, writes all labels <em>parallel</em> to the corresponding axis; the alternative <code>las=2</code> means labels are always <em>perpendicular</em> to the corresponding axes; and using <code>las=3</code> orients all labels to be read <em>vertically</em>, regardless of axis.</p>&#13;
<p class="indent">Next up, the <code>mgp</code> parameter controls three further aspects of axis spacing and, as such, is supplied a vector of length 3 as per the following definition: <code>c(<span class="codeitalic">axis title</code>,<span class="codeitalic">axis labels</span>,<span class="codeitalic">axis line</span>)</span>. Once more, these arguments are expressed in “lines of text.” The default value of <code>mgp</code> is <code>c(3,1,0)</code>—meaning that in every axis you’ve seen so far, the title has sat three lines of text away from the plot region, the tick mark labels one line of text away, and the axis line itself zero lines of text away from the plot region (so it’s flush with any drawn plot region box). When used in <code>axis</code>, only the second and third elements of <code>mpg</code> are relevant. In the vertical axis in the plot on the right of <a href="ch23.xhtml#ch23fig10">Figure 23-10</a>, the only alteration from the default was to set the second element (spacing of the axis labels) to <code>2.5</code>—pushing the axis labels out to the left, further away from the plot region. The tick marks themselves are considerably lengthened by <code>tcl</code>, so this is required to avoid the axis tick mark labels going through those ticks. Try replotting the image and that axis, but without specifying <code>mgp</code>, and you’ll see that unappealing result.</p>&#13;
<p class="indent">Moving to the addition of the <em>x</em>-axis (<code>side=1</code>), you can see tick marks at <code>hpseq2</code> being placed via <code>at</code>. This time, a positive value has been supplied to <code>tcl</code>, instructing the axis to have <em>inward</em>-facing tick marks of 1.5 lines of text in length. In <code>mpg</code>, note that the third element of the vector is now set to <code>1</code>, meaning you want the axis line itself to sit one line of text away from the plot region. Looking at the right of <a href="ch23.xhtml#ch23fig10">Figure 23-10</a>, you can see that the entire axis has been moved downward, away from the plot region. To account for this in terms of the spacing of the tick mark labeling, the second element of <code>mgp</code> has been increased a little from its default, to be <code>1.5</code>.</p>&#13;
<h3 class="h3" id="ch23lev1sec80"><span epub:type="pagebreak" id="page_597"/><strong>23.5 Specialized Text and Label Notation</strong></h3>&#13;
<p class="noindent">Now you’ll investigate some immediately accessible tools for controlling fonts and displaying special notation, such as Greek symbols and mathematical expressions.</p>&#13;
<h4 class="h4" id="ch23lev2sec235"><strong><em>23.5.1 Font</em></strong></h4>&#13;
<p class="noindent">The displayed font is controlled by two graphical parameters: <code>family</code> for the specific font family and <code>font</code>, an integer selector for controlling bold and italic typeface.</p>&#13;
<p class="indent">Available fonts depend on both your operating system and the graphics device you’re using. That said, there are three generic families—<code>"sans"</code> (the default), <code>"serif"</code>, and <code>"mono"</code>—that are always available. These are paired with the four possible values of <code>font</code>—<code>1</code> (normal text, default), <code>2</code> (bold), <code>3</code> (italic), and <code>4</code> (bold and italic). You can set these two graphical parameters universally for a device using <code>par</code>, but like the use of <code>xpd</code>, it’s just as common (if not more so) to set <code>family</code> and <code>font</code> in the relevant annotation functions.</p>&#13;
<p class="indent"><a href="ch23.xhtml#ch23fig11">Figure 23-11</a> shows you some variants alongside the corresponding values of <code>family</code> and <code>font</code>. To create it, start with an empty plot region with preset <em>x</em>- and <em>y</em>-limits, created with the following:</p>&#13;
<pre>R&gt; par(mar=c(3,3,3,3))<br/>R&gt; plot(1,1,type="n",xlim=c(-1,1),ylim=c(0,7),xaxt="n",yaxt="n",ann=FALSE)</pre>&#13;
<p class="indent">Then, the image with six possible variants is completed by executing the following lines:</p>&#13;
<pre>R&gt; text(0,6,label="sans text (default)\nfamily=\"sans\", font=1")<br/>R&gt; text(0,5,label="serif text\nfamily=\"serif\", font=1",<br/>        family="serif",font=1)<br/>R&gt; text(0,4,label="mono text\nfamily=\"mono\", font=1",<br/>        family="mono",font=1)<br/>R&gt; text(0,3,label="mono text (bold, italic)\nfamily=\"mono\", font=4",<br/>        family="mono",font=4)<br/>R&gt; text(0,2,label="sans text (italic)\nfamily=\"sans\", font=3",<br/>        family="sans",font=3)<br/>R&gt; text(0,1,label="serif text (bold)\nfamily=\"serif\", font=2",<br/>        family="serif",font=2)<br/>R&gt; mtext("some",line=1,at=-0.5,cex=2,family="sans")<br/>R&gt; mtext("different",line=1,at=0,cex=2,family="serif")<br/>R&gt; mtext("fonts",line=1,at=0.5,cex=2,family="mono")</pre>&#13;
<p class="indent">Here, <code>text</code> is used to place the content at predetermined coordinates, and <code>mtext</code> is used to add to the top figure margin.</p>&#13;
<div class="image"><span epub:type="pagebreak" id="page_598"/><img src="../images/f23-11.jpg" alt="image"/></div>&#13;
<p class="figt"><em><a id="ch23fig11"/>Figure 23-11: Displaying font styles through use of the</em> <code>family</code> <em>and</em> <code>font</code> <em>graphical parameters</em></p>&#13;
<h4 class="h4" id="ch23lev2sec236"><strong><em>23.5.2 Greek Symbols</em></strong></h4>&#13;
<p class="noindent">For statistically or mathematically technical plots, annotation may occasionally require Greek symbols or mathematical markup. You can display these using the <code>expression</code> function, which, among other things, is capable of invoking the <code>plotmath</code> mode of R (<a href="ref.xhtml#ref50">Murrell and Ihaka, 2000</a>; <a href="ref.xhtml#ref49">Murrell, 2011</a>). Use of <code>expression</code> returns a special object that has a class of the same name and can subsequently be passed to any argument in a plotting function that requires the character string to be displayed.</p>&#13;
<p class="indent">Focusing for the moment on Greek symbols, consider <a href="ch23.xhtml#ch23fig12">Figure 23-12</a>, which is produced with the following code:</p>&#13;
<pre>R&gt; par(mar=c(3,3,3,3))<br/>R&gt; plot(1,1,type="n",xlim=c(-1,1),ylim=c(0.5,4.5),xaxt="n",yaxt="n",<br/>        ann=FALSE)<br/>R&gt; text(0,4,label=expression(alpha),cex=1.5)<br/>R&gt; text(0,3,label=expression(paste("sigma: ",sigma," Sigma: ",Sigma)),<br/>        family="mono",cex=1.5)<br/>R&gt; text(0,2,label=expression(paste(beta," ",gamma," ",Phi)),cex=1.5)<br/>R&gt; text(0,1,label=expression(paste(Gamma,"(",tau,") = 24 when ",tau," = 5")),<br/>        family="serif",cex=1.5)<br/>R&gt; title(main=expression(paste("Gr",epsilon,epsilon,"k")),cex.main=2)</pre>&#13;
<div class="image"><span epub:type="pagebreak" id="page_599"/><img src="../images/f23-12.jpg" alt="image"/></div>&#13;
<p class="figt"><em><a id="ch23fig12"/>Figure 23-12: Displaying Greek symbols using</em> <code>expression</code></p>&#13;
<p class="indent">If you just want a single special character by itself, then something like <code>expression(alpha)</code> is all you need to produce <em>β</em> in the plot, as in the first call to <code>text</code> shown in the code chunk. Note that the specification of the special characters is done <em>without</em> quotes around the name of the desired symbol. More commonly, however, you’ll want a character to appear alongside other components, such as regular text or in an equation. For that, you need to use <code>paste</code> inside the call to <code>expression</code>, separating the components with commas. These are shown in the remaining three calls to <code>text</code>.</p>&#13;
<p class="indent">You can use <code>cex</code> to control size, though use of <code>family</code> and <code>font</code> affects only quoted regular text, not symbols, as the final call to <code>text</code> demonstrates.</p>&#13;
<p class="indent">The <code>title</code> function, which allows you to add axis and main titles, is then used to add the title “Gr<em><span class="ent">ɛ</span><span class="ent">ɛ</span></em>k” by supplying the corresponding <code>expression</code> to <code>main</code>. I use <code>cex.main=2</code> in the same call to double its size (the slightly different tag <code>cex.main</code> is required there to distinguish between the size of the main title and any axis titles, controlled via <code>cex.lab</code>).</p>&#13;
<h4 class="h4" id="ch23lev2sec237"><strong><em>23.5.3 Mathematical Expressions</em></strong></h4>&#13;
<p class="noindent">Formatting entire mathematical expressions to appear in R plots is a bit more complicated and is reminiscent of using markup languages like L<small>A</small>T<sub>E</sub>X. Because of this, I won’t give a full exposition of the syntax required here, but I’ll provide some examples of the kinds of things that are possible, as <span epub:type="pagebreak" id="page_600"/>shown in <a href="ch23.xhtml#ch23fig13">Figure 23-13</a>. To create the image, I first defined four expression objects as follows:</p>&#13;
<pre>R&gt; expr1 &lt;- expression(c^2==a[1]^2+b[1]^2)<br/>R&gt; expr2 &lt;- expression(paste(pi^{x[i]},(1-pi)^(n-x[i])))<br/>R&gt; expr3 &lt;- expression(paste("Sample mean: ",<br/>                             italic(n)^{-1},<br/>                             sum(italic(x)[italic(i)],<br/>                                 italic(i)==1,<br/>                                 italic(n))<br/>                             ==frac(italic(x)[1]+...+italic(x)[italic(n)],<br/>                                    italic(n))))<br/>R&gt; expr4 &lt;- expression(paste("f(x","|",alpha,",",beta,<br/>                             ")"==frac(x^{alpha-1}~(1-x)^{beta-1},<br/>                                       B(alpha,beta))))</pre>&#13;
<p class="indent">And then I used them in the following code:</p>&#13;
<pre>R&gt; par(mar=c(3,3,3,3))<br/>R&gt; plot(1,1,type="n",xlim=c(-1,1),ylim=c(0.5,4.5),xaxt="n",yaxt="n",<br/>        ann=FALSE)<br/>R&gt; text(0,4:1,labels=c(expr1,expr2,expr3,expr4),cex=1.5)<br/>R&gt; title(main="Math",cex.main=2)</pre>&#13;
<div class="image"><img src="../images/f23-13.jpg" alt="image"/></div>&#13;
<p class="figt"><em><a id="ch23fig13"/>Figure 23-13: Some examples of typesetting mathematical expressions in R plots</em></p>&#13;
<p class="indentb"><span epub:type="pagebreak" id="page_601"/>All Greek and mathematical markup is contained within a call to <code>expression</code>. It’s necessary to use <code>paste</code> if you require separate components (separated by commas), some of which may or may not be regular text (in other words, in quotes) to produce the final result. Here are some key notes:</p>&#13;
<p class="bull">• Superscripts are given by <code>^</code> and subscripts by <code>[ ]</code>; for example, <code>c^2</code> provides c<sup>2</sup> in <code>expr1</code>, and the <code>a[1]^2</code> component provides <img class="middle" src="../images/f0601-01a.jpg" alt="image"/>.</p>&#13;
<p class="bull">• You can group components with parentheses <code>( )</code>, which are visible (for example, the <code>(1-pi)^(n-x[i])</code> component of <code>expr2</code>), or with braces <code>{ }</code>, which aren’t (for example, the <code>pi^{x[i]}</code> component).</p>&#13;
<p class="bull">• Italicized alphabetic variables are drawn with <code>italic()</code>; for example, <code>italic(n)</code> produces <em>n</em> in <code>expr3</code>.</p>&#13;
<p class="bull">• Constructs for common arithmetic operators already exist, such as <code>sum( , , )</code> and <code>frac( , )</code>; for example, in <code>expr3</code>, calling <code>sum(italic(x)[italic(i)],italic(i)==1,italic(n))</code> produces a result that looks like this:</p>&#13;
<div class="imagec"><img src="../images/f0601-01.jpg" alt="image"/></div>&#13;
<p class="bullp">and <code>frac(italic(x)[1]+...+italic(x)[italic(n)],italic(n))</code> produces an expression like this:</p>&#13;
<div class="imagec"><img src="../images/f0601-02.jpg" alt="image"/></div>&#13;
<p class="bull">• There are additional markup tools for proper formatting of expressions, such as combining regular text in quotes directly next to mathematical markup and creating spaces between components without needing to insert quotes. The need for these depends where the markup contents are exactly (in other words, as a stand-alone component of the call to <code>paste</code> or as a component of an operator tool like <code>frac</code>). See, for example, the <code>")"==frac( , )</code> part of <code>expr4</code>, and the space-separation of the two components <code>x^{alpha-1}~(1-x)^{beta-1}</code> with a <code>~</code> (these sit on the numerator of the fraction).</p>&#13;
<p class="indentt">There’s an extensive amount of functionality built in to R for this type of string formatting in graphical displays that I haven’t covered here. If you’re interested in seeing more, see the help file accessed by entering <code>?plotmath</code> at the prompt as a first step. There’s also an extremely useful demonstration, which you can view in R by entering <code>demo(plotmath)</code>, that shows off much of what’s possible, alongside the relevant syntax for <code>expression</code>.</p>&#13;
<h3 class="h3" id="ch23lev1sec81"><strong>23.6 A Fully Annotated Scatterplot</strong></h3>&#13;
<p class="noindent">To provide a final example that covers most of the concepts you’ve considered so far, let’s create a detailed plot of the MPG by horsepower data that was used in <a href="ch23.xhtml#ch23lev2sec232">Sections 23.4.1</a> to <a href="ch23.xhtml#ch23lev2sec234">23.4.3</a>. The images in <a href="ch23.xhtml#ch23fig14">Figure 23-14</a> show the final result as the largest plot on the bottom, with three smaller interim plots to illustrate the various stages of production appearing along the top.</p>&#13;
<div class="image"><span epub:type="pagebreak" id="page_602"/><img src="../images/f23-14.jpg" alt="image"/></div>&#13;
<p class="figt"><em><a id="ch23fig14"/>Figure 23-14: A detailed version of the</em> <code>mtcars</code> <em>scatterplot of MPG by horsepower, with point size proportional to weight</em></p>&#13;
<p class="indent">First, ensure you have the objects <code>mpg</code>, <code>hp</code>, <code>wtcex</code>, and <code>hpseq2</code> (defined in <a href="ch23.xhtml#ch23lev2sec232">Sections 23.4.1</a> and <a href="ch23.xhtml#ch23lev2sec234">23.4.3</a>) ready in your workspace, since you’ll use them to ease the length of the code. Here they are again:</p>&#13;
<pre>R&gt; hp &lt;- mtcars$hp<br/>R&gt; mpg &lt;- mtcars$mpg<br/>R&gt; wtcex &lt;- mtcars$wt/mean(mtcars$wt)<br/>R&gt; hpseq2 &lt;- seq(50,325,by=25)</pre>&#13;
<p class="indent">The plot, with a slightly wider right margin than default and a U-shaped box, is started with the following code:</p>&#13;
<pre>R&gt; dev.new()<br/>R&gt; par(mar=c(5,4,4,4))<br/>R&gt; plot(hp,mpg,cex=wtcex,axes=FALSE,ann=FALSE)<br/>R&gt; box(bty="u")</pre>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_603"/>This provides the top-left image of <a href="ch23.xhtml#ch23fig14">Figure 23-14</a>. I’ve used <code>dev.new</code> to explicitly open a new graphics device on my machine, which defaults to 7 × 7 inches. You can use <code>width</code> and <code>height</code> arguments supplied to <code>dev.new</code> to alter this on your machine if you want.</p>&#13;
<p class="indent">Now add some axes:</p>&#13;
<pre>R&gt; axis(2,las=1,tcl=-0.8,family="mono")<br/>R&gt; axis(1,at=hpseq2,labels=FALSE,tcl=-1)</pre>&#13;
<p class="indent">These two lines add the left vertical axis for MPG; the tick marks are lengthened a little using <code>tcl</code>, their labels are made horizontal through <code>las</code>, and a <code>"mono"</code> font is requested. For the horizontal axis (horsepower), longer outward tick marks are drawn at the values in <code>hpseq2</code>, but their labels are suppressed by setting <code>labels=FALSE</code>. You’ll populate those in a moment.</p>&#13;
<p class="indent">Rather than using MPG as a measure of fuel efficiency, many countries use “liters per one hundred kilometers” (L/100km). So, for their benefit, let’s say you want to provide a second vertical axis on the right of the plot that provides L/100km. To do this, you need the conversion formula. Based on a US gallon, an approximate conversion between the two is given by the following:</p>&#13;
<div class="imagec"><img src="../images/f0603-01.jpg" alt="image"/></div>&#13;
<p class="indent">It turns out that this function is <em>involutory</em>. That is, to convert from MPG back to L/100km, simply swap those two variables in the equation.</p>&#13;
<p class="indent">A little experimentation with the conversion formula, based on the limits of the observed MPG data, has given me a sensible collection of L/100km values at which to mark the right axis.</p>&#13;
<pre>R&gt; L100 &lt;- seq(22,7,by=-3)<br/>R&gt; L100<br/>[1] 22 19 16 13 10 7</pre>&#13;
<p class="indent">Note that these are in decreasing order for convenience, since you can see that once you convert these to MPG, the results are increasing:</p>&#13;
<pre>R&gt; MPG.L100 &lt;- (100/L100*3.78541)/1.609<br/>R&gt; MPG.L100<br/>[1] 10.69385 12.38236 14.70405 18.09729 23.52648 33.60925</pre>&#13;
<p class="indent">This makes sense—a smaller number for L/100km means a more fuel-efficient car.</p>&#13;
<p class="indent">Why do you need the MPG version of these numbers? Well, remember that the plot itself is on the scale of MPG, so to instruct R to mark off the appropriate tick marks on the right side, you need the L/100km values in MPG “coordinates.”</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_604"/>With that done, one final call to <code>axis</code> leaves you with the top-middle plot in <a href="ch23.xhtml#ch23fig14">Figure 23-14</a>.</p>&#13;
<pre>R&gt; axis(4,at=MPG.L100,labels=L100,las=1,tcl=0.3,mgp=c(3,0.3,0),family="mono")</pre>&#13;
<p class="indent">Of particular note here is that you’ve used <code>at</code> to specify the tick marks on the MPG scale, at the values in <code>MPG.L100</code>, but since they correspond to the L/100km sequence in <code>L100</code>, it’s the latter vector that you supply to <code>labels</code> to actually label said tick marks.</p>&#13;
<p class="indent">Next, it’s time to annotate the axes with some titles and provide the labels for the tick marks on the horizontal axis. Before doing that, construct an <code>expression</code> for the MPG-to-L/100km conversion to clarify the right vertical axis.</p>&#13;
<pre>R&gt; express.L100 &lt;- expression(paste(L/100,"km"%~~%frac(378.541,1.609%*%MPG)))</pre>&#13;
<p class="indent">In <code>express.L100</code>, the <code>%~~%</code> provides an “approximately equal to” sign (≈), and <code>%*%</code> provides an explicit multiplication symbol (×).</p>&#13;
<p class="indent">Then, by running the following lines, you get the top-right image in <a href="ch23.xhtml#ch23fig14">Figure 23-14</a>.</p>&#13;
<pre>R&gt; title(main="MPG by Horsepower",xlab="Horsepower",ylab="MPG",<br/>         family="serif")<br/>R&gt; mtext(express.L100,side=4,line=3,family="serif")<br/>R&gt; text(hpseq2,rep(7.5,length(hpseq2)),labels=hpseq2,srt=45,<br/>        xpd=TRUE,family="mono")</pre>&#13;
<p class="indent">The first line provides a main title and <em>x</em>- and <em>y</em>-axis titles in a <code>"serif"</code> style. Then <code>mtext</code> places a <code>"serif"</code> version of the arithmetic expression just created in an appropriate position <code>line=3</code> on the right axis (<code>side=4</code>). The third line places the <code>"mono"</code>-style tick mark labels in <code>hpseq2</code> along the <em>x</em>-axis at the appropriate user coordinates in the same vector, with a vertical position of <code>7.5</code>, after a little trial and error. Since you’re using <code>text</code> to draw in the figure margin, you must set <code>xpd</code> to <code>TRUE</code>. Special to <code>text</code> is the optional <code>srt</code> graphical parameter, which allows you to rotate the labels. Here, they’ve been rotated <code>45</code> degrees.</p>&#13;
<p class="indent">You’re now ready to put the final touches on the plot. So far, the scaled sizes of the points according to car weight have been ignored. It’d be helpful to provide at least minimal information about that and other features that can aid in interpretation of the relationship (especially since there are two vertical axes), like an overlaid grid.</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_605"/>Superimposition of a grid on such a plot is straightforward.</p>&#13;
<pre>R&gt; grid(col="darkgray")</pre>&#13;
<p class="indent">You can specify the number of cells along the horizontal and vertical axes using the optional arguments <code>nx</code> and <code>ny</code>, respectively; if not, R will draw the grid lines at what would be the default <em>x</em>- and <em>y</em>-axis tick marks (as I’ve let it do here). Other aesthetics can be altered in the usual way, using arguments such as <code>col</code> (color) and <code>lty</code> (line type).</p>&#13;
<p class="indent">The fun part is now trying to work out how to reference the sizes of the plotted points by the weights of the cars. There are a number of ways you might achieve this. For this last example, I’ll manhandle the <code>legend</code> function in an effort to produce the graphic. The following three lines provide the end result.</p>&#13;
<pre>R&gt; legend(250,30,legend=rep("           ",3),pch=rep(1,3),pt.cex=c(1.5,1,0.5))<br/>R&gt; arrows(265,27,265,29,length=0.05)<br/>R&gt; text(locator(1),labels="Weight",cex=0.8,family="serif")</pre>&#13;
<p class="indent">The legend is placed at user coordinates (250,30), and three points of the default <code>pch</code> type <code>1</code> are included—one large, one standard, and one small—using <code>pt.cex</code> set to <code>1.5</code>, <code>1</code>, and <code>0.5</code>, respectively. Instead of writing text labels for each of these three points by using the <code>legend</code> argument, I simply assign them to be empty strings made up of 10 spaces. What this does is widen the box around the legend, creating a space for what will instead accompany the three points—a small-headed arrow pointing upward and the word <em>Weight</em>. Finding suitable user coordinates for the arrow to fit inside the artificially empty legend box took a little trial and error, and I place the “Weight” text by invoking the interactive <code>locator</code> function as you saw used in <a href="ch23.xhtml#ch23lev1sec78">Section 23.3</a>.</p>&#13;
<p class="indent">Playing with R functionality to produce intricate plots like this is an excellent way to start learning how to handle the traditional graphical abilities of the language. It’s not uncommon to use trial and error and little cheats to reach an end result, though of course that kind of thing comes at the expense of the robustness of your code. For example, resizing the graphics device even moderately and attempting to reproduce the <code>mtcars</code> scatterplot shown earlier will likely result in a displeasing misalignment of the arrow in the legend. If you want to learn more, the authoritative reference on graphics in R is arguably Murrell (<a href="ref.xhtml#ref49">2011</a>), which is a good text to consult once you’re familiar with the fundamentals discussed here and want a comprehensive guide on all things visual in R.</p>&#13;
<div class="ex">&#13;
<p class="ext"><span epub:type="pagebreak" id="page_606"/><a id="ch23exc2"/><strong>Exercise 23.2</strong></p>&#13;
<p class="noindentz">For the following tasks, you’ll work with the diamond-pricing data as analyzed by Chu (<a href="ref.xhtml#ref13">2001</a>). You’ll need an Internet connection for this. Read the data in and name the columns as you’ve done previously with the following:</p>&#13;
<p class="programs-e1">R&gt; dia.url &lt;- "http://www.amstat.org/publications/jse/v9n2/4cdata.txt"<br/>R&gt; diamonds &lt;- read.table(dia.url)<br/>R&gt; names(diamonds) &lt;- c("Carat","Color","Clarity","Cert","Price")</p>&#13;
<ol type="a">&#13;
<li><p class="noindents">Open a new graphics device of 6 × 6 inches. Initialize the margin spacing to be zero, four, two, and zero lines on the bottom, left, top, and right of the plot region, respectively. Then, complete the following:</p>&#13;
<ol type="i">&#13;
<li><p class="noindents">Produce side-by-side boxplots of the diamond prices in Singapore dollars (SGD$) split by certification. Suppress all axes and the surrounding box—note that the <code>boxplot</code> command requires you to set <code>frame=FALSE</code> for suppressing the box (as opposed to <code>bty="n"</code> in <code>plot</code>). Use the same command to provide an appropriate title.</p></li>&#13;
<li><p class="noindents">Next, insert a vertical axis. The axis should have tick marks ranging from SGD$0 to SGD$18000, progressing in steps of SGD$2000. However, the axis should be clipped to the plotting region. The axis tick marks should point inward and be one line in length. The axis labels should sit only half a line away from the axis and should be horizontally readable.</p></li>&#13;
<li><p class="noindents">Finally, use <code>locator</code> in conjunction with <code>text</code> to add an appropriate title sitting at the top of the <em>y</em>-axis; note that clipping will need to be relaxed. Use the same approach to add text, sitting inside each boxplot, denoting the corresponding certification (GIA, HRD, or IGI).</p>&#13;
<p class="noindent">My version of the plot looks like this:</p>&#13;
<div class="imagec"><img src="../images/f0606-01.jpg" alt="image"/></div></li>&#13;
</ol></li>&#13;
<li><p class="noindents"><span epub:type="pagebreak" id="page_607"/>Now, open a new graphics device of 8 × 7 inches. Set the figure margins to be two, five, three, and five lines on the bottom, left, top, and right, respectively. Also allow one line of outer margin space on each side other than the bottom, which should get two lines of outer margin.</p>&#13;
<ol type="i">&#13;
<li><p class="noindents">Produce a scatterplot of diamond price on the vertical axis and carat weight on the horizontal axis. Use the colors red, green, and blue to distinguish the points according to certification. Suppress all axes, boxes, labels, and titles in the initial plot, but then add a U-shaped box.</p></li>&#13;
<li><p class="noindents">Add the horizontal axis. Use <code>axis</code> to place tick marks at an evenly spaced sequence of carat values between 0.2 and 1.1, in steps of 0.1. Use a bold, italic, sans-style font for the labels and adjust the labels to be only half a line from the axis. Then add smaller, outward-facing tick marks between the existing ones. To do this, make a second call to the <code>axis</code> function and place the ticks at a sequence of values from 0.15 to 1.05 at steps of 0.1. Set these secondary tick marks to have a length of one-quarter of a line and suppress the axis labels.</p></li>&#13;
<li><p class="noindents">Add the vertical axes. On the left, ticks should appear at SGD$1000–17000. Labels should be horizontally readable and in the same font style as the horizontal axis. On the right, axis ticks should be made in the equivalent of US dollars (USD$) at the sequence USD$1000–11000 in steps of USD$1000 and should be labeled as such. To do this, use the conversion USD$ = 1.37 × SGD$. Label orientation and font should match the other axes.</p></li>&#13;
<li><p class="noindents">Fit a linear model of price on a quadratic polynomial of carat weight for the data. Provide a prediction of the model for a sequence of carat values spanning the range of the observed values; include estimation of a 95 percent prediction interval. Use this information to superimpose a gray solid line for the fitted values and gray dashed lines for the prediction interval upon the scatterplot.</p></li>&#13;
<li><p class="noindents">Set up expression objects for labeling the approximate US dollar conversion and the regression equation. Name the conversion <code>expr1</code>; it should look something like USD$ ≈ 1.37 × SGD$. The regression equation should look similar to Price = <em>β<sub>0</sub></em> + <em>β</em><sub>1</sub>Carat + <em>β</em><sub>2</sub>Carat<sup>2</sup>; name it <code>expr2</code>.</p></li>&#13;
<li><p class="noindents">Use <code>mtext</code> to add an appropriate main title and titles for all three individual axes. You may need to experiment a little with line depth for each one, as well as whether to write in <span epub:type="pagebreak" id="page_608"/>the outer margin or the figure margin, depending on your own spacing preference. The rightmost axis title should make use of <code>expr1</code>.</p></li>&#13;
<li><p class="noindents">Either via trial and error to find appropriate coordinates or by using the <code>interactive.arrow</code> function from <a href="ch23.xhtml#ch23exc1">Exercise 23.1</a>, place an arrow pointing to the fitted polynomial regression line and label it with <code>expr2</code>.</p></li>&#13;
<li><p class="noindents">Finally, use a call to <code>locator</code> to place a legend in any appropriate location, referencing the color of the points according to the appropriate certification.</p>&#13;
<p class="noindent">My version of the plot looks like this:</p>&#13;
<div class="imagec"><img src="../images/f0608-01.jpg" alt="image"/></div></li>&#13;
</ol></li>&#13;
</ol>&#13;
</div>&#13;
<h5 class="h5" id="ch23lev3sec107"><strong>Important Code in This Chapter</strong></h5>&#13;
<table>&#13;
<thead>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table_th"><p class="table"><strong>Function/operator</strong></p></td>&#13;
<td style="vertical-align: top;" class="table_th"><p class="table"><strong>Brief description</strong></p></td>&#13;
<td style="vertical-align: top;" class="table_th"><p class="table"><strong>First occurrence</strong></p></td>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><code>dev.new</code></p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table">Open new graphics device</p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><a href="ch23.xhtml#ch23lev2sec222">Section 23.1.1</a>, <a href="ch23.xhtml#page_576">p. 576</a></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><code>dev.set</code></p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table">Change active device</p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><a href="ch23.xhtml#ch23lev2sec223">Section 23.1.2</a>, <a href="ch23.xhtml#page_577">p. 577</a></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><code>dev.off</code></p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table">Close device</p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><a href="ch23.xhtml#ch23lev2sec224">Section 23.1.3</a>, <a href="ch23.xhtml#page_578">p. 578</a></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><code>par</code></p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table">Set graphical parameters</p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><a href="ch23.xhtml#ch23lev2sec225">Section 23.1.4</a>, <a href="ch23.xhtml#page_579">p. 579</a></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><code>layout</code></p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table">Open new graphics device</p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><a href="ch23.xhtml#ch23lev2sec225">Section 23.1.4</a>, <a href="ch23.xhtml#page_580">p. 580</a></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><code>box</code></p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table">Add box to plot</p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><a href="ch23.xhtml#ch23lev2sec226">Section 23.2.1</a>, <a href="ch23.xhtml#page_583">p. 583</a></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><code>mtext</code></p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table">Write text in margins</p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><a href="ch23.xhtml#ch23lev2sec227">Section 23.2.2</a>, <a href="ch23.xhtml#page_584">p. 584</a></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><code>locator</code></p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table">Interactive coordinates</p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><a href="ch23.xhtml#ch23lev2sec229">Section 23.3.1</a>, <a href="ch23.xhtml#page_587">p. 587</a></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><code>axis</code></p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table">Add axis to plot</p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><a href="ch23.xhtml#ch23lev2sec234">Section 23.4.3</a>, <a href="ch23.xhtml#page_594">p. 594</a></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><code>expression</code></p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table">Render Greek/math in plot</p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><a href="ch23.xhtml#ch23lev2sec236">Section 23.5.2</a>, <a href="ch23.xhtml#page_598">p. 598</a></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><code>title</code></p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table">Add main/axis titles</p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><a href="ch23.xhtml#ch23lev2sec236">Section 23.5.2</a>, <a href="ch23.xhtml#page_598">p. 598</a></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><code>italic</code></p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table">Italicize text</p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><a href="ch23.xhtml#ch23lev2sec237">Section 23.5.3</a>, <a href="ch23.xhtml#page_600">p. 600</a></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><code>grid</code></p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table">Add grid to plot</p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><a href="ch23.xhtml#ch23lev1sec81">Section 23.6</a>, <a href="ch23.xhtml#page_605">p. 605</a></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
</body></html>