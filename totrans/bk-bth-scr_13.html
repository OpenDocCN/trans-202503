<html><head></head><body>
<div id="sbo-rt-content" class="calibre1"><section aria-labelledby="ch12" epub:type="chapter" role="doc-chapter">
<hgroup>
<h2 class="title" id="ch12">
<span class="cn"><span aria-label=" Page 127. " epub:type="pagebreak" id="pg_127" role="doc-pagebreak" class="calibre2"/><span class="sans_dogma_ot_bold_b_">12</span></span>
<span class="ct1"><span class="sans_dogma_ot_bold_b_">OUTPUTS, REDIRECTION, AND PIPING</span></span>
</h2>
</hgroup>
<figure class="opener"><img alt="" class="opener1" height="407" src="../images/chapter.jpg" width="408"/>
</figure>
<p class="chapterintro">You can now do quite a bit with Batch, such as setting, resetting, and interrogating variables of various data types, calling routines and other bat files, and performing arithmetic; however, most of what you’ve learned will have no lasting effect (except for file movements and the ability to set variables persistently). At the end of a bat file’s ephemeral execution, all of the bits and bytes that’ve been manipulated may vanish into the ether, and it’ll be as if the bat file had never existed.</p>
<p class="tx">I’ll leave the metaphysics of Batch for another time, but whenever code of any type is executed, the intent is to effect some sort of change. Some coders will use Batch simply as a wrapper, setting a few variables before calling an executable that’ll bring about that change, but Batch can do much more. In this chapter, I’ll discuss two general types of output: output from <span aria-label=" Page 128. " epub:type="pagebreak" id="pg_128" role="doc-pagebreak"/>the interpreter (stdout and stderr) and output from you, the coder. After learning the distinction, you’ll be able to write the different types of output to the console, new files, and existing files. In this way, you can store the product of all those variables, calls, and arithmetic on your computer.</p>
<p class="tx">The discussion about the two types of output will lead to a couple of related and interesting topics. One is the redirection of the output of any Batch command to a file, and the other is piping, the technique of sending output from one command into another command. Maybe most important, you’ll learn what exactly is scrolling by so quickly on the console and how to manage it—that is, either save or suppress it.</p>
<section aria-labelledby="sec1" epub:type="division">
<h3 class="h" id="sec1"><span id="h1-87"/><span class="sans_futura_std_bold_b_">Interpreter-Generated vs. Coder-Generated Output</span></h3>
<p class="tni">When you open or execute a bat file, it creates two general types of outputs: interpreter-generated and coder-generated. To be perfectly clear, the interpreter technically creates all of the output, but some of that output is the result of commands entered by you, the coder, to write something to the console or a file. That’s <i class="calibre6">coder-generated output</i>. As a byproduct of the run, the interpreter is also creating output that you didn’t explicitly request. That’s <i class="calibre6">interpreter-generated output</i>.</p>
<p class="tx">All Batch commands create interpreter-generated output; a few also create coder-generated output. By default, Batch writes both types of output to the console, and if the bat file is even moderately complex, the text scrolls by in a jumble that’s too fast to read.</p>
<p class="tx">The <span class="sans_thesansmonocd_w5regular_">echo</span> command is a great example of one that generates both general types of output, and in its simplest manifestation, it writes all of its arguments to the console. Consider this command:</p>
<pre class="pre"><code class="calibre11">echo Greetings, Earthlings.</code></pre>
<p class="tx">The execution of this command writes the output shown in <a href="#Lis12-1" class="calibre3">Listing 12-1</a> to the console.</p>
<span id="Lis12-1"/>
<pre class="pre"><code class="calibre11">C:\Batch&gt;echo Greetings, Earthlings. 
Greetings, Earthlings.
</code></pre>
<p class="listingcaption"><span class="futura_std_book_oblique_i_">Listing 12-1: Output generated by the interpreter and the coder</span></p>
<p class="tni">The desired text, <span class="sans_thesansmonocd_w5regular_">Greetings, Earthlings.</span>, is output, but it isn’t alone and appears twice, with the current directory prepended to the first line for some reason. (I’ll assume that the current directory is <i class="calibre6">C:\Batch\</i> throughout this chapter.)</p>
<p class="tx">The two lines in <a href="#Lis12-1" class="calibre3">Listing 12-1</a> represent entirely different types of outputs. The second line is from the coder—a message written to the console with the <span class="sans_thesansmonocd_w5regular_">echo</span> command. The interpreter generates the first line. It isn’t the output of the <span class="sans_thesansmonocd_w5regular_">echo</span> command; it’s a <i class="calibre6">report of the execution</i> of the <span class="sans_thesansmonocd_w5regular_">echo</span> command.</p>
<p class="tx"><span aria-label=" Page 129. " epub:type="pagebreak" id="pg_129" role="doc-pagebreak"/>The distinction is as subtle as it is important. The interpreter, at a minimum, logs the execution of every command by writing it, prepended with the prompt. By default, the prompt is the current directory followed by a greater-than sign. Many commands produce additional interpreter-generated output, such as the <span class="sans_thesansmonocd_w5regular_">xcopy</span> command, which often produces a list of the files copied.</p>
<p class="tx">Clearly, the intermingled output is a mess, and if this example doesn’t look like a mess, that’s because I’m showing the output from only a single command. Before long, I’ll show you how to clean up the console by sending these distinct outputs to different destinations, but first you’ll need to better understand the interpreter-generated output, which itself is actually two different outputs.</p>
</section>
<section aria-labelledby="sec2" epub:type="division">
<h3 class="h" id="sec2"><span id="h1-88"/><span class="sans_futura_std_bold_b_">stdout and stderr</span></h3>
<p class="tni">Batch writes every bit of interpreter-generated output to one of two data streams. A <i class="calibre6">data stream</i> is a transmission of information from a source—in this case, the interpreter—to a destination, which by default is the console. A file descriptor represents each data stream, and the most voluminous by far is the stream described as <i class="calibre6">stdout</i>, pronounced <i class="calibre6">standard out</i> (or less frequently, <i class="calibre6">standard output</i>). In fact, the only interpreter-generated output not found in stdout are error messages, which are written to the file descriptor <i class="calibre6">stderr</i>, pronounced <i class="calibre6">standard error</i>.</p>
<p class="tx">The stdout data stream can become dense and cryptic, but it’s often invaluable to help you determine what exactly transpired during a bat file’s execution. You can often see the results of <span class="sans_thesansmonocd_w5regular_">if</span> commands, what files were created, and much more. To demonstrate, the following <span class="sans_thesansmonocd_w5regular_">del</span> command deletes a file and is followed by a <span class="sans_thesansmonocd_w5regular_">set</span> command that captures <span class="sans_thesansmonocd_w5regular_">errorlevel</span> as the return code:</p>
<pre class="pre"><code class="calibre11">del C:\Batch\DeleteMe.txt 
set rc=%errorlevel%
</code></pre>
<p class="tni">Nothing here creates coder-generated output; all output comes from the interpreter.</p>
<p class="tx">If the <i class="calibre6">DeleteMe.txt</i> file exists, the previous code deletes it and writes the following to stdout:</p>
<pre class="pre"><code class="calibre11">C:\Batch&gt;del C:\Batch\DeleteMe.txt   

C:\Batch&gt;set rc=0
</code></pre>
<p class="tx">Most variables are resolved in stdout, such as <span class="sans_thesansmonocd_w5regular_">errorlevel</span> being resolved to <span class="sans_thesansmonocd_w5regular_">0</span> in this example. (Frustratingly, the interpreter fails to resolve variables fully in certain situations, such as when using delayed expansion. See <span class="xref"><a href="chapter31.xhtml" class="calibre3">Chapter 31</a></span> for more details.)</p>
<p class="tx">Interspersed with stdout can be the second type of interpreter-generated output, the output written to the stderr data stream, but only if there are <span aria-label=" Page 130. " epub:type="pagebreak" id="pg_130" role="doc-pagebreak"/>any errors, of course. If, for instance, the file in the <span class="sans_thesansmonocd_w5regular_">del</span> command doesn’t exist, the interpreter outputs the following:</p>
<pre class="pre"><code class="calibre11">C:\Batch&gt;del C:\Batch\DeleteMe.txt   
Could Not Find C:\Batch\DeleteMe.txt   

C:\Batch&gt;set rc=0
</code></pre>
<p class="tx">The first and last lines are written to stdout, but the middle line stating that the file couldn’t be found is written to stderr. It’s important to understand that error messages are written to stderr, while all other interpreter-generated output goes to stdout. Both are needed to get a full picture of what happened during a bat file’s execution, and unless we do something to intervene, both are written to the console.</p>
<p class="tx">(By the way, let’s not quibble over why the return code is <span class="sans_thesansmonocd_w5regular_">0</span> even if an error message is generated. But if we must, the file doesn’t exist after the <span class="sans_thesansmonocd_w5regular_">del</span> command completes, so in a certain prosaic sense, it was successful, or it’s a bug.)</p>
</section>
<section aria-labelledby="sec3" epub:type="division">
<h3 class="h" id="sec3"><span id="h1-89"/><span class="sans_futura_std_bold_b_">Writing Files</span></h3>
<p class="tni">Creating, writing to, and appending to files are basic functions of most coding languages, and Batch allows you to build files with both coder- and interpreter-generated output. Up until now, all of the output that you have seen has been written to the console, and when the bat file completes, the window closes.</p>
<p class="tx">Often, you’ll want to create files that persist beyond the life of the bat file’s execution. You can write data to a file to use as input to an executable or even another bat file. If I want a record of how often others run one of my bat files, I’ll set it up to write one record to a central logfile with information about when and on what server it ran. You can even build reports, and capturing the interpreter-generated output into a file provides you with a great audit trail of exactly what transpired during the bat file’s execution.</p>
<section aria-labelledby="sec4" epub:type="division">
<h4 class="h1" id="sec4"><span id="h2-34"/><span class="sans_futura_std_heavy_oblique_bi_">From Coder-Generated Output</span></h4>
<p class="tni">I’ve shown that we can write text to the console with the <span class="sans_thesansmonocd_w5regular_">&gt; con</span> syntax. With a similar syntax, we can write to a file with two commands: the familiar <span class="sans_thesansmonocd_w5regular_">echo</span> command writes a record, and the not-so-familiar <span class="sans_thesansmonocd_w5regular_">type</span> command writes an entire file to another file.</p>
<section aria-labelledby="sec5" epub:type="division">
<h5 class="h2" id="sec5"><span class="sans_futura_std_bold_b_">Writing a Record to a File</span></h5>
<p class="tni">Let’s return to the extraterrestrials. Instead of greeting us via the console, they might want to enter their greeting into a simple text file, and they can accomplish this with a single line of code:</p>
<pre class="pre"><code class="calibre11">echo Greetings, Earthlings.&gt; C:\Batch\ET.txt</code></pre>
<p class="tx"><span aria-label=" Page 131. " epub:type="pagebreak" id="pg_131" role="doc-pagebreak"/>This line of code has four distinct elements. The first is the <span class="sans_thesansmonocd_w5regular_">echo</span> command, and the second is the command’s argument: the <span class="sans_thesansmonocd_w5regular_">Greetings, Earthlings.</span> text. The third element is the greater-than sign (<span class="sans_thesansmonocd_w5regular_">&gt;</span>), or redirection character. This character redirects the output of the command preceding it to the target, which is the fourth element: the <i class="calibre6">C:\Batch\ET.txt</i> file. Putting it all together, the previous statement writes the one line of greeting to the text file.</p>
<p class="tx">The following alternative syntax performs the identical task, but it’s easier to read because the message no longer abuts the greater-than sign as it did in the previous example. I’ve moved the redirection character to the fore, again followed by the target:</p>
<pre class="pre"><code class="calibre11">&gt; C:\Batch\ET.txt  echo Greetings, Earthlings.</code></pre>
<p class="tni">If you replace the path and filename in this example with <span class="sans_thesansmonocd_w5regular_">con</span>, you’ll recognize the familiar syntax for writing to the console.</p>
<p class="tx">The following example demonstrates the appeal of this syntax. If the aliens have more than one line to communicate, they can set the target file path and name to a variable and use it in successive <span class="sans_thesansmonocd_w5regular_">echo</span> commands. This syntax allows for multiple usages of the redirection, target, and <span class="sans_thesansmonocd_w5regular_">echo</span> command to be lined up in an orderly fashion, making it easier to read what’s being written to the file:</p>
<pre class="pre"><code class="calibre11">set alienFile=C:\Batch\ET.txt 
&gt;  %alienFile%  echo Greetings, Earthlings.
&gt;&gt; %alienFile%  echo.
&gt;&gt; %alienFile%  echo Take us to your leader.
</code></pre>
<p class="tx">Before we move on, I snuck a couple of subtle yet important features into the previous code. The first <span class="sans_thesansmonocd_w5regular_">echo</span> command has a single greater-than sign for the redirection, while the subsequent commands each use two greater-than signs. The single character operator creates a new file with its text, deleting the current file of that name if it exists. The two-character operator appends to an existing file. A rookie mistake is to use a single greater-than sign for multiple commands, leaving the novice Batch coder wondering why only the last of several commands worked, when they all actually worked, each wiping out the existing file and writing a single line of text.</p>
<p class="tx">The other important feature is the <span class="sans_thesansmonocd_w5regular_">echo</span> command followed immediately by a dot; it’ll write a blank line, not a dot. After this code executes, the complete contents of <i class="calibre6">ET.txt</i> contain these three lines:</p>
<pre class="pre"><code class="calibre11">Greetings, Earthlings.

Take us to your leader.
</code></pre>
<p class="tx">If you ever need to write a single dot on a line, leave a space between <span class="sans_thesansmonocd_w5regular_">echo</span> and the dot.</p>
</section>
<section aria-labelledby="sec6" epub:type="division">
<h5 class="h2" id="sec6"><span aria-label=" Page 132. " epub:type="pagebreak" id="pg_132" role="doc-pagebreak"/><span class="sans_futura_std_bold_b_">Writing a File to a File</span></h5>
<p class="tni">Another useful command that you can couple with redirection is the <span class="sans_thesansmonocd_w5regular_">type</span> command. Used alone, the command writes out, or types, the complete contents of a file to stdout and the console. With redirection, it can insert the full contents of that file into another file. The following example writes the contents of <i class="calibre6">DetailRecs.txt</i> to <i class="calibre6">OutFile.txt</i>, prepended with a header record and appended with a trailer record via a couple <span class="sans_thesansmonocd_w5regular_">echo</span> commands:</p>
<pre class="pre"><code class="calibre11">set outFil=C:\Batch\OutFile.txt
&gt;  %outFil%  echo This is a Header Record
&gt;&gt; %outFil%  type C:\Batch\DetailRecs.txt
&gt;&gt; %outFil%  echo This is a Trailer Record
</code></pre>
<p class="tni">Notice that only the first <span class="sans_thesansmonocd_w5regular_">echo</span> command has the single character redirection operator, thus ensuring that it’s truly a header record.</p>
</section>
</section>
<section aria-labelledby="sec7" epub:type="division">
<h4 class="h1" id="sec7"><span id="h2-35"/><span class="sans_futura_std_heavy_oblique_bi_">From Interpreter-Generated Output</span></h4>
<p class="tni">You now know that the mess scrolling by on the console is mostly stdout with the possibility of some stderr and coder-generated output. You can also control the destination (console or file) of the coder-generated output. The missing piece is what to do about the interpreter-generated output. By default, it’s sent to the console, but with a modicum of effort, you can write everything the interpreter generates to a file, commonly called a <i class="calibre6">trace file</i>.</p>
<p class="tx">In the previous section, you learned how to redirect the output of the <span class="sans_thesansmonocd_w5regular_">echo</span> and <span class="sans_thesansmonocd_w5regular_">type</span> commands to a file, but you can redirect the output of any command, in particular the <span class="sans_thesansmonocd_w5regular_">call</span> command. In <span class="xref"><a href="chapter10.xhtml" class="calibre3">Chapter 10</a></span>, I introduced the concept of calling routines within a bat file, so you can create a routine containing the bat file’s main logic and call it at the top of the file. What’s new here is the redirection operator and the trace file appended to the first line in the following example:</p>
<pre class="pre"><code class="calibre11"> @call :GetTrace &gt; C:\Batch\Trace.txt
 pause
 goto :eof

:GetTrace
 &gt; con echo Greetings, Earthlings.
 &gt; con echo.
 &gt; con echo Take us to your leader.
 goto :eof
</code></pre>
<p class="tni">This is a complete bat file that writes the greeting to the console and captures the trace file.</p>
<p class="tx">The at symbol (<span class="sans_thesansmonocd_w5regular_">@</span>) prefixing the first command suppresses the <span class="sans_thesansmonocd_w5regular_">call</span> command itself from the console, but not the <span class="sans_thesansmonocd_w5regular_">call</span> command’s output. Critically, the output from the <span class="sans_thesansmonocd_w5regular_">call</span> command is the stdout coming out of the called routine, and that output is redirected via the greater-than sign in the first line away from the console and to the trace file. Notice that the greeting <span aria-label=" Page 133. " epub:type="pagebreak" id="pg_133" role="doc-pagebreak"/>itself at the bottom of the file is explicitly being sent to the console with <span class="sans_thesansmonocd_w5regular_">&gt; con</span> prefixing each of the three <span class="sans_thesansmonocd_w5regular_">echo</span> commands. Without the redirection, the greeting would’ve been written to the trace file with the rest of stdout.</p>
<p class="tx">Each data stream has a reference or numerical handle so that you can refer to one or the other with minimal keystrokes. The reference for stdout is <span class="sans_thesansmonocd_w5regular_">1</span>, and placing that reference number before the redirection character explicitly diverts stdout to the trace file. But stdout is redirected by default with the greater-than sign alone, so the following two commands are functionally equivalent:</p>
<pre class="pre"><code class="calibre11">@call :GetTrace &gt; C:\Batch\Trace.txt
@call :GetTrace 1&gt; C:\Batch\Trace.txt
</code></pre>
<p class="tx">In both commands, stdout alone is written to the trace file, and any error messages from stderr will end up being displayed on the console.</p>
<p class="tx">The stderr data stream is referenced by <span class="sans_thesansmonocd_w5regular_">2</span>, so you can redirect these error messages instead with this one-byte modification prior to the redirection symbol:</p>
<pre class="pre"><code class="calibre11">@call :GetTrace 2&gt; C:\Batch\Trace.txt</code></pre>
<p class="tx">You can even redirect each data stream, stdout and stderr, to entirely different files at once:</p>
<pre class="pre"><code class="calibre11">@call :GetTrace 1&gt; C:\Batch\stdout.txt 2&gt; C:\Batch\stderr.txt</code></pre>
<p class="tx">In practice, separating the data streams is rarely useful as any error messages won’t be tied to the commands that generated them.</p>
<p class="tx">A far superior solution, shown in <a href="#Lis12-2" class="calibre3">Listing 12-2</a>, is to write both outputs to the trace file, and that’s accomplished with this particularly esoteric syntax at the end of the command including <span class="sans_thesansmonocd_w5regular_">2</span> and <span class="sans_thesansmonocd_w5regular_">1</span>, for stderr and stdout, respectively.</p>
<span id="Lis12-2"/>
<pre class="pre"><code class="calibre11">@call :GetTrace &gt; C:\Batch\Trace.txt 2&gt;&amp;1</code></pre>
<p class="listingcaption"><span class="futura_std_book_oblique_i_">Listing 12-2: The ideal technique to redirect stdout and stderr to a trace file</span></p>
<p class="tx">As you are aware, the ampersand (<span class="sans_thesansmonocd_w5regular_">&amp;</span>) is the command separator used to execute two commands coded on a single line. But used in the manner shown in <a href="#Lis12-2" class="calibre3">Listing 12-2</a>, the interpreter treats the ampersand simply as part of the redirection syntax. Just chalk this up as another batveat and don’t ask why, but it’s the best technique for capturing a trace file.</p>
</section>
</section>
<section aria-labelledby="sec8" epub:type="division">
<h3 class="h" id="sec8"><span id="h1-90"/><span class="sans_futura_std_bold_b_">Suppressing stdout and stderr</span></h3>
<p class="tni">You can watch stdout and stderr scroll by on the console, or you can save both data streams to a trace file. In other situations, this data simply isn’t needed at all. It might not be worth the disk space to create a log of every <span aria-label=" Page 134. " epub:type="pagebreak" id="pg_134" role="doc-pagebreak"/>execution of a stable and frequently run process, and you might not even want stdout and stderr written to the console because you want it uncluttered for any coder-generated output. In such cases, you’ll want to outright suppress the interpreter-generated output. Two techniques work; one is simple but works only on stdout, while the slightly more complex technique also works on stderr.</p>
<section aria-labelledby="sec9" epub:type="division">
<h4 class="h1" id="sec9"><span id="h2-36"/><span class="sans_futura_std_heavy_oblique_bi_">The @echo off Technique</span></h4>
<p class="tni">The simple technique to suppress stdout is with the <span class="sans_thesansmonocd_w5regular_">@echo off</span> command. Based on what you’ve learned about the <span class="sans_thesansmonocd_w5regular_">echo</span> command, you might expect this particular command to write <span class="sans_thesansmonocd_w5regular_">off</span> to stdout. Afterall, <span class="sans_thesansmonocd_w5regular_">echo Hello</span> writes <span class="sans_thesansmonocd_w5regular_">Hello</span> to stdout. Usually, <span class="sans_thesansmonocd_w5regular_">echo</span> writes out its arguments, but there are two exceptions.</p>
<p class="tx">The <span class="sans_thesansmonocd_w5regular_">off</span> argument instructs the interpreter to suppress (or turn off) stdout, and the <span class="sans_thesansmonocd_w5regular_">on</span> argument turns it back on, with one catch. The <span class="sans_thesansmonocd_w5regular_">echo</span> command to suppress stdout is itself written to stdout. Fortunately, Batch allows for the suppression of any single command’s contribution to stdout simply by prepending it with the at symbol (<span class="sans_thesansmonocd_w5regular_">@</span>). Hence, the command to suppress stdout that is itself suppressed is <span class="sans_thesansmonocd_w5regular_">@echo off</span>. I quietly introduced this technique in <span class="xref"><a href="chapter2.xhtml" class="calibre3">Chapter 2</a></span> to clean up the console but sidestepped a deeper explanation for later (which is now).</p>
<p class="tx">If the extraterrestrials were to communicate with us via the console, this simple bat file would do the trick:</p>
<pre class="pre"><code class="calibre11">@echo off
echo Greetings, Earthlings.
echo.
pause
</code></pre>
<p class="tni">The first <span class="sans_thesansmonocd_w5regular_">echo</span> suppresses stdout so as to keep the console uncluttered and readable. Try this bat file without that first line to see the difference. It’s ugly; each <span class="sans_thesansmonocd_w5regular_">echo</span> command generates both general types of output to the console. With this command in place, the second <span class="sans_thesansmonocd_w5regular_">echo</span> command writes only its arguments to the console. The <span class="sans_thesansmonocd_w5regular_">echo</span> command followed immediately by a dot writes a blank line. Finally, the <span class="sans_thesansmonocd_w5regular_">pause</span> command keeps the window open so that it doesn’t disappear in a flash. The result is:</p>
<pre class="pre"><code class="calibre11">Greetings, Earthlings.

Press any key to continue ...
</code></pre>
<p class="tx">Press any key, and the <span class="sans_thesansmonocd_w5regular_">pause</span> command allows the bat file to continue, closing the window. In <span class="xref"><a href="chapter3.xhtml" class="calibre3">Chapter 3</a></span>, I mentioned that I start every high-level bat file with a <span class="sans_thesansmonocd_w5regular_">setlocal</span> command that enables command extensions and delayed expansion. This <span class="sans_thesansmonocd_w5regular_">echo</span> command is the only command that might come before that <span class="sans_thesansmonocd_w5regular_">setlocal</span>, thus keeping the console pristine. However, you also can prepend the <span class="sans_thesansmonocd_w5regular_">setlocal</span> command itself with an at symbol to suppress its execution from stdout.</p>
<p class="tx"><span aria-label=" Page 135. " epub:type="pagebreak" id="pg_135" role="doc-pagebreak"/>As a side note, every novice Batch coder will likely try to write a blank line with nothing but spaces following the <span class="sans_thesansmonocd_w5regular_">echo</span> command, even if only by accident. But that command simply writes out the state of the <span class="sans_thesansmonocd_w5regular_">echo</span>, which is either <span class="sans_thesansmonocd_w5regular_">on</span> or <span class="sans_thesansmonocd_w5regular_">off</span>. For instance, executing the following two lines at the beginning of a bat file writes <span class="sans_thesansmonocd_w5regular_">ECHO is off.</span> to the console:</p>
<pre class="pre"><code class="calibre11">echo off
&gt; con echo
</code></pre>
<p class="tni">Likewise, replacing the first line with <span class="sans_thesansmonocd_w5regular_">echo on</span> activates stdout, resulting in <span class="sans_thesansmonocd_w5regular_">ECHO is on.</span> as the output.</p>
<p class="tx">The <span class="sans_thesansmonocd_w5regular_">@echo off</span> technique has one more catch. While stdout is suppressed, stderr is unaffected, which means that any unredirected error messages will appear on the console with little or no context.</p>
</section>
<section aria-labelledby="sec10" epub:type="division">
<h4 class="h1" id="sec10"><span id="h2-37"/><span class="sans_futura_std_heavy_oblique_bi_">The Redirection to nul Technique</span></h4>
<p class="tni">The best technique for suppressing all interpreter-generated output is to redirect stdout and stderr to the <i class="calibre6">nul</i> file introduced in <span class="xref"><a href="chapter7.xhtml" class="calibre3">Chapter 7</a></span>. This file is always empty, regardless of what’s written to it, making it something of a Batch trash receptacle. For instance, reworking the <span class="sans_thesansmonocd_w5regular_">call</span> command from <a href="#Lis12-2" class="calibre3">Listing 12-2</a> to send stdout and stderr to <i class="calibre6">nul</i> instead of a trace file effectively suppresses all interpreter-generated output:</p>
<pre class="pre"><code class="calibre11">@call :GetTrace &gt; nul 2&gt;&amp;1</code></pre>
<p class="tni">However, the name of the routine is now a misnomer. (Rename the label <span class="sans_thesansmonocd_w5regular_">:SuppressTrace</span> if you must.)</p>
<p class="tx">This technique does require that you create a routine for the mainline logic, but it’s very effective, it’s relatively simple, and you can use it to suppress all the interpreter-generated output of called bat files as well as routines. The leading at sign even suppresses the <span class="sans_thesansmonocd_w5regular_">call</span> command itself from stdout.</p>
<p class="tx">You can use this technique to suppress the output of any command. For instance, the following executes the compiled program, while simply discarding its command line output:</p>
<pre class="pre"><code class="calibre11">&gt; nul SomeProgramWithUnwantedOutput.exe</code></pre>
<p class="tx">Prepending (or even appending) the program execution with a redirection to the <i class="calibre6">nul</i> file resolves the issue nicely.</p>
</section>
</section>
<section aria-labelledby="sec11" epub:type="division">
<h3 class="h" id="sec11"><span id="h1-91"/><span class="sans_futura_std_bold_b_">Remarks in stdout</span></h3>
<p class="tni">I’ve one last remark about stdout. In <span class="xref"><a href="chapter2.xhtml" class="calibre3">Chapter 2</a></span>, I introduced the <span class="sans_thesansmonocd_w5regular_">rem</span> command as a simple means of entering a remark or comment into the code. An alternative syntax exists and has ramifications for stdout.</p>
<p class="tx"><span aria-label=" Page 136. " epub:type="pagebreak" id="pg_136" role="doc-pagebreak"/>Remarks generated with the <span class="sans_thesansmonocd_w5regular_">rem</span> command are written to stdout. However, any line in the code preceded with two colons (<span class="sans_thesansmonocd_w5regular_">::</span>) is also treated as a remark, but it’s a hidden remark suppressed from stdout. Consider these two valid remarks:</p>
<pre class="pre"><code class="calibre11">rem This is a Remark shared to stdout.
::This is a Top Secret Remark not meant for the Hoi Polloi.
</code></pre>
<p class="tni">You’ll find only the first remark in stdout. Also notice that the dual colons don’t require a space before the remark text. In <span class="xref"><a href="chapter9.xhtml" class="calibre3">Chapter 9</a></span>, I mentioned that labels must start with a colon, but the second character must be a different character. This is because the double colons signify a hidden remark.</p>
<p class="tx">There’s nothing nefarious about a hidden remark. Remarks that explain the code can be useful in stdout, but others might muddy it up. This is a great technique for coders to keep notes for themselves in the code, and only in the code. For instance, it’s always good to maintain a detailed history of revisions in the source code, but those details might just make a mess of the trace file. If so, use double colons for such remarks.</p>
</section>
<section aria-labelledby="sec12" epub:type="division">
<h3 class="h" id="sec12"><span id="h1-92"/><span class="sans_futura_std_bold_b_">Redirection of Any Command</span></h3>
<p class="tni">I’ve shown that redirection of the <span class="sans_thesansmonocd_w5regular_">echo</span>, <span class="sans_thesansmonocd_w5regular_">type</span>, and <span class="sans_thesansmonocd_w5regular_">call</span> commands can write output to a file, but those are just three examples. You can redirect the output of any Batch command. To take just one example, you can send output of the following <span class="sans_thesansmonocd_w5regular_">xcopy</span> command to a logfile:</p>
<pre class="pre"><code class="calibre11">set copyLog=C:\Batch\Copy.log
&gt;&gt; %copyLog% xcopy C:\Batch\*.dat D:\Backup\ /Y /F
</code></pre>
<p class="tx">The <i class="calibre6">.dat</i> files are copied to <i class="calibre6">D:\Backup\</i> with or without the redirection, but the interpreter now appends the resulting text that lists all of the files just copied along with a total count to the <i class="calibre6">Copy.log</i> file. It’s appended because of the two greater-than signs; the single character operator would have created a new file with the output.</p>
<p class="tx">Although you can perform redirection for any command, many don’t have output or have drab output not worth capturing. In the next chapter, I’ll introduce the <span class="sans_thesansmonocd_w5regular_">dir</span> command, which writes details about all the files and subfolders in a directory to stdout. That’s the type of information that’s easily and often redirected to a file. Command line output from a compiled program is another example of data often worth capturing.</p>
</section>
<section aria-labelledby="sec13" epub:type="division">
<h3 class="h" id="sec13"><span id="h1-93"/><span class="sans_futura_std_bold_b_">Piping</span></h3>
<p class="tni">Redirection typically sends output to a file, but piping sends output to an entirely different destination. <i class="calibre6">Piping</i> is the concept of joining two distinct commands. The interpreter sends the output of the first command to the second command as input via some sort of a tube, hose, duct, conduit, or ... there’s a better metaphor for a physical conveyance, oh ... a pipe. <span aria-label=" Page 137. " epub:type="pagebreak" id="pg_137" role="doc-pagebreak"/>The character used to make this connection is, appropriately enough, the pipe character, also called the vertical bar or upright slash. On most keyboards, it’s above <small class="calibre5">ENTER</small>, and you press <small class="calibre5">SHIFT</small>-\ to access it.</p>
<p class="tx">To this point you’ve seen the results of the <span class="sans_thesansmonocd_w5regular_">echo</span> command redirected to the console, stdout, or a particular file, but you also can pipe those results to other Batch commands. Recall the <span class="sans_thesansmonocd_w5regular_">xcopy</span> command from <span class="xref"><a href="chapter7.xhtml" class="calibre3">Chapter 7</a></span> that, as part of the copy, gave the destination file a different name from the source file. At the time, I warned that such a command sometimes fails, and I promised a solution in this chapter, and that solution is piping. The following command certainly appears to be a straightforward copy with a renamed destination file:</p>
<pre class="pre"><code class="calibre11">xcopy C:\Batch\OldName.txt C:\Target\NewName.txt /Y /F</code></pre>
<p class="tx">If the <i class="calibre6">NewName.txt</i> file exists at the target path, this command simply overlays the file and moves on. But due to the vagaries of Batch (or less diplomatically, a possible bug), if <i class="calibre6">NewName.txt</i> doesn’t exist, the interpreter gets a bit confused. The source file is clearly <i class="calibre6">OldName.txt</i>, but is <i class="calibre6">NewName.txt</i> the name of the destination file or the destination folder? The <i class="calibre6">.txt</i> extension should make it obvious to the interpreter, but directory names can include dots. (But shame on anyone who would give a folder name a typical file extension.) When the interpreter gets confused, it does what a lost human should do; it asks directions:</p>
<pre class="pre"><code class="calibre11">C:\Batch&gt;xcopy C:\Batch\OldName.txt C:\Target\NewName.txt /Y /F 
Does C:\Target\NewName.txt specify a file name
or directory name on the target
(F = file, D = directory)?
</code></pre>
<p class="tx">If you had typed the <span class="sans_thesansmonocd_w5regular_">xcopy</span> command into a command prompt and seen that message written to the console, undoubtedly you would’ve simply entered <span class="sans_thesansmonocd_w5regular_">F</span> and been done with it. The same would’ve been true if the stdout of a bat file had gone to the console, but when this command is in a bat file with a redirected stdout, the interpreter essentially asks the trace file for a response and waits in perpetuity. At some point someone will investigate the long-running execution, scroll down to the bottom of the trace file, and find the text in the previous example. This is what coders call a <i class="calibre6">hang</i>; it’s worse than an abort because the execution never ends. The cause can be an endless loop, but in this case, the cause is the interpreter asking for a response from an entity that cannot respond. The only human response is to kill the command window, find and correct the issue, and rerun.</p>
<p class="tx">The only way to respond programmatically with an answer in real time is to anticipate the question and code for it before the bat file ever executes. To this end, I’ll precede the <span class="sans_thesansmonocd_w5regular_">xcopy</span> command with a response from an <span class="sans_thesansmonocd_w5regular_">echo</span> command. The following <span class="sans_thesansmonocd_w5regular_">echo F</span> command is simply writing <span class="sans_thesansmonocd_w5regular_">F</span>, the response for file, and that response is piped as input to the <span class="sans_thesansmonocd_w5regular_">xcopy</span> command:</p>
<pre class="pre"><code class="calibre11">echo F | xcopy C:\Batch\OldName.txt C:\Target\NewName.txt /Y /F</code></pre>
<p class="tx"><span aria-label=" Page 138. " epub:type="pagebreak" id="pg_138" role="doc-pagebreak"/>Now stdout shows <span class="sans_thesansmonocd_w5regular_">F</span> being entered as the answer to the question even though the response wasn’t from a human:</p>
<pre class="pre"><code class="calibre11">C:\Batch&gt;echo F   | xcopy C:\Batch\OldName.txt C:\Target\NewName.txt /Y /F 
Does C:\Target\NewName.txt specify a file name
or directory name on the target
(F = file, D = directory)? F
C:\Batch\OldName.txt -&gt; C:\Target\NewName.txt
1 File(s) copied
</code></pre>
<p class="tni">(Yes, the interpreter and stdout took some liberties with the spacing before the pipe.)</p>
<p class="tx">Finally, the interpreter copies the file to the destination folder using the new name. If <span class="sans_thesansmonocd_w5regular_">echo D</span> had preceded the pipe, the target file would’ve been <i class="calibre6">C:\Target\NewName.txt\OldName.txt</i>. That’s clearly not the intention here, but in a different situation you could define the destination as a directory with the piping technique.</p>
<p class="tx">To make this more generic, you could set a variable to either <span class="sans_thesansmonocd_w5regular_">F</span> or <span class="sans_thesansmonocd_w5regular_">D</span>, depending on the format of the target. If the target ends in a period and extension, you can assume it’s a file; if not, it’s a directory. Then you can pipe the resolved variable into the <span class="sans_thesansmonocd_w5regular_">xcopy</span> command with an <span class="sans_thesansmonocd_w5regular_">echo</span> command.</p>
<p class="tx">But what effect does this technique have when the <span class="sans_thesansmonocd_w5regular_">xcopy</span> command doesn’t ask for a response? It’s synonymous with trying to impart wisdom to someone, perhaps a teenager, who doesn’t want to listen. Just as a parent’s words are lost into the void, the information piped to the <span class="sans_thesansmonocd_w5regular_">xcopy</span> command is completely ignored if a question wasn’t asked. It’s as if the <span class="sans_thesansmonocd_w5regular_">echo</span> command never executed. So, if a response is requested, the piping will give it, and if a response isn’t requested, it’s harmless.</p>
<p class="tx">There are many applications of piping. In <span class="xref"><a href="chapter24.xhtml" class="calibre3">Chapter 24</a></span>, you’ll learn how to perform some fairly complex text searches by piping both <span class="sans_thesansmonocd_w5regular_">echo</span> and <span class="sans_thesansmonocd_w5regular_">type</span> commands into a <span class="sans_thesansmonocd_w5regular_">findstr</span> command, allowing you to find specific text in a string or to find all the records in a file with that text. You can even sort the output of any command by piping it into the yet to be discussed <span class="sans_thesansmonocd_w5regular_">sort</span> command.</p>
</section>
<section aria-labelledby="sec14" epub:type="division">
<h3 class="h" id="sec14"><span id="h1-94"/><span class="sans_futura_std_bold_b_">stdin</span></h3>
<p class="tni">Even though this is a chapter about outputs, any discussion of stdout and stderr wouldn’t be complete without a mention of the input data stream <i class="calibre6">stdin</i>, pronounced <i class="calibre6">standard in</i> (or less frequently, <i class="calibre6">standard input</i>) and referenced by <span class="sans_thesansmonocd_w5regular_">0</span>, which is input from the console. But little more than a mention is needed. In most literature on the subject, all three are mentioned together as if they were of equal importance, but while stdout and stderr are ubiquitous, stdin is used only occasionally.</p>
<p class="tx">In the following example, the first command redirects a message to the console via <span class="sans_thesansmonocd_w5regular_">echo</span>. The second command is quite new, something of a reversal on the first command:</p>
<pre class="pre"><code class="calibre11"><span aria-label=" Page 139. " epub:type="pagebreak" id="pg_139" role="doc-pagebreak"/>@&gt; con echo Enter some data to be saved in a file:
@type con &gt; C:\Batch\FromTheConsole.txt
</code></pre>
<p class="tni">The stdin data stream is the input from the keyboard or the console and is denoted in this context with the reserved word, <span class="sans_thesansmonocd_w5regular_">con</span>. Up until now, I’ve used <span class="sans_thesansmonocd_w5regular_">con</span> only as output, in particular output to the console. Ultimately, the <span class="sans_thesansmonocd_w5regular_">type</span> command redirects stdin into a text file.</p>
<p class="tx">This command temporarily halts processing. The user can type a line of text and press <small class="calibre5">ENTER</small> to write that line of text to the file. The file can accept multiple lines of text until the user terminates the command by pressing <small class="calibre5">CTRL</small>-Z, followed by <small class="calibre5">ENTER</small> when the cursor is at the beginning of a line. (I never said it was user-friendly.)</p>
<p class="tx">Many times, you may request a basic response of the user at the console— often a simple yes or no—and I’ll discuss how such interactive bat files work in <span class="xref"><a href="chapter15.xhtml" class="calibre3">Chapter 15</a></span>. In those rare instances when you request more involved input from the user, redirecting stdin saves that data to a file for later use.</p>
</section>
<section aria-labelledby="sec15" epub:type="division">
<h3 class="h" id="sec15"><span id="h1-95"/><span class="sans_futura_std_bold_b_">Summary</span></h3>
<p class="tni">In this chapter, I covered three related topics: outputs, redirection, and piping. The stdout and stderr data streams are important and useful interpreter-generated outputs, giving you detailed information about a bat file’s execution. These are distinct from coder-generated output, the output that you explicitly create. You learned how redirection creates new files and appends to existing files. I showed how to capture the interpreter-generated output in a trace file or suppress it altogether. Individual commands also have output and you learned how to redirect it to a file and pipe it to other commands.</p>
<p class="tx">Later in this book I’ll discuss many applications of these new tools. In <span class="xref"><a href="chapter22.xhtml" class="calibre3">Chapter 22</a></span>, formatting simple reports with Batch will make great use of redirection. I already mentioned the use of piping for text searches and redirection with the <span class="sans_thesansmonocd_w5regular_">dir</span> command. In the next chapter, I’ll discuss this extremely useful command and everything else you need to know about directories.</p>
</section>
</section>
</div></body></html>