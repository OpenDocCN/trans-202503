<html><head></head><body><div id="sbo-rt-content"><section>
<header>
<h1 class="chapter">
<span class="ChapterNumber"><span epub:type="pagebreak" title="223" id="Page_223"/>13</span><br/>
<span class="ChapterTitle">Making Your Work Public</span></h1>
</header><figure class="opener">
<img src="Images/chapterart.png" alt="" width="206" height="206"/>
</figure>
<h2 id="h1-501645c13-0001" class="HeadProject"><span><span epub:type="pagebreak" title="224" id="Page_224"/>Sketch 100: Processing on the Web</span></h2>
<p class="BodyFirst">Processing sketches can usually execute within a browser, requiring little to no modification to make dynamic and interactive web objects. The system that allows this is <em>Processing.js</em>; it converts the Processing sketch into JavaScript before running it and displays the result in an HTML5 <span class="KeyTerm">canvas</span>. </p>
<p>There are four steps in running a sketch from the web:</p>
<ol class="decimal">
<li value="1">Download Processing.js. This means going to a site like <a href="https://processingjs.org/download/" class="LinkURL">https://processingjs.org/download/</a> and getting the files <em>processing.js</em> and <em>processing.min.js</em>. </li>
<li value="2">Create the Processing sketch. We’ll use Sketch 91, the aurora simulation, as our example. This sketch will be named <em>sketch100.pde</em>.</li>
<li value="3">Create a web page within which you’ll embed the sketch. It must load <em>processing.min.js</em> as a script in the header of the page <span class="CodeAnnotation" aria-label="annotation2">2</span>:
<pre><code>&lt;script src="processing.min.js"&gt;&lt;/script&gt;</code></pre></li>
<li value="4">Create a canvas, specifying <em>sketch100.pde</em> as a data processing source <span class="CodeAnnotation" aria-label="annotation3">3</span>:
<pre><code>&lt;canvas data-processing-sources="sketch100.pde"&gt; &lt;/canvas&gt;</code></pre></li>
</ol>
<p>This will only work properly on a web server, so you need to upload all files to a server and display the page from the internet, or install a server on your computer.</p>
<p>All three files—the HTML source, the sketch, and <em>processing.min.js</em>—should be in the same directory on the web server. When the page is loaded, the sketch should run and display results in the canvas.</p>
<p>There may be some other issues depending on the sketch. First, if the sketch uses images, these must be preloaded so that their size and other properties are available when the sketch runs. A <code>preload</code> directive must appear in a comment at the beginning of the sketch. For example, in this case, the files <code>trees.gif</code> and <code>stars.jpg</code> are used <span class="CodeAnnotation" aria-label="annotation1">1</span>:</p>
<pre><code>/* @pjs preload="trees.gif, stars.jpg"; */</code></pre>
<p>Next, be careful if the sketch uses integers. The Processing code is translated into JavaScript, which has no integer type. Integers will become floating-point values. Any program that depends on integer arithmetic (like 5/2 = 2) will not work properly.</p>
<p>Any program that requires a Java library won’t work either. Minim is a Java library, and so are the video classes. There are JavaScript variations of these, but using them will require learning how JavaScript works and how to access JavaScript from Processing and vice versa. </p>
<p>The HTML code for the web page follows the code for the sketch on the next page.</p>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="boxcustom1">
<pre><code><span class="CodeAnnotationHang" aria-label="annotation1">1</span> /* @pjs preload="trees.gif, stars.jpg"; */ 
float a=.02, bb=10;
PImage foreground, background; 

void setup ()
{
  foreground=loadImage("trees.gif");
  background=loadImage("stars.jpg");
  size (400, 224);
  colorMode(HSB);
}

void draw ()
{
  float h, s, b=250, dt=0;
  image (background, 0, 0);
  for (int i=0; i&lt;390; i++)
  {
    if (i%3 == 0) s = 220+random(20)-10;
    else if (i%2 == 0) s = 210+random(20)-10;
    else s = 200+random(20)-10;
    h = 15;
    for (int j=130; j&gt;30; j--)
    {
      if (j&lt;=100) dt = (100-j)*3;
      else dt = 0;
      stroke (h, s, b, 200-dt);
      h = h + random(.87);
      point (i,j-bb*sin(a*i));
    }
    a = a + random(0.001)-0.0005;
    bb = bb + random(1)-0.5;
    if (bb&gt;16) bb = 15;
    if (bb&lt;-10) bb = 0;
    if (a&lt;-0.1 || a&gt;0.1) a = 0;
  }
  image (foreground, 0, 0);
}
<span epub:type="pagebreak" title="226" id="Page_226"/>&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;title&gt; Sketch 100: Processing on the Web&lt;/title&gt; 
<span class="CodeAnnotationHang" aria-label="annotation2">2</span> &lt;script src="processing.min.js"&gt;&lt;/script&gt;
&lt;/head&gt;
&lt;body bgcolor=aa99aa&gt;
&lt;br&gt;&lt;br&gt;
&lt;h1&gt; Sketch 91: Simulating the Aurora
 &lt;/h1&gt;
This is sketch 91 adapted for the web. &lt;br&gt;
Among objects that are difficult to render on a computer, the northern lights or aurora is near the top of the list. They flicker and roll, the colors change, the shape changes at various speeds, and they generally have no one specific shape. There have been efforts to draw them with more or less success; this sketch is one of those attempts.&lt;br&gt;
&lt;center&gt;
<span class="CodeAnnotationHang" aria-label="annotation3">3</span> &lt;canvas data-processing-sources="sketch100.pde"&gt;
&lt;/canvas&gt;
&lt;/center&gt;
&lt;br&gt;
There are many shapes that the aurora can take, and this sketch will only attempt to draw one of those: the typical curtain type.&lt;br&gt;
The sketch will make the color change slowly as a function of Y position. Starting with a red value at the bottom of the auroral curtain, the hue will increase in pixels above. Starting at a hue value of h=15, the hue increases according to:&lt;br&gt;
 &lt;b&gt; h = h + random(.87)  &lt;/b&gt;&lt;br&gt;
So that the hue increases at a random rate, but always increases, as the y coordinate changes. At the very top of the curtain the brightness will decrease also, fading the color away.&lt;br&gt;
Next, notice that the aurora appears to consist of vertical strokes and is banded horizontally. This is accomplished in the program by changing the saturation of the pixels periodically as a function of X coordinate. The code is:&lt;br&gt;&lt;b&gt;

if (i%3 == 0) s=220+random(20)-10; &lt;br&gt;
else if (i%2 == 0) s = 210+random(20)-10; &lt;br&gt;
else s = 200+random(20)-10; &lt;br&gt;&lt;/b&gt; 

where i is the horizontal position and s is the saturation. i%3 is the remainder when i is divided by 3, so there is a somewhat random variation in the saturation, giving darker bands.&lt;br&gt;
The curtain effect is accomplished using a sine function to locate the pixels vertically. For a basic coordinate (i,j) the actual pixel will be at (i,j-bb*sin(a*i)) where the parameters a and bb change by a small and random amount during each iteration. This makes the curtain move.&lt;br&gt;

&lt;/body&gt;
&lt;/html&gt;</code></pre>
<span epub:type="pagebreak" title="225" id="Page_225"/><figure class="graphic"><img src="Images/g100001.png" alt="g100001" width="450" height="411"/></figure>
<div class="bottom hr"><hr/></div>
</section>
</aside>
</section>
</div></body></html>