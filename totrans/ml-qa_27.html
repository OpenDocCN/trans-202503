<html><head></head><body>
<div id="book-content">
<div id="sbo-rt-content"><h2 class="h2" id="ch23"><span epub:type="pagebreak" id="page_153"/><strong><span class="big">23</span><br/>DATA DISTRIBUTION SHIFTS</strong></h2>&#13;
<div class="image1"><img src="../images/common.jpg" alt="Image" width="252" height="252"/></div>&#13;
<p class="noindent">What are the main types of data distribution shifts we may encounter after model deployment?</p>&#13;
<p class="indent"><em>Data distribution shifts</em> are one of the most common problems when putting machine learning and AI models into production. In short, they refer to the differences between the distribution of data on which a model was trained and the distribution of data it encounters in the real world. Often, these changes can lead to significant drops in model performance because the model’s predictions are no longer accurate.</p>&#13;
<p class="indent">There are several types of distribution shifts, some of which are more problematic than others. The most common are covariate shift, concept drift, label shift, and domain shift; all discussed in more detail in the following sections.</p>&#13;
<h3 class="h3" id="ch00lev115"><strong>Covariate Shift</strong></h3>&#13;
<p class="noindent">Suppose <em>p</em>(<em>x</em>) describes the distribution of the input data (for instance, the features), <em>p</em>(<em>y</em>) refers to the distribution of the target variable (or class label distribution), and <em>p</em>(<em>y</em>|<em>x</em>) is the distribution of the targets <em>y</em> given the inputs <em>x</em>.</p>&#13;
<p class="indent"><em>Covariate shift</em> happens when the distribution of the input data, <em>p</em>(<em>x</em>), changes, but the conditional distribution of the output given the input, <em>p</em>(<em>y</em>|<em>x</em>), remains the same.</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_154"/><a href="ch23.xhtml#ch23fig1">Figure 23-1</a> illustrates covariate shift where both the feature values of the training data and the new data encountered during production follow a normal distribution. However, the mean of the new data has changed from the training data.</p>&#13;
<div class="image"><img id="ch23fig1" src="../images/23fig01.jpg" alt="Image" width="633" height="269"/></div>&#13;
<p class="figcap"><em>Figure 23-1: Training data and new data distributions differ under covariate shift.</em></p>&#13;
<p class="indent">For example, suppose we trained a model to predict whether an email is spam based on specific features. Now, after we embed the email spam filter in an email client, the email messages that customers receive have drastically different features. For example, the email messages are much longer and are sent from someone in a different time zone. However, if the way those features relate to an email being spam or not doesn’t change, then we have a covariate shift.</p>&#13;
<p class="indent">Covariate shift is a very common challenge when deploying machine learning models. It means that the data the model receives in a live or production environment is different from the data on which it was trained. However, because the relationship between inputs and outputs, <em>p</em>(<em>y</em>|<em>x</em>), remains the same under covariate shift, techniques are available to adjust for it.</p>&#13;
<p class="indent">A common technique to detect covariate shift is <em>adversarial validation</em>, which is covered in more detail in <a href="ch29.xhtml">Chapter 29</a>. Once covariate shift is detected, a common method to deal with it is <em>importance weighting</em>, which assigns different weights to the training example to emphasize or de-emphasize certain instances during training. Essentially, instances that are more likely to appear in the test distribution are given more weight, while instances that are less likely to occur are given less weight. This approach allows the model to focus more on the instances representative of the test data during training, making it more robust to covariate shift.</p>&#13;
<h3 class="h3" id="ch00lev116"><strong>Label Shift</strong></h3>&#13;
<p class="noindent"><em>Label shift</em>, sometimes referred to as <em>prior probability shift</em>, occurs when the class label distribution <em>p</em>(<em>y</em>) changes, but the class-conditional distribution <em>p</em>(<em>y</em>|<em>x</em>) remains unchanged. In other words, there is a significant change in the label distribution or target variable.</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_155"/>As an example of such a scenario, suppose we trained an email spam classifier on a balanced training dataset with 50 percent spam and 50 percent non-spam email. In contrast, in the real world, only 10 percent of email messages are spam.</p>&#13;
<p class="indent">A common way to address label shifts is to update the model using the weighted loss function, especially when we have an idea of the new distribution of the labels. This is essentially a form of importance weighting. By adjusting the weights in the loss function according to the new label distribution, we are incentivizing the model to pay more attention to certain classes that have become more common (or less common) in the new data. This helps align the model’s predictions more closely with the current reality, improving its performance on the new data.</p>&#13;
<h3 class="h3" id="ch00lev117"><strong>Concept Drift</strong></h3>&#13;
<p class="noindent"><em>Concept drift</em> refers to the change in the mapping between the input features and the target variable. In other words, concept drift is typically associated with changes in the conditional distribution <em>p</em>(<em>y</em>|<em>x</em>), such as the relationship between the inputs <em>x</em> and the output <em>y</em>.</p>&#13;
<p class="indent">Using the example of the spam email classifier from the previous section, the features of the email messages might remain the same, but <em>how</em> those features relate to whether an email is spam might change. This could be due to a new spamming strategy that wasn’t present in the training data. Concept drift can be much harder to deal with than the other distribution shifts discussed so far since it requires continuous monitoring and potential model retraining.</p>&#13;
<h3 class="h3" id="ch00lev118"><strong>Domain Shift</strong></h3>&#13;
<p class="noindent">The terms <em>domain shift</em> and <em>concept drift</em> are used somewhat inconsistently across the literature and are sometimes taken to be interchangeable. In reality, the two are related but slightly different phenomena. <em>Concept drift</em> refers to a change in the function that maps from the inputs to the outputs, specifically to situations where the relationship between features and target variables changes as more data is collected over time.</p>&#13;
<p class="indent">In <em>domain shift</em>, the distribution of inputs, <em>p</em>(<em>x</em>), and the conditional distribution of outputs given inputs, <em>p</em>(<em>y</em>|<em>x</em>), both change. This is sometimes also called <em>joint distribution shift</em> due to the joint distribution <em>p</em>(<em>x</em> and <em>y</em>) = <em>p</em>(<em>y</em>|<em>x</em>) <em>· p</em>(<em>x</em>). We can thus think of domain shift as a combination of both covariate shift and concept drift.<span epub:type="pagebreak" id="page_156"/></p>&#13;
<p class="indent">In addition, since we can obtain the marginal distribution <em>p</em>(<em>y</em>) by integrating over the joint distribution <em>p</em>(<em>x</em>, <em>y</em>) over the variable <em>x</em> (mathematically expressed as <em>p</em>(<em>y</em>) = ∫ <em>p</em>(<em>x</em>, <em>y</em>) <em>dx</em>), covariate drift and concept shift also imply label shift. (However, exceptions may exist where the change in <em>p</em>(<em>x</em>) compensates for the change in <em>p</em>(<em>y</em>|<em>x</em>) such that <em>p</em>(<em>y</em>) may not change.) Conversely, label shift and concept drift usually also imply covariate shift.</p>&#13;
<p class="indent">To return once more to the example of email spam classification, domain shift would mean that the features (content and structure of email) <em>and</em> the relationship between the features and target both change over time. For instance, spam email in 2023 might have different features (new types of phishing schemes, new language, and so forth), and the definition of what constitutes spam might have changed as well. This type of shift would be the most challenging scenario for a spam filter trained on 2020 data, as it would have to adjust to changes in both the input data and the target concept.</p>&#13;
<p class="indent">Domain shift is perhaps the most difficult type of shift to handle, but monitoring model performance and data statistics over time can help detect domain shifts early. Once they are detected, mitigation strategies include collecting more labeled data from the target domain and retraining or adapting the model.</p>&#13;
<h3 class="h3" id="ch00lev119"><strong>Types of Data Distribution Shifts</strong></h3>&#13;
<p class="noindent"><a href="ch23.xhtml#ch23fig2">Figure 23-2</a> provides a visual summary of different types of data shifts in the context of a binary (2-class) classification problem, where the black circles refer to examples from one class and the diamonds refer to examples from another class.</p>&#13;
<div class="image"><img id="ch23fig2" src="../images/23fig02.jpg" alt="Image" width="553" height="434"/></div>&#13;
<p class="figcap"><em>Figure 23-2: Different types of data shifts in a binary classification context</em></p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_157"/>As noted in the previous sections, some types of distribution shift are more problematic than others. The least problematic among them is typically covariate shift. Here, the distribution of the input features, <em>p</em>(<em>x</em>), changes between the training and testing data, but the conditional distribution of the output given the inputs, <em>p</em>(<em>y</em>|<em>x</em>), remains constant. Since the underlying relationship between the inputs and outputs remains the same, the model trained on the training data can still apply, in principle, to the testing data and new data.</p>&#13;
<p class="indent">The most problematic type of distribution shift is typically joint distribution shift, where both the input distribution <em>p</em>(<em>x</em>) and the conditional output distribution <em>p</em>(<em>y</em>|<em>x</em>) change. This makes it particularly difficult for a model to adjust, as the learned relationship from the training data may no longer hold. The model has to cope with both new input patterns and new rules for making predictions based on those patterns.</p>&#13;
<p class="indent">However, the “severity” of a shift can vary widely depending on the real-world context. For example, even a covariate shift can be extremely problematic if the shift is severe or if the model cannot adapt to the new input distribution. On the other hand, a joint distribution shift might be manageable if the shift is relatively minor or if we have access to a sufficient amount of labeled data from the new distribution to retrain our model.</p>&#13;
<p class="indent">In general, it’s crucial to monitor our models’ performance and be aware of potential shifts in the data distribution so that we can take appropriate action if necessary.</p>&#13;
<h3 class="h3" id="ch00lev120"><strong>Exercises</strong></h3>&#13;
<p class="number1"><strong>23-1.</strong> What is the big issue with importance weighting as a technique to mitigate covariate shift?</p>&#13;
<p class="number1"><strong>23-2.</strong> How can we detect these types of shifts in real-world scenarios, especially when we do not have access to labels for the new data?</p>&#13;
<h3 class="h3" id="ch00lev121"><strong>References</strong></h3>&#13;
<ul>&#13;
<li class="noindent">Recommendations and pointers to advanced mitigation techniques for avoiding domain shift: Abolfazl Farahani et al., “A Brief Review of Domain Adaptation” (2020), <em><a href="https://arxiv.org/abs/2010.03978">https://arxiv.org/abs/2010.03978</a></em>.<span epub:type="pagebreak" id="page_158"/></li>&#13;
</ul>&#13;
</div>
</div>
</body></html>