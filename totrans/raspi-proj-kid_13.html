<html><head></head><body>
<h2 class="h2" id="ch13"><span epub:type="pagebreak" id="page_215"/>13<br/>MIRROR, MIRROR: THE SOCIAL MEDIA STATUS MIRROR</h2>&#13;
<p class="noindent"><span class="big1">IN THIS CHAPTER, YOU’LL CREATE A SOCIAL MEDIA STATUS MIRROR, A MODERN-DAY TWIST ON THE CLASSIC “MIRROR, MIRROR ON THE WALL” FROM THE <em>SNOW WHITE</em> FAIRYTALE. IMAGINE THAT YOU’RE GETTING READY TO GO OUT AND WANT TO KNOW WHAT YOUR FRIENDS ARE POSTING ONLINE. <span epub:type="pagebreak" id="page_216"/>OR MAYBE YOUR FAVORITE TEAM IS PLAYING, AND YOU WANT TO FOLLOW ALL THE ACTION WHILE YOU GET READY IN THE MORNING.</span></p>&#13;
<p class="noindent">The social media status mirror can help in either situation. All you have to do is enter a keyword in the Python program. Then, whenever a tweet containing the keyword appears in your social media timeline, an array of LEDs will flash several times before the mirror reads you the tweet. The LEDs inform you of incoming messages. If you set your personal Twitter handle as the keyword, the mirror will read out any tweet that mentions you and tell you the name of the user who wrote the tweet.</p>&#13;
<p class="indent">You can customize the project by choosing a colored set of LEDs or even animal-, car-, or fruit-shaped LEDs. Or, instead of attaching the LEDs to a mirror, as shown in <a href="ch13.xhtml#ch13fig01">Figure 13-1</a>, you could attach them to a picture, notice board, bookcase, or window frame. I recommend using the Raspberry Pi Zero for this project, because it’s small and discreet, making it easy to hide. It also has built-in Wi-Fi, which you’ll need to stream data from your Twitter account.</p>&#13;
<div class="image"><img alt="Image" src="../images/13fig01.jpg"/></div>&#13;
<p class="figcap" id="ch13fig01"><strong>FIGURE 13-1</strong> Create your social media status mirror.</p>&#13;
<h3 class="h3" id="ch13lev1sec1">WHAT YOU’LL NEED</h3>&#13;
<p class="noindent">Here are a few items you’ll need to complete the project:</p>&#13;
<ul>&#13;
<li class="noindent">Raspberry Pi Zero W (recommended)</li>&#13;
<li class="noindent">Set of battery-powered LEDs (3.3V maximum)</li>&#13;
<li class="noindent">Twitter account</li>&#13;
<li class="noindent">Speaker</li>&#13;
<li class="noindent">USB battery</li>&#13;
<li class="noindent">Jumper wires</li>&#13;
<li class="noindent"><span epub:type="pagebreak" id="page_217"/>NPN (Negative-Positive-Negative) transistor (a 2N 2222)</li>&#13;
<li class="noindent">1K ohm resistor</li>&#13;
<li class="noindent">Soldering iron and solder, or alligator clips, or aluminum foil</li>&#13;
<li class="noindent">Mirror (or any other object you want to attach the lights to)</li>&#13;
<li class="noindent">Small breadboard (optional)</li>&#13;
</ul>&#13;
<p class="indent">You’ll need to think about the type of speaker you’ll use. You could use a simple portable speaker with the standard audio jack and cable. But then you can’t use the Raspberry Pi Zero, although that’s not an issue unless you have a small mirror that can’t mount a larger Pi board. Another option is to use a Bluetooth-enabled speaker, similar to the setup in <a href="ch10.xhtml#ch10">Chapter 10</a>. The Pi Zero W is Bluetooth enabled, which means you can stream audio directly to a speaker.</p>&#13;
<h3 class="h3" id="ch13lev1sec2">PREPARING THE EQUIPMENT</h3>&#13;
<p class="noindent">This project has a few parts, so before you start coding it, you’ll set up your speaker, teach the Raspberry Pi to read text out loud via the speaker, wire the status LEDs, and connect your Pi to Twitter.</p>&#13;
<h4 class="h4" id="ch13lev2sec1">Connecting the Speaker</h4>&#13;
<p class="noindent">To connect a speaker to the project, you have two options. If you’re <em>not</em> using the Pi Zero, you can use the built-in audio jack. Connect your speaker via a standard 3.5 mm jack cable to the back headphone jack on the Raspberry Pi, which is located next to the HDMI port. Plug in your Raspberry Pi and boot it up; then return to the desktop. Locate the audio icon at the top of the desktop and right-click it. Select <strong>Analog</strong> from the audio output drop-down menu. Now all audio will be played through your speaker.</p>&#13;
<p class="indent">If you’re using a Bluetooth speaker, turn on the Bluetooth software on your Pi by clicking the Bluetooth icon at the top right of the screen. Then turn on your Bluetooth speaker. Click the Bluetooth icon again, and select <strong>Add a Device</strong> from the drop-down menu. The Raspberry Pi will attempt to locate all Bluetooth-enabled devices, including your speaker. Make sure you enable the Bluetooth settings on your speaker to make it discoverable.</p>&#13;
<p class="indent">When found, the speaker will appear in the pop-up window. Select it from the list and click <strong>Pair</strong> to establish a connection between your Raspberry Pi and the Bluetooth speaker.</p>&#13;
<p class="indent">Once the connection is confirmed, click the audio icon and select your Bluetooth speaker from the drop-down menu. The two devices will attempt to pair and establish a connection again. Once <span epub:type="pagebreak" id="page_218"/>the speaker has been set up, your Raspberry Pi should always automatically locate and connect to this speaker.</p>&#13;
<h4 class="h4" id="ch13lev2sec2">Teaching the Pi to Read Text Out Loud</h4>&#13;
<p class="noindent">For the Raspberry Pi to read your tweets aloud, you need to create a text-to-speech program. This program converts written text into audio and then plays it. You can use the program to read any type of text, including text messages, emails, or weather updates. So you could easily adapt this project to read other information to you as you get ready!</p>&#13;
<p class="indent">Open the terminal window and install <code>espeak</code> by entering the following command:</p>&#13;
<pre><span class="codegreen">pi@raspberrypi</span>:- <span class="codeblue">$</span> <span class="codestrong1">sudo apt install espeak python3-espeak</span></pre>&#13;
<p class="indent">Then open Python and start a new program. Enter the following code and save it as <em>espeak_test.py</em>:</p>&#13;
<pre><span class="codeorg">from</span> espeak <span class="codeorg">import</span> espeak&#13;
espeak.synth(<span class="codegreen1">"</span><span class="codegreen2">Have you met my friend Alexa?!</span><span class="codegreen1">"</span>)</pre>&#13;
<p class="indent">Be sure to replace the message between the quotation marks with your own message. Save the program and run it. You should now have a talking Raspberry Pi—well, a Raspberry Pi with a text-to-speech program. Experiment and add your own messages.</p>&#13;
<h4 class="h4" id="ch13lev2sec3">Preparing the LEDs</h4>&#13;
<p class="noindent">Now you’ll set up the LEDs and write a program to control them. Your set of battery-powered LEDs should be in a loop with the battery pack attached, as shown in <a href="ch13.xhtml#ch13fig02">Figure 13-2</a>. The LEDs will be powered by the battery pack, and you will use the Raspberry Pi as a switch that will open and close the circuit, turning the LEDs off and on. Ensure that the batteries you use provide no more than 3V, which is two AA or AAA batteries.</p>&#13;
<div class="image"><img alt="Image" src="../images/13fig02.jpg"/></div>&#13;
<p class="figcap" id="ch13fig02"><strong>FIGURE 13-2</strong> Battery-powered LEDs</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_219"/>To prepare the battery-powered LEDs, use a pair of scissors to cut through the ground wire. You can identify the ground wire by tracing the wires back to the battery pack and finding the wire connected to the negative terminal (the one where the flat side of the battery fits), as shown in <a href="ch13.xhtml#ch13fig03">Figure 13-3</a>.</p>&#13;
<div class="image"><img alt="Image" src="../images/13fig03.jpg"/></div>&#13;
<p class="figcap" id="ch13fig03"><strong>FIGURE 13-3</strong> Finding the ground wire</p>&#13;
<p class="indent">Leave a couple of inches of wire still attached to the battery pack. Strip the insulation from both of the ends so a little of the wire is exposed.</p>&#13;
<p class="indent">Using a single female-to-male jumper wire, attach or solder one of the female ends to one of the ends of the stripped wire. Attach a second female-to-male jumper wire to the end of the other stripped wire. The battery pack should look something like <a href="ch13.xhtml#ch13fig04">Figure 13-4</a>.</p>&#13;
<div class="image"><img alt="Image" src="../images/13fig04.jpg"/></div>&#13;
<p class="figcap" id="ch13fig04"><strong>FIGURE 13-4</strong> Attach one jumper wire to each of the wire ends that have been cut.</p>&#13;
<div class="note">&#13;
<p class="notet"><strong>NOTE</strong></p>&#13;
<p class="notep"><em>If you don’t have access to a soldering iron, you can attach an alligator clip to the end of the wire and then clamp the other end onto the jumper wire. Or, you can wrap the ends of the wires in aluminum foil.</em></p>&#13;
</div>&#13;
<h4 class="h4" id="ch13lev2sec4">Using the NPN Transistor</h4>&#13;
<p class="noindent">The NPN transistor acts as a switch to cut the current from the batteries to the LEDs. Without the transistor, the LEDs will still receive some current from the battery pack, which means that the LEDs will glow slightly even when they are supposed to be off. The NPN transistor has three legs: the <em>emitter</em> on the left, the <em>base</em> in the middle, and the <em>collector</em> on the right. <a href="ch13.xhtml#ch13fig05">Figure 13-5</a> shows the transistor from the front, which is its flat side.</p>&#13;
<div class="image"><img alt="Image" src="../images/13fig05.jpg"/></div>&#13;
<p class="figcap" id="ch13fig05"><span epub:type="pagebreak" id="page_220"/><strong>FIGURE 13-5</strong> NPN transistor</p>&#13;
<p class="indent">To set up the circuit, you’ll connect the ground wire from the batteries to the emitter and then connect the other part of the ground wire (which you created by cutting the ground wire in half) to the collector. You’ll use the Raspberry Pi GPIO to turn on the base, allowing you to flip the switch in the transistor and turn the LEDs on and off.</p>&#13;
<h4 class="h4" id="ch13lev2sec5">Preparing the Circuit</h4>&#13;
<p class="noindent">Attach the two ends of the jumper wires to the NPN by connecting the left wire to the left emitter leg of the NPN transistor and the right wire to the right collector leg of the NPN transistor (<a href="ch13.xhtml#ch13fig06">Figure 13-6</a>). The NPN transistor acts as a switch by controlling the current that passes through the circuit. By stopping the current flow, the NPN transistor breaks the circuit, so the current from the battery pack can’t reach the LEDs and they go out, as though you turned them off. Attach the 1K ohm resistor to the middle base leg of the transistor. You need the resistor to avoid damaging the Raspberry Pi GPIO pin when the transistor is operating.</p>&#13;
<div class="image"><img alt="Image" src="../images/13fig06.jpg"/></div>&#13;
<p class="figcap" id="ch13fig06"><strong>FIGURE 13-6</strong> Setting up the circuit</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_221"/>Use a female-to-female wire to connect the other end of the resistor to pin GPIO 3, which is the pin that provides the current to close the circuit. Then use a male-to-female wire to connect the left emitter leg of the transistor to a ground pin on the Raspberry Pi. Conveniently, there is one directly to the right of GPIO 3, physical pin 6.</p>&#13;
<h4 class="h4" id="ch13lev2sec6">Testing the LEDs</h4>&#13;
<p class="noindent">Open your Python editor and enter the test program in <a href="ch13.xhtml#ch13ex01">Listing 13-1</a>. This code is similar to the program you used in <a href="ch03.xhtml#ch03">Chapter 3</a> when creating the hot glue night-light. It tells the program which GPIO pin the wire is attached to and then turns on that pin. This creates a circuit via the GND pin, allowing the batteries to power the LEDs.</p>&#13;
<pre><span class="codeorg">from</span> gpiozero <span class="codeorg">import</span> LED&#13;
<span class="codeorg">from</span> time <span class="codeorg">import</span> sleep&#13;
led = LED(3)&#13;
<span class="codeorg">while True</span>:&#13;
    led.on()&#13;
    sleep(1)&#13;
    led.off()&#13;
    sleep(1)&#13;
</pre>&#13;
<p class="caption"><a id="ch13ex01"/><strong>LISTING 13-1</strong> Creating a circuit to light the LEDs</p>&#13;
<p class="indent">Save and run the program, and turn on the battery pack. The LEDs on the wire will flash on and then off once per second. If the lights stay on permanently, swap the two wires: attach the GPIO 3 wire to a GND pin and the GND wire to GPIO 3.</p>&#13;
<p class="indent">Once you’ve gotten the LEDs to work properly, you’re ready to begin creating your social media status mirror. But don’t attach the LEDs to your mirror, picture, or shelf yet. Instead, you’ll test the project by using your monitor to observe the tweets streaming in and the actions the program takes in response.</p>&#13;
<h3 class="h3" id="ch13lev1sec3">SETTING UP YOUR TWITTER DEVELOPER ACCOUNT</h3>&#13;
<p class="noindent">To access Twitter from your Raspberry Pi with Python, you’ll need to sign up and register for a developer account and then create an app. Then you can generate unique keys and tokens, which you’ll use in your program code to authorize communication between your Raspberry Pi and Twitter. These keys and tokens identify you as a user, enabling you to stream your timeline and post tweets by using Python code.</p>&#13;
<p class="indent">First, make sure you have a working Twitter account. You can use an existing account, but if you don’t have an account, sign up for one at <a href="https://www.twitter.com/"><em>https://www.twitter.com/</em></a>.</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_222"/>Once you’ve set up your account, head over to <a href="https://developer.twitter.com/"><em>https://developer.twitter.com/</em></a> and click <strong>Apply</strong> at the top right of the page (<a href="ch13.xhtml#ch13fig07">Figure 13-7</a>).</p>&#13;
<div class="image"><img alt="Image" src="../images/13fig07.jpg"/></div>&#13;
<p class="figcap" id="ch13fig07"><strong>FIGURE 13-7</strong> The Twitter Developer website</p>&#13;
<p class="indent">You should then be presented with a page containing a number of APIs: these are a selection of programming codes and functions that enable you to interact with Twitter.</p>&#13;
<p class="indent">Choose <strong>Standard APIs</strong> and click <strong>Apply for a developer account</strong> (<a href="ch13.xhtml#ch13fig08">Figure 13-8</a>). This account is free and perfect for the mirror hack requirements. You’ll be asked to enter your Twitter username and password to create an account. If already have a developer account and are returning to create your own version of the hack, you can click <strong>Sign in</strong> instead.</p>&#13;
<div class="image"><img alt="Image" src="../images/13fig08.jpg"/></div>&#13;
<p class="figcap" id="ch13fig08"><strong>FIGURE 13-8</strong> Select the <strong>Standard APIs</strong> option.</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_223"/>Next, you’ll begin the process of validating your developer account. The first stage requires you to enter a valid mobile phone number. This is purely a security feature so Twitter can send you confirmation texts to authorize the account. Click <strong>Add a valid phone number</strong> (<a href="ch13.xhtml#ch13fig09">Figure 13-9</a>).</p>&#13;
<div class="image"><img alt="Image" src="../images/13fig09.jpg"/></div>&#13;
<p class="figcap" id="ch13fig09"><strong>FIGURE 13-9</strong> Add a valid phone number.</p>&#13;
<p class="indent">Enter the appropriate details for your region, enter your phone number, and click <strong>Next</strong> (<a href="ch13.xhtml#ch13fig10">Figure 13-10</a>). A verification code should be sent to your phone via a text message.</p>&#13;
<div class="image"><img alt="Image" src="../images/13fig10.jpg"/></div>&#13;
<p class="figcap" id="ch13fig10"><strong>FIGURE 13-10</strong> Enter your details.</p>&#13;
<p class="indent">When you receive the text, open it. Then enter the confirmation code into the verification phone number window shown in <a href="ch13.xhtml#ch13fig11">Figure 13-11</a>, and click <strong>Verify</strong>.</p>&#13;
<div class="image"><img alt="Image" src="../images/13fig11.jpg"/></div>&#13;
<p class="figcap" id="ch13fig11"><span epub:type="pagebreak" id="page_224"/><strong>FIGURE 13-11</strong> Enter the code that you receive on your phone.</p>&#13;
<p class="indent">On completion, you should see a message stating your phone number is now verified (<a href="ch13.xhtml#ch13fig12">Figure 13-12</a>). Click <strong>Continue</strong>.</p>&#13;
<div class="image"><img alt="Image" src="../images/13fig12.jpg"/></div>&#13;
<p class="figcap" id="ch13fig12"><strong>FIGURE 13-12</strong> Twitter verifies your phone number.</p>&#13;
<p class="indent">The second stage of the verification asks you to select whom you’re requesting access for (<a href="ch13.xhtml#ch13fig13">Figure 13-13</a>): select the second option, <strong>I am requesting access for my own personal use</strong>. Then add a name for your account, which will be your developer account’s username. You can use your own name—for example, Dan’s Twitter—or use your Twitter account name. Select your primary country of operation, which must be where you’re located and where you’re running your mirror hack. Then click <strong>Continue</strong>.</p>&#13;
<div class="image"><img alt="Image" src="../images/13fig13.jpg"/></div>&#13;
<p class="figcap" id="ch13fig13"><span epub:type="pagebreak" id="page_225"/><strong>FIGURE 13-13</strong> Name your developer account.</p>&#13;
<p class="indent">In the third stage, Twitter will request information about the use of your project.</p>&#13;
<p class="indent">In the first <em>What use case(s) are you interested in?</em> question (<a href="ch13.xhtml#ch13fig14">Figure 13-14</a>), select <strong>Chatbots and automation</strong>.</p>&#13;
<div class="image"><img alt="Image" src="../images/13fig14.jpg"/></div>&#13;
<p class="figcap" id="ch13fig14"><strong>FIGURE 13-14</strong> Select the areas you’re interested in.</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_226"/>You should then be prompted to answer further questions about the purpose of what you’re building. Here are the four questions you need to answer:</p>&#13;
<ol>&#13;
<li class="noindent">What are you using the Twitter API for?</li>&#13;
<li class="noindent">Do you intend to analyze tweets?</li>&#13;
<li class="noindent">Would you like to retweet content?</li>&#13;
<li class="noindent">How will the data be displayed?</li>&#13;
</ol>&#13;
<p class="indent">The web page displays a simple guide that includes advice and some example responses, which you can use to create your own answers.</p>&#13;
<p class="indent">You need to write at least 300 characters when answering these questions. This sounds like a lot, but if you use the model responses, it’s easy to achieve the required number. A useful reminder is displayed in red under the box that disappears when you’ve written the total number of required characters.</p>&#13;
<p class="indent">Here’s the example I added:</p>&#13;
<p class="blockquotet">I’m using Twitter’s APIs to collect tweets and mentions from my timeline and then read them out.</p>&#13;
<p class="blockquotet">The build does not analyze the tweets.</p>&#13;
<p class="blockquotet">The build will not tweet, retweet, like, or interact with other users or their content. It will only stream tweets that contain my username from my timeline.</p>&#13;
<p class="blockquotetb">Tweets will be converted from text to speech and read out.</p>&#13;
<p class="indent">You can add more details and customize your answers for your version of the hack.</p>&#13;
<p class="indent">Under the question <em>Will your product, service, or analysis make Twitter content or derived information available to a government entity?</em>, select <strong>No</strong>, and then click <strong>Continue</strong>.</p>&#13;
<p class="indent">In the fourth stage, you’ll be presented with the terms and conditions (<a href="ch13.xhtml#ch13fig15">Figure 13-15</a>), which you can read if you want to. Then scroll to the bottom of the page, select the box to accept the terms, and click <strong>Submit application</strong>.</p>&#13;
<div class="image"><img alt="Image" src="../images/13fig15.jpg"/></div>&#13;
<p class="figcap" id="ch13fig15"><strong>FIGURE 13-15</strong> Confirm that you accept the terms and conditions.</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_227"/>You should receive a verification email from the Twitter Developer team. Open this email and click <strong>Confirm your email</strong>. Well done! You’ve completed the application process and should be redirected to the API developer page.</p>&#13;
<h3 class="h3" id="ch13lev1sec4">SETTING UP YOUR TWITTER APP</h3>&#13;
<p class="noindent">Once your developer account is set up and verified, you can create your app. For this, you’ll add a few details about your project and then generate a set of unique, random codes called <em>keys</em>. You’ll use the keys in the Python program to enable you to connect to your Twitter account and manage your tweets. Begin by selecting the <strong>Create an app</strong> option (<a href="ch13.xhtml#ch13fig16">Figure 13-16</a>).</p>&#13;
<div class="image"><img alt="Image" src="../images/13fig16.jpg"/></div>&#13;
<p class="figcap" id="ch13fig16"><strong>FIGURE 13-16</strong> Getting started</p>&#13;
<ol>&#13;
<li class="noindent"><span epub:type="pagebreak" id="page_228"/><strong>Create a new app:</strong> The next page of the website shows you any existing Twitter apps you’ve already created and presents you with the option of creating a new app. Click the <strong>Create an app</strong> button (<a href="ch13.xhtml#ch13fig17">Figure 13-17</a>).&#13;
<div class="image"><img alt="Image" src="../images/13fig17.jpg"/></div>&#13;
<p class="figcap" id="ch13fig17"><strong>FIGURE 13-17</strong> Creating a new app</p></li>&#13;
<li class="noindent"><strong>Register the details of your new app:</strong> Enter the app’s name (for example, <em>mirror</em> or <em>social media mirror</em>). You’ll use this name to identify your project the next time you log in. In the next box, enter a short description of the project to let others know what your app does (<a href="ch13.xhtml#ch13fig18">Figure 13-18</a>).&#13;
<div class="image"><img alt="Image" src="../images/13fig18.jpg"/></div>&#13;
<p class="figcap" id="ch13fig18"><strong>FIGURE 13-18</strong> Adding details for your app</p>&#13;
<p class="indent">You’ll also need to enter a website address. If you have your own website, enter its address here. If you don’t, you can enter <span epub:type="pagebreak" id="page_229"/>your Twitter account’s web address, which is usually <em><a href="https://www.twitter.com/your_user_name/">https://www.twitter.com/your_user_name/</a></em>.</p>&#13;
<p class="indent">Make sure the Enable sign in with Twitter option is deselected, and skip the other URL and website prompts. Also, leave the Callback URLs entry blank and agree to the Developer Agreement by selecting the box. Click the <strong>Create your Twitter application</strong> button.</p>&#13;
<p class="indent">In the last box, enter a short summary of how you’ll use the app. I added a short description of what the social media status mirror hack does. Then click <strong>Create</strong>. You should be presented with two further options; select <strong>Permissions</strong> first (<a href="ch13.xhtml#ch13fig19">Figure 13-19</a>).</p>&#13;
<div class="image"><img alt="Image" src="../images/13fig19.jpg"/></div>&#13;
<p class="figcap" id="ch13fig19"><strong>FIGURE 13-19</strong> Select the access permissions that you require.</p>&#13;
<p class="indent">You’ll need to select the type of access that your app requires. <em>Read only</em> enables you to read tweets from your timeline, and <em>Read and write</em> enables you to read and send your own tweets. Select the <strong>Read and write</strong> option, although it might already be set by default.</p></li></ol>&#13;
<h4 class="h4" id="ch13lev2sec7">Creating the Access Keys and Tokens</h4>&#13;
<p class="noindent">The final option window presents you with your API keys and access tokens (<a href="ch13.xhtml#ch13fig20">Figure 13-20</a>). These enable your Raspberry Pi to interact with Twitter through Python. Record the following keys and tokens:</p>&#13;
<p class="noindentt"><strong><span class="purple">Consumer key</span></strong> Identifies you and your app as a unique user</p>&#13;
<p class="noindent"><strong><span class="purple">Consumer secret</span></strong> Use this like a password</p>&#13;
<p class="noindent"><strong><span class="purple">Access token</span></strong> A code you’ll use in your program later</p>&#13;
<p class="noindent"><strong><span class="purple">Access token secret</span></strong> Used with your access token to authorize a connection with your Twitter app</p>&#13;
<div class="image"><img alt="Image" src="../images/13fig20.jpg"/></div>&#13;
<p class="figcap" id="ch13fig20"><strong>FIGURE 13-20</strong> Generate your keys and tokens.</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_230"/>To create the access token and access token secret, click <strong>Create</strong>.</p>&#13;
<p class="indent">It’s important that you keep these keys and tokens secure. If you forget your access token or token secret, or they become compromised, you can click <strong>Regenerate</strong> to create a new token and API key set. Remember that you’ll need to use these in your Python program code, so note them down somewhere safe.</p>&#13;
<p class="indent">You’ve now completed the setup procedures for the Twitter app. You’re ready to send your first tweet by using your Raspberry Pi. Keep in mind that you can use your credentials for other projects too.</p>&#13;
<h3 class="h3" id="ch13lev1sec5">PROGRAMMING YOUR RASPBERRY PI WITH THE APP</h3>&#13;
<p class="noindent">Before you start coding your main program, you’ll create a few test programs so you can learn how to send and read tweets by using the Raspberry Pi. This is a useful skill that you can use and adapt for other projects in the future! It’s also a simple and quick method to test that the configuration is working.</p>&#13;
<h4 class="h4" id="ch13lev2sec8">Sending Your First Tweet</h4>&#13;
<p class="noindent">To send your first tweet, you’ll need to use a new Python library called <code>tweepy</code>, which enables your program to communicate with Twitter.</p>&#13;
<ol>&#13;
<li class="noindent"><strong>Install</strong> <strong><code>tweepy</code>:</strong> Boot your Raspberry Pi and open the terminal window. Then enter the following command:&#13;
<pre><span class="codegreen">pi@raspberrypi</span>:- <span class="codeblue">$</span> <span class="codestrong1">sudo pip3 install tweepy</span></pre></li>&#13;
<li class="noindent"><span epub:type="pagebreak" id="page_231"/><strong>Send a tweet:</strong> You’ll create a Python program to post a tweet from your Raspberry Pi to your Twitter timeline. The tweet will appear on your public timeline immediately, so be aware of what you send. Open your Python editor, start a new file and save it as <em>Sending.py</em>, and enter the code in <a href="ch13.xhtml#ch13ex02">Listing 13-2</a>.&#13;
<pre><span class="ent">❶</span> <span class="codeorg">import</span> sys, subprocess, urllib, time, tweepy&#13;
<span class="ent">❷</span> consumer_key= <span class="codegreen1">"</span><span class="codegreen2">xxxxxxxxxx</span><span class="codegreen1">"</span>&#13;
<span class="ent">❸</span> consumer_secret= <span class="codegreen1">"</span><span class="codegreen2">xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx</span><span class="codegreen1">"</span>&#13;
<span class="ent">❹</span> access_token= <span class="codegreen1">"</span><span class="codegreen2">xxxxxxxxxxxxxxxxxxxxxxx</span><span class="codegreen1">"</span>&#13;
<span class="ent">❺</span> access_token_secret= <span class="codegreen1">"</span><span class="codegreen2">xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx</span><span class="codegreen1">"</span>&#13;
<span class="ent">❻</span> auth = tweepy.OAuthHandler(consumer_key, consumer_secret)&#13;
<span class="ent">❼</span> auth.set_access_token(access_token, access_token_secret)&#13;
<span class="ent">❽</span> api = tweepy.API(auth) &#13;
<span class="ent">❾</span> api.update_status(<span class="codegreen1">"</span><span class="codegreen2">Tweet sent from my Pi</span><span class="codegreen1">"</span>)&#13;
<span class="codepurple">print</span> (<span class="codegreen1">"Tweet Sent"</span>)</pre>&#13;
<p class="caption"><a id="ch13ex02"/><strong>LISTING 13-2</strong> Writing and posting a tweet by using a Raspberry Pi</p>&#13;
<p class="indent">Start the program by importing the <code>sys</code> and <code>subprocess</code> modules, which is a package for working with URLs. Also, import <code>urllib</code>, which is a module of URLs, or website addresses. This Python module lets you send data to and from your Twitter account via a specific URL for your app. Then import <code>time</code> and <code>tweepy</code> <span class="ent">❶</span>.</p>&#13;
<p class="indent">Next, enter your consumer key <span class="ent">❷</span>, consumer secret <span class="ent">❸</span>, access token <span class="ent">❹</span>, and access token secret <span class="ent">❺</span>. At <span class="ent">❻</span>, <span class="ent">❼</span>, and <span class="ent">❽</span>, authorize your Twitter account, your app, and the Raspberry Pi, respectively. This grants you access to your Twitter account.</p>&#13;
<p class="indent">Use the function <code>api.update_status()</code> <span class="ent">❾</span> to post your message; type the message between the quotation marks. Then print a confirmation that the tweet has been sent.</p></li>&#13;
<li class="noindent"><strong>Run the program:</strong> Before running the program, make sure you’ve entered your own message; then press <strong>F5</strong> to save and execute the code. The tweet will post, so check your Twitter timeline.</li>&#13;
<li class="noindent"><strong>(Optional) Change the Twitter Handle:</strong> If you want to use another user’s Twitter handle to send them a mention, just add their Twitter handle in the parentheses, before your message; for example, <code>api.update_status('@dan_aldred, Tweet sent from my Pi').</code> It’s really that easy. You can’t post the same tweet twice because Twitter will consider this spam. When you run this program again, ensure that you change the message on line <span class="ent">❾</span>.</li>&#13;
</ol>&#13;
<h4 class="h4" id="ch13lev2sec9"><span epub:type="pagebreak" id="page_232"/>Reading Tweets</h4>&#13;
<p class="noindent">To read messages and mentions from your Twitter timeline, you’ll download the latest tweets from the Twitter users you follow and print them in the Python console window. Return to your previous program, <em>Sending.py</em>, and save it with a new filename of <em>Timeline.py</em>. Update the file so it matches the code in <a href="ch13.xhtml#ch13ex03">Listing 13-3</a>.</p>&#13;
<pre>   <span class="codeorg">import</span> sys, subprocess, urllib, time, tweepy&#13;
   consumer_key= <span class="codegreen1">"</span><span class="codegreen2">xxxxxxxxxxxxxx</span><span class="codegreen1">"</span>&#13;
   consumer_secret= <span class="codegreen1">"</span><span class="codegreen2">xxxxxxxxxxxxxxxxxxxxxxx</span><span class="codegreen1">"</span>&#13;
   access_token= <span class="codegreen1">"</span><span class="codegreen2">xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx</span><span class="codegreen1">"</span>&#13;
   access_token_secret= <span class="codegreen1">"</span><span class="codegreen2">xxxxxxxxxxxxxxxxxxxx</span><span class="codegreen1">"</span>&#13;
   auth = tweepy.OAuthHandler(consumer_key, consumer_secret)&#13;
   auth.set_access_token(access_token, access_token_secret)&#13;
   api = tweepy.API(auth)&#13;
<span class="ent">❶</span> public_tweets = api.home_timeline()&#13;
<span class="ent">❷</span> <span class="codeorg">for</span> tweet <span class="codeorg">in</span> public_tweets:&#13;
       <span class="ent">❸</span> <span class="codeorg">try</span>:&#13;
          <span class="ent">❹</span> <span class="codepurple">print</span> (tweet.text)&#13;
          <span class="ent">❺</span> time.sleep(2)&#13;
          <span class="ent">❻</span> <span class="codepurple">print</span> (<span class="codegreen1">""</span>)&#13;
       <span class="ent">❼</span> <span class="codeorg">except</span>:&#13;
          <span class="ent">❽</span> <span class="codepurple">print</span> (<span class="codegreen1">"cannot display"</span>)</pre>&#13;
<p class="caption"><a id="ch13ex03"/><strong>LISTING 13-3</strong> Reading tweets from your Twitter timeline</p>&#13;
<p class="indent">The first section of the program, which is identical to the start of the previous program, <em>Sending.py</em>, controls the authentication and authorization to Twitter. You don’t need to adjust these lines unless you’ve changed your key and token details.</p>&#13;
<p class="indent">You delete all the lines of code that appear after <code>api = tweepy.API(auth)</code>. (Don’t worry about losing your <em>Sending.py</em> program, because you’ve saved it under a different name.) Add the code at <span class="ent">❶</span>, which pulls all the tweets from your public timeline and stores them in a variable named <code>public_tweets</code>. Next, use a <code>for</code> loop <span class="ent">❷</span> to cycle through each of the tweets.</p>&#13;
<p class="indent">Then use the <code>try</code> and <code>except</code> method, which tries to run the next part of the program <span class="ent">❸</span> and, if it can’t, runs the <code>except</code> code at <span class="ent">❼</span> and <span class="ent">❽</span>. The reason is that sometimes tweets contain symbols and characters that the Python code can’t interpret, like emojis. Without the code at <span class="ent">❸</span> and <span class="ent">❼</span>, your program would crash and return a message saying it can’t display the text. With the exception, you give your code something to do other than crash.</p>&#13;
<p class="indent">In the next step, print each tweet <span class="ent">❹</span>. Add a short delay <span class="ent">❺</span> to give you time to read each post. You might want to make this delay longer than 2 seconds (say, 5 seconds).</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_233"/>Skip a line before printing the next tweet <span class="ent">❻</span>. This makes reading each tweet a little easier. It also makes the presentation neater, so you don’t have an overwhelming sea of text. Then add the <code>except</code> statement at <span class="ent">❼</span> and a message to inform you that it can’t display the tweet <span class="ent">❽</span>. Save the file as <em>Timeline.py</em> and run the program as before. You now have a Python Twitter timeline reader (<a href="ch13.xhtml#ch13fig21">Figure 13-21</a>)!</p>&#13;
<div class="image"><img alt="Image" src="../images/13fig21.jpg"/></div>&#13;
<p class="figcap" id="ch13fig21"><strong>FIGURE 13-21</strong> Printing tweets from your timeline</p>&#13;
<h4 class="h4" id="ch13lev2sec10">Streaming Tweets Automatically</h4>&#13;
<p class="noindent">When running the <em>Timeline.py</em> program, you might have noticed that it downloads only the first 20 tweets from your timeline. It also prints only tweets that were posted before you started running the program: it won’t automatically download any new tweets received while running the program. This isn’t very useful if you want to retrieve your tweets in real time or check for a keyword.</p>&#13;
<p class="indent">One solution is to use a <code>while</code> loop that requests the tweets from your timeline every 20 seconds or so. But the problem with this is that Twitter limits your number of downloads, because it wants to block spam bots. Each time you request and download the data, Twitter logs that information. If you request data too many times per hour, your program might time out, and you’ll have wait a while before you can request your timeline data again.</p>&#13;
<p class="indent">A better solution is to create a class to stream the tweets. This significantly reduces the number of requests, so Twitter won’t time out your program. This method also allows you to stream the tweets as they’re posted to your timeline. Each time a new tweet arrives <span epub:type="pagebreak" id="page_234"/>while the program is running, Python prints it to the shell window. Let’s create a class now:</p>&#13;
<ol>&#13;
<li class="noindent"><strong>Stream tweets with a class:</strong> Open <em>Timeline.py</em> and save it as <em>Stream_Tweets.py</em>. Edit the file so it matches the code in <a href="ch13.xhtml#ch13ex04">Listing 13-4</a>.&#13;
<pre>   <span class="codeorg">import</span> sys, subprocess, urllib, time, tweepy&#13;
   consumer_key= <span class="codegreen1">"</span><span class="codegreen2">xxxxxxxxxxxxxx</span><span class="codegreen1">"</span>&#13;
   consumer_secret= <span class="codegreen1">"</span><span class="codegreen2">xxxxxxxxxxxxxxxxxxxxxxx</span><span class="codegreen1">"</span>&#13;
   access_token= <span class="codegreen1">"</span><span class="codegreen2">xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx</span><span class="codegreen1">"</span>&#13;
   access_token_secret= <span class="codegreen1">"</span><span class="codegreen2">xxxxxxxxxxxxxxxxxxxx</span><span class="codegreen1">"</span>&#13;
   auth = tweepy.OAuthHandler(consumer_key, consumer_secret)&#13;
   auth.set_access_token(access_token, access_token_secret)&#13;
   api = tweepy.API(auth) &#13;
<span class="ent">❶</span> <span class="codeorg">class</span> <span class="codeblue1">Social_Media_Mirror_StreamListener</span>(tweepy.StreamListener):&#13;
    <span class="ent">❷</span> <span class="codeorg">def</span> <span class="codeblue1">on_status</span>(self, status):&#13;
        <span class="ent">❸</span> tweet_to_check = status.text&#13;
        <span class="ent">❹</span> does_the_tweet_contain_key_word = tweet_to_check.find(<span class="codegreen1">"</span><span class="codegreen2">@Dan_Aldred</span><span class="codegreen1">"</span>)&#13;
        <span class="ent">❺</span> <span class="codepurple">print</span> (does_the_tweet_contain_key_word)&#13;
</pre>&#13;
<p class="caption"><a id="ch13ex04"/><strong>LISTING 13-4</strong> Using a class to stream tweets</p>&#13;
<p class="indent">As with the previous programs, begin by importing the required modules, as well as your keys and tokens, to authenticate and authorize your Twitter account and app.</p>&#13;
<p class="indent">Then create a new class called <code>Social_Media_Mirror_StreamListener</code>, which uses the streaming features of the Python <code>tweepy</code> library <span class="ent">❶</span>. Create a function that streams the tweets and checks for your trigger word <span class="ent">❷</span>. The code <code>status.text</code> retrieves all the tweets on your timeline. Store these in the variable <code>tweet_to_check</code> <span class="ent">❸</span>.</p>&#13;
<p class="indent">Next, check for your trigger word by using <code>.find()</code>. Combine this with the <code>tweet_to_check</code> variable to search for your trigger word in each streamed tweet. Replace the trigger word <em><code>@Dan_Aldred</code></em> in my example with your own Twitter handle, a keyword, or a hashtag that will be the indicator to turn on the LEDs. The program then checks for your keyword and, if it finds it, returns the numerical position of your keyword in the tweet. If the keyword isn’t present in the tweet, the program returns a value of -1 and stores it in the <code>does_the_tweet_contain_key_word</code> variable <span class="ent">❹</span>. You print the positional value of the keyword at <span class="ent">❺</span>. If the keyword is contained within the tweet, a value of 0 or greater is returned to the variable on line <span class="ent">❹</span>.</p></li>&#13;
<li class="noindent"><span epub:type="pagebreak" id="page_235"/><strong>Search for the keyword:</strong> The following section of the program checks the tweets for the keyword. Add the code in <a href="ch13.xhtml#ch13ex05">Listing 13-5</a> to your program.&#13;
<pre>        <span class="ent">❶</span> <span class="codeorg">if</span> does_the_tweet_contain_key_word &gt;= 0:&#13;
            <span class="ent">❷</span> who = status.user.screen_name <span class="codered"># gets the user name</span>&#13;
            <span class="ent">❸</span> <span class="codepurple">print</span> (who) <span class="codered"># prints the user's name</span>&#13;
            <span class="ent">❹</span> <span class="codepurple">print</span> (<span class="codegreen1">"LIGHTS ON"</span>) &#13;
        <span class="ent">❺</span> <span class="codeorg">else</span>:&#13;
            <span class="ent">❻</span> <span class="codepurple">print</span> (<span class="codegreen1">"LIGHTS OFF"</span>)&#13;
            <span class="ent">❼</span> time.sleep(1)&#13;
</pre>&#13;
<p class="caption"><a id="ch13ex05"/><strong>LISTING 13-5</strong> Checking the stream of tweets for your keyword</p>&#13;
<p class="indent">First, check the incoming tweet for your trigger word by seeing whether the trigger word’s placement value is equal to or greater than 0 <span class="ent">❶</span>. If it is greater than or equal to 0, the trigger word is somewhere in the tweet. For example, if the value is 0, the word is at the very start of the tweet. If the value is 7, the keyword is found at position 7 in the tweet.</p>&#13;
<p class="indent">Next, grab the Twitter handle of the user who included your trigger word <span class="ent">❷</span> and print it <span class="ent">❸</span>.</p>&#13;
<p class="indent">In the final program, you’ll also use the keywords as triggers to turn on the LED lights. That would normally happen at this point in the program, but because you haven’t added the code for the LEDs yet, you’ll just add a test statement indicating this <span class="ent">❹</span>.</p>&#13;
<p class="indent">Then you add a response for cases when the trigger word isn’t found in the tweet. The response occurs if the value is -1. If that happens, you add a notification that the lights are off <span class="ent">❺</span> <span class="ent">❻</span> before a short pause of 1 second <span class="ent">❼</span>. This completes the main function of the streaming program.</p></li>&#13;
<li class="noindent"><strong>Start the streaming:</strong> The final step is to start the streaming. Add the code in <a href="ch13.xhtml#ch13ex06">Listing 13-6</a>.&#13;
<pre><span class="ent">❶</span> myStreamListener = Social_Media_Mirror_StreamListener()&#13;
<span class="ent">❷</span> myStream = tweepy.Stream(auth = api.auth, listener=myStreamListener)&#13;
<span class="ent">❸</span> myStream.filter(follow=[<span class="codegreen1">"</span><span class="codegreen2">xxxxxxxxx</span><span class="codegreen1">"</span>])&#13;
</pre>&#13;
<p class="caption"><a id="ch13ex06"/><strong>LISTING 13-6</strong> Starting the streaming</p>&#13;
<p class="indent">Create a variable called <code>myStreamListener</code> to combine and hold the details of your authorization to the Twitter app and the <code>Social_Media_Mirror_StreamListener()</code> function you coded in the previous steps <span class="ent">❶</span>. Then combine these functions to authenticate your credentials and deploy the stream <span class="ent">❷</span>.</p>&#13;
<p class="indent">To stream the timeline for the correct Twitter account, you need to add the ID number of the Twitter account <span class="ent">❸</span>. You find <span epub:type="pagebreak" id="page_236"/>this number by opening <em><a href="https://tweeterid.com/">https://tweeterid.com/</a></em> and entering the account name you want to track (<a href="ch13.xhtml#ch13fig22">Figure 13-22</a>). Place the ID number it returns in line <span class="ent">❸</span>. You can add your own account to ensure that you pick up mentions and messages that are sent to you; you can also search for your favorite celebrity accounts, friends and family, or the hashtag for a trending event.</p></li>&#13;
</ol>&#13;
<div class="image"><img alt="Image" src="../images/13fig22.jpg"/></div>&#13;
<p class="figcap" id="ch13fig22"><strong>FIGURE 13-22</strong> Finding out the ID number of Twitter accounts</p>&#13;
<p class="indent">Save and run your <em>Stream_Tweets.py</em> program. You can test it by mentioning your keyword in a tweet (or getting a friend to do it). Experiment with different placements of the keyword to see how the program responds. Then move on to the final section of code, where we’ll combine this program with the LEDs and audio to complete the social media status mirror.</p>&#13;
<h3 class="h3" id="ch13lev1sec6">THE FINAL PROGRAM</h3>&#13;
<p class="noindent">To complete the project, you’ll combine the code for streaming the tweets that contain your keyword with the code to flash the LEDs and read the tweets out loud.</p>&#13;
<h4 class="h4" id="ch13lev2sec11">Starting the Final Program</h4>&#13;
<p class="noindent">Start a new program file and save it as <em>Social_Media_Mirror.py</em>. This code combines the code you used in <a href="ch13.xhtml#ch13ex04">Listings 13-4</a> and <a href="ch13.xhtml#ch13ex05">13-5</a> to complete the program.</p>&#13;
<pre>   <span epub:type="pagebreak" id="page_237"/><span class="codeorg">import</span> sys, subprocess, urllib, time, tweepy&#13;
<span class="ent">❶</span> <span class="codeorg">from</span> espeak <span class="codeorg">import</span> espeak&#13;
<span class="ent">❷</span> <span class="codeorg">from</span> gpiozero <span class="codeorg">import</span> LED &#13;
   consumer_key= <span class="codegreen1">"</span><span class="codegreen2">xxxxxxxxxxxxx</span><span class="codegreen1">"</span>&#13;
   consumer_secret= <span class="codegreen1">"</span><span class="codegreen2">xxxxxxxxxxxxxxxx</span><span class="codegreen1">"</span>&#13;
   access_token= <span class="codegreen1">"</span><span class="codegreen2">xxxxxxxxxxxxxxxxxxxxxxx</span><span class="codegreen1">"</span>&#13;
   access_token_secret= <span class="codegreen1">"</span><span class="codegreen2">xxxxxxxxxxxxxxxxxx</span><span class="codegreen1">"</span>&#13;
   auth = tweepy.OAuthHandler(consumer_key, consumer_secret)&#13;
   auth.set_access_token(access_token, access_token_secret)&#13;
   api = tweepy.API(auth)&#13;
<span class="ent">❸</span> led = LED(3)&#13;
<span class="ent">❹</span> led.off()&#13;
</pre>&#13;
<p class="caption"><a id="ch13ex07"/><strong>LISTING 13-7</strong> Starting the final program</p>&#13;
<p class="indent">Import the <code>espeak()</code> function <span class="ent">❶</span>, which you use to read the tweets aloud. Then import the <code>LED</code> class from the <code>gpiozero</code> library <span class="ent">❷</span>. You use this to turn the GPIO pin on or off, controlling the battery power to the LEDs. Assign pin GPIO 3 to the LED <span class="ent">❸</span>. Use this pin to turn the lights on and off. Next, turn off the LED <span class="ent">❹</span> so the light won’t turn on every time the program resets.</p>&#13;
<h4 class="h4" id="ch13lev2sec12">Adding the Main Program Code</h4>&#13;
<p class="noindent">Now you’ll add the main program code <em>Social_Media_Mirror.py</em>.</p>&#13;
<pre><span class="codeorg">class</span> <span class="codeblue1">Social_Media_Mirror_StreamListener</span>(tweepy.StreamListener):&#13;
    <span class="codeorg">def</span> on_status(self, status): &#13;
     <span class="ent">❶</span> led.off() &#13;
     <span class="ent">❷</span> <span class="codeorg">try</span>:&#13;
           <span class="codepurple">print</span>(status.text)&#13;
        <span class="codeorg">except</span>:&#13;
            pass&#13;
            <span class="codepurple">print</span> (<span class="codegreen1">"Cannot display Tweet"</span>)&#13;
            led.off()   &#13;
        tweet_to_check = status.text <span class="codered"># checks the tweet</span> &#13;
        does_the_tweet_contain_key_word = tweet_to_check.find(<span class="codegreen1">"</span><span class="codegreen2">@Dan_Aldred</span><span class="codegreen1">"</span>)&#13;
        <span class="codered"># replace with your Twitter user name or a keyword</span>&#13;
        <span class="codepurple">print</span> (does_the_tweet_contain_key_word) &#13;
        <span class="codeorg">if</span> does_the_tweet_contain_key_word &gt;= 0: &#13;
            who = status.user.screen_name <span class="codered"># gets the user name</span>&#13;
            <span class="codepurple">print</span> (who) <span class="codered"># prints the user's name</span> &#13;
         <span class="ent">❸</span> <span class="codered"># flash the lights</span> &#13;
            led.on()&#13;
            time.sleep(0.6)&#13;
            led.off()&#13;
            time.sleep(0.5)&#13;
            led.on()&#13;
            time.sleep(0.4)&#13;
            led.off()&#13;
            time.sleep(0.3)&#13;
            led.on()&#13;
            time.sleep(0.2)&#13;
            <span epub:type="pagebreak" id="page_238"/>led.off()&#13;
            time.sleep(0.1)&#13;
            led.on()&#13;
            time.sleep(0.05)&#13;
&#13;
            led.on()&#13;
            <span class="codepurple">print</span> (<span class="codegreen1">"LIGHTS ON"</span>)&#13;
         <span class="ent">❹</span> espeak.synth(who)&#13;
         <span class="ent">❺</span> espeak.synth(<span class="codegreen1">"said"</span>)&#13;
         <span class="ent">❻</span> time.sleep(1)&#13;
         <span class="ent">❼</span> espeak.synth(status.text) <span class="codered"># reads out the tweet</span>&#13;
         <span class="ent">❽</span> time.sleep(4)&#13;
         <span class="ent">❾</span> led.off() &#13;
     <span class="ent">❿</span> <span class="codeorg">else</span>:&#13;
            <span class="codepurple">print</span> (<span class="codegreen1">"LIGHTS OFF"</span>)&#13;
            led.off()&#13;
            time.sleep(1)&#13;
</pre>&#13;
<p class="caption"><a id="ch13ex08"/><strong>LISTING 13-8</strong> Adding code to make the LEDs flash</p>&#13;
<p class="indent">Use the code at <span class="ent">❶</span> again to turn off the LED, and then add the <code>try</code> and <code>except</code> method <span class="ent">❷</span> (as you did in <a href="ch13.xhtml#ch13ex03">Listing 13-3</a>) to prevent your program from crashing if the tweet contains unknown characters, symbols, or usually emojis that cannot be displayed as text. Next, flash the lights by turning on the LEDs, waiting a few seconds, and then turning them off. The code at <span class="ent">❸</span> is merely an example and makes the lights flash faster until they stay on. You can adapt this code to suit your own preferences: make them stay lit for 5 seconds or flash them only a single time. In the program in <a href="ch13.xhtml#ch13ex08">Listing 13-8</a>, the LEDs stay on while the message is read aloud. Change values in <code>time.sleep()</code> <span class="ent">❸</span> to change the pattern of the LEDs. For example, <code>time.sleep(10)</code> will keep the LEDs on for 10 seconds and then turn them off.</p>&#13;
<p class="indent">Use the <code>espeak.synth()</code> function to read the name of the Twitter user who sent you a tweet containing your Twitter name <span class="ent">❹</span>. Combine this code with the word <code>said</code> <span class="ent">❺</span> so when the program reads a tweet (by me, for example), it starts by announcing, “@Dan_Aldred said.” Add a small delay at <span class="ent">❻</span>. Then make the program read the tweet <span class="ent">❼</span> before adding a final delay <span class="ent">❽</span> and turning off the LEDs <span class="ent">❾</span>. Turning off the lights indicates that the message has been received and relayed.</p>&#13;
<p class="indent">If you receive a tweet that doesn’t contain your keyword, flash the LEDs once to indicate that there’s been a new post to your timeline but not a specific message of interest <span class="ent">❿</span>. Then add the final line of code that authorizes your Twitter credentials and streams, in real time, the tweets from your Twitter timeline. Your program checks them for the keyword and responds in the set manner.</p>&#13;
<p class="indent">Add the end lines of the program in <a href="ch13.xhtml#ch13ex09">Listing 13-9</a> to begin the streaming and complete the main program code.</p>&#13;
<pre><span epub:type="pagebreak" id="page_239"/>myStreamListener = Social_Media_Mirror_StreamListener()&#13;
myStream = tweepy.Stream(auth = api.auth, listener=myStreamListener)&#13;
myStream.filter(follow=[<span class="codegreen1">"</span><span class="codegreen2">xxxxxxxxx</span><span class="codegreen1">"</span>])&#13;
</pre>&#13;
<p class="caption"><a id="ch13ex09"/><strong>LISTING 13-9</strong> Ending the program</p>&#13;
<p class="indent">Save the <em>Social_Media_Mirror.py</em> code and run it. To test it, load your Twitter feed on another device and mention your Twitter username or keyword in a tweet. Watch the LEDs light up when you get a new message, and then listen as the message is read to you. Contact your friends and get them to try it too.</p>&#13;
<p class="indent">Remember that you can also replace your Twitter ID with the ID of your favorite Twitter account or users. Use the website <em><a href="https://tweeterid.com/">https://tweeterid.com/</a></em> to look up the ID number. You can also replace the ID code with keywords like <em>No Starch</em>. When you’re testing your program, remember that if you send a duplicate of the same message, Twitter will consider this spam, so ensure that you change your test word.</p>&#13;
<h4 class="h4" id="ch13lev2sec13">Automatically Starting the Twitter Stream</h4>&#13;
<p class="noindent">Once you’re happy with the project, you can set the program to automatically run when you power up the Raspberry Pi. You do this by configuring a <em>crontab</em> file, as you did for other projects in the book.</p>&#13;
<p class="indent">Open the terminal and enter the following command to open the cron console:</p>&#13;
<pre><span class="codegreen">pi@raspberrypi</span>:- <span class="codeblue">$</span> <span class="codestrong1">sudo crontab -e</span></pre>&#13;
<p class="indent">The console will present you with three methods of editing the <em>crontab</em> file. Select option 2 and press <span class="small">ENTER</span> to open the <em>crontab</em> file with the nano text editor.</p>&#13;
<p class="indent">Scroll to the bottom of the text in the crontab file and locate the blank space. Then add the following line of code:</p>&#13;
<pre><span class="codestrong1">@reboot sudo python3   /home/pi/</span><span class="codestrongi">name_of_your_program.py</span> <span class="codestrong1">&amp;</span></pre>&#13;
<p class="indent">The command states that every time the Raspberry Pi reboots, it should run Python in superuser mode, open the <em>home/pi/</em> folder, and execute your program. Replace the <em>name_of_your_program.py</em> with the name that you saved your program as.</p>&#13;
<p class="indent">The <code>&amp;</code> at the end of the line of code tells your program to run in the background, so you can do other tasks with your Raspberry Pi at the same time.</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_240"/>Once you have checked the command details and are confident that they’re correct, press <span class="small">CTRL</span>-X to save and exit the <em>crontab</em> file. Now each time you turn on or reboot your Raspberry Pi, the <em>crontab</em> file will run, starting the <em>Social_Media_Mirror.py</em> program, and your social media status mirror will be ready.</p>&#13;
<p class="indent">If you want to stop the program from automatically running, open the <em>crontab</em> file again from the terminal by entering this command:</p>&#13;
<pre><span class="codegreen">pi@raspberrypi</span>:- <span class="codeblue">$</span> <span class="codestrong1">crontab -e</span></pre>&#13;
<p class="indent">Then delete the line of code that you added. Save the file and reboot.</p>&#13;
<h3 class="h3" id="ch13lev1sec7">PUTTING IT ALL TOGETHER</h3>&#13;
<p class="noindent">Now that all the hardware is working, you can add the LEDs to the mirror—or to any other object you’ve chosen. (You could also make a social media shelf.) Make sure your speaker and LEDs are attached, and then attach the battery pack to the back of the mirror (<a href="ch13.xhtml#ch13fig23">Figure 13-23</a>). You could glue it to the back of the frame or use double-sided tape. Remember to leave the battery door facing outward so you can change the batteries if required. Then hang your mirror and wait for your messages to come through.</p>&#13;
<div class="image"><img alt="Image" src="../images/13fig23.jpg"/></div>&#13;
<p class="figcap" id="ch13fig23"><strong>FIGURE 13-23</strong> Attach the Pi and battery pack to the back of your mirror.</p>&#13;
<h3 class="h3" id="ch13lev1sec8"><span epub:type="pagebreak" id="page_241"/>WRAPPING UP</h3>&#13;
<p class="noindent">To develop your project further, try one or more of the following:</p>&#13;
<ul>&#13;
<li class="noindent">Change the LED flashing pattern by altering the time.</li>&#13;
<li class="noindent">Add a music or fanfare MP3 file that plays before each tweet is read out loud.</li>&#13;
<li class="noindent">Combine the project with the glue light in <a href="ch03.xhtml#ch03">Chapter 3</a> or wire another set of LEDs that respond to a particular second trigger word.<span epub:type="pagebreak" id="page_242"/></li>&#13;
</ul>&#13;
</body></html>