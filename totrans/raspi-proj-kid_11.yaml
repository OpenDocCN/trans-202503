- en: '11'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'NATURE BOX: MOTION-SENSING CAMERA'
  prefs: []
  type: TYPE_NORMAL
- en: IN THIS CHAPTER, YOU’LL BUILD AND CODE A NATURE BOX CAMERA THAT CAN SNAP A PHOTO
    WHEN IT SENSES MOVEMENT. YOU’LL THEN PLACE THE NATURE BOX IN THE WILD TO PHOTOGRAPH
    LOCAL WILDLIFE. YOU NEVER KNOW—YOU MAY SNAP A BIRD, A BADGER, OR EVEN A FOX!
  prefs: []
  type: TYPE_NORMAL
- en: The box will contain a motion sensor. Whenever animals come close to it, the
    sensor triggers the built-in Pi Camera to take a photo. The Raspberry Pi then
    uploads each image to an online Dropbox folder for you to view and share with
    your friends. You can leave the camera running from morning to evening and see
    what kind of visitors you get ([Figure 11-1](ch11.xhtml#ch11fig01)).
  prefs: []
  type: TYPE_NORMAL
- en: '![Image](../images/11fig01.jpg)'
  prefs: []
  type: TYPE_IMG
- en: '**FIGURE 11-1** Build a nature box that takes animal photos like this one.'
  prefs: []
  type: TYPE_NORMAL
- en: WHAT YOU’LL NEED
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'Here are a few items you’ll need to complete the project:'
  prefs: []
  type: TYPE_NORMAL
- en: Raspberry Pi (You can build the nature box with any of the Pi models. The Pi
    2, 3 A+, and Zero W work well because they are small and can be hidden in a smaller
    space.)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Pi Camera
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Passive infrared sensor (PIR)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Jumper wires
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Clear plastic box to hold the hardware
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Dropbox account
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: USB portable battery
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Drill
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: SETTING UP THE PASSIVE INFRARED SENSOR
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: A PIR ([Figure 11-2](ch11.xhtml#ch11fig02)) is more commonly referred to as
    a *movement detector*. It detects infrared light emitted from warm objects and
    bodies, such as humans, animals, and even vehicles; it measures changes in that
    light. You can write code to respond to the detection of certain levels of change
    and trigger events in response, such as turning on lights, sounding alarms, or
    opening doors automatically.
  prefs: []
  type: TYPE_NORMAL
- en: As an object passes by the PIR, it emits heat that changes the surrounding temperature.
    This difference in the surrounding infrared radiation is picked up by the PIR
    and changes the internal voltage, which means it has detected something. Inside
    the sensor’s dome are small mirrors that help the PIR to detect changes in infrared
    light from as far away as 30 feet.
  prefs: []
  type: TYPE_NORMAL
- en: '![Image](../images/11fig02.jpg)'
  prefs: []
  type: TYPE_IMG
- en: '**FIGURE 11-2** A PIR'
  prefs: []
  type: TYPE_NORMAL
- en: Wiring the PIR
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: You need just three wires to connect the PIR to the Raspberry Pi. Connect the
    VCC PIR pin, which provides power, to the 5V GPIO pin located at the top of the
    Pi’s board. The diagram in [Figure 11-3](ch11.xhtml#ch11fig03) uses the 5V pin,
    which is physical pin 2\. Connect the OUT pin to GPIO pin 4, which is physical
    pin 7, on the Pi. Then connect the ground (GND) pin on the PIR to a ground pin
    on the Pi.
  prefs: []
  type: TYPE_NORMAL
- en: '![Image](../images/11fig03.jpg)'
  prefs: []
  type: TYPE_IMG
- en: '**FIGURE 11-3** Wiring the PIR'
  prefs: []
  type: TYPE_NORMAL
- en: Testing the PIR
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: Let’s write a simple program to test that your PIR works correctly. Your body
    gives off heat, and when you move about, you disturb and move the heat surrounding
    your body. The code in [Listing 11-1](ch11.xhtml#ch11ex01) initializes the PIR
    and then checks for a change in heat. If the PIR detects a significant change,
    according to a threshold you’ll set, the program indicates that it has *seen you*.
    Open your Python editor and enter the code in [Listing 11-1](ch11.xhtml#ch11ex01).
    Save it as *PIR_test.py*.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: '**LISTING 11-1** Detecting movement with the PIR'
  prefs: []
  type: TYPE_NORMAL
- en: Import the `time` module and the `RPi.GPIO` module to control and code the GPIO
    pins ❶. Because there are two GPIO pin numbering systems, define which one you’re
    using by setting the mode to `BCM`.
  prefs: []
  type: TYPE_NORMAL
- en: Next, declare a variable to define the GPIO pin number you’re using to check
    for a response. This is the GPIO 4 pin that you connected to the PIR ❷. Tell the
    program to check for input on GPIO pin 4 by using `GPIO.IN`.
  prefs: []
  type: TYPE_NORMAL
- en: Because this is a test program, print a line indicating that the sensor is ready
    to find you and then provide a short time delay before retrieving the data from
    the PIR. This gives you a moment to prepare before you move about or wave your
    hands, triggering the sensor.
  prefs: []
  type: TYPE_NORMAL
- en: Then define a function that responds to any sensed movement or motion ❸. In
    this test program, the response is a simple statement indicating that you’ve been
    seen.
  prefs: []
  type: TYPE_NORMAL
- en: Next, the program tries to detect motion ❹. You use the `try` and `except` method
    to avoid causing an error if the PIR doesn’t work correctly or takes an odd data
    reading. This ensures that the program will continue to run if the PIR malfunctions.
  prefs: []
  type: TYPE_NORMAL
- en: Then you take the reading from the PIR ❺. This code checks GPIO pin 4 to see
    whether the voltage is rising. If it is, something has triggered the PIR. So you
    use the `callback` method to run the function that responds to any sensed movement
    or motion ❸ and print `We see you`.
  prefs: []
  type: TYPE_NORMAL
- en: To keep the PIR from reading the same input multiple times, you add a 1-second
    delay ❻. This allows enough time for the PIR to reset before it checks for a change
    in temperature again. Remember that you’re looking for motion, not presence; therefore,
    the camera doesn’t have to be constantly active.
  prefs: []
  type: TYPE_NORMAL
- en: Finally, you need a way to stop the program. You add the `except` response,
    which checks whether any key on the keyboard has been pressed ❼. If it detects
    a keypress, it prints `Quit`, resets the GPIO pins, and stops the program.
  prefs: []
  type: TYPE_NORMAL
- en: Save the program and press **F5** to run it. Alternate between moving and staying
    still to make sure the PIR detects you. If you want, you can turn this into a
    game. Can you stand so still that you don’t trigger the PIR? Can you walk into
    a room without having the PIR spot you?
  prefs: []
  type: TYPE_NORMAL
- en: SETTING UP THE PI CAMERA
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: With a working PIR that can detect motion, you can set up the Pi Camera to capture
    images of whatever triggers the sensor.
  prefs: []
  type: TYPE_NORMAL
- en: Attaching the Pi Camera
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: If you completed the Pi Camera projects in [Chapter 4](ch04.xhtml#ch04), you
    might already have the hardware set up. Use the ribbon cable to connect the camera
    to the Pi, as shown in [Figure 11-4](ch11.xhtml#ch11fig04), and remember to ensure
    that the Pi Camera is enabled in the Configuration tool. This requires you to
    restart the Raspberry Pi. If you get stuck or need more detailed instructions,
    refer to “Interfaces” on [page 16](ch01.xhtml#page_16).
  prefs: []
  type: TYPE_NORMAL
- en: '![Image](../images/11fig04.jpg)'
  prefs: []
  type: TYPE_IMG
- en: '**FIGURE 11-4** Setting up the Pi Camera'
  prefs: []
  type: TYPE_NORMAL
- en: Creating a New Folder to Store the Images
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: 'To keep the nature box project organized, you’ll want to store the images and
    program files in one place. Create a new folder named *Nature_Box* by opening
    the terminal and entering the following command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: Making a project folder will prevent your home folder from becoming cluttered
    with hundreds of images.
  prefs: []
  type: TYPE_NORMAL
- en: WRITING THE TEST CODE
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: With the Pi Camera attached, you can now start a new Python file or adapt the
    code in [Listing 11-1](ch11.xhtml#ch11ex01) to make the camera take a picture
    each time the PIR senses movement. You can photograph birds, cats, or other native
    wildlife—maybe even a fox—as they move past your nature box setup. Enter the code
    in [Listing 11-2](ch11.xhtml#ch11ex02) and save it as *Cam_PIR.py*.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: '**LISTING 11-2** Taking a picture whenever the PIR detects motion'
  prefs: []
  type: TYPE_NORMAL
- en: Edit the program code by importing the `sleep()` function from the `time` module
    and import the `picamera` class too ❶.
  prefs: []
  type: TYPE_NORMAL
- en: Then, to stop each new image from overwriting the previous one, create a variable
    to hold the current `Image_Number` ❷. Make this a global variable so you can use
    this data later in the main program function to save each file with a different
    name. Set the `Image_Number` variable to `0`, which means the first image taken
    will be named *Nature0.jpg*.
  prefs: []
  type: TYPE_NORMAL
- en: 'Then add the `PiCamera()` function to the `camera` variable. Replace `time.sleep(2)`
    with the simpler code `sleep(2)` ❸. This is a better way of writing the code,
    as you have less text to type and therefore reduce the chance of an error. You
    can use this simpler code in your other programs and projects. It serves the same
    purpose: it pauses the program for 2 seconds, creating a small delay before the
    next line of code runs.'
  prefs: []
  type: TYPE_NORMAL
- en: Next, within the `Motion_Sensing(PIR)` function, add the code to trigger the
    Pi Camera and take a picture. At ❹, you add the global variable you created at
    ❷. Then you set the camera resolution ❺ and add the code to capture the image
    ❻.
  prefs: []
  type: TYPE_NORMAL
- en: Note that the code that captures the image ❻ combines the string `"Nature"`
    and the `Image_Number` value ❷, which is currently set to `0`. This creates a
    file named *Nature0*, to which you add the *.jpg* file extension to save the image
    as *Nature0.jpg*.
  prefs: []
  type: TYPE_NORMAL
- en: Then add a value of `1` to the current image value ❼, so the program will save
    the next file as *Nature1.jpg*, the following as *Nature2.jpg*, and so on until
    the program stops. You also change the final line from `time.sleep(1)` to `sleep(1)`
    ❽.
  prefs: []
  type: TYPE_NORMAL
- en: Save the program in the *Nature_Box* folder so all the images will be stored
    there, making it easy to access them later. Press **F5** to run the program. Each
    time something triggers the PIR, the Pi Camera will take a picture and save it
    in the folder. You could set up your nature box near your most prized possessions
    or chocolate stash. If anyone steals from you, you’ll have photographic evidence
    of the culprit.
  prefs: []
  type: TYPE_NORMAL
- en: If the PIR triggers too easily, you can adjust its sensitivity. On warm days,
    tree branches can move infrared radiation around, which the PIR can pick up. If
    the box is near a road, cars driving past might alter the surrounding air.
  prefs: []
  type: TYPE_NORMAL
- en: To avoid triggering the camera in those cases, locate the two small dials ([Figure
    11-5](ch11.xhtml#ch11fig05)) on the back of the PIR (they’re usually orange).
    One is the *Delay Time Adjust* dial, which changes how long it takes to reset
    the PIR each time it’s triggered. The other is the *Distance Adjust* dial, which
    increases or decreases the sensitivity; basically, it determines how much of a
    change in heat is required to trigger the PIR. Experiment with adjusting these
    dials to find the perfect settings for your nature box and your local environment.
  prefs: []
  type: TYPE_NORMAL
- en: '![Image](../images/11fig05.jpg)'
  prefs: []
  type: TYPE_IMG
- en: '**FIGURE 11-5** Adjusting the PIR sensitivity on the back of the PIR'
  prefs: []
  type: TYPE_NORMAL
- en: RETRIEVING THE IMAGES FROM THE RASPBERRY PI
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Now you need to figure out how to retrieve your images. If you leave your hardware
    in the wild, you won’t be able to access the images until you collect your nature
    box. Depending on your setup or the type of wildlife you’re trying to monitor,
    you might want to leave it out for a few days. But waiting that long to view images
    isn’t ideal. The solution is to connect your nature box to the internet so that
    you can use the file-sharing website Dropbox and a simple Python program to upload
    each image in real time. You’ll be able to access the photos remotely by using
    a tablet, a laptop, or a mobile phone.
  prefs: []
  type: TYPE_NORMAL
- en: Setting Up a Dropbox Account
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: If you already have a Dropbox account, you can skip this step. If not, head
    over to the Dropbox website at [*https://www.dropbox.com/*](https://www.dropbox.com/)
    and register for a new account. Click **Create an account** and fill in the sign-up
    form ([Figure 11-6](ch11.xhtml#ch11fig06)). Alternatively, you can use your Google
    account details to sign up.
  prefs: []
  type: TYPE_NORMAL
- en: '![Image](../images/11fig06.jpg)'
  prefs: []
  type: TYPE_IMG
- en: '**FIGURE 11-6** Signing up or logging in to Dropbox'
  prefs: []
  type: TYPE_NORMAL
- en: Once you’ve logged in, navigate to the Dropbox Developers page ([Figure 11-7](ch11.xhtml#ch11fig07))
    at [*https://www.dropbox.com/developers/*](https://www.dropbox.com/developers/)
    to create an app.
  prefs: []
  type: TYPE_NORMAL
- en: '![Image](../images/11fig07.jpg)'
  prefs: []
  type: TYPE_IMG
- en: '**FIGURE 11-7** Going to the Dropbox Developers page'
  prefs: []
  type: TYPE_NORMAL
- en: Click the **Create your app** option. Dropbox presents you with several options.
    When it prompts you to choose an API, select **Dropbox API**. Then select **App
    folder** as the access type. Name your app; I called mine *Nature Box*. Agree
    to the terms and conditions, and click the blue **Confirm** button to access the
    next page of configuration settings ([Figure 11-8](ch11.xhtml#ch11fig08)).
  prefs: []
  type: TYPE_NORMAL
- en: '![Image](../images/11fig08.jpg)'
  prefs: []
  type: TYPE_IMG
- en: '**FIGURE 11-8** Configuring your app’s settings'
  prefs: []
  type: TYPE_NORMAL
- en: Keep the Status row set to **Development**, and the Development users row set
    to **Only you**. This means only you will have permission to edit the app. You
    can also edit the app folder name.
  prefs: []
  type: TYPE_NORMAL
- en: Ignore the App key and App secret rows; you don’t need these for this project.
  prefs: []
  type: TYPE_NORMAL
- en: Select the **Generated access token** box to create a code that will enable
    your Raspberry Pi to send image files to the Dropbox app. You’ll need to use this
    token in your Python program later. Remember that this token keeps your account
    secure, so don’t share it with others.
  prefs: []
  type: TYPE_NORMAL
- en: With your Dropbox app set up, you can now use it to upload the nature box images.
  prefs: []
  type: TYPE_NORMAL
- en: Installing Dropbox for Python
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: 'You need to install a Python Dropbox library so you can access your Dropbox
    app and folder from the Python program code. To install the required software,
    open the terminal and enter the following command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: 'Then, to make sure you’re using the newest updates, enter this command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs: []
  type: TYPE_PRE
- en: Creating a Test Program
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
- en: Before you connect the PIR and Pi Camera to Dropbox, you need to create a simple
    program to test whether the Dropbox app and token are functioning correctly. But
    first, save a JPEG image in the *Nature_Box* folder to test with. In the program
    in [Listing 11-3](ch11.xhtml#ch11ex03), I’ve used an image of a cute squirrel
    ([Figure 11-9](ch11.xhtml#ch11fig09)) and named the file *squirrel.jpg*.
  prefs: []
  type: TYPE_NORMAL
- en: '![Image](../images/11fig09.jpg)'
  prefs: []
  type: TYPE_IMG
- en: '**FIGURE 11-9** Saving an image in the *Nature_Box* folder'
  prefs: []
  type: TYPE_NORMAL
- en: Open your Python editor, create a new file, and add the following code. Save
    it as *DB_uploader.py*.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs: []
  type: TYPE_PRE
- en: '**LISTING 11-3** Testing your Dropbox app and token'
  prefs: []
  type: TYPE_NORMAL
- en: Import the `dropbox` module ❶. Create a variable named `token`, and enter the
    app token you acquired earlier within quotation marks ❷. Next, create another
    variable named `dbx` to hold the `Dropbox` class ❸, which enables your Python
    program code to communicate with your Dropbox account.
  prefs: []
  type: TYPE_NORMAL
- en: Now you’re ready to locate and open the image file you want to upload ❹. Open
    the folder where the image is stored by using `with open`. Next, read from the
    file and use the Dropbox API to upload the image to your account ❺. Then print
    a short confirmation message ❻ so you know the file upload is complete.
  prefs: []
  type: TYPE_NORMAL
- en: Running the Program
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
- en: Go to the Dropbox website, log in, and navigate to your app folder. Then return
    to your Raspberry Pi and run the test program. The test will attempt to upload
    your image file (in this example, the image of the squirrel), so check your Dropbox
    folder for the upload ([Figure 11-10](ch11.xhtml#ch11fig10)).
  prefs: []
  type: TYPE_NORMAL
- en: '![Image](../images/11fig10.jpg)'
  prefs: []
  type: TYPE_IMG
- en: '**FIGURE 11-10** The uploaded image in the *Nature_Box* folder'
  prefs: []
  type: TYPE_NORMAL
- en: CODING THE FINAL NATURE BOX
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'So far, you’ve created three separate programs: a first to test that the PIR
    is working correctly, a second to trigger the Pi Camera whenever the PIR senses
    motion, and a third to allow the Raspberry Pi to upload the images to your linked
    Dropbox folder. Now let’s combine everything you’ve learned so far in this chapter
    to make the final nature box program.'
  prefs: []
  type: TYPE_NORMAL
- en: Setting Up the Final Program
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: Save and rename your previous *DB_uploader.py* file or start a new Python file
    and save it as *NatureBox.py*. Then enter the code in [Listing 11-4](ch11.xhtml#ch11ex04).
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs: []
  type: TYPE_PRE
- en: '**LISTING 11-4** Beginning the final nature box program'
  prefs: []
  type: TYPE_NORMAL
- en: Import the `dropbox` module ❶, which lets you interact with Dropbox via the
    Python code. Also import the usual `sleep()` function to add small delays, then
    the `picamera` library, and finally the `Rpi.GPIO` module to control the PIR.
    Then you set the GPIO numbering system to `BCM`.
  prefs: []
  type: TYPE_NORMAL
- en: Combining the Camera and Sensor
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: The next section of the code, shown in [Listing 11-5](ch11.xhtml#ch11ex05),
    combines the PIR code and the camera code, so when movement is sensed, the Pi
    Camera is triggered. It takes a picture and then creates and saves the image file.
    The first lines should be familiar to you because they’re from the *Cam_PIR.py*
    test program you created.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE7]'
  prefs: []
  type: TYPE_PRE
- en: '**LISTING 11-5** Capturing and saving an image'
  prefs: []
  type: TYPE_NORMAL
- en: Add a value of 1 to the image file variable ❶ (which you set to 0 earlier),
    so the first image saved is named *Nature1.jpg*.
  prefs: []
  type: TYPE_NORMAL
- en: After the Pi Camera captures an image, it saves the image file, but not the
    filename. To save the filename as well, create a new variable named `pic` ❷ to
    hold the image’s filename as a string. This means the program can access it later
    when it’s selecting and uploading the image file to Dropbox.
  prefs: []
  type: TYPE_NORMAL
- en: Creating the try and except
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: Next, in [Listing 11-6](ch11.xhtml#ch11ex06), you use the `try` and `except`
    method. The `try` part attempts to run the section of code responsible for uploading
    the image files to Dropbox. If for some reason the nature box is unable to access
    Dropbox—say, because the site is unavailable or because the nature box is no longer
    online—the program will bypass this section by using the `except` part and continue
    to run without halting or causing an error.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE8]'
  prefs: []
  type: TYPE_PRE
- en: '**LISTING 11-6** Saving the image filename'
  prefs: []
  type: TYPE_NORMAL
- en: Add your Dropbox token ❶ and assign it to a variable named `dbx` ❷, which you
    use to authenticate your account credentials and enable interaction with Dropbox.
    At ❸, open the image file that the camera just took by combining the folder location
    of the image and the `pic` variable, which holds the filename of the most recent
    image. The code `rb` opens the image as a binary file and reads the contents as
    bytes rather than strings. This is important because the file contains an image,
    not text. Then assign this data to a variable named `file`, as in the physical
    data that makes up the image in the file stored on your Raspberry Pi.
  prefs: []
  type: TYPE_NORMAL
- en: The program reads the bytes from `file` and tries to upload the data ❹. The
    code `'/Nature%s.jpg' %(Image_Number)` adds the filename to Dropbox, because the
    binary data you uploaded doesn’t contain a filename otherwise. The code `mute
    = True` prevents the user from being notified of the upload. You can imagine how
    distracting receiving hundreds of notifications about uploaded files would be.
  prefs: []
  type: TYPE_NORMAL
- en: 'After the upload, close the file: open files use processor resources and can
    slow your Raspberry Pi, especially if there are a lot of them. Finally, add the
    `except` section of the program’s `try` and `except` method ❺. If the program
    can’t upload the image, it responds by passing and printing a notification before
    looping back, resetting the PIR, and waiting for the sensor to be triggered again.
    The image is still saved in the *Nature_Box* folder on the Pi but just won’t be
    uploaded.'
  prefs: []
  type: TYPE_NORMAL
- en: Running the Motion Sensor
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: The final section of the program, shown in [Listing 11-7](ch11.xhtml#ch11ex07),
    is identical to the *PIR_test.py* program you created earlier. It tells the PIR
    to wait for an input and, upon receiving one, runs the `Motion_Sensing()` function.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE9]'
  prefs: []
  type: TYPE_PRE
- en: '**LISTING 11-7** Ending the program'
  prefs: []
  type: TYPE_NORMAL
- en: 'Once you’ve copied the complete program, save and run it. Test that it’s working
    by moving around to trigger the PIR. Open your internet browser and navigate to
    your Dropbox folder to check out the uploaded images ([Figure 11-11](ch11.xhtml#ch11fig11)).
    Before you deploy your nature box into the wild, you can test your program in
    fun ways: compete with your friends to see who can walk into a room without triggering
    the sensor, or position your nature box at the front door and check to see who
    is knocking. Look for the evidence in the Dropbox folder before you decide to
    open the door!'
  prefs: []
  type: TYPE_NORMAL
- en: '![Image](../images/11fig11.jpg)'
  prefs: []
  type: TYPE_IMG
- en: '**FIGURE 11-11** Your photos should appear the Dropbox folder when you run
    the program.'
  prefs: []
  type: TYPE_NORMAL
- en: 'If the nature box doesn’t function correctly, consider the following common
    errors:'
  prefs: []
  type: TYPE_NORMAL
- en: Is the Dropbox token used in your program correct?
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Is the Raspberry Pi connected to the internet? Otherwise, all image files will
    remain stored in the *Nature_Box* folder.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Do the folder names in the code match the actual folder names?
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Do the filenames in the code match the actual filenames?
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Is the PIR’s sensitivity adjusted so the proper amount of motion triggers it?
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: When uploading to Dropbox, you can’t overwrite the same file. Therefore, whenever
    you run the program again after the first time, make sure you’ve either moved
    the first batch of image files to a different folder or deleted them.
  prefs: []
  type: TYPE_NORMAL
- en: STARTING THE PROGRAM AUTOMATICALLY
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Because you’ll set up the nature box outside, you won’t have a monitor attached
    to it. The program will need to execute whenever you plug power into the Raspberry
    Pi. Recall that I covered how to start programs automatically in [Chapters 7](ch07.xhtml#ch07),
    [9](ch09.xhtml#ch09), and [10](ch10.xhtml#ch10). Now you’ll do it again for the
    nature box program.
  prefs: []
  type: TYPE_NORMAL
- en: You’ll use cron to run the program automatically by creating instructions in
    the crontab file specifying what event you want to run and when you want to run
    it. Refer to [Chapter 9](ch09.xhtml#ch09) if you need a refresher on using cron.
  prefs: []
  type: TYPE_NORMAL
- en: 'Open the terminal and enter the following command to open the cron console:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE10]'
  prefs: []
  type: TYPE_PRE
- en: The cron console presents you with three methods of editing the crontab file.
    Select option 2 and press ENTER to open the crontab file with the nano text editor.
  prefs: []
  type: TYPE_NORMAL
- en: 'Scroll to the bottom of the text in the crontab file and locate the blank space.
    Then add the following code line to run the program automatically:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE11]'
  prefs: []
  type: TYPE_PRE
- en: The command states that every time the Raspberry Pi reboots, it should run Python
    in super user mode, open the */home/pi/Nature_Box* folder, and execute your *NatureBox.py*
    program.
  prefs: []
  type: TYPE_NORMAL
- en: If you named your code file something else, replace *NatureBox.py* with your
    filename. Also, check that the folder path is correct by opening the folder where
    your *NatureBox.py* program is stored and noting the file path.
  prefs: []
  type: TYPE_NORMAL
- en: The `&` at the end of the code line tells your program to run in the background,
    so you can do other tasks with your Raspberry Pi at the same time.
  prefs: []
  type: TYPE_NORMAL
- en: Once you have checked the command details and are confident they’re correct,
    press CTRL-X to save and exit the crontab file. Now, each time you turn on or
    reboot your Raspberry Pi, the crontab file will run, starting up the nature box.
  prefs: []
  type: TYPE_NORMAL
- en: 'If you want to stop the program from automatically running, reopen the crontab
    file from the terminal and delete the line of code you added, like this:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE12]'
  prefs: []
  type: TYPE_PRE
- en: Then save the file and reboot.
  prefs: []
  type: TYPE_NORMAL
- en: 'The nature box is designed to run without a monitor, so you don’t need the
    Raspberry Pi to boot to the desktop interface and display the background wallpaper
    and icons. Because you won’t see the desktop, you don’t need to load it. Instead,
    you can configure the Pi to boot to the command line. Open the terminal window
    and enter this command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE13]'
  prefs: []
  type: TYPE_PRE
- en: Select the third option, **Boot Options**, and press ENTER. Then select the
    **B1 Desktop / CLI** option, followed by the **B1 Console** option. Click the
    **Save** option and then reboot your Raspberry Pi.
  prefs: []
  type: TYPE_NORMAL
- en: 'Once this is set, select the **<Finish>** option and press ENTER: you’ll be
    prompted to save the config file and reboot. Press **Yes** to restart your Pi.
    As your Raspberry Pi boots up, the nature box will load. Before you place the
    box in the wild, run a quick test and check that it’s working and uploading images
    to your Dropbox account.'
  prefs: []
  type: TYPE_NORMAL
- en: PUTTING IT ALL TOGETHER
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Now that you have a working program, you can set up your box and then leave
    it in your garden, at a local park, or elsewhere. Using a plastic case for the
    box is ideal ([Figure 11-12](ch11.xhtml#ch11fig12)) because you can seal it with
    tape, and it will remain fairly watertight—although I don’t recommend that you
    lower the nature box into a pond or leave it out during a thunderstorm.
  prefs: []
  type: TYPE_NORMAL
- en: 'Preparing your nature box is fairly easy:'
  prefs: []
  type: TYPE_NORMAL
- en: Use a drill to create a small hole for the camera lens to poke through.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Use a drill to create a larger hole so that the PIR can poke through. It’s best
    to drill a small hole to start with and then increase the size of the drill bit
    so that you don’t split the plastic. If you’re using a wooden box, this shouldn’t
    be an issue. The hole needs to be just big enough for the PIR to poke through.![Image](../images/11fig12.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '**FIGURE 11-12** An example of the finished nature box'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Use mounting putty or double-sided tape to secure the Pi Camera and PIR *inside*
    your box. Alternatively, the Pi Camera and some PIRs have small screw holes that
    you could use to mount them.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Happy nature hunting!
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: WRAPPING UP
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'Well done, excellent work–you now have a nature box that can sense movement,
    triggering the Pi Camera to take a picture. This image is then uploaded to your
    Dropbox account for you to view and share. Now try the following:'
  prefs: []
  type: TYPE_NORMAL
- en: Use your setup in your bedroom to see who goes in and hopefully out.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Place it near the cookie jar or your stash of chocolate to gather photographic
    evidence of who keeps stealing from you.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Purchase the Pi NoIR Camera, which can be used to take photos at night, in the
    dark.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
