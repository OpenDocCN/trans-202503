<html><head></head><body>
<div id="sbo-rt-content" class="calibre1"><section aria-labelledby="ch14" epub:type="chapter" role="doc-chapter">
<hgroup>
<h2 class="title" id="ch14">
<span class="cn"><span aria-label=" Page 149. " epub:type="pagebreak" id="pg_149" role="doc-pagebreak" class="calibre2"/><span class="sans_dogma_ot_bold_b_">14</span></span>
<span class="ct1"><span class="sans_dogma_ot_bold_b_">ESCAPING</span></span>
</h2>
</hgroup>
<figure class="opener"><img alt="" class="opener1" height="407" src="../images/chapter.jpg" width="408"/>
</figure>
<p class="chapterintro">This chapter is about a vexing problem and its Batch solution. The problem is that you sometimes want to use a character as simple text but that particular character has a specific function in the coding language. The solution is escaping.</p>
<p class="tx">In this chapter, I’ll explain all the intricacies surrounding how to escape a character in Batch. A certain syntax is used the majority of the time, except for when it isn’t. You’ll learn about multiple rounds of escaping, the syntax, and why you might want to escape a character more than once. I’ll also return to the “continuation character,” used to continue a command on multiple lines of code, because when you remove its veil, it turns out to be an escape character. However, before getting into how to solve this problem, you must first understand and appreciate the problem.</p>
<section aria-labelledby="sec1" epub:type="division">
<h3 class="h" id="sec1"><span id="h1-100"/><span aria-label=" Page 150. " epub:type="pagebreak" id="pg_150" role="doc-pagebreak"/><span class="sans_futura_std_bold_b_">The Problem Statement</span></h3>
<p class="tni">You may want to use a certain character in some code, but what happens if it’s a special character with a certain predefined function in the coding language? For instance, say you’re attempting to use the special character in a text string. It happens in all languages, but it happens quite frequently in Batch because of the language’s uniquely esoteric syntax.</p>
<p class="tx">As you’ve seen repeatedly in this book, percent signs delimit variables; one on either side of a variable resolves the variable to its value. But long before the existence of Batch, the percent sign was used to denote a percentage—that is, a proportion of 100. Hence, a text string in Batch can’t simply refer to <span class="sans_thesansmonocd_w5regular_">50%</span> without the percent sign being interpreted as a delimiter. The insidious aspect of this issue is that there’s no compiler to catch the problem and the interpreter might not even fail to execute the code, instead producing unexpected results.</p>
<p class="tx">To demonstrate, consider this command writing what appears to be a simple statement to the console:</p>
<pre class="pre"><code class="calibre11">&gt; con echo Between 60% and 80% of Americans don't understand percents!</code></pre>
<p class="tx">The interpreter treats everything between the two percent signs—that is, the space followed by <span class="sans_thesansmonocd_w5regular_">and 80</span>—as a variable. Assuming that such a variable isn’t set, which is a virtual certainty, it (along with the percent signs) resolves to null. The result is this nonsensical statement written to the console:</p>
<pre class="pre"><code class="calibre11">Between 60 of Americans don't understand percents</code></pre>
<p class="tni">And if this command had used only one percent sign, it alone would’ve been dropped from the output. By the way, what happened to the exclamation mark at the end? Hold that thought.</p>
<p class="tx">The solution to this quandary is escaping any special characters. Escape characters can be tricky, but they are very useful and indispensable in many situations. Before long, I’ll come back to the previous <span class="sans_thesansmonocd_w5regular_">echo</span> command to show you how to make it write the desired text.</p>
</section>
<section aria-labelledby="sec2" epub:type="division">
<h3 class="h" id="sec2"><span id="h1-101"/><span class="sans_futura_std_bold_b_">The Caret Escape Character</span></h3>
<p class="tni">The primary Batch escape character is the caret (<span class="sans_thesansmonocd_w5regular_">^</span>). In other contexts, it’s called a hat or used to indicate an exponential, but in the Batch realm, it’s a caret. On most keyboards, you can type it using <small class="calibre5">SHIFT</small>-6. The upshot is that the interpreter treats the vast majority of characters following the caret as simple text.</p>
<p class="tx">The following <span class="sans_thesansmonocd_w5regular_">echo</span> command is attempting to write to the console some trite pablum one might expect to find on a bad motivational poster at an office run by people who don’t understand that <i class="calibre6">Office Space</i> was a <span aria-label=" Page 151. " epub:type="pagebreak" id="pg_151" role="doc-pagebreak"/>comedy, but the cringeworthy content is only part of the problem. It simply doesn’t work:</p>
<pre class="pre"><code class="calibre11">&gt; con echo Together We Are &gt; You &amp; Me Alone</code></pre>
<p class="tni">The interpreter treats the second greater-than sign as a second redirection character, creating an extensionless file named <span class="sans_thesansmonocd_w5regular_">You</span> in the current directory, and the ampersand ends one command and starts another. Obviously, the <span class="sans_thesansmonocd_w5regular_">Me</span> command with the <span class="sans_thesansmonocd_w5regular_">Alone</span> argument fails outright.</p>
<p class="tx">The command is clearly a mess, but it’s fixable with carets. I’m inserting the primary Batch escape character just prior to the two characters that thwarted us before:</p>
<pre class="pre"><code class="calibre11">&gt; con echo Together We Are ^&gt; You ^&amp; Me Alone</code></pre>
<p class="tx">You can think of each caret in this command as a special messenger. The escape character is giving the interpreter this clear message upon its discovery:</p>
<p class="blockquotesingle">The very next character following me is to be treated as simple text. Don’t interpret it as you normally would. Oh, and by the way, promptly discard me for I am but a digital Pheidippides, a simple messenger who expires after the completion of his task.</p>
<p class="tx">The result is this maybe inspirational and motivational message written to the console:</p>
<pre class="pre"><code class="calibre11">Together We Are &gt; You &amp; Me Alone</code></pre>
<p class="tx">Another way to get the interpreter to treat the special characters as text is to enclose the string in double quotes:</p>
<pre class="pre"><code class="calibre11">&gt; con echo "Together We Are &gt; You &amp; Me Alone"</code></pre>
<p class="tni">It’s important to note that while this command doesn’t have escape characters, it also writes out the double quotes to the console.</p>
<p class="tx">I’ll soon reveal some exceptions, but the caret is the most commonly used Batch escape character, and you can use it to escape the less-than symbol (<span class="sans_thesansmonocd_w5regular_">&lt;</span>), pipe (<span class="sans_thesansmonocd_w5regular_">|</span>), and parentheses (<span class="sans_thesansmonocd_w5regular_">()</span>), among other special characters. But Batch doesn’t treat all characters equally.</p>
</section>
<section aria-labelledby="sec3" epub:type="division">
<h3 class="h" id="sec3"><span id="h1-102"/><span class="sans_futura_std_bold_b_">Escaping the Caret</span></h3>
<p class="tni">Since the interpreter treats the caret as an escape character and throws it away, you might ponder the plight of a caret wanting to be treated simply as text itself. For example, if you were to write the Pythagorean theorem to the console, I hope you aren’t surprised to learn that Batch doesn’t support superscripts: <span class="sans_thesansmonocd_w5regular_">A</span><span class="sans_thesansmonocd_w5regular_sup_">2</span> <span class="sans_thesansmonocd_w5regular_">+ B</span><span class="sans_thesansmonocd_w5regular_sup_">2</span> <span class="sans_thesansmonocd_w5regular_">= C</span><span class="sans_thesansmonocd_w5regular_sup_">2</span>. Instead, carets indicating exponentiation will suffice if we can make it work: <span class="sans_thesansmonocd_w5regular_">A^2 + B^2 = C^2</span>. (The Pythagorean theorem <span aria-label=" Page 152. " epub:type="pagebreak" id="pg_152" role="doc-pagebreak"/>assumes that <span class="sans_thesansmonocd_w5regular_">A</span> and <span class="sans_thesansmonocd_w5regular_">B</span> are the sides of a right triangle adjacent to the right angle and that <span class="sans_thesansmonocd_w5regular_">C</span> is the hypotenuse.) This might be a first attempt at a solution:</p>
<pre class="pre"><code class="calibre11">&gt; con echo The Pythagorean Theorem:  A^2 + B^2 = C^2</code></pre>
<p class="tx">Unfortunately, each caret tells the interpreter to treat the following character, a <span class="sans_thesansmonocd_w5regular_">2</span> in each instance, as simple text, which it would’ve done anyway:</p>
<pre class="pre"><code class="calibre11">The Pythagorean Theorem:  A2 + B2 = C2</code></pre>
<p class="tni">The interpreter simply throws away the carets as if they were never there.</p>
<p class="tx">The solution rests in the fact that the caret is self-escaping; a caret is escaped with another caret. I’ve replaced each caret in the following code with double carets. In each instance, the first caret is the escape character, followed by the text caret:</p>
<pre class="pre"><code class="calibre11">&gt; con echo The Pythagorean Theorem:  A^^2 + B^^2 = C^^2</code></pre>
<p class="tx">Now you’ll get the desired result:</p>
<pre class="pre"><code class="calibre11">The Pythagorean Theorem:  A^2 + B^2 = C^2</code></pre>
<p class="tni">We still can’t manage a superscript, but the result written to the console is the next best thing and much to a mathematician’s liking.</p>
</section>
<section aria-labelledby="sec4" epub:type="division">
<h3 class="h" id="sec4"><span id="h1-103"/><span class="sans_futura_std_bold_b_">Escaping Percent Signs and Exclamation Marks</span></h3>
<p class="tni">After studying the Pythagorean theorem, you might ace the math test, but this celebratory Batch command fails to produce the desired result as the two special characters are dropped from the text written to the console:</p>
<pre class="pre"><code class="calibre11">&gt; con echo I Scored 100% on my Math Test!</code></pre>
<p class="tx">D’oh! We forgot the carets. You can be forgiven for thinking this quick fix will show the percent sign and the exclamation mark:</p>
<pre class="pre"><code class="calibre11">&gt; con echo I Scored 100^% on my Math Test^!</code></pre>
<p class="tni">But the output is unchanged. Unfortunately, as is often the case with Batch, there are batveats. The caret doesn’t work as the escape character for the percent sign or the exclamation mark.</p>
<p class="tx">The escape character for the percent sign is another percent sign, and the escape character—actually the escape characters, plural—for the exclamation mark is two carets. If this doesn’t make any sense to you, you are not alone. I’ve never found a good justification for this anomaly, but the following command writes <span class="sans_thesansmonocd_w5regular_">I Scored 100% on my Math Test!</span> to the console:</p>
<pre class="pre"><code class="calibre11"><span aria-label=" Page 153. " epub:type="pagebreak" id="pg_153" role="doc-pagebreak"/>&gt; con echo I Scored 100%% on my Math Test^^!</code></pre>
<p class="tx">Reflect on this a moment; in comparison to the Pythagorean theorem example, there seems to be a contradiction in how Batch handles double carets. The text <span class="sans_thesansmonocd_w5regular_">^^2</span> resolves to <span class="sans_thesansmonocd_w5regular_">^2</span>, but in relation to the math test, the text <span class="sans_thesansmonocd_w5regular_">^^!</span> resolves to <span class="sans_thesansmonocd_w5regular_">!</span>, leaving nary a caret in sight. Yes, that’s how it works. The interpreter handles double carets one way if followed by an exclamation mark and another way if followed by anything else. Consider it a batveat of a batveat (or a meta-batveat).</p>
<p class="tx">Getting back to the problem statement from the beginning of the chapter, this command writes the desired text:</p>
<pre class="pre"><code class="calibre11">&gt; con echo Between 60%% and 80%% of Americans don't understand percents^^!</code></pre>
<p class="tni">The interpreter writes the appropriate text to the console thanks to each set of double percent signs and the two carets preceding the exclamation mark.</p>
<blockquote class="calibre8">
<p class="warning"><span class="sans_dogma_ot_bold_b_1">NOTE</span></p>
</blockquote>
<p class="warning-txt"><i class="calibre6">As noted in <a href="chapter3.xhtml" class="calibre3">Chapter 3</a>, I’ve written this book with the assumption that delayed expansion is always enabled, but if it’s disabled, Batch treats the exclamation mark like any other character with no particular significance in Batch and with no need of being escaped.</i></p>
</section>
<section aria-labelledby="sec5" epub:type="division">
<h3 class="h" id="sec5"><span id="h1-104"/><span class="sans_futura_std_bold_b_">Multilevel Escaping</span></h3>
<p class="tni">The previous examples demonstrate how to write hardcoded text to the console with single-level escaping, and the same techniques successfully set a simple variable, but there’s a catch. For instance, the following <span class="sans_thesansmonocd_w5regular_">set</span> command resolves the two escape characters and stores <span class="sans_thesansmonocd_w5regular_">Together We Are &gt; You &amp; Me Alone</span> into the variable:</p>
<pre class="pre"><code class="calibre11">set pureDrivel=Together We Are ^&gt; You ^&amp; Me Alone</code></pre>
<p class="tx">Unfortunately, the uses for this variable are severely limited. The variable does in fact contain the two special characters, but if you tried writing it to the console or a file or tried piping it to another command, it would fail to work as intended. Because the escape characters were removed from the text as it was assigned to the variable, when that variable is later resolved, the characters that have special meaning to the interpreter pose the same problem that escaping initially solved.</p>
<p class="tx">The solution is to escape the escape character—yes, double-level escaping. The following two lines of code write the desired text to the console, and by desired text I mean that it contains a greater-than sign and an ampersand with no escape characters:</p>
<pre class="pre"><code class="calibre11">set pureDrivel=Together We Are ^^^&gt; You ^^^&amp; Me Alone
&gt; con echo %pureDrivel%
</code></pre>
<p class="tni">To see what’s happening, let’s focus on <span class="sans_thesansmonocd_w5regular_">^^^&amp;</span>. The first caret is the escape character for the second caret, and the third caret is the escape character <span aria-label=" Page 154. " epub:type="pagebreak" id="pg_154" role="doc-pagebreak"/>for the ampersand. When resolved, the <span class="sans_thesansmonocd_w5regular_">set</span> command stores <span class="sans_thesansmonocd_w5regular_">^&amp;</span> as part of the variable’s value. When the <span class="sans_thesansmonocd_w5regular_">echo</span> command resolves the variable, the remaining caret—the one that was treated as text just a moment ago—is now the escape character for the ampersand, resulting in just the ampersand surviving to be written to the console.</p>
<p class="tx">Let’s look at the entire text string. The first command sets <span class="sans_thesansmonocd_w5regular_">pureDrivel</span> to the value <span class="sans_thesansmonocd_w5regular_">Together We Are ^&gt; You ^&amp; Me Alone</span>; then the second command writes the text <span class="sans_thesansmonocd_w5regular_">Together We Are &gt; You &amp; Me Alone</span> to the console.</p>
<p class="tx">Multilevel escaping can get a bit more complicated. For instance, if you’re concatenating two variables into a larger variable before writing that second variable to a file, you’ll need three levels of escaping.</p>
<p class="tx">As for the mechanics of triple-level escaping, consider this: because of the four escape characters in <span class="sans_thesansmonocd_w5regular_">^^^^^^^&amp;</span> (that’s seven carets), it resolves to <span class="sans_thesansmonocd_w5regular_">^^^&amp;</span>. A second round of escaping sees this resolve to <span class="sans_thesansmonocd_w5regular_">^&amp;</span>, which ultimately resolves to <span class="sans_thesansmonocd_w5regular_">&amp;</span> on the third round. The number of escape characters is 2<i class="calibre6"><sup class="calibre14">n</sup></i> – 1, where <i class="calibre6">n</i> is the number of escapes. I said it was tricky, but it’s also pretty cool.</p>
</section>
<section aria-labelledby="sec6" epub:type="division">
<h3 class="h" id="sec6"><span id="h1-105"/><span class="sans_futura_std_bold_b_">The Continuation Character</span></h3>
<p class="tni">On more than one occasion, I’ve heard coders refer to the caret as the Batch <i class="calibre6">continuation character</i>, and I even introduced it as such in <span class="xref"><a href="chapter5.xhtml" class="calibre3">Chapter 5</a></span> with an example that used it in a <span class="sans_thesansmonocd_w5regular_">set</span> command spanning four lines of code. Technically, that’s incorrect, but in practice, it does perform this function. Allow me to explain.</p>
<p class="tx">It should be the goal of every coder to write code that does not force the reader to scroll right and left. (It should also be efficient, well-documented, well-organized, and even elegant, but maybe that’s just my opinion, so I digress.) In most compiled languages when a command gets too long to easily read, you simply press <small class="calibre5">ENTER</small> and continue typing on the next line. The compiler is smart enough to know that the command encompasses two, three, or even more, lines.</p>
<p class="tx">The Batch interpreter isn’t that forgiving (or smart), but when you append a caret to the <i class="calibre6">very end</i> of a line of code, the statement continues on the following line. Even when a line isn’t particularly long, I sometimes use this technique to line up the arguments I’m passing to an executable for readability:</p>
<pre class="pre"><code class="calibre11">C:\Batch\SomeExecutable.exe %Arg1% ^
                            %Arg2% ^
                            %AnotherArg% ^
                            %YetAnotherArg% ^
                            %AndAnother%
</code></pre>
<p class="tx">At the end of most lines in a text file, two bytes represent the <i class="calibre6">carriage return line feed</i>. In hex, the bytes are <span class="sans_thesansmonocd_w5regular_">x'0D' x'0A'</span>, and together they are often referred to as the CRLF, but they are not usually visible in the text editor. <span aria-label=" Page 155. " epub:type="pagebreak" id="pg_155" role="doc-pagebreak"/>(If using Notepad++, select <b class="calibre10">View</b><span class="sans_thesansmonocd_w5regular_"> ▶ </span><b class="calibre10">Show Symbol</b><span class="sans_thesansmonocd_w5regular_"> ▶ </span><b class="calibre10">Show End of Line</b> to make the CRLFs visible. Other editors have a similar feature.)</p>
<p class="tx">In reality, the caret is still just an escape character, and it’s escaping the CRLF. In keeping with what an escape character does, when the interpreter sees the caret, it doesn’t treat the CRLF following as it normally would—that is, as the end of a line. Instead, it just treats the CRLF as any other whitespace and ignores it, essentially wrapping the line. In this way, the caret is the “continuation character.” (But I still cringe.)</p>
<p class="tx">A common mistake that invalidates this text wrapping is to append the line apparently ending in a caret with a space or two after the caret. Since the caret escapes the very next character, this does nothing more than escape a space, which is pretty close to doing nothing at all and leaves the CRLF undisturbed. This oversight can be very difficult to troubleshoot for those who simply think of the caret as a continuation character instead of as an escape character for the CRLF. Knowledge is power.</p>
<p class="tx">You’ve learned that single characters are escaped by a single escape character, except for the exclamation mark, which requires two escape characters. The CRLF is yet another exception, but for the opposite reason. The CRLF is actually two characters, the carriage return character and the line feed character, and it’s the only example in Batch of two characters escaped by a lone character.</p>
</section>
<section aria-labelledby="sec7" epub:type="division">
<h3 class="h" id="sec7"><span id="h1-106"/><span class="sans_futura_std_bold_b_">Summary</span></h3>
<p class="tni">In this chapter, you learned the many ways to use the caret, and sometimes the percent sign, to escape special characters, but the discussion is just beginning. This technique is an indispensable tool, and you’ll see more than one application of it later in this book.</p>
<p class="tx">If nothing else, I hope this chapter has demonstrated how very tricky escaping can be. When I was a novice Batch coder, I received some simple, yet sage, advice about escaping from a more experienced co-worker. The advice was to test diligently; test all possible characters that the code might reasonably encounter in the data. With so many caveats, batveats, and exceptions, you shouldn’t assume that escaping will work in all contexts after seeing it work in one particular context. In your test plan, pepper the code doing the escaping with all of the special characters that could possibly come its way.</p>
<p class="tx">For something completely different, the next chapter will discuss how a bat file can work interactively with a human, asking questions, getting responses, and performing conditional logic based on those answers.</p>
</section>
</section>
</div></body></html>