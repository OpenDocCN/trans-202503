<html><head></head><body>
		<section>&#13;
			<header>&#13;
				<h1 class="chapter"><span class="ChapterNumber"><span epub:type="pagebreak" id="Page_367" title="367"/>21</span><br/><span class="ChapterTitle">The Internet</span></h1>&#13;
			</header>&#13;
			<p class="ChapterIntro">In this chapter you will</p>&#13;
			<ul>&#13;
				<li>Build a web server to display data on a web page</li>&#13;
				<li>Use your Arduino to send tweets on Twitter</li>&#13;
				<li>Remotely control Arduino digital outputs from a web browser</li>&#13;
			</ul>&#13;
			<p>This chapter will show you how to connect your Arduino to the outside world via the internet. This allows you to broadcast data from your Arduino and remotely control your Arduino from a web browser.</p>&#13;
			<h2 id="h1-500587c21-0001">What You’ll Need</h2>&#13;
			<p class="BodyFirst">To build these internet-related projects, you will need some common hardware, a cable, and some information.</p>&#13;
			<p>&#13;
				Let’s start with the hardware. You’ll need an Ethernet shield with the W5100 controller chip. You have two options to consider: you can use the genuine Arduino-brand Ethernet shield, as shown in <a href="#figure21-1" id="figureanchor21-1">Figure 21-1</a>, or you can use an Arduino Uno–compatible board with integrated Ethernet hardware, such PMD Way part 328497, as shown in <a href="#figure21-2" id="figureanchor21-2">Figure 21-2</a>. The latter is a good <span epub:type="pagebreak" id="Page_368" title="368"/>choice for new projects or when you want to save physical space and money. As you can see, the integrated board has the connectors for Arduino shields, a USB port, an Ethernet socket, and a microSD card socket.</p>&#13;
			<figure>&#13;
				<img alt="f21001" src="image_fi/500587c21/f21001.png"/>&#13;
				<figcaption>&#13;
					<p><a id="figure21-1">Figure 21-1</a>: An Arduino Ethernet shield</p>&#13;
				</figcaption>&#13;
			</figure>&#13;
			<figure>&#13;
				<img alt="f21002" src="image_fi/500587c21/f21002.png"/>&#13;
				<figcaption>&#13;
					<p><a id="figure21-2">Figure 21-2</a>: An Arduino Uno–compatible board with integrated Ethernet</p>&#13;
				</figcaption>&#13;
			</figure>&#13;
			<p><span epub:type="pagebreak" id="Page_369" title="369"/>Regardless of your choice of hardware, you’ll also need a standard 10/100 CAT5, CAT5E, or CAT6 network cable to connect your Ethernet shield to your network router or internet modem.</p>&#13;
			<p>In addition, you’ll need the IP address of your network’s router gateway or modem, which should look something like this: 192.168.0.1. You’ll also need your computer’s IP address in the same format as your router’s IP address.</p>&#13;
			<p>&#13;
				Finally, if you want to communicate with your Arduino from outside your home or local area network, you’ll need a static, public IP address. A static IP address is a fixed address assigned to your physical internet connection by your internet service provider (ISP). Your internet connection may not have a static IP address by default; contact your ISP to have this activated if necessary. If your ISP cannot offer a static IP or if it costs too much, you can get an automated redirection service that offers a hostname that can divert to your connection’s IP address through a third-party company, such as No-IP (<a class="LinkURL" href="http://www.noip.com/">http://www.noip.com/</a>) or Dyn (<a class="LinkURL" href="https://account.dyn.com/">https://account.dyn.com/</a>). Now let’s put our hardware to the test with a simple project.</p>&#13;
			<h2 class="HeadProject" id="h1-500587c21-0002"><span>Project #60: Building a Remote Monitoring Station</span></h2>&#13;
			<p class="BodyFirst">In projects in previous chapters, we gathered data from sensors to measure temperature and light. In this project, you’ll learn how to display those values on a simple web page that you can access from almost any web-enabled device. This project will display the values of the analog input pins and the status of digital inputs 0 to 9 on a simple web page, functionality that will serve as the basis for a remote monitoring station.</p>&#13;
			<p>Using this framework, you can add sensors with analog and digital outputs, such as temperature, light, and switch sensors, and then display the sensors’ status on a web page.</p>&#13;
			<h3 id="h2-500587c21-0001">The Hardware</h3>&#13;
			<p class="BodyFirst">Here’s what you’ll need to create this project:</p>&#13;
			<ul>&#13;
				<li>One USB cable</li>&#13;
				<li>One network cable</li>&#13;
				<li>One Arduino Uno and Ethernet shield, or one Arduino Uno–compatible board with integrated Ethernet</li>&#13;
			</ul>&#13;
			<h3 id="h2-500587c21-0002">The Sketch</h3>&#13;
			<p class="BodyFirst">Enter the following sketch, but <em>don’t upload it</em> yet:</p>&#13;
			<pre><code>/* Project 60 – Building a Remote Monitoring Station created 18 Dec 2009 by David A. Mellis, modified 9 Apr 2012 by Tom Igoe modified August 2020 by John Boxall */&#13;
#include &lt;SPI.h&gt;<span epub:type="pagebreak" id="Page_370" title="370"/>#include &lt;Ethernet.h&gt;<span aria-label="annotation1" class="CodeAnnotationHang">1</span> IPAddress ip(<var>xxx</var>,<var>xxx</var>,<var>xxx</var>,<var>xxx</var>); //  Replace this with your project's IP address<span aria-label="annotation2" class="CodeAnnotationHang">2</span> byte mac[] = { 0xDE, 0xAD, 0xBE, 0xEF, 0xFE, 0xED }; &#13;
EthernetServer server(80);&#13;
void setup() &#13;
{ // Start the Ethernet connection and server Ethernet.begin(mac, ip); server.begin(); for (int z=0; z&lt;10; z++)   { pinMode(z, INPUT);         // set digital pins 0 to 9 to inputs }&#13;
} &#13;
void loop()&#13;
{ // listen for incoming clients (incoming web page request connections) EthernetClient client = server.available(); if (client) { // an HTTP request ends with a blank line boolean currentLineIsBlank = true; while (client.connected()) { if (client.available()) { char c = client.read(); if (c == '\n') &amp;&amp; currentLineIsBlank) { client.println("HTTP/1.1 200 OK"); client.println("Content-Type: text/html"); client.println("Connection: close"); client.println(); client.println("&lt;!DOCTYPE HTML&gt;"); client.println("&lt;html&gt;"); // add a meta refresh tag, so the browser pulls again every 5 sec:<span aria-label="annotation3" class="CodeAnnotationHang">3</span>           client.println("&lt;meta http-equiv=\"refresh\" content=\"5\"&gt;");  // output the value of each analog input pin onto the web page for (int analogChannel = 0; analogChannel &lt; 6; analogChannel++) { int sensorReading = analogRead(analogChannel);<span aria-label="annotation4" class="CodeAnnotationHang">4</span>             client.print("analog input "); client.print(analogChannel); client.print(" is "); client.print(sensorReading); client.println("&lt;br /&gt;");        } // output the value of digital pins 0 to 9 onto the web page for (int digitalChannel = 0; digitalChannel &lt; 10; digitalChannel++) { boolean pinStatus = digitalRead(digitalChannel); client.print("digital pin "); client.print(digitalChannel); client.print(" is "); client.print(pinStatus); client.println("&lt;br /&gt;"); <span epub:type="pagebreak" id="Page_371" title="371"/>          }           client.println("&lt;/html&gt;"); break; } if (c == '\n') { // you're starting a new line currentLineIsBlank = true; }  else if (c != '\r') { // you've gotten a character on the current line currentLineIsBlank = false; } } } // give the web browser time to receive the data delay(1); // close the connection: client.stop(); }&#13;
}</code></pre>&#13;
			<p>&#13;
				We’ll discuss this sketch in more detail a bit later. First, before uploading the sketch, you’ll need to enter an IP address for your Ethernet shield so that it can be found on your local network or modem. You can determine the first three parts of the address by checking your router’s IP address. For example, if your router’s address is 192.168.0.1, change the last digit to something random and different from that of other devices on your network, using a number between 2 and 254 that isn’t already in use on your network. Enter the altered IP address at <span aria-label="annotation1" class="CodeAnnotation">1</span> in the sketch, like so:</p>&#13;
			<pre><code>IPAddress ip(192, 168, 0, 69); // Ethernet shield's IP address</code></pre>&#13;
			<figure>&#13;
				<img alt="f21003" src="image_fi/500587c21/f21003.png"/>&#13;
				<figcaption>&#13;
					<p><a id="figure21-3">Figure 21-3</a>: Values of the pins monitored by our station, viewable as a web page on any web-connected device with a web browser</p>&#13;
				</figcaption>&#13;
			</figure>&#13;
			<p>Once you’ve made that change, save and upload your sketch. Next, insert the Ethernet shield into your Arduino if required, connect the network cable to your router or modem and the Ethernet connector, and power on your Arduino board.</p>&#13;
			<p>&#13;
				Wait about 20 seconds. Then, using a web browser on any device or computer on your network, enter the IP address from <span aria-label="annotation1" class="CodeAnnotation">1</span>. If you see something like <a href="#figure21-3" id="figureanchor21-3">Figure 21-3</a>, the framework of your monitoring station is working correctly.</p>&#13;
			<h3 id="h2-500587c21-0003"><span epub:type="pagebreak" id="Page_372" title="372"/>Troubleshooting</h3>&#13;
			<p class="BodyFirst">If this project doesn’t work for you, try the following:</p>&#13;
			<ul>&#13;
				<li>&#13;
					Check that the IP address is set correctly in the sketch at <span aria-label="annotation1" class="CodeAnnotation">1</span>.</li>&#13;
				<li>Check that the sketch is correct and uploaded to your Arduino.</li>&#13;
				<li>Double-check the local network. You might check whether a connected computer can access the internet. If so, check that the Arduino board has power and is connected to the router or modem.</li>&#13;
				<li>If you’re accessing the project web page from a smartphone, make sure your smartphone is accessing your local Wi-Fi network and not the cell phone company’s cellular network.</li>&#13;
				<li>If none of the Ethernet shield’s LEDs are blinking when the Arduino has power and the Ethernet cable is connected to the shield and router or modem, try another patch lead.</li>&#13;
			</ul>&#13;
			<h3 id="h2-500587c21-0004">Understanding the Sketch</h3>&#13;
			<p class="BodyFirst">Once your monitoring station is working, you can return to the most important parts of the sketch. The code from the beginning until <span aria-label="annotation3" class="CodeAnnotation">3</span> is required because it loads the necessary libraries and starts the Ethernet hardware in <code>void setup()</code>. Prior to <span aria-label="annotation3" class="CodeAnnotation">3</span>, the <code>client.print()</code> statements are where the sketch sets up the web page to allow it to be read by the web browser. From <span aria-label="annotation3" class="CodeAnnotation">3</span> on, you can use the functions <code>client.print()</code> and <code>client.println()</code> to display information on the web page as you would with the Serial Monitor. For example, the following code is used to display the first six lines of the web page shown in Figure 19-3:</p>&#13;
			<pre><code>client.print("analog input ");&#13;
client.print(analogChannel);&#13;
client.print(" is ");&#13;
client.print(sensorReading);</code></pre>&#13;
			<p>&#13;
				At <span aria-label="annotation4" class="CodeAnnotation">4</span>, you see an example of writing text and the contents of a variable to the web page. Here you can use HTML to control the look of your displayed web page, as long as you don’t overtax your Arduino’s memory. In other words, you can use as much HTML code as you like until you reach the maximum sketch size, which is dictated by the amount of memory in your Arduino board. (The sizes for each board type are described in Table 13-2 on <span class="xref" itemid="xref_target_page 234">page 234</span>.)</p>&#13;
			<p>&#13;
				One thing to notice is the MAC address that networks can use to detect individual pieces of hardware connected to the network. Each piece of hardware on a network has a unique MAC address, which can be changed by altering one of the hexadecimal values at <span aria-label="annotation2" class="CodeAnnotation">2</span>. If two or more Arduino-based projects are using one network, you must enter a different MAC address for each device at <span aria-label="annotation2" class="CodeAnnotation">2</span>. If your shield has a MAC address included with it, use that value.</p>&#13;
			<p><span epub:type="pagebreak" id="Page_373" title="373"/>Finally, if you want to view your web page from a device that is not connected to your local network, such as a tablet or phone using a cellular connection, then you’ll need to use a technique called <em>port forwarding</em> in your network router or modem, provided by an organization such as the previously mentioned No-IP or Dyn. Port forwarding is often unique to the make and model of your router, so do an internet search for “router port forwarding” or visit a tutorial site such as <a class="LinkURL" href="http://www.wikihow.com/Port-Forward">http://www.wikihow.com/Port-Forward</a> for more information.</p>&#13;
			<p>Now that you know how to display text and variables on a web page, let’s use the Arduino to tweet.</p>&#13;
			<h2 class="HeadProject" id="h1-500587c21-0003"><span>Project #61: Creating an Arduino Tweeter</span></h2>&#13;
			<p class="BodyFirst">In this project, you’ll learn how to make your Arduino send tweets through Twitter. You can receive all sorts of information that can be generated by a sketch from any device that can access Twitter. If, for example, you want hourly temperature updates from home while you’re abroad or even notifications when the kids come home, this can offer an inexpensive solution.</p>&#13;
			<p>Your Arduino will need its own Twitter account, so do the following:</p>&#13;
			<ol class="decimal">&#13;
				<li value="1">Visit <a class="LinkURL" href="http://twitter.com/">http://twitter.com/</a> and create your Arduino’s Twitter account. Make note of the username and password.</li>&#13;
				<li value="2">Get a <em>token</em> from the third-party website <a class="LinkURL" href="http://arduino-tweet.appspot.com/">http://arduino-tweet.appspot.com/</a>. A token creates a bridge between your Arduino and the Twitter service. You’ll need to follow only step 1 on this site.</li>&#13;
				<li value="3">Copy and paste the token, along with your Arduino’s new Twitter account details, into a text file on your computer.</li>&#13;
				<li value="4">Download and install the Twitter Arduino library from <a class="LinkURL" href="https://github.com/NeoCat/Arduno-Twitter-library/archive/master.zip">https://github.com/NeoCat/Arduno-Twitter-library/archive/master.zip</a>.</li>&#13;
			</ol>&#13;
			<h3 id="h2-500587c21-0005">The Hardware</h3>&#13;
			<p class="BodyFirst">Here’s what you’ll need to create this project:</p>&#13;
			<ul>&#13;
				<li>One USB cable</li>&#13;
				<li>One network cable</li>&#13;
				<li>One Arduino Uno and Ethernet shield, or one Arduino Uno–compatible board with integrated Ethernet</li>&#13;
			</ul>&#13;
			<h3 id="h2-500587c21-0006">The Sketch</h3>&#13;
			<p class="BodyFirst">Enter the following sketch, but <em>don’t upload it</em> yet:</p>&#13;
			<pre><code>// Project 61 - Creating an Arduino Tweeter&#13;
#include &lt;SPI.h&gt; &#13;
#include &lt;Ethernet.h&gt;&#13;
#include &lt;Twitter.h&gt;<span epub:type="pagebreak" id="Page_374" title="374"/>// Ethernet shield settings<span aria-label="annotation1" class="CodeAnnotationHang">1</span> IPAddress ip(192,168,0,1); // Replace this with your project's IP address<span aria-label="annotation2" class="CodeAnnotationHang">2</span> byte mac[] = { <var>0xDE</var>, <var>0xAD</var>, <var>0xBE</var>, <var>0xEF</var>, <var>0xFE</var>, <var>0xED</var> };<span aria-label="annotation3" class="CodeAnnotationHang">3</span> Twitter twitter("<var>insertyourtokenhere</var>");&#13;
// Message to post<span aria-label="annotation4" class="CodeAnnotationHang">4</span> char msg[] = "<var>I'm alive!</var>";&#13;
void setup()&#13;
{ delay(1000); Ethernet.begin(mac, ip); // or you can use DHCP for automatic IP address configuration // Ethernet.begin(mac); Serial.begin(9600); Serial.println("connecting ...");&#13;
}&#13;
void loop()&#13;
{<span aria-label="annotation5" class="CodeAnnotationHang">5</span>  if (twitter.post(msg)) { int status = twitter.wait(&amp;Serial); if (status == 200) { Serial.println("OK."); } else { Serial.print("failed : code "); Serial.println(status); } } else { Serial.println("connection failed."); } while (1);&#13;
}</code></pre>&#13;
			<figure>&#13;
				<img alt="f21004" src="image_fi/500587c21/f21004.png"/>&#13;
				<figcaption>&#13;
					<p><a id="figure21-4">Figure 21-4</a>: Your Arduino’s tweet</p>&#13;
				</figcaption>&#13;
			</figure>&#13;
			<p>&#13;
				As with Project 60, insert your IP address at <span aria-label="annotation1" class="CodeAnnotation">1</span> and modify the MAC address if necessary at <span aria-label="annotation2" class="CodeAnnotation">2</span>. Then insert the Twitter token between the double quotes at <span aria-label="annotation3" class="CodeAnnotation">3</span>. Finally, insert the text that you want to tweet at <span aria-label="annotation4" class="CodeAnnotation">4</span>. Now upload the sketch and connect your hardware to the network. (Don’t forget to follow your Arduino’s Twitter account with your own account!) After a minute or so, visit your Twitter page or load the app on a device, and the message should be displayed, as shown in <a href="#figure21-4" id="figureanchor21-4">Figure 21-4</a>.</p>&#13;
			<p>&#13;
				When you’re creating your Arduino tweeter, keep in mind that you can send no more than one tweet per minute and that each message must be unique. (These are Twitter’s rules.) <span epub:type="pagebreak" id="Page_375" title="375"/>When sending tweets, Twitter also replies with a status code. The sketch will receive and display this in the Serial Monitor using the code at <span aria-label="annotation5" class="CodeAnnotation">5</span>. <a href="#figure21-5" id="figureanchor21-5">Figure 21-5</a> shows an example.</p>&#13;
			<figure>&#13;
				<img alt="f21005" src="image_fi/500587c21/f21005.png"/>&#13;
				<figcaption>&#13;
					<p><a id="figure21-5">Figure 21-5</a>: Example error message from Twitter due to a duplicate post attempt</p>&#13;
				</figcaption>&#13;
			</figure>&#13;
			<p>&#13;
				If you receive a 403 message like this, either your token is incorrect or you’re sending tweets too quickly. (For a complete list of Twitter error codes, see <a class="LinkURL" href="https://finderrorcode.com/twitter-error-codes.html">https://finderrorcode.com/twitter-error-codes.html</a>.)</p>&#13;
			<h2 id="h1-500587c21-0004">Controlling Your Arduino from the Web</h2>&#13;
			<p class="BodyFirst">You can control your Arduino from a web browser in several ways. After doing some research, I’ve found a method that is reliable, secure, and free: Teleduino.</p>&#13;
			<p>&#13;
				Teleduino is a free service created by New Zealand Arduino enthusiast Nathan Kennedy. It’s a simple yet powerful tool for interacting with an Arduino over the internet. It doesn’t require any special or customized Arduino sketches; instead, you simply enter a special URL into a web browser to control the Arduino. You can use Teleduino to control digital output pins and servos or to send I<sup>2</sup>C commands, and more features are being added all the time. In Project 62, you’ll learn how to configure Teleduino and remotely control digital outputs from a web-enabled device.</p>&#13;
			<h2 class="HeadProject" id="h1-500587c21-0005"><span>Project #62: Setting Up a Remote Control for Your Arduino</span></h2>&#13;
			<p class="BodyFirst">Before starting your first Teleduino project, you must register with the Teleduino service and obtain a unique key to identify your Arduino. To do so, visit <a class="LinkURL" href="https://www.teleduino.org/tools/request-key/">https://www.teleduino.org/tools/request-key/</a> and enter the required information. You should receive an email with your key, which will look something like this: <code>187654321Z9AEFF952ABCDEF8534B2BBF</code>.</p>&#13;
			<p>&#13;
				Next, convert your key into an array variable by visiting <a class="LinkURL" href="https://www.teleduino.org/tools/arduino-sketch-key/">https://www.teleduino.org/tools/arduino-sketch-key/</a>. Enter your key, and the page should return an array similar to that shown in <a href="#figure21-6" id="figureanchor21-6">Figure 21-6</a>.</p>&#13;
			<figure>&#13;
				<img alt="f21006" src="image_fi/500587c21/f21006.png"/>&#13;
				<figcaption>&#13;
					<p><a id="figure21-6">Figure 21-6</a>: A Teleduino key as an array</p>&#13;
				</figcaption>&#13;
			</figure>&#13;
			<p><span epub:type="pagebreak" id="Page_376" title="376"/>Each key is unique to a single Arduino, but you can get more keys if you want to run more than one Teleduino project at a time.</p>&#13;
			<h3 id="h2-500587c21-0007">The Hardware</h3>&#13;
			<p class="BodyFirst">Here’s what you’ll need to create this project:</p>&#13;
			<ul>&#13;
				<li>One USB cable</li>&#13;
				<li>One network cable</li>&#13;
				<li>One Arduino Uno and Ethernet shield, or one Arduino Uno–compatible board with integrated Ethernet</li>&#13;
				<li>One 560 Ω resistor (R1)</li>&#13;
				<li>One breadboard</li>&#13;
				<li>One LED of any color</li>&#13;
			</ul>&#13;
			<p>&#13;
				Assemble your hardware and connect an LED to digital pin 8, as shown in <a href="#figure21-7" id="figureanchor21-7">Figure 21-7</a>.</p>&#13;
			<figure>&#13;
				<img alt="f21007" src="image_fi/500587c21/f21007.png"/>&#13;
				<figcaption>&#13;
					<p><a id="figure21-7">Figure 21-7</a>: Schematic for Project 62</p>&#13;
				</figcaption>&#13;
			</figure>&#13;
			<h3 id="h2-500587c21-0008"><span epub:type="pagebreak" id="Page_377" title="377"/>The Sketch</h3>&#13;
			<p class="BodyFirst">Projects in Teleduino use only one sketch, which is included with the Teleduino library. Here’s how to access the sketch:</p>&#13;
			<ol class="decimal">&#13;
				<li value="1">Download and install the Teleduino library from <a class="LinkURL" href="https://www.teleduino.org/downloads/">https://www.teleduino.org/downloads/</a>.</li>&#13;
				<li value="2">Restart the Arduino IDE and select <b>File</b><span class="MenuArrow">▶</span><b>Examples</b><span class="MenuArrow">▶</span><b>Teleduino328</b><span class="MenuArrow">▶</span><b>TeleduinoEthernetClientProxy</b>.</li>&#13;
				<li value="3">You should now see the Teleduino sketch. Before uploading it to your Arduino, replace the default key with your key array. The variable you need to replace should be on line 36 of the sketch. Once you’ve replaced it, save the sketch, and then upload it to your Arduino.</li>&#13;
			</ol>&#13;
			<p>&#13;
				Now connect your hardware to the network and watch the LED. After a minute or so, it should blink a few times and then rest. The number of blinks represents the status of the Teleduino service, as shown in <a href="#table21-1" id="tableanchor21-1">Table 21-1</a>.</p>&#13;
			<figure>&#13;
				<figcaption class="TableTitle">&#13;
					<p><a id="table21-1">Table 21-1</a>: Teleduino Status Blink Codes</p>&#13;
				</figcaption>&#13;
				<table border="1" id="table-500587c21-0001">&#13;
					<thead>&#13;
						<tr>&#13;
							<td><b>Number of blinks</b></td>&#13;
							<td><b>Message</b></td>&#13;
						</tr>&#13;
					</thead>&#13;
					<tbody>&#13;
						<tr>&#13;
							<td>1</td>&#13;
							<td>Initializing</td>&#13;
						</tr>&#13;
						<tr>&#13;
							<td>2</td>&#13;
							<td>Starting network connection</td>&#13;
						</tr>&#13;
						<tr>&#13;
							<td>3</td>&#13;
							<td>Connecting to the Teleduino server</td>&#13;
						</tr>&#13;
						<tr>&#13;
							<td>4</td>&#13;
							<td>Authentication successful</td>&#13;
						</tr>&#13;
						<tr>&#13;
							<td>5</td>&#13;
							<td>Session already exists</td>&#13;
						</tr>&#13;
						<tr>&#13;
							<td>6</td>&#13;
							<td>Invalid or unauthorized key</td>&#13;
						</tr>&#13;
						<tr>&#13;
							<td>10</td>&#13;
							<td>Connection dropped</td>&#13;
						</tr>&#13;
					</tbody>&#13;
				</table>&#13;
			</figure>&#13;
			<p>If you see five blinks, then another Arduino is already programmed with your key and connected to the Teleduino server. At 10 blinks, you should check your hardware and internet connections. Once the Arduino has connected, it should blink once every 5 seconds or so. Because the status LED is controlled by digital pin 8, you can’t use that pin for any other purpose while you’re using Teleduino.</p>&#13;
			<h3 id="h2-500587c21-0009">Controlling Your Arduino Remotely</h3>&#13;
			<p class="BodyFirst">To control your Teleduino remotely, you can use any device with a web browser. However, you first need to set the mode for each digital pin you wish to control. The command to control the Arduino is sent by entering a URL that you create:</p>&#13;
			<pre><code>http://us01.proxy.teleduino.org/api/1.0/328.php?k={<em>YOURKEY</em>}&amp;r=definePinMode&amp;pin=&lt;<em>X</em>&gt;&amp;mode=&lt;<em>Y</em>&gt;</code></pre>&#13;
			<p><span epub:type="pagebreak" id="Page_378" title="378"/>You’ll need to change three parameters in the URL. First, replace <code>{</code><var>YOURKEY</var><code>}</code> with the long alphanumeric key you received from the Teleduino site. Next, replace <code>&lt;</code><var>X</var><code>&gt;</code> with the digital pin number you want to control. Third, change the <code>&lt;</code><var>Y</var><code>&gt;</code> to <code>1</code> to set up the digital pin as an output.</p>&#13;
			<p>Now you can control the digital pin remotely. The command to do this is:</p>&#13;
			<pre><code>http://us01.proxy.teleduino.org/api/1.0/328.php?k={<em>YOURKEY</em>}&#13;
&amp;r=setDigitalOutput&amp;pin=&lt;<em>X</em>&gt;&amp;output=&lt;<em>S</em>&gt;</code></pre>&#13;
			<p>&#13;
				Again, you’ll need to change three parameters in the URL. First, replace <code>{</code><var>YOURKEY</var><code>}</code> with the long alphanumeric key you received from the Teleduino site. Next, replace <code>&lt;</code><var>X</var><code>&gt;</code> with the digital pin number you want to control. Third, change the <code>&lt;</code><var>S</var><code>&gt;</code> to <code>0</code> for low or <code>1</code> for high to alter the digital output. For example, to turn digital pin 7 to high, you would enter:</p>&#13;
			<pre><code>http://us01.proxy.teleduino.org/api/1.0/328.php?k={<var>YOURKEY</var>}&amp;r=setDigitalOutput&amp;pin=7&amp;output=1</code></pre>&#13;
			<p>After the command succeeds, you should see something like the following in your web browser:</p>&#13;
			<pre><code>{"status":200,"message":"OK","response"&#13;
{"result":0,"time":0.22814512252808,"values":[]}}</code></pre>&#13;
			<p>If the command fails, you should see an error message like this:</p>&#13;
			<pre><code>{"status":403,"message":"Key is offline or invalid.","response":[]}</code></pre>&#13;
			<p>You can send commands to change the digital pins to high or low by modifying the URL.</p>&#13;
			<p>&#13;
				If a digital pin is capable of pulse-width modulation (PWM), as described in <span class="xref" itemid="xref_target_Chapter 3">Chapter 3</span>, you can also control the PWM output from a pin using:</p>&#13;
			<pre><code>http://us01.proxy.teleduino.org/api/1.0/328.php?k={<var>YOURKEY</var>}&amp;r=setPwmOutput&amp;pin=&lt;<var>X</var>&gt;&amp;output=&lt;<var>Y</var>&gt;</code></pre>&#13;
			<p class="BodyContinued">where <code>&lt;</code><var>X</var><code>&gt;</code> is the digital output pin and <code>&lt;</code><var>Y</var><code>&gt;</code> is the PWM level, between 0 and 255.</p>&#13;
			<p>After you have created the URLs for your project, bookmark them in your browser or create a local web page with the required links as buttons. For example, you might have a URL bookmarked to set digital pin 7 to high and another bookmarked to set it back to low.</p>&#13;
			<p>&#13;
				In some situations, the status of your Arduino outputs could be critical. As a fail-safe in case your Arduino resets itself due to a power outage or other interruption, set the default state for the digital pins. With your project connected to the Teleduino service, visit <a class="LinkURL" href="https://www.teleduino.org/tools/manage-presets/">https://www.teleduino.org/tools/manage-presets/</a>. After entering your unique key, you should see a screen of options that allows you to select the mode and value for the digital pins, as shown in <a href="#figure21-8" id="figureanchor21-8">Figure 21-8</a>.</p>&#13;
				<span epub:type="pagebreak" id="Page_379" title="379"/>&#13;
				<figure>&#13;
				<img alt="f21008" src="image_fi/500587c21/f21008.png"/>&#13;
				<figcaption>&#13;
					<p><a id="figure21-8">Figure 21-8</a>: Default pin status setup page</p>&#13;
				</figcaption>&#13;
			</figure>&#13;
			<h2 id="h1-500587c21-0006">Looking Ahead</h2>&#13;
			<p class="BodyFirst">Along with easily monitoring your Arduino over the internet and having it send tweets on Twitter, you can control your Arduino projects over the internet without creating any complex sketches, having much networking knowledge, or incurring monthly expenses. This enables you to control the Arduino from almost anywhere and extend the reach of its ability to send data. The three projects in this chapter provide a framework that you can build upon to design your own remote control projects.</p>&#13;
			<p>The next chapter, which is the last one in the book, shows you how to make your Arduino send and receive commands over a cellular network connection.</p>&#13;
		</section>&#13;
	</body></html>