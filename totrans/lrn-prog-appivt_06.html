<html><head></head><body>
<h2 class="h2" id="ch06"><span epub:type="pagebreak" id="page_101"/><strong><span class="big">6</span><br/>TIC TAC TOE: USING LOOPS TO CREATE A GAME</strong></h2>
<div class="imagel"><img alt="Image" src="../images/common.jpg"/></div>
<p class="noindent">Programmers often write code that repeats a set of actions. For instance, they may want to display a password request each time a user enters the wrong password or search for the same phrase in thousands of files. To avoid copying and pasting the same lines of code over and over again, we use the repetition programming control structure or <em>loops</em>, which are code segments that repeat a task a specific number of times or until a certain condition is met. It’s easier to review and correct errors in a loop than multiple lines of repeated code.</p>
<h3 class="h3" id="ch00lev1sec40"><strong>USING LOOPS IN APP INVENTOR</strong></h3>
<p class="noindent">In App Inventor, you can control the flow of apps with three types of loops: a <code>for each number</code> loop that performs an action for each number in a given range, a <code>while</code> loop that repeats an action until a tested Boolean condition returns <code>false</code>, and a <code>for each item</code> loop that performs the same action on each item in a list. Next we’ll take a closer look at each of these.</p>
<h4 class="h4" id="ch00lev2sec38"><span epub:type="pagebreak" id="page_102"/><strong>THE FOR EACH NUMBER LOOP</strong></h4>
<p class="noindent">We often use a <code>for each number</code> loop to calculate a series of numbers. The following event handler shows how a <code>for each number</code> loop calculates the sum of certain numbers in a given range.</p>
<div class="image"><img alt="Image" src="../images/f0102-01.jpg"/></div>
<p class="indent">First, we initialize the global <code>sum</code> variable that holds the value to compute. Then we program the event handler to reset <code>sum</code> to <code>0</code> at each button click. This ensures that the app calculates the correct sum by erasing values from a previous click.</p>
<p class="indent">To create the <code>for each number</code> loop, we use a <em>counter variable</em> named <code>number</code> to count and control the number of times the app executes the code. Then we include a range of values, starting with the number in <code>from</code> and ending with the number in <code>to</code>. Inside the <code>by</code> socket, we insert a number that determines how much to increment the <code>number</code> variable between the loops. When you click the button, the app loops through and executes the blocks in the <code>for each</code> block’s <code>do</code> socket for each number in the range from 20 to 40, while increasing the value of <code>number</code> by 10 between each loop.</p>
<p class="indent">This means that, in the first loop, the code sets the value of the global <code>sum</code> variable to its current value (<code>0</code>) plus the value of the <code>number</code> variable (<code>20</code>), which equals <code>20</code>, and then increments the <code>number</code> variable to <code>30</code>. In the second loop, it sets <code>sum</code> to 20 + 30, or <code>50</code>, and then increments <code>number</code> to <code>40</code>. In the final loop, it sets <code>sum</code> to 50 + 40, or <code>90</code>, which is the sum we set out to compute. You can use this kind of code any time you want to compute the sum of numbers in a specific range incremented between each loop by a consistent number.</p>
<h4 class="h4" id="ch00lev2sec39"><strong>THE WHILE LOOP</strong></h4>
<p class="noindent">A <code>while</code> loop repeats an action until a Boolean condition evaluates to <code>false</code>. The following event handler uses a <code>while</code> loop that chooses three random winners from 30 raffle tickets.</p>
<div class="image"><img alt="Image" src="../images/f0102-02.jpg"/></div>
<p class="indent"><span epub:type="pagebreak" id="page_103"/>Before coding the event handler, we need to create an empty list variable named <code>raffleWinners</code> to hold the three randomly selected ticket numbers. We’ll use <code>raffleWinners</code> along with a relational operator (<code>&lt;</code>) to set the <code>while</code> loop’s <code>test</code> condition. Before each loop, we test whether the length of, or number of items in, the <code>raffleWinners</code> list is less than 3.</p>
<p class="indent">We test for this condition because we want to execute the code in the <code>do</code> socket only three times to pick the three random raffle winners. As long as the length of <code>raffleWinners</code> is less than 3, we execute the code in the <code>while</code> loop’s <code>do</code> socket. Once the length of <code>raffleWinners</code> reaches a value of <code>3</code>, the loop ends, and we immediately execute the blocks beneath the loop.</p>
<p class="indent">When you click the button, while the test condition is <code>true</code>, the blocks in the <code>do</code> socket loop through and add a random integer between 1 and 30 to the <code>raffleWinners</code> list variable.</p>
<p class="indent">This means that, in the first loop when the length of <code>raffleWinners</code> is <code>0</code>, the app adds one random number to <code>raffleWinners</code>, which then increases its length to <code>1</code>. In the second loop, since the length of <code>raffleWinners</code> is still less than 3, the app repeats this action, adding another random number to <code>raffleWinners</code>, which then increases its length to <code>2</code>. In the third loop, since the length of <code>raffleWinners</code> is still less than 3, the app adds another random number to <code>raffleWinners</code>, which then increases its length to <code>3</code>, after which the test condition fails and the loop ends.</p>
<p class="indent">After the loop, the app displays <code>raffleWinners</code>, the list of randomly selected raffle winning numbers, in a label.</p>
<h4 class="h4" id="ch00lev2sec40"><strong>THE FOR EACH ITEM LOOP</strong></h4>
<p class="noindent">We can use the <code>for each item</code> loop to repeat actions for each item in a list. Here is a <code>for each item</code> loop that we could add to “Beat the Bus” from <a href="ch05.xhtml#ch05">Chapter 5</a> so that users can provide their destination to all numbers in the list of phone numbers, instead of just one.</p>
<div class="image"><img alt="Image" src="../images/f0103-01.jpg"/></div>
<p class="indent">These blocks loop through the list of telephone numbers and text the location information to each number.</p>
<h3 class="h3" id="ch00lev1sec41"><span epub:type="pagebreak" id="page_104"/><strong>BUILDING THE “TIC TAC TOE” APP</strong></h3>
<p class="noindent">In this chapter, you’ll use two <code>for each item</code> loops and work more with the <code>Canvas</code> and <code>ImageSprite</code> components to create a “Tic Tac Toe” game app, where two players take turns touching empty squares on the <code>Canvas</code>. The first player who touches three empty squares in a row, either horizontally, vertically, or diagonally, wins the game. The app keeps track of the players’ turns and lets them reset the game to play again at any time.</p>
<p class="indent">Log in to App Inventor and create a project called <span class="codestrong">TicTacToe</span>.</p>
<h4 class="h4" id="ch00lev2sec41"><strong>DECOMPOSING “TIC TAC TOE”</strong></h4>
<p class="noindent">We can decompose the game activity into three steps:</p>
<ol>
<li><p class="noindent">When the app opens, display a nine-square Tic Tac Toe board and a reset button. Place an <code>ImageSprite</code> on top of each square on the board, which will display the X or O.</p></li>
<li><p class="noindent">When the first player touches an empty square on the board, display an X on that square. Then display a message that shows it’s the other player’s turn (O), and so on. When the last square gets filled, tell the players that the game is over!</p></li>
<li><p class="noindent">When a player hits the reset button, remove all Xs and Os from the board along with all notices, and the app is ready for a new game.</p></li>
</ol>
<p class="indent">You’ll need the following components:</p>
<ul>
<li><p class="noindent"><span class="codestrong">Button</span> for a player to click to reset the game board</p></li>
<li><p class="noindent"><span class="codestrong">Canvas</span> with a game board background for players to touch to play the game and on which to display X and O <code>ImageSprite</code>s</p></li>
<li><p class="noindent">Global variable (3) to store <code>ImageSprite</code>s and keep track of the current game player and number of plays</p></li>
<li><p class="noindent"><span class="codestrong">ImageSprite</span> (9) to display X and O graphics on empty game board squares touched by players</p></li>
<li><p class="noindent"><span class="codestrong">Label</span> to display game notices</p></li>
<li><p class="noindent">Local variable to store the value of the touched <code>ImageSprite</code></p></li>
</ul>
<h4 class="h4" id="ch00lev2sec42"><strong>LAYING OUT “TIC TAC TOE” IN THE DESIGNER</strong></h4>
<p class="noindent">Now let’s lay out the app in the Designer starting with <code>Screen1</code>. In the Properties pane for <code>Screen1</code>, set its <span class="codestrong">AlignHorizontal</span> property to <strong>Center: 3</strong> so that all components we place will sit in the middle of the screen toward the top.</p>
<p class="indent">Then, to keep the screen’s orientation from changing when the device rotates, set <span class="codestrong">ScreenOrientation</span> to <strong>Portrait</strong>. Finally, remove the checkmark under <span class="codestrong">TitleVisible</span> to keep the title of the screen from showing when the app runs on a device.</p>
<p class="indent"><span epub:type="pagebreak" id="page_105"/>Next, drag the other necessary components from their drawers in the Palette pane onto the Viewer pane and adjust their properties. Drag in the <code>Label</code> from the User Interface drawer that will show the player’s turns. In the Properties pane, make its font bold and italic by clicking the checkboxes under <span class="codestrong">FontBold</span> and <span class="codestrong">FontItalic</span>, and change the <span class="codestrong">FontSize</span> to <span class="codestrong">30</span>. Also, change the <strong>Width</strong> to <strong>Fill parent</strong>, remove the text under <strong>Text</strong>, set the <span class="codestrong">TextAlignment</span> to <strong>center: 1</strong>, and select <strong>Magenta</strong> as the <span class="codestrong">TextColor</span>.</p>
<p class="indent">To create the reset button, place a <span class="codestrong">Button</span> from the User Interface drawer under the <code>Label</code>. In the Properties pane, change the <code>Button</code>’s <span class="codestrong">BackgroundColor</span> also to <strong>Magenta</strong>, make its <span class="codestrong">FontBold</span>, and increase <span class="codestrong">FontSize</span> to <span class="codestrong">20</span>. Also, change the <strong>Width</strong> to <strong>Fill parent</strong>, and set the <strong>Text</strong> to <span class="codestrong">Reset Game</span> and <span class="codestrong">TextColor</span> to <strong>White</strong>.</p>
<p class="indent">Now drag in a <span class="codestrong">Canvas</span> from the Drawing and Animation drawer. Upload a background image of the Tic Tac Toe board by clicking the text box under <code>BackgroundImage</code> in the Properties pane and following the image upload instructions in “Uploading a Picture” on <a href="ch02.xhtml#page_27">page 27</a>. Also, set the <code>Canvas</code>’s <strong>Height</strong> and <strong>Width</strong> to 100 percent.</p>
<p class="indent">Drag onto the <code>Canvas</code> nine <span class="codestrong">ImageSprite</span>s that will show the Xs and Os when the players touch the screen. In the Properties pane, set the <span class="codestrong">X</span> and <span class="codestrong">Y</span> properties to <span class="codestrong">0</span> for those we want positioned in the three top and three left squares of the Tic Tac Toe board. We can do this now since we know that the 0 coordinate values for these five <code>ImageSprite</code>s won’t change no matter what size device a player uses. Set the 0 coordinates shown in <a href="ch06.xhtml#ch06tab1">Table 6-1</a> as you drag the <code>ImageSprite</code>s to the <code>Canvas</code>.</p>
<p class="tabcap" id="ch06tab1"><strong>Table 6-1:</strong> Initial <code>X</code> and <code>Y</code> Property Values for Top and Left <code>ImageSprite</code>s</p>
<table class="all">
<colgroup>
<col style="width:35%"/>
<col style="width:35%"/>
<col style="width:30%"/>
</colgroup>
<thead>
<tr>
<td class="table-h" style="vertical-align: top;"><p class="tab_th"><span class="codestrong">ImageSprite</span></p></td>
<td class="table-h" style="vertical-align: top;"><p class="tab_th"><strong>X property</strong></p></td>
<td class="table-h" style="vertical-align: top;"><p class="tab_th"><strong>Y property</strong></p></td>
</tr>
</thead>
<tbody>
<tr>
<td class="table-d" style="vertical-align: top;"><p class="taba"><code>ImageSprite1</code></p></td>
<td class="table-d" style="vertical-align: top;"><p class="taba"><code>0</code></p></td>
<td class="table-d" style="vertical-align: top;"><p class="taba"><code>0</code></p></td>
</tr>
<tr>
<td style="vertical-align: top;"><p class="taba"><code>ImageSprite2</code></p></td>
<td style="vertical-align: top;"><p class="taba"> </p></td>
<td style="vertical-align: top;"><p class="taba"><code>0</code></p></td>
</tr>
<tr>
<td class="table-d" style="vertical-align: top;"><p class="taba"><code>ImageSprite3</code></p></td>
<td class="table-d" style="vertical-align: top;"><p class="taba"> </p></td>
<td class="table-d" style="vertical-align: top;"><p class="taba"><code>0</code></p></td>
</tr>
<tr>
<td style="vertical-align: top;"><p class="taba"><code>ImageSprite4</code></p></td>
<td style="vertical-align: top;"><p class="taba"><code>0</code></p></td>
<td style="vertical-align: top;"><p class="taba"> </p></td>
</tr>
<tr>
<td class="table-da" style="vertical-align: top;"><p class="taba"><code>ImageSprite7</code></p></td>
<td class="table-da" style="vertical-align: top;"><p class="taba"><code>0</code></p></td>
<td class="table-da" style="vertical-align: top;"><p class="taba"> </p></td>
</tr>
</tbody>
</table>
<p class="indent">We won’t set the other coordinates now, since their positions will change depending on screen size. Instead, we’ll program the app to set them as a fraction of the <code>Canvas</code> size when the app opens.</p>
<p class="indent">Finally, upload the X and O images by clicking <strong>Upload File…</strong> in the Media pane and following the image upload instructions.</p>
<p class="indent">Now all components should show in the Viewer, except for <code>Label1</code>, which doesn’t contain any text to start. You also should see the list of all app components in the Components pane and the names of the uploaded images in the Media pane, and <code>Screen1</code> should look like <a href="ch06.xhtml#ch6fig1">Figure 6-1</a> (although, depending on where you dragged the <code>ImageSprite</code>s, they may not appear as neatly ordered).</p>
<div class="image" id="ch6fig1"><span epub:type="pagebreak" id="page_106"/><img alt="Image" src="../images/06fig01.jpg"/></div>
<p class="figcap"><em>Figure 6-1: The Viewer, Component, and Media panes after you’ve laid out “Tic Tac Toe”</em></p>
<p class="indent">Now you’re ready to program the app in the Blocks Editor.</p>
<h3 class="h3" id="ch00lev1sec42"><strong>PROGRAMMING “TIC TAC TOE”</strong></h3>
<p class="noindent">For “Tic Tac Toe,” we’ll program three event handlers. The first directs the app’s action when the screen initializes, and the others respond to the <code>Canvas TouchDown</code> and <code>Button Click</code> events. We’ll also create four variables to store important information, including a global list, and we’ll use several <code>if then</code> and two <code>for each item</code> loop blocks to direct the flow of the app’s action. Click the <strong>Blocks</strong> button to switch to the Blocks Editor, and let’s begin programming step 1.</p>
<h4 class="h4" id="ch00lev2sec43"><strong>STEP 1: SETTING UP THE TIC TAC TOE GAME BOARD</strong></h4>
<p class="noindent">When the screen opens, we want players to see the nine-square Tic Tac Toe board and the reset button that we placed and styled in the Designer. At the same time, we want the app to respond to the <code>Screen1 Initialize</code> event by setting the width and height of the <code>ImageSprite</code>s and positioning one on each <span epub:type="pagebreak" id="page_107"/>square of the game board. The <code>Screen1 Initialize</code> event handler programs the behind-the scenes action in step 1.</p>
<div class="image"><img alt="Image" src="../images/f0107-01.jpg"/></div>
<h5 class="h5" id="ch00lev3sec70"><strong>Creating the Global squares List Variable</strong></h5>
<p class="noindent">Before you code the event handler, you should create the global <code>squares</code> list variable to store the nine <code>ImageSprite</code>s that will display Xs and Os. Since the variable is global, we can use it in all event handlers to refer to the nine <code>ImageSprite</code>s. The following blocks declare and initialize the variable.</p>
<div class="image"><img alt="Image" src="../images/f0107-02.jpg"/></div>
<p class="indent">To place the blocks, click the <strong>Variables</strong> block drawer and drag an <span class="codestrong">initialize global name</span> block <span class="ent">➊</span> to the Viewer, click <span class="codestrong">name</span>, and replace it with <span class="codestrong">squares</span>. Then drag a <span class="codestrong">make a list</span> block <span class="ent">➋</span> from the Lists drawer, snap it to <span epub:type="pagebreak" id="page_108"/>the right side of the <span class="codestrong">initialize global squares</span> block, and provide a socket for each of the nine <code>ImageSprite</code>s by adding seven more sockets to the <span class="codestrong">make a list</span> block’s two default inputs. To add the seven sockets, click the blue mutator icon to the left of the words <code>make a list</code>, and drag the additional item blocks to the <span class="codestrong">list</span> block in the dialog that opens.</p>
<p class="indent">Then, in the Blocks pane, click each <span class="codestrong">ImageSprite</span> in order from 1 to 9, and drag its <span class="codestrong">ImageSprite</span> getter block <span class="ent">➌</span> into its socket in the <span class="codestrong">make a list</span> block. We’ve now set the list items in <code>squares</code> to the nine <code>ImageSprite</code>s.</p>
<h5 class="h5" id="ch00lev3sec71"><strong>Looping Through ImageSprites in the squares List</strong></h5>
<p class="noindent">Now that you have the <code>squares</code> list, start the event handler by clicking <span class="codestrong">Screen1</span> in the Blocks pane and dragging the <code>whenScreen1.Initialize</code> block to the Viewer. Then add a <code>for each item</code> block that loops through the list of <code>ImageSprite</code>s and sets their width and height to match those of the game board squares.</p>
<p class="indent">Because the list contains a series of components, you’ll use the generic Any component blocks to access and manipulate the properties of all <code>ImageSprite</code>s in the loop without needing to specifically name each <code>ImageSprite</code>. You can find Any component blocks in the Blocks Editor window beneath the component-specific blocks in the Blocks pane, as shown in <a href="ch06.xhtml#ch6fig2">Figure 6-2</a>.</p>
<div class="image" id="ch6fig2"><img alt="Image" src="../images/06fig02.jpg"/></div>
<p class="figcap"><em>Figure 6-2: The “Tic Tac Toe” app’s Any component blocks</em></p>
<p class="indent">Any app you create in App Inventor will include Any component blocks for each component added.</p>
<h5 class="h5" id="ch00lev3sec72"><strong>Setting the Width and Height of Each ImageSprite in the squares List</strong></h5>
<p class="noindent">By setting the <code>Canvas</code> height and width to 100 percent of the screen size in the Designer earlier, we made sure both the <code>Canvas</code> and the squares in the <code>Canvas</code>’s game board background image will change proportionately whenever the device’s size changes. Likewise, by setting the width and height to a fraction of the <code>Canvas</code> size in the <code>for each item</code> loop, we make sure that the width and height of each <code>ImageSprite</code> will change proportionately with the size of the game board.</p>
<div class="image"><img alt="Image" src="../images/f0108-01.jpg"/></div>
<p class="indent">To place the loop, drag a <span class="codestrong">for each item</span> block <span class="ent">➊</span> from the Control blocks drawer to the Viewer and snap it inside the <span class="codestrong">whenScreen1.Initialize</span> block next to the word <code>do</code>. On the <code>for each item</code> block, you’ll notice the counter variable <code>item</code>, which represents each item in the list. Click the word <span class="codestrong">item</span> and enter a more meaningful name, <span class="codestrong">sprite</span>.</p>
<p class="indent"><span epub:type="pagebreak" id="page_109"/>Then click the <strong>Variables</strong> blocks drawer, drag in a <span class="codestrong">get global squares</span> block <span class="ent">➋</span>, and snap it to the right side of the <span class="codestrong">for each sprite</span> block next to the word <code>list</code>. So far, for each sprite in the global <code>squares</code> list variable, these blocks will cause the app to perform some action. Now let’s have the app set the width and height for each sprite.</p>
<p class="indent">To set the <code>ImageSprite</code>s’ width to one-third the <code>Canvas</code> width, click the plus sign to the left of <strong>Any component</strong> in the Blocks pane, click the <strong>Any ImageSprite</strong> drawer, and drag a <span class="codestrong">setImageSprite.Width</span> block <span class="ent">➌</span> inside the <span class="codestrong">for each sprite</span> block next to the word <code>do</code>. This generic setter block requires us to identify the <code>ImageSprite</code> we’re changing before providing the size we’re changing it to. To identify these values, fill its <code>of component</code> socket by mousing over the <span class="codestrong">sprite</span> counter variable and dragging in a <span class="codestrong">get sprite</span> block <span class="ent">➍</span>. Fill its <code>to</code> socket with a multiplication operator block <span class="ent">➎</span> filled on the left with a <span class="codestrong">Canvas1.Width</span> block <span class="ent">➏</span> from the Canvas1 drawer and on the right with a <span class="codestrong">0.333</span> number block <span class="ent">➐</span>.</p>
<p class="indent">To set the height of each sprite to one-fourth the <code>Canvas</code> height, make a copy of the <span class="codestrong">setImageSprite.Width</span> blocks and snap the duplicate blocks inside the <span class="codestrong">for each sprite</span> block under the <span class="codestrong">setImageSprite.Width</span> block. In the duplicate blocks, click the drop-down arrows in both the <span class="codestrong">setImageSprite.Width</span> block <span class="ent">➑</span> and the <span class="codestrong">Canvas1.Width</span> block <span class="ent">➒</span> and select <span class="codestrong">Height</span>. Replace <code>0.333</code> in the number block with <span class="codestrong">0.25</span> <span class="ent">➓</span>.</p>
<h5 class="h5" id="ch00lev3sec73"><strong>Positioning ImageSprites on the Canvas</strong></h5>
<p class="noindent">Finally, we need to place each <code>ImageSprite</code> on the game board so that it lines up with the top-left point of its corresponding square, as shown in <a href="ch06.xhtml#ch6fig3">Figure 6-3</a>.</p>
<div class="image" id="ch6fig3"><img alt="Image" src="../images/06fig03.jpg"/></div>
<p class="figcap"><em>Figure 6-3: Tic Tac Toe’s <span class="codeitalic">Canvas</span> background image with labeled squares, columns, and rows</em></p>
<p class="indent">We want the x- and y-coordinates of <code>ImageSprite1</code> to be the top-left corner of square 1 (which is where <code>X</code> = 0 and <code>Y</code> = 0), the x- and y-coordinates of <code>ImageSprite2</code> to be the top-left corner of square 2, and so on.</p>
<p class="indent">In the Designer, we already set the <code>X</code> property of <code>ImageSprite1</code>, <code>ImageSprite4</code>, and <code>ImageSprite7</code> to <code>0</code>, because we want them in the left column of the <code>Canvas</code> over squares 1, 4, and 7. We also set the <code>Y</code> property of <code>ImageSprite1</code>, <code>ImageSprite2</code>, and <code>ImageSprite3</code> to <code>0</code>, because we want them at the top row of the <code>Canvas</code> covering squares, 1, 2, and 3.</p>
<p class="indent">The following blocks set the <code>ImageSprite</code>s’ remaining x- and y-coordinates.</p>
<div class="image"><span epub:type="pagebreak" id="page_110"/><img alt="Image" src="../images/f0110-01.jpg"/></div>
<p class="indent">First, set the x-coordinate of <code>ImageSprite2</code> to the farthest point at the left of square 2 on the game board in <a href="ch06.xhtml#ch6fig3">Figure 6-3</a>, which is the <code>Canvas</code> width multiplied by 0.333. Place the <span class="codestrong">setImageSprite2.Xto</span> block <span class="ent">➊</span> inside the <span class="codestrong">whenScreen1.Initialize</span> block under the <span class="codestrong">for each</span> block. Then attach a multiplication operator block to the <span class="codestrong">setImageSprite2.Xto</span> block <span class="ent">➋</span>, and fill it with a <span class="codestrong">Canvas1.Width</span> block <span class="ent">➌</span> and a <span class="codestrong">0.333</span> number block <span class="ent">➍</span>. Now make 11 duplicates of the <span class="codestrong">setImageSprite2.Xto</span> block and make the changes shown in the code.</p>
<p class="indent">These duplicate blocks set the x-coordinates of <code>ImageSprite5</code> and <code>ImageSprite8</code> to the <code>Canvas</code> width multiplied by 0.333, which is the farthest point at the left of the Tic Tac Toe board’s center column on the board in <a href="ch06.xhtml#ch6fig3">Figure 6-3</a>, and the x-coordinates of <code>ImageSprite3</code>, <code>ImageSprite6</code>, and <code>ImageSprite9</code> to the <code>Canvas</code> width multiplied by 0.666, which is the farthest point at the left of the Tic Tac Toe board’s right column on the board in <a href="ch06.xhtml#ch6fig3">Figure 6-3</a>.</p>
<p class="indent">They also set the y-coordinates of <code>ImageSprite4</code>, <code>ImageSprite5</code>, and <code>ImageSprite6</code> to the <code>Canvas</code> height multiplied by 0.25, which is the very top point of the Tic Tac Toe board’s middle row on the board in <a href="ch06.xhtml#ch6fig3">Figure 6-3</a>, and the y-coordinates of <code>ImageSprite7</code>, <code>ImageSprite8</code>, and <code>ImageSprite9</code> to the <code>Canvas</code> height multiplied by 0.5, which is the very top point of the Tic Tac Toe board’s bottom row on the board in <a href="ch06.xhtml#ch6fig3">Figure 6-3</a>.</p>
<p class="indent">Now, with all of our step 1 blocks, we’ve programmed the app to respond to the <code>Screen1 Initialize</code> event by placing on each Tic Tac Toe board square an <code>ImageSprite</code> that shows no image, has the same width and height as the square, and is positioned with its top-left point at the top-left point of the square.</p>
<p class="indent">Let’s live-test now with a device, as outlined in “Live-Testing Your Apps” on <a href="intro.xhtml#page_xxii">page xxii</a>. Click <strong>Connect</strong> <span class="ent">▸</span> <strong>AI Companion</strong> in the top menu bar and scan the QR code with your device’s AI2 Companion app. Your “Tic Tac Toe” app should open on your device, and you should see the game board and the reset button.</p>
<p class="indent">The app should have the invisible <code>ImageSprite</code>s on the <code>Canvas</code>, and you should see their width, height, and position after we program the <code>Canvas</code> <span epub:type="pagebreak" id="page_111"/><code>TouchDown</code> event handler in step 2. Leave the app open on your device to keep live-testing.</p>
<h4 class="h4" id="ch00lev2sec44"><strong>STEP 2: RESPONDING TO PLAYER MOVES</strong></h4>
<p class="noindent">In step 2, we’ll program the app to respond each time a player touches an empty square on the <code>Canvas</code> Tic Tac Toe game board. That’s when we want the app to perform several actions:</p>
<ol>
<li><p class="noindent">Determine which <code>ImageSprite</code> the player touched using the x- and y-coordinates of the place touched and a series of nested conditionals.</p></li>
<li><p class="noindent">Determine whether player X or O touched the <code>Canvas</code> using the data stored in a global variable called <code>player</code>.</p></li>
<li><p class="noindent">Display a corresponding X or O graphic in the touched <code>ImageSprite</code>.</p></li>
<li><p class="noindent">Change the value of <code>player</code> to the opposite player.</p></li>
<li><p class="noindent">Keep track of the number of plays in a global variable called <code>play</code>. (There’s a total of nine possible plays in Tic Tac Toe.)</p></li>
<li><p class="noindent">Display a notice indicating who plays next, until the value of <code>play</code> equals <code>9</code>, when the notice should then read, “Game’s over!”</p></li>
</ol>
<p class="indent">We’ll start the code for step 2 by creating the two global variables: <code>player</code> and <code>play</code>.</p>
<h5 class="h5" id="ch00lev3sec74"><strong>Creating Global Variables</strong></h5>
<p class="noindent">The first global variable, <code>player</code>, stores the value of the current player, either X or O. The second global variable, <code>play</code>, keeps track of the number of plays made in the game. Since both <code>player</code> and <code>play</code> are global, we can use them throughout the code in all event handlers. The following blocks initialize the <code>player</code> and <code>play</code> variables.</p>
<div class="image"><img alt="Image" src="../images/f0111-01.jpg"/></div>
<p class="indent">To create each variable, click the <strong>Variables</strong> block drawer and drag an <span class="codestrong">initialize global name</span> block <span class="ent">➊</span> to the Viewer, click <span class="codestrong">name</span>, and replace it with the variable name. Then, for <code>player</code>, since it will hold string data, drag an empty string block <span class="ent">➋</span> from the Text drawer, snap it to the right side of the <span class="codestrong">initialize global player</span> block, and give it the initial value for the first player, player X, by entering <span class="codestrong">X</span> in the empty string block.</p>
<p class="indent">Initialize <code>play</code>, which will hold numeric data representing the number of plays in the game, to the value of <code>0</code> by dragging a <span class="codestrong">0</span> number block <span class="ent">➌</span> from the Math drawer and snapping it to the right side of the <span class="codestrong">initialize global play</span> block.</p>
<h5 class="h5" id="ch00lev3sec75"><strong>Handling the Canvas TouchDown Event</strong></h5>
<p class="noindent">Now that we’ve created <code>player</code> and <code>play</code>, we have the data we’ll need for the step 2 <code>Canvas TouchDown</code> event handler.</p>
<div class="image"><span epub:type="pagebreak" id="page_112"/><img alt="Image" src="../images/f0112-01.jpg"/></div>
<p class="indent">When a player touches down on an empty square on the <code>Canvas</code> game board, we need the app to place the X image on the touched spot if player X touched it, and the O image if player O touched it. To do this, the app first needs to know which square on the board and corresponding <code>ImageSprite</code> <span epub:type="pagebreak" id="page_113"/>the player touched. Fortunately, the <code>Canvas TouchDown</code> event handler includes two event parameters, <code>x</code> and <code>y</code>, that hold the x- and y-coordinates of the place touched. The app will use these coordinates to determine the game board square and <code>ImageSprite</code> touched.</p>
<p class="indent">We start by using the <code>x</code> and <code>y</code> event parameters to set the value of a local variable called <code>touchedSprite</code> to the <code>ImageSprite</code> that was touched. We do this by first testing a series of conditions to determine whether the player touched a square and its corresponding <code>ImageSprite</code> in the left column of the game board. If the player didn’t touch the left column, we test whether the player touched the center column, and then, if necessary, the right column.</p>
<p class="indent">Once we know the value of <code>touchedSprite</code>—the <code>ImageSprite</code> that the player touched—then the app can determine whether that <code>ImageSprite</code> is already displaying an image, and, if not, display either the X or O image, depending on which player touched the board.</p>
<h5 class="h5" id="ch00lev3sec76"><strong>Creating the Local touchedSprite Variable</strong></h5>
<p class="noindent">The following blocks from the <code>Canvas TouchDown</code> event handler determine which <code>ImageSprite</code> the player touched and then set it as the value of <code>touchedSprite</code>.</p>
<div class="image"><img alt="Image" src="../images/f0113-01.jpg"/></div>
<p class="indent"><span epub:type="pagebreak" id="page_114"/>First, click <span class="codestrong">Canvas1</span> in the Blocks pane and drag its <span class="codestrong">whenCanvas1.TouchDown</span> event handler block <span class="ent">➊</span> to the Viewer. Then, create the local variable <code>touchedSprite</code> by clicking the <strong>Variables</strong> blocks drawer, dragging the first <span class="codestrong">initialize local name to in</span> block inside the <span class="codestrong">whenCanvas1.TouchDown block</span> <span class="ent">➋</span> next to the word <code>do</code>, and changing <span class="codestrong">name</span> to <span class="codestrong">touchedSprite</span>.</p>
<p class="indent">This block sets the initial value of the local variable <code>touchedSprite</code> to the value of the blocks we snap into the <code>to</code> socket. Since <code>touchedSprite</code>’s scope is local, we can use it only in this <code>TouchDown</code> event handler in the blocks we snap next to the word <code>in</code> later in this step.</p>
<h5 class="h5" id="ch00lev3sec77"><strong>Testing Whether touchedSprite Is in the Left Column of the Game Board</strong></h5>
<p class="noindent">Now we’ll add the blocks that set the value for <code>touchedSprite</code>, which is the <code>ImageSprite</code> that displays on top of the square a player has touched. To figure out which spot on the board was touched, the app first tests whether the spot is located in the left column of the board in <a href="ch06.xhtml#ch6fig3">Figure 6-3</a>, which would mean the <code>x</code> parameter is less than or equal to the <code>Canvas</code> width multiplied by 0.33.</p>
<div class="image"><img alt="Image" src="../images/f0114-01.jpg"/></div>
<p class="indent">To place the blocks, click the <strong>Control</strong> blocks drawer and place an <span class="codestrong">if then else</span> block <span class="ent">➊</span> in the <span class="codestrong">initialize local touchedSprite to in</span> block’s <span class="codestrong">to</span> socket.</p>
<p class="indent">Fill the <span class="codestrong">if then else</span> block’s <span class="codestrong">if</span> socket with a <code>≤</code> comparison operator block <span class="ent">➋</span> from the Math drawer. Fill the <code>≤</code> operator block’s first socket by mousing over the <span class="codestrong">whenCanvas1.TouchDown</span> block’s <span class="codestrong">x</span> parameter and dragging in the <span class="codestrong">get x</span> block <span class="ent">➌</span>. Fill the <code>≤</code> operator block’s second socket with a multiplication operator block <span class="ent">➍</span>. Now fill the multiplication block by clicking <span class="codestrong">Canvas1</span> in the Blocks pane and dragging its <span class="codestrong">Canvas1.Width</span> block <span class="ent">➎</span> into the left operand socket and snapping a <span class="codestrong">0.33</span> number block <span class="ent">➏</span> into the right operand socket.</p>
<p class="indent">These blocks check whether the sprite the player touched is in the game board’s left column, or <code>ImageSprite1</code>, <code>ImageSprite4</code>, or <code>ImageSprite7</code>.</p>
<h5 class="h5" id="ch00lev3sec78"><strong>Testing Whether touchedSprite Is in the Top Row of the Left Column</strong></h5>
<p class="noindent">If the first condition is true, we want the app to test the second condition, which is whether the <code>y</code> parameter of the touched spot is less than or equal to the <code>Canvas1</code> height multiplied by 0.25, or located in the top row of the game board. The following blocks test this second condition.</p>
<div class="image"><img alt="Image" src="../images/f0114-02.jpg"/></div>
<p class="indent">Click the <strong>Control</strong> blocks drawer, drag in the second <span class="codestrong">if then else</span> block <span class="ent">➊</span>, and snap it to the right of the first <span class="codestrong">if then else</span> block next to the word <code>then</code>.</p>
<p class="indent">Next, fill the second <span class="codestrong">if then else</span> block’s <span class="codestrong">if</span> socket with a <code>≤</code> operator block <span class="ent">➋</span>. Then fill the <code>≤</code> operator block’s first socket by mousing over the <span class="codestrong">whenCanvas1.TouchDown</span> block’s <span class="codestrong">y</span> parameter and dragging in the <span class="codestrong">get y</span> block <span class="ent">➌</span>, <span epub:type="pagebreak" id="page_115"/>and fill its second socket with a multiplication operator block <span class="ent">➍</span>. Fill the multiplication block by dragging the <span class="codestrong">Canvas1.Height</span> block <span class="ent">➎</span> into the left socket and a <span class="codestrong">0.25</span> number block <span class="ent">➏</span> into the right socket. Finally, fill the second <span class="codestrong">if then else</span> block’s <span class="codestrong">then</span> socket by clicking <span class="codestrong">ImageSprite1</span> in the Blocks pane and dragging in its <span class="codestrong">ImageSprite1</span> getter block <span class="ent">➐</span>.</p>
<p class="indent">Since we already know the player touched <code>ImageSprite1</code>, <code>ImageSprite4</code>, or <code>ImageSprite7</code>, we test whether the touched sprite is in the top row of the game board as shown in <a href="ch06.xhtml#ch6fig3">Figure 6-3</a>. If so, then we know that <code>touchedSprite</code> is <code>ImageSprite1</code> because it’s the only <code>ImageSprite</code> that meets both the first and second test conditions.</p>
<h5 class="h5" id="ch00lev3sec79"><strong>Testing Whether touchedSprite Is in the Middle Row of the Left Column</strong></h5>
<p class="noindent">If the <code>touchedSprite</code> is in the left column of the game board but not in the top row, then the second condition would fail. In that case, we use the <code>if then else</code> block’s <code>else</code> socket to test whether the sprite is in the middle row of the game board.</p>
<div class="image"><img alt="Image" src="../images/f0115-01.jpg"/></div>
<p class="indent">Place another <span class="codestrong">if then else</span> block <span class="ent">➊</span> inside the second <span class="codestrong">if then else</span> block next to the word <code>else</code>. Next, fill the third <span class="codestrong">if then else</span> block’s <span class="codestrong">if</span> socket with an <span class="codestrong">and</span> logic operator block <span class="ent">➋</span> from the Logic drawer. The <code>and</code> logic block requires that both of its operands evaluate to <code>true</code> in order for the tested condition to be true.</p>
<p class="indent">The first <code>and</code> operand determines whether the y-coordinate of the touched spot is greater than the <code>Canvas1</code> height multiplied by 0.25. Fill the <span class="codestrong">and</span> logic block’s first socket with a <span class="codestrong">&gt;</span> operator block <span class="ent">➌</span>, and fill the first socket of the <span class="codestrong">&gt;</span> operator block with the <span class="codestrong">get y</span> block <span class="ent">➍</span> and the second socket with a <span class="codestrong">×</span> operator block <span class="ent">➎</span> that multiplies <code>Canvas1.Height</code> <span class="ent">➏</span> on the left by <code>0.25</code> <span class="ent">➐</span> on the right.</p>
<p class="indent">Now add the second <code>and</code> operand, which determines whether the y-coordinate of the touched spot is less than or equal to the <span class="codestrong">Canvas1</span> height multiplied by 0.5. Fill the <span class="codestrong">and</span> logic block’s second socket by snapping a copy of the blocks in its first socket, clicking the drop-down arrow next to the <span class="codestrong">&gt;</span> operator to change it to a <code>≤</code> operator block <span class="ent">➑</span>, and changing the <span class="codestrong">0.25</span> number block to <span class="codestrong">0.5</span> <span class="ent">➒</span>.</p>
<p class="indent">Finally, add the blocks that tell the app the result if both of those conditions are true, which means that the <code>touchedSprite</code> is <code>ImageSprite4</code>. If either condition is not true, it means that <code>touchedSprite</code> is <code>ImageSprite7</code>. Fill the third <span class="codestrong">if then else</span> block’s <span class="codestrong">then</span> socket by clicking <span class="codestrong">ImageSprite4</span> in the Blocks pane and dragging in its <span class="codestrong">ImageSprite4</span> getter block <span class="ent">➓</span> and its <span class="codestrong">else</span> socket by dragging in the <span class="codestrong">ImageSprite7</span> getter block.</p>
<p class="indent"><span epub:type="pagebreak" id="page_116"/>Now, if <code>touchedSprite</code> meets the first condition by being in the left column of the game board but fails the second condition because it’s not in the top row, the blocks test the third condition—whether the touched sprite is in the middle row of the game board. If so, then we know <code>touchedSprite</code> is <code>ImageSprite4</code>, because it’s the only <code>ImageSprite</code> that meets both the first and third conditions by being in both the left column and the middle row of the game board.</p>
<p class="indent">But if the third condition is not true, or the touched sprite is not in the middle row of the game board, then we know that <code>touchedSprite</code> must be <code>ImageSprite7</code>, because it’s the only remaining <code>ImageSprite</code> that meets the first condition—being located in the left column.</p>
<p class="indent">The rest of the blocks in the <code>to</code> socket of the <code>initalize local touchedSprite</code> block fill the <code>else</code> socket of the first <code>if then else</code> block and tell the app what to do if the touched sprite isn’t in the left column of the game board. In that case, we test whether the touched sprite is in the center column of the game board and, if not, then test whether it’s in the right column of the board.</p>
<p class="indent">To create the blocks to test whether the touched sprite is located in the center column, simply right-click the first <span class="codestrong">if then else</span> block and make a copy. Then snap the copy of the blocks into the first <span class="codestrong">if then else</span> block’s <span class="codestrong">else</span> socket, and make the few changes indicated in the following section.</p>
<h5 class="h5" id="ch00lev3sec80"><strong>Testing Whether touchedSprite Is in the Center Column of the Game Board</strong></h5>
<p class="noindent">To determine which <code>ImageSprite</code> is <code>touchedSprite</code>, the first three <code>if then else</code> blocks test whether the spot touched is in the left column of the board. Next, we need to handle cases where <code>touchedSprite</code> isn’t in the left column at all by testing whether the spot touched on the game board is located in the center column. This would mean that the <code>x</code> parameter of the touched spot is greater than the <code>Canvas</code> width multiplied by 0.33 and less than or equal to the <code>Canvas</code> width multiplied by 0.66, and that <code>touchedSprite</code> is either <code>ImageSprite2</code>, <code>ImageSprite5</code>, or <code>ImageSprite8</code>.</p>
<p class="indent">These three <code>if then else</code> blocks test whether the touched spot is in the center column of the game board.</p>
<div class="image"><img alt="Image" src="../images/f0116-01.jpg"/></div>
<p class="indent"><span epub:type="pagebreak" id="page_117"/>Make changes to the duplicate blocks that you snapped into the <code>whenCanvas1.TouchDown</code> event handler in the first <code>if then else</code> block’s <code>else</code> socket so they look exactly like those shown here.</p>
<p class="indent">These <code>if then else</code> blocks now represent the fourth condition we want the app to test—whether the touched sprite is in the center column of the game board—and tell the app what to do if the condition is met. If the touched sprite is in the game board’s center column (meaning it’s either <code>ImageSprite2</code>, <code>ImageSprite5</code>, or <code>ImageSprite8</code>), the blocks test the fifth condition, which is whether the touched sprite is in the top row of the game board. If this fifth condition is also true, then we know that <code>touchedSprite</code> is <code>ImageSprite2</code>.</p>
<p class="indent">But if the fifth condition is not true, the blocks test the sixth condition—whether the touched sprite is in the middle row of the game board. If so, then we know that <code>touchedSprite</code> is <code>ImageSprite5</code>, because it’s the only <code>ImageSprite</code> that meets both the fourth and sixth conditions, meaning it’s in both the center column and the middle row of the game board.</p>
<p class="indent">However, if the sixth condition is not true, meaning the touched sprite is not in the middle row of the game board, then <code>touchedSprite</code> has to be <code>ImageSprite8</code>, because it’s the only remaining <code>ImageSprite</code> that meets the fourth condition—being located in the center column.</p>
<h5 class="h5" id="ch00lev3sec81"><strong>Determining Whether touchedSprite Is in the Right Column of the Game Board</strong></h5>
<p class="noindent">So far, the first six <code>if then else</code> blocks test whether the spot touched on the game board is located in the left or center columns of the board. Now we need to add blocks to handle cases in which <code>touchedSprite</code> isn’t in the left or center column but in the right column instead.</p>
<p class="indent">To determine whether the player touched <code>ImageSprite3</code>, <code>ImageSprite6</code>, or <code>ImageSprite9</code>, add the following blocks.</p>
<div class="image"><img alt="Image" src="../images/f0117-01.jpg"/></div>
<p class="indent">To place the blocks, copy the last two <span class="codestrong">if then else</span> blocks, snap the copy into the <span class="codestrong">whenCanvas1.TouchDown</span> event handler in the fourth <span class="codestrong">if then else</span> block’s <span class="codestrong">else</span> socket, and make changes so the blocks are identical to those shown here.</p>
<p class="indent">These last two <code>if then else</code> blocks now pose the seventh condition we want to test: whether the touched sprite, which by default must be in the right column, is also in the top row of the game board. If it is, then <code>touchedSprite</code> is <code>ImageSprite3</code>.</p>
<p class="indent"><span epub:type="pagebreak" id="page_118"/>But if the seventh condition is not true, the blocks test the eighth condition—whether the touched sprite is in the middle row of the game board. If so, then <code>touchedSprite</code> is <code>ImageSprite6</code>. However, if the eighth condition is not true, meaning the touched sprite is not in the middle row of the game board, then <code>touchedSprite</code> is <code>ImageSprite9</code>, because it’s the only <code>ImageSprite</code> left.</p>
<p class="indent">Now that we’ve assigned a value to <code>touchedSprite</code> (the <code>ImageSprite</code> that was touched by the player), we’ll use that value in the remainder of the <code>whenCanvas1.TouchDown</code> event handler. If the player touched an empty square on the board, we’ll use the data stored in <code>player</code> to determine whether it was player X or O who touched the board, or played; display a corresponding X or O graphic in the touched <code>ImageSprite</code>; and then change the value of <code>player</code> to the opposite player.</p>
<p class="indent">Also, since there are a total of nine possible plays in Tic Tac Toe, we’ll keep track of the number of plays in the <code>play</code> variable and display a notice indicating who plays next if the value of <code>play</code> is less than 9 and a notice that the game’s over if <code>play</code> is 9 or greater. The following blocks from the <code>whenCanvas1.TouchDown</code> event handler program these actions.</p>
<div class="image"><img alt="Image" src="../images/f0118-01.jpg"/></div>
<h5 class="h5" id="ch00lev3sec82"><strong>Testing Whether the Player Touched an Empty Square on the Game Board</strong></h5>
<p class="noindent">Now we need to determine whether the player touched an empty square on the board. This would mean that the name of the touched <code>ImageSprite</code>’s <code>Picture</code> is an empty string. The following blocks test that condition and, if the answer is yes, add 1 to the value of the variable that keeps track of the number of game plays.</p>
<div class="image"><span epub:type="pagebreak" id="page_119"/><img alt="Image" src="../images/f0119-01.jpg"/></div>
<p class="indent">To add the blocks that test whether the name of the picture showing on <code>touchedSprite</code> is an empty string, drag an <span class="codestrong">if then</span> block <span class="ent">➊</span> from the Control drawer and snap it inside the <span class="codestrong">whenCanvas1.TouchDown</span> event handler next to the word <code>in</code> in the <span class="codestrong">initialize local touchedSprite to in</span> block. Then snap an <span class="codestrong">=</span> comparison operator block <span class="ent">➋</span> from the Logic drawer to the right of the word <code>if</code>.</p>
<p class="indent">Fill the first socket of the <code>=</code> block by clicking the <strong>Any ImageSprite</strong> drawer in the Blocks pane, dragging in an <span class="codestrong">ImageSprite.Picture</span> block <span class="ent">➌</span>, and filling its socket with a <span class="codestrong">get touchedSprite</span> block <span class="ent">➍</span> from the Variables drawer. Fill the <code>=</code> operator block’s second socket with an empty string block <span class="ent">➎</span> from the Text drawer.</p>
<p class="indent">If the player touched an empty square on the board, then we want the app to count the player’s touch as a true game play and increment the value of the variable <code>play</code> by 1. To increment <code>play</code> by 1 in the code, snap the <span class="codestrong">set global play</span> block <span class="ent">➏</span> from the Variables drawer to the right of the word <code>then</code> and an addition operator block <span class="ent">➐</span> next to the <span class="codestrong">set global play</span> block. Then fill the addition operator block on the left with the <span class="codestrong">get global play</span> block <span class="ent">➑</span> and on the right with a <span class="codestrong">1</span> number block <span class="ent">➒</span>.</p>
<h5 class="h5" id="ch00lev3sec83"><strong>Displaying the Correct Image on touchedSprite</strong></h5>
<p class="noindent">Next we’ll tell the app which image to display on <code>touchedSprite</code> based on the value of the <code>player</code> variable and then change the value of <code>player</code> to the opposite player.</p>
<div class="image"><img alt="Image" src="../images/f0119-02.jpg"/></div>
<p class="indent">First we’ll set up the test condition that determines if the value of the <code>player</code> variable equals <code>X</code>, which means that player X touched the <code>Canvas</code>. Place another <span class="codestrong">if then</span> block <span class="ent">➊</span> inside the <span class="codestrong">whenCanvas1.TouchDown</span> block under the <span class="codestrong">set global play</span> block. Click the <span class="codestrong">if then</span> block’s blue mutator icon to add an <span class="codestrong">else</span> input to the block. Then, snap an <span class="codestrong">=</span> operator block <span class="ent">➋</span> from the <span epub:type="pagebreak" id="page_120"/>Logic drawer into the <span class="codestrong">if</span> socket, and fill its left side with a <span class="codestrong">get global player</span> block <span class="ent">➌</span> and its right side with a string block <span class="ent">➍</span> containing the letter <code>X</code>.</p>
<p class="indent">If the answer to the test condition is yes and the <code>player</code> variable equals X, we display X on <code>touchedSprite</code> and then change the value of <code>player</code> to <code>O</code>. To do this, fill the <span class="codestrong">if then else</span> block’s <code>then</code> socket by clicking the <strong>Any ImageSprite</strong> drawer in the Blocks pane, dragging in a <span class="codestrong">setImageSprite.Picture</span> block <span class="ent">➎</span>, and filling its <code>of component</code> socket with a <span class="codestrong">get touched Sprite</span> block <span class="ent">➏</span> from the Variables drawer and its <code>to</code> socket with a string block <span class="ent">➐</span> from the Text drawer containing <em>PurpleX.png</em>, which is the name of the X graphic. Then, under the <span class="codestrong">setImageSprite.Picture</span> block, drag in a <span class="codestrong">set global player</span> block <span class="ent">➑</span> from the Variables drawer, and snap a string block <span class="ent">➒</span> from the Text drawer containing the letter <code>O</code> to the right of the word <code>to</code>.</p>
<p class="indent">If the answer to the test condition is no, meaning the <code>player</code> variable equals <code>O</code>, we display O on <code>touchedSprite</code> and change the value of <code>player</code> to <code>X</code>. Code this by copying the blocks we just placed in the <span class="codestrong">if then else</span> block’s <span class="codestrong">then</span> socket, snapping the copy into the <span class="codestrong">if then else</span> block’s <span class="codestrong">else</span> socket, and making two changes. Change the name of the graphic in the <span class="codestrong">setImageSprite.Picture</span> block’s bottom socket <span class="ent">➓</span> to <span class="codestrong">PinkO.png</span>. Then, change the <span class="codestrong">O</span> in the string block to the right of the <span class="codestrong">set global player</span> block to the letter <span class="codestrong">X</span>.</p>
<p class="indent">Altogether, the code tests whether the value of <code>player</code> is <code>X</code>, and, if so, direct the app to display the X graphic on <code>touchedSprite</code> and then change the value of <code>player</code> to <code>O</code>. If the value of <code>player</code> is not <code>X</code>, they tell the app to display the O graphic on <code>touchedSprite</code> and then change the value of <code>player</code> to <code>X</code>.</p>
<h5 class="h5" id="ch00lev3sec84"><strong>Displaying Information on the Game’s Label</strong></h5>
<p class="noindent">The next blocks use a conditional to determine what to display on the app’s <code>Label</code>, depending on the value of the variable <code>play</code>, which we’ve already programmed the app to increase each time a player touches an empty square on the board. If <code>play</code> is less than 9, then we want the <code>Label</code> to indicate who plays next. But, if <code>play</code> equals or exceeds 9, we want the <code>Label</code> to say the game is over.</p>
<div class="image"><img alt="Image" src="../images/f0120-01.jpg"/></div>
<p class="indent">To add the blocks, drag another <span class="codestrong">if then</span> block <span class="ent">➊</span> from the Control drawer and snap it inside the <span class="codestrong">whenCanvas1.TouchDown</span> block under the prior <span class="codestrong">if then else</span> block. Click the new <span class="codestrong">if then</span> block’s blue mutator icon to add an <span class="codestrong">else</span> input. Then, to test whether <code>play</code> is less than 9, snap a <span class="codestrong">&lt;</span> comparison operator block <span class="ent">➋</span> into the <span class="codestrong">if</span> socket and fill its left side with a <span class="codestrong">get global play</span> block <span class="ent">➌</span> from the Variables drawer and its right side with a <span class="codestrong">9</span> number block <span class="ent">➍</span></p>
<p class="indent">If the value of <code>play</code> is less than 9, the next blocks tell the app to indicate who plays next. Fill the <span class="codestrong">then</span> socket by clicking <span class="codestrong">Label1</span> in the Blocks pane, <span epub:type="pagebreak" id="page_121"/>dragging in its <span class="codestrong">setLabel1.Textto</span> block <span class="ent">➎</span>, and then snapping a <span class="codestrong">join</span> block <span class="ent">➏</span> from the Text drawer next to the word <code>to</code>. Fill the <span class="codestrong">join</span> block’s top socket with the <span class="codestrong">get global player</span> block <span class="ent">➐</span> from the Variables drawer and the bottom socket with a string block <span class="ent">➑</span> from the Text drawer containing <code>'s turn...</code> to indicate which player’s turn it is.</p>
<p class="indent">Finally, if <code>play</code> is not less than 9, the next blocks tell the app to say the game is over. Fill the <span class="codestrong">if then else</span> block’s <span class="codestrong">else</span> socket by dragging in another <span class="codestrong">setLabel1.Textto</span> block <span class="ent">➒</span> and snapping a string block <span class="ent">➓</span> from the Text drawer containing <code>Game's over!</code> next to the word <code>to</code>.</p>
<p class="indent">Altogether, these blocks test whether the value of <code>play</code>, which holds the number of times a player has played in the game, is less than 9. If so, they direct the app to use the value of <code>player</code> to indicate whose turn it is to play next. However, if the value of <code>play</code> is 9 or more, they tell the app to indicate that the game is over.</p>
<p class="indent">Let’s live-test now to see how the step 2 blocks work. As long as the blocks are placed correctly, once you open the app, you should see the game board and the reset button and be able to play the game.</p>
<p class="indent">When you touch an empty square, an X should appear in the square you touched, and the label above the reset button should display <code>O's turn</code>. Then, when the next empty square is touched, an O should appear in the touched square, and the label above the reset button should read <code>X's turn</code>, and so on, until the last empty square is touched and the label reads <code>Game's over!</code>. Since we haven’t yet programmed the reset button, nothing should happen when you click it. We’ll do that next.</p>
<h4 class="h4" id="ch00lev2sec45"><strong>STEP 3: PROGRAMMING THE RESET BUTTON</strong></h4>
<p class="noindent">Let’s now program step 3 of the app—coding the <code>Button1 Click</code> event handler. When a player hits the reset button, we want all X and O images on the game board and all text in the label to disappear, and we want to reset <code>player</code> and <code>play</code> to their original values. The <code>Button1 Click</code> event handler programs these actions.</p>
<div class="image"><img alt="Image" src="../images/f0121-01.jpg"/></div>
<h5 class="h5" id="ch00lev3sec85"><strong>Clearing the Game Board</strong></h5>
<p class="noindent">To make the X and O images disappear, we’ll use another <code>for each item</code> and Any ImageSprite blocks to make the app loop though each <code>ImageSprite</code> and set the name of its <code>Picture</code> to an empty string so that it will no longer display an image.</p>
<p class="indent"><span epub:type="pagebreak" id="page_122"/>Click <span class="codestrong">Button1</span> in the Blocks pane and drag its <span class="codestrong">whenButton1.Click</span> event handler block <span class="ent">➊</span> to the Viewer. Then drag in a <span class="codestrong">for each item</span> block <span class="ent">➋</span> from the Control drawer and snap it inside the <span class="codestrong">whenButton1.Click</span> block next to the word <code>do</code>, and then change <span class="codestrong">item</span> to <span class="codestrong">sprite</span>.</p>
<p class="indent">Next, drag a <span class="codestrong">get global squares</span> block <span class="ent">➌</span> from the Variables drawer and snap it to the right of the <span class="codestrong">for each sprite</span> block next to the word <code>list</code>. Then, next to the word <code>do</code>, drag in a <span class="codestrong">setImageSprite.Picture</span> block <span class="ent">➍</span> from the Any ImageSprite drawer, and fill its first socket by mousing over <span class="codestrong">sprite</span> in the <span class="codestrong">for each sprite</span> block and dragging in its <span class="codestrong">get sprite</span> block <span class="ent">➎</span> and its second socket by snapping in an empty string block <span class="ent">➏</span>. These blocks clear the game board of all Xs and Os when the player hits the button.</p>
<h5 class="h5" id="ch00lev3sec86"><strong>Resetting the Label and Global Variables</strong></h5>
<p class="noindent">Now let’s add the blocks that will restore <code>Label1</code> and the <code>player</code> and <code>play</code> variables to their original state.</p>
<div class="image"><img alt="Image" src="../images/f0122-01.jpg"/></div>
<p class="indent">Click <span class="codestrong">Label1</span> in the Blocks pane, drag its <span class="codestrong">setLabel1.Text</span> block <span class="ent">➊</span> in under the <span class="codestrong">for each</span> loop, and snap an empty string block <span class="ent">➋</span> into its socket. Then drag a <span class="codestrong">set global player</span> block <span class="ent">➌</span> from the Variables drawer, snap it under the <span class="codestrong">setLabel1.Text</span> block, and place another string block <span class="ent">➍</span> filled with an <code>X</code> into its socket. Finally, drag a <span class="codestrong">set global play</span> block <span class="ent">➎</span> from the Variables drawer, snap it under the <span class="codestrong">set global player</span> block, and place a <span class="codestrong">0</span> number block <span class="ent">➏</span> into its socket. These blocks make the <code>Label</code> text disappear and set <code>player</code> and <code>play</code> to their original <code>X</code> and <code>0</code> values.</p>
<p class="indent">Altogether, the blocks for step 3 direct the app to reset when a player hits Reset Game, just as we planned.</p>
<h3 class="h3" id="ch00lev1sec43"><strong>TESTING THE APP</strong></h3>
<p class="noindent">Now we can test the completed app! When you look at your device, you should still see the game board and the reset button and be able to play the game just as you did when you last tested. And now, when you hit the reset button, all the X and O graphics should disappear along with the label text.</p>
<p class="indent">Also, behind the scenes, the <code>player</code> and <code>play</code> variables should reset as well, which you can test by beginning to play the game again. When you touch a square, an X graphic should appear and you should be allowed to touch all nine empty squares before the label displays “Game’s over!”</p>
<p class="indent">If your reset button doesn’t work as planned, debug and try again. Also reset your connection to AI2 Companion if necessary by clicking <strong>Connect</strong> <span class="ent">▸</span> <strong>Reset Connection</strong> in the top menu bar and then clicking <strong>Connect</strong> <span class="ent">▸</span> <strong>AI Companion</strong> and scanning the QR code. If you placed your blocks correctly, the app should work as expected, and you’ve successfully created the “Tic Tac Toe” game app!</p>
<h3 class="h3" id="ch00lev1sec44"><span epub:type="pagebreak" id="page_123"/><strong>SUMMARY</strong></h3>
<p class="noindent">In this chapter, you built the “Tic Tac Toe” app, which uses the App Inventor <code>Canvas</code> and <code>ImageSprite</code> components to create a Tic Tac Toe game for two players. As you built the app, you learned how to create a list of components, access the components’ properties using Any component blocks, and iterate through the list with <code>for each</code> loops to set up and help control the flow of the game. You worked more extensively with <code>if then</code> and logical and comparison operator blocks to control app flow as well.</p>
<p class="indent">In the next chapter, you’ll learn how to make your code reusable by writing <em>procedures</em>—called <em>methods</em> and <em>functions</em> in some programming environments—using the Procedures blocks. You’ll create and call procedures in your code for the “Multiplication Station II” app, which will allow users to choose from one of two difficulty levels of timed multiplication problems.</p>
<h3 class="h3" id="ch00lev1sec45"><strong>ON YOUR OWN</strong></h3>
<p class="noindent">Save new versions of “Tic Tac Toe” as you modify and extend it for these exercises. You can find solutions online at <em><a href="https://nostarch.com/programwithappinventor/">https://nostarch.com/programwithappinventor/</a></em>.</p>
<ol>
<li><p class="noindent">Extend the game so that it indicates when a player has won the game, meaning a player has placed Xs or Os in three squares in a row, either horizontally, vertically, or diagonally.</p></li>
<li><p class="noindent">Extend the app further so that it uses an additional component to indicate which player has won the game.<span epub:type="pagebreak" id="page_124"/></p></li>
</ol>
</body></html>