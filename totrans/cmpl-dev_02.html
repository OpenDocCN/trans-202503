<html><head></head><body>
<section epub:type="chapter" role="doc-chapter" aria-labelledby="ch1">&#13;
<hgroup>&#13;
<h2 class="CHAPTER" id="ch1">&#13;
<span class="CN"><span role="doc-pagebreak" epub:type="pagebreak" id="pg_3" aria-label=" Page 3. "/><samp class="SANS_Futura_Std_Bold_Condensed_B_11">1</samp></span>&#13;
<span class="CT"><samp class="SANS_Dogma_OT_Bold_B_11">NODE.JS</samp></span>&#13;
</h2>&#13;
</hgroup>&#13;
<figure class="opener"><img class="opener" src="../images/Drop-image.jpg" alt=""/>&#13;
</figure>&#13;
<p class="INTRO">Node.js is an open source runtime environment that executes JavaScript code outside a web browser. You could, for example, use it as a scripting language to perform all kinds 	 of chores, such as deleting and moving files, logging data on the server side, or even creating your own web server (as we’ll do in this chapter’s exercise).</p>&#13;
<p class="TX">Knowing how to use Node.js is not really about understanding individual commands or packages, because it relies on standard JavaScript and you can refer to the documentation for details about its syntax and parameters. Instead, all developers should strive to understand the Node.js ecosystem and use it to their advantage. This chapter will introduce you to it.</p>&#13;
<section epub:type="division" aria-labelledby="sec1">&#13;
<h3 class="H1" id="sec1"><span id="h1-6"/><span role="doc-pagebreak" epub:type="pagebreak" id="pg_4" aria-label=" Page 4. "/><samp class="SANS_Futura_Std_Bold_B_11">Installing Node.js</samp></h3>&#13;
<p class="TNI">Begin by checking whether Node.js is already available on your local machine by running the <samp class="SANS_TheSansMonoCd_W5Regular_11">node</samp> command from your command line. The version flag (<samp class="SANS_TheSansMonoCd_W5Regular_11">-v</samp>) should return the current Node.js version:</p>&#13;
&#13;
<pre class="pre-1"><code>$ <b>node -v</b></code></pre>&#13;
<p class="TX">If you see an output with a version number, Node.js is installed. If you don’t, or if the version is lower than the currently recommended stable release listed on <a href="https://nodejs.org"><i>https://<wbr/>nodejs<wbr/>.org</i></a>, you should install this stable version.</p>&#13;
<p class="TX">To install Node.js locally, go to <a href="https://nodejs.org/en/download"><i>https://<wbr/>nodejs<wbr/>.org<wbr/>/en<wbr/>/download</i></a> and select the installer for your operating system. I recommend installing the long-term support (LTS) version of Node.js because many Node.js modules require this version. Run the installer package for Node.js LTS and npm, then check the version number again. It should match the one you’ve just installed.</p>&#13;
<p class="TX">Next, we’ll review the basic commands and features of the Node.js runtime environment. If you prefer not to install Node.js, you can run the Node.js command line examples and JavaScript code in the online playgrounds at <a href="https://codesandbox.io/s/new"><i>https://<wbr/>codesandbox<wbr/>.io<wbr/>/s<wbr/>/new</i></a> and <a href="https://stackblitz.com"><i>https://<wbr/>stackblitz<wbr/>.com</i></a>.</p>&#13;
</section>&#13;
<section epub:type="division" aria-labelledby="sec2">&#13;
<h3 class="H1" id="sec2"><span id="h1-7"/><samp class="SANS_Futura_Std_Bold_B_11">Working with npm</samp></h3>&#13;
<p class="TNI">The default package manager for Node.js is npm. You can find modules for every task there, taken from the online registry at <a href="https://www.npmjs.com"><i>https://<wbr/>www<wbr/>.npmjs<wbr/>.com</i></a>. Verify that npm is available on your local machine by running the following on the command line:</p>&#13;
&#13;
<pre class="pre-2"><code>$ <b>npm -v</b></code></pre>&#13;
<p class="TX">If there is no listed version or if the version is lower than the current release, install the latest Node.js LTS version, including npm.</p>&#13;
<p class="TX">Be aware that there is no vetting process or quality control on <a href="https://www.npmjs.com"><i>https://<wbr/>www<wbr/>.npmjs<wbr/>.com</i></a>. Anyone can publish packages, and the site relies on the community to report any that are malicious or broken.</p>&#13;
<p class="TX">Running the following shows a list of available commands:</p>&#13;
&#13;
<pre class="pre-3"><code>$ <b>npm</b></code></pre>&#13;
<blockquote>&#13;
<p class="NOTE"><span class="NoteHead"><samp class="SANS_Dogma_OT_Bold_B_21">NOTE</samp></span></p>&#13;
<p class="NOTE-TXT"><i>The most popular alternative to npm is yarn, which also uses the</i> <a href="https://www.npmjs.com"><span class="note_LinkURL">https://<wbr/>www<wbr/>.npmjs<wbr/>.com</span></a> <i>registry and is fully compatible with npm.</i></p>&#13;
</blockquote>&#13;
</section>&#13;
<section epub:type="division" aria-labelledby="sec3">&#13;
<h3 class="H1" id="sec3"><span id="h1-8"/><samp class="SANS_Futura_Std_Bold_B_11">The package.json File</samp></h3>&#13;
<p class="TNI">The <i>package.json</i> file is a key element of each Node.js-based project. While the <i>node_modules</i> folder contains actual code, the <i>package.json</i> file holds all <span role="doc-pagebreak" epub:type="pagebreak" id="pg_5" aria-label=" Page 5. "/>the metadata about the project. Found in the project’s root, it must contain the project’s name and version; in addition, it can contain optional data, such as the project’s description, a license, scripts, and many more details.</p>&#13;
<p class="TX">Let’s take a look at the <i>package.json</i> file for the web server you’ll create in <span class="Xref"><a href="#Exe1">Exercise 1</a> on page 13</span>. It should look similar to the one shown in <a href="chapter1.xhtml#Lis1-1">Listing 1-1</a>.</p>&#13;
<span id="Lis1-1"/>&#13;
<pre class="pre-4"><code>{&#13;
    "name": "sample-express",&#13;
    "version": "1.0.0",&#13;
    "description": "sample express server",&#13;
    "main": "index.js",&#13;
    "scripts": {&#13;
        "test": "echo \"Error: no test specified\" &amp;&amp; exit 1",&#13;
        "run": "node index.js"&#13;
    },&#13;
    "author": "",&#13;
    "license": "ISC",&#13;
    "dependencies": {&#13;
        "express":"^4.18.2"&#13;
    }&#13;
}&#13;
</code></pre>&#13;
<p class="__FIG"><span class="Futura_Std_Book_Oblique_BI_11">Listing 1-1: The</span> <span class="Futura_Std_Book_11">package.json</span> <span class="Futura_Std_Book_Oblique_BI_11">file for the Express.js server project in <a href="#Exe1">Exercise 1</a></span></p>&#13;
<p class="TX">The <i>package.json</i> file includes all the information others will need to install required modules on their machine and run the application. As a result, you never have to ship or store the <i>node_modules</i> folder in your code repository, which minimizes the repository’s size. Let’s take a detailed look at the <i>package.json</i> file.</p>&#13;
<section epub:type="division" aria-labelledby="sec4">&#13;
<h4 class="H2" id="sec4"><span id="h2-4"/><samp class="SANS_Futura_Std_Bold_Condensed_Oblique_BI_11">Required Fields</samp></h4>&#13;
<p class="TNI">The <i>package.json</i> file must contain a <samp class="SANS_TheSansMonoCd_W5Regular_11">name</samp> field and a <samp class="SANS_TheSansMonoCd_W5Regular_11">version</samp> field. All other fields are optional. The <samp class="SANS_TheSansMonoCd_W5Regular_11">name</samp> field contains the package’s name, which must be one lowercase word but can contain hyphens and underscores.</p>&#13;
<p class="TX">The <samp class="SANS_TheSansMonoCd_W5Regular_11">version</samp> field must follow semantic versioning guidelines, which suggest this format: <i>major.minor.patch</i>; for example, <i>1.2.3</i>. We call this <i>semantic</i> versioning because each number conveys a meaning. A <i>major</i> version introduces an incompatible API change. You should generally be very careful about switching to another major version, as you won’t be able to expect that your application will work flawlessly. A <i>minor</i> version change adds new functionality in a backward-compatible manner and therefore shouldn’t pose problems for your application. A <i>patch</i> version applies backward-compatible bug fixes, and you should always keep it up to date.</p>&#13;
<blockquote>&#13;
<p class="NOTE"><span class="NoteHead"><samp class="SANS_Dogma_OT_Bold_B_21">NOTE</samp></span></p>&#13;
</blockquote>&#13;
<p class="NOTE-TXT"><i>You can read more about semantic versioning and how to define different ranges at</i> <a href="https://semver.org"><span class="note_LinkURL">https://<wbr/>semver<wbr/>.org</span></a><i>.</i></p>&#13;
</section>&#13;
<section epub:type="division" aria-labelledby="sec5">&#13;
<h4 class="H2" id="sec5"><span id="h2-5"/><span role="doc-pagebreak" epub:type="pagebreak" id="pg_6" aria-label=" Page 6. "/><samp class="SANS_Futura_Std_Bold_Condensed_Oblique_BI_11">Dependencies</samp></h4>&#13;
<p class="TNI">The most important optional fields specify the dependencies and development dependencies. The <samp class="SANS_TheSansMonoCd_W5Regular_11">dependencies</samp> field lists all the dependencies needed to run the project, along with their required version ranges, following the semantic versioning syntax. By default, npm requires only the major version and keeps the minor and patch ranges flexible. This way, npm can always initialize your project with the latest compatible version.</p>&#13;
<p class="TX">These dependencies are part of your bundled application. When you install a project on a new machine, all dependencies listed in the <i>package .json</i> file will be installed and placed in the <i>node_modules</i> folder, next to <i>package.json</i>.</p>&#13;
<p class="TX">Your application could require all sorts of dependencies, such as frameworks and helper modules. For example, the Food Finder application we’ll build in <span class="Xref"><a href="part2.xhtml">Part II</a></span> must contain at least Next.js as a single-page application framework, and Mongoose with MongoDB for the database layer.</p>&#13;
</section>&#13;
<section epub:type="division" aria-labelledby="sec6">&#13;
<h4 class="H2" id="sec6"><span id="h2-6"/><samp class="SANS_Futura_Std_Bold_Condensed_Oblique_BI_11">Development Dependencies</samp></h4>&#13;
<p class="TNI">The <samp class="SANS_TheSansMonoCd_W5Regular_11">devDependencies</samp> field lists all the dependencies necessary to develop the project, along with their versions. Again, only the major version is fixed. These are required only to develop, and not to run, the application. Hence, they are ignored by the packaging scripts and are not part of the deployed application. When you install a project on a new machine, all the development dependencies listed in the <i>package.json</i> file will be installed and placed in the <i>node_modules</i> folder next to <i>package.json</i>. For our Food Finder application, our development dependencies will include TypeScript’s type definitions. Other typical entries are testing frameworks, linters, and build tools such as webpack and Babel.</p>&#13;
</section>&#13;
</section>&#13;
<section epub:type="division" aria-labelledby="sec7">&#13;
<h3 class="H1" id="sec7"><span id="h1-9"/><samp class="SANS_Futura_Std_Bold_B_11">The package-lock.json File</samp></h3>&#13;
<p class="TNI">The npm package manager automatically generates the <i>package-lock.json</i> file for each project. This lock file resolves a problem introduced by the use of semantic versioning for dependencies. As mentioned earlier, the npm default is to define only the major version and to use the latest minor and patch versions available. While this ensures that your application includes the latest bug fixes, it introduces a new issue: without an exact version, builds aren’t reproducible. Because there’s no quality control in the npm registry, even a patch or minor version update could introduce an incompatible API change that should have been a major version change. Consequently, a slight deviation between versions could result in a broken build.</p>&#13;
<p class="TX">The <i>package-lock.json</i> file solves this by tracking the exact version of every package and its dependencies. This file is usually quite big, but its entries for the web server you’ll create at the end of this chapter will look similar to <a href="chapter1.xhtml#Lis1-2">Listing 1-2</a>.</p>&#13;
<span id="Lis1-2"/>&#13;
<pre class="pre-5"><code><span role="doc-pagebreak" epub:type="pagebreak" id="pg_7" aria-label=" Page 7. "/>{&#13;
    "name": "sample-express",&#13;
    "lockfileVersion": 2,&#13;
    "requires": true,&#13;
    "packages": {&#13;
        "": {&#13;
            "dependencies": {&#13;
                "express": "^4.18.2"&#13;
            }&#13;
        },&#13;
        "node_modules/accepts": {&#13;
            "version": "1.3.8",&#13;
            "resolved": "https://registry.npmjs.org/accepts/-/accepts-1.3.8.tgz",&#13;
            "integrity": "sha512-PYAthTa2m2VKxuvSD3DPC/Gy+U+sOA1LAuT8mkmRuvw+NACSaeXEhosdQ==",&#13;
            <var>--snip--</var>&#13;
        },&#13;
        <var>--snip--</var>&#13;
        "node_modules/express": {&#13;
            "version": "4.18.2",&#13;
            "resolved": "https://registry.npmjs.org/express/-/express-4.18.2.tgz",&#13;
            "integrity": "sha512-5/PsL6iGPdfQ/lKM1UuielYgv3BUoJfz1aUwU9vHZ+J7gyvwdQXFEBIEI==",&#13;
            "dependencies": {&#13;
                "accepts": "~1.3.8",&#13;
                <var>--snip--</var>&#13;
                "vary": "~1.1.2"&#13;
            },&#13;
            "engines": {&#13;
                "node": "&gt;= 0.10.0"&#13;
            }&#13;
        },&#13;
        <var>--snip--</var>&#13;
        "vary": {&#13;
            "version": "1.1.2",&#13;
            "resolved": "https://registry.npmjs.org/vary/-/vary-1.1.2.tgz",&#13;
            "integrity": "sha512-BNGbWLfd0eUPabhkXUVm0j8uuvREyTh5ovRa/dyow/BqAbZJyC+bfhskkh=="&#13;
        }&#13;
    }&#13;
}&#13;
</code></pre>&#13;
<p class="__FIG"><span class="Futura_Std_Book_Oblique_BI_11">Listing 1-2: The</span> <span class="Futura_Std_Book_11">package-lock.json</span> <span class="Futura_Std_Book_Oblique_BI_11">file for <a href="#Exe1">Exercise 1</a></span></p>&#13;
<p class="TX">The lock file contains a reference to the project and lists the information from the corresponding <i>package.json</i> file. Then it lists all the project’s dependencies; for us, the only dependency is Express.js, with a pinned version. (We’ll cover Express.js in <a href="#Exe1">Exercise 1</a>.) In addition, the file lists all the dependencies for the Express.js version in use, in this case the <i>accept</i> and <i>vary</i> packages. The stored artifact’s SHA hash enables npm to verify the integrity of the resource after downloading it.</p>&#13;
<p class="TX">Now, with all modules version-locked, every <samp class="SANS_TheSansMonoCd_W5Regular_11">npm install</samp> command will create an exact clone of the original setup. Like <i>package.json</i>, the <i>package-lock.json</i> file is part of the code repository.</p>&#13;
</section>&#13;
<section epub:type="division" aria-labelledby="sec8">&#13;
<h3 class="H1" id="sec8"><span id="h1-10"/><span role="doc-pagebreak" epub:type="pagebreak" id="pg_8" aria-label=" Page 8. "/><samp class="SANS_Futura_Std_Bold_B_11">Creating a Project</samp></h3>&#13;
<p class="TNI">Let’s cover the most important commands for your day-to-day work, in the order in which you would logically use them to create and maintain a project. After performing these steps, you’ll have a <i>package.json</i> file and a production-ready project folder with one installed package, Express.js.</p>&#13;
<section epub:type="division" aria-labelledby="sec9">&#13;
<h4 class="H2" id="sec9"><span id="h2-7"/><samp class="SANS_Futura_Std_Bold_Condensed_Oblique_BI_11">Initializing a New Module or Project</samp></h4>&#13;
<p class="TNI">To start a new project, run <samp class="SANS_TheSansMonoCd_W7Bold_B_11">npm init</samp>, which initializes a new module. This should trigger an interactive guide through which you’ll populate the project’s <i>package.json</i> file based on your input:</p>&#13;
&#13;
<pre class="pre-6"><code>$ <b>mkdir sample-express</b>&#13;
$ <b>cd sample-express</b>&#13;
$ <b>npm init</b>&#13;
This utility will walk you through creating a package.json file.&#13;
It only covers the most common items, and tries to guess sensible defaults.&#13;
<var>--snip--</var>&#13;
Is this OK? <b>(yes)</b>&#13;
</code></pre>&#13;
<p class="TX">At the beginning of each project, you need to initialize a new Node.js setup in an empty folder (created here with <samp class="SANS_TheSansMonoCd_W5Regular_11">mkdir sample-express</samp>) using <samp class="SANS_TheSansMonoCd_W5Regular_11">npm init</samp>. For simplicity, keep the default suggestions here. The assistant creates a basic <i>package.json</i> file in your project folder. It should look similar to <a href="chapter1.xhtml#Lis1-3">Listing 1-3</a>.</p>&#13;
<span id="Lis1-3"/>&#13;
<pre class="pre-7"><code>{&#13;
    "name": " sample-express",&#13;
    "version": "1.0.0",&#13;
    "description": "",&#13;
    "main": "index.js",&#13;
    "scripts": {&#13;
      "test": "echo \"Error: no test specified\" &amp;&amp; exit 1"&#13;
    },&#13;
    "author": "",&#13;
    "license": "ISC"&#13;
}&#13;
</code></pre>&#13;
<p class="__FIG"><span class="Futura_Std_Book_Oblique_BI_11">Listing 1-3: The default</span> <span class="Futura_Std_Book_11">package.json</span> <span class="Futura_Std_Book_Oblique_BI_11">file</span></p>&#13;
<p class="TX">When we compare this file with the one shown in <a href="chapter1.xhtml#Lis1-1">Listing 1-1</a>, we see that they are fairly similar, except for the dependencies and development dependencies. With the <i>package.json</i> file ready, we can now install these dependencies with <samp class="SANS_TheSansMonoCd_W5Regular_11">npm install</samp>.</p>&#13;
</section>&#13;
<section epub:type="division" aria-labelledby="sec10">&#13;
<h4 class="H2" id="sec10"><span id="h2-8"/><samp class="SANS_Futura_Std_Bold_Condensed_Oblique_BI_11">Installing the Dependencies</samp></h4>&#13;
<p class="TNI">Node.js provides modules for tasks like accessing the filesystem’s input and output, using networking protocols (such as DNS, HTTP, TCP, TLS/SSL, and UDP), and handling binary data. It also provides cryptography modules, interfaces for working with data streams, and much more.</p>&#13;
<p class="TX"><span role="doc-pagebreak" epub:type="pagebreak" id="pg_9" aria-label=" Page 9. "/>Running <samp class="SANS_TheSansMonoCd_W5Regular_11">npm install</samp> <samp class="SANS_TheSansMonoCd_W5Regular_Italic_I_11">&lt;package&gt;</samp> downloads and places a specific package in the <i>node_modules</i> folder, next to your <i>package.json</i> file, and adds it to the dependencies list in <i>package.json</i>. You should use it whenever you need to add a new module that is required to run the application.</p>&#13;
<p class="TX">Say you want to create a new Express.js-based server. You’ll need to install the Express.js package from <a href="https://npmjs.com"><i>https://<wbr/>npmjs<wbr/>.com</i></a>. Here we install a particular version, but to install the latest version, omit the version number and use <samp class="SANS_TheSansMonoCd_W5Regular_11">npm install express</samp> instead:</p>&#13;
&#13;
<pre class="pre-8"><code>$ <b>npm install express@4.18.2</b>&#13;
added 57 packages, and audited 58 packages in 1s&#13;
found 0 vulnerabilities&#13;
</code></pre>&#13;
<p class="TX">Now the <i>node_modules</i> folder contains an <i>express</i> folder and additional folders with its dependencies. Also, Express.js is listed as a dependency in <i>package.json</i>, as shown in <a href="chapter1.xhtml#Lis1-4">Listing 1-4</a>.</p>&#13;
<span id="Lis1-4"/>&#13;
<pre class="pre-9"><code>{&#13;
    "name": " sample-express",&#13;
    "version": "1.0.0",&#13;
    "description": "",&#13;
    "main": "index.js",&#13;
    "scripts": {&#13;
      "test": "echo \"Error: no test specified\" &amp;&amp; exit 1"&#13;
    },&#13;
    "author": "",&#13;
    "license": "ISC",&#13;
    "dependencies": {&#13;
      "express": "^4.18.2"&#13;
    }&#13;
}&#13;
</code></pre>&#13;
<p class="__FIG"><span class="Futura_Std_Book_Oblique_BI_11">Listing 1-4: The default</span> <span class="Futura_Std_Book_11">package.json</span> <span class="Futura_Std_Book_Oblique_BI_11">file with Express.js as a dependency</span></p>&#13;
<p class="TX">We’ve successfully added Express.js as a dependency.</p>&#13;
</section>&#13;
<section epub:type="division" aria-labelledby="sec11">&#13;
<h4 class="H2" id="sec11"><span id="h2-9"/><samp class="SANS_Futura_Std_Bold_Condensed_Oblique_BI_11">Installing the Development Dependencies</samp></h4>&#13;
<p class="TNI">Now let’s say you want to use a package called <i>karma</i> for end-to-end testing of the server. Instead of being a dependency like Express.js, this package is used only during development and is not necessary for running the actual application.</p>&#13;
<p class="TX">In cases like this, you should run <samp class="SANS_TheSansMonoCd_W5Regular_11">npm install --save-dev</samp> <samp class="SANS_TheSansMonoCd_W5Regular_Italic_I_11">package</samp> to download this package and add it to the <samp class="SANS_TheSansMonoCd_W5Regular_11">devDependencies</samp> list in the local <i>package.json</i> file:</p>&#13;
&#13;
<pre class="pre-10"><code>$ <b>npm install --save-dev karma@5.0.0</b>&#13;
added 128 packages, and audited 186 packages in 3m&#13;
9 vulnerabilities (1 moderate, 4 high, 4 critical)&#13;
&#13;
To address issues that do not require attention, run:&#13;
  npm audit fix&#13;
&#13;
<span role="doc-pagebreak" epub:type="pagebreak" id="pg_10" aria-label=" Page 10. "/>To address all issues (including breaking changes), run:&#13;
  npm audit fix --force&#13;
&#13;
Run `npm audit` for details.&#13;
</code></pre>&#13;
<p class="TX">Notice that, after installing the <i>karma</i> package, npm indicates that this version has known vulnerabilities. Nonetheless, it is added to the <i>node_modules</i> folder and listed as a <samp class="SANS_TheSansMonoCd_W5Regular_11">devDependency</samp> in <i>package.json</i>. We will follow the suggestions to fix the issues in a bit.</p>&#13;
</section>&#13;
<section epub:type="division" aria-labelledby="sec12">&#13;
<h4 class="H2" id="sec12"><span id="h2-10"/><samp class="SANS_Futura_Std_Bold_Condensed_Oblique_BI_11">Auditing the package.json File</samp></h4>&#13;
<p class="TNI">During installation, npm indicated that <i>karma</i> has a vulnerability, so let’s verify this. The <samp class="SANS_TheSansMonoCd_W5Regular_11">npm audit</samp> command inspects the local <i>package.json</i> file for any known vulnerabilities:</p>&#13;
&#13;
<pre class="pre-11"><code>$ <b>npm audit</b>&#13;
&#13;
# npm audit report&#13;
<var>--snip--</var>&#13;
karma  &lt;=6.3.15&#13;
Severity: high&#13;
Open redirect in karma - https://github.com/advisories/GHSA-rc3x-jf5g-xvc5&#13;
Cross-site Scripting in karma - https://github.com/advisories/GHSA-7x7c-qm48-pq9c&#13;
Depends on vulnerable versions of log4js&#13;
Depends on vulnerable versions of ua-parser-js&#13;
fix available via `npm audit fix --force`&#13;
Will install karma@6.4.1, which is a breaking change&#13;
<var>--snip--</var>&#13;
9 vulnerabilities (1 moderate, 4 high, 4 critical)&#13;
&#13;
To address issues that do not require attention, run:&#13;
  npm audit fix&#13;
&#13;
To address all issues (including breaking changes), run:&#13;
  npm audit fix --force&#13;
</code></pre>&#13;
<p class="TX">Running the command returns a detailed report about the version and severity of each problematic package, as well as a summary of all the issues found in the currently installed Node.js modules.</p>&#13;
<p class="TX">The npm package manager also indicated that the issues could be fixed automatically with <samp class="SANS_TheSansMonoCd_W5Regular_11">npm audit fix</samp>. Alas, it warns us about breaking changes in the latest <i>karma</i> version. To accommodate those, we need to use the <samp class="SANS_TheSansMonoCd_W5Regular_11">--force</samp> flag. I recommend using <samp class="SANS_TheSansMonoCd_W5Regular_11">npm audit</samp> every few months, along with <samp class="SANS_TheSansMonoCd_W5Regular_11">npm update</samp>, to avoid using outdated dependencies and creating security risks:</p>&#13;
&#13;
<pre class="pre-12"><code>$ <b>npm audit fix --force</b>&#13;
added 13 packages, removed 41 packages, changed 27 packages, and audited 158 packages in 5s&#13;
</code></pre>&#13;
<p class="TX">Now we see that the <samp class="SANS_TheSansMonoCd_W5Regular_11">devDependencies</samp> list in <i>package.json</i> has the latest <i>karma</i> version, and another run of <samp class="SANS_TheSansMonoCd_W5Regular_11">npm audit</samp> reports that there are no more known vulnerabilities in the installed packages.</p>&#13;
</section>&#13;
<section epub:type="division" aria-labelledby="sec13">&#13;
<h4 class="H2" id="sec13"><span id="h2-11"/><span role="doc-pagebreak" epub:type="pagebreak" id="pg_11" aria-label=" Page 11. "/><samp class="SANS_Futura_Std_Bold_Condensed_Oblique_BI_11">Cleaning Up the node_modules Folder</samp></h4>&#13;
<p class="TNI">Running <samp class="SANS_TheSansMonoCd_W5Regular_11">npm prune</samp> inspects the local <i>package.json</i> file, compares it to the local <i>node_modules</i> folder, and removes all unnecessary packages. You should use it during development, after adding and removing packages, or when performing general cleanup chores.</p>&#13;
<p class="TX">Let’s check that the audit we just performed didn’t install any unnecessary packages:</p>&#13;
&#13;
<pre class="pre-13"><code>$ <b>npm prune</b>&#13;
up to date, audited 136 packages in 1s&#13;
&#13;
found 0 vulnerabilities&#13;
</code></pre>&#13;
<p class="TX">The output looks fine; there are no issues with our packages.</p>&#13;
</section>&#13;
<section epub:type="division" aria-labelledby="sec14">&#13;
<h4 class="H2" id="sec14"><span id="h2-12"/><samp class="SANS_Futura_Std_Bold_Condensed_Oblique_BI_11">Updating All Packages</samp></h4>&#13;
<p class="TNI">Running <samp class="SANS_TheSansMonoCd_W5Regular_11">npm update</samp> updates all installed packages to their latest acceptable version. You should use this command frequently to avoid outdated dependencies and security risks:</p>&#13;
&#13;
<pre class="pre-14"><code>$ <b>npm update</b>&#13;
added 1 package, removed 1 package, changed 1 package, and audited 158 packages in 8s&#13;
&#13;
found 0 vulnerabilities&#13;
</code></pre>&#13;
<p class="TX">As you can see, <samp class="SANS_TheSansMonoCd_W5Regular_11">npm update</samp> displays a summary of the updates.</p>&#13;
</section>&#13;
<section epub:type="division" aria-labelledby="sec15">&#13;
<h4 class="H2" id="sec15"><span id="h2-13"/><samp class="SANS_Futura_Std_Bold_Condensed_Oblique_BI_11">Removing a Dependency</samp></h4>&#13;
<p class="TNI">Running <samp class="SANS_TheSansMonoCd_W5Regular_11">npm uninstall</samp> <samp class="SANS_TheSansMonoCd_W5Regular_Italic_I_11">package</samp> removes the package and its dependencies from the local <i>node_modules</i> folder and <i>package.json</i> file. You should use this command to delete modules you don’t need anymore. Say you decide that end-to-end tests with <i>karma</i> are no longer necessary:</p>&#13;
&#13;
<pre class="pre-15"><code>$ <b>npm uninstall karma</b>&#13;
removed 71 packages, and audited 138 packages in 3s&#13;
&#13;
found 0 vulnerabilities&#13;
</code></pre>&#13;
<p class="TX">The command’s output shows the changes made to the <i>node_modules</i> folder. The package was removed from <i>package.json</i> as well.</p>&#13;
</section>&#13;
<section epub:type="division" aria-labelledby="sec16">&#13;
<h4 class="H2" id="sec16"><span id="h2-14"/><samp class="SANS_Futura_Std_Bold_Condensed_Oblique_BI_11">Installing a Dependency</samp></h4>&#13;
<p class="TNI">Running <samp class="SANS_TheSansMonoCd_W5Regular_11">npm install</samp> downloads all dependencies and <samp class="SANS_TheSansMonoCd_W5Regular_11">devDependencies</samp> from the npm repository and places them in the <i>node_modules</i> folder. Use this command to install an existing project on a new machine. For example, to install a copy of the Express.js project in a new folder, you could create a new empty folder and copy only the <i>package.json</i> and <span role="doc-pagebreak" epub:type="pagebreak" id="pg_12" aria-label=" Page 12. "/><i>package-lock.json</i> files into it. Then you could run the <samp class="SANS_TheSansMonoCd_W5Regular_11">npm install</samp> command inside this folder:</p>&#13;
&#13;
<pre class="pre-16"><code>$ <b>npm install</b>&#13;
added 137 packages, and audited 138 packages in 3s&#13;
&#13;
found 0 vulnerabilities&#13;
</code></pre>&#13;
<p class="TX">Whenever you clone the repository or create a new project from a <i>package.json</i> file, run <samp class="SANS_TheSansMonoCd_W5Regular_11">npm install</samp>. As with all previous commands, npm shows a status report listing any vulnerabilities.</p>&#13;
</section>&#13;
<section epub:type="division" aria-labelledby="sec17">&#13;
<h4 class="H2" id="sec17"><span id="h2-15"/><samp class="SANS_Futura_Std_Bold_Condensed_Oblique_BI_11">Using npx to Execute a Script Only Once</samp></h4>&#13;
<p class="TNI">When you installed Node.js, you also installed npx, which stands for <i>node package execute</i>. This tool enables you to execute any package from the registry without installing it beforehand. This is useful when you need to run some code only once. For example, you might use a scaffolding script that initializes a project but is neither a dependency nor a development dependency.</p>&#13;
<p class="TX">The npx tool works by checking whether the executable you’re trying to run is available through the <samp class="SANS_TheSansMonoCd_W5Regular_11">$PATH</samp> environment variable or local project binaries. If this is not the case, npx installs the package to a central cache instead of your local <i>node_modules</i> folder. Say you want to check your package JSON for syntax errors. For this, you can use the <i>jsonlint</i> package. As this package is neither required to run the project nor part of your development process, you don’t want to install it into your <i>node_modules</i> folder:</p>&#13;
&#13;
<pre class="pre-17"><code>$ <b>npx jsonlint package.json</b>&#13;
Need to install the following packages:&#13;
  jsonlint&#13;
Ok to proceed? (y) <b>y</b>&#13;
{&#13;
    "name": " sample-express",&#13;
    "version": "1.0.0",&#13;
    "description": "",&#13;
    "main": "index.js",&#13;
    "scripts": {&#13;
        "test": "echo \"Error: no test specified\" &amp;&amp; exit 1"&#13;
    },&#13;
    "author": "",&#13;
    "license": "ISC",&#13;
    "dependencies": {&#13;
        "express": "^4.18.2"&#13;
    }&#13;
}&#13;
</code></pre>&#13;
<p class="TX">This calls <i>jsonlint</i> to validate our <i>package.json</i> file via npx. First npx installs the package into the global cache folder, then runs <i>jsonlint</i>. It prints the content of our <i>package.json</i> file and reports no errors. Check your <i>node_modules</i> folder; <i>jsonlint</i> shouldn’t be installed. Nonetheless, on each subsequent call of npx, you’ll find <i>jsonlint</i> available.</p>&#13;
<p class="HeadProject"><span id="Exe1"/><span role="doc-pagebreak" epub:type="pagebreak" id="pg_13" aria-label=" Page 13. "/><samp class="SANS_Futura_Std_Heavy_B_21">Exercise 1: Build a “Hello World” Express.js Server</samp></p>&#13;
<p class="TNI">Express.js is a free and open source backend framework built on top of Node.js. Designed for building web applications and APIs, it is the de facto standard server framework for the Node.js ecosystem and is foundational to full-stack web development.</p>&#13;
<p class="TX">Express.js offers common middleware used by HTTP servers for tasks such as caching, content negotiation, cookie handling, handling cross-origin requests, redirecting, and much more.</p>&#13;
<blockquote>&#13;
<p class="NOTE"><span class="NoteHead"><samp class="SANS_Dogma_OT_Bold_B_21">NOTE</samp></span></p>&#13;
</blockquote>&#13;
<p class="NOTE-TXT"><i>Next.js uses its own built-in server that borrows heavily from Express.js. For the Food Finder application that you’ll build in <a href="part2.xhtml">Part II</a> of this book, Next.js will be the foundation of the middleware you’ll use. As Next.js abstracts this middleware for you, you won’t directly interact with the server there.</i></p>&#13;
<p class="TX">Let’s build a simple Express.js-based Node.js server to practice your Node.js skills.</p>&#13;
</section>&#13;
<section epub:type="division" aria-labelledby="sec18">&#13;
<h4 class="H2" id="sec18"><span id="h2-16"/><samp class="SANS_Futura_Std_Bold_Condensed_Oblique_BI_11">Setting Up</samp></h4>&#13;
<p class="TNI">If you’ve already created the <i>sample-express</i> folder and <i>package.json</i> file while following along with this chapter, you can skip this setup. Otherwise, create and switch to a new folder called <i>sample-express</i>. Then, to initialize a new Node.js project, run <samp class="SANS_TheSansMonoCd_W5Regular_11">npm init</samp> on the command line. The interactive guide should ask you for some details, such as the name and version of your application. Accept the defaults for now.</p>&#13;
<p class="TX">Next, you’ll want to use the Express.js package as the foundation of the server. Run <samp class="SANS_TheSansMonoCd_W5Regular_11">npm install express@4</samp> to install the latest release of the major version 4. You will see that the <i>package.json</i> file now contains <i>express</i> as a dependency.</p>&#13;
</section>&#13;
<section epub:type="division" aria-labelledby="sec19">&#13;
<h4 class="H2" id="sec19"><span id="h2-17"/><samp class="SANS_Futura_Std_Bold_Condensed_Oblique_BI_11">Writing the Server Code</samp></h4>&#13;
<p class="TNI">Create an <i>index.js</i> file in the <i>sample-express</i> folder and add the code in <a href="chapter1.xhtml#Lis1-5">Listing 1-5</a>.</p>&#13;
<span id="Lis1-5"/>&#13;
<pre class="pre-18"><code>const express = require('express');&#13;
const server = express();&#13;
const port = 3000;&#13;
&#13;
server.get('/hello', function (req, res) {&#13;
    res.send('Hello World!');&#13;
});&#13;
&#13;
server.listen(port, function () {&#13;
    console.log('Listening on ' + port);&#13;
});&#13;
</code></pre>&#13;
<p class="__FIG"><span class="Futura_Std_Book_Oblique_BI_11">Listing 1-5: A basic Express.js server</span></p>&#13;
<p class="TX"><span role="doc-pagebreak" epub:type="pagebreak" id="pg_14" aria-label=" Page 14. "/>First we load the <i>express</i> package into the file, instantiate the app, and define a constant for the port to use. Then we create a route for our server so that it will respond to every GET request sent to the <i>/hello</i> base URL with <samp class="SANS_TheSansMonoCd_W5Regular_11">Hello World!</samp> We use the Express.js <samp class="SANS_TheSansMonoCd_W5Regular_11">get</samp> method and pass <samp class="SANS_TheSansMonoCd_W5Regular_11">/hello</samp> as the first parameter and a callback function as the second parameter. Now, for each GET request sent to the <i>/hello</i> endpoint, the server runs the callback function that sends <samp class="SANS_TheSansMonoCd_W5Regular_11">Hello World!</samp> as the response to the browser. Finally, we use the Express.js <samp class="SANS_TheSansMonoCd_W5Regular_11">listen</samp> method to spin up the web server and tell it to listen on port 3000.</p>&#13;
<p class="TX">Start the server from your command line:</p>&#13;
&#13;
<pre class="pre-19"><code>$ <b>node index.js</b>&#13;
Listening on 3000&#13;
</code></pre>&#13;
<p class="TX">Now visit <i>http://localhost:3000/hello</i> in your browser. You should see the <samp class="SANS_TheSansMonoCd_W5Regular_11">Hello World!</samp> message. Congratulations! You just wrote your first Node.js web server in JavaScript.</p>&#13;
</section>&#13;
</section>&#13;
<section epub:type="division" aria-labelledby="sec20">&#13;
<h3 class="H1" id="sec20"><span id="h1-11"/><samp class="SANS_Futura_Std_Bold_B_11">Summary</samp></h3>&#13;
<p class="TNI">This chapter taught you how to run JavaScript code outside a browser using Node.js and its module ecosystem. You learned how to use, add, and remove modules in your full-stack application with npm commands, as well as how to read and use the <i>package.json</i> and <i>package-lock.json</i> files. Finally, you peeked into Express.js, the de facto standard server for full-stack development, and used it to build a sample Node.js server with just a few lines of code.</p>&#13;
<p class="TX">This chapter only scratched the surface of Node.js. If you want to explore its full potential, I recommend the Node.js tutorials from W3Schools at <a href="https://www.w3schools.com/nodejs/"><i>https://<wbr/>www<wbr/>.w3schools<wbr/>.com<wbr/>/nodejs<wbr/>/</i></a> and the free ExpressJS Fundamentals course from <a href="https://www.udemy.com/course/expressjs-fundamentals/"><i>https://<wbr/>www<wbr/>.udemy<wbr/>.com<wbr/>/course<wbr/>/expressjs<wbr/>-fundamentals<wbr/>/</i></a>.</p>&#13;
<p class="TX">In the next chapter, you will get to know ES.Next, the latest iteration of JavaScript, and master the modern features it brings to the table.</p>&#13;
</section>&#13;
</section>&#13;
</body></html>