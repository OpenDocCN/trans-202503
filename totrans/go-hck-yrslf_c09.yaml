- en: '9'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '9'
- en: Hacking Mobile Devices
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 黑客攻击移动设备
- en: '![](image_fi/book_art/chapterart.png)'
  id: totrans-2
  prefs: []
  type: TYPE_IMG
  zh: '![](image_fi/book_art/chapterart.png)'
- en: In this chapter, we’ll explore the world of mobile device hacking. You’ll build
    a virtual machine using the world’s most popular mobile operating system, Android.
    Then you’ll hack into your virtual mobile device with Metasploit and take control
    of it remotely using Meterpreter, much like you hacked a PC in Chapter 6\. You’ll
    also learn several ways to protect yourself and your family and friends from the
    growing number of mobile attacks.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 本章我们将探索移动设备黑客攻击的世界。你将使用世界上最流行的移动操作系统 Android 来构建一个虚拟机。然后，你将利用 Metasploit 入侵你的虚拟移动设备，并使用
    Meterpreter 远程控制它，就像在第六章中入侵 PC 一样。你还将学习几种方法，以保护自己以及家人和朋友免受日益增长的移动攻击。
- en: Creating an Android Phone/Tablet VM
  id: totrans-4
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 创建 Android 手机/平板虚拟机
- en: We want to hack an Android mobile device in a safe, ethical way, so we’ll begin
    by adding an Android VM in our virtual hacking lab. Follow these steps to download
    and configure the VM.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 我们希望以安全、伦理的方式进行 Android 移动设备的黑客攻击，因此我们将首先在虚拟黑客实验室中添加一个 Android 虚拟机。按照以下步骤下载并配置虚拟机。
- en: Go to [https://www.osboxes.org/android-x86/](https://www.osboxes.org/android-x86/)and
    scroll down to the Android-x86 8.1-RC1 Oreo section. Select the **VirtualBox**
    tab and click the **Download** button for the 64-bit version.
  id: totrans-6
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 前往 [https://www.osboxes.org/android-x86/](https://www.osboxes.org/android-x86/)，向下滚动至
    Android-x86 8.1-RC1 Oreo 部分。选择 **VirtualBox** 标签页，并点击 **下载** 按钮，下载 64 位版本。
- en: 'Your download should have a *.7z* file extension. To unzip the file, you’ll
    need to download and install 7-Zip for Windows, Archiver for Mac, or p7zip-full
    for Linux. Once you have the required software, unzip the Android VM: on Windows,
    right-click the file and select **7-Zip**▶**Extract Here**; on macOS or Linux,
    double-click the file. The VM will be extracted into a folder called *64bit*.'
  id: totrans-7
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你的下载文件应该以 *.7z* 为扩展名。要解压文件，你需要下载并安装 7-Zip（适用于 Windows）、Archiver（适用于 Mac）或 p7zip-full（适用于
    Linux）。安装好所需的软件后，解压 Android 虚拟机：在 Windows 上，右键点击文件并选择 **7-Zip**▶**解压到此处**；在 macOS
    或 Linux 上，双击文件。虚拟机将解压到一个名为 *64bit* 的文件夹中。
- en: Open VirtualBox and click **New** to open the Create Virtual Machine window.
  id: totrans-8
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开 VirtualBox 并点击 **新建**，打开创建虚拟机窗口。
- en: 'In the Name and operating system dialog, enter **Android 8.1** or similar in
    the Name: text box, select **Linux** from the Type: drop-down list, and choose
    **Other Linux (64-bit)** from the Version: drop-down list. Then click **Next**
    on Windows or **Continue** (on macOS).'
  id: totrans-9
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在名称和操作系统对话框中，在名称框中输入 **Android 8.1** 或类似名称，从类型下拉列表中选择 **Linux**，然后从版本下拉列表中选择
    **其他 Linux（64 位）**。然后点击 **下一步**（在 Windows 上）或 **继续**（在 macOS 上）。
- en: In the Memory size dialog, enter **2048** in the box to give the VM 2,048MB
    (2GB) of RAM and click through to the next screen.
  id: totrans-10
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在内存大小对话框中，在框内输入 **2048**，为虚拟机分配 2,048MB（2GB）的内存，然后点击进入下一个屏幕。
- en: In the Hard disk dialog, choose **Use an existing virtual hard disk file** and
    click the Browse icon (the folder with a green arrow). In the pop-up window that
    appears, click **Add**. Then find and select the *.vdi* file inside the *64bit*
    folder you unzipped.
  id: totrans-11
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在硬盘对话框中，选择 **使用现有虚拟硬盘文件**，点击浏览图标（带绿色箭头的文件夹）。在弹出的窗口中，点击 **添加**。然后找到并选择你解压缩后的
    *64bit* 文件夹中的 *.vdi* 文件。
- en: Click through to return to the Hard disk dialog and choose **Create** to create
    your VM. Your new Android 8.1 VM should now appear in the list of VMs in VirtualBox,
    as shown in [Figure 9-1](#figure9-1).
  id: totrans-12
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击进入硬盘对话框并选择 **创建** 来创建你的虚拟机。你的新 Android 8.1 虚拟机现在应该出现在 VirtualBox 的虚拟机列表中，如
    [图 9-1](#figure9-1) 所示。
- en: 'Select the Android VM in the list, go to **Settings**, and choose the **Display**
    tab. In the Graphics Controller: drop-down list, select **VBoxSVGA**. This changes
    the display settings so that we’ll be able to see the graphical user interface
    (GUI) version of our Android smartphone VM.'
  id: totrans-13
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在列表中选择 Android 虚拟机，进入 **设置**，并选择 **显示** 标签页。在图形控制器下拉列表中，选择 **VBoxSVGA**。这样会更改显示设置，使我们能够看到
    Android 智能手机虚拟机的图形用户界面（GUI）版本。
- en: Still in the Display tab, make sure the checkbox beside **Enable 3D Acceleration**
    is unchecked. (If your VM doesn’t work in a moment, however, you might have to
    turn on 3D acceleration.)
  id: totrans-14
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 仍然在显示标签页，确保 **启用 3D 加速** 旁边的复选框没有勾选。（不过，如果你的虚拟机一会儿无法正常工作，你可能需要开启 3D 加速。）
- en: Switch to the **Network** settings tab and choose the NAT network named **PublicNAT**.
    This will enable your Android VM to communicate with your Kali VM in your virtual
    hacking lab.
  id: totrans-15
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 切换到 **网络** 设置标签页，选择名为 **PublicNAT** 的 NAT 网络。这样可以让你的 Android 虚拟机与 Kali 虚拟机在虚拟黑客实验室中进行通信。
- en: '![f09001](image_fi/502000c09/f09001.png)'
  id: totrans-16
  prefs: []
  type: TYPE_IMG
  zh: '![f09001](image_fi/502000c09/f09001.png)'
- en: 'Figure 9-1: We’ve added an Android 8.1 VM to VirtualBox!'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 图9-1：我们已经在VirtualBox中添加了一个Android 8.1虚拟机！
- en: You’re now ready to fire up your Android VM! It may take a few moments to load
    the first time (and you may need to restart your VM if the screen stays black
    for more than a minute or so), but you’ll eventually see an Android device home
    screen like the one shown in [Figure 9-2](#figure9-2).
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 你现在准备启动你的Android虚拟机了！第一次启动可能需要几分钟（如果屏幕停留黑色超过一分钟，你可能需要重启虚拟机），但最终你会看到像[图9-2](#figure9-2)所示的Android设备主屏幕。
- en: '![f09002](image_fi/502000c09/f09002.png)'
  id: totrans-19
  prefs: []
  type: TYPE_IMG
  zh: '![f09002](image_fi/502000c09/f09002.png)'
- en: 'Figure 9-2: The home screen on your virtual Android device'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 图9-2：你虚拟Android设备的主屏幕
- en: Before you start exploring the VM, go to **Input**▶**Mouse Integration** in
    the Android VM’s menu bar to deselect Mouse Integration. Leaving Mouse Integration
    on can make it difficult to control the pointer on the Android VM. (The Android
    VM is made for touch screens, so the mouse can be frustrating to use in Android
    anyway.) With that done, you’re ready to look around your virtual Android device.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 在开始探索虚拟机之前，去Android虚拟机的菜单栏，点击**输入**▶**鼠标集成**，取消选中鼠标集成。保持鼠标集成开启会使得在Android虚拟机上控制指针变得困难。（因为Android虚拟机是为触摸屏设计的，所以在Android上使用鼠标本来就可能令人沮丧。）完成这些后，你就可以开始浏览你的虚拟Android设备了。
- en: Open the Chrome browser and browse to a web page or open the Contacts app and
    add a few contacts—do anything you want to try. The Android VM is almost identical
    to a real Android tablet or phone, except that it can’t make phone calls and it
    doesn’t have certain sensors like GPS for location services. Remember that you
    can use the right CTRL key (Windows) or left COMMAND key (Mac) to regain control
    of your mouse when you want to leave the Android VM, just as we’ve done with other
    VMs.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 打开Chrome浏览器，浏览网页或打开联系人应用并添加几个联系人——你可以尝试任何你想做的事。Android虚拟机几乎和真实的Android平板或手机一模一样，除了它不能打电话，且没有GPS等用于定位服务的传感器。记住，当你想离开Android虚拟机时，你可以使用右CTRL键（Windows）或左COMMAND键（Mac）重新控制鼠标，正如我们对待其他虚拟机时一样。
- en: Launching an Android Trojan
  id: totrans-23
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 启动Android木马
- en: Now we’re ready to create some malware. Just as we did with your Windows VM
    in Chapter 6, we’ll use a Meterpreter trojan to infect and take over the Android
    VM. We’ll hide the trojan in a file called *CoolGame.apk*. Android uses the *APK
    file format* to distribute and install mobile apps. Following these steps, you’ll
    see how easy it is for an attacker to trick an Android user into installing and
    running an infected app.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们准备好创建一些恶意软件了。就像我们在第6章中对Windows虚拟机所做的那样，我们将使用Meterpreter木马来感染并控制Android虚拟机。我们会把木马隐藏在一个名为*CoolGame.apk*的文件中。Android使用*APK文件格式*来分发和安装移动应用程序。按照这些步骤，你将看到攻击者是如何轻松欺骗Android用户安装并运行一个感染的应用程序。
- en: Log in to your Kali VM and launch Metasploit.
  id: totrans-25
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 登录到你的Kali虚拟机并启动Metasploit。
- en: 'At the Metasploit `msf6` command prompt, type the following command as one
    long line, substituting your Kali VM’s IP address after `LHOST=`:'
  id: totrans-26
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在Metasploit的`msf6`命令提示符下，输入以下命令作为一行，替换`LHOST=`后的Kali虚拟机IP地址：
- en: '[PRE0]'
  id: totrans-27
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'This creates an `android/meterpreter/reverse_tcp` payload in the form of an
    APK file and saves it directly to Kali’s shared web folder. Metasploit will respond
    with a few lines of output, ending with something like the following:'
  id: totrans-28
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 这会创建一个形式为APK文件的`android/meterpreter/reverse_tcp`有效载荷，并将其直接保存到Kali的共享网页文件夹中。Metasploit将响应几行输出，最后会显示类似以下内容：
- en: '[PRE1]'
  id: totrans-29
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'Turn on the Apache web server service so you can download the file from your
    Android VM:'
  id: totrans-30
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启动Apache web服务器服务，这样你就可以从你的Android虚拟机下载文件：
- en: '[PRE2]'
  id: totrans-31
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE2]'
- en: To verify that your Kali web server is active, open Firefox and go to *localhost/share*.
    You should see *CoolGame.apk* in the file listing.
  id: totrans-32
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为了验证Kali web服务器是否处于活动状态，打开Firefox并访问*localhost/share*。你应该能看到文件列表中的*CoolGame.apk*。
- en: 'Enter these four commands in the Metasploit terminal window to set up the listener
    for handling incoming Meterpreter connections:'
  id: totrans-33
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在Metasploit终端窗口中输入这四个命令，设置监听器以处理传入的Meterpreter连接：
- en: '[PRE3]'
  id: totrans-34
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE3]'
- en: Metasploit is now listening for incoming connections!
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: Metasploit现在正在监听传入连接！
- en: Infecting the Android VM
  id: totrans-36
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 感染Android虚拟机
- en: 'Now we’ll download the trojan app and deliberately infect your virtual Android
    device. Switch back to your Android VM and follow these steps:'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们将下载木马应用并故意感染你的虚拟Android设备。切换回你的Android虚拟机并按照以下步骤操作：
- en: Open the Chrome browser and enter your Kali VM’s IP address in the address bar,
    followed by `/share/`, like `10.0.9.4``/share/`, as shown in [Figure 9-3](#figure9-3).![f09003](image_fi/502000c09/f09003.png)
  id: totrans-38
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开Chrome浏览器，在地址栏中输入Kali虚拟机的IP地址，后面加上`/share/`，例如`10.0.9.4/share/`，如[图9-3](#figure9-3)所示。![f09003](image_fi/502000c09/f09003.png)
- en: 'Figure 9-3: Navigate to your Kali VM’s *share* folder from your Android VM’s
    Chrome browser to find your *CoolGame.apk* trojan app ready to download and install.'
  id: totrans-39
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 9-3：从 Android 虚拟机的 Chrome 浏览器中导航到 Kali 虚拟机的*共享*文件夹，找到准备下载和安装的*CoolGame.apk*
    木马应用程序。
- en: Click the APK file to download it. Android will pop up a message the first time
    you try to download a file, asking you to give Chrome permission to access file
    storage on your device. Click **Update Permissions**, then **Allow**.![g09001](image_fi/502000c09/g09001.png)
  id: totrans-40
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击 APK 文件进行下载。首次尝试下载文件时，Android 会弹出一条消息，提示你授予 Chrome 访问设备文件存储的权限。点击**更新权限**，然后点击**允许**。![g09001](image_fi/502000c09/g09001.png)
- en: Click your APK file again to download it. Chrome will usually show you the warning
    “This type of file can harm your device.” Click **OK** to download the file anyway.
  id: totrans-41
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 再次点击你的 APK 文件进行下载。Chrome 通常会显示警告：“此类文件可能会危害您的设备。”点击**确定**继续下载该文件。
- en: Click the down arrow in the upper-left corner of your Android VM’s screen, and
    you’ll see the Download Manager as shown in [Figure 9-5](#figure9-5). Click the
    name of your APK file in the list to install the app.
  id: totrans-42
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击 Android 虚拟机屏幕左上角的下拉箭头，你将看到如图 [9-5](#figure9-5) 所示的下载管理器。点击列表中的 APK 文件名称以安装该应用程序。
- en: Android will pop up yet another window telling you “your phone is not allowed
    to install unknown apps from this source.” Click **Settings**, then slide the
    toggle switch to turn on the **Allow from this source** setting.![f09005](image_fi/502000c09/f09005.png)
  id: totrans-43
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Android 将弹出另一个窗口，告诉你“您的手机不允许从此来源安装未知应用。”点击**设置**，然后滑动切换按钮以启用**允许此来源**设置。![f09005](image_fi/502000c09/f09005.png)
- en: 'Figure 9-5: Accessing the Download Manager'
  id: totrans-44
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 9-5：访问下载管理器
- en: 'Click the back button (left arrow) in the black band at the bottom of your
    Android screen, and you’ll see a list of permissions the Meterpreter trojan app,
    called MainActivity, is requesting: settings, pictures, videos, contacts, GPS,
    mic, call logs, text messages, SD card access . . . virtually every permission
    your smartphone can allow! Click **Next** at the bottom right of the permission
    window and then click **Install**. If you get a Google Play Protect warning, click
    **Install Anyway**.'
  id: totrans-45
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击 Android 屏幕底部黑色带状区域的返回按钮（左箭头），你将看到 Meterpreter 木马应用程序（名为 MainActivity）请求的权限列表：设置、图片、视频、联系人、GPS、麦克风、通话记录、短信、SD
    卡访问……几乎是你智能手机能够允许的所有权限！点击权限窗口右下角的**下一步**，然后点击**安装**。如果出现 Google Play Protect 警告，点击**继续安装**。
- en: Click the home button (the circle in the middle) at the bottom of your Android
    VM’s screen. Then click and drag the screen up to reveal your installed apps.
    Click the MainActivity icon to start the trojan app.
  id: totrans-46
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击 Android 虚拟机屏幕底部的主页按钮（中间的圆圈）。然后点击并向上拖动屏幕，显示已安装的应用程序。点击 MainActivity 图标以启动木马应用程序。
- en: Switch back to your Kali VM, and you’ll see a new session has opened in Meterpreter.
  id: totrans-47
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 切换回 Kali 虚拟机，你将看到 Meterpreter 中已打开一个新会话。
- en: Our trojan on the Android device has called home to Kali and is waiting for
    commands. Let’s see what we can do once we take control.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 我们在 Android 设备上的木马已经与 Kali 建立了联系，并在等待指令。让我们看看一旦我们接管控制，能做些什么。
- en: Controlling the Android VM
  id: totrans-49
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 控制 Android 虚拟机
- en: 'The threat from malicious mobile apps is just as real as the threat of malware
    on PCs. If you install malware on your smartphone, an attacker will have access
    to *a lot* of sensitive information: every picture and video you’ve ever taken,
    all your contacts, your call and text message history, your GPS location history,
    every web search you’ve done and YouTube video you’ve watched, and a portable
    camera and microphone an attacker could use to spy on you at any time—that’s what
    you carry with you everywhere you go.'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 恶意移动应用的威胁与 PC 上恶意软件的威胁一样真实。如果你在智能手机上安装恶意软件，攻击者将能够访问*大量*敏感信息：你拍过的每张图片和视频，所有联系人，通话和短信记录，GPS
    位置信息历史记录，所有的网页搜索和 YouTube 视频观看记录，以及一个攻击者随时可以用来监视你的便携式摄像头和麦克风——这些都是你随身携带的。
- en: 'To see exactly how much a malicious hacker can do with an app like the Meterpreter
    trojan, enter `help` in the Meterpreter terminal window. You’ll see a list of
    all available Meterpreter commands. In addition to those we saw in Chapter 6 when
    we hacked a Windows PC, there are two sections of commands just for Android devices:'
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 要查看恶意黑客能用像 Meterpreter 木马这样的应用程序做些什么，在 Meterpreter 终端窗口中输入 `help`。你将看到所有可用的
    Meterpreter 命令列表。除了我们在第 6 章中攻击 Windows PC 时看到的命令外，还有两部分专门针对 Android 设备的命令：
- en: '[PRE4]'
  id: totrans-52
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'The first thing we’ll do to take control of the Android device is prevent it
    from going to sleep. Enter this command at the Meterpreter prompt:'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 我们控制 Android 设备的第一步是防止它进入睡眠状态。在 Meterpreter 提示符下输入以下命令：
- en: '[PRE5]'
  id: totrans-54
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: Meterpreter will reply `Wakelock was acquired`, and if your Android device had
    gone to sleep or changed to a black screen before, the screen will wake up and
    the device will remain awake until you release the wakelock.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: Meterpreter 会回复 `Wakelock was acquired`，如果你的 Android 设备之前处于休眠状态或显示为黑屏，屏幕会唤醒，设备会保持清醒直到你释放
    wakelock。
- en: It’s easiest to run the Meterpreter commands and see their effect if you can
    display both the Android and Kali VMs on your screen at the same time. (This approach
    is also useful to see what the user sees while an attacker is hacking their device.)
    If you have dual monitors, put Kali on one monitor and Android on the other. If
    you have a single screen, try to fit Kali alongside Android so you can see both
    as you work.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你能在屏幕上同时显示 Android 和 Kali 虚拟机，运行 Meterpreter 命令并查看其效果会更简单。（这种方法也有助于查看攻击者在攻击用户设备时，用户看到的内容。）如果你有双显示器，可以把
    Kali 放在一个显示器上，把 Android 放在另一个。如果你只有一个显示器，尝试将 Kali 和 Android 并排放置，这样你就可以在工作时同时看到两个界面。
- en: Running Apps
  id: totrans-57
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 正在运行的应用
- en: 'Once an attacker has taken control of a mobile device, they can remotely launch
    any app they want. To see how it works, let’s list the apps the user has installed
    on their device. In the Meterpreter terminal window, enter the command `app_list`.
    Android will list every app installed on the smartphone, including both the name
    that appears on the app icon and the package Uniform Resource Identifier (URI)
    string for that app. The *URI string* is how we identify the various resources
    on an Android device. For example, you might see the YouTube app listed as follows:'
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦攻击者控制了移动设备，他们可以远程启动任何他们想要的应用。为了查看它是如何工作的，让我们列出用户在设备上安装的应用。在 Meterpreter 终端窗口中，输入命令`app_list`。Android
    会列出智能手机上安装的所有应用，包括应用图标上显示的名称和该应用的包统一资源标识符（URI）字符串。*URI 字符串*是我们识别 Android 设备上各种资源的方式。例如，你可能会看到
    YouTube 应用列出如下：
- en: '[PRE6]'
  id: totrans-59
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: The final two entries on the line tell you whether the app is running and whether
    it’s a system app installed by the operating system. Here, the `false` value tells
    us that the YouTube app is not currently running, and the `true` value indicates
    that it is a standard app installed as part of the Android operating system.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 行中的最后两项会告诉你应用是否正在运行以及它是否是操作系统安装的系统应用。在这里，`false` 值告诉我们 YouTube 应用当前没有运行，而 `true`
    值表示它是作为 Android 操作系统的一部分安装的标准应用。
- en: 'Now that we know YouTube is installed on the Android device, we can launch
    it from Meterpreter using the `app_run` command and YouTube’s package URI string.
    Enter the following:'
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们知道 YouTube 已经安装在 Android 设备上，我们可以通过 Meterpreter 使用`app_run`命令和 YouTube 的包
    URI 字符串来启动它。输入以下内容：
- en: '[PRE7]'
  id: totrans-62
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: You’ll see the YouTube app open in your Android VM! Switch back to your Android
    VM and search for the video “Bryson Payne TED Talk.” The YouTube app on your Android
    VM will pull up the video (though you probably won’t be able to hear audio through
    the VM, because VirtualBox’s drivers don’t always work for smartphone and tablet
    operating systems).
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 你会看到 YouTube 应用在你的 Android 虚拟机中打开！切换回你的 Android 虚拟机并搜索视频 “Bryson Payne TED Talk”。你在
    Android 虚拟机上的 YouTube 应用会显示该视频（尽管你可能听不到音频，因为 VirtualBox 的驱动程序并不总是适用于智能手机和平板电脑操作系统）。
- en: You can run *any app* on the infected smartphone or tablet this way, without
    the user’s permission or interaction at all. Try running several more apps, such
    as Settings (`com.android.settings`) or the Phone app (`com.android.dialer`).
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以通过这种方式在感染的智能手机或平板电脑上运行*任何应用*，完全不需要用户的许可或互动。尝试运行更多的应用，比如设置（`com.android.settings`）或电话应用（`com.android.dialer`）。
- en: 'You can also request permission to uninstall an app, but the user will be alerted.
    Try this command:'
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 你也可以请求卸载应用的权限，但用户会收到警告。尝试这个命令：
- en: '[PRE8]'
  id: totrans-66
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: Your Android VM will show a pop-up window asking if you want to uninstall Gmail,
    as shown in [Figure 9-6](#figure9-6). Click **Cancel** to keep the Gmail app on
    your device. The security settings on newer Android devices keep the Meterpreter
    trojan from uninstalling the app. However, with superuser access (which we’ll
    get in “Stealing Files and Snooping Around in Logs” on page 117), we could delete
    the app’s data and even its main program files without the user’s knowledge.
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 你的Android虚拟机会弹出一个窗口，询问你是否要卸载Gmail，如[图9-6](#figure9-6)所示。点击**取消**以保留Gmail应用在设备上。较新的Android设备的安全设置会阻止Meterpreter木马卸载该应用。不过，通过超级用户权限（我们将在“窃取文件和日志探测”章节中获得，见第117页），我们可以删除应用的数据，甚至删除其主程序文件，而用户对此一无所知。
- en: '![f09006](image_fi/502000c09/f09006.png)'
  id: totrans-68
  prefs: []
  type: TYPE_IMG
  zh: '![f09006](image_fi/502000c09/f09006.png)'
- en: 'Figure 9-6: Android asks the user’s permission before uninstalling an app.'
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 图9-6：Android在卸载应用之前会请求用户的许可。
- en: 'Before we move on to more devious hacks, let’s run one last app, Contacts:'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 在继续进行更阴险的黑客操作之前，让我们先运行最后一个应用，“联系人”：
- en: '[PRE9]'
  id: totrans-71
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: The Contacts app will open in your Android VM. While it’s open, we’ll add a
    contact so we can steal it in Meterpreter later.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: “联系人”应用将在你的Android虚拟机中打开。它打开时，我们将添加一个联系人，稍后在Meterpreter中窃取它。
- en: Click the Add Contact icon (a red circle with a plus sign, +) in the lower-right
    of your Contacts screen in Android.
  id: totrans-73
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击Android“联系人”屏幕右下角的“添加联系人”图标（一个带加号的红色圆圈，+）。
- en: Android will ask you to add an account to access your Google contacts. Click
    **Cancel**. (You don’t need to log in to your Google account to add contacts to
    your virtual smartphone.)
  id: totrans-74
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Android会要求你添加一个账户来访问Google联系人。点击**取消**。（你不需要登录Google账户就可以在虚拟智能手机中添加联系人。）
- en: The Create New Contact window will appear. Enter your name, a fake phone number
    or two, and a fake email address, as shown in [Figure 9-7](#figure9-7).
  id: totrans-75
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: “创建新联系人”窗口将出现。输入你的名字，一个或两个虚假的电话号码，以及一个虚假的电子邮件地址，如[图9-7](#figure9-7)所示。
- en: Click **Save** to store the new contact on your Android VM. Click the back arrow
    at the bottom of your Android screen if you’d like to add more contacts.
  id: totrans-76
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**保存**将新联系人存储在你的Android虚拟机中。如果你想添加更多联系人，请点击Android屏幕底部的返回箭头。
- en: '![f09007](image_fi/502000c09/f09007.png)'
  id: totrans-77
  prefs: []
  type: TYPE_IMG
  zh: '![f09007](image_fi/502000c09/f09007.png)'
- en: 'Figure 9-7: Using the Contacts app to add a new contact with fake information'
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 图9-7：使用“联系人”应用添加带有虚假信息的新联系人
- en: Accessing Contacts
  id: totrans-79
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 访问联系人
- en: 'Meterpreter has several commands for accessing the sensitive data we store
    in our smartphones. Run `help` in the Meterpreter console in Kali and look for
    several commands that begin with `dump`:'
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: Meterpreter有多个命令用于访问我们存储在智能手机中的敏感数据。在Kali的Meterpreter控制台中运行`help`，查找以`dump`开头的几个命令：
- en: '[PRE10]'
  id: totrans-81
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: Since our Android VM isn’t a physical Android device, we can’t make calls or
    receive text messages, but we did add a contact in the previous section. Let’s
    steal it now.
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 由于我们的Android虚拟机不是一台真实的Android设备，因此无法打电话或接收短信，但我们已经在前一部分中添加了一个联系人。现在我们来窃取它。
- en: 'Run the `dump_contacts` command in Meterpreter:'
  id: totrans-83
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在Meterpreter中运行`dump_contacts`命令：
- en: '[PRE11]'
  id: totrans-84
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE11]'
- en: Meterpreter will respond with the number of contacts it found, along with the
    filename where it saved those contacts on your Kali machine.
  id: totrans-85
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: Meterpreter会显示它找到的联系人数量，并显示保存这些联系人的文件名以及该文件存储在你Kali机器上的位置。
- en: 'Open a second terminal window in your Kali VM and enter `cd` to change into
    your home directory. Then enter the command `ls con*` to list any contact files
    Meterpreter dumped there:'
  id: totrans-86
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在Kali虚拟机中打开第二个终端窗口，并输入`cd`命令切换到你的主目录。然后输入命令`ls con*`列出Meterpreter保存的任何联系人文件：
- en: '[PRE12]'
  id: totrans-87
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE12]'
- en: You’ll see a *.txt* file named *contacts_dump_* followed by a timestamp (year,
    month, day, and time in numeric format).
  id: totrans-88
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 你会看到一个*.txt*文件，文件名为*contacts_dump_*，后面跟着时间戳（年、月、日和时间的数字格式）。
- en: 'Enter `cat con` and press **TAB** to autocomplete the contacts filename, and
    then press **ENTER** to display the contents of the file:'
  id: totrans-89
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入`cat con`并按**TAB**键自动完成联系人文件名，然后按**ENTER**键显示文件内容：
- en: '[PRE13]'
  id: totrans-90
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE13]'
- en: An attacker can see the full contact information of every person listed in your
    smartphone’s Contacts app, in addition to reading your text messages and seeing
    every phone call you’ve made recently!
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 攻击者可以查看智能手机“联系人”应用中每个联系人完整的联系信息，还能读取你的短信和查看你最近打过的所有电话！
- en: Spying Through the Camera
  id: totrans-92
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 通过摄像头进行间谍监视
- en: If an attacker gains remote control of your smartphone, they can hijack the
    device’s camera and/or microphone. As we’ll see, this kind of spying is disturbingly
    easy.
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 如果攻击者远程控制了你的智能手机，他们可以劫持设备的摄像头和/或麦克风。正如我们将看到的，这种间谍行为令人不安地简单。
- en: If you’ve got a webcam, connect it to the Android VM by going to the menu bar
    of your VM under **Devices**▶**Webcams** and selecting its name.
  id: totrans-94
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果您有摄像头，可以通过虚拟机菜单栏中的**设备**▶**网络摄像头**来将其连接到Android虚拟机，并选择其名称。
- en: After attaching the webcam, reboot your Android VM (select **Machine**▶**Reset**
    and click the **reset** button). Then rerun the trojan by clicking the MainActivity
    app.
  id: totrans-95
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在连接摄像头后，重启您的Android虚拟机（选择**机器**▶**重置**并点击**重置**按钮）。然后通过点击MainActivity应用程序重新运行木马。
- en: In Metasploit, press **ENTER** after the error `Meterpreter session closed`
    and then enter the command `exploit`.
  id: totrans-96
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在Metasploit中，按下**ENTER**键后出现错误`Meterpreter session closed`，然后输入命令`exploit`。
- en: 'When the new Meterpreter session starts, enter the command `webcam_list` to
    see your camera listed:'
  id: totrans-97
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 当新的Meterpreter会话启动时，输入命令`webcam_list`查看您的摄像头是否已列出：
- en: '[PRE14]'
  id: totrans-98
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'Use the command `webcam_stream` to view a live feed from the camera:'
  id: totrans-99
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用命令`webcam_stream`查看来自摄像头的实时视频流：
- en: '[PRE15]'
  id: totrans-100
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE15]'
- en: The webcam will begin streaming video (slowly) to your Kali VM through the Firefox
    browser, until you close the web browser video stream and press CTRL-C (on Windows)
    or CONTROL-C (on macOS) in the Meterpreter terminal to stop the stream.
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 网络摄像头将开始将视频（较慢）通过Firefox浏览器流式传输到您的Kali虚拟机，直到您关闭Web浏览器视频流，并在Meterpreter终端中按CTRL-C（在Windows上）或CONTROL-C（在macOS上）停止视频流。
- en: As you can see, an attacker can stream video from your smartphone’s webcam if
    your device is ever compromised through an exploit like the one we built, just
    like they can access your laptop or desktop webcam. But unlike with your computer’s
    webcam, you probably take your smartphone with you *everywhere*, as do your friends
    and family. Most of us don’t want to cover the camera on our smartphone like we
    do with our laptop, so it’s even more important to be careful which apps we install
    on our smartphones and what permissions we give them.
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 如您所见，如果您的设备通过像我们构建的利用程序被攻破，攻击者可以通过智能手机的网络摄像头流式传输视频，就像他们可以访问您的笔记本或台式机摄像头一样。但与您的计算机摄像头不同，您可能会*随时*携带您的智能手机，您的朋友和家人也是如此。我们大多数人不希望像遮挡笔记本电脑摄像头那样遮挡智能手机的摄像头，因此更加重要的是小心我们安装的应用程序以及我们授予它们的权限。
- en: Stealing Files and Snooping Around in Logs
  id: totrans-103
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 盗取文件和查看日志
- en: Just as we did in our Windows 10 hack, we can upload and download files from
    the Android device’s storage using the upload and download commands. We can even
    access protected, sensitive files using the device’s shell terminal if the user
    gives us superuser access.
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 就像我们在Windows 10黑客攻击中所做的那样，我们可以使用上传和下载命令从Android设备的存储中上传和下载文件。如果用户授权超级用户权限，我们甚至可以通过设备的shell终端访问受保护的敏感文件。
- en: 'Enter `shell` in Meterpreter to enter the Android terminal shell:'
  id: totrans-105
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在Meterpreter中输入`shell`以进入Android终端shell：
- en: '[PRE16]'
  id: totrans-106
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'The Android shell doesn’t show a prompt at the beginning of the line, so your
    cursor will be on a blank line. Enter the commands `cd /` and `ls` to change directories
    to the root */* directory and list all folders on the device:'
  id: totrans-107
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Android shell在行首不会显示提示符，因此光标会位于空白行。输入命令`cd /`和`ls`以切换到根目录`/*`并列出设备上的所有文件夹：
- en: '[PRE17]'
  id: totrans-108
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE17]'
- en: The *data* folder contains a treasure trove of user data, including the user’s
    YouTube, browser, and other app history files. Remember when we ran the YouTube
    app and searched for “Bryson Payne TED Talk”? If an app stores a log or history
    file with recent search results, we can access those files as long as the user
    grants administrator or superuser privileges to the app.
  id: totrans-109
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '*data*文件夹包含大量用户数据，包括用户的YouTube、浏览器和其他应用程序历史文件。还记得我们在运行YouTube应用时搜索“Bryson Payne
    TED Talk”吗？如果某个应用存储了带有最近搜索结果的日志或历史文件，只要用户授予应用管理员或超级用户权限，我们就可以访问这些文件。'
- en: Enter `su` into the Meterpeter Android shell to request superuser access.
  id: totrans-110
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在Meterpreter Android shell中输入`su`请求超级用户权限。
- en: '[PRE18]'
  id: totrans-111
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE18]'
- en: Immediately in the Android VM, you’ll see the permissions window pop up, as
    shown in [Figure 9-8](#figure9-8). Click **Allow** to give Meterpreter superuser
    access.![f09008](image_fi/502000c09/f09008.png)
  id: totrans-112
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在Android虚拟机中，您将看到权限窗口弹出，如[图9-8](#figure9-8)所示。点击**允许**以授予Meterpreter超级用户权限。![f09008](image_fi/502000c09/f09008.png)
- en: 'Figure 9-8: Giving Meterpreter superuser access'
  id: totrans-113
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图9-8：授予Meterpreter超级用户权限
- en: 'Change directories into */data/data/com.google.android.youtube* and list the
    directory contents with `ls`:'
  id: totrans-114
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用`cd /data/data/com.google.android.youtube`进入目录，并通过`ls`列出该目录内容：
- en: '[PRE19]'
  id: totrans-115
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE19]'
- en: The *databases* folder contains various files used by the app, including one
    that stores the YouTube search history. To find that file, enter the commands
    `cd databases` and `ls`.
  id: totrans-116
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '*databases*文件夹包含应用程序使用的各种文件，其中包括一个存储YouTube搜索历史的文件。要找到该文件，输入命令`cd databases`和`ls`。'
- en: '[PRE20]'
  id: totrans-117
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE20]'
- en: In the short list of files that appears, you’ll find the *history.db* file.
    Run the command `cat history.db` to view the device’s YouTube Search history.
  id: totrans-118
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在出现的文件短列表中，你会找到*history.db*文件。运行命令`cat history.db`查看设备的YouTube搜索历史记录。
- en: '[PRE21]'
  id: totrans-119
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE21]'
- en: Because this is a special database-formatted file, not all of the characters
    are printable, but look at the last line or two—our search for “Bryson Payne TED
    Talk” is viewable in plaintext! If you search for other videos on YouTube and
    then rerun that last command (`cat history.db`), you’ll see new results added
    to the file.
  id: totrans-120
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 因为这是一个特殊的数据库格式文件，并非所有字符都是可打印的，但请查看最后一两行——我们搜索的“Bryson Payne TED Talk”可以以明文查看！如果你在YouTube上搜索其他视频，然后重新运行上面的命令(`cat
    history.db`)，你将看到新结果被添加到文件中。
- en: 'Now we’ll download the YouTube search history file to the Kali VM. First, we
    need to copy it to the Metasploit trojan app’s *files* folder:'
  id: totrans-121
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在我们将下载YouTube搜索历史记录文件到Kali虚拟机。首先，我们需要将其复制到Metasploit木马应用的*files*文件夹中：
- en: '[PRE22]'
  id: totrans-122
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE22]'
- en: 'Next, we need to grant access to the copied file:'
  id: totrans-123
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，我们需要授予对复制文件的访问权限：
- en: '[PRE23]'
  id: totrans-124
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE23]'
- en: Exit the Android shell by pressing CTRL-C (CONTROL-C on a Mac). Meterpreter
    will respond with a prompt asking if you want to terminate the *channel*, or shell
    connection. Enter `y`.
  id: totrans-125
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 按CTRL-C（Mac上是CONTROL-C）退出Android shell。Meterpreter会提示是否终止*channel*（即shell连接）。输入`y`。
- en: '[PRE24]'
  id: totrans-126
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE24]'
- en: 'You’ll now drop back into a regular Meterpreter prompt, where you can download
    the YouTube history file to your Kali VM’s home (*/home/kali/*) folder:'
  id: totrans-127
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你现在将回到普通的Meterpreter提示符，在哪里你可以将YouTube历史文件下载到Kali虚拟机的主文件夹（*/home/kali/*）：
- en: '[PRE25]'
  id: totrans-128
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE25]'
- en: In a separate terminal window, type `ls` to confirm that the *history.db* file
    downloaded successfully. Then enter `cat history.db` and you’ll see the same file
    contents you saw in the Android shell, with the user’s YouTube search history
    in plaintext.
  id: totrans-129
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在一个单独的终端窗口中，输入`ls`确认*history.db*文件已成功下载。然后输入`cat history.db`，你将看到与在Android shell中看到的相同的文件内容，其中包含用户的YouTube搜索历史记录的明文。
- en: Malicious hackers can use this technique to save a record of your YouTube search
    history. If you were a forensic data analyst working for the FBI or on a company’s
    security team, however, you could use the same technique to discover whether a
    criminal had watched YouTube videos to learn how to make a bomb or commit another
    crime.
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 恶意黑客可以使用这种技术保存你的YouTube搜索历史记录。然而，如果你是FBI的法医数据分析师或某公司的安全团队成员，你也可以使用相同的技术来发现犯罪分子是否观看了YouTube视频，学习如何制造炸弹或实施其他犯罪。
- en: Turning Off the Ringer and More
  id: totrans-131
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 关闭铃声及更多设置
- en: 'You can change settings with Meterpreter and prevent the user from being able
    to change them back. For example, you can turn off the ringer on the Android VM
    by entering the following command in Meterpreter:'
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以通过Meterpreter更改设置，并防止用户恢复这些设置。例如，你可以通过在Meterpreter中输入以下命令关闭Android虚拟机的铃声：
- en: '[PRE26]'
  id: totrans-133
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: In your Android VM, swipe up on your home screen and select **Settings**. Search
    for “ring” and click **Ring volume** to open the Sound settings. The Ring volume
    has been turned off, as shown in [Figure 9-9](#figure9-9).
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 在你的Android虚拟机中，向上滑动主屏幕并选择**设置**。搜索“铃声”，点击**铃声音量**打开声音设置。铃声音量已经关闭，如[图9-9](#figure9-9)所示。
- en: '![f09009](image_fi/502000c09/f09009.png)'
  id: totrans-135
  prefs: []
  type: TYPE_IMG
  zh: '![f09009](image_fi/502000c09/f09009.png)'
- en: 'Figure 9-9: When we turn off the ring volume in Meterpreter, the user can’t
    turn it back on from the Settings screen!'
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 图9-9：当我们在Meterpreter中关闭铃声音量时，用户无法从设置界面重新打开它！
- en: Try to slide the Ring volume slider to the right or left. You won’t be able
    to! Meterpreter has locked the ring volume off by turning on a “Do not disturb”
    mode (much like sliding the mute switch on some smartphones). The user will have
    to find “Do not disturb” under Settings and turn it off to regain control of their
    smartphone’s ring volume.
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 尝试将铃声音量滑块向右或向左滑动。你将无法做到！Meterpreter通过开启“请勿打扰”模式（就像某些智能手机上滑动静音开关一样）将铃声音量锁定为关闭。用户必须在设置中找到“请勿打扰”并关闭它，才能恢复对智能手机铃声音量的控制。
- en: There’s another change we can make that the user can’t override. You might have
    already thought to yourself, *If I saw an app I didn’t recognize, like MainActivity,
    I’d probably delete it*. So let’s hide the MainActivity app icon to make it harder
    for the user to delete our trojan app.
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 还有另一个我们可以做的更改，用户无法覆盖。你可能已经想到，*如果我看到一个不认识的应用，比如MainActivity，我可能会删除它*。所以，让我们隐藏MainActivity应用图标，让用户更难删除我们的木马应用。
- en: 'In Meterpreter, enter the following command to hide the MainActivity trojan
    app from the user’s list of installed apps:'
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 在Meterpreter中，输入以下命令将MainActivity木马应用从用户的已安装应用列表中隐藏：
- en: '[PRE27]'
  id: totrans-140
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: Switch back to your Android VM, click the home button, and swipe up to show
    your apps. The MainActivity app will disappear from the list, as shown in [Figure
    9-10](#figure9-10).
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 切换回Android虚拟机，点击主页按钮并向上滑动以显示你的应用。MainActivity应用将从列表中消失，如[图9-10](#figure9-10)所示。
- en: '![f09010](image_fi/502000c09/f09010.png)'
  id: totrans-142
  prefs: []
  type: TYPE_IMG
  zh: '![f09010](image_fi/502000c09/f09010.png)'
- en: 'Figure 9-10: Hiding our MainActivity app icon from the user’s screen'
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 图9-10：隐藏用户屏幕上的MainActivity应用图标
- en: By hiding the app icon, we’ve made it difficult for the user to uninstall the
    trojan app. If an attacker hides the app icon at the very beginning, the user
    might not even know the trojan app had been installed! The user can still uninstall
    the trojan app, however, even if they can’t see it. Go to **Settings**▶**App info**,
    click **MainActivity**, and click **Uninstall**. Notice that stopping or uninstalling
    the app closes the Meterpreter session in the Kali VM. To reinstall the trojan
    app, go to your *Downloads* folder in Android and click the *CoolGame.apk* file
    like we did earlier.
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 通过隐藏应用图标，我们让用户难以卸载木马应用。如果攻击者一开始就隐藏了应用图标，用户甚至可能不知道木马应用已经被安装！然而，用户仍然可以卸载木马应用，即使他们看不见它。只需进入**设置**▶**应用信息**，点击**MainActivity**，然后点击**卸载**。请注意，停止或卸载应用会关闭Kali虚拟机中的Meterpreter会话。要重新安装木马应用，请像之前那样，进入Android的*下载*文件夹并点击*CoolGame.apk*文件。
- en: Defending Against Malicious Apps
  id: totrans-145
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 防御恶意应用
- en: To protect yourself from malicious apps, be careful about which apps you allow
    onto your smartphone. In short, think before you install! Use Google Play Protect
    on your Android device and view each security pop-up as a chance to reconsider
    what you’re doing. Even better, don’t download apps over the web or outside the
    Google Play Store, Apple’s App Store (if you’re on an iPhone), or your smartphone
    manufacturer’s store.
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 为了保护自己免受恶意应用的侵害，务必小心你允许安装到智能手机上的应用。简而言之，安装之前先考虑清楚！在Android设备上使用Google Play Protect，并将每一个安全弹窗视为重新考虑自己行为的机会。更好的是，避免从网上下载应用，或者从Google
    Play商店、Apple的App Store（如果你使用的是iPhone）或智能手机制造商的商店以外的地方下载应用。
- en: Malicious apps can make it into official app stores, though. That’s why it’s
    important to read which permissions an app is requesting when you install it.
    A game or simple app shouldn’t need access to your contacts, call logs, or text
    messages, and other than augmented-reality or location-based apps like *Pokémon
    Go*, an app shouldn’t require your location. If an app asks for more permissions
    than you think it should need, delete it and find one that does what you want
    with fewer permissions. Similarly, if an app you’ve installed ever asks for additional
    permissions—especially if it asks for superuser access—you can cancel the request
    or even delete the app. You *never* have to give more permission to an app than
    you want to, and most apps function perfectly well without being granted extensive
    permissions.
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 恶意应用也有可能进入官方应用商店。因此，在安装应用时，阅读该应用请求的权限非常重要。一款游戏或简单的应用不应该需要访问你的联系人、通话记录或短信，除非是增强现实或基于位置的应用，如*Pokémon
    Go*，应用不应该需要你的位置信息。如果一个应用请求的权限比你认为它应该需要的多，删除它，找一个权限较少却能完成你想要的功能的应用。同样地，如果你安装的应用之后请求额外的权限，尤其是请求超级用户权限时，你可以取消请求，甚至删除该应用。你*永远*不必给应用授权超出你想要的权限，大多数应用在没有授权过多权限的情况下也能正常运行。
- en: If you ever see apps opening on your smartphone that you didn’t open (like when
    we used Meterpreter to open YouTube on the Android VM), turn your smartphone off
    completely (don’t just turn off the screen). Press the power button on the side
    or top of the phone along with the volume up button for several seconds until
    the screen goes black (this works on most Android devices), or search (using a
    different device) for how to reboot or reset your specific device. It might also
    be a good idea to install a security app if you spot any suspicious activity on
    your smartphone or tablet. There are free or low-cost antivirus apps for most
    mobile devices that can detect malicious processes or communications if your smartphone
    ever gets hacked through an app.
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你看到智能手机上出现你没有打开的应用（就像我们使用Meterpreter在Android虚拟机上打开YouTube时那样），立即将手机完全关闭（不要只是关闭屏幕）。按住手机侧面或顶部的电源键和音量增加键几秒钟，直到屏幕变黑（大多数Android设备都适用），或者使用其他设备搜索如何重启或重置你的设备。如果你在手机或平板上发现任何可疑活动，安装安全应用程序可能是个好主意。大多数移动设备都有免费或低成本的杀毒应用，能够检测恶意进程或通信，防止手机通过应用被黑客攻击。
- en: Finally, just like on your desktop or laptop, don’t click suspicious links in
    emails or text messages. You can use VirusTotal to check most links by copying
    and pasting, just like you can on a desktop, but on your smartphone, you need
    to be even more careful about clicking malicious links. Remember, an attacker
    can access a lot of personal information (and even track your location!) if they’re
    able to trick you into clicking a bad link or installing a malicious app. So tell
    your friends, your family members, and other people you care about to be suspicious
    of any links they get via text message or email and to think before they install
    an app, especially if it’s from an unknown source.
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，就像在桌面或笔记本电脑上一样，不要点击电子邮件或短信中的可疑链接。你可以使用 VirusTotal 来检查大多数链接，只需复制粘贴，就像在桌面上操作一样，但在智能手机上，你需要更加小心点击恶意链接。记住，如果攻击者能够欺骗你点击恶意链接或安装恶意应用，他们可以访问大量个人信息（甚至追踪你的定位！）。因此，告诉你的朋友、家人和你关心的其他人对任何通过短信或电子邮件收到的链接保持怀疑，并在安装应用时三思，尤其是当它来自未知来源时。
- en: The Takeaway
  id: totrans-150
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 重点总结
- en: In this chapter, you created an Android virtual machine that looks and works
    just like a real Android smartphone or tablet. You used Metasploit to create a
    Meterpreter remote access trojan for Android, almost exactly the same way you
    did for Windows 10 in Chapter 6, and you installed and launched the trojan on
    the Android VM. Once you gained control of the Android device, you saw how an
    attacker can run apps, steal contacts, upload and download files, hijack your
    camera, and snoop around in your search history.
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，你创建了一个与真实 Android 智能手机或平板电脑完全相似且功能相同的 Android 虚拟机。你使用 Metasploit 创建了一个
    Meterpreter 远程访问木马，几乎与第六章中为 Windows 10 创建的方式完全相同，并且你在 Android 虚拟机上安装并启动了木马。一旦你控制了
    Android 设备，你就看到了攻击者如何运行应用程序、窃取联系人、上传和下载文件、劫持相机并窃听你的搜索历史。
- en: You also learned that the best way to defend your mobile devices from malware
    is to avoid installing untrusted apps. Even if an app looks legitimate, delete
    or uninstall it if the app asks for more permissions than it needs. If your smartphone
    starts acting weird, reboot it, delete all suspicious apps, and consider installing
    a security app like an antivirus scanner if you suspect you accidentally installed
    malware.
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 你还学到了，防止移动设备感染恶意软件的最佳方法是避免安装不受信任的应用程序。即使一个应用看起来合法，如果它请求的权限超过了需要的范围，删除或卸载它。如果你的智能手机开始出现异常，重启它，删除所有可疑的应用程序，并在怀疑不小心安装了恶意软件时，考虑安装像防病毒扫描器这样的安全应用。
- en: In the next chapter, you’ll try one last hacking activity. You’ll see that hacking
    doesn’t apply just to computers, smartphones, and tablets. You can also use the
    tools in your Kali Linux VM to hack other network-connected devices in the world
    around you, from smart TVs to video game consoles and beyond. To prove it, we’ll
    hack a car!
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章，你将尝试最后一个黑客活动。你会发现黑客攻击不仅限于计算机、智能手机和平板电脑。你还可以使用 Kali Linux 虚拟机中的工具，攻击你周围世界中其他联网设备，从智能电视到视频游戏主机，甚至更远。为了证明这一点，我们将黑进一辆汽车！
