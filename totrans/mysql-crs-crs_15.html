<html><head></head><body>
<div id="book-content">
<div id="sbo-rt-content"><section>
<header>
<h1 class="chapter">
<span class="ChapterNumber"><span epub:type="pagebreak" title="195" id="Page_195"/><a class="XrefDestination" id="12"/><span class="XrefDestination" id="xref-503007c12-001"/>12</span><br/>
<span class="ChapterTitle"><a class="XrefDestination" id="CreatingTriggers"/><span class="XrefDestination" id="xref-503007c12-002"/>Creating Triggers</span></h1>
</header>
<figure class="opener">
<img src="image_fi/book_art/chapterart.png" alt="" width="200" height="200"/>
</figure>
<p class="ChapterIntro">In this chapter, you’ll create triggers, database objects that automatically <em>fire</em>, or execute, before or after a row is inserted, updated, or deleted from a table, and perform the functionality you’ve defined. Every trigger is associated with one table.</p>
<p>Triggers are most often used to track changes made to a table or to enhance the data’s quality before it’s saved to the database.</p>
<p>Like functions and procedures, triggers are saved in the database in which you create them.</p>
<h2 id="h1-503007c12-0001"><a class="XrefDestination" id="TriggersThatAuditData"/><span class="XrefDestination" id="xref-503007c12-003"/>Triggers That Audit Data</h2>
<p class="BodyFirst">You’ll first use triggers to track changes to a database table by creating a second <em>audit table</em> that logs which user changed which piece of data and saves the date and time of the change.</p>
<p><span epub:type="pagebreak" title="196" id="Page_196"/>Take a look at the following <code>payable</code> table in a company’s <code>accounting</code> database.</p>
<pre><code>payable_id  company            amount   service
----------- -------           -------   ------------------------
     1      Acme HVAC          123.32   Repair of Air Conditioner
     2      Initech Printers  1459.00   Printer Repair
     3      Hooli Cleaning     398.55   Janitorial Services</code></pre>
<p>To create an audit table that tracks any changes made to the <code>payable</code> table, enter the following:</p>
<pre><code>create table payable_audit
  (
    audit_datetime  datetime,
    audit_user      varchar(100),
    audit_change    varchar(500)
  );</code></pre>
<p>You’ll create triggers so that when changes are made to the <code>payable</code> table, a record of the changes is saved to the <code>payable_audit</code> table. You’ll save the date and time of the change to the <code>audit_datetime</code> column; the user who made the change to the <code>audit_user</code> column; and a text description of what changed to the <code>audit_change</code> column.</p>
<p>Triggers can be set to fire either before or after rows are changed. The first set of triggers you’ll create are <em>after</em> triggers. You’ll set three triggers to fire after changes are made to data in the <code>payable</code> table.</p>
<h3 id="h2-503007c12-0001"><a class="XrefDestination" id="AfterInsertTriggers"/><span class="XrefDestination" id="xref-503007c12-004"/>After Insert Triggers</h3>
<p class="BodyFirst">An <em>after insert</em> trigger (indicated in the code by the suffix <code>_ai</code>) fires after a row is inserted. <a href="#listing12-1" id="listinganchor12-1">Listing 12-1</a> shows how to create an after insert trigger for the <code>payable</code> table.</p>
<pre><code>use accounting;

drop trigger if exists tr_payable_ai;

delimiter //

<span class="CodeAnnotationHang" aria-label="annotation1">❶</span> create trigger tr_payable_ai
<span class="CodeAnnotationCode" aria-label="annotation2">❷</span> after insert on payable
<span class="CodeAnnotationCode" aria-label="annotation3">❸</span> for each row
begin
<span class="CodeAnnotationCode" aria-label="annotation4">❹</span> insert into payable_audit
  (
    audit_datetime,
    audit_user,
    audit_change
  )
  values
  (
    now(),
<span epub:type="pagebreak" title="197" id="Page_197"/>    user(),
    concat(
     'New row for payable_id ',
    <span class="CodeAnnotationCode" aria-label="annotation5">❺</span> new.payable_id,
      '. Company: ',
      new.company,
      '. Amount: ',
      new.amount,
      '. Service: ',
      new.service
    )
  );
end//

delimiter ;</code></pre>
<p class="CodeListingCaption"><a id="listing12-1">Listing 12-1</a>: Creating an after insert trigger</p>
<p>First you create your trigger and call it <code>tr_payable_ai</code> <span class="CodeAnnotation" aria-label="annotation1">❶</span>. Next, you specify the <code>after</code> keyword to indicate when the trigger should fire <span class="CodeAnnotation" aria-label="annotation2">❷</span>. In this example, a row will be inserted into the <code>payable</code> table and <em>then</em> the trigger will fire, writing the audit row to the <code>payable_audit</code> table.</p>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="note">
<h2><span class="NoteHead">NOTE</span></h2>
<p>	I find it helpful to prefix my triggers with <code>tr_</code>, followed by the name of the table I’m tracking, followed by an abbreviation that says when the trigger will fire. These abbreviations include <code>_bi</code> (before insert), <code>_ai</code> (after insert), <code>_bu</code> (before update), <code>_au</code> (after update), <code>_bd</code> (before delete), and <code>_ad</code> (after delete). You’ll learn what all these triggers mean throughout this chapter.</p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<p>In the trigger, for each row <span class="CodeAnnotation" aria-label="annotation3">❸</span> that gets inserted into the <code>payable</code> table, MySQL will run the code between the <code>begin</code> and <code>end</code> statements. All triggers will include the <code>for each row</code> syntax.</p>
<p>You insert a row into the <code>payable_audit</code> table with an <code>insert</code> statement that calls three functions: <code>now()</code> to get the current date and time; <code>user()</code> to get the username of the user who inserted the row; and <code>concat()</code> to build a string describing the data that was inserted into the <code>payable</code> table <span class="CodeAnnotation" aria-label="annotation4">❹</span>.</p>
<p>When writing triggers, you use the <code>new</code> keyword to access the new values being inserted into the table <span class="CodeAnnotation" aria-label="annotation5">❺</span>. For example, you got the new <code>payable_id</code> value by referencing <code>new.payable_id</code>, and the new <code>company</code> value by referencing <code>new.company</code>.</p>
<p>Now that you have the trigger in place, try inserting a row into the <code>payable</code> table to see if the new row automatically gets tracked in the <code>payable_audit</code> table:</p>
<pre><code>insert into payable
  (
    payable_id,
    company,
    amount,
    service
  )
values
  (
<span epub:type="pagebreak" title="198" id="Page_198"/>    4,
    'Sirius Painting',
    451.45,
    'Painting the lobby'
  );

select * from payable_audit;</code></pre>
<p>The results show that your trigger worked. Inserting a new row into the <code>payable</code> table caused your <code>tr_payable_ai</code> trigger to fire, which inserted a row into your <code>payable_audit</code> audit table:</p>
<pre><code>audit_datetime       audit_user      audit_change
-------------------  --------------  -----------------------------------------
2024-04-26 10:43:14  rick@localhost  New row for payable_id 4.
                                     Company: Sirius Painting. Amount: 451.45.
                                     Service: Painting the lobby</code></pre>
<p>The <code>audit_datetime</code> column shows the date and time that the row was inserted. The <code>audit_user</code> column shows the username and the host of the user who inserted the row (the <em>host</em> is the server where the MySQL database resides). The <code>audit_change</code> column contains a description of the added row you built with the <code>concat()</code> function.</p>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="boxcustom1">
<h2>Try it Yourself</h2>
<p class="BoxBodyFirst">The <code>jail</code> database has a table called <code>alcatraz_prisoner</code> that contains the following data:</p>
<pre><code>prisoner_id  prisoner_name
-----------  -------------
     85      Al Capone
    594      Robert Stroud
   1476      John Anglin</code></pre>
<p class="BoxListNumberCustom1"><b>12-1.</b>	Create an audit table called <code>alcatraz_prisoner_audit</code> in the <code>jail</code> database. Create the table with these columns: <code>audit_datetime</code>, <code>audit_user</code>, and <code>audit_change</code>.</p>
<p class="BoxListNumberCustom1"><b>12-2.</b>	Write an after insert trigger called <code>tr_alcatraz_prisoner_ai</code> that tracks new rows inserted into the <code>alcatraz_prisoner</code> table to the <code>alcatraz_prisoner_audit</code> table.</p>
<p class="ListBody">You can test the trigger by inserting a new row into <code>alcatraz_prisoner</code>, like so:</p>
<pre><code>insert into alcatraz_prisoner
  (
    prisoner_id,
    prisoner_name
  )
<span epub:type="pagebreak" title="199" id="Page_199"/>values
  (
    117,
    'Machine Gun Kelly'
  );</code></pre>
<p class="ListBody">Check to see that the new row was tracked to the <code>alcatraz_prisoner_audit</code> table by selecting from it:</p>
<pre><code>select * from alcatraz_prisoner_audit;</code></pre>
<p class="ListBody">Do you see an audit row for <code>Machine Gun Kelly</code>?</p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<h3 id="h2-503007c12-0002"><a class="XrefDestination" id="AfterDeleteTriggers"/><span class="XrefDestination" id="xref-503007c12-006"/>After Delete Triggers</h3>
<p class="BodyFirst">Now you’ll write an <em>after delete </em>trigger (specified in code with the suffix <code>_ad</code>) that will log any rows that are deleted from the <code>payable</code> table to the <code>payable_audit</code> table (<a href="#listing12-2" id="listinganchor12-2">Listing 12-2</a>).</p>
<pre><code>use accounting;

drop trigger if exists tr_payable_ad;

delimiter //

create trigger <b>tr_payable_ad</b>
<b>  after delete on payable</b>
  for each row
begin
  insert into payable_audit
    (
      audit_date,
      audit_user,
      audit_change
    )
  values
    (
      now(),
      user(),
      concat(
       'Deleted row for payable_id ',
     <span class="CodeAnnotationCode" aria-label="annotation1">❶</span> old.payable_id,
       '. Company: ',
       old.company,
       '. Amount: ',
       old.amount,
       '. Service: ',
       old.service
<span epub:type="pagebreak" title="200" id="Page_200"/>    )
  );
end//

delimiter ;</code></pre>
<p class="CodeListingCaption"><a id="listing12-2">Listing 12-2</a>: Creating an after delete trigger</p>
<p>The <code>delete</code> trigger looks similar to the <code>insert</code> trigger except for a few differences; namely, you used the <code>old</code> keyword <span class="CodeAnnotation" aria-label="annotation1">❶</span> instead of <code>new</code>. Since this trigger fires when a row is deleted, there are only <code>old</code> values for the columns.</p>
<p>With your after delete trigger in place, delete a row from the <code>payable</code> table and see if the deletion gets logged in the <code>payable_audit</code> table:</p>
<pre><code>delete from payable where company = 'Sirius Painting';</code></pre>
<p>The results are:</p>
<pre><code>audit_datetime       audit_user      audit_change
-------------------  --------------  -----------------------------------------
2024-04-26 10:43:14  rick@localhost  New row for payable_id 4.
                                     Company: Sirius Painting. Amount: 451.45.
                                     Service: Painting the lobby
2024-04-26 10:47:47  rick@localhost  Deleted row for payable_id 4.
                                     Company: Sirius Painting. Amount: 451.45.
                                     Service: Painting the lobby</code></pre>
<p>The trigger worked! The <code>payable_audit</code> table still contains the row you inserted into the <code>payable</code> table, but you also have a row that tracked the deletion.</p>
<p>Regardless of whether rows get inserted or deleted, you’re logging the changes to the same <code>payable_audit</code> table. You included the text <code>New row</code> or <code>Deleted row</code> as part of your <code>audit_change</code> column value to clarify the action taken.</p>
<h3 id="h2-503007c12-0003"><a class="XrefDestination" id="AfterUpdateTriggers"/><span class="XrefDestination" id="xref-503007c12-007"/>After Update Triggers</h3>
<p class="BodyFirst">To write an <em>after</em> <em>update </em>trigger (<code>_au</code>) that will log any rows that are updated in the <code>payable</code> table to the <code>payable_audit</code> table, enter the code in <a href="#listing12-3" id="listinganchor12-3">Listing 12-3</a>.</p>
<pre><code>use accounting;

drop trigger if exists tr_payable_au;

delimiter //

create trigger <b>tr_payable_au</b>
<b>  after update on payable</b>
  for each row
begin
  <span class="CodeAnnotationCode" aria-label="annotation1">❶</span> set @change_msg =
       concat(
              'Updated row for payable_id ',
<span epub:type="pagebreak" title="201" id="Page_201"/>              old.payable_id
       );

<span class="CodeAnnotationCode" aria-label="annotation2">❷</span> if (old.company != new.company) then
    set @change_msg =
         concat(
              @change_msg,
              '. Company changed from ',
              old.company,
              ' to ',
              new.company
         );
  end if;

  if (old.amount != new.amount) then
    set @change_msg =
         concat(
              @change_msg,
              '. Amount changed from ',
              old.amount,
              ' to ',
              new.amount
         );
  end if;

  if (old.service != new.service) then
    set @change_msg =
         concat(
              @change_msg,
              '. Service changed from ',
              old.service,
              ' to ',
              new.service
         );
  end if;

<span class="CodeAnnotationCode" aria-label="annotation3">❸</span> insert into payable_audit
       (
      audit_datetime,
      audit_user,
      audit_change
    )
  values
    (
       now(),
       user(),
       @change_msg
  );

end//

delimiter ;</code></pre>
<p class="CodeListingCaption"><a id="listing12-3">Listing 12-3</a>: Creating an after update trigger</p>
<p><span epub:type="pagebreak" title="202" id="Page_202"/>You declare this trigger to fire after an update to the <code>payable</code> table. When you update a row in a table, you can update one or more of its columns. You design your after update trigger to show only the column values that changed in the <code>payable</code> table. For example, if you didn’t change the <code>service</code> column, you won’t include any text about the <code>service</code> column in the <code>payable_audit</code> table.</p>
<p>You create a user variable called <code>@change_msg</code> <span class="CodeAnnotation" aria-label="annotation1">❶</span> (for <em>change message</em>) that you use to build a string that contains a list of every updated column. You check whether each column in the <code>payable</code> table has changed. If the old <code>company</code> column value is different from the new <code>company</code> column value, you add the text <code>Company changed from </code><var>old value</var><code> to </code><var>new value</var> to the <code>@change_msg</code> variable <span class="CodeAnnotation" aria-label="annotation2">❷</span>. You then do the same thing with the <code>amount</code> and <code>service</code> columns, adjusting the message text accordingly. When you’re done, the value of <code>@change_msg</code> is inserted into the <code>audit_change</code> column of the <code>payable_audit</code> table <span class="CodeAnnotation" aria-label="annotation3">❸</span>.</p>
<p>With your after update trigger in place, see what happens when a user updates a row in the <code>payable</code> table:</p>
<pre><code>update payable
set    amount = 100000,
       company = 'House of Larry'
where  payable_id = 3;</code></pre>
<p>The first two rows in the <code>payable_audit</code> table are still in the results, along with a new row that tracked the <code>update</code> statement:</p>
<pre><code>audit_datetime       audit_user      audit_change
-------------------  --------------  -----------------------------------------
2024-04-26 10:43:14  rick@localhost  New row for payable_id 4.
                                     Company: Sirius Painting. Amount: 451.45.
                                     Service: Painting the lobby
2024-04-26 10:47:47  rick@localhost  Deleted row for payable_id 4.
                                     Company: Sirius Painting. Amount: 451.45.
                                     Service: Painting the lobby
2024-04-26 10:49:20  larry@localhost Updated row for payable_id 3. Company
                                     changed from Hooli Cleaning to House of
                                     Larry. Amount changed from 4398.55 to
                                     100000.00</code></pre>
<p>It seems that a user named <code>larry@localhost</code> updated a row, changed the <code>amount</code> to $100,000, and changed the <code>company</code> that will be paid to <code>House of Larry</code>. Hmmm . . .</p>
<h2 id="h1-503007c12-0002"><a class="XrefDestination" id="TriggersThatAffectData"/><span class="XrefDestination" id="xref-503007c12-008"/>Triggers That Affect Data</h2>
<p class="BodyFirst">You can also write triggers that fire <em>before</em> rows are changed in a table, to change the data that gets written to tables or prevent rows from being inserted or deleted. This can help improve the quality of your data before you save it to the database.</p>
<p><span epub:type="pagebreak" title="203" id="Page_203"/>Create a <code>credit</code> table in the <code>bank</code> database that will store customers and their credit scores:</p>
<pre><code>create table credit
  (
    customer_id    int,
    customer_name  varchar(100),
    credit_score   int
  );</code></pre>
<p>As with after triggers, there are three before triggers that will fire before a row is inserted, deleted, or updated.</p>
<h3 id="h2-503007c12-0004"><a class="XrefDestination" id="BeforeInsertTriggers"/><span class="XrefDestination" id="xref-503007c12-009"/>Before Insert Triggers</h3>
<p class="BodyFirst">The <em>before insert</em> trigger (<code>_bi</code>) fires before a new row is inserted. <a href="#listing12-4" id="listinganchor12-4">Listing 12-4</a> shows how to write a before insert trigger to make sure no scores outside of the 300–850 range (the lowest possible credit score and the highest) get inserted into the <code>credit</code> table.</p>
<pre><code>use bank;

delimiter //

<span class="CodeAnnotationHang" aria-label="annotation1">❶</span> create trigger tr_credit_bi
<span class="CodeAnnotationCode" aria-label="annotation2">❷</span> before insert on credit
  for each row
begin
<span class="CodeAnnotationCode" aria-label="annotation3">❸</span> if (new.credit_score &lt; 300) then
    set new.credit_score = 300;
  end if;

<span class="CodeAnnotationCode" aria-label="annotation4">❹</span> if (new.credit_score &gt; 850) then
    set new.credit_score = 850;
  end if;

end//

delimiter ;</code></pre>
<p class="CodeListingCaption"><a id="listing12-4">Listing 12-4</a>: Creating a before insert trigger</p>
<p>First, you name the trigger <code>tr_credit_bi</code> <span class="CodeAnnotation" aria-label="annotation1">❶</span> and define it as a <code>before insert</code> trigger <span class="CodeAnnotation" aria-label="annotation2">❷</span> so that it will fire before rows are inserted into the <code>credit</code> table. Because this is an insert trigger, you can take advantage of the <code>new</code> keyword by checking if <code>new.credit_score</code>—the value about to be inserted into the <code>credit</code> table—is less than 300. If so, you set it to exactly <code>300</code> <span class="CodeAnnotation" aria-label="annotation3">❸</span>. You do a similar check for credit scores over 850, changing their value to exactly <code>850</code> <span class="CodeAnnotation" aria-label="annotation4">❹</span>.</p>
<p>Insert some data into the <code>credit</code> table and see what effect your trigger has:</p>
<pre><code>insert into credit
  (
    customer_id,
<span epub:type="pagebreak" title="204" id="Page_204"/>    customer_name,
    credit_score
  )
values
  (1, 'Milton Megabucks',   987),
  (2, 'Patty Po',           145),
  (3, 'Vinny Middle-Class', 702);</code></pre>
<p>Now take a look at the data in the <code>credit</code> table:</p>
<pre><code>select * from credit;</code></pre>
<p>The result is:</p>
<pre><code>customer_id  customer_name       credit_score
-----------  ------------------  ------------
     1       Milton Megabucks        850
     2       Patty Po                300
     3       Vinny Middle-Class      702</code></pre>
<p>Your trigger worked. It changed the credit score for Milton Megabucks from <code>987</code> to <code>850</code> and the credit score for Patti Po from <code>145</code> to <code>300</code> just before those values were inserted into the <code>credit</code> table.</p>
<h3 id="h2-503007c12-0005"><a class="XrefDestination" id="BeforeUpdateTriggers"/><span class="XrefDestination" id="xref-503007c12-010"/>Before Update Triggers</h3>
<p class="BodyFirst">The <em>before update</em> trigger (<code>_bu</code>) fires before a table is updated. You already wrote a trigger that prevents an <code>insert</code> statement from setting a credit score outside of the 300–850 range, but it’s possible that an <code>update</code> statement could update a credit score value outside of that range too. <a href="#listing12-5" id="listinganchor12-5">Listing 12-5</a> shows how to create a <code>before</code> <code>update</code> trigger to solve this.</p>
<pre><code>use bank;

delimiter //

create trigger <b>tr_credit_bu</b>
<b>  before update on credit</b>
  for each row
begin
  if (new.credit_score &lt; 300) then
    set new.credit_score = 300;
  end if;

  if (new.credit_score &gt; 850) then
    set new.credit_score = 850;
  end if;

end//

delimiter ;</code></pre>
<p class="CodeListingCaption"><a id="listing12-5">Listing 12-5</a>: Creating a before update trigger</p>
<p><span epub:type="pagebreak" title="205" id="Page_205"/>Update a row to test your trigger:</p>
<pre><code>update credit
set    credit_score = 1111
where  customer_id = 3;</code></pre>
<p>Now take a look at the data in the <code>credit</code> table:</p>
<pre><code>select * from credit;</code></pre>
<p>The result is:</p>
<pre><code>customer_id  customer_name       credit_score
-----------  ------------------  ------------
     1       Milton Megabucks        850
     2       Patty Po                300
     3       Vinny Middle-Class      850</code></pre>
<p>It worked. The trigger would not let you update the credit score for <code>Vinny Middle-Class</code> to <code>1111</code>. Instead, it set the value to <code>850</code> before updating the row in the table.</p>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="boxcustom1">
<h2>Try it Yourself</h2>
<p class="BoxBodyFirst">The <code>exam</code> database has a table called <code>grade</code> that contains the following data:</p>
<pre><code>student_name  score
------------  -----
   Billy        79
   Jane         87
   Paul         93</code></pre>
<p>The teacher’s policy is that students who scored less than <code>50</code> points will be given a score of <code>50</code>. Students who got all questions correct—including extra credit—cannot get a score higher than <code>100</code>.</p>
<p class="BoxListNumberCustom1"><b>12-3.</b>	Write an update trigger called <code>tr_grade_bu</code> that changes scores under <code>50</code> to <code>50</code>, and scores over <code>100</code> to <code>100</code>.</p>
<p class="ListBody">You can test the trigger by updating the scores in the table like so:</p>
<pre><code>update grade set score = 38  where student_name = 'Billy';
update grade set score = 107 where student_name = 'Jane';
update grade set score = 95  where student_name = 'Paul';</code></pre>
<p class="ListBody">Now check the values in the <code>grade</code> table:</p>
<pre><code>select * from grade;</code></pre>
<p class="ListBody"><span epub:type="pagebreak" title="206" id="Page_206"/>You should see these results:</p>
<pre><code>student_name  score
------------  -----
   Billy        50
   Jane        100
   Paul         95</code></pre>
<p class="ListBody">The trigger should have set Billy’s score to <code>50</code>, Jane’s to <code>100</code>, and Paul’s to <code>95</code>.</p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<h3 id="h2-503007c12-0006"><a class="XrefDestination" id="BeforeDeleteTriggers"/><span class="XrefDestination" id="xref-503007c12-012"/>Before Delete Triggers</h3>
<p class="BodyFirst">Lastly, a <em>before delete</em> trigger (<code>_bd</code>) will fire before a row is deleted from a table. You can use a before delete trigger as a check before you allow the row to be deleted.</p>
<p>Say your bank manager asked you to write a trigger that prevents users from deleting any customers from the <code>credit</code> table that have a credit score over 750. You can achieve this by writing a before delete trigger as shown in <a href="#listing12-6" id="listinganchor12-6">Listing 12-6</a>.</p>
<pre><code>use bank;

delimiter //

create trigger <b>tr_credit_bd</b>
<b>  before delete on credit</b>
  for each row
begin
<span class="CodeAnnotationCode" aria-label="annotation1">❶</span> if (old.credit_score &gt; 750) then
    signal sqlstate '45000'
    set message_text = 'Cannot delete scores over 750';
  end if;
end//

delimiter ;</code></pre>
<p class="CodeListingCaption"><a id="listing12-6">Listing 12-6</a>: Creating a before delete trigger</p>
<p>If the credit score of the row you’re about to delete is over 750, the trigger returns an error <span class="CodeAnnotation" aria-label="annotation1">❶</span>. You use a <code>signal</code> statement, which handles returning an error, followed by the <code>sqlstate</code> keyword and code. A <em>sqlstate code</em> is a five-character code that identifies a particular error or a warning. Since you’re creating your own error, you use <code>45000</code>, which represents a user-defined error. Then, you define the <code>message_text</code> to display your error message.</p>
<p>Test your trigger by deleting some rows from the <code>credit</code> table:</p>
<pre><code>delete from credit where customer_id = 1;</code></pre>
<p><span epub:type="pagebreak" title="207" id="Page_207"/>Since customer <code>1</code> has a credit score of 850, the result is:</p>
<pre><code>Error Code: 1644. Cannot delete scores over 750</code></pre>
<p>Your trigger worked. It prevented the deletion of the row because the credit score was over 750.</p>
<p>Now delete the row for customer <code>2</code>, who has a credit score of 300:</p>
<pre><code>delete from credit where customer_id = 2;</code></pre>
<p>You get a message back informing you that the row was deleted:</p>
<pre><code>1 row(s) affected.</code></pre>
<p>Your trigger is working as you intended. It allowed you to delete the row for customer <code>2</code> because their credit score was not more than 750, but prevented you from deleting customer <code>1</code> because their credit score was over 750.</p>
<h2 id="h1-503007c12-0003"><a class="XrefDestination" id="Summary"/><span class="XrefDestination" id="xref-503007c12-013"/>Summary</h2>
<p class="BodyFirst">In this chapter, you created triggers that automatically fire and perform tasks you define. You learned the differences between before and after triggers, and the three types of each. You used triggers to track changes to tables, prevent particular rows from being deleted, and control ranges of allowed values.</p>
<p>In the next chapter, you’ll learn how to use MySQL events to schedule tasks.</p>
</section>
</div>
</div>
</body></html>