<?xml version='1.0' encoding='utf-8'?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" epub:prefix="z3998: http://www.daisy.org/z3998/2012/vocab/structure/#" lang="en" xml:lang="en">
  <head>
    <title>Project 3: LED Dimmer Switch</title>
    <link href="../styles/9781593278717.css" rel="stylesheet" type="text/css"/>
    <link href="../68851547a55f.css" rel="stylesheet" type="text/css"/>
  </head>
  <body>
    <div id="sbo-rt-content"><h2 class="h2" id="ch03"><span epub:type="pagebreak" id="page_52"/><strong>3<br/>LED Dimmer Switch</strong></h2>
<p class="noindent"><span class="green1">In this project, you’ll build a light dimmer by controlling the brightness of an LED using a potentiometer. The power in this project lies in your ability to read analog inputs with the Raspberry Pi and output pulse-width modulation signals. These will be incredibly useful skills in future projects and in your Pi learning.</span></p>
<div class="image"><span epub:type="pagebreak" id="page_53"/><img src="../images/f0053-01.jpg" alt="image"/></div>
<p class="cap"><span class="green1"><strong>PARTS REQUIRED</strong></span></p>
<p class="cap1">Raspberry Pi</p>
<p class="cap1">Breadboard</p>
<p class="cap1">10 kΩ potent iometer</p>
<p class="cap1">MCP 3008 chip</p>
<p class="cap1">5 mm LED</p>
<p class="cap1">330 Ω resistor</p>
<p class="cap1">Jumper wires</p>
<h3 class="h3" id="lev39"><span epub:type="pagebreak" id="page_54"/><span class="green1"><strong>INTRODUCING POTENTIOMETERS</strong></span></h3>
<p class="noindent">Potentiometers are like power dials and are used in a wide variety of applications in your daily life, such as controlling the volume of the radio, adjusting the brightness of a display, setting the speed on a fan, and much more. The potentiometer you’ll use in this project is shown in <a href="ch03.xhtml#ch03fig1">Figure 3-1</a>.</p>
<div class="image"><a id="ch03fig1"/><img src="../images/f0054-01.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 3-1:</strong> A 10 kΩ potentiometer</p>
<p class="indent">A potentiometer, also referred to as <em>pot</em>, is a manually adjustable variable resistor. This means that you can change the amount of resistance it applies to a circuit by rotating the knob, changing the amount of current reaching a particular component.</p>
<p class="indent">A potentiometer has three pins, as shown in <a href="ch03.xhtml#ch03fig2">Figure 3-2</a>. The two outer pins, shown in blue and red, are connected to a resistive element, while the third, shown in black, is connected to a conductive adjustable <em>wiper</em>.</p>
<div class="image"><a id="ch03fig2"/><img src="../images/f0054-02.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 3-2:</strong> How a potentiometer works</p>
<p class="indent">The position of the wiper determines how much resistance is in the circuit. In this project, you’ll control the resistance in the circuit to make the LED brighter or dimmer.</p>
<h3 class="h3" id="lev40"><span epub:type="pagebreak" id="page_55"/><span class="green1"><strong>READING ANALOG SIGNALS WITH RASPBERRY PI</strong></span></h3>
<p class="noindent">The Raspberry Pi GPIOs can read only digital signals, which means they can read either HIGH (3.3 V ) or LOW (0 V ) but nothing in between. However, the potentiometer is an analog input, and rotating the knob changes its output voltage from 0 V up to 3.3 V. You want the Pi to be able to read all the values in between—like 1 V, 1.4 V, 1.8 V, and so on—so you have gradations of light, not just on and off. For this, you need to convert the analog signal to digital with an analog-to-digital converter chip, and then create imitation analog signals using pulse-width modulation. Let’s go over these two topics before you begin your build.</p>
<h4 class="h4" id="lev41"><span class="green1"><strong>Analog-to-Digital Converters</strong></span></h4>
<p class="noindent">The analog-to-digital converter (ADC) chip (MCP3008), shown in <a href="ch03.xhtml#ch03fig3">Figure 3-3</a>, converts the potentiometer analog signals to digital signals.</p>
<div class="image"><a id="ch03fig3"/><img src="../images/f0055-01.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 3-3:</strong> MCP3008 chip analog-to-digital converter</p>
<p class="indent">This chip has 16 pins, 8 of which are analog inputs you can connect to analog devices. The other 8 connect to the Raspberry Pi GPIOs. The chip pinout is shown in <a href="ch03.xhtml#ch03fig4">Figure 3-4</a>. To identify each pin, orient the chip with the half-circle at the top as shown in the figure.</p>
<div class="image"><a id="ch03fig4"/><img src="../images/f0055-02.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 3-4:</strong> MCP3008 chip</p>
<p class="indent">The following table gives the function for each pin.</p>
<table class="topbot-d">
<thead>
<tr>
<td style="vertical-align: top;" class="border_thb"><p class="tab_th"><span epub:type="pagebreak" id="page_56"/><strong>PIN</strong></p></td>
<td style="vertical-align: top;" class="border_tha"><p class="tab_th"><strong>SYMBOL</strong></p></td>
<td style="vertical-align: top;" class="border_thb"><p class="tab_th"><strong>DESCRIPTION</strong></p></td>
</tr>
</thead>
<tbody>
<tr>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">1</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="green1">CH0</span></p></td>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">Analog input (channel 0)</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">2</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="green1">CH1</span></p></td>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">Analog input (channel 1)</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">3</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="green1">CH2</span></p></td>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">Analog input (channel 2)</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">4</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="green1">CH3</span></p></td>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">Analog input (channel 3)</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">5</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="green1">CH4</span></p></td>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">Analog input (channel 4)</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">6</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="green1">CH5</span></p></td>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">Analog input (channel 5)</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">7</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="green1">CH6</span></p></td>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">Analog input (channel 6)</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">8</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="green1">CH7</span></p></td>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">Analog input (channel 7)</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">9</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="green1">DGND</span></p></td>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">Digital ground</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">10</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="green1">CS/SHDN</span></p></td>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">Chip select/shutdown input</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">11</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="green1">D<sub>IN</sub></span></p></td>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">Serial data in</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">12</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="green1">D<sub>OUT</sub></span></p></td>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">Serial data out</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">13</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="green1">CLK</span></p></td>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">Serial clock</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">14</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="green1">AGND</span></p></td>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">Analog ground</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">15</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="green1">V<sub>REF</sub></span></p></td>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">Reference voltage input</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">16</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="green1">V<sub>DD</sub></span></p></td>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">+2.7 V to 5.5 V power supply</span></p></td>
</tr>
</tbody>
</table>
<h4 class="h4" id="lev42"><span class="green1"><strong>Pulse-Width Modulation</strong></span></h4>
<p class="noindent">As we mentioned earlier, the Raspberry Pi GPIOs can be set to either HIGH or LOW, but they can’t output any voltages in between. However, you can output “fake” mid-level voltages using <em>pulse-width modulation (PWM)</em>, which is how you’ll produce varying levels of LED brightness for this project.</p>
<p class="indent">If you alternate an LED’s voltage between HIGH and LOW very fast, your eyes can’t keep up with the speed at which the LED switches on and off; you’ll simply see some gradations in brightness. That’s basically how PWM works—by producing an output that changes between HIGH and LOW at a very high <em>frequency</em>. The <em>duty cycle</em> is the fraction of the period of time at which the LED is set to HIGH. <a href="ch03.xhtml#ch03fig5">Figure 3-5</a> illustrates how PWM works.</p>
<div class="image"><span epub:type="pagebreak" id="page_57"/><a id="ch03fig5"/><img src="../images/f0057-01.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 3-5:</strong> How PWM works</p>
<p class="indent">A duty cycle of 50 percent results in 50 percent LED brightness, a duty cycle of 0 means the LED is fully off, and a duty cycle of 100 means the LED is fully on. Changing the duty cycle is how you produce different levels of brightness.</p>
<h3 class="h3" id="lev43"><span class="green1"><strong>WIRING THE CIRCUIT</strong></span></h3>
<p class="noindent">For this circuit you’ll need to connect an LED, the MCP3008 chip, and a potentiometer to the Pi. Follow these instructions to build the circuit, using <a href="ch03.xhtml#ch03fig6">Figure 3-6</a> as a reference.</p>
<ol>
<li class="noindent"><p class="list">Connect GND to the blue breadboard rail.</p></li>
<li class="noindent"><p class="list">Connect 3.3 V to the red breadboard rail.</p></li>
<li class="noindent"><p class="list">Insert an LED into the breadboard, connecting the longer LED lead to GPIO 17 through a 330 Ω resistor and the shorter lead to the GND rail.</p></li>
<li class="noindent"><p class="list">Place the MCP3008 chip in the middle of the breadboard and connect it as shown in the following table.</p>
<table class="topbot-d">
<thead>
<tr>
<td style="vertical-align: top;" class="border_thb"><p class="tab_th"><span epub:type="pagebreak" id="page_58"/><strong>MCP3008</strong></p></td>
<td style="vertical-align: top;" class="border_tha"><p class="tab_th"><strong>RASPBERRY PI</strong></p></td>
</tr>
</thead>
<tbody>
<tr>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">1</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="green1">Potentiometer middle lead</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">9</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="green1">GND</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">10</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="green1">GPIO 8</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">11</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="green1">GPIO 10</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">12</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="green1">GPIO 9</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">13</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="green1">GPIO 11</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">14</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="green1">GND</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">15</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="green1">3.3 V</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">16</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="green1">3.3 V</span></p></td>
</tr>
</tbody>
</table>
<div class="note">
<p class="notet"><strong>NOTE</strong></p>
<p class="notep"><em>Before applying power to the circuit, make sure you’ve connected the MCP3008 chip correctly using the pinout in <a href="ch03.xhtml#ch03fig4">Figure 3-4</a>, or you could damage the chip.</em></p>
</div></li>
<li class="noindent"><p class="list">Connect one of the outer leads of the potentiometer to GND and the other to 3.3 V—it doesn’t matter which lead you use for which connection. Connect the middle lead to MCP3008 chip pin 1 if you haven’t already.</p></li>
</ol>
<div class="image"><a id="ch03fig6"/><img src="../images/f0058-01.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 3-6:</strong> Circuit to control the LED brightness with a potentiometer</p>
<h3 class="h3" id="lev44"><span class="green1"><strong>WRITING THE SCRIPT</strong></span></h3>
<p class="noindent">The Pi reads the analog values from the MCP3008 chip using SPI communication, so you’ll need to enable that first.</p>
<p class="indent">From the taskbar main menu, select <strong>Preferences</strong> <span class="ent">▸</span> <strong>Raspberry Pi Configuration</strong>. In the Interfaces tab, enable SPI as shown in <a href="ch03.xhtml#ch03fig7">Figure 3-7</a> and click <strong>OK</strong>.</p>
<div class="image"><span epub:type="pagebreak" id="page_59"/><a id="ch03fig7"/><img src="../images/f0059-01.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 3-7:</strong> Enabling SPI communication</p>
<p class="indent">Your script needs to be able to do the following:</p>
<ul>
<li class="noindent">Read an analog input value from the potentiometer through the MCP3008 chip.</li>
<li class="noindent">Control the brightness of your LED with PWM.</li>
<li class="noindent">Change the duty cycle of the PWM according to the input value read from the potentiometer.</li>
</ul>
<h4 class="h4" id="lev45"><span class="green1"><strong>Entering the Script</strong></span></h4>
<p class="noindent">Open <strong>Python 3 (IDLE)</strong> and go to <strong>File</strong> <span class="ent">▸</span> <strong>New File</strong> to create a new script. Copy the following code to the Python Editor and save the script as <em>brightness_controller.py</em> inside the <em>LEDs</em> folder (remember that you can download all the scripts at <em><a href="https://www.nostarch.com/RaspberryPiProject/">https://www.nostarch.com/RaspberryPiProject/</a></em>):</p>
<div class="box">
<pre>  <span class="red1">#import necessary libraries</span><br/>  <span class="orange">from</span> gpiozero <span class="orange">import</span> PWMLED, MCP3008<br/>  <span class="orange">from</span> time <span class="orange">import</span> sleep<br/><br/>  <span class="red1">#create an object called pot that refers to MCP3008 channel 0</span><br/><span class="ent">➊</span> pot = MCP3008(0)<br/><br/>  <span class="red1">#create a PWMLED object called led that refers to GPIO 17</span><br/><span class="ent">➋</span> led = PWMLED(17)<br/><br/><span class="ent">➌</span> <span class="orange">while True</span>:<br/>      <span class="red1">#pot.value accesses the current pot reading</span><br/>    <span class="ent">➍</span> <span class="orange">if</span>(pot.value &lt; 0.001):<br/>          <span class="red1">#if the pot value is very small, the led is turned off</span><br/>        <span class="ent">➎</span> led.value = 0<br/>    <span class="ent">➏</span> <span class="orange">else</span>:<br/>          <span class="red1">#change led brightness according to the pot value</span><br/>          led.value = pot.value<br/>      <span class="red1">#print the pot value</span><br/>      <span epub:type="pagebreak" id="page_60"/><span class="purple">print</span>(pot.value)<br/>      <span class="red1">#pause for 0.1 seconds</span><br/>      sleep(0.1)</pre>
</div>
<p class="indent">As usual, you start your code by importing the required libraries. Then you create an object called <code>pot</code> <span class="ent">➊</span> that refers to MCP3008 channel 0, the channel the potentiometer is connected to. Channel 0 corresponds to MCP3008 pin 1, channel 1 to pin 2, and so on.</p>
<h5 class="h5"><strong>Setting a PWM Pin and Reading Analog Values</strong></h5>
<p class="noindent">The gpiozero library allows you to control an LED’s brightness with PWM by using a <code>PWMLED</code> object. So at <span class="ent">➋</span>, you create a <code>PWMLED</code> object called <code>led</code> that refers to the pin the LED is connected to, in this case, GPIO17.</p>
<p class="indent">To read an analog value using the gpiozero library, you simply get the potentiometer value with <code>pot.value</code>. Remember that <code>pot</code> refers to MCP3008 channel 0. You’ll get decimal values between <code>0</code> and <code>1</code>.</p>
<h5 class="h5"><strong>Adjusting the Brightness</strong></h5>
<p class="noindent">To adjust the LED brightness using PWM, you need to change its duty cycle. To adjust the duty cycle, you simply have to attribute a value between <code>0</code> and <code>1</code> to the <code>led.value</code>, in which <code>0</code> corresponds to a fully off LED and <code>1</code> to a fully on LED.</p>
<p class="indent">In this script, a <code>while</code> loop <span class="ent">➌</span> that is always <code>True</code> keeps the program running. This loop is constantly checking the potentiometer values: if the value read from the potentiometer is below <code>0.001</code> <span class="ent">➍</span>, the duty cycle is set to <code>0</code>, which turns your LED off <span class="ent">➎</span>. Otherwise, the code enters the <code>else</code> block <span class="ent">➏</span>, in which the duty cycle changes according to the value read from the potentiometer.</p>
<h4 class="h4" id="lev46"><span class="green1"><strong>Running the Script</strong></span></h4>
<p class="noindent">Press <strong>F5</strong> or go to <strong>Run</strong> <span class="ent">▸</span> <strong>Run Module</strong> to run the script. Now you should be able to rotate the potentiometer to control the brightness of the LED.</p>
<h3 class="h3" id="lev47"><span class="green1"><strong>TAKING IT FURTHER</strong></span></h3>
<p class="noindent">Knowing how to read analog values and control output pins with PWM opens you up to a huge variety of projects. Give some of these a try for starters:</p>
<ul>
<li class="noindent">Control several LEDs with the same potentiometer.</li>
<li class="noindent">Build a bar graph of LEDs that you can control with a potentiometer.</li>
<li class="noindent">Control the blinking speed of an LED using a potentiometer.</li>
</ul>
</div>
  </body>
</html>
