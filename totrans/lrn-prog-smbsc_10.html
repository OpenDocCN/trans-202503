<html><head></head><body>
<h2 class="h2" id="ch10"><span epub:type="pagebreak" id="page_129"/><span class="big"><span class="blue"><strong>10</strong></span></span><br/><strong>SOLVING PROBLEMS WITH SUBROUTINES</strong></h2>&#13;
<div class="imagec"><img alt="image" src="graphics/common01.jpg"/></div>&#13;
<p class="noindent">The programs you’ve written so far are short and easy to understand. But as you start dealing with more complex problems, you’ll need to write longer programs. Understanding long programs can be a challenge, because you’ll need to keep track of many different parts of the program. In this chapter, you’ll learn how to organize your programs into smaller pieces.</p>&#13;
<p class="indent">An approach known as <em>structured programming</em> started in the mid-1960s to simplify the process of writing, understanding, and maintaining computer programs. Instead of writing a single, large program, you divide your program into smaller pieces. Each piece solves one part of the overall task, and <em>subroutines</em> implement these smaller pieces as part of a long program.</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_130"/>Subroutines are basic building blocks for creating large programs (see <a href="ch10.html#ch10fig1">Figure 10-1</a>). In this chapter, you’ll delve into the wild world of subroutines, learn how to move data in and out of them, and use them to build large programs and fun games!</p>&#13;
<div class="image"><img alt="image" src="graphics/f10-01.jpg"/></div>&#13;
<p class="figcap"><a id="ch10fig1"/><em>Figure 10-1: Subroutines are the building blocks of larger programs</em></p>&#13;
<h3 class="h3" id="ch10lev1sec01"><span class="blue"><strong>Why Use Subroutines?</strong></span></h3>&#13;
<p class="noindent">Let’s say you run a construction company. Your job is to coordinate the work among your contractors and build houses. As a manager, you don’t have to know all the nitty-gritty details of building a home: the plumber handles the plumbing, the roofer shingles the roof, and the electrician runs all the wires. Each contractor knows their job and is always ready to work when they receive your call.</p>&#13;
<p class="indent">That’s very similar to how subroutines work! Each subroutine has its own name, like how the plumber’s name is Mario. Each subroutine does something different, just like how the plumber and the roofer have different jobs, but all are needed to build the house. As the programmer, you’re the manager, and your job is to solve problems as you build your program. You call your contractors (that is, your subroutines) and let them know when you need them to work (see <a href="ch10.html#ch10fig2">Figure 10-2</a>). You start writing the program by typing statements in the editor. When you need to perform a job that a subroutine handles, you just call that subroutine and wait. When the subroutine completes its task, you move on to the next step in your program.</p>&#13;
<div class="image"><img alt="image" src="graphics/f10-02.jpg"/></div>&#13;
<p class="figcap"><a id="ch10fig2"/><em>Figure 10-2: The boss (main program) calling the Bob subroutine</em></p>&#13;
<p class="indent">There’s nothing new about this call-and-wait strategy; you’ve been doing it since <a href="ch01.html#ch01">Chapter 1</a>. When you call an object’s method, you’re actually giving the work to that object in the Small Basic library. Subroutines are like methods, but <em>you</em> have to write all the statements in the subroutines. Subroutines help you organize your thinking process and make it easier to fix errors.</p>&#13;
<h3 class="h3" id="ch10lev1sec02"><span class="blue"><strong>Writing Subroutines</strong></span></h3>&#13;
<p class="noindent">Let’s use a fun example to learn how to write a subroutine: in his travels, Gulliver had dinner with the king and queen of Lilliput (the land of tiny people). During dinner, the king explained that he was 8.5 glum-gluffs tall. <span epub:type="pagebreak" id="page_131"/>Gulliver later learned that 1 glum-gluff is about 0.75 inches. To find out how the sizes of items in Lilliput compare to sizes in our land, write the program in <a href="ch10.html#ch10ex1">Listing 10-1</a>, which converts glum-gluffs to inches.</p>&#13;
<p class="programs">1 <span class="green"><span class="codeitalic">' GlumGluff.sb</span></span><br/>2 <span class="blue1">TextWindow</span><span class="brown">.Write(</span><span class="red">"How many glum-gluffs? "</span><span class="brown">)</span><br/>3 glumGluffs <span class="brown">=</span> <span class="blue1">TextWindow</span><span class="brown">.ReadNumber()</span><br/>4<br/>5 inches <span class="brown">=</span> <span class="red">0.75</span> <span class="brown">*</span> glumGluffs               <span class="green"><span class="codeitalic">' Converts to inches</span></span><br/>6 inches <span class="brown">=</span> <span class="blue1">Math</span><span class="brown">.Round(</span>inches <span class="brown">*</span> <span class="red">100</span><span class="brown">) /</span> <span class="red">100</span>  <span class="green"><span class="codeitalic">' Rounds to 2 decimal places</span></span><br/>7 <span class="blue1">TextWindow</span><span class="brown">.WriteLine(</span><span class="red">"That's about "</span> <span class="brown">+</span> inches <span class="brown">+</span> <span class="red">" inches."</span><span class="brown">)</span></p>&#13;
<p class="listcap"><a id="ch10ex1"/><em>Listing 10-1: Converting measurements</em></p>&#13;
<p class="indent">This program looks just like the ones you’re already used to! You prompt the user to enter the glum-gluff measurement (line 2), read the input into the <code>glumGluffs</code> variable (line 3), convert the input number to inches (line 5), round the answer to two decimal places (line 6), and then display the result (line 7). Run the program to figure out how tall the king is in inches; remember that he’s 8.5 glum-gluffs tall.</p>&#13;
<p class="indent">Next, let’s rewrite this program and put the conversion statements (lines 5–6) in a subroutine named <code>GlumGluffToInch()</code>. Enter the code in <a href="ch10.html#ch10ex2">Listing 10-2</a>.</p>&#13;
<p class="programs"> 1 <span class="green"><span class="codeitalic">' GlumGluff2.sb</span></span><br/> 2 <span class="blue1">TextWindow</span><span class="brown">.Write(</span><span class="red">"How many glum-gluffs? "</span><span class="brown">)</span><br/> 3 glumGluffs <span class="brown">=</span> <span class="blue1">TextWindow</span><span class="brown">.ReadNumber()</span><br/> 4<br/> 5 GlumGluffToInch<span class="brown">()</span>    <span class="green"><span class="codeitalic">' Calls the subroutine</span></span><br/> 6 <span class="blue1">TextWindow</span><span class="brown">.WriteLine(</span><span class="red">"That's about "</span> <span class="brown">+</span> inches <span class="brown">+</span> <span class="red">" inches."</span><span class="brown">)</span><br/> 7<br/> 8 <span class="green"><span class="codeitalic">' This subroutine converts from glum-gluffs to inches</span></span><br/> 9 <span class="green"><span class="codeitalic">' Input: glumGluff; the size in glum-gluff units</span></span><br/>10 <span class="green"><span class="codeitalic">' Output: inches; the size in inches rounded to 2 decimal places</span></span><br/>11 <span class="purple"><span class="codestrong">Sub</span></span> GlumGluffToInch<br/>12   inches <span class="brown">=</span> <span class="red">0.75</span> <span class="brown">*</span> glumGluffs<br/>13   inches <span class="brown">=</span> <span class="blue1">Math</span><span class="brown">.Round(</span>inches <span class="brown">*</span> <span class="red">100</span><span class="brown">) /</span> <span class="red">100</span><br/>14 <span class="purple"><span class="codestrong">EndSub</span></span></p>&#13;
<p class="listcap"><a id="ch10ex2"/><em>Listing 10-2: Calling a subroutine</em></p>&#13;
<p class="indent">This code does the same thing as the code in <a href="ch10.html#ch10ex1">Listing 10-1</a>, but it uses a subroutine. A subroutine is a collection of statements that do a specific job (just like hiring Mario the plumber to build a fancy toilet). In this case, your subroutine converts glum-gluffs to inches. The statements that make up the subroutine are sandwiched between the <code>Sub</code> and <code>EndSub</code> keywords (lines 11–14). The subroutine’s name comes after the <code>Sub</code> keyword (line 11). When you define the subroutine, don’t put parentheses after its name.</p>&#13;
<p class="indent">But just because you define a subroutine doesn’t mean your program will run it. To run a subroutine, you need to <em>call</em> (or <em>invoke</em>) it! To call a subroutine, you type its name followed by parentheses (line 5). The statement <span epub:type="pagebreak" id="page_132"/>on line 5 means “run the subroutine named <code>GlumGluffToInch()</code>, and then return to the line that comes after this subroutine call” (which is line 6 in this example). It’s like taking a break from cleaning your room to go watch some TV and then coming back to pick up where you left off. <a href="ch10.html#ch10fig3">Figure 10-3</a> shows how a subroutine works in a program.</p>&#13;
<div class="image"><img alt="image" src="graphics/f10-03.jpg"/></div>&#13;
<p class="figcap"><a id="ch10fig3"/><em>Figure 10-3: Showing how</em> GlumGuff2.sb <em>calls the</em> <code><span class="codeitalic">GlumGluffToInch()</code></span> <em>subroutine</em></p>&#13;
<p class="indent">Here is one example of output from this program:</p>&#13;
<p class="programs">How many glum-gluffs? <span class="codestrong">8.5</span><br/>That's about 6.38 inches.</p>&#13;
<p class="indent">A subroutine can access all the variables in the main program, and the main program can access all the variables in a subroutine. The variable <code>glumGluffs</code> was created and assigned a value in the main program (line 3), but it was used by the subroutine to know how many glum-gluffs it needs to convert (line 12). And the variable <code>inches</code> was created inside the subroutine (line 12), but the main program reads it and displays its value to the user (line 6).</p>&#13;
<p class="indent">Here are some good reasons to put the unit conversion code into a subroutine:</p>&#13;
<ol>&#13;
<li><p class="noindenta">You isolate (or separate) the unit conversion details from the main program. The main program now doesn’t have to worry about how the conversion is done. This makes your code easier to read and maintain.</p></li>&#13;
<li><p class="noindenta">If errors occur, you know where to look, which makes debugging much easier to do.</p></li>&#13;
<li><p class="noindenta">You don’t have to write the same code over and over again! Without using subroutines, if a program needs to run the same set of statements more than once, you have to duplicate these statements in your code. But if you put those statements in a subroutine, you can call it from any point in your program (<em>code reuse</em>). You’ll practice this in the next section.</p></li>&#13;
</ol>&#13;
<div class="note">&#13;
<p class="notet"><span class="notes"><strong>NOTE</strong></span></p>&#13;
<p class="notep"><em>In this book, we’ll start the name of a subroutine with a capital letter. We’ll also write all the subroutines at the bottom of every main program. We recommend you follow the same practice in your own programs: it’ll help keep you organized!</em></p>&#13;
</div>&#13;
<div class="sidebar">&#13;
<p class="sidebart" id="ch10sb01"><span epub:type="pagebreak" id="page_133"/><strong>TRY IT OUT 10-1</strong></p>&#13;
<p class="noindent">When Gulliver asked what a glum-gluff was, he was told it was 1/20 of a mumgluff. Write a subroutine named <code>MumGluffToFoot()</code> that converts mum-gluffs to feet. Write a program that prompts the user for a mum-gluff measurement, calls the subroutine, and then displays the result.</p>&#13;
</div>&#13;
<h3 class="h3" id="ch10lev1sec03"><span class="blue"><strong>Subroutine Input and Output</strong></span></h3>&#13;
<p class="noindent">You can think of a subroutine as a small program that provides a service to the main program. When the main program needs that service, it prepares the inputs that the subroutine needs and then calls the subroutine to start its job. The subroutine runs, saves its output(s) in some variables, and returns to the main program. When the main program continues, it looks at any new information from the subroutine and then uses that data to decide what to do next.</p>&#13;
<p class="indent">Small Basic doesn’t let you pass arguments to subroutines between parentheses (like you do with an object’s method, such as the <code>DrawLine()</code> method of <code>GraphicsWindow</code>). And it doesn’t define subroutines that directly return a value (like the <code>Math.Round()</code> method does). So you need to use variables to pass data between the main program and your subroutines. Let’s see how that works.</p>&#13;
<p class="indent">Great news! You inherited some land (<a href="ch10.html#ch10fig4">Figure 10-4</a>) from Uncle Moneybags. But you need to know the area of the land before you can sell it. The figure also shows Heron’s formula, which computes the area of a triangle given the lengths of its three sides. Don’t worry if you’re not familiar with this formula; you don’t need to fully understand something in order to use it (or most people wouldn’t be allowed to use the toilet).</p>&#13;
<div class="image"><img alt="image" src="graphics/f10-04.jpg"/></div>&#13;
<p class="figcap"><a id="ch10fig4"/><em>Figure 10-4: Calculating the area of the piece of land you inherited</em></p>&#13;
<p class="indent">Because the land is made up of two triangles, you can compute the area of these triangles and then add them together. Follow <a href="ch10.html#ch10ex3">Listing 10-3</a> and note how we put the code for calculating the triangle’s area (Heron’s formula) in a subroutine.</p>&#13;
<p class="programs"><span epub:type="pagebreak" id="page_134"/> 1 <span class="green"><span class="codeitalic">' LandArea.sb</span></span><br/> 2 <span class="green"><span class="codeitalic">' Calculates the area of the first triangle</span></span><br/> 3 side1 <span class="brown">=</span> <span class="red">7</span><br/> 4 side2 <span class="brown">=</span> <span class="red">20.6</span><br/> 5 side3 <span class="brown">=</span> <span class="red">25</span><br/> 6 TriangleArea<span class="brown">()</span><br/> 7 totalArea <span class="brown">=</span> area    <span class="green"><span class="codeitalic">' Saves the result from the subroutine call</span></span><br/> 8<br/> 9 <span class="green"><span class="codeitalic">' Calculates the area of the second triangle</span></span><br/>10 side1 <span class="brown">=</span> <span class="red">30</span><br/>11 side2 <span class="brown">=</span> <span class="red">14</span><br/>12 side3 <span class="brown">=</span> <span class="red">22.3</span><br/>13 TriangleArea<span class="brown">()</span><br/>14 totalArea <span class="brown">=</span> totalArea <span class="brown">+</span> area    <span class="green"><span class="codeitalic">' Adds the new area</span></span><br/>15<br/>16 totalArea <span class="brown">=</span> <span class="blue1">Math</span><span class="brown">.Round(</span>totalArea <span class="brown">*</span> <span class="red">100</span><span class="brown">) /</span>  <span class="red">100</span> <span class="green"><span class="codeitalic">' Rounds the answer</span></span><br/>17 <span class="blue1">TextWindow</span><span class="brown">.WriteLine(</span><span class="red">"Area = "</span> <span class="brown">+</span> totalArea <span class="brown">+</span> <span class="red">" square meters"</span><span class="brown">)</span><br/>18<br/>19 <span class="green"><span class="codeitalic">' Subroutine: computes the area of a triangle given its three sides</span></span><br/>20 <span class="green"><span class="codeitalic">' Inputs: side1, side2, and side3; the length of the three sides</span></span><br/>21 <span class="green"><span class="codeitalic">' Outputs: area; the area of the triangle</span></span><br/>22 <span class="green"><span class="codeitalic">' Temporary variables: s; the semiperimeter</span></span><br/>23 <span class="purple"><span class="codestrong">Sub</span></span> TriangleArea<br/>24   s <span class="brown">=</span> <span class="red">0.5</span> <span class="brown">* (</span>side1 <span class="brown">+</span> side2 <span class="brown">+</span> side3<span class="brown">)</span><br/>25   area <span class="brown">=</span> <span class="blue1">Math</span><span class="brown">.SquareRoot(</span>s <span class="brown">* (</span>s <span class="brown">-</span> side1<span class="brown">) * (</span>s <span class="brown">-</span> side2<span class="brown">) * (</span>s <span class="brown">-</span> side3<span class="brown">))</span><br/>26 <span class="purple"><span class="codestrong">EndSub</span></span></p>&#13;
<p class="listcap"><a id="ch10ex3"/><em>Listing 10-3: Calling a subroutine multiple times</em></p>&#13;
<p class="indent">Here’s the output of this program:</p>&#13;
<p class="programs">Area = 208.63 square meters</p>&#13;
<p class="indent">The main program sets the lengths of the three sides of the first triangle (lines 3–5) and then calls the <code>TriangleArea()</code> subroutine (line 6). The subroutine (lines 23–26) saves the computed area in a variable named <code>area</code>. After the subroutine call, the main program stores this first area in the <code>totalArea</code> variable (line 7). Without this, the value stored in <code>area</code> will be lost the next time we call the <code>TriangleArea()</code> subroutine. Then the main program sets the values to compute the area of the second triangle (lines 10–12) and calls the subroutine again (line 13). When the subroutine ends, the main program adds the new area to <code>totalArea</code> (line 14). The main program then rounds the answer (line 16) and displays it (line 17).</p>&#13;
<p class="indent">The <code>TriangleArea()</code> subroutine uses a temporary variable named <code>s</code> to store the <em>semiperimeter</em>, one-half of the perimeter of the current shape (line 24). Note how this variable is used to compute the area in line 25. This variable isn’t intended to be used by the main program, which just cares about the <code>area</code> variable. But the main program knows about it (for example, it can display the variable). Because your subroutines can change <span epub:type="pagebreak" id="page_135"/>variables that belong to the main program, be sure to name your variables carefully and clearly. For example, if the <code>s</code> variable seems confusing, rename it to <code>semiperimeter</code> so you’ll remember what it does.</p>&#13;
<div class="sidebar">&#13;
<p class="sidebart" id="ch10sb02"><strong>TRY IT OUT 10-2</strong></p>&#13;
<p class="noindent">Uncle Moneybags left you another piece of land (<a href="ch10.html#ch10fig5">Figure 10-5</a>)! Update the program in <a href="ch10.html#ch10ex3">Listing 10-3</a> to compute its area (all dimensions are in meters).</p>&#13;
<div class="image"><img alt="image" src="graphics/f10-05.jpg"/></div>&#13;
<p class="figcap"><a id="ch10fig5"/><em>Figure 10-5: Your new piece of land</em></p>&#13;
</div>&#13;
<h3 class="h3" id="ch10lev1sec04"><span class="blue"><strong>Nesting Subroutines</strong></span></h3>&#13;
<p class="noindent">If your chore is to clean the house, you might get help by making a deal with your sister to clean the windows and asking your dog to clean the floor under the table. Similarly, a subroutine might call other subroutines to help it do part of a larger job. In <a href="ch10.html#ch10fig6">Figure 10-6</a>, the main program calls a subroutine, <code>SubA()</code>, which then calls another subroutine, <code>SubC()</code>. Subroutines called from other subroutines are <em>nested subroutines</em>.</p>&#13;
<div class="image"><img alt="image" src="graphics/f10-06.jpg"/></div>&#13;
<p class="figcap"><a id="ch10fig6"/><em>Figure 10-6: Illustrating nested subroutines</em></p>&#13;
<div class="note">&#13;
<p class="notet"><span class="notes"><strong>NOTE</strong></span></p>&#13;
<p class="notep"><em>If your program contains many subroutines, you can place these subroutines at the end of your program in any order you like. For example, it doesn’t matter if you put the code for</em> <code><span class="codeitalic">SubA()</code></span> <em>before or after</em> <code><span class="codeitalic">SubB()</code></span><em>. What matters is the order in which you call these subroutines, not where you place them in your code!</em></p>&#13;
</div>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_136"/>To try out this concept, you’ll play Pepper Dare, an exciting game of chance, against the computer. When the game starts, the player is handed 10 imaginary cards face down. One of those cards has a jalapeño pepper on it; the rest are blank. The player picks a card and hopes for a blank one. If the player picks the card with the jalapeño, the player has to eat a hot pepper and the computer wins! If the player doesn’t get the pepper card, the computer takes a turn. The game ends when either the player or computer eats the pepper and runs for a drink of water. Enter the main program in <a href="ch10.html#ch10ex4">Listing 10-4</a> into Small Basic. You’ll add the subroutines in a moment.</p>&#13;
<p class="programs"> 1 <span class="green"><span class="codeitalic">' PepperDare.sb</span></span><br/> 2 player <span class="brown">=</span> <span class="red">1</span>  <span class="green"><span class="codeitalic">' 1 for player, 2 for computer</span></span><br/> 3 pepper <span class="brown">=</span> <span class="blue1">Math</span><span class="brown">.GetRandomNumber(</span><span class="red">10</span><span class="brown">)</span> <span class="green"><span class="codeitalic">' Which card has the pepper</span></span><br/> 4<br/> 5 Again<span class="brown">:</span><br/> 6 Pick<span class="brown">()</span>      <span class="green"><span class="codeitalic">' Updates the two variables: card and name</span></span><br/> 7 <span class="purple"><span class="codestrong">If</span></span> <span class="brown">(</span>card <span class="brown">=</span> pepper<span class="brown">)</span> <span class="purple"><span class="codestrong">Then</span></span><br/> 8   <span class="blue1">TextWindow</span><span class="brown">.Write(</span><span class="red">"Hot tamale, it's a pepper! "</span><span class="brown">)</span><br/> 9   <span class="blue1">TextWindow</span><span class="brown">.WriteLine</span>(name <span class="brown">+</span> <span class="red">" wins!"</span><span class="brown">)</span><br/>10   <span class="blue1">TextWindow</span><span class="brown">.WriteLine(</span><span class="red">""</span><span class="brown">)</span><br/>11 <span class="purple"><span class="codestrong">Else</span></span><br/>12   <span class="blue1">TextWindow</span><span class="brown">.Write(</span><span class="red">"The card is blank. "</span><span class="brown">)</span><br/>13   <span class="blue1">TextWindow</span><span class="brown">.WriteLine(</span><span class="red">"You put it back in and shuffle the deck."</span><span class="brown">)</span><br/>14   <span class="blue1">TextWindow</span><span class="brown">.WriteLine(</span><span class="red">""</span><span class="brown">)</span><br/>15   player <span class="brown">=</span> <span class="red">3</span> <span class="brown">-</span> player   <span class="green"><span class="codeitalic">' Switches the player</span></span><br/>16   <span class="purple"><span class="codestrong">Goto</span></span> Again<br/>17 <span class="purple"><span class="codestrong">EndIf</span></span></p>&#13;
<p class="listcap"><a id="ch10ex4"/><em>Listing 10-4: Setting up Pepper Dare</em></p>&#13;
<p class="indent">The game starts by setting the <code>player</code> variable to 1 to give you the first turn (line 2). It then randomly picks 1 of the 10 cards to be the card that has the jalapeño pepper (line 3). Then it starts a loop (lines 5–17) to take turns. In each round, the game picks one card at random for the player (or the computer) by calling the <code>Pick()</code> subroutine (line 6). If the picked card has a pepper on it (line 7), the game displays the winner’s name (line 9), and the game ends because the program moves out of the <code>If</code> loop and jumps from line 10 to line 17, bypassing the <code>Goto</code> loop on line 16.</p>&#13;
<p class="indent">Otherwise, it displays <code>The card is blank. You put it back in and shuffle the deck.</code> (lines 12–13) to indicate that the player (or the computer) picked a blank card. The game then switches to the next player (line 15) and goes back to start a new round (line 16). This is how the statement on line 15 works: if <code>player</code> is 1 (you, the user), then 3 – 1 is 2 (switching to the computer’s turn), and if <code>player</code> is 2 (the computer), then 3 – 2 is 1 (switching back to the user’s turn).</p>&#13;
<p class="indent">Next, you’ll add the <code>Pick()</code> subroutine in <a href="ch10.html#ch10ex5">Listing 10-5</a> to the bottom of your program.</p>&#13;
<p class="programs"> 1 <span class="purple"><span class="codestrong">Sub</span></span> Pick<br/> 2   <span class="purple"><span class="codestrong">If</span></span> <span class="brown">(</span>player <span class="brown">=</span> <span class="red">1</span><span class="brown">)</span> <span class="purple"><span class="codestrong">Then</span></span><br/> 3     name <span class="brown">=</span> <span class="red">"The computer"</span><br/> 4     <span class="blue1">TextWindow</span><span class="brown">.WriteLine(</span><span class="red">"Your turn. Pick a card."</span><span class="brown">)</span><br/> 5   <span class="purple"><span class="codestrong">Else</span></span><br/> 6     name <span class="brown">=</span> <span class="red">"The player"</span><br/> 7     <span class="blue1">TextWindow</span><span class="brown">.WriteLine(</span><span class="red">"The computer picks a card."</span><span class="brown">)</span><br/> 8   <span class="purple"><span class="codestrong">EndIf</span></span><br/> 9<br/>10   <span class="blue1">TextWindow</span><span class="brown">.Write(</span><span class="red">"[Press any key...]"</span><span class="brown">)</span><br/>11   <span class="blue1">TextWindow</span><span class="brown">.PauseWithoutMessage()</span><br/>12   <span class="blue1">TextWindow</span><span class="brown">.WriteLine(</span><span class="red">""</span><span class="brown">)</span><br/>13<br/>14   card <span class="brown">=</span> <span class="blue1">Math</span><span class="brown">.GetRandomNumber(</span><span class="red">10</span><span class="brown">)</span> <span class="green"><span class="codeitalic">' Picks a random card</span></span><br/>15   Animat<span class="brown">e()</span> <span class="green"><span class="codeitalic">' Animates the delay in picking a card</span></span><br/>16 <span class="purple"><span class="codestrong">EndSub</span></span></p>&#13;
<p class="listcap"><a id="ch10ex5"/><em>Listing 10-5: The</em> <code><span class="codeitalic">Pick()</code></span> <em>subroutine for Pepper Dare</em></p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_137"/>The subroutine starts by checking the current player (either you or the computer) and then sets the <code>name</code> variable (lines 3 and 6). Next, it asks you to press any key to have you or the computer pick a card (lines 10–12). Then it randomly picks a card (line 14) and calls the nested <code>Animate()</code> subroutine to animate an arrow in the text window.</p>&#13;
<p class="indent">Now add the <code>Animate()</code> subroutine in <a href="ch10.html#ch10ex6">Listing 10-6</a> to the bottom of your program.</p>&#13;
<p class="programs">1 <span class="purple"><span class="codestrong">Sub</span></span> Animate<br/>2   <span class="purple"><span class="codestrong">For</span></span> N <span class="brown">=</span> <span class="red">1</span> <span class="purple"><span class="codestrong">To</span></span> card<br/>3     <span class="blue1">TextWindow</span><span class="brown">.Write(</span><span class="red">"-"</span><span class="brown">)</span><br/>4     <span class="blue1">Program</span><span class="brown">.Delay(</span><span class="red">100</span><span class="brown">)</span><br/>5   <span class="purple"><span class="codestrong">EndFor</span></span><br/>6   <span class="blue1">TextWindow</span><span class="brown">.Write(</span><span class="red">"-&gt; "</span><span class="brown">)</span><br/>7 <span class="purple"><span class="codestrong">EndSub</span></span></p>&#13;
<p class="listcap"><a id="ch10ex6"/><em>Listing 10-6: Subroutine to animate the delay</em></p>&#13;
<p class="indent">Don’t worry about the <code>For</code> loop here. You’ll learn about it in depth in <a href="ch13.html#ch13">Chapter 13</a>. For now, this code just slowly displays a variable-length arrow. Here’s a sample run of the completed Pepper Dare program:</p>&#13;
<p class="programs">Your turn. Pick a card.<br/>[Press any key...]<br/>--&gt; The card is blank. You put it back in and shuffle the deck.<br/><br/>The computer picks a card.<br/>[Press any key...]<br/>--------&gt; The card is blank. You put it back in and shuffle the deck.<br/><br/>Your turn. Pick a card.<br/>[Press any key...]<br/>---------&gt; Hot tamale, it's a pepper! The computer wins!</p>&#13;
<div class="note">&#13;
<p class="notet"><span class="notes"><strong>NOTE</strong></span></p>&#13;
<p class="notep"><em>Not only can a subroutine call other subroutines, but it can also call itself (this is called</em> recursion<em>)! See the online resources to learn more.</em></p>&#13;
</div>&#13;
<div class="sidebar">&#13;
<p class="sidebart" id="ch10sb03"><span epub:type="pagebreak" id="page_138"/><strong>TRY IT OUT 10-3</strong></p>&#13;
<p class="noindent">Play the Pepper Dare game several times to understand how it works. Come up with some ideas to improve it, and then try to implement those ideas.</p>&#13;
</div>&#13;
<h3 class="h3" id="ch10lev1sec05"><span class="blue"><strong>Create a Dragon Game</strong></span></h3>&#13;
<p class="noindent">The previous example showed you how subroutines can add structure and clarity to your programs. You break your program into smaller pieces and tackle them one at a time. Although every problem is different and there’s no one-size-fits-all solution, we recommend a few ways to think through any problem.</p>&#13;
<p class="indent">First, spend some time trying to fully understand the problem. You wouldn’t dive into a pool without looking at it first, right?! (What if it was filled with pudding?) When you have a good idea of the problem you need to solve, plan a general solution. Then divide it into major tasks. As the solution planner, you decide what those tasks are. There’s no right or wrong answer; with practice you’ll get better at making these choices. But if you start with the general solution and break it down into smaller tasks, the logic of your program will be in good shape.</p>&#13;
<p class="indent">To show you this problem-solving strategy, let’s make the dragon game shown in <a href="ch10.html#ch10fig7">Figure 10-7</a>.</p>&#13;
<div class="image"><img alt="image" src="graphics/f10-07.jpg"/></div>&#13;
<p class="figcap"><a id="ch10fig7"/><em>Figure 10-7: The dragon game’s user interface</em></p>&#13;
<p class="indent">In this game, you control the knight, and it’s your job to slay the dragon. On the screen you can see which variables we’ll display to keep score and where the player makes a choice of three actions to play.</p>&#13;
<p class="indent">When the game starts, Good Knight is on the right, some distance from Draggy the dragon. Good Knight has a bow and some arrows, and his shield has a certain strength level (the program picks these values at random). The knight makes the first move. He can move 1 step forward, shoot an arrow at the dragon, or stab the dragon with his sword (but only if he’s <span epub:type="pagebreak" id="page_139"/>1 step away). If the arrow hits the dragon, it’ll slay him instantly! With the sword, the knight has a 50-50 chance of slaying the dragon (but only when he’s close enough). If Good Knight slays Draggy, he’ll become Knight of the Year, win his very own dance party, and get his picture on the castle wall.</p>&#13;
<p class="indent">Once Good Knight makes his move, Draggy breathes his flames at the knight. If he hits the knight, he’ll weaken the knight’s shield. When the shield loses its strength, the knight is defenseless. After this point, if the dragon’s fire hits the knight, it’ll burninate him! The entire city will be under the attack of the merciless, ferocious dragon. Game over!</p>&#13;
<p class="indent">The game uses five images that you can find in this chapter’s folder: the background image (your battlefield), two images for the dragon (one image shows the dragon’s fire), the knight’s image, and an image of an arrow. Follow steps 1–10 to make a fun dragon game!</p>&#13;
<h4 class="h4" id="ch10lev2sec01"><em><strong>Step 1: Open the Startup File</strong></em></h4>&#13;
<p class="noindent">Open the <em>Dragon_Incomplete.sb</em> file from the code folder for this chapter. This file contains the code in <a href="ch10.html#ch10ex7">Listing 10-7</a> and has empty placeholders for your subroutines. You’ll add the code for these subroutines one step at a time. The program’s folder has all the images you need as well. It also has the complete game, <em>Dragon.sb</em>, in case you get stuck.</p>&#13;
<p class="programs"> 1 <span class="green"><span class="codeitalic">' Dragon_Incomplete.sb</span></span><br/> 2 SetUp<span class="brown">()</span>    <span class="green"><span class="codeitalic">' Does one-time set up</span></span><br/> 3<br/> 4 NewGame<span class="brown">()</span>  <span class="green"><span class="codeitalic">' Sets the parameters for a new game</span></span><br/> 5<br/> 6 UpdateUserInterface<span class="brown">()</span> <span class="green"><span class="codeitalic">' Shows values on background image</span></span><br/> 7<br/> 8 NextMove<span class="brown">:</span><br/> 9 GetChoice<span class="brown">()</span>     <span class="green"><span class="codeitalic">' Displays options and gets the knight's choice</span></span><br/>10<br/>11 ProcessChoice<span class="brown">()</span> <span class="green"><span class="codeitalic">' Processes the user's choice</span></span><br/>12<br/>13 DragonFire<span class="brown">()</span>    <span class="green"><span class="codeitalic">' Now it's the dragon's turn</span></span><br/>14 <span class="purple"><span class="codestrong">Goto</span></span> NextMove</p>&#13;
<p class="listcap"><a id="ch10ex7"/><em>Listing 10-7: High-level structure of the dragon game</em></p>&#13;
<p class="indent">First, you call the <code>SetUp()</code> subroutine (line 2) to draw the background image, create text shapes (for displaying the distance, number of arrows, and so on), and load the game’s images (dragon, knight, and arrow). Line 4 calls <code>NewGame()</code> to set the parameters for a new game, including the knight’s arrows, shield strength, and distance from the dragon. In line 6, you call <code>UpdateUserInterface()</code> to update the game’s user interface (UI). Then the code goes into a loop (lines 8–14) to manage the game. Each round, you ask the knight for his next move (line 9), process his move by calling <code>ProcessChoice()</code> on line 11, and then give the dragon a turn (line 13). As you’ll see in a moment, these subroutines will keep track of the game’s status and end the game when there’s a winner!</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_140"/>Next, you’ll work on the subroutines one by one.</p>&#13;
<h4 class="h4" id="ch10lev2sec02"><em><strong>Step 2: Write the SetUp() Subroutine</strong></em></h4>&#13;
<p class="noindent">You’ll start by writing the <code>SetUp()</code> subroutine, which creates the scenario for your game. Add the code in <a href="ch10.html#ch10ex8">Listing 10-8</a> to your program.</p>&#13;
<p class="programs"> 1 <span class="purple"><span class="codestrong">Sub</span></span> SetUp<br/> 2   <span class="blue1">GraphicsWindow</span><span class="brown">.Title =</span> <span class="red">"Slay the Dragon"</span><br/> 3   <span class="blue1">TextWindow</span><span class="brown">.Title =</span> <span class="blue1">GraphicsWindow</span><span class="brown">.Title</span><br/> 4<br/> 5   <span class="blue1">GraphicsWindow</span><span class="brown">.Width =</span> <span class="red">480</span><br/> 6   <span class="blue1">GraphicsWindow</span><span class="brown">.Height =</span> <span class="red">380</span><br/> 7   <span class="blue1">GraphicsWindow</span><span class="brown">.CanResize =</span> <span class="red">0</span><br/> 8   <span class="blue1">GraphicsWindow</span><span class="brown">.FontSize =</span> <span class="red">14</span><br/> 9   <span class="blue1">GraphicsWindow</span><span class="brown">.Left =</span> <span class="red">40</span><br/>10   <span class="green"><span class="codeitalic">' Positions the text window</span></span><br/>11   <span class="blue1">TextWindow</span><span class="brown">.Left =</span> <span class="blue1">GraphicsWindow</span><span class="brown">.Left +</span> <span class="blue1">GraphicsWindow</span><span class="brown">.Width +</span> <span class="red">20</span><br/>12   <span class="blue1">TextWindow</span><span class="brown">.Top =</span> <span class="blue1">GraphicsWindow</span><span class="brown">.Top</span><br/>13<br/>14   path <span class="brown">=</span> <span class="blue1">Program</span><span class="brown">.Directory</span><br/>15   <span class="blue1">GraphicsWindow</span><span class="brown">.DrawImage(</span>path <span class="brown">+</span> <span class="red">"\bkgnd.png"</span><span class="brown">,</span> <span class="red">0</span><span class="brown">,</span> <span class="red">0</span><span class="brown">)</span><br/>16<br/>17   <span class="green"><span class="codeitalic">' Creates text objects to show distance, arrows,</span></span><br/>18   <span class="green"><span class="codeitalic">' shield strength, and message</span></span><br/>19   distText <span class="brown">=</span> <span class="blue1">Shapes</span><span class="brown">.AddText(</span><span class="red">""</span><span class="brown">)</span><br/>20   arrowsText <span class="brown">=</span> <span class="blue1">Shapes</span><span class="brown">.AddText(</span><span class="red">""</span><span class="brown">)</span><br/>21   shieldText <span class="brown">=</span> <span class="blue1">Shapes</span><span class="brown">.AddText(</span><span class="red">""</span><span class="brown">)</span><br/>22   msgText <span class="brown">=</span> <span class="blue1">Shapes</span><span class="brown">.AddText(</span><span class="red">"Draggy VS Good Knight"</span><span class="brown">)</span><br/>23   <span class="blue1">Shapes</span><span class="brown">.Move(</span>distText<span class="brown">,</span> <span class="red">60</span><span class="brown">,</span> <span class="red">30</span><span class="brown">)</span><br/>24   <span class="blue1">Shapes</span><span class="brown">.Move(</span>arrowsText<span class="brown">,</span> <span class="red">200</span><span class="brown">,</span> <span class="red">30</span><span class="brown">)</span><br/>25   <span class="blue1">Shapes</span><span class="brown">.Move(</span>shieldText<span class="brown">,</span> <span class="red">370</span><span class="brown">,</span> <span class="red">30</span><span class="brown">)</span><br/>26   <span class="blue1">Shapes</span><span class="brown">.Move(</span>msgText<span class="brown">,</span> <span class="red">5</span><span class="brown">,</span> <span class="red">362</span><span class="brown">)</span><br/>27<br/>28   <span class="green"><span class="codeitalic">' Loads the images for the knight, dragon, and arrow</span></span><br/>29   knightImg <span class="brown">=</span> <span class="blue1">Shapes</span><span class="brown">.AddImage(</span>path <span class="brown">+</span> <span class="red">"\knight.png"</span><span class="brown">)</span><br/>30   dragon1Img <span class="brown">=</span> <span class="blue1">Shapes</span><span class="brown">.AddImage(</span>path <span class="brown">+</span> <span class="red">"\dragon1.png"</span><span class="brown">)</span><br/>31   dragon2Img <span class="brown">=</span> <span class="blue1">Shapes</span><span class="brown">.AddImage(</span>path <span class="brown">+</span> <span class="red">"\dragon2.png"</span><span class="brown">)</span><br/>32   arrowImg <span class="brown">=</span> <span class="blue1">Shapes</span><span class="brown">.AddImage(</span>path <span class="brown">+</span> <span class="red">"\arrow.png"</span><span class="brown">)</span><br/>33   <span class="blue1">Shapes</span><span class="brown">.Move(</span>dragon1Img<span class="brown">,</span> <span class="red">0</span><span class="brown">,</span> <span class="red">250</span><span class="brown">)</span><br/>34   <span class="blue1">Shapes</span><span class="brown">.Move(</span>dragon2Img<span class="brown">,</span> <span class="red">0</span><span class="brown">,</span> <span class="red">250</span><span class="brown">)</span><br/>35   <span class="blue1">Shapes</span><span class="brown">.Move(</span>knightImg<span class="brown">,</span> <span class="red">380</span><span class="brown">,</span> <span class="red">250</span><span class="brown">)</span><br/>36<br/>37   <span class="blue1">Shapes</span><span class="brown">.HideShape(</span>dragon2Img<span class="brown">)</span><br/>38   <span class="blue1">Shapes</span><span class="brown">.HideShape(</span>arrowImg<span class="brown">)</span><br/>39 <span class="purple"><span class="codestrong">EndSub</span></span></p>&#13;
<p class="listcap"><a id="ch10ex8"/><em>Listing 10-8: Setting up the windows and properties</em></p>&#13;
<p class="indent">This code contains all the one-time setup for your game; it’s a little long, but we’ll talk you through it. You set the titles for the graphics and text windows (lines 2–3). These are displayed in the title bars for these windows when the game is played (see <a href="ch10.html#ch10fig7">Figure 10-7</a>).</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_141"/>Then you set the graphics window’s size (lines 5–7), font size (line 8), and position (line 9). Next, you position the text window to appear to the right of the graphics window (lines 11–12). After drawing the background image (lines 14–15), you create and position the text shapes that you’ll use to show all the numbers on the game’s UI (lines 19–26). Then you load and position the images for the knight, dragon, and arrow (lines 29–35). Finally, you hide the images for the firing dragon and the arrow because they aren’t needed at this time (lines 37–38): you’ll show these images when Draggy breathes fire and Good Knight shoots the arrow.</p>&#13;
<p class="indent">When we built this program, we figured out where to place the text and images (with the numbers we’re using) on the background’s image by using a trial-and-error method (we guessed and tweaked it until we got it right). You’ll likely need to do that when designing your own UIs for your awesome future games.</p>&#13;
<h4 class="h4" id="ch10lev2sec03"><em><strong>Step 3: Add a Bit of Chance</strong></em></h4>&#13;
<p class="noindent">Next, you need to add some luck to the game. Each time we run the game, we want Good Knight to get a different number of arrows, be a random distance away from the dragon, and have a different shield strength. To do this, add the <code>NewGame()</code> subroutine in <a href="ch10.html#ch10ex9">Listing 10-9</a> to your program.</p>&#13;
<p class="programs">1 <span class="purple"><span class="codestrong">Sub</span></span> NewGame<br/>2   dist <span class="brown">=</span> <span class="red">9</span> <span class="brown">+</span> <span class="blue1">Math</span><span class="brown">.GetRandomNumber(</span><span class="red">10</span><span class="brown">)</span> <span class="green"><span class="codeitalic">' 10 to 19</span></span><br/>3   arrows <span class="brown">=</span> <span class="blue1">Math</span><span class="brown">.Floor(</span><span class="red">0.4</span> <span class="brown">*</span> dist<span class="brown">)</span>       <span class="green"><span class="codeitalic">' 4 to 8</span></span><br/>4   shield <span class="brown">=</span> <span class="blue1">Math</span><span class="brown">.Floor(</span><span class="red">0.4</span> <span class="brown">*</span> dist<span class="brown">)</span>       <span class="green"><span class="codeitalic">' 4 to 8</span></span><br/>5   moveStep <span class="brown">=</span> <span class="red">280</span> <span class="brown">/</span> dist                 <span class="green"><span class="codeitalic">' Knight's move in pixels</span></span><br/>6 <span class="purple"><span class="codestrong">EndSub</span></span></p>&#13;
<p class="listcap"><a id="ch10ex9"/><em>Listing 10-9: Setting up a new game</em></p>&#13;
<p class="indent">In line 2, you add 9 to a random number between 1 and 10, which sets the distance, <code>dist</code>, between 10 and 19. This is the number of steps Good Knight has to take to get to Draggy. Next, you set the number of arrows as 40 percent of the distance (line 3). The farther the knight is from the dragon, the more arrows he’ll have. In line 4, you set the strength of the knight’s shield—again, as a fraction of his distance.</p>&#13;
<p class="indent">Let’s think about the <code>moveStep</code> line a little. The width of the background image is 480 pixels. The width of the dragon is 100 pixels, and the width of the knight is 100 pixels. When we place the dragon and the knight on the background, the distance from the dragon’s right edge to the knight’s left edge is 280 pixels. So every time Good Knight moves forward, we’ll move his image to the left by <code>280 / dist</code> pixels.</p>&#13;
<div class="note">&#13;
<p class="notet"><span class="notes"><strong>TIP</strong></span></p>&#13;
<p class="notep"><em>You can change the fraction in lines 3 and 4 from 0.4 to a different value to make the game easier or harder. After you complete the game, try changing the fraction and play the game a couple of times!</em></p>&#13;
</div>&#13;
<h4 class="h4" id="ch10lev2sec04"><span epub:type="pagebreak" id="page_142"/><em><strong>Step 4: Let the Player Know What’s Going On</strong></em></h4>&#13;
<p class="noindent">After you set the game’s parameters, you’ll need to show them to the user. Add the <code>UpdateUserInterface()</code> subroutine in <a href="ch10.html#ch10ex10">Listing 10-10</a>.</p>&#13;
<p class="programs">1 <span class="purple"><span class="codestrong">Sub</span></span> UpdateUserInterface<br/>2   <span class="blue1">Shapes</span><span class="brown">.SetText(</span>distText<span class="brown">,</span> dist<span class="brown">)</span><br/>3   <span class="blue1">Shapes</span><span class="brown">.SetText(</span>arrowsText<span class="brown">,</span> arrows<span class="brown">)</span><br/>4   <span class="blue1">Shapes</span><span class="brown">.SetText(</span>shieldText<span class="brown">,</span> shield<span class="brown">)</span><br/>5 <span class="purple"><span class="codestrong">EndSub</span></span></p>&#13;
<p class="listcap"><a id="ch10ex10"/><em>Listing 10-10: Subroutine that updates the text</em></p>&#13;
<p class="indent">This subroutine is pretty basic (and small!). You just use the <code>SetText()</code> method of the <code>Shapes</code> object and pass the identifier of the text shape and the number you want to display. Recall that we saved these identifiers when we created these text shapes in the <code>SetUp()</code> subroutine (lines 19–21 in <a href="ch10.html#ch10ex8">Listing 10-8</a>).</p>&#13;
<h4 class="h4" id="ch10lev2sec05"><em><strong>Step 5: Get the Player in the Game with GetChoice()</strong></em></h4>&#13;
<p class="noindent">If you run the game now, you should see all the images and numbers in place, but nothing will happen yet. You need to start taking the knight’s orders, so it’s time to add the <code>GetChoice()</code> subroutine in <a href="ch10.html#ch10ex11">Listing 10-11</a>.</p>&#13;
<p class="programs"> 1 <span class="purple"><span class="codestrong">Sub</span></span> GetChoice<br/> 2   AskAgain<span class="brown">:</span><br/> 3   <span class="blue1">TextWindow</span><span class="brown">.WriteLine(</span><span class="red">"Select:"</span><span class="brown">)</span><br/> 4   <span class="blue1">TextWindow</span><span class="brown">.WriteLine(</span><span class="red">"  [1] Move 1 step forward"</span><span class="brown">)</span><br/> 5   <span class="blue1">TextWindow</span><span class="brown">.WriteLine(</span><span class="red">"  [2] Shoot an arrow"</span><span class="brown">)</span><br/> 6   <span class="blue1">TextWindow</span><span class="brown">.WriteLine(</span><span class="red">"  [3] Stab the dragon (you have to be 1 step away)"</span><span class="brown">)</span><br/> 7   <span class="blue1">TextWindow</span><span class="brown">.Write(</span><span class="red">"  Your choice [1-3]: "</span><span class="brown">)</span><br/> 8<br/> 9   choice <span class="brown">=</span> <span class="blue1">TextWindow</span><span class="brown">.ReadNumber()</span><br/>10   <span class="purple"><span class="codestrong">If</span></span><span class="brown">((</span>choice <span class="brown">&lt;&gt;</span> <span class="red">1</span><span class="brown">) And (</span>choice <span class="brown">&lt;&gt;</span> <span class="red">2</span><span class="brown">) And (</span>choice <span class="brown">&lt;&gt;</span> <span class="red">3</span><span class="brown">))</span> <span class="purple"><span class="codestrong">Then</span></span><br/>11     <span class="purple"><span class="codestrong">Goto</span></span> AskAgain<br/>12   <span class="purple"><span class="codestrong">EndIf</span></span><br/>13<br/>14   <span class="purple"><span class="codestrong">If</span></span> <span class="brown">((</span>choice <span class="brown">=</span> <span class="red">2</span><span class="brown">) And (</span>arrows <span class="brown">=</span> <span class="red">0</span><span class="brown">))</span> <span class="purple"><span class="codestrong">Then</span></span><br/>15     <span class="blue1">Shapes</span><span class="brown">.SetText(</span>msgText<span class="brown">,</span> <span class="red">"You ran out of arrows! Borrow some from Link."</span><span class="brown">)</span><br/>16     <span class="purple"><span class="codestrong">Goto</span></span> AskAgain<br/>17   <span class="purple"><span class="codestrong">EndIf</span></span><br/>18<br/>19   <span class="purple"><span class="codestrong">If</span></span> <span class="brown">((</span>choice <span class="brown">=</span> <span class="red">3</span><span class="brown">) And (</span>dist <span class="brown">&gt;</span> <span class="red">1</span><span class="brown">))</span> <span class="purple"><span class="codestrong">Then</span></span><br/>20     <span class="blue1">Shapes</span><span class="brown">.SetText(</span>msgText<span class="brown">,</span> <span class="red">"You're too far to use your sword. Too bad</span><br/>       <span class="red">you can't train dragons."</span><span class="brown">)</span><br/>21     <span class="purple"><span class="codestrong">Goto</span></span> AskAgain<br/>22   <span class="purple"><span class="codestrong">EndIf</span></span><br/>23<br/>24   <span class="blue1">Shapes</span><span class="brown">.SetText(</span>msgText<span class="brown">,</span> <span class="red">""</span><span class="brown">)</span><br/>25   <span class="blue1">TextWindow</span><span class="brown">.WriteLine(</span><span class="red">""</span><span class="brown">)</span><br/>26 <span class="purple"><span class="codestrong">EndSub</span></span></p>&#13;
<p class="listcap"><a id="ch10ex11"/><em>Listing 10-11: Getting the user’s choice and displaying any errors</em></p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_143"/>You start by displaying the options to the user (lines 3–7). You read the user’s choice for Good Knight (line 9) and make sure it’s valid. If your user enters any number other than 1, 2, or 3, you ask them to enter a number again (lines 10–12). If the user chooses to shoot an arrow but doesn’t have any arrows, you tell them they’re out of arrows and ask them again (lines 14–17). If they want to stab the dragon but are too far away, you tell them they’re too far away and ask them to choose again (lines 19–22). Otherwise, the choice the user makes is acceptable. You clear the message text in line 24, add an empty line to the text window in line 25 to prepare for the next prompt, and return to the main program (line 26).</p>&#13;
<h4 class="h4" id="ch10lev2sec06"><em><strong>Step 6: Process the Player’s Choice</strong></em></h4>&#13;
<p class="noindent">Now that the user has made their choice, you need to examine the <code>choice</code> variable to decide what to do next. Add the <code>ProcessChoice()</code> subroutine in <a href="ch10.html#ch10ex12">Listing 10-12</a> to your program.</p>&#13;
<p class="programs">1 <span class="purple"><span class="codestrong">Sub</span></span> ProcessChoice<br/>2   <span class="purple"><span class="codestrong">If</span></span> <span class="brown">(</span>choice <span class="brown">=</span> <span class="red">1</span><span class="brown">)</span> <span class="purple"><span class="codestrong">Then</span></span>     <span class="green"><span class="codeitalic">' Move-forward subroutine</span></span><br/>3     MoveKnight<span class="brown">()</span><br/>4   <span class="purple"><span class="codestrong">ElseIf</span></span> <span class="brown">(</span>choice <span class="brown">=</span> <span class="red">2</span><span class="brown">)</span> <span class="purple"><span class="codestrong">Then</span></span> <span class="green"><span class="codeitalic">' Shoot-arrow subroutine</span></span><br/>5     ShootArrow<span class="brown">()</span><br/>6   <span class="purple"><span class="codestrong">Else</span></span> <span class="green"><span class="codeitalic">' Stab subroutine</span></span><br/>7     StabDragon<span class="brown">()</span><br/>8   <span class="purple"><span class="codestrong">EndIf</span></span><br/>9 <span class="purple"><span class="codestrong">EndSub</span></span></p>&#13;
<p class="listcap"><a id="ch10ex12"/><em>Listing 10-12: Jumping to the choice’s subroutine</em></p>&#13;
<p class="indent">You use an <code>If/Else</code> ladder on the <code>choice</code> variable and call a different subroutine for each choice. Next, you’ll write these three subroutines!</p>&#13;
<h4 class="h4" id="ch10lev2sec07"><em><strong>Step 7: Add Motion with MoveKnight()</strong></em></h4>&#13;
<p class="noindent">Add the <code>MoveKnight()</code> subroutine in <a href="ch10.html#ch10ex13">Listing 10-13</a> to breathe some life into Good Knight and get him moving.</p>&#13;
<p class="programs"> 1 <span class="purple"><span class="codestrong">Sub</span></span> MoveKnight<br/> 2   dist <span class="brown">=</span> dist <span class="brown">-</span> <span class="red">1</span><br/> 3   <span class="blue1">Shapes</span><span class="brown">.SetText(</span>distText<span class="brown">,</span> dist<span class="brown">)</span><br/> 4<br/> 5   <span class="blue1">Shapes</span><span class="brown">.Move(</span>knightImg<span class="brown">,</span> <span class="red">100</span> <span class="brown">+</span> dist <span class="brown">*</span> moveStep<span class="brown">,</span> <span class="red">250</span><span class="brown">)</span><br/> 6<br/> 7   <span class="purple"><span class="codestrong">If</span></span> <span class="brown">(</span>dist <span class="brown">=</span> <span class="red">0</span><span class="brown">)</span> <span class="purple"><span class="codestrong">Then</span></span>  <span class="green"><span class="codeitalic">' Checks whether the knight touched the dragon</span></span><br/> 8     <span class="blue1">Shapes</span><span class="brown">.SetText(</span>msgText<span class="brown">,</span> <span class="red">"The dragon swallowed you! You taste like chicken."</span><span class="brown">)</span><br/> 9     GameOver<span class="brown">()</span><br/>10   <span class="purple"><span class="codestrong">EndIf</span></span><br/>11 <span class="purple"><span class="codestrong">EndSub</span></span></p>&#13;
<p class="listcap"><a id="ch10ex13"/><em>Listing 10-13: The subroutine that moves Good Knight</em></p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_144"/>You start by reducing the knight’s distance from the dragon by 1 step (line 2), and then you show that new distance on the game’s UI (line 3). You then move the knight’s image to the left (line 5).</p>&#13;
<p class="indent">To understand how this works, let’s assume that the knight’s initial distance from the dragon, <code>dist</code>, is 10, which makes <code>moveStep = 28</code>, as illustrated in <a href="ch10.html#ch10fig7">Figure 10-7</a>. When the knight is 10 steps away from the dragon, the upper-left corner of the knight’s image is at (100 + (10 × 28), 250). When the knight is 9 steps away from the dragon, the upper-left corner of the knight’s image is at (100 + (9 × 28), 250), and when he’s 8 steps away, the image’s upper-left corner is at (100 + (8 × 28), 250), and so on. To move the knight, you set the image’s horizontal position to 100 plus the current distance, <code>dist</code>, times the <code>moveStep</code>, and you set the image’s vertical position to 250 (see <a href="ch10.html#ch10fig8">Figure 10-8</a>).</p>&#13;
<div class="image"><img alt="image" src="graphics/f10-08.jpg"/></div>&#13;
<p class="figcap"><a id="ch10fig8"/><em>Figure 10-8: Illustrating the knight’s motion</em></p>&#13;
<p class="indent">After moving the knight, you check whether he touched the dragon (line 7). If he did, you tell Good Knight how great the dragon thinks he tastes and call the <code>GameOver()</code> subroutine. This subroutine is in <a href="ch10.html#ch10ex14">Listing 10-14</a>; add it to your program now.</p>&#13;
<p class="programs">1 <span class="purple"><span class="codestrong">Sub</span></span> GameOver<br/>2   <span class="blue1">TextWindow</span><span class="brown">.Pause()</span><br/>3   <span class="blue1">Program</span><span class="brown">.End()</span><br/>4 <span class="purple"><span class="codestrong">EndSub</span></span></p>&#13;
<p class="listcap"><a id="ch10ex14"/><em>Listing 10-14: Running the</em> <code><span class="codeitalic">GameOver()</code></span> <em>subroutine</em></p>&#13;
<p class="indent">This subroutine calls <code>Pause()</code> to give your user a chance to read the message (line 2). When the user presses any key, the <code>Pause()</code> method ends, and you call the <code>End()</code> method to exit your program (line 3).</p>&#13;
<h4 class="h4" id="ch10lev2sec08"><span epub:type="pagebreak" id="page_145"/><em><strong>Step 8: Shoot Arrows with ShootArrow()</strong></em></h4>&#13;
<p class="noindent">Add the <code>ShootArrow()</code> subroutine in <a href="ch10.html#ch10ex15">Listing 10-15</a> to make the Good Knight a master archer who puts Hawkeye to shame.</p>&#13;
<p class="programs"> 1 <span class="purple"><span class="codestrong">Sub</span></span> ShootArrow<br/> 2   arrows <span class="brown">=</span> arrows <span class="brown">-</span> <span class="red">1</span><br/> 3   <span class="blue1">Shapes</span><span class="brown">.SetText(</span>arrowsText<span class="brown">,</span> arrows<span class="brown">)</span><br/> 4<br/> 5   range <span class="brown">=</span> <span class="blue1">Math</span><span class="brown">.GetRandomNumber(</span>dist<span class="brown">)</span><br/> 6<br/> 7   <span class="green"><span class="codeitalic">' Animates the arrow</span></span><br/> 8   pos1X <span class="brown">=</span> <span class="red">100</span> <span class="brown">+</span> dist <span class="brown">*</span> moveStep<br/> 9   pos2X <span class="brown">=</span> <span class="red">100</span> <span class="brown">+ (</span>dist <span class="brown">-</span> range<span class="brown">)*</span> moveStep<br/>10   <span class="blue1">Shapes</span><span class="brown">.Move(</span>arrowImg<span class="brown">,</span> pos1X<span class="brown">,</span> <span class="red">280</span><span class="brown">)</span><br/>11   <span class="blue1">Shapes</span><span class="brown">.ShowShape(</span>arrowImg<span class="brown">)</span><br/>12   <span class="blue1">Shapes</span><span class="brown">.Animate(</span>arrowImg<span class="brown">,</span> pos2X<span class="brown">,</span> <span class="red">280</span><span class="brown">,</span> <span class="red">2000</span><span class="brown">)</span><br/>13   <span class="blue1">Program</span><span class="brown">.Delay(</span><span class="red">2000</span><span class="brown">)</span><br/>14   <span class="blue1">Shapes</span><span class="brown">.HideShape(</span>arrowImg<span class="brown">)</span><br/>15<br/>16   <span class="purple"><span class="codestrong">If</span></span> <span class="brown">(</span>range <span class="brown">=</span> dist<span class="brown">)</span> <span class="purple"><span class="codestrong">Then</span></span>    <span class="green"><span class="codeitalic">' You hit the dragon right on</span></span><br/>17     <span class="blue1">Shapes</span><span class="brown">.SetText(</span>msgText<span class="brown">,</span> <span class="red">"Perfect shot. The dragon's dead! You kiss the</span><br/>       <span class="red">princess's frog."</span><span class="brown">)</span><br/>18     GameOver<span class="brown">()</span><br/>19   <span class="purple"><span class="codestrong">Else</span></span><br/>20     <span class="blue1">Shapes</span><span class="brown">.SetText(</span>msgText<span class="brown">,</span> <span class="red">"Your arrow missed! Robin Hood is giving lessons."</span><span class="brown">)</span><br/>21     <span class="blue1">Program</span><span class="brown">.Delay(</span><span class="red">2000</span><span class="brown">)</span>     <span class="green"><span class="codeitalic">' To read the message</span></span><br/>22   <span class="purple"><span class="codestrong">EndIf</span></span><br/>23 <span class="purple"><span class="codestrong">EndSub</span></span></p>&#13;
<p class="listcap"><a id="ch10ex15"/><em>Listing 10-15: Shooting the arrow</em></p>&#13;
<p class="indent">You start by using one arrow (line 2) and show the remaining arrows on the UI (line 3). You then set the arrow’s range randomly to a number between 1 and the distance to the dragon (line 5). The closer the knight is to the dragon, the better his chances are that he’ll hit his target. The next block of code (lines 8–14) animates the arrow. The horizontal start position, <code>pos1X</code>, is the same as the knight’s position (line 8), and the end position, <code>pos2X</code>, is based on the selected range (line 9). You then move the arrow to its start position (line 10), show it (line 11), animate it to its final position (line 12), wait for it to reach its target (line 13), and then hide it (line 14). You can change the value <code>2000</code> in lines 12 and 13 to make the animation shorter or longer.</p>&#13;
<p class="indent">Once the animation is complete, you check whether the arrow hit the dragon (line 16). If it did, the game is over (lines 17–18) and the dance party is yours! Otherwise, you tell Good Knight that his arrow missed (line 20), delay the program for your user to read the message (line 21), and return to the <code>ProcessChoice()</code> subroutine, which returns to the main program to give the dragon his turn.</p>&#13;
<h4 class="h4" id="ch10lev2sec09"><span epub:type="pagebreak" id="page_146"/><em><strong>Step 9: Swing the Sword with StabDragon()</strong></em></h4>&#13;
<p class="noindent">Now, add the last subroutine for the knight in <a href="ch10.html#ch10ex16">Listing 10-16</a>.</p>&#13;
<p class="programs">1 <span class="purple"><span class="codestrong">Sub</span></span> StabDragon<br/>2   <span class="purple"><span class="codestrong">If</span></span> <span class="brown">(</span><span class="blue1">Math</span><span class="brown">.GetRandomNumber(</span><span class="red">2</span><span class="brown">) =</span> <span class="red">1</span><span class="brown">)</span> <span class="purple"><span class="codestrong">Then</span></span><br/>3     <span class="blue1">Shapes</span><span class="brown">.SetText(</span>msgText<span class="brown">,</span> <span class="red">"You killed the dragon! You marry the princess</span><br/>      <span class="red">and 7 dwarves."</span><span class="brown">)</span><br/>4     GameOver<span class="brown">()</span><br/>5   <span class="purple"><span class="codestrong">Else</span></span><br/>6     <span class="blue1">Shapes</span><span class="brown">.SetText(</span>msgText<span class="brown">,</span> <span class="red">"Your sword missed! Good one, Lance-a-Little!"</span><span class="brown">)</span><br/>7     <span class="blue1">Program</span><span class="brown">.Delay(</span><span class="red">2000</span><span class="brown">)</span> <span class="green"><span class="codeitalic">' To read the message</span></span><br/>8   <span class="purple"><span class="codestrong">EndIf</span></span><br/>9 <span class="purple"><span class="codestrong">EndSub</span></span></p>&#13;
<p class="listcap"><a id="ch10ex16"/><em>Listing 10-16: Stabbing the dragon</em></p>&#13;
<p class="indent">You randomly pick the number 1 or 2. If the number is 1 (line 2), the knight hits the dragon and the game ends (lines 3–4). If the knight misses, you tell the knight that he missed (line 6), delay the program for your user to read the message (line 7), and return to the <code>ProcessChoice()</code> subroutine.</p>&#13;
<h4 class="h4" id="ch10lev2sec10"><em><strong>Step 10: Breathe Fire</strong></em></h4>&#13;
<p class="noindent">If the knight didn’t kill Draggy and end the game, the main program calls <code>DragonFire()</code> to give the dragon a fair fight. Add <a href="ch10.html#ch10ex17">Listing 10-17</a> to your program.</p>&#13;
<p class="programs"> 1 <span class="purple"><span class="codestrong">Sub</span></span> DragonFire<br/> 2   <span class="blue1">Shapes</span><span class="brown">.SetText(</span>msgText<span class="brown">,</span> <span class="red">"The dragon ignited his fire. The Pokemon run."</span><span class="brown">)</span><br/> 3   <span class="blue1">Shapes</span><span class="brown">.HideShape(</span>dragon1Img<span class="brown">)</span><br/> 4   <span class="blue1">Shapes</span><span class="brown">.ShowShape(</span>dragon2Img<span class="brown">)</span><br/> 5   <span class="blue1">Program</span><span class="brown">.Delay(</span><span class="red">1000</span><span class="brown">)</span><br/> 6   <span class="blue1">Shapes</span><span class="brown">.HideShape(</span>dragon2Img<span class="brown">)</span><br/> 7   <span class="blue1">Shapes</span><span class="brown">.ShowShape(</span>dragon1Img<span class="brown">)</span><br/> 8<br/> 9   <span class="purple"><span class="codestrong">If</span></span> <span class="brown">(</span><span class="blue1">Math</span><span class="brown">.GetRandomNumber(</span><span class="red">2</span><span class="brown">) =</span> <span class="red">1</span><span class="brown">)</span> <span class="purple"><span class="codestrong">Then</span></span> <span class="green"><span class="codeitalic">' Knight is hit</span></span><br/>10     <span class="purple"><span class="codestrong">If</span></span> <span class="brown">(</span>shield <span class="brown">=</span> <span class="red">0</span><span class="brown">)</span> <span class="purple"><span class="codestrong">Then</span></span>                <span class="green"><span class="codeitalic">' Shield is damaged</span></span><br/>11       <span class="blue1">Shapes</span><span class="brown">.SetText(</span>msgText<span class="brown">,</span> <span class="red">"The dragon's fire BURNINATED you!"</span><span class="brown">)</span><br/>12       GameOver<span class="brown">()</span><br/>13     <span class="purple"><span class="codestrong">Else</span></span><br/>14       shield <span class="brown">=</span> shield <span class="brown">-</span> <span class="red">1</span><br/>15       <span class="blue1">Shapes</span><span class="brown">.SetText(</span>shieldText<span class="brown">,</span> shield<span class="brown">)</span><br/>16       <span class="blue1">Shapes</span><span class="brown">.SetText(</span>msgText<span class="brown">,</span> <span class="red">"You're hit! Your shield became weaker. Use</span><br/>         <span class="red">the force!"</span><span class="brown">)</span><br/>17     <span class="purple"><span class="codestrong">EndIf</span></span><br/>18   <span class="purple"><span class="codestrong">Else</span></span><br/>19     <span class="blue1">Shapes</span><span class="brown">.SetText(</span>msgText<span class="brown">,</span> <span class="red">"The fire missed you! Aunt Mildred could've used</span><br/>       <span class="red">your luck."</span><span class="brown">)</span><br/>20   <span class="purple"><span class="codestrong">EndIf</span></span><br/>21 <span class="purple"><span class="codestrong">EndSub</span></span></p>&#13;
<p class="listcap"><a id="ch10ex17"/><em>Listing 10-17: The dragon breathing fire on Good Knight</em></p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_147"/>Lines 3–7 animate the dragon’s fire. You hide the normal dragon image (line 3) and show the one spitting fire (line 4). You wait 1 second (line 5) and switch the images back (lines 6–7). After that, the dragon has a 50-50 chance to hit the knight with his fire. You pick a random number that’s either a 1 or a 2. A value of 1 means the dragon has hit the knight (line 9). In this case, you check the shield’s strength (line 10); if it’s 0, the game is over (lines 11–12). But if it isn’t 0, you reduce the shield’s strength by 1 (line 14), display the new value (line 15), tell the knight that he was hit (line 16), and return to the main program. If the random number is 2 (line 18), you tell the knight that the dragon’s fire missed him (line 19) and return to the main program.</p>&#13;
<p class="indent">Your game is done! Play it several times and enjoy your creation!</p>&#13;
<div class="sidebar">&#13;
<p class="sidebart" id="ch10sb04"><strong>TRY IT OUT 10-4</strong></p>&#13;
<p class="noindent">The dragon game is fun, but it isn’t perfect. When you play the game several times, you’ll notice some issues that you either don’t like or can improve. It’s now your game; make any changes you think will make the game better. You can even change the messages and the graphics. Head to <em><a href="http://tiny.cc/dragongame/">http://tiny.cc/dragongame/</a></em> to share your game in the gallery and see what others did!</p>&#13;
</div>&#13;
<h3 class="h3a" id="ch10lev1sec06"><span class="blues"><strong>Programming Challenges</strong></span></h3>&#13;
<p class="noindent">If you get stuck, check out <em><a href="http://nostarch.com/smallbasic/">http://nostarch.com/smallbasic/</a></em> for the solutions and for more resources and review questions for teachers and students.</p>&#13;
<ol>&#13;
<li><p class="noindenta">The folder for this challenge has images for the head, eyes, mouth, and body of an alien creature (see the following figure).</p>&#13;
<div class="image1"><img alt="image" src="graphics/f0147-01.jpg"/></div>&#13;
<p class="indent">Write a program that prompts a user to enter the number of eyes (2, 4, or 6) and the number of mouths (1 or 2) of the alien. Then <span epub:type="pagebreak" id="page_148"/>have your main program call <code>DrawHead()</code>, <code>DrawEyes()</code>, <code>DrawMouths()</code>, and <code>DrawBody()</code> to draw the alien! For example, here’s an alien with six eyes and two mouths:</p>&#13;
<div class="image1"><img alt="image" src="graphics/f0148-01.jpg"/></div></li>&#13;
<li><p class="noindenta">In this challenge, you’ll develop the game Ghost Hunt (see the following figure). Open the file <em>GhostHunt_Incomplete.sb</em> from this chapter’s folder (which has all the images you need for this game). A ghost is hiding in 1 of the 12 rooms. To find the ghost, the user picks a room. If the user finds the ghost in that room, they win! Otherwise, the ghost tries to find the user (by selecting a room number at random). If the ghost finds the user, the game ends. Otherwise, the ghost moves to a different room, and the user tries again.</p>&#13;
<div class="image1"><img alt="image" src="graphics/f0148-02.jpg"/></div></li>&#13;
</ol>&#13;
</body></html>