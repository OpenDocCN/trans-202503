<html><head></head><body><div id="sbo-rt-content"><h2 class="h2" id="ch14"><span epub:type="pagebreak" id="page_373"/><span class="big">14</span><br/>FIREFLY</h2>&#13;
<div class="image1"><img src="Images/common01.jpg" alt="Image" width="189" height="189"/></div>&#13;
<p class="noindent">Firefly is a minimalist programming language for animation and sound. Firefly targets the BBC micro:bit, but you don’t need one to have fun with the language—the console version will work just fine. The inspiration for the language comes from the 5×5 grid of LEDs that form the display of the micro:bit. The language manipulates a “firefly” that lives on the grid. As it flies, it leaves a luminous trail of light behind it. Oh, the firefly also sings, because why not?</p>&#13;
<p class="indent">This chapter introduces the philosophy and design of the language, followed by its implementation. The chapter ends with a section on configuring a micro:bit, should you wish to use one for the experiments of <a href="ch15.xhtml#ch15">Chapter 15</a>. Again, you don’t need a micro:bit; you can run everything just fine at the command line using the console version of the interpreter. However, the micro:bit isn’t too expensive, and it’s a fun little device that itself runs Python. Also, console fireflies don’t know how to sing.</p>&#13;
<h3 class="h3" id="lev1sec93"><span epub:type="pagebreak" id="page_374"/><strong>Philosophy and Design</strong></h3>&#13;
<p class="noindent">Our environment is this: a small firefly is flying around a tiny 5×5 grid. As it flies, it leaves behind a luminous trail and sometimes sings.</p>&#13;
<p class="indent">To be more specific, a Firefly program manipulates a 5×5 grid of single digits. On the micro:bit, these become intensities of the 5×5 grid of LEDs. The firefly can sing by making the micro:bit sound a note of a particular pitch and duration.</p>&#13;
<p class="indent">A Firefly program is a series of single-character instructions that either move the firefly around the grid, set the way its luminous trail acts, or make the firefly sing a note. The Firefly language also supports what is known as <em>double buffering</em>, meaning instead of one 5×5 grid of digits, there are two 5×5 grids. The program controls which grid is shown to the user and which grid the firefly is making a trail on (drawing to). Double buffering is a common computer animation technique in which the user sees one display while the program is updating the other and then the view switches. Doing this prevents the user from watching the display draw and makes for smooth animation. Don’t worry if double buffering is a new concept; we’ll detail it in <a href="ch15.xhtml#ch15">Chapter 15</a> when we use it.</p>&#13;
<p class="indent">A Firefly program instructs the firefly by directing its movements and when and how it should sing. If you’ve never heard a singing firefly, you’re in good company because I haven’t either. Still, it’s fun to pretend.</p>&#13;
<p class="indent">The firefly is constrained to move on a 5×5 grid. The upper-left corner of the grid is position (0,0), and the lower-right corner is position (4,4). Positions are given as the row number before the column number. The firefly moves one position at a time, either north (<span class="literal">N</span>), south (<span class="literal">S</span>), east (<span class="literal">E</span>), or west (<span class="literal">W</span>). When it moves off one edge of the grid, it wraps around to the other side. For instance, moving east from position (1,4) puts the firefly at position (1,0). Likewise, a firefly moving south from (4,2) arrives at position (0,2).</p>&#13;
<p class="indent">When the firefly moves, it leaves behind a trail, meaning it sets the position it <em>just left</em> to some value. On the micro:bit, the value is the LED’s intensity at that position where 0 is off and 9 is maximum brightness. The console interpreter shows 0 as space and anything else as the numeric value of the position, but if desired, the console will show 0 as <span class="literal">0</span>.</p>&#13;
<p class="indent">Therefore, if the firefly is currently at position (2,2) and the intensity is set to 3, an instruction telling the firefly to move one position to the west, that is, to (2,1), will set position (2,2) to intensity 3. There is also an instruction telling the firefly to stay put, so it is possible to update a position value in place.</p>&#13;
<p class="indent">The 5×5 grid is all the memory we have. It’s also the display: we see the value of each grid cell as a number (console) or brightness of the LED (micro:bit). Therefore, a Firefly program has no variables.</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_375"/>Using memory as the display isn’t novel, but it puts us in good company. The Manchester Baby, the world’s first stored-program computer with random access memory, circa 1948, also used memory as its display (see <a href="ch14.xhtml#ch014fig1">Figure 14-1</a>).</p>&#13;
<div class="image"><img id="ch014fig1" src="Images/14fig01.jpg" alt="Image" width="680" height="454"/></div>&#13;
<p class="figcap"><em>Figure 14-1: The memory/display of the Manchester Baby</em></p>&#13;
<p class="indent">The Baby’s memory is literally the cathode-ray tube shown in the photograph. If a bit was on, one pattern was displayed, and if the bit was off, a slightly different pattern was shown. <a href="ch14.xhtml#ch014fig1">Figure 14-1</a> shows a working replica of the original Baby built at the University of Manchester in 1998 in celebration of the original Baby’s 50th anniversary.</p>&#13;
<p class="indent">The Baby had memory for 32 instructions of 32 bits each. It was a von Neumann machine, meaning program memory and data storage were mixed as they are in a modern desktop computer. Firefly is more like a Harvard architecture machine, as memory for data and program instructions is separate. Many microcontrollers use a Harvard architecture. In our case, the display is the data memory and a Python string represents program memory.</p>&#13;
<p class="indent">We have two versions of the Firefly interpreter to work with. The console version is intended for program creation. It knows how to parse input text to remove whitespace and comments. It also supports program tracing. When the program is working as it should, a utility converts the source code to a form we can load onto the micro:bit. The micro:bit runs a single Python program. For Firefly, the program is the interpreter with the source code we want to execute embedded in it as a string constant.</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_376"/>Perhaps the simplest way to understand Firefly is to detail its instructions. Knowing what the instructions do tells us how to use them. Firefly instructions are single characters and case insensitive. The instructions fall into distinct groups: movement, display, music, and whatever’s left. Most instructions relate to movement, so we’ll begin with those.</p>&#13;
<h4 class="h4" id="lev2sec123"><strong><em>Movement</em></strong></h4>&#13;
<p class="noindent">Firefly move instructions fall into two groups: those that move the firefly and those that define what happens to the position the firefly leaves when it moves. We’ll refer to these latter instructions as setting the <em>mode</em>. Movement is north, south, east, or west, with the option to stay put (see <a href="ch14.xhtml#ch014tab1">Table 14-1</a>).</p>&#13;
<p class="tabcap" id="ch014tab1"><strong>Table 14-1:</strong> Firefly Movement Commands</p>&#13;
<table class="all">&#13;
<colgroup>&#13;
<col style="width:50%"/>&#13;
<col style="width:50%"/>&#13;
</colgroup>&#13;
<thead>&#13;
<tr>&#13;
<th style="vertical-align: top;" class="table-h"><p class="taba"><strong>Instruction</strong></p></th>&#13;
<th style="vertical-align: top;" class="table-h"><p class="taba"><strong>Effect</strong></p></th>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba">N</p></td>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba">Move north</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">S</p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">Move south</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba">E</p></td>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba">Move east</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">W</p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">Move west</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1b_bot"><p class="taba">T</p></td>&#13;
<td style="vertical-align: top;" class="table-1b_bot"><p class="taba">Stay put (“tick” of the clock)</p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<p class="indent">What happens to the position after the firefly moves is the mode given in <a href="ch14.xhtml#ch014tab2">Table 14-2</a>. Note that when the program begins, the firefly is in move-only mode at position (2,2).</p>&#13;
<p class="tabcap" id="ch014tab2"><strong>Table 14-2:</strong> Firefly Intensity (Mode) Commands</p>&#13;
<table class="all">&#13;
<colgroup>&#13;
<col style="width:40%"/>&#13;
<col style="width:60%"/>&#13;
</colgroup>&#13;
<thead>&#13;
<tr>&#13;
<th style="vertical-align: top;" class="table-h"><p class="taba"><strong>Instruction</strong></p></th>&#13;
<th style="vertical-align: top;" class="table-h"><p class="taba"><strong>Effect</strong></p></th>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba">0–9</p></td>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba">Constant intensity value</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">I</p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">Increment the current value</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba">D</p></td>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba">Decrement the current value</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">M</p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">Move only; no change in value</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1b_bot"><p class="taba">R</p></td>&#13;
<td style="vertical-align: top;" class="table-1b_bot"><p class="taba">Random value 1 through 9</p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<p class="indent">Let’s consider a program that begins with the following instructions:</p>&#13;
<pre>SS5NNNNN</pre>&#13;
<p class="noindent">Here, the firefly will move south twice to be at position (4,2), set the intensity to 5, and then move north five times to arrive back at position (4,2) with a vertical trail of five 5s behind it so that the display looks like this:</p>&#13;
<table class="all5">&#13;
<colgroup>&#13;
<col style="width:20%"/>&#13;
<col style="width:20%"/>&#13;
<col style="width:20%"/>&#13;
<col style="width:20%"/>&#13;
<col style="width:20%"/>&#13;
</colgroup>&#13;
<tbody>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">0</p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">0</p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">5</p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">0</p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">0</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">0</p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">0</p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">5</p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">0</p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">0</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">0</p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">0</p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">5</p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">0</p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">0</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">0</p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">0</p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">5</p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">0</p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">0</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">0</p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">0</p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">5</p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">0</p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">0</p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_377"/><a href="ch14.xhtml#ch014fig2">Figure 14-2</a> illustrates the process.</p>&#13;
<div class="image"><img id="ch014fig2" src="Images/14fig02.jpg" alt="Image" width="531" height="286"/></div>&#13;
<p class="figcap"><em>Figure 14-2: How the firefly moves</em></p>&#13;
<p class="indent">The first command, <span class="literal">S</span>, moves the firefly south from (2,2) to (3,2), as shown with the arrow. The next <span class="literal">S</span> moves the firefly to (4,2). The <span class="literal">5</span> sets the trail to intensity 5. Lastly, the five <span class="literal">N</span> commands move the firefly as shown, leaving a trail behind it and finishing at position (4,2).</p>&#13;
<p class="indent">Note that there is no way to ask what the current value of a position is. When the program starts, all positions are 0. If the move mode is increment, adding 1 to the current position’s value wraps around, so 9 becomes 0. Similarly, if the mode is decrement, 0 wraps around to become 9. Use mode <span class="literal">R</span> to set the value to a random integer between 1 and 9.</p>&#13;
<h4 class="h4" id="lev2sec124"><strong><em>Display</em></strong></h4>&#13;
<p class="noindent">Double buffering maintains two 5×5 memory grids. Only one grid is shown at a time, and it’s possible to create any combination of the grid shown and the grid the firefly is making a trail on. We’ll call our two grids A and B. When the program starts, grid A is shown and the firefly draws on grid A. The display instructions are in <a href="ch14.xhtml#ch014tab3">Table 14-3</a>.</p>&#13;
<p class="tabcap" id="ch014tab3"><strong>Table 14-3:</strong> Firefly Display Commands</p>&#13;
<table class="all">&#13;
<colgroup>&#13;
<col style="width:40%"/>&#13;
<col style="width:60%"/>&#13;
</colgroup>&#13;
<thead>&#13;
<tr>&#13;
<th style="vertical-align: top;" class="table-h"><p class="taba"><strong>Instruction</strong></p></th>&#13;
<th style="vertical-align: top;" class="table-h"><p class="taba"><strong>Effect</strong></p></th>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba">X</p></td>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba">Show grid A</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">Y</p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">Show grid B</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba">A</p></td>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba">Draw on grid A</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">B</p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">Draw on grid B</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba">C</p></td>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba">Clear active grid</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">V</p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">Clear grid A</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1b_bot"><p class="taba">Z</p></td>&#13;
<td style="vertical-align: top;" class="table-1b_bot"><p class="taba">Clear grid B</p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<p class="indent">The instruction <span class="literal">C</span> clears the grid currently being displayed, but <span class="literal">V</span> and <span class="literal">Z</span> clear their respective grids regardless of which one is currently displayed. Therefore, to show grid A but make the firefly draw on grid B, execute <span class="literal">XB</span>, <span epub:type="pagebreak" id="page_378"/>and then, when the firefly is done drawing, show grid B with <span class="literal">Y</span>. We’ll explore animation more in <a href="ch15.xhtml#ch15">Chapter 15</a>.</p>&#13;
<h4 class="h4" id="lev2sec125"><strong><em>Music</em></strong></h4>&#13;
<p class="noindent">To make the firefly sing, we need the three instructions in <a href="ch14.xhtml#ch014tab4">Table 14-4</a>.</p>&#13;
<p class="tabcap" id="ch014tab4"><strong>Table 14-4:</strong> Firefly Music Commands</p>&#13;
<table class="all">&#13;
<colgroup>&#13;
<col style="width:40%"/>&#13;
<col style="width:60%"/>&#13;
</colgroup>&#13;
<thead>&#13;
<tr>&#13;
<th style="vertical-align: top;" class="table-h"><p class="taba"><strong>Instruction</strong></p></th>&#13;
<th style="vertical-align: top;" class="table-h"><p class="taba"><strong>Effect</strong></p></th>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">J</p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">Set note duration</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">G</p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">Set octave</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1bw_bot"><p class="taba">F</p></td>&#13;
<td style="vertical-align: top;" class="table-1bw_bot"><p class="taba">Play a note</p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<p class="indent">Each instruction uses the value of the firefly’s current position for the duration, octave, or note.</p>&#13;
<p class="indent">Under the hood, these instructions use the <span class="literal">play</span> function in the MicroPython <span class="literal">music</span> module. The easiest instructions to understand are duration and octave. The micro:bit range is such that octave 4 includes middle C, which is the default value. So, to set the octave to 4, we first need to set the firefly’s current position and then the octave: <span class="literal">4TG</span>. The <span class="literal">4</span> sets the mode to 4, meaning the firefly’s trail uses intensity 4. Next, we keep the firefly in place with <span class="literal">T</span>. Lastly, we set the octave with <span class="literal">G</span>.</p>&#13;
<p class="indent">Note that durations are relative, with a duration of 4 being a reasonable value for a quarter note. Therefore, a duration of 2 implies an eighth note and 8 a half note. Durations, and octaves, are persistent, meaning that once set, their value will stay until changed. To set the duration to quarter notes, use something like <span class="literal">4TJ</span>.</p>&#13;
<p class="indent">To play a note, we need <span class="literal">F</span>. The firefly’s current position indicates the actual note according to <a href="ch14.xhtml#ch014tab5">Table 14-5</a>.</p>&#13;
<p class="tabcap" id="ch014tab5"><strong>Table 14-5:</strong> Firefly Note Commands</p>&#13;
<table class="all">&#13;
<colgroup>&#13;
<col style="width:50%"/>&#13;
<col style="width:50%"/>&#13;
</colgroup>&#13;
<thead>&#13;
<tr>&#13;
<th style="vertical-align: top;" class="table-h"><p class="taba"><strong>Value</strong></p></th>&#13;
<th style="vertical-align: top;" class="table-h"><p class="taba"><strong>Note</strong></p></th>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba">0</p></td>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba">Rest</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">1</p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">C</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba">2</p></td>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba">D</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">3</p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">E</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba">4</p></td>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba">F</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">5</p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">G</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba">6</p></td>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba">A</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">7</p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">B</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba">8</p></td>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba">Rest (same as 0)</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1bw_bot"><p class="taba">9</p></td>&#13;
<td style="vertical-align: top;" class="table-1bw_bot"><p class="taba">C (same as 1)</p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<p class="indent">As an example, to play middle C as a quarter note, we would need something like <span class="literal">1TF</span> to set the move mode, or intensity, to 1 (“move” by staying in <span epub:type="pagebreak" id="page_379"/>place); this sets the current position to 1, and <span class="literal">F</span> to play the note. This assumes that the octave and duration are both their default values of 4. As Firefly memory holds only a single digit at a time, we are limited to the C major scale with no sharps or flats.</p>&#13;
<p class="indent">Our singing firefly will have several opportunities to serenade us in <a href="ch15.xhtml#ch15">Chapter 15</a>.</p>&#13;
<h4 class="h4" id="lev2sec126"><strong><em>What’s Left</em></strong></h4>&#13;
<p class="noindent">Only three instructions remain. The first is <span class="literal">H</span>, which stops the program. Similar to <span class="literal">H</span> is <span class="literal">L</span>, which enters an eternal loop (that is, sleeps the program). The difference between the two is most noticeable with the micro:bit. If <span class="literal">H</span> is executed, the program stops and Python clears the display. If we execute <span class="literal">L</span> instead, the program sleeps “forever” and the display remains active.</p>&#13;
<p class="indent">The final instruction is <span class="literal">P</span>, which pauses for 0.1 seconds before continuing. Use <span class="literal">P</span> to add timing effects. We’ll see <span class="literal">P</span> in <a href="ch15.xhtml#ch15">Chapter 15</a> when we implement a tea timer and a counter.</p>&#13;
<p class="indent"><a href="ch14.xhtml#ch014tab6">Table 14-6</a> serves as a reference for all Firefly instructions.</p>&#13;
<p class="tabcap" id="ch014tab6"><strong>Table 14-6:</strong> The Firefly Instruction Set</p>&#13;
<table class="all">&#13;
<colgroup>&#13;
<col style="width:40%"/>&#13;
<col style="width:60%"/>&#13;
</colgroup>&#13;
<thead>&#13;
<tr>&#13;
<th style="vertical-align: top;" class="table-h"><p class="taba"><strong>Instruction</strong></p></th>&#13;
<th style="vertical-align: top;" class="table-h"><p class="taba"><strong>Effect</strong></p></th>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba">N</p></td>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba">Move north</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">S</p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">Move south</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba">E</p></td>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba">Move east</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">W</p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">Move west</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1b_bot1"><p class="taba">T</p></td>&#13;
<td style="vertical-align: top;" class="table-1b_bot1"><p class="taba">Stay put (“tick” of the clock)</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">0–9</p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">Constant intensity value</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba">I</p></td>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba">Increment the current value</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">D</p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">Decrement the current value</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba">M</p></td>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba">Move only, no change in value</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">R</p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">Random value 1 through 9</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba">X</p></td>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba">Show grid A</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">Y</p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">Show grid B</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba">A</p></td>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba">Draw on grid A</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">B</p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">Draw on grid B</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba">C</p></td>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba">Clear active grid</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">V</p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">Clear grid A</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1b_bot1"><p class="taba">Z</p></td>&#13;
<td style="vertical-align: top;" class="table-1b_bot1"><p class="taba">Clear grid B</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">J</p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">Set note duration</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba">G</p></td>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba">Set octave</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1b_bot1"><p class="taba">F</p></td>&#13;
<td style="vertical-align: top;" class="table-1b_bot1"><p class="taba">Play a note</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba">P</p></td>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba">Pause for 0.1 seconds</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">L</p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">Loop forever</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1bw_bot"><p class="taba">H</p></td>&#13;
<td style="vertical-align: top;" class="table-1bw_bot"><p class="taba">Halt</p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<p class="indent">Now, let’s get down to business and actually implement the language.</p>&#13;
<h3 class="h3" id="lev1sec94"><span epub:type="pagebreak" id="page_380"/><strong>Implementation</strong></h3>&#13;
<p class="noindent">Firefly is written in Python, both for simplicity and because the micro:bit runs only a single Python program. We’ll list Python code for the micro:bit version here, but show example Firefly code for the console version in <a href="ch15.xhtml#ch15">Chapter 15</a>. Doing this lets us use whitespace and comments. In <a href="ch15.xhtml#ch15">Chapter 15</a>, we’ll walk through the development process, which typically involves both the console and micro:bit interpreters.</p>&#13;
<p class="indent">Firefly programs are ultimately a string of uppercase letters and digits. For the micro:bit, the string is literally embedded within the Python code for the interpreter after all whitespace has been removed. The micro:bit does have a flat file system, but it’s simpler to embed the Firefly code at the top of the interpreter.</p>&#13;
<p class="indent">The console interpreter allows whitespace and comments beginning with an exclamation point (<span class="literal">!</span>) and running to the end of the current line. The console interpreter also supports execution tracing, which we’ll see in <a href="ch15.xhtml#ch15">Chapter 15</a>.</p>&#13;
<h4 class="h4" id="lev2sec127"><strong><em>Interpreter Structure and Main Loop</em></strong></h4>&#13;
<p class="noindent">The Firefly interpreter consists of a set of global variables, including the displays, a few functions to handle specific Firefly instructions, and the main loop that executes character after character of the program string. The implementation is deliberately not object oriented, in part to possibly reduce overhead and preserve room on the micro:bit for Firefly code, and in part to be old-school about things as a change of pace. Therefore, the interpreter begins with a series of declarations and necessary imports (see <a href="ch14.xhtml#ch014list1">Listing 14-1</a>).</p>&#13;
<pre>PRG = """&#13;
1TJ0TITFTFTFTFTFTFTF5TG8TJ1TFH&#13;
"""&#13;
&#13;
from microbit import display&#13;
from music import play&#13;
from time import sleep&#13;
from random import randint&#13;
&#13;
DIGITS = ["0","1","2","3","4","5","6","7","8","9"]&#13;
MOVES = ["N","E","W","T","S","L"]&#13;
BUFS = ["A","B","X","Y"]&#13;
&#13;
A = bytearray(25)&#13;
B = bytearray(25)&#13;
C = A&#13;
D = A&#13;
M = "M"&#13;
I = 12<span epub:type="pagebreak" id="page_381"/>&#13;
dur = 4&#13;
oc = 4&#13;
display.clear()</pre>&#13;
<p class="caption" id="ch014list1"><em>Listing 14-1: Firefly interpreter preamble</em></p>&#13;
<p class="indent">The global variable <span class="literal">PRG</span> holds the Firefly program to execute. The example program in <a href="ch14.xhtml#ch014list1">Listing 14-1</a> plays a simple scale.</p>&#13;
<p class="indent">Necessary Python imports come next. The first two functions are exclusive to MicroPython, which runs on the micro:bit; they handle the LED display and playing musical notes, respectively. The <span class="literal">time</span> and <span class="literal">random</span> modules are standard Python fare. We use <span class="literal">sleep</span> to implement the <span class="literal">P</span> instruction and <span class="literal">randint</span> for the <span class="literal">R</span> movement mode.</p>&#13;
<p class="indent">The Firefly display, a 5×5 grid of single-digit values, is stored in a Python <span class="literal">bytearray</span>. There are two of them, <span class="literal">A</span> and <span class="literal">B</span>. The display currently shown is the array assigned to <span class="literal">D</span>, with <span class="literal">A</span> being the default. Likewise, the array currently drawn to by the moving firefly is in <span class="literal">C</span>, which is also <span class="literal">A</span> by default. <span class="literal">M</span> holds the current movement mode with <span class="literal">"M"</span>, which is the default value and means “move with no trail.”</p>&#13;
<p class="indent">The display is in <span class="literal">A</span> or <span class="literal">B</span> with <span class="literal">I</span> as the index or current position of the firefly. When needed, this index is converted into row and column. The default note duration is in <span class="literal">dur</span> and the default note octave is in <span class="literal">oc</span>. When the program starts, the actual micro:bit display is cleared (<span class="literal">display.clear()</span>).</p>&#13;
<p class="indent">After the preamble in <a href="ch14.xhtml#ch014list1">Listing 14-1</a> come seven function definitions. We’ll get to these in the following sections. The main loop comes last. Note that there is no <span class="literal">main</span> function, as the interpreter runs as a script. The main loop is in <a href="ch14.xhtml#ch014list2">Listing 14-2</a>.</p>&#13;
<pre>R = True&#13;
while R:&#13;
    for c in PRG:&#13;
        if c == "I":&#13;
            M = "I"&#13;
        elif c == "D":&#13;
            M = "D"&#13;
        elif c == "M":&#13;
            M = "M"&#13;
        elif c == "R":&#13;
            M = "R"&#13;
        elif c in DIGITS:&#13;
            M = c&#13;
        elif c == "H":&#13;
            R = False&#13;
            break&#13;
        elif c in MOVES:&#13;
            Move(c)&#13;
        elif c == "P":&#13;
            sleep(0.1)<span epub:type="pagebreak" id="page_382"/>&#13;
        elif c == "C":&#13;
            Clear()&#13;
        elif c == "V":&#13;
            ClearA()&#13;
        elif c == "Z":&#13;
            ClearB()&#13;
        elif c in BUFS:&#13;
            Display(c)&#13;
        elif c == "J":&#13;
            dur = C[I]&#13;
        elif c == "F":&#13;
            Play()&#13;
        elif c == "G":&#13;
            oc = C[I]&#13;
        Update()&#13;
&#13;
    C = A&#13;
    D = A&#13;
    M = "M"&#13;
    I = 12&#13;
    display.clear()</pre>&#13;
<p class="caption" id="ch014list2"><em>Listing 14-2: Firefly interpreter main loop</em></p>&#13;
<p class="indent">The main loop runs as long as <span class="literal">R</span> is <span class="literal">True</span>. This means that a Firefly program will begin again after the last instruction. It also means that memory will not be erased. This is the only looping supported by Firefly. We’ll see how to use it in <a href="ch15.xhtml#ch15">Chapter 15</a> when we implement a counter.</p>&#13;
<p class="indent">The inner <span class="literal">for</span> loop is over the characters representing the Firefly program (<span class="literal">PRG</span>). Interpretation is a straightforward nested <span class="literal">if</span> statement. Certain instructions are handled directly in the <span class="literal">for</span> loop, like setting the movement mode to increment (<span class="literal">I</span>) or decrement (<span class="literal">D</span>). If the current character, <span class="literal">c</span>, is a digit (in <span class="literal">DIGITS</span>), the move mode is set to that digit value, <span class="literal">M=c</span>.</p>&#13;
<p class="indent">The only way to exit a Firefly program completely is to execute <span class="literal">H</span>, which sets <span class="literal">R</span> to <span class="literal">False</span> and then uses <span class="literal">break</span> to exit the inner <span class="literal">for</span> loop.</p>&#13;
<p class="indent">Movement instructions (<span class="literal">MOVES</span>), display instructions (<span class="literal">BUFS</span>), and playing a note (<span class="literal">F</span>) all call out to external functions to perform actions.</p>&#13;
<p class="indent">Notice the note duration (<span class="literal">J</span>) and note octave (<span class="literal">G</span>) instructions. They set the <span class="literal">dur</span> or <span class="literal">oc</span> global variables to <span class="literal">C[I]</span>. The index, <span class="literal">I</span>, represents the firefly’s current position in the range [0,24], and <span class="literal">C</span> is assigned the <span class="literal">bytearray</span> for the memory the firefly is currently drawing to, either <span class="literal">A</span> or <span class="literal">B</span>.</p>&#13;
<p class="indent">A call to <span class="literal">Update</span> happens after each instruction is executed to update the micro:bit display. This is what the <span class="literal">Update</span> function looks like:</p>&#13;
<pre>def Update():&#13;
    i = 0&#13;
    while i &lt; 25:&#13;
        display.set_pixel(i%5, i//5, D[i])&#13;
        i += 1</pre>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_383"/>A simple loop over the 25 elements of the <span class="literal">bytearray</span> assigned to global variable <span class="literal">D</span> determines the brightness of each of the LEDs in the 5×5 display. Note the conversion from a linear index (<span class="literal">i</span>) to display column (<span class="literal">i%5</span>) and row (<span class="literal">i//5</span>) for the currently active memory (<span class="literal">D</span>).</p>&#13;
<p class="indent">The final set of instructions—the bottom of the main loop shown in <a href="ch14.xhtml#ch014list2">Listing 14-2</a>—resets the display at the end of the program and then executes again from the beginning. Note that the default firefly position of (2,2) is set, as is showing and drawing on the first memory, <span class="literal">A</span>. However, the memories themselves are <em>not</em> reset to 0.</p>&#13;
<h4 class="h4" id="lev2sec128"><strong><em>Movement</em></strong></h4>&#13;
<p class="noindent">Memory is not updated unless the firefly “moves.” What happens when the firefly moves is determined by the value of global variable <span class="literal">M</span>, which holds the current move mode. <a href="ch14.xhtml#ch014list3">Listing 14-3</a> shows how movement is processed.</p>&#13;
<pre>def Move(c):&#13;
    global I,C&#13;
&#13;
 <span class="ent">➊</span> if M == "M":&#13;
        pass&#13;
    elif M == "I":&#13;
        C[I] += 1&#13;
        if C[I] &gt; 9:&#13;
            C[I] = 0&#13;
    elif M == "D":&#13;
        if (C[I] == 0):&#13;
            C[I] = 9&#13;
        else:&#13;
            C[I] -= 1&#13;
    elif M == "R":&#13;
        C[I] = randint(1,9)&#13;
    else:&#13;
        C[I] = int(M)&#13;
&#13;
 <span class="ent">➋</span> i = I//5&#13;
    j = I%5&#13;
&#13;
 <span class="ent">➌</span> if c == "N":&#13;
        i -= 1&#13;
        if i &lt; 0:&#13;
            i = 4&#13;
    elif c == "S":&#13;
        i += 1&#13;
        if i &gt; 4:&#13;
            i = 0&#13;
    elif c == "E":&#13;
        j += 1<span epub:type="pagebreak" id="page_384"/>&#13;
        if j &gt; 4:&#13;
            j = 0&#13;
    elif c == "W":&#13;
        j -= 1&#13;
        if j &lt; 0:&#13;
            j = 4&#13;
    elif c == "T":&#13;
        pass&#13;
    elif c == "L":&#13;
        while True:&#13;
            sleep(1000)&#13;
&#13;
    I = 5*i + j</pre>&#13;
<p class="caption" id="ch014list3"><em>Listing 14-3: Firefly interpreter movement</em></p>&#13;
<p class="indent">First, the current mode is applied to the <em>current</em> firefly position <span class="ent">➊</span>. Incrementing the position wraps around after 9 while decrementing wraps the other way if below 0. If the mode is <span class="literal">R</span>, a random integer is assigned to the current memory location, <span class="literal">C[I]</span>. Lastly, if the mode is a digit, that value is used to update memory.</p>&#13;
<p class="indent">Next, the interpreter converts the linear index into memory, <span class="literal">I</span>, to a row (<span class="literal">i</span>) and column (<span class="literal">j</span>) format so that we can apply the actual movement command <span class="ent">➋</span>. Integer division by 5 maps <span class="literal">I</span> to 0 through 4 to give us the row. The modulo, that is, what’s left over after integer division by 5, gives us the remainder representing the column.</p>&#13;
<p class="indent">The current move is now applied <span class="ent">➌</span>. Note that <span class="literal">Move</span> is called only if the instruction is a move instruction. The cardinal directions update the row and column position accordingly, wrapping around as needed so that moving east when in column 4 moves back around to column 0, and so on.</p>&#13;
<p class="indent">There are two special move commands, <span class="literal">T</span> and <span class="literal">L</span>. The former acts like a tick of a clock. The firefly doesn’t actually move to a new position, hence <span class="literal">pass</span>, but the interpreter does update the current position. The latter instruction, <span class="literal">L</span>, is specifically for the micro:bit. It enters an infinite loop that sleeps for 1,000 seconds before waking up briefly, only to sleep again. As stated above, a Firefly program executes <span class="literal">H</span> to halt the program and the interpreter exits. On the micro:bit, when a program exits, the display is cleared. Calling <span class="literal">L</span> instead of <span class="literal">H</span> preserves the display.</p>&#13;
<p class="indent">After the move command is executed, <span class="literal">i</span> and/or <span class="literal">j</span> have been updated. Before returning to the main loop, a new value for <span class="literal">I</span> is calculated by multiplying the row number (<span class="literal">i</span>) by 5, which is the number of elements per row, and adding the column number (<span class="literal">j</span>).</p>&#13;
<h4 class="h4" id="lev2sec129"><strong><em>Display</em></strong></h4>&#13;
<p class="noindent">Four functions control the display, as shown in <a href="ch14.xhtml#ch014list4">Listing 14-4</a>.</p>&#13;
<pre>def Clear():&#13;
    global C<span epub:type="pagebreak" id="page_385"/>&#13;
    k = 0&#13;
    while k &lt; 25:&#13;
        C[k] = 0&#13;
        k += 1&#13;
&#13;
def ClearA():&#13;
    global A&#13;
    k = 0&#13;
    while k &lt; 25:&#13;
        A[k] = 0&#13;
        k += 1&#13;
&#13;
def ClearB():&#13;
    global B&#13;
    k = 0&#13;
    while k &lt; 25:&#13;
        B[k] = 0&#13;
        k += 1&#13;
&#13;
def Display(c):&#13;
    global C,D&#13;
    if c == "A":&#13;
        C = A&#13;
    elif c == "B":&#13;
        C = B&#13;
    elif c == "X":&#13;
        D = A&#13;
    elif c == "Y":&#13;
        D = B</pre>&#13;
<p class="caption" id="ch014list4"><em>Listing 14-4: Firefly interpreter display</em></p>&#13;
<p class="indent">Three of the functions in <a href="ch14.xhtml#ch014list4">Listing 14-4</a>, <span class="literal">Clear</span>, <span class="literal">ClearA</span>, and <span class="literal">ClearB</span>, simply zero the display memory. The first function zeroes the current display, and the last two zero a given display, that is, <span class="literal">A</span> or <span class="literal">B</span>. Simply assigning a new <span class="literal">bytearray</span> to these global variables will not work because that would break the link with <span class="literal">A</span> and <span class="literal">B</span>, which are <span class="literal">bytearray</span> objects, while <span class="literal">C</span> and <span class="literal">D</span> act more like pointers that reference <span class="literal">A</span> or <span class="literal">B</span>. Recall that <span class="literal">C</span> references the memory the firefly is updating and <span class="literal">D</span> references the memory currently displayed.</p>&#13;
<p class="indent">The <span class="literal">Display</span> function updates the displayed or drawn-to memory based on the argument, <span class="literal">c</span>. Specifying <span class="literal">"A"</span> as the argument makes <span class="literal">C</span> reference <span class="literal"><em>A</em></span> . Likewise, passing <span class="literal">"B"</span> points <span class="literal">C</span> at <span class="literal">B</span>. Passing <span class="literal">"X"</span> changes the displayed memory to <span class="literal">A</span> and passing <span class="literal">"Y"</span> points the display to <span class="literal">B</span>. Note that the <span class="literal">global</span> statements used by these functions to update the global variables properly. Most Python programs use objects, so the <span class="literal">global</span> keyword is seldom used. We decided on a strictly imperative implementation of Firefly, thereby requiring <span class="literal">global</span> statements.</p>&#13;
<h4 class="h4" id="lev2sec130"><span epub:type="pagebreak" id="page_386"/><strong><em>Music</em></strong></h4>&#13;
<p class="noindent">We’ve surveyed the main interpreter loop, movement, and display. Now let’s finish Firefly by implementing the music instructions.</p>&#13;
<p class="indent">The <span class="literal">J</span> and <span class="literal">G</span> instructions, which set the note duration and octave, respectively, are in the main loop (see <a href="ch14.xhtml#ch014list1">Listing 14-1</a>). The play instruction, <span class="literal">F</span>, calls <span class="literal"><em>Play</em></span> .</p>&#13;
<pre>def Play():&#13;
    note = ["R","C","D","E","F","G","A","B"][C[I] % 8]&#13;
    play("%s%d:%d" % (note,oc,dur))</pre>&#13;
<p class="noindent"><span class="literal">Play</span> translates the current firefly position into a note string and then plays the note using the current octave and duration via the MicroPython <span class="literal">music</span> function, <span class="literal">play</span>. There are 10 possible values for a memory location, so the note is modulo 8 to handle cases where the memory value is 8 or 9 by wrapping around to 0 and 1 instead.</p>&#13;
<p class="indent">With <span class="literal">Play</span>, our micro:bit implementation of Firefly is complete. As mentioned earlier, the console version has extra code to handle console cursor positioning, execution tracing, and to capture SIGINT via CTRL-C; please do take a look at how those features are implemented by reading through <em>firefly.py</em>, which is the name of the console version of the interpreter.</p>&#13;
<p class="indent">We’re almost ready for some Firefly programming. However, if we’re using an actual micro:bit, we should become at least familiar enough with it to configure a speaker and power it up. We’ll save programming the micro:bit for <a href="ch15.xhtml#ch15">Chapter 15</a>. For now, let’s take a crash course in micro:bit hardware.</p>&#13;
<h3 class="h3" id="lev1sec95"><strong>Configuring the Micro:bit</strong></h3>&#13;
<p class="noindent">The BBC micro:bit (<em><a href="https://microbit.org/">https://microbit.org/</a></em>) is a small, single-board computer. Out of the box, it runs MicroPython (see the documentation at <em><a href="https://microbit-micropython.readthedocs.io/en/v2-docs/">https://microbit-micropython.readthedocs.io/en/v2-docs/</a></em>). The micro:bit is intended to introduce as many people as possible to programming via an inexpensive computer system. There are two versions available: the older v1 which has 16KB of RAM, and the newer v2 with 128KB of RAM. Both versions are geared toward hardware projects, and a plethora of accessories exist (<em><a href="https://microbit.org/buy/accessories/">https://microbit.org/buy/accessories/</a></em>). To learn more about the impressive amount of hardware supported by the micro:bit itself, see <a href="https://tech.microbit.org/hardware/">https://tech.microbit.org/hardware/</a>. Lastly, to learn more about implementing hardware projects with the micro:bit, see Simon Monk’s excellent book <em>Micro:bit for Mad Scientists</em> (No Starch Press, 2019).</p>&#13;
<h4 class="h4" id="lev2sec131"><strong><em>Micro:bit Hardware Overview</em></strong></h4>&#13;
<p class="noindent"><a href="ch14.xhtml#ch014fig3">Figure 14-3</a> details the micro:bit and its features.</p>&#13;
<div class="image"><span epub:type="pagebreak" id="page_387"/><img id="ch014fig3" src="Images/14fig03.jpg" alt="Image" width="678" height="719"/></div>&#13;
<p class="figcap"><em>Figure 14-3: A hardware overview of the micro:bit (version 2)</em></p>&#13;
<p class="indent">Of primary interest to us is the 5×5 LED display, the speaker, and the Micro-USB connector to program the device. If you have the older version 1 device, there is no built-in speaker. In that case, you’ll need to attach an external speaker; see the following section.</p>&#13;
<p class="indent">The micro:bit comes with a small battery pack for two AAA batteries. However, it runs just fine from the Micro-USB connector when attached to a computer or a 5V power supply. However, early versions of the micro:bit, those before version 1.3B, should not be run from an external 5V supply. If your micro:bit has a speaker, it’s good to go. If it doesn’t, check the version, which is visible on the back in small print near the right side of the edge connector, to make sure it is at least version 1.3B or 1.5.</p>&#13;
<h4 class="h4" id="lev2sec132"><span epub:type="pagebreak" id="page_388"/><strong><em>Using an External Speaker</em></strong></h4>&#13;
<p class="noindent">Skip this section if your micro:bit is version 2 with a built-in speaker. For version 1 devices, we’ll need to add an external speaker, but have no fear: doing so is painless. Let’s walk through the process.</p>&#13;
<p class="indent">First, you need a speaker of some sort. If you have an old speaker from a defunct electronics device, like an old radio, you can use it. In years past, most tinkerers had many such speakers pulled from dead transistor radios. However, in this day and age, it’s more likely you don’t have a bare speaker lying around. But not all is lost! It turns out that a pair of headphones will work just fine.</p>&#13;
<p class="indent">The micro:bit edge connector is the interface between the micro:bit and external hardware devices. To connect a speaker, attach one wire to connector 0 (the one with the “0” on it), and the other wire to the connector marked “GND.” If using headphones, connect the headphone plug’s tip to connector 0 and the part of the plug farthest from the tip to the GND connector. The connections are easiest to make with alligator clips, but if you don’t have those handy, bare wires twisted together and wrapped around the connectors going through the holes on the micro:bit will do the trick. <a href="ch14.xhtml#ch014fig4">Figure 14-4</a> shows how to connect a generic speaker using alligator clips. The inset shows how to connect headphones.</p>&#13;
<div class="image"><img id="ch014fig4" src="Images/14fig04.jpg" alt="Image" width="561" height="535"/></div>&#13;
<p class="figcap"><em>Figure 14-4: Connecting an external speaker or headphones</em></p>&#13;
<p class="indent">Some speakers are marked with plus (+) and minus (–) connections. If so, connect the white wire in <a href="ch14.xhtml#ch014fig4">Figure 14-4</a> to the + connection and the red to the – connection. Don’t worry if the speaker isn’t marked for polarity; it <span epub:type="pagebreak" id="page_389"/>will still work whichever way you connect the wires. For the headphones, the part of the plug farthest from the tip is usually ground, so connect the red wire to it and the white to the tip.</p>&#13;
<h3 class="h3" id="lev1sec96"><strong>Summary</strong></h3>&#13;
<p class="noindent">This chapter introduced us to Firefly, its design, and the rationale behind it. We then walked through the implementation as we’ll soon run it on the micro:bit and concluded by configuring the micro:bit for our Firefly experiments. Firefly is about as simple as a programming language gets. Now, let’s watch some fireflies and see what they can do.<span epub:type="pagebreak" id="page_390"/></p>&#13;
</div></body></html>