- en: —16—
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Inverted Indexes: The Search Narrows'
  prefs: []
  type: TYPE_NORMAL
- en: The gentle tinkle of a bell announced Frank’s arrival at Cloaks and More in
    the center of the capital the next morning. Nearly every square inch of the small
    shop was packed tight with racks of cloaks. Frank forced his way through a narrow
    gap between racks toward the counter in the back.
  prefs: []
  type: TYPE_NORMAL
- en: A small balding man peered up through thick glasses. “Welcome to Cloaks and
    More. I am Gilbert Cloaksworth. How can I help you today?”
  prefs: []
  type: TYPE_NORMAL
- en: He looked Frank up and down. His eyes flicked repeatedly to Frank’s well-worn
    trench cloak, and when he noticed a patch near the shoulder, the shop owner shuddered.
  prefs: []
  type: TYPE_NORMAL
- en: “I see you are in the market for a new cloak,” he ventured with the fake cheeriness
    perfected by snobby shopkeepers the world over. “You have come to the right place.
    We’ve just received a wonderful shipment of forest green traveling cloaks.”
  prefs: []
  type: TYPE_NORMAL
- en: “I’m looking for information,” said Frank. He pulled out the threads from the
    ArrayCart and held them out to the man. “I need to know what cloak these came
    from.”
  prefs: []
  type: TYPE_NORMAL
- en: Mr. Cloaksworth didn’t move. “Not a new cloak?”
  prefs: []
  type: TYPE_NORMAL
- en: “Just information.”
  prefs: []
  type: TYPE_NORMAL
- en: '![image](../images/f0128-01.jpg)'
  prefs: []
  type: TYPE_IMG
- en: “A pity,” said Cloaksworth coldly. “But I guess you still came to the right
    place. I am the city’s foremost expert in cloaks.” The shop owner took the threads
    and peered at them for a moment. Then he pulled a large magnifying glass from
    under the counter and examined them at length.
  prefs: []
  type: TYPE_NORMAL
- en: “Black and orange with a cross-weave stitch,” Cloaksworth muttered. “Reasonable
    quality. Not up to my standards, of course, but reasonable.”
  prefs: []
  type: TYPE_NORMAL
- en: “Can you tell me anything else?” prompted Frank. “Something useful perhaps?”
  prefs: []
  type: TYPE_NORMAL
- en: The shop owner scowled, but continued studying the threads. “A trace of charring,”
    he said finally.
  prefs: []
  type: TYPE_NORMAL
- en: “It was in a fire?” Frank asked.
  prefs: []
  type: TYPE_NORMAL
- en: “No. It’s too patterned for that. I’ve only seen this type of charring a few
    times in my life. Always on wizards’ cloaks. This cloak had a spell placed on
    it.”
  prefs: []
  type: TYPE_NORMAL
- en: “Do you know what type?” asked Frank.
  prefs: []
  type: TYPE_NORMAL
- en: Cloaksworth shook his head. “You should ask a wizard. I am the region’s foremost
    expert in cloaks, not spells.”
  prefs: []
  type: TYPE_NORMAL
- en: “How about the coloring?” asked Frank. “I haven’t seen many cloaks with those
    colors. Can you tell me anything about where it might be from?”
  prefs: []
  type: TYPE_NORMAL
- en: Cloaksworth smiled. “Of course I can. I am the kingdom’s foremost expert in
    cloaks.”
  prefs: []
  type: TYPE_NORMAL
- en: He turned and pulled a gigantic book from a shelf and dropped it on the counter
    with a loud thud. He flipped to the back.
  prefs: []
  type: TYPE_NORMAL
- en: “What are you doing?” asked Frank.
  prefs: []
  type: TYPE_NORMAL
- en: “Looking up these colors in *The Registry of Cloaks and Heraldry, Volume 5*,”
    responded the shop owner. “You wanted to know where they came from, didn’t you?”
  prefs: []
  type: TYPE_NORMAL
- en: “But why are you reading the back of the book?” said Frank. “Shouldn’t you be
    starting at the table of contents?”
  prefs: []
  type: TYPE_NORMAL
- en: 'Cloaksworth finally gave a genuine smile. “There have been wonderful advances
    in heraldry tracking the past few years!” he exclaimed. “Traditionally, we did
    exactly what you suggested: scanned the table of contents for the subject of interest
    and then flipped to the correct page—using binary search, of course.'
  prefs: []
  type: TYPE_NORMAL
- en: “And it is true that the table of contents provides an index into books’ subjects.
    But the table of contents is organized all wrong for this type of search. It lists
    topics by the order in which they occur. That’s a fine ordering if you want to
    know what comes next, but not if you are looking for a very particular subject.
    The kingdom now has over 10,000 cloak patterns! It can take a long time just to
    search the table of contents.
  prefs: []
  type: TYPE_NORMAL
- en: “So Amanda Cloakington, the author *The Registry of Cloaks and Heraldry* and
    a personal hero of mine, developed the inverted index. She tracked important terms,
    such as cloak colors, and indexed them in back of the book—almost like a second
    table of contents.”
  prefs: []
  type: TYPE_NORMAL
- en: '![image](../images/f0129-01.jpg)'
  prefs: []
  type: TYPE_IMG
- en: “How does that help?” asked Frank. “She’s just repeating the information that’s
    in the table of contents.”
  prefs: []
  type: TYPE_NORMAL
- en: “Yes. She repeated information, but she used a different order. She organized
    the index at the back in order of the terms. Then for each term, she listed the
    pages where it occurred.”
  prefs: []
  type: TYPE_NORMAL
- en: Frank stared at him, waiting. But the owner seemed to have finished. “So?” Frank
    prompted.
  prefs: []
  type: TYPE_NORMAL
- en: “You only need to look up the term you want, and the index directs you to the
    corresponding pages!” he exclaimed. “No more muddling through the table of contents.
    Your search becomes a lookup.”
  prefs: []
  type: TYPE_NORMAL
- en: “But you still need to search the index to find the correct term, right?” asked
    Frank.
  prefs: []
  type: TYPE_NORMAL
- en: “Well, yes. But since the index is sorted alphabetically by the terms, you can
    just use binary search.”
  prefs: []
  type: TYPE_NORMAL
- en: “What if the item appears on a lot of pages?”
  prefs: []
  type: TYPE_NORMAL
- en: “You need to check them all,” Cloaksworth conceded.
  prefs: []
  type: TYPE_NORMAL
- en: “What if you are looking for a few terms?” asked Frank. “Like three colors of
    thread?”
  prefs: []
  type: TYPE_NORMAL
- en: “Ah! Now that’s where it gets interesting,” said Cloaksworth. “You just need
    to check the pages they have in common. You can find those by *intersecting* the
    sets of page numbers. That means going through the lists and finding the elements
    that occur in *every* list. If you have enough terms, you can usually narrow down
    the pages they’re on to just one or two.
  prefs: []
  type: TYPE_NORMAL
- en: “The other day I had to look up a navy blue and royal blue cloak with wooden
    buttons. I can tell you that there aren’t many of those in the world. In fact,
    just one group uses that combination—the Association of Amateur Weather Forecasters.
    Until last year, they had been using navy blue and dark turquoise, but they were
    forced to change. The Association of Semiprofessional Weather Forecasters claimed,
    rightfully, that the colors were too similar to their own navy blue and light
    turquoise.”
  prefs: []
  type: TYPE_NORMAL
- en: '![image](../images/f0131-01.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Frank thought about it for a moment and nodded. “Interesting idea,” he allowed.
    He could immediately see how such inverted indexes could be applied to other information
    sources. Police records were always sorted by date. Using this new technique,
    you could also index them by the type of crime or the location. These indexes
    could make research orders of magnitude more efficient.
  prefs: []
  type: TYPE_NORMAL
- en: “I wonder if it’ll catch on for other books,” Frank mused.
  prefs: []
  type: TYPE_NORMAL
- en: “Unlikely,” the shop owner scoffed. “Few topics in this world are complicated
    enough to require an index. Not every topic is as rich as cloakology.”
  prefs: []
  type: TYPE_NORMAL
- en: As he spoke, the shop owner searched through the index and proceeded to flip
    rapidly through the book. “Police cloak,” he said at last. “The departments of
    Bool and Functionia use those colors. So do a few of the capital police force’s
    departments. Accounting, Payroll, Records, and Advisory Signage, I believe. All
    different designs, of course. I expect the cloak is a new issue, given the state
    of the threads. Police officers have a tendency to wear out cloaks quickly, especially
    in the Department of Advisory Signage.”
  prefs: []
  type: TYPE_NORMAL
- en: “A new police cloak?” Frank confirmed.
  prefs: []
  type: TYPE_NORMAL
- en: “Most likely,” said Cloaksworth. “I doubt it is a custom design. Those colors
    were popular 20 years ago, but fell out of favor with the rise of pastels. It’s
    a shame, really—there were some beautiful cloaks back in those days. I once made
    a riding cloak with double fastenings and—”
  prefs: []
  type: TYPE_NORMAL
- en: Frank interrupted him, “Anything else you can tell me about the threads?”
  prefs: []
  type: TYPE_NORMAL
- en: The shop owner looked at him. “Aside from the fact that they are probably from
    a new police cloak from one of four departments and it was enchanted with a magic
    spell?”
  prefs: []
  type: TYPE_NORMAL
- en: Frank waited.
  prefs: []
  type: TYPE_NORMAL
- en: “Uh . . . no,” said Cloaksworth finally. “That’s everything.”
  prefs: []
  type: TYPE_NORMAL
- en: Frank nodded. “Thanks,” he said. He picked up the threads and turned to leave.
    He heard a soft gasp as he opened the door and knew the shop owner had seen the
    ragged edge at the bottom of his trench cloak.
  prefs: []
  type: TYPE_NORMAL
- en: '**POLICE ALGORITHMS 101: INVERTED INDEXES**'
  prefs: []
  type: TYPE_NORMAL
- en: '***Excerpt from Professor Drecker’s Lecture***'
  prefs: []
  type: TYPE_NORMAL
- en: An inverted index is a computational data structure similar to the index of
    a book. It provides a mapping from target values to the location in the data where
    those values occur. Inverted indexes are especially useful when a given value
    occurs, or might occur, repeatedly throughout the data.
  prefs: []
  type: TYPE_NORMAL
- en: Consider an example from our lecture on binary search—checking an accounting
    ledger for transactions with a particular merchant. The ledgers are sorted by
    increasing transaction number, indicating the order in which the transactions
    were recorded.
  prefs: []
  type: TYPE_NORMAL
- en: '![image](../images/f0132-01.jpg)'
  prefs: []
  type: TYPE_IMG
- en: While this ordering allows us to efficiently find information for a given transaction
    ID, it doesn’t help us trace transactions to a particular merchant. One option
    would be to re-sort the entries by merchant name. However, this requires us to
    make a copy of the entire ledger, which can be costly.
  prefs: []
  type: TYPE_NORMAL
- en: 'Instead, we can build an additional data structure: an inverted index, keyed
    by merchant name. For each merchant, we then store just a list of all the relevant
    transaction IDs. Since we already know how to efficiently look up any transaction
    given its ID, we can now get from merchant name to transaction information via
    an additional lookup in our index.'
  prefs: []
  type: TYPE_NORMAL
- en: '![image](../images/f0133-01.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Inverted indexes are a great example of a common tradeoff between running time
    and memory usage. An algorithm can trade an increase in memory usage, in the form
    of an additional index, for significantly more efficient searches along a new
    dimension.
  prefs: []
  type: TYPE_NORMAL
