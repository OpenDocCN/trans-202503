<html><head></head><body>
<div id="sbo-rt-content"><section aria-labelledby="header0801" class="chapter" epub:type="chapter" id="ch08" role="doc-chapter">
<header id="header0801">
<h1 class="cn"><span aria-label="117" class="page" epub:type="pagebreak" id="p117" role="doc-pagebreak"/><a class="xref" href="nsp-enoka501485-0007.xhtml#rch08">8</a></h1>
<h1 class="ct">Detecting, Removing, and Preventing Malware</h1>
</header>
<figure class="figure">
<p class="fig"><img alt="Chapter opening icon" height="100" src="images/nsp-enoka501485-ct.jpg" width="100"/></p>
</figure>
<p class="pf"><span class="page" data-locator="p117"/>Malware such as viruses, trojans, and ransomware are significant threats to internet users and likely will be for the foreseeable future. As a result, it’s important to arm yourself and your users with an antivirus solution that detects and removes malware. Additionally, keeping your endpoints up-to-date can prevent malware from infecting your network and in some cases provide more protection than an antivirus (AV) solution.</p>
<p>Antivirus solutions can be tricky to manage because they typically are not cross-platform (that is, they work on only one operating system). If you have multiple operating systems in your network, you’ll need to find an effective AV product for each of them. Although this chapter discusses installing, configuring, and scanning with specific products, most options <span aria-label="118" class="page" epub:type="pagebreak" id="p118" role="doc-pagebreak"/>and settings will be the same across most antivirus solutions. The names of the settings and configuration options may differ slightly, but the same logic and processes should work for most products.</p>
<p>After exploring some antivirus solutions for various operating systems, we’ll consider the differences between malware signatures and heuristic scans, the pros and cons of each approach, and the concept of creating an antivirus farm to catch as much malware as possible across different endpoints. Finally, we’ll cover patch management for various operating systems and how best to keep your endpoints up-to-date.</p>
<section>
<h2 class="ah" id="ah1001"><a class="xref" href="nsp-enoka501485-0007.xhtml#rah1001">Microsoft Defender for Windows</a></h2>
<p class="paft">The latest iteration of the built-in Microsoft antivirus solution is <i>Microsoft Defender</i>. Defender automatically updates its virus definitions and scans for threats on a regular schedule, so Windows computers have decent protection out of the box.</p>
<p>Defender’s automatic scans are <i>quick scans</i> that check only the folders where threats are commonly found. While a quick scan offers fast results and uses few system resources, it’s unlikely to discover and remove malware residing outside of these folders. A <i>full scan</i> scans all your files and running programs, performing a thorough search for malware. It’s recommended to run full scans somewhere between once a week and once a month. The longer the period between full scans, the more time an adversary has to wreak havoc on your systems.</p>
<p>You also have the option to choose custom and offline scans. A <i>custom scan</i> lets you select which folders and files to scan. An <i>offline scan</i> is similar to the Boot to Safe Mode method of malware removal available in earlier versions of Windows. Windows is now capable of automatically rebooting to a state that allows Microsoft Defender to remove persistent malware via this offline scan. This option is a last resort, rather than a scan you would run regularly. If you believe your computer is infected but are unable to find the infection using a full scan, run the offline scan to be certain. Failing this, your only recourse is to wipe your hard drive and re-install Windows from scratch.</p>
<p>To run scans, open <b>Settings▸Update &amp; Security▸Windows Security▸Virus &amp; Threat Protection</b>. Click <b>Scan Options</b>, select the type of scan you want, and then click <b>Scan now</b>.</p>
<p>In the Virus &amp; Threat Protection4Manage Settings menu, ensure Real-time Protection is turned on to enable Defender to protect your computer constantly. You can also add file and folder exclusions from this menu. You might add exclusions when you have files or programs that are legitimate and not a risk to your system, but Defender classifies them as malware and tries to quarantine them anyway.</p>
<p><span aria-label="119" class="page" epub:type="pagebreak" id="p119" role="doc-pagebreak"/>One setting in particular could be considered a risk to your privacy, Automatic Sample Submission, which allows Microsoft Defender to upload your files to Microsoft’s servers in the cloud automatically to be analyzed and scanned for malware. This practice poses a risk: private or confidential data could be leaked to a third party without your knowledge, as Defender won’t ask or advise you of files being uploaded to Microsoft. To turn off this setting, toggle Automatic Sample Submissions.</p>
<p>Related to this setting is the Cloud-Delivered Protection setting. This one isn’t as risky, as it relays only file metadata to Microsoft rather than entire file contents. Cloud-Delivered Protection will still work with Automatic Sample Submission turned off, although it might not perform as well.</p>
<p>Windows will keep Microsoft Defender up-to-date, but it never hurts to update manually occasionally. To update, click <b>Check for Updates</b> on the main Virus &amp; Threat Protection page.</p>
<aside aria-labelledby="bxheader0801" class="box">
<div class="bxheader" id="bxheader0801">
<p class="bxh">XProtect for MacOS</p>
</div>
<p class="bxaft">macOS has a built-in antivirus solution called XProtect. When you download an application from the internet, XProtect will check its definitions file of known-bad files, which is updated when you receive software and operating system updates for your computer. This is less beneficial than an antivirus program that performs a heuristics-based scan (see the upcoming “<a class="xref" href="nsp-enoka501485-0017.xhtml#bh1002">Signatures and Heuristics</a>” section for more information on heuristics) that evaluates files based on their content or behavior, rather than a specific file signature.</p>
</aside>
</section>
<section>
<h2 class="ah" id="ah1002"><a class="xref" href="nsp-enoka501485-0007.xhtml#rah1002">Choosing Malware Detection and Antivirus Tools</a></h2>
<p class="paft">When deciding on the antivirus and malware detection tools you’d like to use, consider whether it’s worth paying for a commercial tool (or the premium version of a free tool) and whether the tool will use signatures or heuristics to detect malware.</p>
<p>In general, if all you want is a simple malware scanning tool, there’s rarely a good reason to pay for a commercial product. Typically, you’ll pay for advanced features, such as an email or web browser scanner built-in to the malware file scanner.</p>
<p>Oftentimes, paid solutions allow for some form of centralized management. Whether that’s a web portal or a management server or agent, you gain visibility and the ability to manage all of your devices from one place. If you have a larger network, there’s value in having this capability; if your network consists of less than 30 devices, you probably don’t need it.</p>
<section>
<h3 class="bh" id="bh1001"><span aria-label="120" class="page" epub:type="pagebreak" id="p120" role="doc-pagebreak"/><a class="xref" href="nsp-enoka501485-0007.xhtml#rbh1001">Antivirus Farm</a></h3>
<p class="paft">There’s also a benefit in foregoing a single solution in favor of using multiple antivirus products in smaller networks. <i>Antivirus farms</i> use several products aiming to catch more malware than a single solution might. It also makes the attacker’s job more difficult; instead of evading a single antivirus product, they need to evade multiple to move laterally through a network.</p>
<p>Antivirus farms are helpful because every antivirus vendor curates their own databases of <i>malware signatures</i>—sequences of bytes in the executable that can be used to identify that specific malware sample. These databases have to be optimized every so often; otherwise, the virus definitions that you download with the software would become too large and unwieldy to be useful. Therefore, older virus definitions may be removed from these databases over time, which means having products from multiple vendors will likely lead to greater coverage of known threats.</p>
</section>
<section>
<h3 class="bh" id="bh1002"><a class="xref" href="nsp-enoka501485-0007.xhtml#rbh1002">Signatures and Heuristics</a></h3>
<p class="paft">You should also aim to use antivirus products that perform both signature-based detection and heuristics. <i>Signatures</i> identify known-malicious software by the contents of an executable or other file, though it’s trivial for an attacker to change the signature of their malware by changing the contents slightly. This is a major weakness when it comes to malware detection software. <i>Heuristics</i>, on the other hand, analyze the way a file behaves and the commands a file might run to determine whether it’s malicious. This is a much more reliable way of detecting known and unknown threats. How do you tell whether a particular antivirus program performs signature-based detection or heuristic scanning? The best way, if it’s not listed on their website, is to contact the vendor and ask. There will always be a contact method listed on their website.</p>
<p class="hd" id="hd1001"><a class="xref" href="nsp-enoka501485-0007.xhtml#rhd1001"><span class="ccust2">#26: Installing Avast on macOS</span></a></p>
<p class="paft">Apple devices, commonly believed to be less prone to malware, are becoming infected more often, which means you should install antivirus software on any Macs on your network. There are many options, both free and commercial, when installing a third-party heuristics-based antivirus solution on your Apple computer. Among these, Avast has topped many lists for several years. To install and configure Avast, use the following steps:</p>
<ol style="list-style-type:none">
<li class="nlf">1. Download Avast from <a class="url-i" href="http://www.avast.com/">http://www.avast.com/</a> and install the software. When the installation has completed, you should be presented with the Avast Security window (see <a class="xref" href="nsp-enoka501485-0017.xhtml#fig0801">Figure 8-1</a>).</li>
</ol>
<figure class="figure" id="fig0801">
<p class="fig"><span aria-label="121" class="page" epub:type="pagebreak" id="p121" role="doc-pagebreak"/><img alt="Screenshot of Avast Security’s window states “This Mac is protected,” “You’re up-to-date! Last updated today at 5:40 am.” It has clickable button titled “Run Smart Scan” and options titled “Core Shields,” “Virus Chest,” “Wi-Fi Inspector,” and “Ransomware Shield.” At the top-right side of the window is an option for Notifications and a Menu button." height="800" src="images/nsp-enoka501485-fig0801.jpg" style="width:95%; height:auto;" width="1200"/></p>
<figcaption>
<p class="figh"><span class="fighn">Figure 8-1</span>: Avast Security window</p>
</figcaption>
</figure>
<ol style="list-style-type:none">
<li class="nl">2. Click <b>Menu▸Preferences</b> to reach Avast’s settings page.</li>
<li class="nl">3. In the General tab, ensure that the <b>Turn on Automatic Updates</b> checkbox is ticked.</li>
<li class="nl">4. In the Privacy tab, <i>untick</i> the two checkboxes allowing your data to be shared with Avast. Similar to Windows Defender, it’s best to protect your privacy.</li>
<li class="nl">5. In the Core Shields tab, enable each of the security checks Avast will run, such as file scanning and web and email protection.</li>
<li class="nl">6. Click the <b>Add Exceptions</b> button under each of the shields to specify any necessary exceptions. Add exceptions if you have files or programs that you know to be legitimate or low risk but that your antivirus classifies as potentially malicious.</li>
<li class="nll">7. In the Scans tab, ensure the checkboxes <b>Scan Whole Files</b>, <b>Scan External Drives</b>, <b>Scan Mounted Network Volumes</b>, <b>Scan All Time Machine Backups</b>, and <b>Scan Archives</b> are ticked. By doing so, you can be certain your antivirus is doing as much as possible to identify threats and protect you from them.</li>
</ol>
<p>A <i>Smart Scan</i> is designed to scan the most vulnerable areas of your computer quickly. While this is less resource intensive and less time consuming, it’s not likely to catch all threats on your computer because it doesn’t scan all areas of your hard drives. A <i>Deep Scan</i> is more comprehensive and includes all areas of storage on your device, optionally including external storage, network locations, Time Machine backups, memory, and rootkit detection. A <i>Targeted Scan</i> scans only specified areas.</p>
<p><span aria-label="122" class="page" epub:type="pagebreak" id="p122" role="doc-pagebreak"/>All of these scans are run from the Scan Central screen in Avast on your Mac. Click the <b>Search</b> button to select the type of scan you want to run and then click <b>Scan Now</b>. Selecting Targeted, USB/DVD, or Custom Scans will prompt you for the locations to scan. Avast will scan your computer for threats, and if any are detected, it will ask what you’d like to do with the relevant files. Select all the files and click <b>Resolve Selected</b> to move them all to the Virus Chest; then click <b>Done</b>. Your computer should now be clean of all potentially malicious files and applications.</p>
<p class="hd" id="hd1002"><a class="xref" href="nsp-enoka501485-0007.xhtml#rhd1002"><span class="ccust2">#27: Installing ClamAV on Linux</span></a></p>
<p class="paft">Linux is susceptible to viruses as well. However, Linux operating systems rarely come with a built-in antivirus application, and there are fewer available than for other operating systems. Most of the available solutions are commercial and therefore have a cost attached, such as Avast Core Security for Linux, though there is an open source solution: ClamAV.</p>
<p>ClamAV is a free application that can be used on Windows, macOS, and Linux. To install it on Ubuntu, log in to your server via SSH as a standard, non-root user. Run the following command to install the version of ClamAV that allows you to automate your virus scanning activity, as well as the GUI, clamtk, which may be useful later:</p>
<div class="codeline">
<p class="cls">$ <code class="b">sudo apt install clamav clamav-daemon clamtk</code></p>
</div>
<p>With the installation complete, your antivirus definitions (the database that tells ClamAV what is malware) should be up-to-date, but you can run the following commands to update the virus definitions—either now or in the future—to stop, update, and then restart ClamAV:</p>
<div class="codeline">
<p class="clf">$ <code class="b">sudo systemctl stop clamav-freshclam</code></p>
<p class="cl">$ <code class="b">sudo freshclam</code></p>
<p class="cll">$ <code class="b">sudo systemctl start clamav-freshclam</code></p>
</div>
<p>To run a malware scan, use the <code>clamscan</code> <code class="i">folder_to_scan</code> command. To scan everything on the system, use <code>/</code> to indicate to ClamAV to scan everything in the root of the filesystem, supply the <code>-r</code> parameter to make the scan recurse all directories, and use <code>sudo</code> so that ClamAV has the necessary permission to read all files in the filesystem:</p>
<div class="codeline">
<p class="clf">$ <code class="b">sudo clamscan -r /</code></p>
<p class="cl"><code class="i">--snip--</code></p>
<p class="cl">----------- SCAN SUMMARY -----------</p>
<p class="cl">Known viruses: 8927215</p>
<p class="cl">Engine version: 0.102.3</p>
<p class="cl">Scanned directories: 89954</p>
<p class="cl">Scanned files: 362758</p>
<p class="cl">Infected files: 0</p>
<p class="cl">Total errors: 82216</p>
<p class="cl">Data scanned: 8767.58 MB</p>
<p class="cl"><span aria-label="123" class="page" epub:type="pagebreak" id="p123" role="doc-pagebreak"/>Data read: 14195.27 MB (ratio 0.62:1)</p>
<p class="cll">Time: 1171.021 sec (19 m 31 s)</p>
</div>
<p>When the scan completes, <code>clamscan</code> will output a scan summary.</p>
<p>In addition to known malware, ClamAV can detect <i>potentially unwanted applications (PUAs)</i>, including software such as adware, peer-to-peer (p2p) programs, remote administration tools, bitcoin miners, and bundleware (software included with but not related to the application being installed), which are not inherently malicious but may pose a risk to or negatively impact your endpoints’ security and performance. To scan for PUAs, include the <code>--detect-pua=yes</code> argument when running ClamAV.</p>
<p>If your scans are taking too long, you can use other advanced parameters to reduce their duration. You can limit the size of the files ClamAV will scan with <code>--max-filesize=</code><code class="i">n</code>, where <code class="i">n</code> is the maximum file size in kilobytes. Any files larger than the size you specify will be skipped and assumed to be clean, reducing the time it takes your scan to complete. Similarly, <code>--max-scansize=</code><code class="i">n</code> scans only archive files (<i>.rar</i> files, <i>.zip</i> files, and so on) up to the specified size—all other archives will be skipped. To limit the depth of the recursion (that is, how many directories will be scanned below the directory where you start the scan), use the <code>--max-dir-recursion=</code><code class="i">n</code> parameter. For more parameters, use the <code>-h</code> argument, as in <code>sudo clamscan -h</code>, to print the help menu.</p>
<p>To run a scan on a regular schedule, use Crontab, a Linux utility designed to execute programs at preset times or intervals. In your terminal, use the <code>crontab -e</code> command to edit the scheduled tasks file:</p>
<div class="codeline">
<p class="clf">$ <code class="b">sudo crontab -e</code></p>
<p class="cl">[sudo] password for user:</p>
<p class="clf"># Edit this file to introduce tasks to be run by cron.</p>
<p class="cl">#</p>
<p class="cl"># Each task to run has to be defined through a single line</p>
<p class="cl"># indicating with different fields when the task will be run</p>
<p class="cl"># and what command to run for the task</p>
<p class="cl">#</p>
<p class="cl"># To define the time you can provide concrete values for</p>
<p class="cl"># minute (m), hour (h), day of month (dom), month (mon),</p>
<p class="cl"># and day of week (dow) or use '*' in these fields (for 'any').</p>
<p class="cl">#</p>
<p class="cl"># Notice that tasks will be started based on the cron’s system</p>
<p class="cl"># daemon’s notion of time and timezones.</p>
<p class="cl">#</p>
<p class="cl"># Output of the crontab jobs (including errors) is sent through</p>
<p class="cl"># email to the user the crontab file belongs to (unless redirected).</p>
<p class="cl">#</p>
<p class="cl"># For example, you can run a backup of all your user accounts</p>
<p class="cl"># at 5 a.m every week with:</p>
<p class="cl"># 0 5 * * 1 tar -zcf /var/backups/home.tgz /home/</p>
<p class="cl">#</p>
<p class="cl"># For more information see the manual pages of crontab(5) and cron(8)</p>
<p class="cl">#</p>
<p class="cll"><code class="b"># m h  dom mon dow   command</code></p>
</div>
<p><span aria-label="124" class="page" epub:type="pagebreak" id="p124" role="doc-pagebreak"/>The large comment at the start of the file explains how to specify tasks with an example. The last line of the comment provides the syntax for scheduling execution of scripts and applications. The order is minute, hour, day of month, month, day of week, and command to execute. Minutes and hours must be numbers, 0 to 59 and 0 to 23, respectively, and you can specify a list of minutes or hours by separating the values with commas (that is, you can run a command at 1, 2, and 3 AM by specifying <code>1,2,3</code>). You can specify days numerically (1 to 7, where 1 is Sunday), or as Sun, Mon, Tue, and so on. Months are 1 to 12 (where 1 is January). An asterisk (<code>*</code>) stands for all possible values for a field; if you want your command to run every month, put an asterisk in the month (<code>mon</code>) position.</p>
<p>Say you want to run <code>clamscan</code> over the entire filesystem at 1 AM every Sunday, including scanning for potentially unwanted applications. At the bottom of the Crontab file, add a new line and enter the following:</p>
<div class="codeline">
<p class="cls">0 1 * * sun clamscan -r / --detect-pua=yes -l /<code class="i">path_to_logfile/clamav.log</code></p>
</div>
<p>By default, you won’t be able to see the results of your scans unless you specify the logfile with the <code>-l</code> parameter. If you want to scan a specific folder, like the user home folders (<i>/home/</i>), every day, in addition to the full system scan, add another entry to the Crontab, following the previous example as a guideline.</p>
<p>Add another line to the Crontab to ensure ClamAV is kept up to date:</p>
<div class="codeline1">
<p class="cl1s">0 0 * * mon systemctl stop clamav-freshclam &amp;&amp; freshclam &amp;&amp; systemctl start clamav-freshclam</p>
</div>
<p>You can link multiple commands together and separate them with a pair of ampersands to run them in series. Find more information on Crontab (or any other terminal command) with the <code>man</code> function. Enter <code class="b">man crontab</code> to open the manual for the application on the command line.</p>
<p class="hd" id="hd1003"><a class="xref" href="nsp-enoka501485-0007.xhtml#rhd1003"><span class="ccust2">#28: Using VirusTotal</span></a></p>
<p class="paft"><i>VirusTotal (VT)</i> tests files to determine whether they’re likely to be malicious (<a class="url-i" href="https://www.virustotal.com/">https://www.virustotal.com/</a>) by taking the concept of an antivirus farm and implementing it on a large scale. It’s a publicly available service where you can upload any file to scan for malware, and VT will scan it with more than 60 antivirus programs. It will then produce a report to let you know whether it contains malware or behaves in a way that may negatively impact your endpoints, security, or privacy. This capability is especially useful if you believe a file is malicious but is undetected by your antivirus.</p>
<p>Be aware that anything uploaded to VT becomes public, so anyone can search for and download the files you upload. To use VT without making your private information public, search VT for the hash of the file you want to check. <i>Hashing</i> is a process for calculating a fixed-length string based on the contents of a file. Hashing is expected to be a one-way process, meaning you can’t take the hash of a file and reverse it to get the original file <span aria-label="125" class="page" epub:type="pagebreak" id="p125" role="doc-pagebreak"/>contents. By creating the hash of a file, you should get a unique string of characters that identify said file. Some hashing algorithms can result in <i>collisions</i>, where two files yield the same hash, though the chances of this happening in most modern hashing functions are slim to none. You can get the hash of a file by using built-in tools in any operating system.</p>
<p class="pcust2"><span class="hemb">Windows PowerShell</span> In Windows, open a PowerShell window and enter the following command to get the MD5 hash of any file:</p>
<div class="codeline">
<p class="cl3s">$ <code class="b">Get-FileHash</code> <code class="i">path_to_file</code> <code class="b">-Algorithm MD5</code></p>
</div>
<p class="pcust2">You can then search for the hash directly in the VirusTotal web portal.</p>
<p class="pcust2"><span class="hemb">Linux and macOS Terminal</span> You can get the MD5 hash of a file in both Linux and macOS using the following command:</p>
<div class="codeline">
<p class="cl3s">$ <code class="b">md5sum</code> <code class="i">path_to_file</code></p>
</div>
<p class="pcust2">Then, search for the resulting hash in the VT web portal.</p>
<p>If a file with the same hash has been uploaded to VT at any point in the past, you’ll be presented with the public report for that file, detailing the malware scan results from all the providers in VT. If it hasn’t been uploaded previously, there’s a good chance the file isn’t malicious.</p>
<p class="hd" id="hd1004"><a class="xref" href="nsp-enoka501485-0007.xhtml#rhd1004"><span class="ccust2">#29: Managing Patches and Updates</span></a></p>
<p class="paft">Along with using antivirus tools, patch management is an important defense because malware exploits are written to attack a specific vulnerability in a network, application, protocol, or operating system. Adversaries pay close attention to Windows updates and patches for other operating systems, as the patch notes call out the vulnerability it’s designed to remediate. Attackers use that vulnerability information to write malware specifically for that security flaw, and anyone who hasn’t downloaded the update can fall victim. This is why operating systems constantly ask you to install updates and patches.</p>
<p>In most cases, end users don’t install updates right away, and adversaries have a window of opportunity to target unpatched systems. It’s in your best interest to install software updates as soon as they become available. Luckily, the process of updating is exceedingly simple and easy to automate. This project describes how to configure system updates on individual systems, and the following section discusses a solution for patch management across multiple endpoints.</p>
</section>
<section>
<h3 class="bh" id="bh1003"><span aria-label="126" class="page" epub:type="pagebreak" id="p126" role="doc-pagebreak"/><a class="xref" href="nsp-enoka501485-0007.xhtml#rbh1003">Windows Update</a></h3>
<p class="paft">For Windows updates, open <b>Windows Settings▸Update &amp; Security</b>. Windows checks for updates automatically at least once per day (assuming the device is left on at all times). To check for, download, and install updates manually, click the <b>Check for Updates</b> button.</p>
<p>If you’d prefer not to worry about updates for a while, click <b>Pause Updates for 7 Days</b>. Updates are critical for keeping your system secure, so pausing the updates is not recommended.</p>
<p>You can restrict Windows from updating your computer during certain times by setting active hours. If you use your computer primarily between 9 AM and 5 PM, you can tell Windows not to update during this window, which is a better option than pausing updates for an extended period of time.</p>
<p>In Advanced Options, you can allow Windows to update other Microsoft products via Windows Update—I recommend turning this on. You can also make Windows force devices to restart after updates are installed, which is useful if you, as the administrator, want to force your end users to restart their machines. You’ll be unpopular, but your network will be more secure.</p>
<p>In the Advanced Options▸Delivery Optimization menu, you can enable the option to download updates from other PCs in your network. This reduces the bandwidth required to download the same updates to multiple computers from the internet. You should turn on this setting, with the caveat that downloads be allowed only from PCs on your local network and not from PCs on the internet.</p>
<p>Back in the Advanced Options pane, the last settings of particular interest are the Privacy settings. You can increase your privacy within this menu by disallowing Windows and Microsoft from sending you targeted ads and content based on your location, browsing habits, and application usage statistics.</p>
</section>
<section>
<h3 class="bh" id="bh1004"><a class="xref" href="nsp-enoka501485-0007.xhtml#rbh1004">macOS Software Update</a></h3>
<p class="paft">Apple devices are much simpler than Windows or Linux because their update process can be almost entirely automated and requires very little user input. To ensure your Apple computers are kept up-to-date, open <b>System Preferences▸Software Update</b>. To allow automatic updates, check <b>Automatically Keep My Mac Up-to-date</b>.</p>
<p>With this check box ticked, click the <b>Advanced</b> button to select what actions should be taken automatically. From this menu (<a class="xref" href="nsp-enoka501485-0017.xhtml#fig0802">Figure 8-2</a>), choose whether your computer can check for updates, download updates, or complete the installation process without user input, and then click <b>OK</b> to save the settings. In most cases, allowing your computer to keep itself up-to-date with no input from the user is desirable; the computer will still confirm with the user before restarting after any updates that require a reboot (which doesn’t happen often).</p>
<figure class="figure" id="fig0802">
<p class="fig"><span aria-label="127" class="page" epub:type="pagebreak" id="p127" role="doc-pagebreak"/><img alt="Screenshot showing macOS’s Software Update → Advanced tab where you can choose to automatically check for updates, download new updates when available, install macOS updates, install app updates from the App Store, and install system data files and security updates." height="460" src="images/nsp-enoka501485-fig0802.jpg" style="width:95%; height:auto;" width="1200"/></p>
<figcaption>
<p class="figh"><span class="fighn">Figure 8-2</span>: macOS advanced software update configuration</p>
</figcaption>
</figure>
<p>Keeping your devices up-to-date in this way ensures they are as secure as possible and protects your and your users’ privacy.</p>
</section>
<section>
<h3 class="bh" id="bh1005"><a class="xref" href="nsp-enoka501485-0007.xhtml#rbh1005">Linux Updates with apt</a></h3>
<p class="paft">As discussed in <a class="xref" href="nsp-enoka501485-0010.xhtml#ch01">Chapter 1</a>, the Linux operating system comes in multiple implementations, called <i>distributions</i>. Each of those distributions uses a package manager to maintain and update the software that the system or user installs. Throughout this book, we use Ubuntu Linux, which uses the Advanced Package Tool (APT) package manager. Package managers simplify the process of keeping your Linux endpoints up-to-date and secure.</p>
<p>To update an Ubuntu system, log in via SSH as a standard, non-root user. When you log in, you should be presented with a welcome message, including information about required and recommended updates:</p>
<div class="codeline">
<p class="clf"><code class="i">--snip--</code></p>
<p class="cl"> * Documentation:  https://help.ubuntu.com</p>
<p class="cl"> * Management:     https://landscape.canonical.com</p>
<p class="cl"> * Support:        https://ubuntu.com/advantage</p>
<p class="clf">105 updates can be installed immediately.</p>
<p class="cl">68 of these updates are security updates.</p>
<p class="cl">To see these additional updates run: apt list --upgradable</p>
<p class="cll"><code class="i">--snip--</code></p>
</div>
<p>To make sure the list of updates is complete, run the <code class="b">apt update</code> command:</p>
<div class="codeline">
<p class="cls">$ <code class="b">sudo apt update</code></p>
</div>
<p>Once the list is up-to-date, run the <code class="b">upgrade</code> command to update all of the software packages:</p>
<div class="codeline">
<p class="cls">$ <code class="b">sudo apt upgrade</code></p>
</div>
<p>The command output will show the number of packages to update, the disk space they’ll use, and various status messages. When prompted, type <b>Y</b> and press ENTER to continue.</p>
<p><span aria-label="128" class="page" epub:type="pagebreak" id="p128" role="doc-pagebreak"/>As with Windows and macOS, some updates require you to reboot the system. If that’s the case, you’ll see something like:</p>
<div class="codeline">
<p class="clf">A reboot is required to replace the running dbus-daemon.</p>
<p class="cll">Please reboot the system when convenient.</p>
</div>
<p>To make Ubuntu update the system and installed packages automatically, use the following command:</p>
<div class="codeline">
<p class="cls">$ <code class="b">sudo dpkg-reconfigure -plow unattended-upgrades</code></p>
</div>
<p>The command will produce the prompt shown in <a class="xref" href="nsp-enoka501485-0017.xhtml#fig0803">Figure 8-3</a>.</p>
<figure class="figure" id="fig0803">
<p class="fig"><img alt="Screenshot showing “Configuring unattended-upgrades” that provides the prompt to “Automatically download and install stable updates?” You can choose Yes or No." height="439" src="images/nsp-enoka501485-fig0803.jpg" style="width:95%; height:auto;" width="1200"/></p>
<figcaption>
<p class="figh"><span class="fighn">Figure 8-3</span>: Ubuntu unattended updates</p>
</figcaption>
</figure>
<p>By selecting <b>Yes</b> and pressing ENTER, you’ll ensure your servers are kept up-to-date, thereby making them inherently more secure. However, you should still check for updates manually and reboot your server once a month.</p>
<p class="hd" id="hd1005"><a class="xref" href="nsp-enoka501485-0007.xhtml#rhd1005"><span class="ccust2">#30: Installing Automox</span></a></p>
<p class="paft">Depending on the size of your network, keeping all your endpoints up to date manually or even semi-manually might feel tedious or overwhelming. A centralized patch management solution like Automox allows you to easily manage all of these things in one place. Automox operates on a per-endpoint subscription model: you can start managing one or more Windows, macOS, or Linux systems (workstations or servers) for a nominal monthly fee, which allows you to patch all of your endpoints, with both system and third-party software patches, from one dashboard. Automox also maintains an asset and software inventory, which is the first step anyone should take to keep their network secure.</p>
</section>
<section>
<h3 class="bh" id="bh1006"><a class="xref" href="nsp-enoka501485-0007.xhtml#rbh1006">Installing Automox</a></h3>
<p class="paft">Head to the Automox website (<a class="url-i" href="https://www.automox.com/">https://www.automox.com/</a>) to sign up for an account (or free trial). Then log in to your account dashboard at <span aria-label="129" class="page" epub:type="pagebreak" id="p129" role="doc-pagebreak"/><a class="url-i" href="https://console.automox.com/">https://console.automox.com/</a>. The dashboard is where you’ll see a summary of your managed endpoints and the updates they require. Of course, until you add some endpoints to your account, this dashboard will be sparse. In the following sections you’ll require a user key to connect your endpoints to Automox. Your key can be found by going to your profile settings page in the Automox web UI, under the Keys tab.</p>
<section>
<h4 class="ch" id="ch1001">Windows</h4>
<p class="paft">To install the Automox agent on Windows endpoints, access the <b>Devices</b> tab from your Automox console, and then click the <b>Add Devices</b> link at the top of the page. You’ll be presented with an OS selection pop-up. Select Windows, and then download the agent.</p>
<p>Once the agent is downloaded, run the installer (an <i>.msi</i> file) as an administrator. Follow the installation wizard, entering your Automox user key from the console when prompted. When the installation has completed, refresh your Automox dashboard to see the newly added endpoint (<a class="xref" href="nsp-enoka501485-0017.xhtml#fig0804">Figure 8-4</a>).</p>
<figure class="figure" id="fig0804">
<p class="fig"><img alt="The Automox dashboard includes the following columns: OS, Device Name, Last Disconnected, Group Membership, Tags, IP Address, OS Version, Scheduled Patches, Total Patches, and Status." height="77" src="images/nsp-enoka501485-fig0804.jpg" style="width:95%; height:auto;" width="1200"/></p>
<figcaption>
<p class="figh"><span class="fighn">Figure 8-4</span>: Automox asset list</p>
</figcaption>
</figure>
</section>
<section>
<h4 class="ch" id="ch1002">macOS and Linux</h4>
<p class="paft">In a Terminal window on a Mac or Linux computer, run the following command, substituting your user key for <code class="i">yourkey</code>:</p>
<div class="codeline1">
<p class="cl1s">$ <code class="b">curl -sS "https://console.automox.com/downloadInstaller?accesskey=</code><code class="i">yourkey</code><code class="b">" | sudo bash</code></p>
</div>
<p>Refresh your console again to see the newly added endpoint(s).</p>
</section>
</section>
<section>
<h3 class="bh" id="bh1007"><a class="xref" href="nsp-enoka501485-0007.xhtml#rbh1007">Using Automox</a></h3>
<p class="paft">Now that you’ve installed Automox on your endpoints, you’ll be able to manage operating system and third-party software patches from a central console. From the Devices tab, you can view all of your managed endpoints and add them to groups—if you’d like to manage them that way. You can also scan your endpoints to identify hardware changes and check for new updates they require, reboot your endpoints remotely, or remove endpoints from your account. By clicking an endpoint, you can see its hardware configuration, IP and MAC addresses, device type, operating system, CPU and RAM details, and other critical information, as shown in <a class="xref" href="nsp-enoka501485-0017.xhtml#fig0805">Figure 8-5</a>. You can also force updates to be applied to the endpoint immediately, rather than wait for the endpoint to be updated according to the update policies specified in the System Management tab.</p>
<figure class="figure" id="fig0805">
<p class="fig"><span aria-label="130" class="page" epub:type="pagebreak" id="p130" role="doc-pagebreak"/><img alt="Automox’s Device Details page displays critical information about each device, including: the device status, connection status, time of the last system scan, the next patch window’s schedule, and the time of last disconnect." height="530" src="images/nsp-enoka501485-fig0805.jpg" style="width:95%; height:auto;" width="1200"/></p>
<figcaption>
<p class="figh"><span class="fighn">Figure 8-5</span>: Automox device details</p>
</figcaption>
</figure>
<p>The System Management tab allows you to create and assign patching policies, which is useful if you want to schedule patch installation. For example, you may decide to automatically install any critical patches daily at 5 <span class="ac">pm</span>. Alternatively, you might want to force the installation of all required patches at 12 <span class="ac">am</span> every Saturday, when people are less likely to be using their computers. You will need to define your own requirements and decide what patching schedule works best for you and your network.</p>
<p>In the Reports tab, you can generate reports of actions taken by Automox to keep your endpoints up-to-date, report on the state of any or all endpoints in your console, or identify noncompliant endpoints. Depending on the size of your network, it may be easier to view this information in your dashboard than to run these reports.</p>
<p>Automox will provide you with an inventory of all the software installed on your managed endpoints and their patch level in the Software tab. This allows you to easily identify software that requires updating and to update it if possible. You can also use this list to identify software that you don’t want in your environment, whether it’s potentially unwanted applications or specific software, like games or other software that violates an organizational policy.</p>
<p>Finally, the Settings tab allows you to create new users to allow other administrators to access your Automox console to manage your endpoints. You can also find and add your agent access keys in this tab. One thing you should absolutely take advantage of is the two-factor authentication setting. By enabling two-factor authentication, you make your account more secure and therefore make unauthorized access to your devices and patch management information much more difficult (discussed further in <a class="xref" href="nsp-enoka501485-0020.xhtml#ch11">Chapter 11</a>).</p>
</section>
</section>
<section>
<h2 class="ah" id="ah1003"><a class="xref" href="nsp-enoka501485-0007.xhtml#rah1003">Summary</a></h2>
<p class="paft">Keeping your systems up-to-date is critical in keeping your network secure. Whether you choose to use the built-in antivirus and patching options for your operating system or a managed patching solution like Automox, updates should be regularly scheduled and virus scans regularly run; otherwise, you leave your network vulnerable to all sorts of adversaries and unnecessary risk.</p>
</section>
</section>
</div></body></html>