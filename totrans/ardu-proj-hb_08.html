<html><head></head><body>
<h1 class="part" id="part07"><span epub:type="pagebreak" id="page_207"/><strong>PART 7</strong><br/><img alt="image" class="middle" src="../images/common-01.jpg"/><br/><span class="big"><strong>ADVANCED</strong></span></h1>&#13;


<h2 class="h2a" id="ch24"><span epub:type="pagebreak" id="page_208"/>PROJECT 24: RAINBOW LIGHT SHOW</h2>&#13;
<p class="h2sub"><strong><span class="gray">IN THIS PROJECT, WE’LL CREATE A RAINBOW LIGHT SHOW USING AN 8×8 RGB LED MATRIX. WE’LL ALSO USE SHIFT REGISTERS TO EXTEND THE ARDUINO AND CONTROL THE MATRIX.</span></strong></p>&#13;
<div class="image2"><img alt="image" src="../images/f0208-01.jpg"/></div>&#13;
<div class="image2"><span epub:type="pagebreak" id="page_209"/><img alt="image" src="../images/f0209-01.jpg"/></div>&#13;
<div class="box1">&#13;
<p class="boxtitle1a"><span class="gray"><strong>PARTS REQUIRED</strong></span></p>&#13;
<p class="bull">• Arduino board</p>&#13;
<p class="bull">• 2 full-size breadboards</p>&#13;
<p class="bull">• Jumper wires</p>&#13;
<p class="bull">• 8×8 RGB LED matrix</p>&#13;
<p class="bull">• 4 74HC595 shift registers</p>&#13;
<p class="bull">• 16 220-ohm resistors</p>&#13;
<p class="bull">• 8 330-ohm resistors</p>&#13;
</div>&#13;
<h3 class="h3" id="ch24lev1sec01"><span epub:type="pagebreak" id="page_210"/><span class="gray"><strong>HOW IT WORKS</strong></span></h3>&#13;
<p class="noindent">An RGB LED matrix (<a href="ch24.xhtml#ch24fig1">Figure 24-1</a>) is a grid of 64 red, green, and blue LEDs. You can create the colors of the rainbow by controlling each LED individually and by mixing colors together.</p>&#13;
<p class="figcaption"><a id="ch24fig1"/><strong>FIGURE 24-1:</strong><br/>An RGB LED matrix</p>&#13;
<div class="image"><img alt="image" src="../images/f24-01.jpg"/></div>&#13;
<p class="indent">The LED matrix has a total of 32 pins (<a href="ch24.xhtml#ch24fig2">Figure 24-2</a>); 8 pins control the common-anode positive leg of each LED, and 8 pins apiece control the level of red, green, and blue. In the matrix we’ve used here, pins 17–20 and 29–32 are the anode pins, 9–16 are for red, 21–28 for green, and 1–8 for blue, but your matrix may have different connections. Pin number 1 will be identified as shown in the bottom-left corner of <a href="ch24.xhtml#ch24fig2">Figure 24-2</a>—the pin numbers run clockwise in this image.</p>&#13;
<p class="figcaption"><a id="ch24fig2"/><strong>FIGURE 24-2:</strong><br/>The pins of an RGB LED matrix</p>&#13;
<div class="image"><img alt="image" src="../images/f24-02.jpg"/></div>&#13;
<p class="indent">Your matrix should have come with a data sheet that tells you which pins control the red, green, and blue LEDs. If the pin numbers on your data sheet are different from those listed in <a href="ch24.xhtml#ch24tab1">Table 24-1</a>, follow your data sheet to make the connections to the shift registers and the Arduino. Each color pin requires a resistor to prevent it from <span epub:type="pagebreak" id="page_211"/>overloading and burning out, but the values are slightly different—use 220-ohm resistors for the blue and green, and 330-ohm resistors for the red.</p>&#13;
<p class="tablecap"><a id="ch24tab1"/><strong>TABLE 24-1:</strong><br/>Pin configuration for an RGB LED matrix</p>&#13;
<table class="all">&#13;
<thead>&#13;
<tr>&#13;
<td class="tableth1a-gr" style="vertical-align: middle;"><p class="tablec"><strong>MATRIX PIN FUNCTION</strong></p></td>&#13;
<td class="tableth2" style="vertical-align: middle;"><p class="tablec"><strong>MATRIX PIN NUMBER</strong></p></td>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td class="table1a-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">Common anode (+)</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="gray">17, 18, 19, 20, 29, 30, 31, 32</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">Red LEDs</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="gray">9, 10, 11, 12, 13, 14, 15, 16</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">Green LEDs</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="gray">21, 22, 23, 24, 25, 26, 27, 28</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table3a-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">Blue LEDs</span></p></td>&#13;
<td class="table3l" style="vertical-align: middle;"><p class="tablec"><span class="gray">1, 2, 3, 4, 5, 6, 7, 8</span></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<p class="indent">The layout may look complicated, but that’s simply because we’re using so many different wires. Just remember to take the project one step at a time.</p>&#13;
<p class="indent">Because there are so many connections, we’ll run out of pins on the Arduino board, so we’ll extend the board using <em>shift registers</em>. A shift register is a digital memory circuit found in calculators, computers, and data-processing systems. This project uses the 74HC595 shift register to control eight outputs at a time, while taking up only three pins on your Arduino. We’ll link multiple registers together to control more pins at once, using one for the common anode and one for each LED color.</p>&#13;
<p class="indent">The pin layout for the shift register is shown in <a href="ch24.xhtml#ch24fig3">Figure 24-3</a>, and the functions are described in <a href="ch24.xhtml#ch24tab2">Table 24-2</a>. When building the project, we’ll refer to the pin number of the shift register and function to assist identification.</p>&#13;
<p class="figcaption"><a id="ch24fig3"/><strong>FIGURE 24-3:</strong><br/>Pin layout for the shift register</p>&#13;
<div class="image"><img alt="image" src="../images/f24-03.jpg"/></div>&#13;
<p class="tablecap"><span epub:type="pagebreak" id="page_212"/><a id="ch24tab2"/><strong>TABLE 24-2:</strong><br/>Shift register pins</p>&#13;
<table class="all">&#13;
<thead>&#13;
<tr>&#13;
<td class="tableth1a-gr" style="vertical-align: middle;"><p class="tablec"><strong>SHIFT REGISTER</strong></p></td>&#13;
<td class="tableth1" style="vertical-align: middle;"><p class="tablec"><strong>CONNECTIONS</strong></p></td>&#13;
<td class="tableth1aa-gr" style="vertical-align: middle;"><p class="tablec"><strong>PIN FUNCTION</strong></p></td>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td class="table1a-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">Pins 1–7, 15</span></p></td>&#13;
<td class="table1" style="vertical-align: middle;"><p class="tablec"><span class="gray">Q0–Q7</span></p></td>&#13;
<td class="table1aa-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">Output pins</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">Pin 8</span></p></td>&#13;
<td class="table1" style="vertical-align: middle;"><p class="tablec"><span class="gray">GND</span></p></td>&#13;
<td class="table1aa-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">Ground, VSS</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">Pin 9</span></p></td>&#13;
<td class="table1" style="vertical-align: middle;"><p class="tablec"><span class="gray">SO</span></p></td>&#13;
<td class="table1aa-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">Serial out</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">Pin 10</span></p></td>&#13;
<td class="table1" style="vertical-align: middle;"><p class="tablec"><span class="gray">MR</span></p></td>&#13;
<td class="table1aa-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">Master Reclear, active low</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">Pin 11</span></p></td>&#13;
<td class="table1" style="vertical-align: middle;"><p class="tablec"><span class="gray">SH_CP</span></p></td>&#13;
<td class="table1aa-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">Shift register clock pin (CLOCK pin)</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">Pin 12</span></p></td>&#13;
<td class="table1" style="vertical-align: middle;"><p class="tablec"><span class="gray">ST_CP</span></p></td>&#13;
<td class="table1aa-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">Storage register clock pin (LATCH pin)</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">Pin 13</span></p></td>&#13;
<td class="table1" style="vertical-align: middle;"><p class="tablec"><span class="gray">OE</span></p></td>&#13;
<td class="table1aa-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">Output Enable, active low</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">Pin 14</span></p></td>&#13;
<td class="table1" style="vertical-align: middle;"><p class="tablec"><span class="gray">DS</span></p></td>&#13;
<td class="table1aa-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">Serial data input (DATA pin)</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table3a-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">Pin 16</span></p></td>&#13;
<td class="table3" style="vertical-align: middle;"><p class="tablec"><span class="gray">VCC</span></p></td>&#13;
<td class="table3aa-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">Positive power</span></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<h3 class="h3" id="ch24lev1sec02"><span class="gray"><strong>THE BUILD</strong></span></h3>&#13;
<ol>&#13;
<li><p class="noindenta">Insert the 8×8 RGB LED matrix across two full-size breadboards.</p></li>&#13;
<li><p class="noindenta">Insert a 330-ohm resistor for each red LED pin and a 220-ohm resistor for each green or blue LED pin.</p></li>&#13;
<li><p class="noindenta">Insert the first shift register into one of the breadboards near the common-anode pins on the LED matrix. Place the register so that it straddles the center break, as shown in <a href="ch24.xhtml#ch24fig4">Figure 24-4</a>. Connect the common-anode pins of the LED matrix to shift register 1 as follows. These pins do not need resistors.</p>&#13;
<table class="all">&#13;
<thead>&#13;
<tr>&#13;
<td class="tableth1a-gr" colspan="2" style="vertical-align: middle;"><p class="tablec"><strong>COMMON-ANODE PINS</strong></p></td>&#13;
<td class="tableth1a-gr1" colspan="2" style="vertical-align: middle;"><p class="tablec"><strong>SHIFT REGISTER 1 PINS</strong></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="tableth1a-gr" style="vertical-align: middle;"><p class="tablec"><strong>LED MATRIX</strong></p></td>&#13;
<td class="tableth1" style="vertical-align: middle;"><p class="tablec"><strong>SHIFT REGISTER</strong></p></td>&#13;
<td class="tableth1aa-gr" style="vertical-align: middle;"><p class="tablec"><strong>SHIFT REGISTER</strong></p></td>&#13;
<td class="tableth2" style="vertical-align: middle;"><p class="tablec"><strong>ARDUINO</strong></p></td>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td class="table1a-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">32</span></p></td>&#13;
<td class="table1" style="vertical-align: middle;"><p class="tablec"><span class="gray">15: Q0</span></p></td>&#13;
<td class="table1ab-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">8: GND</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="gray">GND</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">31</span></p></td>&#13;
<td class="table1" style="vertical-align: middle;"><p class="tablec"><span class="gray">1: Q1</span></p></td>&#13;
<td class="table1ab-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">9: SO</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="gray">Shift 3 DS</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">30</span></p></td>&#13;
<td class="table1" style="vertical-align: middle;"><p class="tablec"><span class="gray">2: Q2</span></p></td>&#13;
<td class="table1ab-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">10: MR</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="gray">+5V</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-gr" style="vertical-align: middle;"><p class="tablec"><span epub:type="pagebreak" id="page_213"/><span class="gray">29</span></p></td>&#13;
<td class="table1" style="vertical-align: middle;"><p class="tablec"><span class="gray">3: Q3</span></p></td>&#13;
<td class="table1ab-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">11: SH-CP</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="gray">13</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">20</span></p></td>&#13;
<td class="table1" style="vertical-align: middle;"><p class="tablec"><span class="gray">4: Q4</span></p></td>&#13;
<td class="table1ab-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">12: ST-CP</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="gray">10</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">19</span></p></td>&#13;
<td class="table1" style="vertical-align: middle;"><p class="tablec"><span class="gray">5: Q5</span></p></td>&#13;
<td class="table1ab-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">13: OE</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="gray">GND</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">18</span></p></td>&#13;
<td class="table1" style="vertical-align: middle;"><p class="tablec"><span class="gray">6: Q6</span></p></td>&#13;
<td class="table1ab-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">14: DS</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="gray">Shift 2 SO</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table3a-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">17</span></p></td>&#13;
<td class="table3" style="vertical-align: middle;"><p class="tablec"><span class="gray">7: Q7</span></p></td>&#13;
<td class="table3ab-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">16: VCC</span></p></td>&#13;
<td class="table3l" style="vertical-align: middle;"><p class="tablec"><span class="gray">+5V</span></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<p class="figcaption"><a id="ch24fig4"/><strong>FIGURE 24-4:</strong><br/>The shift registers should straddle the break of the breadboard.</p>&#13;
<div class="image"><img alt="image" src="../images/f24-04.jpg"/></div></li>&#13;
<li><p class="noindenta">Now insert the remaining three shift registers into the breadboard. Shift register 2 controls the green LEDs, shift register 3 controls the blue LEDs, and shift register 4 controls the red LEDs. Connect the wires for each shift register as shown in the following tables. All color LED pins will need resistors.</p>&#13;
<table class="all">&#13;
<thead>&#13;
<tr>&#13;
<td class="tableth1a-gr2" colspan="2" style="vertical-align: middle;"><p class="tablec"><span epub:type="pagebreak" id="page_214"/><strong>GREEN LED PINS</strong></p></td>&#13;
<td class="tableth1a-gra2" colspan="2" style="vertical-align: middle;"><p class="tablec"><strong>SHIFT REGISTER 2 PINS</strong></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="tableth1a-gr" style="vertical-align: middle;"><p class="tablec"><strong>LED MATRIX</strong></p></td>&#13;
<td class="tableth1" style="vertical-align: middle;"><p class="tablec"><strong>SHIFT REGISTER</strong></p></td>&#13;
<td class="tableth1aa-gr" style="vertical-align: middle;"><p class="tablec"><strong>SHIFT REGISTER</strong></p></td>&#13;
<td class="tableth2" style="vertical-align: middle;"><p class="tablec"><strong>ARDUINO</strong></p></td>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td class="table1a-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">28</span></p></td>&#13;
<td class="table1" style="vertical-align: middle;"><p class="tablec"><span class="gray">15: Q0</span></p></td>&#13;
<td class="table1ab-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">8: GND</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="gray">GND</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">27</span></p></td>&#13;
<td class="table1" style="vertical-align: middle;"><p class="tablec"><span class="gray">1: Q1</span></p></td>&#13;
<td class="table1ab-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">9: SO</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="gray">Shift 1 DS</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">26</span></p></td>&#13;
<td class="table1" style="vertical-align: middle;"><p class="tablec"><span class="gray">2: Q2</span></p></td>&#13;
<td class="table1ab-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">10: MR</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="gray">+5V</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">25</span></p></td>&#13;
<td class="table1" style="vertical-align: middle;"><p class="tablec"><span class="gray">3: Q3</span></p></td>&#13;
<td class="table1ab-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">11: SH-CP</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="gray">13</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">24</span></p></td>&#13;
<td class="table1" style="vertical-align: middle;"><p class="tablec"><span class="gray">4: Q4</span></p></td>&#13;
<td class="table1ab-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">12: ST-CP</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="gray">10</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">23</span></p></td>&#13;
<td class="table1" style="vertical-align: middle;"><p class="tablec"><span class="gray">5: Q5</span></p></td>&#13;
<td class="table1ab-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">13: OE</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="gray">GND</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">22</span></p></td>&#13;
<td class="table1" style="vertical-align: middle;"><p class="tablec"><span class="gray">6: Q6</span></p></td>&#13;
<td class="table1ab-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">14: DS</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="gray">11</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table3a-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">21</span></p></td>&#13;
<td class="table3" style="vertical-align: middle;"><p class="tablec"><span class="gray">7: Q7</span></p></td>&#13;
<td class="table3ab-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">16: VCC</span></p></td>&#13;
<td class="table3l" style="vertical-align: middle;"><p class="tablec"><span class="gray">+5V</span></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<table class="all">&#13;
<thead>&#13;
<tr>&#13;
<td class="tableth1a-gr3" colspan="2" style="vertical-align: middle;"><p class="tablec"><strong>BLUE LED PINS</strong></p></td>&#13;
<td class="tableth1a-gra3" colspan="2" style="vertical-align: middle;"><p class="tablec"><strong>SHIFT REGISTER 3 PINS</strong></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="tableth1a-gr" style="vertical-align: middle;"><p class="tablec"><strong>LED MATRIX</strong></p></td>&#13;
<td class="tableth1" style="vertical-align: middle;"><p class="tablec"><strong>SHIFT REGISTER</strong></p></td>&#13;
<td class="tableth1aa-gr" style="vertical-align: middle;"><p class="tablec"><strong>SHIFT REGISTER</strong></p></td>&#13;
<td class="tableth2" style="vertical-align: middle;"><p class="tablec"><strong>ARDUINO</strong></p></td>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td class="table1a-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">1</span></p></td>&#13;
<td class="table1" style="vertical-align: middle;"><p class="tablec"><span class="gray">15: Q0</span></p></td>&#13;
<td class="table1ab-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">8: GND</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="gray">GND</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">2</span></p></td>&#13;
<td class="table1" style="vertical-align: middle;"><p class="tablec"><span class="gray">1: Q1</span></p></td>&#13;
<td class="table1ab-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">9: SO</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="gray">Shift 4 DS</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">3</span></p></td>&#13;
<td class="table1" style="vertical-align: middle;"><p class="tablec"><span class="gray">2: Q2</span></p></td>&#13;
<td class="table1ab-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">10: MR</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="gray">+5V</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">4</span></p></td>&#13;
<td class="table1" style="vertical-align: middle;"><p class="tablec"><span class="gray">3: Q3</span></p></td>&#13;
<td class="table1ab-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">11: SH-CP</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="gray">13</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">5</span></p></td>&#13;
<td class="table1" style="vertical-align: middle;"><p class="tablec"><span class="gray">4: Q4</span></p></td>&#13;
<td class="table1ab-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">12: ST-CP</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="gray">10</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">6</span></p></td>&#13;
<td class="table1" style="vertical-align: middle;"><p class="tablec"><span class="gray">5: Q5</span></p></td>&#13;
<td class="table1ab-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">13: OE</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="gray">GND</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">7</span></p></td>&#13;
<td class="table1" style="vertical-align: middle;"><p class="tablec"><span class="gray">6: Q6</span></p></td>&#13;
<td class="table1ab-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">14: DS</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="gray">Shift 1 SO</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table3a-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">8</span></p></td>&#13;
<td class="table3" style="vertical-align: middle;"><p class="tablec"><span class="gray">7: Q7</span></p></td>&#13;
<td class="table3ab-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">16: VCC</span></p></td>&#13;
<td class="table3l" style="vertical-align: middle;"><p class="tablec"><span class="gray">+5V</span></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<table class="all">&#13;
<thead>&#13;
<tr>&#13;
<td class="tableth1a-gr4" colspan="2" style="vertical-align: middle;"><p class="tablec"><strong>RED LED PINS</strong></p></td>&#13;
<td class="tableth1a-gra4" colspan="2" style="vertical-align: middle;"><p class="tablec"><strong>SHIFT REGISTER 4 PINS</strong></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="tableth1a-gr" style="vertical-align: middle;"><p class="tablec"><strong>LED MATRIX</strong></p></td>&#13;
<td class="tableth1" style="vertical-align: middle;"><p class="tablec"><strong>SHIFT REGISTER</strong></p></td>&#13;
<td class="tableth1aa-gr" style="vertical-align: middle;"><p class="tablec"><strong>SHIFT REGISTER</strong></p></td>&#13;
<td class="tableth2" style="vertical-align: middle;"><p class="tablec"><strong>ARDUINO</strong></p></td>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td class="table1a-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">9</span></p></td>&#13;
<td class="table1" style="vertical-align: middle;"><p class="tablec"><span class="gray">15: Q0</span></p></td>&#13;
<td class="table1ab-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">8: GND</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="gray">GND</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">10</span></p></td>&#13;
<td class="table1" style="vertical-align: middle;"><p class="tablec"><span class="gray">1: Q1</span></p></td>&#13;
<td class="table1ab-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">9: SO</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="gray">Shift 3 DS</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">11</span></p></td>&#13;
<td class="table1" style="vertical-align: middle;"><p class="tablec"><span class="gray">2: Q2</span></p></td>&#13;
<td class="table1ab-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">10: MR</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="gray">+5V</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">12</span></p></td>&#13;
<td class="table1" style="vertical-align: middle;"><p class="tablec"><span class="gray">3: Q3</span></p></td>&#13;
<td class="table1ab-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">11: SH-CP</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="gray">13</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">13</span></p></td>&#13;
<td class="table1" style="vertical-align: middle;"><p class="tablec"><span class="gray">4: Q4</span></p></td>&#13;
<td class="table1ab-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">12: ST-CP</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="gray">10</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">14</span></p></td>&#13;
<td class="table1" style="vertical-align: middle;"><p class="tablec"><span class="gray">5: Q5</span></p></td>&#13;
<td class="table1ab-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">13: OE</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="gray">GND</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">15</span></p></td>&#13;
<td class="table1" style="vertical-align: middle;"><p class="tablec"><span class="gray">6: Q6</span></p></td>&#13;
<td class="table1ab-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">14: DS</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="gray">Shift 2 SO</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table3a-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">16</span></p></td>&#13;
<td class="table3" style="vertical-align: middle;"><p class="tablec"><span class="gray">7: Q7</span></p></td>&#13;
<td class="table3ab-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">16: VCC</span></p></td>&#13;
<td class="table3l" style="vertical-align: middle;"><p class="tablec"><span class="gray">+5V</span></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table></li>&#13;
<li><p class="noindenta"><span epub:type="pagebreak" id="page_215"/>The Arduino controls the LEDs through three PWM pins, one each for clock, data, and latch. Each pin is connected to the Arduino as follows.</p>&#13;
<table class="all">&#13;
<thead>&#13;
<tr>&#13;
<td class="tableth1a-gr" style="vertical-align: middle;"><p class="tablec"><strong>SHIFT REGISTER</strong></p></td>&#13;
<td class="tableth1" style="vertical-align: middle;"><p class="tablec"><strong>ARDUINO</strong></p></td>&#13;
<td class="tableth1aa-gr" style="vertical-align: middle;"><p class="tablec"><strong>FUNCTION</strong></p></td>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td class="table1a-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">Pin 9 (shift reg 2)</span></p></td>&#13;
<td class="table1" style="vertical-align: middle;"><p class="tablec"><span class="gray">Pin 11</span></p></td>&#13;
<td class="table1aa-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">Data</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">Pin 12 (all shift reg)</span></p></td>&#13;
<td class="table1" style="vertical-align: middle;"><p class="tablec"><span class="gray">Pin 10</span></p></td>&#13;
<td class="table1aa-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">Latch</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table3a-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">Pin 11 (all shift reg)</span></p></td>&#13;
<td class="table3" style="vertical-align: middle;"><p class="tablec"><span class="gray">Pin 13</span></p></td>&#13;
<td class="table3aa-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">Clock</span></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table></li>&#13;
<li><p class="noindenta">Check that your setup matches the circuit diagram in <a href="ch24.xhtml#ch24fig5">Figure 24-5</a>, and then upload the code in “<a href="ch24.xhtml#ch24lev1sec03">The Sketch</a>” below.</p>&#13;
<p class="figcaption"><a id="ch24fig5"/><strong>FIGURE 24-5:</strong><br/>The circuit diagram for the rainbow maker</p>&#13;
<div class="image"><img alt="image" src="../images/f24-05.jpg"/></div></li>&#13;
</ol>&#13;
<h3 class="h3" id="ch24lev1sec03"><span class="gray"><strong>THE SKETCH</strong></span></h3>&#13;
<p class="noindent">The sketch first defines the three Arduino pins that control the shift registers. The latch pin is defined as Arduino pin 10, the clock pin as 13, and the data pin as 11. We define a number of variables between 0 and 255 to control the brightness of the LED colors. The sketch then turns on each LED fully in turn and combines the three colors to <span epub:type="pagebreak" id="page_216"/>create the colors of the rainbow. For instance, with green on, blue off, and red on, the color yellow is displayed. The sketch then finishes by cycling though random colors.</p>&#13;
<pre><span class="ash">/* Example 18.1 - experimenting with RGB LED matrix</span><br/>   <span class="ash">CC by-sa 3.0</span><br/>   <span class="ash">http://tronixstuff.wordpress.com/tutorials</span><br/><span class="ash">*/</span><br/><br/><span class="green2">int</span> latchpin = 10; <span class="ash">// Connect to pin 12 on all shift registers</span><br/><span class="green2">int</span> clockpin = 13; <span class="ash">// Connect to pin 11 on all shift registers</span><br/><span class="green2">int</span> datapin = 11;  <span class="ash">// Connect to pin 14 on shift register 2</span><br/><span class="green2">int</span> zz = 500; <span class="ash">// Delay variable</span><br/><span class="green2">int</span> va[] = {<br/>  1, 2, 4, 8, 16, 32, 64, 128, 255<br/>};<br/><span class="green2">int</span> va2[] = {<br/>  1, 3, 7, 15, 31, 63, 127, 255<br/>};<br/><br/><span class="green2">void</span> <span class="green3">setup</span>() {<br/>  <span class="orange1">pinMode</span>(latchpin, <span class="green2">OUTPUT</span>);<br/>  <span class="orange1">pinMode</span>(clockpin, <span class="green2">OUTPUT</span>);<br/>  <span class="orange1">pinMode</span>(datapin, <span class="green2">OUTPUT</span>);<br/>  <span class="orange1">digitalWrite</span>(latchpin, <span class="green2">LOW</span>);<br/>  <span class="orange1">shiftOut</span>(datapin, clockpin, <span class="green2">MSBFIRST</span>, 0);<br/>  <span class="orange1">shiftOut</span>(datapin, clockpin, <span class="green2">MSBFIRST</span>, 0);<br/>  <span class="orange1">shiftOut</span>(datapin, clockpin, <span class="green2">MSBFIRST</span>, 0);<br/>  <span class="orange1">shiftOut</span>(datapin, clockpin, <span class="green2">MSBFIRST</span>, 0);<br/>  <span class="orange1">digitalWrite</span>(latchpin, <span class="green2">HIGH</span>);<br/>  <span class="orange1">randomSeed</span>(<span class="orange1">analogRead</span>(0));<br/>}<br/><br/><span class="green2">void</span> allRed() { <span class="ash">// Turn on all red LEDs</span><br/>  <span class="orange1">digitalWrite</span>(latchpin, <span class="green2">LOW</span>);<br/>  <span class="orange1">shiftOut</span>(datapin, clockpin, <span class="green2">MSBFIRST</span>, 255); <span class="ash">// Turn cathodes to full</span><br/>  <span class="orange1">shiftOut</span>(datapin, clockpin, <span class="green2">MSBFIRST</span>, 0); <span class="ash">// Turn green to 0</span><br/>  <span class="orange1">shiftOut</span>(datapin, clockpin, <span class="green2">MSBFIRST</span>, 0); <span class="ash">// Turn blue to 0</span><br/>  <span class="orange1">shiftOut</span>(datapin, clockpin, <span class="green2">MSBFIRST</span>, 255); <span class="ash">// Turn red to full</span><br/>  <span class="orange1">digitalWrite</span>(latchpin, <span class="green2">HIGH</span>);<br/>}<br/><br/><span class="green2">void</span> allBlue() { <span class="ash">// Turn on all blue LEDs</span><br/>  <span class="orange1">digitalWrite</span>(latchpin, <span class="green2">LOW</span>);<br/>  <span class="orange1">shiftOut</span>(datapin, clockpin, <span class="green2">MSBFIRST</span>, 255); <span class="ash">// Turn cathodes to full</span><br/>  <span class="orange1">shiftOut</span>(datapin, clockpin, <span class="green2">MSBFIRST</span>, 0); <span class="ash">// Turn green to 0</span><br/>  <span class="orange1">shiftOut</span>(datapin, clockpin, <span class="green2">MSBFIRST</span>, 255); <span class="ash">// Turn blue to full</span><br/>  <span class="orange1">shiftOut</span>(datapin, clockpin, <span class="green2">MSBFIRST</span>, 0); <span class="ash">// Turn red to 0</span><br/>  <span class="orange1">digitalWrite</span>(latchpin, <span class="green2">HIGH</span>);<br/>}<br/><br/><span epub:type="pagebreak" id="page_217"/><span class="green2">void</span> allGreen() { <span class="ash">// Turn on all green LEDs</span><br/>  <span class="orange1">digitalWrite</span>(latchpin, <span class="green2">LOW</span>);<br/>  <span class="orange1">shiftOut</span>(datapin, clockpin, <span class="green2">MSBFIRST</span>, 255); <span class="ash">// Cathodes</span><br/>  <span class="orange1">shiftOut</span>(datapin, clockpin, <span class="green2">MSBFIRST</span>, 255); <span class="ash">// Green</span><br/>  <span class="orange1">shiftOut</span>(datapin, clockpin, <span class="green2">MSBFIRST</span>, 0); <span class="ash">// Blue</span><br/>  <span class="orange1">shiftOut</span>(datapin, clockpin, <span class="green2">MSBFIRST</span>, 0); <span class="ash">// Red</span><br/>  <span class="orange1">digitalWrite</span>(latchpin, <span class="green2">HIGH</span>);<br/>}<br/><br/><span class="green2">void</span> allOn() { <span class="ash">// Turn on all LEDs</span><br/>  <span class="orange1">digitalWrite</span>(latchpin, <span class="green2">LOW</span>);<br/>  <span class="orange1">shiftOut</span>(datapin, clockpin, <span class="green2">MSBFIRST</span>, 255); <span class="ash">// Cathodes</span><br/>  <span class="orange1">shiftOut</span>(datapin, clockpin, <span class="green2">MSBFIRST</span>, 255); <span class="ash">// Green</span><br/>  <span class="orange1">shiftOut</span>(datapin, clockpin, <span class="green2">MSBFIRST</span>, 255); <span class="ash">// Blue</span><br/>  <span class="orange1">shiftOut</span>(datapin, clockpin, <span class="green2">MSBFIRST</span>, 255); <span class="ash">// Red</span><br/>  <span class="orange1">digitalWrite</span>(latchpin, <span class="green2">HIGH</span>);<br/>}<br/><br/><span class="green2">void</span> allYellow() { <span class="ash">// Turn on green and red LEDs (yellow)</span><br/>  <span class="orange1">digitalWrite</span>(latchpin, <span class="green2">LOW</span>);<br/>  <span class="orange1">shiftOut</span>(datapin, clockpin, <span class="green2">MSBFIRST</span>, 255); <span class="ash">// Cathodes</span><br/>  <span class="orange1">shiftOut</span>(datapin, clockpin, <span class="green2">MSBFIRST</span>, 255); <span class="ash">// Green</span><br/>  <span class="orange1">shiftOut</span>(datapin, clockpin, <span class="green2">MSBFIRST</span>, 0); <span class="ash">// Blue</span><br/>  <span class="orange1">shiftOut</span>(datapin, clockpin, <span class="green2">MSBFIRST</span>, 255); <span class="ash">// Red</span><br/>  <span class="orange1">digitalWrite</span>(latchpin, <span class="green2">HIGH</span>);<br/>}<br/><br/><span class="green2">void</span> allAqua() { <span class="ash">// Turn on green and blue LEDs (aqua)</span><br/>  <span class="orange1">digitalWrite</span>(latchpin, <span class="green2">LOW</span>);<br/>  <span class="orange1">shiftOut</span>(datapin, clockpin, <span class="green2">MSBFIRST</span>, 255); <span class="ash">// Cathodes</span><br/>  <span class="orange1">shiftOut</span>(datapin, clockpin, <span class="green2">MSBFIRST</span>, 255); <span class="ash">// Green</span><br/>  <span class="orange1">shiftOut</span>(datapin, clockpin, <span class="green2">MSBFIRST</span>, 255); <span class="ash">// Blue</span><br/>  <span class="orange1">shiftOut</span>(datapin, clockpin, <span class="green2">MSBFIRST</span>, 0); <span class="ash">// Red</span><br/>  <span class="orange1">digitalWrite</span>(latchpin, <span class="green2">HIGH</span>);<br/>}<br/><br/><span class="green2">void</span> allPurple() { <span class="ash">// Turn on blue and red LEDs (purple)</span><br/>  <span class="orange1">digitalWrite</span>(latchpin, <span class="green2">LOW</span>);<br/>  <span class="orange1">shiftOut</span>(datapin, clockpin, <span class="green2">MSBFIRST</span>, 255); <span class="ash">// Cathodes</span><br/>  <span class="orange1">shiftOut</span>(datapin, clockpin, <span class="green2">MSBFIRST</span>, 0); <span class="ash">// Green</span><br/>  <span class="orange1">shiftOut</span>(datapin, clockpin, <span class="green2">MSBFIRST</span>, 255); <span class="ash">// Blue</span><br/>  <span class="orange1">shiftOut</span>(datapin, clockpin, <span class="green2">MSBFIRST</span>, 255); <span class="ash">// Red</span><br/>  <span class="orange1">digitalWrite</span>(latchpin, <span class="green2">HIGH</span>);<br/>}<br/><br/><span class="green2">void</span> clearMatrix() { <span class="ash">// Turn off all LEDs</span><br/>  <span class="orange1">digitalWrite</span>(latchpin, <span class="green2">LOW</span>);<br/>  <span class="orange1">shiftOut</span>(datapin, clockpin, <span class="green2">MSBFIRST</span>, 0); <span class="ash">// Cathodes</span><br/>  <span class="orange1">shiftOut</span>(datapin, clockpin, <span class="green2">MSBFIRST</span>, 0); <span class="ash">// Green</span><br/>  <span class="orange1">shiftOut</span>(datapin, clockpin, <span class="green2">MSBFIRST</span>, 0); <span class="ash">// Blue</span><br/>  <span class="orange1">shiftOut</span>(datapin, clockpin, <span class="green2">MSBFIRST</span>, 0); <span class="ash">// Red</span><br/>  <span class="orange1">digitalWrite</span>(latchpin, <span class="green2">HIGH</span>);<br/>}<br/><br/><span epub:type="pagebreak" id="page_218"/><span class="green2">void</span> lostinspace() { <span class="ash">// Random flashes of the LEDs</span><br/>  <span class="green3">for</span> (<span class="green2">int</span> z = 0; z &lt; 100; z++) {<br/>    <span class="orange1">digitalWrite</span>(latchpin, <span class="green2">LOW</span>);<br/>    <span class="orange1">shiftOut</span>(datapin, clockpin, <span class="green2">MSBFIRST</span>, va[<span class="orange1">random</span>(8)]); <span class="ash">// Cathodes</span><br/>    <span class="orange1">shiftOut</span>(datapin, clockpin, <span class="green2">MSBFIRST</span>, va[<span class="orange1">random</span>(8)]); <span class="ash">// Green</span><br/>    <span class="orange1">shiftOut</span>(datapin, clockpin, <span class="green2">MSBFIRST</span>, va[<span class="orange1">random</span>(8)]); <span class="ash">// Blue</span><br/>    <span class="orange1">shiftOut</span>(datapin, clockpin, <span class="green2">MSBFIRST</span>, va[<span class="orange1">random</span>(8)]); <span class="ash">// Red</span><br/>    <span class="orange1">digitalWrite</span>(latchpin, <span class="green2">HIGH</span>);<br/>    <span class="orange1">delay</span>(100);<br/>  }<br/>}<br/><br/><span class="green2">void</span> displayLEDs(<span class="green2">int</span> rr, <span class="green2">int</span> gg, <span class="green2">int</span> bb, <span class="green2">int</span> cc, <span class="green2">int</span> dd) {<br/><span class="ash">// Insert the base-10 values into the shiftOut functions</span><br/><span class="ash">// and hold the display for dd milliseconds</span><br/>  <span class="orange1">digitalWrite</span>(latchpin, <span class="green2">LOW</span>);<br/>  <span class="orange1">shiftOut</span>(datapin, clockpin, <span class="green2">MSBFIRST</span>, cc); <span class="ash">// Cathodes</span><br/>  <span class="orange1">shiftOut</span>(datapin, clockpin, <span class="green2">MSBFIRST</span>, gg); <span class="ash">// Green</span><br/>  <span class="orange1">shiftOut</span>(datapin, clockpin, <span class="green2">MSBFIRST</span>, bb); <span class="ash">// Blue</span><br/>  <span class="orange1">shiftOut</span>(datapin, clockpin, <span class="green2">MSBFIRST</span>, rr); <span class="ash">// Red</span><br/>  <span class="orange1">digitalWrite</span>(latchpin, <span class="green2">HIGH</span>);<br/>  <span class="orange1">delay</span>(dd);<br/>}<br/><br/><span class="green2">void</span> <span class="green3">loop</span>() { <span class="ash">// Light up the whole display in solid colors</span><br/>  allOn();<br/>  <span class="orange1">delay</span>(zz);<br/><br/>  <span class="orange1">delay</span>(zz);<br/>  allRed();<br/>  <span class="orange1">delay</span>(zz);<br/><br/>  <span class="orange1">delay</span>(zz);<br/>  allGreen();<br/>  <span class="orange1">delay</span>(zz);<br/><br/>  <span class="orange1">delay</span>(zz);<br/>  allBlue();<br/>  <span class="orange1">delay</span>(zz);<br/><br/>  <span class="orange1">delay</span>(zz);<br/>  allPurple();<br/>  <span class="orange1">delay</span>(zz);<br/><br/>  <span class="orange1">delay</span>(zz);<br/>  allYellow();<br/>  <span class="orange1">delay</span>(zz);<br/><br/>  <span class="orange1">delay</span>(zz);<br/>  allAqua();<br/>  <span class="orange1">delay</span>(1000);<br/>  <span class="ash">// Light some individual LEDs using random values</span><br/>  <span epub:type="pagebreak" id="page_219"/>lostinspace(); <span class="ash">// Scroll some horizontal and vertical lines</span><br/>  <span class="green3">for</span> (<span class="green2">int</span> z = 0; z &lt; 5; z++) {<br/>    <span class="green3">for</span> (<span class="green2">int</span> q = 1; q &lt; 129; q *= 2) {<br/>      displayLEDs(255, 0, 0, q, 200);<br/>    }<br/>  }<br/>  clearMatrix();<br/>  <span class="orange1">delay</span>(1000);<br/><br/>  <span class="green3">for</span> (<span class="green2">int</span> z = 0; z &lt; 5; z++) {<br/>    <span class="green3">for</span> (<span class="green2">int</span> q = 1; q &lt; 129; q *= 2) {<br/>      displayLEDs(0, 255, 0, q, 200);<br/>      displayLEDs(q, 0, 0, 255, 200);<br/>    }<br/>  }<br/>  clearMatrix();<br/>  <span class="orange1">delay</span>(1000);<br/><br/>  <span class="green3">for</span> (<span class="green2">int</span> z = 0; z &lt; 5; z++) {<br/>    <span class="green3">for</span> (<span class="green2">int</span> q = 1; q &lt; 9; q++) {<br/>      displayLEDs(0, 0, 255, va2[q], 200);<br/>    }<br/>  }<br/>  clearMatrix();<br/>  <span class="orange1">delay</span>(1000);<br/>}</pre>&#13;


<h2 class="h2a" id="ch25"><span epub:type="pagebreak" id="page_220"/>PROJECT 25: BUILD YOUR OWN ARDUINO!</h2>&#13;
<p class="h2sub"><strong><span class="gray">THIS PROJECT WILL TEACH YOU HOW TO BUILD YOUR OWN ARDUINO USING MINIMAL INDIVIDUAL COMPONENTS.</span></strong></p>&#13;
<div class="image2"><img alt="image" src="../images/f0220-01.jpg"/></div>&#13;
<div class="image2"><span epub:type="pagebreak" id="page_221"/><img alt="image" src="../images/f0221-01.jpg"/></div>&#13;
<div class="box1">&#13;
<p class="boxtitle1a"><span class="gray"><strong>PARTS REQUIRED</strong></span></p>&#13;
<p class="bull">• ATMEL ATmega328p chip</p>&#13;
<p class="bull">• Breadboard</p>&#13;
<p class="bull">• Green LED</p>&#13;
<p class="bull">• Red LED</p>&#13;
<p class="bull">• 3 220-ohm resistors</p>&#13;
<p class="bull">• 16 MHz crystal oscillator (HC-495)</p>&#13;
<p class="bull">• L7805cv 5V regulator</p>&#13;
<p class="bull">• 2 100 μF electrolytic capacitors</p>&#13;
<p class="bull">• PP3 9V battery clip</p>&#13;
<p class="bull">• Momentary tactile four-pin pushbutton</p>&#13;
<p class="bull">• 2 22 pF disc capacitors</p>&#13;
<p class="bull">• Jumper wires</p>&#13;
<p class="bull">• 9V battery</p>&#13;
</div>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_222"/>This is a fun and inexpensive little board with the same functionality as an Arduino, so it can be used as part of a permanent project in place of the pricier Arduino board.</p>&#13;
<h3 class="h3" id="ch25lev1sec01"><span class="gray"><strong>HOW IT WORKS</strong></span></h3>&#13;
<p class="noindent">Our project board works exactly the same as an Arduino board. At its heart is the ATMEL ATmega328p chip (<a href="ch25.xhtml#ch25fig1">Figure 25-1</a>), to which we’ll connect additional components. The ATmega chip is the brain of the Arduino and carries out the instructions from an uploaded sketch.</p>&#13;
<p class="figcaption"><a id="ch25fig1"/><strong>FIGURE 25-1:</strong><br/>The ATMEL ATmega328p chip</p>&#13;
<div class="image"><img alt="image" src="../images/f25-01.jpg"/></div>&#13;
<p class="indent">The L7805cv 5V regulator regulates the voltage and limits the current of the 9V battery to 5V, the level at which the ATmega chip operates, thereby protecting the chip and additional components. The 16 MHz crystal oscillator (<a href="ch25.xhtml#ch25fig2">Figure 25-2</a>) allows the Arduino to calculate time, and the capacitors act as a filter to smooth voltage.</p>&#13;
<p class="figcaption"><a id="ch25fig2"/><strong>FIGURE 25-2:</strong><br/>The 16 MHz crystal oscillator</p>&#13;
<div class="image"><img alt="image" src="../images/f25-02.jpg"/></div>&#13;
<p class="indent"><a href="ch25.xhtml#ch25tab1">Table 25-1</a> details the pins of the ATmega328p chip and how they correspond to the Arduino pins. For example, pin 13 on the Arduino, which we used to test our Arduino in “<a href="ch00.xhtml#ch00lev1sec03">Testing Your Arduino: Blinking an LED</a>” on <a href="ch00.xhtml#page_9">page 9</a>, would be pin 19 on the actual chip. <span epub:type="pagebreak" id="page_223"/>The top of the chip can be identified by the small semicircle indentation (<a href="ch25.xhtml#ch25fig3">Figure 25-3</a>). Pin 1 is below this indentation, and the pins are numbered 1–28 counterclockwise from there.</p>&#13;
<p class="tablecap"><a id="ch25tab1"/><strong>TABLE 25-1:</strong><br/>The ATmega chip’s pins and their corresponding Arduino pins</p>&#13;
<table class="all">&#13;
<thead>&#13;
<tr>&#13;
<td class="tableth1a-gr" style="vertical-align: middle;"><p class="tablec"><strong>ATMEGA PIN</strong></p></td>&#13;
<td class="tableth1" style="vertical-align: middle;"><p class="tablec"><strong>ARDUINO FUNCTION</strong></p></td>&#13;
<td class="tableth1aa-gr" style="vertical-align: middle;"><p class="tablec"><strong>ATMEGA PIN</strong></p></td>&#13;
<td class="tableth2" style="vertical-align: middle;"><p class="tablec"><strong>ARDUINO FUNCTION</strong></p></td>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td class="table1a-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">1</span></p></td>&#13;
<td class="table1" style="vertical-align: middle;"><p class="tablec"><span class="gray">Reset</span></p></td>&#13;
<td class="table1ab-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">15</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="gray">Pin 9</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">2</span></p></td>&#13;
<td class="table1" style="vertical-align: middle;"><p class="tablec"><span class="gray">Pin 0</span></p></td>&#13;
<td class="table1ab-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">16</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="gray">Pin 10</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">3</span></p></td>&#13;
<td class="table1" style="vertical-align: middle;"><p class="tablec"><span class="gray">Pin 1</span></p></td>&#13;
<td class="table1ab-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">17</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="gray">Pin 11</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">4</span></p></td>&#13;
<td class="table1" style="vertical-align: middle;"><p class="tablec"><span class="gray">Pin 2</span></p></td>&#13;
<td class="table1ab-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">18</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="gray">Pin 12</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">5</span></p></td>&#13;
<td class="table1" style="vertical-align: middle;"><p class="tablec"><span class="gray">Pin 3</span></p></td>&#13;
<td class="table1ab-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">19</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="gray">Pin 13</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">6</span></p></td>&#13;
<td class="table1" style="vertical-align: middle;"><p class="tablec"><span class="gray">Pin 4</span></p></td>&#13;
<td class="table1ab-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">20</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="gray">BCC</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">7</span></p></td>&#13;
<td class="table1" style="vertical-align: middle;"><p class="tablec"><span class="gray">VCC</span></p></td>&#13;
<td class="table1ab-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">21</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="gray">AREF</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">8</span></p></td>&#13;
<td class="table1" style="vertical-align: middle;"><p class="tablec"><span class="gray">GND</span></p></td>&#13;
<td class="table1ab-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">22</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="gray">GND</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">9</span></p></td>&#13;
<td class="table1" style="vertical-align: middle;"><p class="tablec"><span class="gray">Crystal</span></p></td>&#13;
<td class="table1ab-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">23</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="gray">A0</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">10</span></p></td>&#13;
<td class="table1" style="vertical-align: middle;"><p class="tablec"><span class="gray">Crystal</span></p></td>&#13;
<td class="table1ab-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">24</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="gray">A1</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">11</span></p></td>&#13;
<td class="table1" style="vertical-align: middle;"><p class="tablec"><span class="gray">Pin 5</span></p></td>&#13;
<td class="table1ab-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">25</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="gray">A2</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">12</span></p></td>&#13;
<td class="table1" style="vertical-align: middle;"><p class="tablec"><span class="gray">Pin 6</span></p></td>&#13;
<td class="table1ab-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">26</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="gray">A3</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">13</span></p></td>&#13;
<td class="table1" style="vertical-align: middle;"><p class="tablec"><span class="gray">Pin 7</span></p></td>&#13;
<td class="table1ab-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">27</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="gray">A4</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table3a-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">14</span></p></td>&#13;
<td class="table3" style="vertical-align: middle;"><p class="tablec"><span class="gray">Pin 8</span></p></td>&#13;
<td class="table3ab-gr" style="vertical-align: middle;"><p class="tablec"><span class="gray">28</span></p></td>&#13;
<td class="table3l" style="vertical-align: middle;"><p class="tablec"><span class="gray">A5</span></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<p class="figcaption"><a id="ch25fig3"/><strong>FIGURE 25-3:</strong><br/>The top of the chip is marked with a semicircle indentation.</p>&#13;
<div class="image"><img alt="image" src="../images/f25-03.jpg"/></div>&#13;
<h3 class="h3" id="ch25lev1sec02"><span class="gray"><strong>PREPARING THE CHIP</strong></span></h3>&#13;
<p class="noindent">Make sure to buy an ATmega chip with the Arduino bootloader installed, as it will also come preloaded with the blinking LED sketch, which you’ll need for this project.</p>&#13;
<p class="indent">Our homemade Arduino does not have a USB connector for the chip to connect directly to your PC, so if you want to use this Arduino breadboard with a different sketch (or ir your chip didn’t come with <span epub:type="pagebreak" id="page_224"/>the bootloader installed), you’ll need to use an existing Arduino board as a host and upload the sketch to your ATmega chip as follows:</p>&#13;
<ol>&#13;
<li><p class="noindenta">Carefully pry the Arduino ATmega chip from your existing Arduino board (<a href="ch25.xhtml#ch25fig4">Figure 25-4</a>), and replace it with your ATmega chip.</p>&#13;
<p class="figcaption"><a id="ch25fig4"/><strong>FIGURE 25-4:</strong><br/>Removing the ATmega chip from the Arduino</p>&#13;
<div class="image"><img alt="image" src="../images/f25-04.jpg"/></div></li>&#13;
<li><p class="noindenta">Connect the Arduino to your PC using a USB cable.</p></li>&#13;
<li><p class="noindenta">Open the Arduino IDE on your PC.</p></li>&#13;
<li><p class="noindenta">Load the sketch onto the chip.</p></li>&#13;
<li><p class="noindenta">Once the sketch is uploaded, disconnect the Arduino from your PC, gently remove this chip from the board, and replace the original Arduino ATmega chip.</p></li>&#13;
</ol>&#13;
<p class="indent">The new ATmega chip should be loaded with the desired sketch. Generally you’d want to build your own Arduino as part of a permanent project, so the ability to easily load new sketches is not usually required; you’d just load one sketch at the beginning of the project and use that sketch from then on.</p>&#13;
<p class="indent">You are now ready to prepare your own board.</p>&#13;
<h3 class="h3" id="ch25lev1sec03"><span class="gray"><strong>BUILDING THE ARDUINO CIRCUIT</strong></span></h3>&#13;
<p class="noindent">I normally show the circuit diagram at the end of the chapter, but in this instance it’s helpful to look at it first to reference the layout and identify the components being used (<a href="ch25.xhtml#ch25fig5">Figure 25-5</a>).</p>&#13;
<p class="figcaption"><a id="ch25fig5"/><strong>FIGURE 25-5:</strong><br/>The complete circuit diagram</p>&#13;
<div class="image"><span epub:type="pagebreak" id="page_225"/><img alt="image" src="../images/f25-05.jpg"/></div>&#13;
<ol>&#13;
<li><p class="noindenta">Insert the ATmega chip into the breadboard with its legs straddling either side of the center break. You need a little space at either end for components, so place it roughly as shown in <a href="ch25.xhtml#ch25fig6">Figure 25-6</a>. Remember, pin 1 of the ATmega328p is directly below the small semicircle indentation on the chip. From here, pins are numbered 1–28 counterclockwise. Use this to position your chip correctly. The semicircle should be on the left side of your circuit.</p>&#13;
<p class="figcaption"><a id="ch25fig6"/><strong>FIGURE 25-6:</strong><br/>Placing the ATmega chip so it straddles the center break</p>&#13;
<div class="image"><img alt="image" src="../images/f25-06.jpg"/></div></li>&#13;
<li><p class="noindenta"><span epub:type="pagebreak" id="page_226"/>Connect pins 7, 20, and 21 of the ATmega to their closest positive power rail on the breadboard, and pins 8 and 23 to the negative power rails. Use jumper wires to connect the positive and GND power rails on either side of the board, as shown in <a href="ch25.xhtml#ch25fig7">Figure 25-7</a>.</p>&#13;
<p class="figcaption"><a id="ch25fig7"/><strong>FIGURE 25-7:</strong><br/>Connecting to the power rails</p>&#13;
<div class="image"><img alt="image" src="../images/f25-07.jpg"/></div></li>&#13;
<li><p class="noindenta">Connect one leg of the crystal oscillator to pin 9 on the ATmega chip, and connect the other leg to pin 10. Connect the legs of one of the 22 pF disc capacitors to pin 9 and GND, and the legs of the other disc capacitor to pin 10 and GND, as shown in <a href="ch25.xhtml#ch25fig8">Figure 25-8</a>.</p>&#13;
<p class="figcaption"><a id="ch25fig8"/><strong>FIGURE 25-8:</strong><br/>Inserting the crystal oscillator and 22pf disc capacitors</p>&#13;
<div class="image"><img alt="image" src="../images/f25-08.jpg"/></div></li>&#13;
<li><p class="noindenta">Insert the pushbutton into the breadboard to the left of the ATmega chip, with the legs straddling the center break in the breadboard. Using jumper wires, connect the lower-right pin of the pushbutton to pin 1 on the ATmega, and the lower-left pin to GND, as shown in <a href="ch25.xhtml#ch25fig9">Figure 25-9</a>. Connect a 220-ohm resistor to the lower-right pin, and connect the other side of this resistor to the GND rail. This pushbutton will act as our reset button.</p>&#13;
<p class="figcaption"><a id="ch25fig9"/><strong>FIGURE 25-9:</strong><br/>Inserting the reset button</p>&#13;
<div class="image"><span epub:type="pagebreak" id="page_227"/><img alt="image" src="../images/f25-09.jpg"/></div></li>&#13;
<li><p class="noindenta">Insert the L7805cv 5V regulator into the top-left corner of the breadboard with the printed number of the component facing you, as shown in <a href="ch25.xhtml#ch25fig10">Figure 25-10</a>—the pins are numbered 1–3 from left to right. Insert one 100 μF electrolytic capacitor into the top power rail of the breadboard, with one pin in the positive rail and the other pin in the negative rail. Connect the second 100 μF electrolytic capacitor to pins 1 and 2 of the 5V regulator. Then connect pin 2 of the regulator to the negative power rail and pin 3 to the positive power rail.</p>&#13;
<p class="figcaption"><a id="ch25fig10"/><strong>FIGURE 25-10:</strong><br/>Connecting the electrolytic capacitors and the L7805cv 5V regulator</p>&#13;
<div class="image"><img alt="image" src="../images/f25-10.jpg"/></div></li>&#13;
<li><p class="noindenta">Insert the red LED into the breadboard, connecting the long, positive leg to the positive rail via a 220-ohm resistor, and the short, negative leg to GND. Then insert the green LED, connecting the short leg to pin 21 on the ATmega, and the long leg to the positive power rail via a 220-ohm resistor, as shown in <a href="ch25.xhtml#ch25fig11">Figure 25-11</a>. Add positive power from the battery to pin 1 on the 5V regulator and GND to pin 2 on the regulator.</p>&#13;
<p class="figcaption"><a id="ch25fig11"/><strong>FIGURE 25-11:</strong><br/>Inserting the LEDs and connecting the battery</p>&#13;
<div class="image"><span epub:type="pagebreak" id="page_228"/><img alt="image" src="../images/f25-11.jpg"/></div></li>&#13;
</ol>&#13;
<p class="indent">Your board is now complete and should look like <a href="ch25.xhtml#ch25fig12">Figure 25-12</a>. The red LED lights when power is added to the breadboard rails to indicate that the Arduino is on and working, and the green LED lights in response to the “Blinking an LED” sketch loaded on the ATmega chip.</p>&#13;
<p class="figcaption"><a id="ch25fig12"/><strong>FIGURE 25-12:</strong><br/>The completed circuit</p>&#13;
<div class="image"><img alt="image" src="../images/f25-12.jpg"/></div>&#13;
<p class="indent">Using the reference in <a href="ch25.xhtml#ch25tab1">Table 25-1</a>, you can use this board just like an Arduino Uno by connecting components to the ATmega chip pins instead of the Arduino pins. If you want to make any of the projects from this book permanent, consider building your own Arduino to power it! Remember to load the sketch to the ATmega chip through the real Arduino board first.</p>&#13;
</body></html>