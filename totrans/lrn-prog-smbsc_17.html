<html><head></head><body>
<h2 class="h2" id="ch17"><span epub:type="pagebreak" id="page_241"/><span class="big"><span class="blue"><strong>17</strong></span></span><br/><strong>EXPANDING TO HIGHER-DIMENSION ARRAYS</strong></h2>&#13;
<div class="imagec"><img alt="image" src="graphics/common01.jpg"/></div>&#13;
<p class="noindent">In the previous two chapters, you learned how to use one-dimensional arrays to store collections of items. In this chapter, we’ll expand this concept to two dimensions and higher. Working in more than one dimension is also called working in <em>higher</em> dimensions.</p>&#13;
<p class="indent">In a <em>two-dimensional (2D)</em> array, you can store values in a table or a grid. For example, think about the scoreboard at a baseball game (see <a href="ch17.html#ch17fig1">Figure 17-1</a>). The left column lists the team names, and the right columns list the innings and other statistics.</p>&#13;
<div class="image"><img alt="image" src="graphics/f17-01.jpg"/></div>&#13;
<p class="figcap"><a id="ch17fig1"/><em>Figure 17-1: Baseball scoreboard</em></p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_242"/>The arrays you’ll make in this chapter are similar to a scoreboard. They let you organize your data in rows and columns.</p>&#13;
<p class="indent">When you complete this chapter, you’ll understand 2D and other higher-dimensional arrays and you’ll be able to use them to build new types of applications, including a treasure-hunting game!</p>&#13;
<h3 class="h3" id="ch17lev1sec01"><span class="blue"><strong>Two-Dimensional Arrays</strong></span></h3>&#13;
<p class="noindent">A 2D array has two dimensions: rows and columns. You can think of a 2D array as a table. For example, <a href="ch17.html#ch17fig2">Figure 17-2</a> shows a 2D array named <code>score</code> that stores a student’s test scores in three subjects.</p>&#13;
<div class="image"><img alt="image" src="graphics/f17-02.jpg"/></div>&#13;
<p class="figcap"><a id="ch17fig2"/><em>Figure 17-2: A pictorial view of a 2D array</em></p>&#13;
<p class="indent">The first row contains math test scores, the second row records the science test scores, and the next row stores English scores. This 2D arrangement of elements is also referred to as a <em>matrix</em> (the plural is <em>matrices</em>). But this matrix won’t teach you slow-motion kung fu!</p>&#13;
<p class="indent">To access the individual elements of a matrix, you need two indices: one for the rows and the other for the columns. Here are some examples:</p>&#13;
<p class="programs">score[<span class="red">1</span>][<span class="red">1</span>] <span class="brown">=</span> <span class="red">95</span> <span class="green"><span class="codeitalic">' Row 1, column 1</span></span><br/>score[<span class="red">1</span>][<span class="red">2</span>] <span class="brown">=</span> <span class="red">87</span> <span class="green"><span class="codeitalic">' Row 1, column 2</span></span><br/>score[<span class="red">2</span>][<span class="red">1</span>] <span class="brown">=</span> <span class="red">80</span> <span class="green"><span class="codeitalic">' Row 2, column 1</span></span><br/>score[<span class="red">2</span>][<span class="red">3</span>] <span class="brown">=</span> <span class="red">92</span> <span class="green"><span class="codeitalic">' Row 2, column 3</span></span></p>&#13;
<p class="indent">The variable <code>score</code> is a <em>double-scripted variable</em> because it requires two indices to access its elements. The first index is the row number, and the second index is the column number.</p>&#13;
<p class="indent">As with one-dimensional arrays, the index of each dimension can be a number or a string. Also, the values stored in the matrix can be numbers, strings, or other identifiers returned by objects in the Small Basic library. Let’s look at some simple examples of 2D arrays next.</p>&#13;
<h4 class="h4" id="ch17lev2sec01"><em><strong>A Random Matrix</strong></em></h4>&#13;
<p class="noindent">A client named MI6 wants your help to generate passwords for security locks. The program shown in <a href="ch17.html#ch17ex1">Listing 17-1</a> creates a matrix named <code>mat</code> consisting of random numbers. The matrix contains three rows and four columns, which is a 3×4 (read <em>3 by 4</em>) matrix, or a 3×4 array.</p>&#13;
<p class="programs"><span epub:type="pagebreak" id="page_243"/> 1 <span class="green"><span class="codeitalic">' Random2DArray.sb</span></span><br/> 2 <span class="purple"><span class="codestrong">For</span></span> r <span class="brown">=</span> <span class="red">1</span> <span class="purple"><span class="codestrong">To</span></span> <span class="red">3</span>    <span class="green"><span class="codeitalic">' 3 rows</span></span><br/> 3   <span class="purple"><span class="codestrong">For</span></span> c <span class="brown">=</span> <span class="red">1</span> <span class="purple"><span class="codestrong">To</span></span> <span class="red">4</span>  <span class="green"><span class="codeitalic">' 4 columns</span></span><br/> 4     mat[r][c] <span class="brown">=</span> <span class="blue1">Math</span><span class="brown">.GetRandomNumber(</span><span class="red">9</span><span class="brown">)</span><br/> 5   <span class="purple"><span class="codestrong">EndFor</span></span><br/> 6 <span class="purple"><span class="codestrong">EndFor</span></span><br/> 7<br/> 8 <span class="green"><span class="codeitalic">' Displays the matrix to see its contents</span></span><br/> 9 <span class="purple"><span class="codestrong">For</span></span> r <span class="brown">=</span> <span class="red">1</span> <span class="purple"><span class="codestrong">To</span></span> <span class="red">3</span>    <span class="green"><span class="codeitalic">' 3 rows</span></span><br/>10   <span class="purple"><span class="codestrong">For</span></span> c <span class="brown">=</span> <span class="red">1</span> <span class="purple"><span class="codestrong">To</span></span> <span class="red">4</span>  <span class="green"><span class="codeitalic">' 4 columns</span></span><br/>11     <span class="blue1">TextWindow</span><span class="brown">.Write(</span>mat[r][c] <span class="brown">+</span> <span class="red">" "</span><span class="brown">)</span><br/>12   <span class="purple"><span class="codestrong">EndFor</span></span><br/>13   <span class="blue1">TextWindow</span><span class="brown">.WriteLine(</span><span class="red">""</span><span class="brown">)</span><br/>14 <span class="purple"><span class="codestrong">EndFor</span></span></p>&#13;
<p class="listcap"><a id="ch17ex1"/><em>Listing 17-1: Filling a 3×4 array with random numbers</em></p>&#13;
<p class="indent">The program uses a nested <code>For</code> loop to fill the matrix with random numbers (lines 2–6). Nested <code>For</code> loops are extremely helpful when you’re working with 2D arrays, because you can use one to loop through rows and the other to loop through columns. In this example, the outer loop uses a control variable <code>r</code> (for <em>rows</em>) and runs from 1 to 3 (line 2); the inner loop uses a control variable <code>c</code> (for <em>columns</em>) and runs from 1 to 4 (line 3).</p>&#13;
<p class="indent">The first pass of the outer loop (<code>r = 1</code>) causes four passes inside the inner loop (<code>c = 1</code>, <code>2</code>, <code>3</code>, and <code>4</code>), which fills <code>mat[1][1]</code>, <code>mat[1][2]</code>, <code>mat[1][3]</code>, and <code>mat[1][4]</code>. The second pass of the outer loop (<code>r = 2</code>) causes another four iterations of the inner loop (<code>c = 1</code>, <code>2</code>, <code>3</code>, and <code>4</code>) and fills <code>mat[2][1]</code>, <code>mat[2][2]</code>, <code>mat[2][3]</code>, and <code>mat[2][4]</code>. Likewise, the third pass of the outer loop (<code>r = 3</code>) fills the third row of the matrix. <a href="ch17.html#ch17fig3">Figure 17-3</a> illustrates this process.</p>&#13;
<div class="image"><img alt="image" src="graphics/f17-03.jpg"/></div>&#13;
<p class="figcap"><a id="ch17fig3"/><em>Figure 17-3: Using a nested</em> <code><span class="codeitalic">For</code></span> <em>loop to access the elements of a matrix</em></p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_244"/>Following along with this figure, when <code>r = 1</code>, the program takes the top <code>c</code> branch and fills in all four sets of the 2D array elements. When <code>r = 2</code>, it iterates through the middle branch four times. When <code>r = 3</code>, it iterates through the bottom branch.</p>&#13;
<p class="indent">After filling the matrix with random numbers, the program uses another nested loop to display its contents (lines 9–14) using a similar process. The outer loop runs from 1 to 3 to index the three rows (line 9), and the inner loop runs from 1 to 4 to index the four columns (line 10). Line 11 displays the element at index <code>mat[r][c]</code> (column <code>c</code> in row <code>r</code>), followed by a space. When the inner loop ends, it means an entire row has been displayed, and the cursor moves to the next line to prepare to display the next row (line 13).</p>&#13;
<p class="indent">It’s time to turn your program over to your MI6 client. Here’s a sample output of this program, but your output will most likely be different:</p>&#13;
<p class="programs">2 8 1 6<br/>3 9 3 9<br/>1 5 7 8</p>&#13;
<p class="indent">You can make matrices even more useful by programming them to accept user input. We’ll look at how to do that next.</p>&#13;
<div class="sidebar">&#13;
<p class="sidebart" id="ch17sb01"><strong>TRY IT OUT 17-1</strong></p>&#13;
<p class="noindent">In <a href="ch17.html#ch17ex1">Listing 17-1</a>, the numbers in the matrix are stored by rows. First, row 1 is filled, then row 2, and finally row 3. The reason is that we made the <code>r</code> loop (which represents rows) the outer loop and the <code>c</code> loop (which represents columns) the inner loop. Change the program so it fills the matrix by columns first instead of rows.</p>&#13;
</div>&#13;
<h4 class="h4" id="ch17lev2sec02"><em><strong>A Matrix with User Input</strong></em></h4>&#13;
<p class="noindent">Your MI6 client loves the program you built, but now they want to be able to enter certain numbers into the password matrix. You can easily change <a href="ch17.html#ch17ex1">Listing 17-1</a> to take input from the user instead of using random numbers. Just replace line 4 with the following two lines:</p>&#13;
<p class="programs"><span class="blue1">TextWindow</span><span class="brown">.Write(</span><span class="red">"mat["</span> <span class="brown">+</span> r <span class="brown">+</span> <span class="red">"]["</span> <span class="brown">+</span> c <span class="brown">+</span> <span class="red">"]: "</span><span class="brown">)</span><br/>mat[r][c] <span class="brown">=</span> <span class="blue1">TextWindow</span><span class="brown">.ReadNumber()</span></p>&#13;
<p class="indent">The first statement prompts the user to enter an element in the matrix, and the second line reads and stores the user’s entry. Make this change, and try it out to see how it works.</p>&#13;
<p class="indent">But matrices aren’t only about numbers. You can use them to make some fun, colorful applications too. In the next example, you’ll create a colorful grid and animate it.</p>&#13;
<h4 class="h4" id="ch17lev2sec03"><span epub:type="pagebreak" id="page_245"/><em><strong>Animated Squares</strong></em></h4>&#13;
<p class="noindent">Let’s write a program that creates a 4×8 grid of randomly colored squares and then animates these squares to fly to the upper-left corner of the graphics window, as shown in <a href="ch17.html#ch17fig4">Figure 17-4</a>.</p>&#13;
<div class="image"><img alt="image" src="graphics/f17-04.jpg"/></div>&#13;
<p class="figcap"><a id="ch17fig4"/><em>Figure 17-4: Illustrating the output of</em> AnimatedSquares.sb</p>&#13;
<p class="indent">The complete application is shown in <a href="ch17.html#ch17ex2">Listing 17-2</a>.</p>&#13;
<p class="programs"> 1 <span class="green"><span class="codeitalic">' AnimatedSquares.sb</span></span><br/> 2 <span class="green"><span class="codeitalic">' Creates a 4x8 grid of randomly colored squares</span></span><br/> 3 <span class="purple"><span class="codestrong">For</span></span> r <span class="brown">=</span> <span class="red">1</span> <span class="purple"><span class="codestrong">To</span></span> <span class="red">4</span>    <span class="green"><span class="codeitalic">' 4 rows</span></span><br/> 4   <span class="purple"><span class="codestrong">For</span></span> c <span class="brown">=</span> <span class="red">1</span> <span class="purple"><span class="codestrong">To</span></span> <span class="red">8</span>  <span class="green"><span class="codeitalic">' 8 columns</span></span><br/> 5     clr <span class="brown">=</span> <span class="blue1">GraphicsWindow</span><span class="brown">.GetRandomColor()</span><br/> 6     <span class="blue1">GraphicsWindow</span><span class="brown">.BrushColor =</span> clr<br/> 7     box[r][c] <span class="brown">=</span> <span class="blue1">Shapes</span><span class="brown">.AddRectangle(</span><span class="red">20</span><span class="brown">,</span> <span class="red">20</span><span class="brown">)</span> <span class="green"><span class="codeitalic">' Adds a square</span></span><br/> 8     <span class="blue1">Shapes</span><span class="brown">.Move(</span>box[r][c]<span class="brown">,</span> c <span class="brown">*</span> <span class="red">20</span><span class="brown">,</span> r <span class="brown">*</span> <span class="red">20</span><span class="brown">)</span>  <span class="green"><span class="codeitalic">' Positions it</span></span><br/> 9   <span class="purple"><span class="codestrong">EndFor</span></span><br/>10 <span class="purple"><span class="codestrong">EndFor</span></span><br/>11<br/>12 <span class="green"><span class="codeitalic">' Animates the squares to the upper-left corner of the window</span></span><br/>13 <span class="purple"><span class="codestrong">For</span></span> r <span class="brown">=</span> <span class="red">1</span> <span class="purple"><span class="codestrong">To</span></span> <span class="red">4</span><br/>14   <span class="purple"><span class="codestrong">For</span></span> c <span class="brown">=</span> <span class="red">1</span> <span class="purple"><span class="codestrong">To</span></span> <span class="red">8</span><br/>15     <span class="blue1">Shapes</span><span class="brown">.Animate(</span>box[r][c]<span class="brown">,</span> <span class="red">0</span><span class="brown">,</span> <span class="red">0</span><span class="brown">,</span> <span class="red">1000</span><span class="brown">)</span><br/>16     <span class="blue1">Program</span><span class="brown">.Delay(</span><span class="red">400</span><span class="brown">)</span> <span class="green"><span class="codeitalic">' A small delay (in milliseconds)</span></span><br/>17   <span class="purple"><span class="codestrong">EndFor</span></span><br/>18 <span class="purple"><span class="codestrong">EndFor</span></span></p>&#13;
<p class="listcap"><a id="ch17ex2"/><em>Listing 17-2: Using a matrix to store shape IDs</em></p>&#13;
<p class="indent">The program uses a nested <code>For</code> loop to create the squares (lines 3–10). The outer loop (which creates the rows) runs four times, and the inner loop (which creates the columns) runs eight times (lines 3–4), for a total of 32 iterations (4×8). In each pass of the inner loop, the square’s color is set by changing the <code>BrushColor</code> property (lines 5–6), and a square is created by calling <code>AddRectangle()</code>. We save its identifier in <code>box[r][c]</code> (line 7) and then move the created square to its position on the square grid (see <a href="ch17.html#ch17fig4">Figure 17-4</a>). Let’s take a closer look at lines 7–8.</p>&#13;
<p class="indent">At line 7, the <code>AddRectangle()</code> method takes the width and the height of the desired rectangle and returns an identifier of the created shape. In this example, we pass 20 for both arguments to create a square, and we save the returned identifier in <code>box[r][c]</code>.</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_246"/>To move the square, we call the <code>Move()</code> method of the <code>Shapes</code> object (line 8). This method takes three arguments: the identifier of the shape we want to move and the x- and y-coordinates of the position we’re moving it to. The squares in each row have their x positions (left edge) at 1 × 20 = 20, 2 × 20 = 40, 3 × 20 = 60, and so on. The squares in each column have their y positions (top edge) at 1 × 20 = 20, 2 × 20 = 40, 3 × 20 = 60, and so on. This is why we use <code>c * 20</code> and <code>r * 20</code> in the call to <code>Move()</code>.</p>&#13;
<p class="indent">At the end of this <code>For</code> loop, the <code>box</code> matrix contains 32 unique identifiers for the 32 squares created by the <code>Shapes</code> object.</p>&#13;
<p class="indent">The program then animates the squares (lines 13–18), using a nested <code>For</code> loop to access the rows and the columns of <code>box</code>. During each iteration, we ask the <code>Shapes</code> object to animate one square (line 15) and then pause for a short time (line 16). The <code>Animate()</code> method takes four arguments: the identifier of the shape we want to animate, the x- and y-coordinates of the destination, and the animation duration in milliseconds. We ask the <code>Shapes</code> object to move each square to point (0, 0) in 1 second (1000 milliseconds).</p>&#13;
<div class="sidebar">&#13;
<p class="sidebart" id="ch17sb02"><strong>TRY IT OUT 17-2</strong></p>&#13;
<p class="noindent">Change the program in <a href="ch17.html#ch17ex2">Listing 17-2</a> to animate the squares by columns instead of by rows. If you’re feeling artistic, try moving the squares to create a pattern in the graphics window.</p>&#13;
</div>&#13;
<h4 class="h4" id="ch17lev2sec04"><em><strong>Using String Indices</strong></em></h4>&#13;
<p class="noindent">The previous examples used integer indices to access the elements of a matrix. Our next example teaches you how use strings for indices. You’ll examine an application that keeps track of students’ scores in different subjects.</p>&#13;
<p class="indent">Welcome to Professor Xavier’s School for Gifted Youngsters! The class has only three students right now: Scott, Jean, and Logan (the others are on an important mission). The school teaches only three subjects: math, science, and combat. Let’s write a program that prompts the user to enter a student’s name and then displays the student’s average score. The complete program is shown in <a href="ch17.html#ch17ex3">Listing 17-3</a>.</p>&#13;
<p class="programs"> 1 <span class="green"><span class="codeitalic">' StudentAvg.sb</span></span><br/> 2 score[<span class="red">"Scott"</span>][<span class="red">"Math"</span>] <span class="brown">=</span> <span class="red">92</span><br/> 3 score[<span class="red">"Scott"</span>][<span class="red">"Science"</span>] <span class="brown">=</span> <span class="red">90</span><br/> 4 score[<span class="red">"Scott"</span>][<span class="red">"Combat"</span>] <span class="brown">=</span> <span class="red">87</span><br/> 5 score[<span class="red">"Jean"</span>][<span class="red">"Math"</span>] <span class="brown">=</span> <span class="red">85</span><br/> 6 score[<span class="red">"Jean"</span>][<span class="red">"Science"</span>] <span class="brown">=</span> <span class="red">82</span><br/> 7 score[<span class="red">"Jean"</span>][<span class="red">"Combat"</span>] <span class="brown">=</span> <span class="red">92</span><br/> 8 score[<span class="red">"Logan"</span>][<span class="red">"Math"</span>] <span class="brown">=</span> <span class="red">85</span><br/> 9 score[<span class="red">"Logan"</span>][<span class="red">"Science"</span>] <span class="brown">=</span> <span class="red">95</span><br/>10 score[<span class="red">"Logan"</span>][<span class="red">"Combat"</span>] <span class="brown">=</span> <span class="red">99</span><br/>11<br/>12 <span class="blue1">TextWindow</span><span class="brown">.Write(</span><span class="red">"Enter student name: "</span><span class="brown">)</span><br/>13 name <span class="brown">=</span> <span class="blue1">TextWindow</span><span class="brown">.Read()</span><br/>14 sum <span class="brown">=</span> score[name][<span class="red">"Math"</span>]<br/>15 sum <span class="brown">=</span> sum <span class="brown">+</span> score[name][<span class="red">"Science"</span>]<br/>16 sum <span class="brown">=</span> sum <span class="brown">+</span> score[name][<span class="red">"Combat"</span>]<br/>17 avg <span class="brown">=</span> <span class="blue1">Math</span><span class="brown">.Round(</span>sum <span class="brown">/</span> <span class="red">3</span><span class="brown">)</span><br/>18 <span class="blue1">TextWindow</span><span class="brown">.WriteLine(</span>name <span class="brown">+</span> <span class="red">" average score = "</span> <span class="brown">+</span> avg<span class="brown">)</span></p>&#13;
<p class="listcap"><a id="ch17ex3"/><em>Listing 17-3: Using strings for indices</em></p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_247"/>The program starts by initializing the <code>score</code> matrix with the scores of the three students (lines 2–10). Rows are indexed by the students’ names, and columns are indexed by the subjects. <a href="ch17.html#ch17fig5">Figure 17-5</a> shows a visual representation of the <code>score</code> matrix.</p>&#13;
<div class="image"><img alt="image" src="graphics/f17-05.jpg"/></div>&#13;
<p class="figcap"><a id="ch17fig5"/><em>Figure 17-5: The score matrix in <a href="ch17.html#ch17ex3">Listing 17-3</a></em></p>&#13;
<p class="indent">The program prompts the user to enter a student’s name (line 12) and assigns the input to the <code>name</code> variable (line 13). It then pulls that student’s math score into the <code>sum</code> variable (line 14), adds the student’s science score to <code>sum</code> (line 15), and adds the student’s combat score (line 16). Finally, the program computes the average score (line 17) and displays it (line 18).</p>&#13;
<p class="indent">Here’s the output from a sample run:</p>&#13;
<p class="programs">Enter student name: <span class="codestrong">scott</span><br/>scott average score = 90</p>&#13;
<p class="indent">The string index is case insensitive, which is why the program worked when we entered <em>scott</em> with a lowercase <em>s</em>. What do you think the output will be if you enter an invalid student name? Run the program to check your answer.</p>&#13;
<div class="sidebar">&#13;
<p class="sidebart" id="ch17sb03"><strong>TRY IT OUT 17-3</strong></p>&#13;
<p class="noindent">Update the program in <a href="ch17.html#ch17ex3">Listing 17-3</a> to display the score of a student in a given subject. Have the user enter the name of the student and the subject.</p>&#13;
</div>&#13;
<h4 class="h4" id="ch17lev2sec05"><span epub:type="pagebreak" id="page_248"/><em><strong>Going Interactive</strong></em></h4>&#13;
<p class="noindent">Let’s explore how to get the students’ scores from the user rather than hardcoding them within the program like we did in <a href="ch17.html#ch17ex3">Listing 17-3</a>. We’ll use two loops to iterate over the students’ names and subjects, as shown in the following pseudocode (you’ll learn how to translate this pseudocode into real code in a moment):</p>&#13;
<p class="programs">For each <span class="codestrong">student</span> in the array: [Scott, Jean, Logan]<br/>  For each <span class="codestrong">subject</span> in the array: [Math, Science, Combat]<br/>    score[<span class="codestrong">student</span>][<span class="codestrong">subject</span>] = read score from user<br/>  EndFor<br/>EndFor</p>&#13;
<p class="indent">You can save the names of the students in a one-dimensional array, save the names of the subjects in another one-dimensional array, and then use nested <code>For</code> loops with integer indices to access the individual elements of these two arrays. Then you can use the strings (student name and subject) as indices for a <code>score</code> matrix. Check out <a href="ch17.html#ch17ex4">Listing 17-4</a> to see the code in action.</p>&#13;
<p class="programs"> 1 <span class="green"><span class="codeitalic">' StudentAvg2.sb</span></span><br/> 2 nameList <span class="brown">=</span> <span class="red">"1=Scott;2=Jean;3=Logan;"</span><br/> 3 subjList <span class="brown">=</span> <span class="red">"1=Math;2=Science;3=Combat;"</span><br/> 4<br/> 5 <span class="purple"><span class="codestrong">For</span></span> I <span class="brown">=</span> <span class="red">1</span> <span class="purple"><span class="codestrong">To</span></span> <span class="red">3</span>           <span class="green"><span class="codeitalic">' Three students</span></span><br/> 6   name <span class="brown">=</span> nameList[I]     <span class="green"><span class="codeitalic">' Name of the Ith student</span></span><br/> 7   <span class="purple"><span class="codestrong">For</span></span> J <span class="brown">=</span> <span class="red">1</span> <span class="purple"><span class="codestrong">To</span></span> <span class="red">3</span>         <span class="green"><span class="codeitalic">' Three subjects</span></span><br/> 8     subj <span class="brown">=</span> subjList[J]   <span class="green"><span class="codeitalic">' Name of Jth subject</span></span><br/> 9     <span class="blue1">TextWindow</span><span class="brown">.Write(</span>name <span class="brown">+</span> <span class="red">"'s "</span> <span class="brown">+</span> subj <span class="brown">+</span> <span class="red">" score: "</span><span class="brown">)</span><br/>10     score[name][subj] <span class="brown">=</span> <span class="blue1">TextWindow</span><span class="brown">.ReadNumber()</span><br/>11   <span class="purple"><span class="codestrong">EndFor</span></span><br/>12 <span class="purple"><span class="codestrong">EndFor</span></span><br/>13 <span class="blue1">TextWindow</span><span class="brown">.Write(</span><span class="red">"Enter student name: "</span><span class="brown">)</span><br/>14 name <span class="brown">=</span> <span class="blue1">TextWindow</span><span class="brown">.Read()</span><br/>15 sum <span class="brown">=</span> score[name][<span class="red">"Math"</span>]<br/>16 sum <span class="brown">=</span> sum <span class="brown">+</span> score[name][<span class="red">"Science"</span>]<br/>17 sum <span class="brown">=</span> sum <span class="brown">+</span> score[name][<span class="red">"Combat"</span>]<br/>18 avg <span class="brown">=</span> <span class="blue1">Math</span><span class="brown">.Round(</span>sum <span class="brown">/</span> <span class="red">3</span><span class="brown">)</span><br/>19 <span class="blue1">TextWindow</span><span class="brown">.WriteLine(</span>name <span class="brown">+</span> <span class="red">" average score = "</span> <span class="brown">+</span> avg<span class="brown">)</span></p>&#13;
<p class="listcap"><a id="ch17ex4"/><em>Listing 17-4: Reading scores from the user</em></p>&#13;
<p class="indent">The program starts by creating the name and subject arrays (lines 2–3). Then a nested loop starts to fill the <code>score</code> matrix. The outer loop iterates over the students, and the inner loop iterates over the subjects.</p>&#13;
<p class="indent">The outer loop starts with <code>I = 1</code>. Here <code>name</code> gets assigned to <code>nameList[1]</code>, which is <code>"Scott"</code> (line 6). Then the inner loop runs three times, the first time with <code>J = 1</code>, and <code>subject</code> gets assigned to <code>subjList[1]</code>, which is <code>"Math"</code> <span epub:type="pagebreak" id="page_249"/>(line 8). Line 9 displays <code>Scott's Math score:</code>, and line 10 waits for the user’s input. The number entered by the user is saved in <code>score["Scott"]["Math"]</code>, and the inner loop repeats for <code>J = 2</code>. Now <code>subject</code> gets assigned to <code>subjList[2]</code>, which is <code>"Science"</code>. The program displays <code>Scott's Science score:</code>, waits for the user’s input, stores the entered number in <code>score["Scott"]["Science"]</code>, and repeats the inner loop with <code>J = 3</code>. Now <code>subject</code> gets assigned to <code>subjList[3]</code>, which is <code>"Combat"</code>. The program displays <code>Scott's Combat score:</code>, waits for the user’s input, and stores the entered number in <code>score["Scott"]["Combat"]</code>. This ends the inner loop.</p>&#13;
<p class="indent">The outer loop repeats with <code>I = 2</code>. This sets <code>name</code> to <code>nameList[2]</code>, which is <code>"Jean"</code> and the inner loop works again to fill <code>score["Jean"]["Math"]</code>, <code>score["Jean"]["Science"]</code>, and <code>score["Jean"]["Combat"]</code>.</p>&#13;
<p class="indent">The outer loop repeats with <code>I = 3</code>. This sets <code>name</code> to <code>nameList[3]</code>, which is <code>"Logan"</code>, and the inner loop works again to fill <code>score["Logan"]["Math"]</code>, <code>score["Logan"]["Science"]</code>, and <code>score["Logan"]["Combat"]</code>.</p>&#13;
<p class="indent">Trace through this second version of the program to understand how it works. Thinking through what happens at each step is a great way to learn how matrices work!</p>&#13;
<div class="sidebar">&#13;
<p class="sidebart" id="ch17sb04"><strong>TRY IT OUT 17-4</strong></p>&#13;
<p class="noindent">Replace the statements that find the <code>sum</code> (lines 15–17) in <a href="ch17.html#ch17ex4">Listing 17-4</a> with a <code>For</code> loop, as shown in the following code snippet:</p>&#13;
<p class="programs">sum <span class="brown">=</span> <span class="red">0</span><br/><span class="purple"><span class="codestrong">For</span></span> J <span class="brown">=</span> <span class="red">1</span> <span class="purple"><span class="codestrong">To</span></span> <span class="red">3</span><br/>  <span class="green"><span class="codeitalic">' Add each student's score in the Jth subject to sum</span></span><br/><span class="purple"><span class="codestrong">EndFor</span></span></p>&#13;
</div>&#13;
<h3 class="h3" id="ch17lev1sec02"><span class="blue"><strong>Common Operations on Numerical 2D Arrays</strong></span></h3>&#13;
<p class="noindent">In this section, we’ll develop a useful set of subroutines that can perform common operations on a 2D array made up of numbers. We’ll use the sales of a fake company, Duckberg Industries, whose December sales report is shown in <a href="ch17.html#ch17fig6">Figure 17-6</a>. The company has four stores (Beddy Buyz, UBroke I.T. Emporium, LAN Lord’s Cyber Store, and Mother Bored Electronics) and sells five types of products: Exploding Shoes (eShoes), the iShirt Computer (iShirt), Shampoop, Dehydrated Water (dWater), and the Invisible Hat (iHat). The numbers are the sales of each product in thousands.</p>&#13;
<div class="image"><span epub:type="pagebreak" id="page_250"/><img alt="image" src="graphics/f17-06.jpg"/></div>&#13;
<p class="figcap"><a id="ch17fig6"/><em>Figure 17-6: Duckberg Industries’ December sales report</em></p>&#13;
<p class="indent">Open the file <em>Duckberg_Incomplete.sb</em> from this chapter’s folder. The file contains the data in <a href="ch17.html#ch17fig6">Figure 17-6</a> in a sequence of statements that looks like this:</p>&#13;
<p class="programs">sales[<span class="red">1</span>][<span class="red">1</span>] <span class="brown">=</span> <span class="red">50</span>   <span class="green"><span class="codeitalic">' Beddy Buyz store; Exploding Shoes sales</span></span><br/>sales[<span class="red">1</span>][<span class="red">2</span>] <span class="brown">=</span> <span class="red">60</span>   <span class="green"><span class="codeitalic">' Beddy Buyz store; iShirt Computer sales</span></span><br/>--<span class="codeitalic">snip</span>--<br/>sales[<span class="red">4</span>][<span class="red">4</span>] <span class="brown">=</span> <span class="red">80</span>   <span class="green"><span class="codeitalic">' Mother Bored Electronics; Dehydrated Water sales</span></span><br/>sales[<span class="red">4</span>][<span class="red">5</span>] <span class="brown">=</span> <span class="red">90</span>   <span class="green"><span class="codeitalic">' Mother Bored Electronics; Invisible Hat sales</span></span></p>&#13;
<p class="indent">The program also defines the following variables:</p>&#13;
<p class="programs">ROWS <span class="brown">=</span> <span class="red">4</span>      <span class="green"><span class="codeitalic">' Number of rows</span></span><br/>COLS <span class="brown">=</span> <span class="red">5</span>      <span class="green"><span class="codeitalic">' Number of columns</span></span><br/>product <span class="brown">=</span> <span class="red">"1=eShoes;2=iShirt;3=Shampoop;4=dWater;5=iHat"</span></p>&#13;
<p class="indent">Follow the instructions in the next two sections to complete the program.</p>&#13;
<h4 class="h4" id="ch17lev2sec06"><em><strong>Step 1: Add All Elements</strong></em></h4>&#13;
<p class="noindent">Donald, the company’s sales manager, wants to know the total sales of the company. You need to add all the numbers in the <code>sales</code> matrix. The <code>TotalSales()</code> subroutine in <a href="ch17.html#ch17ex5">Listing 17-5</a> shows you how to do that.</p>&#13;
<p class="programs">1 <span class="purple"><span class="codestrong">Sub</span></span> TotalSales<br/>2   sum <span class="brown">=</span> <span class="red">0</span>                      <span class="green"><span class="codeitalic">' Initializes the running sum</span></span><br/>3   <span class="purple"><span class="codestrong">For</span></span> r <span class="brown">=</span> <span class="red">1</span> <span class="purple"><span class="codestrong">To</span></span> ROWS            <span class="green"><span class="codeitalic">' For all rows</span></span><br/>4     <span class="purple"><span class="codestrong">For</span></span> c <span class="brown">=</span> <span class="red">1</span> <span class="purple"><span class="codestrong">To</span></span> COLS          <span class="green"><span class="codeitalic">' For all columns</span></span><br/>5       sum <span class="brown">=</span> sum <span class="brown">+</span> sales[r][c]  <span class="green"><span class="codeitalic">' Adds number at row r, column c</span></span><br/>6     <span class="purple"><span class="codestrong">EndFor</span></span><br/>7   <span class="purple"><span class="codestrong">EndFor</span></span><br/>8   <span class="blue1">TextWindow</span><span class="brown">.WriteLine(</span><span class="red">"Total Sales: $"</span> <span class="brown">+</span> sum <span class="brown">+</span> <span class="red">" K"</span><span class="brown">)</span><br/>9 <span class="purple"><span class="codestrong">EndSub</span></span></p>&#13;
<p class="listcap"><a id="ch17ex5"/><em>Listing 17-5: Adding all numbers in a matrix</em></p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_251"/>You start by initializing the <code>sum</code> variable (which holds the running sum) to 0 (line 2). You then use a nested loop to iterate over all the rows and columns (lines 3–4). For each iteration, you add the number stored in <code>sales[r][c]</code> to <code>sum</code> (line 5). When the outer loop ends, you display the result followed by <code>K</code> for thousands (line 8).</p>&#13;
<p class="indent">Add this subroutine to the program, and then add a statement to call it. Here’s what you should see when you call the <code>TotalSales()</code> subroutine:</p>&#13;
<p class="programs">Total Sales: $1340 K</p>&#13;
<h4 class="h4" id="ch17lev2sec07"><em><strong>Step 2: Find the Sum of Each Column</strong></em></h4>&#13;
<p class="noindent">Donald also wants to see the total sales for each Duckberg Industries product. He needs to compare these numbers with those from his competitors to assess his company’s market share.</p>&#13;
<p class="indent">To give Donald this information, you’ll use the <code>ColumnSum()</code> subroutine in <a href="ch17.html#ch17ex6">Listing 17-6</a> to compute the sum of each column in the <code>sales</code> matrix.</p>&#13;
<p class="programs"> 1 <span class="purple"><span class="codestrong">Sub</span></span> ColumnSum<br/> 2   <span class="purple"><span class="codestrong">For</span></span> c <span class="brown">=</span> <span class="red">1</span> <span class="purple"><span class="codestrong">To</span></span> COLS           <span class="green"><span class="codeitalic">' For each column</span></span><br/> 3     sum <span class="brown">=</span> <span class="red">0</span>                   <span class="green"><span class="codeitalic">' Initializes the sum for column c</span></span><br/> 4     <span class="purple"><span class="codestrong">For</span></span> r <span class="brown">=</span> <span class="red">1</span> <span class="purple"><span class="codestrong">To</span></span> ROWS         <span class="green"><span class="codeitalic">' Iterates over the rows</span></span><br/> 5       sum <span class="brown">=</span> sum <span class="brown">+</span> sales[r][c] <span class="green"><span class="codeitalic">' Adds number at row r, column c</span></span><br/> 6     <span class="purple"><span class="codestrong">EndFor</span></span><br/> 7     colName <span class="brown">=</span> product[c] <span class="brown">+</span> <span class="red">" Sales: $"</span> <span class="green"><span class="codeitalic">' Name to display</span></span><br/> 8     <span class="blue1">TextWindow</span><span class="brown">.WriteLine(</span>colName <span class="brown">+</span> sum <span class="brown">+</span> <span class="red">" K"</span><span class="brown">)</span><br/> 9   <span class="purple"><span class="codestrong">EndFor</span></span><br/>10 <span class="purple"><span class="codestrong">EndSub</span></span></p>&#13;
<p class="listcap"><a id="ch17ex6"/><em>Listing 17-6: The</em> <code><span class="codeitalic">ColumnSum()</code></span> <em>subroutine</em></p>&#13;
<p class="indent">You start the outer loop to iterate over the five columns (line 2). For each column (each value of <code>c</code>), you initialize the column’s <code>sum</code> to 0 (line 3) and then start a <code>For</code> loop to add the numbers from all the rows in that column to <code>sum</code> (lines 4–6). When the inner loop completes, you get the name of the current product (from <code>product[c]</code>), append <code>"Sales: $"</code> to it, and save the resulting string in <code>colName</code> (line 7). In line 8, you display that string followed by the sum you just computed. The outer loop then restarts to find and display the sum for the next column.</p>&#13;
<p class="indent">Add this subroutine to the program, and then add a statement to call it. Here’s what you should see when you call the <code>ColumnSum()</code> subroutine:</p>&#13;
<p class="programs">eShoes Sales: $190 K<br/>iShirt Sales: $200 K<br/>Shampoop Sales: $310 K<br/>dWater Sales: $330 K<br/>iHat Sales: $310 K</p>&#13;
<div class="sidebar">&#13;
<p class="sidebart" id="ch17sb05"><span epub:type="pagebreak" id="page_252"/><strong>TRY IT OUT 17-5</strong></p>&#13;
<p class="noindent">Donald wants to review the performance of his four stores by comparing the total sales of each store. Write a subroutine, <code>RowSum()</code>, that calculates and displays the sum for each row of the <code>sales</code> matrix.</p>&#13;
</div>&#13;
<h3 class="h3" id="ch17lev1sec03"><span class="blue"><strong>Arrays of Three or More Dimensions</strong></span></h3>&#13;
<p class="noindent">You’ve learned that using 2D arrays is a convenient way to represent a table or a matrix. Small Basic also supports arrays with more than two dimensions. You can extend the syntax for creating 2D arrays to create arrays with even higher dimensions. Next we’ll explore how to create <em>three-dimensional (3D)</em> arrays in Small Basic.</p>&#13;
<p class="indent">Let’s work with a shelf that has five racks. Each rack has three rows and four columns, and each position on the shelf has a box that contains screws of a certain size. Look at <a href="ch17.html#ch17fig7">Figure 17-7</a> and imagine boxes of different screw sizes in each column and row (that’s 12 boxes). Then imagine that same number of boxes on all five racks. That’s 60 boxes in total!</p>&#13;
<div class="image"><img alt="image" src="graphics/f17-07.jpg"/></div>&#13;
<p class="figcap"><a id="ch17fig7"/><em>Figure 17-7: Visualizing a 3D array</em></p>&#13;
<p class="indent">We’ll examine a program that fills each box with a random number that indicates the size of the screws in that box. The program is shown in <a href="ch17.html#ch17ex7">Listing 17-7</a>.</p>&#13;
<p class="programs">1 <span class="green"><span class="codeitalic">' 3DArrayDemo.sb</span></span><br/>2 <span class="purple"><span class="codestrong">For</span></span> rack <span class="brown">=</span> <span class="red">1</span> <span class="purple"><span class="codestrong">To</span></span> <span class="red">5</span>     <span class="green"><span class="codeitalic">' For each rack</span></span><br/>3   <span class="purple"><span class="codestrong">For</span></span> row <span class="brown">=</span> <span class="red">1</span> <span class="purple"><span class="codestrong">To</span></span> <span class="red">3</span>    <span class="green"><span class="codeitalic">' For each row</span></span><br/>4     <span class="purple"><span class="codestrong">For</span></span> col <span class="brown">=</span> <span class="red">1</span> <span class="purple"><span class="codestrong">To</span></span> <span class="red">4</span>  <span class="green"><span class="codeitalic">' For each column</span></span><br/>5       box[rack][row][col] <span class="brown">=</span> <span class="blue1">Math</span><span class="brown">.GetRandomNumber(</span><span class="red">9</span><span class="brown">)</span><br/>6     <span class="purple"><span class="codestrong">EndFor</span></span><br/>7   <span class="purple"><span class="codestrong">EndFor</span></span><br/>8 <span class="purple"><span class="codestrong">EndFor</span></span></p>&#13;
<p class="listcap"><a id="ch17ex7"/><em>Listing 17-7: Demonstrating the syntax for 3D arrays</em></p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_253"/>This program creates a 3D array named <code>box</code>. Its elements are indexed with three subscripts: <code>rack</code> runs from 1 to 5 (line 2), <code>row</code> runs from 1 to 3 (line 3), and <code>col</code> runs from 1 to 4 (line 4). This array has 60 elements (5×4×3), just like the shelf in the example. Line 5 uses the syntax <code>box[rack] [row][col]</code> to access the box in rack number <code>rack</code>, row number <code>row</code>, and column number <code>col</code>, and it puts a random number in that box.</p>&#13;
<p class="indent">Notice that another nested <code>For</code> loop is used, but in this example, we nested three <code>For</code> loops instead of just two (lines 2–4). Generally, you’ll need to use one <code>For</code> loop per dimension in your higher-dimension array; as a result, you’ll be able to access every element in your array!</p>&#13;
<p class="indent">In the next section, you’ll use what you’ve learned so far to create an exciting treasure game. Get ready for another adventure!</p>&#13;
<div class="sidebar">&#13;
<p class="sidebart" id="ch17sb06"><strong>TRY IT OUT 17-6</strong></p>&#13;
<p class="noindent">Write a program that displays the output of the <code>box</code> array in <a href="ch17.html#ch17ex7">Listing 17-7</a>. Your output should have the following format:</p>&#13;
<p class="programs">Rack 1:<br/>2 7 3 2<br/>4 3 1 3<br/>1 2 6 4<br/><br/>Rack 2:<br/>8 8 2 1<br/>7 4 2 7<br/>1 5 2 7<br/>--<span class="codeitalic">snip</span>--</p>&#13;
</div>&#13;
<h3 class="h3" id="ch17lev1sec04"><span class="blue"><strong>Create a Treasure Map Game</strong></span></h3>&#13;
<p class="noindent">You woke up one morning and found you were alone on an island. A treasure map and an old compass were lying next to you. You could hardly hold back your excitement! You decided to look for the treasure. <a href="ch17.html#ch17fig8">Figure 17-8</a> shows a sample map of the island.</p>&#13;
<div class="image"><span epub:type="pagebreak" id="page_254"/><img alt="image" src="graphics/f17-08.jpg"/></div>&#13;
<p class="figcap"><a id="ch17fig8"/><em>Figure 17-8: The user interface for the Treasure Map game</em></p>&#13;
<p class="indent">You can move north, east, south, or west, one block at a time. But because the compass is old, it might lead you in the wrong direction. For example, if you go north or south, there’s a 20 percent chance that you’ll also move one block to the left or to the right. And if you go east or west, there’s a 20 percent chance that you’ll also move one block up or down. Each time you move, you’ll receive information about your current location. The game ends if you find the treasure or if you fall in the water where the hungry sharks are waiting! Don’t think of <em>Jaws</em> while you’re playing this game! (Sorry, that probably didn’t help.)</p>&#13;
<p class="indent">Because you have the treasure map in your hands, you should be able to guess your location. For example, let’s say you’re in a forest, and when you click the S button to go south, the game tells you you’re now next to a volcano. Looking at the map, you can figure out that the treasure is just two blocks west.</p>&#13;
<p class="indent">The following sections will guide you step-by-step to show you how to put this game together. Adventure awaits!</p>&#13;
<h4 class="h4" id="ch17lev2sec08"><em><strong>Step 1: Open the Startup File</strong></em></h4>&#13;
<p class="noindent">Open the <em>TreasureMap_Incomplete.sb</em> file from this chapter’s folder. This file contains some comments and placeholders for the required subroutines. You’ll add all the code one step at a time.</p>&#13;
<p class="indent">This folder also contains the eight images you’ll use. <em>Background.png</em> is a 580×450 image of the game’s background, and the seven 32×32 icons are the different objects on the treasure map.</p>&#13;
<div class="note">&#13;
<p class="notet"><span epub:type="pagebreak" id="page_255"/><span class="notes"><strong>NOTE</strong></span></p>&#13;
<p class="notep"><em>If you run into any problems, check out the finished program</em> TreasureMap.sb, <em>which is also included in this chapter’s folder.</em></p>&#13;
</div>&#13;
<h4 class="h4" id="ch17lev2sec09"><em><strong>Step 2: Create the GUI Elements</strong></em></h4>&#13;
<p class="noindent">Add the code in <a href="ch17.html#ch17ex8">Listing 17-8</a> to initialize the <code>GraphicsWindow</code> and create the controls (buttons and text shapes) for the game.</p>&#13;
<p class="programs"> 1 <span class="blue1">GraphicsWindow</span><span class="brown">.Title =</span> <span class="red">"Treasure Map"</span><br/> 2 <span class="blue1">GraphicsWindow</span><span class="brown">.Width =</span> <span class="red">580</span><br/> 3 <span class="blue1">GraphicsWindow</span><span class="brown">.Height =</span> <span class="red">450</span><br/> 4 <span class="blue1">GraphicsWindow</span><span class="brown">.CanResize =</span> <span class="red">"False"</span><br/> 5 <span class="blue1">GraphicsWindow</span><span class="brown">.FontSize =</span> <span class="red">14</span><br/> 6 <span class="blue1">GraphicsWindow</span><span class="brown">.FontName =</span> <span class="red">"Courier New"</span><br/> 7<br/> 8 <span class="green"><span class="codeitalic">' Creates a text shape for showing the player's location</span></span><br/> 9 <span class="blue1">GraphicsWindow</span><span class="brown">.BrushColor =</span> <span class="red">"Black"</span><br/>10 txtID <span class="brown">=</span> <span class="blue1">Shapes</span><span class="brown">.AddText(</span><span class="red">""</span><span class="brown">)</span><br/>11 <span class="blue1">Shapes</span><span class="brown">.Move(</span>txtID<span class="brown">,</span> <span class="red">60</span><span class="brown">,</span> <span class="red">415</span><span class="brown">)</span><br/>12<br/>13 <span class="green"><span class="codeitalic">' Creates the 4 movement buttons and the new game button</span></span><br/>14 <span class="blue1">GraphicsWindow</span><span class="brown">.BrushColor =</span> <span class="red">"Red"</span><br/>15 btnN <span class="brown">=</span> <span class="blue1">Controls</span><span class="brown">.AddButton(</span><span class="red">"N"</span><span class="brown">,</span> <span class="red">507</span><span class="brown">,</span> <span class="red">10</span><span class="brown">)</span><br/>16 btnS <span class="brown">=</span> <span class="blue1">Controls</span><span class="brown">.AddButton(</span><span class="red">"S"</span><span class="brown">,</span> <span class="red">507</span><span class="brown">,</span> <span class="red">90</span><span class="brown">)</span><br/>17 btnW <span class="brown">=</span> <span class="blue1">Controls</span><span class="brown">.AddButton(</span><span class="red">"W"</span><span class="brown">,</span> <span class="red">467</span><span class="brown">,</span> <span class="red">50</span><span class="brown">)</span><br/>18 btnE <span class="brown">=</span> <span class="blue1">Controls</span><span class="brown">.AddButton(</span><span class="red">"E"</span><span class="brown">,</span> <span class="red">541</span><span class="brown">,</span> <span class="red">50</span><span class="brown">)</span><br/>19 btnNew <span class="brown">=</span> <span class="blue1">Controls</span><span class="brown">.AddButton(</span><span class="red">"New Game"</span><span class="brown">,</span> <span class="red">480</span><span class="brown">,</span> <span class="red">370</span><span class="brown">)</span><br/>20<br/>21 <span class="blue1">Controls</span><span class="brown">.ButtonClicked =</span> OnButtonClicked<br/>22<br/>23 NewGame<span class="brown">()</span></p>&#13;
<p class="listcap"><a id="ch17ex8"/><em>Listing 17-8: Initializing</em> <code><span class="codeitalic">GraphicsWindow</code></span></p>&#13;
<p class="indent">Lines 1–6 set the properties of <code>GraphicsWindow</code>. Lines 9–11 create and position the text that tells the player their current position on the island, and lines 14–19 create the five buttons (see <a href="ch17.html#ch17fig8">Figure 17-8</a>). Line 21 registers a handler to process the buttons, and line 23 calls <code>NewGame()</code> to start a new game.</p>&#13;
<h4 class="h4" id="ch17lev2sec10"><em><strong>Step 3: Start a New Game</strong></em></h4>&#13;
<p class="noindent">Now you’ll add the <code>NewGame()</code> subroutine. This subroutine (shown in <a href="ch17.html#ch17ex9">Listing 17-9</a>) is called when the player clicks the New Game button.</p>&#13;
<p class="programs">1 <span class="purple"><span class="codestrong">Sub</span></span> NewGame<br/>2   gameOver <span class="brown">=</span> <span class="red">0</span>   <span class="green"><span class="codeitalic">' Game isn't over yet</span></span><br/>3   moveNumber <span class="brown">=</span> <span class="red">0</span> <span class="green"><span class="codeitalic">' How many moves the player makes</span></span><br/>4   path <span class="brown">=</span> <span class="blue1">Program</span><span class="brown">.Directory</span><br/>5<br/>6   <span class="blue1">GraphicsWindow</span><span class="brown">.DrawImage(</span>path <span class="brown">+</span> <span class="red">"\Background.png"</span><span class="brown">,</span> <span class="red">0</span><span class="brown">,</span> <span class="red">0</span><span class="brown">)</span><br/>7   CreateNewMap<span class="brown">()</span> <span class="green"><span class="codeitalic">' Creates and draws a new treasure map</span></span><br/><span epub:type="pagebreak" id="page_256"/><br/>8   ShowLocation<span class="brown">()</span> <span class="green"><span class="codeitalic">' Gives feedback to the player</span></span><br/>9 <span class="purple"><span class="codestrong">EndSub</span></span></p>&#13;
<p class="listcap"><a id="ch17ex9"/><em>Listing 17-9: The</em> <code><span class="codeitalic">NewGame()</code></span> <em>subroutine</em></p>&#13;
<p class="indent">You set the <code>gameOver</code> flag to 0 because the game isn’t over yet (line 2). You also set <code>moveNumber</code> to 0 because the player hasn’t made any moves yet (line 3). You then find the program’s path and assign it to the <code>path</code> variable. You’ll use this variable when you draw the different icons on the treasure map. In line 6, you draw a new copy of the background image to erase the previous map. You then call <code>CreateNewMap()</code> to create and draw a new treasure map (line 7) and call <code>ShowLocation()</code> to give feedback to the player about their current location on the island (line 8). <code>ShowLocation()</code> updates the text message to describe the player’s new location after they move. You’ll add these subroutines next.</p>&#13;
<h4 class="h4" id="ch17lev2sec11"><em><strong>Step 4: Create a New Treasure Map</strong></em></h4>&#13;
<p class="noindent">The <code>CreateNewMap()</code> subroutine builds a 10×10 array to represent the treasure map. Each element in the array stores a number between 0 and 7. The number 0 means clear, 1 means grass, 2 means forest, 3 means volcano, 4 means cave, 5 means rain, 6 means flowers, and 7 means treasure. The <code>CreateNewMap()</code> subroutine is shown in <a href="ch17.html#ch17ex10">Listing 17-10</a>.</p>&#13;
<p class="programs"> 1 <span class="purple"><span class="codestrong">Sub</span></span> CreateNewMap<br/> 2   <span class="purple"><span class="codestrong">For</span></span> row <span class="brown">=</span> <span class="red">1</span> <span class="purple"><span class="codestrong">To</span></span> <span class="red">10</span><br/> 3     <span class="purple"><span class="codestrong">For</span></span> col <span class="brown">=</span> <span class="red">1</span> <span class="purple"><span class="codestrong">To</span></span> <span class="red">10</span><br/> 4       map[row][col] <span class="brown">=</span> <span class="red">0</span>   <span class="green"><span class="codeitalic">' Clears all cells</span></span><br/> 5     <span class="purple"><span class="codestrong">EndFor</span></span><br/> 6   <span class="purple"><span class="codestrong">EndFor</span></span><br/> 7<br/> 8   objId <span class="brown">=</span> <span class="red">"1=1;2=1;3=1;4=1;5=1;6=1;7=1;8=1;9=2;10=2;11=2;12=2;13=2;14=2;</span><br/>     <span class="red">15=2;16=2;17=3;18=3;19=4;20=4;21=5;22=5;23=6;24=6;25=7;26=0"</span><br/> 9   count <span class="brown">=</span> <span class="red">1</span>               <span class="green"><span class="codeitalic">' Points to first element in objId</span></span><br/>10   <span class="purple"><span class="codestrong">While</span></span> <span class="brown">(</span>count <span class="brown">&lt;=</span> <span class="blue1">Array</span><span class="brown">.GetItemCount(</span>objId<span class="brown">))</span><br/>11     row <span class="brown">=</span> <span class="blue1">Math</span><span class="brown">.GetRandomNumber(</span><span class="red">10</span><span class="brown">)</span><br/>12     col <span class="brown">=</span> <span class="blue1">Math</span><span class="brown">.GetRandomNumber(</span><span class="red">10</span><span class="brown">)</span><br/>13     <span class="purple"><span class="codestrong">If</span></span> <span class="brown">(</span>map[row][col] <span class="brown">=</span> <span class="red">0</span><span class="brown">)</span> <span class="purple"><span class="codestrong">Then</span></span>    <span class="green"><span class="codeitalic">' Cell is clear</span></span><br/>14       map[row][col] <span class="brown">=</span> objId[count] <span class="green"><span class="codeitalic">' Reserves the cell</span></span><br/>15       DrawObject<span class="brown">()</span><br/>16       count <span class="brown">=</span> count <span class="brown">+</span> <span class="red">1</span>   <span class="green"><span class="codeitalic">' Points to next element in objId</span></span><br/>17     <span class="purple"><span class="codestrong">EndIf</span></span><br/>18   <span class="purple"><span class="codestrong">EndWhile</span></span><br/>19<br/>20   rowP <span class="brown">=</span> row              <span class="green"><span class="codeitalic">' Player's current row</span></span><br/>21   colP <span class="brown">=</span> col              <span class="green"><span class="codeitalic">' Player's current column</span></span><br/>22 <span class="purple"><span class="codestrong">EndSub</span></span></p>&#13;
<p class="listcap"><a id="ch17ex10"/><em>Listing 17-10: The</em> <code><span class="codeitalic">CreateNewMap()</code></span> <em>subroutine</em></p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_257"/>First, you set all the elements of the map to 0 (lines 2–6). In line 8, you define an array, <code>objId</code>, that holds the identifiers of the objects you’ll add to the map. This array asks for eight grass fields, eight forests, two volcanoes, two caves, two rainy spots, two flower fields, and one treasure spot. The last element in the array is intentionally set to 0 so that the <code>While</code> loop on line 10 finds an empty starting place for the player. When you’re feeling more adventurous, you can change the <code>objId</code> array to make the treasure map contain more or fewer objects.</p>&#13;
<p class="indent">Next, you start a <code>While</code> loop to add the objects to the treasure map. First, you select a random cell on the map (lines 11–12). If that cell is clear (line 13), you mark it with a number that’s not zero to reserve it for the next object from <code>objId</code> (line 14), call <code>DrawObject()</code> to draw the added object on the treasure map (line 15), and increment the <code>count</code> variable to point to the next element in <code>objId</code> (line 16). When the loop finishes, you set the player’s current row, <code>rowP</code>, and column, <code>colP</code>, to the empty cell found by the <code>While</code> loop in its last iteration (lines 20–21). This ensures the player starts on a clear cell on the map.</p>&#13;
<h4 class="h4" id="ch17lev2sec12"><em><strong>Step 5: Draw Objects on the Map</strong></em></h4>&#13;
<p class="noindent">Before you add the <code>ShowLocation()</code> subroutine, you need to add the <code>DrawObject()</code> subroutine in <a href="ch17.html#ch17ex11">Listing 17-11</a>. You call this subroutine to draw an object at <code>map[row][col]</code>.</p>&#13;
<p class="programs"> 1 <span class="purple"><span class="codestrong">Sub</span></span> DrawObject<br/> 2   imgName <span class="brown">=</span> <span class="red">"1=Grass.ico;2=Tree.ico;3=Volcano.ico;4=Cave.ico;5=Rain.ico;</span><br/>     <span class="red">6=Flower.ico;7=Treasure.ico"</span><br/> 3<br/> 4   imgID <span class="brown">=</span> map[row][col]<br/> 5   <span class="purple"><span class="codestrong">If</span></span> <span class="brown">((</span>imgID <span class="brown">&gt;=</span> <span class="red">1</span><span class="brown">) And (</span>imgID <span class="brown">&lt;=</span> <span class="red">7</span><span class="brown">))</span> <span class="purple"><span class="codestrong">Then</span></span><br/> 6     imgPath <span class="brown">=</span> path <span class="brown">+</span> <span class="red">"\"</span> <span class="brown">+</span> imgName[imgID]<br/> 7<br/> 8     xPos <span class="brown">=</span> <span class="red">52</span> <span class="brown">+ (</span>col <span class="brown">-</span> <span class="red">1</span><span class="brown">) *</span> <span class="red">38</span><br/> 9     yPos <span class="brown">=</span> <span class="red">25</span> <span class="brown">+ (</span>row <span class="brown">-</span> <span class="red">1</span><span class="brown">) *</span> <span class="red">38</span><br/>10     <span class="blue1">GraphicsWindow</span><span class="brown">.DrawImage(</span>imgPath<span class="brown">,</span> xPos<span class="brown">,</span> yPos<span class="brown">)</span><br/>11   <span class="purple"><span class="codestrong">EndIf</span></span><br/>12 <span class="purple"><span class="codestrong">EndSub</span></span></p>&#13;
<p class="listcap"><a id="ch17ex11"/><em>Listing 17-11: The</em> <code><span class="codeitalic">DrawObject()</code></span> <em>subroutine</em></p>&#13;
<p class="indent">You define the <code>imgName</code> array that holds the name of the image file for the seven objects in the game (line 2). In line 4, you get the number stored in the map at row number <code>row</code> and column number <code>col</code>, and then you assign this value to <code>imgID</code>. If this number is between 1 and 7 (line 5), you construct the full path for the image that corresponds to this number (line 6) and then draw that image at its position on the map (lines 8–10). The numbers you see in lines 8–9 (52, 38, and 25) come from the background image. These numbers ensure that the objects are drawn in the centers of the cells in <a href="ch17.html#ch17fig8">Figure 17-8</a>.</p>&#13;
<h4 class="h4" id="ch17lev2sec13"><span epub:type="pagebreak" id="page_258"/><em><strong>Step 6: Show the Player’s Location</strong></em></h4>&#13;
<p class="noindent">Now you can add the <code>ShowLocation()</code> subroutine in <a href="ch17.html#ch17ex12">Listing 17-12</a>, which tells the player their current location on the island.</p>&#13;
<p class="programs"> 1 <span class="purple"><span class="codestrong">Sub</span></span> ShowLocation<br/> 2   locID <span class="brown">=</span> map[rowP][colP]<br/> 3   <span class="purple"><span class="codestrong">If</span></span> <span class="brown">(</span>locID <span class="brown">=</span> <span class="red">1</span><span class="brown">)</span> <span class="purple"><span class="codestrong">Then</span></span><br/> 4     msg <span class="brown">=</span> <span class="red">"You're in a grass field."</span><br/> 5   <span class="purple"><span class="codestrong">ElseIf</span></span> <span class="brown">(</span>locID <span class="brown">=</span> <span class="red">2</span><span class="brown">)</span> <span class="purple"><span class="codestrong">Then</span></span><br/> 6     msg <span class="brown">=</span> <span class="red">"You're in a forest."</span><br/> 7   <span class="purple"><span class="codestrong">ElseIf</span></span> <span class="brown">(</span>locID <span class="brown">=</span> <span class="red">3</span><span class="brown">)</span> <span class="purple"><span class="codestrong">Then</span></span><br/> 8     msg <span class="brown">=</span> <span class="red">"You're next to a volcano."</span><br/> 9   <span class="purple"><span class="codestrong">ElseIf</span></span> <span class="brown">(</span>locID <span class="brown">=</span> <span class="red">4</span><span class="brown">)</span> <span class="purple"><span class="codestrong">Then</span></span><br/>10     msg <span class="brown">=</span> <span class="red">"You're in a cave."</span><br/>11   <span class="purple"><span class="codestrong">ElseIf</span></span> <span class="brown">(</span>locID <span class="brown">=</span> <span class="red">5</span><span class="brown">)</span> <span class="purple"><span class="codestrong">Then</span></span><br/>12     msg <span class="brown">=</span> <span class="red">"You're in the rain."</span><br/>13   <span class="purple"><span class="codestrong">ElseIf</span></span> <span class="brown">(</span>locID <span class="brown">=</span> <span class="red">6</span><span class="brown">)</span> <span class="purple"><span class="codestrong">Then</span></span><br/>14     msg <span class="brown">=</span> <span class="red">"You're in a flower field."</span><br/>15   <span class="purple"><span class="codestrong">ElseIf</span></span> <span class="brown">(</span>locID <span class="brown">=</span> <span class="red">7</span><span class="brown">)</span> <span class="purple"><span class="codestrong">Then</span></span><br/>16     gameOver <span class="brown">=</span> <span class="red">1</span><br/>17     msg <span class="brown">=</span> <span class="red">"Congratulations! You found the treasure!"</span><br/>18   <span class="purple"><span class="codestrong">Else</span></span><br/>19     msg <span class="brown">=</span> <span class="red">"You're in the clear!"</span><br/>20   <span class="purple"><span class="codestrong">EndIf</span></span><br/>21<br/>22   <span class="blue1">Shapes</span><span class="brown">.SetText(</span>txtID<span class="brown">,</span> <span class="red">"["</span> <span class="brown">+</span> moveNumber <span class="brown">+</span> <span class="red">"]: "</span> <span class="brown">+</span> msg<span class="brown">)</span><br/>23 <span class="purple"><span class="codestrong">EndSub</span></span></p>&#13;
<p class="listcap"><a id="ch17ex12"/><em>Listing 17-12: The</em> <code><span class="codeitalic">ShowLocation()</code></span> <em>subroutine</em></p>&#13;
<p class="indent">The subroutine uses an <code>If/ElseIf</code> ladder to create a message, <code>msg</code>, based on the player’s current location, which is identified by <code>rowP</code> and <code>colP</code> (lines 1–20). The subroutine then calls <code>SetText()</code> to show this message using the text shape identified by <code>txtID</code>. Note how the player’s move number, <code>moveNumber</code>, is included in the message so they know how many times they’ve moved.</p>&#13;
<h4 class="h4" id="ch17lev2sec14"><em><strong>Step 7: Handle Button Clicks</strong></em></h4>&#13;
<p class="noindent">This is the final step to finish the game! You just need to process the button clicks. Add the <code>OnButtonClicked()</code> subroutine shown in <a href="ch17.html#ch17ex13">Listing 17-13</a>.</p>&#13;
<p class="programs"> 1 <span class="purple"><span class="codestrong">Sub</span></span> OnButtonClicked<br/> 2   btnID <span class="brown">=</span> <span class="blue1">Controls</span><span class="brown">.LastClickedButton</span><br/> 3<br/> 4   <span class="purple"><span class="codestrong">If</span></span> <span class="brown">(</span>btnID <span class="brown">=</span> btnNew<span class="brown">)</span> <span class="purple"><span class="codestrong">Then</span></span><br/> 5     NewGame<span class="brown">()</span><br/> 6   <span class="purple"><span class="codestrong">ElseIf</span></span> <span class="brown">(</span>gameOver <span class="brown">=</span> <span class="red">0</span><span class="brown">)</span> <span class="purple"><span class="codestrong">Then</span></span><br/> 7     moveNumber <span class="brown">=</span> moveNumber <span class="brown">+</span> <span class="red">1</span><br/> 8<br/> 9     MovePlayer<span class="brown">()</span>     <span class="green"><span class="codeitalic">' Finds the player's new row and column</span></span><br/>10<br/>11     <span class="purple"><span class="codestrong">If</span></span> <span class="brown">((</span>rowP <span class="brown">&lt;</span> <span class="red">1</span><span class="brown">) Or (</span>rowP <span class="brown">&gt;</span> <span class="red">10</span><span class="brown">) Or (</span>colP <span class="brown">&lt;</span> <span class="red">1</span><span class="brown">) Or (</span>colP <span class="brown">&gt;</span> <span class="red">10</span><span class="brown">))</span> <span class="purple"><span class="codestrong">Then</span></span><br/>12       gameOver <span class="brown">=</span> <span class="red">1</span><br/>13       <span class="blue1">Shapes</span><span class="brown">.SetText(</span>txtID<span class="brown">,</span> <span class="red">"Sorry! You were eaten by the shark!"</span><span class="brown">)</span><br/>14     <span class="purple"><span class="codestrong">Else</span></span><br/>15       ShowLocation<span class="brown">()</span> <span class="green"><span class="codeitalic">' Tells the player their new position</span></span><br/>16     <span class="purple"><span class="codestrong">EndIf</span></span><br/>17   <span class="purple"><span class="codestrong">EndIf</span></span><br/>18 <span class="purple"><span class="codestrong">EndSub</span></span></p>&#13;
<p class="listcap"><a id="ch17ex13"/><em>Listing 17-13: The</em> <code><span class="codeitalic">OnButtonClicked()</code></span> <em>subroutine</em></p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_259"/>Because you’re using five buttons, you start by finding the identifier of the clicked button (line 2). If it’s the New Game button (line 4), you call <code>NewGame()</code> to start all over (line 5). Otherwise, the player has clicked one of the four movement buttons. You need to process the player’s request only if the game isn’t over yet. If the game is still in progress (line 6), you increment <code>moveNumber</code> (line 7), call <code>MovePlayer()</code> to set the player’s new location (line 9), and then check the status after this move (lines 11–16). If the player falls into the shark-infested water (line 11), you set <code>gameOver</code> to 1 (line 12) and inform the player of their bad luck (line 13). Otherwise, if the player is still on the island, you call <code>ShowLocation()</code> to give them information about their new location (line 15).</p>&#13;
<p class="indent">The last subroutine you need to add in this game is in <a href="ch17.html#ch17ex14">Listing 17-14</a>. The <code>MovePlayer()</code> subroutine sets the player’s next position based on which button (N, E, S, or W) they clicked.</p>&#13;
<p class="programs"> 1 <span class="purple"><span class="codestrong">Sub</span></span> MovePlayer<br/> 2   shift <span class="brown">=</span> <span class="red">0</span>                  <span class="green"><span class="codeitalic">' How much to shift direction</span></span><br/> 3   randNum <span class="brown">=</span> <span class="blue1">Math</span><span class="brown">.GetRandomNumber(</span><span class="red">10</span><span class="brown">)</span><br/> 4   <span class="purple"><span class="codestrong">If</span></span> <span class="brown">(</span>randNum <span class="brown">=</span> <span class="red">1</span><span class="brown">)</span> <span class="purple"><span class="codestrong">Then</span></span><br/> 5     shift <span class="brown">=</span> <span class="red">1</span><br/> 6   <span class="purple"><span class="codestrong">ElseIf</span></span> <span class="brown">(</span>randNum <span class="brown">=</span> <span class="red">2</span><span class="brown">)</span> <span class="purple"><span class="codestrong">Then</span></span><br/> 7     shift <span class="brown">= -</span><span class="red">1</span><br/> 8   <span class="purple"><span class="codestrong">EndIf</span></span><br/> 9<br/>10   <span class="purple"><span class="codestrong">If</span></span> <span class="brown">(</span>btnID <span class="brown">=</span> btnN<span class="brown">)</span> <span class="purple"><span class="codestrong">Then</span></span>     <span class="green"><span class="codeitalic">' North</span></span><br/>11     rowP <span class="brown">=</span> rowP <span class="brown">-</span> <span class="red">1</span><br/>12     colP <span class="brown">=</span> colP <span class="brown">+</span> shift<br/>13   <span class="purple"><span class="codestrong">ElseIf</span></span> <span class="brown">(</span>btnID <span class="brown">=</span> btnS<span class="brown">)</span> <span class="purple"><span class="codestrong">Then</span></span> <span class="green"><span class="codeitalic">' South</span></span><br/>14     rowP <span class="brown">=</span> rowP <span class="brown">+</span> <span class="red">1</span><br/>15     colP <span class="brown">=</span> colP <span class="brown">+</span> shift<br/>16   <span class="purple"><span class="codestrong">ElseIf</span></span> <span class="brown">(</span>btnID <span class="brown">=</span> btnE<span class="brown">)</span> <span class="purple"><span class="codestrong">Then</span></span> <span class="green"><span class="codeitalic">' East</span></span><br/>17     colP <span class="brown">=</span> colP <span class="brown">+</span> <span class="red">1</span><br/>18     rowP <span class="brown">=</span> rowP <span class="brown">+</span> shift<br/>19   <span class="purple"><span class="codestrong">ElseIf</span></span> <span class="brown">(</span>btnID <span class="brown">=</span> btnW<span class="brown">)</span> <span class="purple"><span class="codestrong">Then</span></span> <span class="green"><span class="codeitalic">' West</span></span><br/>20     colP <span class="brown">=</span> colP <span class="brown">-</span> <span class="red">1</span><br/>21     rowP <span class="brown">=</span> rowP <span class="brown">+</span> shift<br/>22   <span class="purple"><span class="codestrong">EndIf</span></span><br/>23 <span class="purple"><span class="codestrong">EndSub</span></span></p>&#13;
<p class="listcap"><a id="ch17ex14"/><em>Listing 17-14: The</em> <code><span class="codeitalic">MovePlayer()</code></span> <em>subroutine</em></p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_260"/>We mentioned that the old compass has a 20 percent chance of being wrong. To simulate this, you create the variable <code>shift</code> to alter the player’s direction. First, you get a random number between 1 and 10 (line 3). If this number is 1, you set <code>shift</code> to 1. If this number is 2, you set <code>shift</code> to –1 (lines 4–8). Otherwise, you keep <code>shift</code> at 0, which means that you won’t alter the player’s move in any way (line 2).</p>&#13;
<p class="indent">You start an <code>If/ElseIf</code> ladder to process the clicked button (lines 10–22). If the player clicked the north button N (line 10), you move them up one row (line 11) and change their current column by using the <code>shift</code> variable (line 12). If <code>shift</code> is 0, the player’s current column won’t change, and they’ll move north. The rest of the ladder works the same way.</p>&#13;
<p class="indent">Now that the game is complete, you can enjoy it. See how long it takes you to find the treasure without getting eaten by the sharks!</p>&#13;
<div class="sidebar">&#13;
<p class="sidebart" id="ch17sb07"><strong>TRY IT OUT 17-7</strong></p>&#13;
<p class="noindent">The Treasure Map game has a lot of room for improvement. For example, you can give the player another chance if they fall victim to the sharks. You can also give the player more clues about their current location. Come up with some ideas to improve the game, and try to implement them. Make an adventure worthy of Captain Jack Sparrow!</p>&#13;
</div>&#13;
<h3 class="h3a" id="ch17lev1sec05"><span class="blues"><strong>Programming Challenges</strong></span></h3>&#13;
<p class="noindent">If you get stuck, check out <em><a href="http://nostarch.com/smallbasic/">http://nostarch.com/smallbasic/</a></em> for the solutions and for more resources and review questions for teachers and students.</p>&#13;
<ol>&#13;
<li><p class="noindenta">Okla is a fearless warrior known for his courage and wisdom. He’s now on a noble mission in a haunted castle looking for the four keys needed to free the puppies that are trapped inside! But there’s a problem: the haunted castle is guarded by evil monsters who throw bombs all over the castle. Each time one of these bombs hits Okla, he loses 10 units of energy. You need to help Okla navigate his way through the castle to find the four keys before he loses all his energy.</p>&#13;
<div class="image1"><img alt="image" src="graphics/f0260-01.jpg"/></div>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_261"/>Open the file <em>Okla.sb</em> from this chapter’s folder, and run it to play the game. After you play the game and understand how it works, come up with some ideas to improve it, and try to implement them.</p></li>&#13;
<li><p class="noindenta">Open the file <em>TicTacToe_Incomplete.sb</em> from this chapter’s folder. This game lets you play tic-tac-toe against the computer. The game’s board is represented by a 3×3 matrix named <code>board</code>. When the player clicks a square, the game draws an X in the clicked cell and fills the number 1 in its <code>board</code> element. The computer then takes its turn and picks an empty cell at random (the computer isn’t that smart). The game draws an O in the cell the computer selected and fills in the number 5 in that <code>board</code> element. The following figure illustrates how the game works.</p>&#13;
<div class="image1"><img alt="image" src="graphics/f0261-01.jpg"/></div>&#13;
<p class="indent">Your task is to complete the <code>CheckWinner()</code> subroutine, which is called after each move. You need to check the sum of each row, each column, and the two diagonals. A sum of 3 means the player won the game. A sum of 15 means the computer won the game. If there’s no winner and nine moves have been made (the board is filled completely with the Xs and Os), the game is a tie.<span epub:type="pagebreak" id="page_262"/></p></li>&#13;
</ol>&#13;
</body></html>