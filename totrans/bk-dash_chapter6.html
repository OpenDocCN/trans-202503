<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops">
<head>
<title>6. Investment Portfolio: Building Larger Apps</title>
<link href="../styles/stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="sbo-rt-content"><section aria-labelledby="ch6" epub:type="chapter" role="doc-chapter">
<header>
<h2 class="CHAPTER" id="ch6">
<span class="CN"><span aria-label=" Page 95. " epub:type="pagebreak" id="pg_95" role="doc-pagebreak"></span><samp class="SANS_Futura_Std_Bold_Condensed_B_11">6</samp></span>
<span class="CT"><samp class="SANS_Dogma_OT_Bold_B_11">INVESTMENT PORTFOLIO: BUILDING LARGER APPS</samp></span>
</h2>
</header>
<figure class="opener"><img alt="" class="opener" height="203" src="../images/opener-img.png" width="203"/></figure>
<p class="ChapterIntro">In this chapter we’ll show you how to create an investment portfolio app that explores how asset allocation affects a portfolio’s return. We’ll start with an introduction to asset allocation and why it’s an important concept in investing. We’ll then create a dashboard to explore a dataset detailing annual returns for cash, stocks, and bonds since 1929. The app will show you how interactive dashboards created with Dash really help bring data to life.</p>
<p class="TX">This app contains more lines of code than the app in <span class="Xref"><a href="chapter5.xhtml">Chapter 5</a></span>. We’ll introduce ways to organize larger apps and offer some tips and tricks for maintaining and debugging large apps. We also cover some advanced callback techniques.</p>
<p class="TX"><span aria-label=" Page 96. " epub:type="pagebreak" id="pg_96" role="doc-pagebreak"></span>By the end of this chapter, you’ll know how to:</p>
<ul class="List-1">
<li class="BL">Structure a larger project to make it easier to maintain and debug</li>
<li class="BL">Include FontAwesome icons in your app</li>
<li class="BL">Use new Dash Core components: <samp class="SANS_TheSansMonoCd_W5Regular_11">DataTable</samp>, <samp class="SANS_TheSansMonoCd_W5Regular_11">Slider</samp>, and <samp class="SANS_TheSansMonoCd_W5Regular_11">Markdown</samp></li>
<li class="BL">Use new Dash Bootstrap components: <samp class="SANS_TheSansMonoCd_W5Regular_11">Card</samp>, <samp class="SANS_TheSansMonoCd_W5Regular_11">InputGroup</samp>, <samp class="SANS_TheSansMonoCd_W5Regular_11">Table</samp>, <samp class="SANS_TheSansMonoCd_W5Regular_11">Tabs</samp>, and <samp class="SANS_TheSansMonoCd_W5Regular_11">Tooltip</samp></li>
<li class="BL">Use Plotly Graph Objects to make color-coded figures</li>
</ul>
<p class="TX">We’ll also cover some advanced callback techniques, such as using callbacks with multiple inputs and outputs, getting data from components without triggering a callback, and synchronizing components using callbacks. Before we get to the code, though, you’ll need a little background on asset allocation.</p>
<section aria-labelledby="sec1" epub:type="division">
<h3 class="H1" id="sec1"><a id="h1-36"></a><samp class="SANS_Futura_Std_Bold_B_11">Asset Allocation</samp></h3>
<p class="TNI">One of the primary goals in investing is to obtain the highest returns with the lowest risk of loss. <i>Asset allocation</i> is the strategy of dividing an investment portfolio among different categories of assets such as stocks, bonds, and cash. The objective is to reduce risk through diversification. Historically, the returns of these asset classes do not move in unison. For example, when stocks are down, bonds are often up. Having both classes in your portfolio can reduce risk since they offset each other.</p>
<p class="TX">The amount to allocate to each asset class depends on your goals, time horizon, and risk tolerance. For example, stocks are more volatile than bonds or cash but typically have higher returns in the long run. If you are investing for a retirement that’s decades in the future, you may be comfortable allocating more of your portfolio to stocks since you have time to wait out the inevitable ups and downs of the market. That said, it’s hard to know ahead of time how you’ll feel when you see the balance in your account decline, and it’s not uncommon for people to panic when they see their stocks drop and sell them at the bottom of the market, locking in those losses. Having other assets that don’t decline at the same time as stocks can help you stick with your long-term strategy.</p>
<p class="TX">There are risks in being too conservative as well. If you have too much allocated to cash, you are at risk of not having enough funds at retirement. However, for short-term goals such as being able to cover unexpected living expenses, it’s appropriate to hold cash.</p>
<p class="TX">If you are new to investing and this isn’t making much sense, playing with the app can help clarify these concepts. That’s one of the great things about data visualization. With a glance at the color-coded graph, you can see how stocks, bonds, and cash have performed over time. This app will analyze and graphically depict how asset allocation affects your chosen portfolio, allowing you to tweak your allocation ratios to see how portfolios with various allocations perform over time.</p>
</section>
<section aria-labelledby="sec2" epub:type="division">
<h3 class="H1" id="sec2"><a id="h1-37"></a><span aria-label=" Page 97. " epub:type="pagebreak" id="pg_97" role="doc-pagebreak"></span><samp class="SANS_Futura_Std_Bold_B_11">Download and Run the App</samp></h3>
<p class="TNI">First let’s take a look at the finished app. You’ll find the full code at <a href="https://github.com/DashBookProject/Plotly-Dash"><i>https://<wbr/>github<wbr/>.com<wbr/>/DashBookProject<wbr/>/Plotly<wbr/>-Dash</i></a>. Download and run it locally using the instructions in <span class="Xref"><a href="chapter2.xhtml">Chapter 2</a></span>, or see it live at <a href="https://wealthdashboard.app"><i>https://<wbr/>wealthdashboard<wbr/>.app</i></a>. <a href="chapter6.xhtml#fig6-1">Figure 6-1</a> shows a screenshot of the app.</p>
<a id="fig6-1"></a>
<figure class="IMG"><img alt="" class="img90" height="701" src="../images/Figure6-1.png" width="696"/>
<figcaption><p class="CAP"><samp class="SANS_Futura_Std_Book_Oblique_I_11">Figure 6-1: Screenshot of the Asset Allocation Visualizer app</samp></p></figcaption>
</figure>
<p class="TX">You can see there are a lot more elements in this app than in our previous Dash apps. Try using the app to see how it functions. Enter different numbers in the input fields. Move the sliders to select different asset allocations. See what your investment returns would be if you put all your money in cash, or stocks, or bonds, or various combinations of the three. Use the radio buttons to select different time periods to see how your portfolio would have performed if you had started investing at the height of the dot-com bubble or the depths of the Great Depression.</p>
<p class="TX"><span aria-label=" Page 98. " epub:type="pagebreak" id="pg_98" role="doc-pagebreak"></span>Notice how the components in the app interact and how the pie chart, line chart, tables, and results fields update. You’ll learn how to do this in the <span class="Xref">“Dash Callbacks”</span> section later in this chapter.</p>
<p class="TX">Also, take note of the layout design. This app has sliders, input fields, and checklist options on the left side and output in the form of a pie chart, line chart, and summary table on the right. You will learn how to do this later in this chapter, in the <span class="Xref">“Layout and Styling”</span> section.</p>
</section>
<section aria-labelledby="sec3" epub:type="division">
<h3 class="H1" id="sec3"><a id="h1-38"></a><samp class="SANS_Futura_Std_Bold_B_11">App Structure</samp></h3>
<p class="TNI">One remarkable thing about Dash is how easy it is to make visual, interactive apps with just a few lines of code. The first two apps in this book are good examples, and you can see more in the Dash tutorial and in the Dash Enterprise App Gallery. However, when you start making your own apps, you’ll find it’s easy for the code to grow and become hundreds or even thousands of lines long as you add more features and components and build multipage apps. This chapter’s app has about 700 lines of code, and it is still relatively simple.</p>
<p class="TX">When you start working with larger apps, you’ll quickly understand why structuring your app is important. In small apps, it can be convenient to do things like define components directly in the layout or even in a callback, but as you add more features, this method can make your layout huge and difficult to manage, change, and debug.</p>
<p class="TX">In larger apps, we might separate sections into their own files. In this app, since it’s still relatively small, we keep all the code in one file but organize it so that related elements are grouped together. For example, we have different sections for figures, tables, tabs, and <samp class="SANS_TheSansMonoCd_W5Regular_11">Markdown</samp> components. Each component is either defined in a function or assigned a variable name. Because the components are structured in this way, they become building blocks that we can then place in the layout as and when we need them by using a function call or calling the variable name. This organization also makes it easy to reuse these components in other apps. We split out the helper functions that do the data wrangling, such as calculating the investment returns, into their own section too. We’re able to keep the layout section concise at only 30 lines of code because of the way we structured the components. The last section has the app callbacks.</p>
<p class="TX">There are many ways to structure an app. You could, for instance, put some sections in different modules and import them into the main app. For multipage apps, it’s standard practice to have each page in a different module. You will see examples of this in <span class="Xref"><a href="chapter7.xhtml">Chapter 7</a></span>. The important thing is to have a consistent method of organizing and structuring your app that works for you and makes sense for the project. For this app, given the size and that it’s a single-page app, we prefer to keep everything together.</p>
</section>
<section aria-labelledby="sec4" epub:type="division">
<h3 class="H1" id="sec4"><a id="h1-39"></a><span aria-label=" Page 99. " epub:type="pagebreak" id="pg_99" role="doc-pagebreak"></span><samp class="SANS_Futura_Std_Bold_B_11">Setting Up the Project</samp></h3>
<p class="TNI">As usual, we’ll open with importing the libraries and managing the data.</p>
<p class="HeadB"><a id="h2-29"></a><samp class="SANS_Futura_Std_Bold_Condensed_Oblique_I_11">Importing the Libraries</samp></p>
<p class="TNI">We start by importing the modules we use in the app (<a href="chapter6.xhtml#List6-1">Listing 6-1</a>). New to this app are the <samp class="SANS_TheSansMonoCd_W5Regular_11">data_table</samp>, <samp class="SANS_TheSansMonoCd_W5Regular_11">State</samp>, <samp class="SANS_TheSansMonoCd_W5Regular_11">callback_context</samp>, and <samp class="SANS_TheSansMonoCd_W5Regular_11">plotly.graph_objects</samp> modules.</p>
<a id="List6-1"></a>
<p class="_CodeWideSpaceAbove"><samp class="SANS_TheSansMonoCd_W5Regular_11">from dash import Dash, dcc, html, dash_table, Input, Output, State, callback_context</samp></p>
<p class="CodeWide"><samp class="SANS_TheSansMonoCd_W5Regular_11">import dash_bootstrap_components as dbc</samp></p>
<p class="CodeWide"><samp class="SANS_TheSansMonoCd_W5Regular_11">import plotly.graph_objects as go</samp></p>
<p class="_CodeWideSpacebelow"><samp class="SANS_TheSansMonoCd_W5Regular_11">import pandas as pd</samp></p>
<p class="CodeListingCaptionWide"><samp class="SANS_Futura_Std_Book_Oblique_I_11">Listing 6-1: The import section of</samp> <samp class="SANS_Futura_Std_Book_11">app.py</samp></p>
<p class="TX">We use <samp class="SANS_TheSansMonoCd_W5Regular_11">data_table</samp> to display results and source data. We use <samp class="SANS_TheSansMonoCd_W5Regular_11">State</samp> and <samp class="SANS_TheSansMonoCd_W5Regular_11">callback_context</samp> in our callbacks, and we use Plotly Graph Objects rather than Plotly Express to create the figures. We will discuss each of these in more detail later.</p>
<p class="HeadB"><a id="h2-30"></a><samp class="SANS_Futura_Std_Bold_Condensed_Oblique_I_11">Adding the Stylesheets</samp></p>
<p class="TNI">Next we will add the Bootstrap CSS and the FontAwesome icons as external stylesheets. In <span class="Xref"><a href="chapter5.xhtml">Chapter 5</a></span> we added the <samp class="SANS_TheSansMonoCd_W5Regular_11">BOOTSTRAP</samp> theme to the app, and in this app we use the <samp class="SANS_TheSansMonoCd_W5Regular_11">SPACELAB</samp> theme, like so:</p>
<p class="CodeWideSingle"><samp class="SANS_TheSansMonoCd_W5Regular_11">app = Dash(__name__, external_stylesheets=[dbc.themes.SPACELAB, dbc.icons.FONT_AWESOME])</samp></p>
<p class="TX">The <samp class="SANS_TheSansMonoCd_W5Regular_11">SPACELAB</samp> theme provides us with the fonts, color palette, shapes, and sizes of the page elements you see in <a href="chapter6.xhtml#fig6-1">Figure 6-1</a>.</p>
<p class="TX">The FontAwesome library has an extensive collection of icons to help make an app more eye-catching. <a href="chapter6.xhtml#fig6-2">Figure 6-2</a> shows the FontAwesome icons we use in the app.</p>
<a id="fig6-2"></a>
<figure class="IMG"><img alt="" class="img90" height="186" src="../images/Figure6-2.png" width="696"/>
<figcaption><p class="CAP"><samp class="SANS_Futura_Std_Book_Oblique_I_11">Figure 6-2: The FontAwesome icons we use in the app</samp></p></figcaption>
</figure>
<p class="TX">The Dash Bootstrap Components library has a module with the URLs for the FontAwesome and Bootstrap icons plus the URLs for various Bootstrap themes. This makes it easier to add them to your app. For example, you can specify the theme as <samp class="SANS_TheSansMonoCd_W5Regular_11">dbc.themes.SPACELAB</samp> rather than <a href="https://cdn.jsdelivr.net/npm/bootswatch@5.1.3/dist/spacelab/bootstrap.min.css"><i>https://<wbr/>cdn<wbr/>.jsdelivr<wbr/>.net<wbr/>/npm<wbr/>/bootswatch@5<wbr/>.1<wbr/>.3<wbr/>/dist<wbr/>/spacelab<wbr/>/bootstrap<wbr/>.min<wbr/>.css</i></a>.</p>
<p class="HeadB"><a id="h2-31"></a><span aria-label=" Page 100. " epub:type="pagebreak" id="pg_100" role="doc-pagebreak"></span><samp class="SANS_Futura_Std_Bold_Condensed_Oblique_I_11">Data Management</samp></p>
<p class="TNI">The data source for this app comes from Professor Aswath Damodaran, who teaches corporate finance and valuation at the Stern School of Business at New York University. It includes the returns for three asset classes—cash, bonds, and stocks—represented by the three-month US Treasury Bill, the 10-year US Treasury Bond, and the S&amp;P 500. You can learn more about this data at <a href="http://people.stern.nyu.edu/adamodar/New_Home_Page/data.xhtml"><i>http://<wbr/>people<wbr/>.stern<wbr/>.nyu<wbr/>.edu<wbr/>/adamodar<wbr/>/New<wbr/>_Home<wbr/>_Page<wbr/>/data<wbr/>.xhtml</i></a>.</p>
<p class="TX">We’ve downloaded the data and saved it as an Excel spreadsheet named <i>historic.csv</i> in the <i>assets</i> folder. Here we include the data in our app:</p>
<p class="CodeCustom1"><samp class="SANS_TheSansMonoCd_W5Regular_11">df = pd.read_csv("assets/historic.csv")</samp></p>
<p class="TX">Next we take some steps to make the app easier to maintain over time. First we make the start and end years of the data series global variables, since we use these dates in numerous places in the app. Now when we update the app annually with new data, we don’t have to make any changes to the code for the new dates:</p>
<p class="_CodeSpaceAbove"><samp class="SANS_TheSansMonoCd_W5Regular_11">MAX_YR = df.Year.max()</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">MIN_YR = df.Year.min()</samp></p>
<p class="_CodeSpaceBelow"><samp class="SANS_TheSansMonoCd_W5Regular_11">START_YR = 2007</samp></p>
<p class="TX">The <samp class="SANS_TheSansMonoCd_W5Regular_11">START_YR</samp> is the default starting year for the investment period when the app first runs. Rather than hardcoding “2007” into various places in the app, we use this global variable. If you decide you want a different start year, you only need to change it in this one line of code.</p>
<p class="TX">We also make the colors global variables. We use custom colors for the stocks, bonds, and cash in the graphs, picked to match our Bootstrap theme. If you want to change to a different Bootstrap theme, you can update the graph colors by changing the color numbers here in the <samp class="SANS_TheSansMonoCd_W5Regular_11">COLORS</samp> dictionary, and the colors will be updated throughout the app:</p>
<p class="_CodeSpaceAbove"><samp class="SANS_TheSansMonoCd_W5Regular_11">COLORS =</samp> <samp class="SANS_TheSansMonoCd_W5Regular_11">{</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">   "cash": "#3cb521",</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">   "bonds": "#fd7e14",</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">   "stocks": "#446e9b",</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">   "inflation": "#cd0200",</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">   "background": "whitesmoke",</samp></p>
<p class="_CodeSpaceBelow"><samp class="SANS_TheSansMonoCd_W5Regular_11">}</samp></p>
<p class="TX">Using this dictionary also makes the code more readable and self-documenting, since you can specify a color like this:</p>
<p class="CodeCustom1"><samp class="SANS_TheSansMonoCd_W5Regular_11">COLORS["stocks"]</samp></p>
<p class="BodyContinued">rather than like this:</p>
<p class="CodeCustom1"><samp class="SANS_TheSansMonoCd_W5Regular_11">"#446e9b"</samp></p>
</section>
<section aria-labelledby="sec5" epub:type="division">
<h3 class="H1" id="sec5"><a id="h1-40"></a><span aria-label=" Page 101. " epub:type="pagebreak" id="pg_101" role="doc-pagebreak"></span><samp class="SANS_Futura_Std_Bold_B_11">Layout and Styling</samp></h3>
<p class="TNI">In this section we’ll separate out all components and figures to modularize them so that we can add them to the layout wherever we like, as mentioned at the start of the chapter. The main layout comprises only about 30 lines of the app’s 700 lines of code. To keep it this short we define the components and figures in another section of the app and give them variable names that we can call in the layout section. Structuring the layout in this way clarifies the app structure and simplifies design changes.</p>
<p class="TX"><a href="chapter6.xhtml#List6-2">Listing 6-2</a> shows the <samp class="SANS_TheSansMonoCd_W5Regular_11">app.layout</samp> code for the main layout.</p>
<a id="List6-2"></a>
<p class="_CodeSpaceAbove"><samp class="SANS_TheSansMonoCd_W5Regular_11">app.layout = dbc.Container(</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">   [</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">      </samp><span aria-label="annotation1" class="SANS_NSAnnotations_Monospace_11">❶</span> <samp class="SANS_TheSansMonoCd_W5Regular_11">dbc.Row(</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">           dbc.Col(</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">              html.H2(</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">                 "Asset Allocation Visualizer",</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">                 className="text-center bg-primary text-white p-2",</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">              ),</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">           )</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">         ),</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">      </samp><span aria-label="annotation2" class="SANS_NSAnnotations_Monospace_11">❷</span> <samp class="SANS_TheSansMonoCd_W5Regular_11">dbc.Row(</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">           [</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">              dbc.Col(tabs, width=12, lg=</samp><samp class="SANS_TheSansMonoCd_W5Regular_11">5, className="mt-4 border"),</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">              dbc.Col(</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">                 [</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">                    dcc.Graph(id="allocation_pie_chart", className="mb-2"),</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">                    dcc.Graph(id="returns_chart", className="pb-4"),</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">                  </samp><samp class="SANS_TheSansMonoCd_W5Regular_11">  html.Hr(),</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">                    html.Div(id="summary_table"),</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">                    html.H6(datasource_text, className="my-2"),</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">                 ],</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">                 width=12,</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">                 lg=7,</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">                 className=</samp><samp class="SANS_TheSansMonoCd_W5Regular_11">"pt-4",</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">              ),</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">           ],</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">           className="ms-1",</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">     </samp><samp class="SANS_TheSansMonoCd_W5Regular_11">),</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">     dbc.Row(dbc.Col(footer)),</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">   ],</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">   </samp><span aria-label="annotation3" class="SANS_NSAnnotations_Monospace_11">❸</span> <samp class="SANS_TheSansMonoCd_W5Regular_11">fluid=True,</samp></p>
<p class="_CodeSpaceBelow"><samp class="SANS_TheSansMonoCd_W5Regular_11">)</samp></p>
<p class="CodeListingCaption"><samp class="SANS_Futura_Std_Book_Oblique_I_11">Listing 6-2: Layout code</samp></p>
<p class="TX">The entire app content is wrapped in a <samp class="SANS_TheSansMonoCd_W5Regular_11">dbc.Container</samp>, the most basic layout element in Bootstrap that’s required when using the rows and columns grid system.</p>
<p class="TX">The first row <span aria-label="annotation1" class="SANS_NSAnnotations_Monospace_11">❶</span> of the layout defines the blue header bar, shown in <a href="chapter6.xhtml#fig6-3">Figure 6-3</a>, which is defined as a Bootstrap row with one column that spans the entire width of the screen.</p>
<span aria-label=" Page 102. " epub:type="pagebreak" id="pg_102" role="doc-pagebreak"></span><a id="fig6-3"></a>
<figure class="IMG"><img alt="" class="img90" height="112" src="../images/Figure6-3.png" width="696"/>
<figcaption><p class="CAP"><samp class="SANS_Futura_Std_Book_Oblique_I_11">Figure 6-3: Header bar of the Asset Allocation Visualizer app</samp></p></figcaption>
</figure>
<p class="TX">We style the header using Bootstrap utility classes. We use <samp class="SANS_TheSansMonoCd_W5Regular_11">text-center</samp> to center the text, <samp class="SANS_TheSansMonoCd_W5Regular_11">bg-primary</samp> to set the background to the <samp class="SANS_TheSansMonoCd_W5Regular_11">SPACELAB</samp> theme’s primary color, <samp class="SANS_TheSansMonoCd_W5Regular_11">text-white</samp> to set the text color, and <samp class="SANS_TheSansMonoCd_W5Regular_11">p-2</samp> to add padding. To see all the Bootstrap utility classes available for styling your app, see the Dash Bootstrap cheat sheet at <a href="https://dashcheatsheet.pythonanywhere.com"><i>https://<wbr/>dashcheatsheet<wbr/>.pythonanywhere<wbr/>.com</i></a>.</p>
<p class="TX">The second row <span aria-label="annotation2" class="SANS_NSAnnotations_Monospace_11">❷</span> has two columns and contains the main content of the app, shown in <a href="chapter6.xhtml#fig6-4">Figure 6-4</a>. The left column contains the user input control panel tabs. The right column has the primary outputs, which are the pie chart, line chart, and summary table visualizations. There is a lot of information in this row. If the screen were static, someone viewing it on a small screen would have to zoom in and do a lot of scrolling to see the information. The good news is that Bootstrap can easily make our apps responsive to the size of the device being used. We simply set screens that are smaller than tablet size to show just one column at a time, and screens that are larger to show the two columns side by side.</p>
<a id="fig6-4"></a>
<figure class="IMG"><img alt="" class="img90" height="566" src="../images/Figure6-4.png" width="696"/>
<figcaption><p class="CAP"><samp class="SANS_Futura_Std_Book_Oblique_I_11">Figure 6-4: The main content of the resultant app</samp></p></figcaption>
</figure>
<p class="TX"><span aria-label=" Page 103. " epub:type="pagebreak" id="pg_103" role="doc-pagebreak"></span>Since Bootstrap rows have 12 columns, we make the row span the full screen by setting the width to 12. Then, on large screens, we set the first column to a width of 5 and the second column to a width of 7 so that they will show side by side. Here is a simplified example:</p>
<p class="_CodeSpaceAbove"><samp class="SANS_TheSansMonoCd_W5Regular_11">dbc.Row(</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">   [</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">      dbc.Col("column 1", width=12, lg=5),</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">      dbc.Col("column 2", width=12, lg=7)</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">   ]</samp></p>
<p class="_CodeSpaceBelow"><samp class="SANS_TheSansMonoCd_W5Regular_11">)</samp></p>
<p class="TX">At the bottom we place the footer, shown in <a href="chapter6.xhtml#fig6-5">Figure 6-5</a>. For consistency, it’s styled the same as the header. A website’s footer is located at the bottom of every page and commonly includes secondary information such as contact information, legal notices, and a sitemap.</p>
<a id="fig6-5"></a>
<figure class="IMG"><img alt="" class="img90" height="40" src="../images/Figure6-5.png" width="844"/>
<figcaption><p class="CAP"><samp class="SANS_Futura_Std_Book_Oblique_I_11">Figure 6-5: The app’s footer</samp></p></figcaption>
</figure>
<p class="TX">Finally, we set the property <samp class="SANS_TheSansMonoCd_W5Regular_11">fluid=True</samp> <span aria-label="annotation3" class="SANS_NSAnnotations_Monospace_11">❸</span>. This makes the content span the width of the <i>viewport</i>, which is the area of a web page visible to the user and which varies with the device. The viewport is smaller on phones and tablets than on a computer screen, so setting <samp class="SANS_TheSansMonoCd_W5Regular_11">fluid=True</samp> allows the app to have a responsive design that accommodates this. More on this topic shortly. That’s it for the main layout!</p>
</section>
<section aria-labelledby="sec6" epub:type="division">
<h3 class="H1" id="sec6"><a id="h1-41"></a><samp class="SANS_Futura_Std_Bold_B_11">Components</samp></h3>
<p class="TNI">Now we’ll describe in more detail how to define each component we added to the layout. You’ll notice the app has different <i>tabs</i> which define different panes for content, such as the tutorial (the Learn tab), the app controls (the Play tab), and the data (the Results tab). If you click between the tabs, you’ll see that only the content in the first column changes; the second column, which displays the graphs and summary table, always stays the same when you are just switching tabs.</p>
<p class="TX">The Play tab is the busiest, and we’ll look over each of the following elements in detail:</p>
<ul class="List-1">
<li class="BL"><samp class="SANS_TheSansMonoCd_W5Regular_11">dcc.Markdown</samp> for formatting and displaying the intro text</li>
<li class="BL"><samp class="SANS_TheSansMonoCd_W5Regular_11">dbc.Card</samp> and <samp class="SANS_TheSansMonoCd_W5Regular_11">dcc.Slider</samp> components for setting the asset allocation percentages</li>
<li class="BL"><samp class="SANS_TheSansMonoCd_W5Regular_11">dbc.Input</samp>, <samp class="SANS_TheSansMonoCd_W5Regular_11">dbc.InputGroup</samp>, and <samp class="SANS_TheSansMonoCd_W5Regular_11">dbc.InputGroupText</samp> for making the form for entering the numeric data</li>
<li class="BL"><samp class="SANS_TheSansMonoCd_W5Regular_11">dbc.Tooltip</samp> for displaying additional data on hover</li>
</ul>
<p class="TX"><span aria-label=" Page 104. " epub:type="pagebreak" id="pg_104" role="doc-pagebreak"></span>In the Results tab, we use <samp class="SANS_TheSansMonoCd_W5Regular_11">DataTable</samp> to display the source data and results for visualization.</p>
<p class="HeadB"><a id="h2-32"></a><samp class="SANS_Futura_Std_Bold_Condensed_Oblique_I_11">Tabs</samp></p>
<p class="TNI">In Dash, the <samp class="SANS_TheSansMonoCd_W5Regular_11">Tabs</samp> component provides a convenient way to separate content into different panes. A user can click a tab to view the pane, and the best part is that the component automatically handles this navigation for us. All we need to do is define what content goes in each tab. <a href="chapter6.xhtml#fig6-6">Figure 6-6</a> shows the tabs in our app.</p>
<a id="fig6-6"></a>
<figure class="IMG"><img alt="" class="img50" height="76" src="../images/Figure6-6.png" width="485"/>
<figcaption><p class="CAP"><samp class="SANS_Futura_Std_Book_Oblique_I_11">Figure 6-6: The Asset Allocation Visualizer tabs</samp></p></figcaption>
</figure>
<p class="TX">The Learn tab has some text. The Play tab is the main control panel for the app, which allows the user to input their choices. The Results tab contains tables with details of the annual returns of the portfolio and the source data. This is the data that’s visualized in the second column.</p>
<p class="TX">In <samp class="SANS_TheSansMonoCd_W5Regular_11">app.layout</samp>, we included these tabs by simply including the variable name <samp class="SANS_TheSansMonoCd_W5Regular_11">tabs</samp> in the first column of the second row:</p>
<p class="_CodeSpaceAbove"><span class="gray"><samp class="SANS_TheSansMonoCd_W5Regular_Italic_I_11">--snip--</samp></span></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">   dbc.Row(</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">      [</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">        dbc.Col(tabs, width=</samp><samp class="SANS_TheSansMonoCd_W5Regular_11">12, lg=5, className="mt-4 border"),</samp></p>
<p class="_CodeSpaceBelow"><span class="gray"><samp class="SANS_TheSansMonoCd_W5Regular_Italic_I_11">--snip--</samp></span></p>
<p class="TX">We define our <samp class="SANS_TheSansMonoCd_W5Regular_11">tab</samp>s as shown in <a href="chapter6.xhtml#List6-3">Listing 6-3</a>.</p>
<a id="List6-3"></a>
<p class="_CodeSpaceAbove"><samp class="SANS_TheSansMonoCd_W5Regular_11">tabs = dbc.Tabs(</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">   [</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">      dbc.Tab(learn_card, tab_id="tab1", label="Learn"),</samp></p>
<p class="Code-ind"><samp class="SANS_TheSansMonoCd_W5Regular_11">   </samp><span aria-label="annotation1" class="SANS_NSAnnotations_Monospace_11">❶</span>  <samp class="SANS_TheSansMonoCd_W5Regular_11">dbc.Tab(</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11"><span class="mobi">     </span>        [asset_allocation_text, slider_card, input_groups,</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11"><span class="mobi">     </span>        time_period_card],</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11"><span class="mobi">     </span>        tab_id="tab-2",</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11"><span class="mobi">     </span>        label=</samp><samp class="SANS_TheSansMonoCd_W5Regular_11">"Play",</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11"><span class="mobi">     </span>        className="pb-4",</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">      ),</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">      dbc.Tab([results_card, data_source_card],</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11"><span class="mobi">     </span>        tab_id="tab-3", label="Results"),</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">   ],</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">   id="tabs",</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">   </samp><span aria-label="annotation2" class="SANS_NSAnnotations_Monospace_11">❷</span>  <samp class="SANS_TheSansMonoCd_W5Regular_11">active_tab="tab-2",</samp></p>
<p class="_CodeSpaceBelow"><samp class="SANS_TheSansMonoCd_W5Regular_11">)</samp></p>
<p class="CodeListingCaption"><samp class="SANS_Futura_Std_Book_Oblique_I_11">Listing 6-3: Defining the tabs</samp></p>
<p class="TX"><span aria-label=" Page 105. " epub:type="pagebreak" id="pg_105" role="doc-pagebreak"></span>We create a <samp class="SANS_TheSansMonoCd_W5Regular_11">tab</samp>s container with the <samp class="SANS_TheSansMonoCd_W5Regular_11">dbc.Tabs</samp> component, which holds our three separate <samp class="SANS_TheSansMonoCd_W5Regular_11">Tab</samp> panes. We give each <samp class="SANS_TheSansMonoCd_W5Regular_11">dbc.Tab</samp> the content to display, an ID, and a label that will be displayed on the screen. Take a look at the second <samp class="SANS_TheSansMonoCd_W5Regular_11">dbc.Tab</samp> <span aria-label="annotation1" class="SANS_NSAnnotations_Monospace_11">❶</span>, which is the Play tab depicted in <a href="chapter6.xhtml#fig6-7">Figure 6-7</a>, and you’ll see that the <samp class="SANS_TheSansMonoCd_W5Regular_11">children</samp> property includes a list of variable names that correspond to components we’ve defined separately in the components section of the code. <samp class="SANS_TheSansMonoCd_W5Regular_11">asset</samp>_<samp class="SANS_TheSansMonoCd_W5Regular_11">allocation_text</samp> contains the text of the introduction. <samp class="SANS_TheSansMonoCd_W5Regular_11">slider</samp>_<samp class="SANS_TheSansMonoCd_W5Regular_11">card</samp> contains the two <samp class="SANS_TheSansMonoCd_W5Regular_11">dcc</samp>.<samp class="SANS_TheSansMonoCd_W5Regular_11">Slider</samp>s where the user can set the allocation percentage between cash, stocks, and bonds. <samp class="SANS_TheSansMonoCd_W5Regular_11">input_groups</samp> defines the area for entering all user input: the starting dollar amount, number of years, and starting year. We use this input for calculating the investment returns. <samp class="SANS_TheSansMonoCd_W5Regular_11">time</samp>_<samp class="SANS_TheSansMonoCd_W5Regular_11">period</samp>_<samp class="SANS_TheSansMonoCd_W5Regular_11">card</samp> allows the user to select certain interesting periods, like the dot-com bubble or the Great Depression.</p>
<a id="fig6-7"></a>
<figure class="IMG"><img alt="" class="img50" height="592" src="../images/Figure6-7.png" width="314"/>
<figcaption><p class="CAP"><samp class="SANS_Futura_Std_Book_Oblique_I_11">Figure 6-7: The full content of the Play tab</samp></p></figcaption>
</figure>
<p class="TX">Now try moving the <samp class="SANS_TheSansMonoCd_W5Regular_11">asset_allocation_text</samp> variable name to the last item in the list. When you run the app with that change, you’ll see the intro text is moved to the bottom of the tab screen. This shows how easy it is to make design changes when using this technique for structuring the app. In the next section we’ll discuss in more detail how each section is defined.</p>
<p class="TX">The <samp class="SANS_TheSansMonoCd_W5Regular_11">active_tab</samp> property <span aria-label="annotation2" class="SANS_NSAnnotations_Monospace_11">❷</span> specifies the default tab to show when the app starts. By setting it to <samp class="SANS_TheSansMonoCd_W5Regular_11">2</samp>, we ensure that the app always opens on the Play tab.</p>
<p class="HeadB"><a id="h2-33"></a><span aria-label=" Page 106. " epub:type="pagebreak" id="pg_106" role="doc-pagebreak"></span><samp class="SANS_Futura_Std_Bold_Condensed_Oblique_I_11">Card Containers and Sliders</samp></p>
<p class="TNI">A Bootstrap <samp class="SANS_TheSansMonoCd_W5Regular_11">dbc.Card</samp> is a convenient container for related content. It’s typically a bordered box with padding and has options for headers, footers, and other content. We can also use Bootstrap utility classes to style and position cards easily.</p>
<p class="TX">We use <samp class="SANS_TheSansMonoCd_W5Regular_11">dbc.Card</samp> in several places in the app, but we’ll just examine the code for the card shown in <a href="chapter6.xhtml#fig6-8">Figure 6-8</a> as a representative example.</p>
<a id="fig6-8"></a>
<figure class="IMG"><img alt="" class="img50" height="199" src="../images/Figure6-8.png" width="473"/>
<figcaption><p class="CAP"><samp class="SANS_Futura_Std_Book_Oblique_I_11">Figure 6-8: An example dbc.Card</samp></p></figcaption>
</figure>
<p class="TX"><a href="chapter6.xhtml#List6-4">Listing 6-4</a> shows the code for the <samp class="SANS_TheSansMonoCd_W5Regular_11">Card</samp> component shown in <a href="chapter6.xhtml#fig6-6">Figure 6-6</a>.</p>
<a id="List6-4"></a>
<p class="_CodeSpaceAbove"><samp class="SANS_TheSansMonoCd_W5Regular_11">slider_card = dbc.Card(</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">   [</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">      html.H4("First set cash allocation %:", className="card-title"),</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">      dcc.Slider(</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">         id="cash",</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">         marks={i: f"{i}%" for i in range(0, 101, 10)},</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">         min=0,</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">         max=100,</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">         step=5,</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">         value=</samp><samp class="SANS_TheSansMonoCd_W5Regular_11">10,</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">         included=False,</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">      ),</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">      html.H4("Then set stock allocation % ", className="card-title mt-3",),</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">      html.Div("(The rest will be bonds)", className="card-title"),</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">      dcc.Slider(</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">         id="stock_bond",</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">         marks={i: f"{i}%" for i in range(0, 91, 10)},</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">         min=0,</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">         max=90,</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">         step=5,</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">         value=50,</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">         included=</samp><samp class="SANS_TheSansMonoCd_W5Regular_11">False,</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">      ),</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">   ],</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">   body=True,</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">   className="mt-4",</samp></p>
<p class="_CodeSpaceBelow"><samp class="SANS_TheSansMonoCd_W5Regular_11">)</samp></p>
<p class="CodeListingCaption"><samp class="SANS_Futura_Std_Book_Oblique_I_11">Listing 6-4: The allocation slider card</samp></p>
<p class="TX"><span aria-label=" Page 107. " epub:type="pagebreak" id="pg_107" role="doc-pagebreak"></span>For the slider label, we use the Dash component <samp class="SANS_TheSansMonoCd_W5Regular_11">html.H4</samp> to set a level 4 heading and the Bootstrap class <samp class="SANS_TheSansMonoCd_W5Regular_11">card-title</samp> to set consistent spacing for the selected theme.</p>
<p class="TX"><samp class="SANS_TheSansMonoCd_W5Regular_11">dcc.Slider</samp> is a Dash Core component. In <span class="Xref"><a href="chapter5.xhtml">Chapter 5</a></span> we saw <samp class="SANS_TheSansMonoCd_W5Regular_11">dcc.RangeSlider</samp>, which allows the user to select the start and end values of a range. <samp class="SANS_TheSansMonoCd_W5Regular_11">dcc.Slider</samp> is similar, but only allows you to select a single value. We give the slider an <samp class="SANS_TheSansMonoCd_W5Regular_11">id</samp> that we can reference in a callback, and we set the initial settings for <samp class="SANS_TheSansMonoCd_W5Regular_11">marks</samp>, <samp class="SANS_TheSansMonoCd_W5Regular_11">min</samp>, <samp class="SANS_TheSansMonoCd_W5Regular_11">max</samp>, <samp class="SANS_TheSansMonoCd_W5Regular_11">step</samp>, and <samp class="SANS_TheSansMonoCd_W5Regular_11">value</samp> to select on the slider. These are the defaults you see when the app starts.</p>
<p class="TX">The <samp class="SANS_TheSansMonoCd_W5Regular_11">included</samp> property sets the style of the slider rail. By default, the sections of the slider rail before the slider handle are highlighted. However, for our use we are specifying a discrete value, so it makes sense to only highlight the value and not a range. We do this by setting <samp class="SANS_TheSansMonoCd_W5Regular_11">included=False</samp>.</p>
<p class="TX">Look for other cards in the app and you will see that they are constructed in a similar way but hold different components, such as <samp class="SANS_TheSansMonoCd_W5Regular_11">dbc.RadioItems</samp>, <samp class="SANS_TheSansMonoCd_W5Regular_11">dbc.InputGroup</samp>, and <samp class="SANS_TheSansMonoCd_W5Regular_11">dcc.Markdown</samp>.</p>
<p class="HeadB"><a id="h2-34"></a><samp class="SANS_Futura_Std_Bold_Condensed_Oblique_I_11">Input Containers</samp></p>
<p class="TNI">The <samp class="SANS_TheSansMonoCd_W5Regular_11">dbc.Input</samp> component handles user input, and <samp class="SANS_TheSansMonoCd_W5Regular_11">dbc.InputGroup</samp> is a container that enhances <samp class="SANS_TheSansMonoCd_W5Regular_11">dbc.Input</samp> with more features, such as icons, text, buttons, and dropdown menus.</p>
<p class="TX"><a href="chapter6.xhtml#fig6-9">Figure 6-9</a> shows how we use <samp class="SANS_TheSansMonoCd_W5Regular_11">dbc.InputGroup</samp> in our app to create a form with the variable name <samp class="SANS_TheSansMonoCd_W5Regular_11">input_groups</samp>.</p>
<a id="fig6-9"></a>
<figure class="IMG"><img alt="" class="img50" height="260" src="../images/Figure6-9.png" width="523"/>
<figcaption><p class="CAP"><samp class="SANS_Futura_Std_Book_Oblique_I_11">Figure 6-9: Input form</samp></p></figcaption>
</figure>
<p class="TX">Each line is one <samp class="SANS_TheSansMonoCd_W5Regular_11">dbc.InputGroup</samp> item, so here we have five items together in one container. In this case, rather than use a <samp class="SANS_TheSansMonoCd_W5Regular_11">Card</samp> as a container, we use an <samp class="SANS_TheSansMonoCd_W5Regular_11">html.Div</samp> container, simply because it doesn’t have a border and padding by default. Here’s the containing <samp class="SANS_TheSansMonoCd_W5Regular_11">Div</samp>:</p>
<p class="_CodeSpaceAbove"><samp class="SANS_TheSansMonoCd_W5Regular_11">input_groups = html.Div(</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">   [start_amount, start_year, number_of_years, end_amount, rate_of_return],</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">   className="mt-4 p-4",</samp></p>
<p class="_CodeSpaceBelow"><samp class="SANS_TheSansMonoCd_W5Regular_11">)</samp></p>
<p class="TX"><span aria-label=" Page 108. " epub:type="pagebreak" id="pg_108" role="doc-pagebreak"></span>We define each <samp class="SANS_TheSansMonoCd_W5Regular_11">InputGroup</samp> item separately and add it to the <samp class="SANS_TheSansMonoCd_W5Regular_11">html.Div</samp> container. Each item is quite similar, so we will just look at a couple of them in detail. Here we define the second item, the “Start Year”:</p>
<p class="_CodeSpaceAbove"><samp class="SANS_TheSansMonoCd_W5Regular_11">start_year = dbc.InputGroup(</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">   [</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">      dbc.InputGroupText("Start Year"),</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">      dbc.Input(</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">         id="start_yr",</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">         placeholder=f"min {MIN_YR}  max {MAX_YR}",</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">         type="number",</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">         min=</samp><samp class="SANS_TheSansMonoCd_W5Regular_11">MIN_YR,</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">         max=MAX_YR,</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">         value=START_YR,</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">      ),</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">   ],</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">   className="mb-3",</samp></p>
<p class="_CodeSpaceBelow"><samp class="SANS_TheSansMonoCd_W5Regular_11">)</samp></p>
<p class="TX">You use the <samp class="SANS_TheSansMonoCd_W5Regular_11">dbc.InputGroupText</samp> component to add text before, after, or on both sides of an input field. This makes forms look more attractive. For example, here we use <samp class="SANS_TheSansMonoCd_W5Regular_11">dbc.InputGroupText("Start Year")</samp> to display the text “Start Year” before the <samp class="SANS_TheSansMonoCd_W5Regular_11">dbc.Input</samp>.</p>
<p class="TX">We set <samp class="SANS_TheSansMonoCd_W5Regular_11">min</samp> and <samp class="SANS_TheSansMonoCd_W5Regular_11">max</samp>, props of <samp class="SANS_TheSansMonoCd_W5Regular_11">dbc.Input</samp>, to give an accepted range of values, and <samp class="SANS_TheSansMonoCd_W5Regular_11">type</samp> to only accept numbers; this helps with data validation. For the values for <samp class="SANS_TheSansMonoCd_W5Regular_11">min</samp> and <samp class="SANS_TheSansMonoCd_W5Regular_11">max</samp> we use the <samp class="SANS_TheSansMonoCd_W5Regular_11">MIN_YR</samp> and <samp class="SANS_TheSansMonoCd_W5Regular_11">MAX_YR</samp> global variables we discussed earlier. The <samp class="SANS_TheSansMonoCd_W5Regular_11">placeholder</samp> will show helpful information about the valid range if the input field is empty. Because we use our global variables when we update the datafile, we won’t have to make any changes to this component for the new date range.</p>
<p class="TX">The last two <samp class="SANS_TheSansMonoCd_W5Regular_11">InputGroup</samp> items are not actually used for input, but rather to show some results. We set <samp class="SANS_TheSansMonoCd_W5Regular_11">disabled=True</samp> so that nothing can be entered, and we set the background color to gray to differentiate the items. In the callback we’ll update this field with the investment results. It may seem odd to use an input component as an output field, but doing it like this gives the group a consistent look. Plus, in the future we may decide to allow input data here. For example, the user could enter the ending dollar amount and see how much would need to be invested, and for how long, to reach that goal in different market conditions. The code for the <samp class="SANS_TheSansMonoCd_W5Regular_11">rate_of_return</samp> input group looks like this:</p>
<p class="_CodeSpaceAbove"><samp class="SANS_TheSansMonoCd_W5Regular_11">rate_of_return =</samp> <samp class="SANS_TheSansMonoCd_W5Regular_11">dbc.InputGroup(</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">   [</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">      dbc.InputGroupText(</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">         "Rate of Return(CAGR)",</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">         id="tooltip_target",</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">         className="text-decoration-underline",</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">      ),</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">      dbc.Input(id="cagr", disabled=True, className="text-black"),</samp></p>
<p class="Code"><span aria-label=" Page 109. " epub:type="pagebreak" id="pg_109" role="doc-pagebreak"></span><samp class="SANS_TheSansMonoCd_W5Regular_11">      dbc.Tooltip(cagr_text, target="tooltip_target")</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">   ],</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">   className="mb-3",</samp></p>
<p class="_CodeSpaceBelow"><samp class="SANS_TheSansMonoCd_W5Regular_11">)</samp></p>
<p class="HeadB"><a id="h2-35"></a><samp class="SANS_Futura_Std_Bold_Condensed_Oblique_I_11">Tool Tips</samp></p>
<p class="TNI"><i>Tool tips</i> are textual hints that appear when the user hovers their mouse over a component, as shown in <a href="chapter6.xhtml#fig6-10">Figure 6-10</a>. To add them we use the <samp class="SANS_TheSansMonoCd_W5Regular_11">dbc.Tooltip</samp> component and style it with Bootstrap. You just need to specify the <samp class="SANS_TheSansMonoCd_W5Regular_11">Tooltip</samp>’s <samp class="SANS_TheSansMonoCd_W5Regular_11">target id</samp>—no callback required! We use this in the app to provide a definition of CAGR, since it’s a term many people are not familiar with. The snippet at the end of the preceding section shows the code for the <samp class="SANS_TheSansMonoCd_W5Regular_11">Tooltip</samp> in the <samp class="SANS_TheSansMonoCd_W5Regular_11">rate_of_return</samp> input group.</p>
<a id="fig6-10"></a>
<figure class="IMG"><img alt="" class="img50" height="483" src="../images/Figure6-10.png" width="585"/>
<figcaption><p class="CAP"><samp class="SANS_Futura_Std_Book_Oblique_I_11">Figure 6-10: Tool tip example</samp></p></figcaption>
</figure>
<p class="HeadB"><a id="h2-36"></a><samp class="SANS_Futura_Std_Bold_Condensed_Oblique_I_11">Data Tables</samp></p>
<p class="TNI">The <samp class="SANS_TheSansMonoCd_W5Regular_11">DataTable</samp> is an interactive table for viewing, editing, and exploring large datasets. This app uses only a small portion of its capabilities, so be sure to check out the Dash documentation to see more examples of how to use this powerful tool. We use a <samp class="SANS_TheSansMonoCd_W5Regular_11">DataTable</samp> to show the <samp class="SANS_TheSansMonoCd_W5Regular_11">total</samp>_<samp class="SANS_TheSansMonoCd_W5Regular_11">returns</samp>_<samp class="SANS_TheSansMonoCd_W5Regular_11">table</samp> in the Results tab, shown in <a href="chapter6.xhtml#fig6-11">Figure 6-11</a>.</p>
<span aria-label=" Page 110. " epub:type="pagebreak" id="pg_110" role="doc-pagebreak"></span><a id="fig6-11"></a>
<figure class="IMG"><img alt="" class="img70" height="574" src="../images/Figure6-11.png" width="687"/>
<figcaption><p class="CAP"><samp class="SANS_Futura_Std_Book_Oblique_I_11">Figure 6-11: The full Results tab</samp></p></figcaption>
</figure>
<p class="TX"><a href="chapter6.xhtml#List6-5">Listing 6-5</a> shows the code for the <samp class="SANS_TheSansMonoCd_W5Regular_11">DataTable</samp>.</p>
<a id="List6-5"></a>
<p class="_CodeWideSpaceAbove"><samp class="SANS_TheSansMonoCd_W5Regular_11">total_returns_table = dash_table.DataTable(</samp></p>
<p class="CodeWide"><samp class="SANS_TheSansMonoCd_W5Regular_11">   id="total_returns",</samp></p>
<p class="CodeWide"><samp class="SANS_TheSansMonoCd_W5Regular_11">   columns=[{"id": "Year", "name": "Year", "type": "text"}]</samp></p>
<p class="CodeWide"><samp class="SANS_TheSansMonoCd_W5Regular_11">   + [</samp></p>
<p class="CodeWide"><samp class="SANS_TheSansMonoCd_W5Regular_11">        </samp><samp class="SANS_TheSansMonoCd_W5Regular_11">{"id": col, "name": col, "type": "numeric", "format": {"specifier": "$,.0f"}}</samp></p>
<p class="CodeWide"><samp class="SANS_TheSansMonoCd_W5Regular_11">        </samp><samp class="SANS_TheSansMonoCd_W5Regular_11">for col in ["Cash", "Bonds", "Stocks", "Total"]</samp></p>
<p class="CodeWide"><samp class="SANS_TheSansMonoCd_W5Regular_11">   ],</samp></p>
<p class="CodeWide"><samp class="SANS_TheSansMonoCd_W5Regular_11">   page_size=15,</samp></p>
<p class="CodeWide"><samp class="SANS_TheSansMonoCd_W5Regular_11">   style_table={"overflowX": "scroll"},</samp></p>
<p class="_CodeWideSpacebelow"><samp class="SANS_TheSansMonoCd_W5Regular_11">)</samp></p>
<p class="CodeListingCaptionWide"><samp class="SANS_Futura_Std_Book_Oblique_I_11">Listing 6-5: Code for the DataTable shown in <a href="chapter6.xhtml#fig6-11">Figure 6-11</a></samp></p>
<p class="TX">Like other elements in our app, we assign the <samp class="SANS_TheSansMonoCd_W5Regular_11">DataTable</samp> to a variable to make it easy to call in the layout.</p>
<p class="TX">We use the following component properties to define our table:</p>
<ul class="List-1">
<li class="BL">The table <samp class="SANS_TheSansMonoCd_W5Regular_11">id</samp> is <samp class="SANS_TheSansMonoCd_W5Regular_11">"total_returns"</samp>; we use this to identify this component in a callback.</li>
<li class="BL">The column <samp class="SANS_TheSansMonoCd_W5Regular_11">id</samp> matches the column name of our pandas DataFrame, which is what we use to update the data in the cells of the table.</li>
<li class="BL">The column <samp class="SANS_TheSansMonoCd_W5Regular_11">name</samp> is the text displayed in the column header.</li>
<li class="BL"><span aria-label=" Page 111. " epub:type="pagebreak" id="pg_111" role="doc-pagebreak"></span>The column <samp class="SANS_TheSansMonoCd_W5Regular_11">type</samp> sets the data type to either <samp class="SANS_TheSansMonoCd_W5Regular_11">text</samp> or <samp class="SANS_TheSansMonoCd_W5Regular_11">numeric</samp>.</li>
<li class="BL"><samp class="SANS_TheSansMonoCd_W5Regular_11">"format": {"specifier": "$,.0f"}</samp> formats the cells with a dollar sign (<samp class="SANS_TheSansMonoCd_W5Regular_11">$</samp>) and zero (<samp class="SANS_TheSansMonoCd_W5Regular_11">0</samp>) decimals so that the data is displayed in whole dollars. Note that the data <samp class="SANS_TheSansMonoCd_W5Regular_11">type</samp> must be <samp class="SANS_TheSansMonoCd_W5Regular_11">numeric</samp> for the formatting to be applied correctly.</li>
<li class="BL">The <samp class="SANS_TheSansMonoCd_W5Regular_11">page_size</samp> prop controls the table height and adds the pagination buttons at the bottom of the table. We set it to <samp class="SANS_TheSansMonoCd_W5Regular_11">15</samp> to display 15 rows per page. The <samp class="SANS_TheSansMonoCd_W5Regular_11">style_table={"overflowX": "scroll"}</samp> syntax controls the width by adding a scroll bar if the table would otherwise overflow the parent container.</li>
</ul>
<p class="HeadB"><a id="h2-37"></a><samp class="SANS_Futura_Std_Bold_Condensed_Oblique_I_11">Content Tables</samp></p>
<p class="TNI">The <samp class="SANS_TheSansMonoCd_W5Regular_11">dbc.Table</samp> component is a great way to style basic HTML tables with a Bootstrap theme. HTML tables are convenient when you have just a few items to display, and they can contain other Dash components such as <samp class="SANS_TheSansMonoCd_W5Regular_11">dcc.Graph</samp> or <samp class="SANS_TheSansMonoCd_W5Regular_11">dbc.Button</samp> as content. It’s not possible to do that today with a Dash <samp class="SANS_TheSansMonoCd_W5Regular_11">DataTable</samp>.</p>
<p class="TX">We use a <samp class="SANS_TheSansMonoCd_W5Regular_11">dbc.Table</samp> in the app for the summary table shown in <a href="chapter6.xhtml#fig6-12">Figure 6-12</a>. This allows us to include Dash components and use the FontAwesome icons in the summary table.</p>
<a id="fig6-12"></a>
<figure class="IMG"><img alt="" class="img90" height="187" src="../images/Figure6-12.png" width="694"/>
<figcaption><p class="CAP"><samp class="SANS_Futura_Std_Book_Oblique_I_11">Figure 6-12: Summary table from the Asset Allocation Visualizer app</samp></p></figcaption>
</figure>
<p class="TX"><a href="chapter6.xhtml#List6-6">Listing 6-6</a> shows a portion of the code, but the big picture is that we create this table with a function.</p>
<a id="List6-6"></a>
<p class="_CodeSpaceAbove"><samp class="SANS_TheSansMonoCd_W5Regular_11">def make_summary_table(dff):</samp></p>
<p class="Code"><span class="gray"><samp class="SANS_TheSansMonoCd_W5Regular_11">   # Create new dataframe with info to include in the table</samp></span></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">   df_table = pd.DataFrame(…)</samp></p>
<p class="_CodeSpaceBelow"><samp class="SANS_TheSansMonoCd_W5Regular_11">   return dbc.Table.from_dataframe (df_table, bordered=True, hover=True)</samp></p>
<p class="CodeListingCaption"><samp class="SANS_Futura_Std_Book_Oblique_I_11">Listing 6-6: An excerpt from the summary table code</samp></p>
<p class="TX">We’ll use this function in a callback later in the chapter. The function argument is a DataFrame created from the user’s input. Then we make another DataFrame that contains only the information we want to display in the summary table. We use the dash-bootstrap-components helper function <samp class="SANS_TheSansMonoCd_W5Regular_11">dbc.Table.from_dataframe()</samp> to build the HTML table.</p>
<p class="HeadB"><a id="h2-38"></a><span aria-label=" Page 112. " epub:type="pagebreak" id="pg_112" role="doc-pagebreak"></span><samp class="SANS_Futura_Std_Bold_Condensed_Oblique_I_11">Markdown Text</samp></p>
<p class="TNI"><i>Markdown</i> is a markup language for formatting text for web pages, and it is one of the most popular ways to add and format text with boldface, italics, headers, lists, and more. To learn more about Markdown syntax, check out the tutorial at <a href="https://commonmark.org/help"><i>https://<wbr/>commonmark<wbr/>.org<wbr/>/help</i></a>.</p>
<p class="TX">We use the <samp class="SANS_TheSansMonoCd_W5Regular_11">dcc.Markdown</samp> component to add formatted text to apps. In this app, we use it to add the description of asset allocation shown in <a href="chapter6.xhtml#fig6-13">Figure 6-13</a>. Markdown syntax uses <samp class="SANS_TheSansMonoCd_W5Regular_11">**</samp> to highlight some text and <samp class="SANS_TheSansMonoCd_W5Regular_11">&gt;</samp> to format the text as a blockquote.</p>
<a id="fig6-13"></a>
<figure class="IMG"><img alt="" class="img70" height="241" src="../images/Figure6-13.png" width="585"/>
<figcaption><p class="CAP"><samp class="SANS_Futura_Std_Book_Oblique_I_11">Figure 6-13: Adding text with Markdown</samp></p></figcaption>
</figure>
<p class="TX">Here’s the code for the <samp class="SANS_TheSansMonoCd_W5Regular_11">Markdown</samp> component:</p>
<p class="_CodeWideSpaceAbove"><samp class="SANS_TheSansMonoCd_W5Regular_11">asset_allocation_text = dcc.Markdown(</samp></p>
<p class="CodeWide"><samp class="SANS_TheSansMonoCd_W5Regular_11">   " ""</samp></p>
<p class="CodeWide"><samp class="SANS_TheSansMonoCd_W5Regular_11">&gt; **Asset allocation** is one of the main factors that drive portfolio risk and returns. Play with the app and see for yourself!</samp></p>
<p class="CodeWide"><samp class="SANS_TheSansMonoCd_W5Regular_11">&gt; Change the allocation to cash, bonds and stocks on the sliders and see how your portfolio performs over time in the graph.</samp></p>
<p class="CodeWide"><samp class="SANS_TheSansMonoCd_W5Regular_11">   Try entering different time periods and dollar amounts too.</samp></p>
<p class="CodeWide"><samp class="SANS_TheSansMonoCd_W5Regular_11">" ""</samp></p>
<p class="_CodeWideSpacebelow"><samp class="SANS_TheSansMonoCd_W5Regular_11">)</samp></p>
<p class="TX">We need to take one more step to make the blockquote appear the way it does in the app. A <i>blockquote</i> is typically an extended quote from a different source, but it can also be used to repeat or highlight certain content. A blockquote usually has an additional margin or padding, or other formatting to make it stand out, which is why we chose it for this particular situation.</p>
<p class="TX">The default style for a blockquote in Bootstrap is:</p>
<p class="_CodeSpaceAbove"><samp class="SANS_TheSansMonoCd_W5Regular_11">blockquote {</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">   margin: 0 0 1rem;</samp></p>
<p class="_CodeSpaceBelow"><samp class="SANS_TheSansMonoCd_W5Regular_11">}</samp></p>
<p class="TX">This gives no margin on the top or the right, and just <samp class="SANS_TheSansMonoCd_W5Regular_11">1rem</samp> on the bottom. (A <i>rem</i> is the font size of the root element and is often 16 pixels.) This doesn’t really make the text stand out, so we add a little more margin and some color, like so:</p>
<p class="_CodeSpaceAbove"><span aria-label=" Page 113. " epub:type="pagebreak" id="pg_113" role="doc-pagebreak"></span><samp class="SANS_TheSansMonoCd_W5Regular_11">blockquote {</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">   border-left: 4px var(--bs-primary) solid;</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">   padding-left: 1rem;</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">   margin-top: 2rem;</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">   margin-bottom: 2rem;</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">   margin-left: 0rem;</samp></p>
<p class="_CodeSpaceBelow"><samp class="SANS_TheSansMonoCd_W5Regular_11">}</samp></p>
<p class="TX">This adds a left border that is four pixels wide and matches the color to the header and footer. It also adds a little more margin and padding. Here’s a CSS trick that comes in handy when you use Bootstrap: instead of specifying a color using a hex number, like #446e9b, you can use a Bootstrap color name, like this: <samp class="SANS_TheSansMonoCd_W5Regular_11">var(--bs-primary)</samp>. This code will match the color to the Bootstrap theme’s “primary” color. If you change the Bootstrap theme in the app, this blockquote’s left margin color will update automatically to the primary color of that theme, to keep everything in the app looking consistent.</p>
<p class="TX">This custom CSS is saved in a file named <i>mycss.css</i> in the <i>assets</i> folder. You can name the file anything you like as long as it has the <i>.css</i> extension, and Dash will automatically include this custom CSS in the app.</p>
</section>
<section aria-labelledby="sec7" epub:type="division">
<h3 class="H1" id="sec7"><a id="h1-42"></a><samp class="SANS_Futura_Std_Bold_B_11">Pie Chart Using Plotly Graph Objects</samp></h3>
<p class="TNI">This is a very brief introduction to creating figures with Plotly Graph Objects, which provides more sophisticated options for creating graphs and charts than the simpler Plotly Express. The app’s pie chart, shown in <a href="chapter6.xhtml#fig6-14">Figure 6-14</a>, updates the asset allocation in real time as the user moves the slider handles.</p>
<a id="fig6-14"></a>
<figure class="IMG"><img alt="" class="img70" height="306" src="../images/Figure6-14.png" width="522"/>
<figcaption><p class="CAP"><samp class="SANS_Futura_Std_Book_Oblique_I_11">Figure 6-14: Example of a Plotly pie chart</samp></p></figcaption>
</figure>
<p class="TX">Rather than using Plotly Express to make the figures, like we did in previous chapters, here we use Plotly Graph Objects. Plotly Express preconfigures many of the common parameters so that you can make charts quickly and with less code. However, when you want to do more customization, you <span aria-label=" Page 114. " epub:type="pagebreak" id="pg_114" role="doc-pagebreak"></span>may prefer to use Plotly Graph Objects instead. <a href="chapter6.xhtml#List6-7">Listing 6-7</a> shows the code for creating the pie chart.</p>
<a id="List6-7"></a>
<p class="_CodeWideSpaceAbove"><samp class="SANS_TheSansMonoCd_W5Regular_11">def make_pie(slider_input, title):</samp></p>
<p class="CodeWide"><samp class="SANS_TheSansMonoCd_W5Regular_11">   fig = go.Figure(</samp></p>
<p class="CodeWide"><samp class="SANS_TheSansMonoCd_W5Regular_11">      data=[</samp></p>
<p class="CodeWide"><samp class="SANS_TheSansMonoCd_W5Regular_11">         go.Pie(</samp><span aria-label="annotation1" class="SANS_NSAnnotations_Monospace_11">❶</span></p>
<p class="CodeWide"><samp class="SANS_TheSansMonoCd_W5Regular_11">            </samp><samp class="SANS_TheSansMonoCd_W5Regular_11">labels=["Cash", "Bonds", "Stocks"],</samp></p>
<p class="CodeWide"><samp class="SANS_TheSansMonoCd_W5Regular_11">            </samp><samp class="SANS_TheSansMonoCd_W5Regular_11">values=slider_input,</samp></p>
<p class="CodeWide"><samp class="SANS_TheSansMonoCd_W5Regular_11">            </samp><samp class="SANS_TheSansMonoCd_W5Regular_11">textinfo="label+</samp><samp class="SANS_TheSansMonoCd_W5Regular_11">percent",</samp></p>
<p class="CodeWide"><samp class="SANS_TheSansMonoCd_W5Regular_11">            </samp><samp class="SANS_TheSansMonoCd_W5Regular_11">textposition="inside",</samp></p>
<p class="CodeWide"><samp class="SANS_TheSansMonoCd_W5Regular_11">            </samp><samp class="SANS_TheSansMonoCd_W5Regular_11">marker={"colors": [COLORS["cash"], COLORS["bonds"], COLORS["stocks"]]},</samp> <span aria-label="annotation2" class="SANS_NSAnnotations_Monospace_11">❷</span></p>
<p class="_CodeWideSpace"><samp class="SANS_TheSansMonoCd_W5Regular_11">          </samp><samp class="SANS_TheSansMonoCd_W5Regular_11">  </samp><samp class="SANS_TheSansMonoCd_W5Regular_11">sort=False,</samp> <span aria-label="annotation3" class="SANS_NSAnnotations_Monospace_11">❸</span></p>
<p class="CodeWide"><samp class="SANS_TheSansMonoCd_W5Regular_11">            </samp><samp class="SANS_TheSansMonoCd_W5Regular_11">hoverinfo="none",</samp></p>
<p class="CodeWide"><samp class="SANS_TheSansMonoCd_W5Regular_11">         )</samp></p>
<p class="CodeWide"><samp class="SANS_TheSansMonoCd_W5Regular_11">      </samp><samp class="SANS_TheSansMonoCd_W5Regular_11">]</samp></p>
<p class="CodeWide"><samp class="SANS_TheSansMonoCd_W5Regular_11">   )</samp></p>
<p class="CodeWide"><samp class="SANS_TheSansMonoCd_W5Regular_11">   fig.update_layout(</samp></p>
<p class="CodeWide"><samp class="SANS_TheSansMonoCd_W5Regular_11">      </samp><samp class="SANS_TheSansMonoCd_W5Regular_11">title_text=title,</samp></p>
<p class="CodeWide"><samp class="SANS_TheSansMonoCd_W5Regular_11">      </samp><samp class="SANS_TheSansMonoCd_W5Regular_11">title_x=0.5,</samp></p>
<p class="CodeWide"><samp class="SANS_TheSansMonoCd_W5Regular_11">      </samp><samp class="SANS_TheSansMonoCd_W5Regular_11">margin=dict(b=</samp><samp class="SANS_TheSansMonoCd_W5Regular_11">25, t=75, l=35, r=25),</samp></p>
<p class="CodeWide"><samp class="SANS_TheSansMonoCd_W5Regular_11">      </samp><samp class="SANS_TheSansMonoCd_W5Regular_11">height=325,</samp></p>
<p class="CodeWide"><samp class="SANS_TheSansMonoCd_W5Regular_11">      </samp><samp class="SANS_TheSansMonoCd_W5Regular_11">paper_bgcolor=COLORS["background"],</samp></p>
<p class="CodeWide"><samp class="SANS_TheSansMonoCd_W5Regular_11">   )</samp></p>
<p class="_CodeWideSpacebelow"><samp class="SANS_TheSansMonoCd_W5Regular_11">   return fig</samp></p>
<p class="CodeListingCaptionWide"><samp class="SANS_Futura_Std_Book_Oblique_I_11">Listing 6-7: Creating a Plotly Graph Objects pie chart</samp></p>
<p class="TX">To create our pie chart, we start by creating a graph instance with <samp class="SANS_TheSansMonoCd_W5Regular_11">fig</samp> <samp class="SANS_TheSansMonoCd_W5Regular_11">=</samp> <samp class="SANS_TheSansMonoCd_W5Regular_11">go.Figure</samp>. The <samp class="SANS_TheSansMonoCd_W5Regular_11">Figure</samp> syntax here refers to one of the primary classes defined in the <samp class="SANS_TheSansMonoCd_W5Regular_11">plotly.graph_objects</samp> module (typically imported as <samp class="SANS_TheSansMonoCd_W5Regular_11">go</samp>), and represents the entire figure. We use this class because instances of the class come bundled with many convenient methods for manipulating their attributes, including <samp class="SANS_TheSansMonoCd_W5Regular_11">.update.layout()</samp> and <samp class="SANS_TheSansMonoCd_W5Regular_11">.add.trace()</samp>. In fact, Plotly Express functions use graph objects and return a <samp class="SANS_TheSansMonoCd_W5Regular_11">plotly.graph_objects.Figure</samp> instance.</p>
<p class="TX">The pie chart object in Plotly Graph Objects is <samp class="SANS_TheSansMonoCd_W5Regular_11">go.Pie</samp> <span aria-label="annotation1" class="SANS_NSAnnotations_Monospace_11">❶</span>, and it allows us to easily set custom colors for each segment. Note that here we are using the <samp class="SANS_TheSansMonoCd_W5Regular_11">COLORS</samp> dictionary as a global variable <span aria-label="annotation2" class="SANS_NSAnnotations_Monospace_11">❷</span> rather than setting colors for the <samp class="SANS_TheSansMonoCd_W5Regular_11">marker</samp> directly. This means that if we decide to change the colors later, we only have to update the code in the <samp class="SANS_TheSansMonoCd_W5Regular_11">COLORS</samp> dictionary and not the code in this figure. In our app we want the color for each asset to stay the same, even if the values change. We do this by setting <samp class="SANS_TheSansMonoCd_W5Regular_11">sort=False</samp> <span aria-label="annotation3" class="SANS_NSAnnotations_Monospace_11">❸</span>. (The default is <samp class="SANS_TheSansMonoCd_W5Regular_11">True</samp> and will sort the values in descending order, so the largest value will always have the same color.)</p>
<p class="TX">As with the table in <a href="chapter6.xhtml#List6-6">Listing 6-6</a>, we create this pie chart in a function so that we can update it in a callback. The input arguments are the values of the sliders and the title.</p>
</section>
<section aria-labelledby="sec8" epub:type="division">
<h3 class="H1" id="sec8"><a id="h1-43"></a><span aria-label=" Page 115. " epub:type="pagebreak" id="pg_115" role="doc-pagebreak"></span><samp class="SANS_Futura_Std_Bold_B_11">Line Chart Using Plotly Graph Objects</samp></h3>
<p class="TNI">We will again use Plotly Graph Objects for our line chart, to allow us to customize the colors and markers for each trace—which would be fairly verbose using Plotly Express.</p>
<p class="TX">Again, we create the line chart in a function and input a DataFrame as the argument. This DataFrame is based on user selections: the asset allocation, time period, starting amount, and number of years. You will learn how this DataFrame is created in a callback later in this chapter. <a href="chapter6.xhtml#fig6-15">Figure 6-15</a> shows the line chart.</p>
<a id="fig6-15"></a>
<figure class="IMG"><img alt="" class="img70" height="345" src="../images/Figure6-15.png" width="692"/>
<figcaption><p class="CAP"><samp class="SANS_Futura_Std_Book_Oblique_I_11">Figure 6-15: Example of a Plotly line chart</samp></p></figcaption>
</figure>
<p class="TX"><a href="chapter6.xhtml#List6-8">Listing 6-8</a> gives the code for the line chart.</p>
<a id="List6-8"></a>
<p class="_CodeWideSpaceAbove"><samp class="SANS_TheSansMonoCd_W5Regular_11">def make_line_chart(dff):</samp></p>
<p class="CodeWide"><samp class="SANS_TheSansMonoCd_W5Regular_11">   start = dff.loc[1, "Year"]</samp></p>
<p class="CodeWide"><samp class="SANS_TheSansMonoCd_W5Regular_11">   yrs = dff["Year"].size - 1</samp></p>
<p class="CodeWide"><samp class="SANS_TheSansMonoCd_W5Regular_11">   dtick = 1 if yrs &lt;</samp> <samp class="SANS_TheSansMonoCd_W5Regular_11">16 else 2 if yrs in range(16, 30) else 5</samp></p>
<p class="_CodeWideSpace"><samp class="SANS_TheSansMonoCd_W5Regular_11">   fig = go.Figure()</samp> <span aria-label="annotation1" class="SANS_NSAnnotations_Monospace_11">❶</span></p>
<p class="CodeWide"><samp class="SANS_TheSansMonoCd_W5Regular_11">   fig.add_trace(</samp></p>
<p class="CodeWide"><samp class="SANS_TheSansMonoCd_W5Regular_11">      </samp><samp class="SANS_TheSansMonoCd_W5Regular_11">go.Scatter(</samp></p>
<p class="CodeWide"><samp class="SANS_TheSansMonoCd_W5Regular_11">        </samp><samp class="SANS_TheSansMonoCd_W5Regular_11">x=dff["Year"],</samp></p>
<p class="CodeWide"><samp class="SANS_TheSansMonoCd_W5Regular_11">        </samp><samp class="SANS_TheSansMonoCd_W5Regular_11">y=dff["all_cash"],</samp></p>
<p class="CodeWide"><samp class="SANS_TheSansMonoCd_W5Regular_11">        </samp><samp class="SANS_TheSansMonoCd_W5Regular_11">name="All Cash",</samp></p>
<p class="CodeWide"><samp class="SANS_TheSansMonoCd_W5Regular_11">        </samp><samp class="SANS_TheSansMonoCd_W5Regular_11">marker_color=COLORS["cash"],</samp></p>
<p class="CodeWide"><samp class="SANS_TheSansMonoCd_W5Regular_11">      </samp><samp class="SANS_TheSansMonoCd_W5Regular_11">)</samp></p>
<p class="CodeWide"><samp class="SANS_TheSansMonoCd_W5Regular_11">   )</samp></p>
<p class="CodeWide"><samp class="SANS_TheSansMonoCd_W5Regular_11">   fig.add_trace(</samp></p>
<p class="CodeWide"><samp class="SANS_TheSansMonoCd_W5Regular_11">      </samp><samp class="SANS_TheSansMonoCd_W5Regular_11">go.Scatter(</samp></p>
<p class="CodeWide"><samp class="SANS_TheSansMonoCd_W5Regular_11">        </samp><samp class="SANS_TheSansMonoCd_W5Regular_11">x=dff["Year"],</samp></p>
<p class="CodeWide"><samp class="SANS_TheSansMonoCd_W5Regular_11">        </samp><samp class="SANS_TheSansMonoCd_W5Regular_11">y=dff["all_bonds"],</samp></p>
<p class="CodeWide"><samp class="SANS_TheSansMonoCd_W5Regular_11">        </samp><samp class="SANS_TheSansMonoCd_W5Regular_11">name="All Bonds (10yr T.Bonds)",</samp></p>
<p class="CodeWide"><span aria-label=" Page 116. " epub:type="pagebreak" id="pg_116" role="doc-pagebreak"></span><samp class="SANS_TheSansMonoCd_W5Regular_11">        </samp><samp class="SANS_TheSansMonoCd_W5Regular_11">marker_color=</samp><samp class="SANS_TheSansMonoCd_W5Regular_11">COLORS["bonds"],</samp></p>
<p class="CodeWide"><samp class="SANS_TheSansMonoCd_W5Regular_11">      </samp><samp class="SANS_TheSansMonoCd_W5Regular_11">)</samp></p>
<p class="CodeWide"><samp class="SANS_TheSansMonoCd_W5Regular_11">   )</samp></p>
<p class="_CodeWideSpace"><span class="gray"><samp class="SANS_TheSansMonoCd_W5Regular_11">   # For brevity, the traces for "All Stocks", "My Portfolio", and "Inflation" are excluded</samp></span></p>
<p class="_CodeWideSpace"><samp class="SANS_TheSansMonoCd_W5Regular_11">   fig.update_layout(</samp></p>
<p class="CodeWide"><samp class="SANS_TheSansMonoCd_W5Regular_11">      </samp><samp class="SANS_TheSansMonoCd_W5Regular_11">title=f"Returns for {yrs} years starting {start}",</samp></p>
<p class="CodeWide"><samp class="SANS_TheSansMonoCd_W5Regular_11">      </samp><samp class="SANS_TheSansMonoCd_W5Regular_11">template="none",</samp></p>
<p class="CodeWide"><samp class="SANS_TheSansMonoCd_W5Regular_11">      </samp><samp class="SANS_TheSansMonoCd_W5Regular_11">showlegend=True,</samp></p>
<p class="CodeWide"><samp class="SANS_TheSansMonoCd_W5Regular_11">      </samp><samp class="SANS_TheSansMonoCd_W5Regular_11">legend=dict(x=0.01, y=0.99),</samp></p>
<p class="CodeWide"><samp class="SANS_TheSansMonoCd_W5Regular_11">      </samp><samp class="SANS_TheSansMonoCd_W5Regular_11">height=400,</samp></p>
<p class="CodeWide"><samp class="SANS_TheSansMonoCd_W5Regular_11">      </samp><samp class="SANS_TheSansMonoCd_W5Regular_11">margin=dict(l=</samp><samp class="SANS_TheSansMonoCd_W5Regular_11">40, r=10, t=60, b=55),</samp></p>
<p class="CodeWide"><samp class="SANS_TheSansMonoCd_W5Regular_11">      </samp><samp class="SANS_TheSansMonoCd_W5Regular_11">yaxis=dict(tickprefix="$", fixedrange=True),</samp></p>
<p class="CodeWide"><samp class="SANS_TheSansMonoCd_W5Regular_11">      </samp><samp class="SANS_TheSansMonoCd_W5Regular_11">xaxis=dict(title="Year Ended", fixedrange=True, dtick=</samp><samp class="SANS_TheSansMonoCd_W5Regular_11">dtick),</samp></p>
<p class="CodeWide"><samp class="SANS_TheSansMonoCd_W5Regular_11">   )</samp></p>
<p class="_CodeWideSpacebelow"><samp class="SANS_TheSansMonoCd_W5Regular_11">   return fig</samp></p>
<p class="CodeListingCaptionWide"><samp class="SANS_Futura_Std_Book_Oblique_I_11">Listing 6-8: Creating a Plotly Graph Objects line chart</samp></p>
<p class="TX">By using <samp class="SANS_TheSansMonoCd_W5Regular_11">graph_objects</samp> we can easily customize each trace (which in this case is a line). We start by creating the figure with <samp class="SANS_TheSansMonoCd_W5Regular_11">fig=go.Figure()</samp> <span aria-label="annotation1" class="SANS_NSAnnotations_Monospace_11">❶</span>, and then add each trace to the chart separately using <samp class="SANS_TheSansMonoCd_W5Regular_11">fig.add_trace()</samp>. For this function, the <samp class="SANS_TheSansMonoCd_W5Regular_11">x</samp> and <samp class="SANS_TheSansMonoCd_W5Regular_11">y</samp> attributes are the data for the x-axis and y-axis of the figure. The <samp class="SANS_TheSansMonoCd_W5Regular_11">x</samp> data for every trace is <samp class="SANS_TheSansMonoCd_W5Regular_11">Years</samp> and comes from the <samp class="SANS_TheSansMonoCd_W5Regular_11">Year</samp> column of the DataFrame. The <samp class="SANS_TheSansMonoCd_W5Regular_11">y</samp> data is contained in corresponding columns in the DataFrame. For example, the data for the “All Cash” line is in the DataFrame column <samp class="SANS_TheSansMonoCd_W5Regular_11">dff["all_cash"]</samp>. The <samp class="SANS_TheSansMonoCd_W5Regular_11">name</samp> attribute will show in the legend and on hover for each trace. The <samp class="SANS_TheSansMonoCd_W5Regular_11">marker_color</samp> attribute sets the color of each trace. There are many other attributes for customizing the trace, and you can see them in the Plotly documentation.</p>
<p class="TX">We use the <samp class="SANS_TheSansMonoCd_W5Regular_11">fig.update_layout()</samp> method to customize the positioning and configuration of the non-data parts of the figure, such as setting the title, height, and margins. The <samp class="SANS_TheSansMonoCd_W5Regular_11">yaxis</samp> and <samp class="SANS_TheSansMonoCd_W5Regular_11">xaxis</samp> attributes need a little more explanation:</p>
<ul class="List-1">
<li class="BL"><samp class="SANS_TheSansMonoCd_W5Regular_11">tickprefix=</samp><samp class="SANS_TheSansMonoCd_W5Regular_11">$</samp> adds a dollar sign to the labels on the y-axis.</li>
<li class="BL"><samp class="SANS_TheSansMonoCd_W5Regular_11">fixedrange</samp>=<samp class="SANS_TheSansMonoCd_W5Regular_11">True</samp> disables the zoom for both the x-axis and y-axis. This prevents unintended zooming on touchscreens; it can be annoying when you’re trying to scroll the page and end up zooming in on the figure instead.</li>
<li class="BL"><samp class="SANS_TheSansMonoCd_W5Regular_11">dtict</samp>=<samp class="SANS_TheSansMonoCd_W5Regular_11">dict</samp> is used to set the step between the labels on the x-axis. You can see how the labels change when the user selects different time periods. We calculate it like this:</li>
</ul>
<p class="CodeCustom1-1"><samp class="SANS_TheSansMonoCd_W5Regular_11">dtick = 1 if yrs &lt; 16 else 2 if yrs in range(16, 30) else 5</samp></p>
</section>
<section aria-labelledby="sec9" epub:type="division">
<h3 class="H1" id="sec9"><a id="h1-44"></a><span aria-label=" Page 117. " epub:type="pagebreak" id="pg_117" role="doc-pagebreak"></span><samp class="SANS_Futura_Std_Bold_B_11">Dash Callbacks</samp></h3>
<p class="TNI">Now comes the fun part. Callbacks make the app interactive. The callback functions are called automatically whenever an input component’s property changes. We’ll start with a simple callback that updates the pie chart based on the values of the two sliders.</p>
<p class="TX">Next we will show how to use <samp class="SANS_TheSansMonoCd_W5Regular_11">State</samp> to get data without triggering a callback.</p>
<p class="TX">We’ll then discuss a callback that synchronizes components by using the same parameters as both inputs and outputs.</p>
<p class="TX">Finally, we’ll show a callback with many inputs and outputs, and show how to use functions within the callback to make a large callback more manageable.</p>
<p class="HeadB"><a id="h2-39"></a><samp class="SANS_Futura_Std_Bold_Condensed_Oblique_I_11">Interactive Figures</samp></p>
<p class="TNI">Let’s start with the callback that updates the pie chart. Here’s the definition:</p>
<p class="_CodeSpaceAbove"><samp class="SANS_TheSansMonoCd_W5Regular_11">@app.callback(</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">   Output("allocation_pie_chart", "figure"),</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">   Input("stock_bond", "value"),</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">   Input("cash", "value"),</samp></p>
<p class="_CodeSpaceBelow"><samp class="SANS_TheSansMonoCd_W5Regular_11">)</samp></p>
<p class="TX">First we have the <samp class="SANS_TheSansMonoCd_W5Regular_11">Output</samp> of the callback, which updates the pie chart by updating the figure property of <samp class="SANS_TheSansMonoCd_W5Regular_11">dcc.Graph</samp>. You can find this <samp class="SANS_TheSansMonoCd_W5Regular_11">dcc.Graph</samp> in the <samp class="SANS_TheSansMonoCd_W5Regular_11">app.layout</samp>:</p>
<p class="CodeCustom1"><samp class="SANS_TheSansMonoCd_W5Regular_11">dcc.Graph(id="allocation_pie_chart", className="mb-2")</samp></p>
<p class="TX">We then define the inputs for the callback, which are the value property of the slider with the <samp class="SANS_TheSansMonoCd_W5Regular_11">id "stock_bond"</samp> and the value property of the slider with the <samp class="SANS_TheSansMonoCd_W5Regular_11">id "cash"</samp>.</p>
<p class="TX">Next we have the callback function, shown in <a href="chapter6.xhtml#List6-9">Listing 6-9</a>.</p>
<a id="List6-9"></a>
<p class="_CodeSpaceAbove"><samp class="SANS_TheSansMonoCd_W5Regular_11">def update_pie(stocks, cash):</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">   bonds = 100 - stocks - cash</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">   slider_input = [cash, bonds, stocks]</samp></p>
<p class="_CodeSpace"><samp class="SANS_TheSansMonoCd_W5Regular_11">   if stocks &gt;= 70:</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">      investment_style = "Aggressive"</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">   elif stocks &lt;= 30:</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">      investment_style = "Conservative"</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">   else:</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">      investment_style = "Moderate"</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">   figure = make_pie(slider_input, investment_style + " Asset Allocation")</samp></p>
<p class="_CodeSpaceBelow"><samp class="SANS_TheSansMonoCd_W5Regular_11">   return figure</samp></p>
<p class="CodeListingCaption"><samp class="SANS_Futura_Std_Book_Oblique_I_11">Listing 6-9: The update_pie()</samp> <samp class="SANS_Futura_Std_Book_Oblique_I_11">callback function</samp></p>
<p class="TX"><span aria-label=" Page 118. " epub:type="pagebreak" id="pg_118" role="doc-pagebreak"></span>We first calculate the percentage of bonds based on what the user selected for cash and stocks on the slider, using the operation <samp class="SANS_TheSansMonoCd_W5Regular_11">bonds</samp> <samp class="SANS_TheSansMonoCd_W5Regular_11">=</samp> <samp class="SANS_TheSansMonoCd_W5Regular_11">100 –</samp> <samp class="SANS_TheSansMonoCd_W5Regular_11">stocks – cash</samp>.</p>
<p class="TX">Next we update the text for the title of the pie chart. Our rule of thumb is that portfolios with more than 70 percent allocated to stocks have an “Aggressive” investment style, portfolios with less than 30 percent allocated to stocks are “Conservative,” and everything else is “Moderate.” This title is updated dynamically as the user moves the sliders. We pass this title as an attribute to the <samp class="SANS_TheSansMonoCd_W5Regular_11">make_pie()</samp> function.</p>
<p class="TX">Finally, we create the figure by calling our function <samp class="SANS_TheSansMonoCd_W5Regular_11">make_pie()</samp>, defined in <a href="chapter6.xhtml#List6-7">Listing 6-7</a>. By using a function to create the figure, we reduce the amount of code contained in the callback and can use the function in other callbacks as well. The result, more readable and maintainable code.</p>
<p class="TX">Now you can go back to the app, see how moving the sliders updates the pie chart, and know how this is accomplished.</p>
<p class="HeadB"><a id="h2-40"></a><samp class="SANS_Futura_Std_Bold_Condensed_Oblique_I_11">Callbacks Using State</samp></p>
<p class="TNI">The second callback synchronizes the two sliders using one-way synchronization: one slider is used to update the value of a different slider. The <samp class="SANS_TheSansMonoCd_W5Regular_11">"cash"</samp> slider will update the <samp class="SANS_TheSansMonoCd_W5Regular_11">"stock_bond"</samp> slider, but the <samp class="SANS_TheSansMonoCd_W5Regular_11">"stock_bond"</samp> slider won’t update the <samp class="SANS_TheSansMonoCd_W5Regular_11">"cash"</samp> slider. We update the <samp class="SANS_TheSansMonoCd_W5Regular_11">"stock_bond"</samp> slider component after the user selects the cash allocation on the <samp class="SANS_TheSansMonoCd_W5Regular_11">"cash"</samp> slider:</p>
<p class="_CodeSpaceAbove"><samp class="SANS_TheSansMonoCd_W5Regular_11">@app.callback(</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">   Output("stock_bond", "max"),</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">   Output("stock_bond", "marks"),</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">   Output("stock_bond", "value"),</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">   Input("cash", "value"),</samp></p>
<p class="Code-ind"><span aria-label="annotation1" class="SANS_NSAnnotations_Monospace_11">❶</span>  <samp class="SANS_TheSansMonoCd_W5Regular_11">State("stock_bond", "value"),</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11"> )</samp></p>
<p class="Code-ind"><span aria-label="annotation2" class="SANS_NSAnnotations_Monospace_11">❷</span>  <samp class="SANS_TheSansMonoCd_W5Regular_11">def update_stock_slider(cash, initial_stock_value):</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">   max_slider = 100 - int(cash)</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">   stocks = min(max_slider, initial_stock_value)</samp></p>
<p class="_CodeSpace"><span class="gray"><samp class="SANS_TheSansMonoCd_W5Regular_11">   # Formats the slider scale</samp></span></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">   if max_slider &gt; 50:</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">      marks_slider = {i: f"{i}%" for i in range(0, max_slider +</samp> <samp class="SANS_TheSansMonoCd_W5Regular_11">1, 10)}</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">   elif max_slider &lt;= 15:</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">      marks_slider = {i: f"{i}%" for i in range(0, max_slider + 1, 1)}</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">   else:</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">      marks_slider = {i: f"{i}%" for i in range(0, max_slider + 1, 5)}</samp></p>
<p class="_CodeSpaceBelow"><samp class="SANS_TheSansMonoCd_W5Regular_11">   return max_slider, marks_slider, stocks</samp></p>
<p class="TX">We’re using <samp class="SANS_TheSansMonoCd_W5Regular_11">State</samp> <span aria-label="annotation1" class="SANS_NSAnnotations_Monospace_11">❶</span> in the function definition because we need to know the current input value on the slider in order to calculate the new output value. <samp class="SANS_TheSansMonoCd_W5Regular_11">State</samp> does not trigger a callback; its purpose is to provide the current value (the state) of the property at the time the callback is triggered.</p>
<p class="TX">At <span aria-label="annotation2" class="SANS_NSAnnotations_Monospace_11">❷</span> we begin the callback function. When the user selects the cash allocation, we alter the amount that can be allocated to either stocks or bonds. For example, if the user changes cash to 20 percent, stocks can be a <span aria-label=" Page 119. " epub:type="pagebreak" id="pg_119" role="doc-pagebreak"></span>maximum of 80 percent, so we need to update the value of the <samp class="SANS_TheSansMonoCd_W5Regular_11">"stock_bond"</samp> slider from wherever it’s currently at to the new max of 80 percent.</p>
<p class="TX">We also update the scale on the slider by updating the marks. Notice how the stock allocation percentage slider scale goes up by tens in the top half of <a href="chapter6.xhtml#fig6-16">Figure 6-16</a> and by single digits in the bottom half.</p>
<a id="fig6-16"></a>
<figure class="IMG"><img alt="" class="img90" height="505" src="../images/Figure6-16.png" width="696"/>
<figcaption><p class="CAP"><samp class="SANS_Futura_Std_Book_Oblique_I_11">Figure 6-16: The cash and stock allocation sliders before (top) and after (bottom) updating the scale</samp></p></figcaption>
</figure>
<p class="TX">We calculate the slider marks based on the maximum value of the slider. For example, in the bottom set of sliders, the cash allocation is 95 percent, so the maximum for the stock allocation is 5 percent. This means the <samp class="SANS_TheSansMonoCd_W5Regular_11">max_slider</samp> value is <samp class="SANS_TheSansMonoCd_W5Regular_11">5</samp> in the function that creates the slider marks:</p>
<p class="CodeCustom1"><samp class="SANS_TheSansMonoCd_W5Regular_11">marks_slider = {i: f"{i}%" for i in range(0, max_slider + 1)}</samp></p>
<p class="BodyContinued">which is a more compact way of writing it than this:</p>
<p class="_CodeSpaceAbove"><samp class="SANS_TheSansMonoCd_W5Regular_11">marks_slider={</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">      0: '0%',</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">      1: '1%',</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">      2: '2%',</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">      3: '3%',</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">      4: '4%',</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">      5: '5%'</samp></p>
<p class="_CodeSpaceBelow"><samp class="SANS_TheSansMonoCd_W5Regular_11">   },</samp></p>
<p class="TX">Now you can go back to the app and see how moving the <samp class="SANS_TheSansMonoCd_W5Regular_11">"cash"</samp> slider updates the <samp class="SANS_TheSansMonoCd_W5Regular_11">"max"</samp>, <samp class="SANS_TheSansMonoCd_W5Regular_11">"marks"</samp>, and <samp class="SANS_TheSansMonoCd_W5Regular_11">"value"</samp> of the <samp class="SANS_TheSansMonoCd_W5Regular_11">"stock_bond"</samp> slider.</p>
<p class="HeadB"><a id="h2-41"></a><span aria-label=" Page 120. " epub:type="pagebreak" id="pg_120" role="doc-pagebreak"></span><samp class="SANS_Futura_Std_Bold_Condensed_Oblique_I_11">Circular Callbacks and Synchronizing Components</samp></p>
<p class="TNI">Dash also allows two-way synchronization of components. For example, if you would like a user to be able to set a certain value <i>either</i> by entering a number into an input box <i>or</i> by moving a slider handle, it’s necessary to have these values match. In this case, the slider updates the input box and the input box updates the slider. This is an example of a <i>circular callback</i>.</p>
<p class="TX">We use circular callbacks in our app to synchronize some components in the control panel. Recall that the user can enter a starting year and number of years into input boxes to calculate investment returns, but can also select a certain interesting time period, like the Great Depression, from a list. This callback keeps these three inputs synchronized. When you select the Great Depression from the list, it changes the start year in the input box to 1929 and the planning time to 20 years to highlight how long it took for stocks to recover. If the user then enters 2010 into the input box, it’s no longer the Great Depression period, so that radio button is deselected.</p>
<p class="TX">Now let’s take a closer look at this callback:</p>
<p class="_CodeSpaceAbove"><samp class="SANS_TheSansMonoCd_W5Regular_11">@app.callback(</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">   Output("planning_time", "value"),</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">   Output("start_yr", "value"),</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">   Output("time_period", "value"),</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">   Input("planning_time", "value"),</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">   Input("start_yr", "value"),</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">   Input("time_period", "value"),</samp></p>
<p class="_CodeSpaceBelow"><samp class="SANS_TheSansMonoCd_W5Regular_11">)</samp></p>
<p class="TX">Notice that under the <samp class="SANS_TheSansMonoCd_W5Regular_11">@app.callback</samp> decorator function, the three outputs are exactly the same as the three inputs. This makes it possible to synchronize the values of these three components. <a href="chapter6.xhtml#List6-10">Listing 6-10</a> shows the callback function.</p>
<a id="List6-10"></a>
<p class="_CodeSpaceAbove"><samp class="SANS_TheSansMonoCd_W5Regular_11">def update_time_period(planning_time, start_yr, period_number):</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">   " ""syncs inputs and selected time periods" ""</samp></p>
<p class="Code"><span aria-label="annotation1" class="SANS_NSAnnotations_Monospace_11">❶</span><samp class="SANS_TheSansMonoCd_W5Regular_11"> ctx = callback_context</samp></p>
<p class="Code"><span aria-label="annotation2" class="SANS_NSAnnotations_Monospace_11">❷</span><samp class="SANS_TheSansMonoCd_W5Regular_11"> input_id = ctx.triggered[0]["prop_id"].split(".")[0]</samp></p>
<p class="_CodeSpace"><samp class="SANS_TheSansMonoCd_W5Regular_11">   if input_id ==</samp> <samp class="SANS_TheSansMonoCd_W5Regular_11">"time_period":</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">      planning_time = time_period_data[period_number]["planning_time"]</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">      start_yr = time_period_data[period_number]["start_yr"]</samp></p>
<p class="_CodeSpace"><samp class="SANS_TheSansMonoCd_W5Regular_11">   if input_id in ["planning_time", "start_yr"]:</samp></p>
<p class="Code"><samp class="SANS_TheSansMonoCd_W5Regular_11">      period_number = None</samp></p>
<p class="_CodeSpaceBelowCustom"><samp class="SANS_TheSansMonoCd_W5Regular_11">   return planning_time, start_yr, period_number</samp></p>
<p class="CodeListingCaption"><samp class="SANS_Futura_Std_Book_Oblique_I_11">Listing 6-10: The callback function for synchronization</samp></p>
<p class="TX">To update the output properly, the callback must know which of the three inputs triggered the callback, which we can find out using another advanced callback feature: <samp class="SANS_TheSansMonoCd_W5Regular_11">callback_context</samp> <span aria-label="annotation1" class="SANS_NSAnnotations_Monospace_11">❶</span>. This is a global variable that’s only available inside a Dash callback. One of the attributes of <span aria-label=" Page 121. " epub:type="pagebreak" id="pg_121" role="doc-pagebreak"></span><samp class="SANS_TheSansMonoCd_W5Regular_11">callback_context</samp> is called <samp class="SANS_TheSansMonoCd_W5Regular_11">triggered</samp> and is a list of changed properties. We parse this list to find the <samp class="SANS_TheSansMonoCd_W5Regular_11">id</samp> of the triggering input <span aria-label="annotation2" class="SANS_NSAnnotations_Monospace_11">❷</span>.</p>
<p class="TX">Next we use the <samp class="SANS_TheSansMonoCd_W5Regular_11">input_id</samp> to update different things depending on which input triggered the callback. If it’s triggered by the user selecting a time period, we update the input boxes for the year and planning time. If it’s triggered by the user entering something in the input boxes, we deselect the time period radio button. This keeps the UI synchronized.</p>
<p class="TX">Note that in order to have synced components like this, it’s necessary to have the inputs and outputs in the same callback, which we’ll cover next.</p>
<p class="HeadB"><a id="h2-42"></a><samp class="SANS_Futura_Std_Bold_Condensed_Oblique_I_11">Callbacks with Multiple Inputs and Multiple Outputs</samp></p>
<p class="TNI">One of the current limitations of Dash is that it does not allow for multiple callbacks to update the same output. Currently the only available solution is to include all the inputs that update an output in the same callback. The downside to this approach is that the callbacks can become huge and complex, which can make them difficult to understand, maintain, and debug. The strategy to deal with this is to make separate functions for each process in the callback. You can see an example of this in the callback in <a href="chapter6.xhtml#List6-11">Listing 6-11</a>.</p>
<p class="TX">This callback is the workhorse of the app. Anytime any input changes in the sliders or input boxes, this callback is triggered to update the total returns table, line chart, summary table, ending amount, and rate of return. Wow. If we included the code for all that in this callback it would be hundreds of lines long. Instead, it’s 15 lines (not including comments and whitespace). We can make it so concise because we create and call functions that handle the specific changes required. <a href="chapter6.xhtml#List6-11">Listing 6-11</a> shows the full callback.</p>
<a id="List6-11"></a>
<p class="_CodeWideSpaceAbove"><samp class="SANS_TheSansMonoCd_W5Regular_11">@app.callback(</samp></p>
<p class="CodeWide"><samp class="SANS_TheSansMonoCd_W5Regular_11">   Output("total_returns", "data"),</samp></p>
<p class="CodeWide"><samp class="SANS_TheSansMonoCd_W5Regular_11">   Output("returns_chart", "figure"),</samp></p>
<p class="CodeWide"><samp class="SANS_TheSansMonoCd_W5Regular_11">   Output("summary_table", "children"),</samp></p>
<p class="CodeWide"><samp class="SANS_TheSansMonoCd_W5Regular_11">   Output("ending_amount", "value"),</samp></p>
<p class="CodeWide"><samp class="SANS_TheSansMonoCd_W5Regular_11">   Output("cagr", "value"),</samp></p>
<p class="CodeWide"><samp class="SANS_TheSansMonoCd_W5Regular_11">   Input("stock_bond", "value"),</samp></p>
<p class="CodeWide"><samp class="SANS_TheSansMonoCd_W5Regular_11">   Input("cash", "value"),</samp></p>
<p class="CodeWide"><samp class="SANS_TheSansMonoCd_W5Regular_11">   Input("starting_amount", "value"),</samp></p>
<p class="CodeWide"><samp class="SANS_TheSansMonoCd_W5Regular_11">   Input("planning_time", "value"),</samp></p>
<p class="CodeWide"><samp class="SANS_TheSansMonoCd_W5Regular_11">   Input("start_yr", "value"),</samp></p>
<p class="CodeWide"><samp class="SANS_TheSansMonoCd_W5Regular_11">)</samp></p>
<p class="CodeWide"><samp class="SANS_TheSansMonoCd_W5Regular_11">def update_totals(stocks, cash, start_bal, planning_time, start_yr):</samp></p>
<p class="CodeWide"><span class="gray"><samp class="SANS_TheSansMonoCd_W5Regular_11">   # Set defaults for invalid inputs</samp></span></p>
<p class="CodeWide"><samp class="SANS_TheSansMonoCd_W5Regular_11">   start_bal = 10 if start_bal is None else start_bal</samp></p>
<p class="CodeWide"><samp class="SANS_TheSansMonoCd_W5Regular_11">   planning_time = 1 if planning_time is None else planning_time</samp></p>
<p class="CodeWide"><samp class="SANS_TheSansMonoCd_W5Regular_11">   start_yr = MIN_YR if start_yr is None else int(start_yr)</samp></p>
<p class="_CodeWideSpace"><span class="gray"><samp class="SANS_TheSansMonoCd_W5Regular_11">   # Calculate valid planning time start yr</samp></span></p>
<p class="CodeWide"><samp class="SANS_TheSansMonoCd_W5Regular_11">   max_time = MAX_YR + 1 - start_yr</samp></p>
<p class="CodeWide"><samp class="SANS_TheSansMonoCd_W5Regular_11">   planning_time = min(max_time, planning_time)</samp></p>
<p class="CodeWide"><samp class="SANS_TheSansMonoCd_W5Regular_11">   if start_yr +</samp> <samp class="SANS_TheSansMonoCd_W5Regular_11">planning_time &gt; MAX_YR:</samp></p>
<p class="CodeWide"><samp class="SANS_TheSansMonoCd_W5Regular_11">      </samp><samp class="SANS_TheSansMonoCd_W5Regular_11">start_yr = min(df.iloc[-planning_time, 0], MAX_YR) # 0 is Year column</samp></p>
<p class="_CodeWideSpace"><span class="gray"><span aria-label=" Page 122. " epub:type="pagebreak" id="pg_122" role="doc-pagebreak"></span><samp class="SANS_TheSansMonoCd_W5Regular_11">   # Create investment returns dataframe</samp></span></p>
<p class="CodeWide"><samp class="SANS_TheSansMonoCd_W5Regular_11">   dff = backtest(stocks, cash, start_bal, planning_time, start_yr)</samp></p>
<p class="_CodeWideSpace"><span class="gray"><samp class="SANS_TheSansMonoCd_W5Regular_11">   # Create data for DataTable</samp></span></p>
<p class="CodeWide"><samp class="SANS_TheSansMonoCd_W5Regular_11">   data = dff.to_dict("records")</samp></p>
<p class="_CodeWideSpace"><samp class="SANS_TheSansMonoCd_W5Regular_11">   fig = make_line_chart(dff)</samp> <span aria-label="annotation1" class="SANS_NSAnnotations_Monospace_11">❶</span></p>
<p class="_CodeWideSpace"><samp class="SANS_TheSansMonoCd_W5Regular_11">   summary_table =</samp> <samp class="SANS_TheSansMonoCd_W5Regular_11">make_summary_table(dff)</samp> <span aria-label="annotation2" class="SANS_NSAnnotations_Monospace_11">❷</span></p>
<p class="_CodeWideSpace"><span class="gray"><samp class="SANS_TheSansMonoCd_W5Regular_11">   # Format ending balance</samp></span></p>
<p class="CodeWide"><samp class="SANS_TheSansMonoCd_W5Regular_11">   ending_amount = f"${dff['Total'].iloc[-1]:0,.0f}"</samp></p>
<p class="_CodeWideSpace"><span class="gray"><samp class="SANS_TheSansMonoCd_W5Regular_11">   # Calculate cagr</samp></span></p>
<p class="CodeWide"><samp class="SANS_TheSansMonoCd_W5Regular_11">   ending_cagr = cagr(dff["Total"])</samp></p>
<p class="_CodeWideSpacebelow-t"><samp class="SANS_TheSansMonoCd_W5Regular_11">   return data, fig, summary_table, ending_amount, ending_cagr</samp></p>
<p class="CodeListingCaptionWide"><samp class="SANS_Futura_Std_Book_Oblique_I_11">Listing 6-11: The full callback for updating multiple outputs</samp></p>
<p class="TX">The lines at <span aria-label="annotation1" class="SANS_NSAnnotations_Monospace_11">❶</span> and <span aria-label="annotation2" class="SANS_NSAnnotations_Monospace_11">❷</span> are examples of where we use two functions that we described in the <span class="Xref">“Line Chart Using Plotly Graph Objects”</span> and <span class="Xref">“Content Tables”</span> sections earlier in the chapter. The first function makes the line chart and the second function makes the summary table. We use the two functions <samp class="SANS_TheSansMonoCd_W5Regular_11">backtest()</samp> and <samp class="SANS_TheSansMonoCd_W5Regular_11">cagr()</samp> to calculate the investment returns. Those aren’t discussed in detail in this chapter, but you can see them in the helper function section in the code on GitHub.</p>
</section>
<section aria-labelledby="sec10" epub:type="division">
<h3 class="H1" id="sec10"><a id="h1-45"></a><samp class="SANS_Futura_Std_Bold_B_11">Summary</samp></h3>
<p class="TNI">We’ll wrap up this chapter with a summary of the strategies for structuring larger apps:</p>
<ul class="List-1">
<li class="BL">Use global variables for constant app data such as thematic app colors and startup defaults.</li>
<li class="BL">Assign variable names to components to make them easier to call in the layout. This also means we use reuse the components in other apps, like building blocks.</li>
<li class="BL">Organize code to keep similar elements together; for example, have discrete sections for visuals such as tables, graphs, and inputs.</li>
<li class="BL">Use functions to bundle logic to make the code easier to read and understand. This is especially useful in callbacks with multiple inputs and outputs.</li>
</ul>
<p class="TX">When developing large apps or adding new features to an existing app, it can be helpful to first create a stand-alone minimal working example of the new feature. This smaller version is much easier to debug, since you don’t have to search through hundreds or thousands of lines of code to find the source of the error.</p>
<p class="TX">In the next chapter you will learn even more techniques for structuring apps, such as using multiple files and reusable components.</p>
</section>
</section>
</div></body>
</html>