<html><head></head><body>
<h2 class="h2" id="ch11"><span id="page_155"></span>
 <strong>
<span class="big">11</span>
</strong>
</h2>
<h2 class="h2a">
<strong>DISPLAYING BIRTHDAYS</strong>
</h2>
<div class="image1"><img src="Image00001.jpg" />
</div>
<p class="noindent">Time to show off those birthdays! In <a href="text00021.html#ch10">Chapter 10</a>
 , you created the Add Birthday view controller so that you could add new <span class="code">Birthday</span>
 objects into your app with the <span class="code">Birthday</span>
 class. In this chapter, you’ll create a Birthdays table view controller that can display your added birthdays in a <em>table view</em>
 , which shows a list of items the user can scroll through and select. Then you’ll learn how to make the Add Birthday view controller tell the Birthdays table view controller when a <span class="code">Birthday</span>
 object is added so that the new birthday can be shown in the table view.</p>
<h3 class="h3" id="ch11lev1sec1">
<strong>MAKING THE BIRTHDAY LIST</strong>
</h3>
<p class="noindent">It’s one thing to be able to add birthdays, but you’ll also want to display a list of birthdays. For that you need to create another class, <span class="code">BirthdaysTableViewController</span>
 , which will subclass <span class="code">UITableViewController</span>
 , <span id="page_156"></span>
 a special kind of view controller with a table view. <span class="code">UITableViewController</span>
 contains several built-in methods that allow you to code things like how many rows the table view should have and what should be displayed in each row. We’ll want to have as many rows as we have birthdays and to display one birthday in each row.</p>
<h4 class="h4" id="ch11lev2sec1">
<strong>CREATING THE BIRTHDAYS TABLE VIEW CONTROLLER</strong>
</h4>
<p class="noindent">
<span class="smallcaps">CONTROL</span>
 -click the <em>BirthdayTracker</em>
 folder in the Project navigator and choose <strong>New File…</strong>
 from the menu. In <a href="text00021.html#ch10">Chapter 10</a>
 , we created the Swift file <em>Birthday.swift</em>
 , which Xcode prepared for us with nearly nothing in it. To create a new file this time, we’ll tell Xcode we want to subclass an existing iOS class. Depending on the base class, Xcode will create a file containing some code that you’ll customize to your needs. To create the file, select <strong>iOS</strong>
 at the top of the window and then select the <strong>Cocoa Touch Class</strong>
 template, which will automatically format the new class file (see <a href="text00022.html#ch11fig1">Figure 11-1</a>
 ).</p>
<div class="image"><img src="Image00234.jpg" />
</div>
<p class="figcap"><a id="ch11fig1"></a>
 <em>Figure 11-1: To subclass an existing class, choose</em>
 <strong>
<em>iOS</em>
</strong>
 <em>and then</em>
 <strong>
<em>Cocoa Touch Class.</em>
</strong>
</p>
<p class="indent">When you choose this option, you’ll see a second dialog where you can name your new class and specify which class you’ll subclass. First, in the Subclass field (the second field in the dialog), type <span class="code">
<span class="codestrong">UITableViewController</span>
</span>
 . This will automatically fill in the class field with the subclass name. Once that happens, type <span class="code">
<span class="codestrong">Birthdays</span>
</span>
 in front of <span class="code">TableViewController</span>
 so that the whole class name is <span class="code">BirthdaysTableViewController</span>
 . This is a shortcut so you don’t <span id="page_157"></span>
 have to type as much. Make sure to choose <strong>Swift</strong>
 in the Language drop-down menu as well, and then click <strong>Next</strong>
 . Then select <strong>Create</strong>
 in the final dialog to create your new file.</p>
<p class="indent">In <em>BirthdaysTableViewController.swift</em>
 , Xcode has provided a template with several commented-out methods. You can clean up the code by getting rid of methods we won’t use. Delete just the comments in <span class="code">viewDidLoad()</span>
 , and then delete the entire <span class="code">didReceiveMemoryWarning()</span>
 method and the methods <span class="code">tableView(_:moveRowAt:to:)</span>
 and <span class="code">tableView(_:canMoveRowAt:)</span>
 , which have to do with moving rows in the table view. When you’re finished, the contents of <span class="code">BirthdaysTableViewController</span>
 should look like <a href="text00022.html#ch11fig2">Figure 11-2</a>
 . There are still several commented-out methods, but we’re keeping those to use later!</p>
<div class="image"><img src="Image00235.jpg" />
</div>
<p class="figcap"><a id="ch11fig2"></a>
 <em>Figure 11-2: The</em>
 <span class="code">
<span class="italic">BirthdaysTableViewController</span>
</span>
 <em>cleaned up!</em>
</p>
<p class="indent">Next, you need to make the Birthdays table view controller the <span class="code">BirthdaysTableViewController</span>
 class. To do this, go to <em>Main.storyboard</em>
 and select the <strong>Birthdays</strong>
 scene. Using the Identity Inspector in the right pane, change the class from <span class="code">UITableViewController</span>
 to <span class="code">BirthdaysTableViewController</span>
 , as shown in <a href="text00022.html#ch11fig3">Figure 11-3</a>
 .</p>
<div class="image"><span id="page_158"></span>
 <img src="Image00236.jpg" />
</div>
<p class="figcap"><a id="ch11fig3"></a>
 <em>Figure 11-3: Setting</em>
 <span class="code">
<span class="italic">BirthdaysTableViewController</span>
</span>
 <em>as the class of the Birthdays scene</em>
</p>
<p class="indent">Now that you have the Birthdays table view controller set up in the storyboard, the next step is to make cells in your table that will display each birthday.</p>
<h4 class="h4" id="ch11lev2sec2">
<strong>ADDING CELLS TO THE TABLE VIEW</strong>
</h4>
<p class="noindent">Each birthday will be displayed in a <span class="code">UITableViewCell</span>
 in the Birthdays table view controller. A table has boxes organized into rows and columns that contain information. These boxes are called <em>cells</em>
 . Similarly, a table view also has cells that are all instances of, or a subclass of, the <span class="code">UITableViewCell</span>
 class. We’ll put each birthday into its own cell in our table view.</p>
<p class="indent">We’ll start by creating those cells in the storyboard, and then we’ll fill them with our <span class="code">Birthday</span>
 objects later. In the left outline menu, click the triangle by Birthdays and then click the triangle by Table View to open those sections. Then select <strong>Table View Cell</strong>
 <span class="ent">➊</span>
 , as shown in <a href="text00022.html#ch11fig4">Figure 11-4</a>
 .</p>
<div class="image"><img src="Image00237.jpg" />
</div>
<div class="image"><img src="Image00238.jpg" />
</div>
<p class="figcap"><a id="ch11fig4"></a>
 <em>Figure 11-4: Creating a Subtitle style table view cell and setting its identifier</em>
</p>
<p class="indent"><span id="page_159"></span>
 Next, open the Attributes Inspector. Using the drop-down menu under <strong>Style</strong>
 , set the cell’s style to <strong>Subtitle</strong>
 <span class="ent">➋</span>
 so that the cell now has a Title label and a Subtitle label. You’ll display each person’s name in the Title and birthday in the Subtitle.</p>
<p class="indent">Finally, enter <span class="code">
<span class="codestrong">birthdayCellIdentifier</span>
</span>
 in the Identifier field <span class="ent">➌</span>
 . You’ll use this identifier later when you fill in the cell contents.</p>
<p class="indent">That’s it! You’ve finished your work in the storyboard.</p>
<p class="indent">You may be wondering why we have just one cell in our table view in the storyboard when we’ll have more than one birthday to show in the list. If you look at <a href="text00022.html#ch11fig4">Figure 11-4</a>
 again, you’ll notice that the cell is labeled <em>Prototype Cells</em>
 . This means that the cell you just customized is a <em>template</em>
 for all the cells you want to appear in your table view. The identifier you gave the cell is how your code will tell the table view to produce each cell for you to put birthdays in. You’ll see how this works soon.</p>
<div class="box1">
<p class="box-title">
<strong>WORKING WITH DATES</strong>
</p>
<p class="box-p">Swift has a special data type called <span class="code">Date</span>
 that is used for storing date values. A <span class="code">Date</span>
 object is actually a date and a time. Open your playground and enter the following:</p>
<div class="image"><img src="Image00239.jpg" />
</div>
<p class="box-pi">We’ve just assigned the current date and time the code was run to the variable <span class="code">today</span>
 . When you print <span class="code">today</span>
 , it’s in the format <span class="code">"2017-11-21 10:45:31 +0000\n"</span>
 . What if you wanted it to display as <span class="code">Tuesday, November 21, 2017</span>
 , instead? Or just <span class="code">11/21/17</span>
 ? To display a date in a particular way, you use a <em>date formatter</em>
 , which is a <span class="code">DateFormatter</span>
 object that you create and give a date format style. <span class="code">DateFormatter</span>
 is a helper object that is used to create a display string from any date, and a <em>date format style</em>
 is a property of <span class="code">DateFormatter</span>
 that tells the formatter what style to use. You can create your own date format styles manually, but there are also styles that are included in Swift and ready to use. Add the following to your playground:</p>
<div class="image"><img src="Image00240.jpg" />
</div>
<p class="box-pi">At <span class="ent">➊</span>
 you create a <span class="code">formatter</span>
 . Then at <span class="ent">➋</span>
 , you set the style of the <span class="code">formatter</span>
 to <span class="code">Style.full</span>
 , which will print the day of the week as well as the full month name, date, and year. Finally, you create a string from the date using the <span class="code">string(from:)</span>
 method of the <span class="code">DateFormatter</span>
 class <span class="ent">➌</span>
 . You can see that you now have turned the <span id="page_160"></span>
 date into the nicely formatted string <span class="code">"Tuesday, November 21, 2017"</span>
 . <a style=";color:black;" href="text00022.html#ch11tab1">Table 11-1</a>
 shows the different strings that are created from the five <span class="code">DateFormatter.Style</span>
 options available in Swift.</p>
<p class="tabcap"><a id="ch11tab1" style=";color:black;"></a>
 <strong>Table 11-1:</strong>
 Date Formatter Styles and Their Date Strings</p>
<table class="tabled">
<tbody>
<tr>
<td style="vertical-align: top;" class="border1">
<p class="noindent">
<span class="code">
<span class="codestrong">DateFormatter.Style</span>
</span>
</p>
</td>
<td style="vertical-align: top;" class="border1">
<p class="noindent">
<strong>Date string</strong>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">none</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">""</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">short</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"11/21/17"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">medium</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"Nov 21, 2017"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">long</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"November 21, 2017"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">full</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"Tuesday, November 21, 2017"</span>
</p>
</td>
</tr>
</tbody>
</table>
<p class="box-pi">You can also specify your own custom way of displaying a date using the <span class="code">dateFormat</span>
 property of the <span class="code">DateFormatter</span>
 . Perhaps you only want the month and day. Or maybe you want a four-digit year displayed in the <span class="code">short</span>
 style. Doing either is really easy, and you don’t even have to create a new <span class="code">DateFormatter</span>
 —you can just change the <span class="code">dateFormat</span>
 on <span class="code">formatter</span>
 and then ask it for a new string. Add the following code to your playground to display dates with a specific format:</p>
<div class="image"><img src="Image00241.jpg" />
</div>
<p class="box-pi">At <span class="ent">➊</span>
 , you specify that you only want the month and the date in an <span class="code">MM/dd</span>
 format—that is, a two-digit month followed by a two-digit date. If you want to display the month as three letters, then use <span class="code">MMM</span>
 . To display the full name of the month, use <span class="code">MMMM</span>
 . At <span class="ent">➋</span>
 , we change the date format to use a four-digit year. A two-digit year would be <span class="code">yy</span>
 . Here are a few other ways to use a <span class="code">dateFormat</span>
 to display a custom date string.</p>
<div class="image"><img src="Image00242.jpg" />
</div>
<p class="box-pi"><span id="page_161"></span>
 If you want to include separators, you add them to your <span class="code">dateFormat</span>
 string. For example, if you want periods as separators, then you can create a <span class="code">dateFormat</span>
 like <span class="code">"MM.dd.yy"</span>
 <span class="ent">➊</span>
 . To display an abbreviated day of the week, use <span class="code">EEE</span>
 <span class="ent">➋</span>
 . For the full day, use <span class="code">EEEE</span>
 <span class="ent">➌</span>
 . These are only a few examples. By using combinations of <span class="code">M</span>
 , <span class="code">d</span>
 , <span class="code">y</span>
 , and <span class="code">E</span>
 , you have an endless number of ways to display a date!</p>
</div>
<h4 class="h4" id="ch11lev2sec3">
<strong>SETTING UP THE BIRTHDAYS TABLE VIEW CONTROLLER</strong>
</h4>
<p class="noindent">The Birthdays table view controller will display a list of all the birthdays stored in the app. Do you remember what you use to store a list of items? That’s right—an array! You’ll create an array in the <span class="code">BirthdaysTableViewController</span>
 to store all the birthdays. To do this, give the <span class="code">BirthdaysTableViewController</span>
 a <span class="code">birthdays</span>
 property that is an array of <span class="code">Birthday</span>
 objects. At the top of the class, right above the <span class="code">viewDidLoad()</span>
 method, insert this line to add a variable array property called <span class="code">birthdays</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController {</span>
<br />
<br />
    <span class="pink">var</span>
 birthdays = [<span class="green1">Birthday</span>
 ]()<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent">This line creates an empty array of <span class="code">Birthday</span>
 instances. It needs to be a variable and not a constant because you’ll want to add a saved <span class="code">Birthday</span>
 to this array every time the user adds a <span class="code">Birthday</span>
 with the Add Birthday view controller. You’ll see how to do that in “<a href="text00022.html#ch11lev3sec2">Making the Birthdays Table View Controller Conform to Protocol</a>
 ” on <a href="text00022.html#page_168">page 168</a>
 .</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>Remember that the final versions of the project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>.</em>
</p>
</div>
<p class="indent">The <span class="code">BirthdaysTableViewController</span>
 will also need a <span class="code">dateFormatter</span>
 property to display the birthdate as a nicely formatted string. Add a <span class="code">dateFormatter</span>
 right underneath the <span class="code">birthdays</span>
 array:</p>
<div class="box">
<pre>    <span class="ash">var birthdays = [Birthday]()</span>
<br />
<br />
    <span class="pink">let</span>
 dateFormatter = <span class="violet">DateFormatter</span>
 ()<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent">Note that the <span class="code">dateFormatter</span>
 is a constant that is created with <span class="code">let</span>
 . Even though you’ll change the <span class="code">dateFormatter</span>
 ’s properties, like the <span class="code">dateStyle</span>
 and <span class="code">timeStyle</span>
 , you’ll never change the <span class="code">dateFormatter</span>
 itself.</p>
<p class="indent"><span id="page_162"></span>
 You’ll also need to set up the <span class="code">dateFormatter</span>
 so that it will display the birthdates as fully formatted strings like <span class="code">"Tuesday, December 17, 2008"</span>
 . As you saw in <a href="text00021.html#ch10">Chapter 10</a>
 , a good place to do this is the <span class="code">viewDidLoad()</span>
 method, which is called when the Birthdays table view controller is loading its view. This is the perfect place to do any setup that is needed for this class.</p>
<div class="box">
<pre>
<span class="ash">override func viewDidLoad() {</span>
<br />
    <span class="ash">super.viewDidLoad()</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">dateFormatter</span>
 .<span class="violet">dateStyle</span>
 = .<span class="blue">full</span>
<br />
  <span class="ent">➋</span>
 <span class="green1">dateFormatter</span>
 .<span class="violet">timeStyle</span>
 = .<span class="blue">none</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , you set the <span class="code">dateStyle</span>
 of the <span class="code">dateFormatter</span>
 so that it will display a formatted date string for each <span class="code">Birthday</span>
 . Did you notice how we just wrote <span class="code">.full</span>
 instead of <span class="code">DateFormatter.Style.full</span>
 ? Swift knows what type to expect for the <span class="code">dateStyle</span>
 of a <span class="code">DateFormatter</span>
 , so it lets us take this little shortcut. At <span class="ent">➋</span>
 , you set the <span class="code">timeStyle</span>
 of the <span class="code">dateFormatter</span>
 to <span class="code">.none</span>
 so that the time won’t be shown.</p>
<h4 class="h4" id="ch11lev2sec4">
<strong>DISPLAYING BIRTHDAYS IN A TABLE VIEW</strong>
</h4>
<p class="noindent">The <span class="code">BirthdaysTableViewController</span>
 class has a table view that is used to display a list of items in a single column. The table view has one or more sections containing rows, and each row contains a cell. A section in a table view is a grouping of rows that can be displayed with or without a header. An example of an app that shows a table view with several sections is the Settings app, as shown in <a href="text00022.html#ch11fig5">Figure 11-5</a>
 . It displays a list of rows that have been broken up into different sections.</p>
<p class="indent">Each section and row of a table view is identified with an index number. These numbers start at 0 and then increase by 1 as you go down the table view. For example, the Privacy line in the Settings app is found at section 0, row 1. The News setting is at section 1, row 3.</p>
<p class="indent">In the middle of the <span class="code">BirthdaysTableViewController</span>
 class, there is a section called <em>Table view data source</em>
 with three methods. The table view controller uses these methods to determine what’s going to be displayed inside its table view.</p>
<p class="hang">
<span class="code">
<span class="codestrong">numberOfSections(in:)</span>
</span>
 Tells the table view how many sections it should have</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:numberOfRowsInSection:)</span>
</span>
 Tells the table view how many rows will be displayed in each section</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:cellForRowAt:)</span>
</span>
 Sets up each cell that’s going to be displayed in each row of the table view</p>
<div class="image"><span id="page_163"></span>
 <img src="Image00243.jpg" />
</div>
<p class="figcap"><a id="ch11fig5"></a>
 <em>Figure 11-5: The Settings app uses sections to group rows of different device settings.</em>
</p>
<p class="indent">The table view data source methods are called by the table view controller every time the table view is reloaded. Xcode automatically gives you these method templates when you make a subclass of a <span class="code">UITableViewController</span>
 . You need to implement all three methods for the app to work, even though you’ll never call them directly in your code. The <span class="code">UITableViewController</span>
 class implements the <span class="code">UITableViewDataSource</span>
 protocol, which comes with these data source methods, to determine what will be displayed inside the table view. We’ll discuss protocols in “<a href="text00022.html#ch11lev2sec5">Delegation</a>
 ” on page 166. For now, you just need to know that a <span class="code">UITableViewController</span>
 uses these methods to display its content, and it automatically calls these methods so you don’t need to call them.</p>
<p class="indent">Let’s start with the method <span class="code">numberOfSections(in:)</span>
 . The Birthdays table view controller is a list that just displays <span class="code">Birthday</span>
 instances, so it doesn’t need multiple sections. To set the number of sections in the table view, we just need to return <span class="code">1</span>
 .</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func numberOfSections(in tableView: UITableView) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 <span class="blue1">1</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent"><span id="page_164"></span>
 This method takes a <span class="code">UITableView</span>
 called <span class="code">tableView</span>
 as a parameter, which is the table view that uses this class as its data source. We don’t need to worry about making this connection because the <span class="code">UITableViewController</span>
 comes with a built-in table view that is automatically hooked up to these methods. Each birthday will be displayed in its own row. So in <span class="code">tableView(_:numberOfRowsInSection:)</span>
 , in order to have the right number of rows for all of your birthdays, you need to return the number of <span class="code">Birthday</span>
 instances that you have in your <span class="code">birthdays</span>
 array. Do you remember the <span class="code">count</span>
 property of an array? It’s an integer that tells you how many items are in that array, and it’s perfect for this situation! Change this method to the following:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, <img class="inline" src="Image00184.jpg" />
<br />
    numberOfRowsInSection section: Int) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 birthdays.<span class="violet">count</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">In addition to the <span class="code">tableView</span>
 parameter, <span class="code">tableView(_:numberOfRowsInSection:)</span>
 also takes an <span class="code">Int</span>
 called <span class="code">section</span>
 . When the table view is loading itself, this method is called for each section in the table view. In our case, we have only one section, so we don’t need to bother checking which <span class="code">section</span>
 of the table view is being displayed here. We know it’s section 0, and we want it to have as many rows as there are birthdays, so we write <span class="code">return birthdays.count</span>
 .</p>
<p class="indent">Finally, you need to implement <span class="code">tableView(_:cellForRowAt:)</span>
 so that the table view will know what to put inside each cell. Since this method is commented out, you need to uncomment it by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it. (Be careful not to accidentally uncomment the other methods after it!) After you’ve done that, change it to the following code:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, cellForRowAt <img class="inline" src="Image00184.jpg" />
<br />
    indexPath: IndexPath) -&gt; UITableViewCell {</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="pink">let</span>
 cell = tableView.<span class="blue">dequeueReusableCell</span>
 (withIdentifier: <img class="inline" src="Image00093.jpg" />
<br />
        <span class="red">"birthdayCellIdentifier"</span>
 , for: indexPath)<br />
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 birthday = <span class="green1">birthdays</span>
 [indexPath.<span class="violet">row</span>
 ]<br />
<br />
  <span class="ent">➌</span>
 cell.<span class="violet">textLabel</span>
 ?.<span class="violet">text</span>
 = birthday.<span class="green1">firstName</span>
 <span class="blue">+</span>
 <span class="red">" "</span>
 <span class="blue">+</span>
 <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">lastName</span>
<br />
<br />
  <span class="ent">➍</span>
 cell.<span class="violet">detailTextLabel</span>
 ?.<span class="violet">text</span>
 = <span class="green1">dateFormatter</span>
 .<span class="blue">string</span>
 (from: <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">birthdate</span>
 )<br />
<br />
  <span class="ent">➎</span>
 <span class="pink">return</span>
 cell<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">You don’t call the method <span class="code">tableView(_:cellForRowAt:)</span>
 . It’s called when the table view is loaded onto the screen. It’s called for each cell on the screen and takes two parameters, <span class="code">tableView</span>
 and <span class="code">indexPath</span>
 . You already know <span id="page_165"></span>
 what the <span class="code">tableView</span>
 parameter is for. An <span class="code">IndexPath</span>
 is a Swift struct that’s used to represent a row’s position in a table view. An <span class="code">IndexPath</span>
 instance has a <span class="code">section</span>
 property and a <span class="code">row</span>
 property. Since this method will be called many times (once for every row in the table), we need the <span class="code">indexPath</span>
 to know which section and row we’re currently configuring. The <span class="code">indexPath.section</span>
 property gives the section number, and the <span class="code">indexPath.row</span>
 gives the row of the table view cell. The five lines of code inside <span class="code">tableView(_:cellForRowAt:)</span>
 will do the following:</p>
<div class="image"><img src="Image00244.jpg" />
</div>
<p class="bull">• Create a <span class="code">UITableViewCell</span>
</p>
<p class="bull">• Figure out which <span class="code">Birthday</span>
 in the <span class="code">birthdays</span>
 array will be displayed inside the cell</p>
<p class="bull">• Make two labels to display the birthday person’s name and birthdate in the cell</p>
<p class="bull">• Return the cell ready for display in the table view</p>
<p class="indentt">Let’s go through this code line by line.</p>
<p class="indent">First, create the <span class="code">UITableViewCell</span>
 . The code at <span class="ent">➊</span>
 does this using the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 . Before you can start using this method on a cell, though, you need to tell the method which cell you want to use from the storyboard. Earlier, when you were in the storyboard, you gave your cell the identifier <span class="code">birthdayCellIdentifier</span>
 (see <a href="text00022.html#ch11fig4">Figure 11-4</a>
 ). This identifier links your code to the cell and tells your method that it’s using the right cell. The string for when you call this method needs to be exactly the same as the string you set in the storyboard, or you’ll get an error and the app will crash when you run it.</p>
<p class="indent">In the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 , did you notice the words <em>Reusable Cell</em>
 ? The cells inside a table view are created once and then can be reused over and over. This helps everything run faster and smoother because creating the cell is what takes the most time. If you had 200 birthdays in your app, but only 10 would fit on your screen at one time, then you need only 10 cells to show your birthdays. When you scroll down to reveal more birthdays, the cells that scroll off the top of the screen are reused. They are filled with new information and show up again at the bottom of the screen. The <span class="code">UITableView</span>
 automatically does this work. When the table view is loaded, <span class="code">tableView(_:cellForRowAt:)</span>
 is called for every visible row. When the user scrolls to look at more cells, it’s called again for each row just as it is about to appear on the screen.</p>
<p class="indent">Next, we need to find out which <span class="code">Birthday</span>
 should be displayed inside the cell. We want to display one birthday from the <span class="code">birthdays</span>
 array in each row. The first birthday, which is at <span class="code">birthdays[0]</span>
 , should be displayed in row 0. The second birthday, at <span class="code">birthdays[1]</span>
 , should be displayed in row 1, and so on, which means the <span class="code">indexPath</span>
 ’s <span class="code">row</span>
 is the same as the position in the <span class="code">birthdays</span>
 array that we want to access. The code at <span class="ent">➋</span>
 accesses the <span id="page_166"></span>
 correct <span class="code">Birthday</span>
 object from the <span class="code">birthdays</span>
 array by using <span class="code">indexPath.row</span>
 . Once we have the right <span class="code">Birthday</span>
 object, we assign it to a constant named <span class="code">birthday</span>
 so we can set up the labels in this cell.</p>
<p class="indent">Notice that we’re using <span class="code">let</span>
 to assign the <span class="code">birthday</span>
 to a constant instead of a variable. We can use <span class="code">let</span>
 because each time <span class="code">tableView(_:cellForRowAt:)</span>
 is called, a new <span class="code">birthday</span>
 constant is created. Each cell gets its own <span class="code">birthday</span>
 constant that is assigned its own <span class="code">Birthday</span>
 object. Since we’re not going to change any of the <span class="code">birthday</span>
 constants—we’re just going to read their properties—we don’t want to make them variables.</p>
<p class="indent">Now that you have your cell and your birthday, it’s time to fill in the details. You need two labels for each cell to show the birthday person’s name and birthdate. You set the cell to the Subtitle style so that it has a Title label and a Subtitle label. Each cell will already contain these labels, so now you don’t have to create any labels yourself.</p>
<p class="indent">The labels exist as properties of <span class="code">UITableViewCell</span>
 and are called <span class="code">textLabel</span>
 and <span class="code">detailTextLabel</span>
 . The code at <span class="ent">➌</span>
 sets the text of the <span class="code">textLabel</span>
 to a string made up of the <span class="code">firstName</span>
 and <span class="code">lastName</span>
 of the <span class="code">birthday</span>
 with a space between them. At <span class="ent">➍</span>
 , you use the <span class="code">string(from:)</span>
 method of the <span class="code">dateFormatter</span>
 to display the birthdate in the <span class="code">detailTextLabel</span>
 .</p>
<p class="indent">When your cell is completely configured, <span class="code">tableView( _:cellForRowAt:)</span>
 returns the cell at <span class="ent">➎</span>
 so that it can be displayed at that <span class="code">indexPath</span>
 of the table view.</p>
<h3 class="h3" id="ch11lev1sec2">
<strong>PUTTING IT ALL TOGETHER</strong>
</h3>
<p class="noindent">Now you can add <span class="code">Birthday</span>
 instances to the app using the Add Birthday view controller, and you have a table view to list each <span class="code">Birthday</span>
 in the Birthdays table view controller. But when you try running the app and adding a <span class="code">Birthday</span>
 , it doesn’t appear. To make each <span class="code">Birthday</span>
 you add appear in the table view, you need to make the Add Birthday view controller communicate with the Birthdays table view controller. You do this by using <em>delegation</em>
 .</p>
<h4 class="h4" id="ch11lev2sec5">
<strong>DELEGATION</strong>
</h4>
<p class="noindent">Delegation can be used when one view controller needs to get information from another view controller. Say you have two view controllers: A and B. The first view controller, A, creates B and presents B on top of itself. A knows about B because it created and presented B, so A can pass information along to B. But B doesn’t know about A—it’s just popped into being and doesn’t know where it came from or how it got there. So how can B talk to A? Through delegation!</p>
<div class="image"><img src="Image00245.jpg" />
</div>
<p class="indent">Delegation is when someone gives a job or a task to someone else. A <em>delegate</em>
 is like a boss who tells a delegating employee what to do. When the delegating employee is done with their task, sometimes they’ll report information back to the delegate boss.</p>
<p class="indent"><span id="page_167"></span>
 Delegation in Swift is pretty similar, but instead of having a boss and employee, we have a delegate and a delegating object. Since class B is the one being told what to do by class A, it’s the delegating object. We give class B a special property called a delegate to tell it who its delegate is—that way, it knows who to communicate with. The delegate can be any class that has a set of methods that have been defined in a <em>protocol</em>
 . A protocol is like an agreement between the two classes that tells them what the delegate can ask the delegating object to do. It has a list of method and property names that the delegate can use with the delegating object.</p>
<p class="indent">Class A creates class B, makes itself the delegate of class B, and gives class B a job to do that’s in the protocol. Once class B is done with its job, it reports back to class A. Let’s see how this works in our app.</p>
<p class="indent">The Birthdays table view controller is view controller A, and the Add Birthday view controller is view controller B. We’ll create a protocol called <span class="code">AddBirthdayViewControllerDelegate</span>
 and a method for that protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 , which the Add Birthday view controller will use to report back.</p>
<p class="indent">Take a look at <a href="text00022.html#ch11fig6">Figure 11-6</a>
 . When the user taps the Add button <span class="ent">➊</span>
 , the Birthdays table view controller creates the Add Birthday view controller <span class="ent">➋</span>
 and sets itself as the Add Birthday view controller’s delegate.</p>
<div class="image"><img src="Image00246.jpg" />
</div>
<p class="figcap"><a id="ch11fig6"></a>
 <em>Figure 11-6: A new birthday is added and passed from the Add Birthday view controller to the Birthdays table view controller using delegation.</em>
</p>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<h2 class="h2a">
<strong>DISPLAYING BIRTHDAYS</strong>
</h2>
<div class="image1"><img src="Image00001.jpg" />
</div>
<p class="noindent">Time to show off those birthdays! In <a href="text00021.html#ch10">Chapter 10</a>
 , you created the Add Birthday view controller so that you could add new <span class="code">Birthday</span>
 objects into your app with the <span class="code">Birthday</span>
 class. In this chapter, you’ll create a Birthdays table view controller that can display your added birthdays in a <em>table view</em>
 , which shows a list of items the user can scroll through and select. Then you’ll learn how to make the Add Birthday view controller tell the Birthdays table view controller when a <span class="code">Birthday</span>
 object is added so that the new birthday can be shown in the table view.</p>
<h3 class="h3" id="ch11lev1sec1">
<strong>MAKING THE BIRTHDAY LIST</strong>
</h3>
<p class="noindent">It’s one thing to be able to add birthdays, but you’ll also want to display a list of birthdays. For that you need to create another class, <span class="code">BirthdaysTableViewController</span>
 , which will subclass <span class="code">UITableViewController</span>
 , <span id="page_156"></span>
 a special kind of view controller with a table view. <span class="code">UITableViewController</span>
 contains several built-in methods that allow you to code things like how many rows the table view should have and what should be displayed in each row. We’ll want to have as many rows as we have birthdays and to display one birthday in each row.</p>
<h4 class="h4" id="ch11lev2sec1">
<strong>CREATING THE BIRTHDAYS TABLE VIEW CONTROLLER</strong>
</h4>
<p class="noindent">
<span class="smallcaps">CONTROL</span>
 -click the <em>BirthdayTracker</em>
 folder in the Project navigator and choose <strong>New File…</strong>
 from the menu. In <a href="text00021.html#ch10">Chapter 10</a>
 , we created the Swift file <em>Birthday.swift</em>
 , which Xcode prepared for us with nearly nothing in it. To create a new file this time, we’ll tell Xcode we want to subclass an existing iOS class. Depending on the base class, Xcode will create a file containing some code that you’ll customize to your needs. To create the file, select <strong>iOS</strong>
 at the top of the window and then select the <strong>Cocoa Touch Class</strong>
 template, which will automatically format the new class file (see <a href="text00022.html#ch11fig1">Figure 11-1</a>
 ).</p>
<div class="image"><img src="Image00234.jpg" />
</div>
<p class="figcap"><a id="ch11fig1"></a>
 <em>Figure 11-1: To subclass an existing class, choose</em>
 <strong>
<em>iOS</em>
</strong>
 <em>and then</em>
 <strong>
<em>Cocoa Touch Class.</em>
</strong>
</p>
<p class="indent">When you choose this option, you’ll see a second dialog where you can name your new class and specify which class you’ll subclass. First, in the Subclass field (the second field in the dialog), type <span class="code">
<span class="codestrong">UITableViewController</span>
</span>
 . This will automatically fill in the class field with the subclass name. Once that happens, type <span class="code">
<span class="codestrong">Birthdays</span>
</span>
 in front of <span class="code">TableViewController</span>
 so that the whole class name is <span class="code">BirthdaysTableViewController</span>
 . This is a shortcut so you don’t <span id="page_157"></span>
 have to type as much. Make sure to choose <strong>Swift</strong>
 in the Language drop-down menu as well, and then click <strong>Next</strong>
 . Then select <strong>Create</strong>
 in the final dialog to create your new file.</p>
<p class="indent">In <em>BirthdaysTableViewController.swift</em>
 , Xcode has provided a template with several commented-out methods. You can clean up the code by getting rid of methods we won’t use. Delete just the comments in <span class="code">viewDidLoad()</span>
 , and then delete the entire <span class="code">didReceiveMemoryWarning()</span>
 method and the methods <span class="code">tableView(_:moveRowAt:to:)</span>
 and <span class="code">tableView(_:canMoveRowAt:)</span>
 , which have to do with moving rows in the table view. When you’re finished, the contents of <span class="code">BirthdaysTableViewController</span>
 should look like <a href="text00022.html#ch11fig2">Figure 11-2</a>
 . There are still several commented-out methods, but we’re keeping those to use later!</p>
<div class="image"><img src="Image00235.jpg" />
</div>
<p class="figcap"><a id="ch11fig2"></a>
 <em>Figure 11-2: The</em>
 <span class="code">
<span class="italic">BirthdaysTableViewController</span>
</span>
 <em>cleaned up!</em>
</p>
<p class="indent">Next, you need to make the Birthdays table view controller the <span class="code">BirthdaysTableViewController</span>
 class. To do this, go to <em>Main.storyboard</em>
 and select the <strong>Birthdays</strong>
 scene. Using the Identity Inspector in the right pane, change the class from <span class="code">UITableViewController</span>
 to <span class="code">BirthdaysTableViewController</span>
 , as shown in <a href="text00022.html#ch11fig3">Figure 11-3</a>
 .</p>
<div class="image"><span id="page_158"></span>
 <img src="Image00236.jpg" />
</div>
<p class="figcap"><a id="ch11fig3"></a>
 <em>Figure 11-3: Setting</em>
 <span class="code">
<span class="italic">BirthdaysTableViewController</span>
</span>
 <em>as the class of the Birthdays scene</em>
</p>
<p class="indent">Now that you have the Birthdays table view controller set up in the storyboard, the next step is to make cells in your table that will display each birthday.</p>
<h4 class="h4" id="ch11lev2sec2">
<strong>ADDING CELLS TO THE TABLE VIEW</strong>
</h4>
<p class="noindent">Each birthday will be displayed in a <span class="code">UITableViewCell</span>
 in the Birthdays table view controller. A table has boxes organized into rows and columns that contain information. These boxes are called <em>cells</em>
 . Similarly, a table view also has cells that are all instances of, or a subclass of, the <span class="code">UITableViewCell</span>
 class. We’ll put each birthday into its own cell in our table view.</p>
<p class="indent">We’ll start by creating those cells in the storyboard, and then we’ll fill them with our <span class="code">Birthday</span>
 objects later. In the left outline menu, click the triangle by Birthdays and then click the triangle by Table View to open those sections. Then select <strong>Table View Cell</strong>
 <span class="ent">➊</span>
 , as shown in <a href="text00022.html#ch11fig4">Figure 11-4</a>
 .</p>
<div class="image"><img src="Image00237.jpg" />
</div>
<div class="image"><img src="Image00238.jpg" />
</div>
<p class="figcap"><a id="ch11fig4"></a>
 <em>Figure 11-4: Creating a Subtitle style table view cell and setting its identifier</em>
</p>
<p class="indent"><span id="page_159"></span>
 Next, open the Attributes Inspector. Using the drop-down menu under <strong>Style</strong>
 , set the cell’s style to <strong>Subtitle</strong>
 <span class="ent">➋</span>
 so that the cell now has a Title label and a Subtitle label. You’ll display each person’s name in the Title and birthday in the Subtitle.</p>
<p class="indent">Finally, enter <span class="code">
<span class="codestrong">birthdayCellIdentifier</span>
</span>
 in the Identifier field <span class="ent">➌</span>
 . You’ll use this identifier later when you fill in the cell contents.</p>
<p class="indent">That’s it! You’ve finished your work in the storyboard.</p>
<p class="indent">You may be wondering why we have just one cell in our table view in the storyboard when we’ll have more than one birthday to show in the list. If you look at <a href="text00022.html#ch11fig4">Figure 11-4</a>
 again, you’ll notice that the cell is labeled <em>Prototype Cells</em>
 . This means that the cell you just customized is a <em>template</em>
 for all the cells you want to appear in your table view. The identifier you gave the cell is how your code will tell the table view to produce each cell for you to put birthdays in. You’ll see how this works soon.</p>
<div class="box1">
<p class="box-title">
<strong>WORKING WITH DATES</strong>
</p>
<p class="box-p">Swift has a special data type called <span class="code">Date</span>
 that is used for storing date values. A <span class="code">Date</span>
 object is actually a date and a time. Open your playground and enter the following:</p>
<div class="image"><img src="Image00239.jpg" />
</div>
<p class="box-pi">We’ve just assigned the current date and time the code was run to the variable <span class="code">today</span>
 . When you print <span class="code">today</span>
 , it’s in the format <span class="code">"2017-11-21 10:45:31 +0000\n"</span>
 . What if you wanted it to display as <span class="code">Tuesday, November 21, 2017</span>
 , instead? Or just <span class="code">11/21/17</span>
 ? To display a date in a particular way, you use a <em>date formatter</em>
 , which is a <span class="code">DateFormatter</span>
 object that you create and give a date format style. <span class="code">DateFormatter</span>
 is a helper object that is used to create a display string from any date, and a <em>date format style</em>
 is a property of <span class="code">DateFormatter</span>
 that tells the formatter what style to use. You can create your own date format styles manually, but there are also styles that are included in Swift and ready to use. Add the following to your playground:</p>
<div class="image"><img src="Image00240.jpg" />
</div>
<p class="box-pi">At <span class="ent">➊</span>
 you create a <span class="code">formatter</span>
 . Then at <span class="ent">➋</span>
 , you set the style of the <span class="code">formatter</span>
 to <span class="code">Style.full</span>
 , which will print the day of the week as well as the full month name, date, and year. Finally, you create a string from the date using the <span class="code">string(from:)</span>
 method of the <span class="code">DateFormatter</span>
 class <span class="ent">➌</span>
 . You can see that you now have turned the <span id="page_160"></span>
 date into the nicely formatted string <span class="code">"Tuesday, November 21, 2017"</span>
 . <a style=";color:black;" href="text00022.html#ch11tab1">Table 11-1</a>
 shows the different strings that are created from the five <span class="code">DateFormatter.Style</span>
 options available in Swift.</p>
<p class="tabcap"><a id="ch11tab1" style=";color:black;"></a>
 <strong>Table 11-1:</strong>
 Date Formatter Styles and Their Date Strings</p>
<table class="tabled">
<tbody>
<tr>
<td style="vertical-align: top;" class="border1">
<p class="noindent">
<span class="code">
<span class="codestrong">DateFormatter.Style</span>
</span>
</p>
</td>
<td style="vertical-align: top;" class="border1">
<p class="noindent">
<strong>Date string</strong>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">none</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">""</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">short</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"11/21/17"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">medium</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"Nov 21, 2017"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">long</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"November 21, 2017"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">full</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"Tuesday, November 21, 2017"</span>
</p>
</td>
</tr>
</tbody>
</table>
<p class="box-pi">You can also specify your own custom way of displaying a date using the <span class="code">dateFormat</span>
 property of the <span class="code">DateFormatter</span>
 . Perhaps you only want the month and day. Or maybe you want a four-digit year displayed in the <span class="code">short</span>
 style. Doing either is really easy, and you don’t even have to create a new <span class="code">DateFormatter</span>
 —you can just change the <span class="code">dateFormat</span>
 on <span class="code">formatter</span>
 and then ask it for a new string. Add the following code to your playground to display dates with a specific format:</p>
<div class="image"><img src="Image00241.jpg" />
</div>
<p class="box-pi">At <span class="ent">➊</span>
 , you specify that you only want the month and the date in an <span class="code">MM/dd</span>
 format—that is, a two-digit month followed by a two-digit date. If you want to display the month as three letters, then use <span class="code">MMM</span>
 . To display the full name of the month, use <span class="code">MMMM</span>
 . At <span class="ent">➋</span>
 , we change the date format to use a four-digit year. A two-digit year would be <span class="code">yy</span>
 . Here are a few other ways to use a <span class="code">dateFormat</span>
 to display a custom date string.</p>
<div class="image"><img src="Image00242.jpg" />
</div>
<p class="box-pi"><span id="page_161"></span>
 If you want to include separators, you add them to your <span class="code">dateFormat</span>
 string. For example, if you want periods as separators, then you can create a <span class="code">dateFormat</span>
 like <span class="code">"MM.dd.yy"</span>
 <span class="ent">➊</span>
 . To display an abbreviated day of the week, use <span class="code">EEE</span>
 <span class="ent">➋</span>
 . For the full day, use <span class="code">EEEE</span>
 <span class="ent">➌</span>
 . These are only a few examples. By using combinations of <span class="code">M</span>
 , <span class="code">d</span>
 , <span class="code">y</span>
 , and <span class="code">E</span>
 , you have an endless number of ways to display a date!</p>
</div>
<h4 class="h4" id="ch11lev2sec3">
<strong>SETTING UP THE BIRTHDAYS TABLE VIEW CONTROLLER</strong>
</h4>
<p class="noindent">The Birthdays table view controller will display a list of all the birthdays stored in the app. Do you remember what you use to store a list of items? That’s right—an array! You’ll create an array in the <span class="code">BirthdaysTableViewController</span>
 to store all the birthdays. To do this, give the <span class="code">BirthdaysTableViewController</span>
 a <span class="code">birthdays</span>
 property that is an array of <span class="code">Birthday</span>
 objects. At the top of the class, right above the <span class="code">viewDidLoad()</span>
 method, insert this line to add a variable array property called <span class="code">birthdays</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController {</span>
<br />
<br />
    <span class="pink">var</span>
 birthdays = [<span class="green1">Birthday</span>
 ]()<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent">This line creates an empty array of <span class="code">Birthday</span>
 instances. It needs to be a variable and not a constant because you’ll want to add a saved <span class="code">Birthday</span>
 to this array every time the user adds a <span class="code">Birthday</span>
 with the Add Birthday view controller. You’ll see how to do that in “<a href="text00022.html#ch11lev3sec2">Making the Birthdays Table View Controller Conform to Protocol</a>
 ” on <a href="text00022.html#page_168">page 168</a>
 .</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>Remember that the final versions of the project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>.</em>
</p>
</div>
<p class="indent">The <span class="code">BirthdaysTableViewController</span>
 will also need a <span class="code">dateFormatter</span>
 property to display the birthdate as a nicely formatted string. Add a <span class="code">dateFormatter</span>
 right underneath the <span class="code">birthdays</span>
 array:</p>
<div class="box">
<pre>    <span class="ash">var birthdays = [Birthday]()</span>
<br />
<br />
    <span class="pink">let</span>
 dateFormatter = <span class="violet">DateFormatter</span>
 ()<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent">Note that the <span class="code">dateFormatter</span>
 is a constant that is created with <span class="code">let</span>
 . Even though you’ll change the <span class="code">dateFormatter</span>
 ’s properties, like the <span class="code">dateStyle</span>
 and <span class="code">timeStyle</span>
 , you’ll never change the <span class="code">dateFormatter</span>
 itself.</p>
<p class="indent"><span id="page_162"></span>
 You’ll also need to set up the <span class="code">dateFormatter</span>
 so that it will display the birthdates as fully formatted strings like <span class="code">"Tuesday, December 17, 2008"</span>
 . As you saw in <a href="text00021.html#ch10">Chapter 10</a>
 , a good place to do this is the <span class="code">viewDidLoad()</span>
 method, which is called when the Birthdays table view controller is loading its view. This is the perfect place to do any setup that is needed for this class.</p>
<div class="box">
<pre>
<span class="ash">override func viewDidLoad() {</span>
<br />
    <span class="ash">super.viewDidLoad()</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">dateFormatter</span>
 .<span class="violet">dateStyle</span>
 = .<span class="blue">full</span>
<br />
  <span class="ent">➋</span>
 <span class="green1">dateFormatter</span>
 .<span class="violet">timeStyle</span>
 = .<span class="blue">none</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , you set the <span class="code">dateStyle</span>
 of the <span class="code">dateFormatter</span>
 so that it will display a formatted date string for each <span class="code">Birthday</span>
 . Did you notice how we just wrote <span class="code">.full</span>
 instead of <span class="code">DateFormatter.Style.full</span>
 ? Swift knows what type to expect for the <span class="code">dateStyle</span>
 of a <span class="code">DateFormatter</span>
 , so it lets us take this little shortcut. At <span class="ent">➋</span>
 , you set the <span class="code">timeStyle</span>
 of the <span class="code">dateFormatter</span>
 to <span class="code">.none</span>
 so that the time won’t be shown.</p>
<h4 class="h4" id="ch11lev2sec4">
<strong>DISPLAYING BIRTHDAYS IN A TABLE VIEW</strong>
</h4>
<p class="noindent">The <span class="code">BirthdaysTableViewController</span>
 class has a table view that is used to display a list of items in a single column. The table view has one or more sections containing rows, and each row contains a cell. A section in a table view is a grouping of rows that can be displayed with or without a header. An example of an app that shows a table view with several sections is the Settings app, as shown in <a href="text00022.html#ch11fig5">Figure 11-5</a>
 . It displays a list of rows that have been broken up into different sections.</p>
<p class="indent">Each section and row of a table view is identified with an index number. These numbers start at 0 and then increase by 1 as you go down the table view. For example, the Privacy line in the Settings app is found at section 0, row 1. The News setting is at section 1, row 3.</p>
<p class="indent">In the middle of the <span class="code">BirthdaysTableViewController</span>
 class, there is a section called <em>Table view data source</em>
 with three methods. The table view controller uses these methods to determine what’s going to be displayed inside its table view.</p>
<p class="hang">
<span class="code">
<span class="codestrong">numberOfSections(in:)</span>
</span>
 Tells the table view how many sections it should have</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:numberOfRowsInSection:)</span>
</span>
 Tells the table view how many rows will be displayed in each section</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:cellForRowAt:)</span>
</span>
 Sets up each cell that’s going to be displayed in each row of the table view</p>
<div class="image"><span id="page_163"></span>
 <img src="Image00243.jpg" />
</div>
<p class="figcap"><a id="ch11fig5"></a>
 <em>Figure 11-5: The Settings app uses sections to group rows of different device settings.</em>
</p>
<p class="indent">The table view data source methods are called by the table view controller every time the table view is reloaded. Xcode automatically gives you these method templates when you make a subclass of a <span class="code">UITableViewController</span>
 . You need to implement all three methods for the app to work, even though you’ll never call them directly in your code. The <span class="code">UITableViewController</span>
 class implements the <span class="code">UITableViewDataSource</span>
 protocol, which comes with these data source methods, to determine what will be displayed inside the table view. We’ll discuss protocols in “<a href="text00022.html#ch11lev2sec5">Delegation</a>
 ” on page 166. For now, you just need to know that a <span class="code">UITableViewController</span>
 uses these methods to display its content, and it automatically calls these methods so you don’t need to call them.</p>
<p class="indent">Let’s start with the method <span class="code">numberOfSections(in:)</span>
 . The Birthdays table view controller is a list that just displays <span class="code">Birthday</span>
 instances, so it doesn’t need multiple sections. To set the number of sections in the table view, we just need to return <span class="code">1</span>
 .</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func numberOfSections(in tableView: UITableView) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 <span class="blue1">1</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent"><span id="page_164"></span>
 This method takes a <span class="code">UITableView</span>
 called <span class="code">tableView</span>
 as a parameter, which is the table view that uses this class as its data source. We don’t need to worry about making this connection because the <span class="code">UITableViewController</span>
 comes with a built-in table view that is automatically hooked up to these methods. Each birthday will be displayed in its own row. So in <span class="code">tableView(_:numberOfRowsInSection:)</span>
 , in order to have the right number of rows for all of your birthdays, you need to return the number of <span class="code">Birthday</span>
 instances that you have in your <span class="code">birthdays</span>
 array. Do you remember the <span class="code">count</span>
 property of an array? It’s an integer that tells you how many items are in that array, and it’s perfect for this situation! Change this method to the following:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, <img class="inline" src="Image00184.jpg" />
<br />
    numberOfRowsInSection section: Int) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 birthdays.<span class="violet">count</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">In addition to the <span class="code">tableView</span>
 parameter, <span class="code">tableView(_:numberOfRowsInSection:)</span>
 also takes an <span class="code">Int</span>
 called <span class="code">section</span>
 . When the table view is loading itself, this method is called for each section in the table view. In our case, we have only one section, so we don’t need to bother checking which <span class="code">section</span>
 of the table view is being displayed here. We know it’s section 0, and we want it to have as many rows as there are birthdays, so we write <span class="code">return birthdays.count</span>
 .</p>
<p class="indent">Finally, you need to implement <span class="code">tableView(_:cellForRowAt:)</span>
 so that the table view will know what to put inside each cell. Since this method is commented out, you need to uncomment it by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it. (Be careful not to accidentally uncomment the other methods after it!) After you’ve done that, change it to the following code:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, cellForRowAt <img class="inline" src="Image00184.jpg" />
<br />
    indexPath: IndexPath) -&gt; UITableViewCell {</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="pink">let</span>
 cell = tableView.<span class="blue">dequeueReusableCell</span>
 (withIdentifier: <img class="inline" src="Image00093.jpg" />
<br />
        <span class="red">"birthdayCellIdentifier"</span>
 , for: indexPath)<br />
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 birthday = <span class="green1">birthdays</span>
 [indexPath.<span class="violet">row</span>
 ]<br />
<br />
  <span class="ent">➌</span>
 cell.<span class="violet">textLabel</span>
 ?.<span class="violet">text</span>
 = birthday.<span class="green1">firstName</span>
 <span class="blue">+</span>
 <span class="red">" "</span>
 <span class="blue">+</span>
 <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">lastName</span>
<br />
<br />
  <span class="ent">➍</span>
 cell.<span class="violet">detailTextLabel</span>
 ?.<span class="violet">text</span>
 = <span class="green1">dateFormatter</span>
 .<span class="blue">string</span>
 (from: <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">birthdate</span>
 )<br />
<br />
  <span class="ent">➎</span>
 <span class="pink">return</span>
 cell<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">You don’t call the method <span class="code">tableView(_:cellForRowAt:)</span>
 . It’s called when the table view is loaded onto the screen. It’s called for each cell on the screen and takes two parameters, <span class="code">tableView</span>
 and <span class="code">indexPath</span>
 . You already know <span id="page_165"></span>
 what the <span class="code">tableView</span>
 parameter is for. An <span class="code">IndexPath</span>
 is a Swift struct that’s used to represent a row’s position in a table view. An <span class="code">IndexPath</span>
 instance has a <span class="code">section</span>
 property and a <span class="code">row</span>
 property. Since this method will be called many times (once for every row in the table), we need the <span class="code">indexPath</span>
 to know which section and row we’re currently configuring. The <span class="code">indexPath.section</span>
 property gives the section number, and the <span class="code">indexPath.row</span>
 gives the row of the table view cell. The five lines of code inside <span class="code">tableView(_:cellForRowAt:)</span>
 will do the following:</p>
<div class="image"><img src="Image00244.jpg" />
</div>
<p class="bull">• Create a <span class="code">UITableViewCell</span>
</p>
<p class="bull">• Figure out which <span class="code">Birthday</span>
 in the <span class="code">birthdays</span>
 array will be displayed inside the cell</p>
<p class="bull">• Make two labels to display the birthday person’s name and birthdate in the cell</p>
<p class="bull">• Return the cell ready for display in the table view</p>
<p class="indentt">Let’s go through this code line by line.</p>
<p class="indent">First, create the <span class="code">UITableViewCell</span>
 . The code at <span class="ent">➊</span>
 does this using the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 . Before you can start using this method on a cell, though, you need to tell the method which cell you want to use from the storyboard. Earlier, when you were in the storyboard, you gave your cell the identifier <span class="code">birthdayCellIdentifier</span>
 (see <a href="text00022.html#ch11fig4">Figure 11-4</a>
 ). This identifier links your code to the cell and tells your method that it’s using the right cell. The string for when you call this method needs to be exactly the same as the string you set in the storyboard, or you’ll get an error and the app will crash when you run it.</p>
<p class="indent">In the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 , did you notice the words <em>Reusable Cell</em>
 ? The cells inside a table view are created once and then can be reused over and over. This helps everything run faster and smoother because creating the cell is what takes the most time. If you had 200 birthdays in your app, but only 10 would fit on your screen at one time, then you need only 10 cells to show your birthdays. When you scroll down to reveal more birthdays, the cells that scroll off the top of the screen are reused. They are filled with new information and show up again at the bottom of the screen. The <span class="code">UITableView</span>
 automatically does this work. When the table view is loaded, <span class="code">tableView(_:cellForRowAt:)</span>
 is called for every visible row. When the user scrolls to look at more cells, it’s called again for each row just as it is about to appear on the screen.</p>
<p class="indent">Next, we need to find out which <span class="code">Birthday</span>
 should be displayed inside the cell. We want to display one birthday from the <span class="code">birthdays</span>
 array in each row. The first birthday, which is at <span class="code">birthdays[0]</span>
 , should be displayed in row 0. The second birthday, at <span class="code">birthdays[1]</span>
 , should be displayed in row 1, and so on, which means the <span class="code">indexPath</span>
 ’s <span class="code">row</span>
 is the same as the position in the <span class="code">birthdays</span>
 array that we want to access. The code at <span class="ent">➋</span>
 accesses the <span id="page_166"></span>
 correct <span class="code">Birthday</span>
 object from the <span class="code">birthdays</span>
 array by using <span class="code">indexPath.row</span>
 . Once we have the right <span class="code">Birthday</span>
 object, we assign it to a constant named <span class="code">birthday</span>
 so we can set up the labels in this cell.</p>
<p class="indent">Notice that we’re using <span class="code">let</span>
 to assign the <span class="code">birthday</span>
 to a constant instead of a variable. We can use <span class="code">let</span>
 because each time <span class="code">tableView(_:cellForRowAt:)</span>
 is called, a new <span class="code">birthday</span>
 constant is created. Each cell gets its own <span class="code">birthday</span>
 constant that is assigned its own <span class="code">Birthday</span>
 object. Since we’re not going to change any of the <span class="code">birthday</span>
 constants—we’re just going to read their properties—we don’t want to make them variables.</p>
<p class="indent">Now that you have your cell and your birthday, it’s time to fill in the details. You need two labels for each cell to show the birthday person’s name and birthdate. You set the cell to the Subtitle style so that it has a Title label and a Subtitle label. Each cell will already contain these labels, so now you don’t have to create any labels yourself.</p>
<p class="indent">The labels exist as properties of <span class="code">UITableViewCell</span>
 and are called <span class="code">textLabel</span>
 and <span class="code">detailTextLabel</span>
 . The code at <span class="ent">➌</span>
 sets the text of the <span class="code">textLabel</span>
 to a string made up of the <span class="code">firstName</span>
 and <span class="code">lastName</span>
 of the <span class="code">birthday</span>
 with a space between them. At <span class="ent">➍</span>
 , you use the <span class="code">string(from:)</span>
 method of the <span class="code">dateFormatter</span>
 to display the birthdate in the <span class="code">detailTextLabel</span>
 .</p>
<p class="indent">When your cell is completely configured, <span class="code">tableView( _:cellForRowAt:)</span>
 returns the cell at <span class="ent">➎</span>
 so that it can be displayed at that <span class="code">indexPath</span>
 of the table view.</p>
<h3 class="h3" id="ch11lev1sec2">
<strong>PUTTING IT ALL TOGETHER</strong>
</h3>
<p class="noindent">Now you can add <span class="code">Birthday</span>
 instances to the app using the Add Birthday view controller, and you have a table view to list each <span class="code">Birthday</span>
 in the Birthdays table view controller. But when you try running the app and adding a <span class="code">Birthday</span>
 , it doesn’t appear. To make each <span class="code">Birthday</span>
 you add appear in the table view, you need to make the Add Birthday view controller communicate with the Birthdays table view controller. You do this by using <em>delegation</em>
 .</p>
<h4 class="h4" id="ch11lev2sec5">
<strong>DELEGATION</strong>
</h4>
<p class="noindent">Delegation can be used when one view controller needs to get information from another view controller. Say you have two view controllers: A and B. The first view controller, A, creates B and presents B on top of itself. A knows about B because it created and presented B, so A can pass information along to B. But B doesn’t know about A—it’s just popped into being and doesn’t know where it came from or how it got there. So how can B talk to A? Through delegation!</p>
<div class="image"><img src="Image00245.jpg" />
</div>
<p class="indent">Delegation is when someone gives a job or a task to someone else. A <em>delegate</em>
 is like a boss who tells a delegating employee what to do. When the delegating employee is done with their task, sometimes they’ll report information back to the delegate boss.</p>
<p class="indent"><span id="page_167"></span>
 Delegation in Swift is pretty similar, but instead of having a boss and employee, we have a delegate and a delegating object. Since class B is the one being told what to do by class A, it’s the delegating object. We give class B a special property called a delegate to tell it who its delegate is—that way, it knows who to communicate with. The delegate can be any class that has a set of methods that have been defined in a <em>protocol</em>
 . A protocol is like an agreement between the two classes that tells them what the delegate can ask the delegating object to do. It has a list of method and property names that the delegate can use with the delegating object.</p>
<p class="indent">Class A creates class B, makes itself the delegate of class B, and gives class B a job to do that’s in the protocol. Once class B is done with its job, it reports back to class A. Let’s see how this works in our app.</p>
<p class="indent">The Birthdays table view controller is view controller A, and the Add Birthday view controller is view controller B. We’ll create a protocol called <span class="code">AddBirthdayViewControllerDelegate</span>
 and a method for that protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 , which the Add Birthday view controller will use to report back.</p>
<p class="indent">Take a look at <a href="text00022.html#ch11fig6">Figure 11-6</a>
 . When the user taps the Add button <span class="ent">➊</span>
 , the Birthdays table view controller creates the Add Birthday view controller <span class="ent">➋</span>
 and sets itself as the Add Birthday view controller’s delegate.</p>
<div class="image"><img src="Image00246.jpg" />
</div>
<p class="figcap"><a id="ch11fig6"></a>
 <em>Figure 11-6: A new birthday is added and passed from the Add Birthday view controller to the Birthdays table view controller using delegation.</em>
</p>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<div class="image1"><img src="Image00001.jpg" />
</div>
<p class="noindent">Time to show off those birthdays! In <a href="text00021.html#ch10">Chapter 10</a>
 , you created the Add Birthday view controller so that you could add new <span class="code">Birthday</span>
 objects into your app with the <span class="code">Birthday</span>
 class. In this chapter, you’ll create a Birthdays table view controller that can display your added birthdays in a <em>table view</em>
 , which shows a list of items the user can scroll through and select. Then you’ll learn how to make the Add Birthday view controller tell the Birthdays table view controller when a <span class="code">Birthday</span>
 object is added so that the new birthday can be shown in the table view.</p>
<h3 class="h3" id="ch11lev1sec1">
<strong>MAKING THE BIRTHDAY LIST</strong>
</h3>
<p class="noindent">It’s one thing to be able to add birthdays, but you’ll also want to display a list of birthdays. For that you need to create another class, <span class="code">BirthdaysTableViewController</span>
 , which will subclass <span class="code">UITableViewController</span>
 , <span id="page_156"></span>
 a special kind of view controller with a table view. <span class="code">UITableViewController</span>
 contains several built-in methods that allow you to code things like how many rows the table view should have and what should be displayed in each row. We’ll want to have as many rows as we have birthdays and to display one birthday in each row.</p>
<h4 class="h4" id="ch11lev2sec1">
<strong>CREATING THE BIRTHDAYS TABLE VIEW CONTROLLER</strong>
</h4>
<p class="noindent">
<span class="smallcaps">CONTROL</span>
 -click the <em>BirthdayTracker</em>
 folder in the Project navigator and choose <strong>New File…</strong>
 from the menu. In <a href="text00021.html#ch10">Chapter 10</a>
 , we created the Swift file <em>Birthday.swift</em>
 , which Xcode prepared for us with nearly nothing in it. To create a new file this time, we’ll tell Xcode we want to subclass an existing iOS class. Depending on the base class, Xcode will create a file containing some code that you’ll customize to your needs. To create the file, select <strong>iOS</strong>
 at the top of the window and then select the <strong>Cocoa Touch Class</strong>
 template, which will automatically format the new class file (see <a href="text00022.html#ch11fig1">Figure 11-1</a>
 ).</p>
<div class="image"><img src="Image00234.jpg" />
</div>
<p class="figcap"><a id="ch11fig1"></a>
 <em>Figure 11-1: To subclass an existing class, choose</em>
 <strong>
<em>iOS</em>
</strong>
 <em>and then</em>
 <strong>
<em>Cocoa Touch Class.</em>
</strong>
</p>
<p class="indent">When you choose this option, you’ll see a second dialog where you can name your new class and specify which class you’ll subclass. First, in the Subclass field (the second field in the dialog), type <span class="code">
<span class="codestrong">UITableViewController</span>
</span>
 . This will automatically fill in the class field with the subclass name. Once that happens, type <span class="code">
<span class="codestrong">Birthdays</span>
</span>
 in front of <span class="code">TableViewController</span>
 so that the whole class name is <span class="code">BirthdaysTableViewController</span>
 . This is a shortcut so you don’t <span id="page_157"></span>
 have to type as much. Make sure to choose <strong>Swift</strong>
 in the Language drop-down menu as well, and then click <strong>Next</strong>
 . Then select <strong>Create</strong>
 in the final dialog to create your new file.</p>
<p class="indent">In <em>BirthdaysTableViewController.swift</em>
 , Xcode has provided a template with several commented-out methods. You can clean up the code by getting rid of methods we won’t use. Delete just the comments in <span class="code">viewDidLoad()</span>
 , and then delete the entire <span class="code">didReceiveMemoryWarning()</span>
 method and the methods <span class="code">tableView(_:moveRowAt:to:)</span>
 and <span class="code">tableView(_:canMoveRowAt:)</span>
 , which have to do with moving rows in the table view. When you’re finished, the contents of <span class="code">BirthdaysTableViewController</span>
 should look like <a href="text00022.html#ch11fig2">Figure 11-2</a>
 . There are still several commented-out methods, but we’re keeping those to use later!</p>
<div class="image"><img src="Image00235.jpg" />
</div>
<p class="figcap"><a id="ch11fig2"></a>
 <em>Figure 11-2: The</em>
 <span class="code">
<span class="italic">BirthdaysTableViewController</span>
</span>
 <em>cleaned up!</em>
</p>
<p class="indent">Next, you need to make the Birthdays table view controller the <span class="code">BirthdaysTableViewController</span>
 class. To do this, go to <em>Main.storyboard</em>
 and select the <strong>Birthdays</strong>
 scene. Using the Identity Inspector in the right pane, change the class from <span class="code">UITableViewController</span>
 to <span class="code">BirthdaysTableViewController</span>
 , as shown in <a href="text00022.html#ch11fig3">Figure 11-3</a>
 .</p>
<div class="image"><span id="page_158"></span>
 <img src="Image00236.jpg" />
</div>
<p class="figcap"><a id="ch11fig3"></a>
 <em>Figure 11-3: Setting</em>
 <span class="code">
<span class="italic">BirthdaysTableViewController</span>
</span>
 <em>as the class of the Birthdays scene</em>
</p>
<p class="indent">Now that you have the Birthdays table view controller set up in the storyboard, the next step is to make cells in your table that will display each birthday.</p>
<h4 class="h4" id="ch11lev2sec2">
<strong>ADDING CELLS TO THE TABLE VIEW</strong>
</h4>
<p class="noindent">Each birthday will be displayed in a <span class="code">UITableViewCell</span>
 in the Birthdays table view controller. A table has boxes organized into rows and columns that contain information. These boxes are called <em>cells</em>
 . Similarly, a table view also has cells that are all instances of, or a subclass of, the <span class="code">UITableViewCell</span>
 class. We’ll put each birthday into its own cell in our table view.</p>
<p class="indent">We’ll start by creating those cells in the storyboard, and then we’ll fill them with our <span class="code">Birthday</span>
 objects later. In the left outline menu, click the triangle by Birthdays and then click the triangle by Table View to open those sections. Then select <strong>Table View Cell</strong>
 <span class="ent">➊</span>
 , as shown in <a href="text00022.html#ch11fig4">Figure 11-4</a>
 .</p>
<div class="image"><img src="Image00237.jpg" />
</div>
<div class="image"><img src="Image00238.jpg" />
</div>
<p class="figcap"><a id="ch11fig4"></a>
 <em>Figure 11-4: Creating a Subtitle style table view cell and setting its identifier</em>
</p>
<p class="indent"><span id="page_159"></span>
 Next, open the Attributes Inspector. Using the drop-down menu under <strong>Style</strong>
 , set the cell’s style to <strong>Subtitle</strong>
 <span class="ent">➋</span>
 so that the cell now has a Title label and a Subtitle label. You’ll display each person’s name in the Title and birthday in the Subtitle.</p>
<p class="indent">Finally, enter <span class="code">
<span class="codestrong">birthdayCellIdentifier</span>
</span>
 in the Identifier field <span class="ent">➌</span>
 . You’ll use this identifier later when you fill in the cell contents.</p>
<p class="indent">That’s it! You’ve finished your work in the storyboard.</p>
<p class="indent">You may be wondering why we have just one cell in our table view in the storyboard when we’ll have more than one birthday to show in the list. If you look at <a href="text00022.html#ch11fig4">Figure 11-4</a>
 again, you’ll notice that the cell is labeled <em>Prototype Cells</em>
 . This means that the cell you just customized is a <em>template</em>
 for all the cells you want to appear in your table view. The identifier you gave the cell is how your code will tell the table view to produce each cell for you to put birthdays in. You’ll see how this works soon.</p>
<div class="box1">
<p class="box-title">
<strong>WORKING WITH DATES</strong>
</p>
<p class="box-p">Swift has a special data type called <span class="code">Date</span>
 that is used for storing date values. A <span class="code">Date</span>
 object is actually a date and a time. Open your playground and enter the following:</p>
<div class="image"><img src="Image00239.jpg" />
</div>
<p class="box-pi">We’ve just assigned the current date and time the code was run to the variable <span class="code">today</span>
 . When you print <span class="code">today</span>
 , it’s in the format <span class="code">"2017-11-21 10:45:31 +0000\n"</span>
 . What if you wanted it to display as <span class="code">Tuesday, November 21, 2017</span>
 , instead? Or just <span class="code">11/21/17</span>
 ? To display a date in a particular way, you use a <em>date formatter</em>
 , which is a <span class="code">DateFormatter</span>
 object that you create and give a date format style. <span class="code">DateFormatter</span>
 is a helper object that is used to create a display string from any date, and a <em>date format style</em>
 is a property of <span class="code">DateFormatter</span>
 that tells the formatter what style to use. You can create your own date format styles manually, but there are also styles that are included in Swift and ready to use. Add the following to your playground:</p>
<div class="image"><img src="Image00240.jpg" />
</div>
<p class="box-pi">At <span class="ent">➊</span>
 you create a <span class="code">formatter</span>
 . Then at <span class="ent">➋</span>
 , you set the style of the <span class="code">formatter</span>
 to <span class="code">Style.full</span>
 , which will print the day of the week as well as the full month name, date, and year. Finally, you create a string from the date using the <span class="code">string(from:)</span>
 method of the <span class="code">DateFormatter</span>
 class <span class="ent">➌</span>
 . You can see that you now have turned the <span id="page_160"></span>
 date into the nicely formatted string <span class="code">"Tuesday, November 21, 2017"</span>
 . <a style=";color:black;" href="text00022.html#ch11tab1">Table 11-1</a>
 shows the different strings that are created from the five <span class="code">DateFormatter.Style</span>
 options available in Swift.</p>
<p class="tabcap"><a id="ch11tab1" style=";color:black;"></a>
 <strong>Table 11-1:</strong>
 Date Formatter Styles and Their Date Strings</p>
<table class="tabled">
<tbody>
<tr>
<td style="vertical-align: top;" class="border1">
<p class="noindent">
<span class="code">
<span class="codestrong">DateFormatter.Style</span>
</span>
</p>
</td>
<td style="vertical-align: top;" class="border1">
<p class="noindent">
<strong>Date string</strong>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">none</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">""</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">short</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"11/21/17"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">medium</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"Nov 21, 2017"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">long</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"November 21, 2017"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">full</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"Tuesday, November 21, 2017"</span>
</p>
</td>
</tr>
</tbody>
</table>
<p class="box-pi">You can also specify your own custom way of displaying a date using the <span class="code">dateFormat</span>
 property of the <span class="code">DateFormatter</span>
 . Perhaps you only want the month and day. Or maybe you want a four-digit year displayed in the <span class="code">short</span>
 style. Doing either is really easy, and you don’t even have to create a new <span class="code">DateFormatter</span>
 —you can just change the <span class="code">dateFormat</span>
 on <span class="code">formatter</span>
 and then ask it for a new string. Add the following code to your playground to display dates with a specific format:</p>
<div class="image"><img src="Image00241.jpg" />
</div>
<p class="box-pi">At <span class="ent">➊</span>
 , you specify that you only want the month and the date in an <span class="code">MM/dd</span>
 format—that is, a two-digit month followed by a two-digit date. If you want to display the month as three letters, then use <span class="code">MMM</span>
 . To display the full name of the month, use <span class="code">MMMM</span>
 . At <span class="ent">➋</span>
 , we change the date format to use a four-digit year. A two-digit year would be <span class="code">yy</span>
 . Here are a few other ways to use a <span class="code">dateFormat</span>
 to display a custom date string.</p>
<div class="image"><img src="Image00242.jpg" />
</div>
<p class="box-pi"><span id="page_161"></span>
 If you want to include separators, you add them to your <span class="code">dateFormat</span>
 string. For example, if you want periods as separators, then you can create a <span class="code">dateFormat</span>
 like <span class="code">"MM.dd.yy"</span>
 <span class="ent">➊</span>
 . To display an abbreviated day of the week, use <span class="code">EEE</span>
 <span class="ent">➋</span>
 . For the full day, use <span class="code">EEEE</span>
 <span class="ent">➌</span>
 . These are only a few examples. By using combinations of <span class="code">M</span>
 , <span class="code">d</span>
 , <span class="code">y</span>
 , and <span class="code">E</span>
 , you have an endless number of ways to display a date!</p>
</div>
<h4 class="h4" id="ch11lev2sec3">
<strong>SETTING UP THE BIRTHDAYS TABLE VIEW CONTROLLER</strong>
</h4>
<p class="noindent">The Birthdays table view controller will display a list of all the birthdays stored in the app. Do you remember what you use to store a list of items? That’s right—an array! You’ll create an array in the <span class="code">BirthdaysTableViewController</span>
 to store all the birthdays. To do this, give the <span class="code">BirthdaysTableViewController</span>
 a <span class="code">birthdays</span>
 property that is an array of <span class="code">Birthday</span>
 objects. At the top of the class, right above the <span class="code">viewDidLoad()</span>
 method, insert this line to add a variable array property called <span class="code">birthdays</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController {</span>
<br />
<br />
    <span class="pink">var</span>
 birthdays = [<span class="green1">Birthday</span>
 ]()<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent">This line creates an empty array of <span class="code">Birthday</span>
 instances. It needs to be a variable and not a constant because you’ll want to add a saved <span class="code">Birthday</span>
 to this array every time the user adds a <span class="code">Birthday</span>
 with the Add Birthday view controller. You’ll see how to do that in “<a href="text00022.html#ch11lev3sec2">Making the Birthdays Table View Controller Conform to Protocol</a>
 ” on <a href="text00022.html#page_168">page 168</a>
 .</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>Remember that the final versions of the project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>.</em>
</p>
</div>
<p class="indent">The <span class="code">BirthdaysTableViewController</span>
 will also need a <span class="code">dateFormatter</span>
 property to display the birthdate as a nicely formatted string. Add a <span class="code">dateFormatter</span>
 right underneath the <span class="code">birthdays</span>
 array:</p>
<div class="box">
<pre>    <span class="ash">var birthdays = [Birthday]()</span>
<br />
<br />
    <span class="pink">let</span>
 dateFormatter = <span class="violet">DateFormatter</span>
 ()<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent">Note that the <span class="code">dateFormatter</span>
 is a constant that is created with <span class="code">let</span>
 . Even though you’ll change the <span class="code">dateFormatter</span>
 ’s properties, like the <span class="code">dateStyle</span>
 and <span class="code">timeStyle</span>
 , you’ll never change the <span class="code">dateFormatter</span>
 itself.</p>
<p class="indent"><span id="page_162"></span>
 You’ll also need to set up the <span class="code">dateFormatter</span>
 so that it will display the birthdates as fully formatted strings like <span class="code">"Tuesday, December 17, 2008"</span>
 . As you saw in <a href="text00021.html#ch10">Chapter 10</a>
 , a good place to do this is the <span class="code">viewDidLoad()</span>
 method, which is called when the Birthdays table view controller is loading its view. This is the perfect place to do any setup that is needed for this class.</p>
<div class="box">
<pre>
<span class="ash">override func viewDidLoad() {</span>
<br />
    <span class="ash">super.viewDidLoad()</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">dateFormatter</span>
 .<span class="violet">dateStyle</span>
 = .<span class="blue">full</span>
<br />
  <span class="ent">➋</span>
 <span class="green1">dateFormatter</span>
 .<span class="violet">timeStyle</span>
 = .<span class="blue">none</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , you set the <span class="code">dateStyle</span>
 of the <span class="code">dateFormatter</span>
 so that it will display a formatted date string for each <span class="code">Birthday</span>
 . Did you notice how we just wrote <span class="code">.full</span>
 instead of <span class="code">DateFormatter.Style.full</span>
 ? Swift knows what type to expect for the <span class="code">dateStyle</span>
 of a <span class="code">DateFormatter</span>
 , so it lets us take this little shortcut. At <span class="ent">➋</span>
 , you set the <span class="code">timeStyle</span>
 of the <span class="code">dateFormatter</span>
 to <span class="code">.none</span>
 so that the time won’t be shown.</p>
<h4 class="h4" id="ch11lev2sec4">
<strong>DISPLAYING BIRTHDAYS IN A TABLE VIEW</strong>
</h4>
<p class="noindent">The <span class="code">BirthdaysTableViewController</span>
 class has a table view that is used to display a list of items in a single column. The table view has one or more sections containing rows, and each row contains a cell. A section in a table view is a grouping of rows that can be displayed with or without a header. An example of an app that shows a table view with several sections is the Settings app, as shown in <a href="text00022.html#ch11fig5">Figure 11-5</a>
 . It displays a list of rows that have been broken up into different sections.</p>
<p class="indent">Each section and row of a table view is identified with an index number. These numbers start at 0 and then increase by 1 as you go down the table view. For example, the Privacy line in the Settings app is found at section 0, row 1. The News setting is at section 1, row 3.</p>
<p class="indent">In the middle of the <span class="code">BirthdaysTableViewController</span>
 class, there is a section called <em>Table view data source</em>
 with three methods. The table view controller uses these methods to determine what’s going to be displayed inside its table view.</p>
<p class="hang">
<span class="code">
<span class="codestrong">numberOfSections(in:)</span>
</span>
 Tells the table view how many sections it should have</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:numberOfRowsInSection:)</span>
</span>
 Tells the table view how many rows will be displayed in each section</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:cellForRowAt:)</span>
</span>
 Sets up each cell that’s going to be displayed in each row of the table view</p>
<div class="image"><span id="page_163"></span>
 <img src="Image00243.jpg" />
</div>
<p class="figcap"><a id="ch11fig5"></a>
 <em>Figure 11-5: The Settings app uses sections to group rows of different device settings.</em>
</p>
<p class="indent">The table view data source methods are called by the table view controller every time the table view is reloaded. Xcode automatically gives you these method templates when you make a subclass of a <span class="code">UITableViewController</span>
 . You need to implement all three methods for the app to work, even though you’ll never call them directly in your code. The <span class="code">UITableViewController</span>
 class implements the <span class="code">UITableViewDataSource</span>
 protocol, which comes with these data source methods, to determine what will be displayed inside the table view. We’ll discuss protocols in “<a href="text00022.html#ch11lev2sec5">Delegation</a>
 ” on page 166. For now, you just need to know that a <span class="code">UITableViewController</span>
 uses these methods to display its content, and it automatically calls these methods so you don’t need to call them.</p>
<p class="indent">Let’s start with the method <span class="code">numberOfSections(in:)</span>
 . The Birthdays table view controller is a list that just displays <span class="code">Birthday</span>
 instances, so it doesn’t need multiple sections. To set the number of sections in the table view, we just need to return <span class="code">1</span>
 .</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func numberOfSections(in tableView: UITableView) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 <span class="blue1">1</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent"><span id="page_164"></span>
 This method takes a <span class="code">UITableView</span>
 called <span class="code">tableView</span>
 as a parameter, which is the table view that uses this class as its data source. We don’t need to worry about making this connection because the <span class="code">UITableViewController</span>
 comes with a built-in table view that is automatically hooked up to these methods. Each birthday will be displayed in its own row. So in <span class="code">tableView(_:numberOfRowsInSection:)</span>
 , in order to have the right number of rows for all of your birthdays, you need to return the number of <span class="code">Birthday</span>
 instances that you have in your <span class="code">birthdays</span>
 array. Do you remember the <span class="code">count</span>
 property of an array? It’s an integer that tells you how many items are in that array, and it’s perfect for this situation! Change this method to the following:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, <img class="inline" src="Image00184.jpg" />
<br />
    numberOfRowsInSection section: Int) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 birthdays.<span class="violet">count</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">In addition to the <span class="code">tableView</span>
 parameter, <span class="code">tableView(_:numberOfRowsInSection:)</span>
 also takes an <span class="code">Int</span>
 called <span class="code">section</span>
 . When the table view is loading itself, this method is called for each section in the table view. In our case, we have only one section, so we don’t need to bother checking which <span class="code">section</span>
 of the table view is being displayed here. We know it’s section 0, and we want it to have as many rows as there are birthdays, so we write <span class="code">return birthdays.count</span>
 .</p>
<p class="indent">Finally, you need to implement <span class="code">tableView(_:cellForRowAt:)</span>
 so that the table view will know what to put inside each cell. Since this method is commented out, you need to uncomment it by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it. (Be careful not to accidentally uncomment the other methods after it!) After you’ve done that, change it to the following code:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, cellForRowAt <img class="inline" src="Image00184.jpg" />
<br />
    indexPath: IndexPath) -&gt; UITableViewCell {</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="pink">let</span>
 cell = tableView.<span class="blue">dequeueReusableCell</span>
 (withIdentifier: <img class="inline" src="Image00093.jpg" />
<br />
        <span class="red">"birthdayCellIdentifier"</span>
 , for: indexPath)<br />
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 birthday = <span class="green1">birthdays</span>
 [indexPath.<span class="violet">row</span>
 ]<br />
<br />
  <span class="ent">➌</span>
 cell.<span class="violet">textLabel</span>
 ?.<span class="violet">text</span>
 = birthday.<span class="green1">firstName</span>
 <span class="blue">+</span>
 <span class="red">" "</span>
 <span class="blue">+</span>
 <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">lastName</span>
<br />
<br />
  <span class="ent">➍</span>
 cell.<span class="violet">detailTextLabel</span>
 ?.<span class="violet">text</span>
 = <span class="green1">dateFormatter</span>
 .<span class="blue">string</span>
 (from: <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">birthdate</span>
 )<br />
<br />
  <span class="ent">➎</span>
 <span class="pink">return</span>
 cell<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">You don’t call the method <span class="code">tableView(_:cellForRowAt:)</span>
 . It’s called when the table view is loaded onto the screen. It’s called for each cell on the screen and takes two parameters, <span class="code">tableView</span>
 and <span class="code">indexPath</span>
 . You already know <span id="page_165"></span>
 what the <span class="code">tableView</span>
 parameter is for. An <span class="code">IndexPath</span>
 is a Swift struct that’s used to represent a row’s position in a table view. An <span class="code">IndexPath</span>
 instance has a <span class="code">section</span>
 property and a <span class="code">row</span>
 property. Since this method will be called many times (once for every row in the table), we need the <span class="code">indexPath</span>
 to know which section and row we’re currently configuring. The <span class="code">indexPath.section</span>
 property gives the section number, and the <span class="code">indexPath.row</span>
 gives the row of the table view cell. The five lines of code inside <span class="code">tableView(_:cellForRowAt:)</span>
 will do the following:</p>
<div class="image"><img src="Image00244.jpg" />
</div>
<p class="bull">• Create a <span class="code">UITableViewCell</span>
</p>
<p class="bull">• Figure out which <span class="code">Birthday</span>
 in the <span class="code">birthdays</span>
 array will be displayed inside the cell</p>
<p class="bull">• Make two labels to display the birthday person’s name and birthdate in the cell</p>
<p class="bull">• Return the cell ready for display in the table view</p>
<p class="indentt">Let’s go through this code line by line.</p>
<p class="indent">First, create the <span class="code">UITableViewCell</span>
 . The code at <span class="ent">➊</span>
 does this using the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 . Before you can start using this method on a cell, though, you need to tell the method which cell you want to use from the storyboard. Earlier, when you were in the storyboard, you gave your cell the identifier <span class="code">birthdayCellIdentifier</span>
 (see <a href="text00022.html#ch11fig4">Figure 11-4</a>
 ). This identifier links your code to the cell and tells your method that it’s using the right cell. The string for when you call this method needs to be exactly the same as the string you set in the storyboard, or you’ll get an error and the app will crash when you run it.</p>
<p class="indent">In the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 , did you notice the words <em>Reusable Cell</em>
 ? The cells inside a table view are created once and then can be reused over and over. This helps everything run faster and smoother because creating the cell is what takes the most time. If you had 200 birthdays in your app, but only 10 would fit on your screen at one time, then you need only 10 cells to show your birthdays. When you scroll down to reveal more birthdays, the cells that scroll off the top of the screen are reused. They are filled with new information and show up again at the bottom of the screen. The <span class="code">UITableView</span>
 automatically does this work. When the table view is loaded, <span class="code">tableView(_:cellForRowAt:)</span>
 is called for every visible row. When the user scrolls to look at more cells, it’s called again for each row just as it is about to appear on the screen.</p>
<p class="indent">Next, we need to find out which <span class="code">Birthday</span>
 should be displayed inside the cell. We want to display one birthday from the <span class="code">birthdays</span>
 array in each row. The first birthday, which is at <span class="code">birthdays[0]</span>
 , should be displayed in row 0. The second birthday, at <span class="code">birthdays[1]</span>
 , should be displayed in row 1, and so on, which means the <span class="code">indexPath</span>
 ’s <span class="code">row</span>
 is the same as the position in the <span class="code">birthdays</span>
 array that we want to access. The code at <span class="ent">➋</span>
 accesses the <span id="page_166"></span>
 correct <span class="code">Birthday</span>
 object from the <span class="code">birthdays</span>
 array by using <span class="code">indexPath.row</span>
 . Once we have the right <span class="code">Birthday</span>
 object, we assign it to a constant named <span class="code">birthday</span>
 so we can set up the labels in this cell.</p>
<p class="indent">Notice that we’re using <span class="code">let</span>
 to assign the <span class="code">birthday</span>
 to a constant instead of a variable. We can use <span class="code">let</span>
 because each time <span class="code">tableView(_:cellForRowAt:)</span>
 is called, a new <span class="code">birthday</span>
 constant is created. Each cell gets its own <span class="code">birthday</span>
 constant that is assigned its own <span class="code">Birthday</span>
 object. Since we’re not going to change any of the <span class="code">birthday</span>
 constants—we’re just going to read their properties—we don’t want to make them variables.</p>
<p class="indent">Now that you have your cell and your birthday, it’s time to fill in the details. You need two labels for each cell to show the birthday person’s name and birthdate. You set the cell to the Subtitle style so that it has a Title label and a Subtitle label. Each cell will already contain these labels, so now you don’t have to create any labels yourself.</p>
<p class="indent">The labels exist as properties of <span class="code">UITableViewCell</span>
 and are called <span class="code">textLabel</span>
 and <span class="code">detailTextLabel</span>
 . The code at <span class="ent">➌</span>
 sets the text of the <span class="code">textLabel</span>
 to a string made up of the <span class="code">firstName</span>
 and <span class="code">lastName</span>
 of the <span class="code">birthday</span>
 with a space between them. At <span class="ent">➍</span>
 , you use the <span class="code">string(from:)</span>
 method of the <span class="code">dateFormatter</span>
 to display the birthdate in the <span class="code">detailTextLabel</span>
 .</p>
<p class="indent">When your cell is completely configured, <span class="code">tableView( _:cellForRowAt:)</span>
 returns the cell at <span class="ent">➎</span>
 so that it can be displayed at that <span class="code">indexPath</span>
 of the table view.</p>
<h3 class="h3" id="ch11lev1sec2">
<strong>PUTTING IT ALL TOGETHER</strong>
</h3>
<p class="noindent">Now you can add <span class="code">Birthday</span>
 instances to the app using the Add Birthday view controller, and you have a table view to list each <span class="code">Birthday</span>
 in the Birthdays table view controller. But when you try running the app and adding a <span class="code">Birthday</span>
 , it doesn’t appear. To make each <span class="code">Birthday</span>
 you add appear in the table view, you need to make the Add Birthday view controller communicate with the Birthdays table view controller. You do this by using <em>delegation</em>
 .</p>
<h4 class="h4" id="ch11lev2sec5">
<strong>DELEGATION</strong>
</h4>
<p class="noindent">Delegation can be used when one view controller needs to get information from another view controller. Say you have two view controllers: A and B. The first view controller, A, creates B and presents B on top of itself. A knows about B because it created and presented B, so A can pass information along to B. But B doesn’t know about A—it’s just popped into being and doesn’t know where it came from or how it got there. So how can B talk to A? Through delegation!</p>
<div class="image"><img src="Image00245.jpg" />
</div>
<p class="indent">Delegation is when someone gives a job or a task to someone else. A <em>delegate</em>
 is like a boss who tells a delegating employee what to do. When the delegating employee is done with their task, sometimes they’ll report information back to the delegate boss.</p>
<p class="indent"><span id="page_167"></span>
 Delegation in Swift is pretty similar, but instead of having a boss and employee, we have a delegate and a delegating object. Since class B is the one being told what to do by class A, it’s the delegating object. We give class B a special property called a delegate to tell it who its delegate is—that way, it knows who to communicate with. The delegate can be any class that has a set of methods that have been defined in a <em>protocol</em>
 . A protocol is like an agreement between the two classes that tells them what the delegate can ask the delegating object to do. It has a list of method and property names that the delegate can use with the delegating object.</p>
<p class="indent">Class A creates class B, makes itself the delegate of class B, and gives class B a job to do that’s in the protocol. Once class B is done with its job, it reports back to class A. Let’s see how this works in our app.</p>
<p class="indent">The Birthdays table view controller is view controller A, and the Add Birthday view controller is view controller B. We’ll create a protocol called <span class="code">AddBirthdayViewControllerDelegate</span>
 and a method for that protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 , which the Add Birthday view controller will use to report back.</p>
<p class="indent">Take a look at <a href="text00022.html#ch11fig6">Figure 11-6</a>
 . When the user taps the Add button <span class="ent">➊</span>
 , the Birthdays table view controller creates the Add Birthday view controller <span class="ent">➋</span>
 and sets itself as the Add Birthday view controller’s delegate.</p>
<div class="image"><img src="Image00246.jpg" />
</div>
<p class="figcap"><a id="ch11fig6"></a>
 <em>Figure 11-6: A new birthday is added and passed from the Add Birthday view controller to the Birthdays table view controller using delegation.</em>
</p>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="noindent">Time to show off those birthdays! In <a href="text00021.html#ch10">Chapter 10</a>
 , you created the Add Birthday view controller so that you could add new <span class="code">Birthday</span>
 objects into your app with the <span class="code">Birthday</span>
 class. In this chapter, you’ll create a Birthdays table view controller that can display your added birthdays in a <em>table view</em>
 , which shows a list of items the user can scroll through and select. Then you’ll learn how to make the Add Birthday view controller tell the Birthdays table view controller when a <span class="code">Birthday</span>
 object is added so that the new birthday can be shown in the table view.</p>
<h3 class="h3" id="ch11lev1sec1">
<strong>MAKING THE BIRTHDAY LIST</strong>
</h3>
<p class="noindent">It’s one thing to be able to add birthdays, but you’ll also want to display a list of birthdays. For that you need to create another class, <span class="code">BirthdaysTableViewController</span>
 , which will subclass <span class="code">UITableViewController</span>
 , <span id="page_156"></span>
 a special kind of view controller with a table view. <span class="code">UITableViewController</span>
 contains several built-in methods that allow you to code things like how many rows the table view should have and what should be displayed in each row. We’ll want to have as many rows as we have birthdays and to display one birthday in each row.</p>
<h4 class="h4" id="ch11lev2sec1">
<strong>CREATING THE BIRTHDAYS TABLE VIEW CONTROLLER</strong>
</h4>
<p class="noindent">
<span class="smallcaps">CONTROL</span>
 -click the <em>BirthdayTracker</em>
 folder in the Project navigator and choose <strong>New File…</strong>
 from the menu. In <a href="text00021.html#ch10">Chapter 10</a>
 , we created the Swift file <em>Birthday.swift</em>
 , which Xcode prepared for us with nearly nothing in it. To create a new file this time, we’ll tell Xcode we want to subclass an existing iOS class. Depending on the base class, Xcode will create a file containing some code that you’ll customize to your needs. To create the file, select <strong>iOS</strong>
 at the top of the window and then select the <strong>Cocoa Touch Class</strong>
 template, which will automatically format the new class file (see <a href="text00022.html#ch11fig1">Figure 11-1</a>
 ).</p>
<div class="image"><img src="Image00234.jpg" />
</div>
<p class="figcap"><a id="ch11fig1"></a>
 <em>Figure 11-1: To subclass an existing class, choose</em>
 <strong>
<em>iOS</em>
</strong>
 <em>and then</em>
 <strong>
<em>Cocoa Touch Class.</em>
</strong>
</p>
<p class="indent">When you choose this option, you’ll see a second dialog where you can name your new class and specify which class you’ll subclass. First, in the Subclass field (the second field in the dialog), type <span class="code">
<span class="codestrong">UITableViewController</span>
</span>
 . This will automatically fill in the class field with the subclass name. Once that happens, type <span class="code">
<span class="codestrong">Birthdays</span>
</span>
 in front of <span class="code">TableViewController</span>
 so that the whole class name is <span class="code">BirthdaysTableViewController</span>
 . This is a shortcut so you don’t <span id="page_157"></span>
 have to type as much. Make sure to choose <strong>Swift</strong>
 in the Language drop-down menu as well, and then click <strong>Next</strong>
 . Then select <strong>Create</strong>
 in the final dialog to create your new file.</p>
<p class="indent">In <em>BirthdaysTableViewController.swift</em>
 , Xcode has provided a template with several commented-out methods. You can clean up the code by getting rid of methods we won’t use. Delete just the comments in <span class="code">viewDidLoad()</span>
 , and then delete the entire <span class="code">didReceiveMemoryWarning()</span>
 method and the methods <span class="code">tableView(_:moveRowAt:to:)</span>
 and <span class="code">tableView(_:canMoveRowAt:)</span>
 , which have to do with moving rows in the table view. When you’re finished, the contents of <span class="code">BirthdaysTableViewController</span>
 should look like <a href="text00022.html#ch11fig2">Figure 11-2</a>
 . There are still several commented-out methods, but we’re keeping those to use later!</p>
<div class="image"><img src="Image00235.jpg" />
</div>
<p class="figcap"><a id="ch11fig2"></a>
 <em>Figure 11-2: The</em>
 <span class="code">
<span class="italic">BirthdaysTableViewController</span>
</span>
 <em>cleaned up!</em>
</p>
<p class="indent">Next, you need to make the Birthdays table view controller the <span class="code">BirthdaysTableViewController</span>
 class. To do this, go to <em>Main.storyboard</em>
 and select the <strong>Birthdays</strong>
 scene. Using the Identity Inspector in the right pane, change the class from <span class="code">UITableViewController</span>
 to <span class="code">BirthdaysTableViewController</span>
 , as shown in <a href="text00022.html#ch11fig3">Figure 11-3</a>
 .</p>
<div class="image"><span id="page_158"></span>
 <img src="Image00236.jpg" />
</div>
<p class="figcap"><a id="ch11fig3"></a>
 <em>Figure 11-3: Setting</em>
 <span class="code">
<span class="italic">BirthdaysTableViewController</span>
</span>
 <em>as the class of the Birthdays scene</em>
</p>
<p class="indent">Now that you have the Birthdays table view controller set up in the storyboard, the next step is to make cells in your table that will display each birthday.</p>
<h4 class="h4" id="ch11lev2sec2">
<strong>ADDING CELLS TO THE TABLE VIEW</strong>
</h4>
<p class="noindent">Each birthday will be displayed in a <span class="code">UITableViewCell</span>
 in the Birthdays table view controller. A table has boxes organized into rows and columns that contain information. These boxes are called <em>cells</em>
 . Similarly, a table view also has cells that are all instances of, or a subclass of, the <span class="code">UITableViewCell</span>
 class. We’ll put each birthday into its own cell in our table view.</p>
<p class="indent">We’ll start by creating those cells in the storyboard, and then we’ll fill them with our <span class="code">Birthday</span>
 objects later. In the left outline menu, click the triangle by Birthdays and then click the triangle by Table View to open those sections. Then select <strong>Table View Cell</strong>
 <span class="ent">➊</span>
 , as shown in <a href="text00022.html#ch11fig4">Figure 11-4</a>
 .</p>
<div class="image"><img src="Image00237.jpg" />
</div>
<div class="image"><img src="Image00238.jpg" />
</div>
<p class="figcap"><a id="ch11fig4"></a>
 <em>Figure 11-4: Creating a Subtitle style table view cell and setting its identifier</em>
</p>
<p class="indent"><span id="page_159"></span>
 Next, open the Attributes Inspector. Using the drop-down menu under <strong>Style</strong>
 , set the cell’s style to <strong>Subtitle</strong>
 <span class="ent">➋</span>
 so that the cell now has a Title label and a Subtitle label. You’ll display each person’s name in the Title and birthday in the Subtitle.</p>
<p class="indent">Finally, enter <span class="code">
<span class="codestrong">birthdayCellIdentifier</span>
</span>
 in the Identifier field <span class="ent">➌</span>
 . You’ll use this identifier later when you fill in the cell contents.</p>
<p class="indent">That’s it! You’ve finished your work in the storyboard.</p>
<p class="indent">You may be wondering why we have just one cell in our table view in the storyboard when we’ll have more than one birthday to show in the list. If you look at <a href="text00022.html#ch11fig4">Figure 11-4</a>
 again, you’ll notice that the cell is labeled <em>Prototype Cells</em>
 . This means that the cell you just customized is a <em>template</em>
 for all the cells you want to appear in your table view. The identifier you gave the cell is how your code will tell the table view to produce each cell for you to put birthdays in. You’ll see how this works soon.</p>
<div class="box1">
<p class="box-title">
<strong>WORKING WITH DATES</strong>
</p>
<p class="box-p">Swift has a special data type called <span class="code">Date</span>
 that is used for storing date values. A <span class="code">Date</span>
 object is actually a date and a time. Open your playground and enter the following:</p>
<div class="image"><img src="Image00239.jpg" />
</div>
<p class="box-pi">We’ve just assigned the current date and time the code was run to the variable <span class="code">today</span>
 . When you print <span class="code">today</span>
 , it’s in the format <span class="code">"2017-11-21 10:45:31 +0000\n"</span>
 . What if you wanted it to display as <span class="code">Tuesday, November 21, 2017</span>
 , instead? Or just <span class="code">11/21/17</span>
 ? To display a date in a particular way, you use a <em>date formatter</em>
 , which is a <span class="code">DateFormatter</span>
 object that you create and give a date format style. <span class="code">DateFormatter</span>
 is a helper object that is used to create a display string from any date, and a <em>date format style</em>
 is a property of <span class="code">DateFormatter</span>
 that tells the formatter what style to use. You can create your own date format styles manually, but there are also styles that are included in Swift and ready to use. Add the following to your playground:</p>
<div class="image"><img src="Image00240.jpg" />
</div>
<p class="box-pi">At <span class="ent">➊</span>
 you create a <span class="code">formatter</span>
 . Then at <span class="ent">➋</span>
 , you set the style of the <span class="code">formatter</span>
 to <span class="code">Style.full</span>
 , which will print the day of the week as well as the full month name, date, and year. Finally, you create a string from the date using the <span class="code">string(from:)</span>
 method of the <span class="code">DateFormatter</span>
 class <span class="ent">➌</span>
 . You can see that you now have turned the <span id="page_160"></span>
 date into the nicely formatted string <span class="code">"Tuesday, November 21, 2017"</span>
 . <a style=";color:black;" href="text00022.html#ch11tab1">Table 11-1</a>
 shows the different strings that are created from the five <span class="code">DateFormatter.Style</span>
 options available in Swift.</p>
<p class="tabcap"><a id="ch11tab1" style=";color:black;"></a>
 <strong>Table 11-1:</strong>
 Date Formatter Styles and Their Date Strings</p>
<table class="tabled">
<tbody>
<tr>
<td style="vertical-align: top;" class="border1">
<p class="noindent">
<span class="code">
<span class="codestrong">DateFormatter.Style</span>
</span>
</p>
</td>
<td style="vertical-align: top;" class="border1">
<p class="noindent">
<strong>Date string</strong>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">none</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">""</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">short</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"11/21/17"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">medium</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"Nov 21, 2017"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">long</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"November 21, 2017"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">full</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"Tuesday, November 21, 2017"</span>
</p>
</td>
</tr>
</tbody>
</table>
<p class="box-pi">You can also specify your own custom way of displaying a date using the <span class="code">dateFormat</span>
 property of the <span class="code">DateFormatter</span>
 . Perhaps you only want the month and day. Or maybe you want a four-digit year displayed in the <span class="code">short</span>
 style. Doing either is really easy, and you don’t even have to create a new <span class="code">DateFormatter</span>
 —you can just change the <span class="code">dateFormat</span>
 on <span class="code">formatter</span>
 and then ask it for a new string. Add the following code to your playground to display dates with a specific format:</p>
<div class="image"><img src="Image00241.jpg" />
</div>
<p class="box-pi">At <span class="ent">➊</span>
 , you specify that you only want the month and the date in an <span class="code">MM/dd</span>
 format—that is, a two-digit month followed by a two-digit date. If you want to display the month as three letters, then use <span class="code">MMM</span>
 . To display the full name of the month, use <span class="code">MMMM</span>
 . At <span class="ent">➋</span>
 , we change the date format to use a four-digit year. A two-digit year would be <span class="code">yy</span>
 . Here are a few other ways to use a <span class="code">dateFormat</span>
 to display a custom date string.</p>
<div class="image"><img src="Image00242.jpg" />
</div>
<p class="box-pi"><span id="page_161"></span>
 If you want to include separators, you add them to your <span class="code">dateFormat</span>
 string. For example, if you want periods as separators, then you can create a <span class="code">dateFormat</span>
 like <span class="code">"MM.dd.yy"</span>
 <span class="ent">➊</span>
 . To display an abbreviated day of the week, use <span class="code">EEE</span>
 <span class="ent">➋</span>
 . For the full day, use <span class="code">EEEE</span>
 <span class="ent">➌</span>
 . These are only a few examples. By using combinations of <span class="code">M</span>
 , <span class="code">d</span>
 , <span class="code">y</span>
 , and <span class="code">E</span>
 , you have an endless number of ways to display a date!</p>
</div>
<h4 class="h4" id="ch11lev2sec3">
<strong>SETTING UP THE BIRTHDAYS TABLE VIEW CONTROLLER</strong>
</h4>
<p class="noindent">The Birthdays table view controller will display a list of all the birthdays stored in the app. Do you remember what you use to store a list of items? That’s right—an array! You’ll create an array in the <span class="code">BirthdaysTableViewController</span>
 to store all the birthdays. To do this, give the <span class="code">BirthdaysTableViewController</span>
 a <span class="code">birthdays</span>
 property that is an array of <span class="code">Birthday</span>
 objects. At the top of the class, right above the <span class="code">viewDidLoad()</span>
 method, insert this line to add a variable array property called <span class="code">birthdays</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController {</span>
<br />
<br />
    <span class="pink">var</span>
 birthdays = [<span class="green1">Birthday</span>
 ]()<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent">This line creates an empty array of <span class="code">Birthday</span>
 instances. It needs to be a variable and not a constant because you’ll want to add a saved <span class="code">Birthday</span>
 to this array every time the user adds a <span class="code">Birthday</span>
 with the Add Birthday view controller. You’ll see how to do that in “<a href="text00022.html#ch11lev3sec2">Making the Birthdays Table View Controller Conform to Protocol</a>
 ” on <a href="text00022.html#page_168">page 168</a>
 .</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>Remember that the final versions of the project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>.</em>
</p>
</div>
<p class="indent">The <span class="code">BirthdaysTableViewController</span>
 will also need a <span class="code">dateFormatter</span>
 property to display the birthdate as a nicely formatted string. Add a <span class="code">dateFormatter</span>
 right underneath the <span class="code">birthdays</span>
 array:</p>
<div class="box">
<pre>    <span class="ash">var birthdays = [Birthday]()</span>
<br />
<br />
    <span class="pink">let</span>
 dateFormatter = <span class="violet">DateFormatter</span>
 ()<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent">Note that the <span class="code">dateFormatter</span>
 is a constant that is created with <span class="code">let</span>
 . Even though you’ll change the <span class="code">dateFormatter</span>
 ’s properties, like the <span class="code">dateStyle</span>
 and <span class="code">timeStyle</span>
 , you’ll never change the <span class="code">dateFormatter</span>
 itself.</p>
<p class="indent"><span id="page_162"></span>
 You’ll also need to set up the <span class="code">dateFormatter</span>
 so that it will display the birthdates as fully formatted strings like <span class="code">"Tuesday, December 17, 2008"</span>
 . As you saw in <a href="text00021.html#ch10">Chapter 10</a>
 , a good place to do this is the <span class="code">viewDidLoad()</span>
 method, which is called when the Birthdays table view controller is loading its view. This is the perfect place to do any setup that is needed for this class.</p>
<div class="box">
<pre>
<span class="ash">override func viewDidLoad() {</span>
<br />
    <span class="ash">super.viewDidLoad()</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">dateFormatter</span>
 .<span class="violet">dateStyle</span>
 = .<span class="blue">full</span>
<br />
  <span class="ent">➋</span>
 <span class="green1">dateFormatter</span>
 .<span class="violet">timeStyle</span>
 = .<span class="blue">none</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , you set the <span class="code">dateStyle</span>
 of the <span class="code">dateFormatter</span>
 so that it will display a formatted date string for each <span class="code">Birthday</span>
 . Did you notice how we just wrote <span class="code">.full</span>
 instead of <span class="code">DateFormatter.Style.full</span>
 ? Swift knows what type to expect for the <span class="code">dateStyle</span>
 of a <span class="code">DateFormatter</span>
 , so it lets us take this little shortcut. At <span class="ent">➋</span>
 , you set the <span class="code">timeStyle</span>
 of the <span class="code">dateFormatter</span>
 to <span class="code">.none</span>
 so that the time won’t be shown.</p>
<h4 class="h4" id="ch11lev2sec4">
<strong>DISPLAYING BIRTHDAYS IN A TABLE VIEW</strong>
</h4>
<p class="noindent">The <span class="code">BirthdaysTableViewController</span>
 class has a table view that is used to display a list of items in a single column. The table view has one or more sections containing rows, and each row contains a cell. A section in a table view is a grouping of rows that can be displayed with or without a header. An example of an app that shows a table view with several sections is the Settings app, as shown in <a href="text00022.html#ch11fig5">Figure 11-5</a>
 . It displays a list of rows that have been broken up into different sections.</p>
<p class="indent">Each section and row of a table view is identified with an index number. These numbers start at 0 and then increase by 1 as you go down the table view. For example, the Privacy line in the Settings app is found at section 0, row 1. The News setting is at section 1, row 3.</p>
<p class="indent">In the middle of the <span class="code">BirthdaysTableViewController</span>
 class, there is a section called <em>Table view data source</em>
 with three methods. The table view controller uses these methods to determine what’s going to be displayed inside its table view.</p>
<p class="hang">
<span class="code">
<span class="codestrong">numberOfSections(in:)</span>
</span>
 Tells the table view how many sections it should have</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:numberOfRowsInSection:)</span>
</span>
 Tells the table view how many rows will be displayed in each section</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:cellForRowAt:)</span>
</span>
 Sets up each cell that’s going to be displayed in each row of the table view</p>
<div class="image"><span id="page_163"></span>
 <img src="Image00243.jpg" />
</div>
<p class="figcap"><a id="ch11fig5"></a>
 <em>Figure 11-5: The Settings app uses sections to group rows of different device settings.</em>
</p>
<p class="indent">The table view data source methods are called by the table view controller every time the table view is reloaded. Xcode automatically gives you these method templates when you make a subclass of a <span class="code">UITableViewController</span>
 . You need to implement all three methods for the app to work, even though you’ll never call them directly in your code. The <span class="code">UITableViewController</span>
 class implements the <span class="code">UITableViewDataSource</span>
 protocol, which comes with these data source methods, to determine what will be displayed inside the table view. We’ll discuss protocols in “<a href="text00022.html#ch11lev2sec5">Delegation</a>
 ” on page 166. For now, you just need to know that a <span class="code">UITableViewController</span>
 uses these methods to display its content, and it automatically calls these methods so you don’t need to call them.</p>
<p class="indent">Let’s start with the method <span class="code">numberOfSections(in:)</span>
 . The Birthdays table view controller is a list that just displays <span class="code">Birthday</span>
 instances, so it doesn’t need multiple sections. To set the number of sections in the table view, we just need to return <span class="code">1</span>
 .</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func numberOfSections(in tableView: UITableView) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 <span class="blue1">1</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent"><span id="page_164"></span>
 This method takes a <span class="code">UITableView</span>
 called <span class="code">tableView</span>
 as a parameter, which is the table view that uses this class as its data source. We don’t need to worry about making this connection because the <span class="code">UITableViewController</span>
 comes with a built-in table view that is automatically hooked up to these methods. Each birthday will be displayed in its own row. So in <span class="code">tableView(_:numberOfRowsInSection:)</span>
 , in order to have the right number of rows for all of your birthdays, you need to return the number of <span class="code">Birthday</span>
 instances that you have in your <span class="code">birthdays</span>
 array. Do you remember the <span class="code">count</span>
 property of an array? It’s an integer that tells you how many items are in that array, and it’s perfect for this situation! Change this method to the following:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, <img class="inline" src="Image00184.jpg" />
<br />
    numberOfRowsInSection section: Int) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 birthdays.<span class="violet">count</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">In addition to the <span class="code">tableView</span>
 parameter, <span class="code">tableView(_:numberOfRowsInSection:)</span>
 also takes an <span class="code">Int</span>
 called <span class="code">section</span>
 . When the table view is loading itself, this method is called for each section in the table view. In our case, we have only one section, so we don’t need to bother checking which <span class="code">section</span>
 of the table view is being displayed here. We know it’s section 0, and we want it to have as many rows as there are birthdays, so we write <span class="code">return birthdays.count</span>
 .</p>
<p class="indent">Finally, you need to implement <span class="code">tableView(_:cellForRowAt:)</span>
 so that the table view will know what to put inside each cell. Since this method is commented out, you need to uncomment it by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it. (Be careful not to accidentally uncomment the other methods after it!) After you’ve done that, change it to the following code:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, cellForRowAt <img class="inline" src="Image00184.jpg" />
<br />
    indexPath: IndexPath) -&gt; UITableViewCell {</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="pink">let</span>
 cell = tableView.<span class="blue">dequeueReusableCell</span>
 (withIdentifier: <img class="inline" src="Image00093.jpg" />
<br />
        <span class="red">"birthdayCellIdentifier"</span>
 , for: indexPath)<br />
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 birthday = <span class="green1">birthdays</span>
 [indexPath.<span class="violet">row</span>
 ]<br />
<br />
  <span class="ent">➌</span>
 cell.<span class="violet">textLabel</span>
 ?.<span class="violet">text</span>
 = birthday.<span class="green1">firstName</span>
 <span class="blue">+</span>
 <span class="red">" "</span>
 <span class="blue">+</span>
 <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">lastName</span>
<br />
<br />
  <span class="ent">➍</span>
 cell.<span class="violet">detailTextLabel</span>
 ?.<span class="violet">text</span>
 = <span class="green1">dateFormatter</span>
 .<span class="blue">string</span>
 (from: <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">birthdate</span>
 )<br />
<br />
  <span class="ent">➎</span>
 <span class="pink">return</span>
 cell<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">You don’t call the method <span class="code">tableView(_:cellForRowAt:)</span>
 . It’s called when the table view is loaded onto the screen. It’s called for each cell on the screen and takes two parameters, <span class="code">tableView</span>
 and <span class="code">indexPath</span>
 . You already know <span id="page_165"></span>
 what the <span class="code">tableView</span>
 parameter is for. An <span class="code">IndexPath</span>
 is a Swift struct that’s used to represent a row’s position in a table view. An <span class="code">IndexPath</span>
 instance has a <span class="code">section</span>
 property and a <span class="code">row</span>
 property. Since this method will be called many times (once for every row in the table), we need the <span class="code">indexPath</span>
 to know which section and row we’re currently configuring. The <span class="code">indexPath.section</span>
 property gives the section number, and the <span class="code">indexPath.row</span>
 gives the row of the table view cell. The five lines of code inside <span class="code">tableView(_:cellForRowAt:)</span>
 will do the following:</p>
<div class="image"><img src="Image00244.jpg" />
</div>
<p class="bull">• Create a <span class="code">UITableViewCell</span>
</p>
<p class="bull">• Figure out which <span class="code">Birthday</span>
 in the <span class="code">birthdays</span>
 array will be displayed inside the cell</p>
<p class="bull">• Make two labels to display the birthday person’s name and birthdate in the cell</p>
<p class="bull">• Return the cell ready for display in the table view</p>
<p class="indentt">Let’s go through this code line by line.</p>
<p class="indent">First, create the <span class="code">UITableViewCell</span>
 . The code at <span class="ent">➊</span>
 does this using the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 . Before you can start using this method on a cell, though, you need to tell the method which cell you want to use from the storyboard. Earlier, when you were in the storyboard, you gave your cell the identifier <span class="code">birthdayCellIdentifier</span>
 (see <a href="text00022.html#ch11fig4">Figure 11-4</a>
 ). This identifier links your code to the cell and tells your method that it’s using the right cell. The string for when you call this method needs to be exactly the same as the string you set in the storyboard, or you’ll get an error and the app will crash when you run it.</p>
<p class="indent">In the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 , did you notice the words <em>Reusable Cell</em>
 ? The cells inside a table view are created once and then can be reused over and over. This helps everything run faster and smoother because creating the cell is what takes the most time. If you had 200 birthdays in your app, but only 10 would fit on your screen at one time, then you need only 10 cells to show your birthdays. When you scroll down to reveal more birthdays, the cells that scroll off the top of the screen are reused. They are filled with new information and show up again at the bottom of the screen. The <span class="code">UITableView</span>
 automatically does this work. When the table view is loaded, <span class="code">tableView(_:cellForRowAt:)</span>
 is called for every visible row. When the user scrolls to look at more cells, it’s called again for each row just as it is about to appear on the screen.</p>
<p class="indent">Next, we need to find out which <span class="code">Birthday</span>
 should be displayed inside the cell. We want to display one birthday from the <span class="code">birthdays</span>
 array in each row. The first birthday, which is at <span class="code">birthdays[0]</span>
 , should be displayed in row 0. The second birthday, at <span class="code">birthdays[1]</span>
 , should be displayed in row 1, and so on, which means the <span class="code">indexPath</span>
 ’s <span class="code">row</span>
 is the same as the position in the <span class="code">birthdays</span>
 array that we want to access. The code at <span class="ent">➋</span>
 accesses the <span id="page_166"></span>
 correct <span class="code">Birthday</span>
 object from the <span class="code">birthdays</span>
 array by using <span class="code">indexPath.row</span>
 . Once we have the right <span class="code">Birthday</span>
 object, we assign it to a constant named <span class="code">birthday</span>
 so we can set up the labels in this cell.</p>
<p class="indent">Notice that we’re using <span class="code">let</span>
 to assign the <span class="code">birthday</span>
 to a constant instead of a variable. We can use <span class="code">let</span>
 because each time <span class="code">tableView(_:cellForRowAt:)</span>
 is called, a new <span class="code">birthday</span>
 constant is created. Each cell gets its own <span class="code">birthday</span>
 constant that is assigned its own <span class="code">Birthday</span>
 object. Since we’re not going to change any of the <span class="code">birthday</span>
 constants—we’re just going to read their properties—we don’t want to make them variables.</p>
<p class="indent">Now that you have your cell and your birthday, it’s time to fill in the details. You need two labels for each cell to show the birthday person’s name and birthdate. You set the cell to the Subtitle style so that it has a Title label and a Subtitle label. Each cell will already contain these labels, so now you don’t have to create any labels yourself.</p>
<p class="indent">The labels exist as properties of <span class="code">UITableViewCell</span>
 and are called <span class="code">textLabel</span>
 and <span class="code">detailTextLabel</span>
 . The code at <span class="ent">➌</span>
 sets the text of the <span class="code">textLabel</span>
 to a string made up of the <span class="code">firstName</span>
 and <span class="code">lastName</span>
 of the <span class="code">birthday</span>
 with a space between them. At <span class="ent">➍</span>
 , you use the <span class="code">string(from:)</span>
 method of the <span class="code">dateFormatter</span>
 to display the birthdate in the <span class="code">detailTextLabel</span>
 .</p>
<p class="indent">When your cell is completely configured, <span class="code">tableView( _:cellForRowAt:)</span>
 returns the cell at <span class="ent">➎</span>
 so that it can be displayed at that <span class="code">indexPath</span>
 of the table view.</p>
<h3 class="h3" id="ch11lev1sec2">
<strong>PUTTING IT ALL TOGETHER</strong>
</h3>
<p class="noindent">Now you can add <span class="code">Birthday</span>
 instances to the app using the Add Birthday view controller, and you have a table view to list each <span class="code">Birthday</span>
 in the Birthdays table view controller. But when you try running the app and adding a <span class="code">Birthday</span>
 , it doesn’t appear. To make each <span class="code">Birthday</span>
 you add appear in the table view, you need to make the Add Birthday view controller communicate with the Birthdays table view controller. You do this by using <em>delegation</em>
 .</p>
<h4 class="h4" id="ch11lev2sec5">
<strong>DELEGATION</strong>
</h4>
<p class="noindent">Delegation can be used when one view controller needs to get information from another view controller. Say you have two view controllers: A and B. The first view controller, A, creates B and presents B on top of itself. A knows about B because it created and presented B, so A can pass information along to B. But B doesn’t know about A—it’s just popped into being and doesn’t know where it came from or how it got there. So how can B talk to A? Through delegation!</p>
<div class="image"><img src="Image00245.jpg" />
</div>
<p class="indent">Delegation is when someone gives a job or a task to someone else. A <em>delegate</em>
 is like a boss who tells a delegating employee what to do. When the delegating employee is done with their task, sometimes they’ll report information back to the delegate boss.</p>
<p class="indent"><span id="page_167"></span>
 Delegation in Swift is pretty similar, but instead of having a boss and employee, we have a delegate and a delegating object. Since class B is the one being told what to do by class A, it’s the delegating object. We give class B a special property called a delegate to tell it who its delegate is—that way, it knows who to communicate with. The delegate can be any class that has a set of methods that have been defined in a <em>protocol</em>
 . A protocol is like an agreement between the two classes that tells them what the delegate can ask the delegating object to do. It has a list of method and property names that the delegate can use with the delegating object.</p>
<p class="indent">Class A creates class B, makes itself the delegate of class B, and gives class B a job to do that’s in the protocol. Once class B is done with its job, it reports back to class A. Let’s see how this works in our app.</p>
<p class="indent">The Birthdays table view controller is view controller A, and the Add Birthday view controller is view controller B. We’ll create a protocol called <span class="code">AddBirthdayViewControllerDelegate</span>
 and a method for that protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 , which the Add Birthday view controller will use to report back.</p>
<p class="indent">Take a look at <a href="text00022.html#ch11fig6">Figure 11-6</a>
 . When the user taps the Add button <span class="ent">➊</span>
 , the Birthdays table view controller creates the Add Birthday view controller <span class="ent">➋</span>
 and sets itself as the Add Birthday view controller’s delegate.</p>
<div class="image"><img src="Image00246.jpg" />
</div>
<p class="figcap"><a id="ch11fig6"></a>
 <em>Figure 11-6: A new birthday is added and passed from the Add Birthday view controller to the Birthdays table view controller using delegation.</em>
</p>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<h3 class="h3" id="ch11lev1sec1">
<strong>MAKING THE BIRTHDAY LIST</strong>
</h3>
<p class="noindent">It’s one thing to be able to add birthdays, but you’ll also want to display a list of birthdays. For that you need to create another class, <span class="code">BirthdaysTableViewController</span>
 , which will subclass <span class="code">UITableViewController</span>
 , <span id="page_156"></span>
 a special kind of view controller with a table view. <span class="code">UITableViewController</span>
 contains several built-in methods that allow you to code things like how many rows the table view should have and what should be displayed in each row. We’ll want to have as many rows as we have birthdays and to display one birthday in each row.</p>
<h4 class="h4" id="ch11lev2sec1">
<strong>CREATING THE BIRTHDAYS TABLE VIEW CONTROLLER</strong>
</h4>
<p class="noindent">
<span class="smallcaps">CONTROL</span>
 -click the <em>BirthdayTracker</em>
 folder in the Project navigator and choose <strong>New File…</strong>
 from the menu. In <a href="text00021.html#ch10">Chapter 10</a>
 , we created the Swift file <em>Birthday.swift</em>
 , which Xcode prepared for us with nearly nothing in it. To create a new file this time, we’ll tell Xcode we want to subclass an existing iOS class. Depending on the base class, Xcode will create a file containing some code that you’ll customize to your needs. To create the file, select <strong>iOS</strong>
 at the top of the window and then select the <strong>Cocoa Touch Class</strong>
 template, which will automatically format the new class file (see <a href="text00022.html#ch11fig1">Figure 11-1</a>
 ).</p>
<div class="image"><img src="Image00234.jpg" />
</div>
<p class="figcap"><a id="ch11fig1"></a>
 <em>Figure 11-1: To subclass an existing class, choose</em>
 <strong>
<em>iOS</em>
</strong>
 <em>and then</em>
 <strong>
<em>Cocoa Touch Class.</em>
</strong>
</p>
<p class="indent">When you choose this option, you’ll see a second dialog where you can name your new class and specify which class you’ll subclass. First, in the Subclass field (the second field in the dialog), type <span class="code">
<span class="codestrong">UITableViewController</span>
</span>
 . This will automatically fill in the class field with the subclass name. Once that happens, type <span class="code">
<span class="codestrong">Birthdays</span>
</span>
 in front of <span class="code">TableViewController</span>
 so that the whole class name is <span class="code">BirthdaysTableViewController</span>
 . This is a shortcut so you don’t <span id="page_157"></span>
 have to type as much. Make sure to choose <strong>Swift</strong>
 in the Language drop-down menu as well, and then click <strong>Next</strong>
 . Then select <strong>Create</strong>
 in the final dialog to create your new file.</p>
<p class="indent">In <em>BirthdaysTableViewController.swift</em>
 , Xcode has provided a template with several commented-out methods. You can clean up the code by getting rid of methods we won’t use. Delete just the comments in <span class="code">viewDidLoad()</span>
 , and then delete the entire <span class="code">didReceiveMemoryWarning()</span>
 method and the methods <span class="code">tableView(_:moveRowAt:to:)</span>
 and <span class="code">tableView(_:canMoveRowAt:)</span>
 , which have to do with moving rows in the table view. When you’re finished, the contents of <span class="code">BirthdaysTableViewController</span>
 should look like <a href="text00022.html#ch11fig2">Figure 11-2</a>
 . There are still several commented-out methods, but we’re keeping those to use later!</p>
<div class="image"><img src="Image00235.jpg" />
</div>
<p class="figcap"><a id="ch11fig2"></a>
 <em>Figure 11-2: The</em>
 <span class="code">
<span class="italic">BirthdaysTableViewController</span>
</span>
 <em>cleaned up!</em>
</p>
<p class="indent">Next, you need to make the Birthdays table view controller the <span class="code">BirthdaysTableViewController</span>
 class. To do this, go to <em>Main.storyboard</em>
 and select the <strong>Birthdays</strong>
 scene. Using the Identity Inspector in the right pane, change the class from <span class="code">UITableViewController</span>
 to <span class="code">BirthdaysTableViewController</span>
 , as shown in <a href="text00022.html#ch11fig3">Figure 11-3</a>
 .</p>
<div class="image"><span id="page_158"></span>
 <img src="Image00236.jpg" />
</div>
<p class="figcap"><a id="ch11fig3"></a>
 <em>Figure 11-3: Setting</em>
 <span class="code">
<span class="italic">BirthdaysTableViewController</span>
</span>
 <em>as the class of the Birthdays scene</em>
</p>
<p class="indent">Now that you have the Birthdays table view controller set up in the storyboard, the next step is to make cells in your table that will display each birthday.</p>
<h4 class="h4" id="ch11lev2sec2">
<strong>ADDING CELLS TO THE TABLE VIEW</strong>
</h4>
<p class="noindent">Each birthday will be displayed in a <span class="code">UITableViewCell</span>
 in the Birthdays table view controller. A table has boxes organized into rows and columns that contain information. These boxes are called <em>cells</em>
 . Similarly, a table view also has cells that are all instances of, or a subclass of, the <span class="code">UITableViewCell</span>
 class. We’ll put each birthday into its own cell in our table view.</p>
<p class="indent">We’ll start by creating those cells in the storyboard, and then we’ll fill them with our <span class="code">Birthday</span>
 objects later. In the left outline menu, click the triangle by Birthdays and then click the triangle by Table View to open those sections. Then select <strong>Table View Cell</strong>
 <span class="ent">➊</span>
 , as shown in <a href="text00022.html#ch11fig4">Figure 11-4</a>
 .</p>
<div class="image"><img src="Image00237.jpg" />
</div>
<div class="image"><img src="Image00238.jpg" />
</div>
<p class="figcap"><a id="ch11fig4"></a>
 <em>Figure 11-4: Creating a Subtitle style table view cell and setting its identifier</em>
</p>
<p class="indent"><span id="page_159"></span>
 Next, open the Attributes Inspector. Using the drop-down menu under <strong>Style</strong>
 , set the cell’s style to <strong>Subtitle</strong>
 <span class="ent">➋</span>
 so that the cell now has a Title label and a Subtitle label. You’ll display each person’s name in the Title and birthday in the Subtitle.</p>
<p class="indent">Finally, enter <span class="code">
<span class="codestrong">birthdayCellIdentifier</span>
</span>
 in the Identifier field <span class="ent">➌</span>
 . You’ll use this identifier later when you fill in the cell contents.</p>
<p class="indent">That’s it! You’ve finished your work in the storyboard.</p>
<p class="indent">You may be wondering why we have just one cell in our table view in the storyboard when we’ll have more than one birthday to show in the list. If you look at <a href="text00022.html#ch11fig4">Figure 11-4</a>
 again, you’ll notice that the cell is labeled <em>Prototype Cells</em>
 . This means that the cell you just customized is a <em>template</em>
 for all the cells you want to appear in your table view. The identifier you gave the cell is how your code will tell the table view to produce each cell for you to put birthdays in. You’ll see how this works soon.</p>
<div class="box1">
<p class="box-title">
<strong>WORKING WITH DATES</strong>
</p>
<p class="box-p">Swift has a special data type called <span class="code">Date</span>
 that is used for storing date values. A <span class="code">Date</span>
 object is actually a date and a time. Open your playground and enter the following:</p>
<div class="image"><img src="Image00239.jpg" />
</div>
<p class="box-pi">We’ve just assigned the current date and time the code was run to the variable <span class="code">today</span>
 . When you print <span class="code">today</span>
 , it’s in the format <span class="code">"2017-11-21 10:45:31 +0000\n"</span>
 . What if you wanted it to display as <span class="code">Tuesday, November 21, 2017</span>
 , instead? Or just <span class="code">11/21/17</span>
 ? To display a date in a particular way, you use a <em>date formatter</em>
 , which is a <span class="code">DateFormatter</span>
 object that you create and give a date format style. <span class="code">DateFormatter</span>
 is a helper object that is used to create a display string from any date, and a <em>date format style</em>
 is a property of <span class="code">DateFormatter</span>
 that tells the formatter what style to use. You can create your own date format styles manually, but there are also styles that are included in Swift and ready to use. Add the following to your playground:</p>
<div class="image"><img src="Image00240.jpg" />
</div>
<p class="box-pi">At <span class="ent">➊</span>
 you create a <span class="code">formatter</span>
 . Then at <span class="ent">➋</span>
 , you set the style of the <span class="code">formatter</span>
 to <span class="code">Style.full</span>
 , which will print the day of the week as well as the full month name, date, and year. Finally, you create a string from the date using the <span class="code">string(from:)</span>
 method of the <span class="code">DateFormatter</span>
 class <span class="ent">➌</span>
 . You can see that you now have turned the <span id="page_160"></span>
 date into the nicely formatted string <span class="code">"Tuesday, November 21, 2017"</span>
 . <a style=";color:black;" href="text00022.html#ch11tab1">Table 11-1</a>
 shows the different strings that are created from the five <span class="code">DateFormatter.Style</span>
 options available in Swift.</p>
<p class="tabcap"><a id="ch11tab1" style=";color:black;"></a>
 <strong>Table 11-1:</strong>
 Date Formatter Styles and Their Date Strings</p>
<table class="tabled">
<tbody>
<tr>
<td style="vertical-align: top;" class="border1">
<p class="noindent">
<span class="code">
<span class="codestrong">DateFormatter.Style</span>
</span>
</p>
</td>
<td style="vertical-align: top;" class="border1">
<p class="noindent">
<strong>Date string</strong>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">none</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">""</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">short</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"11/21/17"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">medium</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"Nov 21, 2017"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">long</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"November 21, 2017"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">full</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"Tuesday, November 21, 2017"</span>
</p>
</td>
</tr>
</tbody>
</table>
<p class="box-pi">You can also specify your own custom way of displaying a date using the <span class="code">dateFormat</span>
 property of the <span class="code">DateFormatter</span>
 . Perhaps you only want the month and day. Or maybe you want a four-digit year displayed in the <span class="code">short</span>
 style. Doing either is really easy, and you don’t even have to create a new <span class="code">DateFormatter</span>
 —you can just change the <span class="code">dateFormat</span>
 on <span class="code">formatter</span>
 and then ask it for a new string. Add the following code to your playground to display dates with a specific format:</p>
<div class="image"><img src="Image00241.jpg" />
</div>
<p class="box-pi">At <span class="ent">➊</span>
 , you specify that you only want the month and the date in an <span class="code">MM/dd</span>
 format—that is, a two-digit month followed by a two-digit date. If you want to display the month as three letters, then use <span class="code">MMM</span>
 . To display the full name of the month, use <span class="code">MMMM</span>
 . At <span class="ent">➋</span>
 , we change the date format to use a four-digit year. A two-digit year would be <span class="code">yy</span>
 . Here are a few other ways to use a <span class="code">dateFormat</span>
 to display a custom date string.</p>
<div class="image"><img src="Image00242.jpg" />
</div>
<p class="box-pi"><span id="page_161"></span>
 If you want to include separators, you add them to your <span class="code">dateFormat</span>
 string. For example, if you want periods as separators, then you can create a <span class="code">dateFormat</span>
 like <span class="code">"MM.dd.yy"</span>
 <span class="ent">➊</span>
 . To display an abbreviated day of the week, use <span class="code">EEE</span>
 <span class="ent">➋</span>
 . For the full day, use <span class="code">EEEE</span>
 <span class="ent">➌</span>
 . These are only a few examples. By using combinations of <span class="code">M</span>
 , <span class="code">d</span>
 , <span class="code">y</span>
 , and <span class="code">E</span>
 , you have an endless number of ways to display a date!</p>
</div>
<h4 class="h4" id="ch11lev2sec3">
<strong>SETTING UP THE BIRTHDAYS TABLE VIEW CONTROLLER</strong>
</h4>
<p class="noindent">The Birthdays table view controller will display a list of all the birthdays stored in the app. Do you remember what you use to store a list of items? That’s right—an array! You’ll create an array in the <span class="code">BirthdaysTableViewController</span>
 to store all the birthdays. To do this, give the <span class="code">BirthdaysTableViewController</span>
 a <span class="code">birthdays</span>
 property that is an array of <span class="code">Birthday</span>
 objects. At the top of the class, right above the <span class="code">viewDidLoad()</span>
 method, insert this line to add a variable array property called <span class="code">birthdays</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController {</span>
<br />
<br />
    <span class="pink">var</span>
 birthdays = [<span class="green1">Birthday</span>
 ]()<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent">This line creates an empty array of <span class="code">Birthday</span>
 instances. It needs to be a variable and not a constant because you’ll want to add a saved <span class="code">Birthday</span>
 to this array every time the user adds a <span class="code">Birthday</span>
 with the Add Birthday view controller. You’ll see how to do that in “<a href="text00022.html#ch11lev3sec2">Making the Birthdays Table View Controller Conform to Protocol</a>
 ” on <a href="text00022.html#page_168">page 168</a>
 .</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>Remember that the final versions of the project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>.</em>
</p>
</div>
<p class="indent">The <span class="code">BirthdaysTableViewController</span>
 will also need a <span class="code">dateFormatter</span>
 property to display the birthdate as a nicely formatted string. Add a <span class="code">dateFormatter</span>
 right underneath the <span class="code">birthdays</span>
 array:</p>
<div class="box">
<pre>    <span class="ash">var birthdays = [Birthday]()</span>
<br />
<br />
    <span class="pink">let</span>
 dateFormatter = <span class="violet">DateFormatter</span>
 ()<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent">Note that the <span class="code">dateFormatter</span>
 is a constant that is created with <span class="code">let</span>
 . Even though you’ll change the <span class="code">dateFormatter</span>
 ’s properties, like the <span class="code">dateStyle</span>
 and <span class="code">timeStyle</span>
 , you’ll never change the <span class="code">dateFormatter</span>
 itself.</p>
<p class="indent"><span id="page_162"></span>
 You’ll also need to set up the <span class="code">dateFormatter</span>
 so that it will display the birthdates as fully formatted strings like <span class="code">"Tuesday, December 17, 2008"</span>
 . As you saw in <a href="text00021.html#ch10">Chapter 10</a>
 , a good place to do this is the <span class="code">viewDidLoad()</span>
 method, which is called when the Birthdays table view controller is loading its view. This is the perfect place to do any setup that is needed for this class.</p>
<div class="box">
<pre>
<span class="ash">override func viewDidLoad() {</span>
<br />
    <span class="ash">super.viewDidLoad()</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">dateFormatter</span>
 .<span class="violet">dateStyle</span>
 = .<span class="blue">full</span>
<br />
  <span class="ent">➋</span>
 <span class="green1">dateFormatter</span>
 .<span class="violet">timeStyle</span>
 = .<span class="blue">none</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , you set the <span class="code">dateStyle</span>
 of the <span class="code">dateFormatter</span>
 so that it will display a formatted date string for each <span class="code">Birthday</span>
 . Did you notice how we just wrote <span class="code">.full</span>
 instead of <span class="code">DateFormatter.Style.full</span>
 ? Swift knows what type to expect for the <span class="code">dateStyle</span>
 of a <span class="code">DateFormatter</span>
 , so it lets us take this little shortcut. At <span class="ent">➋</span>
 , you set the <span class="code">timeStyle</span>
 of the <span class="code">dateFormatter</span>
 to <span class="code">.none</span>
 so that the time won’t be shown.</p>
<h4 class="h4" id="ch11lev2sec4">
<strong>DISPLAYING BIRTHDAYS IN A TABLE VIEW</strong>
</h4>
<p class="noindent">The <span class="code">BirthdaysTableViewController</span>
 class has a table view that is used to display a list of items in a single column. The table view has one or more sections containing rows, and each row contains a cell. A section in a table view is a grouping of rows that can be displayed with or without a header. An example of an app that shows a table view with several sections is the Settings app, as shown in <a href="text00022.html#ch11fig5">Figure 11-5</a>
 . It displays a list of rows that have been broken up into different sections.</p>
<p class="indent">Each section and row of a table view is identified with an index number. These numbers start at 0 and then increase by 1 as you go down the table view. For example, the Privacy line in the Settings app is found at section 0, row 1. The News setting is at section 1, row 3.</p>
<p class="indent">In the middle of the <span class="code">BirthdaysTableViewController</span>
 class, there is a section called <em>Table view data source</em>
 with three methods. The table view controller uses these methods to determine what’s going to be displayed inside its table view.</p>
<p class="hang">
<span class="code">
<span class="codestrong">numberOfSections(in:)</span>
</span>
 Tells the table view how many sections it should have</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:numberOfRowsInSection:)</span>
</span>
 Tells the table view how many rows will be displayed in each section</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:cellForRowAt:)</span>
</span>
 Sets up each cell that’s going to be displayed in each row of the table view</p>
<div class="image"><span id="page_163"></span>
 <img src="Image00243.jpg" />
</div>
<p class="figcap"><a id="ch11fig5"></a>
 <em>Figure 11-5: The Settings app uses sections to group rows of different device settings.</em>
</p>
<p class="indent">The table view data source methods are called by the table view controller every time the table view is reloaded. Xcode automatically gives you these method templates when you make a subclass of a <span class="code">UITableViewController</span>
 . You need to implement all three methods for the app to work, even though you’ll never call them directly in your code. The <span class="code">UITableViewController</span>
 class implements the <span class="code">UITableViewDataSource</span>
 protocol, which comes with these data source methods, to determine what will be displayed inside the table view. We’ll discuss protocols in “<a href="text00022.html#ch11lev2sec5">Delegation</a>
 ” on page 166. For now, you just need to know that a <span class="code">UITableViewController</span>
 uses these methods to display its content, and it automatically calls these methods so you don’t need to call them.</p>
<p class="indent">Let’s start with the method <span class="code">numberOfSections(in:)</span>
 . The Birthdays table view controller is a list that just displays <span class="code">Birthday</span>
 instances, so it doesn’t need multiple sections. To set the number of sections in the table view, we just need to return <span class="code">1</span>
 .</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func numberOfSections(in tableView: UITableView) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 <span class="blue1">1</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent"><span id="page_164"></span>
 This method takes a <span class="code">UITableView</span>
 called <span class="code">tableView</span>
 as a parameter, which is the table view that uses this class as its data source. We don’t need to worry about making this connection because the <span class="code">UITableViewController</span>
 comes with a built-in table view that is automatically hooked up to these methods. Each birthday will be displayed in its own row. So in <span class="code">tableView(_:numberOfRowsInSection:)</span>
 , in order to have the right number of rows for all of your birthdays, you need to return the number of <span class="code">Birthday</span>
 instances that you have in your <span class="code">birthdays</span>
 array. Do you remember the <span class="code">count</span>
 property of an array? It’s an integer that tells you how many items are in that array, and it’s perfect for this situation! Change this method to the following:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, <img class="inline" src="Image00184.jpg" />
<br />
    numberOfRowsInSection section: Int) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 birthdays.<span class="violet">count</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">In addition to the <span class="code">tableView</span>
 parameter, <span class="code">tableView(_:numberOfRowsInSection:)</span>
 also takes an <span class="code">Int</span>
 called <span class="code">section</span>
 . When the table view is loading itself, this method is called for each section in the table view. In our case, we have only one section, so we don’t need to bother checking which <span class="code">section</span>
 of the table view is being displayed here. We know it’s section 0, and we want it to have as many rows as there are birthdays, so we write <span class="code">return birthdays.count</span>
 .</p>
<p class="indent">Finally, you need to implement <span class="code">tableView(_:cellForRowAt:)</span>
 so that the table view will know what to put inside each cell. Since this method is commented out, you need to uncomment it by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it. (Be careful not to accidentally uncomment the other methods after it!) After you’ve done that, change it to the following code:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, cellForRowAt <img class="inline" src="Image00184.jpg" />
<br />
    indexPath: IndexPath) -&gt; UITableViewCell {</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="pink">let</span>
 cell = tableView.<span class="blue">dequeueReusableCell</span>
 (withIdentifier: <img class="inline" src="Image00093.jpg" />
<br />
        <span class="red">"birthdayCellIdentifier"</span>
 , for: indexPath)<br />
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 birthday = <span class="green1">birthdays</span>
 [indexPath.<span class="violet">row</span>
 ]<br />
<br />
  <span class="ent">➌</span>
 cell.<span class="violet">textLabel</span>
 ?.<span class="violet">text</span>
 = birthday.<span class="green1">firstName</span>
 <span class="blue">+</span>
 <span class="red">" "</span>
 <span class="blue">+</span>
 <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">lastName</span>
<br />
<br />
  <span class="ent">➍</span>
 cell.<span class="violet">detailTextLabel</span>
 ?.<span class="violet">text</span>
 = <span class="green1">dateFormatter</span>
 .<span class="blue">string</span>
 (from: <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">birthdate</span>
 )<br />
<br />
  <span class="ent">➎</span>
 <span class="pink">return</span>
 cell<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">You don’t call the method <span class="code">tableView(_:cellForRowAt:)</span>
 . It’s called when the table view is loaded onto the screen. It’s called for each cell on the screen and takes two parameters, <span class="code">tableView</span>
 and <span class="code">indexPath</span>
 . You already know <span id="page_165"></span>
 what the <span class="code">tableView</span>
 parameter is for. An <span class="code">IndexPath</span>
 is a Swift struct that’s used to represent a row’s position in a table view. An <span class="code">IndexPath</span>
 instance has a <span class="code">section</span>
 property and a <span class="code">row</span>
 property. Since this method will be called many times (once for every row in the table), we need the <span class="code">indexPath</span>
 to know which section and row we’re currently configuring. The <span class="code">indexPath.section</span>
 property gives the section number, and the <span class="code">indexPath.row</span>
 gives the row of the table view cell. The five lines of code inside <span class="code">tableView(_:cellForRowAt:)</span>
 will do the following:</p>
<div class="image"><img src="Image00244.jpg" />
</div>
<p class="bull">• Create a <span class="code">UITableViewCell</span>
</p>
<p class="bull">• Figure out which <span class="code">Birthday</span>
 in the <span class="code">birthdays</span>
 array will be displayed inside the cell</p>
<p class="bull">• Make two labels to display the birthday person’s name and birthdate in the cell</p>
<p class="bull">• Return the cell ready for display in the table view</p>
<p class="indentt">Let’s go through this code line by line.</p>
<p class="indent">First, create the <span class="code">UITableViewCell</span>
 . The code at <span class="ent">➊</span>
 does this using the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 . Before you can start using this method on a cell, though, you need to tell the method which cell you want to use from the storyboard. Earlier, when you were in the storyboard, you gave your cell the identifier <span class="code">birthdayCellIdentifier</span>
 (see <a href="text00022.html#ch11fig4">Figure 11-4</a>
 ). This identifier links your code to the cell and tells your method that it’s using the right cell. The string for when you call this method needs to be exactly the same as the string you set in the storyboard, or you’ll get an error and the app will crash when you run it.</p>
<p class="indent">In the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 , did you notice the words <em>Reusable Cell</em>
 ? The cells inside a table view are created once and then can be reused over and over. This helps everything run faster and smoother because creating the cell is what takes the most time. If you had 200 birthdays in your app, but only 10 would fit on your screen at one time, then you need only 10 cells to show your birthdays. When you scroll down to reveal more birthdays, the cells that scroll off the top of the screen are reused. They are filled with new information and show up again at the bottom of the screen. The <span class="code">UITableView</span>
 automatically does this work. When the table view is loaded, <span class="code">tableView(_:cellForRowAt:)</span>
 is called for every visible row. When the user scrolls to look at more cells, it’s called again for each row just as it is about to appear on the screen.</p>
<p class="indent">Next, we need to find out which <span class="code">Birthday</span>
 should be displayed inside the cell. We want to display one birthday from the <span class="code">birthdays</span>
 array in each row. The first birthday, which is at <span class="code">birthdays[0]</span>
 , should be displayed in row 0. The second birthday, at <span class="code">birthdays[1]</span>
 , should be displayed in row 1, and so on, which means the <span class="code">indexPath</span>
 ’s <span class="code">row</span>
 is the same as the position in the <span class="code">birthdays</span>
 array that we want to access. The code at <span class="ent">➋</span>
 accesses the <span id="page_166"></span>
 correct <span class="code">Birthday</span>
 object from the <span class="code">birthdays</span>
 array by using <span class="code">indexPath.row</span>
 . Once we have the right <span class="code">Birthday</span>
 object, we assign it to a constant named <span class="code">birthday</span>
 so we can set up the labels in this cell.</p>
<p class="indent">Notice that we’re using <span class="code">let</span>
 to assign the <span class="code">birthday</span>
 to a constant instead of a variable. We can use <span class="code">let</span>
 because each time <span class="code">tableView(_:cellForRowAt:)</span>
 is called, a new <span class="code">birthday</span>
 constant is created. Each cell gets its own <span class="code">birthday</span>
 constant that is assigned its own <span class="code">Birthday</span>
 object. Since we’re not going to change any of the <span class="code">birthday</span>
 constants—we’re just going to read their properties—we don’t want to make them variables.</p>
<p class="indent">Now that you have your cell and your birthday, it’s time to fill in the details. You need two labels for each cell to show the birthday person’s name and birthdate. You set the cell to the Subtitle style so that it has a Title label and a Subtitle label. Each cell will already contain these labels, so now you don’t have to create any labels yourself.</p>
<p class="indent">The labels exist as properties of <span class="code">UITableViewCell</span>
 and are called <span class="code">textLabel</span>
 and <span class="code">detailTextLabel</span>
 . The code at <span class="ent">➌</span>
 sets the text of the <span class="code">textLabel</span>
 to a string made up of the <span class="code">firstName</span>
 and <span class="code">lastName</span>
 of the <span class="code">birthday</span>
 with a space between them. At <span class="ent">➍</span>
 , you use the <span class="code">string(from:)</span>
 method of the <span class="code">dateFormatter</span>
 to display the birthdate in the <span class="code">detailTextLabel</span>
 .</p>
<p class="indent">When your cell is completely configured, <span class="code">tableView( _:cellForRowAt:)</span>
 returns the cell at <span class="ent">➎</span>
 so that it can be displayed at that <span class="code">indexPath</span>
 of the table view.</p>
<h3 class="h3" id="ch11lev1sec2">
<strong>PUTTING IT ALL TOGETHER</strong>
</h3>
<p class="noindent">Now you can add <span class="code">Birthday</span>
 instances to the app using the Add Birthday view controller, and you have a table view to list each <span class="code">Birthday</span>
 in the Birthdays table view controller. But when you try running the app and adding a <span class="code">Birthday</span>
 , it doesn’t appear. To make each <span class="code">Birthday</span>
 you add appear in the table view, you need to make the Add Birthday view controller communicate with the Birthdays table view controller. You do this by using <em>delegation</em>
 .</p>
<h4 class="h4" id="ch11lev2sec5">
<strong>DELEGATION</strong>
</h4>
<p class="noindent">Delegation can be used when one view controller needs to get information from another view controller. Say you have two view controllers: A and B. The first view controller, A, creates B and presents B on top of itself. A knows about B because it created and presented B, so A can pass information along to B. But B doesn’t know about A—it’s just popped into being and doesn’t know where it came from or how it got there. So how can B talk to A? Through delegation!</p>
<div class="image"><img src="Image00245.jpg" />
</div>
<p class="indent">Delegation is when someone gives a job or a task to someone else. A <em>delegate</em>
 is like a boss who tells a delegating employee what to do. When the delegating employee is done with their task, sometimes they’ll report information back to the delegate boss.</p>
<p class="indent"><span id="page_167"></span>
 Delegation in Swift is pretty similar, but instead of having a boss and employee, we have a delegate and a delegating object. Since class B is the one being told what to do by class A, it’s the delegating object. We give class B a special property called a delegate to tell it who its delegate is—that way, it knows who to communicate with. The delegate can be any class that has a set of methods that have been defined in a <em>protocol</em>
 . A protocol is like an agreement between the two classes that tells them what the delegate can ask the delegating object to do. It has a list of method and property names that the delegate can use with the delegating object.</p>
<p class="indent">Class A creates class B, makes itself the delegate of class B, and gives class B a job to do that’s in the protocol. Once class B is done with its job, it reports back to class A. Let’s see how this works in our app.</p>
<p class="indent">The Birthdays table view controller is view controller A, and the Add Birthday view controller is view controller B. We’ll create a protocol called <span class="code">AddBirthdayViewControllerDelegate</span>
 and a method for that protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 , which the Add Birthday view controller will use to report back.</p>
<p class="indent">Take a look at <a href="text00022.html#ch11fig6">Figure 11-6</a>
 . When the user taps the Add button <span class="ent">➊</span>
 , the Birthdays table view controller creates the Add Birthday view controller <span class="ent">➋</span>
 and sets itself as the Add Birthday view controller’s delegate.</p>
<div class="image"><img src="Image00246.jpg" />
</div>
<p class="figcap"><a id="ch11fig6"></a>
 <em>Figure 11-6: A new birthday is added and passed from the Add Birthday view controller to the Birthdays table view controller using delegation.</em>
</p>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="noindent">It’s one thing to be able to add birthdays, but you’ll also want to display a list of birthdays. For that you need to create another class, <span class="code">BirthdaysTableViewController</span>
 , which will subclass <span class="code">UITableViewController</span>
 , <span id="page_156"></span>
 a special kind of view controller with a table view. <span class="code">UITableViewController</span>
 contains several built-in methods that allow you to code things like how many rows the table view should have and what should be displayed in each row. We’ll want to have as many rows as we have birthdays and to display one birthday in each row.</p>
<h4 class="h4" id="ch11lev2sec1">
<strong>CREATING THE BIRTHDAYS TABLE VIEW CONTROLLER</strong>
</h4>
<p class="noindent">
<span class="smallcaps">CONTROL</span>
 -click the <em>BirthdayTracker</em>
 folder in the Project navigator and choose <strong>New File…</strong>
 from the menu. In <a href="text00021.html#ch10">Chapter 10</a>
 , we created the Swift file <em>Birthday.swift</em>
 , which Xcode prepared for us with nearly nothing in it. To create a new file this time, we’ll tell Xcode we want to subclass an existing iOS class. Depending on the base class, Xcode will create a file containing some code that you’ll customize to your needs. To create the file, select <strong>iOS</strong>
 at the top of the window and then select the <strong>Cocoa Touch Class</strong>
 template, which will automatically format the new class file (see <a href="text00022.html#ch11fig1">Figure 11-1</a>
 ).</p>
<div class="image"><img src="Image00234.jpg" />
</div>
<p class="figcap"><a id="ch11fig1"></a>
 <em>Figure 11-1: To subclass an existing class, choose</em>
 <strong>
<em>iOS</em>
</strong>
 <em>and then</em>
 <strong>
<em>Cocoa Touch Class.</em>
</strong>
</p>
<p class="indent">When you choose this option, you’ll see a second dialog where you can name your new class and specify which class you’ll subclass. First, in the Subclass field (the second field in the dialog), type <span class="code">
<span class="codestrong">UITableViewController</span>
</span>
 . This will automatically fill in the class field with the subclass name. Once that happens, type <span class="code">
<span class="codestrong">Birthdays</span>
</span>
 in front of <span class="code">TableViewController</span>
 so that the whole class name is <span class="code">BirthdaysTableViewController</span>
 . This is a shortcut so you don’t <span id="page_157"></span>
 have to type as much. Make sure to choose <strong>Swift</strong>
 in the Language drop-down menu as well, and then click <strong>Next</strong>
 . Then select <strong>Create</strong>
 in the final dialog to create your new file.</p>
<p class="indent">In <em>BirthdaysTableViewController.swift</em>
 , Xcode has provided a template with several commented-out methods. You can clean up the code by getting rid of methods we won’t use. Delete just the comments in <span class="code">viewDidLoad()</span>
 , and then delete the entire <span class="code">didReceiveMemoryWarning()</span>
 method and the methods <span class="code">tableView(_:moveRowAt:to:)</span>
 and <span class="code">tableView(_:canMoveRowAt:)</span>
 , which have to do with moving rows in the table view. When you’re finished, the contents of <span class="code">BirthdaysTableViewController</span>
 should look like <a href="text00022.html#ch11fig2">Figure 11-2</a>
 . There are still several commented-out methods, but we’re keeping those to use later!</p>
<div class="image"><img src="Image00235.jpg" />
</div>
<p class="figcap"><a id="ch11fig2"></a>
 <em>Figure 11-2: The</em>
 <span class="code">
<span class="italic">BirthdaysTableViewController</span>
</span>
 <em>cleaned up!</em>
</p>
<p class="indent">Next, you need to make the Birthdays table view controller the <span class="code">BirthdaysTableViewController</span>
 class. To do this, go to <em>Main.storyboard</em>
 and select the <strong>Birthdays</strong>
 scene. Using the Identity Inspector in the right pane, change the class from <span class="code">UITableViewController</span>
 to <span class="code">BirthdaysTableViewController</span>
 , as shown in <a href="text00022.html#ch11fig3">Figure 11-3</a>
 .</p>
<div class="image"><span id="page_158"></span>
 <img src="Image00236.jpg" />
</div>
<p class="figcap"><a id="ch11fig3"></a>
 <em>Figure 11-3: Setting</em>
 <span class="code">
<span class="italic">BirthdaysTableViewController</span>
</span>
 <em>as the class of the Birthdays scene</em>
</p>
<p class="indent">Now that you have the Birthdays table view controller set up in the storyboard, the next step is to make cells in your table that will display each birthday.</p>
<h4 class="h4" id="ch11lev2sec2">
<strong>ADDING CELLS TO THE TABLE VIEW</strong>
</h4>
<p class="noindent">Each birthday will be displayed in a <span class="code">UITableViewCell</span>
 in the Birthdays table view controller. A table has boxes organized into rows and columns that contain information. These boxes are called <em>cells</em>
 . Similarly, a table view also has cells that are all instances of, or a subclass of, the <span class="code">UITableViewCell</span>
 class. We’ll put each birthday into its own cell in our table view.</p>
<p class="indent">We’ll start by creating those cells in the storyboard, and then we’ll fill them with our <span class="code">Birthday</span>
 objects later. In the left outline menu, click the triangle by Birthdays and then click the triangle by Table View to open those sections. Then select <strong>Table View Cell</strong>
 <span class="ent">➊</span>
 , as shown in <a href="text00022.html#ch11fig4">Figure 11-4</a>
 .</p>
<div class="image"><img src="Image00237.jpg" />
</div>
<div class="image"><img src="Image00238.jpg" />
</div>
<p class="figcap"><a id="ch11fig4"></a>
 <em>Figure 11-4: Creating a Subtitle style table view cell and setting its identifier</em>
</p>
<p class="indent"><span id="page_159"></span>
 Next, open the Attributes Inspector. Using the drop-down menu under <strong>Style</strong>
 , set the cell’s style to <strong>Subtitle</strong>
 <span class="ent">➋</span>
 so that the cell now has a Title label and a Subtitle label. You’ll display each person’s name in the Title and birthday in the Subtitle.</p>
<p class="indent">Finally, enter <span class="code">
<span class="codestrong">birthdayCellIdentifier</span>
</span>
 in the Identifier field <span class="ent">➌</span>
 . You’ll use this identifier later when you fill in the cell contents.</p>
<p class="indent">That’s it! You’ve finished your work in the storyboard.</p>
<p class="indent">You may be wondering why we have just one cell in our table view in the storyboard when we’ll have more than one birthday to show in the list. If you look at <a href="text00022.html#ch11fig4">Figure 11-4</a>
 again, you’ll notice that the cell is labeled <em>Prototype Cells</em>
 . This means that the cell you just customized is a <em>template</em>
 for all the cells you want to appear in your table view. The identifier you gave the cell is how your code will tell the table view to produce each cell for you to put birthdays in. You’ll see how this works soon.</p>
<div class="box1">
<p class="box-title">
<strong>WORKING WITH DATES</strong>
</p>
<p class="box-p">Swift has a special data type called <span class="code">Date</span>
 that is used for storing date values. A <span class="code">Date</span>
 object is actually a date and a time. Open your playground and enter the following:</p>
<div class="image"><img src="Image00239.jpg" />
</div>
<p class="box-pi">We’ve just assigned the current date and time the code was run to the variable <span class="code">today</span>
 . When you print <span class="code">today</span>
 , it’s in the format <span class="code">"2017-11-21 10:45:31 +0000\n"</span>
 . What if you wanted it to display as <span class="code">Tuesday, November 21, 2017</span>
 , instead? Or just <span class="code">11/21/17</span>
 ? To display a date in a particular way, you use a <em>date formatter</em>
 , which is a <span class="code">DateFormatter</span>
 object that you create and give a date format style. <span class="code">DateFormatter</span>
 is a helper object that is used to create a display string from any date, and a <em>date format style</em>
 is a property of <span class="code">DateFormatter</span>
 that tells the formatter what style to use. You can create your own date format styles manually, but there are also styles that are included in Swift and ready to use. Add the following to your playground:</p>
<div class="image"><img src="Image00240.jpg" />
</div>
<p class="box-pi">At <span class="ent">➊</span>
 you create a <span class="code">formatter</span>
 . Then at <span class="ent">➋</span>
 , you set the style of the <span class="code">formatter</span>
 to <span class="code">Style.full</span>
 , which will print the day of the week as well as the full month name, date, and year. Finally, you create a string from the date using the <span class="code">string(from:)</span>
 method of the <span class="code">DateFormatter</span>
 class <span class="ent">➌</span>
 . You can see that you now have turned the <span id="page_160"></span>
 date into the nicely formatted string <span class="code">"Tuesday, November 21, 2017"</span>
 . <a style=";color:black;" href="text00022.html#ch11tab1">Table 11-1</a>
 shows the different strings that are created from the five <span class="code">DateFormatter.Style</span>
 options available in Swift.</p>
<p class="tabcap"><a id="ch11tab1" style=";color:black;"></a>
 <strong>Table 11-1:</strong>
 Date Formatter Styles and Their Date Strings</p>
<table class="tabled">
<tbody>
<tr>
<td style="vertical-align: top;" class="border1">
<p class="noindent">
<span class="code">
<span class="codestrong">DateFormatter.Style</span>
</span>
</p>
</td>
<td style="vertical-align: top;" class="border1">
<p class="noindent">
<strong>Date string</strong>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">none</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">""</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">short</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"11/21/17"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">medium</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"Nov 21, 2017"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">long</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"November 21, 2017"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">full</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"Tuesday, November 21, 2017"</span>
</p>
</td>
</tr>
</tbody>
</table>
<p class="box-pi">You can also specify your own custom way of displaying a date using the <span class="code">dateFormat</span>
 property of the <span class="code">DateFormatter</span>
 . Perhaps you only want the month and day. Or maybe you want a four-digit year displayed in the <span class="code">short</span>
 style. Doing either is really easy, and you don’t even have to create a new <span class="code">DateFormatter</span>
 —you can just change the <span class="code">dateFormat</span>
 on <span class="code">formatter</span>
 and then ask it for a new string. Add the following code to your playground to display dates with a specific format:</p>
<div class="image"><img src="Image00241.jpg" />
</div>
<p class="box-pi">At <span class="ent">➊</span>
 , you specify that you only want the month and the date in an <span class="code">MM/dd</span>
 format—that is, a two-digit month followed by a two-digit date. If you want to display the month as three letters, then use <span class="code">MMM</span>
 . To display the full name of the month, use <span class="code">MMMM</span>
 . At <span class="ent">➋</span>
 , we change the date format to use a four-digit year. A two-digit year would be <span class="code">yy</span>
 . Here are a few other ways to use a <span class="code">dateFormat</span>
 to display a custom date string.</p>
<div class="image"><img src="Image00242.jpg" />
</div>
<p class="box-pi"><span id="page_161"></span>
 If you want to include separators, you add them to your <span class="code">dateFormat</span>
 string. For example, if you want periods as separators, then you can create a <span class="code">dateFormat</span>
 like <span class="code">"MM.dd.yy"</span>
 <span class="ent">➊</span>
 . To display an abbreviated day of the week, use <span class="code">EEE</span>
 <span class="ent">➋</span>
 . For the full day, use <span class="code">EEEE</span>
 <span class="ent">➌</span>
 . These are only a few examples. By using combinations of <span class="code">M</span>
 , <span class="code">d</span>
 , <span class="code">y</span>
 , and <span class="code">E</span>
 , you have an endless number of ways to display a date!</p>
</div>
<h4 class="h4" id="ch11lev2sec3">
<strong>SETTING UP THE BIRTHDAYS TABLE VIEW CONTROLLER</strong>
</h4>
<p class="noindent">The Birthdays table view controller will display a list of all the birthdays stored in the app. Do you remember what you use to store a list of items? That’s right—an array! You’ll create an array in the <span class="code">BirthdaysTableViewController</span>
 to store all the birthdays. To do this, give the <span class="code">BirthdaysTableViewController</span>
 a <span class="code">birthdays</span>
 property that is an array of <span class="code">Birthday</span>
 objects. At the top of the class, right above the <span class="code">viewDidLoad()</span>
 method, insert this line to add a variable array property called <span class="code">birthdays</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController {</span>
<br />
<br />
    <span class="pink">var</span>
 birthdays = [<span class="green1">Birthday</span>
 ]()<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent">This line creates an empty array of <span class="code">Birthday</span>
 instances. It needs to be a variable and not a constant because you’ll want to add a saved <span class="code">Birthday</span>
 to this array every time the user adds a <span class="code">Birthday</span>
 with the Add Birthday view controller. You’ll see how to do that in “<a href="text00022.html#ch11lev3sec2">Making the Birthdays Table View Controller Conform to Protocol</a>
 ” on <a href="text00022.html#page_168">page 168</a>
 .</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>Remember that the final versions of the project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>.</em>
</p>
</div>
<p class="indent">The <span class="code">BirthdaysTableViewController</span>
 will also need a <span class="code">dateFormatter</span>
 property to display the birthdate as a nicely formatted string. Add a <span class="code">dateFormatter</span>
 right underneath the <span class="code">birthdays</span>
 array:</p>
<div class="box">
<pre>    <span class="ash">var birthdays = [Birthday]()</span>
<br />
<br />
    <span class="pink">let</span>
 dateFormatter = <span class="violet">DateFormatter</span>
 ()<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent">Note that the <span class="code">dateFormatter</span>
 is a constant that is created with <span class="code">let</span>
 . Even though you’ll change the <span class="code">dateFormatter</span>
 ’s properties, like the <span class="code">dateStyle</span>
 and <span class="code">timeStyle</span>
 , you’ll never change the <span class="code">dateFormatter</span>
 itself.</p>
<p class="indent"><span id="page_162"></span>
 You’ll also need to set up the <span class="code">dateFormatter</span>
 so that it will display the birthdates as fully formatted strings like <span class="code">"Tuesday, December 17, 2008"</span>
 . As you saw in <a href="text00021.html#ch10">Chapter 10</a>
 , a good place to do this is the <span class="code">viewDidLoad()</span>
 method, which is called when the Birthdays table view controller is loading its view. This is the perfect place to do any setup that is needed for this class.</p>
<div class="box">
<pre>
<span class="ash">override func viewDidLoad() {</span>
<br />
    <span class="ash">super.viewDidLoad()</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">dateFormatter</span>
 .<span class="violet">dateStyle</span>
 = .<span class="blue">full</span>
<br />
  <span class="ent">➋</span>
 <span class="green1">dateFormatter</span>
 .<span class="violet">timeStyle</span>
 = .<span class="blue">none</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , you set the <span class="code">dateStyle</span>
 of the <span class="code">dateFormatter</span>
 so that it will display a formatted date string for each <span class="code">Birthday</span>
 . Did you notice how we just wrote <span class="code">.full</span>
 instead of <span class="code">DateFormatter.Style.full</span>
 ? Swift knows what type to expect for the <span class="code">dateStyle</span>
 of a <span class="code">DateFormatter</span>
 , so it lets us take this little shortcut. At <span class="ent">➋</span>
 , you set the <span class="code">timeStyle</span>
 of the <span class="code">dateFormatter</span>
 to <span class="code">.none</span>
 so that the time won’t be shown.</p>
<h4 class="h4" id="ch11lev2sec4">
<strong>DISPLAYING BIRTHDAYS IN A TABLE VIEW</strong>
</h4>
<p class="noindent">The <span class="code">BirthdaysTableViewController</span>
 class has a table view that is used to display a list of items in a single column. The table view has one or more sections containing rows, and each row contains a cell. A section in a table view is a grouping of rows that can be displayed with or without a header. An example of an app that shows a table view with several sections is the Settings app, as shown in <a href="text00022.html#ch11fig5">Figure 11-5</a>
 . It displays a list of rows that have been broken up into different sections.</p>
<p class="indent">Each section and row of a table view is identified with an index number. These numbers start at 0 and then increase by 1 as you go down the table view. For example, the Privacy line in the Settings app is found at section 0, row 1. The News setting is at section 1, row 3.</p>
<p class="indent">In the middle of the <span class="code">BirthdaysTableViewController</span>
 class, there is a section called <em>Table view data source</em>
 with three methods. The table view controller uses these methods to determine what’s going to be displayed inside its table view.</p>
<p class="hang">
<span class="code">
<span class="codestrong">numberOfSections(in:)</span>
</span>
 Tells the table view how many sections it should have</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:numberOfRowsInSection:)</span>
</span>
 Tells the table view how many rows will be displayed in each section</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:cellForRowAt:)</span>
</span>
 Sets up each cell that’s going to be displayed in each row of the table view</p>
<div class="image"><span id="page_163"></span>
 <img src="Image00243.jpg" />
</div>
<p class="figcap"><a id="ch11fig5"></a>
 <em>Figure 11-5: The Settings app uses sections to group rows of different device settings.</em>
</p>
<p class="indent">The table view data source methods are called by the table view controller every time the table view is reloaded. Xcode automatically gives you these method templates when you make a subclass of a <span class="code">UITableViewController</span>
 . You need to implement all three methods for the app to work, even though you’ll never call them directly in your code. The <span class="code">UITableViewController</span>
 class implements the <span class="code">UITableViewDataSource</span>
 protocol, which comes with these data source methods, to determine what will be displayed inside the table view. We’ll discuss protocols in “<a href="text00022.html#ch11lev2sec5">Delegation</a>
 ” on page 166. For now, you just need to know that a <span class="code">UITableViewController</span>
 uses these methods to display its content, and it automatically calls these methods so you don’t need to call them.</p>
<p class="indent">Let’s start with the method <span class="code">numberOfSections(in:)</span>
 . The Birthdays table view controller is a list that just displays <span class="code">Birthday</span>
 instances, so it doesn’t need multiple sections. To set the number of sections in the table view, we just need to return <span class="code">1</span>
 .</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func numberOfSections(in tableView: UITableView) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 <span class="blue1">1</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent"><span id="page_164"></span>
 This method takes a <span class="code">UITableView</span>
 called <span class="code">tableView</span>
 as a parameter, which is the table view that uses this class as its data source. We don’t need to worry about making this connection because the <span class="code">UITableViewController</span>
 comes with a built-in table view that is automatically hooked up to these methods. Each birthday will be displayed in its own row. So in <span class="code">tableView(_:numberOfRowsInSection:)</span>
 , in order to have the right number of rows for all of your birthdays, you need to return the number of <span class="code">Birthday</span>
 instances that you have in your <span class="code">birthdays</span>
 array. Do you remember the <span class="code">count</span>
 property of an array? It’s an integer that tells you how many items are in that array, and it’s perfect for this situation! Change this method to the following:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, <img class="inline" src="Image00184.jpg" />
<br />
    numberOfRowsInSection section: Int) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 birthdays.<span class="violet">count</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">In addition to the <span class="code">tableView</span>
 parameter, <span class="code">tableView(_:numberOfRowsInSection:)</span>
 also takes an <span class="code">Int</span>
 called <span class="code">section</span>
 . When the table view is loading itself, this method is called for each section in the table view. In our case, we have only one section, so we don’t need to bother checking which <span class="code">section</span>
 of the table view is being displayed here. We know it’s section 0, and we want it to have as many rows as there are birthdays, so we write <span class="code">return birthdays.count</span>
 .</p>
<p class="indent">Finally, you need to implement <span class="code">tableView(_:cellForRowAt:)</span>
 so that the table view will know what to put inside each cell. Since this method is commented out, you need to uncomment it by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it. (Be careful not to accidentally uncomment the other methods after it!) After you’ve done that, change it to the following code:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, cellForRowAt <img class="inline" src="Image00184.jpg" />
<br />
    indexPath: IndexPath) -&gt; UITableViewCell {</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="pink">let</span>
 cell = tableView.<span class="blue">dequeueReusableCell</span>
 (withIdentifier: <img class="inline" src="Image00093.jpg" />
<br />
        <span class="red">"birthdayCellIdentifier"</span>
 , for: indexPath)<br />
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 birthday = <span class="green1">birthdays</span>
 [indexPath.<span class="violet">row</span>
 ]<br />
<br />
  <span class="ent">➌</span>
 cell.<span class="violet">textLabel</span>
 ?.<span class="violet">text</span>
 = birthday.<span class="green1">firstName</span>
 <span class="blue">+</span>
 <span class="red">" "</span>
 <span class="blue">+</span>
 <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">lastName</span>
<br />
<br />
  <span class="ent">➍</span>
 cell.<span class="violet">detailTextLabel</span>
 ?.<span class="violet">text</span>
 = <span class="green1">dateFormatter</span>
 .<span class="blue">string</span>
 (from: <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">birthdate</span>
 )<br />
<br />
  <span class="ent">➎</span>
 <span class="pink">return</span>
 cell<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">You don’t call the method <span class="code">tableView(_:cellForRowAt:)</span>
 . It’s called when the table view is loaded onto the screen. It’s called for each cell on the screen and takes two parameters, <span class="code">tableView</span>
 and <span class="code">indexPath</span>
 . You already know <span id="page_165"></span>
 what the <span class="code">tableView</span>
 parameter is for. An <span class="code">IndexPath</span>
 is a Swift struct that’s used to represent a row’s position in a table view. An <span class="code">IndexPath</span>
 instance has a <span class="code">section</span>
 property and a <span class="code">row</span>
 property. Since this method will be called many times (once for every row in the table), we need the <span class="code">indexPath</span>
 to know which section and row we’re currently configuring. The <span class="code">indexPath.section</span>
 property gives the section number, and the <span class="code">indexPath.row</span>
 gives the row of the table view cell. The five lines of code inside <span class="code">tableView(_:cellForRowAt:)</span>
 will do the following:</p>
<div class="image"><img src="Image00244.jpg" />
</div>
<p class="bull">• Create a <span class="code">UITableViewCell</span>
</p>
<p class="bull">• Figure out which <span class="code">Birthday</span>
 in the <span class="code">birthdays</span>
 array will be displayed inside the cell</p>
<p class="bull">• Make two labels to display the birthday person’s name and birthdate in the cell</p>
<p class="bull">• Return the cell ready for display in the table view</p>
<p class="indentt">Let’s go through this code line by line.</p>
<p class="indent">First, create the <span class="code">UITableViewCell</span>
 . The code at <span class="ent">➊</span>
 does this using the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 . Before you can start using this method on a cell, though, you need to tell the method which cell you want to use from the storyboard. Earlier, when you were in the storyboard, you gave your cell the identifier <span class="code">birthdayCellIdentifier</span>
 (see <a href="text00022.html#ch11fig4">Figure 11-4</a>
 ). This identifier links your code to the cell and tells your method that it’s using the right cell. The string for when you call this method needs to be exactly the same as the string you set in the storyboard, or you’ll get an error and the app will crash when you run it.</p>
<p class="indent">In the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 , did you notice the words <em>Reusable Cell</em>
 ? The cells inside a table view are created once and then can be reused over and over. This helps everything run faster and smoother because creating the cell is what takes the most time. If you had 200 birthdays in your app, but only 10 would fit on your screen at one time, then you need only 10 cells to show your birthdays. When you scroll down to reveal more birthdays, the cells that scroll off the top of the screen are reused. They are filled with new information and show up again at the bottom of the screen. The <span class="code">UITableView</span>
 automatically does this work. When the table view is loaded, <span class="code">tableView(_:cellForRowAt:)</span>
 is called for every visible row. When the user scrolls to look at more cells, it’s called again for each row just as it is about to appear on the screen.</p>
<p class="indent">Next, we need to find out which <span class="code">Birthday</span>
 should be displayed inside the cell. We want to display one birthday from the <span class="code">birthdays</span>
 array in each row. The first birthday, which is at <span class="code">birthdays[0]</span>
 , should be displayed in row 0. The second birthday, at <span class="code">birthdays[1]</span>
 , should be displayed in row 1, and so on, which means the <span class="code">indexPath</span>
 ’s <span class="code">row</span>
 is the same as the position in the <span class="code">birthdays</span>
 array that we want to access. The code at <span class="ent">➋</span>
 accesses the <span id="page_166"></span>
 correct <span class="code">Birthday</span>
 object from the <span class="code">birthdays</span>
 array by using <span class="code">indexPath.row</span>
 . Once we have the right <span class="code">Birthday</span>
 object, we assign it to a constant named <span class="code">birthday</span>
 so we can set up the labels in this cell.</p>
<p class="indent">Notice that we’re using <span class="code">let</span>
 to assign the <span class="code">birthday</span>
 to a constant instead of a variable. We can use <span class="code">let</span>
 because each time <span class="code">tableView(_:cellForRowAt:)</span>
 is called, a new <span class="code">birthday</span>
 constant is created. Each cell gets its own <span class="code">birthday</span>
 constant that is assigned its own <span class="code">Birthday</span>
 object. Since we’re not going to change any of the <span class="code">birthday</span>
 constants—we’re just going to read their properties—we don’t want to make them variables.</p>
<p class="indent">Now that you have your cell and your birthday, it’s time to fill in the details. You need two labels for each cell to show the birthday person’s name and birthdate. You set the cell to the Subtitle style so that it has a Title label and a Subtitle label. Each cell will already contain these labels, so now you don’t have to create any labels yourself.</p>
<p class="indent">The labels exist as properties of <span class="code">UITableViewCell</span>
 and are called <span class="code">textLabel</span>
 and <span class="code">detailTextLabel</span>
 . The code at <span class="ent">➌</span>
 sets the text of the <span class="code">textLabel</span>
 to a string made up of the <span class="code">firstName</span>
 and <span class="code">lastName</span>
 of the <span class="code">birthday</span>
 with a space between them. At <span class="ent">➍</span>
 , you use the <span class="code">string(from:)</span>
 method of the <span class="code">dateFormatter</span>
 to display the birthdate in the <span class="code">detailTextLabel</span>
 .</p>
<p class="indent">When your cell is completely configured, <span class="code">tableView( _:cellForRowAt:)</span>
 returns the cell at <span class="ent">➎</span>
 so that it can be displayed at that <span class="code">indexPath</span>
 of the table view.</p>
<h3 class="h3" id="ch11lev1sec2">
<strong>PUTTING IT ALL TOGETHER</strong>
</h3>
<p class="noindent">Now you can add <span class="code">Birthday</span>
 instances to the app using the Add Birthday view controller, and you have a table view to list each <span class="code">Birthday</span>
 in the Birthdays table view controller. But when you try running the app and adding a <span class="code">Birthday</span>
 , it doesn’t appear. To make each <span class="code">Birthday</span>
 you add appear in the table view, you need to make the Add Birthday view controller communicate with the Birthdays table view controller. You do this by using <em>delegation</em>
 .</p>
<h4 class="h4" id="ch11lev2sec5">
<strong>DELEGATION</strong>
</h4>
<p class="noindent">Delegation can be used when one view controller needs to get information from another view controller. Say you have two view controllers: A and B. The first view controller, A, creates B and presents B on top of itself. A knows about B because it created and presented B, so A can pass information along to B. But B doesn’t know about A—it’s just popped into being and doesn’t know where it came from or how it got there. So how can B talk to A? Through delegation!</p>
<div class="image"><img src="Image00245.jpg" />
</div>
<p class="indent">Delegation is when someone gives a job or a task to someone else. A <em>delegate</em>
 is like a boss who tells a delegating employee what to do. When the delegating employee is done with their task, sometimes they’ll report information back to the delegate boss.</p>
<p class="indent"><span id="page_167"></span>
 Delegation in Swift is pretty similar, but instead of having a boss and employee, we have a delegate and a delegating object. Since class B is the one being told what to do by class A, it’s the delegating object. We give class B a special property called a delegate to tell it who its delegate is—that way, it knows who to communicate with. The delegate can be any class that has a set of methods that have been defined in a <em>protocol</em>
 . A protocol is like an agreement between the two classes that tells them what the delegate can ask the delegating object to do. It has a list of method and property names that the delegate can use with the delegating object.</p>
<p class="indent">Class A creates class B, makes itself the delegate of class B, and gives class B a job to do that’s in the protocol. Once class B is done with its job, it reports back to class A. Let’s see how this works in our app.</p>
<p class="indent">The Birthdays table view controller is view controller A, and the Add Birthday view controller is view controller B. We’ll create a protocol called <span class="code">AddBirthdayViewControllerDelegate</span>
 and a method for that protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 , which the Add Birthday view controller will use to report back.</p>
<p class="indent">Take a look at <a href="text00022.html#ch11fig6">Figure 11-6</a>
 . When the user taps the Add button <span class="ent">➊</span>
 , the Birthdays table view controller creates the Add Birthday view controller <span class="ent">➋</span>
 and sets itself as the Add Birthday view controller’s delegate.</p>
<div class="image"><img src="Image00246.jpg" />
</div>
<p class="figcap"><a id="ch11fig6"></a>
 <em>Figure 11-6: A new birthday is added and passed from the Add Birthday view controller to the Birthdays table view controller using delegation.</em>
</p>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<h4 class="h4" id="ch11lev2sec1">
<strong>CREATING THE BIRTHDAYS TABLE VIEW CONTROLLER</strong>
</h4>
<p class="noindent">
<span class="smallcaps">CONTROL</span>
 -click the <em>BirthdayTracker</em>
 folder in the Project navigator and choose <strong>New File…</strong>
 from the menu. In <a href="text00021.html#ch10">Chapter 10</a>
 , we created the Swift file <em>Birthday.swift</em>
 , which Xcode prepared for us with nearly nothing in it. To create a new file this time, we’ll tell Xcode we want to subclass an existing iOS class. Depending on the base class, Xcode will create a file containing some code that you’ll customize to your needs. To create the file, select <strong>iOS</strong>
 at the top of the window and then select the <strong>Cocoa Touch Class</strong>
 template, which will automatically format the new class file (see <a href="text00022.html#ch11fig1">Figure 11-1</a>
 ).</p>
<div class="image"><img src="Image00234.jpg" />
</div>
<p class="figcap"><a id="ch11fig1"></a>
 <em>Figure 11-1: To subclass an existing class, choose</em>
 <strong>
<em>iOS</em>
</strong>
 <em>and then</em>
 <strong>
<em>Cocoa Touch Class.</em>
</strong>
</p>
<p class="indent">When you choose this option, you’ll see a second dialog where you can name your new class and specify which class you’ll subclass. First, in the Subclass field (the second field in the dialog), type <span class="code">
<span class="codestrong">UITableViewController</span>
</span>
 . This will automatically fill in the class field with the subclass name. Once that happens, type <span class="code">
<span class="codestrong">Birthdays</span>
</span>
 in front of <span class="code">TableViewController</span>
 so that the whole class name is <span class="code">BirthdaysTableViewController</span>
 . This is a shortcut so you don’t <span id="page_157"></span>
 have to type as much. Make sure to choose <strong>Swift</strong>
 in the Language drop-down menu as well, and then click <strong>Next</strong>
 . Then select <strong>Create</strong>
 in the final dialog to create your new file.</p>
<p class="indent">In <em>BirthdaysTableViewController.swift</em>
 , Xcode has provided a template with several commented-out methods. You can clean up the code by getting rid of methods we won’t use. Delete just the comments in <span class="code">viewDidLoad()</span>
 , and then delete the entire <span class="code">didReceiveMemoryWarning()</span>
 method and the methods <span class="code">tableView(_:moveRowAt:to:)</span>
 and <span class="code">tableView(_:canMoveRowAt:)</span>
 , which have to do with moving rows in the table view. When you’re finished, the contents of <span class="code">BirthdaysTableViewController</span>
 should look like <a href="text00022.html#ch11fig2">Figure 11-2</a>
 . There are still several commented-out methods, but we’re keeping those to use later!</p>
<div class="image"><img src="Image00235.jpg" />
</div>
<p class="figcap"><a id="ch11fig2"></a>
 <em>Figure 11-2: The</em>
 <span class="code">
<span class="italic">BirthdaysTableViewController</span>
</span>
 <em>cleaned up!</em>
</p>
<p class="indent">Next, you need to make the Birthdays table view controller the <span class="code">BirthdaysTableViewController</span>
 class. To do this, go to <em>Main.storyboard</em>
 and select the <strong>Birthdays</strong>
 scene. Using the Identity Inspector in the right pane, change the class from <span class="code">UITableViewController</span>
 to <span class="code">BirthdaysTableViewController</span>
 , as shown in <a href="text00022.html#ch11fig3">Figure 11-3</a>
 .</p>
<div class="image"><span id="page_158"></span>
 <img src="Image00236.jpg" />
</div>
<p class="figcap"><a id="ch11fig3"></a>
 <em>Figure 11-3: Setting</em>
 <span class="code">
<span class="italic">BirthdaysTableViewController</span>
</span>
 <em>as the class of the Birthdays scene</em>
</p>
<p class="indent">Now that you have the Birthdays table view controller set up in the storyboard, the next step is to make cells in your table that will display each birthday.</p>
<h4 class="h4" id="ch11lev2sec2">
<strong>ADDING CELLS TO THE TABLE VIEW</strong>
</h4>
<p class="noindent">Each birthday will be displayed in a <span class="code">UITableViewCell</span>
 in the Birthdays table view controller. A table has boxes organized into rows and columns that contain information. These boxes are called <em>cells</em>
 . Similarly, a table view also has cells that are all instances of, or a subclass of, the <span class="code">UITableViewCell</span>
 class. We’ll put each birthday into its own cell in our table view.</p>
<p class="indent">We’ll start by creating those cells in the storyboard, and then we’ll fill them with our <span class="code">Birthday</span>
 objects later. In the left outline menu, click the triangle by Birthdays and then click the triangle by Table View to open those sections. Then select <strong>Table View Cell</strong>
 <span class="ent">➊</span>
 , as shown in <a href="text00022.html#ch11fig4">Figure 11-4</a>
 .</p>
<div class="image"><img src="Image00237.jpg" />
</div>
<div class="image"><img src="Image00238.jpg" />
</div>
<p class="figcap"><a id="ch11fig4"></a>
 <em>Figure 11-4: Creating a Subtitle style table view cell and setting its identifier</em>
</p>
<p class="indent"><span id="page_159"></span>
 Next, open the Attributes Inspector. Using the drop-down menu under <strong>Style</strong>
 , set the cell’s style to <strong>Subtitle</strong>
 <span class="ent">➋</span>
 so that the cell now has a Title label and a Subtitle label. You’ll display each person’s name in the Title and birthday in the Subtitle.</p>
<p class="indent">Finally, enter <span class="code">
<span class="codestrong">birthdayCellIdentifier</span>
</span>
 in the Identifier field <span class="ent">➌</span>
 . You’ll use this identifier later when you fill in the cell contents.</p>
<p class="indent">That’s it! You’ve finished your work in the storyboard.</p>
<p class="indent">You may be wondering why we have just one cell in our table view in the storyboard when we’ll have more than one birthday to show in the list. If you look at <a href="text00022.html#ch11fig4">Figure 11-4</a>
 again, you’ll notice that the cell is labeled <em>Prototype Cells</em>
 . This means that the cell you just customized is a <em>template</em>
 for all the cells you want to appear in your table view. The identifier you gave the cell is how your code will tell the table view to produce each cell for you to put birthdays in. You’ll see how this works soon.</p>
<div class="box1">
<p class="box-title">
<strong>WORKING WITH DATES</strong>
</p>
<p class="box-p">Swift has a special data type called <span class="code">Date</span>
 that is used for storing date values. A <span class="code">Date</span>
 object is actually a date and a time. Open your playground and enter the following:</p>
<div class="image"><img src="Image00239.jpg" />
</div>
<p class="box-pi">We’ve just assigned the current date and time the code was run to the variable <span class="code">today</span>
 . When you print <span class="code">today</span>
 , it’s in the format <span class="code">"2017-11-21 10:45:31 +0000\n"</span>
 . What if you wanted it to display as <span class="code">Tuesday, November 21, 2017</span>
 , instead? Or just <span class="code">11/21/17</span>
 ? To display a date in a particular way, you use a <em>date formatter</em>
 , which is a <span class="code">DateFormatter</span>
 object that you create and give a date format style. <span class="code">DateFormatter</span>
 is a helper object that is used to create a display string from any date, and a <em>date format style</em>
 is a property of <span class="code">DateFormatter</span>
 that tells the formatter what style to use. You can create your own date format styles manually, but there are also styles that are included in Swift and ready to use. Add the following to your playground:</p>
<div class="image"><img src="Image00240.jpg" />
</div>
<p class="box-pi">At <span class="ent">➊</span>
 you create a <span class="code">formatter</span>
 . Then at <span class="ent">➋</span>
 , you set the style of the <span class="code">formatter</span>
 to <span class="code">Style.full</span>
 , which will print the day of the week as well as the full month name, date, and year. Finally, you create a string from the date using the <span class="code">string(from:)</span>
 method of the <span class="code">DateFormatter</span>
 class <span class="ent">➌</span>
 . You can see that you now have turned the <span id="page_160"></span>
 date into the nicely formatted string <span class="code">"Tuesday, November 21, 2017"</span>
 . <a style=";color:black;" href="text00022.html#ch11tab1">Table 11-1</a>
 shows the different strings that are created from the five <span class="code">DateFormatter.Style</span>
 options available in Swift.</p>
<p class="tabcap"><a id="ch11tab1" style=";color:black;"></a>
 <strong>Table 11-1:</strong>
 Date Formatter Styles and Their Date Strings</p>
<table class="tabled">
<tbody>
<tr>
<td style="vertical-align: top;" class="border1">
<p class="noindent">
<span class="code">
<span class="codestrong">DateFormatter.Style</span>
</span>
</p>
</td>
<td style="vertical-align: top;" class="border1">
<p class="noindent">
<strong>Date string</strong>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">none</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">""</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">short</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"11/21/17"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">medium</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"Nov 21, 2017"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">long</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"November 21, 2017"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">full</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"Tuesday, November 21, 2017"</span>
</p>
</td>
</tr>
</tbody>
</table>
<p class="box-pi">You can also specify your own custom way of displaying a date using the <span class="code">dateFormat</span>
 property of the <span class="code">DateFormatter</span>
 . Perhaps you only want the month and day. Or maybe you want a four-digit year displayed in the <span class="code">short</span>
 style. Doing either is really easy, and you don’t even have to create a new <span class="code">DateFormatter</span>
 —you can just change the <span class="code">dateFormat</span>
 on <span class="code">formatter</span>
 and then ask it for a new string. Add the following code to your playground to display dates with a specific format:</p>
<div class="image"><img src="Image00241.jpg" />
</div>
<p class="box-pi">At <span class="ent">➊</span>
 , you specify that you only want the month and the date in an <span class="code">MM/dd</span>
 format—that is, a two-digit month followed by a two-digit date. If you want to display the month as three letters, then use <span class="code">MMM</span>
 . To display the full name of the month, use <span class="code">MMMM</span>
 . At <span class="ent">➋</span>
 , we change the date format to use a four-digit year. A two-digit year would be <span class="code">yy</span>
 . Here are a few other ways to use a <span class="code">dateFormat</span>
 to display a custom date string.</p>
<div class="image"><img src="Image00242.jpg" />
</div>
<p class="box-pi"><span id="page_161"></span>
 If you want to include separators, you add them to your <span class="code">dateFormat</span>
 string. For example, if you want periods as separators, then you can create a <span class="code">dateFormat</span>
 like <span class="code">"MM.dd.yy"</span>
 <span class="ent">➊</span>
 . To display an abbreviated day of the week, use <span class="code">EEE</span>
 <span class="ent">➋</span>
 . For the full day, use <span class="code">EEEE</span>
 <span class="ent">➌</span>
 . These are only a few examples. By using combinations of <span class="code">M</span>
 , <span class="code">d</span>
 , <span class="code">y</span>
 , and <span class="code">E</span>
 , you have an endless number of ways to display a date!</p>
</div>
<h4 class="h4" id="ch11lev2sec3">
<strong>SETTING UP THE BIRTHDAYS TABLE VIEW CONTROLLER</strong>
</h4>
<p class="noindent">The Birthdays table view controller will display a list of all the birthdays stored in the app. Do you remember what you use to store a list of items? That’s right—an array! You’ll create an array in the <span class="code">BirthdaysTableViewController</span>
 to store all the birthdays. To do this, give the <span class="code">BirthdaysTableViewController</span>
 a <span class="code">birthdays</span>
 property that is an array of <span class="code">Birthday</span>
 objects. At the top of the class, right above the <span class="code">viewDidLoad()</span>
 method, insert this line to add a variable array property called <span class="code">birthdays</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController {</span>
<br />
<br />
    <span class="pink">var</span>
 birthdays = [<span class="green1">Birthday</span>
 ]()<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent">This line creates an empty array of <span class="code">Birthday</span>
 instances. It needs to be a variable and not a constant because you’ll want to add a saved <span class="code">Birthday</span>
 to this array every time the user adds a <span class="code">Birthday</span>
 with the Add Birthday view controller. You’ll see how to do that in “<a href="text00022.html#ch11lev3sec2">Making the Birthdays Table View Controller Conform to Protocol</a>
 ” on <a href="text00022.html#page_168">page 168</a>
 .</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>Remember that the final versions of the project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>.</em>
</p>
</div>
<p class="indent">The <span class="code">BirthdaysTableViewController</span>
 will also need a <span class="code">dateFormatter</span>
 property to display the birthdate as a nicely formatted string. Add a <span class="code">dateFormatter</span>
 right underneath the <span class="code">birthdays</span>
 array:</p>
<div class="box">
<pre>    <span class="ash">var birthdays = [Birthday]()</span>
<br />
<br />
    <span class="pink">let</span>
 dateFormatter = <span class="violet">DateFormatter</span>
 ()<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent">Note that the <span class="code">dateFormatter</span>
 is a constant that is created with <span class="code">let</span>
 . Even though you’ll change the <span class="code">dateFormatter</span>
 ’s properties, like the <span class="code">dateStyle</span>
 and <span class="code">timeStyle</span>
 , you’ll never change the <span class="code">dateFormatter</span>
 itself.</p>
<p class="indent"><span id="page_162"></span>
 You’ll also need to set up the <span class="code">dateFormatter</span>
 so that it will display the birthdates as fully formatted strings like <span class="code">"Tuesday, December 17, 2008"</span>
 . As you saw in <a href="text00021.html#ch10">Chapter 10</a>
 , a good place to do this is the <span class="code">viewDidLoad()</span>
 method, which is called when the Birthdays table view controller is loading its view. This is the perfect place to do any setup that is needed for this class.</p>
<div class="box">
<pre>
<span class="ash">override func viewDidLoad() {</span>
<br />
    <span class="ash">super.viewDidLoad()</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">dateFormatter</span>
 .<span class="violet">dateStyle</span>
 = .<span class="blue">full</span>
<br />
  <span class="ent">➋</span>
 <span class="green1">dateFormatter</span>
 .<span class="violet">timeStyle</span>
 = .<span class="blue">none</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , you set the <span class="code">dateStyle</span>
 of the <span class="code">dateFormatter</span>
 so that it will display a formatted date string for each <span class="code">Birthday</span>
 . Did you notice how we just wrote <span class="code">.full</span>
 instead of <span class="code">DateFormatter.Style.full</span>
 ? Swift knows what type to expect for the <span class="code">dateStyle</span>
 of a <span class="code">DateFormatter</span>
 , so it lets us take this little shortcut. At <span class="ent">➋</span>
 , you set the <span class="code">timeStyle</span>
 of the <span class="code">dateFormatter</span>
 to <span class="code">.none</span>
 so that the time won’t be shown.</p>
<h4 class="h4" id="ch11lev2sec4">
<strong>DISPLAYING BIRTHDAYS IN A TABLE VIEW</strong>
</h4>
<p class="noindent">The <span class="code">BirthdaysTableViewController</span>
 class has a table view that is used to display a list of items in a single column. The table view has one or more sections containing rows, and each row contains a cell. A section in a table view is a grouping of rows that can be displayed with or without a header. An example of an app that shows a table view with several sections is the Settings app, as shown in <a href="text00022.html#ch11fig5">Figure 11-5</a>
 . It displays a list of rows that have been broken up into different sections.</p>
<p class="indent">Each section and row of a table view is identified with an index number. These numbers start at 0 and then increase by 1 as you go down the table view. For example, the Privacy line in the Settings app is found at section 0, row 1. The News setting is at section 1, row 3.</p>
<p class="indent">In the middle of the <span class="code">BirthdaysTableViewController</span>
 class, there is a section called <em>Table view data source</em>
 with three methods. The table view controller uses these methods to determine what’s going to be displayed inside its table view.</p>
<p class="hang">
<span class="code">
<span class="codestrong">numberOfSections(in:)</span>
</span>
 Tells the table view how many sections it should have</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:numberOfRowsInSection:)</span>
</span>
 Tells the table view how many rows will be displayed in each section</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:cellForRowAt:)</span>
</span>
 Sets up each cell that’s going to be displayed in each row of the table view</p>
<div class="image"><span id="page_163"></span>
 <img src="Image00243.jpg" />
</div>
<p class="figcap"><a id="ch11fig5"></a>
 <em>Figure 11-5: The Settings app uses sections to group rows of different device settings.</em>
</p>
<p class="indent">The table view data source methods are called by the table view controller every time the table view is reloaded. Xcode automatically gives you these method templates when you make a subclass of a <span class="code">UITableViewController</span>
 . You need to implement all three methods for the app to work, even though you’ll never call them directly in your code. The <span class="code">UITableViewController</span>
 class implements the <span class="code">UITableViewDataSource</span>
 protocol, which comes with these data source methods, to determine what will be displayed inside the table view. We’ll discuss protocols in “<a href="text00022.html#ch11lev2sec5">Delegation</a>
 ” on page 166. For now, you just need to know that a <span class="code">UITableViewController</span>
 uses these methods to display its content, and it automatically calls these methods so you don’t need to call them.</p>
<p class="indent">Let’s start with the method <span class="code">numberOfSections(in:)</span>
 . The Birthdays table view controller is a list that just displays <span class="code">Birthday</span>
 instances, so it doesn’t need multiple sections. To set the number of sections in the table view, we just need to return <span class="code">1</span>
 .</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func numberOfSections(in tableView: UITableView) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 <span class="blue1">1</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent"><span id="page_164"></span>
 This method takes a <span class="code">UITableView</span>
 called <span class="code">tableView</span>
 as a parameter, which is the table view that uses this class as its data source. We don’t need to worry about making this connection because the <span class="code">UITableViewController</span>
 comes with a built-in table view that is automatically hooked up to these methods. Each birthday will be displayed in its own row. So in <span class="code">tableView(_:numberOfRowsInSection:)</span>
 , in order to have the right number of rows for all of your birthdays, you need to return the number of <span class="code">Birthday</span>
 instances that you have in your <span class="code">birthdays</span>
 array. Do you remember the <span class="code">count</span>
 property of an array? It’s an integer that tells you how many items are in that array, and it’s perfect for this situation! Change this method to the following:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, <img class="inline" src="Image00184.jpg" />
<br />
    numberOfRowsInSection section: Int) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 birthdays.<span class="violet">count</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">In addition to the <span class="code">tableView</span>
 parameter, <span class="code">tableView(_:numberOfRowsInSection:)</span>
 also takes an <span class="code">Int</span>
 called <span class="code">section</span>
 . When the table view is loading itself, this method is called for each section in the table view. In our case, we have only one section, so we don’t need to bother checking which <span class="code">section</span>
 of the table view is being displayed here. We know it’s section 0, and we want it to have as many rows as there are birthdays, so we write <span class="code">return birthdays.count</span>
 .</p>
<p class="indent">Finally, you need to implement <span class="code">tableView(_:cellForRowAt:)</span>
 so that the table view will know what to put inside each cell. Since this method is commented out, you need to uncomment it by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it. (Be careful not to accidentally uncomment the other methods after it!) After you’ve done that, change it to the following code:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, cellForRowAt <img class="inline" src="Image00184.jpg" />
<br />
    indexPath: IndexPath) -&gt; UITableViewCell {</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="pink">let</span>
 cell = tableView.<span class="blue">dequeueReusableCell</span>
 (withIdentifier: <img class="inline" src="Image00093.jpg" />
<br />
        <span class="red">"birthdayCellIdentifier"</span>
 , for: indexPath)<br />
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 birthday = <span class="green1">birthdays</span>
 [indexPath.<span class="violet">row</span>
 ]<br />
<br />
  <span class="ent">➌</span>
 cell.<span class="violet">textLabel</span>
 ?.<span class="violet">text</span>
 = birthday.<span class="green1">firstName</span>
 <span class="blue">+</span>
 <span class="red">" "</span>
 <span class="blue">+</span>
 <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">lastName</span>
<br />
<br />
  <span class="ent">➍</span>
 cell.<span class="violet">detailTextLabel</span>
 ?.<span class="violet">text</span>
 = <span class="green1">dateFormatter</span>
 .<span class="blue">string</span>
 (from: <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">birthdate</span>
 )<br />
<br />
  <span class="ent">➎</span>
 <span class="pink">return</span>
 cell<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">You don’t call the method <span class="code">tableView(_:cellForRowAt:)</span>
 . It’s called when the table view is loaded onto the screen. It’s called for each cell on the screen and takes two parameters, <span class="code">tableView</span>
 and <span class="code">indexPath</span>
 . You already know <span id="page_165"></span>
 what the <span class="code">tableView</span>
 parameter is for. An <span class="code">IndexPath</span>
 is a Swift struct that’s used to represent a row’s position in a table view. An <span class="code">IndexPath</span>
 instance has a <span class="code">section</span>
 property and a <span class="code">row</span>
 property. Since this method will be called many times (once for every row in the table), we need the <span class="code">indexPath</span>
 to know which section and row we’re currently configuring. The <span class="code">indexPath.section</span>
 property gives the section number, and the <span class="code">indexPath.row</span>
 gives the row of the table view cell. The five lines of code inside <span class="code">tableView(_:cellForRowAt:)</span>
 will do the following:</p>
<div class="image"><img src="Image00244.jpg" />
</div>
<p class="bull">• Create a <span class="code">UITableViewCell</span>
</p>
<p class="bull">• Figure out which <span class="code">Birthday</span>
 in the <span class="code">birthdays</span>
 array will be displayed inside the cell</p>
<p class="bull">• Make two labels to display the birthday person’s name and birthdate in the cell</p>
<p class="bull">• Return the cell ready for display in the table view</p>
<p class="indentt">Let’s go through this code line by line.</p>
<p class="indent">First, create the <span class="code">UITableViewCell</span>
 . The code at <span class="ent">➊</span>
 does this using the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 . Before you can start using this method on a cell, though, you need to tell the method which cell you want to use from the storyboard. Earlier, when you were in the storyboard, you gave your cell the identifier <span class="code">birthdayCellIdentifier</span>
 (see <a href="text00022.html#ch11fig4">Figure 11-4</a>
 ). This identifier links your code to the cell and tells your method that it’s using the right cell. The string for when you call this method needs to be exactly the same as the string you set in the storyboard, or you’ll get an error and the app will crash when you run it.</p>
<p class="indent">In the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 , did you notice the words <em>Reusable Cell</em>
 ? The cells inside a table view are created once and then can be reused over and over. This helps everything run faster and smoother because creating the cell is what takes the most time. If you had 200 birthdays in your app, but only 10 would fit on your screen at one time, then you need only 10 cells to show your birthdays. When you scroll down to reveal more birthdays, the cells that scroll off the top of the screen are reused. They are filled with new information and show up again at the bottom of the screen. The <span class="code">UITableView</span>
 automatically does this work. When the table view is loaded, <span class="code">tableView(_:cellForRowAt:)</span>
 is called for every visible row. When the user scrolls to look at more cells, it’s called again for each row just as it is about to appear on the screen.</p>
<p class="indent">Next, we need to find out which <span class="code">Birthday</span>
 should be displayed inside the cell. We want to display one birthday from the <span class="code">birthdays</span>
 array in each row. The first birthday, which is at <span class="code">birthdays[0]</span>
 , should be displayed in row 0. The second birthday, at <span class="code">birthdays[1]</span>
 , should be displayed in row 1, and so on, which means the <span class="code">indexPath</span>
 ’s <span class="code">row</span>
 is the same as the position in the <span class="code">birthdays</span>
 array that we want to access. The code at <span class="ent">➋</span>
 accesses the <span id="page_166"></span>
 correct <span class="code">Birthday</span>
 object from the <span class="code">birthdays</span>
 array by using <span class="code">indexPath.row</span>
 . Once we have the right <span class="code">Birthday</span>
 object, we assign it to a constant named <span class="code">birthday</span>
 so we can set up the labels in this cell.</p>
<p class="indent">Notice that we’re using <span class="code">let</span>
 to assign the <span class="code">birthday</span>
 to a constant instead of a variable. We can use <span class="code">let</span>
 because each time <span class="code">tableView(_:cellForRowAt:)</span>
 is called, a new <span class="code">birthday</span>
 constant is created. Each cell gets its own <span class="code">birthday</span>
 constant that is assigned its own <span class="code">Birthday</span>
 object. Since we’re not going to change any of the <span class="code">birthday</span>
 constants—we’re just going to read their properties—we don’t want to make them variables.</p>
<p class="indent">Now that you have your cell and your birthday, it’s time to fill in the details. You need two labels for each cell to show the birthday person’s name and birthdate. You set the cell to the Subtitle style so that it has a Title label and a Subtitle label. Each cell will already contain these labels, so now you don’t have to create any labels yourself.</p>
<p class="indent">The labels exist as properties of <span class="code">UITableViewCell</span>
 and are called <span class="code">textLabel</span>
 and <span class="code">detailTextLabel</span>
 . The code at <span class="ent">➌</span>
 sets the text of the <span class="code">textLabel</span>
 to a string made up of the <span class="code">firstName</span>
 and <span class="code">lastName</span>
 of the <span class="code">birthday</span>
 with a space between them. At <span class="ent">➍</span>
 , you use the <span class="code">string(from:)</span>
 method of the <span class="code">dateFormatter</span>
 to display the birthdate in the <span class="code">detailTextLabel</span>
 .</p>
<p class="indent">When your cell is completely configured, <span class="code">tableView( _:cellForRowAt:)</span>
 returns the cell at <span class="ent">➎</span>
 so that it can be displayed at that <span class="code">indexPath</span>
 of the table view.</p>
<h3 class="h3" id="ch11lev1sec2">
<strong>PUTTING IT ALL TOGETHER</strong>
</h3>
<p class="noindent">Now you can add <span class="code">Birthday</span>
 instances to the app using the Add Birthday view controller, and you have a table view to list each <span class="code">Birthday</span>
 in the Birthdays table view controller. But when you try running the app and adding a <span class="code">Birthday</span>
 , it doesn’t appear. To make each <span class="code">Birthday</span>
 you add appear in the table view, you need to make the Add Birthday view controller communicate with the Birthdays table view controller. You do this by using <em>delegation</em>
 .</p>
<h4 class="h4" id="ch11lev2sec5">
<strong>DELEGATION</strong>
</h4>
<p class="noindent">Delegation can be used when one view controller needs to get information from another view controller. Say you have two view controllers: A and B. The first view controller, A, creates B and presents B on top of itself. A knows about B because it created and presented B, so A can pass information along to B. But B doesn’t know about A—it’s just popped into being and doesn’t know where it came from or how it got there. So how can B talk to A? Through delegation!</p>
<div class="image"><img src="Image00245.jpg" />
</div>
<p class="indent">Delegation is when someone gives a job or a task to someone else. A <em>delegate</em>
 is like a boss who tells a delegating employee what to do. When the delegating employee is done with their task, sometimes they’ll report information back to the delegate boss.</p>
<p class="indent"><span id="page_167"></span>
 Delegation in Swift is pretty similar, but instead of having a boss and employee, we have a delegate and a delegating object. Since class B is the one being told what to do by class A, it’s the delegating object. We give class B a special property called a delegate to tell it who its delegate is—that way, it knows who to communicate with. The delegate can be any class that has a set of methods that have been defined in a <em>protocol</em>
 . A protocol is like an agreement between the two classes that tells them what the delegate can ask the delegating object to do. It has a list of method and property names that the delegate can use with the delegating object.</p>
<p class="indent">Class A creates class B, makes itself the delegate of class B, and gives class B a job to do that’s in the protocol. Once class B is done with its job, it reports back to class A. Let’s see how this works in our app.</p>
<p class="indent">The Birthdays table view controller is view controller A, and the Add Birthday view controller is view controller B. We’ll create a protocol called <span class="code">AddBirthdayViewControllerDelegate</span>
 and a method for that protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 , which the Add Birthday view controller will use to report back.</p>
<p class="indent">Take a look at <a href="text00022.html#ch11fig6">Figure 11-6</a>
 . When the user taps the Add button <span class="ent">➊</span>
 , the Birthdays table view controller creates the Add Birthday view controller <span class="ent">➋</span>
 and sets itself as the Add Birthday view controller’s delegate.</p>
<div class="image"><img src="Image00246.jpg" />
</div>
<p class="figcap"><a id="ch11fig6"></a>
 <em>Figure 11-6: A new birthday is added and passed from the Add Birthday view controller to the Birthdays table view controller using delegation.</em>
</p>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="noindent">
<span class="smallcaps">CONTROL</span>
 -click the <em>BirthdayTracker</em>
 folder in the Project navigator and choose <strong>New File…</strong>
 from the menu. In <a href="text00021.html#ch10">Chapter 10</a>
 , we created the Swift file <em>Birthday.swift</em>
 , which Xcode prepared for us with nearly nothing in it. To create a new file this time, we’ll tell Xcode we want to subclass an existing iOS class. Depending on the base class, Xcode will create a file containing some code that you’ll customize to your needs. To create the file, select <strong>iOS</strong>
 at the top of the window and then select the <strong>Cocoa Touch Class</strong>
 template, which will automatically format the new class file (see <a href="text00022.html#ch11fig1">Figure 11-1</a>
 ).</p>
<div class="image"><img src="Image00234.jpg" />
</div>
<p class="figcap"><a id="ch11fig1"></a>
 <em>Figure 11-1: To subclass an existing class, choose</em>
 <strong>
<em>iOS</em>
</strong>
 <em>and then</em>
 <strong>
<em>Cocoa Touch Class.</em>
</strong>
</p>
<p class="indent">When you choose this option, you’ll see a second dialog where you can name your new class and specify which class you’ll subclass. First, in the Subclass field (the second field in the dialog), type <span class="code">
<span class="codestrong">UITableViewController</span>
</span>
 . This will automatically fill in the class field with the subclass name. Once that happens, type <span class="code">
<span class="codestrong">Birthdays</span>
</span>
 in front of <span class="code">TableViewController</span>
 so that the whole class name is <span class="code">BirthdaysTableViewController</span>
 . This is a shortcut so you don’t <span id="page_157"></span>
 have to type as much. Make sure to choose <strong>Swift</strong>
 in the Language drop-down menu as well, and then click <strong>Next</strong>
 . Then select <strong>Create</strong>
 in the final dialog to create your new file.</p>
<p class="indent">In <em>BirthdaysTableViewController.swift</em>
 , Xcode has provided a template with several commented-out methods. You can clean up the code by getting rid of methods we won’t use. Delete just the comments in <span class="code">viewDidLoad()</span>
 , and then delete the entire <span class="code">didReceiveMemoryWarning()</span>
 method and the methods <span class="code">tableView(_:moveRowAt:to:)</span>
 and <span class="code">tableView(_:canMoveRowAt:)</span>
 , which have to do with moving rows in the table view. When you’re finished, the contents of <span class="code">BirthdaysTableViewController</span>
 should look like <a href="text00022.html#ch11fig2">Figure 11-2</a>
 . There are still several commented-out methods, but we’re keeping those to use later!</p>
<div class="image"><img src="Image00235.jpg" />
</div>
<p class="figcap"><a id="ch11fig2"></a>
 <em>Figure 11-2: The</em>
 <span class="code">
<span class="italic">BirthdaysTableViewController</span>
</span>
 <em>cleaned up!</em>
</p>
<p class="indent">Next, you need to make the Birthdays table view controller the <span class="code">BirthdaysTableViewController</span>
 class. To do this, go to <em>Main.storyboard</em>
 and select the <strong>Birthdays</strong>
 scene. Using the Identity Inspector in the right pane, change the class from <span class="code">UITableViewController</span>
 to <span class="code">BirthdaysTableViewController</span>
 , as shown in <a href="text00022.html#ch11fig3">Figure 11-3</a>
 .</p>
<div class="image"><span id="page_158"></span>
 <img src="Image00236.jpg" />
</div>
<p class="figcap"><a id="ch11fig3"></a>
 <em>Figure 11-3: Setting</em>
 <span class="code">
<span class="italic">BirthdaysTableViewController</span>
</span>
 <em>as the class of the Birthdays scene</em>
</p>
<p class="indent">Now that you have the Birthdays table view controller set up in the storyboard, the next step is to make cells in your table that will display each birthday.</p>
<h4 class="h4" id="ch11lev2sec2">
<strong>ADDING CELLS TO THE TABLE VIEW</strong>
</h4>
<p class="noindent">Each birthday will be displayed in a <span class="code">UITableViewCell</span>
 in the Birthdays table view controller. A table has boxes organized into rows and columns that contain information. These boxes are called <em>cells</em>
 . Similarly, a table view also has cells that are all instances of, or a subclass of, the <span class="code">UITableViewCell</span>
 class. We’ll put each birthday into its own cell in our table view.</p>
<p class="indent">We’ll start by creating those cells in the storyboard, and then we’ll fill them with our <span class="code">Birthday</span>
 objects later. In the left outline menu, click the triangle by Birthdays and then click the triangle by Table View to open those sections. Then select <strong>Table View Cell</strong>
 <span class="ent">➊</span>
 , as shown in <a href="text00022.html#ch11fig4">Figure 11-4</a>
 .</p>
<div class="image"><img src="Image00237.jpg" />
</div>
<div class="image"><img src="Image00238.jpg" />
</div>
<p class="figcap"><a id="ch11fig4"></a>
 <em>Figure 11-4: Creating a Subtitle style table view cell and setting its identifier</em>
</p>
<p class="indent"><span id="page_159"></span>
 Next, open the Attributes Inspector. Using the drop-down menu under <strong>Style</strong>
 , set the cell’s style to <strong>Subtitle</strong>
 <span class="ent">➋</span>
 so that the cell now has a Title label and a Subtitle label. You’ll display each person’s name in the Title and birthday in the Subtitle.</p>
<p class="indent">Finally, enter <span class="code">
<span class="codestrong">birthdayCellIdentifier</span>
</span>
 in the Identifier field <span class="ent">➌</span>
 . You’ll use this identifier later when you fill in the cell contents.</p>
<p class="indent">That’s it! You’ve finished your work in the storyboard.</p>
<p class="indent">You may be wondering why we have just one cell in our table view in the storyboard when we’ll have more than one birthday to show in the list. If you look at <a href="text00022.html#ch11fig4">Figure 11-4</a>
 again, you’ll notice that the cell is labeled <em>Prototype Cells</em>
 . This means that the cell you just customized is a <em>template</em>
 for all the cells you want to appear in your table view. The identifier you gave the cell is how your code will tell the table view to produce each cell for you to put birthdays in. You’ll see how this works soon.</p>
<div class="box1">
<p class="box-title">
<strong>WORKING WITH DATES</strong>
</p>
<p class="box-p">Swift has a special data type called <span class="code">Date</span>
 that is used for storing date values. A <span class="code">Date</span>
 object is actually a date and a time. Open your playground and enter the following:</p>
<div class="image"><img src="Image00239.jpg" />
</div>
<p class="box-pi">We’ve just assigned the current date and time the code was run to the variable <span class="code">today</span>
 . When you print <span class="code">today</span>
 , it’s in the format <span class="code">"2017-11-21 10:45:31 +0000\n"</span>
 . What if you wanted it to display as <span class="code">Tuesday, November 21, 2017</span>
 , instead? Or just <span class="code">11/21/17</span>
 ? To display a date in a particular way, you use a <em>date formatter</em>
 , which is a <span class="code">DateFormatter</span>
 object that you create and give a date format style. <span class="code">DateFormatter</span>
 is a helper object that is used to create a display string from any date, and a <em>date format style</em>
 is a property of <span class="code">DateFormatter</span>
 that tells the formatter what style to use. You can create your own date format styles manually, but there are also styles that are included in Swift and ready to use. Add the following to your playground:</p>
<div class="image"><img src="Image00240.jpg" />
</div>
<p class="box-pi">At <span class="ent">➊</span>
 you create a <span class="code">formatter</span>
 . Then at <span class="ent">➋</span>
 , you set the style of the <span class="code">formatter</span>
 to <span class="code">Style.full</span>
 , which will print the day of the week as well as the full month name, date, and year. Finally, you create a string from the date using the <span class="code">string(from:)</span>
 method of the <span class="code">DateFormatter</span>
 class <span class="ent">➌</span>
 . You can see that you now have turned the <span id="page_160"></span>
 date into the nicely formatted string <span class="code">"Tuesday, November 21, 2017"</span>
 . <a style=";color:black;" href="text00022.html#ch11tab1">Table 11-1</a>
 shows the different strings that are created from the five <span class="code">DateFormatter.Style</span>
 options available in Swift.</p>
<p class="tabcap"><a id="ch11tab1" style=";color:black;"></a>
 <strong>Table 11-1:</strong>
 Date Formatter Styles and Their Date Strings</p>
<table class="tabled">
<tbody>
<tr>
<td style="vertical-align: top;" class="border1">
<p class="noindent">
<span class="code">
<span class="codestrong">DateFormatter.Style</span>
</span>
</p>
</td>
<td style="vertical-align: top;" class="border1">
<p class="noindent">
<strong>Date string</strong>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">none</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">""</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">short</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"11/21/17"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">medium</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"Nov 21, 2017"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">long</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"November 21, 2017"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">full</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"Tuesday, November 21, 2017"</span>
</p>
</td>
</tr>
</tbody>
</table>
<p class="box-pi">You can also specify your own custom way of displaying a date using the <span class="code">dateFormat</span>
 property of the <span class="code">DateFormatter</span>
 . Perhaps you only want the month and day. Or maybe you want a four-digit year displayed in the <span class="code">short</span>
 style. Doing either is really easy, and you don’t even have to create a new <span class="code">DateFormatter</span>
 —you can just change the <span class="code">dateFormat</span>
 on <span class="code">formatter</span>
 and then ask it for a new string. Add the following code to your playground to display dates with a specific format:</p>
<div class="image"><img src="Image00241.jpg" />
</div>
<p class="box-pi">At <span class="ent">➊</span>
 , you specify that you only want the month and the date in an <span class="code">MM/dd</span>
 format—that is, a two-digit month followed by a two-digit date. If you want to display the month as three letters, then use <span class="code">MMM</span>
 . To display the full name of the month, use <span class="code">MMMM</span>
 . At <span class="ent">➋</span>
 , we change the date format to use a four-digit year. A two-digit year would be <span class="code">yy</span>
 . Here are a few other ways to use a <span class="code">dateFormat</span>
 to display a custom date string.</p>
<div class="image"><img src="Image00242.jpg" />
</div>
<p class="box-pi"><span id="page_161"></span>
 If you want to include separators, you add them to your <span class="code">dateFormat</span>
 string. For example, if you want periods as separators, then you can create a <span class="code">dateFormat</span>
 like <span class="code">"MM.dd.yy"</span>
 <span class="ent">➊</span>
 . To display an abbreviated day of the week, use <span class="code">EEE</span>
 <span class="ent">➋</span>
 . For the full day, use <span class="code">EEEE</span>
 <span class="ent">➌</span>
 . These are only a few examples. By using combinations of <span class="code">M</span>
 , <span class="code">d</span>
 , <span class="code">y</span>
 , and <span class="code">E</span>
 , you have an endless number of ways to display a date!</p>
</div>
<h4 class="h4" id="ch11lev2sec3">
<strong>SETTING UP THE BIRTHDAYS TABLE VIEW CONTROLLER</strong>
</h4>
<p class="noindent">The Birthdays table view controller will display a list of all the birthdays stored in the app. Do you remember what you use to store a list of items? That’s right—an array! You’ll create an array in the <span class="code">BirthdaysTableViewController</span>
 to store all the birthdays. To do this, give the <span class="code">BirthdaysTableViewController</span>
 a <span class="code">birthdays</span>
 property that is an array of <span class="code">Birthday</span>
 objects. At the top of the class, right above the <span class="code">viewDidLoad()</span>
 method, insert this line to add a variable array property called <span class="code">birthdays</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController {</span>
<br />
<br />
    <span class="pink">var</span>
 birthdays = [<span class="green1">Birthday</span>
 ]()<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent">This line creates an empty array of <span class="code">Birthday</span>
 instances. It needs to be a variable and not a constant because you’ll want to add a saved <span class="code">Birthday</span>
 to this array every time the user adds a <span class="code">Birthday</span>
 with the Add Birthday view controller. You’ll see how to do that in “<a href="text00022.html#ch11lev3sec2">Making the Birthdays Table View Controller Conform to Protocol</a>
 ” on <a href="text00022.html#page_168">page 168</a>
 .</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>Remember that the final versions of the project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>.</em>
</p>
</div>
<p class="indent">The <span class="code">BirthdaysTableViewController</span>
 will also need a <span class="code">dateFormatter</span>
 property to display the birthdate as a nicely formatted string. Add a <span class="code">dateFormatter</span>
 right underneath the <span class="code">birthdays</span>
 array:</p>
<div class="box">
<pre>    <span class="ash">var birthdays = [Birthday]()</span>
<br />
<br />
    <span class="pink">let</span>
 dateFormatter = <span class="violet">DateFormatter</span>
 ()<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent">Note that the <span class="code">dateFormatter</span>
 is a constant that is created with <span class="code">let</span>
 . Even though you’ll change the <span class="code">dateFormatter</span>
 ’s properties, like the <span class="code">dateStyle</span>
 and <span class="code">timeStyle</span>
 , you’ll never change the <span class="code">dateFormatter</span>
 itself.</p>
<p class="indent"><span id="page_162"></span>
 You’ll also need to set up the <span class="code">dateFormatter</span>
 so that it will display the birthdates as fully formatted strings like <span class="code">"Tuesday, December 17, 2008"</span>
 . As you saw in <a href="text00021.html#ch10">Chapter 10</a>
 , a good place to do this is the <span class="code">viewDidLoad()</span>
 method, which is called when the Birthdays table view controller is loading its view. This is the perfect place to do any setup that is needed for this class.</p>
<div class="box">
<pre>
<span class="ash">override func viewDidLoad() {</span>
<br />
    <span class="ash">super.viewDidLoad()</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">dateFormatter</span>
 .<span class="violet">dateStyle</span>
 = .<span class="blue">full</span>
<br />
  <span class="ent">➋</span>
 <span class="green1">dateFormatter</span>
 .<span class="violet">timeStyle</span>
 = .<span class="blue">none</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , you set the <span class="code">dateStyle</span>
 of the <span class="code">dateFormatter</span>
 so that it will display a formatted date string for each <span class="code">Birthday</span>
 . Did you notice how we just wrote <span class="code">.full</span>
 instead of <span class="code">DateFormatter.Style.full</span>
 ? Swift knows what type to expect for the <span class="code">dateStyle</span>
 of a <span class="code">DateFormatter</span>
 , so it lets us take this little shortcut. At <span class="ent">➋</span>
 , you set the <span class="code">timeStyle</span>
 of the <span class="code">dateFormatter</span>
 to <span class="code">.none</span>
 so that the time won’t be shown.</p>
<h4 class="h4" id="ch11lev2sec4">
<strong>DISPLAYING BIRTHDAYS IN A TABLE VIEW</strong>
</h4>
<p class="noindent">The <span class="code">BirthdaysTableViewController</span>
 class has a table view that is used to display a list of items in a single column. The table view has one or more sections containing rows, and each row contains a cell. A section in a table view is a grouping of rows that can be displayed with or without a header. An example of an app that shows a table view with several sections is the Settings app, as shown in <a href="text00022.html#ch11fig5">Figure 11-5</a>
 . It displays a list of rows that have been broken up into different sections.</p>
<p class="indent">Each section and row of a table view is identified with an index number. These numbers start at 0 and then increase by 1 as you go down the table view. For example, the Privacy line in the Settings app is found at section 0, row 1. The News setting is at section 1, row 3.</p>
<p class="indent">In the middle of the <span class="code">BirthdaysTableViewController</span>
 class, there is a section called <em>Table view data source</em>
 with three methods. The table view controller uses these methods to determine what’s going to be displayed inside its table view.</p>
<p class="hang">
<span class="code">
<span class="codestrong">numberOfSections(in:)</span>
</span>
 Tells the table view how many sections it should have</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:numberOfRowsInSection:)</span>
</span>
 Tells the table view how many rows will be displayed in each section</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:cellForRowAt:)</span>
</span>
 Sets up each cell that’s going to be displayed in each row of the table view</p>
<div class="image"><span id="page_163"></span>
 <img src="Image00243.jpg" />
</div>
<p class="figcap"><a id="ch11fig5"></a>
 <em>Figure 11-5: The Settings app uses sections to group rows of different device settings.</em>
</p>
<p class="indent">The table view data source methods are called by the table view controller every time the table view is reloaded. Xcode automatically gives you these method templates when you make a subclass of a <span class="code">UITableViewController</span>
 . You need to implement all three methods for the app to work, even though you’ll never call them directly in your code. The <span class="code">UITableViewController</span>
 class implements the <span class="code">UITableViewDataSource</span>
 protocol, which comes with these data source methods, to determine what will be displayed inside the table view. We’ll discuss protocols in “<a href="text00022.html#ch11lev2sec5">Delegation</a>
 ” on page 166. For now, you just need to know that a <span class="code">UITableViewController</span>
 uses these methods to display its content, and it automatically calls these methods so you don’t need to call them.</p>
<p class="indent">Let’s start with the method <span class="code">numberOfSections(in:)</span>
 . The Birthdays table view controller is a list that just displays <span class="code">Birthday</span>
 instances, so it doesn’t need multiple sections. To set the number of sections in the table view, we just need to return <span class="code">1</span>
 .</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func numberOfSections(in tableView: UITableView) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 <span class="blue1">1</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent"><span id="page_164"></span>
 This method takes a <span class="code">UITableView</span>
 called <span class="code">tableView</span>
 as a parameter, which is the table view that uses this class as its data source. We don’t need to worry about making this connection because the <span class="code">UITableViewController</span>
 comes with a built-in table view that is automatically hooked up to these methods. Each birthday will be displayed in its own row. So in <span class="code">tableView(_:numberOfRowsInSection:)</span>
 , in order to have the right number of rows for all of your birthdays, you need to return the number of <span class="code">Birthday</span>
 instances that you have in your <span class="code">birthdays</span>
 array. Do you remember the <span class="code">count</span>
 property of an array? It’s an integer that tells you how many items are in that array, and it’s perfect for this situation! Change this method to the following:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, <img class="inline" src="Image00184.jpg" />
<br />
    numberOfRowsInSection section: Int) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 birthdays.<span class="violet">count</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">In addition to the <span class="code">tableView</span>
 parameter, <span class="code">tableView(_:numberOfRowsInSection:)</span>
 also takes an <span class="code">Int</span>
 called <span class="code">section</span>
 . When the table view is loading itself, this method is called for each section in the table view. In our case, we have only one section, so we don’t need to bother checking which <span class="code">section</span>
 of the table view is being displayed here. We know it’s section 0, and we want it to have as many rows as there are birthdays, so we write <span class="code">return birthdays.count</span>
 .</p>
<p class="indent">Finally, you need to implement <span class="code">tableView(_:cellForRowAt:)</span>
 so that the table view will know what to put inside each cell. Since this method is commented out, you need to uncomment it by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it. (Be careful not to accidentally uncomment the other methods after it!) After you’ve done that, change it to the following code:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, cellForRowAt <img class="inline" src="Image00184.jpg" />
<br />
    indexPath: IndexPath) -&gt; UITableViewCell {</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="pink">let</span>
 cell = tableView.<span class="blue">dequeueReusableCell</span>
 (withIdentifier: <img class="inline" src="Image00093.jpg" />
<br />
        <span class="red">"birthdayCellIdentifier"</span>
 , for: indexPath)<br />
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 birthday = <span class="green1">birthdays</span>
 [indexPath.<span class="violet">row</span>
 ]<br />
<br />
  <span class="ent">➌</span>
 cell.<span class="violet">textLabel</span>
 ?.<span class="violet">text</span>
 = birthday.<span class="green1">firstName</span>
 <span class="blue">+</span>
 <span class="red">" "</span>
 <span class="blue">+</span>
 <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">lastName</span>
<br />
<br />
  <span class="ent">➍</span>
 cell.<span class="violet">detailTextLabel</span>
 ?.<span class="violet">text</span>
 = <span class="green1">dateFormatter</span>
 .<span class="blue">string</span>
 (from: <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">birthdate</span>
 )<br />
<br />
  <span class="ent">➎</span>
 <span class="pink">return</span>
 cell<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">You don’t call the method <span class="code">tableView(_:cellForRowAt:)</span>
 . It’s called when the table view is loaded onto the screen. It’s called for each cell on the screen and takes two parameters, <span class="code">tableView</span>
 and <span class="code">indexPath</span>
 . You already know <span id="page_165"></span>
 what the <span class="code">tableView</span>
 parameter is for. An <span class="code">IndexPath</span>
 is a Swift struct that’s used to represent a row’s position in a table view. An <span class="code">IndexPath</span>
 instance has a <span class="code">section</span>
 property and a <span class="code">row</span>
 property. Since this method will be called many times (once for every row in the table), we need the <span class="code">indexPath</span>
 to know which section and row we’re currently configuring. The <span class="code">indexPath.section</span>
 property gives the section number, and the <span class="code">indexPath.row</span>
 gives the row of the table view cell. The five lines of code inside <span class="code">tableView(_:cellForRowAt:)</span>
 will do the following:</p>
<div class="image"><img src="Image00244.jpg" />
</div>
<p class="bull">• Create a <span class="code">UITableViewCell</span>
</p>
<p class="bull">• Figure out which <span class="code">Birthday</span>
 in the <span class="code">birthdays</span>
 array will be displayed inside the cell</p>
<p class="bull">• Make two labels to display the birthday person’s name and birthdate in the cell</p>
<p class="bull">• Return the cell ready for display in the table view</p>
<p class="indentt">Let’s go through this code line by line.</p>
<p class="indent">First, create the <span class="code">UITableViewCell</span>
 . The code at <span class="ent">➊</span>
 does this using the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 . Before you can start using this method on a cell, though, you need to tell the method which cell you want to use from the storyboard. Earlier, when you were in the storyboard, you gave your cell the identifier <span class="code">birthdayCellIdentifier</span>
 (see <a href="text00022.html#ch11fig4">Figure 11-4</a>
 ). This identifier links your code to the cell and tells your method that it’s using the right cell. The string for when you call this method needs to be exactly the same as the string you set in the storyboard, or you’ll get an error and the app will crash when you run it.</p>
<p class="indent">In the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 , did you notice the words <em>Reusable Cell</em>
 ? The cells inside a table view are created once and then can be reused over and over. This helps everything run faster and smoother because creating the cell is what takes the most time. If you had 200 birthdays in your app, but only 10 would fit on your screen at one time, then you need only 10 cells to show your birthdays. When you scroll down to reveal more birthdays, the cells that scroll off the top of the screen are reused. They are filled with new information and show up again at the bottom of the screen. The <span class="code">UITableView</span>
 automatically does this work. When the table view is loaded, <span class="code">tableView(_:cellForRowAt:)</span>
 is called for every visible row. When the user scrolls to look at more cells, it’s called again for each row just as it is about to appear on the screen.</p>
<p class="indent">Next, we need to find out which <span class="code">Birthday</span>
 should be displayed inside the cell. We want to display one birthday from the <span class="code">birthdays</span>
 array in each row. The first birthday, which is at <span class="code">birthdays[0]</span>
 , should be displayed in row 0. The second birthday, at <span class="code">birthdays[1]</span>
 , should be displayed in row 1, and so on, which means the <span class="code">indexPath</span>
 ’s <span class="code">row</span>
 is the same as the position in the <span class="code">birthdays</span>
 array that we want to access. The code at <span class="ent">➋</span>
 accesses the <span id="page_166"></span>
 correct <span class="code">Birthday</span>
 object from the <span class="code">birthdays</span>
 array by using <span class="code">indexPath.row</span>
 . Once we have the right <span class="code">Birthday</span>
 object, we assign it to a constant named <span class="code">birthday</span>
 so we can set up the labels in this cell.</p>
<p class="indent">Notice that we’re using <span class="code">let</span>
 to assign the <span class="code">birthday</span>
 to a constant instead of a variable. We can use <span class="code">let</span>
 because each time <span class="code">tableView(_:cellForRowAt:)</span>
 is called, a new <span class="code">birthday</span>
 constant is created. Each cell gets its own <span class="code">birthday</span>
 constant that is assigned its own <span class="code">Birthday</span>
 object. Since we’re not going to change any of the <span class="code">birthday</span>
 constants—we’re just going to read their properties—we don’t want to make them variables.</p>
<p class="indent">Now that you have your cell and your birthday, it’s time to fill in the details. You need two labels for each cell to show the birthday person’s name and birthdate. You set the cell to the Subtitle style so that it has a Title label and a Subtitle label. Each cell will already contain these labels, so now you don’t have to create any labels yourself.</p>
<p class="indent">The labels exist as properties of <span class="code">UITableViewCell</span>
 and are called <span class="code">textLabel</span>
 and <span class="code">detailTextLabel</span>
 . The code at <span class="ent">➌</span>
 sets the text of the <span class="code">textLabel</span>
 to a string made up of the <span class="code">firstName</span>
 and <span class="code">lastName</span>
 of the <span class="code">birthday</span>
 with a space between them. At <span class="ent">➍</span>
 , you use the <span class="code">string(from:)</span>
 method of the <span class="code">dateFormatter</span>
 to display the birthdate in the <span class="code">detailTextLabel</span>
 .</p>
<p class="indent">When your cell is completely configured, <span class="code">tableView( _:cellForRowAt:)</span>
 returns the cell at <span class="ent">➎</span>
 so that it can be displayed at that <span class="code">indexPath</span>
 of the table view.</p>
<h3 class="h3" id="ch11lev1sec2">
<strong>PUTTING IT ALL TOGETHER</strong>
</h3>
<p class="noindent">Now you can add <span class="code">Birthday</span>
 instances to the app using the Add Birthday view controller, and you have a table view to list each <span class="code">Birthday</span>
 in the Birthdays table view controller. But when you try running the app and adding a <span class="code">Birthday</span>
 , it doesn’t appear. To make each <span class="code">Birthday</span>
 you add appear in the table view, you need to make the Add Birthday view controller communicate with the Birthdays table view controller. You do this by using <em>delegation</em>
 .</p>
<h4 class="h4" id="ch11lev2sec5">
<strong>DELEGATION</strong>
</h4>
<p class="noindent">Delegation can be used when one view controller needs to get information from another view controller. Say you have two view controllers: A and B. The first view controller, A, creates B and presents B on top of itself. A knows about B because it created and presented B, so A can pass information along to B. But B doesn’t know about A—it’s just popped into being and doesn’t know where it came from or how it got there. So how can B talk to A? Through delegation!</p>
<div class="image"><img src="Image00245.jpg" />
</div>
<p class="indent">Delegation is when someone gives a job or a task to someone else. A <em>delegate</em>
 is like a boss who tells a delegating employee what to do. When the delegating employee is done with their task, sometimes they’ll report information back to the delegate boss.</p>
<p class="indent"><span id="page_167"></span>
 Delegation in Swift is pretty similar, but instead of having a boss and employee, we have a delegate and a delegating object. Since class B is the one being told what to do by class A, it’s the delegating object. We give class B a special property called a delegate to tell it who its delegate is—that way, it knows who to communicate with. The delegate can be any class that has a set of methods that have been defined in a <em>protocol</em>
 . A protocol is like an agreement between the two classes that tells them what the delegate can ask the delegating object to do. It has a list of method and property names that the delegate can use with the delegating object.</p>
<p class="indent">Class A creates class B, makes itself the delegate of class B, and gives class B a job to do that’s in the protocol. Once class B is done with its job, it reports back to class A. Let’s see how this works in our app.</p>
<p class="indent">The Birthdays table view controller is view controller A, and the Add Birthday view controller is view controller B. We’ll create a protocol called <span class="code">AddBirthdayViewControllerDelegate</span>
 and a method for that protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 , which the Add Birthday view controller will use to report back.</p>
<p class="indent">Take a look at <a href="text00022.html#ch11fig6">Figure 11-6</a>
 . When the user taps the Add button <span class="ent">➊</span>
 , the Birthdays table view controller creates the Add Birthday view controller <span class="ent">➋</span>
 and sets itself as the Add Birthday view controller’s delegate.</p>
<div class="image"><img src="Image00246.jpg" />
</div>
<p class="figcap"><a id="ch11fig6"></a>
 <em>Figure 11-6: A new birthday is added and passed from the Add Birthday view controller to the Birthdays table view controller using delegation.</em>
</p>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<div class="image"><img src="Image00234.jpg" />
</div>
<p class="figcap"><a id="ch11fig1"></a>
 <em>Figure 11-1: To subclass an existing class, choose</em>
 <strong>
<em>iOS</em>
</strong>
 <em>and then</em>
 <strong>
<em>Cocoa Touch Class.</em>
</strong>
</p>
<p class="indent">When you choose this option, you’ll see a second dialog where you can name your new class and specify which class you’ll subclass. First, in the Subclass field (the second field in the dialog), type <span class="code">
<span class="codestrong">UITableViewController</span>
</span>
 . This will automatically fill in the class field with the subclass name. Once that happens, type <span class="code">
<span class="codestrong">Birthdays</span>
</span>
 in front of <span class="code">TableViewController</span>
 so that the whole class name is <span class="code">BirthdaysTableViewController</span>
 . This is a shortcut so you don’t <span id="page_157"></span>
 have to type as much. Make sure to choose <strong>Swift</strong>
 in the Language drop-down menu as well, and then click <strong>Next</strong>
 . Then select <strong>Create</strong>
 in the final dialog to create your new file.</p>
<p class="indent">In <em>BirthdaysTableViewController.swift</em>
 , Xcode has provided a template with several commented-out methods. You can clean up the code by getting rid of methods we won’t use. Delete just the comments in <span class="code">viewDidLoad()</span>
 , and then delete the entire <span class="code">didReceiveMemoryWarning()</span>
 method and the methods <span class="code">tableView(_:moveRowAt:to:)</span>
 and <span class="code">tableView(_:canMoveRowAt:)</span>
 , which have to do with moving rows in the table view. When you’re finished, the contents of <span class="code">BirthdaysTableViewController</span>
 should look like <a href="text00022.html#ch11fig2">Figure 11-2</a>
 . There are still several commented-out methods, but we’re keeping those to use later!</p>
<div class="image"><img src="Image00235.jpg" />
</div>
<p class="figcap"><a id="ch11fig2"></a>
 <em>Figure 11-2: The</em>
 <span class="code">
<span class="italic">BirthdaysTableViewController</span>
</span>
 <em>cleaned up!</em>
</p>
<p class="indent">Next, you need to make the Birthdays table view controller the <span class="code">BirthdaysTableViewController</span>
 class. To do this, go to <em>Main.storyboard</em>
 and select the <strong>Birthdays</strong>
 scene. Using the Identity Inspector in the right pane, change the class from <span class="code">UITableViewController</span>
 to <span class="code">BirthdaysTableViewController</span>
 , as shown in <a href="text00022.html#ch11fig3">Figure 11-3</a>
 .</p>
<div class="image"><span id="page_158"></span>
 <img src="Image00236.jpg" />
</div>
<p class="figcap"><a id="ch11fig3"></a>
 <em>Figure 11-3: Setting</em>
 <span class="code">
<span class="italic">BirthdaysTableViewController</span>
</span>
 <em>as the class of the Birthdays scene</em>
</p>
<p class="indent">Now that you have the Birthdays table view controller set up in the storyboard, the next step is to make cells in your table that will display each birthday.</p>
<h4 class="h4" id="ch11lev2sec2">
<strong>ADDING CELLS TO THE TABLE VIEW</strong>
</h4>
<p class="noindent">Each birthday will be displayed in a <span class="code">UITableViewCell</span>
 in the Birthdays table view controller. A table has boxes organized into rows and columns that contain information. These boxes are called <em>cells</em>
 . Similarly, a table view also has cells that are all instances of, or a subclass of, the <span class="code">UITableViewCell</span>
 class. We’ll put each birthday into its own cell in our table view.</p>
<p class="indent">We’ll start by creating those cells in the storyboard, and then we’ll fill them with our <span class="code">Birthday</span>
 objects later. In the left outline menu, click the triangle by Birthdays and then click the triangle by Table View to open those sections. Then select <strong>Table View Cell</strong>
 <span class="ent">➊</span>
 , as shown in <a href="text00022.html#ch11fig4">Figure 11-4</a>
 .</p>
<div class="image"><img src="Image00237.jpg" />
</div>
<div class="image"><img src="Image00238.jpg" />
</div>
<p class="figcap"><a id="ch11fig4"></a>
 <em>Figure 11-4: Creating a Subtitle style table view cell and setting its identifier</em>
</p>
<p class="indent"><span id="page_159"></span>
 Next, open the Attributes Inspector. Using the drop-down menu under <strong>Style</strong>
 , set the cell’s style to <strong>Subtitle</strong>
 <span class="ent">➋</span>
 so that the cell now has a Title label and a Subtitle label. You’ll display each person’s name in the Title and birthday in the Subtitle.</p>
<p class="indent">Finally, enter <span class="code">
<span class="codestrong">birthdayCellIdentifier</span>
</span>
 in the Identifier field <span class="ent">➌</span>
 . You’ll use this identifier later when you fill in the cell contents.</p>
<p class="indent">That’s it! You’ve finished your work in the storyboard.</p>
<p class="indent">You may be wondering why we have just one cell in our table view in the storyboard when we’ll have more than one birthday to show in the list. If you look at <a href="text00022.html#ch11fig4">Figure 11-4</a>
 again, you’ll notice that the cell is labeled <em>Prototype Cells</em>
 . This means that the cell you just customized is a <em>template</em>
 for all the cells you want to appear in your table view. The identifier you gave the cell is how your code will tell the table view to produce each cell for you to put birthdays in. You’ll see how this works soon.</p>
<div class="box1">
<p class="box-title">
<strong>WORKING WITH DATES</strong>
</p>
<p class="box-p">Swift has a special data type called <span class="code">Date</span>
 that is used for storing date values. A <span class="code">Date</span>
 object is actually a date and a time. Open your playground and enter the following:</p>
<div class="image"><img src="Image00239.jpg" />
</div>
<p class="box-pi">We’ve just assigned the current date and time the code was run to the variable <span class="code">today</span>
 . When you print <span class="code">today</span>
 , it’s in the format <span class="code">"2017-11-21 10:45:31 +0000\n"</span>
 . What if you wanted it to display as <span class="code">Tuesday, November 21, 2017</span>
 , instead? Or just <span class="code">11/21/17</span>
 ? To display a date in a particular way, you use a <em>date formatter</em>
 , which is a <span class="code">DateFormatter</span>
 object that you create and give a date format style. <span class="code">DateFormatter</span>
 is a helper object that is used to create a display string from any date, and a <em>date format style</em>
 is a property of <span class="code">DateFormatter</span>
 that tells the formatter what style to use. You can create your own date format styles manually, but there are also styles that are included in Swift and ready to use. Add the following to your playground:</p>
<div class="image"><img src="Image00240.jpg" />
</div>
<p class="box-pi">At <span class="ent">➊</span>
 you create a <span class="code">formatter</span>
 . Then at <span class="ent">➋</span>
 , you set the style of the <span class="code">formatter</span>
 to <span class="code">Style.full</span>
 , which will print the day of the week as well as the full month name, date, and year. Finally, you create a string from the date using the <span class="code">string(from:)</span>
 method of the <span class="code">DateFormatter</span>
 class <span class="ent">➌</span>
 . You can see that you now have turned the <span id="page_160"></span>
 date into the nicely formatted string <span class="code">"Tuesday, November 21, 2017"</span>
 . <a style=";color:black;" href="text00022.html#ch11tab1">Table 11-1</a>
 shows the different strings that are created from the five <span class="code">DateFormatter.Style</span>
 options available in Swift.</p>
<p class="tabcap"><a id="ch11tab1" style=";color:black;"></a>
 <strong>Table 11-1:</strong>
 Date Formatter Styles and Their Date Strings</p>
<table class="tabled">
<tbody>
<tr>
<td style="vertical-align: top;" class="border1">
<p class="noindent">
<span class="code">
<span class="codestrong">DateFormatter.Style</span>
</span>
</p>
</td>
<td style="vertical-align: top;" class="border1">
<p class="noindent">
<strong>Date string</strong>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">none</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">""</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">short</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"11/21/17"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">medium</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"Nov 21, 2017"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">long</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"November 21, 2017"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">full</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"Tuesday, November 21, 2017"</span>
</p>
</td>
</tr>
</tbody>
</table>
<p class="box-pi">You can also specify your own custom way of displaying a date using the <span class="code">dateFormat</span>
 property of the <span class="code">DateFormatter</span>
 . Perhaps you only want the month and day. Or maybe you want a four-digit year displayed in the <span class="code">short</span>
 style. Doing either is really easy, and you don’t even have to create a new <span class="code">DateFormatter</span>
 —you can just change the <span class="code">dateFormat</span>
 on <span class="code">formatter</span>
 and then ask it for a new string. Add the following code to your playground to display dates with a specific format:</p>
<div class="image"><img src="Image00241.jpg" />
</div>
<p class="box-pi">At <span class="ent">➊</span>
 , you specify that you only want the month and the date in an <span class="code">MM/dd</span>
 format—that is, a two-digit month followed by a two-digit date. If you want to display the month as three letters, then use <span class="code">MMM</span>
 . To display the full name of the month, use <span class="code">MMMM</span>
 . At <span class="ent">➋</span>
 , we change the date format to use a four-digit year. A two-digit year would be <span class="code">yy</span>
 . Here are a few other ways to use a <span class="code">dateFormat</span>
 to display a custom date string.</p>
<div class="image"><img src="Image00242.jpg" />
</div>
<p class="box-pi"><span id="page_161"></span>
 If you want to include separators, you add them to your <span class="code">dateFormat</span>
 string. For example, if you want periods as separators, then you can create a <span class="code">dateFormat</span>
 like <span class="code">"MM.dd.yy"</span>
 <span class="ent">➊</span>
 . To display an abbreviated day of the week, use <span class="code">EEE</span>
 <span class="ent">➋</span>
 . For the full day, use <span class="code">EEEE</span>
 <span class="ent">➌</span>
 . These are only a few examples. By using combinations of <span class="code">M</span>
 , <span class="code">d</span>
 , <span class="code">y</span>
 , and <span class="code">E</span>
 , you have an endless number of ways to display a date!</p>
</div>
<h4 class="h4" id="ch11lev2sec3">
<strong>SETTING UP THE BIRTHDAYS TABLE VIEW CONTROLLER</strong>
</h4>
<p class="noindent">The Birthdays table view controller will display a list of all the birthdays stored in the app. Do you remember what you use to store a list of items? That’s right—an array! You’ll create an array in the <span class="code">BirthdaysTableViewController</span>
 to store all the birthdays. To do this, give the <span class="code">BirthdaysTableViewController</span>
 a <span class="code">birthdays</span>
 property that is an array of <span class="code">Birthday</span>
 objects. At the top of the class, right above the <span class="code">viewDidLoad()</span>
 method, insert this line to add a variable array property called <span class="code">birthdays</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController {</span>
<br />
<br />
    <span class="pink">var</span>
 birthdays = [<span class="green1">Birthday</span>
 ]()<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent">This line creates an empty array of <span class="code">Birthday</span>
 instances. It needs to be a variable and not a constant because you’ll want to add a saved <span class="code">Birthday</span>
 to this array every time the user adds a <span class="code">Birthday</span>
 with the Add Birthday view controller. You’ll see how to do that in “<a href="text00022.html#ch11lev3sec2">Making the Birthdays Table View Controller Conform to Protocol</a>
 ” on <a href="text00022.html#page_168">page 168</a>
 .</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>Remember that the final versions of the project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>.</em>
</p>
</div>
<p class="indent">The <span class="code">BirthdaysTableViewController</span>
 will also need a <span class="code">dateFormatter</span>
 property to display the birthdate as a nicely formatted string. Add a <span class="code">dateFormatter</span>
 right underneath the <span class="code">birthdays</span>
 array:</p>
<div class="box">
<pre>    <span class="ash">var birthdays = [Birthday]()</span>
<br />
<br />
    <span class="pink">let</span>
 dateFormatter = <span class="violet">DateFormatter</span>
 ()<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent">Note that the <span class="code">dateFormatter</span>
 is a constant that is created with <span class="code">let</span>
 . Even though you’ll change the <span class="code">dateFormatter</span>
 ’s properties, like the <span class="code">dateStyle</span>
 and <span class="code">timeStyle</span>
 , you’ll never change the <span class="code">dateFormatter</span>
 itself.</p>
<p class="indent"><span id="page_162"></span>
 You’ll also need to set up the <span class="code">dateFormatter</span>
 so that it will display the birthdates as fully formatted strings like <span class="code">"Tuesday, December 17, 2008"</span>
 . As you saw in <a href="text00021.html#ch10">Chapter 10</a>
 , a good place to do this is the <span class="code">viewDidLoad()</span>
 method, which is called when the Birthdays table view controller is loading its view. This is the perfect place to do any setup that is needed for this class.</p>
<div class="box">
<pre>
<span class="ash">override func viewDidLoad() {</span>
<br />
    <span class="ash">super.viewDidLoad()</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">dateFormatter</span>
 .<span class="violet">dateStyle</span>
 = .<span class="blue">full</span>
<br />
  <span class="ent">➋</span>
 <span class="green1">dateFormatter</span>
 .<span class="violet">timeStyle</span>
 = .<span class="blue">none</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , you set the <span class="code">dateStyle</span>
 of the <span class="code">dateFormatter</span>
 so that it will display a formatted date string for each <span class="code">Birthday</span>
 . Did you notice how we just wrote <span class="code">.full</span>
 instead of <span class="code">DateFormatter.Style.full</span>
 ? Swift knows what type to expect for the <span class="code">dateStyle</span>
 of a <span class="code">DateFormatter</span>
 , so it lets us take this little shortcut. At <span class="ent">➋</span>
 , you set the <span class="code">timeStyle</span>
 of the <span class="code">dateFormatter</span>
 to <span class="code">.none</span>
 so that the time won’t be shown.</p>
<h4 class="h4" id="ch11lev2sec4">
<strong>DISPLAYING BIRTHDAYS IN A TABLE VIEW</strong>
</h4>
<p class="noindent">The <span class="code">BirthdaysTableViewController</span>
 class has a table view that is used to display a list of items in a single column. The table view has one or more sections containing rows, and each row contains a cell. A section in a table view is a grouping of rows that can be displayed with or without a header. An example of an app that shows a table view with several sections is the Settings app, as shown in <a href="text00022.html#ch11fig5">Figure 11-5</a>
 . It displays a list of rows that have been broken up into different sections.</p>
<p class="indent">Each section and row of a table view is identified with an index number. These numbers start at 0 and then increase by 1 as you go down the table view. For example, the Privacy line in the Settings app is found at section 0, row 1. The News setting is at section 1, row 3.</p>
<p class="indent">In the middle of the <span class="code">BirthdaysTableViewController</span>
 class, there is a section called <em>Table view data source</em>
 with three methods. The table view controller uses these methods to determine what’s going to be displayed inside its table view.</p>
<p class="hang">
<span class="code">
<span class="codestrong">numberOfSections(in:)</span>
</span>
 Tells the table view how many sections it should have</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:numberOfRowsInSection:)</span>
</span>
 Tells the table view how many rows will be displayed in each section</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:cellForRowAt:)</span>
</span>
 Sets up each cell that’s going to be displayed in each row of the table view</p>
<div class="image"><span id="page_163"></span>
 <img src="Image00243.jpg" />
</div>
<p class="figcap"><a id="ch11fig5"></a>
 <em>Figure 11-5: The Settings app uses sections to group rows of different device settings.</em>
</p>
<p class="indent">The table view data source methods are called by the table view controller every time the table view is reloaded. Xcode automatically gives you these method templates when you make a subclass of a <span class="code">UITableViewController</span>
 . You need to implement all three methods for the app to work, even though you’ll never call them directly in your code. The <span class="code">UITableViewController</span>
 class implements the <span class="code">UITableViewDataSource</span>
 protocol, which comes with these data source methods, to determine what will be displayed inside the table view. We’ll discuss protocols in “<a href="text00022.html#ch11lev2sec5">Delegation</a>
 ” on page 166. For now, you just need to know that a <span class="code">UITableViewController</span>
 uses these methods to display its content, and it automatically calls these methods so you don’t need to call them.</p>
<p class="indent">Let’s start with the method <span class="code">numberOfSections(in:)</span>
 . The Birthdays table view controller is a list that just displays <span class="code">Birthday</span>
 instances, so it doesn’t need multiple sections. To set the number of sections in the table view, we just need to return <span class="code">1</span>
 .</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func numberOfSections(in tableView: UITableView) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 <span class="blue1">1</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent"><span id="page_164"></span>
 This method takes a <span class="code">UITableView</span>
 called <span class="code">tableView</span>
 as a parameter, which is the table view that uses this class as its data source. We don’t need to worry about making this connection because the <span class="code">UITableViewController</span>
 comes with a built-in table view that is automatically hooked up to these methods. Each birthday will be displayed in its own row. So in <span class="code">tableView(_:numberOfRowsInSection:)</span>
 , in order to have the right number of rows for all of your birthdays, you need to return the number of <span class="code">Birthday</span>
 instances that you have in your <span class="code">birthdays</span>
 array. Do you remember the <span class="code">count</span>
 property of an array? It’s an integer that tells you how many items are in that array, and it’s perfect for this situation! Change this method to the following:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, <img class="inline" src="Image00184.jpg" />
<br />
    numberOfRowsInSection section: Int) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 birthdays.<span class="violet">count</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">In addition to the <span class="code">tableView</span>
 parameter, <span class="code">tableView(_:numberOfRowsInSection:)</span>
 also takes an <span class="code">Int</span>
 called <span class="code">section</span>
 . When the table view is loading itself, this method is called for each section in the table view. In our case, we have only one section, so we don’t need to bother checking which <span class="code">section</span>
 of the table view is being displayed here. We know it’s section 0, and we want it to have as many rows as there are birthdays, so we write <span class="code">return birthdays.count</span>
 .</p>
<p class="indent">Finally, you need to implement <span class="code">tableView(_:cellForRowAt:)</span>
 so that the table view will know what to put inside each cell. Since this method is commented out, you need to uncomment it by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it. (Be careful not to accidentally uncomment the other methods after it!) After you’ve done that, change it to the following code:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, cellForRowAt <img class="inline" src="Image00184.jpg" />
<br />
    indexPath: IndexPath) -&gt; UITableViewCell {</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="pink">let</span>
 cell = tableView.<span class="blue">dequeueReusableCell</span>
 (withIdentifier: <img class="inline" src="Image00093.jpg" />
<br />
        <span class="red">"birthdayCellIdentifier"</span>
 , for: indexPath)<br />
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 birthday = <span class="green1">birthdays</span>
 [indexPath.<span class="violet">row</span>
 ]<br />
<br />
  <span class="ent">➌</span>
 cell.<span class="violet">textLabel</span>
 ?.<span class="violet">text</span>
 = birthday.<span class="green1">firstName</span>
 <span class="blue">+</span>
 <span class="red">" "</span>
 <span class="blue">+</span>
 <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">lastName</span>
<br />
<br />
  <span class="ent">➍</span>
 cell.<span class="violet">detailTextLabel</span>
 ?.<span class="violet">text</span>
 = <span class="green1">dateFormatter</span>
 .<span class="blue">string</span>
 (from: <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">birthdate</span>
 )<br />
<br />
  <span class="ent">➎</span>
 <span class="pink">return</span>
 cell<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">You don’t call the method <span class="code">tableView(_:cellForRowAt:)</span>
 . It’s called when the table view is loaded onto the screen. It’s called for each cell on the screen and takes two parameters, <span class="code">tableView</span>
 and <span class="code">indexPath</span>
 . You already know <span id="page_165"></span>
 what the <span class="code">tableView</span>
 parameter is for. An <span class="code">IndexPath</span>
 is a Swift struct that’s used to represent a row’s position in a table view. An <span class="code">IndexPath</span>
 instance has a <span class="code">section</span>
 property and a <span class="code">row</span>
 property. Since this method will be called many times (once for every row in the table), we need the <span class="code">indexPath</span>
 to know which section and row we’re currently configuring. The <span class="code">indexPath.section</span>
 property gives the section number, and the <span class="code">indexPath.row</span>
 gives the row of the table view cell. The five lines of code inside <span class="code">tableView(_:cellForRowAt:)</span>
 will do the following:</p>
<div class="image"><img src="Image00244.jpg" />
</div>
<p class="bull">• Create a <span class="code">UITableViewCell</span>
</p>
<p class="bull">• Figure out which <span class="code">Birthday</span>
 in the <span class="code">birthdays</span>
 array will be displayed inside the cell</p>
<p class="bull">• Make two labels to display the birthday person’s name and birthdate in the cell</p>
<p class="bull">• Return the cell ready for display in the table view</p>
<p class="indentt">Let’s go through this code line by line.</p>
<p class="indent">First, create the <span class="code">UITableViewCell</span>
 . The code at <span class="ent">➊</span>
 does this using the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 . Before you can start using this method on a cell, though, you need to tell the method which cell you want to use from the storyboard. Earlier, when you were in the storyboard, you gave your cell the identifier <span class="code">birthdayCellIdentifier</span>
 (see <a href="text00022.html#ch11fig4">Figure 11-4</a>
 ). This identifier links your code to the cell and tells your method that it’s using the right cell. The string for when you call this method needs to be exactly the same as the string you set in the storyboard, or you’ll get an error and the app will crash when you run it.</p>
<p class="indent">In the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 , did you notice the words <em>Reusable Cell</em>
 ? The cells inside a table view are created once and then can be reused over and over. This helps everything run faster and smoother because creating the cell is what takes the most time. If you had 200 birthdays in your app, but only 10 would fit on your screen at one time, then you need only 10 cells to show your birthdays. When you scroll down to reveal more birthdays, the cells that scroll off the top of the screen are reused. They are filled with new information and show up again at the bottom of the screen. The <span class="code">UITableView</span>
 automatically does this work. When the table view is loaded, <span class="code">tableView(_:cellForRowAt:)</span>
 is called for every visible row. When the user scrolls to look at more cells, it’s called again for each row just as it is about to appear on the screen.</p>
<p class="indent">Next, we need to find out which <span class="code">Birthday</span>
 should be displayed inside the cell. We want to display one birthday from the <span class="code">birthdays</span>
 array in each row. The first birthday, which is at <span class="code">birthdays[0]</span>
 , should be displayed in row 0. The second birthday, at <span class="code">birthdays[1]</span>
 , should be displayed in row 1, and so on, which means the <span class="code">indexPath</span>
 ’s <span class="code">row</span>
 is the same as the position in the <span class="code">birthdays</span>
 array that we want to access. The code at <span class="ent">➋</span>
 accesses the <span id="page_166"></span>
 correct <span class="code">Birthday</span>
 object from the <span class="code">birthdays</span>
 array by using <span class="code">indexPath.row</span>
 . Once we have the right <span class="code">Birthday</span>
 object, we assign it to a constant named <span class="code">birthday</span>
 so we can set up the labels in this cell.</p>
<p class="indent">Notice that we’re using <span class="code">let</span>
 to assign the <span class="code">birthday</span>
 to a constant instead of a variable. We can use <span class="code">let</span>
 because each time <span class="code">tableView(_:cellForRowAt:)</span>
 is called, a new <span class="code">birthday</span>
 constant is created. Each cell gets its own <span class="code">birthday</span>
 constant that is assigned its own <span class="code">Birthday</span>
 object. Since we’re not going to change any of the <span class="code">birthday</span>
 constants—we’re just going to read their properties—we don’t want to make them variables.</p>
<p class="indent">Now that you have your cell and your birthday, it’s time to fill in the details. You need two labels for each cell to show the birthday person’s name and birthdate. You set the cell to the Subtitle style so that it has a Title label and a Subtitle label. Each cell will already contain these labels, so now you don’t have to create any labels yourself.</p>
<p class="indent">The labels exist as properties of <span class="code">UITableViewCell</span>
 and are called <span class="code">textLabel</span>
 and <span class="code">detailTextLabel</span>
 . The code at <span class="ent">➌</span>
 sets the text of the <span class="code">textLabel</span>
 to a string made up of the <span class="code">firstName</span>
 and <span class="code">lastName</span>
 of the <span class="code">birthday</span>
 with a space between them. At <span class="ent">➍</span>
 , you use the <span class="code">string(from:)</span>
 method of the <span class="code">dateFormatter</span>
 to display the birthdate in the <span class="code">detailTextLabel</span>
 .</p>
<p class="indent">When your cell is completely configured, <span class="code">tableView( _:cellForRowAt:)</span>
 returns the cell at <span class="ent">➎</span>
 so that it can be displayed at that <span class="code">indexPath</span>
 of the table view.</p>
<h3 class="h3" id="ch11lev1sec2">
<strong>PUTTING IT ALL TOGETHER</strong>
</h3>
<p class="noindent">Now you can add <span class="code">Birthday</span>
 instances to the app using the Add Birthday view controller, and you have a table view to list each <span class="code">Birthday</span>
 in the Birthdays table view controller. But when you try running the app and adding a <span class="code">Birthday</span>
 , it doesn’t appear. To make each <span class="code">Birthday</span>
 you add appear in the table view, you need to make the Add Birthday view controller communicate with the Birthdays table view controller. You do this by using <em>delegation</em>
 .</p>
<h4 class="h4" id="ch11lev2sec5">
<strong>DELEGATION</strong>
</h4>
<p class="noindent">Delegation can be used when one view controller needs to get information from another view controller. Say you have two view controllers: A and B. The first view controller, A, creates B and presents B on top of itself. A knows about B because it created and presented B, so A can pass information along to B. But B doesn’t know about A—it’s just popped into being and doesn’t know where it came from or how it got there. So how can B talk to A? Through delegation!</p>
<div class="image"><img src="Image00245.jpg" />
</div>
<p class="indent">Delegation is when someone gives a job or a task to someone else. A <em>delegate</em>
 is like a boss who tells a delegating employee what to do. When the delegating employee is done with their task, sometimes they’ll report information back to the delegate boss.</p>
<p class="indent"><span id="page_167"></span>
 Delegation in Swift is pretty similar, but instead of having a boss and employee, we have a delegate and a delegating object. Since class B is the one being told what to do by class A, it’s the delegating object. We give class B a special property called a delegate to tell it who its delegate is—that way, it knows who to communicate with. The delegate can be any class that has a set of methods that have been defined in a <em>protocol</em>
 . A protocol is like an agreement between the two classes that tells them what the delegate can ask the delegating object to do. It has a list of method and property names that the delegate can use with the delegating object.</p>
<p class="indent">Class A creates class B, makes itself the delegate of class B, and gives class B a job to do that’s in the protocol. Once class B is done with its job, it reports back to class A. Let’s see how this works in our app.</p>
<p class="indent">The Birthdays table view controller is view controller A, and the Add Birthday view controller is view controller B. We’ll create a protocol called <span class="code">AddBirthdayViewControllerDelegate</span>
 and a method for that protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 , which the Add Birthday view controller will use to report back.</p>
<p class="indent">Take a look at <a href="text00022.html#ch11fig6">Figure 11-6</a>
 . When the user taps the Add button <span class="ent">➊</span>
 , the Birthdays table view controller creates the Add Birthday view controller <span class="ent">➋</span>
 and sets itself as the Add Birthday view controller’s delegate.</p>
<div class="image"><img src="Image00246.jpg" />
</div>
<p class="figcap"><a id="ch11fig6"></a>
 <em>Figure 11-6: A new birthday is added and passed from the Add Birthday view controller to the Birthdays table view controller using delegation.</em>
</p>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="figcap"><a id="ch11fig1"></a>
 <em>Figure 11-1: To subclass an existing class, choose</em>
 <strong>
<em>iOS</em>
</strong>
 <em>and then</em>
 <strong>
<em>Cocoa Touch Class.</em>
</strong>
</p>
<p class="indent">When you choose this option, you’ll see a second dialog where you can name your new class and specify which class you’ll subclass. First, in the Subclass field (the second field in the dialog), type <span class="code">
<span class="codestrong">UITableViewController</span>
</span>
 . This will automatically fill in the class field with the subclass name. Once that happens, type <span class="code">
<span class="codestrong">Birthdays</span>
</span>
 in front of <span class="code">TableViewController</span>
 so that the whole class name is <span class="code">BirthdaysTableViewController</span>
 . This is a shortcut so you don’t <span id="page_157"></span>
 have to type as much. Make sure to choose <strong>Swift</strong>
 in the Language drop-down menu as well, and then click <strong>Next</strong>
 . Then select <strong>Create</strong>
 in the final dialog to create your new file.</p>
<p class="indent">In <em>BirthdaysTableViewController.swift</em>
 , Xcode has provided a template with several commented-out methods. You can clean up the code by getting rid of methods we won’t use. Delete just the comments in <span class="code">viewDidLoad()</span>
 , and then delete the entire <span class="code">didReceiveMemoryWarning()</span>
 method and the methods <span class="code">tableView(_:moveRowAt:to:)</span>
 and <span class="code">tableView(_:canMoveRowAt:)</span>
 , which have to do with moving rows in the table view. When you’re finished, the contents of <span class="code">BirthdaysTableViewController</span>
 should look like <a href="text00022.html#ch11fig2">Figure 11-2</a>
 . There are still several commented-out methods, but we’re keeping those to use later!</p>
<div class="image"><img src="Image00235.jpg" />
</div>
<p class="figcap"><a id="ch11fig2"></a>
 <em>Figure 11-2: The</em>
 <span class="code">
<span class="italic">BirthdaysTableViewController</span>
</span>
 <em>cleaned up!</em>
</p>
<p class="indent">Next, you need to make the Birthdays table view controller the <span class="code">BirthdaysTableViewController</span>
 class. To do this, go to <em>Main.storyboard</em>
 and select the <strong>Birthdays</strong>
 scene. Using the Identity Inspector in the right pane, change the class from <span class="code">UITableViewController</span>
 to <span class="code">BirthdaysTableViewController</span>
 , as shown in <a href="text00022.html#ch11fig3">Figure 11-3</a>
 .</p>
<div class="image"><span id="page_158"></span>
 <img src="Image00236.jpg" />
</div>
<p class="figcap"><a id="ch11fig3"></a>
 <em>Figure 11-3: Setting</em>
 <span class="code">
<span class="italic">BirthdaysTableViewController</span>
</span>
 <em>as the class of the Birthdays scene</em>
</p>
<p class="indent">Now that you have the Birthdays table view controller set up in the storyboard, the next step is to make cells in your table that will display each birthday.</p>
<h4 class="h4" id="ch11lev2sec2">
<strong>ADDING CELLS TO THE TABLE VIEW</strong>
</h4>
<p class="noindent">Each birthday will be displayed in a <span class="code">UITableViewCell</span>
 in the Birthdays table view controller. A table has boxes organized into rows and columns that contain information. These boxes are called <em>cells</em>
 . Similarly, a table view also has cells that are all instances of, or a subclass of, the <span class="code">UITableViewCell</span>
 class. We’ll put each birthday into its own cell in our table view.</p>
<p class="indent">We’ll start by creating those cells in the storyboard, and then we’ll fill them with our <span class="code">Birthday</span>
 objects later. In the left outline menu, click the triangle by Birthdays and then click the triangle by Table View to open those sections. Then select <strong>Table View Cell</strong>
 <span class="ent">➊</span>
 , as shown in <a href="text00022.html#ch11fig4">Figure 11-4</a>
 .</p>
<div class="image"><img src="Image00237.jpg" />
</div>
<div class="image"><img src="Image00238.jpg" />
</div>
<p class="figcap"><a id="ch11fig4"></a>
 <em>Figure 11-4: Creating a Subtitle style table view cell and setting its identifier</em>
</p>
<p class="indent"><span id="page_159"></span>
 Next, open the Attributes Inspector. Using the drop-down menu under <strong>Style</strong>
 , set the cell’s style to <strong>Subtitle</strong>
 <span class="ent">➋</span>
 so that the cell now has a Title label and a Subtitle label. You’ll display each person’s name in the Title and birthday in the Subtitle.</p>
<p class="indent">Finally, enter <span class="code">
<span class="codestrong">birthdayCellIdentifier</span>
</span>
 in the Identifier field <span class="ent">➌</span>
 . You’ll use this identifier later when you fill in the cell contents.</p>
<p class="indent">That’s it! You’ve finished your work in the storyboard.</p>
<p class="indent">You may be wondering why we have just one cell in our table view in the storyboard when we’ll have more than one birthday to show in the list. If you look at <a href="text00022.html#ch11fig4">Figure 11-4</a>
 again, you’ll notice that the cell is labeled <em>Prototype Cells</em>
 . This means that the cell you just customized is a <em>template</em>
 for all the cells you want to appear in your table view. The identifier you gave the cell is how your code will tell the table view to produce each cell for you to put birthdays in. You’ll see how this works soon.</p>
<div class="box1">
<p class="box-title">
<strong>WORKING WITH DATES</strong>
</p>
<p class="box-p">Swift has a special data type called <span class="code">Date</span>
 that is used for storing date values. A <span class="code">Date</span>
 object is actually a date and a time. Open your playground and enter the following:</p>
<div class="image"><img src="Image00239.jpg" />
</div>
<p class="box-pi">We’ve just assigned the current date and time the code was run to the variable <span class="code">today</span>
 . When you print <span class="code">today</span>
 , it’s in the format <span class="code">"2017-11-21 10:45:31 +0000\n"</span>
 . What if you wanted it to display as <span class="code">Tuesday, November 21, 2017</span>
 , instead? Or just <span class="code">11/21/17</span>
 ? To display a date in a particular way, you use a <em>date formatter</em>
 , which is a <span class="code">DateFormatter</span>
 object that you create and give a date format style. <span class="code">DateFormatter</span>
 is a helper object that is used to create a display string from any date, and a <em>date format style</em>
 is a property of <span class="code">DateFormatter</span>
 that tells the formatter what style to use. You can create your own date format styles manually, but there are also styles that are included in Swift and ready to use. Add the following to your playground:</p>
<div class="image"><img src="Image00240.jpg" />
</div>
<p class="box-pi">At <span class="ent">➊</span>
 you create a <span class="code">formatter</span>
 . Then at <span class="ent">➋</span>
 , you set the style of the <span class="code">formatter</span>
 to <span class="code">Style.full</span>
 , which will print the day of the week as well as the full month name, date, and year. Finally, you create a string from the date using the <span class="code">string(from:)</span>
 method of the <span class="code">DateFormatter</span>
 class <span class="ent">➌</span>
 . You can see that you now have turned the <span id="page_160"></span>
 date into the nicely formatted string <span class="code">"Tuesday, November 21, 2017"</span>
 . <a style=";color:black;" href="text00022.html#ch11tab1">Table 11-1</a>
 shows the different strings that are created from the five <span class="code">DateFormatter.Style</span>
 options available in Swift.</p>
<p class="tabcap"><a id="ch11tab1" style=";color:black;"></a>
 <strong>Table 11-1:</strong>
 Date Formatter Styles and Their Date Strings</p>
<table class="tabled">
<tbody>
<tr>
<td style="vertical-align: top;" class="border1">
<p class="noindent">
<span class="code">
<span class="codestrong">DateFormatter.Style</span>
</span>
</p>
</td>
<td style="vertical-align: top;" class="border1">
<p class="noindent">
<strong>Date string</strong>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">none</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">""</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">short</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"11/21/17"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">medium</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"Nov 21, 2017"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">long</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"November 21, 2017"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">full</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"Tuesday, November 21, 2017"</span>
</p>
</td>
</tr>
</tbody>
</table>
<p class="box-pi">You can also specify your own custom way of displaying a date using the <span class="code">dateFormat</span>
 property of the <span class="code">DateFormatter</span>
 . Perhaps you only want the month and day. Or maybe you want a four-digit year displayed in the <span class="code">short</span>
 style. Doing either is really easy, and you don’t even have to create a new <span class="code">DateFormatter</span>
 —you can just change the <span class="code">dateFormat</span>
 on <span class="code">formatter</span>
 and then ask it for a new string. Add the following code to your playground to display dates with a specific format:</p>
<div class="image"><img src="Image00241.jpg" />
</div>
<p class="box-pi">At <span class="ent">➊</span>
 , you specify that you only want the month and the date in an <span class="code">MM/dd</span>
 format—that is, a two-digit month followed by a two-digit date. If you want to display the month as three letters, then use <span class="code">MMM</span>
 . To display the full name of the month, use <span class="code">MMMM</span>
 . At <span class="ent">➋</span>
 , we change the date format to use a four-digit year. A two-digit year would be <span class="code">yy</span>
 . Here are a few other ways to use a <span class="code">dateFormat</span>
 to display a custom date string.</p>
<div class="image"><img src="Image00242.jpg" />
</div>
<p class="box-pi"><span id="page_161"></span>
 If you want to include separators, you add them to your <span class="code">dateFormat</span>
 string. For example, if you want periods as separators, then you can create a <span class="code">dateFormat</span>
 like <span class="code">"MM.dd.yy"</span>
 <span class="ent">➊</span>
 . To display an abbreviated day of the week, use <span class="code">EEE</span>
 <span class="ent">➋</span>
 . For the full day, use <span class="code">EEEE</span>
 <span class="ent">➌</span>
 . These are only a few examples. By using combinations of <span class="code">M</span>
 , <span class="code">d</span>
 , <span class="code">y</span>
 , and <span class="code">E</span>
 , you have an endless number of ways to display a date!</p>
</div>
<h4 class="h4" id="ch11lev2sec3">
<strong>SETTING UP THE BIRTHDAYS TABLE VIEW CONTROLLER</strong>
</h4>
<p class="noindent">The Birthdays table view controller will display a list of all the birthdays stored in the app. Do you remember what you use to store a list of items? That’s right—an array! You’ll create an array in the <span class="code">BirthdaysTableViewController</span>
 to store all the birthdays. To do this, give the <span class="code">BirthdaysTableViewController</span>
 a <span class="code">birthdays</span>
 property that is an array of <span class="code">Birthday</span>
 objects. At the top of the class, right above the <span class="code">viewDidLoad()</span>
 method, insert this line to add a variable array property called <span class="code">birthdays</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController {</span>
<br />
<br />
    <span class="pink">var</span>
 birthdays = [<span class="green1">Birthday</span>
 ]()<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent">This line creates an empty array of <span class="code">Birthday</span>
 instances. It needs to be a variable and not a constant because you’ll want to add a saved <span class="code">Birthday</span>
 to this array every time the user adds a <span class="code">Birthday</span>
 with the Add Birthday view controller. You’ll see how to do that in “<a href="text00022.html#ch11lev3sec2">Making the Birthdays Table View Controller Conform to Protocol</a>
 ” on <a href="text00022.html#page_168">page 168</a>
 .</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>Remember that the final versions of the project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>.</em>
</p>
</div>
<p class="indent">The <span class="code">BirthdaysTableViewController</span>
 will also need a <span class="code">dateFormatter</span>
 property to display the birthdate as a nicely formatted string. Add a <span class="code">dateFormatter</span>
 right underneath the <span class="code">birthdays</span>
 array:</p>
<div class="box">
<pre>    <span class="ash">var birthdays = [Birthday]()</span>
<br />
<br />
    <span class="pink">let</span>
 dateFormatter = <span class="violet">DateFormatter</span>
 ()<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent">Note that the <span class="code">dateFormatter</span>
 is a constant that is created with <span class="code">let</span>
 . Even though you’ll change the <span class="code">dateFormatter</span>
 ’s properties, like the <span class="code">dateStyle</span>
 and <span class="code">timeStyle</span>
 , you’ll never change the <span class="code">dateFormatter</span>
 itself.</p>
<p class="indent"><span id="page_162"></span>
 You’ll also need to set up the <span class="code">dateFormatter</span>
 so that it will display the birthdates as fully formatted strings like <span class="code">"Tuesday, December 17, 2008"</span>
 . As you saw in <a href="text00021.html#ch10">Chapter 10</a>
 , a good place to do this is the <span class="code">viewDidLoad()</span>
 method, which is called when the Birthdays table view controller is loading its view. This is the perfect place to do any setup that is needed for this class.</p>
<div class="box">
<pre>
<span class="ash">override func viewDidLoad() {</span>
<br />
    <span class="ash">super.viewDidLoad()</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">dateFormatter</span>
 .<span class="violet">dateStyle</span>
 = .<span class="blue">full</span>
<br />
  <span class="ent">➋</span>
 <span class="green1">dateFormatter</span>
 .<span class="violet">timeStyle</span>
 = .<span class="blue">none</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , you set the <span class="code">dateStyle</span>
 of the <span class="code">dateFormatter</span>
 so that it will display a formatted date string for each <span class="code">Birthday</span>
 . Did you notice how we just wrote <span class="code">.full</span>
 instead of <span class="code">DateFormatter.Style.full</span>
 ? Swift knows what type to expect for the <span class="code">dateStyle</span>
 of a <span class="code">DateFormatter</span>
 , so it lets us take this little shortcut. At <span class="ent">➋</span>
 , you set the <span class="code">timeStyle</span>
 of the <span class="code">dateFormatter</span>
 to <span class="code">.none</span>
 so that the time won’t be shown.</p>
<h4 class="h4" id="ch11lev2sec4">
<strong>DISPLAYING BIRTHDAYS IN A TABLE VIEW</strong>
</h4>
<p class="noindent">The <span class="code">BirthdaysTableViewController</span>
 class has a table view that is used to display a list of items in a single column. The table view has one or more sections containing rows, and each row contains a cell. A section in a table view is a grouping of rows that can be displayed with or without a header. An example of an app that shows a table view with several sections is the Settings app, as shown in <a href="text00022.html#ch11fig5">Figure 11-5</a>
 . It displays a list of rows that have been broken up into different sections.</p>
<p class="indent">Each section and row of a table view is identified with an index number. These numbers start at 0 and then increase by 1 as you go down the table view. For example, the Privacy line in the Settings app is found at section 0, row 1. The News setting is at section 1, row 3.</p>
<p class="indent">In the middle of the <span class="code">BirthdaysTableViewController</span>
 class, there is a section called <em>Table view data source</em>
 with three methods. The table view controller uses these methods to determine what’s going to be displayed inside its table view.</p>
<p class="hang">
<span class="code">
<span class="codestrong">numberOfSections(in:)</span>
</span>
 Tells the table view how many sections it should have</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:numberOfRowsInSection:)</span>
</span>
 Tells the table view how many rows will be displayed in each section</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:cellForRowAt:)</span>
</span>
 Sets up each cell that’s going to be displayed in each row of the table view</p>
<div class="image"><span id="page_163"></span>
 <img src="Image00243.jpg" />
</div>
<p class="figcap"><a id="ch11fig5"></a>
 <em>Figure 11-5: The Settings app uses sections to group rows of different device settings.</em>
</p>
<p class="indent">The table view data source methods are called by the table view controller every time the table view is reloaded. Xcode automatically gives you these method templates when you make a subclass of a <span class="code">UITableViewController</span>
 . You need to implement all three methods for the app to work, even though you’ll never call them directly in your code. The <span class="code">UITableViewController</span>
 class implements the <span class="code">UITableViewDataSource</span>
 protocol, which comes with these data source methods, to determine what will be displayed inside the table view. We’ll discuss protocols in “<a href="text00022.html#ch11lev2sec5">Delegation</a>
 ” on page 166. For now, you just need to know that a <span class="code">UITableViewController</span>
 uses these methods to display its content, and it automatically calls these methods so you don’t need to call them.</p>
<p class="indent">Let’s start with the method <span class="code">numberOfSections(in:)</span>
 . The Birthdays table view controller is a list that just displays <span class="code">Birthday</span>
 instances, so it doesn’t need multiple sections. To set the number of sections in the table view, we just need to return <span class="code">1</span>
 .</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func numberOfSections(in tableView: UITableView) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 <span class="blue1">1</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent"><span id="page_164"></span>
 This method takes a <span class="code">UITableView</span>
 called <span class="code">tableView</span>
 as a parameter, which is the table view that uses this class as its data source. We don’t need to worry about making this connection because the <span class="code">UITableViewController</span>
 comes with a built-in table view that is automatically hooked up to these methods. Each birthday will be displayed in its own row. So in <span class="code">tableView(_:numberOfRowsInSection:)</span>
 , in order to have the right number of rows for all of your birthdays, you need to return the number of <span class="code">Birthday</span>
 instances that you have in your <span class="code">birthdays</span>
 array. Do you remember the <span class="code">count</span>
 property of an array? It’s an integer that tells you how many items are in that array, and it’s perfect for this situation! Change this method to the following:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, <img class="inline" src="Image00184.jpg" />
<br />
    numberOfRowsInSection section: Int) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 birthdays.<span class="violet">count</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">In addition to the <span class="code">tableView</span>
 parameter, <span class="code">tableView(_:numberOfRowsInSection:)</span>
 also takes an <span class="code">Int</span>
 called <span class="code">section</span>
 . When the table view is loading itself, this method is called for each section in the table view. In our case, we have only one section, so we don’t need to bother checking which <span class="code">section</span>
 of the table view is being displayed here. We know it’s section 0, and we want it to have as many rows as there are birthdays, so we write <span class="code">return birthdays.count</span>
 .</p>
<p class="indent">Finally, you need to implement <span class="code">tableView(_:cellForRowAt:)</span>
 so that the table view will know what to put inside each cell. Since this method is commented out, you need to uncomment it by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it. (Be careful not to accidentally uncomment the other methods after it!) After you’ve done that, change it to the following code:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, cellForRowAt <img class="inline" src="Image00184.jpg" />
<br />
    indexPath: IndexPath) -&gt; UITableViewCell {</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="pink">let</span>
 cell = tableView.<span class="blue">dequeueReusableCell</span>
 (withIdentifier: <img class="inline" src="Image00093.jpg" />
<br />
        <span class="red">"birthdayCellIdentifier"</span>
 , for: indexPath)<br />
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 birthday = <span class="green1">birthdays</span>
 [indexPath.<span class="violet">row</span>
 ]<br />
<br />
  <span class="ent">➌</span>
 cell.<span class="violet">textLabel</span>
 ?.<span class="violet">text</span>
 = birthday.<span class="green1">firstName</span>
 <span class="blue">+</span>
 <span class="red">" "</span>
 <span class="blue">+</span>
 <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">lastName</span>
<br />
<br />
  <span class="ent">➍</span>
 cell.<span class="violet">detailTextLabel</span>
 ?.<span class="violet">text</span>
 = <span class="green1">dateFormatter</span>
 .<span class="blue">string</span>
 (from: <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">birthdate</span>
 )<br />
<br />
  <span class="ent">➎</span>
 <span class="pink">return</span>
 cell<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">You don’t call the method <span class="code">tableView(_:cellForRowAt:)</span>
 . It’s called when the table view is loaded onto the screen. It’s called for each cell on the screen and takes two parameters, <span class="code">tableView</span>
 and <span class="code">indexPath</span>
 . You already know <span id="page_165"></span>
 what the <span class="code">tableView</span>
 parameter is for. An <span class="code">IndexPath</span>
 is a Swift struct that’s used to represent a row’s position in a table view. An <span class="code">IndexPath</span>
 instance has a <span class="code">section</span>
 property and a <span class="code">row</span>
 property. Since this method will be called many times (once for every row in the table), we need the <span class="code">indexPath</span>
 to know which section and row we’re currently configuring. The <span class="code">indexPath.section</span>
 property gives the section number, and the <span class="code">indexPath.row</span>
 gives the row of the table view cell. The five lines of code inside <span class="code">tableView(_:cellForRowAt:)</span>
 will do the following:</p>
<div class="image"><img src="Image00244.jpg" />
</div>
<p class="bull">• Create a <span class="code">UITableViewCell</span>
</p>
<p class="bull">• Figure out which <span class="code">Birthday</span>
 in the <span class="code">birthdays</span>
 array will be displayed inside the cell</p>
<p class="bull">• Make two labels to display the birthday person’s name and birthdate in the cell</p>
<p class="bull">• Return the cell ready for display in the table view</p>
<p class="indentt">Let’s go through this code line by line.</p>
<p class="indent">First, create the <span class="code">UITableViewCell</span>
 . The code at <span class="ent">➊</span>
 does this using the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 . Before you can start using this method on a cell, though, you need to tell the method which cell you want to use from the storyboard. Earlier, when you were in the storyboard, you gave your cell the identifier <span class="code">birthdayCellIdentifier</span>
 (see <a href="text00022.html#ch11fig4">Figure 11-4</a>
 ). This identifier links your code to the cell and tells your method that it’s using the right cell. The string for when you call this method needs to be exactly the same as the string you set in the storyboard, or you’ll get an error and the app will crash when you run it.</p>
<p class="indent">In the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 , did you notice the words <em>Reusable Cell</em>
 ? The cells inside a table view are created once and then can be reused over and over. This helps everything run faster and smoother because creating the cell is what takes the most time. If you had 200 birthdays in your app, but only 10 would fit on your screen at one time, then you need only 10 cells to show your birthdays. When you scroll down to reveal more birthdays, the cells that scroll off the top of the screen are reused. They are filled with new information and show up again at the bottom of the screen. The <span class="code">UITableView</span>
 automatically does this work. When the table view is loaded, <span class="code">tableView(_:cellForRowAt:)</span>
 is called for every visible row. When the user scrolls to look at more cells, it’s called again for each row just as it is about to appear on the screen.</p>
<p class="indent">Next, we need to find out which <span class="code">Birthday</span>
 should be displayed inside the cell. We want to display one birthday from the <span class="code">birthdays</span>
 array in each row. The first birthday, which is at <span class="code">birthdays[0]</span>
 , should be displayed in row 0. The second birthday, at <span class="code">birthdays[1]</span>
 , should be displayed in row 1, and so on, which means the <span class="code">indexPath</span>
 ’s <span class="code">row</span>
 is the same as the position in the <span class="code">birthdays</span>
 array that we want to access. The code at <span class="ent">➋</span>
 accesses the <span id="page_166"></span>
 correct <span class="code">Birthday</span>
 object from the <span class="code">birthdays</span>
 array by using <span class="code">indexPath.row</span>
 . Once we have the right <span class="code">Birthday</span>
 object, we assign it to a constant named <span class="code">birthday</span>
 so we can set up the labels in this cell.</p>
<p class="indent">Notice that we’re using <span class="code">let</span>
 to assign the <span class="code">birthday</span>
 to a constant instead of a variable. We can use <span class="code">let</span>
 because each time <span class="code">tableView(_:cellForRowAt:)</span>
 is called, a new <span class="code">birthday</span>
 constant is created. Each cell gets its own <span class="code">birthday</span>
 constant that is assigned its own <span class="code">Birthday</span>
 object. Since we’re not going to change any of the <span class="code">birthday</span>
 constants—we’re just going to read their properties—we don’t want to make them variables.</p>
<p class="indent">Now that you have your cell and your birthday, it’s time to fill in the details. You need two labels for each cell to show the birthday person’s name and birthdate. You set the cell to the Subtitle style so that it has a Title label and a Subtitle label. Each cell will already contain these labels, so now you don’t have to create any labels yourself.</p>
<p class="indent">The labels exist as properties of <span class="code">UITableViewCell</span>
 and are called <span class="code">textLabel</span>
 and <span class="code">detailTextLabel</span>
 . The code at <span class="ent">➌</span>
 sets the text of the <span class="code">textLabel</span>
 to a string made up of the <span class="code">firstName</span>
 and <span class="code">lastName</span>
 of the <span class="code">birthday</span>
 with a space between them. At <span class="ent">➍</span>
 , you use the <span class="code">string(from:)</span>
 method of the <span class="code">dateFormatter</span>
 to display the birthdate in the <span class="code">detailTextLabel</span>
 .</p>
<p class="indent">When your cell is completely configured, <span class="code">tableView( _:cellForRowAt:)</span>
 returns the cell at <span class="ent">➎</span>
 so that it can be displayed at that <span class="code">indexPath</span>
 of the table view.</p>
<h3 class="h3" id="ch11lev1sec2">
<strong>PUTTING IT ALL TOGETHER</strong>
</h3>
<p class="noindent">Now you can add <span class="code">Birthday</span>
 instances to the app using the Add Birthday view controller, and you have a table view to list each <span class="code">Birthday</span>
 in the Birthdays table view controller. But when you try running the app and adding a <span class="code">Birthday</span>
 , it doesn’t appear. To make each <span class="code">Birthday</span>
 you add appear in the table view, you need to make the Add Birthday view controller communicate with the Birthdays table view controller. You do this by using <em>delegation</em>
 .</p>
<h4 class="h4" id="ch11lev2sec5">
<strong>DELEGATION</strong>
</h4>
<p class="noindent">Delegation can be used when one view controller needs to get information from another view controller. Say you have two view controllers: A and B. The first view controller, A, creates B and presents B on top of itself. A knows about B because it created and presented B, so A can pass information along to B. But B doesn’t know about A—it’s just popped into being and doesn’t know where it came from or how it got there. So how can B talk to A? Through delegation!</p>
<div class="image"><img src="Image00245.jpg" />
</div>
<p class="indent">Delegation is when someone gives a job or a task to someone else. A <em>delegate</em>
 is like a boss who tells a delegating employee what to do. When the delegating employee is done with their task, sometimes they’ll report information back to the delegate boss.</p>
<p class="indent"><span id="page_167"></span>
 Delegation in Swift is pretty similar, but instead of having a boss and employee, we have a delegate and a delegating object. Since class B is the one being told what to do by class A, it’s the delegating object. We give class B a special property called a delegate to tell it who its delegate is—that way, it knows who to communicate with. The delegate can be any class that has a set of methods that have been defined in a <em>protocol</em>
 . A protocol is like an agreement between the two classes that tells them what the delegate can ask the delegating object to do. It has a list of method and property names that the delegate can use with the delegating object.</p>
<p class="indent">Class A creates class B, makes itself the delegate of class B, and gives class B a job to do that’s in the protocol. Once class B is done with its job, it reports back to class A. Let’s see how this works in our app.</p>
<p class="indent">The Birthdays table view controller is view controller A, and the Add Birthday view controller is view controller B. We’ll create a protocol called <span class="code">AddBirthdayViewControllerDelegate</span>
 and a method for that protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 , which the Add Birthday view controller will use to report back.</p>
<p class="indent">Take a look at <a href="text00022.html#ch11fig6">Figure 11-6</a>
 . When the user taps the Add button <span class="ent">➊</span>
 , the Birthdays table view controller creates the Add Birthday view controller <span class="ent">➋</span>
 and sets itself as the Add Birthday view controller’s delegate.</p>
<div class="image"><img src="Image00246.jpg" />
</div>
<p class="figcap"><a id="ch11fig6"></a>
 <em>Figure 11-6: A new birthday is added and passed from the Add Birthday view controller to the Birthdays table view controller using delegation.</em>
</p>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="indent">When you choose this option, you’ll see a second dialog where you can name your new class and specify which class you’ll subclass. First, in the Subclass field (the second field in the dialog), type <span class="code">
<span class="codestrong">UITableViewController</span>
</span>
 . This will automatically fill in the class field with the subclass name. Once that happens, type <span class="code">
<span class="codestrong">Birthdays</span>
</span>
 in front of <span class="code">TableViewController</span>
 so that the whole class name is <span class="code">BirthdaysTableViewController</span>
 . This is a shortcut so you don’t <span id="page_157"></span>
 have to type as much. Make sure to choose <strong>Swift</strong>
 in the Language drop-down menu as well, and then click <strong>Next</strong>
 . Then select <strong>Create</strong>
 in the final dialog to create your new file.</p>
<p class="indent">In <em>BirthdaysTableViewController.swift</em>
 , Xcode has provided a template with several commented-out methods. You can clean up the code by getting rid of methods we won’t use. Delete just the comments in <span class="code">viewDidLoad()</span>
 , and then delete the entire <span class="code">didReceiveMemoryWarning()</span>
 method and the methods <span class="code">tableView(_:moveRowAt:to:)</span>
 and <span class="code">tableView(_:canMoveRowAt:)</span>
 , which have to do with moving rows in the table view. When you’re finished, the contents of <span class="code">BirthdaysTableViewController</span>
 should look like <a href="text00022.html#ch11fig2">Figure 11-2</a>
 . There are still several commented-out methods, but we’re keeping those to use later!</p>
<div class="image"><img src="Image00235.jpg" />
</div>
<p class="figcap"><a id="ch11fig2"></a>
 <em>Figure 11-2: The</em>
 <span class="code">
<span class="italic">BirthdaysTableViewController</span>
</span>
 <em>cleaned up!</em>
</p>
<p class="indent">Next, you need to make the Birthdays table view controller the <span class="code">BirthdaysTableViewController</span>
 class. To do this, go to <em>Main.storyboard</em>
 and select the <strong>Birthdays</strong>
 scene. Using the Identity Inspector in the right pane, change the class from <span class="code">UITableViewController</span>
 to <span class="code">BirthdaysTableViewController</span>
 , as shown in <a href="text00022.html#ch11fig3">Figure 11-3</a>
 .</p>
<div class="image"><span id="page_158"></span>
 <img src="Image00236.jpg" />
</div>
<p class="figcap"><a id="ch11fig3"></a>
 <em>Figure 11-3: Setting</em>
 <span class="code">
<span class="italic">BirthdaysTableViewController</span>
</span>
 <em>as the class of the Birthdays scene</em>
</p>
<p class="indent">Now that you have the Birthdays table view controller set up in the storyboard, the next step is to make cells in your table that will display each birthday.</p>
<h4 class="h4" id="ch11lev2sec2">
<strong>ADDING CELLS TO THE TABLE VIEW</strong>
</h4>
<p class="noindent">Each birthday will be displayed in a <span class="code">UITableViewCell</span>
 in the Birthdays table view controller. A table has boxes organized into rows and columns that contain information. These boxes are called <em>cells</em>
 . Similarly, a table view also has cells that are all instances of, or a subclass of, the <span class="code">UITableViewCell</span>
 class. We’ll put each birthday into its own cell in our table view.</p>
<p class="indent">We’ll start by creating those cells in the storyboard, and then we’ll fill them with our <span class="code">Birthday</span>
 objects later. In the left outline menu, click the triangle by Birthdays and then click the triangle by Table View to open those sections. Then select <strong>Table View Cell</strong>
 <span class="ent">➊</span>
 , as shown in <a href="text00022.html#ch11fig4">Figure 11-4</a>
 .</p>
<div class="image"><img src="Image00237.jpg" />
</div>
<div class="image"><img src="Image00238.jpg" />
</div>
<p class="figcap"><a id="ch11fig4"></a>
 <em>Figure 11-4: Creating a Subtitle style table view cell and setting its identifier</em>
</p>
<p class="indent"><span id="page_159"></span>
 Next, open the Attributes Inspector. Using the drop-down menu under <strong>Style</strong>
 , set the cell’s style to <strong>Subtitle</strong>
 <span class="ent">➋</span>
 so that the cell now has a Title label and a Subtitle label. You’ll display each person’s name in the Title and birthday in the Subtitle.</p>
<p class="indent">Finally, enter <span class="code">
<span class="codestrong">birthdayCellIdentifier</span>
</span>
 in the Identifier field <span class="ent">➌</span>
 . You’ll use this identifier later when you fill in the cell contents.</p>
<p class="indent">That’s it! You’ve finished your work in the storyboard.</p>
<p class="indent">You may be wondering why we have just one cell in our table view in the storyboard when we’ll have more than one birthday to show in the list. If you look at <a href="text00022.html#ch11fig4">Figure 11-4</a>
 again, you’ll notice that the cell is labeled <em>Prototype Cells</em>
 . This means that the cell you just customized is a <em>template</em>
 for all the cells you want to appear in your table view. The identifier you gave the cell is how your code will tell the table view to produce each cell for you to put birthdays in. You’ll see how this works soon.</p>
<div class="box1">
<p class="box-title">
<strong>WORKING WITH DATES</strong>
</p>
<p class="box-p">Swift has a special data type called <span class="code">Date</span>
 that is used for storing date values. A <span class="code">Date</span>
 object is actually a date and a time. Open your playground and enter the following:</p>
<div class="image"><img src="Image00239.jpg" />
</div>
<p class="box-pi">We’ve just assigned the current date and time the code was run to the variable <span class="code">today</span>
 . When you print <span class="code">today</span>
 , it’s in the format <span class="code">"2017-11-21 10:45:31 +0000\n"</span>
 . What if you wanted it to display as <span class="code">Tuesday, November 21, 2017</span>
 , instead? Or just <span class="code">11/21/17</span>
 ? To display a date in a particular way, you use a <em>date formatter</em>
 , which is a <span class="code">DateFormatter</span>
 object that you create and give a date format style. <span class="code">DateFormatter</span>
 is a helper object that is used to create a display string from any date, and a <em>date format style</em>
 is a property of <span class="code">DateFormatter</span>
 that tells the formatter what style to use. You can create your own date format styles manually, but there are also styles that are included in Swift and ready to use. Add the following to your playground:</p>
<div class="image"><img src="Image00240.jpg" />
</div>
<p class="box-pi">At <span class="ent">➊</span>
 you create a <span class="code">formatter</span>
 . Then at <span class="ent">➋</span>
 , you set the style of the <span class="code">formatter</span>
 to <span class="code">Style.full</span>
 , which will print the day of the week as well as the full month name, date, and year. Finally, you create a string from the date using the <span class="code">string(from:)</span>
 method of the <span class="code">DateFormatter</span>
 class <span class="ent">➌</span>
 . You can see that you now have turned the <span id="page_160"></span>
 date into the nicely formatted string <span class="code">"Tuesday, November 21, 2017"</span>
 . <a style=";color:black;" href="text00022.html#ch11tab1">Table 11-1</a>
 shows the different strings that are created from the five <span class="code">DateFormatter.Style</span>
 options available in Swift.</p>
<p class="tabcap"><a id="ch11tab1" style=";color:black;"></a>
 <strong>Table 11-1:</strong>
 Date Formatter Styles and Their Date Strings</p>
<table class="tabled">
<tbody>
<tr>
<td style="vertical-align: top;" class="border1">
<p class="noindent">
<span class="code">
<span class="codestrong">DateFormatter.Style</span>
</span>
</p>
</td>
<td style="vertical-align: top;" class="border1">
<p class="noindent">
<strong>Date string</strong>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">none</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">""</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">short</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"11/21/17"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">medium</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"Nov 21, 2017"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">long</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"November 21, 2017"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">full</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"Tuesday, November 21, 2017"</span>
</p>
</td>
</tr>
</tbody>
</table>
<p class="box-pi">You can also specify your own custom way of displaying a date using the <span class="code">dateFormat</span>
 property of the <span class="code">DateFormatter</span>
 . Perhaps you only want the month and day. Or maybe you want a four-digit year displayed in the <span class="code">short</span>
 style. Doing either is really easy, and you don’t even have to create a new <span class="code">DateFormatter</span>
 —you can just change the <span class="code">dateFormat</span>
 on <span class="code">formatter</span>
 and then ask it for a new string. Add the following code to your playground to display dates with a specific format:</p>
<div class="image"><img src="Image00241.jpg" />
</div>
<p class="box-pi">At <span class="ent">➊</span>
 , you specify that you only want the month and the date in an <span class="code">MM/dd</span>
 format—that is, a two-digit month followed by a two-digit date. If you want to display the month as three letters, then use <span class="code">MMM</span>
 . To display the full name of the month, use <span class="code">MMMM</span>
 . At <span class="ent">➋</span>
 , we change the date format to use a four-digit year. A two-digit year would be <span class="code">yy</span>
 . Here are a few other ways to use a <span class="code">dateFormat</span>
 to display a custom date string.</p>
<div class="image"><img src="Image00242.jpg" />
</div>
<p class="box-pi"><span id="page_161"></span>
 If you want to include separators, you add them to your <span class="code">dateFormat</span>
 string. For example, if you want periods as separators, then you can create a <span class="code">dateFormat</span>
 like <span class="code">"MM.dd.yy"</span>
 <span class="ent">➊</span>
 . To display an abbreviated day of the week, use <span class="code">EEE</span>
 <span class="ent">➋</span>
 . For the full day, use <span class="code">EEEE</span>
 <span class="ent">➌</span>
 . These are only a few examples. By using combinations of <span class="code">M</span>
 , <span class="code">d</span>
 , <span class="code">y</span>
 , and <span class="code">E</span>
 , you have an endless number of ways to display a date!</p>
</div>
<h4 class="h4" id="ch11lev2sec3">
<strong>SETTING UP THE BIRTHDAYS TABLE VIEW CONTROLLER</strong>
</h4>
<p class="noindent">The Birthdays table view controller will display a list of all the birthdays stored in the app. Do you remember what you use to store a list of items? That’s right—an array! You’ll create an array in the <span class="code">BirthdaysTableViewController</span>
 to store all the birthdays. To do this, give the <span class="code">BirthdaysTableViewController</span>
 a <span class="code">birthdays</span>
 property that is an array of <span class="code">Birthday</span>
 objects. At the top of the class, right above the <span class="code">viewDidLoad()</span>
 method, insert this line to add a variable array property called <span class="code">birthdays</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController {</span>
<br />
<br />
    <span class="pink">var</span>
 birthdays = [<span class="green1">Birthday</span>
 ]()<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent">This line creates an empty array of <span class="code">Birthday</span>
 instances. It needs to be a variable and not a constant because you’ll want to add a saved <span class="code">Birthday</span>
 to this array every time the user adds a <span class="code">Birthday</span>
 with the Add Birthday view controller. You’ll see how to do that in “<a href="text00022.html#ch11lev3sec2">Making the Birthdays Table View Controller Conform to Protocol</a>
 ” on <a href="text00022.html#page_168">page 168</a>
 .</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>Remember that the final versions of the project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>.</em>
</p>
</div>
<p class="indent">The <span class="code">BirthdaysTableViewController</span>
 will also need a <span class="code">dateFormatter</span>
 property to display the birthdate as a nicely formatted string. Add a <span class="code">dateFormatter</span>
 right underneath the <span class="code">birthdays</span>
 array:</p>
<div class="box">
<pre>    <span class="ash">var birthdays = [Birthday]()</span>
<br />
<br />
    <span class="pink">let</span>
 dateFormatter = <span class="violet">DateFormatter</span>
 ()<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent">Note that the <span class="code">dateFormatter</span>
 is a constant that is created with <span class="code">let</span>
 . Even though you’ll change the <span class="code">dateFormatter</span>
 ’s properties, like the <span class="code">dateStyle</span>
 and <span class="code">timeStyle</span>
 , you’ll never change the <span class="code">dateFormatter</span>
 itself.</p>
<p class="indent"><span id="page_162"></span>
 You’ll also need to set up the <span class="code">dateFormatter</span>
 so that it will display the birthdates as fully formatted strings like <span class="code">"Tuesday, December 17, 2008"</span>
 . As you saw in <a href="text00021.html#ch10">Chapter 10</a>
 , a good place to do this is the <span class="code">viewDidLoad()</span>
 method, which is called when the Birthdays table view controller is loading its view. This is the perfect place to do any setup that is needed for this class.</p>
<div class="box">
<pre>
<span class="ash">override func viewDidLoad() {</span>
<br />
    <span class="ash">super.viewDidLoad()</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">dateFormatter</span>
 .<span class="violet">dateStyle</span>
 = .<span class="blue">full</span>
<br />
  <span class="ent">➋</span>
 <span class="green1">dateFormatter</span>
 .<span class="violet">timeStyle</span>
 = .<span class="blue">none</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , you set the <span class="code">dateStyle</span>
 of the <span class="code">dateFormatter</span>
 so that it will display a formatted date string for each <span class="code">Birthday</span>
 . Did you notice how we just wrote <span class="code">.full</span>
 instead of <span class="code">DateFormatter.Style.full</span>
 ? Swift knows what type to expect for the <span class="code">dateStyle</span>
 of a <span class="code">DateFormatter</span>
 , so it lets us take this little shortcut. At <span class="ent">➋</span>
 , you set the <span class="code">timeStyle</span>
 of the <span class="code">dateFormatter</span>
 to <span class="code">.none</span>
 so that the time won’t be shown.</p>
<h4 class="h4" id="ch11lev2sec4">
<strong>DISPLAYING BIRTHDAYS IN A TABLE VIEW</strong>
</h4>
<p class="noindent">The <span class="code">BirthdaysTableViewController</span>
 class has a table view that is used to display a list of items in a single column. The table view has one or more sections containing rows, and each row contains a cell. A section in a table view is a grouping of rows that can be displayed with or without a header. An example of an app that shows a table view with several sections is the Settings app, as shown in <a href="text00022.html#ch11fig5">Figure 11-5</a>
 . It displays a list of rows that have been broken up into different sections.</p>
<p class="indent">Each section and row of a table view is identified with an index number. These numbers start at 0 and then increase by 1 as you go down the table view. For example, the Privacy line in the Settings app is found at section 0, row 1. The News setting is at section 1, row 3.</p>
<p class="indent">In the middle of the <span class="code">BirthdaysTableViewController</span>
 class, there is a section called <em>Table view data source</em>
 with three methods. The table view controller uses these methods to determine what’s going to be displayed inside its table view.</p>
<p class="hang">
<span class="code">
<span class="codestrong">numberOfSections(in:)</span>
</span>
 Tells the table view how many sections it should have</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:numberOfRowsInSection:)</span>
</span>
 Tells the table view how many rows will be displayed in each section</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:cellForRowAt:)</span>
</span>
 Sets up each cell that’s going to be displayed in each row of the table view</p>
<div class="image"><span id="page_163"></span>
 <img src="Image00243.jpg" />
</div>
<p class="figcap"><a id="ch11fig5"></a>
 <em>Figure 11-5: The Settings app uses sections to group rows of different device settings.</em>
</p>
<p class="indent">The table view data source methods are called by the table view controller every time the table view is reloaded. Xcode automatically gives you these method templates when you make a subclass of a <span class="code">UITableViewController</span>
 . You need to implement all three methods for the app to work, even though you’ll never call them directly in your code. The <span class="code">UITableViewController</span>
 class implements the <span class="code">UITableViewDataSource</span>
 protocol, which comes with these data source methods, to determine what will be displayed inside the table view. We’ll discuss protocols in “<a href="text00022.html#ch11lev2sec5">Delegation</a>
 ” on page 166. For now, you just need to know that a <span class="code">UITableViewController</span>
 uses these methods to display its content, and it automatically calls these methods so you don’t need to call them.</p>
<p class="indent">Let’s start with the method <span class="code">numberOfSections(in:)</span>
 . The Birthdays table view controller is a list that just displays <span class="code">Birthday</span>
 instances, so it doesn’t need multiple sections. To set the number of sections in the table view, we just need to return <span class="code">1</span>
 .</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func numberOfSections(in tableView: UITableView) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 <span class="blue1">1</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent"><span id="page_164"></span>
 This method takes a <span class="code">UITableView</span>
 called <span class="code">tableView</span>
 as a parameter, which is the table view that uses this class as its data source. We don’t need to worry about making this connection because the <span class="code">UITableViewController</span>
 comes with a built-in table view that is automatically hooked up to these methods. Each birthday will be displayed in its own row. So in <span class="code">tableView(_:numberOfRowsInSection:)</span>
 , in order to have the right number of rows for all of your birthdays, you need to return the number of <span class="code">Birthday</span>
 instances that you have in your <span class="code">birthdays</span>
 array. Do you remember the <span class="code">count</span>
 property of an array? It’s an integer that tells you how many items are in that array, and it’s perfect for this situation! Change this method to the following:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, <img class="inline" src="Image00184.jpg" />
<br />
    numberOfRowsInSection section: Int) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 birthdays.<span class="violet">count</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">In addition to the <span class="code">tableView</span>
 parameter, <span class="code">tableView(_:numberOfRowsInSection:)</span>
 also takes an <span class="code">Int</span>
 called <span class="code">section</span>
 . When the table view is loading itself, this method is called for each section in the table view. In our case, we have only one section, so we don’t need to bother checking which <span class="code">section</span>
 of the table view is being displayed here. We know it’s section 0, and we want it to have as many rows as there are birthdays, so we write <span class="code">return birthdays.count</span>
 .</p>
<p class="indent">Finally, you need to implement <span class="code">tableView(_:cellForRowAt:)</span>
 so that the table view will know what to put inside each cell. Since this method is commented out, you need to uncomment it by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it. (Be careful not to accidentally uncomment the other methods after it!) After you’ve done that, change it to the following code:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, cellForRowAt <img class="inline" src="Image00184.jpg" />
<br />
    indexPath: IndexPath) -&gt; UITableViewCell {</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="pink">let</span>
 cell = tableView.<span class="blue">dequeueReusableCell</span>
 (withIdentifier: <img class="inline" src="Image00093.jpg" />
<br />
        <span class="red">"birthdayCellIdentifier"</span>
 , for: indexPath)<br />
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 birthday = <span class="green1">birthdays</span>
 [indexPath.<span class="violet">row</span>
 ]<br />
<br />
  <span class="ent">➌</span>
 cell.<span class="violet">textLabel</span>
 ?.<span class="violet">text</span>
 = birthday.<span class="green1">firstName</span>
 <span class="blue">+</span>
 <span class="red">" "</span>
 <span class="blue">+</span>
 <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">lastName</span>
<br />
<br />
  <span class="ent">➍</span>
 cell.<span class="violet">detailTextLabel</span>
 ?.<span class="violet">text</span>
 = <span class="green1">dateFormatter</span>
 .<span class="blue">string</span>
 (from: <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">birthdate</span>
 )<br />
<br />
  <span class="ent">➎</span>
 <span class="pink">return</span>
 cell<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">You don’t call the method <span class="code">tableView(_:cellForRowAt:)</span>
 . It’s called when the table view is loaded onto the screen. It’s called for each cell on the screen and takes two parameters, <span class="code">tableView</span>
 and <span class="code">indexPath</span>
 . You already know <span id="page_165"></span>
 what the <span class="code">tableView</span>
 parameter is for. An <span class="code">IndexPath</span>
 is a Swift struct that’s used to represent a row’s position in a table view. An <span class="code">IndexPath</span>
 instance has a <span class="code">section</span>
 property and a <span class="code">row</span>
 property. Since this method will be called many times (once for every row in the table), we need the <span class="code">indexPath</span>
 to know which section and row we’re currently configuring. The <span class="code">indexPath.section</span>
 property gives the section number, and the <span class="code">indexPath.row</span>
 gives the row of the table view cell. The five lines of code inside <span class="code">tableView(_:cellForRowAt:)</span>
 will do the following:</p>
<div class="image"><img src="Image00244.jpg" />
</div>
<p class="bull">• Create a <span class="code">UITableViewCell</span>
</p>
<p class="bull">• Figure out which <span class="code">Birthday</span>
 in the <span class="code">birthdays</span>
 array will be displayed inside the cell</p>
<p class="bull">• Make two labels to display the birthday person’s name and birthdate in the cell</p>
<p class="bull">• Return the cell ready for display in the table view</p>
<p class="indentt">Let’s go through this code line by line.</p>
<p class="indent">First, create the <span class="code">UITableViewCell</span>
 . The code at <span class="ent">➊</span>
 does this using the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 . Before you can start using this method on a cell, though, you need to tell the method which cell you want to use from the storyboard. Earlier, when you were in the storyboard, you gave your cell the identifier <span class="code">birthdayCellIdentifier</span>
 (see <a href="text00022.html#ch11fig4">Figure 11-4</a>
 ). This identifier links your code to the cell and tells your method that it’s using the right cell. The string for when you call this method needs to be exactly the same as the string you set in the storyboard, or you’ll get an error and the app will crash when you run it.</p>
<p class="indent">In the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 , did you notice the words <em>Reusable Cell</em>
 ? The cells inside a table view are created once and then can be reused over and over. This helps everything run faster and smoother because creating the cell is what takes the most time. If you had 200 birthdays in your app, but only 10 would fit on your screen at one time, then you need only 10 cells to show your birthdays. When you scroll down to reveal more birthdays, the cells that scroll off the top of the screen are reused. They are filled with new information and show up again at the bottom of the screen. The <span class="code">UITableView</span>
 automatically does this work. When the table view is loaded, <span class="code">tableView(_:cellForRowAt:)</span>
 is called for every visible row. When the user scrolls to look at more cells, it’s called again for each row just as it is about to appear on the screen.</p>
<p class="indent">Next, we need to find out which <span class="code">Birthday</span>
 should be displayed inside the cell. We want to display one birthday from the <span class="code">birthdays</span>
 array in each row. The first birthday, which is at <span class="code">birthdays[0]</span>
 , should be displayed in row 0. The second birthday, at <span class="code">birthdays[1]</span>
 , should be displayed in row 1, and so on, which means the <span class="code">indexPath</span>
 ’s <span class="code">row</span>
 is the same as the position in the <span class="code">birthdays</span>
 array that we want to access. The code at <span class="ent">➋</span>
 accesses the <span id="page_166"></span>
 correct <span class="code">Birthday</span>
 object from the <span class="code">birthdays</span>
 array by using <span class="code">indexPath.row</span>
 . Once we have the right <span class="code">Birthday</span>
 object, we assign it to a constant named <span class="code">birthday</span>
 so we can set up the labels in this cell.</p>
<p class="indent">Notice that we’re using <span class="code">let</span>
 to assign the <span class="code">birthday</span>
 to a constant instead of a variable. We can use <span class="code">let</span>
 because each time <span class="code">tableView(_:cellForRowAt:)</span>
 is called, a new <span class="code">birthday</span>
 constant is created. Each cell gets its own <span class="code">birthday</span>
 constant that is assigned its own <span class="code">Birthday</span>
 object. Since we’re not going to change any of the <span class="code">birthday</span>
 constants—we’re just going to read their properties—we don’t want to make them variables.</p>
<p class="indent">Now that you have your cell and your birthday, it’s time to fill in the details. You need two labels for each cell to show the birthday person’s name and birthdate. You set the cell to the Subtitle style so that it has a Title label and a Subtitle label. Each cell will already contain these labels, so now you don’t have to create any labels yourself.</p>
<p class="indent">The labels exist as properties of <span class="code">UITableViewCell</span>
 and are called <span class="code">textLabel</span>
 and <span class="code">detailTextLabel</span>
 . The code at <span class="ent">➌</span>
 sets the text of the <span class="code">textLabel</span>
 to a string made up of the <span class="code">firstName</span>
 and <span class="code">lastName</span>
 of the <span class="code">birthday</span>
 with a space between them. At <span class="ent">➍</span>
 , you use the <span class="code">string(from:)</span>
 method of the <span class="code">dateFormatter</span>
 to display the birthdate in the <span class="code">detailTextLabel</span>
 .</p>
<p class="indent">When your cell is completely configured, <span class="code">tableView( _:cellForRowAt:)</span>
 returns the cell at <span class="ent">➎</span>
 so that it can be displayed at that <span class="code">indexPath</span>
 of the table view.</p>
<h3 class="h3" id="ch11lev1sec2">
<strong>PUTTING IT ALL TOGETHER</strong>
</h3>
<p class="noindent">Now you can add <span class="code">Birthday</span>
 instances to the app using the Add Birthday view controller, and you have a table view to list each <span class="code">Birthday</span>
 in the Birthdays table view controller. But when you try running the app and adding a <span class="code">Birthday</span>
 , it doesn’t appear. To make each <span class="code">Birthday</span>
 you add appear in the table view, you need to make the Add Birthday view controller communicate with the Birthdays table view controller. You do this by using <em>delegation</em>
 .</p>
<h4 class="h4" id="ch11lev2sec5">
<strong>DELEGATION</strong>
</h4>
<p class="noindent">Delegation can be used when one view controller needs to get information from another view controller. Say you have two view controllers: A and B. The first view controller, A, creates B and presents B on top of itself. A knows about B because it created and presented B, so A can pass information along to B. But B doesn’t know about A—it’s just popped into being and doesn’t know where it came from or how it got there. So how can B talk to A? Through delegation!</p>
<div class="image"><img src="Image00245.jpg" />
</div>
<p class="indent">Delegation is when someone gives a job or a task to someone else. A <em>delegate</em>
 is like a boss who tells a delegating employee what to do. When the delegating employee is done with their task, sometimes they’ll report information back to the delegate boss.</p>
<p class="indent"><span id="page_167"></span>
 Delegation in Swift is pretty similar, but instead of having a boss and employee, we have a delegate and a delegating object. Since class B is the one being told what to do by class A, it’s the delegating object. We give class B a special property called a delegate to tell it who its delegate is—that way, it knows who to communicate with. The delegate can be any class that has a set of methods that have been defined in a <em>protocol</em>
 . A protocol is like an agreement between the two classes that tells them what the delegate can ask the delegating object to do. It has a list of method and property names that the delegate can use with the delegating object.</p>
<p class="indent">Class A creates class B, makes itself the delegate of class B, and gives class B a job to do that’s in the protocol. Once class B is done with its job, it reports back to class A. Let’s see how this works in our app.</p>
<p class="indent">The Birthdays table view controller is view controller A, and the Add Birthday view controller is view controller B. We’ll create a protocol called <span class="code">AddBirthdayViewControllerDelegate</span>
 and a method for that protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 , which the Add Birthday view controller will use to report back.</p>
<p class="indent">Take a look at <a href="text00022.html#ch11fig6">Figure 11-6</a>
 . When the user taps the Add button <span class="ent">➊</span>
 , the Birthdays table view controller creates the Add Birthday view controller <span class="ent">➋</span>
 and sets itself as the Add Birthday view controller’s delegate.</p>
<div class="image"><img src="Image00246.jpg" />
</div>
<p class="figcap"><a id="ch11fig6"></a>
 <em>Figure 11-6: A new birthday is added and passed from the Add Birthday view controller to the Birthdays table view controller using delegation.</em>
</p>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="indent">In <em>BirthdaysTableViewController.swift</em>
 , Xcode has provided a template with several commented-out methods. You can clean up the code by getting rid of methods we won’t use. Delete just the comments in <span class="code">viewDidLoad()</span>
 , and then delete the entire <span class="code">didReceiveMemoryWarning()</span>
 method and the methods <span class="code">tableView(_:moveRowAt:to:)</span>
 and <span class="code">tableView(_:canMoveRowAt:)</span>
 , which have to do with moving rows in the table view. When you’re finished, the contents of <span class="code">BirthdaysTableViewController</span>
 should look like <a href="text00022.html#ch11fig2">Figure 11-2</a>
 . There are still several commented-out methods, but we’re keeping those to use later!</p>
<div class="image"><img src="Image00235.jpg" />
</div>
<p class="figcap"><a id="ch11fig2"></a>
 <em>Figure 11-2: The</em>
 <span class="code">
<span class="italic">BirthdaysTableViewController</span>
</span>
 <em>cleaned up!</em>
</p>
<p class="indent">Next, you need to make the Birthdays table view controller the <span class="code">BirthdaysTableViewController</span>
 class. To do this, go to <em>Main.storyboard</em>
 and select the <strong>Birthdays</strong>
 scene. Using the Identity Inspector in the right pane, change the class from <span class="code">UITableViewController</span>
 to <span class="code">BirthdaysTableViewController</span>
 , as shown in <a href="text00022.html#ch11fig3">Figure 11-3</a>
 .</p>
<div class="image"><span id="page_158"></span>
 <img src="Image00236.jpg" />
</div>
<p class="figcap"><a id="ch11fig3"></a>
 <em>Figure 11-3: Setting</em>
 <span class="code">
<span class="italic">BirthdaysTableViewController</span>
</span>
 <em>as the class of the Birthdays scene</em>
</p>
<p class="indent">Now that you have the Birthdays table view controller set up in the storyboard, the next step is to make cells in your table that will display each birthday.</p>
<h4 class="h4" id="ch11lev2sec2">
<strong>ADDING CELLS TO THE TABLE VIEW</strong>
</h4>
<p class="noindent">Each birthday will be displayed in a <span class="code">UITableViewCell</span>
 in the Birthdays table view controller. A table has boxes organized into rows and columns that contain information. These boxes are called <em>cells</em>
 . Similarly, a table view also has cells that are all instances of, or a subclass of, the <span class="code">UITableViewCell</span>
 class. We’ll put each birthday into its own cell in our table view.</p>
<p class="indent">We’ll start by creating those cells in the storyboard, and then we’ll fill them with our <span class="code">Birthday</span>
 objects later. In the left outline menu, click the triangle by Birthdays and then click the triangle by Table View to open those sections. Then select <strong>Table View Cell</strong>
 <span class="ent">➊</span>
 , as shown in <a href="text00022.html#ch11fig4">Figure 11-4</a>
 .</p>
<div class="image"><img src="Image00237.jpg" />
</div>
<div class="image"><img src="Image00238.jpg" />
</div>
<p class="figcap"><a id="ch11fig4"></a>
 <em>Figure 11-4: Creating a Subtitle style table view cell and setting its identifier</em>
</p>
<p class="indent"><span id="page_159"></span>
 Next, open the Attributes Inspector. Using the drop-down menu under <strong>Style</strong>
 , set the cell’s style to <strong>Subtitle</strong>
 <span class="ent">➋</span>
 so that the cell now has a Title label and a Subtitle label. You’ll display each person’s name in the Title and birthday in the Subtitle.</p>
<p class="indent">Finally, enter <span class="code">
<span class="codestrong">birthdayCellIdentifier</span>
</span>
 in the Identifier field <span class="ent">➌</span>
 . You’ll use this identifier later when you fill in the cell contents.</p>
<p class="indent">That’s it! You’ve finished your work in the storyboard.</p>
<p class="indent">You may be wondering why we have just one cell in our table view in the storyboard when we’ll have more than one birthday to show in the list. If you look at <a href="text00022.html#ch11fig4">Figure 11-4</a>
 again, you’ll notice that the cell is labeled <em>Prototype Cells</em>
 . This means that the cell you just customized is a <em>template</em>
 for all the cells you want to appear in your table view. The identifier you gave the cell is how your code will tell the table view to produce each cell for you to put birthdays in. You’ll see how this works soon.</p>
<div class="box1">
<p class="box-title">
<strong>WORKING WITH DATES</strong>
</p>
<p class="box-p">Swift has a special data type called <span class="code">Date</span>
 that is used for storing date values. A <span class="code">Date</span>
 object is actually a date and a time. Open your playground and enter the following:</p>
<div class="image"><img src="Image00239.jpg" />
</div>
<p class="box-pi">We’ve just assigned the current date and time the code was run to the variable <span class="code">today</span>
 . When you print <span class="code">today</span>
 , it’s in the format <span class="code">"2017-11-21 10:45:31 +0000\n"</span>
 . What if you wanted it to display as <span class="code">Tuesday, November 21, 2017</span>
 , instead? Or just <span class="code">11/21/17</span>
 ? To display a date in a particular way, you use a <em>date formatter</em>
 , which is a <span class="code">DateFormatter</span>
 object that you create and give a date format style. <span class="code">DateFormatter</span>
 is a helper object that is used to create a display string from any date, and a <em>date format style</em>
 is a property of <span class="code">DateFormatter</span>
 that tells the formatter what style to use. You can create your own date format styles manually, but there are also styles that are included in Swift and ready to use. Add the following to your playground:</p>
<div class="image"><img src="Image00240.jpg" />
</div>
<p class="box-pi">At <span class="ent">➊</span>
 you create a <span class="code">formatter</span>
 . Then at <span class="ent">➋</span>
 , you set the style of the <span class="code">formatter</span>
 to <span class="code">Style.full</span>
 , which will print the day of the week as well as the full month name, date, and year. Finally, you create a string from the date using the <span class="code">string(from:)</span>
 method of the <span class="code">DateFormatter</span>
 class <span class="ent">➌</span>
 . You can see that you now have turned the <span id="page_160"></span>
 date into the nicely formatted string <span class="code">"Tuesday, November 21, 2017"</span>
 . <a style=";color:black;" href="text00022.html#ch11tab1">Table 11-1</a>
 shows the different strings that are created from the five <span class="code">DateFormatter.Style</span>
 options available in Swift.</p>
<p class="tabcap"><a id="ch11tab1" style=";color:black;"></a>
 <strong>Table 11-1:</strong>
 Date Formatter Styles and Their Date Strings</p>
<table class="tabled">
<tbody>
<tr>
<td style="vertical-align: top;" class="border1">
<p class="noindent">
<span class="code">
<span class="codestrong">DateFormatter.Style</span>
</span>
</p>
</td>
<td style="vertical-align: top;" class="border1">
<p class="noindent">
<strong>Date string</strong>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">none</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">""</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">short</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"11/21/17"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">medium</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"Nov 21, 2017"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">long</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"November 21, 2017"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">full</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"Tuesday, November 21, 2017"</span>
</p>
</td>
</tr>
</tbody>
</table>
<p class="box-pi">You can also specify your own custom way of displaying a date using the <span class="code">dateFormat</span>
 property of the <span class="code">DateFormatter</span>
 . Perhaps you only want the month and day. Or maybe you want a four-digit year displayed in the <span class="code">short</span>
 style. Doing either is really easy, and you don’t even have to create a new <span class="code">DateFormatter</span>
 —you can just change the <span class="code">dateFormat</span>
 on <span class="code">formatter</span>
 and then ask it for a new string. Add the following code to your playground to display dates with a specific format:</p>
<div class="image"><img src="Image00241.jpg" />
</div>
<p class="box-pi">At <span class="ent">➊</span>
 , you specify that you only want the month and the date in an <span class="code">MM/dd</span>
 format—that is, a two-digit month followed by a two-digit date. If you want to display the month as three letters, then use <span class="code">MMM</span>
 . To display the full name of the month, use <span class="code">MMMM</span>
 . At <span class="ent">➋</span>
 , we change the date format to use a four-digit year. A two-digit year would be <span class="code">yy</span>
 . Here are a few other ways to use a <span class="code">dateFormat</span>
 to display a custom date string.</p>
<div class="image"><img src="Image00242.jpg" />
</div>
<p class="box-pi"><span id="page_161"></span>
 If you want to include separators, you add them to your <span class="code">dateFormat</span>
 string. For example, if you want periods as separators, then you can create a <span class="code">dateFormat</span>
 like <span class="code">"MM.dd.yy"</span>
 <span class="ent">➊</span>
 . To display an abbreviated day of the week, use <span class="code">EEE</span>
 <span class="ent">➋</span>
 . For the full day, use <span class="code">EEEE</span>
 <span class="ent">➌</span>
 . These are only a few examples. By using combinations of <span class="code">M</span>
 , <span class="code">d</span>
 , <span class="code">y</span>
 , and <span class="code">E</span>
 , you have an endless number of ways to display a date!</p>
</div>
<h4 class="h4" id="ch11lev2sec3">
<strong>SETTING UP THE BIRTHDAYS TABLE VIEW CONTROLLER</strong>
</h4>
<p class="noindent">The Birthdays table view controller will display a list of all the birthdays stored in the app. Do you remember what you use to store a list of items? That’s right—an array! You’ll create an array in the <span class="code">BirthdaysTableViewController</span>
 to store all the birthdays. To do this, give the <span class="code">BirthdaysTableViewController</span>
 a <span class="code">birthdays</span>
 property that is an array of <span class="code">Birthday</span>
 objects. At the top of the class, right above the <span class="code">viewDidLoad()</span>
 method, insert this line to add a variable array property called <span class="code">birthdays</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController {</span>
<br />
<br />
    <span class="pink">var</span>
 birthdays = [<span class="green1">Birthday</span>
 ]()<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent">This line creates an empty array of <span class="code">Birthday</span>
 instances. It needs to be a variable and not a constant because you’ll want to add a saved <span class="code">Birthday</span>
 to this array every time the user adds a <span class="code">Birthday</span>
 with the Add Birthday view controller. You’ll see how to do that in “<a href="text00022.html#ch11lev3sec2">Making the Birthdays Table View Controller Conform to Protocol</a>
 ” on <a href="text00022.html#page_168">page 168</a>
 .</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>Remember that the final versions of the project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>.</em>
</p>
</div>
<p class="indent">The <span class="code">BirthdaysTableViewController</span>
 will also need a <span class="code">dateFormatter</span>
 property to display the birthdate as a nicely formatted string. Add a <span class="code">dateFormatter</span>
 right underneath the <span class="code">birthdays</span>
 array:</p>
<div class="box">
<pre>    <span class="ash">var birthdays = [Birthday]()</span>
<br />
<br />
    <span class="pink">let</span>
 dateFormatter = <span class="violet">DateFormatter</span>
 ()<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent">Note that the <span class="code">dateFormatter</span>
 is a constant that is created with <span class="code">let</span>
 . Even though you’ll change the <span class="code">dateFormatter</span>
 ’s properties, like the <span class="code">dateStyle</span>
 and <span class="code">timeStyle</span>
 , you’ll never change the <span class="code">dateFormatter</span>
 itself.</p>
<p class="indent"><span id="page_162"></span>
 You’ll also need to set up the <span class="code">dateFormatter</span>
 so that it will display the birthdates as fully formatted strings like <span class="code">"Tuesday, December 17, 2008"</span>
 . As you saw in <a href="text00021.html#ch10">Chapter 10</a>
 , a good place to do this is the <span class="code">viewDidLoad()</span>
 method, which is called when the Birthdays table view controller is loading its view. This is the perfect place to do any setup that is needed for this class.</p>
<div class="box">
<pre>
<span class="ash">override func viewDidLoad() {</span>
<br />
    <span class="ash">super.viewDidLoad()</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">dateFormatter</span>
 .<span class="violet">dateStyle</span>
 = .<span class="blue">full</span>
<br />
  <span class="ent">➋</span>
 <span class="green1">dateFormatter</span>
 .<span class="violet">timeStyle</span>
 = .<span class="blue">none</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , you set the <span class="code">dateStyle</span>
 of the <span class="code">dateFormatter</span>
 so that it will display a formatted date string for each <span class="code">Birthday</span>
 . Did you notice how we just wrote <span class="code">.full</span>
 instead of <span class="code">DateFormatter.Style.full</span>
 ? Swift knows what type to expect for the <span class="code">dateStyle</span>
 of a <span class="code">DateFormatter</span>
 , so it lets us take this little shortcut. At <span class="ent">➋</span>
 , you set the <span class="code">timeStyle</span>
 of the <span class="code">dateFormatter</span>
 to <span class="code">.none</span>
 so that the time won’t be shown.</p>
<h4 class="h4" id="ch11lev2sec4">
<strong>DISPLAYING BIRTHDAYS IN A TABLE VIEW</strong>
</h4>
<p class="noindent">The <span class="code">BirthdaysTableViewController</span>
 class has a table view that is used to display a list of items in a single column. The table view has one or more sections containing rows, and each row contains a cell. A section in a table view is a grouping of rows that can be displayed with or without a header. An example of an app that shows a table view with several sections is the Settings app, as shown in <a href="text00022.html#ch11fig5">Figure 11-5</a>
 . It displays a list of rows that have been broken up into different sections.</p>
<p class="indent">Each section and row of a table view is identified with an index number. These numbers start at 0 and then increase by 1 as you go down the table view. For example, the Privacy line in the Settings app is found at section 0, row 1. The News setting is at section 1, row 3.</p>
<p class="indent">In the middle of the <span class="code">BirthdaysTableViewController</span>
 class, there is a section called <em>Table view data source</em>
 with three methods. The table view controller uses these methods to determine what’s going to be displayed inside its table view.</p>
<p class="hang">
<span class="code">
<span class="codestrong">numberOfSections(in:)</span>
</span>
 Tells the table view how many sections it should have</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:numberOfRowsInSection:)</span>
</span>
 Tells the table view how many rows will be displayed in each section</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:cellForRowAt:)</span>
</span>
 Sets up each cell that’s going to be displayed in each row of the table view</p>
<div class="image"><span id="page_163"></span>
 <img src="Image00243.jpg" />
</div>
<p class="figcap"><a id="ch11fig5"></a>
 <em>Figure 11-5: The Settings app uses sections to group rows of different device settings.</em>
</p>
<p class="indent">The table view data source methods are called by the table view controller every time the table view is reloaded. Xcode automatically gives you these method templates when you make a subclass of a <span class="code">UITableViewController</span>
 . You need to implement all three methods for the app to work, even though you’ll never call them directly in your code. The <span class="code">UITableViewController</span>
 class implements the <span class="code">UITableViewDataSource</span>
 protocol, which comes with these data source methods, to determine what will be displayed inside the table view. We’ll discuss protocols in “<a href="text00022.html#ch11lev2sec5">Delegation</a>
 ” on page 166. For now, you just need to know that a <span class="code">UITableViewController</span>
 uses these methods to display its content, and it automatically calls these methods so you don’t need to call them.</p>
<p class="indent">Let’s start with the method <span class="code">numberOfSections(in:)</span>
 . The Birthdays table view controller is a list that just displays <span class="code">Birthday</span>
 instances, so it doesn’t need multiple sections. To set the number of sections in the table view, we just need to return <span class="code">1</span>
 .</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func numberOfSections(in tableView: UITableView) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 <span class="blue1">1</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent"><span id="page_164"></span>
 This method takes a <span class="code">UITableView</span>
 called <span class="code">tableView</span>
 as a parameter, which is the table view that uses this class as its data source. We don’t need to worry about making this connection because the <span class="code">UITableViewController</span>
 comes with a built-in table view that is automatically hooked up to these methods. Each birthday will be displayed in its own row. So in <span class="code">tableView(_:numberOfRowsInSection:)</span>
 , in order to have the right number of rows for all of your birthdays, you need to return the number of <span class="code">Birthday</span>
 instances that you have in your <span class="code">birthdays</span>
 array. Do you remember the <span class="code">count</span>
 property of an array? It’s an integer that tells you how many items are in that array, and it’s perfect for this situation! Change this method to the following:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, <img class="inline" src="Image00184.jpg" />
<br />
    numberOfRowsInSection section: Int) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 birthdays.<span class="violet">count</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">In addition to the <span class="code">tableView</span>
 parameter, <span class="code">tableView(_:numberOfRowsInSection:)</span>
 also takes an <span class="code">Int</span>
 called <span class="code">section</span>
 . When the table view is loading itself, this method is called for each section in the table view. In our case, we have only one section, so we don’t need to bother checking which <span class="code">section</span>
 of the table view is being displayed here. We know it’s section 0, and we want it to have as many rows as there are birthdays, so we write <span class="code">return birthdays.count</span>
 .</p>
<p class="indent">Finally, you need to implement <span class="code">tableView(_:cellForRowAt:)</span>
 so that the table view will know what to put inside each cell. Since this method is commented out, you need to uncomment it by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it. (Be careful not to accidentally uncomment the other methods after it!) After you’ve done that, change it to the following code:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, cellForRowAt <img class="inline" src="Image00184.jpg" />
<br />
    indexPath: IndexPath) -&gt; UITableViewCell {</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="pink">let</span>
 cell = tableView.<span class="blue">dequeueReusableCell</span>
 (withIdentifier: <img class="inline" src="Image00093.jpg" />
<br />
        <span class="red">"birthdayCellIdentifier"</span>
 , for: indexPath)<br />
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 birthday = <span class="green1">birthdays</span>
 [indexPath.<span class="violet">row</span>
 ]<br />
<br />
  <span class="ent">➌</span>
 cell.<span class="violet">textLabel</span>
 ?.<span class="violet">text</span>
 = birthday.<span class="green1">firstName</span>
 <span class="blue">+</span>
 <span class="red">" "</span>
 <span class="blue">+</span>
 <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">lastName</span>
<br />
<br />
  <span class="ent">➍</span>
 cell.<span class="violet">detailTextLabel</span>
 ?.<span class="violet">text</span>
 = <span class="green1">dateFormatter</span>
 .<span class="blue">string</span>
 (from: <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">birthdate</span>
 )<br />
<br />
  <span class="ent">➎</span>
 <span class="pink">return</span>
 cell<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">You don’t call the method <span class="code">tableView(_:cellForRowAt:)</span>
 . It’s called when the table view is loaded onto the screen. It’s called for each cell on the screen and takes two parameters, <span class="code">tableView</span>
 and <span class="code">indexPath</span>
 . You already know <span id="page_165"></span>
 what the <span class="code">tableView</span>
 parameter is for. An <span class="code">IndexPath</span>
 is a Swift struct that’s used to represent a row’s position in a table view. An <span class="code">IndexPath</span>
 instance has a <span class="code">section</span>
 property and a <span class="code">row</span>
 property. Since this method will be called many times (once for every row in the table), we need the <span class="code">indexPath</span>
 to know which section and row we’re currently configuring. The <span class="code">indexPath.section</span>
 property gives the section number, and the <span class="code">indexPath.row</span>
 gives the row of the table view cell. The five lines of code inside <span class="code">tableView(_:cellForRowAt:)</span>
 will do the following:</p>
<div class="image"><img src="Image00244.jpg" />
</div>
<p class="bull">• Create a <span class="code">UITableViewCell</span>
</p>
<p class="bull">• Figure out which <span class="code">Birthday</span>
 in the <span class="code">birthdays</span>
 array will be displayed inside the cell</p>
<p class="bull">• Make two labels to display the birthday person’s name and birthdate in the cell</p>
<p class="bull">• Return the cell ready for display in the table view</p>
<p class="indentt">Let’s go through this code line by line.</p>
<p class="indent">First, create the <span class="code">UITableViewCell</span>
 . The code at <span class="ent">➊</span>
 does this using the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 . Before you can start using this method on a cell, though, you need to tell the method which cell you want to use from the storyboard. Earlier, when you were in the storyboard, you gave your cell the identifier <span class="code">birthdayCellIdentifier</span>
 (see <a href="text00022.html#ch11fig4">Figure 11-4</a>
 ). This identifier links your code to the cell and tells your method that it’s using the right cell. The string for when you call this method needs to be exactly the same as the string you set in the storyboard, or you’ll get an error and the app will crash when you run it.</p>
<p class="indent">In the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 , did you notice the words <em>Reusable Cell</em>
 ? The cells inside a table view are created once and then can be reused over and over. This helps everything run faster and smoother because creating the cell is what takes the most time. If you had 200 birthdays in your app, but only 10 would fit on your screen at one time, then you need only 10 cells to show your birthdays. When you scroll down to reveal more birthdays, the cells that scroll off the top of the screen are reused. They are filled with new information and show up again at the bottom of the screen. The <span class="code">UITableView</span>
 automatically does this work. When the table view is loaded, <span class="code">tableView(_:cellForRowAt:)</span>
 is called for every visible row. When the user scrolls to look at more cells, it’s called again for each row just as it is about to appear on the screen.</p>
<p class="indent">Next, we need to find out which <span class="code">Birthday</span>
 should be displayed inside the cell. We want to display one birthday from the <span class="code">birthdays</span>
 array in each row. The first birthday, which is at <span class="code">birthdays[0]</span>
 , should be displayed in row 0. The second birthday, at <span class="code">birthdays[1]</span>
 , should be displayed in row 1, and so on, which means the <span class="code">indexPath</span>
 ’s <span class="code">row</span>
 is the same as the position in the <span class="code">birthdays</span>
 array that we want to access. The code at <span class="ent">➋</span>
 accesses the <span id="page_166"></span>
 correct <span class="code">Birthday</span>
 object from the <span class="code">birthdays</span>
 array by using <span class="code">indexPath.row</span>
 . Once we have the right <span class="code">Birthday</span>
 object, we assign it to a constant named <span class="code">birthday</span>
 so we can set up the labels in this cell.</p>
<p class="indent">Notice that we’re using <span class="code">let</span>
 to assign the <span class="code">birthday</span>
 to a constant instead of a variable. We can use <span class="code">let</span>
 because each time <span class="code">tableView(_:cellForRowAt:)</span>
 is called, a new <span class="code">birthday</span>
 constant is created. Each cell gets its own <span class="code">birthday</span>
 constant that is assigned its own <span class="code">Birthday</span>
 object. Since we’re not going to change any of the <span class="code">birthday</span>
 constants—we’re just going to read their properties—we don’t want to make them variables.</p>
<p class="indent">Now that you have your cell and your birthday, it’s time to fill in the details. You need two labels for each cell to show the birthday person’s name and birthdate. You set the cell to the Subtitle style so that it has a Title label and a Subtitle label. Each cell will already contain these labels, so now you don’t have to create any labels yourself.</p>
<p class="indent">The labels exist as properties of <span class="code">UITableViewCell</span>
 and are called <span class="code">textLabel</span>
 and <span class="code">detailTextLabel</span>
 . The code at <span class="ent">➌</span>
 sets the text of the <span class="code">textLabel</span>
 to a string made up of the <span class="code">firstName</span>
 and <span class="code">lastName</span>
 of the <span class="code">birthday</span>
 with a space between them. At <span class="ent">➍</span>
 , you use the <span class="code">string(from:)</span>
 method of the <span class="code">dateFormatter</span>
 to display the birthdate in the <span class="code">detailTextLabel</span>
 .</p>
<p class="indent">When your cell is completely configured, <span class="code">tableView( _:cellForRowAt:)</span>
 returns the cell at <span class="ent">➎</span>
 so that it can be displayed at that <span class="code">indexPath</span>
 of the table view.</p>
<h3 class="h3" id="ch11lev1sec2">
<strong>PUTTING IT ALL TOGETHER</strong>
</h3>
<p class="noindent">Now you can add <span class="code">Birthday</span>
 instances to the app using the Add Birthday view controller, and you have a table view to list each <span class="code">Birthday</span>
 in the Birthdays table view controller. But when you try running the app and adding a <span class="code">Birthday</span>
 , it doesn’t appear. To make each <span class="code">Birthday</span>
 you add appear in the table view, you need to make the Add Birthday view controller communicate with the Birthdays table view controller. You do this by using <em>delegation</em>
 .</p>
<h4 class="h4" id="ch11lev2sec5">
<strong>DELEGATION</strong>
</h4>
<p class="noindent">Delegation can be used when one view controller needs to get information from another view controller. Say you have two view controllers: A and B. The first view controller, A, creates B and presents B on top of itself. A knows about B because it created and presented B, so A can pass information along to B. But B doesn’t know about A—it’s just popped into being and doesn’t know where it came from or how it got there. So how can B talk to A? Through delegation!</p>
<div class="image"><img src="Image00245.jpg" />
</div>
<p class="indent">Delegation is when someone gives a job or a task to someone else. A <em>delegate</em>
 is like a boss who tells a delegating employee what to do. When the delegating employee is done with their task, sometimes they’ll report information back to the delegate boss.</p>
<p class="indent"><span id="page_167"></span>
 Delegation in Swift is pretty similar, but instead of having a boss and employee, we have a delegate and a delegating object. Since class B is the one being told what to do by class A, it’s the delegating object. We give class B a special property called a delegate to tell it who its delegate is—that way, it knows who to communicate with. The delegate can be any class that has a set of methods that have been defined in a <em>protocol</em>
 . A protocol is like an agreement between the two classes that tells them what the delegate can ask the delegating object to do. It has a list of method and property names that the delegate can use with the delegating object.</p>
<p class="indent">Class A creates class B, makes itself the delegate of class B, and gives class B a job to do that’s in the protocol. Once class B is done with its job, it reports back to class A. Let’s see how this works in our app.</p>
<p class="indent">The Birthdays table view controller is view controller A, and the Add Birthday view controller is view controller B. We’ll create a protocol called <span class="code">AddBirthdayViewControllerDelegate</span>
 and a method for that protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 , which the Add Birthday view controller will use to report back.</p>
<p class="indent">Take a look at <a href="text00022.html#ch11fig6">Figure 11-6</a>
 . When the user taps the Add button <span class="ent">➊</span>
 , the Birthdays table view controller creates the Add Birthday view controller <span class="ent">➋</span>
 and sets itself as the Add Birthday view controller’s delegate.</p>
<div class="image"><img src="Image00246.jpg" />
</div>
<p class="figcap"><a id="ch11fig6"></a>
 <em>Figure 11-6: A new birthday is added and passed from the Add Birthday view controller to the Birthdays table view controller using delegation.</em>
</p>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<div class="image"><img src="Image00235.jpg" />
</div>
<p class="figcap"><a id="ch11fig2"></a>
 <em>Figure 11-2: The</em>
 <span class="code">
<span class="italic">BirthdaysTableViewController</span>
</span>
 <em>cleaned up!</em>
</p>
<p class="indent">Next, you need to make the Birthdays table view controller the <span class="code">BirthdaysTableViewController</span>
 class. To do this, go to <em>Main.storyboard</em>
 and select the <strong>Birthdays</strong>
 scene. Using the Identity Inspector in the right pane, change the class from <span class="code">UITableViewController</span>
 to <span class="code">BirthdaysTableViewController</span>
 , as shown in <a href="text00022.html#ch11fig3">Figure 11-3</a>
 .</p>
<div class="image"><span id="page_158"></span>
 <img src="Image00236.jpg" />
</div>
<p class="figcap"><a id="ch11fig3"></a>
 <em>Figure 11-3: Setting</em>
 <span class="code">
<span class="italic">BirthdaysTableViewController</span>
</span>
 <em>as the class of the Birthdays scene</em>
</p>
<p class="indent">Now that you have the Birthdays table view controller set up in the storyboard, the next step is to make cells in your table that will display each birthday.</p>
<h4 class="h4" id="ch11lev2sec2">
<strong>ADDING CELLS TO THE TABLE VIEW</strong>
</h4>
<p class="noindent">Each birthday will be displayed in a <span class="code">UITableViewCell</span>
 in the Birthdays table view controller. A table has boxes organized into rows and columns that contain information. These boxes are called <em>cells</em>
 . Similarly, a table view also has cells that are all instances of, or a subclass of, the <span class="code">UITableViewCell</span>
 class. We’ll put each birthday into its own cell in our table view.</p>
<p class="indent">We’ll start by creating those cells in the storyboard, and then we’ll fill them with our <span class="code">Birthday</span>
 objects later. In the left outline menu, click the triangle by Birthdays and then click the triangle by Table View to open those sections. Then select <strong>Table View Cell</strong>
 <span class="ent">➊</span>
 , as shown in <a href="text00022.html#ch11fig4">Figure 11-4</a>
 .</p>
<div class="image"><img src="Image00237.jpg" />
</div>
<div class="image"><img src="Image00238.jpg" />
</div>
<p class="figcap"><a id="ch11fig4"></a>
 <em>Figure 11-4: Creating a Subtitle style table view cell and setting its identifier</em>
</p>
<p class="indent"><span id="page_159"></span>
 Next, open the Attributes Inspector. Using the drop-down menu under <strong>Style</strong>
 , set the cell’s style to <strong>Subtitle</strong>
 <span class="ent">➋</span>
 so that the cell now has a Title label and a Subtitle label. You’ll display each person’s name in the Title and birthday in the Subtitle.</p>
<p class="indent">Finally, enter <span class="code">
<span class="codestrong">birthdayCellIdentifier</span>
</span>
 in the Identifier field <span class="ent">➌</span>
 . You’ll use this identifier later when you fill in the cell contents.</p>
<p class="indent">That’s it! You’ve finished your work in the storyboard.</p>
<p class="indent">You may be wondering why we have just one cell in our table view in the storyboard when we’ll have more than one birthday to show in the list. If you look at <a href="text00022.html#ch11fig4">Figure 11-4</a>
 again, you’ll notice that the cell is labeled <em>Prototype Cells</em>
 . This means that the cell you just customized is a <em>template</em>
 for all the cells you want to appear in your table view. The identifier you gave the cell is how your code will tell the table view to produce each cell for you to put birthdays in. You’ll see how this works soon.</p>
<div class="box1">
<p class="box-title">
<strong>WORKING WITH DATES</strong>
</p>
<p class="box-p">Swift has a special data type called <span class="code">Date</span>
 that is used for storing date values. A <span class="code">Date</span>
 object is actually a date and a time. Open your playground and enter the following:</p>
<div class="image"><img src="Image00239.jpg" />
</div>
<p class="box-pi">We’ve just assigned the current date and time the code was run to the variable <span class="code">today</span>
 . When you print <span class="code">today</span>
 , it’s in the format <span class="code">"2017-11-21 10:45:31 +0000\n"</span>
 . What if you wanted it to display as <span class="code">Tuesday, November 21, 2017</span>
 , instead? Or just <span class="code">11/21/17</span>
 ? To display a date in a particular way, you use a <em>date formatter</em>
 , which is a <span class="code">DateFormatter</span>
 object that you create and give a date format style. <span class="code">DateFormatter</span>
 is a helper object that is used to create a display string from any date, and a <em>date format style</em>
 is a property of <span class="code">DateFormatter</span>
 that tells the formatter what style to use. You can create your own date format styles manually, but there are also styles that are included in Swift and ready to use. Add the following to your playground:</p>
<div class="image"><img src="Image00240.jpg" />
</div>
<p class="box-pi">At <span class="ent">➊</span>
 you create a <span class="code">formatter</span>
 . Then at <span class="ent">➋</span>
 , you set the style of the <span class="code">formatter</span>
 to <span class="code">Style.full</span>
 , which will print the day of the week as well as the full month name, date, and year. Finally, you create a string from the date using the <span class="code">string(from:)</span>
 method of the <span class="code">DateFormatter</span>
 class <span class="ent">➌</span>
 . You can see that you now have turned the <span id="page_160"></span>
 date into the nicely formatted string <span class="code">"Tuesday, November 21, 2017"</span>
 . <a style=";color:black;" href="text00022.html#ch11tab1">Table 11-1</a>
 shows the different strings that are created from the five <span class="code">DateFormatter.Style</span>
 options available in Swift.</p>
<p class="tabcap"><a id="ch11tab1" style=";color:black;"></a>
 <strong>Table 11-1:</strong>
 Date Formatter Styles and Their Date Strings</p>
<table class="tabled">
<tbody>
<tr>
<td style="vertical-align: top;" class="border1">
<p class="noindent">
<span class="code">
<span class="codestrong">DateFormatter.Style</span>
</span>
</p>
</td>
<td style="vertical-align: top;" class="border1">
<p class="noindent">
<strong>Date string</strong>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">none</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">""</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">short</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"11/21/17"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">medium</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"Nov 21, 2017"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">long</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"November 21, 2017"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">full</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"Tuesday, November 21, 2017"</span>
</p>
</td>
</tr>
</tbody>
</table>
<p class="box-pi">You can also specify your own custom way of displaying a date using the <span class="code">dateFormat</span>
 property of the <span class="code">DateFormatter</span>
 . Perhaps you only want the month and day. Or maybe you want a four-digit year displayed in the <span class="code">short</span>
 style. Doing either is really easy, and you don’t even have to create a new <span class="code">DateFormatter</span>
 —you can just change the <span class="code">dateFormat</span>
 on <span class="code">formatter</span>
 and then ask it for a new string. Add the following code to your playground to display dates with a specific format:</p>
<div class="image"><img src="Image00241.jpg" />
</div>
<p class="box-pi">At <span class="ent">➊</span>
 , you specify that you only want the month and the date in an <span class="code">MM/dd</span>
 format—that is, a two-digit month followed by a two-digit date. If you want to display the month as three letters, then use <span class="code">MMM</span>
 . To display the full name of the month, use <span class="code">MMMM</span>
 . At <span class="ent">➋</span>
 , we change the date format to use a four-digit year. A two-digit year would be <span class="code">yy</span>
 . Here are a few other ways to use a <span class="code">dateFormat</span>
 to display a custom date string.</p>
<div class="image"><img src="Image00242.jpg" />
</div>
<p class="box-pi"><span id="page_161"></span>
 If you want to include separators, you add them to your <span class="code">dateFormat</span>
 string. For example, if you want periods as separators, then you can create a <span class="code">dateFormat</span>
 like <span class="code">"MM.dd.yy"</span>
 <span class="ent">➊</span>
 . To display an abbreviated day of the week, use <span class="code">EEE</span>
 <span class="ent">➋</span>
 . For the full day, use <span class="code">EEEE</span>
 <span class="ent">➌</span>
 . These are only a few examples. By using combinations of <span class="code">M</span>
 , <span class="code">d</span>
 , <span class="code">y</span>
 , and <span class="code">E</span>
 , you have an endless number of ways to display a date!</p>
</div>
<h4 class="h4" id="ch11lev2sec3">
<strong>SETTING UP THE BIRTHDAYS TABLE VIEW CONTROLLER</strong>
</h4>
<p class="noindent">The Birthdays table view controller will display a list of all the birthdays stored in the app. Do you remember what you use to store a list of items? That’s right—an array! You’ll create an array in the <span class="code">BirthdaysTableViewController</span>
 to store all the birthdays. To do this, give the <span class="code">BirthdaysTableViewController</span>
 a <span class="code">birthdays</span>
 property that is an array of <span class="code">Birthday</span>
 objects. At the top of the class, right above the <span class="code">viewDidLoad()</span>
 method, insert this line to add a variable array property called <span class="code">birthdays</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController {</span>
<br />
<br />
    <span class="pink">var</span>
 birthdays = [<span class="green1">Birthday</span>
 ]()<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent">This line creates an empty array of <span class="code">Birthday</span>
 instances. It needs to be a variable and not a constant because you’ll want to add a saved <span class="code">Birthday</span>
 to this array every time the user adds a <span class="code">Birthday</span>
 with the Add Birthday view controller. You’ll see how to do that in “<a href="text00022.html#ch11lev3sec2">Making the Birthdays Table View Controller Conform to Protocol</a>
 ” on <a href="text00022.html#page_168">page 168</a>
 .</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>Remember that the final versions of the project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>.</em>
</p>
</div>
<p class="indent">The <span class="code">BirthdaysTableViewController</span>
 will also need a <span class="code">dateFormatter</span>
 property to display the birthdate as a nicely formatted string. Add a <span class="code">dateFormatter</span>
 right underneath the <span class="code">birthdays</span>
 array:</p>
<div class="box">
<pre>    <span class="ash">var birthdays = [Birthday]()</span>
<br />
<br />
    <span class="pink">let</span>
 dateFormatter = <span class="violet">DateFormatter</span>
 ()<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent">Note that the <span class="code">dateFormatter</span>
 is a constant that is created with <span class="code">let</span>
 . Even though you’ll change the <span class="code">dateFormatter</span>
 ’s properties, like the <span class="code">dateStyle</span>
 and <span class="code">timeStyle</span>
 , you’ll never change the <span class="code">dateFormatter</span>
 itself.</p>
<p class="indent"><span id="page_162"></span>
 You’ll also need to set up the <span class="code">dateFormatter</span>
 so that it will display the birthdates as fully formatted strings like <span class="code">"Tuesday, December 17, 2008"</span>
 . As you saw in <a href="text00021.html#ch10">Chapter 10</a>
 , a good place to do this is the <span class="code">viewDidLoad()</span>
 method, which is called when the Birthdays table view controller is loading its view. This is the perfect place to do any setup that is needed for this class.</p>
<div class="box">
<pre>
<span class="ash">override func viewDidLoad() {</span>
<br />
    <span class="ash">super.viewDidLoad()</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">dateFormatter</span>
 .<span class="violet">dateStyle</span>
 = .<span class="blue">full</span>
<br />
  <span class="ent">➋</span>
 <span class="green1">dateFormatter</span>
 .<span class="violet">timeStyle</span>
 = .<span class="blue">none</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , you set the <span class="code">dateStyle</span>
 of the <span class="code">dateFormatter</span>
 so that it will display a formatted date string for each <span class="code">Birthday</span>
 . Did you notice how we just wrote <span class="code">.full</span>
 instead of <span class="code">DateFormatter.Style.full</span>
 ? Swift knows what type to expect for the <span class="code">dateStyle</span>
 of a <span class="code">DateFormatter</span>
 , so it lets us take this little shortcut. At <span class="ent">➋</span>
 , you set the <span class="code">timeStyle</span>
 of the <span class="code">dateFormatter</span>
 to <span class="code">.none</span>
 so that the time won’t be shown.</p>
<h4 class="h4" id="ch11lev2sec4">
<strong>DISPLAYING BIRTHDAYS IN A TABLE VIEW</strong>
</h4>
<p class="noindent">The <span class="code">BirthdaysTableViewController</span>
 class has a table view that is used to display a list of items in a single column. The table view has one or more sections containing rows, and each row contains a cell. A section in a table view is a grouping of rows that can be displayed with or without a header. An example of an app that shows a table view with several sections is the Settings app, as shown in <a href="text00022.html#ch11fig5">Figure 11-5</a>
 . It displays a list of rows that have been broken up into different sections.</p>
<p class="indent">Each section and row of a table view is identified with an index number. These numbers start at 0 and then increase by 1 as you go down the table view. For example, the Privacy line in the Settings app is found at section 0, row 1. The News setting is at section 1, row 3.</p>
<p class="indent">In the middle of the <span class="code">BirthdaysTableViewController</span>
 class, there is a section called <em>Table view data source</em>
 with three methods. The table view controller uses these methods to determine what’s going to be displayed inside its table view.</p>
<p class="hang">
<span class="code">
<span class="codestrong">numberOfSections(in:)</span>
</span>
 Tells the table view how many sections it should have</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:numberOfRowsInSection:)</span>
</span>
 Tells the table view how many rows will be displayed in each section</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:cellForRowAt:)</span>
</span>
 Sets up each cell that’s going to be displayed in each row of the table view</p>
<div class="image"><span id="page_163"></span>
 <img src="Image00243.jpg" />
</div>
<p class="figcap"><a id="ch11fig5"></a>
 <em>Figure 11-5: The Settings app uses sections to group rows of different device settings.</em>
</p>
<p class="indent">The table view data source methods are called by the table view controller every time the table view is reloaded. Xcode automatically gives you these method templates when you make a subclass of a <span class="code">UITableViewController</span>
 . You need to implement all three methods for the app to work, even though you’ll never call them directly in your code. The <span class="code">UITableViewController</span>
 class implements the <span class="code">UITableViewDataSource</span>
 protocol, which comes with these data source methods, to determine what will be displayed inside the table view. We’ll discuss protocols in “<a href="text00022.html#ch11lev2sec5">Delegation</a>
 ” on page 166. For now, you just need to know that a <span class="code">UITableViewController</span>
 uses these methods to display its content, and it automatically calls these methods so you don’t need to call them.</p>
<p class="indent">Let’s start with the method <span class="code">numberOfSections(in:)</span>
 . The Birthdays table view controller is a list that just displays <span class="code">Birthday</span>
 instances, so it doesn’t need multiple sections. To set the number of sections in the table view, we just need to return <span class="code">1</span>
 .</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func numberOfSections(in tableView: UITableView) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 <span class="blue1">1</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent"><span id="page_164"></span>
 This method takes a <span class="code">UITableView</span>
 called <span class="code">tableView</span>
 as a parameter, which is the table view that uses this class as its data source. We don’t need to worry about making this connection because the <span class="code">UITableViewController</span>
 comes with a built-in table view that is automatically hooked up to these methods. Each birthday will be displayed in its own row. So in <span class="code">tableView(_:numberOfRowsInSection:)</span>
 , in order to have the right number of rows for all of your birthdays, you need to return the number of <span class="code">Birthday</span>
 instances that you have in your <span class="code">birthdays</span>
 array. Do you remember the <span class="code">count</span>
 property of an array? It’s an integer that tells you how many items are in that array, and it’s perfect for this situation! Change this method to the following:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, <img class="inline" src="Image00184.jpg" />
<br />
    numberOfRowsInSection section: Int) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 birthdays.<span class="violet">count</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">In addition to the <span class="code">tableView</span>
 parameter, <span class="code">tableView(_:numberOfRowsInSection:)</span>
 also takes an <span class="code">Int</span>
 called <span class="code">section</span>
 . When the table view is loading itself, this method is called for each section in the table view. In our case, we have only one section, so we don’t need to bother checking which <span class="code">section</span>
 of the table view is being displayed here. We know it’s section 0, and we want it to have as many rows as there are birthdays, so we write <span class="code">return birthdays.count</span>
 .</p>
<p class="indent">Finally, you need to implement <span class="code">tableView(_:cellForRowAt:)</span>
 so that the table view will know what to put inside each cell. Since this method is commented out, you need to uncomment it by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it. (Be careful not to accidentally uncomment the other methods after it!) After you’ve done that, change it to the following code:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, cellForRowAt <img class="inline" src="Image00184.jpg" />
<br />
    indexPath: IndexPath) -&gt; UITableViewCell {</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="pink">let</span>
 cell = tableView.<span class="blue">dequeueReusableCell</span>
 (withIdentifier: <img class="inline" src="Image00093.jpg" />
<br />
        <span class="red">"birthdayCellIdentifier"</span>
 , for: indexPath)<br />
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 birthday = <span class="green1">birthdays</span>
 [indexPath.<span class="violet">row</span>
 ]<br />
<br />
  <span class="ent">➌</span>
 cell.<span class="violet">textLabel</span>
 ?.<span class="violet">text</span>
 = birthday.<span class="green1">firstName</span>
 <span class="blue">+</span>
 <span class="red">" "</span>
 <span class="blue">+</span>
 <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">lastName</span>
<br />
<br />
  <span class="ent">➍</span>
 cell.<span class="violet">detailTextLabel</span>
 ?.<span class="violet">text</span>
 = <span class="green1">dateFormatter</span>
 .<span class="blue">string</span>
 (from: <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">birthdate</span>
 )<br />
<br />
  <span class="ent">➎</span>
 <span class="pink">return</span>
 cell<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">You don’t call the method <span class="code">tableView(_:cellForRowAt:)</span>
 . It’s called when the table view is loaded onto the screen. It’s called for each cell on the screen and takes two parameters, <span class="code">tableView</span>
 and <span class="code">indexPath</span>
 . You already know <span id="page_165"></span>
 what the <span class="code">tableView</span>
 parameter is for. An <span class="code">IndexPath</span>
 is a Swift struct that’s used to represent a row’s position in a table view. An <span class="code">IndexPath</span>
 instance has a <span class="code">section</span>
 property and a <span class="code">row</span>
 property. Since this method will be called many times (once for every row in the table), we need the <span class="code">indexPath</span>
 to know which section and row we’re currently configuring. The <span class="code">indexPath.section</span>
 property gives the section number, and the <span class="code">indexPath.row</span>
 gives the row of the table view cell. The five lines of code inside <span class="code">tableView(_:cellForRowAt:)</span>
 will do the following:</p>
<div class="image"><img src="Image00244.jpg" />
</div>
<p class="bull">• Create a <span class="code">UITableViewCell</span>
</p>
<p class="bull">• Figure out which <span class="code">Birthday</span>
 in the <span class="code">birthdays</span>
 array will be displayed inside the cell</p>
<p class="bull">• Make two labels to display the birthday person’s name and birthdate in the cell</p>
<p class="bull">• Return the cell ready for display in the table view</p>
<p class="indentt">Let’s go through this code line by line.</p>
<p class="indent">First, create the <span class="code">UITableViewCell</span>
 . The code at <span class="ent">➊</span>
 does this using the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 . Before you can start using this method on a cell, though, you need to tell the method which cell you want to use from the storyboard. Earlier, when you were in the storyboard, you gave your cell the identifier <span class="code">birthdayCellIdentifier</span>
 (see <a href="text00022.html#ch11fig4">Figure 11-4</a>
 ). This identifier links your code to the cell and tells your method that it’s using the right cell. The string for when you call this method needs to be exactly the same as the string you set in the storyboard, or you’ll get an error and the app will crash when you run it.</p>
<p class="indent">In the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 , did you notice the words <em>Reusable Cell</em>
 ? The cells inside a table view are created once and then can be reused over and over. This helps everything run faster and smoother because creating the cell is what takes the most time. If you had 200 birthdays in your app, but only 10 would fit on your screen at one time, then you need only 10 cells to show your birthdays. When you scroll down to reveal more birthdays, the cells that scroll off the top of the screen are reused. They are filled with new information and show up again at the bottom of the screen. The <span class="code">UITableView</span>
 automatically does this work. When the table view is loaded, <span class="code">tableView(_:cellForRowAt:)</span>
 is called for every visible row. When the user scrolls to look at more cells, it’s called again for each row just as it is about to appear on the screen.</p>
<p class="indent">Next, we need to find out which <span class="code">Birthday</span>
 should be displayed inside the cell. We want to display one birthday from the <span class="code">birthdays</span>
 array in each row. The first birthday, which is at <span class="code">birthdays[0]</span>
 , should be displayed in row 0. The second birthday, at <span class="code">birthdays[1]</span>
 , should be displayed in row 1, and so on, which means the <span class="code">indexPath</span>
 ’s <span class="code">row</span>
 is the same as the position in the <span class="code">birthdays</span>
 array that we want to access. The code at <span class="ent">➋</span>
 accesses the <span id="page_166"></span>
 correct <span class="code">Birthday</span>
 object from the <span class="code">birthdays</span>
 array by using <span class="code">indexPath.row</span>
 . Once we have the right <span class="code">Birthday</span>
 object, we assign it to a constant named <span class="code">birthday</span>
 so we can set up the labels in this cell.</p>
<p class="indent">Notice that we’re using <span class="code">let</span>
 to assign the <span class="code">birthday</span>
 to a constant instead of a variable. We can use <span class="code">let</span>
 because each time <span class="code">tableView(_:cellForRowAt:)</span>
 is called, a new <span class="code">birthday</span>
 constant is created. Each cell gets its own <span class="code">birthday</span>
 constant that is assigned its own <span class="code">Birthday</span>
 object. Since we’re not going to change any of the <span class="code">birthday</span>
 constants—we’re just going to read their properties—we don’t want to make them variables.</p>
<p class="indent">Now that you have your cell and your birthday, it’s time to fill in the details. You need two labels for each cell to show the birthday person’s name and birthdate. You set the cell to the Subtitle style so that it has a Title label and a Subtitle label. Each cell will already contain these labels, so now you don’t have to create any labels yourself.</p>
<p class="indent">The labels exist as properties of <span class="code">UITableViewCell</span>
 and are called <span class="code">textLabel</span>
 and <span class="code">detailTextLabel</span>
 . The code at <span class="ent">➌</span>
 sets the text of the <span class="code">textLabel</span>
 to a string made up of the <span class="code">firstName</span>
 and <span class="code">lastName</span>
 of the <span class="code">birthday</span>
 with a space between them. At <span class="ent">➍</span>
 , you use the <span class="code">string(from:)</span>
 method of the <span class="code">dateFormatter</span>
 to display the birthdate in the <span class="code">detailTextLabel</span>
 .</p>
<p class="indent">When your cell is completely configured, <span class="code">tableView( _:cellForRowAt:)</span>
 returns the cell at <span class="ent">➎</span>
 so that it can be displayed at that <span class="code">indexPath</span>
 of the table view.</p>
<h3 class="h3" id="ch11lev1sec2">
<strong>PUTTING IT ALL TOGETHER</strong>
</h3>
<p class="noindent">Now you can add <span class="code">Birthday</span>
 instances to the app using the Add Birthday view controller, and you have a table view to list each <span class="code">Birthday</span>
 in the Birthdays table view controller. But when you try running the app and adding a <span class="code">Birthday</span>
 , it doesn’t appear. To make each <span class="code">Birthday</span>
 you add appear in the table view, you need to make the Add Birthday view controller communicate with the Birthdays table view controller. You do this by using <em>delegation</em>
 .</p>
<h4 class="h4" id="ch11lev2sec5">
<strong>DELEGATION</strong>
</h4>
<p class="noindent">Delegation can be used when one view controller needs to get information from another view controller. Say you have two view controllers: A and B. The first view controller, A, creates B and presents B on top of itself. A knows about B because it created and presented B, so A can pass information along to B. But B doesn’t know about A—it’s just popped into being and doesn’t know where it came from or how it got there. So how can B talk to A? Through delegation!</p>
<div class="image"><img src="Image00245.jpg" />
</div>
<p class="indent">Delegation is when someone gives a job or a task to someone else. A <em>delegate</em>
 is like a boss who tells a delegating employee what to do. When the delegating employee is done with their task, sometimes they’ll report information back to the delegate boss.</p>
<p class="indent"><span id="page_167"></span>
 Delegation in Swift is pretty similar, but instead of having a boss and employee, we have a delegate and a delegating object. Since class B is the one being told what to do by class A, it’s the delegating object. We give class B a special property called a delegate to tell it who its delegate is—that way, it knows who to communicate with. The delegate can be any class that has a set of methods that have been defined in a <em>protocol</em>
 . A protocol is like an agreement between the two classes that tells them what the delegate can ask the delegating object to do. It has a list of method and property names that the delegate can use with the delegating object.</p>
<p class="indent">Class A creates class B, makes itself the delegate of class B, and gives class B a job to do that’s in the protocol. Once class B is done with its job, it reports back to class A. Let’s see how this works in our app.</p>
<p class="indent">The Birthdays table view controller is view controller A, and the Add Birthday view controller is view controller B. We’ll create a protocol called <span class="code">AddBirthdayViewControllerDelegate</span>
 and a method for that protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 , which the Add Birthday view controller will use to report back.</p>
<p class="indent">Take a look at <a href="text00022.html#ch11fig6">Figure 11-6</a>
 . When the user taps the Add button <span class="ent">➊</span>
 , the Birthdays table view controller creates the Add Birthday view controller <span class="ent">➋</span>
 and sets itself as the Add Birthday view controller’s delegate.</p>
<div class="image"><img src="Image00246.jpg" />
</div>
<p class="figcap"><a id="ch11fig6"></a>
 <em>Figure 11-6: A new birthday is added and passed from the Add Birthday view controller to the Birthdays table view controller using delegation.</em>
</p>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="figcap"><a id="ch11fig2"></a>
 <em>Figure 11-2: The</em>
 <span class="code">
<span class="italic">BirthdaysTableViewController</span>
</span>
 <em>cleaned up!</em>
</p>
<p class="indent">Next, you need to make the Birthdays table view controller the <span class="code">BirthdaysTableViewController</span>
 class. To do this, go to <em>Main.storyboard</em>
 and select the <strong>Birthdays</strong>
 scene. Using the Identity Inspector in the right pane, change the class from <span class="code">UITableViewController</span>
 to <span class="code">BirthdaysTableViewController</span>
 , as shown in <a href="text00022.html#ch11fig3">Figure 11-3</a>
 .</p>
<div class="image"><span id="page_158"></span>
 <img src="Image00236.jpg" />
</div>
<p class="figcap"><a id="ch11fig3"></a>
 <em>Figure 11-3: Setting</em>
 <span class="code">
<span class="italic">BirthdaysTableViewController</span>
</span>
 <em>as the class of the Birthdays scene</em>
</p>
<p class="indent">Now that you have the Birthdays table view controller set up in the storyboard, the next step is to make cells in your table that will display each birthday.</p>
<h4 class="h4" id="ch11lev2sec2">
<strong>ADDING CELLS TO THE TABLE VIEW</strong>
</h4>
<p class="noindent">Each birthday will be displayed in a <span class="code">UITableViewCell</span>
 in the Birthdays table view controller. A table has boxes organized into rows and columns that contain information. These boxes are called <em>cells</em>
 . Similarly, a table view also has cells that are all instances of, or a subclass of, the <span class="code">UITableViewCell</span>
 class. We’ll put each birthday into its own cell in our table view.</p>
<p class="indent">We’ll start by creating those cells in the storyboard, and then we’ll fill them with our <span class="code">Birthday</span>
 objects later. In the left outline menu, click the triangle by Birthdays and then click the triangle by Table View to open those sections. Then select <strong>Table View Cell</strong>
 <span class="ent">➊</span>
 , as shown in <a href="text00022.html#ch11fig4">Figure 11-4</a>
 .</p>
<div class="image"><img src="Image00237.jpg" />
</div>
<div class="image"><img src="Image00238.jpg" />
</div>
<p class="figcap"><a id="ch11fig4"></a>
 <em>Figure 11-4: Creating a Subtitle style table view cell and setting its identifier</em>
</p>
<p class="indent"><span id="page_159"></span>
 Next, open the Attributes Inspector. Using the drop-down menu under <strong>Style</strong>
 , set the cell’s style to <strong>Subtitle</strong>
 <span class="ent">➋</span>
 so that the cell now has a Title label and a Subtitle label. You’ll display each person’s name in the Title and birthday in the Subtitle.</p>
<p class="indent">Finally, enter <span class="code">
<span class="codestrong">birthdayCellIdentifier</span>
</span>
 in the Identifier field <span class="ent">➌</span>
 . You’ll use this identifier later when you fill in the cell contents.</p>
<p class="indent">That’s it! You’ve finished your work in the storyboard.</p>
<p class="indent">You may be wondering why we have just one cell in our table view in the storyboard when we’ll have more than one birthday to show in the list. If you look at <a href="text00022.html#ch11fig4">Figure 11-4</a>
 again, you’ll notice that the cell is labeled <em>Prototype Cells</em>
 . This means that the cell you just customized is a <em>template</em>
 for all the cells you want to appear in your table view. The identifier you gave the cell is how your code will tell the table view to produce each cell for you to put birthdays in. You’ll see how this works soon.</p>
<div class="box1">
<p class="box-title">
<strong>WORKING WITH DATES</strong>
</p>
<p class="box-p">Swift has a special data type called <span class="code">Date</span>
 that is used for storing date values. A <span class="code">Date</span>
 object is actually a date and a time. Open your playground and enter the following:</p>
<div class="image"><img src="Image00239.jpg" />
</div>
<p class="box-pi">We’ve just assigned the current date and time the code was run to the variable <span class="code">today</span>
 . When you print <span class="code">today</span>
 , it’s in the format <span class="code">"2017-11-21 10:45:31 +0000\n"</span>
 . What if you wanted it to display as <span class="code">Tuesday, November 21, 2017</span>
 , instead? Or just <span class="code">11/21/17</span>
 ? To display a date in a particular way, you use a <em>date formatter</em>
 , which is a <span class="code">DateFormatter</span>
 object that you create and give a date format style. <span class="code">DateFormatter</span>
 is a helper object that is used to create a display string from any date, and a <em>date format style</em>
 is a property of <span class="code">DateFormatter</span>
 that tells the formatter what style to use. You can create your own date format styles manually, but there are also styles that are included in Swift and ready to use. Add the following to your playground:</p>
<div class="image"><img src="Image00240.jpg" />
</div>
<p class="box-pi">At <span class="ent">➊</span>
 you create a <span class="code">formatter</span>
 . Then at <span class="ent">➋</span>
 , you set the style of the <span class="code">formatter</span>
 to <span class="code">Style.full</span>
 , which will print the day of the week as well as the full month name, date, and year. Finally, you create a string from the date using the <span class="code">string(from:)</span>
 method of the <span class="code">DateFormatter</span>
 class <span class="ent">➌</span>
 . You can see that you now have turned the <span id="page_160"></span>
 date into the nicely formatted string <span class="code">"Tuesday, November 21, 2017"</span>
 . <a style=";color:black;" href="text00022.html#ch11tab1">Table 11-1</a>
 shows the different strings that are created from the five <span class="code">DateFormatter.Style</span>
 options available in Swift.</p>
<p class="tabcap"><a id="ch11tab1" style=";color:black;"></a>
 <strong>Table 11-1:</strong>
 Date Formatter Styles and Their Date Strings</p>
<table class="tabled">
<tbody>
<tr>
<td style="vertical-align: top;" class="border1">
<p class="noindent">
<span class="code">
<span class="codestrong">DateFormatter.Style</span>
</span>
</p>
</td>
<td style="vertical-align: top;" class="border1">
<p class="noindent">
<strong>Date string</strong>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">none</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">""</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">short</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"11/21/17"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">medium</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"Nov 21, 2017"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">long</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"November 21, 2017"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">full</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"Tuesday, November 21, 2017"</span>
</p>
</td>
</tr>
</tbody>
</table>
<p class="box-pi">You can also specify your own custom way of displaying a date using the <span class="code">dateFormat</span>
 property of the <span class="code">DateFormatter</span>
 . Perhaps you only want the month and day. Or maybe you want a four-digit year displayed in the <span class="code">short</span>
 style. Doing either is really easy, and you don’t even have to create a new <span class="code">DateFormatter</span>
 —you can just change the <span class="code">dateFormat</span>
 on <span class="code">formatter</span>
 and then ask it for a new string. Add the following code to your playground to display dates with a specific format:</p>
<div class="image"><img src="Image00241.jpg" />
</div>
<p class="box-pi">At <span class="ent">➊</span>
 , you specify that you only want the month and the date in an <span class="code">MM/dd</span>
 format—that is, a two-digit month followed by a two-digit date. If you want to display the month as three letters, then use <span class="code">MMM</span>
 . To display the full name of the month, use <span class="code">MMMM</span>
 . At <span class="ent">➋</span>
 , we change the date format to use a four-digit year. A two-digit year would be <span class="code">yy</span>
 . Here are a few other ways to use a <span class="code">dateFormat</span>
 to display a custom date string.</p>
<div class="image"><img src="Image00242.jpg" />
</div>
<p class="box-pi"><span id="page_161"></span>
 If you want to include separators, you add them to your <span class="code">dateFormat</span>
 string. For example, if you want periods as separators, then you can create a <span class="code">dateFormat</span>
 like <span class="code">"MM.dd.yy"</span>
 <span class="ent">➊</span>
 . To display an abbreviated day of the week, use <span class="code">EEE</span>
 <span class="ent">➋</span>
 . For the full day, use <span class="code">EEEE</span>
 <span class="ent">➌</span>
 . These are only a few examples. By using combinations of <span class="code">M</span>
 , <span class="code">d</span>
 , <span class="code">y</span>
 , and <span class="code">E</span>
 , you have an endless number of ways to display a date!</p>
</div>
<h4 class="h4" id="ch11lev2sec3">
<strong>SETTING UP THE BIRTHDAYS TABLE VIEW CONTROLLER</strong>
</h4>
<p class="noindent">The Birthdays table view controller will display a list of all the birthdays stored in the app. Do you remember what you use to store a list of items? That’s right—an array! You’ll create an array in the <span class="code">BirthdaysTableViewController</span>
 to store all the birthdays. To do this, give the <span class="code">BirthdaysTableViewController</span>
 a <span class="code">birthdays</span>
 property that is an array of <span class="code">Birthday</span>
 objects. At the top of the class, right above the <span class="code">viewDidLoad()</span>
 method, insert this line to add a variable array property called <span class="code">birthdays</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController {</span>
<br />
<br />
    <span class="pink">var</span>
 birthdays = [<span class="green1">Birthday</span>
 ]()<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent">This line creates an empty array of <span class="code">Birthday</span>
 instances. It needs to be a variable and not a constant because you’ll want to add a saved <span class="code">Birthday</span>
 to this array every time the user adds a <span class="code">Birthday</span>
 with the Add Birthday view controller. You’ll see how to do that in “<a href="text00022.html#ch11lev3sec2">Making the Birthdays Table View Controller Conform to Protocol</a>
 ” on <a href="text00022.html#page_168">page 168</a>
 .</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>Remember that the final versions of the project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>.</em>
</p>
</div>
<p class="indent">The <span class="code">BirthdaysTableViewController</span>
 will also need a <span class="code">dateFormatter</span>
 property to display the birthdate as a nicely formatted string. Add a <span class="code">dateFormatter</span>
 right underneath the <span class="code">birthdays</span>
 array:</p>
<div class="box">
<pre>    <span class="ash">var birthdays = [Birthday]()</span>
<br />
<br />
    <span class="pink">let</span>
 dateFormatter = <span class="violet">DateFormatter</span>
 ()<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent">Note that the <span class="code">dateFormatter</span>
 is a constant that is created with <span class="code">let</span>
 . Even though you’ll change the <span class="code">dateFormatter</span>
 ’s properties, like the <span class="code">dateStyle</span>
 and <span class="code">timeStyle</span>
 , you’ll never change the <span class="code">dateFormatter</span>
 itself.</p>
<p class="indent"><span id="page_162"></span>
 You’ll also need to set up the <span class="code">dateFormatter</span>
 so that it will display the birthdates as fully formatted strings like <span class="code">"Tuesday, December 17, 2008"</span>
 . As you saw in <a href="text00021.html#ch10">Chapter 10</a>
 , a good place to do this is the <span class="code">viewDidLoad()</span>
 method, which is called when the Birthdays table view controller is loading its view. This is the perfect place to do any setup that is needed for this class.</p>
<div class="box">
<pre>
<span class="ash">override func viewDidLoad() {</span>
<br />
    <span class="ash">super.viewDidLoad()</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">dateFormatter</span>
 .<span class="violet">dateStyle</span>
 = .<span class="blue">full</span>
<br />
  <span class="ent">➋</span>
 <span class="green1">dateFormatter</span>
 .<span class="violet">timeStyle</span>
 = .<span class="blue">none</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , you set the <span class="code">dateStyle</span>
 of the <span class="code">dateFormatter</span>
 so that it will display a formatted date string for each <span class="code">Birthday</span>
 . Did you notice how we just wrote <span class="code">.full</span>
 instead of <span class="code">DateFormatter.Style.full</span>
 ? Swift knows what type to expect for the <span class="code">dateStyle</span>
 of a <span class="code">DateFormatter</span>
 , so it lets us take this little shortcut. At <span class="ent">➋</span>
 , you set the <span class="code">timeStyle</span>
 of the <span class="code">dateFormatter</span>
 to <span class="code">.none</span>
 so that the time won’t be shown.</p>
<h4 class="h4" id="ch11lev2sec4">
<strong>DISPLAYING BIRTHDAYS IN A TABLE VIEW</strong>
</h4>
<p class="noindent">The <span class="code">BirthdaysTableViewController</span>
 class has a table view that is used to display a list of items in a single column. The table view has one or more sections containing rows, and each row contains a cell. A section in a table view is a grouping of rows that can be displayed with or without a header. An example of an app that shows a table view with several sections is the Settings app, as shown in <a href="text00022.html#ch11fig5">Figure 11-5</a>
 . It displays a list of rows that have been broken up into different sections.</p>
<p class="indent">Each section and row of a table view is identified with an index number. These numbers start at 0 and then increase by 1 as you go down the table view. For example, the Privacy line in the Settings app is found at section 0, row 1. The News setting is at section 1, row 3.</p>
<p class="indent">In the middle of the <span class="code">BirthdaysTableViewController</span>
 class, there is a section called <em>Table view data source</em>
 with three methods. The table view controller uses these methods to determine what’s going to be displayed inside its table view.</p>
<p class="hang">
<span class="code">
<span class="codestrong">numberOfSections(in:)</span>
</span>
 Tells the table view how many sections it should have</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:numberOfRowsInSection:)</span>
</span>
 Tells the table view how many rows will be displayed in each section</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:cellForRowAt:)</span>
</span>
 Sets up each cell that’s going to be displayed in each row of the table view</p>
<div class="image"><span id="page_163"></span>
 <img src="Image00243.jpg" />
</div>
<p class="figcap"><a id="ch11fig5"></a>
 <em>Figure 11-5: The Settings app uses sections to group rows of different device settings.</em>
</p>
<p class="indent">The table view data source methods are called by the table view controller every time the table view is reloaded. Xcode automatically gives you these method templates when you make a subclass of a <span class="code">UITableViewController</span>
 . You need to implement all three methods for the app to work, even though you’ll never call them directly in your code. The <span class="code">UITableViewController</span>
 class implements the <span class="code">UITableViewDataSource</span>
 protocol, which comes with these data source methods, to determine what will be displayed inside the table view. We’ll discuss protocols in “<a href="text00022.html#ch11lev2sec5">Delegation</a>
 ” on page 166. For now, you just need to know that a <span class="code">UITableViewController</span>
 uses these methods to display its content, and it automatically calls these methods so you don’t need to call them.</p>
<p class="indent">Let’s start with the method <span class="code">numberOfSections(in:)</span>
 . The Birthdays table view controller is a list that just displays <span class="code">Birthday</span>
 instances, so it doesn’t need multiple sections. To set the number of sections in the table view, we just need to return <span class="code">1</span>
 .</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func numberOfSections(in tableView: UITableView) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 <span class="blue1">1</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent"><span id="page_164"></span>
 This method takes a <span class="code">UITableView</span>
 called <span class="code">tableView</span>
 as a parameter, which is the table view that uses this class as its data source. We don’t need to worry about making this connection because the <span class="code">UITableViewController</span>
 comes with a built-in table view that is automatically hooked up to these methods. Each birthday will be displayed in its own row. So in <span class="code">tableView(_:numberOfRowsInSection:)</span>
 , in order to have the right number of rows for all of your birthdays, you need to return the number of <span class="code">Birthday</span>
 instances that you have in your <span class="code">birthdays</span>
 array. Do you remember the <span class="code">count</span>
 property of an array? It’s an integer that tells you how many items are in that array, and it’s perfect for this situation! Change this method to the following:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, <img class="inline" src="Image00184.jpg" />
<br />
    numberOfRowsInSection section: Int) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 birthdays.<span class="violet">count</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">In addition to the <span class="code">tableView</span>
 parameter, <span class="code">tableView(_:numberOfRowsInSection:)</span>
 also takes an <span class="code">Int</span>
 called <span class="code">section</span>
 . When the table view is loading itself, this method is called for each section in the table view. In our case, we have only one section, so we don’t need to bother checking which <span class="code">section</span>
 of the table view is being displayed here. We know it’s section 0, and we want it to have as many rows as there are birthdays, so we write <span class="code">return birthdays.count</span>
 .</p>
<p class="indent">Finally, you need to implement <span class="code">tableView(_:cellForRowAt:)</span>
 so that the table view will know what to put inside each cell. Since this method is commented out, you need to uncomment it by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it. (Be careful not to accidentally uncomment the other methods after it!) After you’ve done that, change it to the following code:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, cellForRowAt <img class="inline" src="Image00184.jpg" />
<br />
    indexPath: IndexPath) -&gt; UITableViewCell {</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="pink">let</span>
 cell = tableView.<span class="blue">dequeueReusableCell</span>
 (withIdentifier: <img class="inline" src="Image00093.jpg" />
<br />
        <span class="red">"birthdayCellIdentifier"</span>
 , for: indexPath)<br />
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 birthday = <span class="green1">birthdays</span>
 [indexPath.<span class="violet">row</span>
 ]<br />
<br />
  <span class="ent">➌</span>
 cell.<span class="violet">textLabel</span>
 ?.<span class="violet">text</span>
 = birthday.<span class="green1">firstName</span>
 <span class="blue">+</span>
 <span class="red">" "</span>
 <span class="blue">+</span>
 <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">lastName</span>
<br />
<br />
  <span class="ent">➍</span>
 cell.<span class="violet">detailTextLabel</span>
 ?.<span class="violet">text</span>
 = <span class="green1">dateFormatter</span>
 .<span class="blue">string</span>
 (from: <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">birthdate</span>
 )<br />
<br />
  <span class="ent">➎</span>
 <span class="pink">return</span>
 cell<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">You don’t call the method <span class="code">tableView(_:cellForRowAt:)</span>
 . It’s called when the table view is loaded onto the screen. It’s called for each cell on the screen and takes two parameters, <span class="code">tableView</span>
 and <span class="code">indexPath</span>
 . You already know <span id="page_165"></span>
 what the <span class="code">tableView</span>
 parameter is for. An <span class="code">IndexPath</span>
 is a Swift struct that’s used to represent a row’s position in a table view. An <span class="code">IndexPath</span>
 instance has a <span class="code">section</span>
 property and a <span class="code">row</span>
 property. Since this method will be called many times (once for every row in the table), we need the <span class="code">indexPath</span>
 to know which section and row we’re currently configuring. The <span class="code">indexPath.section</span>
 property gives the section number, and the <span class="code">indexPath.row</span>
 gives the row of the table view cell. The five lines of code inside <span class="code">tableView(_:cellForRowAt:)</span>
 will do the following:</p>
<div class="image"><img src="Image00244.jpg" />
</div>
<p class="bull">• Create a <span class="code">UITableViewCell</span>
</p>
<p class="bull">• Figure out which <span class="code">Birthday</span>
 in the <span class="code">birthdays</span>
 array will be displayed inside the cell</p>
<p class="bull">• Make two labels to display the birthday person’s name and birthdate in the cell</p>
<p class="bull">• Return the cell ready for display in the table view</p>
<p class="indentt">Let’s go through this code line by line.</p>
<p class="indent">First, create the <span class="code">UITableViewCell</span>
 . The code at <span class="ent">➊</span>
 does this using the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 . Before you can start using this method on a cell, though, you need to tell the method which cell you want to use from the storyboard. Earlier, when you were in the storyboard, you gave your cell the identifier <span class="code">birthdayCellIdentifier</span>
 (see <a href="text00022.html#ch11fig4">Figure 11-4</a>
 ). This identifier links your code to the cell and tells your method that it’s using the right cell. The string for when you call this method needs to be exactly the same as the string you set in the storyboard, or you’ll get an error and the app will crash when you run it.</p>
<p class="indent">In the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 , did you notice the words <em>Reusable Cell</em>
 ? The cells inside a table view are created once and then can be reused over and over. This helps everything run faster and smoother because creating the cell is what takes the most time. If you had 200 birthdays in your app, but only 10 would fit on your screen at one time, then you need only 10 cells to show your birthdays. When you scroll down to reveal more birthdays, the cells that scroll off the top of the screen are reused. They are filled with new information and show up again at the bottom of the screen. The <span class="code">UITableView</span>
 automatically does this work. When the table view is loaded, <span class="code">tableView(_:cellForRowAt:)</span>
 is called for every visible row. When the user scrolls to look at more cells, it’s called again for each row just as it is about to appear on the screen.</p>
<p class="indent">Next, we need to find out which <span class="code">Birthday</span>
 should be displayed inside the cell. We want to display one birthday from the <span class="code">birthdays</span>
 array in each row. The first birthday, which is at <span class="code">birthdays[0]</span>
 , should be displayed in row 0. The second birthday, at <span class="code">birthdays[1]</span>
 , should be displayed in row 1, and so on, which means the <span class="code">indexPath</span>
 ’s <span class="code">row</span>
 is the same as the position in the <span class="code">birthdays</span>
 array that we want to access. The code at <span class="ent">➋</span>
 accesses the <span id="page_166"></span>
 correct <span class="code">Birthday</span>
 object from the <span class="code">birthdays</span>
 array by using <span class="code">indexPath.row</span>
 . Once we have the right <span class="code">Birthday</span>
 object, we assign it to a constant named <span class="code">birthday</span>
 so we can set up the labels in this cell.</p>
<p class="indent">Notice that we’re using <span class="code">let</span>
 to assign the <span class="code">birthday</span>
 to a constant instead of a variable. We can use <span class="code">let</span>
 because each time <span class="code">tableView(_:cellForRowAt:)</span>
 is called, a new <span class="code">birthday</span>
 constant is created. Each cell gets its own <span class="code">birthday</span>
 constant that is assigned its own <span class="code">Birthday</span>
 object. Since we’re not going to change any of the <span class="code">birthday</span>
 constants—we’re just going to read their properties—we don’t want to make them variables.</p>
<p class="indent">Now that you have your cell and your birthday, it’s time to fill in the details. You need two labels for each cell to show the birthday person’s name and birthdate. You set the cell to the Subtitle style so that it has a Title label and a Subtitle label. Each cell will already contain these labels, so now you don’t have to create any labels yourself.</p>
<p class="indent">The labels exist as properties of <span class="code">UITableViewCell</span>
 and are called <span class="code">textLabel</span>
 and <span class="code">detailTextLabel</span>
 . The code at <span class="ent">➌</span>
 sets the text of the <span class="code">textLabel</span>
 to a string made up of the <span class="code">firstName</span>
 and <span class="code">lastName</span>
 of the <span class="code">birthday</span>
 with a space between them. At <span class="ent">➍</span>
 , you use the <span class="code">string(from:)</span>
 method of the <span class="code">dateFormatter</span>
 to display the birthdate in the <span class="code">detailTextLabel</span>
 .</p>
<p class="indent">When your cell is completely configured, <span class="code">tableView( _:cellForRowAt:)</span>
 returns the cell at <span class="ent">➎</span>
 so that it can be displayed at that <span class="code">indexPath</span>
 of the table view.</p>
<h3 class="h3" id="ch11lev1sec2">
<strong>PUTTING IT ALL TOGETHER</strong>
</h3>
<p class="noindent">Now you can add <span class="code">Birthday</span>
 instances to the app using the Add Birthday view controller, and you have a table view to list each <span class="code">Birthday</span>
 in the Birthdays table view controller. But when you try running the app and adding a <span class="code">Birthday</span>
 , it doesn’t appear. To make each <span class="code">Birthday</span>
 you add appear in the table view, you need to make the Add Birthday view controller communicate with the Birthdays table view controller. You do this by using <em>delegation</em>
 .</p>
<h4 class="h4" id="ch11lev2sec5">
<strong>DELEGATION</strong>
</h4>
<p class="noindent">Delegation can be used when one view controller needs to get information from another view controller. Say you have two view controllers: A and B. The first view controller, A, creates B and presents B on top of itself. A knows about B because it created and presented B, so A can pass information along to B. But B doesn’t know about A—it’s just popped into being and doesn’t know where it came from or how it got there. So how can B talk to A? Through delegation!</p>
<div class="image"><img src="Image00245.jpg" />
</div>
<p class="indent">Delegation is when someone gives a job or a task to someone else. A <em>delegate</em>
 is like a boss who tells a delegating employee what to do. When the delegating employee is done with their task, sometimes they’ll report information back to the delegate boss.</p>
<p class="indent"><span id="page_167"></span>
 Delegation in Swift is pretty similar, but instead of having a boss and employee, we have a delegate and a delegating object. Since class B is the one being told what to do by class A, it’s the delegating object. We give class B a special property called a delegate to tell it who its delegate is—that way, it knows who to communicate with. The delegate can be any class that has a set of methods that have been defined in a <em>protocol</em>
 . A protocol is like an agreement between the two classes that tells them what the delegate can ask the delegating object to do. It has a list of method and property names that the delegate can use with the delegating object.</p>
<p class="indent">Class A creates class B, makes itself the delegate of class B, and gives class B a job to do that’s in the protocol. Once class B is done with its job, it reports back to class A. Let’s see how this works in our app.</p>
<p class="indent">The Birthdays table view controller is view controller A, and the Add Birthday view controller is view controller B. We’ll create a protocol called <span class="code">AddBirthdayViewControllerDelegate</span>
 and a method for that protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 , which the Add Birthday view controller will use to report back.</p>
<p class="indent">Take a look at <a href="text00022.html#ch11fig6">Figure 11-6</a>
 . When the user taps the Add button <span class="ent">➊</span>
 , the Birthdays table view controller creates the Add Birthday view controller <span class="ent">➋</span>
 and sets itself as the Add Birthday view controller’s delegate.</p>
<div class="image"><img src="Image00246.jpg" />
</div>
<p class="figcap"><a id="ch11fig6"></a>
 <em>Figure 11-6: A new birthday is added and passed from the Add Birthday view controller to the Birthdays table view controller using delegation.</em>
</p>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="indent">Next, you need to make the Birthdays table view controller the <span class="code">BirthdaysTableViewController</span>
 class. To do this, go to <em>Main.storyboard</em>
 and select the <strong>Birthdays</strong>
 scene. Using the Identity Inspector in the right pane, change the class from <span class="code">UITableViewController</span>
 to <span class="code">BirthdaysTableViewController</span>
 , as shown in <a href="text00022.html#ch11fig3">Figure 11-3</a>
 .</p>
<div class="image"><span id="page_158"></span>
 <img src="Image00236.jpg" />
</div>
<p class="figcap"><a id="ch11fig3"></a>
 <em>Figure 11-3: Setting</em>
 <span class="code">
<span class="italic">BirthdaysTableViewController</span>
</span>
 <em>as the class of the Birthdays scene</em>
</p>
<p class="indent">Now that you have the Birthdays table view controller set up in the storyboard, the next step is to make cells in your table that will display each birthday.</p>
<h4 class="h4" id="ch11lev2sec2">
<strong>ADDING CELLS TO THE TABLE VIEW</strong>
</h4>
<p class="noindent">Each birthday will be displayed in a <span class="code">UITableViewCell</span>
 in the Birthdays table view controller. A table has boxes organized into rows and columns that contain information. These boxes are called <em>cells</em>
 . Similarly, a table view also has cells that are all instances of, or a subclass of, the <span class="code">UITableViewCell</span>
 class. We’ll put each birthday into its own cell in our table view.</p>
<p class="indent">We’ll start by creating those cells in the storyboard, and then we’ll fill them with our <span class="code">Birthday</span>
 objects later. In the left outline menu, click the triangle by Birthdays and then click the triangle by Table View to open those sections. Then select <strong>Table View Cell</strong>
 <span class="ent">➊</span>
 , as shown in <a href="text00022.html#ch11fig4">Figure 11-4</a>
 .</p>
<div class="image"><img src="Image00237.jpg" />
</div>
<div class="image"><img src="Image00238.jpg" />
</div>
<p class="figcap"><a id="ch11fig4"></a>
 <em>Figure 11-4: Creating a Subtitle style table view cell and setting its identifier</em>
</p>
<p class="indent"><span id="page_159"></span>
 Next, open the Attributes Inspector. Using the drop-down menu under <strong>Style</strong>
 , set the cell’s style to <strong>Subtitle</strong>
 <span class="ent">➋</span>
 so that the cell now has a Title label and a Subtitle label. You’ll display each person’s name in the Title and birthday in the Subtitle.</p>
<p class="indent">Finally, enter <span class="code">
<span class="codestrong">birthdayCellIdentifier</span>
</span>
 in the Identifier field <span class="ent">➌</span>
 . You’ll use this identifier later when you fill in the cell contents.</p>
<p class="indent">That’s it! You’ve finished your work in the storyboard.</p>
<p class="indent">You may be wondering why we have just one cell in our table view in the storyboard when we’ll have more than one birthday to show in the list. If you look at <a href="text00022.html#ch11fig4">Figure 11-4</a>
 again, you’ll notice that the cell is labeled <em>Prototype Cells</em>
 . This means that the cell you just customized is a <em>template</em>
 for all the cells you want to appear in your table view. The identifier you gave the cell is how your code will tell the table view to produce each cell for you to put birthdays in. You’ll see how this works soon.</p>
<div class="box1">
<p class="box-title">
<strong>WORKING WITH DATES</strong>
</p>
<p class="box-p">Swift has a special data type called <span class="code">Date</span>
 that is used for storing date values. A <span class="code">Date</span>
 object is actually a date and a time. Open your playground and enter the following:</p>
<div class="image"><img src="Image00239.jpg" />
</div>
<p class="box-pi">We’ve just assigned the current date and time the code was run to the variable <span class="code">today</span>
 . When you print <span class="code">today</span>
 , it’s in the format <span class="code">"2017-11-21 10:45:31 +0000\n"</span>
 . What if you wanted it to display as <span class="code">Tuesday, November 21, 2017</span>
 , instead? Or just <span class="code">11/21/17</span>
 ? To display a date in a particular way, you use a <em>date formatter</em>
 , which is a <span class="code">DateFormatter</span>
 object that you create and give a date format style. <span class="code">DateFormatter</span>
 is a helper object that is used to create a display string from any date, and a <em>date format style</em>
 is a property of <span class="code">DateFormatter</span>
 that tells the formatter what style to use. You can create your own date format styles manually, but there are also styles that are included in Swift and ready to use. Add the following to your playground:</p>
<div class="image"><img src="Image00240.jpg" />
</div>
<p class="box-pi">At <span class="ent">➊</span>
 you create a <span class="code">formatter</span>
 . Then at <span class="ent">➋</span>
 , you set the style of the <span class="code">formatter</span>
 to <span class="code">Style.full</span>
 , which will print the day of the week as well as the full month name, date, and year. Finally, you create a string from the date using the <span class="code">string(from:)</span>
 method of the <span class="code">DateFormatter</span>
 class <span class="ent">➌</span>
 . You can see that you now have turned the <span id="page_160"></span>
 date into the nicely formatted string <span class="code">"Tuesday, November 21, 2017"</span>
 . <a style=";color:black;" href="text00022.html#ch11tab1">Table 11-1</a>
 shows the different strings that are created from the five <span class="code">DateFormatter.Style</span>
 options available in Swift.</p>
<p class="tabcap"><a id="ch11tab1" style=";color:black;"></a>
 <strong>Table 11-1:</strong>
 Date Formatter Styles and Their Date Strings</p>
<table class="tabled">
<tbody>
<tr>
<td style="vertical-align: top;" class="border1">
<p class="noindent">
<span class="code">
<span class="codestrong">DateFormatter.Style</span>
</span>
</p>
</td>
<td style="vertical-align: top;" class="border1">
<p class="noindent">
<strong>Date string</strong>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">none</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">""</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">short</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"11/21/17"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">medium</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"Nov 21, 2017"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">long</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"November 21, 2017"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">full</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"Tuesday, November 21, 2017"</span>
</p>
</td>
</tr>
</tbody>
</table>
<p class="box-pi">You can also specify your own custom way of displaying a date using the <span class="code">dateFormat</span>
 property of the <span class="code">DateFormatter</span>
 . Perhaps you only want the month and day. Or maybe you want a four-digit year displayed in the <span class="code">short</span>
 style. Doing either is really easy, and you don’t even have to create a new <span class="code">DateFormatter</span>
 —you can just change the <span class="code">dateFormat</span>
 on <span class="code">formatter</span>
 and then ask it for a new string. Add the following code to your playground to display dates with a specific format:</p>
<div class="image"><img src="Image00241.jpg" />
</div>
<p class="box-pi">At <span class="ent">➊</span>
 , you specify that you only want the month and the date in an <span class="code">MM/dd</span>
 format—that is, a two-digit month followed by a two-digit date. If you want to display the month as three letters, then use <span class="code">MMM</span>
 . To display the full name of the month, use <span class="code">MMMM</span>
 . At <span class="ent">➋</span>
 , we change the date format to use a four-digit year. A two-digit year would be <span class="code">yy</span>
 . Here are a few other ways to use a <span class="code">dateFormat</span>
 to display a custom date string.</p>
<div class="image"><img src="Image00242.jpg" />
</div>
<p class="box-pi"><span id="page_161"></span>
 If you want to include separators, you add them to your <span class="code">dateFormat</span>
 string. For example, if you want periods as separators, then you can create a <span class="code">dateFormat</span>
 like <span class="code">"MM.dd.yy"</span>
 <span class="ent">➊</span>
 . To display an abbreviated day of the week, use <span class="code">EEE</span>
 <span class="ent">➋</span>
 . For the full day, use <span class="code">EEEE</span>
 <span class="ent">➌</span>
 . These are only a few examples. By using combinations of <span class="code">M</span>
 , <span class="code">d</span>
 , <span class="code">y</span>
 , and <span class="code">E</span>
 , you have an endless number of ways to display a date!</p>
</div>
<h4 class="h4" id="ch11lev2sec3">
<strong>SETTING UP THE BIRTHDAYS TABLE VIEW CONTROLLER</strong>
</h4>
<p class="noindent">The Birthdays table view controller will display a list of all the birthdays stored in the app. Do you remember what you use to store a list of items? That’s right—an array! You’ll create an array in the <span class="code">BirthdaysTableViewController</span>
 to store all the birthdays. To do this, give the <span class="code">BirthdaysTableViewController</span>
 a <span class="code">birthdays</span>
 property that is an array of <span class="code">Birthday</span>
 objects. At the top of the class, right above the <span class="code">viewDidLoad()</span>
 method, insert this line to add a variable array property called <span class="code">birthdays</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController {</span>
<br />
<br />
    <span class="pink">var</span>
 birthdays = [<span class="green1">Birthday</span>
 ]()<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent">This line creates an empty array of <span class="code">Birthday</span>
 instances. It needs to be a variable and not a constant because you’ll want to add a saved <span class="code">Birthday</span>
 to this array every time the user adds a <span class="code">Birthday</span>
 with the Add Birthday view controller. You’ll see how to do that in “<a href="text00022.html#ch11lev3sec2">Making the Birthdays Table View Controller Conform to Protocol</a>
 ” on <a href="text00022.html#page_168">page 168</a>
 .</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>Remember that the final versions of the project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>.</em>
</p>
</div>
<p class="indent">The <span class="code">BirthdaysTableViewController</span>
 will also need a <span class="code">dateFormatter</span>
 property to display the birthdate as a nicely formatted string. Add a <span class="code">dateFormatter</span>
 right underneath the <span class="code">birthdays</span>
 array:</p>
<div class="box">
<pre>    <span class="ash">var birthdays = [Birthday]()</span>
<br />
<br />
    <span class="pink">let</span>
 dateFormatter = <span class="violet">DateFormatter</span>
 ()<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent">Note that the <span class="code">dateFormatter</span>
 is a constant that is created with <span class="code">let</span>
 . Even though you’ll change the <span class="code">dateFormatter</span>
 ’s properties, like the <span class="code">dateStyle</span>
 and <span class="code">timeStyle</span>
 , you’ll never change the <span class="code">dateFormatter</span>
 itself.</p>
<p class="indent"><span id="page_162"></span>
 You’ll also need to set up the <span class="code">dateFormatter</span>
 so that it will display the birthdates as fully formatted strings like <span class="code">"Tuesday, December 17, 2008"</span>
 . As you saw in <a href="text00021.html#ch10">Chapter 10</a>
 , a good place to do this is the <span class="code">viewDidLoad()</span>
 method, which is called when the Birthdays table view controller is loading its view. This is the perfect place to do any setup that is needed for this class.</p>
<div class="box">
<pre>
<span class="ash">override func viewDidLoad() {</span>
<br />
    <span class="ash">super.viewDidLoad()</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">dateFormatter</span>
 .<span class="violet">dateStyle</span>
 = .<span class="blue">full</span>
<br />
  <span class="ent">➋</span>
 <span class="green1">dateFormatter</span>
 .<span class="violet">timeStyle</span>
 = .<span class="blue">none</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , you set the <span class="code">dateStyle</span>
 of the <span class="code">dateFormatter</span>
 so that it will display a formatted date string for each <span class="code">Birthday</span>
 . Did you notice how we just wrote <span class="code">.full</span>
 instead of <span class="code">DateFormatter.Style.full</span>
 ? Swift knows what type to expect for the <span class="code">dateStyle</span>
 of a <span class="code">DateFormatter</span>
 , so it lets us take this little shortcut. At <span class="ent">➋</span>
 , you set the <span class="code">timeStyle</span>
 of the <span class="code">dateFormatter</span>
 to <span class="code">.none</span>
 so that the time won’t be shown.</p>
<h4 class="h4" id="ch11lev2sec4">
<strong>DISPLAYING BIRTHDAYS IN A TABLE VIEW</strong>
</h4>
<p class="noindent">The <span class="code">BirthdaysTableViewController</span>
 class has a table view that is used to display a list of items in a single column. The table view has one or more sections containing rows, and each row contains a cell. A section in a table view is a grouping of rows that can be displayed with or without a header. An example of an app that shows a table view with several sections is the Settings app, as shown in <a href="text00022.html#ch11fig5">Figure 11-5</a>
 . It displays a list of rows that have been broken up into different sections.</p>
<p class="indent">Each section and row of a table view is identified with an index number. These numbers start at 0 and then increase by 1 as you go down the table view. For example, the Privacy line in the Settings app is found at section 0, row 1. The News setting is at section 1, row 3.</p>
<p class="indent">In the middle of the <span class="code">BirthdaysTableViewController</span>
 class, there is a section called <em>Table view data source</em>
 with three methods. The table view controller uses these methods to determine what’s going to be displayed inside its table view.</p>
<p class="hang">
<span class="code">
<span class="codestrong">numberOfSections(in:)</span>
</span>
 Tells the table view how many sections it should have</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:numberOfRowsInSection:)</span>
</span>
 Tells the table view how many rows will be displayed in each section</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:cellForRowAt:)</span>
</span>
 Sets up each cell that’s going to be displayed in each row of the table view</p>
<div class="image"><span id="page_163"></span>
 <img src="Image00243.jpg" />
</div>
<p class="figcap"><a id="ch11fig5"></a>
 <em>Figure 11-5: The Settings app uses sections to group rows of different device settings.</em>
</p>
<p class="indent">The table view data source methods are called by the table view controller every time the table view is reloaded. Xcode automatically gives you these method templates when you make a subclass of a <span class="code">UITableViewController</span>
 . You need to implement all three methods for the app to work, even though you’ll never call them directly in your code. The <span class="code">UITableViewController</span>
 class implements the <span class="code">UITableViewDataSource</span>
 protocol, which comes with these data source methods, to determine what will be displayed inside the table view. We’ll discuss protocols in “<a href="text00022.html#ch11lev2sec5">Delegation</a>
 ” on page 166. For now, you just need to know that a <span class="code">UITableViewController</span>
 uses these methods to display its content, and it automatically calls these methods so you don’t need to call them.</p>
<p class="indent">Let’s start with the method <span class="code">numberOfSections(in:)</span>
 . The Birthdays table view controller is a list that just displays <span class="code">Birthday</span>
 instances, so it doesn’t need multiple sections. To set the number of sections in the table view, we just need to return <span class="code">1</span>
 .</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func numberOfSections(in tableView: UITableView) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 <span class="blue1">1</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent"><span id="page_164"></span>
 This method takes a <span class="code">UITableView</span>
 called <span class="code">tableView</span>
 as a parameter, which is the table view that uses this class as its data source. We don’t need to worry about making this connection because the <span class="code">UITableViewController</span>
 comes with a built-in table view that is automatically hooked up to these methods. Each birthday will be displayed in its own row. So in <span class="code">tableView(_:numberOfRowsInSection:)</span>
 , in order to have the right number of rows for all of your birthdays, you need to return the number of <span class="code">Birthday</span>
 instances that you have in your <span class="code">birthdays</span>
 array. Do you remember the <span class="code">count</span>
 property of an array? It’s an integer that tells you how many items are in that array, and it’s perfect for this situation! Change this method to the following:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, <img class="inline" src="Image00184.jpg" />
<br />
    numberOfRowsInSection section: Int) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 birthdays.<span class="violet">count</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">In addition to the <span class="code">tableView</span>
 parameter, <span class="code">tableView(_:numberOfRowsInSection:)</span>
 also takes an <span class="code">Int</span>
 called <span class="code">section</span>
 . When the table view is loading itself, this method is called for each section in the table view. In our case, we have only one section, so we don’t need to bother checking which <span class="code">section</span>
 of the table view is being displayed here. We know it’s section 0, and we want it to have as many rows as there are birthdays, so we write <span class="code">return birthdays.count</span>
 .</p>
<p class="indent">Finally, you need to implement <span class="code">tableView(_:cellForRowAt:)</span>
 so that the table view will know what to put inside each cell. Since this method is commented out, you need to uncomment it by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it. (Be careful not to accidentally uncomment the other methods after it!) After you’ve done that, change it to the following code:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, cellForRowAt <img class="inline" src="Image00184.jpg" />
<br />
    indexPath: IndexPath) -&gt; UITableViewCell {</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="pink">let</span>
 cell = tableView.<span class="blue">dequeueReusableCell</span>
 (withIdentifier: <img class="inline" src="Image00093.jpg" />
<br />
        <span class="red">"birthdayCellIdentifier"</span>
 , for: indexPath)<br />
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 birthday = <span class="green1">birthdays</span>
 [indexPath.<span class="violet">row</span>
 ]<br />
<br />
  <span class="ent">➌</span>
 cell.<span class="violet">textLabel</span>
 ?.<span class="violet">text</span>
 = birthday.<span class="green1">firstName</span>
 <span class="blue">+</span>
 <span class="red">" "</span>
 <span class="blue">+</span>
 <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">lastName</span>
<br />
<br />
  <span class="ent">➍</span>
 cell.<span class="violet">detailTextLabel</span>
 ?.<span class="violet">text</span>
 = <span class="green1">dateFormatter</span>
 .<span class="blue">string</span>
 (from: <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">birthdate</span>
 )<br />
<br />
  <span class="ent">➎</span>
 <span class="pink">return</span>
 cell<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">You don’t call the method <span class="code">tableView(_:cellForRowAt:)</span>
 . It’s called when the table view is loaded onto the screen. It’s called for each cell on the screen and takes two parameters, <span class="code">tableView</span>
 and <span class="code">indexPath</span>
 . You already know <span id="page_165"></span>
 what the <span class="code">tableView</span>
 parameter is for. An <span class="code">IndexPath</span>
 is a Swift struct that’s used to represent a row’s position in a table view. An <span class="code">IndexPath</span>
 instance has a <span class="code">section</span>
 property and a <span class="code">row</span>
 property. Since this method will be called many times (once for every row in the table), we need the <span class="code">indexPath</span>
 to know which section and row we’re currently configuring. The <span class="code">indexPath.section</span>
 property gives the section number, and the <span class="code">indexPath.row</span>
 gives the row of the table view cell. The five lines of code inside <span class="code">tableView(_:cellForRowAt:)</span>
 will do the following:</p>
<div class="image"><img src="Image00244.jpg" />
</div>
<p class="bull">• Create a <span class="code">UITableViewCell</span>
</p>
<p class="bull">• Figure out which <span class="code">Birthday</span>
 in the <span class="code">birthdays</span>
 array will be displayed inside the cell</p>
<p class="bull">• Make two labels to display the birthday person’s name and birthdate in the cell</p>
<p class="bull">• Return the cell ready for display in the table view</p>
<p class="indentt">Let’s go through this code line by line.</p>
<p class="indent">First, create the <span class="code">UITableViewCell</span>
 . The code at <span class="ent">➊</span>
 does this using the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 . Before you can start using this method on a cell, though, you need to tell the method which cell you want to use from the storyboard. Earlier, when you were in the storyboard, you gave your cell the identifier <span class="code">birthdayCellIdentifier</span>
 (see <a href="text00022.html#ch11fig4">Figure 11-4</a>
 ). This identifier links your code to the cell and tells your method that it’s using the right cell. The string for when you call this method needs to be exactly the same as the string you set in the storyboard, or you’ll get an error and the app will crash when you run it.</p>
<p class="indent">In the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 , did you notice the words <em>Reusable Cell</em>
 ? The cells inside a table view are created once and then can be reused over and over. This helps everything run faster and smoother because creating the cell is what takes the most time. If you had 200 birthdays in your app, but only 10 would fit on your screen at one time, then you need only 10 cells to show your birthdays. When you scroll down to reveal more birthdays, the cells that scroll off the top of the screen are reused. They are filled with new information and show up again at the bottom of the screen. The <span class="code">UITableView</span>
 automatically does this work. When the table view is loaded, <span class="code">tableView(_:cellForRowAt:)</span>
 is called for every visible row. When the user scrolls to look at more cells, it’s called again for each row just as it is about to appear on the screen.</p>
<p class="indent">Next, we need to find out which <span class="code">Birthday</span>
 should be displayed inside the cell. We want to display one birthday from the <span class="code">birthdays</span>
 array in each row. The first birthday, which is at <span class="code">birthdays[0]</span>
 , should be displayed in row 0. The second birthday, at <span class="code">birthdays[1]</span>
 , should be displayed in row 1, and so on, which means the <span class="code">indexPath</span>
 ’s <span class="code">row</span>
 is the same as the position in the <span class="code">birthdays</span>
 array that we want to access. The code at <span class="ent">➋</span>
 accesses the <span id="page_166"></span>
 correct <span class="code">Birthday</span>
 object from the <span class="code">birthdays</span>
 array by using <span class="code">indexPath.row</span>
 . Once we have the right <span class="code">Birthday</span>
 object, we assign it to a constant named <span class="code">birthday</span>
 so we can set up the labels in this cell.</p>
<p class="indent">Notice that we’re using <span class="code">let</span>
 to assign the <span class="code">birthday</span>
 to a constant instead of a variable. We can use <span class="code">let</span>
 because each time <span class="code">tableView(_:cellForRowAt:)</span>
 is called, a new <span class="code">birthday</span>
 constant is created. Each cell gets its own <span class="code">birthday</span>
 constant that is assigned its own <span class="code">Birthday</span>
 object. Since we’re not going to change any of the <span class="code">birthday</span>
 constants—we’re just going to read their properties—we don’t want to make them variables.</p>
<p class="indent">Now that you have your cell and your birthday, it’s time to fill in the details. You need two labels for each cell to show the birthday person’s name and birthdate. You set the cell to the Subtitle style so that it has a Title label and a Subtitle label. Each cell will already contain these labels, so now you don’t have to create any labels yourself.</p>
<p class="indent">The labels exist as properties of <span class="code">UITableViewCell</span>
 and are called <span class="code">textLabel</span>
 and <span class="code">detailTextLabel</span>
 . The code at <span class="ent">➌</span>
 sets the text of the <span class="code">textLabel</span>
 to a string made up of the <span class="code">firstName</span>
 and <span class="code">lastName</span>
 of the <span class="code">birthday</span>
 with a space between them. At <span class="ent">➍</span>
 , you use the <span class="code">string(from:)</span>
 method of the <span class="code">dateFormatter</span>
 to display the birthdate in the <span class="code">detailTextLabel</span>
 .</p>
<p class="indent">When your cell is completely configured, <span class="code">tableView( _:cellForRowAt:)</span>
 returns the cell at <span class="ent">➎</span>
 so that it can be displayed at that <span class="code">indexPath</span>
 of the table view.</p>
<h3 class="h3" id="ch11lev1sec2">
<strong>PUTTING IT ALL TOGETHER</strong>
</h3>
<p class="noindent">Now you can add <span class="code">Birthday</span>
 instances to the app using the Add Birthday view controller, and you have a table view to list each <span class="code">Birthday</span>
 in the Birthdays table view controller. But when you try running the app and adding a <span class="code">Birthday</span>
 , it doesn’t appear. To make each <span class="code">Birthday</span>
 you add appear in the table view, you need to make the Add Birthday view controller communicate with the Birthdays table view controller. You do this by using <em>delegation</em>
 .</p>
<h4 class="h4" id="ch11lev2sec5">
<strong>DELEGATION</strong>
</h4>
<p class="noindent">Delegation can be used when one view controller needs to get information from another view controller. Say you have two view controllers: A and B. The first view controller, A, creates B and presents B on top of itself. A knows about B because it created and presented B, so A can pass information along to B. But B doesn’t know about A—it’s just popped into being and doesn’t know where it came from or how it got there. So how can B talk to A? Through delegation!</p>
<div class="image"><img src="Image00245.jpg" />
</div>
<p class="indent">Delegation is when someone gives a job or a task to someone else. A <em>delegate</em>
 is like a boss who tells a delegating employee what to do. When the delegating employee is done with their task, sometimes they’ll report information back to the delegate boss.</p>
<p class="indent"><span id="page_167"></span>
 Delegation in Swift is pretty similar, but instead of having a boss and employee, we have a delegate and a delegating object. Since class B is the one being told what to do by class A, it’s the delegating object. We give class B a special property called a delegate to tell it who its delegate is—that way, it knows who to communicate with. The delegate can be any class that has a set of methods that have been defined in a <em>protocol</em>
 . A protocol is like an agreement between the two classes that tells them what the delegate can ask the delegating object to do. It has a list of method and property names that the delegate can use with the delegating object.</p>
<p class="indent">Class A creates class B, makes itself the delegate of class B, and gives class B a job to do that’s in the protocol. Once class B is done with its job, it reports back to class A. Let’s see how this works in our app.</p>
<p class="indent">The Birthdays table view controller is view controller A, and the Add Birthday view controller is view controller B. We’ll create a protocol called <span class="code">AddBirthdayViewControllerDelegate</span>
 and a method for that protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 , which the Add Birthday view controller will use to report back.</p>
<p class="indent">Take a look at <a href="text00022.html#ch11fig6">Figure 11-6</a>
 . When the user taps the Add button <span class="ent">➊</span>
 , the Birthdays table view controller creates the Add Birthday view controller <span class="ent">➋</span>
 and sets itself as the Add Birthday view controller’s delegate.</p>
<div class="image"><img src="Image00246.jpg" />
</div>
<p class="figcap"><a id="ch11fig6"></a>
 <em>Figure 11-6: A new birthday is added and passed from the Add Birthday view controller to the Birthdays table view controller using delegation.</em>
</p>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<div class="image"><span id="page_158"></span>
 <img src="Image00236.jpg" />
</div>
<p class="figcap"><a id="ch11fig3"></a>
 <em>Figure 11-3: Setting</em>
 <span class="code">
<span class="italic">BirthdaysTableViewController</span>
</span>
 <em>as the class of the Birthdays scene</em>
</p>
<p class="indent">Now that you have the Birthdays table view controller set up in the storyboard, the next step is to make cells in your table that will display each birthday.</p>
<h4 class="h4" id="ch11lev2sec2">
<strong>ADDING CELLS TO THE TABLE VIEW</strong>
</h4>
<p class="noindent">Each birthday will be displayed in a <span class="code">UITableViewCell</span>
 in the Birthdays table view controller. A table has boxes organized into rows and columns that contain information. These boxes are called <em>cells</em>
 . Similarly, a table view also has cells that are all instances of, or a subclass of, the <span class="code">UITableViewCell</span>
 class. We’ll put each birthday into its own cell in our table view.</p>
<p class="indent">We’ll start by creating those cells in the storyboard, and then we’ll fill them with our <span class="code">Birthday</span>
 objects later. In the left outline menu, click the triangle by Birthdays and then click the triangle by Table View to open those sections. Then select <strong>Table View Cell</strong>
 <span class="ent">➊</span>
 , as shown in <a href="text00022.html#ch11fig4">Figure 11-4</a>
 .</p>
<div class="image"><img src="Image00237.jpg" />
</div>
<div class="image"><img src="Image00238.jpg" />
</div>
<p class="figcap"><a id="ch11fig4"></a>
 <em>Figure 11-4: Creating a Subtitle style table view cell and setting its identifier</em>
</p>
<p class="indent"><span id="page_159"></span>
 Next, open the Attributes Inspector. Using the drop-down menu under <strong>Style</strong>
 , set the cell’s style to <strong>Subtitle</strong>
 <span class="ent">➋</span>
 so that the cell now has a Title label and a Subtitle label. You’ll display each person’s name in the Title and birthday in the Subtitle.</p>
<p class="indent">Finally, enter <span class="code">
<span class="codestrong">birthdayCellIdentifier</span>
</span>
 in the Identifier field <span class="ent">➌</span>
 . You’ll use this identifier later when you fill in the cell contents.</p>
<p class="indent">That’s it! You’ve finished your work in the storyboard.</p>
<p class="indent">You may be wondering why we have just one cell in our table view in the storyboard when we’ll have more than one birthday to show in the list. If you look at <a href="text00022.html#ch11fig4">Figure 11-4</a>
 again, you’ll notice that the cell is labeled <em>Prototype Cells</em>
 . This means that the cell you just customized is a <em>template</em>
 for all the cells you want to appear in your table view. The identifier you gave the cell is how your code will tell the table view to produce each cell for you to put birthdays in. You’ll see how this works soon.</p>
<div class="box1">
<p class="box-title">
<strong>WORKING WITH DATES</strong>
</p>
<p class="box-p">Swift has a special data type called <span class="code">Date</span>
 that is used for storing date values. A <span class="code">Date</span>
 object is actually a date and a time. Open your playground and enter the following:</p>
<div class="image"><img src="Image00239.jpg" />
</div>
<p class="box-pi">We’ve just assigned the current date and time the code was run to the variable <span class="code">today</span>
 . When you print <span class="code">today</span>
 , it’s in the format <span class="code">"2017-11-21 10:45:31 +0000\n"</span>
 . What if you wanted it to display as <span class="code">Tuesday, November 21, 2017</span>
 , instead? Or just <span class="code">11/21/17</span>
 ? To display a date in a particular way, you use a <em>date formatter</em>
 , which is a <span class="code">DateFormatter</span>
 object that you create and give a date format style. <span class="code">DateFormatter</span>
 is a helper object that is used to create a display string from any date, and a <em>date format style</em>
 is a property of <span class="code">DateFormatter</span>
 that tells the formatter what style to use. You can create your own date format styles manually, but there are also styles that are included in Swift and ready to use. Add the following to your playground:</p>
<div class="image"><img src="Image00240.jpg" />
</div>
<p class="box-pi">At <span class="ent">➊</span>
 you create a <span class="code">formatter</span>
 . Then at <span class="ent">➋</span>
 , you set the style of the <span class="code">formatter</span>
 to <span class="code">Style.full</span>
 , which will print the day of the week as well as the full month name, date, and year. Finally, you create a string from the date using the <span class="code">string(from:)</span>
 method of the <span class="code">DateFormatter</span>
 class <span class="ent">➌</span>
 . You can see that you now have turned the <span id="page_160"></span>
 date into the nicely formatted string <span class="code">"Tuesday, November 21, 2017"</span>
 . <a style=";color:black;" href="text00022.html#ch11tab1">Table 11-1</a>
 shows the different strings that are created from the five <span class="code">DateFormatter.Style</span>
 options available in Swift.</p>
<p class="tabcap"><a id="ch11tab1" style=";color:black;"></a>
 <strong>Table 11-1:</strong>
 Date Formatter Styles and Their Date Strings</p>
<table class="tabled">
<tbody>
<tr>
<td style="vertical-align: top;" class="border1">
<p class="noindent">
<span class="code">
<span class="codestrong">DateFormatter.Style</span>
</span>
</p>
</td>
<td style="vertical-align: top;" class="border1">
<p class="noindent">
<strong>Date string</strong>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">none</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">""</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">short</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"11/21/17"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">medium</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"Nov 21, 2017"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">long</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"November 21, 2017"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">full</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"Tuesday, November 21, 2017"</span>
</p>
</td>
</tr>
</tbody>
</table>
<p class="box-pi">You can also specify your own custom way of displaying a date using the <span class="code">dateFormat</span>
 property of the <span class="code">DateFormatter</span>
 . Perhaps you only want the month and day. Or maybe you want a four-digit year displayed in the <span class="code">short</span>
 style. Doing either is really easy, and you don’t even have to create a new <span class="code">DateFormatter</span>
 —you can just change the <span class="code">dateFormat</span>
 on <span class="code">formatter</span>
 and then ask it for a new string. Add the following code to your playground to display dates with a specific format:</p>
<div class="image"><img src="Image00241.jpg" />
</div>
<p class="box-pi">At <span class="ent">➊</span>
 , you specify that you only want the month and the date in an <span class="code">MM/dd</span>
 format—that is, a two-digit month followed by a two-digit date. If you want to display the month as three letters, then use <span class="code">MMM</span>
 . To display the full name of the month, use <span class="code">MMMM</span>
 . At <span class="ent">➋</span>
 , we change the date format to use a four-digit year. A two-digit year would be <span class="code">yy</span>
 . Here are a few other ways to use a <span class="code">dateFormat</span>
 to display a custom date string.</p>
<div class="image"><img src="Image00242.jpg" />
</div>
<p class="box-pi"><span id="page_161"></span>
 If you want to include separators, you add them to your <span class="code">dateFormat</span>
 string. For example, if you want periods as separators, then you can create a <span class="code">dateFormat</span>
 like <span class="code">"MM.dd.yy"</span>
 <span class="ent">➊</span>
 . To display an abbreviated day of the week, use <span class="code">EEE</span>
 <span class="ent">➋</span>
 . For the full day, use <span class="code">EEEE</span>
 <span class="ent">➌</span>
 . These are only a few examples. By using combinations of <span class="code">M</span>
 , <span class="code">d</span>
 , <span class="code">y</span>
 , and <span class="code">E</span>
 , you have an endless number of ways to display a date!</p>
</div>
<h4 class="h4" id="ch11lev2sec3">
<strong>SETTING UP THE BIRTHDAYS TABLE VIEW CONTROLLER</strong>
</h4>
<p class="noindent">The Birthdays table view controller will display a list of all the birthdays stored in the app. Do you remember what you use to store a list of items? That’s right—an array! You’ll create an array in the <span class="code">BirthdaysTableViewController</span>
 to store all the birthdays. To do this, give the <span class="code">BirthdaysTableViewController</span>
 a <span class="code">birthdays</span>
 property that is an array of <span class="code">Birthday</span>
 objects. At the top of the class, right above the <span class="code">viewDidLoad()</span>
 method, insert this line to add a variable array property called <span class="code">birthdays</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController {</span>
<br />
<br />
    <span class="pink">var</span>
 birthdays = [<span class="green1">Birthday</span>
 ]()<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent">This line creates an empty array of <span class="code">Birthday</span>
 instances. It needs to be a variable and not a constant because you’ll want to add a saved <span class="code">Birthday</span>
 to this array every time the user adds a <span class="code">Birthday</span>
 with the Add Birthday view controller. You’ll see how to do that in “<a href="text00022.html#ch11lev3sec2">Making the Birthdays Table View Controller Conform to Protocol</a>
 ” on <a href="text00022.html#page_168">page 168</a>
 .</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>Remember that the final versions of the project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>.</em>
</p>
</div>
<p class="indent">The <span class="code">BirthdaysTableViewController</span>
 will also need a <span class="code">dateFormatter</span>
 property to display the birthdate as a nicely formatted string. Add a <span class="code">dateFormatter</span>
 right underneath the <span class="code">birthdays</span>
 array:</p>
<div class="box">
<pre>    <span class="ash">var birthdays = [Birthday]()</span>
<br />
<br />
    <span class="pink">let</span>
 dateFormatter = <span class="violet">DateFormatter</span>
 ()<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent">Note that the <span class="code">dateFormatter</span>
 is a constant that is created with <span class="code">let</span>
 . Even though you’ll change the <span class="code">dateFormatter</span>
 ’s properties, like the <span class="code">dateStyle</span>
 and <span class="code">timeStyle</span>
 , you’ll never change the <span class="code">dateFormatter</span>
 itself.</p>
<p class="indent"><span id="page_162"></span>
 You’ll also need to set up the <span class="code">dateFormatter</span>
 so that it will display the birthdates as fully formatted strings like <span class="code">"Tuesday, December 17, 2008"</span>
 . As you saw in <a href="text00021.html#ch10">Chapter 10</a>
 , a good place to do this is the <span class="code">viewDidLoad()</span>
 method, which is called when the Birthdays table view controller is loading its view. This is the perfect place to do any setup that is needed for this class.</p>
<div class="box">
<pre>
<span class="ash">override func viewDidLoad() {</span>
<br />
    <span class="ash">super.viewDidLoad()</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">dateFormatter</span>
 .<span class="violet">dateStyle</span>
 = .<span class="blue">full</span>
<br />
  <span class="ent">➋</span>
 <span class="green1">dateFormatter</span>
 .<span class="violet">timeStyle</span>
 = .<span class="blue">none</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , you set the <span class="code">dateStyle</span>
 of the <span class="code">dateFormatter</span>
 so that it will display a formatted date string for each <span class="code">Birthday</span>
 . Did you notice how we just wrote <span class="code">.full</span>
 instead of <span class="code">DateFormatter.Style.full</span>
 ? Swift knows what type to expect for the <span class="code">dateStyle</span>
 of a <span class="code">DateFormatter</span>
 , so it lets us take this little shortcut. At <span class="ent">➋</span>
 , you set the <span class="code">timeStyle</span>
 of the <span class="code">dateFormatter</span>
 to <span class="code">.none</span>
 so that the time won’t be shown.</p>
<h4 class="h4" id="ch11lev2sec4">
<strong>DISPLAYING BIRTHDAYS IN A TABLE VIEW</strong>
</h4>
<p class="noindent">The <span class="code">BirthdaysTableViewController</span>
 class has a table view that is used to display a list of items in a single column. The table view has one or more sections containing rows, and each row contains a cell. A section in a table view is a grouping of rows that can be displayed with or without a header. An example of an app that shows a table view with several sections is the Settings app, as shown in <a href="text00022.html#ch11fig5">Figure 11-5</a>
 . It displays a list of rows that have been broken up into different sections.</p>
<p class="indent">Each section and row of a table view is identified with an index number. These numbers start at 0 and then increase by 1 as you go down the table view. For example, the Privacy line in the Settings app is found at section 0, row 1. The News setting is at section 1, row 3.</p>
<p class="indent">In the middle of the <span class="code">BirthdaysTableViewController</span>
 class, there is a section called <em>Table view data source</em>
 with three methods. The table view controller uses these methods to determine what’s going to be displayed inside its table view.</p>
<p class="hang">
<span class="code">
<span class="codestrong">numberOfSections(in:)</span>
</span>
 Tells the table view how many sections it should have</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:numberOfRowsInSection:)</span>
</span>
 Tells the table view how many rows will be displayed in each section</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:cellForRowAt:)</span>
</span>
 Sets up each cell that’s going to be displayed in each row of the table view</p>
<div class="image"><span id="page_163"></span>
 <img src="Image00243.jpg" />
</div>
<p class="figcap"><a id="ch11fig5"></a>
 <em>Figure 11-5: The Settings app uses sections to group rows of different device settings.</em>
</p>
<p class="indent">The table view data source methods are called by the table view controller every time the table view is reloaded. Xcode automatically gives you these method templates when you make a subclass of a <span class="code">UITableViewController</span>
 . You need to implement all three methods for the app to work, even though you’ll never call them directly in your code. The <span class="code">UITableViewController</span>
 class implements the <span class="code">UITableViewDataSource</span>
 protocol, which comes with these data source methods, to determine what will be displayed inside the table view. We’ll discuss protocols in “<a href="text00022.html#ch11lev2sec5">Delegation</a>
 ” on page 166. For now, you just need to know that a <span class="code">UITableViewController</span>
 uses these methods to display its content, and it automatically calls these methods so you don’t need to call them.</p>
<p class="indent">Let’s start with the method <span class="code">numberOfSections(in:)</span>
 . The Birthdays table view controller is a list that just displays <span class="code">Birthday</span>
 instances, so it doesn’t need multiple sections. To set the number of sections in the table view, we just need to return <span class="code">1</span>
 .</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func numberOfSections(in tableView: UITableView) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 <span class="blue1">1</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent"><span id="page_164"></span>
 This method takes a <span class="code">UITableView</span>
 called <span class="code">tableView</span>
 as a parameter, which is the table view that uses this class as its data source. We don’t need to worry about making this connection because the <span class="code">UITableViewController</span>
 comes with a built-in table view that is automatically hooked up to these methods. Each birthday will be displayed in its own row. So in <span class="code">tableView(_:numberOfRowsInSection:)</span>
 , in order to have the right number of rows for all of your birthdays, you need to return the number of <span class="code">Birthday</span>
 instances that you have in your <span class="code">birthdays</span>
 array. Do you remember the <span class="code">count</span>
 property of an array? It’s an integer that tells you how many items are in that array, and it’s perfect for this situation! Change this method to the following:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, <img class="inline" src="Image00184.jpg" />
<br />
    numberOfRowsInSection section: Int) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 birthdays.<span class="violet">count</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">In addition to the <span class="code">tableView</span>
 parameter, <span class="code">tableView(_:numberOfRowsInSection:)</span>
 also takes an <span class="code">Int</span>
 called <span class="code">section</span>
 . When the table view is loading itself, this method is called for each section in the table view. In our case, we have only one section, so we don’t need to bother checking which <span class="code">section</span>
 of the table view is being displayed here. We know it’s section 0, and we want it to have as many rows as there are birthdays, so we write <span class="code">return birthdays.count</span>
 .</p>
<p class="indent">Finally, you need to implement <span class="code">tableView(_:cellForRowAt:)</span>
 so that the table view will know what to put inside each cell. Since this method is commented out, you need to uncomment it by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it. (Be careful not to accidentally uncomment the other methods after it!) After you’ve done that, change it to the following code:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, cellForRowAt <img class="inline" src="Image00184.jpg" />
<br />
    indexPath: IndexPath) -&gt; UITableViewCell {</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="pink">let</span>
 cell = tableView.<span class="blue">dequeueReusableCell</span>
 (withIdentifier: <img class="inline" src="Image00093.jpg" />
<br />
        <span class="red">"birthdayCellIdentifier"</span>
 , for: indexPath)<br />
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 birthday = <span class="green1">birthdays</span>
 [indexPath.<span class="violet">row</span>
 ]<br />
<br />
  <span class="ent">➌</span>
 cell.<span class="violet">textLabel</span>
 ?.<span class="violet">text</span>
 = birthday.<span class="green1">firstName</span>
 <span class="blue">+</span>
 <span class="red">" "</span>
 <span class="blue">+</span>
 <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">lastName</span>
<br />
<br />
  <span class="ent">➍</span>
 cell.<span class="violet">detailTextLabel</span>
 ?.<span class="violet">text</span>
 = <span class="green1">dateFormatter</span>
 .<span class="blue">string</span>
 (from: <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">birthdate</span>
 )<br />
<br />
  <span class="ent">➎</span>
 <span class="pink">return</span>
 cell<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">You don’t call the method <span class="code">tableView(_:cellForRowAt:)</span>
 . It’s called when the table view is loaded onto the screen. It’s called for each cell on the screen and takes two parameters, <span class="code">tableView</span>
 and <span class="code">indexPath</span>
 . You already know <span id="page_165"></span>
 what the <span class="code">tableView</span>
 parameter is for. An <span class="code">IndexPath</span>
 is a Swift struct that’s used to represent a row’s position in a table view. An <span class="code">IndexPath</span>
 instance has a <span class="code">section</span>
 property and a <span class="code">row</span>
 property. Since this method will be called many times (once for every row in the table), we need the <span class="code">indexPath</span>
 to know which section and row we’re currently configuring. The <span class="code">indexPath.section</span>
 property gives the section number, and the <span class="code">indexPath.row</span>
 gives the row of the table view cell. The five lines of code inside <span class="code">tableView(_:cellForRowAt:)</span>
 will do the following:</p>
<div class="image"><img src="Image00244.jpg" />
</div>
<p class="bull">• Create a <span class="code">UITableViewCell</span>
</p>
<p class="bull">• Figure out which <span class="code">Birthday</span>
 in the <span class="code">birthdays</span>
 array will be displayed inside the cell</p>
<p class="bull">• Make two labels to display the birthday person’s name and birthdate in the cell</p>
<p class="bull">• Return the cell ready for display in the table view</p>
<p class="indentt">Let’s go through this code line by line.</p>
<p class="indent">First, create the <span class="code">UITableViewCell</span>
 . The code at <span class="ent">➊</span>
 does this using the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 . Before you can start using this method on a cell, though, you need to tell the method which cell you want to use from the storyboard. Earlier, when you were in the storyboard, you gave your cell the identifier <span class="code">birthdayCellIdentifier</span>
 (see <a href="text00022.html#ch11fig4">Figure 11-4</a>
 ). This identifier links your code to the cell and tells your method that it’s using the right cell. The string for when you call this method needs to be exactly the same as the string you set in the storyboard, or you’ll get an error and the app will crash when you run it.</p>
<p class="indent">In the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 , did you notice the words <em>Reusable Cell</em>
 ? The cells inside a table view are created once and then can be reused over and over. This helps everything run faster and smoother because creating the cell is what takes the most time. If you had 200 birthdays in your app, but only 10 would fit on your screen at one time, then you need only 10 cells to show your birthdays. When you scroll down to reveal more birthdays, the cells that scroll off the top of the screen are reused. They are filled with new information and show up again at the bottom of the screen. The <span class="code">UITableView</span>
 automatically does this work. When the table view is loaded, <span class="code">tableView(_:cellForRowAt:)</span>
 is called for every visible row. When the user scrolls to look at more cells, it’s called again for each row just as it is about to appear on the screen.</p>
<p class="indent">Next, we need to find out which <span class="code">Birthday</span>
 should be displayed inside the cell. We want to display one birthday from the <span class="code">birthdays</span>
 array in each row. The first birthday, which is at <span class="code">birthdays[0]</span>
 , should be displayed in row 0. The second birthday, at <span class="code">birthdays[1]</span>
 , should be displayed in row 1, and so on, which means the <span class="code">indexPath</span>
 ’s <span class="code">row</span>
 is the same as the position in the <span class="code">birthdays</span>
 array that we want to access. The code at <span class="ent">➋</span>
 accesses the <span id="page_166"></span>
 correct <span class="code">Birthday</span>
 object from the <span class="code">birthdays</span>
 array by using <span class="code">indexPath.row</span>
 . Once we have the right <span class="code">Birthday</span>
 object, we assign it to a constant named <span class="code">birthday</span>
 so we can set up the labels in this cell.</p>
<p class="indent">Notice that we’re using <span class="code">let</span>
 to assign the <span class="code">birthday</span>
 to a constant instead of a variable. We can use <span class="code">let</span>
 because each time <span class="code">tableView(_:cellForRowAt:)</span>
 is called, a new <span class="code">birthday</span>
 constant is created. Each cell gets its own <span class="code">birthday</span>
 constant that is assigned its own <span class="code">Birthday</span>
 object. Since we’re not going to change any of the <span class="code">birthday</span>
 constants—we’re just going to read their properties—we don’t want to make them variables.</p>
<p class="indent">Now that you have your cell and your birthday, it’s time to fill in the details. You need two labels for each cell to show the birthday person’s name and birthdate. You set the cell to the Subtitle style so that it has a Title label and a Subtitle label. Each cell will already contain these labels, so now you don’t have to create any labels yourself.</p>
<p class="indent">The labels exist as properties of <span class="code">UITableViewCell</span>
 and are called <span class="code">textLabel</span>
 and <span class="code">detailTextLabel</span>
 . The code at <span class="ent">➌</span>
 sets the text of the <span class="code">textLabel</span>
 to a string made up of the <span class="code">firstName</span>
 and <span class="code">lastName</span>
 of the <span class="code">birthday</span>
 with a space between them. At <span class="ent">➍</span>
 , you use the <span class="code">string(from:)</span>
 method of the <span class="code">dateFormatter</span>
 to display the birthdate in the <span class="code">detailTextLabel</span>
 .</p>
<p class="indent">When your cell is completely configured, <span class="code">tableView( _:cellForRowAt:)</span>
 returns the cell at <span class="ent">➎</span>
 so that it can be displayed at that <span class="code">indexPath</span>
 of the table view.</p>
<h3 class="h3" id="ch11lev1sec2">
<strong>PUTTING IT ALL TOGETHER</strong>
</h3>
<p class="noindent">Now you can add <span class="code">Birthday</span>
 instances to the app using the Add Birthday view controller, and you have a table view to list each <span class="code">Birthday</span>
 in the Birthdays table view controller. But when you try running the app and adding a <span class="code">Birthday</span>
 , it doesn’t appear. To make each <span class="code">Birthday</span>
 you add appear in the table view, you need to make the Add Birthday view controller communicate with the Birthdays table view controller. You do this by using <em>delegation</em>
 .</p>
<h4 class="h4" id="ch11lev2sec5">
<strong>DELEGATION</strong>
</h4>
<p class="noindent">Delegation can be used when one view controller needs to get information from another view controller. Say you have two view controllers: A and B. The first view controller, A, creates B and presents B on top of itself. A knows about B because it created and presented B, so A can pass information along to B. But B doesn’t know about A—it’s just popped into being and doesn’t know where it came from or how it got there. So how can B talk to A? Through delegation!</p>
<div class="image"><img src="Image00245.jpg" />
</div>
<p class="indent">Delegation is when someone gives a job or a task to someone else. A <em>delegate</em>
 is like a boss who tells a delegating employee what to do. When the delegating employee is done with their task, sometimes they’ll report information back to the delegate boss.</p>
<p class="indent"><span id="page_167"></span>
 Delegation in Swift is pretty similar, but instead of having a boss and employee, we have a delegate and a delegating object. Since class B is the one being told what to do by class A, it’s the delegating object. We give class B a special property called a delegate to tell it who its delegate is—that way, it knows who to communicate with. The delegate can be any class that has a set of methods that have been defined in a <em>protocol</em>
 . A protocol is like an agreement between the two classes that tells them what the delegate can ask the delegating object to do. It has a list of method and property names that the delegate can use with the delegating object.</p>
<p class="indent">Class A creates class B, makes itself the delegate of class B, and gives class B a job to do that’s in the protocol. Once class B is done with its job, it reports back to class A. Let’s see how this works in our app.</p>
<p class="indent">The Birthdays table view controller is view controller A, and the Add Birthday view controller is view controller B. We’ll create a protocol called <span class="code">AddBirthdayViewControllerDelegate</span>
 and a method for that protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 , which the Add Birthday view controller will use to report back.</p>
<p class="indent">Take a look at <a href="text00022.html#ch11fig6">Figure 11-6</a>
 . When the user taps the Add button <span class="ent">➊</span>
 , the Birthdays table view controller creates the Add Birthday view controller <span class="ent">➋</span>
 and sets itself as the Add Birthday view controller’s delegate.</p>
<div class="image"><img src="Image00246.jpg" />
</div>
<p class="figcap"><a id="ch11fig6"></a>
 <em>Figure 11-6: A new birthday is added and passed from the Add Birthday view controller to the Birthdays table view controller using delegation.</em>
</p>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="figcap"><a id="ch11fig3"></a>
 <em>Figure 11-3: Setting</em>
 <span class="code">
<span class="italic">BirthdaysTableViewController</span>
</span>
 <em>as the class of the Birthdays scene</em>
</p>
<p class="indent">Now that you have the Birthdays table view controller set up in the storyboard, the next step is to make cells in your table that will display each birthday.</p>
<h4 class="h4" id="ch11lev2sec2">
<strong>ADDING CELLS TO THE TABLE VIEW</strong>
</h4>
<p class="noindent">Each birthday will be displayed in a <span class="code">UITableViewCell</span>
 in the Birthdays table view controller. A table has boxes organized into rows and columns that contain information. These boxes are called <em>cells</em>
 . Similarly, a table view also has cells that are all instances of, or a subclass of, the <span class="code">UITableViewCell</span>
 class. We’ll put each birthday into its own cell in our table view.</p>
<p class="indent">We’ll start by creating those cells in the storyboard, and then we’ll fill them with our <span class="code">Birthday</span>
 objects later. In the left outline menu, click the triangle by Birthdays and then click the triangle by Table View to open those sections. Then select <strong>Table View Cell</strong>
 <span class="ent">➊</span>
 , as shown in <a href="text00022.html#ch11fig4">Figure 11-4</a>
 .</p>
<div class="image"><img src="Image00237.jpg" />
</div>
<div class="image"><img src="Image00238.jpg" />
</div>
<p class="figcap"><a id="ch11fig4"></a>
 <em>Figure 11-4: Creating a Subtitle style table view cell and setting its identifier</em>
</p>
<p class="indent"><span id="page_159"></span>
 Next, open the Attributes Inspector. Using the drop-down menu under <strong>Style</strong>
 , set the cell’s style to <strong>Subtitle</strong>
 <span class="ent">➋</span>
 so that the cell now has a Title label and a Subtitle label. You’ll display each person’s name in the Title and birthday in the Subtitle.</p>
<p class="indent">Finally, enter <span class="code">
<span class="codestrong">birthdayCellIdentifier</span>
</span>
 in the Identifier field <span class="ent">➌</span>
 . You’ll use this identifier later when you fill in the cell contents.</p>
<p class="indent">That’s it! You’ve finished your work in the storyboard.</p>
<p class="indent">You may be wondering why we have just one cell in our table view in the storyboard when we’ll have more than one birthday to show in the list. If you look at <a href="text00022.html#ch11fig4">Figure 11-4</a>
 again, you’ll notice that the cell is labeled <em>Prototype Cells</em>
 . This means that the cell you just customized is a <em>template</em>
 for all the cells you want to appear in your table view. The identifier you gave the cell is how your code will tell the table view to produce each cell for you to put birthdays in. You’ll see how this works soon.</p>
<div class="box1">
<p class="box-title">
<strong>WORKING WITH DATES</strong>
</p>
<p class="box-p">Swift has a special data type called <span class="code">Date</span>
 that is used for storing date values. A <span class="code">Date</span>
 object is actually a date and a time. Open your playground and enter the following:</p>
<div class="image"><img src="Image00239.jpg" />
</div>
<p class="box-pi">We’ve just assigned the current date and time the code was run to the variable <span class="code">today</span>
 . When you print <span class="code">today</span>
 , it’s in the format <span class="code">"2017-11-21 10:45:31 +0000\n"</span>
 . What if you wanted it to display as <span class="code">Tuesday, November 21, 2017</span>
 , instead? Or just <span class="code">11/21/17</span>
 ? To display a date in a particular way, you use a <em>date formatter</em>
 , which is a <span class="code">DateFormatter</span>
 object that you create and give a date format style. <span class="code">DateFormatter</span>
 is a helper object that is used to create a display string from any date, and a <em>date format style</em>
 is a property of <span class="code">DateFormatter</span>
 that tells the formatter what style to use. You can create your own date format styles manually, but there are also styles that are included in Swift and ready to use. Add the following to your playground:</p>
<div class="image"><img src="Image00240.jpg" />
</div>
<p class="box-pi">At <span class="ent">➊</span>
 you create a <span class="code">formatter</span>
 . Then at <span class="ent">➋</span>
 , you set the style of the <span class="code">formatter</span>
 to <span class="code">Style.full</span>
 , which will print the day of the week as well as the full month name, date, and year. Finally, you create a string from the date using the <span class="code">string(from:)</span>
 method of the <span class="code">DateFormatter</span>
 class <span class="ent">➌</span>
 . You can see that you now have turned the <span id="page_160"></span>
 date into the nicely formatted string <span class="code">"Tuesday, November 21, 2017"</span>
 . <a style=";color:black;" href="text00022.html#ch11tab1">Table 11-1</a>
 shows the different strings that are created from the five <span class="code">DateFormatter.Style</span>
 options available in Swift.</p>
<p class="tabcap"><a id="ch11tab1" style=";color:black;"></a>
 <strong>Table 11-1:</strong>
 Date Formatter Styles and Their Date Strings</p>
<table class="tabled">
<tbody>
<tr>
<td style="vertical-align: top;" class="border1">
<p class="noindent">
<span class="code">
<span class="codestrong">DateFormatter.Style</span>
</span>
</p>
</td>
<td style="vertical-align: top;" class="border1">
<p class="noindent">
<strong>Date string</strong>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">none</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">""</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">short</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"11/21/17"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">medium</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"Nov 21, 2017"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">long</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"November 21, 2017"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">full</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"Tuesday, November 21, 2017"</span>
</p>
</td>
</tr>
</tbody>
</table>
<p class="box-pi">You can also specify your own custom way of displaying a date using the <span class="code">dateFormat</span>
 property of the <span class="code">DateFormatter</span>
 . Perhaps you only want the month and day. Or maybe you want a four-digit year displayed in the <span class="code">short</span>
 style. Doing either is really easy, and you don’t even have to create a new <span class="code">DateFormatter</span>
 —you can just change the <span class="code">dateFormat</span>
 on <span class="code">formatter</span>
 and then ask it for a new string. Add the following code to your playground to display dates with a specific format:</p>
<div class="image"><img src="Image00241.jpg" />
</div>
<p class="box-pi">At <span class="ent">➊</span>
 , you specify that you only want the month and the date in an <span class="code">MM/dd</span>
 format—that is, a two-digit month followed by a two-digit date. If you want to display the month as three letters, then use <span class="code">MMM</span>
 . To display the full name of the month, use <span class="code">MMMM</span>
 . At <span class="ent">➋</span>
 , we change the date format to use a four-digit year. A two-digit year would be <span class="code">yy</span>
 . Here are a few other ways to use a <span class="code">dateFormat</span>
 to display a custom date string.</p>
<div class="image"><img src="Image00242.jpg" />
</div>
<p class="box-pi"><span id="page_161"></span>
 If you want to include separators, you add them to your <span class="code">dateFormat</span>
 string. For example, if you want periods as separators, then you can create a <span class="code">dateFormat</span>
 like <span class="code">"MM.dd.yy"</span>
 <span class="ent">➊</span>
 . To display an abbreviated day of the week, use <span class="code">EEE</span>
 <span class="ent">➋</span>
 . For the full day, use <span class="code">EEEE</span>
 <span class="ent">➌</span>
 . These are only a few examples. By using combinations of <span class="code">M</span>
 , <span class="code">d</span>
 , <span class="code">y</span>
 , and <span class="code">E</span>
 , you have an endless number of ways to display a date!</p>
</div>
<h4 class="h4" id="ch11lev2sec3">
<strong>SETTING UP THE BIRTHDAYS TABLE VIEW CONTROLLER</strong>
</h4>
<p class="noindent">The Birthdays table view controller will display a list of all the birthdays stored in the app. Do you remember what you use to store a list of items? That’s right—an array! You’ll create an array in the <span class="code">BirthdaysTableViewController</span>
 to store all the birthdays. To do this, give the <span class="code">BirthdaysTableViewController</span>
 a <span class="code">birthdays</span>
 property that is an array of <span class="code">Birthday</span>
 objects. At the top of the class, right above the <span class="code">viewDidLoad()</span>
 method, insert this line to add a variable array property called <span class="code">birthdays</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController {</span>
<br />
<br />
    <span class="pink">var</span>
 birthdays = [<span class="green1">Birthday</span>
 ]()<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent">This line creates an empty array of <span class="code">Birthday</span>
 instances. It needs to be a variable and not a constant because you’ll want to add a saved <span class="code">Birthday</span>
 to this array every time the user adds a <span class="code">Birthday</span>
 with the Add Birthday view controller. You’ll see how to do that in “<a href="text00022.html#ch11lev3sec2">Making the Birthdays Table View Controller Conform to Protocol</a>
 ” on <a href="text00022.html#page_168">page 168</a>
 .</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>Remember that the final versions of the project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>.</em>
</p>
</div>
<p class="indent">The <span class="code">BirthdaysTableViewController</span>
 will also need a <span class="code">dateFormatter</span>
 property to display the birthdate as a nicely formatted string. Add a <span class="code">dateFormatter</span>
 right underneath the <span class="code">birthdays</span>
 array:</p>
<div class="box">
<pre>    <span class="ash">var birthdays = [Birthday]()</span>
<br />
<br />
    <span class="pink">let</span>
 dateFormatter = <span class="violet">DateFormatter</span>
 ()<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent">Note that the <span class="code">dateFormatter</span>
 is a constant that is created with <span class="code">let</span>
 . Even though you’ll change the <span class="code">dateFormatter</span>
 ’s properties, like the <span class="code">dateStyle</span>
 and <span class="code">timeStyle</span>
 , you’ll never change the <span class="code">dateFormatter</span>
 itself.</p>
<p class="indent"><span id="page_162"></span>
 You’ll also need to set up the <span class="code">dateFormatter</span>
 so that it will display the birthdates as fully formatted strings like <span class="code">"Tuesday, December 17, 2008"</span>
 . As you saw in <a href="text00021.html#ch10">Chapter 10</a>
 , a good place to do this is the <span class="code">viewDidLoad()</span>
 method, which is called when the Birthdays table view controller is loading its view. This is the perfect place to do any setup that is needed for this class.</p>
<div class="box">
<pre>
<span class="ash">override func viewDidLoad() {</span>
<br />
    <span class="ash">super.viewDidLoad()</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">dateFormatter</span>
 .<span class="violet">dateStyle</span>
 = .<span class="blue">full</span>
<br />
  <span class="ent">➋</span>
 <span class="green1">dateFormatter</span>
 .<span class="violet">timeStyle</span>
 = .<span class="blue">none</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , you set the <span class="code">dateStyle</span>
 of the <span class="code">dateFormatter</span>
 so that it will display a formatted date string for each <span class="code">Birthday</span>
 . Did you notice how we just wrote <span class="code">.full</span>
 instead of <span class="code">DateFormatter.Style.full</span>
 ? Swift knows what type to expect for the <span class="code">dateStyle</span>
 of a <span class="code">DateFormatter</span>
 , so it lets us take this little shortcut. At <span class="ent">➋</span>
 , you set the <span class="code">timeStyle</span>
 of the <span class="code">dateFormatter</span>
 to <span class="code">.none</span>
 so that the time won’t be shown.</p>
<h4 class="h4" id="ch11lev2sec4">
<strong>DISPLAYING BIRTHDAYS IN A TABLE VIEW</strong>
</h4>
<p class="noindent">The <span class="code">BirthdaysTableViewController</span>
 class has a table view that is used to display a list of items in a single column. The table view has one or more sections containing rows, and each row contains a cell. A section in a table view is a grouping of rows that can be displayed with or without a header. An example of an app that shows a table view with several sections is the Settings app, as shown in <a href="text00022.html#ch11fig5">Figure 11-5</a>
 . It displays a list of rows that have been broken up into different sections.</p>
<p class="indent">Each section and row of a table view is identified with an index number. These numbers start at 0 and then increase by 1 as you go down the table view. For example, the Privacy line in the Settings app is found at section 0, row 1. The News setting is at section 1, row 3.</p>
<p class="indent">In the middle of the <span class="code">BirthdaysTableViewController</span>
 class, there is a section called <em>Table view data source</em>
 with three methods. The table view controller uses these methods to determine what’s going to be displayed inside its table view.</p>
<p class="hang">
<span class="code">
<span class="codestrong">numberOfSections(in:)</span>
</span>
 Tells the table view how many sections it should have</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:numberOfRowsInSection:)</span>
</span>
 Tells the table view how many rows will be displayed in each section</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:cellForRowAt:)</span>
</span>
 Sets up each cell that’s going to be displayed in each row of the table view</p>
<div class="image"><span id="page_163"></span>
 <img src="Image00243.jpg" />
</div>
<p class="figcap"><a id="ch11fig5"></a>
 <em>Figure 11-5: The Settings app uses sections to group rows of different device settings.</em>
</p>
<p class="indent">The table view data source methods are called by the table view controller every time the table view is reloaded. Xcode automatically gives you these method templates when you make a subclass of a <span class="code">UITableViewController</span>
 . You need to implement all three methods for the app to work, even though you’ll never call them directly in your code. The <span class="code">UITableViewController</span>
 class implements the <span class="code">UITableViewDataSource</span>
 protocol, which comes with these data source methods, to determine what will be displayed inside the table view. We’ll discuss protocols in “<a href="text00022.html#ch11lev2sec5">Delegation</a>
 ” on page 166. For now, you just need to know that a <span class="code">UITableViewController</span>
 uses these methods to display its content, and it automatically calls these methods so you don’t need to call them.</p>
<p class="indent">Let’s start with the method <span class="code">numberOfSections(in:)</span>
 . The Birthdays table view controller is a list that just displays <span class="code">Birthday</span>
 instances, so it doesn’t need multiple sections. To set the number of sections in the table view, we just need to return <span class="code">1</span>
 .</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func numberOfSections(in tableView: UITableView) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 <span class="blue1">1</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent"><span id="page_164"></span>
 This method takes a <span class="code">UITableView</span>
 called <span class="code">tableView</span>
 as a parameter, which is the table view that uses this class as its data source. We don’t need to worry about making this connection because the <span class="code">UITableViewController</span>
 comes with a built-in table view that is automatically hooked up to these methods. Each birthday will be displayed in its own row. So in <span class="code">tableView(_:numberOfRowsInSection:)</span>
 , in order to have the right number of rows for all of your birthdays, you need to return the number of <span class="code">Birthday</span>
 instances that you have in your <span class="code">birthdays</span>
 array. Do you remember the <span class="code">count</span>
 property of an array? It’s an integer that tells you how many items are in that array, and it’s perfect for this situation! Change this method to the following:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, <img class="inline" src="Image00184.jpg" />
<br />
    numberOfRowsInSection section: Int) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 birthdays.<span class="violet">count</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">In addition to the <span class="code">tableView</span>
 parameter, <span class="code">tableView(_:numberOfRowsInSection:)</span>
 also takes an <span class="code">Int</span>
 called <span class="code">section</span>
 . When the table view is loading itself, this method is called for each section in the table view. In our case, we have only one section, so we don’t need to bother checking which <span class="code">section</span>
 of the table view is being displayed here. We know it’s section 0, and we want it to have as many rows as there are birthdays, so we write <span class="code">return birthdays.count</span>
 .</p>
<p class="indent">Finally, you need to implement <span class="code">tableView(_:cellForRowAt:)</span>
 so that the table view will know what to put inside each cell. Since this method is commented out, you need to uncomment it by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it. (Be careful not to accidentally uncomment the other methods after it!) After you’ve done that, change it to the following code:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, cellForRowAt <img class="inline" src="Image00184.jpg" />
<br />
    indexPath: IndexPath) -&gt; UITableViewCell {</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="pink">let</span>
 cell = tableView.<span class="blue">dequeueReusableCell</span>
 (withIdentifier: <img class="inline" src="Image00093.jpg" />
<br />
        <span class="red">"birthdayCellIdentifier"</span>
 , for: indexPath)<br />
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 birthday = <span class="green1">birthdays</span>
 [indexPath.<span class="violet">row</span>
 ]<br />
<br />
  <span class="ent">➌</span>
 cell.<span class="violet">textLabel</span>
 ?.<span class="violet">text</span>
 = birthday.<span class="green1">firstName</span>
 <span class="blue">+</span>
 <span class="red">" "</span>
 <span class="blue">+</span>
 <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">lastName</span>
<br />
<br />
  <span class="ent">➍</span>
 cell.<span class="violet">detailTextLabel</span>
 ?.<span class="violet">text</span>
 = <span class="green1">dateFormatter</span>
 .<span class="blue">string</span>
 (from: <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">birthdate</span>
 )<br />
<br />
  <span class="ent">➎</span>
 <span class="pink">return</span>
 cell<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">You don’t call the method <span class="code">tableView(_:cellForRowAt:)</span>
 . It’s called when the table view is loaded onto the screen. It’s called for each cell on the screen and takes two parameters, <span class="code">tableView</span>
 and <span class="code">indexPath</span>
 . You already know <span id="page_165"></span>
 what the <span class="code">tableView</span>
 parameter is for. An <span class="code">IndexPath</span>
 is a Swift struct that’s used to represent a row’s position in a table view. An <span class="code">IndexPath</span>
 instance has a <span class="code">section</span>
 property and a <span class="code">row</span>
 property. Since this method will be called many times (once for every row in the table), we need the <span class="code">indexPath</span>
 to know which section and row we’re currently configuring. The <span class="code">indexPath.section</span>
 property gives the section number, and the <span class="code">indexPath.row</span>
 gives the row of the table view cell. The five lines of code inside <span class="code">tableView(_:cellForRowAt:)</span>
 will do the following:</p>
<div class="image"><img src="Image00244.jpg" />
</div>
<p class="bull">• Create a <span class="code">UITableViewCell</span>
</p>
<p class="bull">• Figure out which <span class="code">Birthday</span>
 in the <span class="code">birthdays</span>
 array will be displayed inside the cell</p>
<p class="bull">• Make two labels to display the birthday person’s name and birthdate in the cell</p>
<p class="bull">• Return the cell ready for display in the table view</p>
<p class="indentt">Let’s go through this code line by line.</p>
<p class="indent">First, create the <span class="code">UITableViewCell</span>
 . The code at <span class="ent">➊</span>
 does this using the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 . Before you can start using this method on a cell, though, you need to tell the method which cell you want to use from the storyboard. Earlier, when you were in the storyboard, you gave your cell the identifier <span class="code">birthdayCellIdentifier</span>
 (see <a href="text00022.html#ch11fig4">Figure 11-4</a>
 ). This identifier links your code to the cell and tells your method that it’s using the right cell. The string for when you call this method needs to be exactly the same as the string you set in the storyboard, or you’ll get an error and the app will crash when you run it.</p>
<p class="indent">In the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 , did you notice the words <em>Reusable Cell</em>
 ? The cells inside a table view are created once and then can be reused over and over. This helps everything run faster and smoother because creating the cell is what takes the most time. If you had 200 birthdays in your app, but only 10 would fit on your screen at one time, then you need only 10 cells to show your birthdays. When you scroll down to reveal more birthdays, the cells that scroll off the top of the screen are reused. They are filled with new information and show up again at the bottom of the screen. The <span class="code">UITableView</span>
 automatically does this work. When the table view is loaded, <span class="code">tableView(_:cellForRowAt:)</span>
 is called for every visible row. When the user scrolls to look at more cells, it’s called again for each row just as it is about to appear on the screen.</p>
<p class="indent">Next, we need to find out which <span class="code">Birthday</span>
 should be displayed inside the cell. We want to display one birthday from the <span class="code">birthdays</span>
 array in each row. The first birthday, which is at <span class="code">birthdays[0]</span>
 , should be displayed in row 0. The second birthday, at <span class="code">birthdays[1]</span>
 , should be displayed in row 1, and so on, which means the <span class="code">indexPath</span>
 ’s <span class="code">row</span>
 is the same as the position in the <span class="code">birthdays</span>
 array that we want to access. The code at <span class="ent">➋</span>
 accesses the <span id="page_166"></span>
 correct <span class="code">Birthday</span>
 object from the <span class="code">birthdays</span>
 array by using <span class="code">indexPath.row</span>
 . Once we have the right <span class="code">Birthday</span>
 object, we assign it to a constant named <span class="code">birthday</span>
 so we can set up the labels in this cell.</p>
<p class="indent">Notice that we’re using <span class="code">let</span>
 to assign the <span class="code">birthday</span>
 to a constant instead of a variable. We can use <span class="code">let</span>
 because each time <span class="code">tableView(_:cellForRowAt:)</span>
 is called, a new <span class="code">birthday</span>
 constant is created. Each cell gets its own <span class="code">birthday</span>
 constant that is assigned its own <span class="code">Birthday</span>
 object. Since we’re not going to change any of the <span class="code">birthday</span>
 constants—we’re just going to read their properties—we don’t want to make them variables.</p>
<p class="indent">Now that you have your cell and your birthday, it’s time to fill in the details. You need two labels for each cell to show the birthday person’s name and birthdate. You set the cell to the Subtitle style so that it has a Title label and a Subtitle label. Each cell will already contain these labels, so now you don’t have to create any labels yourself.</p>
<p class="indent">The labels exist as properties of <span class="code">UITableViewCell</span>
 and are called <span class="code">textLabel</span>
 and <span class="code">detailTextLabel</span>
 . The code at <span class="ent">➌</span>
 sets the text of the <span class="code">textLabel</span>
 to a string made up of the <span class="code">firstName</span>
 and <span class="code">lastName</span>
 of the <span class="code">birthday</span>
 with a space between them. At <span class="ent">➍</span>
 , you use the <span class="code">string(from:)</span>
 method of the <span class="code">dateFormatter</span>
 to display the birthdate in the <span class="code">detailTextLabel</span>
 .</p>
<p class="indent">When your cell is completely configured, <span class="code">tableView( _:cellForRowAt:)</span>
 returns the cell at <span class="ent">➎</span>
 so that it can be displayed at that <span class="code">indexPath</span>
 of the table view.</p>
<h3 class="h3" id="ch11lev1sec2">
<strong>PUTTING IT ALL TOGETHER</strong>
</h3>
<p class="noindent">Now you can add <span class="code">Birthday</span>
 instances to the app using the Add Birthday view controller, and you have a table view to list each <span class="code">Birthday</span>
 in the Birthdays table view controller. But when you try running the app and adding a <span class="code">Birthday</span>
 , it doesn’t appear. To make each <span class="code">Birthday</span>
 you add appear in the table view, you need to make the Add Birthday view controller communicate with the Birthdays table view controller. You do this by using <em>delegation</em>
 .</p>
<h4 class="h4" id="ch11lev2sec5">
<strong>DELEGATION</strong>
</h4>
<p class="noindent">Delegation can be used when one view controller needs to get information from another view controller. Say you have two view controllers: A and B. The first view controller, A, creates B and presents B on top of itself. A knows about B because it created and presented B, so A can pass information along to B. But B doesn’t know about A—it’s just popped into being and doesn’t know where it came from or how it got there. So how can B talk to A? Through delegation!</p>
<div class="image"><img src="Image00245.jpg" />
</div>
<p class="indent">Delegation is when someone gives a job or a task to someone else. A <em>delegate</em>
 is like a boss who tells a delegating employee what to do. When the delegating employee is done with their task, sometimes they’ll report information back to the delegate boss.</p>
<p class="indent"><span id="page_167"></span>
 Delegation in Swift is pretty similar, but instead of having a boss and employee, we have a delegate and a delegating object. Since class B is the one being told what to do by class A, it’s the delegating object. We give class B a special property called a delegate to tell it who its delegate is—that way, it knows who to communicate with. The delegate can be any class that has a set of methods that have been defined in a <em>protocol</em>
 . A protocol is like an agreement between the two classes that tells them what the delegate can ask the delegating object to do. It has a list of method and property names that the delegate can use with the delegating object.</p>
<p class="indent">Class A creates class B, makes itself the delegate of class B, and gives class B a job to do that’s in the protocol. Once class B is done with its job, it reports back to class A. Let’s see how this works in our app.</p>
<p class="indent">The Birthdays table view controller is view controller A, and the Add Birthday view controller is view controller B. We’ll create a protocol called <span class="code">AddBirthdayViewControllerDelegate</span>
 and a method for that protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 , which the Add Birthday view controller will use to report back.</p>
<p class="indent">Take a look at <a href="text00022.html#ch11fig6">Figure 11-6</a>
 . When the user taps the Add button <span class="ent">➊</span>
 , the Birthdays table view controller creates the Add Birthday view controller <span class="ent">➋</span>
 and sets itself as the Add Birthday view controller’s delegate.</p>
<div class="image"><img src="Image00246.jpg" />
</div>
<p class="figcap"><a id="ch11fig6"></a>
 <em>Figure 11-6: A new birthday is added and passed from the Add Birthday view controller to the Birthdays table view controller using delegation.</em>
</p>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="indent">Now that you have the Birthdays table view controller set up in the storyboard, the next step is to make cells in your table that will display each birthday.</p>
<h4 class="h4" id="ch11lev2sec2">
<strong>ADDING CELLS TO THE TABLE VIEW</strong>
</h4>
<p class="noindent">Each birthday will be displayed in a <span class="code">UITableViewCell</span>
 in the Birthdays table view controller. A table has boxes organized into rows and columns that contain information. These boxes are called <em>cells</em>
 . Similarly, a table view also has cells that are all instances of, or a subclass of, the <span class="code">UITableViewCell</span>
 class. We’ll put each birthday into its own cell in our table view.</p>
<p class="indent">We’ll start by creating those cells in the storyboard, and then we’ll fill them with our <span class="code">Birthday</span>
 objects later. In the left outline menu, click the triangle by Birthdays and then click the triangle by Table View to open those sections. Then select <strong>Table View Cell</strong>
 <span class="ent">➊</span>
 , as shown in <a href="text00022.html#ch11fig4">Figure 11-4</a>
 .</p>
<div class="image"><img src="Image00237.jpg" />
</div>
<div class="image"><img src="Image00238.jpg" />
</div>
<p class="figcap"><a id="ch11fig4"></a>
 <em>Figure 11-4: Creating a Subtitle style table view cell and setting its identifier</em>
</p>
<p class="indent"><span id="page_159"></span>
 Next, open the Attributes Inspector. Using the drop-down menu under <strong>Style</strong>
 , set the cell’s style to <strong>Subtitle</strong>
 <span class="ent">➋</span>
 so that the cell now has a Title label and a Subtitle label. You’ll display each person’s name in the Title and birthday in the Subtitle.</p>
<p class="indent">Finally, enter <span class="code">
<span class="codestrong">birthdayCellIdentifier</span>
</span>
 in the Identifier field <span class="ent">➌</span>
 . You’ll use this identifier later when you fill in the cell contents.</p>
<p class="indent">That’s it! You’ve finished your work in the storyboard.</p>
<p class="indent">You may be wondering why we have just one cell in our table view in the storyboard when we’ll have more than one birthday to show in the list. If you look at <a href="text00022.html#ch11fig4">Figure 11-4</a>
 again, you’ll notice that the cell is labeled <em>Prototype Cells</em>
 . This means that the cell you just customized is a <em>template</em>
 for all the cells you want to appear in your table view. The identifier you gave the cell is how your code will tell the table view to produce each cell for you to put birthdays in. You’ll see how this works soon.</p>
<div class="box1">
<p class="box-title">
<strong>WORKING WITH DATES</strong>
</p>
<p class="box-p">Swift has a special data type called <span class="code">Date</span>
 that is used for storing date values. A <span class="code">Date</span>
 object is actually a date and a time. Open your playground and enter the following:</p>
<div class="image"><img src="Image00239.jpg" />
</div>
<p class="box-pi">We’ve just assigned the current date and time the code was run to the variable <span class="code">today</span>
 . When you print <span class="code">today</span>
 , it’s in the format <span class="code">"2017-11-21 10:45:31 +0000\n"</span>
 . What if you wanted it to display as <span class="code">Tuesday, November 21, 2017</span>
 , instead? Or just <span class="code">11/21/17</span>
 ? To display a date in a particular way, you use a <em>date formatter</em>
 , which is a <span class="code">DateFormatter</span>
 object that you create and give a date format style. <span class="code">DateFormatter</span>
 is a helper object that is used to create a display string from any date, and a <em>date format style</em>
 is a property of <span class="code">DateFormatter</span>
 that tells the formatter what style to use. You can create your own date format styles manually, but there are also styles that are included in Swift and ready to use. Add the following to your playground:</p>
<div class="image"><img src="Image00240.jpg" />
</div>
<p class="box-pi">At <span class="ent">➊</span>
 you create a <span class="code">formatter</span>
 . Then at <span class="ent">➋</span>
 , you set the style of the <span class="code">formatter</span>
 to <span class="code">Style.full</span>
 , which will print the day of the week as well as the full month name, date, and year. Finally, you create a string from the date using the <span class="code">string(from:)</span>
 method of the <span class="code">DateFormatter</span>
 class <span class="ent">➌</span>
 . You can see that you now have turned the <span id="page_160"></span>
 date into the nicely formatted string <span class="code">"Tuesday, November 21, 2017"</span>
 . <a style=";color:black;" href="text00022.html#ch11tab1">Table 11-1</a>
 shows the different strings that are created from the five <span class="code">DateFormatter.Style</span>
 options available in Swift.</p>
<p class="tabcap"><a id="ch11tab1" style=";color:black;"></a>
 <strong>Table 11-1:</strong>
 Date Formatter Styles and Their Date Strings</p>
<table class="tabled">
<tbody>
<tr>
<td style="vertical-align: top;" class="border1">
<p class="noindent">
<span class="code">
<span class="codestrong">DateFormatter.Style</span>
</span>
</p>
</td>
<td style="vertical-align: top;" class="border1">
<p class="noindent">
<strong>Date string</strong>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">none</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">""</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">short</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"11/21/17"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">medium</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"Nov 21, 2017"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">long</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"November 21, 2017"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">full</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"Tuesday, November 21, 2017"</span>
</p>
</td>
</tr>
</tbody>
</table>
<p class="box-pi">You can also specify your own custom way of displaying a date using the <span class="code">dateFormat</span>
 property of the <span class="code">DateFormatter</span>
 . Perhaps you only want the month and day. Or maybe you want a four-digit year displayed in the <span class="code">short</span>
 style. Doing either is really easy, and you don’t even have to create a new <span class="code">DateFormatter</span>
 —you can just change the <span class="code">dateFormat</span>
 on <span class="code">formatter</span>
 and then ask it for a new string. Add the following code to your playground to display dates with a specific format:</p>
<div class="image"><img src="Image00241.jpg" />
</div>
<p class="box-pi">At <span class="ent">➊</span>
 , you specify that you only want the month and the date in an <span class="code">MM/dd</span>
 format—that is, a two-digit month followed by a two-digit date. If you want to display the month as three letters, then use <span class="code">MMM</span>
 . To display the full name of the month, use <span class="code">MMMM</span>
 . At <span class="ent">➋</span>
 , we change the date format to use a four-digit year. A two-digit year would be <span class="code">yy</span>
 . Here are a few other ways to use a <span class="code">dateFormat</span>
 to display a custom date string.</p>
<div class="image"><img src="Image00242.jpg" />
</div>
<p class="box-pi"><span id="page_161"></span>
 If you want to include separators, you add them to your <span class="code">dateFormat</span>
 string. For example, if you want periods as separators, then you can create a <span class="code">dateFormat</span>
 like <span class="code">"MM.dd.yy"</span>
 <span class="ent">➊</span>
 . To display an abbreviated day of the week, use <span class="code">EEE</span>
 <span class="ent">➋</span>
 . For the full day, use <span class="code">EEEE</span>
 <span class="ent">➌</span>
 . These are only a few examples. By using combinations of <span class="code">M</span>
 , <span class="code">d</span>
 , <span class="code">y</span>
 , and <span class="code">E</span>
 , you have an endless number of ways to display a date!</p>
</div>
<h4 class="h4" id="ch11lev2sec3">
<strong>SETTING UP THE BIRTHDAYS TABLE VIEW CONTROLLER</strong>
</h4>
<p class="noindent">The Birthdays table view controller will display a list of all the birthdays stored in the app. Do you remember what you use to store a list of items? That’s right—an array! You’ll create an array in the <span class="code">BirthdaysTableViewController</span>
 to store all the birthdays. To do this, give the <span class="code">BirthdaysTableViewController</span>
 a <span class="code">birthdays</span>
 property that is an array of <span class="code">Birthday</span>
 objects. At the top of the class, right above the <span class="code">viewDidLoad()</span>
 method, insert this line to add a variable array property called <span class="code">birthdays</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController {</span>
<br />
<br />
    <span class="pink">var</span>
 birthdays = [<span class="green1">Birthday</span>
 ]()<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent">This line creates an empty array of <span class="code">Birthday</span>
 instances. It needs to be a variable and not a constant because you’ll want to add a saved <span class="code">Birthday</span>
 to this array every time the user adds a <span class="code">Birthday</span>
 with the Add Birthday view controller. You’ll see how to do that in “<a href="text00022.html#ch11lev3sec2">Making the Birthdays Table View Controller Conform to Protocol</a>
 ” on <a href="text00022.html#page_168">page 168</a>
 .</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>Remember that the final versions of the project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>.</em>
</p>
</div>
<p class="indent">The <span class="code">BirthdaysTableViewController</span>
 will also need a <span class="code">dateFormatter</span>
 property to display the birthdate as a nicely formatted string. Add a <span class="code">dateFormatter</span>
 right underneath the <span class="code">birthdays</span>
 array:</p>
<div class="box">
<pre>    <span class="ash">var birthdays = [Birthday]()</span>
<br />
<br />
    <span class="pink">let</span>
 dateFormatter = <span class="violet">DateFormatter</span>
 ()<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent">Note that the <span class="code">dateFormatter</span>
 is a constant that is created with <span class="code">let</span>
 . Even though you’ll change the <span class="code">dateFormatter</span>
 ’s properties, like the <span class="code">dateStyle</span>
 and <span class="code">timeStyle</span>
 , you’ll never change the <span class="code">dateFormatter</span>
 itself.</p>
<p class="indent"><span id="page_162"></span>
 You’ll also need to set up the <span class="code">dateFormatter</span>
 so that it will display the birthdates as fully formatted strings like <span class="code">"Tuesday, December 17, 2008"</span>
 . As you saw in <a href="text00021.html#ch10">Chapter 10</a>
 , a good place to do this is the <span class="code">viewDidLoad()</span>
 method, which is called when the Birthdays table view controller is loading its view. This is the perfect place to do any setup that is needed for this class.</p>
<div class="box">
<pre>
<span class="ash">override func viewDidLoad() {</span>
<br />
    <span class="ash">super.viewDidLoad()</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">dateFormatter</span>
 .<span class="violet">dateStyle</span>
 = .<span class="blue">full</span>
<br />
  <span class="ent">➋</span>
 <span class="green1">dateFormatter</span>
 .<span class="violet">timeStyle</span>
 = .<span class="blue">none</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , you set the <span class="code">dateStyle</span>
 of the <span class="code">dateFormatter</span>
 so that it will display a formatted date string for each <span class="code">Birthday</span>
 . Did you notice how we just wrote <span class="code">.full</span>
 instead of <span class="code">DateFormatter.Style.full</span>
 ? Swift knows what type to expect for the <span class="code">dateStyle</span>
 of a <span class="code">DateFormatter</span>
 , so it lets us take this little shortcut. At <span class="ent">➋</span>
 , you set the <span class="code">timeStyle</span>
 of the <span class="code">dateFormatter</span>
 to <span class="code">.none</span>
 so that the time won’t be shown.</p>
<h4 class="h4" id="ch11lev2sec4">
<strong>DISPLAYING BIRTHDAYS IN A TABLE VIEW</strong>
</h4>
<p class="noindent">The <span class="code">BirthdaysTableViewController</span>
 class has a table view that is used to display a list of items in a single column. The table view has one or more sections containing rows, and each row contains a cell. A section in a table view is a grouping of rows that can be displayed with or without a header. An example of an app that shows a table view with several sections is the Settings app, as shown in <a href="text00022.html#ch11fig5">Figure 11-5</a>
 . It displays a list of rows that have been broken up into different sections.</p>
<p class="indent">Each section and row of a table view is identified with an index number. These numbers start at 0 and then increase by 1 as you go down the table view. For example, the Privacy line in the Settings app is found at section 0, row 1. The News setting is at section 1, row 3.</p>
<p class="indent">In the middle of the <span class="code">BirthdaysTableViewController</span>
 class, there is a section called <em>Table view data source</em>
 with three methods. The table view controller uses these methods to determine what’s going to be displayed inside its table view.</p>
<p class="hang">
<span class="code">
<span class="codestrong">numberOfSections(in:)</span>
</span>
 Tells the table view how many sections it should have</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:numberOfRowsInSection:)</span>
</span>
 Tells the table view how many rows will be displayed in each section</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:cellForRowAt:)</span>
</span>
 Sets up each cell that’s going to be displayed in each row of the table view</p>
<div class="image"><span id="page_163"></span>
 <img src="Image00243.jpg" />
</div>
<p class="figcap"><a id="ch11fig5"></a>
 <em>Figure 11-5: The Settings app uses sections to group rows of different device settings.</em>
</p>
<p class="indent">The table view data source methods are called by the table view controller every time the table view is reloaded. Xcode automatically gives you these method templates when you make a subclass of a <span class="code">UITableViewController</span>
 . You need to implement all three methods for the app to work, even though you’ll never call them directly in your code. The <span class="code">UITableViewController</span>
 class implements the <span class="code">UITableViewDataSource</span>
 protocol, which comes with these data source methods, to determine what will be displayed inside the table view. We’ll discuss protocols in “<a href="text00022.html#ch11lev2sec5">Delegation</a>
 ” on page 166. For now, you just need to know that a <span class="code">UITableViewController</span>
 uses these methods to display its content, and it automatically calls these methods so you don’t need to call them.</p>
<p class="indent">Let’s start with the method <span class="code">numberOfSections(in:)</span>
 . The Birthdays table view controller is a list that just displays <span class="code">Birthday</span>
 instances, so it doesn’t need multiple sections. To set the number of sections in the table view, we just need to return <span class="code">1</span>
 .</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func numberOfSections(in tableView: UITableView) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 <span class="blue1">1</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent"><span id="page_164"></span>
 This method takes a <span class="code">UITableView</span>
 called <span class="code">tableView</span>
 as a parameter, which is the table view that uses this class as its data source. We don’t need to worry about making this connection because the <span class="code">UITableViewController</span>
 comes with a built-in table view that is automatically hooked up to these methods. Each birthday will be displayed in its own row. So in <span class="code">tableView(_:numberOfRowsInSection:)</span>
 , in order to have the right number of rows for all of your birthdays, you need to return the number of <span class="code">Birthday</span>
 instances that you have in your <span class="code">birthdays</span>
 array. Do you remember the <span class="code">count</span>
 property of an array? It’s an integer that tells you how many items are in that array, and it’s perfect for this situation! Change this method to the following:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, <img class="inline" src="Image00184.jpg" />
<br />
    numberOfRowsInSection section: Int) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 birthdays.<span class="violet">count</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">In addition to the <span class="code">tableView</span>
 parameter, <span class="code">tableView(_:numberOfRowsInSection:)</span>
 also takes an <span class="code">Int</span>
 called <span class="code">section</span>
 . When the table view is loading itself, this method is called for each section in the table view. In our case, we have only one section, so we don’t need to bother checking which <span class="code">section</span>
 of the table view is being displayed here. We know it’s section 0, and we want it to have as many rows as there are birthdays, so we write <span class="code">return birthdays.count</span>
 .</p>
<p class="indent">Finally, you need to implement <span class="code">tableView(_:cellForRowAt:)</span>
 so that the table view will know what to put inside each cell. Since this method is commented out, you need to uncomment it by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it. (Be careful not to accidentally uncomment the other methods after it!) After you’ve done that, change it to the following code:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, cellForRowAt <img class="inline" src="Image00184.jpg" />
<br />
    indexPath: IndexPath) -&gt; UITableViewCell {</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="pink">let</span>
 cell = tableView.<span class="blue">dequeueReusableCell</span>
 (withIdentifier: <img class="inline" src="Image00093.jpg" />
<br />
        <span class="red">"birthdayCellIdentifier"</span>
 , for: indexPath)<br />
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 birthday = <span class="green1">birthdays</span>
 [indexPath.<span class="violet">row</span>
 ]<br />
<br />
  <span class="ent">➌</span>
 cell.<span class="violet">textLabel</span>
 ?.<span class="violet">text</span>
 = birthday.<span class="green1">firstName</span>
 <span class="blue">+</span>
 <span class="red">" "</span>
 <span class="blue">+</span>
 <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">lastName</span>
<br />
<br />
  <span class="ent">➍</span>
 cell.<span class="violet">detailTextLabel</span>
 ?.<span class="violet">text</span>
 = <span class="green1">dateFormatter</span>
 .<span class="blue">string</span>
 (from: <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">birthdate</span>
 )<br />
<br />
  <span class="ent">➎</span>
 <span class="pink">return</span>
 cell<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">You don’t call the method <span class="code">tableView(_:cellForRowAt:)</span>
 . It’s called when the table view is loaded onto the screen. It’s called for each cell on the screen and takes two parameters, <span class="code">tableView</span>
 and <span class="code">indexPath</span>
 . You already know <span id="page_165"></span>
 what the <span class="code">tableView</span>
 parameter is for. An <span class="code">IndexPath</span>
 is a Swift struct that’s used to represent a row’s position in a table view. An <span class="code">IndexPath</span>
 instance has a <span class="code">section</span>
 property and a <span class="code">row</span>
 property. Since this method will be called many times (once for every row in the table), we need the <span class="code">indexPath</span>
 to know which section and row we’re currently configuring. The <span class="code">indexPath.section</span>
 property gives the section number, and the <span class="code">indexPath.row</span>
 gives the row of the table view cell. The five lines of code inside <span class="code">tableView(_:cellForRowAt:)</span>
 will do the following:</p>
<div class="image"><img src="Image00244.jpg" />
</div>
<p class="bull">• Create a <span class="code">UITableViewCell</span>
</p>
<p class="bull">• Figure out which <span class="code">Birthday</span>
 in the <span class="code">birthdays</span>
 array will be displayed inside the cell</p>
<p class="bull">• Make two labels to display the birthday person’s name and birthdate in the cell</p>
<p class="bull">• Return the cell ready for display in the table view</p>
<p class="indentt">Let’s go through this code line by line.</p>
<p class="indent">First, create the <span class="code">UITableViewCell</span>
 . The code at <span class="ent">➊</span>
 does this using the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 . Before you can start using this method on a cell, though, you need to tell the method which cell you want to use from the storyboard. Earlier, when you were in the storyboard, you gave your cell the identifier <span class="code">birthdayCellIdentifier</span>
 (see <a href="text00022.html#ch11fig4">Figure 11-4</a>
 ). This identifier links your code to the cell and tells your method that it’s using the right cell. The string for when you call this method needs to be exactly the same as the string you set in the storyboard, or you’ll get an error and the app will crash when you run it.</p>
<p class="indent">In the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 , did you notice the words <em>Reusable Cell</em>
 ? The cells inside a table view are created once and then can be reused over and over. This helps everything run faster and smoother because creating the cell is what takes the most time. If you had 200 birthdays in your app, but only 10 would fit on your screen at one time, then you need only 10 cells to show your birthdays. When you scroll down to reveal more birthdays, the cells that scroll off the top of the screen are reused. They are filled with new information and show up again at the bottom of the screen. The <span class="code">UITableView</span>
 automatically does this work. When the table view is loaded, <span class="code">tableView(_:cellForRowAt:)</span>
 is called for every visible row. When the user scrolls to look at more cells, it’s called again for each row just as it is about to appear on the screen.</p>
<p class="indent">Next, we need to find out which <span class="code">Birthday</span>
 should be displayed inside the cell. We want to display one birthday from the <span class="code">birthdays</span>
 array in each row. The first birthday, which is at <span class="code">birthdays[0]</span>
 , should be displayed in row 0. The second birthday, at <span class="code">birthdays[1]</span>
 , should be displayed in row 1, and so on, which means the <span class="code">indexPath</span>
 ’s <span class="code">row</span>
 is the same as the position in the <span class="code">birthdays</span>
 array that we want to access. The code at <span class="ent">➋</span>
 accesses the <span id="page_166"></span>
 correct <span class="code">Birthday</span>
 object from the <span class="code">birthdays</span>
 array by using <span class="code">indexPath.row</span>
 . Once we have the right <span class="code">Birthday</span>
 object, we assign it to a constant named <span class="code">birthday</span>
 so we can set up the labels in this cell.</p>
<p class="indent">Notice that we’re using <span class="code">let</span>
 to assign the <span class="code">birthday</span>
 to a constant instead of a variable. We can use <span class="code">let</span>
 because each time <span class="code">tableView(_:cellForRowAt:)</span>
 is called, a new <span class="code">birthday</span>
 constant is created. Each cell gets its own <span class="code">birthday</span>
 constant that is assigned its own <span class="code">Birthday</span>
 object. Since we’re not going to change any of the <span class="code">birthday</span>
 constants—we’re just going to read their properties—we don’t want to make them variables.</p>
<p class="indent">Now that you have your cell and your birthday, it’s time to fill in the details. You need two labels for each cell to show the birthday person’s name and birthdate. You set the cell to the Subtitle style so that it has a Title label and a Subtitle label. Each cell will already contain these labels, so now you don’t have to create any labels yourself.</p>
<p class="indent">The labels exist as properties of <span class="code">UITableViewCell</span>
 and are called <span class="code">textLabel</span>
 and <span class="code">detailTextLabel</span>
 . The code at <span class="ent">➌</span>
 sets the text of the <span class="code">textLabel</span>
 to a string made up of the <span class="code">firstName</span>
 and <span class="code">lastName</span>
 of the <span class="code">birthday</span>
 with a space between them. At <span class="ent">➍</span>
 , you use the <span class="code">string(from:)</span>
 method of the <span class="code">dateFormatter</span>
 to display the birthdate in the <span class="code">detailTextLabel</span>
 .</p>
<p class="indent">When your cell is completely configured, <span class="code">tableView( _:cellForRowAt:)</span>
 returns the cell at <span class="ent">➎</span>
 so that it can be displayed at that <span class="code">indexPath</span>
 of the table view.</p>
<h3 class="h3" id="ch11lev1sec2">
<strong>PUTTING IT ALL TOGETHER</strong>
</h3>
<p class="noindent">Now you can add <span class="code">Birthday</span>
 instances to the app using the Add Birthday view controller, and you have a table view to list each <span class="code">Birthday</span>
 in the Birthdays table view controller. But when you try running the app and adding a <span class="code">Birthday</span>
 , it doesn’t appear. To make each <span class="code">Birthday</span>
 you add appear in the table view, you need to make the Add Birthday view controller communicate with the Birthdays table view controller. You do this by using <em>delegation</em>
 .</p>
<h4 class="h4" id="ch11lev2sec5">
<strong>DELEGATION</strong>
</h4>
<p class="noindent">Delegation can be used when one view controller needs to get information from another view controller. Say you have two view controllers: A and B. The first view controller, A, creates B and presents B on top of itself. A knows about B because it created and presented B, so A can pass information along to B. But B doesn’t know about A—it’s just popped into being and doesn’t know where it came from or how it got there. So how can B talk to A? Through delegation!</p>
<div class="image"><img src="Image00245.jpg" />
</div>
<p class="indent">Delegation is when someone gives a job or a task to someone else. A <em>delegate</em>
 is like a boss who tells a delegating employee what to do. When the delegating employee is done with their task, sometimes they’ll report information back to the delegate boss.</p>
<p class="indent"><span id="page_167"></span>
 Delegation in Swift is pretty similar, but instead of having a boss and employee, we have a delegate and a delegating object. Since class B is the one being told what to do by class A, it’s the delegating object. We give class B a special property called a delegate to tell it who its delegate is—that way, it knows who to communicate with. The delegate can be any class that has a set of methods that have been defined in a <em>protocol</em>
 . A protocol is like an agreement between the two classes that tells them what the delegate can ask the delegating object to do. It has a list of method and property names that the delegate can use with the delegating object.</p>
<p class="indent">Class A creates class B, makes itself the delegate of class B, and gives class B a job to do that’s in the protocol. Once class B is done with its job, it reports back to class A. Let’s see how this works in our app.</p>
<p class="indent">The Birthdays table view controller is view controller A, and the Add Birthday view controller is view controller B. We’ll create a protocol called <span class="code">AddBirthdayViewControllerDelegate</span>
 and a method for that protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 , which the Add Birthday view controller will use to report back.</p>
<p class="indent">Take a look at <a href="text00022.html#ch11fig6">Figure 11-6</a>
 . When the user taps the Add button <span class="ent">➊</span>
 , the Birthdays table view controller creates the Add Birthday view controller <span class="ent">➋</span>
 and sets itself as the Add Birthday view controller’s delegate.</p>
<div class="image"><img src="Image00246.jpg" />
</div>
<p class="figcap"><a id="ch11fig6"></a>
 <em>Figure 11-6: A new birthday is added and passed from the Add Birthday view controller to the Birthdays table view controller using delegation.</em>
</p>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<h4 class="h4" id="ch11lev2sec2">
<strong>ADDING CELLS TO THE TABLE VIEW</strong>
</h4>
<p class="noindent">Each birthday will be displayed in a <span class="code">UITableViewCell</span>
 in the Birthdays table view controller. A table has boxes organized into rows and columns that contain information. These boxes are called <em>cells</em>
 . Similarly, a table view also has cells that are all instances of, or a subclass of, the <span class="code">UITableViewCell</span>
 class. We’ll put each birthday into its own cell in our table view.</p>
<p class="indent">We’ll start by creating those cells in the storyboard, and then we’ll fill them with our <span class="code">Birthday</span>
 objects later. In the left outline menu, click the triangle by Birthdays and then click the triangle by Table View to open those sections. Then select <strong>Table View Cell</strong>
 <span class="ent">➊</span>
 , as shown in <a href="text00022.html#ch11fig4">Figure 11-4</a>
 .</p>
<div class="image"><img src="Image00237.jpg" />
</div>
<div class="image"><img src="Image00238.jpg" />
</div>
<p class="figcap"><a id="ch11fig4"></a>
 <em>Figure 11-4: Creating a Subtitle style table view cell and setting its identifier</em>
</p>
<p class="indent"><span id="page_159"></span>
 Next, open the Attributes Inspector. Using the drop-down menu under <strong>Style</strong>
 , set the cell’s style to <strong>Subtitle</strong>
 <span class="ent">➋</span>
 so that the cell now has a Title label and a Subtitle label. You’ll display each person’s name in the Title and birthday in the Subtitle.</p>
<p class="indent">Finally, enter <span class="code">
<span class="codestrong">birthdayCellIdentifier</span>
</span>
 in the Identifier field <span class="ent">➌</span>
 . You’ll use this identifier later when you fill in the cell contents.</p>
<p class="indent">That’s it! You’ve finished your work in the storyboard.</p>
<p class="indent">You may be wondering why we have just one cell in our table view in the storyboard when we’ll have more than one birthday to show in the list. If you look at <a href="text00022.html#ch11fig4">Figure 11-4</a>
 again, you’ll notice that the cell is labeled <em>Prototype Cells</em>
 . This means that the cell you just customized is a <em>template</em>
 for all the cells you want to appear in your table view. The identifier you gave the cell is how your code will tell the table view to produce each cell for you to put birthdays in. You’ll see how this works soon.</p>
<div class="box1">
<p class="box-title">
<strong>WORKING WITH DATES</strong>
</p>
<p class="box-p">Swift has a special data type called <span class="code">Date</span>
 that is used for storing date values. A <span class="code">Date</span>
 object is actually a date and a time. Open your playground and enter the following:</p>
<div class="image"><img src="Image00239.jpg" />
</div>
<p class="box-pi">We’ve just assigned the current date and time the code was run to the variable <span class="code">today</span>
 . When you print <span class="code">today</span>
 , it’s in the format <span class="code">"2017-11-21 10:45:31 +0000\n"</span>
 . What if you wanted it to display as <span class="code">Tuesday, November 21, 2017</span>
 , instead? Or just <span class="code">11/21/17</span>
 ? To display a date in a particular way, you use a <em>date formatter</em>
 , which is a <span class="code">DateFormatter</span>
 object that you create and give a date format style. <span class="code">DateFormatter</span>
 is a helper object that is used to create a display string from any date, and a <em>date format style</em>
 is a property of <span class="code">DateFormatter</span>
 that tells the formatter what style to use. You can create your own date format styles manually, but there are also styles that are included in Swift and ready to use. Add the following to your playground:</p>
<div class="image"><img src="Image00240.jpg" />
</div>
<p class="box-pi">At <span class="ent">➊</span>
 you create a <span class="code">formatter</span>
 . Then at <span class="ent">➋</span>
 , you set the style of the <span class="code">formatter</span>
 to <span class="code">Style.full</span>
 , which will print the day of the week as well as the full month name, date, and year. Finally, you create a string from the date using the <span class="code">string(from:)</span>
 method of the <span class="code">DateFormatter</span>
 class <span class="ent">➌</span>
 . You can see that you now have turned the <span id="page_160"></span>
 date into the nicely formatted string <span class="code">"Tuesday, November 21, 2017"</span>
 . <a style=";color:black;" href="text00022.html#ch11tab1">Table 11-1</a>
 shows the different strings that are created from the five <span class="code">DateFormatter.Style</span>
 options available in Swift.</p>
<p class="tabcap"><a id="ch11tab1" style=";color:black;"></a>
 <strong>Table 11-1:</strong>
 Date Formatter Styles and Their Date Strings</p>
<table class="tabled">
<tbody>
<tr>
<td style="vertical-align: top;" class="border1">
<p class="noindent">
<span class="code">
<span class="codestrong">DateFormatter.Style</span>
</span>
</p>
</td>
<td style="vertical-align: top;" class="border1">
<p class="noindent">
<strong>Date string</strong>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">none</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">""</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">short</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"11/21/17"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">medium</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"Nov 21, 2017"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">long</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"November 21, 2017"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">full</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"Tuesday, November 21, 2017"</span>
</p>
</td>
</tr>
</tbody>
</table>
<p class="box-pi">You can also specify your own custom way of displaying a date using the <span class="code">dateFormat</span>
 property of the <span class="code">DateFormatter</span>
 . Perhaps you only want the month and day. Or maybe you want a four-digit year displayed in the <span class="code">short</span>
 style. Doing either is really easy, and you don’t even have to create a new <span class="code">DateFormatter</span>
 —you can just change the <span class="code">dateFormat</span>
 on <span class="code">formatter</span>
 and then ask it for a new string. Add the following code to your playground to display dates with a specific format:</p>
<div class="image"><img src="Image00241.jpg" />
</div>
<p class="box-pi">At <span class="ent">➊</span>
 , you specify that you only want the month and the date in an <span class="code">MM/dd</span>
 format—that is, a two-digit month followed by a two-digit date. If you want to display the month as three letters, then use <span class="code">MMM</span>
 . To display the full name of the month, use <span class="code">MMMM</span>
 . At <span class="ent">➋</span>
 , we change the date format to use a four-digit year. A two-digit year would be <span class="code">yy</span>
 . Here are a few other ways to use a <span class="code">dateFormat</span>
 to display a custom date string.</p>
<div class="image"><img src="Image00242.jpg" />
</div>
<p class="box-pi"><span id="page_161"></span>
 If you want to include separators, you add them to your <span class="code">dateFormat</span>
 string. For example, if you want periods as separators, then you can create a <span class="code">dateFormat</span>
 like <span class="code">"MM.dd.yy"</span>
 <span class="ent">➊</span>
 . To display an abbreviated day of the week, use <span class="code">EEE</span>
 <span class="ent">➋</span>
 . For the full day, use <span class="code">EEEE</span>
 <span class="ent">➌</span>
 . These are only a few examples. By using combinations of <span class="code">M</span>
 , <span class="code">d</span>
 , <span class="code">y</span>
 , and <span class="code">E</span>
 , you have an endless number of ways to display a date!</p>
</div>
<h4 class="h4" id="ch11lev2sec3">
<strong>SETTING UP THE BIRTHDAYS TABLE VIEW CONTROLLER</strong>
</h4>
<p class="noindent">The Birthdays table view controller will display a list of all the birthdays stored in the app. Do you remember what you use to store a list of items? That’s right—an array! You’ll create an array in the <span class="code">BirthdaysTableViewController</span>
 to store all the birthdays. To do this, give the <span class="code">BirthdaysTableViewController</span>
 a <span class="code">birthdays</span>
 property that is an array of <span class="code">Birthday</span>
 objects. At the top of the class, right above the <span class="code">viewDidLoad()</span>
 method, insert this line to add a variable array property called <span class="code">birthdays</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController {</span>
<br />
<br />
    <span class="pink">var</span>
 birthdays = [<span class="green1">Birthday</span>
 ]()<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent">This line creates an empty array of <span class="code">Birthday</span>
 instances. It needs to be a variable and not a constant because you’ll want to add a saved <span class="code">Birthday</span>
 to this array every time the user adds a <span class="code">Birthday</span>
 with the Add Birthday view controller. You’ll see how to do that in “<a href="text00022.html#ch11lev3sec2">Making the Birthdays Table View Controller Conform to Protocol</a>
 ” on <a href="text00022.html#page_168">page 168</a>
 .</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>Remember that the final versions of the project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>.</em>
</p>
</div>
<p class="indent">The <span class="code">BirthdaysTableViewController</span>
 will also need a <span class="code">dateFormatter</span>
 property to display the birthdate as a nicely formatted string. Add a <span class="code">dateFormatter</span>
 right underneath the <span class="code">birthdays</span>
 array:</p>
<div class="box">
<pre>    <span class="ash">var birthdays = [Birthday]()</span>
<br />
<br />
    <span class="pink">let</span>
 dateFormatter = <span class="violet">DateFormatter</span>
 ()<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent">Note that the <span class="code">dateFormatter</span>
 is a constant that is created with <span class="code">let</span>
 . Even though you’ll change the <span class="code">dateFormatter</span>
 ’s properties, like the <span class="code">dateStyle</span>
 and <span class="code">timeStyle</span>
 , you’ll never change the <span class="code">dateFormatter</span>
 itself.</p>
<p class="indent"><span id="page_162"></span>
 You’ll also need to set up the <span class="code">dateFormatter</span>
 so that it will display the birthdates as fully formatted strings like <span class="code">"Tuesday, December 17, 2008"</span>
 . As you saw in <a href="text00021.html#ch10">Chapter 10</a>
 , a good place to do this is the <span class="code">viewDidLoad()</span>
 method, which is called when the Birthdays table view controller is loading its view. This is the perfect place to do any setup that is needed for this class.</p>
<div class="box">
<pre>
<span class="ash">override func viewDidLoad() {</span>
<br />
    <span class="ash">super.viewDidLoad()</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">dateFormatter</span>
 .<span class="violet">dateStyle</span>
 = .<span class="blue">full</span>
<br />
  <span class="ent">➋</span>
 <span class="green1">dateFormatter</span>
 .<span class="violet">timeStyle</span>
 = .<span class="blue">none</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , you set the <span class="code">dateStyle</span>
 of the <span class="code">dateFormatter</span>
 so that it will display a formatted date string for each <span class="code">Birthday</span>
 . Did you notice how we just wrote <span class="code">.full</span>
 instead of <span class="code">DateFormatter.Style.full</span>
 ? Swift knows what type to expect for the <span class="code">dateStyle</span>
 of a <span class="code">DateFormatter</span>
 , so it lets us take this little shortcut. At <span class="ent">➋</span>
 , you set the <span class="code">timeStyle</span>
 of the <span class="code">dateFormatter</span>
 to <span class="code">.none</span>
 so that the time won’t be shown.</p>
<h4 class="h4" id="ch11lev2sec4">
<strong>DISPLAYING BIRTHDAYS IN A TABLE VIEW</strong>
</h4>
<p class="noindent">The <span class="code">BirthdaysTableViewController</span>
 class has a table view that is used to display a list of items in a single column. The table view has one or more sections containing rows, and each row contains a cell. A section in a table view is a grouping of rows that can be displayed with or without a header. An example of an app that shows a table view with several sections is the Settings app, as shown in <a href="text00022.html#ch11fig5">Figure 11-5</a>
 . It displays a list of rows that have been broken up into different sections.</p>
<p class="indent">Each section and row of a table view is identified with an index number. These numbers start at 0 and then increase by 1 as you go down the table view. For example, the Privacy line in the Settings app is found at section 0, row 1. The News setting is at section 1, row 3.</p>
<p class="indent">In the middle of the <span class="code">BirthdaysTableViewController</span>
 class, there is a section called <em>Table view data source</em>
 with three methods. The table view controller uses these methods to determine what’s going to be displayed inside its table view.</p>
<p class="hang">
<span class="code">
<span class="codestrong">numberOfSections(in:)</span>
</span>
 Tells the table view how many sections it should have</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:numberOfRowsInSection:)</span>
</span>
 Tells the table view how many rows will be displayed in each section</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:cellForRowAt:)</span>
</span>
 Sets up each cell that’s going to be displayed in each row of the table view</p>
<div class="image"><span id="page_163"></span>
 <img src="Image00243.jpg" />
</div>
<p class="figcap"><a id="ch11fig5"></a>
 <em>Figure 11-5: The Settings app uses sections to group rows of different device settings.</em>
</p>
<p class="indent">The table view data source methods are called by the table view controller every time the table view is reloaded. Xcode automatically gives you these method templates when you make a subclass of a <span class="code">UITableViewController</span>
 . You need to implement all three methods for the app to work, even though you’ll never call them directly in your code. The <span class="code">UITableViewController</span>
 class implements the <span class="code">UITableViewDataSource</span>
 protocol, which comes with these data source methods, to determine what will be displayed inside the table view. We’ll discuss protocols in “<a href="text00022.html#ch11lev2sec5">Delegation</a>
 ” on page 166. For now, you just need to know that a <span class="code">UITableViewController</span>
 uses these methods to display its content, and it automatically calls these methods so you don’t need to call them.</p>
<p class="indent">Let’s start with the method <span class="code">numberOfSections(in:)</span>
 . The Birthdays table view controller is a list that just displays <span class="code">Birthday</span>
 instances, so it doesn’t need multiple sections. To set the number of sections in the table view, we just need to return <span class="code">1</span>
 .</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func numberOfSections(in tableView: UITableView) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 <span class="blue1">1</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent"><span id="page_164"></span>
 This method takes a <span class="code">UITableView</span>
 called <span class="code">tableView</span>
 as a parameter, which is the table view that uses this class as its data source. We don’t need to worry about making this connection because the <span class="code">UITableViewController</span>
 comes with a built-in table view that is automatically hooked up to these methods. Each birthday will be displayed in its own row. So in <span class="code">tableView(_:numberOfRowsInSection:)</span>
 , in order to have the right number of rows for all of your birthdays, you need to return the number of <span class="code">Birthday</span>
 instances that you have in your <span class="code">birthdays</span>
 array. Do you remember the <span class="code">count</span>
 property of an array? It’s an integer that tells you how many items are in that array, and it’s perfect for this situation! Change this method to the following:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, <img class="inline" src="Image00184.jpg" />
<br />
    numberOfRowsInSection section: Int) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 birthdays.<span class="violet">count</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">In addition to the <span class="code">tableView</span>
 parameter, <span class="code">tableView(_:numberOfRowsInSection:)</span>
 also takes an <span class="code">Int</span>
 called <span class="code">section</span>
 . When the table view is loading itself, this method is called for each section in the table view. In our case, we have only one section, so we don’t need to bother checking which <span class="code">section</span>
 of the table view is being displayed here. We know it’s section 0, and we want it to have as many rows as there are birthdays, so we write <span class="code">return birthdays.count</span>
 .</p>
<p class="indent">Finally, you need to implement <span class="code">tableView(_:cellForRowAt:)</span>
 so that the table view will know what to put inside each cell. Since this method is commented out, you need to uncomment it by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it. (Be careful not to accidentally uncomment the other methods after it!) After you’ve done that, change it to the following code:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, cellForRowAt <img class="inline" src="Image00184.jpg" />
<br />
    indexPath: IndexPath) -&gt; UITableViewCell {</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="pink">let</span>
 cell = tableView.<span class="blue">dequeueReusableCell</span>
 (withIdentifier: <img class="inline" src="Image00093.jpg" />
<br />
        <span class="red">"birthdayCellIdentifier"</span>
 , for: indexPath)<br />
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 birthday = <span class="green1">birthdays</span>
 [indexPath.<span class="violet">row</span>
 ]<br />
<br />
  <span class="ent">➌</span>
 cell.<span class="violet">textLabel</span>
 ?.<span class="violet">text</span>
 = birthday.<span class="green1">firstName</span>
 <span class="blue">+</span>
 <span class="red">" "</span>
 <span class="blue">+</span>
 <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">lastName</span>
<br />
<br />
  <span class="ent">➍</span>
 cell.<span class="violet">detailTextLabel</span>
 ?.<span class="violet">text</span>
 = <span class="green1">dateFormatter</span>
 .<span class="blue">string</span>
 (from: <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">birthdate</span>
 )<br />
<br />
  <span class="ent">➎</span>
 <span class="pink">return</span>
 cell<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">You don’t call the method <span class="code">tableView(_:cellForRowAt:)</span>
 . It’s called when the table view is loaded onto the screen. It’s called for each cell on the screen and takes two parameters, <span class="code">tableView</span>
 and <span class="code">indexPath</span>
 . You already know <span id="page_165"></span>
 what the <span class="code">tableView</span>
 parameter is for. An <span class="code">IndexPath</span>
 is a Swift struct that’s used to represent a row’s position in a table view. An <span class="code">IndexPath</span>
 instance has a <span class="code">section</span>
 property and a <span class="code">row</span>
 property. Since this method will be called many times (once for every row in the table), we need the <span class="code">indexPath</span>
 to know which section and row we’re currently configuring. The <span class="code">indexPath.section</span>
 property gives the section number, and the <span class="code">indexPath.row</span>
 gives the row of the table view cell. The five lines of code inside <span class="code">tableView(_:cellForRowAt:)</span>
 will do the following:</p>
<div class="image"><img src="Image00244.jpg" />
</div>
<p class="bull">• Create a <span class="code">UITableViewCell</span>
</p>
<p class="bull">• Figure out which <span class="code">Birthday</span>
 in the <span class="code">birthdays</span>
 array will be displayed inside the cell</p>
<p class="bull">• Make two labels to display the birthday person’s name and birthdate in the cell</p>
<p class="bull">• Return the cell ready for display in the table view</p>
<p class="indentt">Let’s go through this code line by line.</p>
<p class="indent">First, create the <span class="code">UITableViewCell</span>
 . The code at <span class="ent">➊</span>
 does this using the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 . Before you can start using this method on a cell, though, you need to tell the method which cell you want to use from the storyboard. Earlier, when you were in the storyboard, you gave your cell the identifier <span class="code">birthdayCellIdentifier</span>
 (see <a href="text00022.html#ch11fig4">Figure 11-4</a>
 ). This identifier links your code to the cell and tells your method that it’s using the right cell. The string for when you call this method needs to be exactly the same as the string you set in the storyboard, or you’ll get an error and the app will crash when you run it.</p>
<p class="indent">In the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 , did you notice the words <em>Reusable Cell</em>
 ? The cells inside a table view are created once and then can be reused over and over. This helps everything run faster and smoother because creating the cell is what takes the most time. If you had 200 birthdays in your app, but only 10 would fit on your screen at one time, then you need only 10 cells to show your birthdays. When you scroll down to reveal more birthdays, the cells that scroll off the top of the screen are reused. They are filled with new information and show up again at the bottom of the screen. The <span class="code">UITableView</span>
 automatically does this work. When the table view is loaded, <span class="code">tableView(_:cellForRowAt:)</span>
 is called for every visible row. When the user scrolls to look at more cells, it’s called again for each row just as it is about to appear on the screen.</p>
<p class="indent">Next, we need to find out which <span class="code">Birthday</span>
 should be displayed inside the cell. We want to display one birthday from the <span class="code">birthdays</span>
 array in each row. The first birthday, which is at <span class="code">birthdays[0]</span>
 , should be displayed in row 0. The second birthday, at <span class="code">birthdays[1]</span>
 , should be displayed in row 1, and so on, which means the <span class="code">indexPath</span>
 ’s <span class="code">row</span>
 is the same as the position in the <span class="code">birthdays</span>
 array that we want to access. The code at <span class="ent">➋</span>
 accesses the <span id="page_166"></span>
 correct <span class="code">Birthday</span>
 object from the <span class="code">birthdays</span>
 array by using <span class="code">indexPath.row</span>
 . Once we have the right <span class="code">Birthday</span>
 object, we assign it to a constant named <span class="code">birthday</span>
 so we can set up the labels in this cell.</p>
<p class="indent">Notice that we’re using <span class="code">let</span>
 to assign the <span class="code">birthday</span>
 to a constant instead of a variable. We can use <span class="code">let</span>
 because each time <span class="code">tableView(_:cellForRowAt:)</span>
 is called, a new <span class="code">birthday</span>
 constant is created. Each cell gets its own <span class="code">birthday</span>
 constant that is assigned its own <span class="code">Birthday</span>
 object. Since we’re not going to change any of the <span class="code">birthday</span>
 constants—we’re just going to read their properties—we don’t want to make them variables.</p>
<p class="indent">Now that you have your cell and your birthday, it’s time to fill in the details. You need two labels for each cell to show the birthday person’s name and birthdate. You set the cell to the Subtitle style so that it has a Title label and a Subtitle label. Each cell will already contain these labels, so now you don’t have to create any labels yourself.</p>
<p class="indent">The labels exist as properties of <span class="code">UITableViewCell</span>
 and are called <span class="code">textLabel</span>
 and <span class="code">detailTextLabel</span>
 . The code at <span class="ent">➌</span>
 sets the text of the <span class="code">textLabel</span>
 to a string made up of the <span class="code">firstName</span>
 and <span class="code">lastName</span>
 of the <span class="code">birthday</span>
 with a space between them. At <span class="ent">➍</span>
 , you use the <span class="code">string(from:)</span>
 method of the <span class="code">dateFormatter</span>
 to display the birthdate in the <span class="code">detailTextLabel</span>
 .</p>
<p class="indent">When your cell is completely configured, <span class="code">tableView( _:cellForRowAt:)</span>
 returns the cell at <span class="ent">➎</span>
 so that it can be displayed at that <span class="code">indexPath</span>
 of the table view.</p>
<h3 class="h3" id="ch11lev1sec2">
<strong>PUTTING IT ALL TOGETHER</strong>
</h3>
<p class="noindent">Now you can add <span class="code">Birthday</span>
 instances to the app using the Add Birthday view controller, and you have a table view to list each <span class="code">Birthday</span>
 in the Birthdays table view controller. But when you try running the app and adding a <span class="code">Birthday</span>
 , it doesn’t appear. To make each <span class="code">Birthday</span>
 you add appear in the table view, you need to make the Add Birthday view controller communicate with the Birthdays table view controller. You do this by using <em>delegation</em>
 .</p>
<h4 class="h4" id="ch11lev2sec5">
<strong>DELEGATION</strong>
</h4>
<p class="noindent">Delegation can be used when one view controller needs to get information from another view controller. Say you have two view controllers: A and B. The first view controller, A, creates B and presents B on top of itself. A knows about B because it created and presented B, so A can pass information along to B. But B doesn’t know about A—it’s just popped into being and doesn’t know where it came from or how it got there. So how can B talk to A? Through delegation!</p>
<div class="image"><img src="Image00245.jpg" />
</div>
<p class="indent">Delegation is when someone gives a job or a task to someone else. A <em>delegate</em>
 is like a boss who tells a delegating employee what to do. When the delegating employee is done with their task, sometimes they’ll report information back to the delegate boss.</p>
<p class="indent"><span id="page_167"></span>
 Delegation in Swift is pretty similar, but instead of having a boss and employee, we have a delegate and a delegating object. Since class B is the one being told what to do by class A, it’s the delegating object. We give class B a special property called a delegate to tell it who its delegate is—that way, it knows who to communicate with. The delegate can be any class that has a set of methods that have been defined in a <em>protocol</em>
 . A protocol is like an agreement between the two classes that tells them what the delegate can ask the delegating object to do. It has a list of method and property names that the delegate can use with the delegating object.</p>
<p class="indent">Class A creates class B, makes itself the delegate of class B, and gives class B a job to do that’s in the protocol. Once class B is done with its job, it reports back to class A. Let’s see how this works in our app.</p>
<p class="indent">The Birthdays table view controller is view controller A, and the Add Birthday view controller is view controller B. We’ll create a protocol called <span class="code">AddBirthdayViewControllerDelegate</span>
 and a method for that protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 , which the Add Birthday view controller will use to report back.</p>
<p class="indent">Take a look at <a href="text00022.html#ch11fig6">Figure 11-6</a>
 . When the user taps the Add button <span class="ent">➊</span>
 , the Birthdays table view controller creates the Add Birthday view controller <span class="ent">➋</span>
 and sets itself as the Add Birthday view controller’s delegate.</p>
<div class="image"><img src="Image00246.jpg" />
</div>
<p class="figcap"><a id="ch11fig6"></a>
 <em>Figure 11-6: A new birthday is added and passed from the Add Birthday view controller to the Birthdays table view controller using delegation.</em>
</p>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="noindent">Each birthday will be displayed in a <span class="code">UITableViewCell</span>
 in the Birthdays table view controller. A table has boxes organized into rows and columns that contain information. These boxes are called <em>cells</em>
 . Similarly, a table view also has cells that are all instances of, or a subclass of, the <span class="code">UITableViewCell</span>
 class. We’ll put each birthday into its own cell in our table view.</p>
<p class="indent">We’ll start by creating those cells in the storyboard, and then we’ll fill them with our <span class="code">Birthday</span>
 objects later. In the left outline menu, click the triangle by Birthdays and then click the triangle by Table View to open those sections. Then select <strong>Table View Cell</strong>
 <span class="ent">➊</span>
 , as shown in <a href="text00022.html#ch11fig4">Figure 11-4</a>
 .</p>
<div class="image"><img src="Image00237.jpg" />
</div>
<div class="image"><img src="Image00238.jpg" />
</div>
<p class="figcap"><a id="ch11fig4"></a>
 <em>Figure 11-4: Creating a Subtitle style table view cell and setting its identifier</em>
</p>
<p class="indent"><span id="page_159"></span>
 Next, open the Attributes Inspector. Using the drop-down menu under <strong>Style</strong>
 , set the cell’s style to <strong>Subtitle</strong>
 <span class="ent">➋</span>
 so that the cell now has a Title label and a Subtitle label. You’ll display each person’s name in the Title and birthday in the Subtitle.</p>
<p class="indent">Finally, enter <span class="code">
<span class="codestrong">birthdayCellIdentifier</span>
</span>
 in the Identifier field <span class="ent">➌</span>
 . You’ll use this identifier later when you fill in the cell contents.</p>
<p class="indent">That’s it! You’ve finished your work in the storyboard.</p>
<p class="indent">You may be wondering why we have just one cell in our table view in the storyboard when we’ll have more than one birthday to show in the list. If you look at <a href="text00022.html#ch11fig4">Figure 11-4</a>
 again, you’ll notice that the cell is labeled <em>Prototype Cells</em>
 . This means that the cell you just customized is a <em>template</em>
 for all the cells you want to appear in your table view. The identifier you gave the cell is how your code will tell the table view to produce each cell for you to put birthdays in. You’ll see how this works soon.</p>
<div class="box1">
<p class="box-title">
<strong>WORKING WITH DATES</strong>
</p>
<p class="box-p">Swift has a special data type called <span class="code">Date</span>
 that is used for storing date values. A <span class="code">Date</span>
 object is actually a date and a time. Open your playground and enter the following:</p>
<div class="image"><img src="Image00239.jpg" />
</div>
<p class="box-pi">We’ve just assigned the current date and time the code was run to the variable <span class="code">today</span>
 . When you print <span class="code">today</span>
 , it’s in the format <span class="code">"2017-11-21 10:45:31 +0000\n"</span>
 . What if you wanted it to display as <span class="code">Tuesday, November 21, 2017</span>
 , instead? Or just <span class="code">11/21/17</span>
 ? To display a date in a particular way, you use a <em>date formatter</em>
 , which is a <span class="code">DateFormatter</span>
 object that you create and give a date format style. <span class="code">DateFormatter</span>
 is a helper object that is used to create a display string from any date, and a <em>date format style</em>
 is a property of <span class="code">DateFormatter</span>
 that tells the formatter what style to use. You can create your own date format styles manually, but there are also styles that are included in Swift and ready to use. Add the following to your playground:</p>
<div class="image"><img src="Image00240.jpg" />
</div>
<p class="box-pi">At <span class="ent">➊</span>
 you create a <span class="code">formatter</span>
 . Then at <span class="ent">➋</span>
 , you set the style of the <span class="code">formatter</span>
 to <span class="code">Style.full</span>
 , which will print the day of the week as well as the full month name, date, and year. Finally, you create a string from the date using the <span class="code">string(from:)</span>
 method of the <span class="code">DateFormatter</span>
 class <span class="ent">➌</span>
 . You can see that you now have turned the <span id="page_160"></span>
 date into the nicely formatted string <span class="code">"Tuesday, November 21, 2017"</span>
 . <a style=";color:black;" href="text00022.html#ch11tab1">Table 11-1</a>
 shows the different strings that are created from the five <span class="code">DateFormatter.Style</span>
 options available in Swift.</p>
<p class="tabcap"><a id="ch11tab1" style=";color:black;"></a>
 <strong>Table 11-1:</strong>
 Date Formatter Styles and Their Date Strings</p>
<table class="tabled">
<tbody>
<tr>
<td style="vertical-align: top;" class="border1">
<p class="noindent">
<span class="code">
<span class="codestrong">DateFormatter.Style</span>
</span>
</p>
</td>
<td style="vertical-align: top;" class="border1">
<p class="noindent">
<strong>Date string</strong>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">none</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">""</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">short</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"11/21/17"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">medium</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"Nov 21, 2017"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">long</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"November 21, 2017"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">full</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"Tuesday, November 21, 2017"</span>
</p>
</td>
</tr>
</tbody>
</table>
<p class="box-pi">You can also specify your own custom way of displaying a date using the <span class="code">dateFormat</span>
 property of the <span class="code">DateFormatter</span>
 . Perhaps you only want the month and day. Or maybe you want a four-digit year displayed in the <span class="code">short</span>
 style. Doing either is really easy, and you don’t even have to create a new <span class="code">DateFormatter</span>
 —you can just change the <span class="code">dateFormat</span>
 on <span class="code">formatter</span>
 and then ask it for a new string. Add the following code to your playground to display dates with a specific format:</p>
<div class="image"><img src="Image00241.jpg" />
</div>
<p class="box-pi">At <span class="ent">➊</span>
 , you specify that you only want the month and the date in an <span class="code">MM/dd</span>
 format—that is, a two-digit month followed by a two-digit date. If you want to display the month as three letters, then use <span class="code">MMM</span>
 . To display the full name of the month, use <span class="code">MMMM</span>
 . At <span class="ent">➋</span>
 , we change the date format to use a four-digit year. A two-digit year would be <span class="code">yy</span>
 . Here are a few other ways to use a <span class="code">dateFormat</span>
 to display a custom date string.</p>
<div class="image"><img src="Image00242.jpg" />
</div>
<p class="box-pi"><span id="page_161"></span>
 If you want to include separators, you add them to your <span class="code">dateFormat</span>
 string. For example, if you want periods as separators, then you can create a <span class="code">dateFormat</span>
 like <span class="code">"MM.dd.yy"</span>
 <span class="ent">➊</span>
 . To display an abbreviated day of the week, use <span class="code">EEE</span>
 <span class="ent">➋</span>
 . For the full day, use <span class="code">EEEE</span>
 <span class="ent">➌</span>
 . These are only a few examples. By using combinations of <span class="code">M</span>
 , <span class="code">d</span>
 , <span class="code">y</span>
 , and <span class="code">E</span>
 , you have an endless number of ways to display a date!</p>
</div>
<h4 class="h4" id="ch11lev2sec3">
<strong>SETTING UP THE BIRTHDAYS TABLE VIEW CONTROLLER</strong>
</h4>
<p class="noindent">The Birthdays table view controller will display a list of all the birthdays stored in the app. Do you remember what you use to store a list of items? That’s right—an array! You’ll create an array in the <span class="code">BirthdaysTableViewController</span>
 to store all the birthdays. To do this, give the <span class="code">BirthdaysTableViewController</span>
 a <span class="code">birthdays</span>
 property that is an array of <span class="code">Birthday</span>
 objects. At the top of the class, right above the <span class="code">viewDidLoad()</span>
 method, insert this line to add a variable array property called <span class="code">birthdays</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController {</span>
<br />
<br />
    <span class="pink">var</span>
 birthdays = [<span class="green1">Birthday</span>
 ]()<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent">This line creates an empty array of <span class="code">Birthday</span>
 instances. It needs to be a variable and not a constant because you’ll want to add a saved <span class="code">Birthday</span>
 to this array every time the user adds a <span class="code">Birthday</span>
 with the Add Birthday view controller. You’ll see how to do that in “<a href="text00022.html#ch11lev3sec2">Making the Birthdays Table View Controller Conform to Protocol</a>
 ” on <a href="text00022.html#page_168">page 168</a>
 .</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>Remember that the final versions of the project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>.</em>
</p>
</div>
<p class="indent">The <span class="code">BirthdaysTableViewController</span>
 will also need a <span class="code">dateFormatter</span>
 property to display the birthdate as a nicely formatted string. Add a <span class="code">dateFormatter</span>
 right underneath the <span class="code">birthdays</span>
 array:</p>
<div class="box">
<pre>    <span class="ash">var birthdays = [Birthday]()</span>
<br />
<br />
    <span class="pink">let</span>
 dateFormatter = <span class="violet">DateFormatter</span>
 ()<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent">Note that the <span class="code">dateFormatter</span>
 is a constant that is created with <span class="code">let</span>
 . Even though you’ll change the <span class="code">dateFormatter</span>
 ’s properties, like the <span class="code">dateStyle</span>
 and <span class="code">timeStyle</span>
 , you’ll never change the <span class="code">dateFormatter</span>
 itself.</p>
<p class="indent"><span id="page_162"></span>
 You’ll also need to set up the <span class="code">dateFormatter</span>
 so that it will display the birthdates as fully formatted strings like <span class="code">"Tuesday, December 17, 2008"</span>
 . As you saw in <a href="text00021.html#ch10">Chapter 10</a>
 , a good place to do this is the <span class="code">viewDidLoad()</span>
 method, which is called when the Birthdays table view controller is loading its view. This is the perfect place to do any setup that is needed for this class.</p>
<div class="box">
<pre>
<span class="ash">override func viewDidLoad() {</span>
<br />
    <span class="ash">super.viewDidLoad()</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">dateFormatter</span>
 .<span class="violet">dateStyle</span>
 = .<span class="blue">full</span>
<br />
  <span class="ent">➋</span>
 <span class="green1">dateFormatter</span>
 .<span class="violet">timeStyle</span>
 = .<span class="blue">none</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , you set the <span class="code">dateStyle</span>
 of the <span class="code">dateFormatter</span>
 so that it will display a formatted date string for each <span class="code">Birthday</span>
 . Did you notice how we just wrote <span class="code">.full</span>
 instead of <span class="code">DateFormatter.Style.full</span>
 ? Swift knows what type to expect for the <span class="code">dateStyle</span>
 of a <span class="code">DateFormatter</span>
 , so it lets us take this little shortcut. At <span class="ent">➋</span>
 , you set the <span class="code">timeStyle</span>
 of the <span class="code">dateFormatter</span>
 to <span class="code">.none</span>
 so that the time won’t be shown.</p>
<h4 class="h4" id="ch11lev2sec4">
<strong>DISPLAYING BIRTHDAYS IN A TABLE VIEW</strong>
</h4>
<p class="noindent">The <span class="code">BirthdaysTableViewController</span>
 class has a table view that is used to display a list of items in a single column. The table view has one or more sections containing rows, and each row contains a cell. A section in a table view is a grouping of rows that can be displayed with or without a header. An example of an app that shows a table view with several sections is the Settings app, as shown in <a href="text00022.html#ch11fig5">Figure 11-5</a>
 . It displays a list of rows that have been broken up into different sections.</p>
<p class="indent">Each section and row of a table view is identified with an index number. These numbers start at 0 and then increase by 1 as you go down the table view. For example, the Privacy line in the Settings app is found at section 0, row 1. The News setting is at section 1, row 3.</p>
<p class="indent">In the middle of the <span class="code">BirthdaysTableViewController</span>
 class, there is a section called <em>Table view data source</em>
 with three methods. The table view controller uses these methods to determine what’s going to be displayed inside its table view.</p>
<p class="hang">
<span class="code">
<span class="codestrong">numberOfSections(in:)</span>
</span>
 Tells the table view how many sections it should have</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:numberOfRowsInSection:)</span>
</span>
 Tells the table view how many rows will be displayed in each section</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:cellForRowAt:)</span>
</span>
 Sets up each cell that’s going to be displayed in each row of the table view</p>
<div class="image"><span id="page_163"></span>
 <img src="Image00243.jpg" />
</div>
<p class="figcap"><a id="ch11fig5"></a>
 <em>Figure 11-5: The Settings app uses sections to group rows of different device settings.</em>
</p>
<p class="indent">The table view data source methods are called by the table view controller every time the table view is reloaded. Xcode automatically gives you these method templates when you make a subclass of a <span class="code">UITableViewController</span>
 . You need to implement all three methods for the app to work, even though you’ll never call them directly in your code. The <span class="code">UITableViewController</span>
 class implements the <span class="code">UITableViewDataSource</span>
 protocol, which comes with these data source methods, to determine what will be displayed inside the table view. We’ll discuss protocols in “<a href="text00022.html#ch11lev2sec5">Delegation</a>
 ” on page 166. For now, you just need to know that a <span class="code">UITableViewController</span>
 uses these methods to display its content, and it automatically calls these methods so you don’t need to call them.</p>
<p class="indent">Let’s start with the method <span class="code">numberOfSections(in:)</span>
 . The Birthdays table view controller is a list that just displays <span class="code">Birthday</span>
 instances, so it doesn’t need multiple sections. To set the number of sections in the table view, we just need to return <span class="code">1</span>
 .</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func numberOfSections(in tableView: UITableView) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 <span class="blue1">1</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent"><span id="page_164"></span>
 This method takes a <span class="code">UITableView</span>
 called <span class="code">tableView</span>
 as a parameter, which is the table view that uses this class as its data source. We don’t need to worry about making this connection because the <span class="code">UITableViewController</span>
 comes with a built-in table view that is automatically hooked up to these methods. Each birthday will be displayed in its own row. So in <span class="code">tableView(_:numberOfRowsInSection:)</span>
 , in order to have the right number of rows for all of your birthdays, you need to return the number of <span class="code">Birthday</span>
 instances that you have in your <span class="code">birthdays</span>
 array. Do you remember the <span class="code">count</span>
 property of an array? It’s an integer that tells you how many items are in that array, and it’s perfect for this situation! Change this method to the following:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, <img class="inline" src="Image00184.jpg" />
<br />
    numberOfRowsInSection section: Int) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 birthdays.<span class="violet">count</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">In addition to the <span class="code">tableView</span>
 parameter, <span class="code">tableView(_:numberOfRowsInSection:)</span>
 also takes an <span class="code">Int</span>
 called <span class="code">section</span>
 . When the table view is loading itself, this method is called for each section in the table view. In our case, we have only one section, so we don’t need to bother checking which <span class="code">section</span>
 of the table view is being displayed here. We know it’s section 0, and we want it to have as many rows as there are birthdays, so we write <span class="code">return birthdays.count</span>
 .</p>
<p class="indent">Finally, you need to implement <span class="code">tableView(_:cellForRowAt:)</span>
 so that the table view will know what to put inside each cell. Since this method is commented out, you need to uncomment it by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it. (Be careful not to accidentally uncomment the other methods after it!) After you’ve done that, change it to the following code:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, cellForRowAt <img class="inline" src="Image00184.jpg" />
<br />
    indexPath: IndexPath) -&gt; UITableViewCell {</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="pink">let</span>
 cell = tableView.<span class="blue">dequeueReusableCell</span>
 (withIdentifier: <img class="inline" src="Image00093.jpg" />
<br />
        <span class="red">"birthdayCellIdentifier"</span>
 , for: indexPath)<br />
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 birthday = <span class="green1">birthdays</span>
 [indexPath.<span class="violet">row</span>
 ]<br />
<br />
  <span class="ent">➌</span>
 cell.<span class="violet">textLabel</span>
 ?.<span class="violet">text</span>
 = birthday.<span class="green1">firstName</span>
 <span class="blue">+</span>
 <span class="red">" "</span>
 <span class="blue">+</span>
 <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">lastName</span>
<br />
<br />
  <span class="ent">➍</span>
 cell.<span class="violet">detailTextLabel</span>
 ?.<span class="violet">text</span>
 = <span class="green1">dateFormatter</span>
 .<span class="blue">string</span>
 (from: <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">birthdate</span>
 )<br />
<br />
  <span class="ent">➎</span>
 <span class="pink">return</span>
 cell<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">You don’t call the method <span class="code">tableView(_:cellForRowAt:)</span>
 . It’s called when the table view is loaded onto the screen. It’s called for each cell on the screen and takes two parameters, <span class="code">tableView</span>
 and <span class="code">indexPath</span>
 . You already know <span id="page_165"></span>
 what the <span class="code">tableView</span>
 parameter is for. An <span class="code">IndexPath</span>
 is a Swift struct that’s used to represent a row’s position in a table view. An <span class="code">IndexPath</span>
 instance has a <span class="code">section</span>
 property and a <span class="code">row</span>
 property. Since this method will be called many times (once for every row in the table), we need the <span class="code">indexPath</span>
 to know which section and row we’re currently configuring. The <span class="code">indexPath.section</span>
 property gives the section number, and the <span class="code">indexPath.row</span>
 gives the row of the table view cell. The five lines of code inside <span class="code">tableView(_:cellForRowAt:)</span>
 will do the following:</p>
<div class="image"><img src="Image00244.jpg" />
</div>
<p class="bull">• Create a <span class="code">UITableViewCell</span>
</p>
<p class="bull">• Figure out which <span class="code">Birthday</span>
 in the <span class="code">birthdays</span>
 array will be displayed inside the cell</p>
<p class="bull">• Make two labels to display the birthday person’s name and birthdate in the cell</p>
<p class="bull">• Return the cell ready for display in the table view</p>
<p class="indentt">Let’s go through this code line by line.</p>
<p class="indent">First, create the <span class="code">UITableViewCell</span>
 . The code at <span class="ent">➊</span>
 does this using the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 . Before you can start using this method on a cell, though, you need to tell the method which cell you want to use from the storyboard. Earlier, when you were in the storyboard, you gave your cell the identifier <span class="code">birthdayCellIdentifier</span>
 (see <a href="text00022.html#ch11fig4">Figure 11-4</a>
 ). This identifier links your code to the cell and tells your method that it’s using the right cell. The string for when you call this method needs to be exactly the same as the string you set in the storyboard, or you’ll get an error and the app will crash when you run it.</p>
<p class="indent">In the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 , did you notice the words <em>Reusable Cell</em>
 ? The cells inside a table view are created once and then can be reused over and over. This helps everything run faster and smoother because creating the cell is what takes the most time. If you had 200 birthdays in your app, but only 10 would fit on your screen at one time, then you need only 10 cells to show your birthdays. When you scroll down to reveal more birthdays, the cells that scroll off the top of the screen are reused. They are filled with new information and show up again at the bottom of the screen. The <span class="code">UITableView</span>
 automatically does this work. When the table view is loaded, <span class="code">tableView(_:cellForRowAt:)</span>
 is called for every visible row. When the user scrolls to look at more cells, it’s called again for each row just as it is about to appear on the screen.</p>
<p class="indent">Next, we need to find out which <span class="code">Birthday</span>
 should be displayed inside the cell. We want to display one birthday from the <span class="code">birthdays</span>
 array in each row. The first birthday, which is at <span class="code">birthdays[0]</span>
 , should be displayed in row 0. The second birthday, at <span class="code">birthdays[1]</span>
 , should be displayed in row 1, and so on, which means the <span class="code">indexPath</span>
 ’s <span class="code">row</span>
 is the same as the position in the <span class="code">birthdays</span>
 array that we want to access. The code at <span class="ent">➋</span>
 accesses the <span id="page_166"></span>
 correct <span class="code">Birthday</span>
 object from the <span class="code">birthdays</span>
 array by using <span class="code">indexPath.row</span>
 . Once we have the right <span class="code">Birthday</span>
 object, we assign it to a constant named <span class="code">birthday</span>
 so we can set up the labels in this cell.</p>
<p class="indent">Notice that we’re using <span class="code">let</span>
 to assign the <span class="code">birthday</span>
 to a constant instead of a variable. We can use <span class="code">let</span>
 because each time <span class="code">tableView(_:cellForRowAt:)</span>
 is called, a new <span class="code">birthday</span>
 constant is created. Each cell gets its own <span class="code">birthday</span>
 constant that is assigned its own <span class="code">Birthday</span>
 object. Since we’re not going to change any of the <span class="code">birthday</span>
 constants—we’re just going to read their properties—we don’t want to make them variables.</p>
<p class="indent">Now that you have your cell and your birthday, it’s time to fill in the details. You need two labels for each cell to show the birthday person’s name and birthdate. You set the cell to the Subtitle style so that it has a Title label and a Subtitle label. Each cell will already contain these labels, so now you don’t have to create any labels yourself.</p>
<p class="indent">The labels exist as properties of <span class="code">UITableViewCell</span>
 and are called <span class="code">textLabel</span>
 and <span class="code">detailTextLabel</span>
 . The code at <span class="ent">➌</span>
 sets the text of the <span class="code">textLabel</span>
 to a string made up of the <span class="code">firstName</span>
 and <span class="code">lastName</span>
 of the <span class="code">birthday</span>
 with a space between them. At <span class="ent">➍</span>
 , you use the <span class="code">string(from:)</span>
 method of the <span class="code">dateFormatter</span>
 to display the birthdate in the <span class="code">detailTextLabel</span>
 .</p>
<p class="indent">When your cell is completely configured, <span class="code">tableView( _:cellForRowAt:)</span>
 returns the cell at <span class="ent">➎</span>
 so that it can be displayed at that <span class="code">indexPath</span>
 of the table view.</p>
<h3 class="h3" id="ch11lev1sec2">
<strong>PUTTING IT ALL TOGETHER</strong>
</h3>
<p class="noindent">Now you can add <span class="code">Birthday</span>
 instances to the app using the Add Birthday view controller, and you have a table view to list each <span class="code">Birthday</span>
 in the Birthdays table view controller. But when you try running the app and adding a <span class="code">Birthday</span>
 , it doesn’t appear. To make each <span class="code">Birthday</span>
 you add appear in the table view, you need to make the Add Birthday view controller communicate with the Birthdays table view controller. You do this by using <em>delegation</em>
 .</p>
<h4 class="h4" id="ch11lev2sec5">
<strong>DELEGATION</strong>
</h4>
<p class="noindent">Delegation can be used when one view controller needs to get information from another view controller. Say you have two view controllers: A and B. The first view controller, A, creates B and presents B on top of itself. A knows about B because it created and presented B, so A can pass information along to B. But B doesn’t know about A—it’s just popped into being and doesn’t know where it came from or how it got there. So how can B talk to A? Through delegation!</p>
<div class="image"><img src="Image00245.jpg" />
</div>
<p class="indent">Delegation is when someone gives a job or a task to someone else. A <em>delegate</em>
 is like a boss who tells a delegating employee what to do. When the delegating employee is done with their task, sometimes they’ll report information back to the delegate boss.</p>
<p class="indent"><span id="page_167"></span>
 Delegation in Swift is pretty similar, but instead of having a boss and employee, we have a delegate and a delegating object. Since class B is the one being told what to do by class A, it’s the delegating object. We give class B a special property called a delegate to tell it who its delegate is—that way, it knows who to communicate with. The delegate can be any class that has a set of methods that have been defined in a <em>protocol</em>
 . A protocol is like an agreement between the two classes that tells them what the delegate can ask the delegating object to do. It has a list of method and property names that the delegate can use with the delegating object.</p>
<p class="indent">Class A creates class B, makes itself the delegate of class B, and gives class B a job to do that’s in the protocol. Once class B is done with its job, it reports back to class A. Let’s see how this works in our app.</p>
<p class="indent">The Birthdays table view controller is view controller A, and the Add Birthday view controller is view controller B. We’ll create a protocol called <span class="code">AddBirthdayViewControllerDelegate</span>
 and a method for that protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 , which the Add Birthday view controller will use to report back.</p>
<p class="indent">Take a look at <a href="text00022.html#ch11fig6">Figure 11-6</a>
 . When the user taps the Add button <span class="ent">➊</span>
 , the Birthdays table view controller creates the Add Birthday view controller <span class="ent">➋</span>
 and sets itself as the Add Birthday view controller’s delegate.</p>
<div class="image"><img src="Image00246.jpg" />
</div>
<p class="figcap"><a id="ch11fig6"></a>
 <em>Figure 11-6: A new birthday is added and passed from the Add Birthday view controller to the Birthdays table view controller using delegation.</em>
</p>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="indent">We’ll start by creating those cells in the storyboard, and then we’ll fill them with our <span class="code">Birthday</span>
 objects later. In the left outline menu, click the triangle by Birthdays and then click the triangle by Table View to open those sections. Then select <strong>Table View Cell</strong>
 <span class="ent">➊</span>
 , as shown in <a href="text00022.html#ch11fig4">Figure 11-4</a>
 .</p>
<div class="image"><img src="Image00237.jpg" />
</div>
<div class="image"><img src="Image00238.jpg" />
</div>
<p class="figcap"><a id="ch11fig4"></a>
 <em>Figure 11-4: Creating a Subtitle style table view cell and setting its identifier</em>
</p>
<p class="indent"><span id="page_159"></span>
 Next, open the Attributes Inspector. Using the drop-down menu under <strong>Style</strong>
 , set the cell’s style to <strong>Subtitle</strong>
 <span class="ent">➋</span>
 so that the cell now has a Title label and a Subtitle label. You’ll display each person’s name in the Title and birthday in the Subtitle.</p>
<p class="indent">Finally, enter <span class="code">
<span class="codestrong">birthdayCellIdentifier</span>
</span>
 in the Identifier field <span class="ent">➌</span>
 . You’ll use this identifier later when you fill in the cell contents.</p>
<p class="indent">That’s it! You’ve finished your work in the storyboard.</p>
<p class="indent">You may be wondering why we have just one cell in our table view in the storyboard when we’ll have more than one birthday to show in the list. If you look at <a href="text00022.html#ch11fig4">Figure 11-4</a>
 again, you’ll notice that the cell is labeled <em>Prototype Cells</em>
 . This means that the cell you just customized is a <em>template</em>
 for all the cells you want to appear in your table view. The identifier you gave the cell is how your code will tell the table view to produce each cell for you to put birthdays in. You’ll see how this works soon.</p>
<div class="box1">
<p class="box-title">
<strong>WORKING WITH DATES</strong>
</p>
<p class="box-p">Swift has a special data type called <span class="code">Date</span>
 that is used for storing date values. A <span class="code">Date</span>
 object is actually a date and a time. Open your playground and enter the following:</p>
<div class="image"><img src="Image00239.jpg" />
</div>
<p class="box-pi">We’ve just assigned the current date and time the code was run to the variable <span class="code">today</span>
 . When you print <span class="code">today</span>
 , it’s in the format <span class="code">"2017-11-21 10:45:31 +0000\n"</span>
 . What if you wanted it to display as <span class="code">Tuesday, November 21, 2017</span>
 , instead? Or just <span class="code">11/21/17</span>
 ? To display a date in a particular way, you use a <em>date formatter</em>
 , which is a <span class="code">DateFormatter</span>
 object that you create and give a date format style. <span class="code">DateFormatter</span>
 is a helper object that is used to create a display string from any date, and a <em>date format style</em>
 is a property of <span class="code">DateFormatter</span>
 that tells the formatter what style to use. You can create your own date format styles manually, but there are also styles that are included in Swift and ready to use. Add the following to your playground:</p>
<div class="image"><img src="Image00240.jpg" />
</div>
<p class="box-pi">At <span class="ent">➊</span>
 you create a <span class="code">formatter</span>
 . Then at <span class="ent">➋</span>
 , you set the style of the <span class="code">formatter</span>
 to <span class="code">Style.full</span>
 , which will print the day of the week as well as the full month name, date, and year. Finally, you create a string from the date using the <span class="code">string(from:)</span>
 method of the <span class="code">DateFormatter</span>
 class <span class="ent">➌</span>
 . You can see that you now have turned the <span id="page_160"></span>
 date into the nicely formatted string <span class="code">"Tuesday, November 21, 2017"</span>
 . <a style=";color:black;" href="text00022.html#ch11tab1">Table 11-1</a>
 shows the different strings that are created from the five <span class="code">DateFormatter.Style</span>
 options available in Swift.</p>
<p class="tabcap"><a id="ch11tab1" style=";color:black;"></a>
 <strong>Table 11-1:</strong>
 Date Formatter Styles and Their Date Strings</p>
<table class="tabled">
<tbody>
<tr>
<td style="vertical-align: top;" class="border1">
<p class="noindent">
<span class="code">
<span class="codestrong">DateFormatter.Style</span>
</span>
</p>
</td>
<td style="vertical-align: top;" class="border1">
<p class="noindent">
<strong>Date string</strong>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">none</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">""</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">short</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"11/21/17"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">medium</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"Nov 21, 2017"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">long</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"November 21, 2017"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">full</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"Tuesday, November 21, 2017"</span>
</p>
</td>
</tr>
</tbody>
</table>
<p class="box-pi">You can also specify your own custom way of displaying a date using the <span class="code">dateFormat</span>
 property of the <span class="code">DateFormatter</span>
 . Perhaps you only want the month and day. Or maybe you want a four-digit year displayed in the <span class="code">short</span>
 style. Doing either is really easy, and you don’t even have to create a new <span class="code">DateFormatter</span>
 —you can just change the <span class="code">dateFormat</span>
 on <span class="code">formatter</span>
 and then ask it for a new string. Add the following code to your playground to display dates with a specific format:</p>
<div class="image"><img src="Image00241.jpg" />
</div>
<p class="box-pi">At <span class="ent">➊</span>
 , you specify that you only want the month and the date in an <span class="code">MM/dd</span>
 format—that is, a two-digit month followed by a two-digit date. If you want to display the month as three letters, then use <span class="code">MMM</span>
 . To display the full name of the month, use <span class="code">MMMM</span>
 . At <span class="ent">➋</span>
 , we change the date format to use a four-digit year. A two-digit year would be <span class="code">yy</span>
 . Here are a few other ways to use a <span class="code">dateFormat</span>
 to display a custom date string.</p>
<div class="image"><img src="Image00242.jpg" />
</div>
<p class="box-pi"><span id="page_161"></span>
 If you want to include separators, you add them to your <span class="code">dateFormat</span>
 string. For example, if you want periods as separators, then you can create a <span class="code">dateFormat</span>
 like <span class="code">"MM.dd.yy"</span>
 <span class="ent">➊</span>
 . To display an abbreviated day of the week, use <span class="code">EEE</span>
 <span class="ent">➋</span>
 . For the full day, use <span class="code">EEEE</span>
 <span class="ent">➌</span>
 . These are only a few examples. By using combinations of <span class="code">M</span>
 , <span class="code">d</span>
 , <span class="code">y</span>
 , and <span class="code">E</span>
 , you have an endless number of ways to display a date!</p>
</div>
<h4 class="h4" id="ch11lev2sec3">
<strong>SETTING UP THE BIRTHDAYS TABLE VIEW CONTROLLER</strong>
</h4>
<p class="noindent">The Birthdays table view controller will display a list of all the birthdays stored in the app. Do you remember what you use to store a list of items? That’s right—an array! You’ll create an array in the <span class="code">BirthdaysTableViewController</span>
 to store all the birthdays. To do this, give the <span class="code">BirthdaysTableViewController</span>
 a <span class="code">birthdays</span>
 property that is an array of <span class="code">Birthday</span>
 objects. At the top of the class, right above the <span class="code">viewDidLoad()</span>
 method, insert this line to add a variable array property called <span class="code">birthdays</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController {</span>
<br />
<br />
    <span class="pink">var</span>
 birthdays = [<span class="green1">Birthday</span>
 ]()<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent">This line creates an empty array of <span class="code">Birthday</span>
 instances. It needs to be a variable and not a constant because you’ll want to add a saved <span class="code">Birthday</span>
 to this array every time the user adds a <span class="code">Birthday</span>
 with the Add Birthday view controller. You’ll see how to do that in “<a href="text00022.html#ch11lev3sec2">Making the Birthdays Table View Controller Conform to Protocol</a>
 ” on <a href="text00022.html#page_168">page 168</a>
 .</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>Remember that the final versions of the project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>.</em>
</p>
</div>
<p class="indent">The <span class="code">BirthdaysTableViewController</span>
 will also need a <span class="code">dateFormatter</span>
 property to display the birthdate as a nicely formatted string. Add a <span class="code">dateFormatter</span>
 right underneath the <span class="code">birthdays</span>
 array:</p>
<div class="box">
<pre>    <span class="ash">var birthdays = [Birthday]()</span>
<br />
<br />
    <span class="pink">let</span>
 dateFormatter = <span class="violet">DateFormatter</span>
 ()<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent">Note that the <span class="code">dateFormatter</span>
 is a constant that is created with <span class="code">let</span>
 . Even though you’ll change the <span class="code">dateFormatter</span>
 ’s properties, like the <span class="code">dateStyle</span>
 and <span class="code">timeStyle</span>
 , you’ll never change the <span class="code">dateFormatter</span>
 itself.</p>
<p class="indent"><span id="page_162"></span>
 You’ll also need to set up the <span class="code">dateFormatter</span>
 so that it will display the birthdates as fully formatted strings like <span class="code">"Tuesday, December 17, 2008"</span>
 . As you saw in <a href="text00021.html#ch10">Chapter 10</a>
 , a good place to do this is the <span class="code">viewDidLoad()</span>
 method, which is called when the Birthdays table view controller is loading its view. This is the perfect place to do any setup that is needed for this class.</p>
<div class="box">
<pre>
<span class="ash">override func viewDidLoad() {</span>
<br />
    <span class="ash">super.viewDidLoad()</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">dateFormatter</span>
 .<span class="violet">dateStyle</span>
 = .<span class="blue">full</span>
<br />
  <span class="ent">➋</span>
 <span class="green1">dateFormatter</span>
 .<span class="violet">timeStyle</span>
 = .<span class="blue">none</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , you set the <span class="code">dateStyle</span>
 of the <span class="code">dateFormatter</span>
 so that it will display a formatted date string for each <span class="code">Birthday</span>
 . Did you notice how we just wrote <span class="code">.full</span>
 instead of <span class="code">DateFormatter.Style.full</span>
 ? Swift knows what type to expect for the <span class="code">dateStyle</span>
 of a <span class="code">DateFormatter</span>
 , so it lets us take this little shortcut. At <span class="ent">➋</span>
 , you set the <span class="code">timeStyle</span>
 of the <span class="code">dateFormatter</span>
 to <span class="code">.none</span>
 so that the time won’t be shown.</p>
<h4 class="h4" id="ch11lev2sec4">
<strong>DISPLAYING BIRTHDAYS IN A TABLE VIEW</strong>
</h4>
<p class="noindent">The <span class="code">BirthdaysTableViewController</span>
 class has a table view that is used to display a list of items in a single column. The table view has one or more sections containing rows, and each row contains a cell. A section in a table view is a grouping of rows that can be displayed with or without a header. An example of an app that shows a table view with several sections is the Settings app, as shown in <a href="text00022.html#ch11fig5">Figure 11-5</a>
 . It displays a list of rows that have been broken up into different sections.</p>
<p class="indent">Each section and row of a table view is identified with an index number. These numbers start at 0 and then increase by 1 as you go down the table view. For example, the Privacy line in the Settings app is found at section 0, row 1. The News setting is at section 1, row 3.</p>
<p class="indent">In the middle of the <span class="code">BirthdaysTableViewController</span>
 class, there is a section called <em>Table view data source</em>
 with three methods. The table view controller uses these methods to determine what’s going to be displayed inside its table view.</p>
<p class="hang">
<span class="code">
<span class="codestrong">numberOfSections(in:)</span>
</span>
 Tells the table view how many sections it should have</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:numberOfRowsInSection:)</span>
</span>
 Tells the table view how many rows will be displayed in each section</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:cellForRowAt:)</span>
</span>
 Sets up each cell that’s going to be displayed in each row of the table view</p>
<div class="image"><span id="page_163"></span>
 <img src="Image00243.jpg" />
</div>
<p class="figcap"><a id="ch11fig5"></a>
 <em>Figure 11-5: The Settings app uses sections to group rows of different device settings.</em>
</p>
<p class="indent">The table view data source methods are called by the table view controller every time the table view is reloaded. Xcode automatically gives you these method templates when you make a subclass of a <span class="code">UITableViewController</span>
 . You need to implement all three methods for the app to work, even though you’ll never call them directly in your code. The <span class="code">UITableViewController</span>
 class implements the <span class="code">UITableViewDataSource</span>
 protocol, which comes with these data source methods, to determine what will be displayed inside the table view. We’ll discuss protocols in “<a href="text00022.html#ch11lev2sec5">Delegation</a>
 ” on page 166. For now, you just need to know that a <span class="code">UITableViewController</span>
 uses these methods to display its content, and it automatically calls these methods so you don’t need to call them.</p>
<p class="indent">Let’s start with the method <span class="code">numberOfSections(in:)</span>
 . The Birthdays table view controller is a list that just displays <span class="code">Birthday</span>
 instances, so it doesn’t need multiple sections. To set the number of sections in the table view, we just need to return <span class="code">1</span>
 .</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func numberOfSections(in tableView: UITableView) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 <span class="blue1">1</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent"><span id="page_164"></span>
 This method takes a <span class="code">UITableView</span>
 called <span class="code">tableView</span>
 as a parameter, which is the table view that uses this class as its data source. We don’t need to worry about making this connection because the <span class="code">UITableViewController</span>
 comes with a built-in table view that is automatically hooked up to these methods. Each birthday will be displayed in its own row. So in <span class="code">tableView(_:numberOfRowsInSection:)</span>
 , in order to have the right number of rows for all of your birthdays, you need to return the number of <span class="code">Birthday</span>
 instances that you have in your <span class="code">birthdays</span>
 array. Do you remember the <span class="code">count</span>
 property of an array? It’s an integer that tells you how many items are in that array, and it’s perfect for this situation! Change this method to the following:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, <img class="inline" src="Image00184.jpg" />
<br />
    numberOfRowsInSection section: Int) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 birthdays.<span class="violet">count</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">In addition to the <span class="code">tableView</span>
 parameter, <span class="code">tableView(_:numberOfRowsInSection:)</span>
 also takes an <span class="code">Int</span>
 called <span class="code">section</span>
 . When the table view is loading itself, this method is called for each section in the table view. In our case, we have only one section, so we don’t need to bother checking which <span class="code">section</span>
 of the table view is being displayed here. We know it’s section 0, and we want it to have as many rows as there are birthdays, so we write <span class="code">return birthdays.count</span>
 .</p>
<p class="indent">Finally, you need to implement <span class="code">tableView(_:cellForRowAt:)</span>
 so that the table view will know what to put inside each cell. Since this method is commented out, you need to uncomment it by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it. (Be careful not to accidentally uncomment the other methods after it!) After you’ve done that, change it to the following code:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, cellForRowAt <img class="inline" src="Image00184.jpg" />
<br />
    indexPath: IndexPath) -&gt; UITableViewCell {</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="pink">let</span>
 cell = tableView.<span class="blue">dequeueReusableCell</span>
 (withIdentifier: <img class="inline" src="Image00093.jpg" />
<br />
        <span class="red">"birthdayCellIdentifier"</span>
 , for: indexPath)<br />
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 birthday = <span class="green1">birthdays</span>
 [indexPath.<span class="violet">row</span>
 ]<br />
<br />
  <span class="ent">➌</span>
 cell.<span class="violet">textLabel</span>
 ?.<span class="violet">text</span>
 = birthday.<span class="green1">firstName</span>
 <span class="blue">+</span>
 <span class="red">" "</span>
 <span class="blue">+</span>
 <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">lastName</span>
<br />
<br />
  <span class="ent">➍</span>
 cell.<span class="violet">detailTextLabel</span>
 ?.<span class="violet">text</span>
 = <span class="green1">dateFormatter</span>
 .<span class="blue">string</span>
 (from: <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">birthdate</span>
 )<br />
<br />
  <span class="ent">➎</span>
 <span class="pink">return</span>
 cell<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">You don’t call the method <span class="code">tableView(_:cellForRowAt:)</span>
 . It’s called when the table view is loaded onto the screen. It’s called for each cell on the screen and takes two parameters, <span class="code">tableView</span>
 and <span class="code">indexPath</span>
 . You already know <span id="page_165"></span>
 what the <span class="code">tableView</span>
 parameter is for. An <span class="code">IndexPath</span>
 is a Swift struct that’s used to represent a row’s position in a table view. An <span class="code">IndexPath</span>
 instance has a <span class="code">section</span>
 property and a <span class="code">row</span>
 property. Since this method will be called many times (once for every row in the table), we need the <span class="code">indexPath</span>
 to know which section and row we’re currently configuring. The <span class="code">indexPath.section</span>
 property gives the section number, and the <span class="code">indexPath.row</span>
 gives the row of the table view cell. The five lines of code inside <span class="code">tableView(_:cellForRowAt:)</span>
 will do the following:</p>
<div class="image"><img src="Image00244.jpg" />
</div>
<p class="bull">• Create a <span class="code">UITableViewCell</span>
</p>
<p class="bull">• Figure out which <span class="code">Birthday</span>
 in the <span class="code">birthdays</span>
 array will be displayed inside the cell</p>
<p class="bull">• Make two labels to display the birthday person’s name and birthdate in the cell</p>
<p class="bull">• Return the cell ready for display in the table view</p>
<p class="indentt">Let’s go through this code line by line.</p>
<p class="indent">First, create the <span class="code">UITableViewCell</span>
 . The code at <span class="ent">➊</span>
 does this using the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 . Before you can start using this method on a cell, though, you need to tell the method which cell you want to use from the storyboard. Earlier, when you were in the storyboard, you gave your cell the identifier <span class="code">birthdayCellIdentifier</span>
 (see <a href="text00022.html#ch11fig4">Figure 11-4</a>
 ). This identifier links your code to the cell and tells your method that it’s using the right cell. The string for when you call this method needs to be exactly the same as the string you set in the storyboard, or you’ll get an error and the app will crash when you run it.</p>
<p class="indent">In the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 , did you notice the words <em>Reusable Cell</em>
 ? The cells inside a table view are created once and then can be reused over and over. This helps everything run faster and smoother because creating the cell is what takes the most time. If you had 200 birthdays in your app, but only 10 would fit on your screen at one time, then you need only 10 cells to show your birthdays. When you scroll down to reveal more birthdays, the cells that scroll off the top of the screen are reused. They are filled with new information and show up again at the bottom of the screen. The <span class="code">UITableView</span>
 automatically does this work. When the table view is loaded, <span class="code">tableView(_:cellForRowAt:)</span>
 is called for every visible row. When the user scrolls to look at more cells, it’s called again for each row just as it is about to appear on the screen.</p>
<p class="indent">Next, we need to find out which <span class="code">Birthday</span>
 should be displayed inside the cell. We want to display one birthday from the <span class="code">birthdays</span>
 array in each row. The first birthday, which is at <span class="code">birthdays[0]</span>
 , should be displayed in row 0. The second birthday, at <span class="code">birthdays[1]</span>
 , should be displayed in row 1, and so on, which means the <span class="code">indexPath</span>
 ’s <span class="code">row</span>
 is the same as the position in the <span class="code">birthdays</span>
 array that we want to access. The code at <span class="ent">➋</span>
 accesses the <span id="page_166"></span>
 correct <span class="code">Birthday</span>
 object from the <span class="code">birthdays</span>
 array by using <span class="code">indexPath.row</span>
 . Once we have the right <span class="code">Birthday</span>
 object, we assign it to a constant named <span class="code">birthday</span>
 so we can set up the labels in this cell.</p>
<p class="indent">Notice that we’re using <span class="code">let</span>
 to assign the <span class="code">birthday</span>
 to a constant instead of a variable. We can use <span class="code">let</span>
 because each time <span class="code">tableView(_:cellForRowAt:)</span>
 is called, a new <span class="code">birthday</span>
 constant is created. Each cell gets its own <span class="code">birthday</span>
 constant that is assigned its own <span class="code">Birthday</span>
 object. Since we’re not going to change any of the <span class="code">birthday</span>
 constants—we’re just going to read their properties—we don’t want to make them variables.</p>
<p class="indent">Now that you have your cell and your birthday, it’s time to fill in the details. You need two labels for each cell to show the birthday person’s name and birthdate. You set the cell to the Subtitle style so that it has a Title label and a Subtitle label. Each cell will already contain these labels, so now you don’t have to create any labels yourself.</p>
<p class="indent">The labels exist as properties of <span class="code">UITableViewCell</span>
 and are called <span class="code">textLabel</span>
 and <span class="code">detailTextLabel</span>
 . The code at <span class="ent">➌</span>
 sets the text of the <span class="code">textLabel</span>
 to a string made up of the <span class="code">firstName</span>
 and <span class="code">lastName</span>
 of the <span class="code">birthday</span>
 with a space between them. At <span class="ent">➍</span>
 , you use the <span class="code">string(from:)</span>
 method of the <span class="code">dateFormatter</span>
 to display the birthdate in the <span class="code">detailTextLabel</span>
 .</p>
<p class="indent">When your cell is completely configured, <span class="code">tableView( _:cellForRowAt:)</span>
 returns the cell at <span class="ent">➎</span>
 so that it can be displayed at that <span class="code">indexPath</span>
 of the table view.</p>
<h3 class="h3" id="ch11lev1sec2">
<strong>PUTTING IT ALL TOGETHER</strong>
</h3>
<p class="noindent">Now you can add <span class="code">Birthday</span>
 instances to the app using the Add Birthday view controller, and you have a table view to list each <span class="code">Birthday</span>
 in the Birthdays table view controller. But when you try running the app and adding a <span class="code">Birthday</span>
 , it doesn’t appear. To make each <span class="code">Birthday</span>
 you add appear in the table view, you need to make the Add Birthday view controller communicate with the Birthdays table view controller. You do this by using <em>delegation</em>
 .</p>
<h4 class="h4" id="ch11lev2sec5">
<strong>DELEGATION</strong>
</h4>
<p class="noindent">Delegation can be used when one view controller needs to get information from another view controller. Say you have two view controllers: A and B. The first view controller, A, creates B and presents B on top of itself. A knows about B because it created and presented B, so A can pass information along to B. But B doesn’t know about A—it’s just popped into being and doesn’t know where it came from or how it got there. So how can B talk to A? Through delegation!</p>
<div class="image"><img src="Image00245.jpg" />
</div>
<p class="indent">Delegation is when someone gives a job or a task to someone else. A <em>delegate</em>
 is like a boss who tells a delegating employee what to do. When the delegating employee is done with their task, sometimes they’ll report information back to the delegate boss.</p>
<p class="indent"><span id="page_167"></span>
 Delegation in Swift is pretty similar, but instead of having a boss and employee, we have a delegate and a delegating object. Since class B is the one being told what to do by class A, it’s the delegating object. We give class B a special property called a delegate to tell it who its delegate is—that way, it knows who to communicate with. The delegate can be any class that has a set of methods that have been defined in a <em>protocol</em>
 . A protocol is like an agreement between the two classes that tells them what the delegate can ask the delegating object to do. It has a list of method and property names that the delegate can use with the delegating object.</p>
<p class="indent">Class A creates class B, makes itself the delegate of class B, and gives class B a job to do that’s in the protocol. Once class B is done with its job, it reports back to class A. Let’s see how this works in our app.</p>
<p class="indent">The Birthdays table view controller is view controller A, and the Add Birthday view controller is view controller B. We’ll create a protocol called <span class="code">AddBirthdayViewControllerDelegate</span>
 and a method for that protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 , which the Add Birthday view controller will use to report back.</p>
<p class="indent">Take a look at <a href="text00022.html#ch11fig6">Figure 11-6</a>
 . When the user taps the Add button <span class="ent">➊</span>
 , the Birthdays table view controller creates the Add Birthday view controller <span class="ent">➋</span>
 and sets itself as the Add Birthday view controller’s delegate.</p>
<div class="image"><img src="Image00246.jpg" />
</div>
<p class="figcap"><a id="ch11fig6"></a>
 <em>Figure 11-6: A new birthday is added and passed from the Add Birthday view controller to the Birthdays table view controller using delegation.</em>
</p>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<div class="image"><img src="Image00237.jpg" />
</div>
<div class="image"><img src="Image00238.jpg" />
</div>
<p class="figcap"><a id="ch11fig4"></a>
 <em>Figure 11-4: Creating a Subtitle style table view cell and setting its identifier</em>
</p>
<p class="indent"><span id="page_159"></span>
 Next, open the Attributes Inspector. Using the drop-down menu under <strong>Style</strong>
 , set the cell’s style to <strong>Subtitle</strong>
 <span class="ent">➋</span>
 so that the cell now has a Title label and a Subtitle label. You’ll display each person’s name in the Title and birthday in the Subtitle.</p>
<p class="indent">Finally, enter <span class="code">
<span class="codestrong">birthdayCellIdentifier</span>
</span>
 in the Identifier field <span class="ent">➌</span>
 . You’ll use this identifier later when you fill in the cell contents.</p>
<p class="indent">That’s it! You’ve finished your work in the storyboard.</p>
<p class="indent">You may be wondering why we have just one cell in our table view in the storyboard when we’ll have more than one birthday to show in the list. If you look at <a href="text00022.html#ch11fig4">Figure 11-4</a>
 again, you’ll notice that the cell is labeled <em>Prototype Cells</em>
 . This means that the cell you just customized is a <em>template</em>
 for all the cells you want to appear in your table view. The identifier you gave the cell is how your code will tell the table view to produce each cell for you to put birthdays in. You’ll see how this works soon.</p>
<div class="box1">
<p class="box-title">
<strong>WORKING WITH DATES</strong>
</p>
<p class="box-p">Swift has a special data type called <span class="code">Date</span>
 that is used for storing date values. A <span class="code">Date</span>
 object is actually a date and a time. Open your playground and enter the following:</p>
<div class="image"><img src="Image00239.jpg" />
</div>
<p class="box-pi">We’ve just assigned the current date and time the code was run to the variable <span class="code">today</span>
 . When you print <span class="code">today</span>
 , it’s in the format <span class="code">"2017-11-21 10:45:31 +0000\n"</span>
 . What if you wanted it to display as <span class="code">Tuesday, November 21, 2017</span>
 , instead? Or just <span class="code">11/21/17</span>
 ? To display a date in a particular way, you use a <em>date formatter</em>
 , which is a <span class="code">DateFormatter</span>
 object that you create and give a date format style. <span class="code">DateFormatter</span>
 is a helper object that is used to create a display string from any date, and a <em>date format style</em>
 is a property of <span class="code">DateFormatter</span>
 that tells the formatter what style to use. You can create your own date format styles manually, but there are also styles that are included in Swift and ready to use. Add the following to your playground:</p>
<div class="image"><img src="Image00240.jpg" />
</div>
<p class="box-pi">At <span class="ent">➊</span>
 you create a <span class="code">formatter</span>
 . Then at <span class="ent">➋</span>
 , you set the style of the <span class="code">formatter</span>
 to <span class="code">Style.full</span>
 , which will print the day of the week as well as the full month name, date, and year. Finally, you create a string from the date using the <span class="code">string(from:)</span>
 method of the <span class="code">DateFormatter</span>
 class <span class="ent">➌</span>
 . You can see that you now have turned the <span id="page_160"></span>
 date into the nicely formatted string <span class="code">"Tuesday, November 21, 2017"</span>
 . <a style=";color:black;" href="text00022.html#ch11tab1">Table 11-1</a>
 shows the different strings that are created from the five <span class="code">DateFormatter.Style</span>
 options available in Swift.</p>
<p class="tabcap"><a id="ch11tab1" style=";color:black;"></a>
 <strong>Table 11-1:</strong>
 Date Formatter Styles and Their Date Strings</p>
<table class="tabled">
<tbody>
<tr>
<td style="vertical-align: top;" class="border1">
<p class="noindent">
<span class="code">
<span class="codestrong">DateFormatter.Style</span>
</span>
</p>
</td>
<td style="vertical-align: top;" class="border1">
<p class="noindent">
<strong>Date string</strong>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">none</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">""</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">short</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"11/21/17"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">medium</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"Nov 21, 2017"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">long</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"November 21, 2017"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">full</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"Tuesday, November 21, 2017"</span>
</p>
</td>
</tr>
</tbody>
</table>
<p class="box-pi">You can also specify your own custom way of displaying a date using the <span class="code">dateFormat</span>
 property of the <span class="code">DateFormatter</span>
 . Perhaps you only want the month and day. Or maybe you want a four-digit year displayed in the <span class="code">short</span>
 style. Doing either is really easy, and you don’t even have to create a new <span class="code">DateFormatter</span>
 —you can just change the <span class="code">dateFormat</span>
 on <span class="code">formatter</span>
 and then ask it for a new string. Add the following code to your playground to display dates with a specific format:</p>
<div class="image"><img src="Image00241.jpg" />
</div>
<p class="box-pi">At <span class="ent">➊</span>
 , you specify that you only want the month and the date in an <span class="code">MM/dd</span>
 format—that is, a two-digit month followed by a two-digit date. If you want to display the month as three letters, then use <span class="code">MMM</span>
 . To display the full name of the month, use <span class="code">MMMM</span>
 . At <span class="ent">➋</span>
 , we change the date format to use a four-digit year. A two-digit year would be <span class="code">yy</span>
 . Here are a few other ways to use a <span class="code">dateFormat</span>
 to display a custom date string.</p>
<div class="image"><img src="Image00242.jpg" />
</div>
<p class="box-pi"><span id="page_161"></span>
 If you want to include separators, you add them to your <span class="code">dateFormat</span>
 string. For example, if you want periods as separators, then you can create a <span class="code">dateFormat</span>
 like <span class="code">"MM.dd.yy"</span>
 <span class="ent">➊</span>
 . To display an abbreviated day of the week, use <span class="code">EEE</span>
 <span class="ent">➋</span>
 . For the full day, use <span class="code">EEEE</span>
 <span class="ent">➌</span>
 . These are only a few examples. By using combinations of <span class="code">M</span>
 , <span class="code">d</span>
 , <span class="code">y</span>
 , and <span class="code">E</span>
 , you have an endless number of ways to display a date!</p>
</div>
<h4 class="h4" id="ch11lev2sec3">
<strong>SETTING UP THE BIRTHDAYS TABLE VIEW CONTROLLER</strong>
</h4>
<p class="noindent">The Birthdays table view controller will display a list of all the birthdays stored in the app. Do you remember what you use to store a list of items? That’s right—an array! You’ll create an array in the <span class="code">BirthdaysTableViewController</span>
 to store all the birthdays. To do this, give the <span class="code">BirthdaysTableViewController</span>
 a <span class="code">birthdays</span>
 property that is an array of <span class="code">Birthday</span>
 objects. At the top of the class, right above the <span class="code">viewDidLoad()</span>
 method, insert this line to add a variable array property called <span class="code">birthdays</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController {</span>
<br />
<br />
    <span class="pink">var</span>
 birthdays = [<span class="green1">Birthday</span>
 ]()<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent">This line creates an empty array of <span class="code">Birthday</span>
 instances. It needs to be a variable and not a constant because you’ll want to add a saved <span class="code">Birthday</span>
 to this array every time the user adds a <span class="code">Birthday</span>
 with the Add Birthday view controller. You’ll see how to do that in “<a href="text00022.html#ch11lev3sec2">Making the Birthdays Table View Controller Conform to Protocol</a>
 ” on <a href="text00022.html#page_168">page 168</a>
 .</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>Remember that the final versions of the project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>.</em>
</p>
</div>
<p class="indent">The <span class="code">BirthdaysTableViewController</span>
 will also need a <span class="code">dateFormatter</span>
 property to display the birthdate as a nicely formatted string. Add a <span class="code">dateFormatter</span>
 right underneath the <span class="code">birthdays</span>
 array:</p>
<div class="box">
<pre>    <span class="ash">var birthdays = [Birthday]()</span>
<br />
<br />
    <span class="pink">let</span>
 dateFormatter = <span class="violet">DateFormatter</span>
 ()<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent">Note that the <span class="code">dateFormatter</span>
 is a constant that is created with <span class="code">let</span>
 . Even though you’ll change the <span class="code">dateFormatter</span>
 ’s properties, like the <span class="code">dateStyle</span>
 and <span class="code">timeStyle</span>
 , you’ll never change the <span class="code">dateFormatter</span>
 itself.</p>
<p class="indent"><span id="page_162"></span>
 You’ll also need to set up the <span class="code">dateFormatter</span>
 so that it will display the birthdates as fully formatted strings like <span class="code">"Tuesday, December 17, 2008"</span>
 . As you saw in <a href="text00021.html#ch10">Chapter 10</a>
 , a good place to do this is the <span class="code">viewDidLoad()</span>
 method, which is called when the Birthdays table view controller is loading its view. This is the perfect place to do any setup that is needed for this class.</p>
<div class="box">
<pre>
<span class="ash">override func viewDidLoad() {</span>
<br />
    <span class="ash">super.viewDidLoad()</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">dateFormatter</span>
 .<span class="violet">dateStyle</span>
 = .<span class="blue">full</span>
<br />
  <span class="ent">➋</span>
 <span class="green1">dateFormatter</span>
 .<span class="violet">timeStyle</span>
 = .<span class="blue">none</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , you set the <span class="code">dateStyle</span>
 of the <span class="code">dateFormatter</span>
 so that it will display a formatted date string for each <span class="code">Birthday</span>
 . Did you notice how we just wrote <span class="code">.full</span>
 instead of <span class="code">DateFormatter.Style.full</span>
 ? Swift knows what type to expect for the <span class="code">dateStyle</span>
 of a <span class="code">DateFormatter</span>
 , so it lets us take this little shortcut. At <span class="ent">➋</span>
 , you set the <span class="code">timeStyle</span>
 of the <span class="code">dateFormatter</span>
 to <span class="code">.none</span>
 so that the time won’t be shown.</p>
<h4 class="h4" id="ch11lev2sec4">
<strong>DISPLAYING BIRTHDAYS IN A TABLE VIEW</strong>
</h4>
<p class="noindent">The <span class="code">BirthdaysTableViewController</span>
 class has a table view that is used to display a list of items in a single column. The table view has one or more sections containing rows, and each row contains a cell. A section in a table view is a grouping of rows that can be displayed with or without a header. An example of an app that shows a table view with several sections is the Settings app, as shown in <a href="text00022.html#ch11fig5">Figure 11-5</a>
 . It displays a list of rows that have been broken up into different sections.</p>
<p class="indent">Each section and row of a table view is identified with an index number. These numbers start at 0 and then increase by 1 as you go down the table view. For example, the Privacy line in the Settings app is found at section 0, row 1. The News setting is at section 1, row 3.</p>
<p class="indent">In the middle of the <span class="code">BirthdaysTableViewController</span>
 class, there is a section called <em>Table view data source</em>
 with three methods. The table view controller uses these methods to determine what’s going to be displayed inside its table view.</p>
<p class="hang">
<span class="code">
<span class="codestrong">numberOfSections(in:)</span>
</span>
 Tells the table view how many sections it should have</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:numberOfRowsInSection:)</span>
</span>
 Tells the table view how many rows will be displayed in each section</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:cellForRowAt:)</span>
</span>
 Sets up each cell that’s going to be displayed in each row of the table view</p>
<div class="image"><span id="page_163"></span>
 <img src="Image00243.jpg" />
</div>
<p class="figcap"><a id="ch11fig5"></a>
 <em>Figure 11-5: The Settings app uses sections to group rows of different device settings.</em>
</p>
<p class="indent">The table view data source methods are called by the table view controller every time the table view is reloaded. Xcode automatically gives you these method templates when you make a subclass of a <span class="code">UITableViewController</span>
 . You need to implement all three methods for the app to work, even though you’ll never call them directly in your code. The <span class="code">UITableViewController</span>
 class implements the <span class="code">UITableViewDataSource</span>
 protocol, which comes with these data source methods, to determine what will be displayed inside the table view. We’ll discuss protocols in “<a href="text00022.html#ch11lev2sec5">Delegation</a>
 ” on page 166. For now, you just need to know that a <span class="code">UITableViewController</span>
 uses these methods to display its content, and it automatically calls these methods so you don’t need to call them.</p>
<p class="indent">Let’s start with the method <span class="code">numberOfSections(in:)</span>
 . The Birthdays table view controller is a list that just displays <span class="code">Birthday</span>
 instances, so it doesn’t need multiple sections. To set the number of sections in the table view, we just need to return <span class="code">1</span>
 .</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func numberOfSections(in tableView: UITableView) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 <span class="blue1">1</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent"><span id="page_164"></span>
 This method takes a <span class="code">UITableView</span>
 called <span class="code">tableView</span>
 as a parameter, which is the table view that uses this class as its data source. We don’t need to worry about making this connection because the <span class="code">UITableViewController</span>
 comes with a built-in table view that is automatically hooked up to these methods. Each birthday will be displayed in its own row. So in <span class="code">tableView(_:numberOfRowsInSection:)</span>
 , in order to have the right number of rows for all of your birthdays, you need to return the number of <span class="code">Birthday</span>
 instances that you have in your <span class="code">birthdays</span>
 array. Do you remember the <span class="code">count</span>
 property of an array? It’s an integer that tells you how many items are in that array, and it’s perfect for this situation! Change this method to the following:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, <img class="inline" src="Image00184.jpg" />
<br />
    numberOfRowsInSection section: Int) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 birthdays.<span class="violet">count</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">In addition to the <span class="code">tableView</span>
 parameter, <span class="code">tableView(_:numberOfRowsInSection:)</span>
 also takes an <span class="code">Int</span>
 called <span class="code">section</span>
 . When the table view is loading itself, this method is called for each section in the table view. In our case, we have only one section, so we don’t need to bother checking which <span class="code">section</span>
 of the table view is being displayed here. We know it’s section 0, and we want it to have as many rows as there are birthdays, so we write <span class="code">return birthdays.count</span>
 .</p>
<p class="indent">Finally, you need to implement <span class="code">tableView(_:cellForRowAt:)</span>
 so that the table view will know what to put inside each cell. Since this method is commented out, you need to uncomment it by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it. (Be careful not to accidentally uncomment the other methods after it!) After you’ve done that, change it to the following code:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, cellForRowAt <img class="inline" src="Image00184.jpg" />
<br />
    indexPath: IndexPath) -&gt; UITableViewCell {</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="pink">let</span>
 cell = tableView.<span class="blue">dequeueReusableCell</span>
 (withIdentifier: <img class="inline" src="Image00093.jpg" />
<br />
        <span class="red">"birthdayCellIdentifier"</span>
 , for: indexPath)<br />
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 birthday = <span class="green1">birthdays</span>
 [indexPath.<span class="violet">row</span>
 ]<br />
<br />
  <span class="ent">➌</span>
 cell.<span class="violet">textLabel</span>
 ?.<span class="violet">text</span>
 = birthday.<span class="green1">firstName</span>
 <span class="blue">+</span>
 <span class="red">" "</span>
 <span class="blue">+</span>
 <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">lastName</span>
<br />
<br />
  <span class="ent">➍</span>
 cell.<span class="violet">detailTextLabel</span>
 ?.<span class="violet">text</span>
 = <span class="green1">dateFormatter</span>
 .<span class="blue">string</span>
 (from: <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">birthdate</span>
 )<br />
<br />
  <span class="ent">➎</span>
 <span class="pink">return</span>
 cell<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">You don’t call the method <span class="code">tableView(_:cellForRowAt:)</span>
 . It’s called when the table view is loaded onto the screen. It’s called for each cell on the screen and takes two parameters, <span class="code">tableView</span>
 and <span class="code">indexPath</span>
 . You already know <span id="page_165"></span>
 what the <span class="code">tableView</span>
 parameter is for. An <span class="code">IndexPath</span>
 is a Swift struct that’s used to represent a row’s position in a table view. An <span class="code">IndexPath</span>
 instance has a <span class="code">section</span>
 property and a <span class="code">row</span>
 property. Since this method will be called many times (once for every row in the table), we need the <span class="code">indexPath</span>
 to know which section and row we’re currently configuring. The <span class="code">indexPath.section</span>
 property gives the section number, and the <span class="code">indexPath.row</span>
 gives the row of the table view cell. The five lines of code inside <span class="code">tableView(_:cellForRowAt:)</span>
 will do the following:</p>
<div class="image"><img src="Image00244.jpg" />
</div>
<p class="bull">• Create a <span class="code">UITableViewCell</span>
</p>
<p class="bull">• Figure out which <span class="code">Birthday</span>
 in the <span class="code">birthdays</span>
 array will be displayed inside the cell</p>
<p class="bull">• Make two labels to display the birthday person’s name and birthdate in the cell</p>
<p class="bull">• Return the cell ready for display in the table view</p>
<p class="indentt">Let’s go through this code line by line.</p>
<p class="indent">First, create the <span class="code">UITableViewCell</span>
 . The code at <span class="ent">➊</span>
 does this using the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 . Before you can start using this method on a cell, though, you need to tell the method which cell you want to use from the storyboard. Earlier, when you were in the storyboard, you gave your cell the identifier <span class="code">birthdayCellIdentifier</span>
 (see <a href="text00022.html#ch11fig4">Figure 11-4</a>
 ). This identifier links your code to the cell and tells your method that it’s using the right cell. The string for when you call this method needs to be exactly the same as the string you set in the storyboard, or you’ll get an error and the app will crash when you run it.</p>
<p class="indent">In the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 , did you notice the words <em>Reusable Cell</em>
 ? The cells inside a table view are created once and then can be reused over and over. This helps everything run faster and smoother because creating the cell is what takes the most time. If you had 200 birthdays in your app, but only 10 would fit on your screen at one time, then you need only 10 cells to show your birthdays. When you scroll down to reveal more birthdays, the cells that scroll off the top of the screen are reused. They are filled with new information and show up again at the bottom of the screen. The <span class="code">UITableView</span>
 automatically does this work. When the table view is loaded, <span class="code">tableView(_:cellForRowAt:)</span>
 is called for every visible row. When the user scrolls to look at more cells, it’s called again for each row just as it is about to appear on the screen.</p>
<p class="indent">Next, we need to find out which <span class="code">Birthday</span>
 should be displayed inside the cell. We want to display one birthday from the <span class="code">birthdays</span>
 array in each row. The first birthday, which is at <span class="code">birthdays[0]</span>
 , should be displayed in row 0. The second birthday, at <span class="code">birthdays[1]</span>
 , should be displayed in row 1, and so on, which means the <span class="code">indexPath</span>
 ’s <span class="code">row</span>
 is the same as the position in the <span class="code">birthdays</span>
 array that we want to access. The code at <span class="ent">➋</span>
 accesses the <span id="page_166"></span>
 correct <span class="code">Birthday</span>
 object from the <span class="code">birthdays</span>
 array by using <span class="code">indexPath.row</span>
 . Once we have the right <span class="code">Birthday</span>
 object, we assign it to a constant named <span class="code">birthday</span>
 so we can set up the labels in this cell.</p>
<p class="indent">Notice that we’re using <span class="code">let</span>
 to assign the <span class="code">birthday</span>
 to a constant instead of a variable. We can use <span class="code">let</span>
 because each time <span class="code">tableView(_:cellForRowAt:)</span>
 is called, a new <span class="code">birthday</span>
 constant is created. Each cell gets its own <span class="code">birthday</span>
 constant that is assigned its own <span class="code">Birthday</span>
 object. Since we’re not going to change any of the <span class="code">birthday</span>
 constants—we’re just going to read their properties—we don’t want to make them variables.</p>
<p class="indent">Now that you have your cell and your birthday, it’s time to fill in the details. You need two labels for each cell to show the birthday person’s name and birthdate. You set the cell to the Subtitle style so that it has a Title label and a Subtitle label. Each cell will already contain these labels, so now you don’t have to create any labels yourself.</p>
<p class="indent">The labels exist as properties of <span class="code">UITableViewCell</span>
 and are called <span class="code">textLabel</span>
 and <span class="code">detailTextLabel</span>
 . The code at <span class="ent">➌</span>
 sets the text of the <span class="code">textLabel</span>
 to a string made up of the <span class="code">firstName</span>
 and <span class="code">lastName</span>
 of the <span class="code">birthday</span>
 with a space between them. At <span class="ent">➍</span>
 , you use the <span class="code">string(from:)</span>
 method of the <span class="code">dateFormatter</span>
 to display the birthdate in the <span class="code">detailTextLabel</span>
 .</p>
<p class="indent">When your cell is completely configured, <span class="code">tableView( _:cellForRowAt:)</span>
 returns the cell at <span class="ent">➎</span>
 so that it can be displayed at that <span class="code">indexPath</span>
 of the table view.</p>
<h3 class="h3" id="ch11lev1sec2">
<strong>PUTTING IT ALL TOGETHER</strong>
</h3>
<p class="noindent">Now you can add <span class="code">Birthday</span>
 instances to the app using the Add Birthday view controller, and you have a table view to list each <span class="code">Birthday</span>
 in the Birthdays table view controller. But when you try running the app and adding a <span class="code">Birthday</span>
 , it doesn’t appear. To make each <span class="code">Birthday</span>
 you add appear in the table view, you need to make the Add Birthday view controller communicate with the Birthdays table view controller. You do this by using <em>delegation</em>
 .</p>
<h4 class="h4" id="ch11lev2sec5">
<strong>DELEGATION</strong>
</h4>
<p class="noindent">Delegation can be used when one view controller needs to get information from another view controller. Say you have two view controllers: A and B. The first view controller, A, creates B and presents B on top of itself. A knows about B because it created and presented B, so A can pass information along to B. But B doesn’t know about A—it’s just popped into being and doesn’t know where it came from or how it got there. So how can B talk to A? Through delegation!</p>
<div class="image"><img src="Image00245.jpg" />
</div>
<p class="indent">Delegation is when someone gives a job or a task to someone else. A <em>delegate</em>
 is like a boss who tells a delegating employee what to do. When the delegating employee is done with their task, sometimes they’ll report information back to the delegate boss.</p>
<p class="indent"><span id="page_167"></span>
 Delegation in Swift is pretty similar, but instead of having a boss and employee, we have a delegate and a delegating object. Since class B is the one being told what to do by class A, it’s the delegating object. We give class B a special property called a delegate to tell it who its delegate is—that way, it knows who to communicate with. The delegate can be any class that has a set of methods that have been defined in a <em>protocol</em>
 . A protocol is like an agreement between the two classes that tells them what the delegate can ask the delegating object to do. It has a list of method and property names that the delegate can use with the delegating object.</p>
<p class="indent">Class A creates class B, makes itself the delegate of class B, and gives class B a job to do that’s in the protocol. Once class B is done with its job, it reports back to class A. Let’s see how this works in our app.</p>
<p class="indent">The Birthdays table view controller is view controller A, and the Add Birthday view controller is view controller B. We’ll create a protocol called <span class="code">AddBirthdayViewControllerDelegate</span>
 and a method for that protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 , which the Add Birthday view controller will use to report back.</p>
<p class="indent">Take a look at <a href="text00022.html#ch11fig6">Figure 11-6</a>
 . When the user taps the Add button <span class="ent">➊</span>
 , the Birthdays table view controller creates the Add Birthday view controller <span class="ent">➋</span>
 and sets itself as the Add Birthday view controller’s delegate.</p>
<div class="image"><img src="Image00246.jpg" />
</div>
<p class="figcap"><a id="ch11fig6"></a>
 <em>Figure 11-6: A new birthday is added and passed from the Add Birthday view controller to the Birthdays table view controller using delegation.</em>
</p>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<div class="image"><img src="Image00238.jpg" />
</div>
<p class="figcap"><a id="ch11fig4"></a>
 <em>Figure 11-4: Creating a Subtitle style table view cell and setting its identifier</em>
</p>
<p class="indent"><span id="page_159"></span>
 Next, open the Attributes Inspector. Using the drop-down menu under <strong>Style</strong>
 , set the cell’s style to <strong>Subtitle</strong>
 <span class="ent">➋</span>
 so that the cell now has a Title label and a Subtitle label. You’ll display each person’s name in the Title and birthday in the Subtitle.</p>
<p class="indent">Finally, enter <span class="code">
<span class="codestrong">birthdayCellIdentifier</span>
</span>
 in the Identifier field <span class="ent">➌</span>
 . You’ll use this identifier later when you fill in the cell contents.</p>
<p class="indent">That’s it! You’ve finished your work in the storyboard.</p>
<p class="indent">You may be wondering why we have just one cell in our table view in the storyboard when we’ll have more than one birthday to show in the list. If you look at <a href="text00022.html#ch11fig4">Figure 11-4</a>
 again, you’ll notice that the cell is labeled <em>Prototype Cells</em>
 . This means that the cell you just customized is a <em>template</em>
 for all the cells you want to appear in your table view. The identifier you gave the cell is how your code will tell the table view to produce each cell for you to put birthdays in. You’ll see how this works soon.</p>
<div class="box1">
<p class="box-title">
<strong>WORKING WITH DATES</strong>
</p>
<p class="box-p">Swift has a special data type called <span class="code">Date</span>
 that is used for storing date values. A <span class="code">Date</span>
 object is actually a date and a time. Open your playground and enter the following:</p>
<div class="image"><img src="Image00239.jpg" />
</div>
<p class="box-pi">We’ve just assigned the current date and time the code was run to the variable <span class="code">today</span>
 . When you print <span class="code">today</span>
 , it’s in the format <span class="code">"2017-11-21 10:45:31 +0000\n"</span>
 . What if you wanted it to display as <span class="code">Tuesday, November 21, 2017</span>
 , instead? Or just <span class="code">11/21/17</span>
 ? To display a date in a particular way, you use a <em>date formatter</em>
 , which is a <span class="code">DateFormatter</span>
 object that you create and give a date format style. <span class="code">DateFormatter</span>
 is a helper object that is used to create a display string from any date, and a <em>date format style</em>
 is a property of <span class="code">DateFormatter</span>
 that tells the formatter what style to use. You can create your own date format styles manually, but there are also styles that are included in Swift and ready to use. Add the following to your playground:</p>
<div class="image"><img src="Image00240.jpg" />
</div>
<p class="box-pi">At <span class="ent">➊</span>
 you create a <span class="code">formatter</span>
 . Then at <span class="ent">➋</span>
 , you set the style of the <span class="code">formatter</span>
 to <span class="code">Style.full</span>
 , which will print the day of the week as well as the full month name, date, and year. Finally, you create a string from the date using the <span class="code">string(from:)</span>
 method of the <span class="code">DateFormatter</span>
 class <span class="ent">➌</span>
 . You can see that you now have turned the <span id="page_160"></span>
 date into the nicely formatted string <span class="code">"Tuesday, November 21, 2017"</span>
 . <a style=";color:black;" href="text00022.html#ch11tab1">Table 11-1</a>
 shows the different strings that are created from the five <span class="code">DateFormatter.Style</span>
 options available in Swift.</p>
<p class="tabcap"><a id="ch11tab1" style=";color:black;"></a>
 <strong>Table 11-1:</strong>
 Date Formatter Styles and Their Date Strings</p>
<table class="tabled">
<tbody>
<tr>
<td style="vertical-align: top;" class="border1">
<p class="noindent">
<span class="code">
<span class="codestrong">DateFormatter.Style</span>
</span>
</p>
</td>
<td style="vertical-align: top;" class="border1">
<p class="noindent">
<strong>Date string</strong>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">none</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">""</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">short</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"11/21/17"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">medium</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"Nov 21, 2017"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">long</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"November 21, 2017"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">full</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"Tuesday, November 21, 2017"</span>
</p>
</td>
</tr>
</tbody>
</table>
<p class="box-pi">You can also specify your own custom way of displaying a date using the <span class="code">dateFormat</span>
 property of the <span class="code">DateFormatter</span>
 . Perhaps you only want the month and day. Or maybe you want a four-digit year displayed in the <span class="code">short</span>
 style. Doing either is really easy, and you don’t even have to create a new <span class="code">DateFormatter</span>
 —you can just change the <span class="code">dateFormat</span>
 on <span class="code">formatter</span>
 and then ask it for a new string. Add the following code to your playground to display dates with a specific format:</p>
<div class="image"><img src="Image00241.jpg" />
</div>
<p class="box-pi">At <span class="ent">➊</span>
 , you specify that you only want the month and the date in an <span class="code">MM/dd</span>
 format—that is, a two-digit month followed by a two-digit date. If you want to display the month as three letters, then use <span class="code">MMM</span>
 . To display the full name of the month, use <span class="code">MMMM</span>
 . At <span class="ent">➋</span>
 , we change the date format to use a four-digit year. A two-digit year would be <span class="code">yy</span>
 . Here are a few other ways to use a <span class="code">dateFormat</span>
 to display a custom date string.</p>
<div class="image"><img src="Image00242.jpg" />
</div>
<p class="box-pi"><span id="page_161"></span>
 If you want to include separators, you add them to your <span class="code">dateFormat</span>
 string. For example, if you want periods as separators, then you can create a <span class="code">dateFormat</span>
 like <span class="code">"MM.dd.yy"</span>
 <span class="ent">➊</span>
 . To display an abbreviated day of the week, use <span class="code">EEE</span>
 <span class="ent">➋</span>
 . For the full day, use <span class="code">EEEE</span>
 <span class="ent">➌</span>
 . These are only a few examples. By using combinations of <span class="code">M</span>
 , <span class="code">d</span>
 , <span class="code">y</span>
 , and <span class="code">E</span>
 , you have an endless number of ways to display a date!</p>
</div>
<h4 class="h4" id="ch11lev2sec3">
<strong>SETTING UP THE BIRTHDAYS TABLE VIEW CONTROLLER</strong>
</h4>
<p class="noindent">The Birthdays table view controller will display a list of all the birthdays stored in the app. Do you remember what you use to store a list of items? That’s right—an array! You’ll create an array in the <span class="code">BirthdaysTableViewController</span>
 to store all the birthdays. To do this, give the <span class="code">BirthdaysTableViewController</span>
 a <span class="code">birthdays</span>
 property that is an array of <span class="code">Birthday</span>
 objects. At the top of the class, right above the <span class="code">viewDidLoad()</span>
 method, insert this line to add a variable array property called <span class="code">birthdays</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController {</span>
<br />
<br />
    <span class="pink">var</span>
 birthdays = [<span class="green1">Birthday</span>
 ]()<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent">This line creates an empty array of <span class="code">Birthday</span>
 instances. It needs to be a variable and not a constant because you’ll want to add a saved <span class="code">Birthday</span>
 to this array every time the user adds a <span class="code">Birthday</span>
 with the Add Birthday view controller. You’ll see how to do that in “<a href="text00022.html#ch11lev3sec2">Making the Birthdays Table View Controller Conform to Protocol</a>
 ” on <a href="text00022.html#page_168">page 168</a>
 .</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>Remember that the final versions of the project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>.</em>
</p>
</div>
<p class="indent">The <span class="code">BirthdaysTableViewController</span>
 will also need a <span class="code">dateFormatter</span>
 property to display the birthdate as a nicely formatted string. Add a <span class="code">dateFormatter</span>
 right underneath the <span class="code">birthdays</span>
 array:</p>
<div class="box">
<pre>    <span class="ash">var birthdays = [Birthday]()</span>
<br />
<br />
    <span class="pink">let</span>
 dateFormatter = <span class="violet">DateFormatter</span>
 ()<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent">Note that the <span class="code">dateFormatter</span>
 is a constant that is created with <span class="code">let</span>
 . Even though you’ll change the <span class="code">dateFormatter</span>
 ’s properties, like the <span class="code">dateStyle</span>
 and <span class="code">timeStyle</span>
 , you’ll never change the <span class="code">dateFormatter</span>
 itself.</p>
<p class="indent"><span id="page_162"></span>
 You’ll also need to set up the <span class="code">dateFormatter</span>
 so that it will display the birthdates as fully formatted strings like <span class="code">"Tuesday, December 17, 2008"</span>
 . As you saw in <a href="text00021.html#ch10">Chapter 10</a>
 , a good place to do this is the <span class="code">viewDidLoad()</span>
 method, which is called when the Birthdays table view controller is loading its view. This is the perfect place to do any setup that is needed for this class.</p>
<div class="box">
<pre>
<span class="ash">override func viewDidLoad() {</span>
<br />
    <span class="ash">super.viewDidLoad()</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">dateFormatter</span>
 .<span class="violet">dateStyle</span>
 = .<span class="blue">full</span>
<br />
  <span class="ent">➋</span>
 <span class="green1">dateFormatter</span>
 .<span class="violet">timeStyle</span>
 = .<span class="blue">none</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , you set the <span class="code">dateStyle</span>
 of the <span class="code">dateFormatter</span>
 so that it will display a formatted date string for each <span class="code">Birthday</span>
 . Did you notice how we just wrote <span class="code">.full</span>
 instead of <span class="code">DateFormatter.Style.full</span>
 ? Swift knows what type to expect for the <span class="code">dateStyle</span>
 of a <span class="code">DateFormatter</span>
 , so it lets us take this little shortcut. At <span class="ent">➋</span>
 , you set the <span class="code">timeStyle</span>
 of the <span class="code">dateFormatter</span>
 to <span class="code">.none</span>
 so that the time won’t be shown.</p>
<h4 class="h4" id="ch11lev2sec4">
<strong>DISPLAYING BIRTHDAYS IN A TABLE VIEW</strong>
</h4>
<p class="noindent">The <span class="code">BirthdaysTableViewController</span>
 class has a table view that is used to display a list of items in a single column. The table view has one or more sections containing rows, and each row contains a cell. A section in a table view is a grouping of rows that can be displayed with or without a header. An example of an app that shows a table view with several sections is the Settings app, as shown in <a href="text00022.html#ch11fig5">Figure 11-5</a>
 . It displays a list of rows that have been broken up into different sections.</p>
<p class="indent">Each section and row of a table view is identified with an index number. These numbers start at 0 and then increase by 1 as you go down the table view. For example, the Privacy line in the Settings app is found at section 0, row 1. The News setting is at section 1, row 3.</p>
<p class="indent">In the middle of the <span class="code">BirthdaysTableViewController</span>
 class, there is a section called <em>Table view data source</em>
 with three methods. The table view controller uses these methods to determine what’s going to be displayed inside its table view.</p>
<p class="hang">
<span class="code">
<span class="codestrong">numberOfSections(in:)</span>
</span>
 Tells the table view how many sections it should have</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:numberOfRowsInSection:)</span>
</span>
 Tells the table view how many rows will be displayed in each section</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:cellForRowAt:)</span>
</span>
 Sets up each cell that’s going to be displayed in each row of the table view</p>
<div class="image"><span id="page_163"></span>
 <img src="Image00243.jpg" />
</div>
<p class="figcap"><a id="ch11fig5"></a>
 <em>Figure 11-5: The Settings app uses sections to group rows of different device settings.</em>
</p>
<p class="indent">The table view data source methods are called by the table view controller every time the table view is reloaded. Xcode automatically gives you these method templates when you make a subclass of a <span class="code">UITableViewController</span>
 . You need to implement all three methods for the app to work, even though you’ll never call them directly in your code. The <span class="code">UITableViewController</span>
 class implements the <span class="code">UITableViewDataSource</span>
 protocol, which comes with these data source methods, to determine what will be displayed inside the table view. We’ll discuss protocols in “<a href="text00022.html#ch11lev2sec5">Delegation</a>
 ” on page 166. For now, you just need to know that a <span class="code">UITableViewController</span>
 uses these methods to display its content, and it automatically calls these methods so you don’t need to call them.</p>
<p class="indent">Let’s start with the method <span class="code">numberOfSections(in:)</span>
 . The Birthdays table view controller is a list that just displays <span class="code">Birthday</span>
 instances, so it doesn’t need multiple sections. To set the number of sections in the table view, we just need to return <span class="code">1</span>
 .</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func numberOfSections(in tableView: UITableView) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 <span class="blue1">1</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent"><span id="page_164"></span>
 This method takes a <span class="code">UITableView</span>
 called <span class="code">tableView</span>
 as a parameter, which is the table view that uses this class as its data source. We don’t need to worry about making this connection because the <span class="code">UITableViewController</span>
 comes with a built-in table view that is automatically hooked up to these methods. Each birthday will be displayed in its own row. So in <span class="code">tableView(_:numberOfRowsInSection:)</span>
 , in order to have the right number of rows for all of your birthdays, you need to return the number of <span class="code">Birthday</span>
 instances that you have in your <span class="code">birthdays</span>
 array. Do you remember the <span class="code">count</span>
 property of an array? It’s an integer that tells you how many items are in that array, and it’s perfect for this situation! Change this method to the following:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, <img class="inline" src="Image00184.jpg" />
<br />
    numberOfRowsInSection section: Int) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 birthdays.<span class="violet">count</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">In addition to the <span class="code">tableView</span>
 parameter, <span class="code">tableView(_:numberOfRowsInSection:)</span>
 also takes an <span class="code">Int</span>
 called <span class="code">section</span>
 . When the table view is loading itself, this method is called for each section in the table view. In our case, we have only one section, so we don’t need to bother checking which <span class="code">section</span>
 of the table view is being displayed here. We know it’s section 0, and we want it to have as many rows as there are birthdays, so we write <span class="code">return birthdays.count</span>
 .</p>
<p class="indent">Finally, you need to implement <span class="code">tableView(_:cellForRowAt:)</span>
 so that the table view will know what to put inside each cell. Since this method is commented out, you need to uncomment it by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it. (Be careful not to accidentally uncomment the other methods after it!) After you’ve done that, change it to the following code:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, cellForRowAt <img class="inline" src="Image00184.jpg" />
<br />
    indexPath: IndexPath) -&gt; UITableViewCell {</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="pink">let</span>
 cell = tableView.<span class="blue">dequeueReusableCell</span>
 (withIdentifier: <img class="inline" src="Image00093.jpg" />
<br />
        <span class="red">"birthdayCellIdentifier"</span>
 , for: indexPath)<br />
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 birthday = <span class="green1">birthdays</span>
 [indexPath.<span class="violet">row</span>
 ]<br />
<br />
  <span class="ent">➌</span>
 cell.<span class="violet">textLabel</span>
 ?.<span class="violet">text</span>
 = birthday.<span class="green1">firstName</span>
 <span class="blue">+</span>
 <span class="red">" "</span>
 <span class="blue">+</span>
 <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">lastName</span>
<br />
<br />
  <span class="ent">➍</span>
 cell.<span class="violet">detailTextLabel</span>
 ?.<span class="violet">text</span>
 = <span class="green1">dateFormatter</span>
 .<span class="blue">string</span>
 (from: <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">birthdate</span>
 )<br />
<br />
  <span class="ent">➎</span>
 <span class="pink">return</span>
 cell<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">You don’t call the method <span class="code">tableView(_:cellForRowAt:)</span>
 . It’s called when the table view is loaded onto the screen. It’s called for each cell on the screen and takes two parameters, <span class="code">tableView</span>
 and <span class="code">indexPath</span>
 . You already know <span id="page_165"></span>
 what the <span class="code">tableView</span>
 parameter is for. An <span class="code">IndexPath</span>
 is a Swift struct that’s used to represent a row’s position in a table view. An <span class="code">IndexPath</span>
 instance has a <span class="code">section</span>
 property and a <span class="code">row</span>
 property. Since this method will be called many times (once for every row in the table), we need the <span class="code">indexPath</span>
 to know which section and row we’re currently configuring. The <span class="code">indexPath.section</span>
 property gives the section number, and the <span class="code">indexPath.row</span>
 gives the row of the table view cell. The five lines of code inside <span class="code">tableView(_:cellForRowAt:)</span>
 will do the following:</p>
<div class="image"><img src="Image00244.jpg" />
</div>
<p class="bull">• Create a <span class="code">UITableViewCell</span>
</p>
<p class="bull">• Figure out which <span class="code">Birthday</span>
 in the <span class="code">birthdays</span>
 array will be displayed inside the cell</p>
<p class="bull">• Make two labels to display the birthday person’s name and birthdate in the cell</p>
<p class="bull">• Return the cell ready for display in the table view</p>
<p class="indentt">Let’s go through this code line by line.</p>
<p class="indent">First, create the <span class="code">UITableViewCell</span>
 . The code at <span class="ent">➊</span>
 does this using the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 . Before you can start using this method on a cell, though, you need to tell the method which cell you want to use from the storyboard. Earlier, when you were in the storyboard, you gave your cell the identifier <span class="code">birthdayCellIdentifier</span>
 (see <a href="text00022.html#ch11fig4">Figure 11-4</a>
 ). This identifier links your code to the cell and tells your method that it’s using the right cell. The string for when you call this method needs to be exactly the same as the string you set in the storyboard, or you’ll get an error and the app will crash when you run it.</p>
<p class="indent">In the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 , did you notice the words <em>Reusable Cell</em>
 ? The cells inside a table view are created once and then can be reused over and over. This helps everything run faster and smoother because creating the cell is what takes the most time. If you had 200 birthdays in your app, but only 10 would fit on your screen at one time, then you need only 10 cells to show your birthdays. When you scroll down to reveal more birthdays, the cells that scroll off the top of the screen are reused. They are filled with new information and show up again at the bottom of the screen. The <span class="code">UITableView</span>
 automatically does this work. When the table view is loaded, <span class="code">tableView(_:cellForRowAt:)</span>
 is called for every visible row. When the user scrolls to look at more cells, it’s called again for each row just as it is about to appear on the screen.</p>
<p class="indent">Next, we need to find out which <span class="code">Birthday</span>
 should be displayed inside the cell. We want to display one birthday from the <span class="code">birthdays</span>
 array in each row. The first birthday, which is at <span class="code">birthdays[0]</span>
 , should be displayed in row 0. The second birthday, at <span class="code">birthdays[1]</span>
 , should be displayed in row 1, and so on, which means the <span class="code">indexPath</span>
 ’s <span class="code">row</span>
 is the same as the position in the <span class="code">birthdays</span>
 array that we want to access. The code at <span class="ent">➋</span>
 accesses the <span id="page_166"></span>
 correct <span class="code">Birthday</span>
 object from the <span class="code">birthdays</span>
 array by using <span class="code">indexPath.row</span>
 . Once we have the right <span class="code">Birthday</span>
 object, we assign it to a constant named <span class="code">birthday</span>
 so we can set up the labels in this cell.</p>
<p class="indent">Notice that we’re using <span class="code">let</span>
 to assign the <span class="code">birthday</span>
 to a constant instead of a variable. We can use <span class="code">let</span>
 because each time <span class="code">tableView(_:cellForRowAt:)</span>
 is called, a new <span class="code">birthday</span>
 constant is created. Each cell gets its own <span class="code">birthday</span>
 constant that is assigned its own <span class="code">Birthday</span>
 object. Since we’re not going to change any of the <span class="code">birthday</span>
 constants—we’re just going to read their properties—we don’t want to make them variables.</p>
<p class="indent">Now that you have your cell and your birthday, it’s time to fill in the details. You need two labels for each cell to show the birthday person’s name and birthdate. You set the cell to the Subtitle style so that it has a Title label and a Subtitle label. Each cell will already contain these labels, so now you don’t have to create any labels yourself.</p>
<p class="indent">The labels exist as properties of <span class="code">UITableViewCell</span>
 and are called <span class="code">textLabel</span>
 and <span class="code">detailTextLabel</span>
 . The code at <span class="ent">➌</span>
 sets the text of the <span class="code">textLabel</span>
 to a string made up of the <span class="code">firstName</span>
 and <span class="code">lastName</span>
 of the <span class="code">birthday</span>
 with a space between them. At <span class="ent">➍</span>
 , you use the <span class="code">string(from:)</span>
 method of the <span class="code">dateFormatter</span>
 to display the birthdate in the <span class="code">detailTextLabel</span>
 .</p>
<p class="indent">When your cell is completely configured, <span class="code">tableView( _:cellForRowAt:)</span>
 returns the cell at <span class="ent">➎</span>
 so that it can be displayed at that <span class="code">indexPath</span>
 of the table view.</p>
<h3 class="h3" id="ch11lev1sec2">
<strong>PUTTING IT ALL TOGETHER</strong>
</h3>
<p class="noindent">Now you can add <span class="code">Birthday</span>
 instances to the app using the Add Birthday view controller, and you have a table view to list each <span class="code">Birthday</span>
 in the Birthdays table view controller. But when you try running the app and adding a <span class="code">Birthday</span>
 , it doesn’t appear. To make each <span class="code">Birthday</span>
 you add appear in the table view, you need to make the Add Birthday view controller communicate with the Birthdays table view controller. You do this by using <em>delegation</em>
 .</p>
<h4 class="h4" id="ch11lev2sec5">
<strong>DELEGATION</strong>
</h4>
<p class="noindent">Delegation can be used when one view controller needs to get information from another view controller. Say you have two view controllers: A and B. The first view controller, A, creates B and presents B on top of itself. A knows about B because it created and presented B, so A can pass information along to B. But B doesn’t know about A—it’s just popped into being and doesn’t know where it came from or how it got there. So how can B talk to A? Through delegation!</p>
<div class="image"><img src="Image00245.jpg" />
</div>
<p class="indent">Delegation is when someone gives a job or a task to someone else. A <em>delegate</em>
 is like a boss who tells a delegating employee what to do. When the delegating employee is done with their task, sometimes they’ll report information back to the delegate boss.</p>
<p class="indent"><span id="page_167"></span>
 Delegation in Swift is pretty similar, but instead of having a boss and employee, we have a delegate and a delegating object. Since class B is the one being told what to do by class A, it’s the delegating object. We give class B a special property called a delegate to tell it who its delegate is—that way, it knows who to communicate with. The delegate can be any class that has a set of methods that have been defined in a <em>protocol</em>
 . A protocol is like an agreement between the two classes that tells them what the delegate can ask the delegating object to do. It has a list of method and property names that the delegate can use with the delegating object.</p>
<p class="indent">Class A creates class B, makes itself the delegate of class B, and gives class B a job to do that’s in the protocol. Once class B is done with its job, it reports back to class A. Let’s see how this works in our app.</p>
<p class="indent">The Birthdays table view controller is view controller A, and the Add Birthday view controller is view controller B. We’ll create a protocol called <span class="code">AddBirthdayViewControllerDelegate</span>
 and a method for that protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 , which the Add Birthday view controller will use to report back.</p>
<p class="indent">Take a look at <a href="text00022.html#ch11fig6">Figure 11-6</a>
 . When the user taps the Add button <span class="ent">➊</span>
 , the Birthdays table view controller creates the Add Birthday view controller <span class="ent">➋</span>
 and sets itself as the Add Birthday view controller’s delegate.</p>
<div class="image"><img src="Image00246.jpg" />
</div>
<p class="figcap"><a id="ch11fig6"></a>
 <em>Figure 11-6: A new birthday is added and passed from the Add Birthday view controller to the Birthdays table view controller using delegation.</em>
</p>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="figcap"><a id="ch11fig4"></a>
 <em>Figure 11-4: Creating a Subtitle style table view cell and setting its identifier</em>
</p>
<p class="indent"><span id="page_159"></span>
 Next, open the Attributes Inspector. Using the drop-down menu under <strong>Style</strong>
 , set the cell’s style to <strong>Subtitle</strong>
 <span class="ent">➋</span>
 so that the cell now has a Title label and a Subtitle label. You’ll display each person’s name in the Title and birthday in the Subtitle.</p>
<p class="indent">Finally, enter <span class="code">
<span class="codestrong">birthdayCellIdentifier</span>
</span>
 in the Identifier field <span class="ent">➌</span>
 . You’ll use this identifier later when you fill in the cell contents.</p>
<p class="indent">That’s it! You’ve finished your work in the storyboard.</p>
<p class="indent">You may be wondering why we have just one cell in our table view in the storyboard when we’ll have more than one birthday to show in the list. If you look at <a href="text00022.html#ch11fig4">Figure 11-4</a>
 again, you’ll notice that the cell is labeled <em>Prototype Cells</em>
 . This means that the cell you just customized is a <em>template</em>
 for all the cells you want to appear in your table view. The identifier you gave the cell is how your code will tell the table view to produce each cell for you to put birthdays in. You’ll see how this works soon.</p>
<div class="box1">
<p class="box-title">
<strong>WORKING WITH DATES</strong>
</p>
<p class="box-p">Swift has a special data type called <span class="code">Date</span>
 that is used for storing date values. A <span class="code">Date</span>
 object is actually a date and a time. Open your playground and enter the following:</p>
<div class="image"><img src="Image00239.jpg" />
</div>
<p class="box-pi">We’ve just assigned the current date and time the code was run to the variable <span class="code">today</span>
 . When you print <span class="code">today</span>
 , it’s in the format <span class="code">"2017-11-21 10:45:31 +0000\n"</span>
 . What if you wanted it to display as <span class="code">Tuesday, November 21, 2017</span>
 , instead? Or just <span class="code">11/21/17</span>
 ? To display a date in a particular way, you use a <em>date formatter</em>
 , which is a <span class="code">DateFormatter</span>
 object that you create and give a date format style. <span class="code">DateFormatter</span>
 is a helper object that is used to create a display string from any date, and a <em>date format style</em>
 is a property of <span class="code">DateFormatter</span>
 that tells the formatter what style to use. You can create your own date format styles manually, but there are also styles that are included in Swift and ready to use. Add the following to your playground:</p>
<div class="image"><img src="Image00240.jpg" />
</div>
<p class="box-pi">At <span class="ent">➊</span>
 you create a <span class="code">formatter</span>
 . Then at <span class="ent">➋</span>
 , you set the style of the <span class="code">formatter</span>
 to <span class="code">Style.full</span>
 , which will print the day of the week as well as the full month name, date, and year. Finally, you create a string from the date using the <span class="code">string(from:)</span>
 method of the <span class="code">DateFormatter</span>
 class <span class="ent">➌</span>
 . You can see that you now have turned the <span id="page_160"></span>
 date into the nicely formatted string <span class="code">"Tuesday, November 21, 2017"</span>
 . <a style=";color:black;" href="text00022.html#ch11tab1">Table 11-1</a>
 shows the different strings that are created from the five <span class="code">DateFormatter.Style</span>
 options available in Swift.</p>
<p class="tabcap"><a id="ch11tab1" style=";color:black;"></a>
 <strong>Table 11-1:</strong>
 Date Formatter Styles and Their Date Strings</p>
<table class="tabled">
<tbody>
<tr>
<td style="vertical-align: top;" class="border1">
<p class="noindent">
<span class="code">
<span class="codestrong">DateFormatter.Style</span>
</span>
</p>
</td>
<td style="vertical-align: top;" class="border1">
<p class="noindent">
<strong>Date string</strong>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">none</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">""</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">short</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"11/21/17"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">medium</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"Nov 21, 2017"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">long</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"November 21, 2017"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">full</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"Tuesday, November 21, 2017"</span>
</p>
</td>
</tr>
</tbody>
</table>
<p class="box-pi">You can also specify your own custom way of displaying a date using the <span class="code">dateFormat</span>
 property of the <span class="code">DateFormatter</span>
 . Perhaps you only want the month and day. Or maybe you want a four-digit year displayed in the <span class="code">short</span>
 style. Doing either is really easy, and you don’t even have to create a new <span class="code">DateFormatter</span>
 —you can just change the <span class="code">dateFormat</span>
 on <span class="code">formatter</span>
 and then ask it for a new string. Add the following code to your playground to display dates with a specific format:</p>
<div class="image"><img src="Image00241.jpg" />
</div>
<p class="box-pi">At <span class="ent">➊</span>
 , you specify that you only want the month and the date in an <span class="code">MM/dd</span>
 format—that is, a two-digit month followed by a two-digit date. If you want to display the month as three letters, then use <span class="code">MMM</span>
 . To display the full name of the month, use <span class="code">MMMM</span>
 . At <span class="ent">➋</span>
 , we change the date format to use a four-digit year. A two-digit year would be <span class="code">yy</span>
 . Here are a few other ways to use a <span class="code">dateFormat</span>
 to display a custom date string.</p>
<div class="image"><img src="Image00242.jpg" />
</div>
<p class="box-pi"><span id="page_161"></span>
 If you want to include separators, you add them to your <span class="code">dateFormat</span>
 string. For example, if you want periods as separators, then you can create a <span class="code">dateFormat</span>
 like <span class="code">"MM.dd.yy"</span>
 <span class="ent">➊</span>
 . To display an abbreviated day of the week, use <span class="code">EEE</span>
 <span class="ent">➋</span>
 . For the full day, use <span class="code">EEEE</span>
 <span class="ent">➌</span>
 . These are only a few examples. By using combinations of <span class="code">M</span>
 , <span class="code">d</span>
 , <span class="code">y</span>
 , and <span class="code">E</span>
 , you have an endless number of ways to display a date!</p>
</div>
<h4 class="h4" id="ch11lev2sec3">
<strong>SETTING UP THE BIRTHDAYS TABLE VIEW CONTROLLER</strong>
</h4>
<p class="noindent">The Birthdays table view controller will display a list of all the birthdays stored in the app. Do you remember what you use to store a list of items? That’s right—an array! You’ll create an array in the <span class="code">BirthdaysTableViewController</span>
 to store all the birthdays. To do this, give the <span class="code">BirthdaysTableViewController</span>
 a <span class="code">birthdays</span>
 property that is an array of <span class="code">Birthday</span>
 objects. At the top of the class, right above the <span class="code">viewDidLoad()</span>
 method, insert this line to add a variable array property called <span class="code">birthdays</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController {</span>
<br />
<br />
    <span class="pink">var</span>
 birthdays = [<span class="green1">Birthday</span>
 ]()<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent">This line creates an empty array of <span class="code">Birthday</span>
 instances. It needs to be a variable and not a constant because you’ll want to add a saved <span class="code">Birthday</span>
 to this array every time the user adds a <span class="code">Birthday</span>
 with the Add Birthday view controller. You’ll see how to do that in “<a href="text00022.html#ch11lev3sec2">Making the Birthdays Table View Controller Conform to Protocol</a>
 ” on <a href="text00022.html#page_168">page 168</a>
 .</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>Remember that the final versions of the project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>.</em>
</p>
</div>
<p class="indent">The <span class="code">BirthdaysTableViewController</span>
 will also need a <span class="code">dateFormatter</span>
 property to display the birthdate as a nicely formatted string. Add a <span class="code">dateFormatter</span>
 right underneath the <span class="code">birthdays</span>
 array:</p>
<div class="box">
<pre>    <span class="ash">var birthdays = [Birthday]()</span>
<br />
<br />
    <span class="pink">let</span>
 dateFormatter = <span class="violet">DateFormatter</span>
 ()<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent">Note that the <span class="code">dateFormatter</span>
 is a constant that is created with <span class="code">let</span>
 . Even though you’ll change the <span class="code">dateFormatter</span>
 ’s properties, like the <span class="code">dateStyle</span>
 and <span class="code">timeStyle</span>
 , you’ll never change the <span class="code">dateFormatter</span>
 itself.</p>
<p class="indent"><span id="page_162"></span>
 You’ll also need to set up the <span class="code">dateFormatter</span>
 so that it will display the birthdates as fully formatted strings like <span class="code">"Tuesday, December 17, 2008"</span>
 . As you saw in <a href="text00021.html#ch10">Chapter 10</a>
 , a good place to do this is the <span class="code">viewDidLoad()</span>
 method, which is called when the Birthdays table view controller is loading its view. This is the perfect place to do any setup that is needed for this class.</p>
<div class="box">
<pre>
<span class="ash">override func viewDidLoad() {</span>
<br />
    <span class="ash">super.viewDidLoad()</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">dateFormatter</span>
 .<span class="violet">dateStyle</span>
 = .<span class="blue">full</span>
<br />
  <span class="ent">➋</span>
 <span class="green1">dateFormatter</span>
 .<span class="violet">timeStyle</span>
 = .<span class="blue">none</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , you set the <span class="code">dateStyle</span>
 of the <span class="code">dateFormatter</span>
 so that it will display a formatted date string for each <span class="code">Birthday</span>
 . Did you notice how we just wrote <span class="code">.full</span>
 instead of <span class="code">DateFormatter.Style.full</span>
 ? Swift knows what type to expect for the <span class="code">dateStyle</span>
 of a <span class="code">DateFormatter</span>
 , so it lets us take this little shortcut. At <span class="ent">➋</span>
 , you set the <span class="code">timeStyle</span>
 of the <span class="code">dateFormatter</span>
 to <span class="code">.none</span>
 so that the time won’t be shown.</p>
<h4 class="h4" id="ch11lev2sec4">
<strong>DISPLAYING BIRTHDAYS IN A TABLE VIEW</strong>
</h4>
<p class="noindent">The <span class="code">BirthdaysTableViewController</span>
 class has a table view that is used to display a list of items in a single column. The table view has one or more sections containing rows, and each row contains a cell. A section in a table view is a grouping of rows that can be displayed with or without a header. An example of an app that shows a table view with several sections is the Settings app, as shown in <a href="text00022.html#ch11fig5">Figure 11-5</a>
 . It displays a list of rows that have been broken up into different sections.</p>
<p class="indent">Each section and row of a table view is identified with an index number. These numbers start at 0 and then increase by 1 as you go down the table view. For example, the Privacy line in the Settings app is found at section 0, row 1. The News setting is at section 1, row 3.</p>
<p class="indent">In the middle of the <span class="code">BirthdaysTableViewController</span>
 class, there is a section called <em>Table view data source</em>
 with three methods. The table view controller uses these methods to determine what’s going to be displayed inside its table view.</p>
<p class="hang">
<span class="code">
<span class="codestrong">numberOfSections(in:)</span>
</span>
 Tells the table view how many sections it should have</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:numberOfRowsInSection:)</span>
</span>
 Tells the table view how many rows will be displayed in each section</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:cellForRowAt:)</span>
</span>
 Sets up each cell that’s going to be displayed in each row of the table view</p>
<div class="image"><span id="page_163"></span>
 <img src="Image00243.jpg" />
</div>
<p class="figcap"><a id="ch11fig5"></a>
 <em>Figure 11-5: The Settings app uses sections to group rows of different device settings.</em>
</p>
<p class="indent">The table view data source methods are called by the table view controller every time the table view is reloaded. Xcode automatically gives you these method templates when you make a subclass of a <span class="code">UITableViewController</span>
 . You need to implement all three methods for the app to work, even though you’ll never call them directly in your code. The <span class="code">UITableViewController</span>
 class implements the <span class="code">UITableViewDataSource</span>
 protocol, which comes with these data source methods, to determine what will be displayed inside the table view. We’ll discuss protocols in “<a href="text00022.html#ch11lev2sec5">Delegation</a>
 ” on page 166. For now, you just need to know that a <span class="code">UITableViewController</span>
 uses these methods to display its content, and it automatically calls these methods so you don’t need to call them.</p>
<p class="indent">Let’s start with the method <span class="code">numberOfSections(in:)</span>
 . The Birthdays table view controller is a list that just displays <span class="code">Birthday</span>
 instances, so it doesn’t need multiple sections. To set the number of sections in the table view, we just need to return <span class="code">1</span>
 .</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func numberOfSections(in tableView: UITableView) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 <span class="blue1">1</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent"><span id="page_164"></span>
 This method takes a <span class="code">UITableView</span>
 called <span class="code">tableView</span>
 as a parameter, which is the table view that uses this class as its data source. We don’t need to worry about making this connection because the <span class="code">UITableViewController</span>
 comes with a built-in table view that is automatically hooked up to these methods. Each birthday will be displayed in its own row. So in <span class="code">tableView(_:numberOfRowsInSection:)</span>
 , in order to have the right number of rows for all of your birthdays, you need to return the number of <span class="code">Birthday</span>
 instances that you have in your <span class="code">birthdays</span>
 array. Do you remember the <span class="code">count</span>
 property of an array? It’s an integer that tells you how many items are in that array, and it’s perfect for this situation! Change this method to the following:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, <img class="inline" src="Image00184.jpg" />
<br />
    numberOfRowsInSection section: Int) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 birthdays.<span class="violet">count</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">In addition to the <span class="code">tableView</span>
 parameter, <span class="code">tableView(_:numberOfRowsInSection:)</span>
 also takes an <span class="code">Int</span>
 called <span class="code">section</span>
 . When the table view is loading itself, this method is called for each section in the table view. In our case, we have only one section, so we don’t need to bother checking which <span class="code">section</span>
 of the table view is being displayed here. We know it’s section 0, and we want it to have as many rows as there are birthdays, so we write <span class="code">return birthdays.count</span>
 .</p>
<p class="indent">Finally, you need to implement <span class="code">tableView(_:cellForRowAt:)</span>
 so that the table view will know what to put inside each cell. Since this method is commented out, you need to uncomment it by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it. (Be careful not to accidentally uncomment the other methods after it!) After you’ve done that, change it to the following code:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, cellForRowAt <img class="inline" src="Image00184.jpg" />
<br />
    indexPath: IndexPath) -&gt; UITableViewCell {</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="pink">let</span>
 cell = tableView.<span class="blue">dequeueReusableCell</span>
 (withIdentifier: <img class="inline" src="Image00093.jpg" />
<br />
        <span class="red">"birthdayCellIdentifier"</span>
 , for: indexPath)<br />
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 birthday = <span class="green1">birthdays</span>
 [indexPath.<span class="violet">row</span>
 ]<br />
<br />
  <span class="ent">➌</span>
 cell.<span class="violet">textLabel</span>
 ?.<span class="violet">text</span>
 = birthday.<span class="green1">firstName</span>
 <span class="blue">+</span>
 <span class="red">" "</span>
 <span class="blue">+</span>
 <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">lastName</span>
<br />
<br />
  <span class="ent">➍</span>
 cell.<span class="violet">detailTextLabel</span>
 ?.<span class="violet">text</span>
 = <span class="green1">dateFormatter</span>
 .<span class="blue">string</span>
 (from: <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">birthdate</span>
 )<br />
<br />
  <span class="ent">➎</span>
 <span class="pink">return</span>
 cell<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">You don’t call the method <span class="code">tableView(_:cellForRowAt:)</span>
 . It’s called when the table view is loaded onto the screen. It’s called for each cell on the screen and takes two parameters, <span class="code">tableView</span>
 and <span class="code">indexPath</span>
 . You already know <span id="page_165"></span>
 what the <span class="code">tableView</span>
 parameter is for. An <span class="code">IndexPath</span>
 is a Swift struct that’s used to represent a row’s position in a table view. An <span class="code">IndexPath</span>
 instance has a <span class="code">section</span>
 property and a <span class="code">row</span>
 property. Since this method will be called many times (once for every row in the table), we need the <span class="code">indexPath</span>
 to know which section and row we’re currently configuring. The <span class="code">indexPath.section</span>
 property gives the section number, and the <span class="code">indexPath.row</span>
 gives the row of the table view cell. The five lines of code inside <span class="code">tableView(_:cellForRowAt:)</span>
 will do the following:</p>
<div class="image"><img src="Image00244.jpg" />
</div>
<p class="bull">• Create a <span class="code">UITableViewCell</span>
</p>
<p class="bull">• Figure out which <span class="code">Birthday</span>
 in the <span class="code">birthdays</span>
 array will be displayed inside the cell</p>
<p class="bull">• Make two labels to display the birthday person’s name and birthdate in the cell</p>
<p class="bull">• Return the cell ready for display in the table view</p>
<p class="indentt">Let’s go through this code line by line.</p>
<p class="indent">First, create the <span class="code">UITableViewCell</span>
 . The code at <span class="ent">➊</span>
 does this using the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 . Before you can start using this method on a cell, though, you need to tell the method which cell you want to use from the storyboard. Earlier, when you were in the storyboard, you gave your cell the identifier <span class="code">birthdayCellIdentifier</span>
 (see <a href="text00022.html#ch11fig4">Figure 11-4</a>
 ). This identifier links your code to the cell and tells your method that it’s using the right cell. The string for when you call this method needs to be exactly the same as the string you set in the storyboard, or you’ll get an error and the app will crash when you run it.</p>
<p class="indent">In the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 , did you notice the words <em>Reusable Cell</em>
 ? The cells inside a table view are created once and then can be reused over and over. This helps everything run faster and smoother because creating the cell is what takes the most time. If you had 200 birthdays in your app, but only 10 would fit on your screen at one time, then you need only 10 cells to show your birthdays. When you scroll down to reveal more birthdays, the cells that scroll off the top of the screen are reused. They are filled with new information and show up again at the bottom of the screen. The <span class="code">UITableView</span>
 automatically does this work. When the table view is loaded, <span class="code">tableView(_:cellForRowAt:)</span>
 is called for every visible row. When the user scrolls to look at more cells, it’s called again for each row just as it is about to appear on the screen.</p>
<p class="indent">Next, we need to find out which <span class="code">Birthday</span>
 should be displayed inside the cell. We want to display one birthday from the <span class="code">birthdays</span>
 array in each row. The first birthday, which is at <span class="code">birthdays[0]</span>
 , should be displayed in row 0. The second birthday, at <span class="code">birthdays[1]</span>
 , should be displayed in row 1, and so on, which means the <span class="code">indexPath</span>
 ’s <span class="code">row</span>
 is the same as the position in the <span class="code">birthdays</span>
 array that we want to access. The code at <span class="ent">➋</span>
 accesses the <span id="page_166"></span>
 correct <span class="code">Birthday</span>
 object from the <span class="code">birthdays</span>
 array by using <span class="code">indexPath.row</span>
 . Once we have the right <span class="code">Birthday</span>
 object, we assign it to a constant named <span class="code">birthday</span>
 so we can set up the labels in this cell.</p>
<p class="indent">Notice that we’re using <span class="code">let</span>
 to assign the <span class="code">birthday</span>
 to a constant instead of a variable. We can use <span class="code">let</span>
 because each time <span class="code">tableView(_:cellForRowAt:)</span>
 is called, a new <span class="code">birthday</span>
 constant is created. Each cell gets its own <span class="code">birthday</span>
 constant that is assigned its own <span class="code">Birthday</span>
 object. Since we’re not going to change any of the <span class="code">birthday</span>
 constants—we’re just going to read their properties—we don’t want to make them variables.</p>
<p class="indent">Now that you have your cell and your birthday, it’s time to fill in the details. You need two labels for each cell to show the birthday person’s name and birthdate. You set the cell to the Subtitle style so that it has a Title label and a Subtitle label. Each cell will already contain these labels, so now you don’t have to create any labels yourself.</p>
<p class="indent">The labels exist as properties of <span class="code">UITableViewCell</span>
 and are called <span class="code">textLabel</span>
 and <span class="code">detailTextLabel</span>
 . The code at <span class="ent">➌</span>
 sets the text of the <span class="code">textLabel</span>
 to a string made up of the <span class="code">firstName</span>
 and <span class="code">lastName</span>
 of the <span class="code">birthday</span>
 with a space between them. At <span class="ent">➍</span>
 , you use the <span class="code">string(from:)</span>
 method of the <span class="code">dateFormatter</span>
 to display the birthdate in the <span class="code">detailTextLabel</span>
 .</p>
<p class="indent">When your cell is completely configured, <span class="code">tableView( _:cellForRowAt:)</span>
 returns the cell at <span class="ent">➎</span>
 so that it can be displayed at that <span class="code">indexPath</span>
 of the table view.</p>
<h3 class="h3" id="ch11lev1sec2">
<strong>PUTTING IT ALL TOGETHER</strong>
</h3>
<p class="noindent">Now you can add <span class="code">Birthday</span>
 instances to the app using the Add Birthday view controller, and you have a table view to list each <span class="code">Birthday</span>
 in the Birthdays table view controller. But when you try running the app and adding a <span class="code">Birthday</span>
 , it doesn’t appear. To make each <span class="code">Birthday</span>
 you add appear in the table view, you need to make the Add Birthday view controller communicate with the Birthdays table view controller. You do this by using <em>delegation</em>
 .</p>
<h4 class="h4" id="ch11lev2sec5">
<strong>DELEGATION</strong>
</h4>
<p class="noindent">Delegation can be used when one view controller needs to get information from another view controller. Say you have two view controllers: A and B. The first view controller, A, creates B and presents B on top of itself. A knows about B because it created and presented B, so A can pass information along to B. But B doesn’t know about A—it’s just popped into being and doesn’t know where it came from or how it got there. So how can B talk to A? Through delegation!</p>
<div class="image"><img src="Image00245.jpg" />
</div>
<p class="indent">Delegation is when someone gives a job or a task to someone else. A <em>delegate</em>
 is like a boss who tells a delegating employee what to do. When the delegating employee is done with their task, sometimes they’ll report information back to the delegate boss.</p>
<p class="indent"><span id="page_167"></span>
 Delegation in Swift is pretty similar, but instead of having a boss and employee, we have a delegate and a delegating object. Since class B is the one being told what to do by class A, it’s the delegating object. We give class B a special property called a delegate to tell it who its delegate is—that way, it knows who to communicate with. The delegate can be any class that has a set of methods that have been defined in a <em>protocol</em>
 . A protocol is like an agreement between the two classes that tells them what the delegate can ask the delegating object to do. It has a list of method and property names that the delegate can use with the delegating object.</p>
<p class="indent">Class A creates class B, makes itself the delegate of class B, and gives class B a job to do that’s in the protocol. Once class B is done with its job, it reports back to class A. Let’s see how this works in our app.</p>
<p class="indent">The Birthdays table view controller is view controller A, and the Add Birthday view controller is view controller B. We’ll create a protocol called <span class="code">AddBirthdayViewControllerDelegate</span>
 and a method for that protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 , which the Add Birthday view controller will use to report back.</p>
<p class="indent">Take a look at <a href="text00022.html#ch11fig6">Figure 11-6</a>
 . When the user taps the Add button <span class="ent">➊</span>
 , the Birthdays table view controller creates the Add Birthday view controller <span class="ent">➋</span>
 and sets itself as the Add Birthday view controller’s delegate.</p>
<div class="image"><img src="Image00246.jpg" />
</div>
<p class="figcap"><a id="ch11fig6"></a>
 <em>Figure 11-6: A new birthday is added and passed from the Add Birthday view controller to the Birthdays table view controller using delegation.</em>
</p>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="indent"><span id="page_159"></span>
 Next, open the Attributes Inspector. Using the drop-down menu under <strong>Style</strong>
 , set the cell’s style to <strong>Subtitle</strong>
 <span class="ent">➋</span>
 so that the cell now has a Title label and a Subtitle label. You’ll display each person’s name in the Title and birthday in the Subtitle.</p>
<p class="indent">Finally, enter <span class="code">
<span class="codestrong">birthdayCellIdentifier</span>
</span>
 in the Identifier field <span class="ent">➌</span>
 . You’ll use this identifier later when you fill in the cell contents.</p>
<p class="indent">That’s it! You’ve finished your work in the storyboard.</p>
<p class="indent">You may be wondering why we have just one cell in our table view in the storyboard when we’ll have more than one birthday to show in the list. If you look at <a href="text00022.html#ch11fig4">Figure 11-4</a>
 again, you’ll notice that the cell is labeled <em>Prototype Cells</em>
 . This means that the cell you just customized is a <em>template</em>
 for all the cells you want to appear in your table view. The identifier you gave the cell is how your code will tell the table view to produce each cell for you to put birthdays in. You’ll see how this works soon.</p>
<div class="box1">
<p class="box-title">
<strong>WORKING WITH DATES</strong>
</p>
<p class="box-p">Swift has a special data type called <span class="code">Date</span>
 that is used for storing date values. A <span class="code">Date</span>
 object is actually a date and a time. Open your playground and enter the following:</p>
<div class="image"><img src="Image00239.jpg" />
</div>
<p class="box-pi">We’ve just assigned the current date and time the code was run to the variable <span class="code">today</span>
 . When you print <span class="code">today</span>
 , it’s in the format <span class="code">"2017-11-21 10:45:31 +0000\n"</span>
 . What if you wanted it to display as <span class="code">Tuesday, November 21, 2017</span>
 , instead? Or just <span class="code">11/21/17</span>
 ? To display a date in a particular way, you use a <em>date formatter</em>
 , which is a <span class="code">DateFormatter</span>
 object that you create and give a date format style. <span class="code">DateFormatter</span>
 is a helper object that is used to create a display string from any date, and a <em>date format style</em>
 is a property of <span class="code">DateFormatter</span>
 that tells the formatter what style to use. You can create your own date format styles manually, but there are also styles that are included in Swift and ready to use. Add the following to your playground:</p>
<div class="image"><img src="Image00240.jpg" />
</div>
<p class="box-pi">At <span class="ent">➊</span>
 you create a <span class="code">formatter</span>
 . Then at <span class="ent">➋</span>
 , you set the style of the <span class="code">formatter</span>
 to <span class="code">Style.full</span>
 , which will print the day of the week as well as the full month name, date, and year. Finally, you create a string from the date using the <span class="code">string(from:)</span>
 method of the <span class="code">DateFormatter</span>
 class <span class="ent">➌</span>
 . You can see that you now have turned the <span id="page_160"></span>
 date into the nicely formatted string <span class="code">"Tuesday, November 21, 2017"</span>
 . <a style=";color:black;" href="text00022.html#ch11tab1">Table 11-1</a>
 shows the different strings that are created from the five <span class="code">DateFormatter.Style</span>
 options available in Swift.</p>
<p class="tabcap"><a id="ch11tab1" style=";color:black;"></a>
 <strong>Table 11-1:</strong>
 Date Formatter Styles and Their Date Strings</p>
<table class="tabled">
<tbody>
<tr>
<td style="vertical-align: top;" class="border1">
<p class="noindent">
<span class="code">
<span class="codestrong">DateFormatter.Style</span>
</span>
</p>
</td>
<td style="vertical-align: top;" class="border1">
<p class="noindent">
<strong>Date string</strong>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">none</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">""</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">short</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"11/21/17"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">medium</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"Nov 21, 2017"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">long</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"November 21, 2017"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">full</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"Tuesday, November 21, 2017"</span>
</p>
</td>
</tr>
</tbody>
</table>
<p class="box-pi">You can also specify your own custom way of displaying a date using the <span class="code">dateFormat</span>
 property of the <span class="code">DateFormatter</span>
 . Perhaps you only want the month and day. Or maybe you want a four-digit year displayed in the <span class="code">short</span>
 style. Doing either is really easy, and you don’t even have to create a new <span class="code">DateFormatter</span>
 —you can just change the <span class="code">dateFormat</span>
 on <span class="code">formatter</span>
 and then ask it for a new string. Add the following code to your playground to display dates with a specific format:</p>
<div class="image"><img src="Image00241.jpg" />
</div>
<p class="box-pi">At <span class="ent">➊</span>
 , you specify that you only want the month and the date in an <span class="code">MM/dd</span>
 format—that is, a two-digit month followed by a two-digit date. If you want to display the month as three letters, then use <span class="code">MMM</span>
 . To display the full name of the month, use <span class="code">MMMM</span>
 . At <span class="ent">➋</span>
 , we change the date format to use a four-digit year. A two-digit year would be <span class="code">yy</span>
 . Here are a few other ways to use a <span class="code">dateFormat</span>
 to display a custom date string.</p>
<div class="image"><img src="Image00242.jpg" />
</div>
<p class="box-pi"><span id="page_161"></span>
 If you want to include separators, you add them to your <span class="code">dateFormat</span>
 string. For example, if you want periods as separators, then you can create a <span class="code">dateFormat</span>
 like <span class="code">"MM.dd.yy"</span>
 <span class="ent">➊</span>
 . To display an abbreviated day of the week, use <span class="code">EEE</span>
 <span class="ent">➋</span>
 . For the full day, use <span class="code">EEEE</span>
 <span class="ent">➌</span>
 . These are only a few examples. By using combinations of <span class="code">M</span>
 , <span class="code">d</span>
 , <span class="code">y</span>
 , and <span class="code">E</span>
 , you have an endless number of ways to display a date!</p>
</div>
<h4 class="h4" id="ch11lev2sec3">
<strong>SETTING UP THE BIRTHDAYS TABLE VIEW CONTROLLER</strong>
</h4>
<p class="noindent">The Birthdays table view controller will display a list of all the birthdays stored in the app. Do you remember what you use to store a list of items? That’s right—an array! You’ll create an array in the <span class="code">BirthdaysTableViewController</span>
 to store all the birthdays. To do this, give the <span class="code">BirthdaysTableViewController</span>
 a <span class="code">birthdays</span>
 property that is an array of <span class="code">Birthday</span>
 objects. At the top of the class, right above the <span class="code">viewDidLoad()</span>
 method, insert this line to add a variable array property called <span class="code">birthdays</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController {</span>
<br />
<br />
    <span class="pink">var</span>
 birthdays = [<span class="green1">Birthday</span>
 ]()<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent">This line creates an empty array of <span class="code">Birthday</span>
 instances. It needs to be a variable and not a constant because you’ll want to add a saved <span class="code">Birthday</span>
 to this array every time the user adds a <span class="code">Birthday</span>
 with the Add Birthday view controller. You’ll see how to do that in “<a href="text00022.html#ch11lev3sec2">Making the Birthdays Table View Controller Conform to Protocol</a>
 ” on <a href="text00022.html#page_168">page 168</a>
 .</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>Remember that the final versions of the project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>.</em>
</p>
</div>
<p class="indent">The <span class="code">BirthdaysTableViewController</span>
 will also need a <span class="code">dateFormatter</span>
 property to display the birthdate as a nicely formatted string. Add a <span class="code">dateFormatter</span>
 right underneath the <span class="code">birthdays</span>
 array:</p>
<div class="box">
<pre>    <span class="ash">var birthdays = [Birthday]()</span>
<br />
<br />
    <span class="pink">let</span>
 dateFormatter = <span class="violet">DateFormatter</span>
 ()<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent">Note that the <span class="code">dateFormatter</span>
 is a constant that is created with <span class="code">let</span>
 . Even though you’ll change the <span class="code">dateFormatter</span>
 ’s properties, like the <span class="code">dateStyle</span>
 and <span class="code">timeStyle</span>
 , you’ll never change the <span class="code">dateFormatter</span>
 itself.</p>
<p class="indent"><span id="page_162"></span>
 You’ll also need to set up the <span class="code">dateFormatter</span>
 so that it will display the birthdates as fully formatted strings like <span class="code">"Tuesday, December 17, 2008"</span>
 . As you saw in <a href="text00021.html#ch10">Chapter 10</a>
 , a good place to do this is the <span class="code">viewDidLoad()</span>
 method, which is called when the Birthdays table view controller is loading its view. This is the perfect place to do any setup that is needed for this class.</p>
<div class="box">
<pre>
<span class="ash">override func viewDidLoad() {</span>
<br />
    <span class="ash">super.viewDidLoad()</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">dateFormatter</span>
 .<span class="violet">dateStyle</span>
 = .<span class="blue">full</span>
<br />
  <span class="ent">➋</span>
 <span class="green1">dateFormatter</span>
 .<span class="violet">timeStyle</span>
 = .<span class="blue">none</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , you set the <span class="code">dateStyle</span>
 of the <span class="code">dateFormatter</span>
 so that it will display a formatted date string for each <span class="code">Birthday</span>
 . Did you notice how we just wrote <span class="code">.full</span>
 instead of <span class="code">DateFormatter.Style.full</span>
 ? Swift knows what type to expect for the <span class="code">dateStyle</span>
 of a <span class="code">DateFormatter</span>
 , so it lets us take this little shortcut. At <span class="ent">➋</span>
 , you set the <span class="code">timeStyle</span>
 of the <span class="code">dateFormatter</span>
 to <span class="code">.none</span>
 so that the time won’t be shown.</p>
<h4 class="h4" id="ch11lev2sec4">
<strong>DISPLAYING BIRTHDAYS IN A TABLE VIEW</strong>
</h4>
<p class="noindent">The <span class="code">BirthdaysTableViewController</span>
 class has a table view that is used to display a list of items in a single column. The table view has one or more sections containing rows, and each row contains a cell. A section in a table view is a grouping of rows that can be displayed with or without a header. An example of an app that shows a table view with several sections is the Settings app, as shown in <a href="text00022.html#ch11fig5">Figure 11-5</a>
 . It displays a list of rows that have been broken up into different sections.</p>
<p class="indent">Each section and row of a table view is identified with an index number. These numbers start at 0 and then increase by 1 as you go down the table view. For example, the Privacy line in the Settings app is found at section 0, row 1. The News setting is at section 1, row 3.</p>
<p class="indent">In the middle of the <span class="code">BirthdaysTableViewController</span>
 class, there is a section called <em>Table view data source</em>
 with three methods. The table view controller uses these methods to determine what’s going to be displayed inside its table view.</p>
<p class="hang">
<span class="code">
<span class="codestrong">numberOfSections(in:)</span>
</span>
 Tells the table view how many sections it should have</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:numberOfRowsInSection:)</span>
</span>
 Tells the table view how many rows will be displayed in each section</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:cellForRowAt:)</span>
</span>
 Sets up each cell that’s going to be displayed in each row of the table view</p>
<div class="image"><span id="page_163"></span>
 <img src="Image00243.jpg" />
</div>
<p class="figcap"><a id="ch11fig5"></a>
 <em>Figure 11-5: The Settings app uses sections to group rows of different device settings.</em>
</p>
<p class="indent">The table view data source methods are called by the table view controller every time the table view is reloaded. Xcode automatically gives you these method templates when you make a subclass of a <span class="code">UITableViewController</span>
 . You need to implement all three methods for the app to work, even though you’ll never call them directly in your code. The <span class="code">UITableViewController</span>
 class implements the <span class="code">UITableViewDataSource</span>
 protocol, which comes with these data source methods, to determine what will be displayed inside the table view. We’ll discuss protocols in “<a href="text00022.html#ch11lev2sec5">Delegation</a>
 ” on page 166. For now, you just need to know that a <span class="code">UITableViewController</span>
 uses these methods to display its content, and it automatically calls these methods so you don’t need to call them.</p>
<p class="indent">Let’s start with the method <span class="code">numberOfSections(in:)</span>
 . The Birthdays table view controller is a list that just displays <span class="code">Birthday</span>
 instances, so it doesn’t need multiple sections. To set the number of sections in the table view, we just need to return <span class="code">1</span>
 .</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func numberOfSections(in tableView: UITableView) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 <span class="blue1">1</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent"><span id="page_164"></span>
 This method takes a <span class="code">UITableView</span>
 called <span class="code">tableView</span>
 as a parameter, which is the table view that uses this class as its data source. We don’t need to worry about making this connection because the <span class="code">UITableViewController</span>
 comes with a built-in table view that is automatically hooked up to these methods. Each birthday will be displayed in its own row. So in <span class="code">tableView(_:numberOfRowsInSection:)</span>
 , in order to have the right number of rows for all of your birthdays, you need to return the number of <span class="code">Birthday</span>
 instances that you have in your <span class="code">birthdays</span>
 array. Do you remember the <span class="code">count</span>
 property of an array? It’s an integer that tells you how many items are in that array, and it’s perfect for this situation! Change this method to the following:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, <img class="inline" src="Image00184.jpg" />
<br />
    numberOfRowsInSection section: Int) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 birthdays.<span class="violet">count</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">In addition to the <span class="code">tableView</span>
 parameter, <span class="code">tableView(_:numberOfRowsInSection:)</span>
 also takes an <span class="code">Int</span>
 called <span class="code">section</span>
 . When the table view is loading itself, this method is called for each section in the table view. In our case, we have only one section, so we don’t need to bother checking which <span class="code">section</span>
 of the table view is being displayed here. We know it’s section 0, and we want it to have as many rows as there are birthdays, so we write <span class="code">return birthdays.count</span>
 .</p>
<p class="indent">Finally, you need to implement <span class="code">tableView(_:cellForRowAt:)</span>
 so that the table view will know what to put inside each cell. Since this method is commented out, you need to uncomment it by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it. (Be careful not to accidentally uncomment the other methods after it!) After you’ve done that, change it to the following code:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, cellForRowAt <img class="inline" src="Image00184.jpg" />
<br />
    indexPath: IndexPath) -&gt; UITableViewCell {</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="pink">let</span>
 cell = tableView.<span class="blue">dequeueReusableCell</span>
 (withIdentifier: <img class="inline" src="Image00093.jpg" />
<br />
        <span class="red">"birthdayCellIdentifier"</span>
 , for: indexPath)<br />
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 birthday = <span class="green1">birthdays</span>
 [indexPath.<span class="violet">row</span>
 ]<br />
<br />
  <span class="ent">➌</span>
 cell.<span class="violet">textLabel</span>
 ?.<span class="violet">text</span>
 = birthday.<span class="green1">firstName</span>
 <span class="blue">+</span>
 <span class="red">" "</span>
 <span class="blue">+</span>
 <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">lastName</span>
<br />
<br />
  <span class="ent">➍</span>
 cell.<span class="violet">detailTextLabel</span>
 ?.<span class="violet">text</span>
 = <span class="green1">dateFormatter</span>
 .<span class="blue">string</span>
 (from: <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">birthdate</span>
 )<br />
<br />
  <span class="ent">➎</span>
 <span class="pink">return</span>
 cell<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">You don’t call the method <span class="code">tableView(_:cellForRowAt:)</span>
 . It’s called when the table view is loaded onto the screen. It’s called for each cell on the screen and takes two parameters, <span class="code">tableView</span>
 and <span class="code">indexPath</span>
 . You already know <span id="page_165"></span>
 what the <span class="code">tableView</span>
 parameter is for. An <span class="code">IndexPath</span>
 is a Swift struct that’s used to represent a row’s position in a table view. An <span class="code">IndexPath</span>
 instance has a <span class="code">section</span>
 property and a <span class="code">row</span>
 property. Since this method will be called many times (once for every row in the table), we need the <span class="code">indexPath</span>
 to know which section and row we’re currently configuring. The <span class="code">indexPath.section</span>
 property gives the section number, and the <span class="code">indexPath.row</span>
 gives the row of the table view cell. The five lines of code inside <span class="code">tableView(_:cellForRowAt:)</span>
 will do the following:</p>
<div class="image"><img src="Image00244.jpg" />
</div>
<p class="bull">• Create a <span class="code">UITableViewCell</span>
</p>
<p class="bull">• Figure out which <span class="code">Birthday</span>
 in the <span class="code">birthdays</span>
 array will be displayed inside the cell</p>
<p class="bull">• Make two labels to display the birthday person’s name and birthdate in the cell</p>
<p class="bull">• Return the cell ready for display in the table view</p>
<p class="indentt">Let’s go through this code line by line.</p>
<p class="indent">First, create the <span class="code">UITableViewCell</span>
 . The code at <span class="ent">➊</span>
 does this using the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 . Before you can start using this method on a cell, though, you need to tell the method which cell you want to use from the storyboard. Earlier, when you were in the storyboard, you gave your cell the identifier <span class="code">birthdayCellIdentifier</span>
 (see <a href="text00022.html#ch11fig4">Figure 11-4</a>
 ). This identifier links your code to the cell and tells your method that it’s using the right cell. The string for when you call this method needs to be exactly the same as the string you set in the storyboard, or you’ll get an error and the app will crash when you run it.</p>
<p class="indent">In the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 , did you notice the words <em>Reusable Cell</em>
 ? The cells inside a table view are created once and then can be reused over and over. This helps everything run faster and smoother because creating the cell is what takes the most time. If you had 200 birthdays in your app, but only 10 would fit on your screen at one time, then you need only 10 cells to show your birthdays. When you scroll down to reveal more birthdays, the cells that scroll off the top of the screen are reused. They are filled with new information and show up again at the bottom of the screen. The <span class="code">UITableView</span>
 automatically does this work. When the table view is loaded, <span class="code">tableView(_:cellForRowAt:)</span>
 is called for every visible row. When the user scrolls to look at more cells, it’s called again for each row just as it is about to appear on the screen.</p>
<p class="indent">Next, we need to find out which <span class="code">Birthday</span>
 should be displayed inside the cell. We want to display one birthday from the <span class="code">birthdays</span>
 array in each row. The first birthday, which is at <span class="code">birthdays[0]</span>
 , should be displayed in row 0. The second birthday, at <span class="code">birthdays[1]</span>
 , should be displayed in row 1, and so on, which means the <span class="code">indexPath</span>
 ’s <span class="code">row</span>
 is the same as the position in the <span class="code">birthdays</span>
 array that we want to access. The code at <span class="ent">➋</span>
 accesses the <span id="page_166"></span>
 correct <span class="code">Birthday</span>
 object from the <span class="code">birthdays</span>
 array by using <span class="code">indexPath.row</span>
 . Once we have the right <span class="code">Birthday</span>
 object, we assign it to a constant named <span class="code">birthday</span>
 so we can set up the labels in this cell.</p>
<p class="indent">Notice that we’re using <span class="code">let</span>
 to assign the <span class="code">birthday</span>
 to a constant instead of a variable. We can use <span class="code">let</span>
 because each time <span class="code">tableView(_:cellForRowAt:)</span>
 is called, a new <span class="code">birthday</span>
 constant is created. Each cell gets its own <span class="code">birthday</span>
 constant that is assigned its own <span class="code">Birthday</span>
 object. Since we’re not going to change any of the <span class="code">birthday</span>
 constants—we’re just going to read their properties—we don’t want to make them variables.</p>
<p class="indent">Now that you have your cell and your birthday, it’s time to fill in the details. You need two labels for each cell to show the birthday person’s name and birthdate. You set the cell to the Subtitle style so that it has a Title label and a Subtitle label. Each cell will already contain these labels, so now you don’t have to create any labels yourself.</p>
<p class="indent">The labels exist as properties of <span class="code">UITableViewCell</span>
 and are called <span class="code">textLabel</span>
 and <span class="code">detailTextLabel</span>
 . The code at <span class="ent">➌</span>
 sets the text of the <span class="code">textLabel</span>
 to a string made up of the <span class="code">firstName</span>
 and <span class="code">lastName</span>
 of the <span class="code">birthday</span>
 with a space between them. At <span class="ent">➍</span>
 , you use the <span class="code">string(from:)</span>
 method of the <span class="code">dateFormatter</span>
 to display the birthdate in the <span class="code">detailTextLabel</span>
 .</p>
<p class="indent">When your cell is completely configured, <span class="code">tableView( _:cellForRowAt:)</span>
 returns the cell at <span class="ent">➎</span>
 so that it can be displayed at that <span class="code">indexPath</span>
 of the table view.</p>
<h3 class="h3" id="ch11lev1sec2">
<strong>PUTTING IT ALL TOGETHER</strong>
</h3>
<p class="noindent">Now you can add <span class="code">Birthday</span>
 instances to the app using the Add Birthday view controller, and you have a table view to list each <span class="code">Birthday</span>
 in the Birthdays table view controller. But when you try running the app and adding a <span class="code">Birthday</span>
 , it doesn’t appear. To make each <span class="code">Birthday</span>
 you add appear in the table view, you need to make the Add Birthday view controller communicate with the Birthdays table view controller. You do this by using <em>delegation</em>
 .</p>
<h4 class="h4" id="ch11lev2sec5">
<strong>DELEGATION</strong>
</h4>
<p class="noindent">Delegation can be used when one view controller needs to get information from another view controller. Say you have two view controllers: A and B. The first view controller, A, creates B and presents B on top of itself. A knows about B because it created and presented B, so A can pass information along to B. But B doesn’t know about A—it’s just popped into being and doesn’t know where it came from or how it got there. So how can B talk to A? Through delegation!</p>
<div class="image"><img src="Image00245.jpg" />
</div>
<p class="indent">Delegation is when someone gives a job or a task to someone else. A <em>delegate</em>
 is like a boss who tells a delegating employee what to do. When the delegating employee is done with their task, sometimes they’ll report information back to the delegate boss.</p>
<p class="indent"><span id="page_167"></span>
 Delegation in Swift is pretty similar, but instead of having a boss and employee, we have a delegate and a delegating object. Since class B is the one being told what to do by class A, it’s the delegating object. We give class B a special property called a delegate to tell it who its delegate is—that way, it knows who to communicate with. The delegate can be any class that has a set of methods that have been defined in a <em>protocol</em>
 . A protocol is like an agreement between the two classes that tells them what the delegate can ask the delegating object to do. It has a list of method and property names that the delegate can use with the delegating object.</p>
<p class="indent">Class A creates class B, makes itself the delegate of class B, and gives class B a job to do that’s in the protocol. Once class B is done with its job, it reports back to class A. Let’s see how this works in our app.</p>
<p class="indent">The Birthdays table view controller is view controller A, and the Add Birthday view controller is view controller B. We’ll create a protocol called <span class="code">AddBirthdayViewControllerDelegate</span>
 and a method for that protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 , which the Add Birthday view controller will use to report back.</p>
<p class="indent">Take a look at <a href="text00022.html#ch11fig6">Figure 11-6</a>
 . When the user taps the Add button <span class="ent">➊</span>
 , the Birthdays table view controller creates the Add Birthday view controller <span class="ent">➋</span>
 and sets itself as the Add Birthday view controller’s delegate.</p>
<div class="image"><img src="Image00246.jpg" />
</div>
<p class="figcap"><a id="ch11fig6"></a>
 <em>Figure 11-6: A new birthday is added and passed from the Add Birthday view controller to the Birthdays table view controller using delegation.</em>
</p>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="indent">Finally, enter <span class="code">
<span class="codestrong">birthdayCellIdentifier</span>
</span>
 in the Identifier field <span class="ent">➌</span>
 . You’ll use this identifier later when you fill in the cell contents.</p>
<p class="indent">That’s it! You’ve finished your work in the storyboard.</p>
<p class="indent">You may be wondering why we have just one cell in our table view in the storyboard when we’ll have more than one birthday to show in the list. If you look at <a href="text00022.html#ch11fig4">Figure 11-4</a>
 again, you’ll notice that the cell is labeled <em>Prototype Cells</em>
 . This means that the cell you just customized is a <em>template</em>
 for all the cells you want to appear in your table view. The identifier you gave the cell is how your code will tell the table view to produce each cell for you to put birthdays in. You’ll see how this works soon.</p>
<div class="box1">
<p class="box-title">
<strong>WORKING WITH DATES</strong>
</p>
<p class="box-p">Swift has a special data type called <span class="code">Date</span>
 that is used for storing date values. A <span class="code">Date</span>
 object is actually a date and a time. Open your playground and enter the following:</p>
<div class="image"><img src="Image00239.jpg" />
</div>
<p class="box-pi">We’ve just assigned the current date and time the code was run to the variable <span class="code">today</span>
 . When you print <span class="code">today</span>
 , it’s in the format <span class="code">"2017-11-21 10:45:31 +0000\n"</span>
 . What if you wanted it to display as <span class="code">Tuesday, November 21, 2017</span>
 , instead? Or just <span class="code">11/21/17</span>
 ? To display a date in a particular way, you use a <em>date formatter</em>
 , which is a <span class="code">DateFormatter</span>
 object that you create and give a date format style. <span class="code">DateFormatter</span>
 is a helper object that is used to create a display string from any date, and a <em>date format style</em>
 is a property of <span class="code">DateFormatter</span>
 that tells the formatter what style to use. You can create your own date format styles manually, but there are also styles that are included in Swift and ready to use. Add the following to your playground:</p>
<div class="image"><img src="Image00240.jpg" />
</div>
<p class="box-pi">At <span class="ent">➊</span>
 you create a <span class="code">formatter</span>
 . Then at <span class="ent">➋</span>
 , you set the style of the <span class="code">formatter</span>
 to <span class="code">Style.full</span>
 , which will print the day of the week as well as the full month name, date, and year. Finally, you create a string from the date using the <span class="code">string(from:)</span>
 method of the <span class="code">DateFormatter</span>
 class <span class="ent">➌</span>
 . You can see that you now have turned the <span id="page_160"></span>
 date into the nicely formatted string <span class="code">"Tuesday, November 21, 2017"</span>
 . <a style=";color:black;" href="text00022.html#ch11tab1">Table 11-1</a>
 shows the different strings that are created from the five <span class="code">DateFormatter.Style</span>
 options available in Swift.</p>
<p class="tabcap"><a id="ch11tab1" style=";color:black;"></a>
 <strong>Table 11-1:</strong>
 Date Formatter Styles and Their Date Strings</p>
<table class="tabled">
<tbody>
<tr>
<td style="vertical-align: top;" class="border1">
<p class="noindent">
<span class="code">
<span class="codestrong">DateFormatter.Style</span>
</span>
</p>
</td>
<td style="vertical-align: top;" class="border1">
<p class="noindent">
<strong>Date string</strong>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">none</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">""</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">short</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"11/21/17"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">medium</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"Nov 21, 2017"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">long</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"November 21, 2017"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">full</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"Tuesday, November 21, 2017"</span>
</p>
</td>
</tr>
</tbody>
</table>
<p class="box-pi">You can also specify your own custom way of displaying a date using the <span class="code">dateFormat</span>
 property of the <span class="code">DateFormatter</span>
 . Perhaps you only want the month and day. Or maybe you want a four-digit year displayed in the <span class="code">short</span>
 style. Doing either is really easy, and you don’t even have to create a new <span class="code">DateFormatter</span>
 —you can just change the <span class="code">dateFormat</span>
 on <span class="code">formatter</span>
 and then ask it for a new string. Add the following code to your playground to display dates with a specific format:</p>
<div class="image"><img src="Image00241.jpg" />
</div>
<p class="box-pi">At <span class="ent">➊</span>
 , you specify that you only want the month and the date in an <span class="code">MM/dd</span>
 format—that is, a two-digit month followed by a two-digit date. If you want to display the month as three letters, then use <span class="code">MMM</span>
 . To display the full name of the month, use <span class="code">MMMM</span>
 . At <span class="ent">➋</span>
 , we change the date format to use a four-digit year. A two-digit year would be <span class="code">yy</span>
 . Here are a few other ways to use a <span class="code">dateFormat</span>
 to display a custom date string.</p>
<div class="image"><img src="Image00242.jpg" />
</div>
<p class="box-pi"><span id="page_161"></span>
 If you want to include separators, you add them to your <span class="code">dateFormat</span>
 string. For example, if you want periods as separators, then you can create a <span class="code">dateFormat</span>
 like <span class="code">"MM.dd.yy"</span>
 <span class="ent">➊</span>
 . To display an abbreviated day of the week, use <span class="code">EEE</span>
 <span class="ent">➋</span>
 . For the full day, use <span class="code">EEEE</span>
 <span class="ent">➌</span>
 . These are only a few examples. By using combinations of <span class="code">M</span>
 , <span class="code">d</span>
 , <span class="code">y</span>
 , and <span class="code">E</span>
 , you have an endless number of ways to display a date!</p>
</div>
<h4 class="h4" id="ch11lev2sec3">
<strong>SETTING UP THE BIRTHDAYS TABLE VIEW CONTROLLER</strong>
</h4>
<p class="noindent">The Birthdays table view controller will display a list of all the birthdays stored in the app. Do you remember what you use to store a list of items? That’s right—an array! You’ll create an array in the <span class="code">BirthdaysTableViewController</span>
 to store all the birthdays. To do this, give the <span class="code">BirthdaysTableViewController</span>
 a <span class="code">birthdays</span>
 property that is an array of <span class="code">Birthday</span>
 objects. At the top of the class, right above the <span class="code">viewDidLoad()</span>
 method, insert this line to add a variable array property called <span class="code">birthdays</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController {</span>
<br />
<br />
    <span class="pink">var</span>
 birthdays = [<span class="green1">Birthday</span>
 ]()<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent">This line creates an empty array of <span class="code">Birthday</span>
 instances. It needs to be a variable and not a constant because you’ll want to add a saved <span class="code">Birthday</span>
 to this array every time the user adds a <span class="code">Birthday</span>
 with the Add Birthday view controller. You’ll see how to do that in “<a href="text00022.html#ch11lev3sec2">Making the Birthdays Table View Controller Conform to Protocol</a>
 ” on <a href="text00022.html#page_168">page 168</a>
 .</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>Remember that the final versions of the project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>.</em>
</p>
</div>
<p class="indent">The <span class="code">BirthdaysTableViewController</span>
 will also need a <span class="code">dateFormatter</span>
 property to display the birthdate as a nicely formatted string. Add a <span class="code">dateFormatter</span>
 right underneath the <span class="code">birthdays</span>
 array:</p>
<div class="box">
<pre>    <span class="ash">var birthdays = [Birthday]()</span>
<br />
<br />
    <span class="pink">let</span>
 dateFormatter = <span class="violet">DateFormatter</span>
 ()<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent">Note that the <span class="code">dateFormatter</span>
 is a constant that is created with <span class="code">let</span>
 . Even though you’ll change the <span class="code">dateFormatter</span>
 ’s properties, like the <span class="code">dateStyle</span>
 and <span class="code">timeStyle</span>
 , you’ll never change the <span class="code">dateFormatter</span>
 itself.</p>
<p class="indent"><span id="page_162"></span>
 You’ll also need to set up the <span class="code">dateFormatter</span>
 so that it will display the birthdates as fully formatted strings like <span class="code">"Tuesday, December 17, 2008"</span>
 . As you saw in <a href="text00021.html#ch10">Chapter 10</a>
 , a good place to do this is the <span class="code">viewDidLoad()</span>
 method, which is called when the Birthdays table view controller is loading its view. This is the perfect place to do any setup that is needed for this class.</p>
<div class="box">
<pre>
<span class="ash">override func viewDidLoad() {</span>
<br />
    <span class="ash">super.viewDidLoad()</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">dateFormatter</span>
 .<span class="violet">dateStyle</span>
 = .<span class="blue">full</span>
<br />
  <span class="ent">➋</span>
 <span class="green1">dateFormatter</span>
 .<span class="violet">timeStyle</span>
 = .<span class="blue">none</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , you set the <span class="code">dateStyle</span>
 of the <span class="code">dateFormatter</span>
 so that it will display a formatted date string for each <span class="code">Birthday</span>
 . Did you notice how we just wrote <span class="code">.full</span>
 instead of <span class="code">DateFormatter.Style.full</span>
 ? Swift knows what type to expect for the <span class="code">dateStyle</span>
 of a <span class="code">DateFormatter</span>
 , so it lets us take this little shortcut. At <span class="ent">➋</span>
 , you set the <span class="code">timeStyle</span>
 of the <span class="code">dateFormatter</span>
 to <span class="code">.none</span>
 so that the time won’t be shown.</p>
<h4 class="h4" id="ch11lev2sec4">
<strong>DISPLAYING BIRTHDAYS IN A TABLE VIEW</strong>
</h4>
<p class="noindent">The <span class="code">BirthdaysTableViewController</span>
 class has a table view that is used to display a list of items in a single column. The table view has one or more sections containing rows, and each row contains a cell. A section in a table view is a grouping of rows that can be displayed with or without a header. An example of an app that shows a table view with several sections is the Settings app, as shown in <a href="text00022.html#ch11fig5">Figure 11-5</a>
 . It displays a list of rows that have been broken up into different sections.</p>
<p class="indent">Each section and row of a table view is identified with an index number. These numbers start at 0 and then increase by 1 as you go down the table view. For example, the Privacy line in the Settings app is found at section 0, row 1. The News setting is at section 1, row 3.</p>
<p class="indent">In the middle of the <span class="code">BirthdaysTableViewController</span>
 class, there is a section called <em>Table view data source</em>
 with three methods. The table view controller uses these methods to determine what’s going to be displayed inside its table view.</p>
<p class="hang">
<span class="code">
<span class="codestrong">numberOfSections(in:)</span>
</span>
 Tells the table view how many sections it should have</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:numberOfRowsInSection:)</span>
</span>
 Tells the table view how many rows will be displayed in each section</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:cellForRowAt:)</span>
</span>
 Sets up each cell that’s going to be displayed in each row of the table view</p>
<div class="image"><span id="page_163"></span>
 <img src="Image00243.jpg" />
</div>
<p class="figcap"><a id="ch11fig5"></a>
 <em>Figure 11-5: The Settings app uses sections to group rows of different device settings.</em>
</p>
<p class="indent">The table view data source methods are called by the table view controller every time the table view is reloaded. Xcode automatically gives you these method templates when you make a subclass of a <span class="code">UITableViewController</span>
 . You need to implement all three methods for the app to work, even though you’ll never call them directly in your code. The <span class="code">UITableViewController</span>
 class implements the <span class="code">UITableViewDataSource</span>
 protocol, which comes with these data source methods, to determine what will be displayed inside the table view. We’ll discuss protocols in “<a href="text00022.html#ch11lev2sec5">Delegation</a>
 ” on page 166. For now, you just need to know that a <span class="code">UITableViewController</span>
 uses these methods to display its content, and it automatically calls these methods so you don’t need to call them.</p>
<p class="indent">Let’s start with the method <span class="code">numberOfSections(in:)</span>
 . The Birthdays table view controller is a list that just displays <span class="code">Birthday</span>
 instances, so it doesn’t need multiple sections. To set the number of sections in the table view, we just need to return <span class="code">1</span>
 .</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func numberOfSections(in tableView: UITableView) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 <span class="blue1">1</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent"><span id="page_164"></span>
 This method takes a <span class="code">UITableView</span>
 called <span class="code">tableView</span>
 as a parameter, which is the table view that uses this class as its data source. We don’t need to worry about making this connection because the <span class="code">UITableViewController</span>
 comes with a built-in table view that is automatically hooked up to these methods. Each birthday will be displayed in its own row. So in <span class="code">tableView(_:numberOfRowsInSection:)</span>
 , in order to have the right number of rows for all of your birthdays, you need to return the number of <span class="code">Birthday</span>
 instances that you have in your <span class="code">birthdays</span>
 array. Do you remember the <span class="code">count</span>
 property of an array? It’s an integer that tells you how many items are in that array, and it’s perfect for this situation! Change this method to the following:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, <img class="inline" src="Image00184.jpg" />
<br />
    numberOfRowsInSection section: Int) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 birthdays.<span class="violet">count</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">In addition to the <span class="code">tableView</span>
 parameter, <span class="code">tableView(_:numberOfRowsInSection:)</span>
 also takes an <span class="code">Int</span>
 called <span class="code">section</span>
 . When the table view is loading itself, this method is called for each section in the table view. In our case, we have only one section, so we don’t need to bother checking which <span class="code">section</span>
 of the table view is being displayed here. We know it’s section 0, and we want it to have as many rows as there are birthdays, so we write <span class="code">return birthdays.count</span>
 .</p>
<p class="indent">Finally, you need to implement <span class="code">tableView(_:cellForRowAt:)</span>
 so that the table view will know what to put inside each cell. Since this method is commented out, you need to uncomment it by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it. (Be careful not to accidentally uncomment the other methods after it!) After you’ve done that, change it to the following code:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, cellForRowAt <img class="inline" src="Image00184.jpg" />
<br />
    indexPath: IndexPath) -&gt; UITableViewCell {</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="pink">let</span>
 cell = tableView.<span class="blue">dequeueReusableCell</span>
 (withIdentifier: <img class="inline" src="Image00093.jpg" />
<br />
        <span class="red">"birthdayCellIdentifier"</span>
 , for: indexPath)<br />
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 birthday = <span class="green1">birthdays</span>
 [indexPath.<span class="violet">row</span>
 ]<br />
<br />
  <span class="ent">➌</span>
 cell.<span class="violet">textLabel</span>
 ?.<span class="violet">text</span>
 = birthday.<span class="green1">firstName</span>
 <span class="blue">+</span>
 <span class="red">" "</span>
 <span class="blue">+</span>
 <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">lastName</span>
<br />
<br />
  <span class="ent">➍</span>
 cell.<span class="violet">detailTextLabel</span>
 ?.<span class="violet">text</span>
 = <span class="green1">dateFormatter</span>
 .<span class="blue">string</span>
 (from: <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">birthdate</span>
 )<br />
<br />
  <span class="ent">➎</span>
 <span class="pink">return</span>
 cell<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">You don’t call the method <span class="code">tableView(_:cellForRowAt:)</span>
 . It’s called when the table view is loaded onto the screen. It’s called for each cell on the screen and takes two parameters, <span class="code">tableView</span>
 and <span class="code">indexPath</span>
 . You already know <span id="page_165"></span>
 what the <span class="code">tableView</span>
 parameter is for. An <span class="code">IndexPath</span>
 is a Swift struct that’s used to represent a row’s position in a table view. An <span class="code">IndexPath</span>
 instance has a <span class="code">section</span>
 property and a <span class="code">row</span>
 property. Since this method will be called many times (once for every row in the table), we need the <span class="code">indexPath</span>
 to know which section and row we’re currently configuring. The <span class="code">indexPath.section</span>
 property gives the section number, and the <span class="code">indexPath.row</span>
 gives the row of the table view cell. The five lines of code inside <span class="code">tableView(_:cellForRowAt:)</span>
 will do the following:</p>
<div class="image"><img src="Image00244.jpg" />
</div>
<p class="bull">• Create a <span class="code">UITableViewCell</span>
</p>
<p class="bull">• Figure out which <span class="code">Birthday</span>
 in the <span class="code">birthdays</span>
 array will be displayed inside the cell</p>
<p class="bull">• Make two labels to display the birthday person’s name and birthdate in the cell</p>
<p class="bull">• Return the cell ready for display in the table view</p>
<p class="indentt">Let’s go through this code line by line.</p>
<p class="indent">First, create the <span class="code">UITableViewCell</span>
 . The code at <span class="ent">➊</span>
 does this using the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 . Before you can start using this method on a cell, though, you need to tell the method which cell you want to use from the storyboard. Earlier, when you were in the storyboard, you gave your cell the identifier <span class="code">birthdayCellIdentifier</span>
 (see <a href="text00022.html#ch11fig4">Figure 11-4</a>
 ). This identifier links your code to the cell and tells your method that it’s using the right cell. The string for when you call this method needs to be exactly the same as the string you set in the storyboard, or you’ll get an error and the app will crash when you run it.</p>
<p class="indent">In the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 , did you notice the words <em>Reusable Cell</em>
 ? The cells inside a table view are created once and then can be reused over and over. This helps everything run faster and smoother because creating the cell is what takes the most time. If you had 200 birthdays in your app, but only 10 would fit on your screen at one time, then you need only 10 cells to show your birthdays. When you scroll down to reveal more birthdays, the cells that scroll off the top of the screen are reused. They are filled with new information and show up again at the bottom of the screen. The <span class="code">UITableView</span>
 automatically does this work. When the table view is loaded, <span class="code">tableView(_:cellForRowAt:)</span>
 is called for every visible row. When the user scrolls to look at more cells, it’s called again for each row just as it is about to appear on the screen.</p>
<p class="indent">Next, we need to find out which <span class="code">Birthday</span>
 should be displayed inside the cell. We want to display one birthday from the <span class="code">birthdays</span>
 array in each row. The first birthday, which is at <span class="code">birthdays[0]</span>
 , should be displayed in row 0. The second birthday, at <span class="code">birthdays[1]</span>
 , should be displayed in row 1, and so on, which means the <span class="code">indexPath</span>
 ’s <span class="code">row</span>
 is the same as the position in the <span class="code">birthdays</span>
 array that we want to access. The code at <span class="ent">➋</span>
 accesses the <span id="page_166"></span>
 correct <span class="code">Birthday</span>
 object from the <span class="code">birthdays</span>
 array by using <span class="code">indexPath.row</span>
 . Once we have the right <span class="code">Birthday</span>
 object, we assign it to a constant named <span class="code">birthday</span>
 so we can set up the labels in this cell.</p>
<p class="indent">Notice that we’re using <span class="code">let</span>
 to assign the <span class="code">birthday</span>
 to a constant instead of a variable. We can use <span class="code">let</span>
 because each time <span class="code">tableView(_:cellForRowAt:)</span>
 is called, a new <span class="code">birthday</span>
 constant is created. Each cell gets its own <span class="code">birthday</span>
 constant that is assigned its own <span class="code">Birthday</span>
 object. Since we’re not going to change any of the <span class="code">birthday</span>
 constants—we’re just going to read their properties—we don’t want to make them variables.</p>
<p class="indent">Now that you have your cell and your birthday, it’s time to fill in the details. You need two labels for each cell to show the birthday person’s name and birthdate. You set the cell to the Subtitle style so that it has a Title label and a Subtitle label. Each cell will already contain these labels, so now you don’t have to create any labels yourself.</p>
<p class="indent">The labels exist as properties of <span class="code">UITableViewCell</span>
 and are called <span class="code">textLabel</span>
 and <span class="code">detailTextLabel</span>
 . The code at <span class="ent">➌</span>
 sets the text of the <span class="code">textLabel</span>
 to a string made up of the <span class="code">firstName</span>
 and <span class="code">lastName</span>
 of the <span class="code">birthday</span>
 with a space between them. At <span class="ent">➍</span>
 , you use the <span class="code">string(from:)</span>
 method of the <span class="code">dateFormatter</span>
 to display the birthdate in the <span class="code">detailTextLabel</span>
 .</p>
<p class="indent">When your cell is completely configured, <span class="code">tableView( _:cellForRowAt:)</span>
 returns the cell at <span class="ent">➎</span>
 so that it can be displayed at that <span class="code">indexPath</span>
 of the table view.</p>
<h3 class="h3" id="ch11lev1sec2">
<strong>PUTTING IT ALL TOGETHER</strong>
</h3>
<p class="noindent">Now you can add <span class="code">Birthday</span>
 instances to the app using the Add Birthday view controller, and you have a table view to list each <span class="code">Birthday</span>
 in the Birthdays table view controller. But when you try running the app and adding a <span class="code">Birthday</span>
 , it doesn’t appear. To make each <span class="code">Birthday</span>
 you add appear in the table view, you need to make the Add Birthday view controller communicate with the Birthdays table view controller. You do this by using <em>delegation</em>
 .</p>
<h4 class="h4" id="ch11lev2sec5">
<strong>DELEGATION</strong>
</h4>
<p class="noindent">Delegation can be used when one view controller needs to get information from another view controller. Say you have two view controllers: A and B. The first view controller, A, creates B and presents B on top of itself. A knows about B because it created and presented B, so A can pass information along to B. But B doesn’t know about A—it’s just popped into being and doesn’t know where it came from or how it got there. So how can B talk to A? Through delegation!</p>
<div class="image"><img src="Image00245.jpg" />
</div>
<p class="indent">Delegation is when someone gives a job or a task to someone else. A <em>delegate</em>
 is like a boss who tells a delegating employee what to do. When the delegating employee is done with their task, sometimes they’ll report information back to the delegate boss.</p>
<p class="indent"><span id="page_167"></span>
 Delegation in Swift is pretty similar, but instead of having a boss and employee, we have a delegate and a delegating object. Since class B is the one being told what to do by class A, it’s the delegating object. We give class B a special property called a delegate to tell it who its delegate is—that way, it knows who to communicate with. The delegate can be any class that has a set of methods that have been defined in a <em>protocol</em>
 . A protocol is like an agreement between the two classes that tells them what the delegate can ask the delegating object to do. It has a list of method and property names that the delegate can use with the delegating object.</p>
<p class="indent">Class A creates class B, makes itself the delegate of class B, and gives class B a job to do that’s in the protocol. Once class B is done with its job, it reports back to class A. Let’s see how this works in our app.</p>
<p class="indent">The Birthdays table view controller is view controller A, and the Add Birthday view controller is view controller B. We’ll create a protocol called <span class="code">AddBirthdayViewControllerDelegate</span>
 and a method for that protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 , which the Add Birthday view controller will use to report back.</p>
<p class="indent">Take a look at <a href="text00022.html#ch11fig6">Figure 11-6</a>
 . When the user taps the Add button <span class="ent">➊</span>
 , the Birthdays table view controller creates the Add Birthday view controller <span class="ent">➋</span>
 and sets itself as the Add Birthday view controller’s delegate.</p>
<div class="image"><img src="Image00246.jpg" />
</div>
<p class="figcap"><a id="ch11fig6"></a>
 <em>Figure 11-6: A new birthday is added and passed from the Add Birthday view controller to the Birthdays table view controller using delegation.</em>
</p>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="indent">That’s it! You’ve finished your work in the storyboard.</p>
<p class="indent">You may be wondering why we have just one cell in our table view in the storyboard when we’ll have more than one birthday to show in the list. If you look at <a href="text00022.html#ch11fig4">Figure 11-4</a>
 again, you’ll notice that the cell is labeled <em>Prototype Cells</em>
 . This means that the cell you just customized is a <em>template</em>
 for all the cells you want to appear in your table view. The identifier you gave the cell is how your code will tell the table view to produce each cell for you to put birthdays in. You’ll see how this works soon.</p>
<div class="box1">
<p class="box-title">
<strong>WORKING WITH DATES</strong>
</p>
<p class="box-p">Swift has a special data type called <span class="code">Date</span>
 that is used for storing date values. A <span class="code">Date</span>
 object is actually a date and a time. Open your playground and enter the following:</p>
<div class="image"><img src="Image00239.jpg" />
</div>
<p class="box-pi">We’ve just assigned the current date and time the code was run to the variable <span class="code">today</span>
 . When you print <span class="code">today</span>
 , it’s in the format <span class="code">"2017-11-21 10:45:31 +0000\n"</span>
 . What if you wanted it to display as <span class="code">Tuesday, November 21, 2017</span>
 , instead? Or just <span class="code">11/21/17</span>
 ? To display a date in a particular way, you use a <em>date formatter</em>
 , which is a <span class="code">DateFormatter</span>
 object that you create and give a date format style. <span class="code">DateFormatter</span>
 is a helper object that is used to create a display string from any date, and a <em>date format style</em>
 is a property of <span class="code">DateFormatter</span>
 that tells the formatter what style to use. You can create your own date format styles manually, but there are also styles that are included in Swift and ready to use. Add the following to your playground:</p>
<div class="image"><img src="Image00240.jpg" />
</div>
<p class="box-pi">At <span class="ent">➊</span>
 you create a <span class="code">formatter</span>
 . Then at <span class="ent">➋</span>
 , you set the style of the <span class="code">formatter</span>
 to <span class="code">Style.full</span>
 , which will print the day of the week as well as the full month name, date, and year. Finally, you create a string from the date using the <span class="code">string(from:)</span>
 method of the <span class="code">DateFormatter</span>
 class <span class="ent">➌</span>
 . You can see that you now have turned the <span id="page_160"></span>
 date into the nicely formatted string <span class="code">"Tuesday, November 21, 2017"</span>
 . <a style=";color:black;" href="text00022.html#ch11tab1">Table 11-1</a>
 shows the different strings that are created from the five <span class="code">DateFormatter.Style</span>
 options available in Swift.</p>
<p class="tabcap"><a id="ch11tab1" style=";color:black;"></a>
 <strong>Table 11-1:</strong>
 Date Formatter Styles and Their Date Strings</p>
<table class="tabled">
<tbody>
<tr>
<td style="vertical-align: top;" class="border1">
<p class="noindent">
<span class="code">
<span class="codestrong">DateFormatter.Style</span>
</span>
</p>
</td>
<td style="vertical-align: top;" class="border1">
<p class="noindent">
<strong>Date string</strong>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">none</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">""</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">short</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"11/21/17"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">medium</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"Nov 21, 2017"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">long</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"November 21, 2017"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">full</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"Tuesday, November 21, 2017"</span>
</p>
</td>
</tr>
</tbody>
</table>
<p class="box-pi">You can also specify your own custom way of displaying a date using the <span class="code">dateFormat</span>
 property of the <span class="code">DateFormatter</span>
 . Perhaps you only want the month and day. Or maybe you want a four-digit year displayed in the <span class="code">short</span>
 style. Doing either is really easy, and you don’t even have to create a new <span class="code">DateFormatter</span>
 —you can just change the <span class="code">dateFormat</span>
 on <span class="code">formatter</span>
 and then ask it for a new string. Add the following code to your playground to display dates with a specific format:</p>
<div class="image"><img src="Image00241.jpg" />
</div>
<p class="box-pi">At <span class="ent">➊</span>
 , you specify that you only want the month and the date in an <span class="code">MM/dd</span>
 format—that is, a two-digit month followed by a two-digit date. If you want to display the month as three letters, then use <span class="code">MMM</span>
 . To display the full name of the month, use <span class="code">MMMM</span>
 . At <span class="ent">➋</span>
 , we change the date format to use a four-digit year. A two-digit year would be <span class="code">yy</span>
 . Here are a few other ways to use a <span class="code">dateFormat</span>
 to display a custom date string.</p>
<div class="image"><img src="Image00242.jpg" />
</div>
<p class="box-pi"><span id="page_161"></span>
 If you want to include separators, you add them to your <span class="code">dateFormat</span>
 string. For example, if you want periods as separators, then you can create a <span class="code">dateFormat</span>
 like <span class="code">"MM.dd.yy"</span>
 <span class="ent">➊</span>
 . To display an abbreviated day of the week, use <span class="code">EEE</span>
 <span class="ent">➋</span>
 . For the full day, use <span class="code">EEEE</span>
 <span class="ent">➌</span>
 . These are only a few examples. By using combinations of <span class="code">M</span>
 , <span class="code">d</span>
 , <span class="code">y</span>
 , and <span class="code">E</span>
 , you have an endless number of ways to display a date!</p>
</div>
<h4 class="h4" id="ch11lev2sec3">
<strong>SETTING UP THE BIRTHDAYS TABLE VIEW CONTROLLER</strong>
</h4>
<p class="noindent">The Birthdays table view controller will display a list of all the birthdays stored in the app. Do you remember what you use to store a list of items? That’s right—an array! You’ll create an array in the <span class="code">BirthdaysTableViewController</span>
 to store all the birthdays. To do this, give the <span class="code">BirthdaysTableViewController</span>
 a <span class="code">birthdays</span>
 property that is an array of <span class="code">Birthday</span>
 objects. At the top of the class, right above the <span class="code">viewDidLoad()</span>
 method, insert this line to add a variable array property called <span class="code">birthdays</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController {</span>
<br />
<br />
    <span class="pink">var</span>
 birthdays = [<span class="green1">Birthday</span>
 ]()<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent">This line creates an empty array of <span class="code">Birthday</span>
 instances. It needs to be a variable and not a constant because you’ll want to add a saved <span class="code">Birthday</span>
 to this array every time the user adds a <span class="code">Birthday</span>
 with the Add Birthday view controller. You’ll see how to do that in “<a href="text00022.html#ch11lev3sec2">Making the Birthdays Table View Controller Conform to Protocol</a>
 ” on <a href="text00022.html#page_168">page 168</a>
 .</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>Remember that the final versions of the project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>.</em>
</p>
</div>
<p class="indent">The <span class="code">BirthdaysTableViewController</span>
 will also need a <span class="code">dateFormatter</span>
 property to display the birthdate as a nicely formatted string. Add a <span class="code">dateFormatter</span>
 right underneath the <span class="code">birthdays</span>
 array:</p>
<div class="box">
<pre>    <span class="ash">var birthdays = [Birthday]()</span>
<br />
<br />
    <span class="pink">let</span>
 dateFormatter = <span class="violet">DateFormatter</span>
 ()<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent">Note that the <span class="code">dateFormatter</span>
 is a constant that is created with <span class="code">let</span>
 . Even though you’ll change the <span class="code">dateFormatter</span>
 ’s properties, like the <span class="code">dateStyle</span>
 and <span class="code">timeStyle</span>
 , you’ll never change the <span class="code">dateFormatter</span>
 itself.</p>
<p class="indent"><span id="page_162"></span>
 You’ll also need to set up the <span class="code">dateFormatter</span>
 so that it will display the birthdates as fully formatted strings like <span class="code">"Tuesday, December 17, 2008"</span>
 . As you saw in <a href="text00021.html#ch10">Chapter 10</a>
 , a good place to do this is the <span class="code">viewDidLoad()</span>
 method, which is called when the Birthdays table view controller is loading its view. This is the perfect place to do any setup that is needed for this class.</p>
<div class="box">
<pre>
<span class="ash">override func viewDidLoad() {</span>
<br />
    <span class="ash">super.viewDidLoad()</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">dateFormatter</span>
 .<span class="violet">dateStyle</span>
 = .<span class="blue">full</span>
<br />
  <span class="ent">➋</span>
 <span class="green1">dateFormatter</span>
 .<span class="violet">timeStyle</span>
 = .<span class="blue">none</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , you set the <span class="code">dateStyle</span>
 of the <span class="code">dateFormatter</span>
 so that it will display a formatted date string for each <span class="code">Birthday</span>
 . Did you notice how we just wrote <span class="code">.full</span>
 instead of <span class="code">DateFormatter.Style.full</span>
 ? Swift knows what type to expect for the <span class="code">dateStyle</span>
 of a <span class="code">DateFormatter</span>
 , so it lets us take this little shortcut. At <span class="ent">➋</span>
 , you set the <span class="code">timeStyle</span>
 of the <span class="code">dateFormatter</span>
 to <span class="code">.none</span>
 so that the time won’t be shown.</p>
<h4 class="h4" id="ch11lev2sec4">
<strong>DISPLAYING BIRTHDAYS IN A TABLE VIEW</strong>
</h4>
<p class="noindent">The <span class="code">BirthdaysTableViewController</span>
 class has a table view that is used to display a list of items in a single column. The table view has one or more sections containing rows, and each row contains a cell. A section in a table view is a grouping of rows that can be displayed with or without a header. An example of an app that shows a table view with several sections is the Settings app, as shown in <a href="text00022.html#ch11fig5">Figure 11-5</a>
 . It displays a list of rows that have been broken up into different sections.</p>
<p class="indent">Each section and row of a table view is identified with an index number. These numbers start at 0 and then increase by 1 as you go down the table view. For example, the Privacy line in the Settings app is found at section 0, row 1. The News setting is at section 1, row 3.</p>
<p class="indent">In the middle of the <span class="code">BirthdaysTableViewController</span>
 class, there is a section called <em>Table view data source</em>
 with three methods. The table view controller uses these methods to determine what’s going to be displayed inside its table view.</p>
<p class="hang">
<span class="code">
<span class="codestrong">numberOfSections(in:)</span>
</span>
 Tells the table view how many sections it should have</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:numberOfRowsInSection:)</span>
</span>
 Tells the table view how many rows will be displayed in each section</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:cellForRowAt:)</span>
</span>
 Sets up each cell that’s going to be displayed in each row of the table view</p>
<div class="image"><span id="page_163"></span>
 <img src="Image00243.jpg" />
</div>
<p class="figcap"><a id="ch11fig5"></a>
 <em>Figure 11-5: The Settings app uses sections to group rows of different device settings.</em>
</p>
<p class="indent">The table view data source methods are called by the table view controller every time the table view is reloaded. Xcode automatically gives you these method templates when you make a subclass of a <span class="code">UITableViewController</span>
 . You need to implement all three methods for the app to work, even though you’ll never call them directly in your code. The <span class="code">UITableViewController</span>
 class implements the <span class="code">UITableViewDataSource</span>
 protocol, which comes with these data source methods, to determine what will be displayed inside the table view. We’ll discuss protocols in “<a href="text00022.html#ch11lev2sec5">Delegation</a>
 ” on page 166. For now, you just need to know that a <span class="code">UITableViewController</span>
 uses these methods to display its content, and it automatically calls these methods so you don’t need to call them.</p>
<p class="indent">Let’s start with the method <span class="code">numberOfSections(in:)</span>
 . The Birthdays table view controller is a list that just displays <span class="code">Birthday</span>
 instances, so it doesn’t need multiple sections. To set the number of sections in the table view, we just need to return <span class="code">1</span>
 .</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func numberOfSections(in tableView: UITableView) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 <span class="blue1">1</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent"><span id="page_164"></span>
 This method takes a <span class="code">UITableView</span>
 called <span class="code">tableView</span>
 as a parameter, which is the table view that uses this class as its data source. We don’t need to worry about making this connection because the <span class="code">UITableViewController</span>
 comes with a built-in table view that is automatically hooked up to these methods. Each birthday will be displayed in its own row. So in <span class="code">tableView(_:numberOfRowsInSection:)</span>
 , in order to have the right number of rows for all of your birthdays, you need to return the number of <span class="code">Birthday</span>
 instances that you have in your <span class="code">birthdays</span>
 array. Do you remember the <span class="code">count</span>
 property of an array? It’s an integer that tells you how many items are in that array, and it’s perfect for this situation! Change this method to the following:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, <img class="inline" src="Image00184.jpg" />
<br />
    numberOfRowsInSection section: Int) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 birthdays.<span class="violet">count</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">In addition to the <span class="code">tableView</span>
 parameter, <span class="code">tableView(_:numberOfRowsInSection:)</span>
 also takes an <span class="code">Int</span>
 called <span class="code">section</span>
 . When the table view is loading itself, this method is called for each section in the table view. In our case, we have only one section, so we don’t need to bother checking which <span class="code">section</span>
 of the table view is being displayed here. We know it’s section 0, and we want it to have as many rows as there are birthdays, so we write <span class="code">return birthdays.count</span>
 .</p>
<p class="indent">Finally, you need to implement <span class="code">tableView(_:cellForRowAt:)</span>
 so that the table view will know what to put inside each cell. Since this method is commented out, you need to uncomment it by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it. (Be careful not to accidentally uncomment the other methods after it!) After you’ve done that, change it to the following code:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, cellForRowAt <img class="inline" src="Image00184.jpg" />
<br />
    indexPath: IndexPath) -&gt; UITableViewCell {</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="pink">let</span>
 cell = tableView.<span class="blue">dequeueReusableCell</span>
 (withIdentifier: <img class="inline" src="Image00093.jpg" />
<br />
        <span class="red">"birthdayCellIdentifier"</span>
 , for: indexPath)<br />
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 birthday = <span class="green1">birthdays</span>
 [indexPath.<span class="violet">row</span>
 ]<br />
<br />
  <span class="ent">➌</span>
 cell.<span class="violet">textLabel</span>
 ?.<span class="violet">text</span>
 = birthday.<span class="green1">firstName</span>
 <span class="blue">+</span>
 <span class="red">" "</span>
 <span class="blue">+</span>
 <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">lastName</span>
<br />
<br />
  <span class="ent">➍</span>
 cell.<span class="violet">detailTextLabel</span>
 ?.<span class="violet">text</span>
 = <span class="green1">dateFormatter</span>
 .<span class="blue">string</span>
 (from: <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">birthdate</span>
 )<br />
<br />
  <span class="ent">➎</span>
 <span class="pink">return</span>
 cell<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">You don’t call the method <span class="code">tableView(_:cellForRowAt:)</span>
 . It’s called when the table view is loaded onto the screen. It’s called for each cell on the screen and takes two parameters, <span class="code">tableView</span>
 and <span class="code">indexPath</span>
 . You already know <span id="page_165"></span>
 what the <span class="code">tableView</span>
 parameter is for. An <span class="code">IndexPath</span>
 is a Swift struct that’s used to represent a row’s position in a table view. An <span class="code">IndexPath</span>
 instance has a <span class="code">section</span>
 property and a <span class="code">row</span>
 property. Since this method will be called many times (once for every row in the table), we need the <span class="code">indexPath</span>
 to know which section and row we’re currently configuring. The <span class="code">indexPath.section</span>
 property gives the section number, and the <span class="code">indexPath.row</span>
 gives the row of the table view cell. The five lines of code inside <span class="code">tableView(_:cellForRowAt:)</span>
 will do the following:</p>
<div class="image"><img src="Image00244.jpg" />
</div>
<p class="bull">• Create a <span class="code">UITableViewCell</span>
</p>
<p class="bull">• Figure out which <span class="code">Birthday</span>
 in the <span class="code">birthdays</span>
 array will be displayed inside the cell</p>
<p class="bull">• Make two labels to display the birthday person’s name and birthdate in the cell</p>
<p class="bull">• Return the cell ready for display in the table view</p>
<p class="indentt">Let’s go through this code line by line.</p>
<p class="indent">First, create the <span class="code">UITableViewCell</span>
 . The code at <span class="ent">➊</span>
 does this using the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 . Before you can start using this method on a cell, though, you need to tell the method which cell you want to use from the storyboard. Earlier, when you were in the storyboard, you gave your cell the identifier <span class="code">birthdayCellIdentifier</span>
 (see <a href="text00022.html#ch11fig4">Figure 11-4</a>
 ). This identifier links your code to the cell and tells your method that it’s using the right cell. The string for when you call this method needs to be exactly the same as the string you set in the storyboard, or you’ll get an error and the app will crash when you run it.</p>
<p class="indent">In the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 , did you notice the words <em>Reusable Cell</em>
 ? The cells inside a table view are created once and then can be reused over and over. This helps everything run faster and smoother because creating the cell is what takes the most time. If you had 200 birthdays in your app, but only 10 would fit on your screen at one time, then you need only 10 cells to show your birthdays. When you scroll down to reveal more birthdays, the cells that scroll off the top of the screen are reused. They are filled with new information and show up again at the bottom of the screen. The <span class="code">UITableView</span>
 automatically does this work. When the table view is loaded, <span class="code">tableView(_:cellForRowAt:)</span>
 is called for every visible row. When the user scrolls to look at more cells, it’s called again for each row just as it is about to appear on the screen.</p>
<p class="indent">Next, we need to find out which <span class="code">Birthday</span>
 should be displayed inside the cell. We want to display one birthday from the <span class="code">birthdays</span>
 array in each row. The first birthday, which is at <span class="code">birthdays[0]</span>
 , should be displayed in row 0. The second birthday, at <span class="code">birthdays[1]</span>
 , should be displayed in row 1, and so on, which means the <span class="code">indexPath</span>
 ’s <span class="code">row</span>
 is the same as the position in the <span class="code">birthdays</span>
 array that we want to access. The code at <span class="ent">➋</span>
 accesses the <span id="page_166"></span>
 correct <span class="code">Birthday</span>
 object from the <span class="code">birthdays</span>
 array by using <span class="code">indexPath.row</span>
 . Once we have the right <span class="code">Birthday</span>
 object, we assign it to a constant named <span class="code">birthday</span>
 so we can set up the labels in this cell.</p>
<p class="indent">Notice that we’re using <span class="code">let</span>
 to assign the <span class="code">birthday</span>
 to a constant instead of a variable. We can use <span class="code">let</span>
 because each time <span class="code">tableView(_:cellForRowAt:)</span>
 is called, a new <span class="code">birthday</span>
 constant is created. Each cell gets its own <span class="code">birthday</span>
 constant that is assigned its own <span class="code">Birthday</span>
 object. Since we’re not going to change any of the <span class="code">birthday</span>
 constants—we’re just going to read their properties—we don’t want to make them variables.</p>
<p class="indent">Now that you have your cell and your birthday, it’s time to fill in the details. You need two labels for each cell to show the birthday person’s name and birthdate. You set the cell to the Subtitle style so that it has a Title label and a Subtitle label. Each cell will already contain these labels, so now you don’t have to create any labels yourself.</p>
<p class="indent">The labels exist as properties of <span class="code">UITableViewCell</span>
 and are called <span class="code">textLabel</span>
 and <span class="code">detailTextLabel</span>
 . The code at <span class="ent">➌</span>
 sets the text of the <span class="code">textLabel</span>
 to a string made up of the <span class="code">firstName</span>
 and <span class="code">lastName</span>
 of the <span class="code">birthday</span>
 with a space between them. At <span class="ent">➍</span>
 , you use the <span class="code">string(from:)</span>
 method of the <span class="code">dateFormatter</span>
 to display the birthdate in the <span class="code">detailTextLabel</span>
 .</p>
<p class="indent">When your cell is completely configured, <span class="code">tableView( _:cellForRowAt:)</span>
 returns the cell at <span class="ent">➎</span>
 so that it can be displayed at that <span class="code">indexPath</span>
 of the table view.</p>
<h3 class="h3" id="ch11lev1sec2">
<strong>PUTTING IT ALL TOGETHER</strong>
</h3>
<p class="noindent">Now you can add <span class="code">Birthday</span>
 instances to the app using the Add Birthday view controller, and you have a table view to list each <span class="code">Birthday</span>
 in the Birthdays table view controller. But when you try running the app and adding a <span class="code">Birthday</span>
 , it doesn’t appear. To make each <span class="code">Birthday</span>
 you add appear in the table view, you need to make the Add Birthday view controller communicate with the Birthdays table view controller. You do this by using <em>delegation</em>
 .</p>
<h4 class="h4" id="ch11lev2sec5">
<strong>DELEGATION</strong>
</h4>
<p class="noindent">Delegation can be used when one view controller needs to get information from another view controller. Say you have two view controllers: A and B. The first view controller, A, creates B and presents B on top of itself. A knows about B because it created and presented B, so A can pass information along to B. But B doesn’t know about A—it’s just popped into being and doesn’t know where it came from or how it got there. So how can B talk to A? Through delegation!</p>
<div class="image"><img src="Image00245.jpg" />
</div>
<p class="indent">Delegation is when someone gives a job or a task to someone else. A <em>delegate</em>
 is like a boss who tells a delegating employee what to do. When the delegating employee is done with their task, sometimes they’ll report information back to the delegate boss.</p>
<p class="indent"><span id="page_167"></span>
 Delegation in Swift is pretty similar, but instead of having a boss and employee, we have a delegate and a delegating object. Since class B is the one being told what to do by class A, it’s the delegating object. We give class B a special property called a delegate to tell it who its delegate is—that way, it knows who to communicate with. The delegate can be any class that has a set of methods that have been defined in a <em>protocol</em>
 . A protocol is like an agreement between the two classes that tells them what the delegate can ask the delegating object to do. It has a list of method and property names that the delegate can use with the delegating object.</p>
<p class="indent">Class A creates class B, makes itself the delegate of class B, and gives class B a job to do that’s in the protocol. Once class B is done with its job, it reports back to class A. Let’s see how this works in our app.</p>
<p class="indent">The Birthdays table view controller is view controller A, and the Add Birthday view controller is view controller B. We’ll create a protocol called <span class="code">AddBirthdayViewControllerDelegate</span>
 and a method for that protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 , which the Add Birthday view controller will use to report back.</p>
<p class="indent">Take a look at <a href="text00022.html#ch11fig6">Figure 11-6</a>
 . When the user taps the Add button <span class="ent">➊</span>
 , the Birthdays table view controller creates the Add Birthday view controller <span class="ent">➋</span>
 and sets itself as the Add Birthday view controller’s delegate.</p>
<div class="image"><img src="Image00246.jpg" />
</div>
<p class="figcap"><a id="ch11fig6"></a>
 <em>Figure 11-6: A new birthday is added and passed from the Add Birthday view controller to the Birthdays table view controller using delegation.</em>
</p>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="indent">You may be wondering why we have just one cell in our table view in the storyboard when we’ll have more than one birthday to show in the list. If you look at <a href="text00022.html#ch11fig4">Figure 11-4</a>
 again, you’ll notice that the cell is labeled <em>Prototype Cells</em>
 . This means that the cell you just customized is a <em>template</em>
 for all the cells you want to appear in your table view. The identifier you gave the cell is how your code will tell the table view to produce each cell for you to put birthdays in. You’ll see how this works soon.</p>
<div class="box1">
<p class="box-title">
<strong>WORKING WITH DATES</strong>
</p>
<p class="box-p">Swift has a special data type called <span class="code">Date</span>
 that is used for storing date values. A <span class="code">Date</span>
 object is actually a date and a time. Open your playground and enter the following:</p>
<div class="image"><img src="Image00239.jpg" />
</div>
<p class="box-pi">We’ve just assigned the current date and time the code was run to the variable <span class="code">today</span>
 . When you print <span class="code">today</span>
 , it’s in the format <span class="code">"2017-11-21 10:45:31 +0000\n"</span>
 . What if you wanted it to display as <span class="code">Tuesday, November 21, 2017</span>
 , instead? Or just <span class="code">11/21/17</span>
 ? To display a date in a particular way, you use a <em>date formatter</em>
 , which is a <span class="code">DateFormatter</span>
 object that you create and give a date format style. <span class="code">DateFormatter</span>
 is a helper object that is used to create a display string from any date, and a <em>date format style</em>
 is a property of <span class="code">DateFormatter</span>
 that tells the formatter what style to use. You can create your own date format styles manually, but there are also styles that are included in Swift and ready to use. Add the following to your playground:</p>
<div class="image"><img src="Image00240.jpg" />
</div>
<p class="box-pi">At <span class="ent">➊</span>
 you create a <span class="code">formatter</span>
 . Then at <span class="ent">➋</span>
 , you set the style of the <span class="code">formatter</span>
 to <span class="code">Style.full</span>
 , which will print the day of the week as well as the full month name, date, and year. Finally, you create a string from the date using the <span class="code">string(from:)</span>
 method of the <span class="code">DateFormatter</span>
 class <span class="ent">➌</span>
 . You can see that you now have turned the <span id="page_160"></span>
 date into the nicely formatted string <span class="code">"Tuesday, November 21, 2017"</span>
 . <a style=";color:black;" href="text00022.html#ch11tab1">Table 11-1</a>
 shows the different strings that are created from the five <span class="code">DateFormatter.Style</span>
 options available in Swift.</p>
<p class="tabcap"><a id="ch11tab1" style=";color:black;"></a>
 <strong>Table 11-1:</strong>
 Date Formatter Styles and Their Date Strings</p>
<table class="tabled">
<tbody>
<tr>
<td style="vertical-align: top;" class="border1">
<p class="noindent">
<span class="code">
<span class="codestrong">DateFormatter.Style</span>
</span>
</p>
</td>
<td style="vertical-align: top;" class="border1">
<p class="noindent">
<strong>Date string</strong>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">none</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">""</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">short</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"11/21/17"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">medium</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"Nov 21, 2017"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">long</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"November 21, 2017"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">full</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"Tuesday, November 21, 2017"</span>
</p>
</td>
</tr>
</tbody>
</table>
<p class="box-pi">You can also specify your own custom way of displaying a date using the <span class="code">dateFormat</span>
 property of the <span class="code">DateFormatter</span>
 . Perhaps you only want the month and day. Or maybe you want a four-digit year displayed in the <span class="code">short</span>
 style. Doing either is really easy, and you don’t even have to create a new <span class="code">DateFormatter</span>
 —you can just change the <span class="code">dateFormat</span>
 on <span class="code">formatter</span>
 and then ask it for a new string. Add the following code to your playground to display dates with a specific format:</p>
<div class="image"><img src="Image00241.jpg" />
</div>
<p class="box-pi">At <span class="ent">➊</span>
 , you specify that you only want the month and the date in an <span class="code">MM/dd</span>
 format—that is, a two-digit month followed by a two-digit date. If you want to display the month as three letters, then use <span class="code">MMM</span>
 . To display the full name of the month, use <span class="code">MMMM</span>
 . At <span class="ent">➋</span>
 , we change the date format to use a four-digit year. A two-digit year would be <span class="code">yy</span>
 . Here are a few other ways to use a <span class="code">dateFormat</span>
 to display a custom date string.</p>
<div class="image"><img src="Image00242.jpg" />
</div>
<p class="box-pi"><span id="page_161"></span>
 If you want to include separators, you add them to your <span class="code">dateFormat</span>
 string. For example, if you want periods as separators, then you can create a <span class="code">dateFormat</span>
 like <span class="code">"MM.dd.yy"</span>
 <span class="ent">➊</span>
 . To display an abbreviated day of the week, use <span class="code">EEE</span>
 <span class="ent">➋</span>
 . For the full day, use <span class="code">EEEE</span>
 <span class="ent">➌</span>
 . These are only a few examples. By using combinations of <span class="code">M</span>
 , <span class="code">d</span>
 , <span class="code">y</span>
 , and <span class="code">E</span>
 , you have an endless number of ways to display a date!</p>
</div>
<h4 class="h4" id="ch11lev2sec3">
<strong>SETTING UP THE BIRTHDAYS TABLE VIEW CONTROLLER</strong>
</h4>
<p class="noindent">The Birthdays table view controller will display a list of all the birthdays stored in the app. Do you remember what you use to store a list of items? That’s right—an array! You’ll create an array in the <span class="code">BirthdaysTableViewController</span>
 to store all the birthdays. To do this, give the <span class="code">BirthdaysTableViewController</span>
 a <span class="code">birthdays</span>
 property that is an array of <span class="code">Birthday</span>
 objects. At the top of the class, right above the <span class="code">viewDidLoad()</span>
 method, insert this line to add a variable array property called <span class="code">birthdays</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController {</span>
<br />
<br />
    <span class="pink">var</span>
 birthdays = [<span class="green1">Birthday</span>
 ]()<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent">This line creates an empty array of <span class="code">Birthday</span>
 instances. It needs to be a variable and not a constant because you’ll want to add a saved <span class="code">Birthday</span>
 to this array every time the user adds a <span class="code">Birthday</span>
 with the Add Birthday view controller. You’ll see how to do that in “<a href="text00022.html#ch11lev3sec2">Making the Birthdays Table View Controller Conform to Protocol</a>
 ” on <a href="text00022.html#page_168">page 168</a>
 .</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>Remember that the final versions of the project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>.</em>
</p>
</div>
<p class="indent">The <span class="code">BirthdaysTableViewController</span>
 will also need a <span class="code">dateFormatter</span>
 property to display the birthdate as a nicely formatted string. Add a <span class="code">dateFormatter</span>
 right underneath the <span class="code">birthdays</span>
 array:</p>
<div class="box">
<pre>    <span class="ash">var birthdays = [Birthday]()</span>
<br />
<br />
    <span class="pink">let</span>
 dateFormatter = <span class="violet">DateFormatter</span>
 ()<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent">Note that the <span class="code">dateFormatter</span>
 is a constant that is created with <span class="code">let</span>
 . Even though you’ll change the <span class="code">dateFormatter</span>
 ’s properties, like the <span class="code">dateStyle</span>
 and <span class="code">timeStyle</span>
 , you’ll never change the <span class="code">dateFormatter</span>
 itself.</p>
<p class="indent"><span id="page_162"></span>
 You’ll also need to set up the <span class="code">dateFormatter</span>
 so that it will display the birthdates as fully formatted strings like <span class="code">"Tuesday, December 17, 2008"</span>
 . As you saw in <a href="text00021.html#ch10">Chapter 10</a>
 , a good place to do this is the <span class="code">viewDidLoad()</span>
 method, which is called when the Birthdays table view controller is loading its view. This is the perfect place to do any setup that is needed for this class.</p>
<div class="box">
<pre>
<span class="ash">override func viewDidLoad() {</span>
<br />
    <span class="ash">super.viewDidLoad()</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">dateFormatter</span>
 .<span class="violet">dateStyle</span>
 = .<span class="blue">full</span>
<br />
  <span class="ent">➋</span>
 <span class="green1">dateFormatter</span>
 .<span class="violet">timeStyle</span>
 = .<span class="blue">none</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , you set the <span class="code">dateStyle</span>
 of the <span class="code">dateFormatter</span>
 so that it will display a formatted date string for each <span class="code">Birthday</span>
 . Did you notice how we just wrote <span class="code">.full</span>
 instead of <span class="code">DateFormatter.Style.full</span>
 ? Swift knows what type to expect for the <span class="code">dateStyle</span>
 of a <span class="code">DateFormatter</span>
 , so it lets us take this little shortcut. At <span class="ent">➋</span>
 , you set the <span class="code">timeStyle</span>
 of the <span class="code">dateFormatter</span>
 to <span class="code">.none</span>
 so that the time won’t be shown.</p>
<h4 class="h4" id="ch11lev2sec4">
<strong>DISPLAYING BIRTHDAYS IN A TABLE VIEW</strong>
</h4>
<p class="noindent">The <span class="code">BirthdaysTableViewController</span>
 class has a table view that is used to display a list of items in a single column. The table view has one or more sections containing rows, and each row contains a cell. A section in a table view is a grouping of rows that can be displayed with or without a header. An example of an app that shows a table view with several sections is the Settings app, as shown in <a href="text00022.html#ch11fig5">Figure 11-5</a>
 . It displays a list of rows that have been broken up into different sections.</p>
<p class="indent">Each section and row of a table view is identified with an index number. These numbers start at 0 and then increase by 1 as you go down the table view. For example, the Privacy line in the Settings app is found at section 0, row 1. The News setting is at section 1, row 3.</p>
<p class="indent">In the middle of the <span class="code">BirthdaysTableViewController</span>
 class, there is a section called <em>Table view data source</em>
 with three methods. The table view controller uses these methods to determine what’s going to be displayed inside its table view.</p>
<p class="hang">
<span class="code">
<span class="codestrong">numberOfSections(in:)</span>
</span>
 Tells the table view how many sections it should have</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:numberOfRowsInSection:)</span>
</span>
 Tells the table view how many rows will be displayed in each section</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:cellForRowAt:)</span>
</span>
 Sets up each cell that’s going to be displayed in each row of the table view</p>
<div class="image"><span id="page_163"></span>
 <img src="Image00243.jpg" />
</div>
<p class="figcap"><a id="ch11fig5"></a>
 <em>Figure 11-5: The Settings app uses sections to group rows of different device settings.</em>
</p>
<p class="indent">The table view data source methods are called by the table view controller every time the table view is reloaded. Xcode automatically gives you these method templates when you make a subclass of a <span class="code">UITableViewController</span>
 . You need to implement all three methods for the app to work, even though you’ll never call them directly in your code. The <span class="code">UITableViewController</span>
 class implements the <span class="code">UITableViewDataSource</span>
 protocol, which comes with these data source methods, to determine what will be displayed inside the table view. We’ll discuss protocols in “<a href="text00022.html#ch11lev2sec5">Delegation</a>
 ” on page 166. For now, you just need to know that a <span class="code">UITableViewController</span>
 uses these methods to display its content, and it automatically calls these methods so you don’t need to call them.</p>
<p class="indent">Let’s start with the method <span class="code">numberOfSections(in:)</span>
 . The Birthdays table view controller is a list that just displays <span class="code">Birthday</span>
 instances, so it doesn’t need multiple sections. To set the number of sections in the table view, we just need to return <span class="code">1</span>
 .</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func numberOfSections(in tableView: UITableView) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 <span class="blue1">1</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent"><span id="page_164"></span>
 This method takes a <span class="code">UITableView</span>
 called <span class="code">tableView</span>
 as a parameter, which is the table view that uses this class as its data source. We don’t need to worry about making this connection because the <span class="code">UITableViewController</span>
 comes with a built-in table view that is automatically hooked up to these methods. Each birthday will be displayed in its own row. So in <span class="code">tableView(_:numberOfRowsInSection:)</span>
 , in order to have the right number of rows for all of your birthdays, you need to return the number of <span class="code">Birthday</span>
 instances that you have in your <span class="code">birthdays</span>
 array. Do you remember the <span class="code">count</span>
 property of an array? It’s an integer that tells you how many items are in that array, and it’s perfect for this situation! Change this method to the following:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, <img class="inline" src="Image00184.jpg" />
<br />
    numberOfRowsInSection section: Int) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 birthdays.<span class="violet">count</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">In addition to the <span class="code">tableView</span>
 parameter, <span class="code">tableView(_:numberOfRowsInSection:)</span>
 also takes an <span class="code">Int</span>
 called <span class="code">section</span>
 . When the table view is loading itself, this method is called for each section in the table view. In our case, we have only one section, so we don’t need to bother checking which <span class="code">section</span>
 of the table view is being displayed here. We know it’s section 0, and we want it to have as many rows as there are birthdays, so we write <span class="code">return birthdays.count</span>
 .</p>
<p class="indent">Finally, you need to implement <span class="code">tableView(_:cellForRowAt:)</span>
 so that the table view will know what to put inside each cell. Since this method is commented out, you need to uncomment it by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it. (Be careful not to accidentally uncomment the other methods after it!) After you’ve done that, change it to the following code:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, cellForRowAt <img class="inline" src="Image00184.jpg" />
<br />
    indexPath: IndexPath) -&gt; UITableViewCell {</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="pink">let</span>
 cell = tableView.<span class="blue">dequeueReusableCell</span>
 (withIdentifier: <img class="inline" src="Image00093.jpg" />
<br />
        <span class="red">"birthdayCellIdentifier"</span>
 , for: indexPath)<br />
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 birthday = <span class="green1">birthdays</span>
 [indexPath.<span class="violet">row</span>
 ]<br />
<br />
  <span class="ent">➌</span>
 cell.<span class="violet">textLabel</span>
 ?.<span class="violet">text</span>
 = birthday.<span class="green1">firstName</span>
 <span class="blue">+</span>
 <span class="red">" "</span>
 <span class="blue">+</span>
 <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">lastName</span>
<br />
<br />
  <span class="ent">➍</span>
 cell.<span class="violet">detailTextLabel</span>
 ?.<span class="violet">text</span>
 = <span class="green1">dateFormatter</span>
 .<span class="blue">string</span>
 (from: <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">birthdate</span>
 )<br />
<br />
  <span class="ent">➎</span>
 <span class="pink">return</span>
 cell<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">You don’t call the method <span class="code">tableView(_:cellForRowAt:)</span>
 . It’s called when the table view is loaded onto the screen. It’s called for each cell on the screen and takes two parameters, <span class="code">tableView</span>
 and <span class="code">indexPath</span>
 . You already know <span id="page_165"></span>
 what the <span class="code">tableView</span>
 parameter is for. An <span class="code">IndexPath</span>
 is a Swift struct that’s used to represent a row’s position in a table view. An <span class="code">IndexPath</span>
 instance has a <span class="code">section</span>
 property and a <span class="code">row</span>
 property. Since this method will be called many times (once for every row in the table), we need the <span class="code">indexPath</span>
 to know which section and row we’re currently configuring. The <span class="code">indexPath.section</span>
 property gives the section number, and the <span class="code">indexPath.row</span>
 gives the row of the table view cell. The five lines of code inside <span class="code">tableView(_:cellForRowAt:)</span>
 will do the following:</p>
<div class="image"><img src="Image00244.jpg" />
</div>
<p class="bull">• Create a <span class="code">UITableViewCell</span>
</p>
<p class="bull">• Figure out which <span class="code">Birthday</span>
 in the <span class="code">birthdays</span>
 array will be displayed inside the cell</p>
<p class="bull">• Make two labels to display the birthday person’s name and birthdate in the cell</p>
<p class="bull">• Return the cell ready for display in the table view</p>
<p class="indentt">Let’s go through this code line by line.</p>
<p class="indent">First, create the <span class="code">UITableViewCell</span>
 . The code at <span class="ent">➊</span>
 does this using the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 . Before you can start using this method on a cell, though, you need to tell the method which cell you want to use from the storyboard. Earlier, when you were in the storyboard, you gave your cell the identifier <span class="code">birthdayCellIdentifier</span>
 (see <a href="text00022.html#ch11fig4">Figure 11-4</a>
 ). This identifier links your code to the cell and tells your method that it’s using the right cell. The string for when you call this method needs to be exactly the same as the string you set in the storyboard, or you’ll get an error and the app will crash when you run it.</p>
<p class="indent">In the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 , did you notice the words <em>Reusable Cell</em>
 ? The cells inside a table view are created once and then can be reused over and over. This helps everything run faster and smoother because creating the cell is what takes the most time. If you had 200 birthdays in your app, but only 10 would fit on your screen at one time, then you need only 10 cells to show your birthdays. When you scroll down to reveal more birthdays, the cells that scroll off the top of the screen are reused. They are filled with new information and show up again at the bottom of the screen. The <span class="code">UITableView</span>
 automatically does this work. When the table view is loaded, <span class="code">tableView(_:cellForRowAt:)</span>
 is called for every visible row. When the user scrolls to look at more cells, it’s called again for each row just as it is about to appear on the screen.</p>
<p class="indent">Next, we need to find out which <span class="code">Birthday</span>
 should be displayed inside the cell. We want to display one birthday from the <span class="code">birthdays</span>
 array in each row. The first birthday, which is at <span class="code">birthdays[0]</span>
 , should be displayed in row 0. The second birthday, at <span class="code">birthdays[1]</span>
 , should be displayed in row 1, and so on, which means the <span class="code">indexPath</span>
 ’s <span class="code">row</span>
 is the same as the position in the <span class="code">birthdays</span>
 array that we want to access. The code at <span class="ent">➋</span>
 accesses the <span id="page_166"></span>
 correct <span class="code">Birthday</span>
 object from the <span class="code">birthdays</span>
 array by using <span class="code">indexPath.row</span>
 . Once we have the right <span class="code">Birthday</span>
 object, we assign it to a constant named <span class="code">birthday</span>
 so we can set up the labels in this cell.</p>
<p class="indent">Notice that we’re using <span class="code">let</span>
 to assign the <span class="code">birthday</span>
 to a constant instead of a variable. We can use <span class="code">let</span>
 because each time <span class="code">tableView(_:cellForRowAt:)</span>
 is called, a new <span class="code">birthday</span>
 constant is created. Each cell gets its own <span class="code">birthday</span>
 constant that is assigned its own <span class="code">Birthday</span>
 object. Since we’re not going to change any of the <span class="code">birthday</span>
 constants—we’re just going to read their properties—we don’t want to make them variables.</p>
<p class="indent">Now that you have your cell and your birthday, it’s time to fill in the details. You need two labels for each cell to show the birthday person’s name and birthdate. You set the cell to the Subtitle style so that it has a Title label and a Subtitle label. Each cell will already contain these labels, so now you don’t have to create any labels yourself.</p>
<p class="indent">The labels exist as properties of <span class="code">UITableViewCell</span>
 and are called <span class="code">textLabel</span>
 and <span class="code">detailTextLabel</span>
 . The code at <span class="ent">➌</span>
 sets the text of the <span class="code">textLabel</span>
 to a string made up of the <span class="code">firstName</span>
 and <span class="code">lastName</span>
 of the <span class="code">birthday</span>
 with a space between them. At <span class="ent">➍</span>
 , you use the <span class="code">string(from:)</span>
 method of the <span class="code">dateFormatter</span>
 to display the birthdate in the <span class="code">detailTextLabel</span>
 .</p>
<p class="indent">When your cell is completely configured, <span class="code">tableView( _:cellForRowAt:)</span>
 returns the cell at <span class="ent">➎</span>
 so that it can be displayed at that <span class="code">indexPath</span>
 of the table view.</p>
<h3 class="h3" id="ch11lev1sec2">
<strong>PUTTING IT ALL TOGETHER</strong>
</h3>
<p class="noindent">Now you can add <span class="code">Birthday</span>
 instances to the app using the Add Birthday view controller, and you have a table view to list each <span class="code">Birthday</span>
 in the Birthdays table view controller. But when you try running the app and adding a <span class="code">Birthday</span>
 , it doesn’t appear. To make each <span class="code">Birthday</span>
 you add appear in the table view, you need to make the Add Birthday view controller communicate with the Birthdays table view controller. You do this by using <em>delegation</em>
 .</p>
<h4 class="h4" id="ch11lev2sec5">
<strong>DELEGATION</strong>
</h4>
<p class="noindent">Delegation can be used when one view controller needs to get information from another view controller. Say you have two view controllers: A and B. The first view controller, A, creates B and presents B on top of itself. A knows about B because it created and presented B, so A can pass information along to B. But B doesn’t know about A—it’s just popped into being and doesn’t know where it came from or how it got there. So how can B talk to A? Through delegation!</p>
<div class="image"><img src="Image00245.jpg" />
</div>
<p class="indent">Delegation is when someone gives a job or a task to someone else. A <em>delegate</em>
 is like a boss who tells a delegating employee what to do. When the delegating employee is done with their task, sometimes they’ll report information back to the delegate boss.</p>
<p class="indent"><span id="page_167"></span>
 Delegation in Swift is pretty similar, but instead of having a boss and employee, we have a delegate and a delegating object. Since class B is the one being told what to do by class A, it’s the delegating object. We give class B a special property called a delegate to tell it who its delegate is—that way, it knows who to communicate with. The delegate can be any class that has a set of methods that have been defined in a <em>protocol</em>
 . A protocol is like an agreement between the two classes that tells them what the delegate can ask the delegating object to do. It has a list of method and property names that the delegate can use with the delegating object.</p>
<p class="indent">Class A creates class B, makes itself the delegate of class B, and gives class B a job to do that’s in the protocol. Once class B is done with its job, it reports back to class A. Let’s see how this works in our app.</p>
<p class="indent">The Birthdays table view controller is view controller A, and the Add Birthday view controller is view controller B. We’ll create a protocol called <span class="code">AddBirthdayViewControllerDelegate</span>
 and a method for that protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 , which the Add Birthday view controller will use to report back.</p>
<p class="indent">Take a look at <a href="text00022.html#ch11fig6">Figure 11-6</a>
 . When the user taps the Add button <span class="ent">➊</span>
 , the Birthdays table view controller creates the Add Birthday view controller <span class="ent">➋</span>
 and sets itself as the Add Birthday view controller’s delegate.</p>
<div class="image"><img src="Image00246.jpg" />
</div>
<p class="figcap"><a id="ch11fig6"></a>
 <em>Figure 11-6: A new birthday is added and passed from the Add Birthday view controller to the Birthdays table view controller using delegation.</em>
</p>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<div class="box1">
<p class="box-title">
<strong>WORKING WITH DATES</strong>
</p>
<p class="box-p">Swift has a special data type called <span class="code">Date</span>
 that is used for storing date values. A <span class="code">Date</span>
 object is actually a date and a time. Open your playground and enter the following:</p>
<div class="image"><img src="Image00239.jpg" />
</div>
<p class="box-pi">We’ve just assigned the current date and time the code was run to the variable <span class="code">today</span>
 . When you print <span class="code">today</span>
 , it’s in the format <span class="code">"2017-11-21 10:45:31 +0000\n"</span>
 . What if you wanted it to display as <span class="code">Tuesday, November 21, 2017</span>
 , instead? Or just <span class="code">11/21/17</span>
 ? To display a date in a particular way, you use a <em>date formatter</em>
 , which is a <span class="code">DateFormatter</span>
 object that you create and give a date format style. <span class="code">DateFormatter</span>
 is a helper object that is used to create a display string from any date, and a <em>date format style</em>
 is a property of <span class="code">DateFormatter</span>
 that tells the formatter what style to use. You can create your own date format styles manually, but there are also styles that are included in Swift and ready to use. Add the following to your playground:</p>
<div class="image"><img src="Image00240.jpg" />
</div>
<p class="box-pi">At <span class="ent">➊</span>
 you create a <span class="code">formatter</span>
 . Then at <span class="ent">➋</span>
 , you set the style of the <span class="code">formatter</span>
 to <span class="code">Style.full</span>
 , which will print the day of the week as well as the full month name, date, and year. Finally, you create a string from the date using the <span class="code">string(from:)</span>
 method of the <span class="code">DateFormatter</span>
 class <span class="ent">➌</span>
 . You can see that you now have turned the <span id="page_160"></span>
 date into the nicely formatted string <span class="code">"Tuesday, November 21, 2017"</span>
 . <a style=";color:black;" href="text00022.html#ch11tab1">Table 11-1</a>
 shows the different strings that are created from the five <span class="code">DateFormatter.Style</span>
 options available in Swift.</p>
<p class="tabcap"><a id="ch11tab1" style=";color:black;"></a>
 <strong>Table 11-1:</strong>
 Date Formatter Styles and Their Date Strings</p>
<table class="tabled">
<tbody>
<tr>
<td style="vertical-align: top;" class="border1">
<p class="noindent">
<span class="code">
<span class="codestrong">DateFormatter.Style</span>
</span>
</p>
</td>
<td style="vertical-align: top;" class="border1">
<p class="noindent">
<strong>Date string</strong>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">none</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">""</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">short</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"11/21/17"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">medium</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"Nov 21, 2017"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">long</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"November 21, 2017"</span>
</p>
</td>
</tr>
<tr>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">full</span>
</p>
</td>
<td style="vertical-align: top;">
<p class="noindent">
<span class="code">"Tuesday, November 21, 2017"</span>
</p>
</td>
</tr>
</tbody>
</table>
<p class="box-pi">You can also specify your own custom way of displaying a date using the <span class="code">dateFormat</span>
 property of the <span class="code">DateFormatter</span>
 . Perhaps you only want the month and day. Or maybe you want a four-digit year displayed in the <span class="code">short</span>
 style. Doing either is really easy, and you don’t even have to create a new <span class="code">DateFormatter</span>
 —you can just change the <span class="code">dateFormat</span>
 on <span class="code">formatter</span>
 and then ask it for a new string. Add the following code to your playground to display dates with a specific format:</p>
<div class="image"><img src="Image00241.jpg" />
</div>
<p class="box-pi">At <span class="ent">➊</span>
 , you specify that you only want the month and the date in an <span class="code">MM/dd</span>
 format—that is, a two-digit month followed by a two-digit date. If you want to display the month as three letters, then use <span class="code">MMM</span>
 . To display the full name of the month, use <span class="code">MMMM</span>
 . At <span class="ent">➋</span>
 , we change the date format to use a four-digit year. A two-digit year would be <span class="code">yy</span>
 . Here are a few other ways to use a <span class="code">dateFormat</span>
 to display a custom date string.</p>
<div class="image"><img src="Image00242.jpg" />
</div>
<p class="box-pi"><span id="page_161"></span>
 If you want to include separators, you add them to your <span class="code">dateFormat</span>
 string. For example, if you want periods as separators, then you can create a <span class="code">dateFormat</span>
 like <span class="code">"MM.dd.yy"</span>
 <span class="ent">➊</span>
 . To display an abbreviated day of the week, use <span class="code">EEE</span>
 <span class="ent">➋</span>
 . For the full day, use <span class="code">EEEE</span>
 <span class="ent">➌</span>
 . These are only a few examples. By using combinations of <span class="code">M</span>
 , <span class="code">d</span>
 , <span class="code">y</span>
 , and <span class="code">E</span>
 , you have an endless number of ways to display a date!</p>
</div>
<h4 class="h4" id="ch11lev2sec3">
<strong>SETTING UP THE BIRTHDAYS TABLE VIEW CONTROLLER</strong>
</h4>
<p class="noindent">The Birthdays table view controller will display a list of all the birthdays stored in the app. Do you remember what you use to store a list of items? That’s right—an array! You’ll create an array in the <span class="code">BirthdaysTableViewController</span>
 to store all the birthdays. To do this, give the <span class="code">BirthdaysTableViewController</span>
 a <span class="code">birthdays</span>
 property that is an array of <span class="code">Birthday</span>
 objects. At the top of the class, right above the <span class="code">viewDidLoad()</span>
 method, insert this line to add a variable array property called <span class="code">birthdays</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController {</span>
<br />
<br />
    <span class="pink">var</span>
 birthdays = [<span class="green1">Birthday</span>
 ]()<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent">This line creates an empty array of <span class="code">Birthday</span>
 instances. It needs to be a variable and not a constant because you’ll want to add a saved <span class="code">Birthday</span>
 to this array every time the user adds a <span class="code">Birthday</span>
 with the Add Birthday view controller. You’ll see how to do that in “<a href="text00022.html#ch11lev3sec2">Making the Birthdays Table View Controller Conform to Protocol</a>
 ” on <a href="text00022.html#page_168">page 168</a>
 .</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>Remember that the final versions of the project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>.</em>
</p>
</div>
<p class="indent">The <span class="code">BirthdaysTableViewController</span>
 will also need a <span class="code">dateFormatter</span>
 property to display the birthdate as a nicely formatted string. Add a <span class="code">dateFormatter</span>
 right underneath the <span class="code">birthdays</span>
 array:</p>
<div class="box">
<pre>    <span class="ash">var birthdays = [Birthday]()</span>
<br />
<br />
    <span class="pink">let</span>
 dateFormatter = <span class="violet">DateFormatter</span>
 ()<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent">Note that the <span class="code">dateFormatter</span>
 is a constant that is created with <span class="code">let</span>
 . Even though you’ll change the <span class="code">dateFormatter</span>
 ’s properties, like the <span class="code">dateStyle</span>
 and <span class="code">timeStyle</span>
 , you’ll never change the <span class="code">dateFormatter</span>
 itself.</p>
<p class="indent"><span id="page_162"></span>
 You’ll also need to set up the <span class="code">dateFormatter</span>
 so that it will display the birthdates as fully formatted strings like <span class="code">"Tuesday, December 17, 2008"</span>
 . As you saw in <a href="text00021.html#ch10">Chapter 10</a>
 , a good place to do this is the <span class="code">viewDidLoad()</span>
 method, which is called when the Birthdays table view controller is loading its view. This is the perfect place to do any setup that is needed for this class.</p>
<div class="box">
<pre>
<span class="ash">override func viewDidLoad() {</span>
<br />
    <span class="ash">super.viewDidLoad()</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">dateFormatter</span>
 .<span class="violet">dateStyle</span>
 = .<span class="blue">full</span>
<br />
  <span class="ent">➋</span>
 <span class="green1">dateFormatter</span>
 .<span class="violet">timeStyle</span>
 = .<span class="blue">none</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , you set the <span class="code">dateStyle</span>
 of the <span class="code">dateFormatter</span>
 so that it will display a formatted date string for each <span class="code">Birthday</span>
 . Did you notice how we just wrote <span class="code">.full</span>
 instead of <span class="code">DateFormatter.Style.full</span>
 ? Swift knows what type to expect for the <span class="code">dateStyle</span>
 of a <span class="code">DateFormatter</span>
 , so it lets us take this little shortcut. At <span class="ent">➋</span>
 , you set the <span class="code">timeStyle</span>
 of the <span class="code">dateFormatter</span>
 to <span class="code">.none</span>
 so that the time won’t be shown.</p>
<h4 class="h4" id="ch11lev2sec4">
<strong>DISPLAYING BIRTHDAYS IN A TABLE VIEW</strong>
</h4>
<p class="noindent">The <span class="code">BirthdaysTableViewController</span>
 class has a table view that is used to display a list of items in a single column. The table view has one or more sections containing rows, and each row contains a cell. A section in a table view is a grouping of rows that can be displayed with or without a header. An example of an app that shows a table view with several sections is the Settings app, as shown in <a href="text00022.html#ch11fig5">Figure 11-5</a>
 . It displays a list of rows that have been broken up into different sections.</p>
<p class="indent">Each section and row of a table view is identified with an index number. These numbers start at 0 and then increase by 1 as you go down the table view. For example, the Privacy line in the Settings app is found at section 0, row 1. The News setting is at section 1, row 3.</p>
<p class="indent">In the middle of the <span class="code">BirthdaysTableViewController</span>
 class, there is a section called <em>Table view data source</em>
 with three methods. The table view controller uses these methods to determine what’s going to be displayed inside its table view.</p>
<p class="hang">
<span class="code">
<span class="codestrong">numberOfSections(in:)</span>
</span>
 Tells the table view how many sections it should have</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:numberOfRowsInSection:)</span>
</span>
 Tells the table view how many rows will be displayed in each section</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:cellForRowAt:)</span>
</span>
 Sets up each cell that’s going to be displayed in each row of the table view</p>
<div class="image"><span id="page_163"></span>
 <img src="Image00243.jpg" />
</div>
<p class="figcap"><a id="ch11fig5"></a>
 <em>Figure 11-5: The Settings app uses sections to group rows of different device settings.</em>
</p>
<p class="indent">The table view data source methods are called by the table view controller every time the table view is reloaded. Xcode automatically gives you these method templates when you make a subclass of a <span class="code">UITableViewController</span>
 . You need to implement all three methods for the app to work, even though you’ll never call them directly in your code. The <span class="code">UITableViewController</span>
 class implements the <span class="code">UITableViewDataSource</span>
 protocol, which comes with these data source methods, to determine what will be displayed inside the table view. We’ll discuss protocols in “<a href="text00022.html#ch11lev2sec5">Delegation</a>
 ” on page 166. For now, you just need to know that a <span class="code">UITableViewController</span>
 uses these methods to display its content, and it automatically calls these methods so you don’t need to call them.</p>
<p class="indent">Let’s start with the method <span class="code">numberOfSections(in:)</span>
 . The Birthdays table view controller is a list that just displays <span class="code">Birthday</span>
 instances, so it doesn’t need multiple sections. To set the number of sections in the table view, we just need to return <span class="code">1</span>
 .</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func numberOfSections(in tableView: UITableView) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 <span class="blue1">1</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent"><span id="page_164"></span>
 This method takes a <span class="code">UITableView</span>
 called <span class="code">tableView</span>
 as a parameter, which is the table view that uses this class as its data source. We don’t need to worry about making this connection because the <span class="code">UITableViewController</span>
 comes with a built-in table view that is automatically hooked up to these methods. Each birthday will be displayed in its own row. So in <span class="code">tableView(_:numberOfRowsInSection:)</span>
 , in order to have the right number of rows for all of your birthdays, you need to return the number of <span class="code">Birthday</span>
 instances that you have in your <span class="code">birthdays</span>
 array. Do you remember the <span class="code">count</span>
 property of an array? It’s an integer that tells you how many items are in that array, and it’s perfect for this situation! Change this method to the following:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, <img class="inline" src="Image00184.jpg" />
<br />
    numberOfRowsInSection section: Int) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 birthdays.<span class="violet">count</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">In addition to the <span class="code">tableView</span>
 parameter, <span class="code">tableView(_:numberOfRowsInSection:)</span>
 also takes an <span class="code">Int</span>
 called <span class="code">section</span>
 . When the table view is loading itself, this method is called for each section in the table view. In our case, we have only one section, so we don’t need to bother checking which <span class="code">section</span>
 of the table view is being displayed here. We know it’s section 0, and we want it to have as many rows as there are birthdays, so we write <span class="code">return birthdays.count</span>
 .</p>
<p class="indent">Finally, you need to implement <span class="code">tableView(_:cellForRowAt:)</span>
 so that the table view will know what to put inside each cell. Since this method is commented out, you need to uncomment it by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it. (Be careful not to accidentally uncomment the other methods after it!) After you’ve done that, change it to the following code:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, cellForRowAt <img class="inline" src="Image00184.jpg" />
<br />
    indexPath: IndexPath) -&gt; UITableViewCell {</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="pink">let</span>
 cell = tableView.<span class="blue">dequeueReusableCell</span>
 (withIdentifier: <img class="inline" src="Image00093.jpg" />
<br />
        <span class="red">"birthdayCellIdentifier"</span>
 , for: indexPath)<br />
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 birthday = <span class="green1">birthdays</span>
 [indexPath.<span class="violet">row</span>
 ]<br />
<br />
  <span class="ent">➌</span>
 cell.<span class="violet">textLabel</span>
 ?.<span class="violet">text</span>
 = birthday.<span class="green1">firstName</span>
 <span class="blue">+</span>
 <span class="red">" "</span>
 <span class="blue">+</span>
 <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">lastName</span>
<br />
<br />
  <span class="ent">➍</span>
 cell.<span class="violet">detailTextLabel</span>
 ?.<span class="violet">text</span>
 = <span class="green1">dateFormatter</span>
 .<span class="blue">string</span>
 (from: <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">birthdate</span>
 )<br />
<br />
  <span class="ent">➎</span>
 <span class="pink">return</span>
 cell<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">You don’t call the method <span class="code">tableView(_:cellForRowAt:)</span>
 . It’s called when the table view is loaded onto the screen. It’s called for each cell on the screen and takes two parameters, <span class="code">tableView</span>
 and <span class="code">indexPath</span>
 . You already know <span id="page_165"></span>
 what the <span class="code">tableView</span>
 parameter is for. An <span class="code">IndexPath</span>
 is a Swift struct that’s used to represent a row’s position in a table view. An <span class="code">IndexPath</span>
 instance has a <span class="code">section</span>
 property and a <span class="code">row</span>
 property. Since this method will be called many times (once for every row in the table), we need the <span class="code">indexPath</span>
 to know which section and row we’re currently configuring. The <span class="code">indexPath.section</span>
 property gives the section number, and the <span class="code">indexPath.row</span>
 gives the row of the table view cell. The five lines of code inside <span class="code">tableView(_:cellForRowAt:)</span>
 will do the following:</p>
<div class="image"><img src="Image00244.jpg" />
</div>
<p class="bull">• Create a <span class="code">UITableViewCell</span>
</p>
<p class="bull">• Figure out which <span class="code">Birthday</span>
 in the <span class="code">birthdays</span>
 array will be displayed inside the cell</p>
<p class="bull">• Make two labels to display the birthday person’s name and birthdate in the cell</p>
<p class="bull">• Return the cell ready for display in the table view</p>
<p class="indentt">Let’s go through this code line by line.</p>
<p class="indent">First, create the <span class="code">UITableViewCell</span>
 . The code at <span class="ent">➊</span>
 does this using the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 . Before you can start using this method on a cell, though, you need to tell the method which cell you want to use from the storyboard. Earlier, when you were in the storyboard, you gave your cell the identifier <span class="code">birthdayCellIdentifier</span>
 (see <a href="text00022.html#ch11fig4">Figure 11-4</a>
 ). This identifier links your code to the cell and tells your method that it’s using the right cell. The string for when you call this method needs to be exactly the same as the string you set in the storyboard, or you’ll get an error and the app will crash when you run it.</p>
<p class="indent">In the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 , did you notice the words <em>Reusable Cell</em>
 ? The cells inside a table view are created once and then can be reused over and over. This helps everything run faster and smoother because creating the cell is what takes the most time. If you had 200 birthdays in your app, but only 10 would fit on your screen at one time, then you need only 10 cells to show your birthdays. When you scroll down to reveal more birthdays, the cells that scroll off the top of the screen are reused. They are filled with new information and show up again at the bottom of the screen. The <span class="code">UITableView</span>
 automatically does this work. When the table view is loaded, <span class="code">tableView(_:cellForRowAt:)</span>
 is called for every visible row. When the user scrolls to look at more cells, it’s called again for each row just as it is about to appear on the screen.</p>
<p class="indent">Next, we need to find out which <span class="code">Birthday</span>
 should be displayed inside the cell. We want to display one birthday from the <span class="code">birthdays</span>
 array in each row. The first birthday, which is at <span class="code">birthdays[0]</span>
 , should be displayed in row 0. The second birthday, at <span class="code">birthdays[1]</span>
 , should be displayed in row 1, and so on, which means the <span class="code">indexPath</span>
 ’s <span class="code">row</span>
 is the same as the position in the <span class="code">birthdays</span>
 array that we want to access. The code at <span class="ent">➋</span>
 accesses the <span id="page_166"></span>
 correct <span class="code">Birthday</span>
 object from the <span class="code">birthdays</span>
 array by using <span class="code">indexPath.row</span>
 . Once we have the right <span class="code">Birthday</span>
 object, we assign it to a constant named <span class="code">birthday</span>
 so we can set up the labels in this cell.</p>
<p class="indent">Notice that we’re using <span class="code">let</span>
 to assign the <span class="code">birthday</span>
 to a constant instead of a variable. We can use <span class="code">let</span>
 because each time <span class="code">tableView(_:cellForRowAt:)</span>
 is called, a new <span class="code">birthday</span>
 constant is created. Each cell gets its own <span class="code">birthday</span>
 constant that is assigned its own <span class="code">Birthday</span>
 object. Since we’re not going to change any of the <span class="code">birthday</span>
 constants—we’re just going to read their properties—we don’t want to make them variables.</p>
<p class="indent">Now that you have your cell and your birthday, it’s time to fill in the details. You need two labels for each cell to show the birthday person’s name and birthdate. You set the cell to the Subtitle style so that it has a Title label and a Subtitle label. Each cell will already contain these labels, so now you don’t have to create any labels yourself.</p>
<p class="indent">The labels exist as properties of <span class="code">UITableViewCell</span>
 and are called <span class="code">textLabel</span>
 and <span class="code">detailTextLabel</span>
 . The code at <span class="ent">➌</span>
 sets the text of the <span class="code">textLabel</span>
 to a string made up of the <span class="code">firstName</span>
 and <span class="code">lastName</span>
 of the <span class="code">birthday</span>
 with a space between them. At <span class="ent">➍</span>
 , you use the <span class="code">string(from:)</span>
 method of the <span class="code">dateFormatter</span>
 to display the birthdate in the <span class="code">detailTextLabel</span>
 .</p>
<p class="indent">When your cell is completely configured, <span class="code">tableView( _:cellForRowAt:)</span>
 returns the cell at <span class="ent">➎</span>
 so that it can be displayed at that <span class="code">indexPath</span>
 of the table view.</p>
<h3 class="h3" id="ch11lev1sec2">
<strong>PUTTING IT ALL TOGETHER</strong>
</h3>
<p class="noindent">Now you can add <span class="code">Birthday</span>
 instances to the app using the Add Birthday view controller, and you have a table view to list each <span class="code">Birthday</span>
 in the Birthdays table view controller. But when you try running the app and adding a <span class="code">Birthday</span>
 , it doesn’t appear. To make each <span class="code">Birthday</span>
 you add appear in the table view, you need to make the Add Birthday view controller communicate with the Birthdays table view controller. You do this by using <em>delegation</em>
 .</p>
<h4 class="h4" id="ch11lev2sec5">
<strong>DELEGATION</strong>
</h4>
<p class="noindent">Delegation can be used when one view controller needs to get information from another view controller. Say you have two view controllers: A and B. The first view controller, A, creates B and presents B on top of itself. A knows about B because it created and presented B, so A can pass information along to B. But B doesn’t know about A—it’s just popped into being and doesn’t know where it came from or how it got there. So how can B talk to A? Through delegation!</p>
<div class="image"><img src="Image00245.jpg" />
</div>
<p class="indent">Delegation is when someone gives a job or a task to someone else. A <em>delegate</em>
 is like a boss who tells a delegating employee what to do. When the delegating employee is done with their task, sometimes they’ll report information back to the delegate boss.</p>
<p class="indent"><span id="page_167"></span>
 Delegation in Swift is pretty similar, but instead of having a boss and employee, we have a delegate and a delegating object. Since class B is the one being told what to do by class A, it’s the delegating object. We give class B a special property called a delegate to tell it who its delegate is—that way, it knows who to communicate with. The delegate can be any class that has a set of methods that have been defined in a <em>protocol</em>
 . A protocol is like an agreement between the two classes that tells them what the delegate can ask the delegating object to do. It has a list of method and property names that the delegate can use with the delegating object.</p>
<p class="indent">Class A creates class B, makes itself the delegate of class B, and gives class B a job to do that’s in the protocol. Once class B is done with its job, it reports back to class A. Let’s see how this works in our app.</p>
<p class="indent">The Birthdays table view controller is view controller A, and the Add Birthday view controller is view controller B. We’ll create a protocol called <span class="code">AddBirthdayViewControllerDelegate</span>
 and a method for that protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 , which the Add Birthday view controller will use to report back.</p>
<p class="indent">Take a look at <a href="text00022.html#ch11fig6">Figure 11-6</a>
 . When the user taps the Add button <span class="ent">➊</span>
 , the Birthdays table view controller creates the Add Birthday view controller <span class="ent">➋</span>
 and sets itself as the Add Birthday view controller’s delegate.</p>
<div class="image"><img src="Image00246.jpg" />
</div>
<p class="figcap"><a id="ch11fig6"></a>
 <em>Figure 11-6: A new birthday is added and passed from the Add Birthday view controller to the Birthdays table view controller using delegation.</em>
</p>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<h4 class="h4" id="ch11lev2sec3">
<strong>SETTING UP THE BIRTHDAYS TABLE VIEW CONTROLLER</strong>
</h4>
<p class="noindent">The Birthdays table view controller will display a list of all the birthdays stored in the app. Do you remember what you use to store a list of items? That’s right—an array! You’ll create an array in the <span class="code">BirthdaysTableViewController</span>
 to store all the birthdays. To do this, give the <span class="code">BirthdaysTableViewController</span>
 a <span class="code">birthdays</span>
 property that is an array of <span class="code">Birthday</span>
 objects. At the top of the class, right above the <span class="code">viewDidLoad()</span>
 method, insert this line to add a variable array property called <span class="code">birthdays</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController {</span>
<br />
<br />
    <span class="pink">var</span>
 birthdays = [<span class="green1">Birthday</span>
 ]()<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent">This line creates an empty array of <span class="code">Birthday</span>
 instances. It needs to be a variable and not a constant because you’ll want to add a saved <span class="code">Birthday</span>
 to this array every time the user adds a <span class="code">Birthday</span>
 with the Add Birthday view controller. You’ll see how to do that in “<a href="text00022.html#ch11lev3sec2">Making the Birthdays Table View Controller Conform to Protocol</a>
 ” on <a href="text00022.html#page_168">page 168</a>
 .</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>Remember that the final versions of the project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>.</em>
</p>
</div>
<p class="indent">The <span class="code">BirthdaysTableViewController</span>
 will also need a <span class="code">dateFormatter</span>
 property to display the birthdate as a nicely formatted string. Add a <span class="code">dateFormatter</span>
 right underneath the <span class="code">birthdays</span>
 array:</p>
<div class="box">
<pre>    <span class="ash">var birthdays = [Birthday]()</span>
<br />
<br />
    <span class="pink">let</span>
 dateFormatter = <span class="violet">DateFormatter</span>
 ()<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent">Note that the <span class="code">dateFormatter</span>
 is a constant that is created with <span class="code">let</span>
 . Even though you’ll change the <span class="code">dateFormatter</span>
 ’s properties, like the <span class="code">dateStyle</span>
 and <span class="code">timeStyle</span>
 , you’ll never change the <span class="code">dateFormatter</span>
 itself.</p>
<p class="indent"><span id="page_162"></span>
 You’ll also need to set up the <span class="code">dateFormatter</span>
 so that it will display the birthdates as fully formatted strings like <span class="code">"Tuesday, December 17, 2008"</span>
 . As you saw in <a href="text00021.html#ch10">Chapter 10</a>
 , a good place to do this is the <span class="code">viewDidLoad()</span>
 method, which is called when the Birthdays table view controller is loading its view. This is the perfect place to do any setup that is needed for this class.</p>
<div class="box">
<pre>
<span class="ash">override func viewDidLoad() {</span>
<br />
    <span class="ash">super.viewDidLoad()</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">dateFormatter</span>
 .<span class="violet">dateStyle</span>
 = .<span class="blue">full</span>
<br />
  <span class="ent">➋</span>
 <span class="green1">dateFormatter</span>
 .<span class="violet">timeStyle</span>
 = .<span class="blue">none</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , you set the <span class="code">dateStyle</span>
 of the <span class="code">dateFormatter</span>
 so that it will display a formatted date string for each <span class="code">Birthday</span>
 . Did you notice how we just wrote <span class="code">.full</span>
 instead of <span class="code">DateFormatter.Style.full</span>
 ? Swift knows what type to expect for the <span class="code">dateStyle</span>
 of a <span class="code">DateFormatter</span>
 , so it lets us take this little shortcut. At <span class="ent">➋</span>
 , you set the <span class="code">timeStyle</span>
 of the <span class="code">dateFormatter</span>
 to <span class="code">.none</span>
 so that the time won’t be shown.</p>
<h4 class="h4" id="ch11lev2sec4">
<strong>DISPLAYING BIRTHDAYS IN A TABLE VIEW</strong>
</h4>
<p class="noindent">The <span class="code">BirthdaysTableViewController</span>
 class has a table view that is used to display a list of items in a single column. The table view has one or more sections containing rows, and each row contains a cell. A section in a table view is a grouping of rows that can be displayed with or without a header. An example of an app that shows a table view with several sections is the Settings app, as shown in <a href="text00022.html#ch11fig5">Figure 11-5</a>
 . It displays a list of rows that have been broken up into different sections.</p>
<p class="indent">Each section and row of a table view is identified with an index number. These numbers start at 0 and then increase by 1 as you go down the table view. For example, the Privacy line in the Settings app is found at section 0, row 1. The News setting is at section 1, row 3.</p>
<p class="indent">In the middle of the <span class="code">BirthdaysTableViewController</span>
 class, there is a section called <em>Table view data source</em>
 with three methods. The table view controller uses these methods to determine what’s going to be displayed inside its table view.</p>
<p class="hang">
<span class="code">
<span class="codestrong">numberOfSections(in:)</span>
</span>
 Tells the table view how many sections it should have</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:numberOfRowsInSection:)</span>
</span>
 Tells the table view how many rows will be displayed in each section</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:cellForRowAt:)</span>
</span>
 Sets up each cell that’s going to be displayed in each row of the table view</p>
<div class="image"><span id="page_163"></span>
 <img src="Image00243.jpg" />
</div>
<p class="figcap"><a id="ch11fig5"></a>
 <em>Figure 11-5: The Settings app uses sections to group rows of different device settings.</em>
</p>
<p class="indent">The table view data source methods are called by the table view controller every time the table view is reloaded. Xcode automatically gives you these method templates when you make a subclass of a <span class="code">UITableViewController</span>
 . You need to implement all three methods for the app to work, even though you’ll never call them directly in your code. The <span class="code">UITableViewController</span>
 class implements the <span class="code">UITableViewDataSource</span>
 protocol, which comes with these data source methods, to determine what will be displayed inside the table view. We’ll discuss protocols in “<a href="text00022.html#ch11lev2sec5">Delegation</a>
 ” on page 166. For now, you just need to know that a <span class="code">UITableViewController</span>
 uses these methods to display its content, and it automatically calls these methods so you don’t need to call them.</p>
<p class="indent">Let’s start with the method <span class="code">numberOfSections(in:)</span>
 . The Birthdays table view controller is a list that just displays <span class="code">Birthday</span>
 instances, so it doesn’t need multiple sections. To set the number of sections in the table view, we just need to return <span class="code">1</span>
 .</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func numberOfSections(in tableView: UITableView) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 <span class="blue1">1</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent"><span id="page_164"></span>
 This method takes a <span class="code">UITableView</span>
 called <span class="code">tableView</span>
 as a parameter, which is the table view that uses this class as its data source. We don’t need to worry about making this connection because the <span class="code">UITableViewController</span>
 comes with a built-in table view that is automatically hooked up to these methods. Each birthday will be displayed in its own row. So in <span class="code">tableView(_:numberOfRowsInSection:)</span>
 , in order to have the right number of rows for all of your birthdays, you need to return the number of <span class="code">Birthday</span>
 instances that you have in your <span class="code">birthdays</span>
 array. Do you remember the <span class="code">count</span>
 property of an array? It’s an integer that tells you how many items are in that array, and it’s perfect for this situation! Change this method to the following:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, <img class="inline" src="Image00184.jpg" />
<br />
    numberOfRowsInSection section: Int) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 birthdays.<span class="violet">count</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">In addition to the <span class="code">tableView</span>
 parameter, <span class="code">tableView(_:numberOfRowsInSection:)</span>
 also takes an <span class="code">Int</span>
 called <span class="code">section</span>
 . When the table view is loading itself, this method is called for each section in the table view. In our case, we have only one section, so we don’t need to bother checking which <span class="code">section</span>
 of the table view is being displayed here. We know it’s section 0, and we want it to have as many rows as there are birthdays, so we write <span class="code">return birthdays.count</span>
 .</p>
<p class="indent">Finally, you need to implement <span class="code">tableView(_:cellForRowAt:)</span>
 so that the table view will know what to put inside each cell. Since this method is commented out, you need to uncomment it by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it. (Be careful not to accidentally uncomment the other methods after it!) After you’ve done that, change it to the following code:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, cellForRowAt <img class="inline" src="Image00184.jpg" />
<br />
    indexPath: IndexPath) -&gt; UITableViewCell {</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="pink">let</span>
 cell = tableView.<span class="blue">dequeueReusableCell</span>
 (withIdentifier: <img class="inline" src="Image00093.jpg" />
<br />
        <span class="red">"birthdayCellIdentifier"</span>
 , for: indexPath)<br />
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 birthday = <span class="green1">birthdays</span>
 [indexPath.<span class="violet">row</span>
 ]<br />
<br />
  <span class="ent">➌</span>
 cell.<span class="violet">textLabel</span>
 ?.<span class="violet">text</span>
 = birthday.<span class="green1">firstName</span>
 <span class="blue">+</span>
 <span class="red">" "</span>
 <span class="blue">+</span>
 <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">lastName</span>
<br />
<br />
  <span class="ent">➍</span>
 cell.<span class="violet">detailTextLabel</span>
 ?.<span class="violet">text</span>
 = <span class="green1">dateFormatter</span>
 .<span class="blue">string</span>
 (from: <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">birthdate</span>
 )<br />
<br />
  <span class="ent">➎</span>
 <span class="pink">return</span>
 cell<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">You don’t call the method <span class="code">tableView(_:cellForRowAt:)</span>
 . It’s called when the table view is loaded onto the screen. It’s called for each cell on the screen and takes two parameters, <span class="code">tableView</span>
 and <span class="code">indexPath</span>
 . You already know <span id="page_165"></span>
 what the <span class="code">tableView</span>
 parameter is for. An <span class="code">IndexPath</span>
 is a Swift struct that’s used to represent a row’s position in a table view. An <span class="code">IndexPath</span>
 instance has a <span class="code">section</span>
 property and a <span class="code">row</span>
 property. Since this method will be called many times (once for every row in the table), we need the <span class="code">indexPath</span>
 to know which section and row we’re currently configuring. The <span class="code">indexPath.section</span>
 property gives the section number, and the <span class="code">indexPath.row</span>
 gives the row of the table view cell. The five lines of code inside <span class="code">tableView(_:cellForRowAt:)</span>
 will do the following:</p>
<div class="image"><img src="Image00244.jpg" />
</div>
<p class="bull">• Create a <span class="code">UITableViewCell</span>
</p>
<p class="bull">• Figure out which <span class="code">Birthday</span>
 in the <span class="code">birthdays</span>
 array will be displayed inside the cell</p>
<p class="bull">• Make two labels to display the birthday person’s name and birthdate in the cell</p>
<p class="bull">• Return the cell ready for display in the table view</p>
<p class="indentt">Let’s go through this code line by line.</p>
<p class="indent">First, create the <span class="code">UITableViewCell</span>
 . The code at <span class="ent">➊</span>
 does this using the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 . Before you can start using this method on a cell, though, you need to tell the method which cell you want to use from the storyboard. Earlier, when you were in the storyboard, you gave your cell the identifier <span class="code">birthdayCellIdentifier</span>
 (see <a href="text00022.html#ch11fig4">Figure 11-4</a>
 ). This identifier links your code to the cell and tells your method that it’s using the right cell. The string for when you call this method needs to be exactly the same as the string you set in the storyboard, or you’ll get an error and the app will crash when you run it.</p>
<p class="indent">In the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 , did you notice the words <em>Reusable Cell</em>
 ? The cells inside a table view are created once and then can be reused over and over. This helps everything run faster and smoother because creating the cell is what takes the most time. If you had 200 birthdays in your app, but only 10 would fit on your screen at one time, then you need only 10 cells to show your birthdays. When you scroll down to reveal more birthdays, the cells that scroll off the top of the screen are reused. They are filled with new information and show up again at the bottom of the screen. The <span class="code">UITableView</span>
 automatically does this work. When the table view is loaded, <span class="code">tableView(_:cellForRowAt:)</span>
 is called for every visible row. When the user scrolls to look at more cells, it’s called again for each row just as it is about to appear on the screen.</p>
<p class="indent">Next, we need to find out which <span class="code">Birthday</span>
 should be displayed inside the cell. We want to display one birthday from the <span class="code">birthdays</span>
 array in each row. The first birthday, which is at <span class="code">birthdays[0]</span>
 , should be displayed in row 0. The second birthday, at <span class="code">birthdays[1]</span>
 , should be displayed in row 1, and so on, which means the <span class="code">indexPath</span>
 ’s <span class="code">row</span>
 is the same as the position in the <span class="code">birthdays</span>
 array that we want to access. The code at <span class="ent">➋</span>
 accesses the <span id="page_166"></span>
 correct <span class="code">Birthday</span>
 object from the <span class="code">birthdays</span>
 array by using <span class="code">indexPath.row</span>
 . Once we have the right <span class="code">Birthday</span>
 object, we assign it to a constant named <span class="code">birthday</span>
 so we can set up the labels in this cell.</p>
<p class="indent">Notice that we’re using <span class="code">let</span>
 to assign the <span class="code">birthday</span>
 to a constant instead of a variable. We can use <span class="code">let</span>
 because each time <span class="code">tableView(_:cellForRowAt:)</span>
 is called, a new <span class="code">birthday</span>
 constant is created. Each cell gets its own <span class="code">birthday</span>
 constant that is assigned its own <span class="code">Birthday</span>
 object. Since we’re not going to change any of the <span class="code">birthday</span>
 constants—we’re just going to read their properties—we don’t want to make them variables.</p>
<p class="indent">Now that you have your cell and your birthday, it’s time to fill in the details. You need two labels for each cell to show the birthday person’s name and birthdate. You set the cell to the Subtitle style so that it has a Title label and a Subtitle label. Each cell will already contain these labels, so now you don’t have to create any labels yourself.</p>
<p class="indent">The labels exist as properties of <span class="code">UITableViewCell</span>
 and are called <span class="code">textLabel</span>
 and <span class="code">detailTextLabel</span>
 . The code at <span class="ent">➌</span>
 sets the text of the <span class="code">textLabel</span>
 to a string made up of the <span class="code">firstName</span>
 and <span class="code">lastName</span>
 of the <span class="code">birthday</span>
 with a space between them. At <span class="ent">➍</span>
 , you use the <span class="code">string(from:)</span>
 method of the <span class="code">dateFormatter</span>
 to display the birthdate in the <span class="code">detailTextLabel</span>
 .</p>
<p class="indent">When your cell is completely configured, <span class="code">tableView( _:cellForRowAt:)</span>
 returns the cell at <span class="ent">➎</span>
 so that it can be displayed at that <span class="code">indexPath</span>
 of the table view.</p>
<h3 class="h3" id="ch11lev1sec2">
<strong>PUTTING IT ALL TOGETHER</strong>
</h3>
<p class="noindent">Now you can add <span class="code">Birthday</span>
 instances to the app using the Add Birthday view controller, and you have a table view to list each <span class="code">Birthday</span>
 in the Birthdays table view controller. But when you try running the app and adding a <span class="code">Birthday</span>
 , it doesn’t appear. To make each <span class="code">Birthday</span>
 you add appear in the table view, you need to make the Add Birthday view controller communicate with the Birthdays table view controller. You do this by using <em>delegation</em>
 .</p>
<h4 class="h4" id="ch11lev2sec5">
<strong>DELEGATION</strong>
</h4>
<p class="noindent">Delegation can be used when one view controller needs to get information from another view controller. Say you have two view controllers: A and B. The first view controller, A, creates B and presents B on top of itself. A knows about B because it created and presented B, so A can pass information along to B. But B doesn’t know about A—it’s just popped into being and doesn’t know where it came from or how it got there. So how can B talk to A? Through delegation!</p>
<div class="image"><img src="Image00245.jpg" />
</div>
<p class="indent">Delegation is when someone gives a job or a task to someone else. A <em>delegate</em>
 is like a boss who tells a delegating employee what to do. When the delegating employee is done with their task, sometimes they’ll report information back to the delegate boss.</p>
<p class="indent"><span id="page_167"></span>
 Delegation in Swift is pretty similar, but instead of having a boss and employee, we have a delegate and a delegating object. Since class B is the one being told what to do by class A, it’s the delegating object. We give class B a special property called a delegate to tell it who its delegate is—that way, it knows who to communicate with. The delegate can be any class that has a set of methods that have been defined in a <em>protocol</em>
 . A protocol is like an agreement between the two classes that tells them what the delegate can ask the delegating object to do. It has a list of method and property names that the delegate can use with the delegating object.</p>
<p class="indent">Class A creates class B, makes itself the delegate of class B, and gives class B a job to do that’s in the protocol. Once class B is done with its job, it reports back to class A. Let’s see how this works in our app.</p>
<p class="indent">The Birthdays table view controller is view controller A, and the Add Birthday view controller is view controller B. We’ll create a protocol called <span class="code">AddBirthdayViewControllerDelegate</span>
 and a method for that protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 , which the Add Birthday view controller will use to report back.</p>
<p class="indent">Take a look at <a href="text00022.html#ch11fig6">Figure 11-6</a>
 . When the user taps the Add button <span class="ent">➊</span>
 , the Birthdays table view controller creates the Add Birthday view controller <span class="ent">➋</span>
 and sets itself as the Add Birthday view controller’s delegate.</p>
<div class="image"><img src="Image00246.jpg" />
</div>
<p class="figcap"><a id="ch11fig6"></a>
 <em>Figure 11-6: A new birthday is added and passed from the Add Birthday view controller to the Birthdays table view controller using delegation.</em>
</p>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="noindent">The Birthdays table view controller will display a list of all the birthdays stored in the app. Do you remember what you use to store a list of items? That’s right—an array! You’ll create an array in the <span class="code">BirthdaysTableViewController</span>
 to store all the birthdays. To do this, give the <span class="code">BirthdaysTableViewController</span>
 a <span class="code">birthdays</span>
 property that is an array of <span class="code">Birthday</span>
 objects. At the top of the class, right above the <span class="code">viewDidLoad()</span>
 method, insert this line to add a variable array property called <span class="code">birthdays</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController {</span>
<br />
<br />
    <span class="pink">var</span>
 birthdays = [<span class="green1">Birthday</span>
 ]()<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent">This line creates an empty array of <span class="code">Birthday</span>
 instances. It needs to be a variable and not a constant because you’ll want to add a saved <span class="code">Birthday</span>
 to this array every time the user adds a <span class="code">Birthday</span>
 with the Add Birthday view controller. You’ll see how to do that in “<a href="text00022.html#ch11lev3sec2">Making the Birthdays Table View Controller Conform to Protocol</a>
 ” on <a href="text00022.html#page_168">page 168</a>
 .</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>Remember that the final versions of the project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>.</em>
</p>
</div>
<p class="indent">The <span class="code">BirthdaysTableViewController</span>
 will also need a <span class="code">dateFormatter</span>
 property to display the birthdate as a nicely formatted string. Add a <span class="code">dateFormatter</span>
 right underneath the <span class="code">birthdays</span>
 array:</p>
<div class="box">
<pre>    <span class="ash">var birthdays = [Birthday]()</span>
<br />
<br />
    <span class="pink">let</span>
 dateFormatter = <span class="violet">DateFormatter</span>
 ()<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent">Note that the <span class="code">dateFormatter</span>
 is a constant that is created with <span class="code">let</span>
 . Even though you’ll change the <span class="code">dateFormatter</span>
 ’s properties, like the <span class="code">dateStyle</span>
 and <span class="code">timeStyle</span>
 , you’ll never change the <span class="code">dateFormatter</span>
 itself.</p>
<p class="indent"><span id="page_162"></span>
 You’ll also need to set up the <span class="code">dateFormatter</span>
 so that it will display the birthdates as fully formatted strings like <span class="code">"Tuesday, December 17, 2008"</span>
 . As you saw in <a href="text00021.html#ch10">Chapter 10</a>
 , a good place to do this is the <span class="code">viewDidLoad()</span>
 method, which is called when the Birthdays table view controller is loading its view. This is the perfect place to do any setup that is needed for this class.</p>
<div class="box">
<pre>
<span class="ash">override func viewDidLoad() {</span>
<br />
    <span class="ash">super.viewDidLoad()</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">dateFormatter</span>
 .<span class="violet">dateStyle</span>
 = .<span class="blue">full</span>
<br />
  <span class="ent">➋</span>
 <span class="green1">dateFormatter</span>
 .<span class="violet">timeStyle</span>
 = .<span class="blue">none</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , you set the <span class="code">dateStyle</span>
 of the <span class="code">dateFormatter</span>
 so that it will display a formatted date string for each <span class="code">Birthday</span>
 . Did you notice how we just wrote <span class="code">.full</span>
 instead of <span class="code">DateFormatter.Style.full</span>
 ? Swift knows what type to expect for the <span class="code">dateStyle</span>
 of a <span class="code">DateFormatter</span>
 , so it lets us take this little shortcut. At <span class="ent">➋</span>
 , you set the <span class="code">timeStyle</span>
 of the <span class="code">dateFormatter</span>
 to <span class="code">.none</span>
 so that the time won’t be shown.</p>
<h4 class="h4" id="ch11lev2sec4">
<strong>DISPLAYING BIRTHDAYS IN A TABLE VIEW</strong>
</h4>
<p class="noindent">The <span class="code">BirthdaysTableViewController</span>
 class has a table view that is used to display a list of items in a single column. The table view has one or more sections containing rows, and each row contains a cell. A section in a table view is a grouping of rows that can be displayed with or without a header. An example of an app that shows a table view with several sections is the Settings app, as shown in <a href="text00022.html#ch11fig5">Figure 11-5</a>
 . It displays a list of rows that have been broken up into different sections.</p>
<p class="indent">Each section and row of a table view is identified with an index number. These numbers start at 0 and then increase by 1 as you go down the table view. For example, the Privacy line in the Settings app is found at section 0, row 1. The News setting is at section 1, row 3.</p>
<p class="indent">In the middle of the <span class="code">BirthdaysTableViewController</span>
 class, there is a section called <em>Table view data source</em>
 with three methods. The table view controller uses these methods to determine what’s going to be displayed inside its table view.</p>
<p class="hang">
<span class="code">
<span class="codestrong">numberOfSections(in:)</span>
</span>
 Tells the table view how many sections it should have</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:numberOfRowsInSection:)</span>
</span>
 Tells the table view how many rows will be displayed in each section</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:cellForRowAt:)</span>
</span>
 Sets up each cell that’s going to be displayed in each row of the table view</p>
<div class="image"><span id="page_163"></span>
 <img src="Image00243.jpg" />
</div>
<p class="figcap"><a id="ch11fig5"></a>
 <em>Figure 11-5: The Settings app uses sections to group rows of different device settings.</em>
</p>
<p class="indent">The table view data source methods are called by the table view controller every time the table view is reloaded. Xcode automatically gives you these method templates when you make a subclass of a <span class="code">UITableViewController</span>
 . You need to implement all three methods for the app to work, even though you’ll never call them directly in your code. The <span class="code">UITableViewController</span>
 class implements the <span class="code">UITableViewDataSource</span>
 protocol, which comes with these data source methods, to determine what will be displayed inside the table view. We’ll discuss protocols in “<a href="text00022.html#ch11lev2sec5">Delegation</a>
 ” on page 166. For now, you just need to know that a <span class="code">UITableViewController</span>
 uses these methods to display its content, and it automatically calls these methods so you don’t need to call them.</p>
<p class="indent">Let’s start with the method <span class="code">numberOfSections(in:)</span>
 . The Birthdays table view controller is a list that just displays <span class="code">Birthday</span>
 instances, so it doesn’t need multiple sections. To set the number of sections in the table view, we just need to return <span class="code">1</span>
 .</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func numberOfSections(in tableView: UITableView) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 <span class="blue1">1</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent"><span id="page_164"></span>
 This method takes a <span class="code">UITableView</span>
 called <span class="code">tableView</span>
 as a parameter, which is the table view that uses this class as its data source. We don’t need to worry about making this connection because the <span class="code">UITableViewController</span>
 comes with a built-in table view that is automatically hooked up to these methods. Each birthday will be displayed in its own row. So in <span class="code">tableView(_:numberOfRowsInSection:)</span>
 , in order to have the right number of rows for all of your birthdays, you need to return the number of <span class="code">Birthday</span>
 instances that you have in your <span class="code">birthdays</span>
 array. Do you remember the <span class="code">count</span>
 property of an array? It’s an integer that tells you how many items are in that array, and it’s perfect for this situation! Change this method to the following:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, <img class="inline" src="Image00184.jpg" />
<br />
    numberOfRowsInSection section: Int) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 birthdays.<span class="violet">count</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">In addition to the <span class="code">tableView</span>
 parameter, <span class="code">tableView(_:numberOfRowsInSection:)</span>
 also takes an <span class="code">Int</span>
 called <span class="code">section</span>
 . When the table view is loading itself, this method is called for each section in the table view. In our case, we have only one section, so we don’t need to bother checking which <span class="code">section</span>
 of the table view is being displayed here. We know it’s section 0, and we want it to have as many rows as there are birthdays, so we write <span class="code">return birthdays.count</span>
 .</p>
<p class="indent">Finally, you need to implement <span class="code">tableView(_:cellForRowAt:)</span>
 so that the table view will know what to put inside each cell. Since this method is commented out, you need to uncomment it by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it. (Be careful not to accidentally uncomment the other methods after it!) After you’ve done that, change it to the following code:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, cellForRowAt <img class="inline" src="Image00184.jpg" />
<br />
    indexPath: IndexPath) -&gt; UITableViewCell {</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="pink">let</span>
 cell = tableView.<span class="blue">dequeueReusableCell</span>
 (withIdentifier: <img class="inline" src="Image00093.jpg" />
<br />
        <span class="red">"birthdayCellIdentifier"</span>
 , for: indexPath)<br />
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 birthday = <span class="green1">birthdays</span>
 [indexPath.<span class="violet">row</span>
 ]<br />
<br />
  <span class="ent">➌</span>
 cell.<span class="violet">textLabel</span>
 ?.<span class="violet">text</span>
 = birthday.<span class="green1">firstName</span>
 <span class="blue">+</span>
 <span class="red">" "</span>
 <span class="blue">+</span>
 <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">lastName</span>
<br />
<br />
  <span class="ent">➍</span>
 cell.<span class="violet">detailTextLabel</span>
 ?.<span class="violet">text</span>
 = <span class="green1">dateFormatter</span>
 .<span class="blue">string</span>
 (from: <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">birthdate</span>
 )<br />
<br />
  <span class="ent">➎</span>
 <span class="pink">return</span>
 cell<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">You don’t call the method <span class="code">tableView(_:cellForRowAt:)</span>
 . It’s called when the table view is loaded onto the screen. It’s called for each cell on the screen and takes two parameters, <span class="code">tableView</span>
 and <span class="code">indexPath</span>
 . You already know <span id="page_165"></span>
 what the <span class="code">tableView</span>
 parameter is for. An <span class="code">IndexPath</span>
 is a Swift struct that’s used to represent a row’s position in a table view. An <span class="code">IndexPath</span>
 instance has a <span class="code">section</span>
 property and a <span class="code">row</span>
 property. Since this method will be called many times (once for every row in the table), we need the <span class="code">indexPath</span>
 to know which section and row we’re currently configuring. The <span class="code">indexPath.section</span>
 property gives the section number, and the <span class="code">indexPath.row</span>
 gives the row of the table view cell. The five lines of code inside <span class="code">tableView(_:cellForRowAt:)</span>
 will do the following:</p>
<div class="image"><img src="Image00244.jpg" />
</div>
<p class="bull">• Create a <span class="code">UITableViewCell</span>
</p>
<p class="bull">• Figure out which <span class="code">Birthday</span>
 in the <span class="code">birthdays</span>
 array will be displayed inside the cell</p>
<p class="bull">• Make two labels to display the birthday person’s name and birthdate in the cell</p>
<p class="bull">• Return the cell ready for display in the table view</p>
<p class="indentt">Let’s go through this code line by line.</p>
<p class="indent">First, create the <span class="code">UITableViewCell</span>
 . The code at <span class="ent">➊</span>
 does this using the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 . Before you can start using this method on a cell, though, you need to tell the method which cell you want to use from the storyboard. Earlier, when you were in the storyboard, you gave your cell the identifier <span class="code">birthdayCellIdentifier</span>
 (see <a href="text00022.html#ch11fig4">Figure 11-4</a>
 ). This identifier links your code to the cell and tells your method that it’s using the right cell. The string for when you call this method needs to be exactly the same as the string you set in the storyboard, or you’ll get an error and the app will crash when you run it.</p>
<p class="indent">In the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 , did you notice the words <em>Reusable Cell</em>
 ? The cells inside a table view are created once and then can be reused over and over. This helps everything run faster and smoother because creating the cell is what takes the most time. If you had 200 birthdays in your app, but only 10 would fit on your screen at one time, then you need only 10 cells to show your birthdays. When you scroll down to reveal more birthdays, the cells that scroll off the top of the screen are reused. They are filled with new information and show up again at the bottom of the screen. The <span class="code">UITableView</span>
 automatically does this work. When the table view is loaded, <span class="code">tableView(_:cellForRowAt:)</span>
 is called for every visible row. When the user scrolls to look at more cells, it’s called again for each row just as it is about to appear on the screen.</p>
<p class="indent">Next, we need to find out which <span class="code">Birthday</span>
 should be displayed inside the cell. We want to display one birthday from the <span class="code">birthdays</span>
 array in each row. The first birthday, which is at <span class="code">birthdays[0]</span>
 , should be displayed in row 0. The second birthday, at <span class="code">birthdays[1]</span>
 , should be displayed in row 1, and so on, which means the <span class="code">indexPath</span>
 ’s <span class="code">row</span>
 is the same as the position in the <span class="code">birthdays</span>
 array that we want to access. The code at <span class="ent">➋</span>
 accesses the <span id="page_166"></span>
 correct <span class="code">Birthday</span>
 object from the <span class="code">birthdays</span>
 array by using <span class="code">indexPath.row</span>
 . Once we have the right <span class="code">Birthday</span>
 object, we assign it to a constant named <span class="code">birthday</span>
 so we can set up the labels in this cell.</p>
<p class="indent">Notice that we’re using <span class="code">let</span>
 to assign the <span class="code">birthday</span>
 to a constant instead of a variable. We can use <span class="code">let</span>
 because each time <span class="code">tableView(_:cellForRowAt:)</span>
 is called, a new <span class="code">birthday</span>
 constant is created. Each cell gets its own <span class="code">birthday</span>
 constant that is assigned its own <span class="code">Birthday</span>
 object. Since we’re not going to change any of the <span class="code">birthday</span>
 constants—we’re just going to read their properties—we don’t want to make them variables.</p>
<p class="indent">Now that you have your cell and your birthday, it’s time to fill in the details. You need two labels for each cell to show the birthday person’s name and birthdate. You set the cell to the Subtitle style so that it has a Title label and a Subtitle label. Each cell will already contain these labels, so now you don’t have to create any labels yourself.</p>
<p class="indent">The labels exist as properties of <span class="code">UITableViewCell</span>
 and are called <span class="code">textLabel</span>
 and <span class="code">detailTextLabel</span>
 . The code at <span class="ent">➌</span>
 sets the text of the <span class="code">textLabel</span>
 to a string made up of the <span class="code">firstName</span>
 and <span class="code">lastName</span>
 of the <span class="code">birthday</span>
 with a space between them. At <span class="ent">➍</span>
 , you use the <span class="code">string(from:)</span>
 method of the <span class="code">dateFormatter</span>
 to display the birthdate in the <span class="code">detailTextLabel</span>
 .</p>
<p class="indent">When your cell is completely configured, <span class="code">tableView( _:cellForRowAt:)</span>
 returns the cell at <span class="ent">➎</span>
 so that it can be displayed at that <span class="code">indexPath</span>
 of the table view.</p>
<h3 class="h3" id="ch11lev1sec2">
<strong>PUTTING IT ALL TOGETHER</strong>
</h3>
<p class="noindent">Now you can add <span class="code">Birthday</span>
 instances to the app using the Add Birthday view controller, and you have a table view to list each <span class="code">Birthday</span>
 in the Birthdays table view controller. But when you try running the app and adding a <span class="code">Birthday</span>
 , it doesn’t appear. To make each <span class="code">Birthday</span>
 you add appear in the table view, you need to make the Add Birthday view controller communicate with the Birthdays table view controller. You do this by using <em>delegation</em>
 .</p>
<h4 class="h4" id="ch11lev2sec5">
<strong>DELEGATION</strong>
</h4>
<p class="noindent">Delegation can be used when one view controller needs to get information from another view controller. Say you have two view controllers: A and B. The first view controller, A, creates B and presents B on top of itself. A knows about B because it created and presented B, so A can pass information along to B. But B doesn’t know about A—it’s just popped into being and doesn’t know where it came from or how it got there. So how can B talk to A? Through delegation!</p>
<div class="image"><img src="Image00245.jpg" />
</div>
<p class="indent">Delegation is when someone gives a job or a task to someone else. A <em>delegate</em>
 is like a boss who tells a delegating employee what to do. When the delegating employee is done with their task, sometimes they’ll report information back to the delegate boss.</p>
<p class="indent"><span id="page_167"></span>
 Delegation in Swift is pretty similar, but instead of having a boss and employee, we have a delegate and a delegating object. Since class B is the one being told what to do by class A, it’s the delegating object. We give class B a special property called a delegate to tell it who its delegate is—that way, it knows who to communicate with. The delegate can be any class that has a set of methods that have been defined in a <em>protocol</em>
 . A protocol is like an agreement between the two classes that tells them what the delegate can ask the delegating object to do. It has a list of method and property names that the delegate can use with the delegating object.</p>
<p class="indent">Class A creates class B, makes itself the delegate of class B, and gives class B a job to do that’s in the protocol. Once class B is done with its job, it reports back to class A. Let’s see how this works in our app.</p>
<p class="indent">The Birthdays table view controller is view controller A, and the Add Birthday view controller is view controller B. We’ll create a protocol called <span class="code">AddBirthdayViewControllerDelegate</span>
 and a method for that protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 , which the Add Birthday view controller will use to report back.</p>
<p class="indent">Take a look at <a href="text00022.html#ch11fig6">Figure 11-6</a>
 . When the user taps the Add button <span class="ent">➊</span>
 , the Birthdays table view controller creates the Add Birthday view controller <span class="ent">➋</span>
 and sets itself as the Add Birthday view controller’s delegate.</p>
<div class="image"><img src="Image00246.jpg" />
</div>
<p class="figcap"><a id="ch11fig6"></a>
 <em>Figure 11-6: A new birthday is added and passed from the Add Birthday view controller to the Birthdays table view controller using delegation.</em>
</p>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController {</span>
<br />
<br />
    <span class="pink">var</span>
 birthdays = [<span class="green1">Birthday</span>
 ]()<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent">This line creates an empty array of <span class="code">Birthday</span>
 instances. It needs to be a variable and not a constant because you’ll want to add a saved <span class="code">Birthday</span>
 to this array every time the user adds a <span class="code">Birthday</span>
 with the Add Birthday view controller. You’ll see how to do that in “<a href="text00022.html#ch11lev3sec2">Making the Birthdays Table View Controller Conform to Protocol</a>
 ” on <a href="text00022.html#page_168">page 168</a>
 .</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>Remember that the final versions of the project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>.</em>
</p>
</div>
<p class="indent">The <span class="code">BirthdaysTableViewController</span>
 will also need a <span class="code">dateFormatter</span>
 property to display the birthdate as a nicely formatted string. Add a <span class="code">dateFormatter</span>
 right underneath the <span class="code">birthdays</span>
 array:</p>
<div class="box">
<pre>    <span class="ash">var birthdays = [Birthday]()</span>
<br />
<br />
    <span class="pink">let</span>
 dateFormatter = <span class="violet">DateFormatter</span>
 ()<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent">Note that the <span class="code">dateFormatter</span>
 is a constant that is created with <span class="code">let</span>
 . Even though you’ll change the <span class="code">dateFormatter</span>
 ’s properties, like the <span class="code">dateStyle</span>
 and <span class="code">timeStyle</span>
 , you’ll never change the <span class="code">dateFormatter</span>
 itself.</p>
<p class="indent"><span id="page_162"></span>
 You’ll also need to set up the <span class="code">dateFormatter</span>
 so that it will display the birthdates as fully formatted strings like <span class="code">"Tuesday, December 17, 2008"</span>
 . As you saw in <a href="text00021.html#ch10">Chapter 10</a>
 , a good place to do this is the <span class="code">viewDidLoad()</span>
 method, which is called when the Birthdays table view controller is loading its view. This is the perfect place to do any setup that is needed for this class.</p>
<div class="box">
<pre>
<span class="ash">override func viewDidLoad() {</span>
<br />
    <span class="ash">super.viewDidLoad()</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">dateFormatter</span>
 .<span class="violet">dateStyle</span>
 = .<span class="blue">full</span>
<br />
  <span class="ent">➋</span>
 <span class="green1">dateFormatter</span>
 .<span class="violet">timeStyle</span>
 = .<span class="blue">none</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , you set the <span class="code">dateStyle</span>
 of the <span class="code">dateFormatter</span>
 so that it will display a formatted date string for each <span class="code">Birthday</span>
 . Did you notice how we just wrote <span class="code">.full</span>
 instead of <span class="code">DateFormatter.Style.full</span>
 ? Swift knows what type to expect for the <span class="code">dateStyle</span>
 of a <span class="code">DateFormatter</span>
 , so it lets us take this little shortcut. At <span class="ent">➋</span>
 , you set the <span class="code">timeStyle</span>
 of the <span class="code">dateFormatter</span>
 to <span class="code">.none</span>
 so that the time won’t be shown.</p>
<h4 class="h4" id="ch11lev2sec4">
<strong>DISPLAYING BIRTHDAYS IN A TABLE VIEW</strong>
</h4>
<p class="noindent">The <span class="code">BirthdaysTableViewController</span>
 class has a table view that is used to display a list of items in a single column. The table view has one or more sections containing rows, and each row contains a cell. A section in a table view is a grouping of rows that can be displayed with or without a header. An example of an app that shows a table view with several sections is the Settings app, as shown in <a href="text00022.html#ch11fig5">Figure 11-5</a>
 . It displays a list of rows that have been broken up into different sections.</p>
<p class="indent">Each section and row of a table view is identified with an index number. These numbers start at 0 and then increase by 1 as you go down the table view. For example, the Privacy line in the Settings app is found at section 0, row 1. The News setting is at section 1, row 3.</p>
<p class="indent">In the middle of the <span class="code">BirthdaysTableViewController</span>
 class, there is a section called <em>Table view data source</em>
 with three methods. The table view controller uses these methods to determine what’s going to be displayed inside its table view.</p>
<p class="hang">
<span class="code">
<span class="codestrong">numberOfSections(in:)</span>
</span>
 Tells the table view how many sections it should have</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:numberOfRowsInSection:)</span>
</span>
 Tells the table view how many rows will be displayed in each section</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:cellForRowAt:)</span>
</span>
 Sets up each cell that’s going to be displayed in each row of the table view</p>
<div class="image"><span id="page_163"></span>
 <img src="Image00243.jpg" />
</div>
<p class="figcap"><a id="ch11fig5"></a>
 <em>Figure 11-5: The Settings app uses sections to group rows of different device settings.</em>
</p>
<p class="indent">The table view data source methods are called by the table view controller every time the table view is reloaded. Xcode automatically gives you these method templates when you make a subclass of a <span class="code">UITableViewController</span>
 . You need to implement all three methods for the app to work, even though you’ll never call them directly in your code. The <span class="code">UITableViewController</span>
 class implements the <span class="code">UITableViewDataSource</span>
 protocol, which comes with these data source methods, to determine what will be displayed inside the table view. We’ll discuss protocols in “<a href="text00022.html#ch11lev2sec5">Delegation</a>
 ” on page 166. For now, you just need to know that a <span class="code">UITableViewController</span>
 uses these methods to display its content, and it automatically calls these methods so you don’t need to call them.</p>
<p class="indent">Let’s start with the method <span class="code">numberOfSections(in:)</span>
 . The Birthdays table view controller is a list that just displays <span class="code">Birthday</span>
 instances, so it doesn’t need multiple sections. To set the number of sections in the table view, we just need to return <span class="code">1</span>
 .</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func numberOfSections(in tableView: UITableView) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 <span class="blue1">1</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent"><span id="page_164"></span>
 This method takes a <span class="code">UITableView</span>
 called <span class="code">tableView</span>
 as a parameter, which is the table view that uses this class as its data source. We don’t need to worry about making this connection because the <span class="code">UITableViewController</span>
 comes with a built-in table view that is automatically hooked up to these methods. Each birthday will be displayed in its own row. So in <span class="code">tableView(_:numberOfRowsInSection:)</span>
 , in order to have the right number of rows for all of your birthdays, you need to return the number of <span class="code">Birthday</span>
 instances that you have in your <span class="code">birthdays</span>
 array. Do you remember the <span class="code">count</span>
 property of an array? It’s an integer that tells you how many items are in that array, and it’s perfect for this situation! Change this method to the following:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, <img class="inline" src="Image00184.jpg" />
<br />
    numberOfRowsInSection section: Int) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 birthdays.<span class="violet">count</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">In addition to the <span class="code">tableView</span>
 parameter, <span class="code">tableView(_:numberOfRowsInSection:)</span>
 also takes an <span class="code">Int</span>
 called <span class="code">section</span>
 . When the table view is loading itself, this method is called for each section in the table view. In our case, we have only one section, so we don’t need to bother checking which <span class="code">section</span>
 of the table view is being displayed here. We know it’s section 0, and we want it to have as many rows as there are birthdays, so we write <span class="code">return birthdays.count</span>
 .</p>
<p class="indent">Finally, you need to implement <span class="code">tableView(_:cellForRowAt:)</span>
 so that the table view will know what to put inside each cell. Since this method is commented out, you need to uncomment it by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it. (Be careful not to accidentally uncomment the other methods after it!) After you’ve done that, change it to the following code:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, cellForRowAt <img class="inline" src="Image00184.jpg" />
<br />
    indexPath: IndexPath) -&gt; UITableViewCell {</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="pink">let</span>
 cell = tableView.<span class="blue">dequeueReusableCell</span>
 (withIdentifier: <img class="inline" src="Image00093.jpg" />
<br />
        <span class="red">"birthdayCellIdentifier"</span>
 , for: indexPath)<br />
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 birthday = <span class="green1">birthdays</span>
 [indexPath.<span class="violet">row</span>
 ]<br />
<br />
  <span class="ent">➌</span>
 cell.<span class="violet">textLabel</span>
 ?.<span class="violet">text</span>
 = birthday.<span class="green1">firstName</span>
 <span class="blue">+</span>
 <span class="red">" "</span>
 <span class="blue">+</span>
 <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">lastName</span>
<br />
<br />
  <span class="ent">➍</span>
 cell.<span class="violet">detailTextLabel</span>
 ?.<span class="violet">text</span>
 = <span class="green1">dateFormatter</span>
 .<span class="blue">string</span>
 (from: <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">birthdate</span>
 )<br />
<br />
  <span class="ent">➎</span>
 <span class="pink">return</span>
 cell<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">You don’t call the method <span class="code">tableView(_:cellForRowAt:)</span>
 . It’s called when the table view is loaded onto the screen. It’s called for each cell on the screen and takes two parameters, <span class="code">tableView</span>
 and <span class="code">indexPath</span>
 . You already know <span id="page_165"></span>
 what the <span class="code">tableView</span>
 parameter is for. An <span class="code">IndexPath</span>
 is a Swift struct that’s used to represent a row’s position in a table view. An <span class="code">IndexPath</span>
 instance has a <span class="code">section</span>
 property and a <span class="code">row</span>
 property. Since this method will be called many times (once for every row in the table), we need the <span class="code">indexPath</span>
 to know which section and row we’re currently configuring. The <span class="code">indexPath.section</span>
 property gives the section number, and the <span class="code">indexPath.row</span>
 gives the row of the table view cell. The five lines of code inside <span class="code">tableView(_:cellForRowAt:)</span>
 will do the following:</p>
<div class="image"><img src="Image00244.jpg" />
</div>
<p class="bull">• Create a <span class="code">UITableViewCell</span>
</p>
<p class="bull">• Figure out which <span class="code">Birthday</span>
 in the <span class="code">birthdays</span>
 array will be displayed inside the cell</p>
<p class="bull">• Make two labels to display the birthday person’s name and birthdate in the cell</p>
<p class="bull">• Return the cell ready for display in the table view</p>
<p class="indentt">Let’s go through this code line by line.</p>
<p class="indent">First, create the <span class="code">UITableViewCell</span>
 . The code at <span class="ent">➊</span>
 does this using the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 . Before you can start using this method on a cell, though, you need to tell the method which cell you want to use from the storyboard. Earlier, when you were in the storyboard, you gave your cell the identifier <span class="code">birthdayCellIdentifier</span>
 (see <a href="text00022.html#ch11fig4">Figure 11-4</a>
 ). This identifier links your code to the cell and tells your method that it’s using the right cell. The string for when you call this method needs to be exactly the same as the string you set in the storyboard, or you’ll get an error and the app will crash when you run it.</p>
<p class="indent">In the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 , did you notice the words <em>Reusable Cell</em>
 ? The cells inside a table view are created once and then can be reused over and over. This helps everything run faster and smoother because creating the cell is what takes the most time. If you had 200 birthdays in your app, but only 10 would fit on your screen at one time, then you need only 10 cells to show your birthdays. When you scroll down to reveal more birthdays, the cells that scroll off the top of the screen are reused. They are filled with new information and show up again at the bottom of the screen. The <span class="code">UITableView</span>
 automatically does this work. When the table view is loaded, <span class="code">tableView(_:cellForRowAt:)</span>
 is called for every visible row. When the user scrolls to look at more cells, it’s called again for each row just as it is about to appear on the screen.</p>
<p class="indent">Next, we need to find out which <span class="code">Birthday</span>
 should be displayed inside the cell. We want to display one birthday from the <span class="code">birthdays</span>
 array in each row. The first birthday, which is at <span class="code">birthdays[0]</span>
 , should be displayed in row 0. The second birthday, at <span class="code">birthdays[1]</span>
 , should be displayed in row 1, and so on, which means the <span class="code">indexPath</span>
 ’s <span class="code">row</span>
 is the same as the position in the <span class="code">birthdays</span>
 array that we want to access. The code at <span class="ent">➋</span>
 accesses the <span id="page_166"></span>
 correct <span class="code">Birthday</span>
 object from the <span class="code">birthdays</span>
 array by using <span class="code">indexPath.row</span>
 . Once we have the right <span class="code">Birthday</span>
 object, we assign it to a constant named <span class="code">birthday</span>
 so we can set up the labels in this cell.</p>
<p class="indent">Notice that we’re using <span class="code">let</span>
 to assign the <span class="code">birthday</span>
 to a constant instead of a variable. We can use <span class="code">let</span>
 because each time <span class="code">tableView(_:cellForRowAt:)</span>
 is called, a new <span class="code">birthday</span>
 constant is created. Each cell gets its own <span class="code">birthday</span>
 constant that is assigned its own <span class="code">Birthday</span>
 object. Since we’re not going to change any of the <span class="code">birthday</span>
 constants—we’re just going to read their properties—we don’t want to make them variables.</p>
<p class="indent">Now that you have your cell and your birthday, it’s time to fill in the details. You need two labels for each cell to show the birthday person’s name and birthdate. You set the cell to the Subtitle style so that it has a Title label and a Subtitle label. Each cell will already contain these labels, so now you don’t have to create any labels yourself.</p>
<p class="indent">The labels exist as properties of <span class="code">UITableViewCell</span>
 and are called <span class="code">textLabel</span>
 and <span class="code">detailTextLabel</span>
 . The code at <span class="ent">➌</span>
 sets the text of the <span class="code">textLabel</span>
 to a string made up of the <span class="code">firstName</span>
 and <span class="code">lastName</span>
 of the <span class="code">birthday</span>
 with a space between them. At <span class="ent">➍</span>
 , you use the <span class="code">string(from:)</span>
 method of the <span class="code">dateFormatter</span>
 to display the birthdate in the <span class="code">detailTextLabel</span>
 .</p>
<p class="indent">When your cell is completely configured, <span class="code">tableView( _:cellForRowAt:)</span>
 returns the cell at <span class="ent">➎</span>
 so that it can be displayed at that <span class="code">indexPath</span>
 of the table view.</p>
<h3 class="h3" id="ch11lev1sec2">
<strong>PUTTING IT ALL TOGETHER</strong>
</h3>
<p class="noindent">Now you can add <span class="code">Birthday</span>
 instances to the app using the Add Birthday view controller, and you have a table view to list each <span class="code">Birthday</span>
 in the Birthdays table view controller. But when you try running the app and adding a <span class="code">Birthday</span>
 , it doesn’t appear. To make each <span class="code">Birthday</span>
 you add appear in the table view, you need to make the Add Birthday view controller communicate with the Birthdays table view controller. You do this by using <em>delegation</em>
 .</p>
<h4 class="h4" id="ch11lev2sec5">
<strong>DELEGATION</strong>
</h4>
<p class="noindent">Delegation can be used when one view controller needs to get information from another view controller. Say you have two view controllers: A and B. The first view controller, A, creates B and presents B on top of itself. A knows about B because it created and presented B, so A can pass information along to B. But B doesn’t know about A—it’s just popped into being and doesn’t know where it came from or how it got there. So how can B talk to A? Through delegation!</p>
<div class="image"><img src="Image00245.jpg" />
</div>
<p class="indent">Delegation is when someone gives a job or a task to someone else. A <em>delegate</em>
 is like a boss who tells a delegating employee what to do. When the delegating employee is done with their task, sometimes they’ll report information back to the delegate boss.</p>
<p class="indent"><span id="page_167"></span>
 Delegation in Swift is pretty similar, but instead of having a boss and employee, we have a delegate and a delegating object. Since class B is the one being told what to do by class A, it’s the delegating object. We give class B a special property called a delegate to tell it who its delegate is—that way, it knows who to communicate with. The delegate can be any class that has a set of methods that have been defined in a <em>protocol</em>
 . A protocol is like an agreement between the two classes that tells them what the delegate can ask the delegating object to do. It has a list of method and property names that the delegate can use with the delegating object.</p>
<p class="indent">Class A creates class B, makes itself the delegate of class B, and gives class B a job to do that’s in the protocol. Once class B is done with its job, it reports back to class A. Let’s see how this works in our app.</p>
<p class="indent">The Birthdays table view controller is view controller A, and the Add Birthday view controller is view controller B. We’ll create a protocol called <span class="code">AddBirthdayViewControllerDelegate</span>
 and a method for that protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 , which the Add Birthday view controller will use to report back.</p>
<p class="indent">Take a look at <a href="text00022.html#ch11fig6">Figure 11-6</a>
 . When the user taps the Add button <span class="ent">➊</span>
 , the Birthdays table view controller creates the Add Birthday view controller <span class="ent">➋</span>
 and sets itself as the Add Birthday view controller’s delegate.</p>
<div class="image"><img src="Image00246.jpg" />
</div>
<p class="figcap"><a id="ch11fig6"></a>
 <em>Figure 11-6: A new birthday is added and passed from the Add Birthday view controller to the Birthdays table view controller using delegation.</em>
</p>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController {</span>
<br />
<br />
    <span class="pink">var</span>
 birthdays = [<span class="green1">Birthday</span>
 ]()<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent">This line creates an empty array of <span class="code">Birthday</span>
 instances. It needs to be a variable and not a constant because you’ll want to add a saved <span class="code">Birthday</span>
 to this array every time the user adds a <span class="code">Birthday</span>
 with the Add Birthday view controller. You’ll see how to do that in “<a href="text00022.html#ch11lev3sec2">Making the Birthdays Table View Controller Conform to Protocol</a>
 ” on <a href="text00022.html#page_168">page 168</a>
 .</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>Remember that the final versions of the project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>.</em>
</p>
</div>
<p class="indent">The <span class="code">BirthdaysTableViewController</span>
 will also need a <span class="code">dateFormatter</span>
 property to display the birthdate as a nicely formatted string. Add a <span class="code">dateFormatter</span>
 right underneath the <span class="code">birthdays</span>
 array:</p>
<div class="box">
<pre>    <span class="ash">var birthdays = [Birthday]()</span>
<br />
<br />
    <span class="pink">let</span>
 dateFormatter = <span class="violet">DateFormatter</span>
 ()<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent">Note that the <span class="code">dateFormatter</span>
 is a constant that is created with <span class="code">let</span>
 . Even though you’ll change the <span class="code">dateFormatter</span>
 ’s properties, like the <span class="code">dateStyle</span>
 and <span class="code">timeStyle</span>
 , you’ll never change the <span class="code">dateFormatter</span>
 itself.</p>
<p class="indent"><span id="page_162"></span>
 You’ll also need to set up the <span class="code">dateFormatter</span>
 so that it will display the birthdates as fully formatted strings like <span class="code">"Tuesday, December 17, 2008"</span>
 . As you saw in <a href="text00021.html#ch10">Chapter 10</a>
 , a good place to do this is the <span class="code">viewDidLoad()</span>
 method, which is called when the Birthdays table view controller is loading its view. This is the perfect place to do any setup that is needed for this class.</p>
<div class="box">
<pre>
<span class="ash">override func viewDidLoad() {</span>
<br />
    <span class="ash">super.viewDidLoad()</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">dateFormatter</span>
 .<span class="violet">dateStyle</span>
 = .<span class="blue">full</span>
<br />
  <span class="ent">➋</span>
 <span class="green1">dateFormatter</span>
 .<span class="violet">timeStyle</span>
 = .<span class="blue">none</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , you set the <span class="code">dateStyle</span>
 of the <span class="code">dateFormatter</span>
 so that it will display a formatted date string for each <span class="code">Birthday</span>
 . Did you notice how we just wrote <span class="code">.full</span>
 instead of <span class="code">DateFormatter.Style.full</span>
 ? Swift knows what type to expect for the <span class="code">dateStyle</span>
 of a <span class="code">DateFormatter</span>
 , so it lets us take this little shortcut. At <span class="ent">➋</span>
 , you set the <span class="code">timeStyle</span>
 of the <span class="code">dateFormatter</span>
 to <span class="code">.none</span>
 so that the time won’t be shown.</p>
<h4 class="h4" id="ch11lev2sec4">
<strong>DISPLAYING BIRTHDAYS IN A TABLE VIEW</strong>
</h4>
<p class="noindent">The <span class="code">BirthdaysTableViewController</span>
 class has a table view that is used to display a list of items in a single column. The table view has one or more sections containing rows, and each row contains a cell. A section in a table view is a grouping of rows that can be displayed with or without a header. An example of an app that shows a table view with several sections is the Settings app, as shown in <a href="text00022.html#ch11fig5">Figure 11-5</a>
 . It displays a list of rows that have been broken up into different sections.</p>
<p class="indent">Each section and row of a table view is identified with an index number. These numbers start at 0 and then increase by 1 as you go down the table view. For example, the Privacy line in the Settings app is found at section 0, row 1. The News setting is at section 1, row 3.</p>
<p class="indent">In the middle of the <span class="code">BirthdaysTableViewController</span>
 class, there is a section called <em>Table view data source</em>
 with three methods. The table view controller uses these methods to determine what’s going to be displayed inside its table view.</p>
<p class="hang">
<span class="code">
<span class="codestrong">numberOfSections(in:)</span>
</span>
 Tells the table view how many sections it should have</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:numberOfRowsInSection:)</span>
</span>
 Tells the table view how many rows will be displayed in each section</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:cellForRowAt:)</span>
</span>
 Sets up each cell that’s going to be displayed in each row of the table view</p>
<div class="image"><span id="page_163"></span>
 <img src="Image00243.jpg" />
</div>
<p class="figcap"><a id="ch11fig5"></a>
 <em>Figure 11-5: The Settings app uses sections to group rows of different device settings.</em>
</p>
<p class="indent">The table view data source methods are called by the table view controller every time the table view is reloaded. Xcode automatically gives you these method templates when you make a subclass of a <span class="code">UITableViewController</span>
 . You need to implement all three methods for the app to work, even though you’ll never call them directly in your code. The <span class="code">UITableViewController</span>
 class implements the <span class="code">UITableViewDataSource</span>
 protocol, which comes with these data source methods, to determine what will be displayed inside the table view. We’ll discuss protocols in “<a href="text00022.html#ch11lev2sec5">Delegation</a>
 ” on page 166. For now, you just need to know that a <span class="code">UITableViewController</span>
 uses these methods to display its content, and it automatically calls these methods so you don’t need to call them.</p>
<p class="indent">Let’s start with the method <span class="code">numberOfSections(in:)</span>
 . The Birthdays table view controller is a list that just displays <span class="code">Birthday</span>
 instances, so it doesn’t need multiple sections. To set the number of sections in the table view, we just need to return <span class="code">1</span>
 .</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func numberOfSections(in tableView: UITableView) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 <span class="blue1">1</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent"><span id="page_164"></span>
 This method takes a <span class="code">UITableView</span>
 called <span class="code">tableView</span>
 as a parameter, which is the table view that uses this class as its data source. We don’t need to worry about making this connection because the <span class="code">UITableViewController</span>
 comes with a built-in table view that is automatically hooked up to these methods. Each birthday will be displayed in its own row. So in <span class="code">tableView(_:numberOfRowsInSection:)</span>
 , in order to have the right number of rows for all of your birthdays, you need to return the number of <span class="code">Birthday</span>
 instances that you have in your <span class="code">birthdays</span>
 array. Do you remember the <span class="code">count</span>
 property of an array? It’s an integer that tells you how many items are in that array, and it’s perfect for this situation! Change this method to the following:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, <img class="inline" src="Image00184.jpg" />
<br />
    numberOfRowsInSection section: Int) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 birthdays.<span class="violet">count</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">In addition to the <span class="code">tableView</span>
 parameter, <span class="code">tableView(_:numberOfRowsInSection:)</span>
 also takes an <span class="code">Int</span>
 called <span class="code">section</span>
 . When the table view is loading itself, this method is called for each section in the table view. In our case, we have only one section, so we don’t need to bother checking which <span class="code">section</span>
 of the table view is being displayed here. We know it’s section 0, and we want it to have as many rows as there are birthdays, so we write <span class="code">return birthdays.count</span>
 .</p>
<p class="indent">Finally, you need to implement <span class="code">tableView(_:cellForRowAt:)</span>
 so that the table view will know what to put inside each cell. Since this method is commented out, you need to uncomment it by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it. (Be careful not to accidentally uncomment the other methods after it!) After you’ve done that, change it to the following code:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, cellForRowAt <img class="inline" src="Image00184.jpg" />
<br />
    indexPath: IndexPath) -&gt; UITableViewCell {</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="pink">let</span>
 cell = tableView.<span class="blue">dequeueReusableCell</span>
 (withIdentifier: <img class="inline" src="Image00093.jpg" />
<br />
        <span class="red">"birthdayCellIdentifier"</span>
 , for: indexPath)<br />
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 birthday = <span class="green1">birthdays</span>
 [indexPath.<span class="violet">row</span>
 ]<br />
<br />
  <span class="ent">➌</span>
 cell.<span class="violet">textLabel</span>
 ?.<span class="violet">text</span>
 = birthday.<span class="green1">firstName</span>
 <span class="blue">+</span>
 <span class="red">" "</span>
 <span class="blue">+</span>
 <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">lastName</span>
<br />
<br />
  <span class="ent">➍</span>
 cell.<span class="violet">detailTextLabel</span>
 ?.<span class="violet">text</span>
 = <span class="green1">dateFormatter</span>
 .<span class="blue">string</span>
 (from: <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">birthdate</span>
 )<br />
<br />
  <span class="ent">➎</span>
 <span class="pink">return</span>
 cell<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">You don’t call the method <span class="code">tableView(_:cellForRowAt:)</span>
 . It’s called when the table view is loaded onto the screen. It’s called for each cell on the screen and takes two parameters, <span class="code">tableView</span>
 and <span class="code">indexPath</span>
 . You already know <span id="page_165"></span>
 what the <span class="code">tableView</span>
 parameter is for. An <span class="code">IndexPath</span>
 is a Swift struct that’s used to represent a row’s position in a table view. An <span class="code">IndexPath</span>
 instance has a <span class="code">section</span>
 property and a <span class="code">row</span>
 property. Since this method will be called many times (once for every row in the table), we need the <span class="code">indexPath</span>
 to know which section and row we’re currently configuring. The <span class="code">indexPath.section</span>
 property gives the section number, and the <span class="code">indexPath.row</span>
 gives the row of the table view cell. The five lines of code inside <span class="code">tableView(_:cellForRowAt:)</span>
 will do the following:</p>
<div class="image"><img src="Image00244.jpg" />
</div>
<p class="bull">• Create a <span class="code">UITableViewCell</span>
</p>
<p class="bull">• Figure out which <span class="code">Birthday</span>
 in the <span class="code">birthdays</span>
 array will be displayed inside the cell</p>
<p class="bull">• Make two labels to display the birthday person’s name and birthdate in the cell</p>
<p class="bull">• Return the cell ready for display in the table view</p>
<p class="indentt">Let’s go through this code line by line.</p>
<p class="indent">First, create the <span class="code">UITableViewCell</span>
 . The code at <span class="ent">➊</span>
 does this using the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 . Before you can start using this method on a cell, though, you need to tell the method which cell you want to use from the storyboard. Earlier, when you were in the storyboard, you gave your cell the identifier <span class="code">birthdayCellIdentifier</span>
 (see <a href="text00022.html#ch11fig4">Figure 11-4</a>
 ). This identifier links your code to the cell and tells your method that it’s using the right cell. The string for when you call this method needs to be exactly the same as the string you set in the storyboard, or you’ll get an error and the app will crash when you run it.</p>
<p class="indent">In the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 , did you notice the words <em>Reusable Cell</em>
 ? The cells inside a table view are created once and then can be reused over and over. This helps everything run faster and smoother because creating the cell is what takes the most time. If you had 200 birthdays in your app, but only 10 would fit on your screen at one time, then you need only 10 cells to show your birthdays. When you scroll down to reveal more birthdays, the cells that scroll off the top of the screen are reused. They are filled with new information and show up again at the bottom of the screen. The <span class="code">UITableView</span>
 automatically does this work. When the table view is loaded, <span class="code">tableView(_:cellForRowAt:)</span>
 is called for every visible row. When the user scrolls to look at more cells, it’s called again for each row just as it is about to appear on the screen.</p>
<p class="indent">Next, we need to find out which <span class="code">Birthday</span>
 should be displayed inside the cell. We want to display one birthday from the <span class="code">birthdays</span>
 array in each row. The first birthday, which is at <span class="code">birthdays[0]</span>
 , should be displayed in row 0. The second birthday, at <span class="code">birthdays[1]</span>
 , should be displayed in row 1, and so on, which means the <span class="code">indexPath</span>
 ’s <span class="code">row</span>
 is the same as the position in the <span class="code">birthdays</span>
 array that we want to access. The code at <span class="ent">➋</span>
 accesses the <span id="page_166"></span>
 correct <span class="code">Birthday</span>
 object from the <span class="code">birthdays</span>
 array by using <span class="code">indexPath.row</span>
 . Once we have the right <span class="code">Birthday</span>
 object, we assign it to a constant named <span class="code">birthday</span>
 so we can set up the labels in this cell.</p>
<p class="indent">Notice that we’re using <span class="code">let</span>
 to assign the <span class="code">birthday</span>
 to a constant instead of a variable. We can use <span class="code">let</span>
 because each time <span class="code">tableView(_:cellForRowAt:)</span>
 is called, a new <span class="code">birthday</span>
 constant is created. Each cell gets its own <span class="code">birthday</span>
 constant that is assigned its own <span class="code">Birthday</span>
 object. Since we’re not going to change any of the <span class="code">birthday</span>
 constants—we’re just going to read their properties—we don’t want to make them variables.</p>
<p class="indent">Now that you have your cell and your birthday, it’s time to fill in the details. You need two labels for each cell to show the birthday person’s name and birthdate. You set the cell to the Subtitle style so that it has a Title label and a Subtitle label. Each cell will already contain these labels, so now you don’t have to create any labels yourself.</p>
<p class="indent">The labels exist as properties of <span class="code">UITableViewCell</span>
 and are called <span class="code">textLabel</span>
 and <span class="code">detailTextLabel</span>
 . The code at <span class="ent">➌</span>
 sets the text of the <span class="code">textLabel</span>
 to a string made up of the <span class="code">firstName</span>
 and <span class="code">lastName</span>
 of the <span class="code">birthday</span>
 with a space between them. At <span class="ent">➍</span>
 , you use the <span class="code">string(from:)</span>
 method of the <span class="code">dateFormatter</span>
 to display the birthdate in the <span class="code">detailTextLabel</span>
 .</p>
<p class="indent">When your cell is completely configured, <span class="code">tableView( _:cellForRowAt:)</span>
 returns the cell at <span class="ent">➎</span>
 so that it can be displayed at that <span class="code">indexPath</span>
 of the table view.</p>
<h3 class="h3" id="ch11lev1sec2">
<strong>PUTTING IT ALL TOGETHER</strong>
</h3>
<p class="noindent">Now you can add <span class="code">Birthday</span>
 instances to the app using the Add Birthday view controller, and you have a table view to list each <span class="code">Birthday</span>
 in the Birthdays table view controller. But when you try running the app and adding a <span class="code">Birthday</span>
 , it doesn’t appear. To make each <span class="code">Birthday</span>
 you add appear in the table view, you need to make the Add Birthday view controller communicate with the Birthdays table view controller. You do this by using <em>delegation</em>
 .</p>
<h4 class="h4" id="ch11lev2sec5">
<strong>DELEGATION</strong>
</h4>
<p class="noindent">Delegation can be used when one view controller needs to get information from another view controller. Say you have two view controllers: A and B. The first view controller, A, creates B and presents B on top of itself. A knows about B because it created and presented B, so A can pass information along to B. But B doesn’t know about A—it’s just popped into being and doesn’t know where it came from or how it got there. So how can B talk to A? Through delegation!</p>
<div class="image"><img src="Image00245.jpg" />
</div>
<p class="indent">Delegation is when someone gives a job or a task to someone else. A <em>delegate</em>
 is like a boss who tells a delegating employee what to do. When the delegating employee is done with their task, sometimes they’ll report information back to the delegate boss.</p>
<p class="indent"><span id="page_167"></span>
 Delegation in Swift is pretty similar, but instead of having a boss and employee, we have a delegate and a delegating object. Since class B is the one being told what to do by class A, it’s the delegating object. We give class B a special property called a delegate to tell it who its delegate is—that way, it knows who to communicate with. The delegate can be any class that has a set of methods that have been defined in a <em>protocol</em>
 . A protocol is like an agreement between the two classes that tells them what the delegate can ask the delegating object to do. It has a list of method and property names that the delegate can use with the delegating object.</p>
<p class="indent">Class A creates class B, makes itself the delegate of class B, and gives class B a job to do that’s in the protocol. Once class B is done with its job, it reports back to class A. Let’s see how this works in our app.</p>
<p class="indent">The Birthdays table view controller is view controller A, and the Add Birthday view controller is view controller B. We’ll create a protocol called <span class="code">AddBirthdayViewControllerDelegate</span>
 and a method for that protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 , which the Add Birthday view controller will use to report back.</p>
<p class="indent">Take a look at <a href="text00022.html#ch11fig6">Figure 11-6</a>
 . When the user taps the Add button <span class="ent">➊</span>
 , the Birthdays table view controller creates the Add Birthday view controller <span class="ent">➋</span>
 and sets itself as the Add Birthday view controller’s delegate.</p>
<div class="image"><img src="Image00246.jpg" />
</div>
<p class="figcap"><a id="ch11fig6"></a>
 <em>Figure 11-6: A new birthday is added and passed from the Add Birthday view controller to the Birthdays table view controller using delegation.</em>
</p>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="indent">This line creates an empty array of <span class="code">Birthday</span>
 instances. It needs to be a variable and not a constant because you’ll want to add a saved <span class="code">Birthday</span>
 to this array every time the user adds a <span class="code">Birthday</span>
 with the Add Birthday view controller. You’ll see how to do that in “<a href="text00022.html#ch11lev3sec2">Making the Birthdays Table View Controller Conform to Protocol</a>
 ” on <a href="text00022.html#page_168">page 168</a>
 .</p>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>Remember that the final versions of the project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>.</em>
</p>
</div>
<p class="indent">The <span class="code">BirthdaysTableViewController</span>
 will also need a <span class="code">dateFormatter</span>
 property to display the birthdate as a nicely formatted string. Add a <span class="code">dateFormatter</span>
 right underneath the <span class="code">birthdays</span>
 array:</p>
<div class="box">
<pre>    <span class="ash">var birthdays = [Birthday]()</span>
<br />
<br />
    <span class="pink">let</span>
 dateFormatter = <span class="violet">DateFormatter</span>
 ()<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent">Note that the <span class="code">dateFormatter</span>
 is a constant that is created with <span class="code">let</span>
 . Even though you’ll change the <span class="code">dateFormatter</span>
 ’s properties, like the <span class="code">dateStyle</span>
 and <span class="code">timeStyle</span>
 , you’ll never change the <span class="code">dateFormatter</span>
 itself.</p>
<p class="indent"><span id="page_162"></span>
 You’ll also need to set up the <span class="code">dateFormatter</span>
 so that it will display the birthdates as fully formatted strings like <span class="code">"Tuesday, December 17, 2008"</span>
 . As you saw in <a href="text00021.html#ch10">Chapter 10</a>
 , a good place to do this is the <span class="code">viewDidLoad()</span>
 method, which is called when the Birthdays table view controller is loading its view. This is the perfect place to do any setup that is needed for this class.</p>
<div class="box">
<pre>
<span class="ash">override func viewDidLoad() {</span>
<br />
    <span class="ash">super.viewDidLoad()</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">dateFormatter</span>
 .<span class="violet">dateStyle</span>
 = .<span class="blue">full</span>
<br />
  <span class="ent">➋</span>
 <span class="green1">dateFormatter</span>
 .<span class="violet">timeStyle</span>
 = .<span class="blue">none</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , you set the <span class="code">dateStyle</span>
 of the <span class="code">dateFormatter</span>
 so that it will display a formatted date string for each <span class="code">Birthday</span>
 . Did you notice how we just wrote <span class="code">.full</span>
 instead of <span class="code">DateFormatter.Style.full</span>
 ? Swift knows what type to expect for the <span class="code">dateStyle</span>
 of a <span class="code">DateFormatter</span>
 , so it lets us take this little shortcut. At <span class="ent">➋</span>
 , you set the <span class="code">timeStyle</span>
 of the <span class="code">dateFormatter</span>
 to <span class="code">.none</span>
 so that the time won’t be shown.</p>
<h4 class="h4" id="ch11lev2sec4">
<strong>DISPLAYING BIRTHDAYS IN A TABLE VIEW</strong>
</h4>
<p class="noindent">The <span class="code">BirthdaysTableViewController</span>
 class has a table view that is used to display a list of items in a single column. The table view has one or more sections containing rows, and each row contains a cell. A section in a table view is a grouping of rows that can be displayed with or without a header. An example of an app that shows a table view with several sections is the Settings app, as shown in <a href="text00022.html#ch11fig5">Figure 11-5</a>
 . It displays a list of rows that have been broken up into different sections.</p>
<p class="indent">Each section and row of a table view is identified with an index number. These numbers start at 0 and then increase by 1 as you go down the table view. For example, the Privacy line in the Settings app is found at section 0, row 1. The News setting is at section 1, row 3.</p>
<p class="indent">In the middle of the <span class="code">BirthdaysTableViewController</span>
 class, there is a section called <em>Table view data source</em>
 with three methods. The table view controller uses these methods to determine what’s going to be displayed inside its table view.</p>
<p class="hang">
<span class="code">
<span class="codestrong">numberOfSections(in:)</span>
</span>
 Tells the table view how many sections it should have</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:numberOfRowsInSection:)</span>
</span>
 Tells the table view how many rows will be displayed in each section</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:cellForRowAt:)</span>
</span>
 Sets up each cell that’s going to be displayed in each row of the table view</p>
<div class="image"><span id="page_163"></span>
 <img src="Image00243.jpg" />
</div>
<p class="figcap"><a id="ch11fig5"></a>
 <em>Figure 11-5: The Settings app uses sections to group rows of different device settings.</em>
</p>
<p class="indent">The table view data source methods are called by the table view controller every time the table view is reloaded. Xcode automatically gives you these method templates when you make a subclass of a <span class="code">UITableViewController</span>
 . You need to implement all three methods for the app to work, even though you’ll never call them directly in your code. The <span class="code">UITableViewController</span>
 class implements the <span class="code">UITableViewDataSource</span>
 protocol, which comes with these data source methods, to determine what will be displayed inside the table view. We’ll discuss protocols in “<a href="text00022.html#ch11lev2sec5">Delegation</a>
 ” on page 166. For now, you just need to know that a <span class="code">UITableViewController</span>
 uses these methods to display its content, and it automatically calls these methods so you don’t need to call them.</p>
<p class="indent">Let’s start with the method <span class="code">numberOfSections(in:)</span>
 . The Birthdays table view controller is a list that just displays <span class="code">Birthday</span>
 instances, so it doesn’t need multiple sections. To set the number of sections in the table view, we just need to return <span class="code">1</span>
 .</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func numberOfSections(in tableView: UITableView) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 <span class="blue1">1</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent"><span id="page_164"></span>
 This method takes a <span class="code">UITableView</span>
 called <span class="code">tableView</span>
 as a parameter, which is the table view that uses this class as its data source. We don’t need to worry about making this connection because the <span class="code">UITableViewController</span>
 comes with a built-in table view that is automatically hooked up to these methods. Each birthday will be displayed in its own row. So in <span class="code">tableView(_:numberOfRowsInSection:)</span>
 , in order to have the right number of rows for all of your birthdays, you need to return the number of <span class="code">Birthday</span>
 instances that you have in your <span class="code">birthdays</span>
 array. Do you remember the <span class="code">count</span>
 property of an array? It’s an integer that tells you how many items are in that array, and it’s perfect for this situation! Change this method to the following:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, <img class="inline" src="Image00184.jpg" />
<br />
    numberOfRowsInSection section: Int) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 birthdays.<span class="violet">count</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">In addition to the <span class="code">tableView</span>
 parameter, <span class="code">tableView(_:numberOfRowsInSection:)</span>
 also takes an <span class="code">Int</span>
 called <span class="code">section</span>
 . When the table view is loading itself, this method is called for each section in the table view. In our case, we have only one section, so we don’t need to bother checking which <span class="code">section</span>
 of the table view is being displayed here. We know it’s section 0, and we want it to have as many rows as there are birthdays, so we write <span class="code">return birthdays.count</span>
 .</p>
<p class="indent">Finally, you need to implement <span class="code">tableView(_:cellForRowAt:)</span>
 so that the table view will know what to put inside each cell. Since this method is commented out, you need to uncomment it by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it. (Be careful not to accidentally uncomment the other methods after it!) After you’ve done that, change it to the following code:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, cellForRowAt <img class="inline" src="Image00184.jpg" />
<br />
    indexPath: IndexPath) -&gt; UITableViewCell {</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="pink">let</span>
 cell = tableView.<span class="blue">dequeueReusableCell</span>
 (withIdentifier: <img class="inline" src="Image00093.jpg" />
<br />
        <span class="red">"birthdayCellIdentifier"</span>
 , for: indexPath)<br />
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 birthday = <span class="green1">birthdays</span>
 [indexPath.<span class="violet">row</span>
 ]<br />
<br />
  <span class="ent">➌</span>
 cell.<span class="violet">textLabel</span>
 ?.<span class="violet">text</span>
 = birthday.<span class="green1">firstName</span>
 <span class="blue">+</span>
 <span class="red">" "</span>
 <span class="blue">+</span>
 <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">lastName</span>
<br />
<br />
  <span class="ent">➍</span>
 cell.<span class="violet">detailTextLabel</span>
 ?.<span class="violet">text</span>
 = <span class="green1">dateFormatter</span>
 .<span class="blue">string</span>
 (from: <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">birthdate</span>
 )<br />
<br />
  <span class="ent">➎</span>
 <span class="pink">return</span>
 cell<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">You don’t call the method <span class="code">tableView(_:cellForRowAt:)</span>
 . It’s called when the table view is loaded onto the screen. It’s called for each cell on the screen and takes two parameters, <span class="code">tableView</span>
 and <span class="code">indexPath</span>
 . You already know <span id="page_165"></span>
 what the <span class="code">tableView</span>
 parameter is for. An <span class="code">IndexPath</span>
 is a Swift struct that’s used to represent a row’s position in a table view. An <span class="code">IndexPath</span>
 instance has a <span class="code">section</span>
 property and a <span class="code">row</span>
 property. Since this method will be called many times (once for every row in the table), we need the <span class="code">indexPath</span>
 to know which section and row we’re currently configuring. The <span class="code">indexPath.section</span>
 property gives the section number, and the <span class="code">indexPath.row</span>
 gives the row of the table view cell. The five lines of code inside <span class="code">tableView(_:cellForRowAt:)</span>
 will do the following:</p>
<div class="image"><img src="Image00244.jpg" />
</div>
<p class="bull">• Create a <span class="code">UITableViewCell</span>
</p>
<p class="bull">• Figure out which <span class="code">Birthday</span>
 in the <span class="code">birthdays</span>
 array will be displayed inside the cell</p>
<p class="bull">• Make two labels to display the birthday person’s name and birthdate in the cell</p>
<p class="bull">• Return the cell ready for display in the table view</p>
<p class="indentt">Let’s go through this code line by line.</p>
<p class="indent">First, create the <span class="code">UITableViewCell</span>
 . The code at <span class="ent">➊</span>
 does this using the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 . Before you can start using this method on a cell, though, you need to tell the method which cell you want to use from the storyboard. Earlier, when you were in the storyboard, you gave your cell the identifier <span class="code">birthdayCellIdentifier</span>
 (see <a href="text00022.html#ch11fig4">Figure 11-4</a>
 ). This identifier links your code to the cell and tells your method that it’s using the right cell. The string for when you call this method needs to be exactly the same as the string you set in the storyboard, or you’ll get an error and the app will crash when you run it.</p>
<p class="indent">In the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 , did you notice the words <em>Reusable Cell</em>
 ? The cells inside a table view are created once and then can be reused over and over. This helps everything run faster and smoother because creating the cell is what takes the most time. If you had 200 birthdays in your app, but only 10 would fit on your screen at one time, then you need only 10 cells to show your birthdays. When you scroll down to reveal more birthdays, the cells that scroll off the top of the screen are reused. They are filled with new information and show up again at the bottom of the screen. The <span class="code">UITableView</span>
 automatically does this work. When the table view is loaded, <span class="code">tableView(_:cellForRowAt:)</span>
 is called for every visible row. When the user scrolls to look at more cells, it’s called again for each row just as it is about to appear on the screen.</p>
<p class="indent">Next, we need to find out which <span class="code">Birthday</span>
 should be displayed inside the cell. We want to display one birthday from the <span class="code">birthdays</span>
 array in each row. The first birthday, which is at <span class="code">birthdays[0]</span>
 , should be displayed in row 0. The second birthday, at <span class="code">birthdays[1]</span>
 , should be displayed in row 1, and so on, which means the <span class="code">indexPath</span>
 ’s <span class="code">row</span>
 is the same as the position in the <span class="code">birthdays</span>
 array that we want to access. The code at <span class="ent">➋</span>
 accesses the <span id="page_166"></span>
 correct <span class="code">Birthday</span>
 object from the <span class="code">birthdays</span>
 array by using <span class="code">indexPath.row</span>
 . Once we have the right <span class="code">Birthday</span>
 object, we assign it to a constant named <span class="code">birthday</span>
 so we can set up the labels in this cell.</p>
<p class="indent">Notice that we’re using <span class="code">let</span>
 to assign the <span class="code">birthday</span>
 to a constant instead of a variable. We can use <span class="code">let</span>
 because each time <span class="code">tableView(_:cellForRowAt:)</span>
 is called, a new <span class="code">birthday</span>
 constant is created. Each cell gets its own <span class="code">birthday</span>
 constant that is assigned its own <span class="code">Birthday</span>
 object. Since we’re not going to change any of the <span class="code">birthday</span>
 constants—we’re just going to read their properties—we don’t want to make them variables.</p>
<p class="indent">Now that you have your cell and your birthday, it’s time to fill in the details. You need two labels for each cell to show the birthday person’s name and birthdate. You set the cell to the Subtitle style so that it has a Title label and a Subtitle label. Each cell will already contain these labels, so now you don’t have to create any labels yourself.</p>
<p class="indent">The labels exist as properties of <span class="code">UITableViewCell</span>
 and are called <span class="code">textLabel</span>
 and <span class="code">detailTextLabel</span>
 . The code at <span class="ent">➌</span>
 sets the text of the <span class="code">textLabel</span>
 to a string made up of the <span class="code">firstName</span>
 and <span class="code">lastName</span>
 of the <span class="code">birthday</span>
 with a space between them. At <span class="ent">➍</span>
 , you use the <span class="code">string(from:)</span>
 method of the <span class="code">dateFormatter</span>
 to display the birthdate in the <span class="code">detailTextLabel</span>
 .</p>
<p class="indent">When your cell is completely configured, <span class="code">tableView( _:cellForRowAt:)</span>
 returns the cell at <span class="ent">➎</span>
 so that it can be displayed at that <span class="code">indexPath</span>
 of the table view.</p>
<h3 class="h3" id="ch11lev1sec2">
<strong>PUTTING IT ALL TOGETHER</strong>
</h3>
<p class="noindent">Now you can add <span class="code">Birthday</span>
 instances to the app using the Add Birthday view controller, and you have a table view to list each <span class="code">Birthday</span>
 in the Birthdays table view controller. But when you try running the app and adding a <span class="code">Birthday</span>
 , it doesn’t appear. To make each <span class="code">Birthday</span>
 you add appear in the table view, you need to make the Add Birthday view controller communicate with the Birthdays table view controller. You do this by using <em>delegation</em>
 .</p>
<h4 class="h4" id="ch11lev2sec5">
<strong>DELEGATION</strong>
</h4>
<p class="noindent">Delegation can be used when one view controller needs to get information from another view controller. Say you have two view controllers: A and B. The first view controller, A, creates B and presents B on top of itself. A knows about B because it created and presented B, so A can pass information along to B. But B doesn’t know about A—it’s just popped into being and doesn’t know where it came from or how it got there. So how can B talk to A? Through delegation!</p>
<div class="image"><img src="Image00245.jpg" />
</div>
<p class="indent">Delegation is when someone gives a job or a task to someone else. A <em>delegate</em>
 is like a boss who tells a delegating employee what to do. When the delegating employee is done with their task, sometimes they’ll report information back to the delegate boss.</p>
<p class="indent"><span id="page_167"></span>
 Delegation in Swift is pretty similar, but instead of having a boss and employee, we have a delegate and a delegating object. Since class B is the one being told what to do by class A, it’s the delegating object. We give class B a special property called a delegate to tell it who its delegate is—that way, it knows who to communicate with. The delegate can be any class that has a set of methods that have been defined in a <em>protocol</em>
 . A protocol is like an agreement between the two classes that tells them what the delegate can ask the delegating object to do. It has a list of method and property names that the delegate can use with the delegating object.</p>
<p class="indent">Class A creates class B, makes itself the delegate of class B, and gives class B a job to do that’s in the protocol. Once class B is done with its job, it reports back to class A. Let’s see how this works in our app.</p>
<p class="indent">The Birthdays table view controller is view controller A, and the Add Birthday view controller is view controller B. We’ll create a protocol called <span class="code">AddBirthdayViewControllerDelegate</span>
 and a method for that protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 , which the Add Birthday view controller will use to report back.</p>
<p class="indent">Take a look at <a href="text00022.html#ch11fig6">Figure 11-6</a>
 . When the user taps the Add button <span class="ent">➊</span>
 , the Birthdays table view controller creates the Add Birthday view controller <span class="ent">➋</span>
 and sets itself as the Add Birthday view controller’s delegate.</p>
<div class="image"><img src="Image00246.jpg" />
</div>
<p class="figcap"><a id="ch11fig6"></a>
 <em>Figure 11-6: A new birthday is added and passed from the Add Birthday view controller to the Birthdays table view controller using delegation.</em>
</p>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<div class="note">
<p class="notet">
<strong>
<span class="bgblue">NOTE</span>
</strong>
</p>
<p class="notep">
<em>Remember that the final versions of the project files are available from</em>
 <a href="https://www.nostarch.com/iphoneappsforkids/">https://www.nostarch.com/iphoneappsforkids/</a>
 <em>.</em>
</p>
</div>
<p class="indent">The <span class="code">BirthdaysTableViewController</span>
 will also need a <span class="code">dateFormatter</span>
 property to display the birthdate as a nicely formatted string. Add a <span class="code">dateFormatter</span>
 right underneath the <span class="code">birthdays</span>
 array:</p>
<div class="box">
<pre>    <span class="ash">var birthdays = [Birthday]()</span>
<br />
<br />
    <span class="pink">let</span>
 dateFormatter = <span class="violet">DateFormatter</span>
 ()<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent">Note that the <span class="code">dateFormatter</span>
 is a constant that is created with <span class="code">let</span>
 . Even though you’ll change the <span class="code">dateFormatter</span>
 ’s properties, like the <span class="code">dateStyle</span>
 and <span class="code">timeStyle</span>
 , you’ll never change the <span class="code">dateFormatter</span>
 itself.</p>
<p class="indent"><span id="page_162"></span>
 You’ll also need to set up the <span class="code">dateFormatter</span>
 so that it will display the birthdates as fully formatted strings like <span class="code">"Tuesday, December 17, 2008"</span>
 . As you saw in <a href="text00021.html#ch10">Chapter 10</a>
 , a good place to do this is the <span class="code">viewDidLoad()</span>
 method, which is called when the Birthdays table view controller is loading its view. This is the perfect place to do any setup that is needed for this class.</p>
<div class="box">
<pre>
<span class="ash">override func viewDidLoad() {</span>
<br />
    <span class="ash">super.viewDidLoad()</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">dateFormatter</span>
 .<span class="violet">dateStyle</span>
 = .<span class="blue">full</span>
<br />
  <span class="ent">➋</span>
 <span class="green1">dateFormatter</span>
 .<span class="violet">timeStyle</span>
 = .<span class="blue">none</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , you set the <span class="code">dateStyle</span>
 of the <span class="code">dateFormatter</span>
 so that it will display a formatted date string for each <span class="code">Birthday</span>
 . Did you notice how we just wrote <span class="code">.full</span>
 instead of <span class="code">DateFormatter.Style.full</span>
 ? Swift knows what type to expect for the <span class="code">dateStyle</span>
 of a <span class="code">DateFormatter</span>
 , so it lets us take this little shortcut. At <span class="ent">➋</span>
 , you set the <span class="code">timeStyle</span>
 of the <span class="code">dateFormatter</span>
 to <span class="code">.none</span>
 so that the time won’t be shown.</p>
<h4 class="h4" id="ch11lev2sec4">
<strong>DISPLAYING BIRTHDAYS IN A TABLE VIEW</strong>
</h4>
<p class="noindent">The <span class="code">BirthdaysTableViewController</span>
 class has a table view that is used to display a list of items in a single column. The table view has one or more sections containing rows, and each row contains a cell. A section in a table view is a grouping of rows that can be displayed with or without a header. An example of an app that shows a table view with several sections is the Settings app, as shown in <a href="text00022.html#ch11fig5">Figure 11-5</a>
 . It displays a list of rows that have been broken up into different sections.</p>
<p class="indent">Each section and row of a table view is identified with an index number. These numbers start at 0 and then increase by 1 as you go down the table view. For example, the Privacy line in the Settings app is found at section 0, row 1. The News setting is at section 1, row 3.</p>
<p class="indent">In the middle of the <span class="code">BirthdaysTableViewController</span>
 class, there is a section called <em>Table view data source</em>
 with three methods. The table view controller uses these methods to determine what’s going to be displayed inside its table view.</p>
<p class="hang">
<span class="code">
<span class="codestrong">numberOfSections(in:)</span>
</span>
 Tells the table view how many sections it should have</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:numberOfRowsInSection:)</span>
</span>
 Tells the table view how many rows will be displayed in each section</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:cellForRowAt:)</span>
</span>
 Sets up each cell that’s going to be displayed in each row of the table view</p>
<div class="image"><span id="page_163"></span>
 <img src="Image00243.jpg" />
</div>
<p class="figcap"><a id="ch11fig5"></a>
 <em>Figure 11-5: The Settings app uses sections to group rows of different device settings.</em>
</p>
<p class="indent">The table view data source methods are called by the table view controller every time the table view is reloaded. Xcode automatically gives you these method templates when you make a subclass of a <span class="code">UITableViewController</span>
 . You need to implement all three methods for the app to work, even though you’ll never call them directly in your code. The <span class="code">UITableViewController</span>
 class implements the <span class="code">UITableViewDataSource</span>
 protocol, which comes with these data source methods, to determine what will be displayed inside the table view. We’ll discuss protocols in “<a href="text00022.html#ch11lev2sec5">Delegation</a>
 ” on page 166. For now, you just need to know that a <span class="code">UITableViewController</span>
 uses these methods to display its content, and it automatically calls these methods so you don’t need to call them.</p>
<p class="indent">Let’s start with the method <span class="code">numberOfSections(in:)</span>
 . The Birthdays table view controller is a list that just displays <span class="code">Birthday</span>
 instances, so it doesn’t need multiple sections. To set the number of sections in the table view, we just need to return <span class="code">1</span>
 .</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func numberOfSections(in tableView: UITableView) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 <span class="blue1">1</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent"><span id="page_164"></span>
 This method takes a <span class="code">UITableView</span>
 called <span class="code">tableView</span>
 as a parameter, which is the table view that uses this class as its data source. We don’t need to worry about making this connection because the <span class="code">UITableViewController</span>
 comes with a built-in table view that is automatically hooked up to these methods. Each birthday will be displayed in its own row. So in <span class="code">tableView(_:numberOfRowsInSection:)</span>
 , in order to have the right number of rows for all of your birthdays, you need to return the number of <span class="code">Birthday</span>
 instances that you have in your <span class="code">birthdays</span>
 array. Do you remember the <span class="code">count</span>
 property of an array? It’s an integer that tells you how many items are in that array, and it’s perfect for this situation! Change this method to the following:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, <img class="inline" src="Image00184.jpg" />
<br />
    numberOfRowsInSection section: Int) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 birthdays.<span class="violet">count</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">In addition to the <span class="code">tableView</span>
 parameter, <span class="code">tableView(_:numberOfRowsInSection:)</span>
 also takes an <span class="code">Int</span>
 called <span class="code">section</span>
 . When the table view is loading itself, this method is called for each section in the table view. In our case, we have only one section, so we don’t need to bother checking which <span class="code">section</span>
 of the table view is being displayed here. We know it’s section 0, and we want it to have as many rows as there are birthdays, so we write <span class="code">return birthdays.count</span>
 .</p>
<p class="indent">Finally, you need to implement <span class="code">tableView(_:cellForRowAt:)</span>
 so that the table view will know what to put inside each cell. Since this method is commented out, you need to uncomment it by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it. (Be careful not to accidentally uncomment the other methods after it!) After you’ve done that, change it to the following code:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, cellForRowAt <img class="inline" src="Image00184.jpg" />
<br />
    indexPath: IndexPath) -&gt; UITableViewCell {</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="pink">let</span>
 cell = tableView.<span class="blue">dequeueReusableCell</span>
 (withIdentifier: <img class="inline" src="Image00093.jpg" />
<br />
        <span class="red">"birthdayCellIdentifier"</span>
 , for: indexPath)<br />
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 birthday = <span class="green1">birthdays</span>
 [indexPath.<span class="violet">row</span>
 ]<br />
<br />
  <span class="ent">➌</span>
 cell.<span class="violet">textLabel</span>
 ?.<span class="violet">text</span>
 = birthday.<span class="green1">firstName</span>
 <span class="blue">+</span>
 <span class="red">" "</span>
 <span class="blue">+</span>
 <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">lastName</span>
<br />
<br />
  <span class="ent">➍</span>
 cell.<span class="violet">detailTextLabel</span>
 ?.<span class="violet">text</span>
 = <span class="green1">dateFormatter</span>
 .<span class="blue">string</span>
 (from: <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">birthdate</span>
 )<br />
<br />
  <span class="ent">➎</span>
 <span class="pink">return</span>
 cell<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">You don’t call the method <span class="code">tableView(_:cellForRowAt:)</span>
 . It’s called when the table view is loaded onto the screen. It’s called for each cell on the screen and takes two parameters, <span class="code">tableView</span>
 and <span class="code">indexPath</span>
 . You already know <span id="page_165"></span>
 what the <span class="code">tableView</span>
 parameter is for. An <span class="code">IndexPath</span>
 is a Swift struct that’s used to represent a row’s position in a table view. An <span class="code">IndexPath</span>
 instance has a <span class="code">section</span>
 property and a <span class="code">row</span>
 property. Since this method will be called many times (once for every row in the table), we need the <span class="code">indexPath</span>
 to know which section and row we’re currently configuring. The <span class="code">indexPath.section</span>
 property gives the section number, and the <span class="code">indexPath.row</span>
 gives the row of the table view cell. The five lines of code inside <span class="code">tableView(_:cellForRowAt:)</span>
 will do the following:</p>
<div class="image"><img src="Image00244.jpg" />
</div>
<p class="bull">• Create a <span class="code">UITableViewCell</span>
</p>
<p class="bull">• Figure out which <span class="code">Birthday</span>
 in the <span class="code">birthdays</span>
 array will be displayed inside the cell</p>
<p class="bull">• Make two labels to display the birthday person’s name and birthdate in the cell</p>
<p class="bull">• Return the cell ready for display in the table view</p>
<p class="indentt">Let’s go through this code line by line.</p>
<p class="indent">First, create the <span class="code">UITableViewCell</span>
 . The code at <span class="ent">➊</span>
 does this using the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 . Before you can start using this method on a cell, though, you need to tell the method which cell you want to use from the storyboard. Earlier, when you were in the storyboard, you gave your cell the identifier <span class="code">birthdayCellIdentifier</span>
 (see <a href="text00022.html#ch11fig4">Figure 11-4</a>
 ). This identifier links your code to the cell and tells your method that it’s using the right cell. The string for when you call this method needs to be exactly the same as the string you set in the storyboard, or you’ll get an error and the app will crash when you run it.</p>
<p class="indent">In the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 , did you notice the words <em>Reusable Cell</em>
 ? The cells inside a table view are created once and then can be reused over and over. This helps everything run faster and smoother because creating the cell is what takes the most time. If you had 200 birthdays in your app, but only 10 would fit on your screen at one time, then you need only 10 cells to show your birthdays. When you scroll down to reveal more birthdays, the cells that scroll off the top of the screen are reused. They are filled with new information and show up again at the bottom of the screen. The <span class="code">UITableView</span>
 automatically does this work. When the table view is loaded, <span class="code">tableView(_:cellForRowAt:)</span>
 is called for every visible row. When the user scrolls to look at more cells, it’s called again for each row just as it is about to appear on the screen.</p>
<p class="indent">Next, we need to find out which <span class="code">Birthday</span>
 should be displayed inside the cell. We want to display one birthday from the <span class="code">birthdays</span>
 array in each row. The first birthday, which is at <span class="code">birthdays[0]</span>
 , should be displayed in row 0. The second birthday, at <span class="code">birthdays[1]</span>
 , should be displayed in row 1, and so on, which means the <span class="code">indexPath</span>
 ’s <span class="code">row</span>
 is the same as the position in the <span class="code">birthdays</span>
 array that we want to access. The code at <span class="ent">➋</span>
 accesses the <span id="page_166"></span>
 correct <span class="code">Birthday</span>
 object from the <span class="code">birthdays</span>
 array by using <span class="code">indexPath.row</span>
 . Once we have the right <span class="code">Birthday</span>
 object, we assign it to a constant named <span class="code">birthday</span>
 so we can set up the labels in this cell.</p>
<p class="indent">Notice that we’re using <span class="code">let</span>
 to assign the <span class="code">birthday</span>
 to a constant instead of a variable. We can use <span class="code">let</span>
 because each time <span class="code">tableView(_:cellForRowAt:)</span>
 is called, a new <span class="code">birthday</span>
 constant is created. Each cell gets its own <span class="code">birthday</span>
 constant that is assigned its own <span class="code">Birthday</span>
 object. Since we’re not going to change any of the <span class="code">birthday</span>
 constants—we’re just going to read their properties—we don’t want to make them variables.</p>
<p class="indent">Now that you have your cell and your birthday, it’s time to fill in the details. You need two labels for each cell to show the birthday person’s name and birthdate. You set the cell to the Subtitle style so that it has a Title label and a Subtitle label. Each cell will already contain these labels, so now you don’t have to create any labels yourself.</p>
<p class="indent">The labels exist as properties of <span class="code">UITableViewCell</span>
 and are called <span class="code">textLabel</span>
 and <span class="code">detailTextLabel</span>
 . The code at <span class="ent">➌</span>
 sets the text of the <span class="code">textLabel</span>
 to a string made up of the <span class="code">firstName</span>
 and <span class="code">lastName</span>
 of the <span class="code">birthday</span>
 with a space between them. At <span class="ent">➍</span>
 , you use the <span class="code">string(from:)</span>
 method of the <span class="code">dateFormatter</span>
 to display the birthdate in the <span class="code">detailTextLabel</span>
 .</p>
<p class="indent">When your cell is completely configured, <span class="code">tableView( _:cellForRowAt:)</span>
 returns the cell at <span class="ent">➎</span>
 so that it can be displayed at that <span class="code">indexPath</span>
 of the table view.</p>
<h3 class="h3" id="ch11lev1sec2">
<strong>PUTTING IT ALL TOGETHER</strong>
</h3>
<p class="noindent">Now you can add <span class="code">Birthday</span>
 instances to the app using the Add Birthday view controller, and you have a table view to list each <span class="code">Birthday</span>
 in the Birthdays table view controller. But when you try running the app and adding a <span class="code">Birthday</span>
 , it doesn’t appear. To make each <span class="code">Birthday</span>
 you add appear in the table view, you need to make the Add Birthday view controller communicate with the Birthdays table view controller. You do this by using <em>delegation</em>
 .</p>
<h4 class="h4" id="ch11lev2sec5">
<strong>DELEGATION</strong>
</h4>
<p class="noindent">Delegation can be used when one view controller needs to get information from another view controller. Say you have two view controllers: A and B. The first view controller, A, creates B and presents B on top of itself. A knows about B because it created and presented B, so A can pass information along to B. But B doesn’t know about A—it’s just popped into being and doesn’t know where it came from or how it got there. So how can B talk to A? Through delegation!</p>
<div class="image"><img src="Image00245.jpg" />
</div>
<p class="indent">Delegation is when someone gives a job or a task to someone else. A <em>delegate</em>
 is like a boss who tells a delegating employee what to do. When the delegating employee is done with their task, sometimes they’ll report information back to the delegate boss.</p>
<p class="indent"><span id="page_167"></span>
 Delegation in Swift is pretty similar, but instead of having a boss and employee, we have a delegate and a delegating object. Since class B is the one being told what to do by class A, it’s the delegating object. We give class B a special property called a delegate to tell it who its delegate is—that way, it knows who to communicate with. The delegate can be any class that has a set of methods that have been defined in a <em>protocol</em>
 . A protocol is like an agreement between the two classes that tells them what the delegate can ask the delegating object to do. It has a list of method and property names that the delegate can use with the delegating object.</p>
<p class="indent">Class A creates class B, makes itself the delegate of class B, and gives class B a job to do that’s in the protocol. Once class B is done with its job, it reports back to class A. Let’s see how this works in our app.</p>
<p class="indent">The Birthdays table view controller is view controller A, and the Add Birthday view controller is view controller B. We’ll create a protocol called <span class="code">AddBirthdayViewControllerDelegate</span>
 and a method for that protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 , which the Add Birthday view controller will use to report back.</p>
<p class="indent">Take a look at <a href="text00022.html#ch11fig6">Figure 11-6</a>
 . When the user taps the Add button <span class="ent">➊</span>
 , the Birthdays table view controller creates the Add Birthday view controller <span class="ent">➋</span>
 and sets itself as the Add Birthday view controller’s delegate.</p>
<div class="image"><img src="Image00246.jpg" />
</div>
<p class="figcap"><a id="ch11fig6"></a>
 <em>Figure 11-6: A new birthday is added and passed from the Add Birthday view controller to the Birthdays table view controller using delegation.</em>
</p>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="indent">The <span class="code">BirthdaysTableViewController</span>
 will also need a <span class="code">dateFormatter</span>
 property to display the birthdate as a nicely formatted string. Add a <span class="code">dateFormatter</span>
 right underneath the <span class="code">birthdays</span>
 array:</p>
<div class="box">
<pre>    <span class="ash">var birthdays = [Birthday]()</span>
<br />
<br />
    <span class="pink">let</span>
 dateFormatter = <span class="violet">DateFormatter</span>
 ()<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent">Note that the <span class="code">dateFormatter</span>
 is a constant that is created with <span class="code">let</span>
 . Even though you’ll change the <span class="code">dateFormatter</span>
 ’s properties, like the <span class="code">dateStyle</span>
 and <span class="code">timeStyle</span>
 , you’ll never change the <span class="code">dateFormatter</span>
 itself.</p>
<p class="indent"><span id="page_162"></span>
 You’ll also need to set up the <span class="code">dateFormatter</span>
 so that it will display the birthdates as fully formatted strings like <span class="code">"Tuesday, December 17, 2008"</span>
 . As you saw in <a href="text00021.html#ch10">Chapter 10</a>
 , a good place to do this is the <span class="code">viewDidLoad()</span>
 method, which is called when the Birthdays table view controller is loading its view. This is the perfect place to do any setup that is needed for this class.</p>
<div class="box">
<pre>
<span class="ash">override func viewDidLoad() {</span>
<br />
    <span class="ash">super.viewDidLoad()</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">dateFormatter</span>
 .<span class="violet">dateStyle</span>
 = .<span class="blue">full</span>
<br />
  <span class="ent">➋</span>
 <span class="green1">dateFormatter</span>
 .<span class="violet">timeStyle</span>
 = .<span class="blue">none</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , you set the <span class="code">dateStyle</span>
 of the <span class="code">dateFormatter</span>
 so that it will display a formatted date string for each <span class="code">Birthday</span>
 . Did you notice how we just wrote <span class="code">.full</span>
 instead of <span class="code">DateFormatter.Style.full</span>
 ? Swift knows what type to expect for the <span class="code">dateStyle</span>
 of a <span class="code">DateFormatter</span>
 , so it lets us take this little shortcut. At <span class="ent">➋</span>
 , you set the <span class="code">timeStyle</span>
 of the <span class="code">dateFormatter</span>
 to <span class="code">.none</span>
 so that the time won’t be shown.</p>
<h4 class="h4" id="ch11lev2sec4">
<strong>DISPLAYING BIRTHDAYS IN A TABLE VIEW</strong>
</h4>
<p class="noindent">The <span class="code">BirthdaysTableViewController</span>
 class has a table view that is used to display a list of items in a single column. The table view has one or more sections containing rows, and each row contains a cell. A section in a table view is a grouping of rows that can be displayed with or without a header. An example of an app that shows a table view with several sections is the Settings app, as shown in <a href="text00022.html#ch11fig5">Figure 11-5</a>
 . It displays a list of rows that have been broken up into different sections.</p>
<p class="indent">Each section and row of a table view is identified with an index number. These numbers start at 0 and then increase by 1 as you go down the table view. For example, the Privacy line in the Settings app is found at section 0, row 1. The News setting is at section 1, row 3.</p>
<p class="indent">In the middle of the <span class="code">BirthdaysTableViewController</span>
 class, there is a section called <em>Table view data source</em>
 with three methods. The table view controller uses these methods to determine what’s going to be displayed inside its table view.</p>
<p class="hang">
<span class="code">
<span class="codestrong">numberOfSections(in:)</span>
</span>
 Tells the table view how many sections it should have</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:numberOfRowsInSection:)</span>
</span>
 Tells the table view how many rows will be displayed in each section</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:cellForRowAt:)</span>
</span>
 Sets up each cell that’s going to be displayed in each row of the table view</p>
<div class="image"><span id="page_163"></span>
 <img src="Image00243.jpg" />
</div>
<p class="figcap"><a id="ch11fig5"></a>
 <em>Figure 11-5: The Settings app uses sections to group rows of different device settings.</em>
</p>
<p class="indent">The table view data source methods are called by the table view controller every time the table view is reloaded. Xcode automatically gives you these method templates when you make a subclass of a <span class="code">UITableViewController</span>
 . You need to implement all three methods for the app to work, even though you’ll never call them directly in your code. The <span class="code">UITableViewController</span>
 class implements the <span class="code">UITableViewDataSource</span>
 protocol, which comes with these data source methods, to determine what will be displayed inside the table view. We’ll discuss protocols in “<a href="text00022.html#ch11lev2sec5">Delegation</a>
 ” on page 166. For now, you just need to know that a <span class="code">UITableViewController</span>
 uses these methods to display its content, and it automatically calls these methods so you don’t need to call them.</p>
<p class="indent">Let’s start with the method <span class="code">numberOfSections(in:)</span>
 . The Birthdays table view controller is a list that just displays <span class="code">Birthday</span>
 instances, so it doesn’t need multiple sections. To set the number of sections in the table view, we just need to return <span class="code">1</span>
 .</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func numberOfSections(in tableView: UITableView) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 <span class="blue1">1</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent"><span id="page_164"></span>
 This method takes a <span class="code">UITableView</span>
 called <span class="code">tableView</span>
 as a parameter, which is the table view that uses this class as its data source. We don’t need to worry about making this connection because the <span class="code">UITableViewController</span>
 comes with a built-in table view that is automatically hooked up to these methods. Each birthday will be displayed in its own row. So in <span class="code">tableView(_:numberOfRowsInSection:)</span>
 , in order to have the right number of rows for all of your birthdays, you need to return the number of <span class="code">Birthday</span>
 instances that you have in your <span class="code">birthdays</span>
 array. Do you remember the <span class="code">count</span>
 property of an array? It’s an integer that tells you how many items are in that array, and it’s perfect for this situation! Change this method to the following:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, <img class="inline" src="Image00184.jpg" />
<br />
    numberOfRowsInSection section: Int) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 birthdays.<span class="violet">count</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">In addition to the <span class="code">tableView</span>
 parameter, <span class="code">tableView(_:numberOfRowsInSection:)</span>
 also takes an <span class="code">Int</span>
 called <span class="code">section</span>
 . When the table view is loading itself, this method is called for each section in the table view. In our case, we have only one section, so we don’t need to bother checking which <span class="code">section</span>
 of the table view is being displayed here. We know it’s section 0, and we want it to have as many rows as there are birthdays, so we write <span class="code">return birthdays.count</span>
 .</p>
<p class="indent">Finally, you need to implement <span class="code">tableView(_:cellForRowAt:)</span>
 so that the table view will know what to put inside each cell. Since this method is commented out, you need to uncomment it by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it. (Be careful not to accidentally uncomment the other methods after it!) After you’ve done that, change it to the following code:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, cellForRowAt <img class="inline" src="Image00184.jpg" />
<br />
    indexPath: IndexPath) -&gt; UITableViewCell {</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="pink">let</span>
 cell = tableView.<span class="blue">dequeueReusableCell</span>
 (withIdentifier: <img class="inline" src="Image00093.jpg" />
<br />
        <span class="red">"birthdayCellIdentifier"</span>
 , for: indexPath)<br />
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 birthday = <span class="green1">birthdays</span>
 [indexPath.<span class="violet">row</span>
 ]<br />
<br />
  <span class="ent">➌</span>
 cell.<span class="violet">textLabel</span>
 ?.<span class="violet">text</span>
 = birthday.<span class="green1">firstName</span>
 <span class="blue">+</span>
 <span class="red">" "</span>
 <span class="blue">+</span>
 <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">lastName</span>
<br />
<br />
  <span class="ent">➍</span>
 cell.<span class="violet">detailTextLabel</span>
 ?.<span class="violet">text</span>
 = <span class="green1">dateFormatter</span>
 .<span class="blue">string</span>
 (from: <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">birthdate</span>
 )<br />
<br />
  <span class="ent">➎</span>
 <span class="pink">return</span>
 cell<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">You don’t call the method <span class="code">tableView(_:cellForRowAt:)</span>
 . It’s called when the table view is loaded onto the screen. It’s called for each cell on the screen and takes two parameters, <span class="code">tableView</span>
 and <span class="code">indexPath</span>
 . You already know <span id="page_165"></span>
 what the <span class="code">tableView</span>
 parameter is for. An <span class="code">IndexPath</span>
 is a Swift struct that’s used to represent a row’s position in a table view. An <span class="code">IndexPath</span>
 instance has a <span class="code">section</span>
 property and a <span class="code">row</span>
 property. Since this method will be called many times (once for every row in the table), we need the <span class="code">indexPath</span>
 to know which section and row we’re currently configuring. The <span class="code">indexPath.section</span>
 property gives the section number, and the <span class="code">indexPath.row</span>
 gives the row of the table view cell. The five lines of code inside <span class="code">tableView(_:cellForRowAt:)</span>
 will do the following:</p>
<div class="image"><img src="Image00244.jpg" />
</div>
<p class="bull">• Create a <span class="code">UITableViewCell</span>
</p>
<p class="bull">• Figure out which <span class="code">Birthday</span>
 in the <span class="code">birthdays</span>
 array will be displayed inside the cell</p>
<p class="bull">• Make two labels to display the birthday person’s name and birthdate in the cell</p>
<p class="bull">• Return the cell ready for display in the table view</p>
<p class="indentt">Let’s go through this code line by line.</p>
<p class="indent">First, create the <span class="code">UITableViewCell</span>
 . The code at <span class="ent">➊</span>
 does this using the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 . Before you can start using this method on a cell, though, you need to tell the method which cell you want to use from the storyboard. Earlier, when you were in the storyboard, you gave your cell the identifier <span class="code">birthdayCellIdentifier</span>
 (see <a href="text00022.html#ch11fig4">Figure 11-4</a>
 ). This identifier links your code to the cell and tells your method that it’s using the right cell. The string for when you call this method needs to be exactly the same as the string you set in the storyboard, or you’ll get an error and the app will crash when you run it.</p>
<p class="indent">In the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 , did you notice the words <em>Reusable Cell</em>
 ? The cells inside a table view are created once and then can be reused over and over. This helps everything run faster and smoother because creating the cell is what takes the most time. If you had 200 birthdays in your app, but only 10 would fit on your screen at one time, then you need only 10 cells to show your birthdays. When you scroll down to reveal more birthdays, the cells that scroll off the top of the screen are reused. They are filled with new information and show up again at the bottom of the screen. The <span class="code">UITableView</span>
 automatically does this work. When the table view is loaded, <span class="code">tableView(_:cellForRowAt:)</span>
 is called for every visible row. When the user scrolls to look at more cells, it’s called again for each row just as it is about to appear on the screen.</p>
<p class="indent">Next, we need to find out which <span class="code">Birthday</span>
 should be displayed inside the cell. We want to display one birthday from the <span class="code">birthdays</span>
 array in each row. The first birthday, which is at <span class="code">birthdays[0]</span>
 , should be displayed in row 0. The second birthday, at <span class="code">birthdays[1]</span>
 , should be displayed in row 1, and so on, which means the <span class="code">indexPath</span>
 ’s <span class="code">row</span>
 is the same as the position in the <span class="code">birthdays</span>
 array that we want to access. The code at <span class="ent">➋</span>
 accesses the <span id="page_166"></span>
 correct <span class="code">Birthday</span>
 object from the <span class="code">birthdays</span>
 array by using <span class="code">indexPath.row</span>
 . Once we have the right <span class="code">Birthday</span>
 object, we assign it to a constant named <span class="code">birthday</span>
 so we can set up the labels in this cell.</p>
<p class="indent">Notice that we’re using <span class="code">let</span>
 to assign the <span class="code">birthday</span>
 to a constant instead of a variable. We can use <span class="code">let</span>
 because each time <span class="code">tableView(_:cellForRowAt:)</span>
 is called, a new <span class="code">birthday</span>
 constant is created. Each cell gets its own <span class="code">birthday</span>
 constant that is assigned its own <span class="code">Birthday</span>
 object. Since we’re not going to change any of the <span class="code">birthday</span>
 constants—we’re just going to read their properties—we don’t want to make them variables.</p>
<p class="indent">Now that you have your cell and your birthday, it’s time to fill in the details. You need two labels for each cell to show the birthday person’s name and birthdate. You set the cell to the Subtitle style so that it has a Title label and a Subtitle label. Each cell will already contain these labels, so now you don’t have to create any labels yourself.</p>
<p class="indent">The labels exist as properties of <span class="code">UITableViewCell</span>
 and are called <span class="code">textLabel</span>
 and <span class="code">detailTextLabel</span>
 . The code at <span class="ent">➌</span>
 sets the text of the <span class="code">textLabel</span>
 to a string made up of the <span class="code">firstName</span>
 and <span class="code">lastName</span>
 of the <span class="code">birthday</span>
 with a space between them. At <span class="ent">➍</span>
 , you use the <span class="code">string(from:)</span>
 method of the <span class="code">dateFormatter</span>
 to display the birthdate in the <span class="code">detailTextLabel</span>
 .</p>
<p class="indent">When your cell is completely configured, <span class="code">tableView( _:cellForRowAt:)</span>
 returns the cell at <span class="ent">➎</span>
 so that it can be displayed at that <span class="code">indexPath</span>
 of the table view.</p>
<h3 class="h3" id="ch11lev1sec2">
<strong>PUTTING IT ALL TOGETHER</strong>
</h3>
<p class="noindent">Now you can add <span class="code">Birthday</span>
 instances to the app using the Add Birthday view controller, and you have a table view to list each <span class="code">Birthday</span>
 in the Birthdays table view controller. But when you try running the app and adding a <span class="code">Birthday</span>
 , it doesn’t appear. To make each <span class="code">Birthday</span>
 you add appear in the table view, you need to make the Add Birthday view controller communicate with the Birthdays table view controller. You do this by using <em>delegation</em>
 .</p>
<h4 class="h4" id="ch11lev2sec5">
<strong>DELEGATION</strong>
</h4>
<p class="noindent">Delegation can be used when one view controller needs to get information from another view controller. Say you have two view controllers: A and B. The first view controller, A, creates B and presents B on top of itself. A knows about B because it created and presented B, so A can pass information along to B. But B doesn’t know about A—it’s just popped into being and doesn’t know where it came from or how it got there. So how can B talk to A? Through delegation!</p>
<div class="image"><img src="Image00245.jpg" />
</div>
<p class="indent">Delegation is when someone gives a job or a task to someone else. A <em>delegate</em>
 is like a boss who tells a delegating employee what to do. When the delegating employee is done with their task, sometimes they’ll report information back to the delegate boss.</p>
<p class="indent"><span id="page_167"></span>
 Delegation in Swift is pretty similar, but instead of having a boss and employee, we have a delegate and a delegating object. Since class B is the one being told what to do by class A, it’s the delegating object. We give class B a special property called a delegate to tell it who its delegate is—that way, it knows who to communicate with. The delegate can be any class that has a set of methods that have been defined in a <em>protocol</em>
 . A protocol is like an agreement between the two classes that tells them what the delegate can ask the delegating object to do. It has a list of method and property names that the delegate can use with the delegating object.</p>
<p class="indent">Class A creates class B, makes itself the delegate of class B, and gives class B a job to do that’s in the protocol. Once class B is done with its job, it reports back to class A. Let’s see how this works in our app.</p>
<p class="indent">The Birthdays table view controller is view controller A, and the Add Birthday view controller is view controller B. We’ll create a protocol called <span class="code">AddBirthdayViewControllerDelegate</span>
 and a method for that protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 , which the Add Birthday view controller will use to report back.</p>
<p class="indent">Take a look at <a href="text00022.html#ch11fig6">Figure 11-6</a>
 . When the user taps the Add button <span class="ent">➊</span>
 , the Birthdays table view controller creates the Add Birthday view controller <span class="ent">➋</span>
 and sets itself as the Add Birthday view controller’s delegate.</p>
<div class="image"><img src="Image00246.jpg" />
</div>
<p class="figcap"><a id="ch11fig6"></a>
 <em>Figure 11-6: A new birthday is added and passed from the Add Birthday view controller to the Birthdays table view controller using delegation.</em>
</p>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<div class="box">
<pre>    <span class="ash">var birthdays = [Birthday]()</span>
<br />
<br />
    <span class="pink">let</span>
 dateFormatter = <span class="violet">DateFormatter</span>
 ()<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent">Note that the <span class="code">dateFormatter</span>
 is a constant that is created with <span class="code">let</span>
 . Even though you’ll change the <span class="code">dateFormatter</span>
 ’s properties, like the <span class="code">dateStyle</span>
 and <span class="code">timeStyle</span>
 , you’ll never change the <span class="code">dateFormatter</span>
 itself.</p>
<p class="indent"><span id="page_162"></span>
 You’ll also need to set up the <span class="code">dateFormatter</span>
 so that it will display the birthdates as fully formatted strings like <span class="code">"Tuesday, December 17, 2008"</span>
 . As you saw in <a href="text00021.html#ch10">Chapter 10</a>
 , a good place to do this is the <span class="code">viewDidLoad()</span>
 method, which is called when the Birthdays table view controller is loading its view. This is the perfect place to do any setup that is needed for this class.</p>
<div class="box">
<pre>
<span class="ash">override func viewDidLoad() {</span>
<br />
    <span class="ash">super.viewDidLoad()</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">dateFormatter</span>
 .<span class="violet">dateStyle</span>
 = .<span class="blue">full</span>
<br />
  <span class="ent">➋</span>
 <span class="green1">dateFormatter</span>
 .<span class="violet">timeStyle</span>
 = .<span class="blue">none</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , you set the <span class="code">dateStyle</span>
 of the <span class="code">dateFormatter</span>
 so that it will display a formatted date string for each <span class="code">Birthday</span>
 . Did you notice how we just wrote <span class="code">.full</span>
 instead of <span class="code">DateFormatter.Style.full</span>
 ? Swift knows what type to expect for the <span class="code">dateStyle</span>
 of a <span class="code">DateFormatter</span>
 , so it lets us take this little shortcut. At <span class="ent">➋</span>
 , you set the <span class="code">timeStyle</span>
 of the <span class="code">dateFormatter</span>
 to <span class="code">.none</span>
 so that the time won’t be shown.</p>
<h4 class="h4" id="ch11lev2sec4">
<strong>DISPLAYING BIRTHDAYS IN A TABLE VIEW</strong>
</h4>
<p class="noindent">The <span class="code">BirthdaysTableViewController</span>
 class has a table view that is used to display a list of items in a single column. The table view has one or more sections containing rows, and each row contains a cell. A section in a table view is a grouping of rows that can be displayed with or without a header. An example of an app that shows a table view with several sections is the Settings app, as shown in <a href="text00022.html#ch11fig5">Figure 11-5</a>
 . It displays a list of rows that have been broken up into different sections.</p>
<p class="indent">Each section and row of a table view is identified with an index number. These numbers start at 0 and then increase by 1 as you go down the table view. For example, the Privacy line in the Settings app is found at section 0, row 1. The News setting is at section 1, row 3.</p>
<p class="indent">In the middle of the <span class="code">BirthdaysTableViewController</span>
 class, there is a section called <em>Table view data source</em>
 with three methods. The table view controller uses these methods to determine what’s going to be displayed inside its table view.</p>
<p class="hang">
<span class="code">
<span class="codestrong">numberOfSections(in:)</span>
</span>
 Tells the table view how many sections it should have</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:numberOfRowsInSection:)</span>
</span>
 Tells the table view how many rows will be displayed in each section</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:cellForRowAt:)</span>
</span>
 Sets up each cell that’s going to be displayed in each row of the table view</p>
<div class="image"><span id="page_163"></span>
 <img src="Image00243.jpg" />
</div>
<p class="figcap"><a id="ch11fig5"></a>
 <em>Figure 11-5: The Settings app uses sections to group rows of different device settings.</em>
</p>
<p class="indent">The table view data source methods are called by the table view controller every time the table view is reloaded. Xcode automatically gives you these method templates when you make a subclass of a <span class="code">UITableViewController</span>
 . You need to implement all three methods for the app to work, even though you’ll never call them directly in your code. The <span class="code">UITableViewController</span>
 class implements the <span class="code">UITableViewDataSource</span>
 protocol, which comes with these data source methods, to determine what will be displayed inside the table view. We’ll discuss protocols in “<a href="text00022.html#ch11lev2sec5">Delegation</a>
 ” on page 166. For now, you just need to know that a <span class="code">UITableViewController</span>
 uses these methods to display its content, and it automatically calls these methods so you don’t need to call them.</p>
<p class="indent">Let’s start with the method <span class="code">numberOfSections(in:)</span>
 . The Birthdays table view controller is a list that just displays <span class="code">Birthday</span>
 instances, so it doesn’t need multiple sections. To set the number of sections in the table view, we just need to return <span class="code">1</span>
 .</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func numberOfSections(in tableView: UITableView) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 <span class="blue1">1</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent"><span id="page_164"></span>
 This method takes a <span class="code">UITableView</span>
 called <span class="code">tableView</span>
 as a parameter, which is the table view that uses this class as its data source. We don’t need to worry about making this connection because the <span class="code">UITableViewController</span>
 comes with a built-in table view that is automatically hooked up to these methods. Each birthday will be displayed in its own row. So in <span class="code">tableView(_:numberOfRowsInSection:)</span>
 , in order to have the right number of rows for all of your birthdays, you need to return the number of <span class="code">Birthday</span>
 instances that you have in your <span class="code">birthdays</span>
 array. Do you remember the <span class="code">count</span>
 property of an array? It’s an integer that tells you how many items are in that array, and it’s perfect for this situation! Change this method to the following:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, <img class="inline" src="Image00184.jpg" />
<br />
    numberOfRowsInSection section: Int) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 birthdays.<span class="violet">count</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">In addition to the <span class="code">tableView</span>
 parameter, <span class="code">tableView(_:numberOfRowsInSection:)</span>
 also takes an <span class="code">Int</span>
 called <span class="code">section</span>
 . When the table view is loading itself, this method is called for each section in the table view. In our case, we have only one section, so we don’t need to bother checking which <span class="code">section</span>
 of the table view is being displayed here. We know it’s section 0, and we want it to have as many rows as there are birthdays, so we write <span class="code">return birthdays.count</span>
 .</p>
<p class="indent">Finally, you need to implement <span class="code">tableView(_:cellForRowAt:)</span>
 so that the table view will know what to put inside each cell. Since this method is commented out, you need to uncomment it by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it. (Be careful not to accidentally uncomment the other methods after it!) After you’ve done that, change it to the following code:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, cellForRowAt <img class="inline" src="Image00184.jpg" />
<br />
    indexPath: IndexPath) -&gt; UITableViewCell {</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="pink">let</span>
 cell = tableView.<span class="blue">dequeueReusableCell</span>
 (withIdentifier: <img class="inline" src="Image00093.jpg" />
<br />
        <span class="red">"birthdayCellIdentifier"</span>
 , for: indexPath)<br />
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 birthday = <span class="green1">birthdays</span>
 [indexPath.<span class="violet">row</span>
 ]<br />
<br />
  <span class="ent">➌</span>
 cell.<span class="violet">textLabel</span>
 ?.<span class="violet">text</span>
 = birthday.<span class="green1">firstName</span>
 <span class="blue">+</span>
 <span class="red">" "</span>
 <span class="blue">+</span>
 <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">lastName</span>
<br />
<br />
  <span class="ent">➍</span>
 cell.<span class="violet">detailTextLabel</span>
 ?.<span class="violet">text</span>
 = <span class="green1">dateFormatter</span>
 .<span class="blue">string</span>
 (from: <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">birthdate</span>
 )<br />
<br />
  <span class="ent">➎</span>
 <span class="pink">return</span>
 cell<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">You don’t call the method <span class="code">tableView(_:cellForRowAt:)</span>
 . It’s called when the table view is loaded onto the screen. It’s called for each cell on the screen and takes two parameters, <span class="code">tableView</span>
 and <span class="code">indexPath</span>
 . You already know <span id="page_165"></span>
 what the <span class="code">tableView</span>
 parameter is for. An <span class="code">IndexPath</span>
 is a Swift struct that’s used to represent a row’s position in a table view. An <span class="code">IndexPath</span>
 instance has a <span class="code">section</span>
 property and a <span class="code">row</span>
 property. Since this method will be called many times (once for every row in the table), we need the <span class="code">indexPath</span>
 to know which section and row we’re currently configuring. The <span class="code">indexPath.section</span>
 property gives the section number, and the <span class="code">indexPath.row</span>
 gives the row of the table view cell. The five lines of code inside <span class="code">tableView(_:cellForRowAt:)</span>
 will do the following:</p>
<div class="image"><img src="Image00244.jpg" />
</div>
<p class="bull">• Create a <span class="code">UITableViewCell</span>
</p>
<p class="bull">• Figure out which <span class="code">Birthday</span>
 in the <span class="code">birthdays</span>
 array will be displayed inside the cell</p>
<p class="bull">• Make two labels to display the birthday person’s name and birthdate in the cell</p>
<p class="bull">• Return the cell ready for display in the table view</p>
<p class="indentt">Let’s go through this code line by line.</p>
<p class="indent">First, create the <span class="code">UITableViewCell</span>
 . The code at <span class="ent">➊</span>
 does this using the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 . Before you can start using this method on a cell, though, you need to tell the method which cell you want to use from the storyboard. Earlier, when you were in the storyboard, you gave your cell the identifier <span class="code">birthdayCellIdentifier</span>
 (see <a href="text00022.html#ch11fig4">Figure 11-4</a>
 ). This identifier links your code to the cell and tells your method that it’s using the right cell. The string for when you call this method needs to be exactly the same as the string you set in the storyboard, or you’ll get an error and the app will crash when you run it.</p>
<p class="indent">In the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 , did you notice the words <em>Reusable Cell</em>
 ? The cells inside a table view are created once and then can be reused over and over. This helps everything run faster and smoother because creating the cell is what takes the most time. If you had 200 birthdays in your app, but only 10 would fit on your screen at one time, then you need only 10 cells to show your birthdays. When you scroll down to reveal more birthdays, the cells that scroll off the top of the screen are reused. They are filled with new information and show up again at the bottom of the screen. The <span class="code">UITableView</span>
 automatically does this work. When the table view is loaded, <span class="code">tableView(_:cellForRowAt:)</span>
 is called for every visible row. When the user scrolls to look at more cells, it’s called again for each row just as it is about to appear on the screen.</p>
<p class="indent">Next, we need to find out which <span class="code">Birthday</span>
 should be displayed inside the cell. We want to display one birthday from the <span class="code">birthdays</span>
 array in each row. The first birthday, which is at <span class="code">birthdays[0]</span>
 , should be displayed in row 0. The second birthday, at <span class="code">birthdays[1]</span>
 , should be displayed in row 1, and so on, which means the <span class="code">indexPath</span>
 ’s <span class="code">row</span>
 is the same as the position in the <span class="code">birthdays</span>
 array that we want to access. The code at <span class="ent">➋</span>
 accesses the <span id="page_166"></span>
 correct <span class="code">Birthday</span>
 object from the <span class="code">birthdays</span>
 array by using <span class="code">indexPath.row</span>
 . Once we have the right <span class="code">Birthday</span>
 object, we assign it to a constant named <span class="code">birthday</span>
 so we can set up the labels in this cell.</p>
<p class="indent">Notice that we’re using <span class="code">let</span>
 to assign the <span class="code">birthday</span>
 to a constant instead of a variable. We can use <span class="code">let</span>
 because each time <span class="code">tableView(_:cellForRowAt:)</span>
 is called, a new <span class="code">birthday</span>
 constant is created. Each cell gets its own <span class="code">birthday</span>
 constant that is assigned its own <span class="code">Birthday</span>
 object. Since we’re not going to change any of the <span class="code">birthday</span>
 constants—we’re just going to read their properties—we don’t want to make them variables.</p>
<p class="indent">Now that you have your cell and your birthday, it’s time to fill in the details. You need two labels for each cell to show the birthday person’s name and birthdate. You set the cell to the Subtitle style so that it has a Title label and a Subtitle label. Each cell will already contain these labels, so now you don’t have to create any labels yourself.</p>
<p class="indent">The labels exist as properties of <span class="code">UITableViewCell</span>
 and are called <span class="code">textLabel</span>
 and <span class="code">detailTextLabel</span>
 . The code at <span class="ent">➌</span>
 sets the text of the <span class="code">textLabel</span>
 to a string made up of the <span class="code">firstName</span>
 and <span class="code">lastName</span>
 of the <span class="code">birthday</span>
 with a space between them. At <span class="ent">➍</span>
 , you use the <span class="code">string(from:)</span>
 method of the <span class="code">dateFormatter</span>
 to display the birthdate in the <span class="code">detailTextLabel</span>
 .</p>
<p class="indent">When your cell is completely configured, <span class="code">tableView( _:cellForRowAt:)</span>
 returns the cell at <span class="ent">➎</span>
 so that it can be displayed at that <span class="code">indexPath</span>
 of the table view.</p>
<h3 class="h3" id="ch11lev1sec2">
<strong>PUTTING IT ALL TOGETHER</strong>
</h3>
<p class="noindent">Now you can add <span class="code">Birthday</span>
 instances to the app using the Add Birthday view controller, and you have a table view to list each <span class="code">Birthday</span>
 in the Birthdays table view controller. But when you try running the app and adding a <span class="code">Birthday</span>
 , it doesn’t appear. To make each <span class="code">Birthday</span>
 you add appear in the table view, you need to make the Add Birthday view controller communicate with the Birthdays table view controller. You do this by using <em>delegation</em>
 .</p>
<h4 class="h4" id="ch11lev2sec5">
<strong>DELEGATION</strong>
</h4>
<p class="noindent">Delegation can be used when one view controller needs to get information from another view controller. Say you have two view controllers: A and B. The first view controller, A, creates B and presents B on top of itself. A knows about B because it created and presented B, so A can pass information along to B. But B doesn’t know about A—it’s just popped into being and doesn’t know where it came from or how it got there. So how can B talk to A? Through delegation!</p>
<div class="image"><img src="Image00245.jpg" />
</div>
<p class="indent">Delegation is when someone gives a job or a task to someone else. A <em>delegate</em>
 is like a boss who tells a delegating employee what to do. When the delegating employee is done with their task, sometimes they’ll report information back to the delegate boss.</p>
<p class="indent"><span id="page_167"></span>
 Delegation in Swift is pretty similar, but instead of having a boss and employee, we have a delegate and a delegating object. Since class B is the one being told what to do by class A, it’s the delegating object. We give class B a special property called a delegate to tell it who its delegate is—that way, it knows who to communicate with. The delegate can be any class that has a set of methods that have been defined in a <em>protocol</em>
 . A protocol is like an agreement between the two classes that tells them what the delegate can ask the delegating object to do. It has a list of method and property names that the delegate can use with the delegating object.</p>
<p class="indent">Class A creates class B, makes itself the delegate of class B, and gives class B a job to do that’s in the protocol. Once class B is done with its job, it reports back to class A. Let’s see how this works in our app.</p>
<p class="indent">The Birthdays table view controller is view controller A, and the Add Birthday view controller is view controller B. We’ll create a protocol called <span class="code">AddBirthdayViewControllerDelegate</span>
 and a method for that protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 , which the Add Birthday view controller will use to report back.</p>
<p class="indent">Take a look at <a href="text00022.html#ch11fig6">Figure 11-6</a>
 . When the user taps the Add button <span class="ent">➊</span>
 , the Birthdays table view controller creates the Add Birthday view controller <span class="ent">➋</span>
 and sets itself as the Add Birthday view controller’s delegate.</p>
<div class="image"><img src="Image00246.jpg" />
</div>
<p class="figcap"><a id="ch11fig6"></a>
 <em>Figure 11-6: A new birthday is added and passed from the Add Birthday view controller to the Birthdays table view controller using delegation.</em>
</p>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="indent">Note that the <span class="code">dateFormatter</span>
 is a constant that is created with <span class="code">let</span>
 . Even though you’ll change the <span class="code">dateFormatter</span>
 ’s properties, like the <span class="code">dateStyle</span>
 and <span class="code">timeStyle</span>
 , you’ll never change the <span class="code">dateFormatter</span>
 itself.</p>
<p class="indent"><span id="page_162"></span>
 You’ll also need to set up the <span class="code">dateFormatter</span>
 so that it will display the birthdates as fully formatted strings like <span class="code">"Tuesday, December 17, 2008"</span>
 . As you saw in <a href="text00021.html#ch10">Chapter 10</a>
 , a good place to do this is the <span class="code">viewDidLoad()</span>
 method, which is called when the Birthdays table view controller is loading its view. This is the perfect place to do any setup that is needed for this class.</p>
<div class="box">
<pre>
<span class="ash">override func viewDidLoad() {</span>
<br />
    <span class="ash">super.viewDidLoad()</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">dateFormatter</span>
 .<span class="violet">dateStyle</span>
 = .<span class="blue">full</span>
<br />
  <span class="ent">➋</span>
 <span class="green1">dateFormatter</span>
 .<span class="violet">timeStyle</span>
 = .<span class="blue">none</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , you set the <span class="code">dateStyle</span>
 of the <span class="code">dateFormatter</span>
 so that it will display a formatted date string for each <span class="code">Birthday</span>
 . Did you notice how we just wrote <span class="code">.full</span>
 instead of <span class="code">DateFormatter.Style.full</span>
 ? Swift knows what type to expect for the <span class="code">dateStyle</span>
 of a <span class="code">DateFormatter</span>
 , so it lets us take this little shortcut. At <span class="ent">➋</span>
 , you set the <span class="code">timeStyle</span>
 of the <span class="code">dateFormatter</span>
 to <span class="code">.none</span>
 so that the time won’t be shown.</p>
<h4 class="h4" id="ch11lev2sec4">
<strong>DISPLAYING BIRTHDAYS IN A TABLE VIEW</strong>
</h4>
<p class="noindent">The <span class="code">BirthdaysTableViewController</span>
 class has a table view that is used to display a list of items in a single column. The table view has one or more sections containing rows, and each row contains a cell. A section in a table view is a grouping of rows that can be displayed with or without a header. An example of an app that shows a table view with several sections is the Settings app, as shown in <a href="text00022.html#ch11fig5">Figure 11-5</a>
 . It displays a list of rows that have been broken up into different sections.</p>
<p class="indent">Each section and row of a table view is identified with an index number. These numbers start at 0 and then increase by 1 as you go down the table view. For example, the Privacy line in the Settings app is found at section 0, row 1. The News setting is at section 1, row 3.</p>
<p class="indent">In the middle of the <span class="code">BirthdaysTableViewController</span>
 class, there is a section called <em>Table view data source</em>
 with three methods. The table view controller uses these methods to determine what’s going to be displayed inside its table view.</p>
<p class="hang">
<span class="code">
<span class="codestrong">numberOfSections(in:)</span>
</span>
 Tells the table view how many sections it should have</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:numberOfRowsInSection:)</span>
</span>
 Tells the table view how many rows will be displayed in each section</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:cellForRowAt:)</span>
</span>
 Sets up each cell that’s going to be displayed in each row of the table view</p>
<div class="image"><span id="page_163"></span>
 <img src="Image00243.jpg" />
</div>
<p class="figcap"><a id="ch11fig5"></a>
 <em>Figure 11-5: The Settings app uses sections to group rows of different device settings.</em>
</p>
<p class="indent">The table view data source methods are called by the table view controller every time the table view is reloaded. Xcode automatically gives you these method templates when you make a subclass of a <span class="code">UITableViewController</span>
 . You need to implement all three methods for the app to work, even though you’ll never call them directly in your code. The <span class="code">UITableViewController</span>
 class implements the <span class="code">UITableViewDataSource</span>
 protocol, which comes with these data source methods, to determine what will be displayed inside the table view. We’ll discuss protocols in “<a href="text00022.html#ch11lev2sec5">Delegation</a>
 ” on page 166. For now, you just need to know that a <span class="code">UITableViewController</span>
 uses these methods to display its content, and it automatically calls these methods so you don’t need to call them.</p>
<p class="indent">Let’s start with the method <span class="code">numberOfSections(in:)</span>
 . The Birthdays table view controller is a list that just displays <span class="code">Birthday</span>
 instances, so it doesn’t need multiple sections. To set the number of sections in the table view, we just need to return <span class="code">1</span>
 .</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func numberOfSections(in tableView: UITableView) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 <span class="blue1">1</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent"><span id="page_164"></span>
 This method takes a <span class="code">UITableView</span>
 called <span class="code">tableView</span>
 as a parameter, which is the table view that uses this class as its data source. We don’t need to worry about making this connection because the <span class="code">UITableViewController</span>
 comes with a built-in table view that is automatically hooked up to these methods. Each birthday will be displayed in its own row. So in <span class="code">tableView(_:numberOfRowsInSection:)</span>
 , in order to have the right number of rows for all of your birthdays, you need to return the number of <span class="code">Birthday</span>
 instances that you have in your <span class="code">birthdays</span>
 array. Do you remember the <span class="code">count</span>
 property of an array? It’s an integer that tells you how many items are in that array, and it’s perfect for this situation! Change this method to the following:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, <img class="inline" src="Image00184.jpg" />
<br />
    numberOfRowsInSection section: Int) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 birthdays.<span class="violet">count</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">In addition to the <span class="code">tableView</span>
 parameter, <span class="code">tableView(_:numberOfRowsInSection:)</span>
 also takes an <span class="code">Int</span>
 called <span class="code">section</span>
 . When the table view is loading itself, this method is called for each section in the table view. In our case, we have only one section, so we don’t need to bother checking which <span class="code">section</span>
 of the table view is being displayed here. We know it’s section 0, and we want it to have as many rows as there are birthdays, so we write <span class="code">return birthdays.count</span>
 .</p>
<p class="indent">Finally, you need to implement <span class="code">tableView(_:cellForRowAt:)</span>
 so that the table view will know what to put inside each cell. Since this method is commented out, you need to uncomment it by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it. (Be careful not to accidentally uncomment the other methods after it!) After you’ve done that, change it to the following code:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, cellForRowAt <img class="inline" src="Image00184.jpg" />
<br />
    indexPath: IndexPath) -&gt; UITableViewCell {</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="pink">let</span>
 cell = tableView.<span class="blue">dequeueReusableCell</span>
 (withIdentifier: <img class="inline" src="Image00093.jpg" />
<br />
        <span class="red">"birthdayCellIdentifier"</span>
 , for: indexPath)<br />
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 birthday = <span class="green1">birthdays</span>
 [indexPath.<span class="violet">row</span>
 ]<br />
<br />
  <span class="ent">➌</span>
 cell.<span class="violet">textLabel</span>
 ?.<span class="violet">text</span>
 = birthday.<span class="green1">firstName</span>
 <span class="blue">+</span>
 <span class="red">" "</span>
 <span class="blue">+</span>
 <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">lastName</span>
<br />
<br />
  <span class="ent">➍</span>
 cell.<span class="violet">detailTextLabel</span>
 ?.<span class="violet">text</span>
 = <span class="green1">dateFormatter</span>
 .<span class="blue">string</span>
 (from: <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">birthdate</span>
 )<br />
<br />
  <span class="ent">➎</span>
 <span class="pink">return</span>
 cell<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">You don’t call the method <span class="code">tableView(_:cellForRowAt:)</span>
 . It’s called when the table view is loaded onto the screen. It’s called for each cell on the screen and takes two parameters, <span class="code">tableView</span>
 and <span class="code">indexPath</span>
 . You already know <span id="page_165"></span>
 what the <span class="code">tableView</span>
 parameter is for. An <span class="code">IndexPath</span>
 is a Swift struct that’s used to represent a row’s position in a table view. An <span class="code">IndexPath</span>
 instance has a <span class="code">section</span>
 property and a <span class="code">row</span>
 property. Since this method will be called many times (once for every row in the table), we need the <span class="code">indexPath</span>
 to know which section and row we’re currently configuring. The <span class="code">indexPath.section</span>
 property gives the section number, and the <span class="code">indexPath.row</span>
 gives the row of the table view cell. The five lines of code inside <span class="code">tableView(_:cellForRowAt:)</span>
 will do the following:</p>
<div class="image"><img src="Image00244.jpg" />
</div>
<p class="bull">• Create a <span class="code">UITableViewCell</span>
</p>
<p class="bull">• Figure out which <span class="code">Birthday</span>
 in the <span class="code">birthdays</span>
 array will be displayed inside the cell</p>
<p class="bull">• Make two labels to display the birthday person’s name and birthdate in the cell</p>
<p class="bull">• Return the cell ready for display in the table view</p>
<p class="indentt">Let’s go through this code line by line.</p>
<p class="indent">First, create the <span class="code">UITableViewCell</span>
 . The code at <span class="ent">➊</span>
 does this using the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 . Before you can start using this method on a cell, though, you need to tell the method which cell you want to use from the storyboard. Earlier, when you were in the storyboard, you gave your cell the identifier <span class="code">birthdayCellIdentifier</span>
 (see <a href="text00022.html#ch11fig4">Figure 11-4</a>
 ). This identifier links your code to the cell and tells your method that it’s using the right cell. The string for when you call this method needs to be exactly the same as the string you set in the storyboard, or you’ll get an error and the app will crash when you run it.</p>
<p class="indent">In the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 , did you notice the words <em>Reusable Cell</em>
 ? The cells inside a table view are created once and then can be reused over and over. This helps everything run faster and smoother because creating the cell is what takes the most time. If you had 200 birthdays in your app, but only 10 would fit on your screen at one time, then you need only 10 cells to show your birthdays. When you scroll down to reveal more birthdays, the cells that scroll off the top of the screen are reused. They are filled with new information and show up again at the bottom of the screen. The <span class="code">UITableView</span>
 automatically does this work. When the table view is loaded, <span class="code">tableView(_:cellForRowAt:)</span>
 is called for every visible row. When the user scrolls to look at more cells, it’s called again for each row just as it is about to appear on the screen.</p>
<p class="indent">Next, we need to find out which <span class="code">Birthday</span>
 should be displayed inside the cell. We want to display one birthday from the <span class="code">birthdays</span>
 array in each row. The first birthday, which is at <span class="code">birthdays[0]</span>
 , should be displayed in row 0. The second birthday, at <span class="code">birthdays[1]</span>
 , should be displayed in row 1, and so on, which means the <span class="code">indexPath</span>
 ’s <span class="code">row</span>
 is the same as the position in the <span class="code">birthdays</span>
 array that we want to access. The code at <span class="ent">➋</span>
 accesses the <span id="page_166"></span>
 correct <span class="code">Birthday</span>
 object from the <span class="code">birthdays</span>
 array by using <span class="code">indexPath.row</span>
 . Once we have the right <span class="code">Birthday</span>
 object, we assign it to a constant named <span class="code">birthday</span>
 so we can set up the labels in this cell.</p>
<p class="indent">Notice that we’re using <span class="code">let</span>
 to assign the <span class="code">birthday</span>
 to a constant instead of a variable. We can use <span class="code">let</span>
 because each time <span class="code">tableView(_:cellForRowAt:)</span>
 is called, a new <span class="code">birthday</span>
 constant is created. Each cell gets its own <span class="code">birthday</span>
 constant that is assigned its own <span class="code">Birthday</span>
 object. Since we’re not going to change any of the <span class="code">birthday</span>
 constants—we’re just going to read their properties—we don’t want to make them variables.</p>
<p class="indent">Now that you have your cell and your birthday, it’s time to fill in the details. You need two labels for each cell to show the birthday person’s name and birthdate. You set the cell to the Subtitle style so that it has a Title label and a Subtitle label. Each cell will already contain these labels, so now you don’t have to create any labels yourself.</p>
<p class="indent">The labels exist as properties of <span class="code">UITableViewCell</span>
 and are called <span class="code">textLabel</span>
 and <span class="code">detailTextLabel</span>
 . The code at <span class="ent">➌</span>
 sets the text of the <span class="code">textLabel</span>
 to a string made up of the <span class="code">firstName</span>
 and <span class="code">lastName</span>
 of the <span class="code">birthday</span>
 with a space between them. At <span class="ent">➍</span>
 , you use the <span class="code">string(from:)</span>
 method of the <span class="code">dateFormatter</span>
 to display the birthdate in the <span class="code">detailTextLabel</span>
 .</p>
<p class="indent">When your cell is completely configured, <span class="code">tableView( _:cellForRowAt:)</span>
 returns the cell at <span class="ent">➎</span>
 so that it can be displayed at that <span class="code">indexPath</span>
 of the table view.</p>
<h3 class="h3" id="ch11lev1sec2">
<strong>PUTTING IT ALL TOGETHER</strong>
</h3>
<p class="noindent">Now you can add <span class="code">Birthday</span>
 instances to the app using the Add Birthday view controller, and you have a table view to list each <span class="code">Birthday</span>
 in the Birthdays table view controller. But when you try running the app and adding a <span class="code">Birthday</span>
 , it doesn’t appear. To make each <span class="code">Birthday</span>
 you add appear in the table view, you need to make the Add Birthday view controller communicate with the Birthdays table view controller. You do this by using <em>delegation</em>
 .</p>
<h4 class="h4" id="ch11lev2sec5">
<strong>DELEGATION</strong>
</h4>
<p class="noindent">Delegation can be used when one view controller needs to get information from another view controller. Say you have two view controllers: A and B. The first view controller, A, creates B and presents B on top of itself. A knows about B because it created and presented B, so A can pass information along to B. But B doesn’t know about A—it’s just popped into being and doesn’t know where it came from or how it got there. So how can B talk to A? Through delegation!</p>
<div class="image"><img src="Image00245.jpg" />
</div>
<p class="indent">Delegation is when someone gives a job or a task to someone else. A <em>delegate</em>
 is like a boss who tells a delegating employee what to do. When the delegating employee is done with their task, sometimes they’ll report information back to the delegate boss.</p>
<p class="indent"><span id="page_167"></span>
 Delegation in Swift is pretty similar, but instead of having a boss and employee, we have a delegate and a delegating object. Since class B is the one being told what to do by class A, it’s the delegating object. We give class B a special property called a delegate to tell it who its delegate is—that way, it knows who to communicate with. The delegate can be any class that has a set of methods that have been defined in a <em>protocol</em>
 . A protocol is like an agreement between the two classes that tells them what the delegate can ask the delegating object to do. It has a list of method and property names that the delegate can use with the delegating object.</p>
<p class="indent">Class A creates class B, makes itself the delegate of class B, and gives class B a job to do that’s in the protocol. Once class B is done with its job, it reports back to class A. Let’s see how this works in our app.</p>
<p class="indent">The Birthdays table view controller is view controller A, and the Add Birthday view controller is view controller B. We’ll create a protocol called <span class="code">AddBirthdayViewControllerDelegate</span>
 and a method for that protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 , which the Add Birthday view controller will use to report back.</p>
<p class="indent">Take a look at <a href="text00022.html#ch11fig6">Figure 11-6</a>
 . When the user taps the Add button <span class="ent">➊</span>
 , the Birthdays table view controller creates the Add Birthday view controller <span class="ent">➋</span>
 and sets itself as the Add Birthday view controller’s delegate.</p>
<div class="image"><img src="Image00246.jpg" />
</div>
<p class="figcap"><a id="ch11fig6"></a>
 <em>Figure 11-6: A new birthday is added and passed from the Add Birthday view controller to the Birthdays table view controller using delegation.</em>
</p>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="indent"><span id="page_162"></span>
 You’ll also need to set up the <span class="code">dateFormatter</span>
 so that it will display the birthdates as fully formatted strings like <span class="code">"Tuesday, December 17, 2008"</span>
 . As you saw in <a href="text00021.html#ch10">Chapter 10</a>
 , a good place to do this is the <span class="code">viewDidLoad()</span>
 method, which is called when the Birthdays table view controller is loading its view. This is the perfect place to do any setup that is needed for this class.</p>
<div class="box">
<pre>
<span class="ash">override func viewDidLoad() {</span>
<br />
    <span class="ash">super.viewDidLoad()</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">dateFormatter</span>
 .<span class="violet">dateStyle</span>
 = .<span class="blue">full</span>
<br />
  <span class="ent">➋</span>
 <span class="green1">dateFormatter</span>
 .<span class="violet">timeStyle</span>
 = .<span class="blue">none</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , you set the <span class="code">dateStyle</span>
 of the <span class="code">dateFormatter</span>
 so that it will display a formatted date string for each <span class="code">Birthday</span>
 . Did you notice how we just wrote <span class="code">.full</span>
 instead of <span class="code">DateFormatter.Style.full</span>
 ? Swift knows what type to expect for the <span class="code">dateStyle</span>
 of a <span class="code">DateFormatter</span>
 , so it lets us take this little shortcut. At <span class="ent">➋</span>
 , you set the <span class="code">timeStyle</span>
 of the <span class="code">dateFormatter</span>
 to <span class="code">.none</span>
 so that the time won’t be shown.</p>
<h4 class="h4" id="ch11lev2sec4">
<strong>DISPLAYING BIRTHDAYS IN A TABLE VIEW</strong>
</h4>
<p class="noindent">The <span class="code">BirthdaysTableViewController</span>
 class has a table view that is used to display a list of items in a single column. The table view has one or more sections containing rows, and each row contains a cell. A section in a table view is a grouping of rows that can be displayed with or without a header. An example of an app that shows a table view with several sections is the Settings app, as shown in <a href="text00022.html#ch11fig5">Figure 11-5</a>
 . It displays a list of rows that have been broken up into different sections.</p>
<p class="indent">Each section and row of a table view is identified with an index number. These numbers start at 0 and then increase by 1 as you go down the table view. For example, the Privacy line in the Settings app is found at section 0, row 1. The News setting is at section 1, row 3.</p>
<p class="indent">In the middle of the <span class="code">BirthdaysTableViewController</span>
 class, there is a section called <em>Table view data source</em>
 with three methods. The table view controller uses these methods to determine what’s going to be displayed inside its table view.</p>
<p class="hang">
<span class="code">
<span class="codestrong">numberOfSections(in:)</span>
</span>
 Tells the table view how many sections it should have</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:numberOfRowsInSection:)</span>
</span>
 Tells the table view how many rows will be displayed in each section</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:cellForRowAt:)</span>
</span>
 Sets up each cell that’s going to be displayed in each row of the table view</p>
<div class="image"><span id="page_163"></span>
 <img src="Image00243.jpg" />
</div>
<p class="figcap"><a id="ch11fig5"></a>
 <em>Figure 11-5: The Settings app uses sections to group rows of different device settings.</em>
</p>
<p class="indent">The table view data source methods are called by the table view controller every time the table view is reloaded. Xcode automatically gives you these method templates when you make a subclass of a <span class="code">UITableViewController</span>
 . You need to implement all three methods for the app to work, even though you’ll never call them directly in your code. The <span class="code">UITableViewController</span>
 class implements the <span class="code">UITableViewDataSource</span>
 protocol, which comes with these data source methods, to determine what will be displayed inside the table view. We’ll discuss protocols in “<a href="text00022.html#ch11lev2sec5">Delegation</a>
 ” on page 166. For now, you just need to know that a <span class="code">UITableViewController</span>
 uses these methods to display its content, and it automatically calls these methods so you don’t need to call them.</p>
<p class="indent">Let’s start with the method <span class="code">numberOfSections(in:)</span>
 . The Birthdays table view controller is a list that just displays <span class="code">Birthday</span>
 instances, so it doesn’t need multiple sections. To set the number of sections in the table view, we just need to return <span class="code">1</span>
 .</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func numberOfSections(in tableView: UITableView) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 <span class="blue1">1</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent"><span id="page_164"></span>
 This method takes a <span class="code">UITableView</span>
 called <span class="code">tableView</span>
 as a parameter, which is the table view that uses this class as its data source. We don’t need to worry about making this connection because the <span class="code">UITableViewController</span>
 comes with a built-in table view that is automatically hooked up to these methods. Each birthday will be displayed in its own row. So in <span class="code">tableView(_:numberOfRowsInSection:)</span>
 , in order to have the right number of rows for all of your birthdays, you need to return the number of <span class="code">Birthday</span>
 instances that you have in your <span class="code">birthdays</span>
 array. Do you remember the <span class="code">count</span>
 property of an array? It’s an integer that tells you how many items are in that array, and it’s perfect for this situation! Change this method to the following:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, <img class="inline" src="Image00184.jpg" />
<br />
    numberOfRowsInSection section: Int) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 birthdays.<span class="violet">count</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">In addition to the <span class="code">tableView</span>
 parameter, <span class="code">tableView(_:numberOfRowsInSection:)</span>
 also takes an <span class="code">Int</span>
 called <span class="code">section</span>
 . When the table view is loading itself, this method is called for each section in the table view. In our case, we have only one section, so we don’t need to bother checking which <span class="code">section</span>
 of the table view is being displayed here. We know it’s section 0, and we want it to have as many rows as there are birthdays, so we write <span class="code">return birthdays.count</span>
 .</p>
<p class="indent">Finally, you need to implement <span class="code">tableView(_:cellForRowAt:)</span>
 so that the table view will know what to put inside each cell. Since this method is commented out, you need to uncomment it by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it. (Be careful not to accidentally uncomment the other methods after it!) After you’ve done that, change it to the following code:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, cellForRowAt <img class="inline" src="Image00184.jpg" />
<br />
    indexPath: IndexPath) -&gt; UITableViewCell {</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="pink">let</span>
 cell = tableView.<span class="blue">dequeueReusableCell</span>
 (withIdentifier: <img class="inline" src="Image00093.jpg" />
<br />
        <span class="red">"birthdayCellIdentifier"</span>
 , for: indexPath)<br />
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 birthday = <span class="green1">birthdays</span>
 [indexPath.<span class="violet">row</span>
 ]<br />
<br />
  <span class="ent">➌</span>
 cell.<span class="violet">textLabel</span>
 ?.<span class="violet">text</span>
 = birthday.<span class="green1">firstName</span>
 <span class="blue">+</span>
 <span class="red">" "</span>
 <span class="blue">+</span>
 <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">lastName</span>
<br />
<br />
  <span class="ent">➍</span>
 cell.<span class="violet">detailTextLabel</span>
 ?.<span class="violet">text</span>
 = <span class="green1">dateFormatter</span>
 .<span class="blue">string</span>
 (from: <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">birthdate</span>
 )<br />
<br />
  <span class="ent">➎</span>
 <span class="pink">return</span>
 cell<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">You don’t call the method <span class="code">tableView(_:cellForRowAt:)</span>
 . It’s called when the table view is loaded onto the screen. It’s called for each cell on the screen and takes two parameters, <span class="code">tableView</span>
 and <span class="code">indexPath</span>
 . You already know <span id="page_165"></span>
 what the <span class="code">tableView</span>
 parameter is for. An <span class="code">IndexPath</span>
 is a Swift struct that’s used to represent a row’s position in a table view. An <span class="code">IndexPath</span>
 instance has a <span class="code">section</span>
 property and a <span class="code">row</span>
 property. Since this method will be called many times (once for every row in the table), we need the <span class="code">indexPath</span>
 to know which section and row we’re currently configuring. The <span class="code">indexPath.section</span>
 property gives the section number, and the <span class="code">indexPath.row</span>
 gives the row of the table view cell. The five lines of code inside <span class="code">tableView(_:cellForRowAt:)</span>
 will do the following:</p>
<div class="image"><img src="Image00244.jpg" />
</div>
<p class="bull">• Create a <span class="code">UITableViewCell</span>
</p>
<p class="bull">• Figure out which <span class="code">Birthday</span>
 in the <span class="code">birthdays</span>
 array will be displayed inside the cell</p>
<p class="bull">• Make two labels to display the birthday person’s name and birthdate in the cell</p>
<p class="bull">• Return the cell ready for display in the table view</p>
<p class="indentt">Let’s go through this code line by line.</p>
<p class="indent">First, create the <span class="code">UITableViewCell</span>
 . The code at <span class="ent">➊</span>
 does this using the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 . Before you can start using this method on a cell, though, you need to tell the method which cell you want to use from the storyboard. Earlier, when you were in the storyboard, you gave your cell the identifier <span class="code">birthdayCellIdentifier</span>
 (see <a href="text00022.html#ch11fig4">Figure 11-4</a>
 ). This identifier links your code to the cell and tells your method that it’s using the right cell. The string for when you call this method needs to be exactly the same as the string you set in the storyboard, or you’ll get an error and the app will crash when you run it.</p>
<p class="indent">In the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 , did you notice the words <em>Reusable Cell</em>
 ? The cells inside a table view are created once and then can be reused over and over. This helps everything run faster and smoother because creating the cell is what takes the most time. If you had 200 birthdays in your app, but only 10 would fit on your screen at one time, then you need only 10 cells to show your birthdays. When you scroll down to reveal more birthdays, the cells that scroll off the top of the screen are reused. They are filled with new information and show up again at the bottom of the screen. The <span class="code">UITableView</span>
 automatically does this work. When the table view is loaded, <span class="code">tableView(_:cellForRowAt:)</span>
 is called for every visible row. When the user scrolls to look at more cells, it’s called again for each row just as it is about to appear on the screen.</p>
<p class="indent">Next, we need to find out which <span class="code">Birthday</span>
 should be displayed inside the cell. We want to display one birthday from the <span class="code">birthdays</span>
 array in each row. The first birthday, which is at <span class="code">birthdays[0]</span>
 , should be displayed in row 0. The second birthday, at <span class="code">birthdays[1]</span>
 , should be displayed in row 1, and so on, which means the <span class="code">indexPath</span>
 ’s <span class="code">row</span>
 is the same as the position in the <span class="code">birthdays</span>
 array that we want to access. The code at <span class="ent">➋</span>
 accesses the <span id="page_166"></span>
 correct <span class="code">Birthday</span>
 object from the <span class="code">birthdays</span>
 array by using <span class="code">indexPath.row</span>
 . Once we have the right <span class="code">Birthday</span>
 object, we assign it to a constant named <span class="code">birthday</span>
 so we can set up the labels in this cell.</p>
<p class="indent">Notice that we’re using <span class="code">let</span>
 to assign the <span class="code">birthday</span>
 to a constant instead of a variable. We can use <span class="code">let</span>
 because each time <span class="code">tableView(_:cellForRowAt:)</span>
 is called, a new <span class="code">birthday</span>
 constant is created. Each cell gets its own <span class="code">birthday</span>
 constant that is assigned its own <span class="code">Birthday</span>
 object. Since we’re not going to change any of the <span class="code">birthday</span>
 constants—we’re just going to read their properties—we don’t want to make them variables.</p>
<p class="indent">Now that you have your cell and your birthday, it’s time to fill in the details. You need two labels for each cell to show the birthday person’s name and birthdate. You set the cell to the Subtitle style so that it has a Title label and a Subtitle label. Each cell will already contain these labels, so now you don’t have to create any labels yourself.</p>
<p class="indent">The labels exist as properties of <span class="code">UITableViewCell</span>
 and are called <span class="code">textLabel</span>
 and <span class="code">detailTextLabel</span>
 . The code at <span class="ent">➌</span>
 sets the text of the <span class="code">textLabel</span>
 to a string made up of the <span class="code">firstName</span>
 and <span class="code">lastName</span>
 of the <span class="code">birthday</span>
 with a space between them. At <span class="ent">➍</span>
 , you use the <span class="code">string(from:)</span>
 method of the <span class="code">dateFormatter</span>
 to display the birthdate in the <span class="code">detailTextLabel</span>
 .</p>
<p class="indent">When your cell is completely configured, <span class="code">tableView( _:cellForRowAt:)</span>
 returns the cell at <span class="ent">➎</span>
 so that it can be displayed at that <span class="code">indexPath</span>
 of the table view.</p>
<h3 class="h3" id="ch11lev1sec2">
<strong>PUTTING IT ALL TOGETHER</strong>
</h3>
<p class="noindent">Now you can add <span class="code">Birthday</span>
 instances to the app using the Add Birthday view controller, and you have a table view to list each <span class="code">Birthday</span>
 in the Birthdays table view controller. But when you try running the app and adding a <span class="code">Birthday</span>
 , it doesn’t appear. To make each <span class="code">Birthday</span>
 you add appear in the table view, you need to make the Add Birthday view controller communicate with the Birthdays table view controller. You do this by using <em>delegation</em>
 .</p>
<h4 class="h4" id="ch11lev2sec5">
<strong>DELEGATION</strong>
</h4>
<p class="noindent">Delegation can be used when one view controller needs to get information from another view controller. Say you have two view controllers: A and B. The first view controller, A, creates B and presents B on top of itself. A knows about B because it created and presented B, so A can pass information along to B. But B doesn’t know about A—it’s just popped into being and doesn’t know where it came from or how it got there. So how can B talk to A? Through delegation!</p>
<div class="image"><img src="Image00245.jpg" />
</div>
<p class="indent">Delegation is when someone gives a job or a task to someone else. A <em>delegate</em>
 is like a boss who tells a delegating employee what to do. When the delegating employee is done with their task, sometimes they’ll report information back to the delegate boss.</p>
<p class="indent"><span id="page_167"></span>
 Delegation in Swift is pretty similar, but instead of having a boss and employee, we have a delegate and a delegating object. Since class B is the one being told what to do by class A, it’s the delegating object. We give class B a special property called a delegate to tell it who its delegate is—that way, it knows who to communicate with. The delegate can be any class that has a set of methods that have been defined in a <em>protocol</em>
 . A protocol is like an agreement between the two classes that tells them what the delegate can ask the delegating object to do. It has a list of method and property names that the delegate can use with the delegating object.</p>
<p class="indent">Class A creates class B, makes itself the delegate of class B, and gives class B a job to do that’s in the protocol. Once class B is done with its job, it reports back to class A. Let’s see how this works in our app.</p>
<p class="indent">The Birthdays table view controller is view controller A, and the Add Birthday view controller is view controller B. We’ll create a protocol called <span class="code">AddBirthdayViewControllerDelegate</span>
 and a method for that protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 , which the Add Birthday view controller will use to report back.</p>
<p class="indent">Take a look at <a href="text00022.html#ch11fig6">Figure 11-6</a>
 . When the user taps the Add button <span class="ent">➊</span>
 , the Birthdays table view controller creates the Add Birthday view controller <span class="ent">➋</span>
 and sets itself as the Add Birthday view controller’s delegate.</p>
<div class="image"><img src="Image00246.jpg" />
</div>
<p class="figcap"><a id="ch11fig6"></a>
 <em>Figure 11-6: A new birthday is added and passed from the Add Birthday view controller to the Birthdays table view controller using delegation.</em>
</p>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<div class="box">
<pre>
<span class="ash">override func viewDidLoad() {</span>
<br />
    <span class="ash">super.viewDidLoad()</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">dateFormatter</span>
 .<span class="violet">dateStyle</span>
 = .<span class="blue">full</span>
<br />
  <span class="ent">➋</span>
 <span class="green1">dateFormatter</span>
 .<span class="violet">timeStyle</span>
 = .<span class="blue">none</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">At <span class="ent">➊</span>
 , you set the <span class="code">dateStyle</span>
 of the <span class="code">dateFormatter</span>
 so that it will display a formatted date string for each <span class="code">Birthday</span>
 . Did you notice how we just wrote <span class="code">.full</span>
 instead of <span class="code">DateFormatter.Style.full</span>
 ? Swift knows what type to expect for the <span class="code">dateStyle</span>
 of a <span class="code">DateFormatter</span>
 , so it lets us take this little shortcut. At <span class="ent">➋</span>
 , you set the <span class="code">timeStyle</span>
 of the <span class="code">dateFormatter</span>
 to <span class="code">.none</span>
 so that the time won’t be shown.</p>
<h4 class="h4" id="ch11lev2sec4">
<strong>DISPLAYING BIRTHDAYS IN A TABLE VIEW</strong>
</h4>
<p class="noindent">The <span class="code">BirthdaysTableViewController</span>
 class has a table view that is used to display a list of items in a single column. The table view has one or more sections containing rows, and each row contains a cell. A section in a table view is a grouping of rows that can be displayed with or without a header. An example of an app that shows a table view with several sections is the Settings app, as shown in <a href="text00022.html#ch11fig5">Figure 11-5</a>
 . It displays a list of rows that have been broken up into different sections.</p>
<p class="indent">Each section and row of a table view is identified with an index number. These numbers start at 0 and then increase by 1 as you go down the table view. For example, the Privacy line in the Settings app is found at section 0, row 1. The News setting is at section 1, row 3.</p>
<p class="indent">In the middle of the <span class="code">BirthdaysTableViewController</span>
 class, there is a section called <em>Table view data source</em>
 with three methods. The table view controller uses these methods to determine what’s going to be displayed inside its table view.</p>
<p class="hang">
<span class="code">
<span class="codestrong">numberOfSections(in:)</span>
</span>
 Tells the table view how many sections it should have</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:numberOfRowsInSection:)</span>
</span>
 Tells the table view how many rows will be displayed in each section</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:cellForRowAt:)</span>
</span>
 Sets up each cell that’s going to be displayed in each row of the table view</p>
<div class="image"><span id="page_163"></span>
 <img src="Image00243.jpg" />
</div>
<p class="figcap"><a id="ch11fig5"></a>
 <em>Figure 11-5: The Settings app uses sections to group rows of different device settings.</em>
</p>
<p class="indent">The table view data source methods are called by the table view controller every time the table view is reloaded. Xcode automatically gives you these method templates when you make a subclass of a <span class="code">UITableViewController</span>
 . You need to implement all three methods for the app to work, even though you’ll never call them directly in your code. The <span class="code">UITableViewController</span>
 class implements the <span class="code">UITableViewDataSource</span>
 protocol, which comes with these data source methods, to determine what will be displayed inside the table view. We’ll discuss protocols in “<a href="text00022.html#ch11lev2sec5">Delegation</a>
 ” on page 166. For now, you just need to know that a <span class="code">UITableViewController</span>
 uses these methods to display its content, and it automatically calls these methods so you don’t need to call them.</p>
<p class="indent">Let’s start with the method <span class="code">numberOfSections(in:)</span>
 . The Birthdays table view controller is a list that just displays <span class="code">Birthday</span>
 instances, so it doesn’t need multiple sections. To set the number of sections in the table view, we just need to return <span class="code">1</span>
 .</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func numberOfSections(in tableView: UITableView) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 <span class="blue1">1</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent"><span id="page_164"></span>
 This method takes a <span class="code">UITableView</span>
 called <span class="code">tableView</span>
 as a parameter, which is the table view that uses this class as its data source. We don’t need to worry about making this connection because the <span class="code">UITableViewController</span>
 comes with a built-in table view that is automatically hooked up to these methods. Each birthday will be displayed in its own row. So in <span class="code">tableView(_:numberOfRowsInSection:)</span>
 , in order to have the right number of rows for all of your birthdays, you need to return the number of <span class="code">Birthday</span>
 instances that you have in your <span class="code">birthdays</span>
 array. Do you remember the <span class="code">count</span>
 property of an array? It’s an integer that tells you how many items are in that array, and it’s perfect for this situation! Change this method to the following:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, <img class="inline" src="Image00184.jpg" />
<br />
    numberOfRowsInSection section: Int) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 birthdays.<span class="violet">count</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">In addition to the <span class="code">tableView</span>
 parameter, <span class="code">tableView(_:numberOfRowsInSection:)</span>
 also takes an <span class="code">Int</span>
 called <span class="code">section</span>
 . When the table view is loading itself, this method is called for each section in the table view. In our case, we have only one section, so we don’t need to bother checking which <span class="code">section</span>
 of the table view is being displayed here. We know it’s section 0, and we want it to have as many rows as there are birthdays, so we write <span class="code">return birthdays.count</span>
 .</p>
<p class="indent">Finally, you need to implement <span class="code">tableView(_:cellForRowAt:)</span>
 so that the table view will know what to put inside each cell. Since this method is commented out, you need to uncomment it by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it. (Be careful not to accidentally uncomment the other methods after it!) After you’ve done that, change it to the following code:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, cellForRowAt <img class="inline" src="Image00184.jpg" />
<br />
    indexPath: IndexPath) -&gt; UITableViewCell {</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="pink">let</span>
 cell = tableView.<span class="blue">dequeueReusableCell</span>
 (withIdentifier: <img class="inline" src="Image00093.jpg" />
<br />
        <span class="red">"birthdayCellIdentifier"</span>
 , for: indexPath)<br />
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 birthday = <span class="green1">birthdays</span>
 [indexPath.<span class="violet">row</span>
 ]<br />
<br />
  <span class="ent">➌</span>
 cell.<span class="violet">textLabel</span>
 ?.<span class="violet">text</span>
 = birthday.<span class="green1">firstName</span>
 <span class="blue">+</span>
 <span class="red">" "</span>
 <span class="blue">+</span>
 <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">lastName</span>
<br />
<br />
  <span class="ent">➍</span>
 cell.<span class="violet">detailTextLabel</span>
 ?.<span class="violet">text</span>
 = <span class="green1">dateFormatter</span>
 .<span class="blue">string</span>
 (from: <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">birthdate</span>
 )<br />
<br />
  <span class="ent">➎</span>
 <span class="pink">return</span>
 cell<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">You don’t call the method <span class="code">tableView(_:cellForRowAt:)</span>
 . It’s called when the table view is loaded onto the screen. It’s called for each cell on the screen and takes two parameters, <span class="code">tableView</span>
 and <span class="code">indexPath</span>
 . You already know <span id="page_165"></span>
 what the <span class="code">tableView</span>
 parameter is for. An <span class="code">IndexPath</span>
 is a Swift struct that’s used to represent a row’s position in a table view. An <span class="code">IndexPath</span>
 instance has a <span class="code">section</span>
 property and a <span class="code">row</span>
 property. Since this method will be called many times (once for every row in the table), we need the <span class="code">indexPath</span>
 to know which section and row we’re currently configuring. The <span class="code">indexPath.section</span>
 property gives the section number, and the <span class="code">indexPath.row</span>
 gives the row of the table view cell. The five lines of code inside <span class="code">tableView(_:cellForRowAt:)</span>
 will do the following:</p>
<div class="image"><img src="Image00244.jpg" />
</div>
<p class="bull">• Create a <span class="code">UITableViewCell</span>
</p>
<p class="bull">• Figure out which <span class="code">Birthday</span>
 in the <span class="code">birthdays</span>
 array will be displayed inside the cell</p>
<p class="bull">• Make two labels to display the birthday person’s name and birthdate in the cell</p>
<p class="bull">• Return the cell ready for display in the table view</p>
<p class="indentt">Let’s go through this code line by line.</p>
<p class="indent">First, create the <span class="code">UITableViewCell</span>
 . The code at <span class="ent">➊</span>
 does this using the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 . Before you can start using this method on a cell, though, you need to tell the method which cell you want to use from the storyboard. Earlier, when you were in the storyboard, you gave your cell the identifier <span class="code">birthdayCellIdentifier</span>
 (see <a href="text00022.html#ch11fig4">Figure 11-4</a>
 ). This identifier links your code to the cell and tells your method that it’s using the right cell. The string for when you call this method needs to be exactly the same as the string you set in the storyboard, or you’ll get an error and the app will crash when you run it.</p>
<p class="indent">In the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 , did you notice the words <em>Reusable Cell</em>
 ? The cells inside a table view are created once and then can be reused over and over. This helps everything run faster and smoother because creating the cell is what takes the most time. If you had 200 birthdays in your app, but only 10 would fit on your screen at one time, then you need only 10 cells to show your birthdays. When you scroll down to reveal more birthdays, the cells that scroll off the top of the screen are reused. They are filled with new information and show up again at the bottom of the screen. The <span class="code">UITableView</span>
 automatically does this work. When the table view is loaded, <span class="code">tableView(_:cellForRowAt:)</span>
 is called for every visible row. When the user scrolls to look at more cells, it’s called again for each row just as it is about to appear on the screen.</p>
<p class="indent">Next, we need to find out which <span class="code">Birthday</span>
 should be displayed inside the cell. We want to display one birthday from the <span class="code">birthdays</span>
 array in each row. The first birthday, which is at <span class="code">birthdays[0]</span>
 , should be displayed in row 0. The second birthday, at <span class="code">birthdays[1]</span>
 , should be displayed in row 1, and so on, which means the <span class="code">indexPath</span>
 ’s <span class="code">row</span>
 is the same as the position in the <span class="code">birthdays</span>
 array that we want to access. The code at <span class="ent">➋</span>
 accesses the <span id="page_166"></span>
 correct <span class="code">Birthday</span>
 object from the <span class="code">birthdays</span>
 array by using <span class="code">indexPath.row</span>
 . Once we have the right <span class="code">Birthday</span>
 object, we assign it to a constant named <span class="code">birthday</span>
 so we can set up the labels in this cell.</p>
<p class="indent">Notice that we’re using <span class="code">let</span>
 to assign the <span class="code">birthday</span>
 to a constant instead of a variable. We can use <span class="code">let</span>
 because each time <span class="code">tableView(_:cellForRowAt:)</span>
 is called, a new <span class="code">birthday</span>
 constant is created. Each cell gets its own <span class="code">birthday</span>
 constant that is assigned its own <span class="code">Birthday</span>
 object. Since we’re not going to change any of the <span class="code">birthday</span>
 constants—we’re just going to read their properties—we don’t want to make them variables.</p>
<p class="indent">Now that you have your cell and your birthday, it’s time to fill in the details. You need two labels for each cell to show the birthday person’s name and birthdate. You set the cell to the Subtitle style so that it has a Title label and a Subtitle label. Each cell will already contain these labels, so now you don’t have to create any labels yourself.</p>
<p class="indent">The labels exist as properties of <span class="code">UITableViewCell</span>
 and are called <span class="code">textLabel</span>
 and <span class="code">detailTextLabel</span>
 . The code at <span class="ent">➌</span>
 sets the text of the <span class="code">textLabel</span>
 to a string made up of the <span class="code">firstName</span>
 and <span class="code">lastName</span>
 of the <span class="code">birthday</span>
 with a space between them. At <span class="ent">➍</span>
 , you use the <span class="code">string(from:)</span>
 method of the <span class="code">dateFormatter</span>
 to display the birthdate in the <span class="code">detailTextLabel</span>
 .</p>
<p class="indent">When your cell is completely configured, <span class="code">tableView( _:cellForRowAt:)</span>
 returns the cell at <span class="ent">➎</span>
 so that it can be displayed at that <span class="code">indexPath</span>
 of the table view.</p>
<h3 class="h3" id="ch11lev1sec2">
<strong>PUTTING IT ALL TOGETHER</strong>
</h3>
<p class="noindent">Now you can add <span class="code">Birthday</span>
 instances to the app using the Add Birthday view controller, and you have a table view to list each <span class="code">Birthday</span>
 in the Birthdays table view controller. But when you try running the app and adding a <span class="code">Birthday</span>
 , it doesn’t appear. To make each <span class="code">Birthday</span>
 you add appear in the table view, you need to make the Add Birthday view controller communicate with the Birthdays table view controller. You do this by using <em>delegation</em>
 .</p>
<h4 class="h4" id="ch11lev2sec5">
<strong>DELEGATION</strong>
</h4>
<p class="noindent">Delegation can be used when one view controller needs to get information from another view controller. Say you have two view controllers: A and B. The first view controller, A, creates B and presents B on top of itself. A knows about B because it created and presented B, so A can pass information along to B. But B doesn’t know about A—it’s just popped into being and doesn’t know where it came from or how it got there. So how can B talk to A? Through delegation!</p>
<div class="image"><img src="Image00245.jpg" />
</div>
<p class="indent">Delegation is when someone gives a job or a task to someone else. A <em>delegate</em>
 is like a boss who tells a delegating employee what to do. When the delegating employee is done with their task, sometimes they’ll report information back to the delegate boss.</p>
<p class="indent"><span id="page_167"></span>
 Delegation in Swift is pretty similar, but instead of having a boss and employee, we have a delegate and a delegating object. Since class B is the one being told what to do by class A, it’s the delegating object. We give class B a special property called a delegate to tell it who its delegate is—that way, it knows who to communicate with. The delegate can be any class that has a set of methods that have been defined in a <em>protocol</em>
 . A protocol is like an agreement between the two classes that tells them what the delegate can ask the delegating object to do. It has a list of method and property names that the delegate can use with the delegating object.</p>
<p class="indent">Class A creates class B, makes itself the delegate of class B, and gives class B a job to do that’s in the protocol. Once class B is done with its job, it reports back to class A. Let’s see how this works in our app.</p>
<p class="indent">The Birthdays table view controller is view controller A, and the Add Birthday view controller is view controller B. We’ll create a protocol called <span class="code">AddBirthdayViewControllerDelegate</span>
 and a method for that protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 , which the Add Birthday view controller will use to report back.</p>
<p class="indent">Take a look at <a href="text00022.html#ch11fig6">Figure 11-6</a>
 . When the user taps the Add button <span class="ent">➊</span>
 , the Birthdays table view controller creates the Add Birthday view controller <span class="ent">➋</span>
 and sets itself as the Add Birthday view controller’s delegate.</p>
<div class="image"><img src="Image00246.jpg" />
</div>
<p class="figcap"><a id="ch11fig6"></a>
 <em>Figure 11-6: A new birthday is added and passed from the Add Birthday view controller to the Birthdays table view controller using delegation.</em>
</p>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="indent">At <span class="ent">➊</span>
 , you set the <span class="code">dateStyle</span>
 of the <span class="code">dateFormatter</span>
 so that it will display a formatted date string for each <span class="code">Birthday</span>
 . Did you notice how we just wrote <span class="code">.full</span>
 instead of <span class="code">DateFormatter.Style.full</span>
 ? Swift knows what type to expect for the <span class="code">dateStyle</span>
 of a <span class="code">DateFormatter</span>
 , so it lets us take this little shortcut. At <span class="ent">➋</span>
 , you set the <span class="code">timeStyle</span>
 of the <span class="code">dateFormatter</span>
 to <span class="code">.none</span>
 so that the time won’t be shown.</p>
<h4 class="h4" id="ch11lev2sec4">
<strong>DISPLAYING BIRTHDAYS IN A TABLE VIEW</strong>
</h4>
<p class="noindent">The <span class="code">BirthdaysTableViewController</span>
 class has a table view that is used to display a list of items in a single column. The table view has one or more sections containing rows, and each row contains a cell. A section in a table view is a grouping of rows that can be displayed with or without a header. An example of an app that shows a table view with several sections is the Settings app, as shown in <a href="text00022.html#ch11fig5">Figure 11-5</a>
 . It displays a list of rows that have been broken up into different sections.</p>
<p class="indent">Each section and row of a table view is identified with an index number. These numbers start at 0 and then increase by 1 as you go down the table view. For example, the Privacy line in the Settings app is found at section 0, row 1. The News setting is at section 1, row 3.</p>
<p class="indent">In the middle of the <span class="code">BirthdaysTableViewController</span>
 class, there is a section called <em>Table view data source</em>
 with three methods. The table view controller uses these methods to determine what’s going to be displayed inside its table view.</p>
<p class="hang">
<span class="code">
<span class="codestrong">numberOfSections(in:)</span>
</span>
 Tells the table view how many sections it should have</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:numberOfRowsInSection:)</span>
</span>
 Tells the table view how many rows will be displayed in each section</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:cellForRowAt:)</span>
</span>
 Sets up each cell that’s going to be displayed in each row of the table view</p>
<div class="image"><span id="page_163"></span>
 <img src="Image00243.jpg" />
</div>
<p class="figcap"><a id="ch11fig5"></a>
 <em>Figure 11-5: The Settings app uses sections to group rows of different device settings.</em>
</p>
<p class="indent">The table view data source methods are called by the table view controller every time the table view is reloaded. Xcode automatically gives you these method templates when you make a subclass of a <span class="code">UITableViewController</span>
 . You need to implement all three methods for the app to work, even though you’ll never call them directly in your code. The <span class="code">UITableViewController</span>
 class implements the <span class="code">UITableViewDataSource</span>
 protocol, which comes with these data source methods, to determine what will be displayed inside the table view. We’ll discuss protocols in “<a href="text00022.html#ch11lev2sec5">Delegation</a>
 ” on page 166. For now, you just need to know that a <span class="code">UITableViewController</span>
 uses these methods to display its content, and it automatically calls these methods so you don’t need to call them.</p>
<p class="indent">Let’s start with the method <span class="code">numberOfSections(in:)</span>
 . The Birthdays table view controller is a list that just displays <span class="code">Birthday</span>
 instances, so it doesn’t need multiple sections. To set the number of sections in the table view, we just need to return <span class="code">1</span>
 .</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func numberOfSections(in tableView: UITableView) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 <span class="blue1">1</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent"><span id="page_164"></span>
 This method takes a <span class="code">UITableView</span>
 called <span class="code">tableView</span>
 as a parameter, which is the table view that uses this class as its data source. We don’t need to worry about making this connection because the <span class="code">UITableViewController</span>
 comes with a built-in table view that is automatically hooked up to these methods. Each birthday will be displayed in its own row. So in <span class="code">tableView(_:numberOfRowsInSection:)</span>
 , in order to have the right number of rows for all of your birthdays, you need to return the number of <span class="code">Birthday</span>
 instances that you have in your <span class="code">birthdays</span>
 array. Do you remember the <span class="code">count</span>
 property of an array? It’s an integer that tells you how many items are in that array, and it’s perfect for this situation! Change this method to the following:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, <img class="inline" src="Image00184.jpg" />
<br />
    numberOfRowsInSection section: Int) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 birthdays.<span class="violet">count</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">In addition to the <span class="code">tableView</span>
 parameter, <span class="code">tableView(_:numberOfRowsInSection:)</span>
 also takes an <span class="code">Int</span>
 called <span class="code">section</span>
 . When the table view is loading itself, this method is called for each section in the table view. In our case, we have only one section, so we don’t need to bother checking which <span class="code">section</span>
 of the table view is being displayed here. We know it’s section 0, and we want it to have as many rows as there are birthdays, so we write <span class="code">return birthdays.count</span>
 .</p>
<p class="indent">Finally, you need to implement <span class="code">tableView(_:cellForRowAt:)</span>
 so that the table view will know what to put inside each cell. Since this method is commented out, you need to uncomment it by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it. (Be careful not to accidentally uncomment the other methods after it!) After you’ve done that, change it to the following code:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, cellForRowAt <img class="inline" src="Image00184.jpg" />
<br />
    indexPath: IndexPath) -&gt; UITableViewCell {</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="pink">let</span>
 cell = tableView.<span class="blue">dequeueReusableCell</span>
 (withIdentifier: <img class="inline" src="Image00093.jpg" />
<br />
        <span class="red">"birthdayCellIdentifier"</span>
 , for: indexPath)<br />
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 birthday = <span class="green1">birthdays</span>
 [indexPath.<span class="violet">row</span>
 ]<br />
<br />
  <span class="ent">➌</span>
 cell.<span class="violet">textLabel</span>
 ?.<span class="violet">text</span>
 = birthday.<span class="green1">firstName</span>
 <span class="blue">+</span>
 <span class="red">" "</span>
 <span class="blue">+</span>
 <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">lastName</span>
<br />
<br />
  <span class="ent">➍</span>
 cell.<span class="violet">detailTextLabel</span>
 ?.<span class="violet">text</span>
 = <span class="green1">dateFormatter</span>
 .<span class="blue">string</span>
 (from: <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">birthdate</span>
 )<br />
<br />
  <span class="ent">➎</span>
 <span class="pink">return</span>
 cell<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">You don’t call the method <span class="code">tableView(_:cellForRowAt:)</span>
 . It’s called when the table view is loaded onto the screen. It’s called for each cell on the screen and takes two parameters, <span class="code">tableView</span>
 and <span class="code">indexPath</span>
 . You already know <span id="page_165"></span>
 what the <span class="code">tableView</span>
 parameter is for. An <span class="code">IndexPath</span>
 is a Swift struct that’s used to represent a row’s position in a table view. An <span class="code">IndexPath</span>
 instance has a <span class="code">section</span>
 property and a <span class="code">row</span>
 property. Since this method will be called many times (once for every row in the table), we need the <span class="code">indexPath</span>
 to know which section and row we’re currently configuring. The <span class="code">indexPath.section</span>
 property gives the section number, and the <span class="code">indexPath.row</span>
 gives the row of the table view cell. The five lines of code inside <span class="code">tableView(_:cellForRowAt:)</span>
 will do the following:</p>
<div class="image"><img src="Image00244.jpg" />
</div>
<p class="bull">• Create a <span class="code">UITableViewCell</span>
</p>
<p class="bull">• Figure out which <span class="code">Birthday</span>
 in the <span class="code">birthdays</span>
 array will be displayed inside the cell</p>
<p class="bull">• Make two labels to display the birthday person’s name and birthdate in the cell</p>
<p class="bull">• Return the cell ready for display in the table view</p>
<p class="indentt">Let’s go through this code line by line.</p>
<p class="indent">First, create the <span class="code">UITableViewCell</span>
 . The code at <span class="ent">➊</span>
 does this using the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 . Before you can start using this method on a cell, though, you need to tell the method which cell you want to use from the storyboard. Earlier, when you were in the storyboard, you gave your cell the identifier <span class="code">birthdayCellIdentifier</span>
 (see <a href="text00022.html#ch11fig4">Figure 11-4</a>
 ). This identifier links your code to the cell and tells your method that it’s using the right cell. The string for when you call this method needs to be exactly the same as the string you set in the storyboard, or you’ll get an error and the app will crash when you run it.</p>
<p class="indent">In the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 , did you notice the words <em>Reusable Cell</em>
 ? The cells inside a table view are created once and then can be reused over and over. This helps everything run faster and smoother because creating the cell is what takes the most time. If you had 200 birthdays in your app, but only 10 would fit on your screen at one time, then you need only 10 cells to show your birthdays. When you scroll down to reveal more birthdays, the cells that scroll off the top of the screen are reused. They are filled with new information and show up again at the bottom of the screen. The <span class="code">UITableView</span>
 automatically does this work. When the table view is loaded, <span class="code">tableView(_:cellForRowAt:)</span>
 is called for every visible row. When the user scrolls to look at more cells, it’s called again for each row just as it is about to appear on the screen.</p>
<p class="indent">Next, we need to find out which <span class="code">Birthday</span>
 should be displayed inside the cell. We want to display one birthday from the <span class="code">birthdays</span>
 array in each row. The first birthday, which is at <span class="code">birthdays[0]</span>
 , should be displayed in row 0. The second birthday, at <span class="code">birthdays[1]</span>
 , should be displayed in row 1, and so on, which means the <span class="code">indexPath</span>
 ’s <span class="code">row</span>
 is the same as the position in the <span class="code">birthdays</span>
 array that we want to access. The code at <span class="ent">➋</span>
 accesses the <span id="page_166"></span>
 correct <span class="code">Birthday</span>
 object from the <span class="code">birthdays</span>
 array by using <span class="code">indexPath.row</span>
 . Once we have the right <span class="code">Birthday</span>
 object, we assign it to a constant named <span class="code">birthday</span>
 so we can set up the labels in this cell.</p>
<p class="indent">Notice that we’re using <span class="code">let</span>
 to assign the <span class="code">birthday</span>
 to a constant instead of a variable. We can use <span class="code">let</span>
 because each time <span class="code">tableView(_:cellForRowAt:)</span>
 is called, a new <span class="code">birthday</span>
 constant is created. Each cell gets its own <span class="code">birthday</span>
 constant that is assigned its own <span class="code">Birthday</span>
 object. Since we’re not going to change any of the <span class="code">birthday</span>
 constants—we’re just going to read their properties—we don’t want to make them variables.</p>
<p class="indent">Now that you have your cell and your birthday, it’s time to fill in the details. You need two labels for each cell to show the birthday person’s name and birthdate. You set the cell to the Subtitle style so that it has a Title label and a Subtitle label. Each cell will already contain these labels, so now you don’t have to create any labels yourself.</p>
<p class="indent">The labels exist as properties of <span class="code">UITableViewCell</span>
 and are called <span class="code">textLabel</span>
 and <span class="code">detailTextLabel</span>
 . The code at <span class="ent">➌</span>
 sets the text of the <span class="code">textLabel</span>
 to a string made up of the <span class="code">firstName</span>
 and <span class="code">lastName</span>
 of the <span class="code">birthday</span>
 with a space between them. At <span class="ent">➍</span>
 , you use the <span class="code">string(from:)</span>
 method of the <span class="code">dateFormatter</span>
 to display the birthdate in the <span class="code">detailTextLabel</span>
 .</p>
<p class="indent">When your cell is completely configured, <span class="code">tableView( _:cellForRowAt:)</span>
 returns the cell at <span class="ent">➎</span>
 so that it can be displayed at that <span class="code">indexPath</span>
 of the table view.</p>
<h3 class="h3" id="ch11lev1sec2">
<strong>PUTTING IT ALL TOGETHER</strong>
</h3>
<p class="noindent">Now you can add <span class="code">Birthday</span>
 instances to the app using the Add Birthday view controller, and you have a table view to list each <span class="code">Birthday</span>
 in the Birthdays table view controller. But when you try running the app and adding a <span class="code">Birthday</span>
 , it doesn’t appear. To make each <span class="code">Birthday</span>
 you add appear in the table view, you need to make the Add Birthday view controller communicate with the Birthdays table view controller. You do this by using <em>delegation</em>
 .</p>
<h4 class="h4" id="ch11lev2sec5">
<strong>DELEGATION</strong>
</h4>
<p class="noindent">Delegation can be used when one view controller needs to get information from another view controller. Say you have two view controllers: A and B. The first view controller, A, creates B and presents B on top of itself. A knows about B because it created and presented B, so A can pass information along to B. But B doesn’t know about A—it’s just popped into being and doesn’t know where it came from or how it got there. So how can B talk to A? Through delegation!</p>
<div class="image"><img src="Image00245.jpg" />
</div>
<p class="indent">Delegation is when someone gives a job or a task to someone else. A <em>delegate</em>
 is like a boss who tells a delegating employee what to do. When the delegating employee is done with their task, sometimes they’ll report information back to the delegate boss.</p>
<p class="indent"><span id="page_167"></span>
 Delegation in Swift is pretty similar, but instead of having a boss and employee, we have a delegate and a delegating object. Since class B is the one being told what to do by class A, it’s the delegating object. We give class B a special property called a delegate to tell it who its delegate is—that way, it knows who to communicate with. The delegate can be any class that has a set of methods that have been defined in a <em>protocol</em>
 . A protocol is like an agreement between the two classes that tells them what the delegate can ask the delegating object to do. It has a list of method and property names that the delegate can use with the delegating object.</p>
<p class="indent">Class A creates class B, makes itself the delegate of class B, and gives class B a job to do that’s in the protocol. Once class B is done with its job, it reports back to class A. Let’s see how this works in our app.</p>
<p class="indent">The Birthdays table view controller is view controller A, and the Add Birthday view controller is view controller B. We’ll create a protocol called <span class="code">AddBirthdayViewControllerDelegate</span>
 and a method for that protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 , which the Add Birthday view controller will use to report back.</p>
<p class="indent">Take a look at <a href="text00022.html#ch11fig6">Figure 11-6</a>
 . When the user taps the Add button <span class="ent">➊</span>
 , the Birthdays table view controller creates the Add Birthday view controller <span class="ent">➋</span>
 and sets itself as the Add Birthday view controller’s delegate.</p>
<div class="image"><img src="Image00246.jpg" />
</div>
<p class="figcap"><a id="ch11fig6"></a>
 <em>Figure 11-6: A new birthday is added and passed from the Add Birthday view controller to the Birthdays table view controller using delegation.</em>
</p>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<h4 class="h4" id="ch11lev2sec4">
<strong>DISPLAYING BIRTHDAYS IN A TABLE VIEW</strong>
</h4>
<p class="noindent">The <span class="code">BirthdaysTableViewController</span>
 class has a table view that is used to display a list of items in a single column. The table view has one or more sections containing rows, and each row contains a cell. A section in a table view is a grouping of rows that can be displayed with or without a header. An example of an app that shows a table view with several sections is the Settings app, as shown in <a href="text00022.html#ch11fig5">Figure 11-5</a>
 . It displays a list of rows that have been broken up into different sections.</p>
<p class="indent">Each section and row of a table view is identified with an index number. These numbers start at 0 and then increase by 1 as you go down the table view. For example, the Privacy line in the Settings app is found at section 0, row 1. The News setting is at section 1, row 3.</p>
<p class="indent">In the middle of the <span class="code">BirthdaysTableViewController</span>
 class, there is a section called <em>Table view data source</em>
 with three methods. The table view controller uses these methods to determine what’s going to be displayed inside its table view.</p>
<p class="hang">
<span class="code">
<span class="codestrong">numberOfSections(in:)</span>
</span>
 Tells the table view how many sections it should have</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:numberOfRowsInSection:)</span>
</span>
 Tells the table view how many rows will be displayed in each section</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:cellForRowAt:)</span>
</span>
 Sets up each cell that’s going to be displayed in each row of the table view</p>
<div class="image"><span id="page_163"></span>
 <img src="Image00243.jpg" />
</div>
<p class="figcap"><a id="ch11fig5"></a>
 <em>Figure 11-5: The Settings app uses sections to group rows of different device settings.</em>
</p>
<p class="indent">The table view data source methods are called by the table view controller every time the table view is reloaded. Xcode automatically gives you these method templates when you make a subclass of a <span class="code">UITableViewController</span>
 . You need to implement all three methods for the app to work, even though you’ll never call them directly in your code. The <span class="code">UITableViewController</span>
 class implements the <span class="code">UITableViewDataSource</span>
 protocol, which comes with these data source methods, to determine what will be displayed inside the table view. We’ll discuss protocols in “<a href="text00022.html#ch11lev2sec5">Delegation</a>
 ” on page 166. For now, you just need to know that a <span class="code">UITableViewController</span>
 uses these methods to display its content, and it automatically calls these methods so you don’t need to call them.</p>
<p class="indent">Let’s start with the method <span class="code">numberOfSections(in:)</span>
 . The Birthdays table view controller is a list that just displays <span class="code">Birthday</span>
 instances, so it doesn’t need multiple sections. To set the number of sections in the table view, we just need to return <span class="code">1</span>
 .</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func numberOfSections(in tableView: UITableView) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 <span class="blue1">1</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent"><span id="page_164"></span>
 This method takes a <span class="code">UITableView</span>
 called <span class="code">tableView</span>
 as a parameter, which is the table view that uses this class as its data source. We don’t need to worry about making this connection because the <span class="code">UITableViewController</span>
 comes with a built-in table view that is automatically hooked up to these methods. Each birthday will be displayed in its own row. So in <span class="code">tableView(_:numberOfRowsInSection:)</span>
 , in order to have the right number of rows for all of your birthdays, you need to return the number of <span class="code">Birthday</span>
 instances that you have in your <span class="code">birthdays</span>
 array. Do you remember the <span class="code">count</span>
 property of an array? It’s an integer that tells you how many items are in that array, and it’s perfect for this situation! Change this method to the following:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, <img class="inline" src="Image00184.jpg" />
<br />
    numberOfRowsInSection section: Int) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 birthdays.<span class="violet">count</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">In addition to the <span class="code">tableView</span>
 parameter, <span class="code">tableView(_:numberOfRowsInSection:)</span>
 also takes an <span class="code">Int</span>
 called <span class="code">section</span>
 . When the table view is loading itself, this method is called for each section in the table view. In our case, we have only one section, so we don’t need to bother checking which <span class="code">section</span>
 of the table view is being displayed here. We know it’s section 0, and we want it to have as many rows as there are birthdays, so we write <span class="code">return birthdays.count</span>
 .</p>
<p class="indent">Finally, you need to implement <span class="code">tableView(_:cellForRowAt:)</span>
 so that the table view will know what to put inside each cell. Since this method is commented out, you need to uncomment it by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it. (Be careful not to accidentally uncomment the other methods after it!) After you’ve done that, change it to the following code:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, cellForRowAt <img class="inline" src="Image00184.jpg" />
<br />
    indexPath: IndexPath) -&gt; UITableViewCell {</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="pink">let</span>
 cell = tableView.<span class="blue">dequeueReusableCell</span>
 (withIdentifier: <img class="inline" src="Image00093.jpg" />
<br />
        <span class="red">"birthdayCellIdentifier"</span>
 , for: indexPath)<br />
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 birthday = <span class="green1">birthdays</span>
 [indexPath.<span class="violet">row</span>
 ]<br />
<br />
  <span class="ent">➌</span>
 cell.<span class="violet">textLabel</span>
 ?.<span class="violet">text</span>
 = birthday.<span class="green1">firstName</span>
 <span class="blue">+</span>
 <span class="red">" "</span>
 <span class="blue">+</span>
 <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">lastName</span>
<br />
<br />
  <span class="ent">➍</span>
 cell.<span class="violet">detailTextLabel</span>
 ?.<span class="violet">text</span>
 = <span class="green1">dateFormatter</span>
 .<span class="blue">string</span>
 (from: <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">birthdate</span>
 )<br />
<br />
  <span class="ent">➎</span>
 <span class="pink">return</span>
 cell<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">You don’t call the method <span class="code">tableView(_:cellForRowAt:)</span>
 . It’s called when the table view is loaded onto the screen. It’s called for each cell on the screen and takes two parameters, <span class="code">tableView</span>
 and <span class="code">indexPath</span>
 . You already know <span id="page_165"></span>
 what the <span class="code">tableView</span>
 parameter is for. An <span class="code">IndexPath</span>
 is a Swift struct that’s used to represent a row’s position in a table view. An <span class="code">IndexPath</span>
 instance has a <span class="code">section</span>
 property and a <span class="code">row</span>
 property. Since this method will be called many times (once for every row in the table), we need the <span class="code">indexPath</span>
 to know which section and row we’re currently configuring. The <span class="code">indexPath.section</span>
 property gives the section number, and the <span class="code">indexPath.row</span>
 gives the row of the table view cell. The five lines of code inside <span class="code">tableView(_:cellForRowAt:)</span>
 will do the following:</p>
<div class="image"><img src="Image00244.jpg" />
</div>
<p class="bull">• Create a <span class="code">UITableViewCell</span>
</p>
<p class="bull">• Figure out which <span class="code">Birthday</span>
 in the <span class="code">birthdays</span>
 array will be displayed inside the cell</p>
<p class="bull">• Make two labels to display the birthday person’s name and birthdate in the cell</p>
<p class="bull">• Return the cell ready for display in the table view</p>
<p class="indentt">Let’s go through this code line by line.</p>
<p class="indent">First, create the <span class="code">UITableViewCell</span>
 . The code at <span class="ent">➊</span>
 does this using the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 . Before you can start using this method on a cell, though, you need to tell the method which cell you want to use from the storyboard. Earlier, when you were in the storyboard, you gave your cell the identifier <span class="code">birthdayCellIdentifier</span>
 (see <a href="text00022.html#ch11fig4">Figure 11-4</a>
 ). This identifier links your code to the cell and tells your method that it’s using the right cell. The string for when you call this method needs to be exactly the same as the string you set in the storyboard, or you’ll get an error and the app will crash when you run it.</p>
<p class="indent">In the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 , did you notice the words <em>Reusable Cell</em>
 ? The cells inside a table view are created once and then can be reused over and over. This helps everything run faster and smoother because creating the cell is what takes the most time. If you had 200 birthdays in your app, but only 10 would fit on your screen at one time, then you need only 10 cells to show your birthdays. When you scroll down to reveal more birthdays, the cells that scroll off the top of the screen are reused. They are filled with new information and show up again at the bottom of the screen. The <span class="code">UITableView</span>
 automatically does this work. When the table view is loaded, <span class="code">tableView(_:cellForRowAt:)</span>
 is called for every visible row. When the user scrolls to look at more cells, it’s called again for each row just as it is about to appear on the screen.</p>
<p class="indent">Next, we need to find out which <span class="code">Birthday</span>
 should be displayed inside the cell. We want to display one birthday from the <span class="code">birthdays</span>
 array in each row. The first birthday, which is at <span class="code">birthdays[0]</span>
 , should be displayed in row 0. The second birthday, at <span class="code">birthdays[1]</span>
 , should be displayed in row 1, and so on, which means the <span class="code">indexPath</span>
 ’s <span class="code">row</span>
 is the same as the position in the <span class="code">birthdays</span>
 array that we want to access. The code at <span class="ent">➋</span>
 accesses the <span id="page_166"></span>
 correct <span class="code">Birthday</span>
 object from the <span class="code">birthdays</span>
 array by using <span class="code">indexPath.row</span>
 . Once we have the right <span class="code">Birthday</span>
 object, we assign it to a constant named <span class="code">birthday</span>
 so we can set up the labels in this cell.</p>
<p class="indent">Notice that we’re using <span class="code">let</span>
 to assign the <span class="code">birthday</span>
 to a constant instead of a variable. We can use <span class="code">let</span>
 because each time <span class="code">tableView(_:cellForRowAt:)</span>
 is called, a new <span class="code">birthday</span>
 constant is created. Each cell gets its own <span class="code">birthday</span>
 constant that is assigned its own <span class="code">Birthday</span>
 object. Since we’re not going to change any of the <span class="code">birthday</span>
 constants—we’re just going to read their properties—we don’t want to make them variables.</p>
<p class="indent">Now that you have your cell and your birthday, it’s time to fill in the details. You need two labels for each cell to show the birthday person’s name and birthdate. You set the cell to the Subtitle style so that it has a Title label and a Subtitle label. Each cell will already contain these labels, so now you don’t have to create any labels yourself.</p>
<p class="indent">The labels exist as properties of <span class="code">UITableViewCell</span>
 and are called <span class="code">textLabel</span>
 and <span class="code">detailTextLabel</span>
 . The code at <span class="ent">➌</span>
 sets the text of the <span class="code">textLabel</span>
 to a string made up of the <span class="code">firstName</span>
 and <span class="code">lastName</span>
 of the <span class="code">birthday</span>
 with a space between them. At <span class="ent">➍</span>
 , you use the <span class="code">string(from:)</span>
 method of the <span class="code">dateFormatter</span>
 to display the birthdate in the <span class="code">detailTextLabel</span>
 .</p>
<p class="indent">When your cell is completely configured, <span class="code">tableView( _:cellForRowAt:)</span>
 returns the cell at <span class="ent">➎</span>
 so that it can be displayed at that <span class="code">indexPath</span>
 of the table view.</p>
<h3 class="h3" id="ch11lev1sec2">
<strong>PUTTING IT ALL TOGETHER</strong>
</h3>
<p class="noindent">Now you can add <span class="code">Birthday</span>
 instances to the app using the Add Birthday view controller, and you have a table view to list each <span class="code">Birthday</span>
 in the Birthdays table view controller. But when you try running the app and adding a <span class="code">Birthday</span>
 , it doesn’t appear. To make each <span class="code">Birthday</span>
 you add appear in the table view, you need to make the Add Birthday view controller communicate with the Birthdays table view controller. You do this by using <em>delegation</em>
 .</p>
<h4 class="h4" id="ch11lev2sec5">
<strong>DELEGATION</strong>
</h4>
<p class="noindent">Delegation can be used when one view controller needs to get information from another view controller. Say you have two view controllers: A and B. The first view controller, A, creates B and presents B on top of itself. A knows about B because it created and presented B, so A can pass information along to B. But B doesn’t know about A—it’s just popped into being and doesn’t know where it came from or how it got there. So how can B talk to A? Through delegation!</p>
<div class="image"><img src="Image00245.jpg" />
</div>
<p class="indent">Delegation is when someone gives a job or a task to someone else. A <em>delegate</em>
 is like a boss who tells a delegating employee what to do. When the delegating employee is done with their task, sometimes they’ll report information back to the delegate boss.</p>
<p class="indent"><span id="page_167"></span>
 Delegation in Swift is pretty similar, but instead of having a boss and employee, we have a delegate and a delegating object. Since class B is the one being told what to do by class A, it’s the delegating object. We give class B a special property called a delegate to tell it who its delegate is—that way, it knows who to communicate with. The delegate can be any class that has a set of methods that have been defined in a <em>protocol</em>
 . A protocol is like an agreement between the two classes that tells them what the delegate can ask the delegating object to do. It has a list of method and property names that the delegate can use with the delegating object.</p>
<p class="indent">Class A creates class B, makes itself the delegate of class B, and gives class B a job to do that’s in the protocol. Once class B is done with its job, it reports back to class A. Let’s see how this works in our app.</p>
<p class="indent">The Birthdays table view controller is view controller A, and the Add Birthday view controller is view controller B. We’ll create a protocol called <span class="code">AddBirthdayViewControllerDelegate</span>
 and a method for that protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 , which the Add Birthday view controller will use to report back.</p>
<p class="indent">Take a look at <a href="text00022.html#ch11fig6">Figure 11-6</a>
 . When the user taps the Add button <span class="ent">➊</span>
 , the Birthdays table view controller creates the Add Birthday view controller <span class="ent">➋</span>
 and sets itself as the Add Birthday view controller’s delegate.</p>
<div class="image"><img src="Image00246.jpg" />
</div>
<p class="figcap"><a id="ch11fig6"></a>
 <em>Figure 11-6: A new birthday is added and passed from the Add Birthday view controller to the Birthdays table view controller using delegation.</em>
</p>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="noindent">The <span class="code">BirthdaysTableViewController</span>
 class has a table view that is used to display a list of items in a single column. The table view has one or more sections containing rows, and each row contains a cell. A section in a table view is a grouping of rows that can be displayed with or without a header. An example of an app that shows a table view with several sections is the Settings app, as shown in <a href="text00022.html#ch11fig5">Figure 11-5</a>
 . It displays a list of rows that have been broken up into different sections.</p>
<p class="indent">Each section and row of a table view is identified with an index number. These numbers start at 0 and then increase by 1 as you go down the table view. For example, the Privacy line in the Settings app is found at section 0, row 1. The News setting is at section 1, row 3.</p>
<p class="indent">In the middle of the <span class="code">BirthdaysTableViewController</span>
 class, there is a section called <em>Table view data source</em>
 with three methods. The table view controller uses these methods to determine what’s going to be displayed inside its table view.</p>
<p class="hang">
<span class="code">
<span class="codestrong">numberOfSections(in:)</span>
</span>
 Tells the table view how many sections it should have</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:numberOfRowsInSection:)</span>
</span>
 Tells the table view how many rows will be displayed in each section</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:cellForRowAt:)</span>
</span>
 Sets up each cell that’s going to be displayed in each row of the table view</p>
<div class="image"><span id="page_163"></span>
 <img src="Image00243.jpg" />
</div>
<p class="figcap"><a id="ch11fig5"></a>
 <em>Figure 11-5: The Settings app uses sections to group rows of different device settings.</em>
</p>
<p class="indent">The table view data source methods are called by the table view controller every time the table view is reloaded. Xcode automatically gives you these method templates when you make a subclass of a <span class="code">UITableViewController</span>
 . You need to implement all three methods for the app to work, even though you’ll never call them directly in your code. The <span class="code">UITableViewController</span>
 class implements the <span class="code">UITableViewDataSource</span>
 protocol, which comes with these data source methods, to determine what will be displayed inside the table view. We’ll discuss protocols in “<a href="text00022.html#ch11lev2sec5">Delegation</a>
 ” on page 166. For now, you just need to know that a <span class="code">UITableViewController</span>
 uses these methods to display its content, and it automatically calls these methods so you don’t need to call them.</p>
<p class="indent">Let’s start with the method <span class="code">numberOfSections(in:)</span>
 . The Birthdays table view controller is a list that just displays <span class="code">Birthday</span>
 instances, so it doesn’t need multiple sections. To set the number of sections in the table view, we just need to return <span class="code">1</span>
 .</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func numberOfSections(in tableView: UITableView) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 <span class="blue1">1</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent"><span id="page_164"></span>
 This method takes a <span class="code">UITableView</span>
 called <span class="code">tableView</span>
 as a parameter, which is the table view that uses this class as its data source. We don’t need to worry about making this connection because the <span class="code">UITableViewController</span>
 comes with a built-in table view that is automatically hooked up to these methods. Each birthday will be displayed in its own row. So in <span class="code">tableView(_:numberOfRowsInSection:)</span>
 , in order to have the right number of rows for all of your birthdays, you need to return the number of <span class="code">Birthday</span>
 instances that you have in your <span class="code">birthdays</span>
 array. Do you remember the <span class="code">count</span>
 property of an array? It’s an integer that tells you how many items are in that array, and it’s perfect for this situation! Change this method to the following:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, <img class="inline" src="Image00184.jpg" />
<br />
    numberOfRowsInSection section: Int) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 birthdays.<span class="violet">count</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">In addition to the <span class="code">tableView</span>
 parameter, <span class="code">tableView(_:numberOfRowsInSection:)</span>
 also takes an <span class="code">Int</span>
 called <span class="code">section</span>
 . When the table view is loading itself, this method is called for each section in the table view. In our case, we have only one section, so we don’t need to bother checking which <span class="code">section</span>
 of the table view is being displayed here. We know it’s section 0, and we want it to have as many rows as there are birthdays, so we write <span class="code">return birthdays.count</span>
 .</p>
<p class="indent">Finally, you need to implement <span class="code">tableView(_:cellForRowAt:)</span>
 so that the table view will know what to put inside each cell. Since this method is commented out, you need to uncomment it by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it. (Be careful not to accidentally uncomment the other methods after it!) After you’ve done that, change it to the following code:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, cellForRowAt <img class="inline" src="Image00184.jpg" />
<br />
    indexPath: IndexPath) -&gt; UITableViewCell {</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="pink">let</span>
 cell = tableView.<span class="blue">dequeueReusableCell</span>
 (withIdentifier: <img class="inline" src="Image00093.jpg" />
<br />
        <span class="red">"birthdayCellIdentifier"</span>
 , for: indexPath)<br />
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 birthday = <span class="green1">birthdays</span>
 [indexPath.<span class="violet">row</span>
 ]<br />
<br />
  <span class="ent">➌</span>
 cell.<span class="violet">textLabel</span>
 ?.<span class="violet">text</span>
 = birthday.<span class="green1">firstName</span>
 <span class="blue">+</span>
 <span class="red">" "</span>
 <span class="blue">+</span>
 <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">lastName</span>
<br />
<br />
  <span class="ent">➍</span>
 cell.<span class="violet">detailTextLabel</span>
 ?.<span class="violet">text</span>
 = <span class="green1">dateFormatter</span>
 .<span class="blue">string</span>
 (from: <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">birthdate</span>
 )<br />
<br />
  <span class="ent">➎</span>
 <span class="pink">return</span>
 cell<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">You don’t call the method <span class="code">tableView(_:cellForRowAt:)</span>
 . It’s called when the table view is loaded onto the screen. It’s called for each cell on the screen and takes two parameters, <span class="code">tableView</span>
 and <span class="code">indexPath</span>
 . You already know <span id="page_165"></span>
 what the <span class="code">tableView</span>
 parameter is for. An <span class="code">IndexPath</span>
 is a Swift struct that’s used to represent a row’s position in a table view. An <span class="code">IndexPath</span>
 instance has a <span class="code">section</span>
 property and a <span class="code">row</span>
 property. Since this method will be called many times (once for every row in the table), we need the <span class="code">indexPath</span>
 to know which section and row we’re currently configuring. The <span class="code">indexPath.section</span>
 property gives the section number, and the <span class="code">indexPath.row</span>
 gives the row of the table view cell. The five lines of code inside <span class="code">tableView(_:cellForRowAt:)</span>
 will do the following:</p>
<div class="image"><img src="Image00244.jpg" />
</div>
<p class="bull">• Create a <span class="code">UITableViewCell</span>
</p>
<p class="bull">• Figure out which <span class="code">Birthday</span>
 in the <span class="code">birthdays</span>
 array will be displayed inside the cell</p>
<p class="bull">• Make two labels to display the birthday person’s name and birthdate in the cell</p>
<p class="bull">• Return the cell ready for display in the table view</p>
<p class="indentt">Let’s go through this code line by line.</p>
<p class="indent">First, create the <span class="code">UITableViewCell</span>
 . The code at <span class="ent">➊</span>
 does this using the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 . Before you can start using this method on a cell, though, you need to tell the method which cell you want to use from the storyboard. Earlier, when you were in the storyboard, you gave your cell the identifier <span class="code">birthdayCellIdentifier</span>
 (see <a href="text00022.html#ch11fig4">Figure 11-4</a>
 ). This identifier links your code to the cell and tells your method that it’s using the right cell. The string for when you call this method needs to be exactly the same as the string you set in the storyboard, or you’ll get an error and the app will crash when you run it.</p>
<p class="indent">In the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 , did you notice the words <em>Reusable Cell</em>
 ? The cells inside a table view are created once and then can be reused over and over. This helps everything run faster and smoother because creating the cell is what takes the most time. If you had 200 birthdays in your app, but only 10 would fit on your screen at one time, then you need only 10 cells to show your birthdays. When you scroll down to reveal more birthdays, the cells that scroll off the top of the screen are reused. They are filled with new information and show up again at the bottom of the screen. The <span class="code">UITableView</span>
 automatically does this work. When the table view is loaded, <span class="code">tableView(_:cellForRowAt:)</span>
 is called for every visible row. When the user scrolls to look at more cells, it’s called again for each row just as it is about to appear on the screen.</p>
<p class="indent">Next, we need to find out which <span class="code">Birthday</span>
 should be displayed inside the cell. We want to display one birthday from the <span class="code">birthdays</span>
 array in each row. The first birthday, which is at <span class="code">birthdays[0]</span>
 , should be displayed in row 0. The second birthday, at <span class="code">birthdays[1]</span>
 , should be displayed in row 1, and so on, which means the <span class="code">indexPath</span>
 ’s <span class="code">row</span>
 is the same as the position in the <span class="code">birthdays</span>
 array that we want to access. The code at <span class="ent">➋</span>
 accesses the <span id="page_166"></span>
 correct <span class="code">Birthday</span>
 object from the <span class="code">birthdays</span>
 array by using <span class="code">indexPath.row</span>
 . Once we have the right <span class="code">Birthday</span>
 object, we assign it to a constant named <span class="code">birthday</span>
 so we can set up the labels in this cell.</p>
<p class="indent">Notice that we’re using <span class="code">let</span>
 to assign the <span class="code">birthday</span>
 to a constant instead of a variable. We can use <span class="code">let</span>
 because each time <span class="code">tableView(_:cellForRowAt:)</span>
 is called, a new <span class="code">birthday</span>
 constant is created. Each cell gets its own <span class="code">birthday</span>
 constant that is assigned its own <span class="code">Birthday</span>
 object. Since we’re not going to change any of the <span class="code">birthday</span>
 constants—we’re just going to read their properties—we don’t want to make them variables.</p>
<p class="indent">Now that you have your cell and your birthday, it’s time to fill in the details. You need two labels for each cell to show the birthday person’s name and birthdate. You set the cell to the Subtitle style so that it has a Title label and a Subtitle label. Each cell will already contain these labels, so now you don’t have to create any labels yourself.</p>
<p class="indent">The labels exist as properties of <span class="code">UITableViewCell</span>
 and are called <span class="code">textLabel</span>
 and <span class="code">detailTextLabel</span>
 . The code at <span class="ent">➌</span>
 sets the text of the <span class="code">textLabel</span>
 to a string made up of the <span class="code">firstName</span>
 and <span class="code">lastName</span>
 of the <span class="code">birthday</span>
 with a space between them. At <span class="ent">➍</span>
 , you use the <span class="code">string(from:)</span>
 method of the <span class="code">dateFormatter</span>
 to display the birthdate in the <span class="code">detailTextLabel</span>
 .</p>
<p class="indent">When your cell is completely configured, <span class="code">tableView( _:cellForRowAt:)</span>
 returns the cell at <span class="ent">➎</span>
 so that it can be displayed at that <span class="code">indexPath</span>
 of the table view.</p>
<h3 class="h3" id="ch11lev1sec2">
<strong>PUTTING IT ALL TOGETHER</strong>
</h3>
<p class="noindent">Now you can add <span class="code">Birthday</span>
 instances to the app using the Add Birthday view controller, and you have a table view to list each <span class="code">Birthday</span>
 in the Birthdays table view controller. But when you try running the app and adding a <span class="code">Birthday</span>
 , it doesn’t appear. To make each <span class="code">Birthday</span>
 you add appear in the table view, you need to make the Add Birthday view controller communicate with the Birthdays table view controller. You do this by using <em>delegation</em>
 .</p>
<h4 class="h4" id="ch11lev2sec5">
<strong>DELEGATION</strong>
</h4>
<p class="noindent">Delegation can be used when one view controller needs to get information from another view controller. Say you have two view controllers: A and B. The first view controller, A, creates B and presents B on top of itself. A knows about B because it created and presented B, so A can pass information along to B. But B doesn’t know about A—it’s just popped into being and doesn’t know where it came from or how it got there. So how can B talk to A? Through delegation!</p>
<div class="image"><img src="Image00245.jpg" />
</div>
<p class="indent">Delegation is when someone gives a job or a task to someone else. A <em>delegate</em>
 is like a boss who tells a delegating employee what to do. When the delegating employee is done with their task, sometimes they’ll report information back to the delegate boss.</p>
<p class="indent"><span id="page_167"></span>
 Delegation in Swift is pretty similar, but instead of having a boss and employee, we have a delegate and a delegating object. Since class B is the one being told what to do by class A, it’s the delegating object. We give class B a special property called a delegate to tell it who its delegate is—that way, it knows who to communicate with. The delegate can be any class that has a set of methods that have been defined in a <em>protocol</em>
 . A protocol is like an agreement between the two classes that tells them what the delegate can ask the delegating object to do. It has a list of method and property names that the delegate can use with the delegating object.</p>
<p class="indent">Class A creates class B, makes itself the delegate of class B, and gives class B a job to do that’s in the protocol. Once class B is done with its job, it reports back to class A. Let’s see how this works in our app.</p>
<p class="indent">The Birthdays table view controller is view controller A, and the Add Birthday view controller is view controller B. We’ll create a protocol called <span class="code">AddBirthdayViewControllerDelegate</span>
 and a method for that protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 , which the Add Birthday view controller will use to report back.</p>
<p class="indent">Take a look at <a href="text00022.html#ch11fig6">Figure 11-6</a>
 . When the user taps the Add button <span class="ent">➊</span>
 , the Birthdays table view controller creates the Add Birthday view controller <span class="ent">➋</span>
 and sets itself as the Add Birthday view controller’s delegate.</p>
<div class="image"><img src="Image00246.jpg" />
</div>
<p class="figcap"><a id="ch11fig6"></a>
 <em>Figure 11-6: A new birthday is added and passed from the Add Birthday view controller to the Birthdays table view controller using delegation.</em>
</p>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="indent">Each section and row of a table view is identified with an index number. These numbers start at 0 and then increase by 1 as you go down the table view. For example, the Privacy line in the Settings app is found at section 0, row 1. The News setting is at section 1, row 3.</p>
<p class="indent">In the middle of the <span class="code">BirthdaysTableViewController</span>
 class, there is a section called <em>Table view data source</em>
 with three methods. The table view controller uses these methods to determine what’s going to be displayed inside its table view.</p>
<p class="hang">
<span class="code">
<span class="codestrong">numberOfSections(in:)</span>
</span>
 Tells the table view how many sections it should have</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:numberOfRowsInSection:)</span>
</span>
 Tells the table view how many rows will be displayed in each section</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:cellForRowAt:)</span>
</span>
 Sets up each cell that’s going to be displayed in each row of the table view</p>
<div class="image"><span id="page_163"></span>
 <img src="Image00243.jpg" />
</div>
<p class="figcap"><a id="ch11fig5"></a>
 <em>Figure 11-5: The Settings app uses sections to group rows of different device settings.</em>
</p>
<p class="indent">The table view data source methods are called by the table view controller every time the table view is reloaded. Xcode automatically gives you these method templates when you make a subclass of a <span class="code">UITableViewController</span>
 . You need to implement all three methods for the app to work, even though you’ll never call them directly in your code. The <span class="code">UITableViewController</span>
 class implements the <span class="code">UITableViewDataSource</span>
 protocol, which comes with these data source methods, to determine what will be displayed inside the table view. We’ll discuss protocols in “<a href="text00022.html#ch11lev2sec5">Delegation</a>
 ” on page 166. For now, you just need to know that a <span class="code">UITableViewController</span>
 uses these methods to display its content, and it automatically calls these methods so you don’t need to call them.</p>
<p class="indent">Let’s start with the method <span class="code">numberOfSections(in:)</span>
 . The Birthdays table view controller is a list that just displays <span class="code">Birthday</span>
 instances, so it doesn’t need multiple sections. To set the number of sections in the table view, we just need to return <span class="code">1</span>
 .</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func numberOfSections(in tableView: UITableView) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 <span class="blue1">1</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent"><span id="page_164"></span>
 This method takes a <span class="code">UITableView</span>
 called <span class="code">tableView</span>
 as a parameter, which is the table view that uses this class as its data source. We don’t need to worry about making this connection because the <span class="code">UITableViewController</span>
 comes with a built-in table view that is automatically hooked up to these methods. Each birthday will be displayed in its own row. So in <span class="code">tableView(_:numberOfRowsInSection:)</span>
 , in order to have the right number of rows for all of your birthdays, you need to return the number of <span class="code">Birthday</span>
 instances that you have in your <span class="code">birthdays</span>
 array. Do you remember the <span class="code">count</span>
 property of an array? It’s an integer that tells you how many items are in that array, and it’s perfect for this situation! Change this method to the following:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, <img class="inline" src="Image00184.jpg" />
<br />
    numberOfRowsInSection section: Int) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 birthdays.<span class="violet">count</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">In addition to the <span class="code">tableView</span>
 parameter, <span class="code">tableView(_:numberOfRowsInSection:)</span>
 also takes an <span class="code">Int</span>
 called <span class="code">section</span>
 . When the table view is loading itself, this method is called for each section in the table view. In our case, we have only one section, so we don’t need to bother checking which <span class="code">section</span>
 of the table view is being displayed here. We know it’s section 0, and we want it to have as many rows as there are birthdays, so we write <span class="code">return birthdays.count</span>
 .</p>
<p class="indent">Finally, you need to implement <span class="code">tableView(_:cellForRowAt:)</span>
 so that the table view will know what to put inside each cell. Since this method is commented out, you need to uncomment it by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it. (Be careful not to accidentally uncomment the other methods after it!) After you’ve done that, change it to the following code:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, cellForRowAt <img class="inline" src="Image00184.jpg" />
<br />
    indexPath: IndexPath) -&gt; UITableViewCell {</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="pink">let</span>
 cell = tableView.<span class="blue">dequeueReusableCell</span>
 (withIdentifier: <img class="inline" src="Image00093.jpg" />
<br />
        <span class="red">"birthdayCellIdentifier"</span>
 , for: indexPath)<br />
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 birthday = <span class="green1">birthdays</span>
 [indexPath.<span class="violet">row</span>
 ]<br />
<br />
  <span class="ent">➌</span>
 cell.<span class="violet">textLabel</span>
 ?.<span class="violet">text</span>
 = birthday.<span class="green1">firstName</span>
 <span class="blue">+</span>
 <span class="red">" "</span>
 <span class="blue">+</span>
 <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">lastName</span>
<br />
<br />
  <span class="ent">➍</span>
 cell.<span class="violet">detailTextLabel</span>
 ?.<span class="violet">text</span>
 = <span class="green1">dateFormatter</span>
 .<span class="blue">string</span>
 (from: <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">birthdate</span>
 )<br />
<br />
  <span class="ent">➎</span>
 <span class="pink">return</span>
 cell<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">You don’t call the method <span class="code">tableView(_:cellForRowAt:)</span>
 . It’s called when the table view is loaded onto the screen. It’s called for each cell on the screen and takes two parameters, <span class="code">tableView</span>
 and <span class="code">indexPath</span>
 . You already know <span id="page_165"></span>
 what the <span class="code">tableView</span>
 parameter is for. An <span class="code">IndexPath</span>
 is a Swift struct that’s used to represent a row’s position in a table view. An <span class="code">IndexPath</span>
 instance has a <span class="code">section</span>
 property and a <span class="code">row</span>
 property. Since this method will be called many times (once for every row in the table), we need the <span class="code">indexPath</span>
 to know which section and row we’re currently configuring. The <span class="code">indexPath.section</span>
 property gives the section number, and the <span class="code">indexPath.row</span>
 gives the row of the table view cell. The five lines of code inside <span class="code">tableView(_:cellForRowAt:)</span>
 will do the following:</p>
<div class="image"><img src="Image00244.jpg" />
</div>
<p class="bull">• Create a <span class="code">UITableViewCell</span>
</p>
<p class="bull">• Figure out which <span class="code">Birthday</span>
 in the <span class="code">birthdays</span>
 array will be displayed inside the cell</p>
<p class="bull">• Make two labels to display the birthday person’s name and birthdate in the cell</p>
<p class="bull">• Return the cell ready for display in the table view</p>
<p class="indentt">Let’s go through this code line by line.</p>
<p class="indent">First, create the <span class="code">UITableViewCell</span>
 . The code at <span class="ent">➊</span>
 does this using the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 . Before you can start using this method on a cell, though, you need to tell the method which cell you want to use from the storyboard. Earlier, when you were in the storyboard, you gave your cell the identifier <span class="code">birthdayCellIdentifier</span>
 (see <a href="text00022.html#ch11fig4">Figure 11-4</a>
 ). This identifier links your code to the cell and tells your method that it’s using the right cell. The string for when you call this method needs to be exactly the same as the string you set in the storyboard, or you’ll get an error and the app will crash when you run it.</p>
<p class="indent">In the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 , did you notice the words <em>Reusable Cell</em>
 ? The cells inside a table view are created once and then can be reused over and over. This helps everything run faster and smoother because creating the cell is what takes the most time. If you had 200 birthdays in your app, but only 10 would fit on your screen at one time, then you need only 10 cells to show your birthdays. When you scroll down to reveal more birthdays, the cells that scroll off the top of the screen are reused. They are filled with new information and show up again at the bottom of the screen. The <span class="code">UITableView</span>
 automatically does this work. When the table view is loaded, <span class="code">tableView(_:cellForRowAt:)</span>
 is called for every visible row. When the user scrolls to look at more cells, it’s called again for each row just as it is about to appear on the screen.</p>
<p class="indent">Next, we need to find out which <span class="code">Birthday</span>
 should be displayed inside the cell. We want to display one birthday from the <span class="code">birthdays</span>
 array in each row. The first birthday, which is at <span class="code">birthdays[0]</span>
 , should be displayed in row 0. The second birthday, at <span class="code">birthdays[1]</span>
 , should be displayed in row 1, and so on, which means the <span class="code">indexPath</span>
 ’s <span class="code">row</span>
 is the same as the position in the <span class="code">birthdays</span>
 array that we want to access. The code at <span class="ent">➋</span>
 accesses the <span id="page_166"></span>
 correct <span class="code">Birthday</span>
 object from the <span class="code">birthdays</span>
 array by using <span class="code">indexPath.row</span>
 . Once we have the right <span class="code">Birthday</span>
 object, we assign it to a constant named <span class="code">birthday</span>
 so we can set up the labels in this cell.</p>
<p class="indent">Notice that we’re using <span class="code">let</span>
 to assign the <span class="code">birthday</span>
 to a constant instead of a variable. We can use <span class="code">let</span>
 because each time <span class="code">tableView(_:cellForRowAt:)</span>
 is called, a new <span class="code">birthday</span>
 constant is created. Each cell gets its own <span class="code">birthday</span>
 constant that is assigned its own <span class="code">Birthday</span>
 object. Since we’re not going to change any of the <span class="code">birthday</span>
 constants—we’re just going to read their properties—we don’t want to make them variables.</p>
<p class="indent">Now that you have your cell and your birthday, it’s time to fill in the details. You need two labels for each cell to show the birthday person’s name and birthdate. You set the cell to the Subtitle style so that it has a Title label and a Subtitle label. Each cell will already contain these labels, so now you don’t have to create any labels yourself.</p>
<p class="indent">The labels exist as properties of <span class="code">UITableViewCell</span>
 and are called <span class="code">textLabel</span>
 and <span class="code">detailTextLabel</span>
 . The code at <span class="ent">➌</span>
 sets the text of the <span class="code">textLabel</span>
 to a string made up of the <span class="code">firstName</span>
 and <span class="code">lastName</span>
 of the <span class="code">birthday</span>
 with a space between them. At <span class="ent">➍</span>
 , you use the <span class="code">string(from:)</span>
 method of the <span class="code">dateFormatter</span>
 to display the birthdate in the <span class="code">detailTextLabel</span>
 .</p>
<p class="indent">When your cell is completely configured, <span class="code">tableView( _:cellForRowAt:)</span>
 returns the cell at <span class="ent">➎</span>
 so that it can be displayed at that <span class="code">indexPath</span>
 of the table view.</p>
<h3 class="h3" id="ch11lev1sec2">
<strong>PUTTING IT ALL TOGETHER</strong>
</h3>
<p class="noindent">Now you can add <span class="code">Birthday</span>
 instances to the app using the Add Birthday view controller, and you have a table view to list each <span class="code">Birthday</span>
 in the Birthdays table view controller. But when you try running the app and adding a <span class="code">Birthday</span>
 , it doesn’t appear. To make each <span class="code">Birthday</span>
 you add appear in the table view, you need to make the Add Birthday view controller communicate with the Birthdays table view controller. You do this by using <em>delegation</em>
 .</p>
<h4 class="h4" id="ch11lev2sec5">
<strong>DELEGATION</strong>
</h4>
<p class="noindent">Delegation can be used when one view controller needs to get information from another view controller. Say you have two view controllers: A and B. The first view controller, A, creates B and presents B on top of itself. A knows about B because it created and presented B, so A can pass information along to B. But B doesn’t know about A—it’s just popped into being and doesn’t know where it came from or how it got there. So how can B talk to A? Through delegation!</p>
<div class="image"><img src="Image00245.jpg" />
</div>
<p class="indent">Delegation is when someone gives a job or a task to someone else. A <em>delegate</em>
 is like a boss who tells a delegating employee what to do. When the delegating employee is done with their task, sometimes they’ll report information back to the delegate boss.</p>
<p class="indent"><span id="page_167"></span>
 Delegation in Swift is pretty similar, but instead of having a boss and employee, we have a delegate and a delegating object. Since class B is the one being told what to do by class A, it’s the delegating object. We give class B a special property called a delegate to tell it who its delegate is—that way, it knows who to communicate with. The delegate can be any class that has a set of methods that have been defined in a <em>protocol</em>
 . A protocol is like an agreement between the two classes that tells them what the delegate can ask the delegating object to do. It has a list of method and property names that the delegate can use with the delegating object.</p>
<p class="indent">Class A creates class B, makes itself the delegate of class B, and gives class B a job to do that’s in the protocol. Once class B is done with its job, it reports back to class A. Let’s see how this works in our app.</p>
<p class="indent">The Birthdays table view controller is view controller A, and the Add Birthday view controller is view controller B. We’ll create a protocol called <span class="code">AddBirthdayViewControllerDelegate</span>
 and a method for that protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 , which the Add Birthday view controller will use to report back.</p>
<p class="indent">Take a look at <a href="text00022.html#ch11fig6">Figure 11-6</a>
 . When the user taps the Add button <span class="ent">➊</span>
 , the Birthdays table view controller creates the Add Birthday view controller <span class="ent">➋</span>
 and sets itself as the Add Birthday view controller’s delegate.</p>
<div class="image"><img src="Image00246.jpg" />
</div>
<p class="figcap"><a id="ch11fig6"></a>
 <em>Figure 11-6: A new birthday is added and passed from the Add Birthday view controller to the Birthdays table view controller using delegation.</em>
</p>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="indent">In the middle of the <span class="code">BirthdaysTableViewController</span>
 class, there is a section called <em>Table view data source</em>
 with three methods. The table view controller uses these methods to determine what’s going to be displayed inside its table view.</p>
<p class="hang">
<span class="code">
<span class="codestrong">numberOfSections(in:)</span>
</span>
 Tells the table view how many sections it should have</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:numberOfRowsInSection:)</span>
</span>
 Tells the table view how many rows will be displayed in each section</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:cellForRowAt:)</span>
</span>
 Sets up each cell that’s going to be displayed in each row of the table view</p>
<div class="image"><span id="page_163"></span>
 <img src="Image00243.jpg" />
</div>
<p class="figcap"><a id="ch11fig5"></a>
 <em>Figure 11-5: The Settings app uses sections to group rows of different device settings.</em>
</p>
<p class="indent">The table view data source methods are called by the table view controller every time the table view is reloaded. Xcode automatically gives you these method templates when you make a subclass of a <span class="code">UITableViewController</span>
 . You need to implement all three methods for the app to work, even though you’ll never call them directly in your code. The <span class="code">UITableViewController</span>
 class implements the <span class="code">UITableViewDataSource</span>
 protocol, which comes with these data source methods, to determine what will be displayed inside the table view. We’ll discuss protocols in “<a href="text00022.html#ch11lev2sec5">Delegation</a>
 ” on page 166. For now, you just need to know that a <span class="code">UITableViewController</span>
 uses these methods to display its content, and it automatically calls these methods so you don’t need to call them.</p>
<p class="indent">Let’s start with the method <span class="code">numberOfSections(in:)</span>
 . The Birthdays table view controller is a list that just displays <span class="code">Birthday</span>
 instances, so it doesn’t need multiple sections. To set the number of sections in the table view, we just need to return <span class="code">1</span>
 .</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func numberOfSections(in tableView: UITableView) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 <span class="blue1">1</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent"><span id="page_164"></span>
 This method takes a <span class="code">UITableView</span>
 called <span class="code">tableView</span>
 as a parameter, which is the table view that uses this class as its data source. We don’t need to worry about making this connection because the <span class="code">UITableViewController</span>
 comes with a built-in table view that is automatically hooked up to these methods. Each birthday will be displayed in its own row. So in <span class="code">tableView(_:numberOfRowsInSection:)</span>
 , in order to have the right number of rows for all of your birthdays, you need to return the number of <span class="code">Birthday</span>
 instances that you have in your <span class="code">birthdays</span>
 array. Do you remember the <span class="code">count</span>
 property of an array? It’s an integer that tells you how many items are in that array, and it’s perfect for this situation! Change this method to the following:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, <img class="inline" src="Image00184.jpg" />
<br />
    numberOfRowsInSection section: Int) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 birthdays.<span class="violet">count</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">In addition to the <span class="code">tableView</span>
 parameter, <span class="code">tableView(_:numberOfRowsInSection:)</span>
 also takes an <span class="code">Int</span>
 called <span class="code">section</span>
 . When the table view is loading itself, this method is called for each section in the table view. In our case, we have only one section, so we don’t need to bother checking which <span class="code">section</span>
 of the table view is being displayed here. We know it’s section 0, and we want it to have as many rows as there are birthdays, so we write <span class="code">return birthdays.count</span>
 .</p>
<p class="indent">Finally, you need to implement <span class="code">tableView(_:cellForRowAt:)</span>
 so that the table view will know what to put inside each cell. Since this method is commented out, you need to uncomment it by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it. (Be careful not to accidentally uncomment the other methods after it!) After you’ve done that, change it to the following code:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, cellForRowAt <img class="inline" src="Image00184.jpg" />
<br />
    indexPath: IndexPath) -&gt; UITableViewCell {</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="pink">let</span>
 cell = tableView.<span class="blue">dequeueReusableCell</span>
 (withIdentifier: <img class="inline" src="Image00093.jpg" />
<br />
        <span class="red">"birthdayCellIdentifier"</span>
 , for: indexPath)<br />
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 birthday = <span class="green1">birthdays</span>
 [indexPath.<span class="violet">row</span>
 ]<br />
<br />
  <span class="ent">➌</span>
 cell.<span class="violet">textLabel</span>
 ?.<span class="violet">text</span>
 = birthday.<span class="green1">firstName</span>
 <span class="blue">+</span>
 <span class="red">" "</span>
 <span class="blue">+</span>
 <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">lastName</span>
<br />
<br />
  <span class="ent">➍</span>
 cell.<span class="violet">detailTextLabel</span>
 ?.<span class="violet">text</span>
 = <span class="green1">dateFormatter</span>
 .<span class="blue">string</span>
 (from: <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">birthdate</span>
 )<br />
<br />
  <span class="ent">➎</span>
 <span class="pink">return</span>
 cell<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">You don’t call the method <span class="code">tableView(_:cellForRowAt:)</span>
 . It’s called when the table view is loaded onto the screen. It’s called for each cell on the screen and takes two parameters, <span class="code">tableView</span>
 and <span class="code">indexPath</span>
 . You already know <span id="page_165"></span>
 what the <span class="code">tableView</span>
 parameter is for. An <span class="code">IndexPath</span>
 is a Swift struct that’s used to represent a row’s position in a table view. An <span class="code">IndexPath</span>
 instance has a <span class="code">section</span>
 property and a <span class="code">row</span>
 property. Since this method will be called many times (once for every row in the table), we need the <span class="code">indexPath</span>
 to know which section and row we’re currently configuring. The <span class="code">indexPath.section</span>
 property gives the section number, and the <span class="code">indexPath.row</span>
 gives the row of the table view cell. The five lines of code inside <span class="code">tableView(_:cellForRowAt:)</span>
 will do the following:</p>
<div class="image"><img src="Image00244.jpg" />
</div>
<p class="bull">• Create a <span class="code">UITableViewCell</span>
</p>
<p class="bull">• Figure out which <span class="code">Birthday</span>
 in the <span class="code">birthdays</span>
 array will be displayed inside the cell</p>
<p class="bull">• Make two labels to display the birthday person’s name and birthdate in the cell</p>
<p class="bull">• Return the cell ready for display in the table view</p>
<p class="indentt">Let’s go through this code line by line.</p>
<p class="indent">First, create the <span class="code">UITableViewCell</span>
 . The code at <span class="ent">➊</span>
 does this using the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 . Before you can start using this method on a cell, though, you need to tell the method which cell you want to use from the storyboard. Earlier, when you were in the storyboard, you gave your cell the identifier <span class="code">birthdayCellIdentifier</span>
 (see <a href="text00022.html#ch11fig4">Figure 11-4</a>
 ). This identifier links your code to the cell and tells your method that it’s using the right cell. The string for when you call this method needs to be exactly the same as the string you set in the storyboard, or you’ll get an error and the app will crash when you run it.</p>
<p class="indent">In the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 , did you notice the words <em>Reusable Cell</em>
 ? The cells inside a table view are created once and then can be reused over and over. This helps everything run faster and smoother because creating the cell is what takes the most time. If you had 200 birthdays in your app, but only 10 would fit on your screen at one time, then you need only 10 cells to show your birthdays. When you scroll down to reveal more birthdays, the cells that scroll off the top of the screen are reused. They are filled with new information and show up again at the bottom of the screen. The <span class="code">UITableView</span>
 automatically does this work. When the table view is loaded, <span class="code">tableView(_:cellForRowAt:)</span>
 is called for every visible row. When the user scrolls to look at more cells, it’s called again for each row just as it is about to appear on the screen.</p>
<p class="indent">Next, we need to find out which <span class="code">Birthday</span>
 should be displayed inside the cell. We want to display one birthday from the <span class="code">birthdays</span>
 array in each row. The first birthday, which is at <span class="code">birthdays[0]</span>
 , should be displayed in row 0. The second birthday, at <span class="code">birthdays[1]</span>
 , should be displayed in row 1, and so on, which means the <span class="code">indexPath</span>
 ’s <span class="code">row</span>
 is the same as the position in the <span class="code">birthdays</span>
 array that we want to access. The code at <span class="ent">➋</span>
 accesses the <span id="page_166"></span>
 correct <span class="code">Birthday</span>
 object from the <span class="code">birthdays</span>
 array by using <span class="code">indexPath.row</span>
 . Once we have the right <span class="code">Birthday</span>
 object, we assign it to a constant named <span class="code">birthday</span>
 so we can set up the labels in this cell.</p>
<p class="indent">Notice that we’re using <span class="code">let</span>
 to assign the <span class="code">birthday</span>
 to a constant instead of a variable. We can use <span class="code">let</span>
 because each time <span class="code">tableView(_:cellForRowAt:)</span>
 is called, a new <span class="code">birthday</span>
 constant is created. Each cell gets its own <span class="code">birthday</span>
 constant that is assigned its own <span class="code">Birthday</span>
 object. Since we’re not going to change any of the <span class="code">birthday</span>
 constants—we’re just going to read their properties—we don’t want to make them variables.</p>
<p class="indent">Now that you have your cell and your birthday, it’s time to fill in the details. You need two labels for each cell to show the birthday person’s name and birthdate. You set the cell to the Subtitle style so that it has a Title label and a Subtitle label. Each cell will already contain these labels, so now you don’t have to create any labels yourself.</p>
<p class="indent">The labels exist as properties of <span class="code">UITableViewCell</span>
 and are called <span class="code">textLabel</span>
 and <span class="code">detailTextLabel</span>
 . The code at <span class="ent">➌</span>
 sets the text of the <span class="code">textLabel</span>
 to a string made up of the <span class="code">firstName</span>
 and <span class="code">lastName</span>
 of the <span class="code">birthday</span>
 with a space between them. At <span class="ent">➍</span>
 , you use the <span class="code">string(from:)</span>
 method of the <span class="code">dateFormatter</span>
 to display the birthdate in the <span class="code">detailTextLabel</span>
 .</p>
<p class="indent">When your cell is completely configured, <span class="code">tableView( _:cellForRowAt:)</span>
 returns the cell at <span class="ent">➎</span>
 so that it can be displayed at that <span class="code">indexPath</span>
 of the table view.</p>
<h3 class="h3" id="ch11lev1sec2">
<strong>PUTTING IT ALL TOGETHER</strong>
</h3>
<p class="noindent">Now you can add <span class="code">Birthday</span>
 instances to the app using the Add Birthday view controller, and you have a table view to list each <span class="code">Birthday</span>
 in the Birthdays table view controller. But when you try running the app and adding a <span class="code">Birthday</span>
 , it doesn’t appear. To make each <span class="code">Birthday</span>
 you add appear in the table view, you need to make the Add Birthday view controller communicate with the Birthdays table view controller. You do this by using <em>delegation</em>
 .</p>
<h4 class="h4" id="ch11lev2sec5">
<strong>DELEGATION</strong>
</h4>
<p class="noindent">Delegation can be used when one view controller needs to get information from another view controller. Say you have two view controllers: A and B. The first view controller, A, creates B and presents B on top of itself. A knows about B because it created and presented B, so A can pass information along to B. But B doesn’t know about A—it’s just popped into being and doesn’t know where it came from or how it got there. So how can B talk to A? Through delegation!</p>
<div class="image"><img src="Image00245.jpg" />
</div>
<p class="indent">Delegation is when someone gives a job or a task to someone else. A <em>delegate</em>
 is like a boss who tells a delegating employee what to do. When the delegating employee is done with their task, sometimes they’ll report information back to the delegate boss.</p>
<p class="indent"><span id="page_167"></span>
 Delegation in Swift is pretty similar, but instead of having a boss and employee, we have a delegate and a delegating object. Since class B is the one being told what to do by class A, it’s the delegating object. We give class B a special property called a delegate to tell it who its delegate is—that way, it knows who to communicate with. The delegate can be any class that has a set of methods that have been defined in a <em>protocol</em>
 . A protocol is like an agreement between the two classes that tells them what the delegate can ask the delegating object to do. It has a list of method and property names that the delegate can use with the delegating object.</p>
<p class="indent">Class A creates class B, makes itself the delegate of class B, and gives class B a job to do that’s in the protocol. Once class B is done with its job, it reports back to class A. Let’s see how this works in our app.</p>
<p class="indent">The Birthdays table view controller is view controller A, and the Add Birthday view controller is view controller B. We’ll create a protocol called <span class="code">AddBirthdayViewControllerDelegate</span>
 and a method for that protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 , which the Add Birthday view controller will use to report back.</p>
<p class="indent">Take a look at <a href="text00022.html#ch11fig6">Figure 11-6</a>
 . When the user taps the Add button <span class="ent">➊</span>
 , the Birthdays table view controller creates the Add Birthday view controller <span class="ent">➋</span>
 and sets itself as the Add Birthday view controller’s delegate.</p>
<div class="image"><img src="Image00246.jpg" />
</div>
<p class="figcap"><a id="ch11fig6"></a>
 <em>Figure 11-6: A new birthday is added and passed from the Add Birthday view controller to the Birthdays table view controller using delegation.</em>
</p>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="hang">
<span class="code">
<span class="codestrong">numberOfSections(in:)</span>
</span>
 Tells the table view how many sections it should have</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:numberOfRowsInSection:)</span>
</span>
 Tells the table view how many rows will be displayed in each section</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:cellForRowAt:)</span>
</span>
 Sets up each cell that’s going to be displayed in each row of the table view</p>
<div class="image"><span id="page_163"></span>
 <img src="Image00243.jpg" />
</div>
<p class="figcap"><a id="ch11fig5"></a>
 <em>Figure 11-5: The Settings app uses sections to group rows of different device settings.</em>
</p>
<p class="indent">The table view data source methods are called by the table view controller every time the table view is reloaded. Xcode automatically gives you these method templates when you make a subclass of a <span class="code">UITableViewController</span>
 . You need to implement all three methods for the app to work, even though you’ll never call them directly in your code. The <span class="code">UITableViewController</span>
 class implements the <span class="code">UITableViewDataSource</span>
 protocol, which comes with these data source methods, to determine what will be displayed inside the table view. We’ll discuss protocols in “<a href="text00022.html#ch11lev2sec5">Delegation</a>
 ” on page 166. For now, you just need to know that a <span class="code">UITableViewController</span>
 uses these methods to display its content, and it automatically calls these methods so you don’t need to call them.</p>
<p class="indent">Let’s start with the method <span class="code">numberOfSections(in:)</span>
 . The Birthdays table view controller is a list that just displays <span class="code">Birthday</span>
 instances, so it doesn’t need multiple sections. To set the number of sections in the table view, we just need to return <span class="code">1</span>
 .</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func numberOfSections(in tableView: UITableView) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 <span class="blue1">1</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent"><span id="page_164"></span>
 This method takes a <span class="code">UITableView</span>
 called <span class="code">tableView</span>
 as a parameter, which is the table view that uses this class as its data source. We don’t need to worry about making this connection because the <span class="code">UITableViewController</span>
 comes with a built-in table view that is automatically hooked up to these methods. Each birthday will be displayed in its own row. So in <span class="code">tableView(_:numberOfRowsInSection:)</span>
 , in order to have the right number of rows for all of your birthdays, you need to return the number of <span class="code">Birthday</span>
 instances that you have in your <span class="code">birthdays</span>
 array. Do you remember the <span class="code">count</span>
 property of an array? It’s an integer that tells you how many items are in that array, and it’s perfect for this situation! Change this method to the following:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, <img class="inline" src="Image00184.jpg" />
<br />
    numberOfRowsInSection section: Int) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 birthdays.<span class="violet">count</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">In addition to the <span class="code">tableView</span>
 parameter, <span class="code">tableView(_:numberOfRowsInSection:)</span>
 also takes an <span class="code">Int</span>
 called <span class="code">section</span>
 . When the table view is loading itself, this method is called for each section in the table view. In our case, we have only one section, so we don’t need to bother checking which <span class="code">section</span>
 of the table view is being displayed here. We know it’s section 0, and we want it to have as many rows as there are birthdays, so we write <span class="code">return birthdays.count</span>
 .</p>
<p class="indent">Finally, you need to implement <span class="code">tableView(_:cellForRowAt:)</span>
 so that the table view will know what to put inside each cell. Since this method is commented out, you need to uncomment it by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it. (Be careful not to accidentally uncomment the other methods after it!) After you’ve done that, change it to the following code:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, cellForRowAt <img class="inline" src="Image00184.jpg" />
<br />
    indexPath: IndexPath) -&gt; UITableViewCell {</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="pink">let</span>
 cell = tableView.<span class="blue">dequeueReusableCell</span>
 (withIdentifier: <img class="inline" src="Image00093.jpg" />
<br />
        <span class="red">"birthdayCellIdentifier"</span>
 , for: indexPath)<br />
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 birthday = <span class="green1">birthdays</span>
 [indexPath.<span class="violet">row</span>
 ]<br />
<br />
  <span class="ent">➌</span>
 cell.<span class="violet">textLabel</span>
 ?.<span class="violet">text</span>
 = birthday.<span class="green1">firstName</span>
 <span class="blue">+</span>
 <span class="red">" "</span>
 <span class="blue">+</span>
 <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">lastName</span>
<br />
<br />
  <span class="ent">➍</span>
 cell.<span class="violet">detailTextLabel</span>
 ?.<span class="violet">text</span>
 = <span class="green1">dateFormatter</span>
 .<span class="blue">string</span>
 (from: <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">birthdate</span>
 )<br />
<br />
  <span class="ent">➎</span>
 <span class="pink">return</span>
 cell<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">You don’t call the method <span class="code">tableView(_:cellForRowAt:)</span>
 . It’s called when the table view is loaded onto the screen. It’s called for each cell on the screen and takes two parameters, <span class="code">tableView</span>
 and <span class="code">indexPath</span>
 . You already know <span id="page_165"></span>
 what the <span class="code">tableView</span>
 parameter is for. An <span class="code">IndexPath</span>
 is a Swift struct that’s used to represent a row’s position in a table view. An <span class="code">IndexPath</span>
 instance has a <span class="code">section</span>
 property and a <span class="code">row</span>
 property. Since this method will be called many times (once for every row in the table), we need the <span class="code">indexPath</span>
 to know which section and row we’re currently configuring. The <span class="code">indexPath.section</span>
 property gives the section number, and the <span class="code">indexPath.row</span>
 gives the row of the table view cell. The five lines of code inside <span class="code">tableView(_:cellForRowAt:)</span>
 will do the following:</p>
<div class="image"><img src="Image00244.jpg" />
</div>
<p class="bull">• Create a <span class="code">UITableViewCell</span>
</p>
<p class="bull">• Figure out which <span class="code">Birthday</span>
 in the <span class="code">birthdays</span>
 array will be displayed inside the cell</p>
<p class="bull">• Make two labels to display the birthday person’s name and birthdate in the cell</p>
<p class="bull">• Return the cell ready for display in the table view</p>
<p class="indentt">Let’s go through this code line by line.</p>
<p class="indent">First, create the <span class="code">UITableViewCell</span>
 . The code at <span class="ent">➊</span>
 does this using the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 . Before you can start using this method on a cell, though, you need to tell the method which cell you want to use from the storyboard. Earlier, when you were in the storyboard, you gave your cell the identifier <span class="code">birthdayCellIdentifier</span>
 (see <a href="text00022.html#ch11fig4">Figure 11-4</a>
 ). This identifier links your code to the cell and tells your method that it’s using the right cell. The string for when you call this method needs to be exactly the same as the string you set in the storyboard, or you’ll get an error and the app will crash when you run it.</p>
<p class="indent">In the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 , did you notice the words <em>Reusable Cell</em>
 ? The cells inside a table view are created once and then can be reused over and over. This helps everything run faster and smoother because creating the cell is what takes the most time. If you had 200 birthdays in your app, but only 10 would fit on your screen at one time, then you need only 10 cells to show your birthdays. When you scroll down to reveal more birthdays, the cells that scroll off the top of the screen are reused. They are filled with new information and show up again at the bottom of the screen. The <span class="code">UITableView</span>
 automatically does this work. When the table view is loaded, <span class="code">tableView(_:cellForRowAt:)</span>
 is called for every visible row. When the user scrolls to look at more cells, it’s called again for each row just as it is about to appear on the screen.</p>
<p class="indent">Next, we need to find out which <span class="code">Birthday</span>
 should be displayed inside the cell. We want to display one birthday from the <span class="code">birthdays</span>
 array in each row. The first birthday, which is at <span class="code">birthdays[0]</span>
 , should be displayed in row 0. The second birthday, at <span class="code">birthdays[1]</span>
 , should be displayed in row 1, and so on, which means the <span class="code">indexPath</span>
 ’s <span class="code">row</span>
 is the same as the position in the <span class="code">birthdays</span>
 array that we want to access. The code at <span class="ent">➋</span>
 accesses the <span id="page_166"></span>
 correct <span class="code">Birthday</span>
 object from the <span class="code">birthdays</span>
 array by using <span class="code">indexPath.row</span>
 . Once we have the right <span class="code">Birthday</span>
 object, we assign it to a constant named <span class="code">birthday</span>
 so we can set up the labels in this cell.</p>
<p class="indent">Notice that we’re using <span class="code">let</span>
 to assign the <span class="code">birthday</span>
 to a constant instead of a variable. We can use <span class="code">let</span>
 because each time <span class="code">tableView(_:cellForRowAt:)</span>
 is called, a new <span class="code">birthday</span>
 constant is created. Each cell gets its own <span class="code">birthday</span>
 constant that is assigned its own <span class="code">Birthday</span>
 object. Since we’re not going to change any of the <span class="code">birthday</span>
 constants—we’re just going to read their properties—we don’t want to make them variables.</p>
<p class="indent">Now that you have your cell and your birthday, it’s time to fill in the details. You need two labels for each cell to show the birthday person’s name and birthdate. You set the cell to the Subtitle style so that it has a Title label and a Subtitle label. Each cell will already contain these labels, so now you don’t have to create any labels yourself.</p>
<p class="indent">The labels exist as properties of <span class="code">UITableViewCell</span>
 and are called <span class="code">textLabel</span>
 and <span class="code">detailTextLabel</span>
 . The code at <span class="ent">➌</span>
 sets the text of the <span class="code">textLabel</span>
 to a string made up of the <span class="code">firstName</span>
 and <span class="code">lastName</span>
 of the <span class="code">birthday</span>
 with a space between them. At <span class="ent">➍</span>
 , you use the <span class="code">string(from:)</span>
 method of the <span class="code">dateFormatter</span>
 to display the birthdate in the <span class="code">detailTextLabel</span>
 .</p>
<p class="indent">When your cell is completely configured, <span class="code">tableView( _:cellForRowAt:)</span>
 returns the cell at <span class="ent">➎</span>
 so that it can be displayed at that <span class="code">indexPath</span>
 of the table view.</p>
<h3 class="h3" id="ch11lev1sec2">
<strong>PUTTING IT ALL TOGETHER</strong>
</h3>
<p class="noindent">Now you can add <span class="code">Birthday</span>
 instances to the app using the Add Birthday view controller, and you have a table view to list each <span class="code">Birthday</span>
 in the Birthdays table view controller. But when you try running the app and adding a <span class="code">Birthday</span>
 , it doesn’t appear. To make each <span class="code">Birthday</span>
 you add appear in the table view, you need to make the Add Birthday view controller communicate with the Birthdays table view controller. You do this by using <em>delegation</em>
 .</p>
<h4 class="h4" id="ch11lev2sec5">
<strong>DELEGATION</strong>
</h4>
<p class="noindent">Delegation can be used when one view controller needs to get information from another view controller. Say you have two view controllers: A and B. The first view controller, A, creates B and presents B on top of itself. A knows about B because it created and presented B, so A can pass information along to B. But B doesn’t know about A—it’s just popped into being and doesn’t know where it came from or how it got there. So how can B talk to A? Through delegation!</p>
<div class="image"><img src="Image00245.jpg" />
</div>
<p class="indent">Delegation is when someone gives a job or a task to someone else. A <em>delegate</em>
 is like a boss who tells a delegating employee what to do. When the delegating employee is done with their task, sometimes they’ll report information back to the delegate boss.</p>
<p class="indent"><span id="page_167"></span>
 Delegation in Swift is pretty similar, but instead of having a boss and employee, we have a delegate and a delegating object. Since class B is the one being told what to do by class A, it’s the delegating object. We give class B a special property called a delegate to tell it who its delegate is—that way, it knows who to communicate with. The delegate can be any class that has a set of methods that have been defined in a <em>protocol</em>
 . A protocol is like an agreement between the two classes that tells them what the delegate can ask the delegating object to do. It has a list of method and property names that the delegate can use with the delegating object.</p>
<p class="indent">Class A creates class B, makes itself the delegate of class B, and gives class B a job to do that’s in the protocol. Once class B is done with its job, it reports back to class A. Let’s see how this works in our app.</p>
<p class="indent">The Birthdays table view controller is view controller A, and the Add Birthday view controller is view controller B. We’ll create a protocol called <span class="code">AddBirthdayViewControllerDelegate</span>
 and a method for that protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 , which the Add Birthday view controller will use to report back.</p>
<p class="indent">Take a look at <a href="text00022.html#ch11fig6">Figure 11-6</a>
 . When the user taps the Add button <span class="ent">➊</span>
 , the Birthdays table view controller creates the Add Birthday view controller <span class="ent">➋</span>
 and sets itself as the Add Birthday view controller’s delegate.</p>
<div class="image"><img src="Image00246.jpg" />
</div>
<p class="figcap"><a id="ch11fig6"></a>
 <em>Figure 11-6: A new birthday is added and passed from the Add Birthday view controller to the Birthdays table view controller using delegation.</em>
</p>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:numberOfRowsInSection:)</span>
</span>
 Tells the table view how many rows will be displayed in each section</p>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:cellForRowAt:)</span>
</span>
 Sets up each cell that’s going to be displayed in each row of the table view</p>
<div class="image"><span id="page_163"></span>
 <img src="Image00243.jpg" />
</div>
<p class="figcap"><a id="ch11fig5"></a>
 <em>Figure 11-5: The Settings app uses sections to group rows of different device settings.</em>
</p>
<p class="indent">The table view data source methods are called by the table view controller every time the table view is reloaded. Xcode automatically gives you these method templates when you make a subclass of a <span class="code">UITableViewController</span>
 . You need to implement all three methods for the app to work, even though you’ll never call them directly in your code. The <span class="code">UITableViewController</span>
 class implements the <span class="code">UITableViewDataSource</span>
 protocol, which comes with these data source methods, to determine what will be displayed inside the table view. We’ll discuss protocols in “<a href="text00022.html#ch11lev2sec5">Delegation</a>
 ” on page 166. For now, you just need to know that a <span class="code">UITableViewController</span>
 uses these methods to display its content, and it automatically calls these methods so you don’t need to call them.</p>
<p class="indent">Let’s start with the method <span class="code">numberOfSections(in:)</span>
 . The Birthdays table view controller is a list that just displays <span class="code">Birthday</span>
 instances, so it doesn’t need multiple sections. To set the number of sections in the table view, we just need to return <span class="code">1</span>
 .</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func numberOfSections(in tableView: UITableView) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 <span class="blue1">1</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent"><span id="page_164"></span>
 This method takes a <span class="code">UITableView</span>
 called <span class="code">tableView</span>
 as a parameter, which is the table view that uses this class as its data source. We don’t need to worry about making this connection because the <span class="code">UITableViewController</span>
 comes with a built-in table view that is automatically hooked up to these methods. Each birthday will be displayed in its own row. So in <span class="code">tableView(_:numberOfRowsInSection:)</span>
 , in order to have the right number of rows for all of your birthdays, you need to return the number of <span class="code">Birthday</span>
 instances that you have in your <span class="code">birthdays</span>
 array. Do you remember the <span class="code">count</span>
 property of an array? It’s an integer that tells you how many items are in that array, and it’s perfect for this situation! Change this method to the following:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, <img class="inline" src="Image00184.jpg" />
<br />
    numberOfRowsInSection section: Int) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 birthdays.<span class="violet">count</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">In addition to the <span class="code">tableView</span>
 parameter, <span class="code">tableView(_:numberOfRowsInSection:)</span>
 also takes an <span class="code">Int</span>
 called <span class="code">section</span>
 . When the table view is loading itself, this method is called for each section in the table view. In our case, we have only one section, so we don’t need to bother checking which <span class="code">section</span>
 of the table view is being displayed here. We know it’s section 0, and we want it to have as many rows as there are birthdays, so we write <span class="code">return birthdays.count</span>
 .</p>
<p class="indent">Finally, you need to implement <span class="code">tableView(_:cellForRowAt:)</span>
 so that the table view will know what to put inside each cell. Since this method is commented out, you need to uncomment it by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it. (Be careful not to accidentally uncomment the other methods after it!) After you’ve done that, change it to the following code:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, cellForRowAt <img class="inline" src="Image00184.jpg" />
<br />
    indexPath: IndexPath) -&gt; UITableViewCell {</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="pink">let</span>
 cell = tableView.<span class="blue">dequeueReusableCell</span>
 (withIdentifier: <img class="inline" src="Image00093.jpg" />
<br />
        <span class="red">"birthdayCellIdentifier"</span>
 , for: indexPath)<br />
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 birthday = <span class="green1">birthdays</span>
 [indexPath.<span class="violet">row</span>
 ]<br />
<br />
  <span class="ent">➌</span>
 cell.<span class="violet">textLabel</span>
 ?.<span class="violet">text</span>
 = birthday.<span class="green1">firstName</span>
 <span class="blue">+</span>
 <span class="red">" "</span>
 <span class="blue">+</span>
 <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">lastName</span>
<br />
<br />
  <span class="ent">➍</span>
 cell.<span class="violet">detailTextLabel</span>
 ?.<span class="violet">text</span>
 = <span class="green1">dateFormatter</span>
 .<span class="blue">string</span>
 (from: <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">birthdate</span>
 )<br />
<br />
  <span class="ent">➎</span>
 <span class="pink">return</span>
 cell<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">You don’t call the method <span class="code">tableView(_:cellForRowAt:)</span>
 . It’s called when the table view is loaded onto the screen. It’s called for each cell on the screen and takes two parameters, <span class="code">tableView</span>
 and <span class="code">indexPath</span>
 . You already know <span id="page_165"></span>
 what the <span class="code">tableView</span>
 parameter is for. An <span class="code">IndexPath</span>
 is a Swift struct that’s used to represent a row’s position in a table view. An <span class="code">IndexPath</span>
 instance has a <span class="code">section</span>
 property and a <span class="code">row</span>
 property. Since this method will be called many times (once for every row in the table), we need the <span class="code">indexPath</span>
 to know which section and row we’re currently configuring. The <span class="code">indexPath.section</span>
 property gives the section number, and the <span class="code">indexPath.row</span>
 gives the row of the table view cell. The five lines of code inside <span class="code">tableView(_:cellForRowAt:)</span>
 will do the following:</p>
<div class="image"><img src="Image00244.jpg" />
</div>
<p class="bull">• Create a <span class="code">UITableViewCell</span>
</p>
<p class="bull">• Figure out which <span class="code">Birthday</span>
 in the <span class="code">birthdays</span>
 array will be displayed inside the cell</p>
<p class="bull">• Make two labels to display the birthday person’s name and birthdate in the cell</p>
<p class="bull">• Return the cell ready for display in the table view</p>
<p class="indentt">Let’s go through this code line by line.</p>
<p class="indent">First, create the <span class="code">UITableViewCell</span>
 . The code at <span class="ent">➊</span>
 does this using the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 . Before you can start using this method on a cell, though, you need to tell the method which cell you want to use from the storyboard. Earlier, when you were in the storyboard, you gave your cell the identifier <span class="code">birthdayCellIdentifier</span>
 (see <a href="text00022.html#ch11fig4">Figure 11-4</a>
 ). This identifier links your code to the cell and tells your method that it’s using the right cell. The string for when you call this method needs to be exactly the same as the string you set in the storyboard, or you’ll get an error and the app will crash when you run it.</p>
<p class="indent">In the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 , did you notice the words <em>Reusable Cell</em>
 ? The cells inside a table view are created once and then can be reused over and over. This helps everything run faster and smoother because creating the cell is what takes the most time. If you had 200 birthdays in your app, but only 10 would fit on your screen at one time, then you need only 10 cells to show your birthdays. When you scroll down to reveal more birthdays, the cells that scroll off the top of the screen are reused. They are filled with new information and show up again at the bottom of the screen. The <span class="code">UITableView</span>
 automatically does this work. When the table view is loaded, <span class="code">tableView(_:cellForRowAt:)</span>
 is called for every visible row. When the user scrolls to look at more cells, it’s called again for each row just as it is about to appear on the screen.</p>
<p class="indent">Next, we need to find out which <span class="code">Birthday</span>
 should be displayed inside the cell. We want to display one birthday from the <span class="code">birthdays</span>
 array in each row. The first birthday, which is at <span class="code">birthdays[0]</span>
 , should be displayed in row 0. The second birthday, at <span class="code">birthdays[1]</span>
 , should be displayed in row 1, and so on, which means the <span class="code">indexPath</span>
 ’s <span class="code">row</span>
 is the same as the position in the <span class="code">birthdays</span>
 array that we want to access. The code at <span class="ent">➋</span>
 accesses the <span id="page_166"></span>
 correct <span class="code">Birthday</span>
 object from the <span class="code">birthdays</span>
 array by using <span class="code">indexPath.row</span>
 . Once we have the right <span class="code">Birthday</span>
 object, we assign it to a constant named <span class="code">birthday</span>
 so we can set up the labels in this cell.</p>
<p class="indent">Notice that we’re using <span class="code">let</span>
 to assign the <span class="code">birthday</span>
 to a constant instead of a variable. We can use <span class="code">let</span>
 because each time <span class="code">tableView(_:cellForRowAt:)</span>
 is called, a new <span class="code">birthday</span>
 constant is created. Each cell gets its own <span class="code">birthday</span>
 constant that is assigned its own <span class="code">Birthday</span>
 object. Since we’re not going to change any of the <span class="code">birthday</span>
 constants—we’re just going to read their properties—we don’t want to make them variables.</p>
<p class="indent">Now that you have your cell and your birthday, it’s time to fill in the details. You need two labels for each cell to show the birthday person’s name and birthdate. You set the cell to the Subtitle style so that it has a Title label and a Subtitle label. Each cell will already contain these labels, so now you don’t have to create any labels yourself.</p>
<p class="indent">The labels exist as properties of <span class="code">UITableViewCell</span>
 and are called <span class="code">textLabel</span>
 and <span class="code">detailTextLabel</span>
 . The code at <span class="ent">➌</span>
 sets the text of the <span class="code">textLabel</span>
 to a string made up of the <span class="code">firstName</span>
 and <span class="code">lastName</span>
 of the <span class="code">birthday</span>
 with a space between them. At <span class="ent">➍</span>
 , you use the <span class="code">string(from:)</span>
 method of the <span class="code">dateFormatter</span>
 to display the birthdate in the <span class="code">detailTextLabel</span>
 .</p>
<p class="indent">When your cell is completely configured, <span class="code">tableView( _:cellForRowAt:)</span>
 returns the cell at <span class="ent">➎</span>
 so that it can be displayed at that <span class="code">indexPath</span>
 of the table view.</p>
<h3 class="h3" id="ch11lev1sec2">
<strong>PUTTING IT ALL TOGETHER</strong>
</h3>
<p class="noindent">Now you can add <span class="code">Birthday</span>
 instances to the app using the Add Birthday view controller, and you have a table view to list each <span class="code">Birthday</span>
 in the Birthdays table view controller. But when you try running the app and adding a <span class="code">Birthday</span>
 , it doesn’t appear. To make each <span class="code">Birthday</span>
 you add appear in the table view, you need to make the Add Birthday view controller communicate with the Birthdays table view controller. You do this by using <em>delegation</em>
 .</p>
<h4 class="h4" id="ch11lev2sec5">
<strong>DELEGATION</strong>
</h4>
<p class="noindent">Delegation can be used when one view controller needs to get information from another view controller. Say you have two view controllers: A and B. The first view controller, A, creates B and presents B on top of itself. A knows about B because it created and presented B, so A can pass information along to B. But B doesn’t know about A—it’s just popped into being and doesn’t know where it came from or how it got there. So how can B talk to A? Through delegation!</p>
<div class="image"><img src="Image00245.jpg" />
</div>
<p class="indent">Delegation is when someone gives a job or a task to someone else. A <em>delegate</em>
 is like a boss who tells a delegating employee what to do. When the delegating employee is done with their task, sometimes they’ll report information back to the delegate boss.</p>
<p class="indent"><span id="page_167"></span>
 Delegation in Swift is pretty similar, but instead of having a boss and employee, we have a delegate and a delegating object. Since class B is the one being told what to do by class A, it’s the delegating object. We give class B a special property called a delegate to tell it who its delegate is—that way, it knows who to communicate with. The delegate can be any class that has a set of methods that have been defined in a <em>protocol</em>
 . A protocol is like an agreement between the two classes that tells them what the delegate can ask the delegating object to do. It has a list of method and property names that the delegate can use with the delegating object.</p>
<p class="indent">Class A creates class B, makes itself the delegate of class B, and gives class B a job to do that’s in the protocol. Once class B is done with its job, it reports back to class A. Let’s see how this works in our app.</p>
<p class="indent">The Birthdays table view controller is view controller A, and the Add Birthday view controller is view controller B. We’ll create a protocol called <span class="code">AddBirthdayViewControllerDelegate</span>
 and a method for that protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 , which the Add Birthday view controller will use to report back.</p>
<p class="indent">Take a look at <a href="text00022.html#ch11fig6">Figure 11-6</a>
 . When the user taps the Add button <span class="ent">➊</span>
 , the Birthdays table view controller creates the Add Birthday view controller <span class="ent">➋</span>
 and sets itself as the Add Birthday view controller’s delegate.</p>
<div class="image"><img src="Image00246.jpg" />
</div>
<p class="figcap"><a id="ch11fig6"></a>
 <em>Figure 11-6: A new birthday is added and passed from the Add Birthday view controller to the Birthdays table view controller using delegation.</em>
</p>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="hang">
<span class="code">
<span class="codestrong">tableView(_:cellForRowAt:)</span>
</span>
 Sets up each cell that’s going to be displayed in each row of the table view</p>
<div class="image"><span id="page_163"></span>
 <img src="Image00243.jpg" />
</div>
<p class="figcap"><a id="ch11fig5"></a>
 <em>Figure 11-5: The Settings app uses sections to group rows of different device settings.</em>
</p>
<p class="indent">The table view data source methods are called by the table view controller every time the table view is reloaded. Xcode automatically gives you these method templates when you make a subclass of a <span class="code">UITableViewController</span>
 . You need to implement all three methods for the app to work, even though you’ll never call them directly in your code. The <span class="code">UITableViewController</span>
 class implements the <span class="code">UITableViewDataSource</span>
 protocol, which comes with these data source methods, to determine what will be displayed inside the table view. We’ll discuss protocols in “<a href="text00022.html#ch11lev2sec5">Delegation</a>
 ” on page 166. For now, you just need to know that a <span class="code">UITableViewController</span>
 uses these methods to display its content, and it automatically calls these methods so you don’t need to call them.</p>
<p class="indent">Let’s start with the method <span class="code">numberOfSections(in:)</span>
 . The Birthdays table view controller is a list that just displays <span class="code">Birthday</span>
 instances, so it doesn’t need multiple sections. To set the number of sections in the table view, we just need to return <span class="code">1</span>
 .</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func numberOfSections(in tableView: UITableView) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 <span class="blue1">1</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent"><span id="page_164"></span>
 This method takes a <span class="code">UITableView</span>
 called <span class="code">tableView</span>
 as a parameter, which is the table view that uses this class as its data source. We don’t need to worry about making this connection because the <span class="code">UITableViewController</span>
 comes with a built-in table view that is automatically hooked up to these methods. Each birthday will be displayed in its own row. So in <span class="code">tableView(_:numberOfRowsInSection:)</span>
 , in order to have the right number of rows for all of your birthdays, you need to return the number of <span class="code">Birthday</span>
 instances that you have in your <span class="code">birthdays</span>
 array. Do you remember the <span class="code">count</span>
 property of an array? It’s an integer that tells you how many items are in that array, and it’s perfect for this situation! Change this method to the following:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, <img class="inline" src="Image00184.jpg" />
<br />
    numberOfRowsInSection section: Int) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 birthdays.<span class="violet">count</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">In addition to the <span class="code">tableView</span>
 parameter, <span class="code">tableView(_:numberOfRowsInSection:)</span>
 also takes an <span class="code">Int</span>
 called <span class="code">section</span>
 . When the table view is loading itself, this method is called for each section in the table view. In our case, we have only one section, so we don’t need to bother checking which <span class="code">section</span>
 of the table view is being displayed here. We know it’s section 0, and we want it to have as many rows as there are birthdays, so we write <span class="code">return birthdays.count</span>
 .</p>
<p class="indent">Finally, you need to implement <span class="code">tableView(_:cellForRowAt:)</span>
 so that the table view will know what to put inside each cell. Since this method is commented out, you need to uncomment it by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it. (Be careful not to accidentally uncomment the other methods after it!) After you’ve done that, change it to the following code:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, cellForRowAt <img class="inline" src="Image00184.jpg" />
<br />
    indexPath: IndexPath) -&gt; UITableViewCell {</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="pink">let</span>
 cell = tableView.<span class="blue">dequeueReusableCell</span>
 (withIdentifier: <img class="inline" src="Image00093.jpg" />
<br />
        <span class="red">"birthdayCellIdentifier"</span>
 , for: indexPath)<br />
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 birthday = <span class="green1">birthdays</span>
 [indexPath.<span class="violet">row</span>
 ]<br />
<br />
  <span class="ent">➌</span>
 cell.<span class="violet">textLabel</span>
 ?.<span class="violet">text</span>
 = birthday.<span class="green1">firstName</span>
 <span class="blue">+</span>
 <span class="red">" "</span>
 <span class="blue">+</span>
 <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">lastName</span>
<br />
<br />
  <span class="ent">➍</span>
 cell.<span class="violet">detailTextLabel</span>
 ?.<span class="violet">text</span>
 = <span class="green1">dateFormatter</span>
 .<span class="blue">string</span>
 (from: <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">birthdate</span>
 )<br />
<br />
  <span class="ent">➎</span>
 <span class="pink">return</span>
 cell<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">You don’t call the method <span class="code">tableView(_:cellForRowAt:)</span>
 . It’s called when the table view is loaded onto the screen. It’s called for each cell on the screen and takes two parameters, <span class="code">tableView</span>
 and <span class="code">indexPath</span>
 . You already know <span id="page_165"></span>
 what the <span class="code">tableView</span>
 parameter is for. An <span class="code">IndexPath</span>
 is a Swift struct that’s used to represent a row’s position in a table view. An <span class="code">IndexPath</span>
 instance has a <span class="code">section</span>
 property and a <span class="code">row</span>
 property. Since this method will be called many times (once for every row in the table), we need the <span class="code">indexPath</span>
 to know which section and row we’re currently configuring. The <span class="code">indexPath.section</span>
 property gives the section number, and the <span class="code">indexPath.row</span>
 gives the row of the table view cell. The five lines of code inside <span class="code">tableView(_:cellForRowAt:)</span>
 will do the following:</p>
<div class="image"><img src="Image00244.jpg" />
</div>
<p class="bull">• Create a <span class="code">UITableViewCell</span>
</p>
<p class="bull">• Figure out which <span class="code">Birthday</span>
 in the <span class="code">birthdays</span>
 array will be displayed inside the cell</p>
<p class="bull">• Make two labels to display the birthday person’s name and birthdate in the cell</p>
<p class="bull">• Return the cell ready for display in the table view</p>
<p class="indentt">Let’s go through this code line by line.</p>
<p class="indent">First, create the <span class="code">UITableViewCell</span>
 . The code at <span class="ent">➊</span>
 does this using the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 . Before you can start using this method on a cell, though, you need to tell the method which cell you want to use from the storyboard. Earlier, when you were in the storyboard, you gave your cell the identifier <span class="code">birthdayCellIdentifier</span>
 (see <a href="text00022.html#ch11fig4">Figure 11-4</a>
 ). This identifier links your code to the cell and tells your method that it’s using the right cell. The string for when you call this method needs to be exactly the same as the string you set in the storyboard, or you’ll get an error and the app will crash when you run it.</p>
<p class="indent">In the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 , did you notice the words <em>Reusable Cell</em>
 ? The cells inside a table view are created once and then can be reused over and over. This helps everything run faster and smoother because creating the cell is what takes the most time. If you had 200 birthdays in your app, but only 10 would fit on your screen at one time, then you need only 10 cells to show your birthdays. When you scroll down to reveal more birthdays, the cells that scroll off the top of the screen are reused. They are filled with new information and show up again at the bottom of the screen. The <span class="code">UITableView</span>
 automatically does this work. When the table view is loaded, <span class="code">tableView(_:cellForRowAt:)</span>
 is called for every visible row. When the user scrolls to look at more cells, it’s called again for each row just as it is about to appear on the screen.</p>
<p class="indent">Next, we need to find out which <span class="code">Birthday</span>
 should be displayed inside the cell. We want to display one birthday from the <span class="code">birthdays</span>
 array in each row. The first birthday, which is at <span class="code">birthdays[0]</span>
 , should be displayed in row 0. The second birthday, at <span class="code">birthdays[1]</span>
 , should be displayed in row 1, and so on, which means the <span class="code">indexPath</span>
 ’s <span class="code">row</span>
 is the same as the position in the <span class="code">birthdays</span>
 array that we want to access. The code at <span class="ent">➋</span>
 accesses the <span id="page_166"></span>
 correct <span class="code">Birthday</span>
 object from the <span class="code">birthdays</span>
 array by using <span class="code">indexPath.row</span>
 . Once we have the right <span class="code">Birthday</span>
 object, we assign it to a constant named <span class="code">birthday</span>
 so we can set up the labels in this cell.</p>
<p class="indent">Notice that we’re using <span class="code">let</span>
 to assign the <span class="code">birthday</span>
 to a constant instead of a variable. We can use <span class="code">let</span>
 because each time <span class="code">tableView(_:cellForRowAt:)</span>
 is called, a new <span class="code">birthday</span>
 constant is created. Each cell gets its own <span class="code">birthday</span>
 constant that is assigned its own <span class="code">Birthday</span>
 object. Since we’re not going to change any of the <span class="code">birthday</span>
 constants—we’re just going to read their properties—we don’t want to make them variables.</p>
<p class="indent">Now that you have your cell and your birthday, it’s time to fill in the details. You need two labels for each cell to show the birthday person’s name and birthdate. You set the cell to the Subtitle style so that it has a Title label and a Subtitle label. Each cell will already contain these labels, so now you don’t have to create any labels yourself.</p>
<p class="indent">The labels exist as properties of <span class="code">UITableViewCell</span>
 and are called <span class="code">textLabel</span>
 and <span class="code">detailTextLabel</span>
 . The code at <span class="ent">➌</span>
 sets the text of the <span class="code">textLabel</span>
 to a string made up of the <span class="code">firstName</span>
 and <span class="code">lastName</span>
 of the <span class="code">birthday</span>
 with a space between them. At <span class="ent">➍</span>
 , you use the <span class="code">string(from:)</span>
 method of the <span class="code">dateFormatter</span>
 to display the birthdate in the <span class="code">detailTextLabel</span>
 .</p>
<p class="indent">When your cell is completely configured, <span class="code">tableView( _:cellForRowAt:)</span>
 returns the cell at <span class="ent">➎</span>
 so that it can be displayed at that <span class="code">indexPath</span>
 of the table view.</p>
<h3 class="h3" id="ch11lev1sec2">
<strong>PUTTING IT ALL TOGETHER</strong>
</h3>
<p class="noindent">Now you can add <span class="code">Birthday</span>
 instances to the app using the Add Birthday view controller, and you have a table view to list each <span class="code">Birthday</span>
 in the Birthdays table view controller. But when you try running the app and adding a <span class="code">Birthday</span>
 , it doesn’t appear. To make each <span class="code">Birthday</span>
 you add appear in the table view, you need to make the Add Birthday view controller communicate with the Birthdays table view controller. You do this by using <em>delegation</em>
 .</p>
<h4 class="h4" id="ch11lev2sec5">
<strong>DELEGATION</strong>
</h4>
<p class="noindent">Delegation can be used when one view controller needs to get information from another view controller. Say you have two view controllers: A and B. The first view controller, A, creates B and presents B on top of itself. A knows about B because it created and presented B, so A can pass information along to B. But B doesn’t know about A—it’s just popped into being and doesn’t know where it came from or how it got there. So how can B talk to A? Through delegation!</p>
<div class="image"><img src="Image00245.jpg" />
</div>
<p class="indent">Delegation is when someone gives a job or a task to someone else. A <em>delegate</em>
 is like a boss who tells a delegating employee what to do. When the delegating employee is done with their task, sometimes they’ll report information back to the delegate boss.</p>
<p class="indent"><span id="page_167"></span>
 Delegation in Swift is pretty similar, but instead of having a boss and employee, we have a delegate and a delegating object. Since class B is the one being told what to do by class A, it’s the delegating object. We give class B a special property called a delegate to tell it who its delegate is—that way, it knows who to communicate with. The delegate can be any class that has a set of methods that have been defined in a <em>protocol</em>
 . A protocol is like an agreement between the two classes that tells them what the delegate can ask the delegating object to do. It has a list of method and property names that the delegate can use with the delegating object.</p>
<p class="indent">Class A creates class B, makes itself the delegate of class B, and gives class B a job to do that’s in the protocol. Once class B is done with its job, it reports back to class A. Let’s see how this works in our app.</p>
<p class="indent">The Birthdays table view controller is view controller A, and the Add Birthday view controller is view controller B. We’ll create a protocol called <span class="code">AddBirthdayViewControllerDelegate</span>
 and a method for that protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 , which the Add Birthday view controller will use to report back.</p>
<p class="indent">Take a look at <a href="text00022.html#ch11fig6">Figure 11-6</a>
 . When the user taps the Add button <span class="ent">➊</span>
 , the Birthdays table view controller creates the Add Birthday view controller <span class="ent">➋</span>
 and sets itself as the Add Birthday view controller’s delegate.</p>
<div class="image"><img src="Image00246.jpg" />
</div>
<p class="figcap"><a id="ch11fig6"></a>
 <em>Figure 11-6: A new birthday is added and passed from the Add Birthday view controller to the Birthdays table view controller using delegation.</em>
</p>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<div class="image"><span id="page_163"></span>
 <img src="Image00243.jpg" />
</div>
<p class="figcap"><a id="ch11fig5"></a>
 <em>Figure 11-5: The Settings app uses sections to group rows of different device settings.</em>
</p>
<p class="indent">The table view data source methods are called by the table view controller every time the table view is reloaded. Xcode automatically gives you these method templates when you make a subclass of a <span class="code">UITableViewController</span>
 . You need to implement all three methods for the app to work, even though you’ll never call them directly in your code. The <span class="code">UITableViewController</span>
 class implements the <span class="code">UITableViewDataSource</span>
 protocol, which comes with these data source methods, to determine what will be displayed inside the table view. We’ll discuss protocols in “<a href="text00022.html#ch11lev2sec5">Delegation</a>
 ” on page 166. For now, you just need to know that a <span class="code">UITableViewController</span>
 uses these methods to display its content, and it automatically calls these methods so you don’t need to call them.</p>
<p class="indent">Let’s start with the method <span class="code">numberOfSections(in:)</span>
 . The Birthdays table view controller is a list that just displays <span class="code">Birthday</span>
 instances, so it doesn’t need multiple sections. To set the number of sections in the table view, we just need to return <span class="code">1</span>
 .</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func numberOfSections(in tableView: UITableView) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 <span class="blue1">1</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent"><span id="page_164"></span>
 This method takes a <span class="code">UITableView</span>
 called <span class="code">tableView</span>
 as a parameter, which is the table view that uses this class as its data source. We don’t need to worry about making this connection because the <span class="code">UITableViewController</span>
 comes with a built-in table view that is automatically hooked up to these methods. Each birthday will be displayed in its own row. So in <span class="code">tableView(_:numberOfRowsInSection:)</span>
 , in order to have the right number of rows for all of your birthdays, you need to return the number of <span class="code">Birthday</span>
 instances that you have in your <span class="code">birthdays</span>
 array. Do you remember the <span class="code">count</span>
 property of an array? It’s an integer that tells you how many items are in that array, and it’s perfect for this situation! Change this method to the following:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, <img class="inline" src="Image00184.jpg" />
<br />
    numberOfRowsInSection section: Int) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 birthdays.<span class="violet">count</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">In addition to the <span class="code">tableView</span>
 parameter, <span class="code">tableView(_:numberOfRowsInSection:)</span>
 also takes an <span class="code">Int</span>
 called <span class="code">section</span>
 . When the table view is loading itself, this method is called for each section in the table view. In our case, we have only one section, so we don’t need to bother checking which <span class="code">section</span>
 of the table view is being displayed here. We know it’s section 0, and we want it to have as many rows as there are birthdays, so we write <span class="code">return birthdays.count</span>
 .</p>
<p class="indent">Finally, you need to implement <span class="code">tableView(_:cellForRowAt:)</span>
 so that the table view will know what to put inside each cell. Since this method is commented out, you need to uncomment it by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it. (Be careful not to accidentally uncomment the other methods after it!) After you’ve done that, change it to the following code:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, cellForRowAt <img class="inline" src="Image00184.jpg" />
<br />
    indexPath: IndexPath) -&gt; UITableViewCell {</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="pink">let</span>
 cell = tableView.<span class="blue">dequeueReusableCell</span>
 (withIdentifier: <img class="inline" src="Image00093.jpg" />
<br />
        <span class="red">"birthdayCellIdentifier"</span>
 , for: indexPath)<br />
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 birthday = <span class="green1">birthdays</span>
 [indexPath.<span class="violet">row</span>
 ]<br />
<br />
  <span class="ent">➌</span>
 cell.<span class="violet">textLabel</span>
 ?.<span class="violet">text</span>
 = birthday.<span class="green1">firstName</span>
 <span class="blue">+</span>
 <span class="red">" "</span>
 <span class="blue">+</span>
 <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">lastName</span>
<br />
<br />
  <span class="ent">➍</span>
 cell.<span class="violet">detailTextLabel</span>
 ?.<span class="violet">text</span>
 = <span class="green1">dateFormatter</span>
 .<span class="blue">string</span>
 (from: <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">birthdate</span>
 )<br />
<br />
  <span class="ent">➎</span>
 <span class="pink">return</span>
 cell<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">You don’t call the method <span class="code">tableView(_:cellForRowAt:)</span>
 . It’s called when the table view is loaded onto the screen. It’s called for each cell on the screen and takes two parameters, <span class="code">tableView</span>
 and <span class="code">indexPath</span>
 . You already know <span id="page_165"></span>
 what the <span class="code">tableView</span>
 parameter is for. An <span class="code">IndexPath</span>
 is a Swift struct that’s used to represent a row’s position in a table view. An <span class="code">IndexPath</span>
 instance has a <span class="code">section</span>
 property and a <span class="code">row</span>
 property. Since this method will be called many times (once for every row in the table), we need the <span class="code">indexPath</span>
 to know which section and row we’re currently configuring. The <span class="code">indexPath.section</span>
 property gives the section number, and the <span class="code">indexPath.row</span>
 gives the row of the table view cell. The five lines of code inside <span class="code">tableView(_:cellForRowAt:)</span>
 will do the following:</p>
<div class="image"><img src="Image00244.jpg" />
</div>
<p class="bull">• Create a <span class="code">UITableViewCell</span>
</p>
<p class="bull">• Figure out which <span class="code">Birthday</span>
 in the <span class="code">birthdays</span>
 array will be displayed inside the cell</p>
<p class="bull">• Make two labels to display the birthday person’s name and birthdate in the cell</p>
<p class="bull">• Return the cell ready for display in the table view</p>
<p class="indentt">Let’s go through this code line by line.</p>
<p class="indent">First, create the <span class="code">UITableViewCell</span>
 . The code at <span class="ent">➊</span>
 does this using the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 . Before you can start using this method on a cell, though, you need to tell the method which cell you want to use from the storyboard. Earlier, when you were in the storyboard, you gave your cell the identifier <span class="code">birthdayCellIdentifier</span>
 (see <a href="text00022.html#ch11fig4">Figure 11-4</a>
 ). This identifier links your code to the cell and tells your method that it’s using the right cell. The string for when you call this method needs to be exactly the same as the string you set in the storyboard, or you’ll get an error and the app will crash when you run it.</p>
<p class="indent">In the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 , did you notice the words <em>Reusable Cell</em>
 ? The cells inside a table view are created once and then can be reused over and over. This helps everything run faster and smoother because creating the cell is what takes the most time. If you had 200 birthdays in your app, but only 10 would fit on your screen at one time, then you need only 10 cells to show your birthdays. When you scroll down to reveal more birthdays, the cells that scroll off the top of the screen are reused. They are filled with new information and show up again at the bottom of the screen. The <span class="code">UITableView</span>
 automatically does this work. When the table view is loaded, <span class="code">tableView(_:cellForRowAt:)</span>
 is called for every visible row. When the user scrolls to look at more cells, it’s called again for each row just as it is about to appear on the screen.</p>
<p class="indent">Next, we need to find out which <span class="code">Birthday</span>
 should be displayed inside the cell. We want to display one birthday from the <span class="code">birthdays</span>
 array in each row. The first birthday, which is at <span class="code">birthdays[0]</span>
 , should be displayed in row 0. The second birthday, at <span class="code">birthdays[1]</span>
 , should be displayed in row 1, and so on, which means the <span class="code">indexPath</span>
 ’s <span class="code">row</span>
 is the same as the position in the <span class="code">birthdays</span>
 array that we want to access. The code at <span class="ent">➋</span>
 accesses the <span id="page_166"></span>
 correct <span class="code">Birthday</span>
 object from the <span class="code">birthdays</span>
 array by using <span class="code">indexPath.row</span>
 . Once we have the right <span class="code">Birthday</span>
 object, we assign it to a constant named <span class="code">birthday</span>
 so we can set up the labels in this cell.</p>
<p class="indent">Notice that we’re using <span class="code">let</span>
 to assign the <span class="code">birthday</span>
 to a constant instead of a variable. We can use <span class="code">let</span>
 because each time <span class="code">tableView(_:cellForRowAt:)</span>
 is called, a new <span class="code">birthday</span>
 constant is created. Each cell gets its own <span class="code">birthday</span>
 constant that is assigned its own <span class="code">Birthday</span>
 object. Since we’re not going to change any of the <span class="code">birthday</span>
 constants—we’re just going to read their properties—we don’t want to make them variables.</p>
<p class="indent">Now that you have your cell and your birthday, it’s time to fill in the details. You need two labels for each cell to show the birthday person’s name and birthdate. You set the cell to the Subtitle style so that it has a Title label and a Subtitle label. Each cell will already contain these labels, so now you don’t have to create any labels yourself.</p>
<p class="indent">The labels exist as properties of <span class="code">UITableViewCell</span>
 and are called <span class="code">textLabel</span>
 and <span class="code">detailTextLabel</span>
 . The code at <span class="ent">➌</span>
 sets the text of the <span class="code">textLabel</span>
 to a string made up of the <span class="code">firstName</span>
 and <span class="code">lastName</span>
 of the <span class="code">birthday</span>
 with a space between them. At <span class="ent">➍</span>
 , you use the <span class="code">string(from:)</span>
 method of the <span class="code">dateFormatter</span>
 to display the birthdate in the <span class="code">detailTextLabel</span>
 .</p>
<p class="indent">When your cell is completely configured, <span class="code">tableView( _:cellForRowAt:)</span>
 returns the cell at <span class="ent">➎</span>
 so that it can be displayed at that <span class="code">indexPath</span>
 of the table view.</p>
<h3 class="h3" id="ch11lev1sec2">
<strong>PUTTING IT ALL TOGETHER</strong>
</h3>
<p class="noindent">Now you can add <span class="code">Birthday</span>
 instances to the app using the Add Birthday view controller, and you have a table view to list each <span class="code">Birthday</span>
 in the Birthdays table view controller. But when you try running the app and adding a <span class="code">Birthday</span>
 , it doesn’t appear. To make each <span class="code">Birthday</span>
 you add appear in the table view, you need to make the Add Birthday view controller communicate with the Birthdays table view controller. You do this by using <em>delegation</em>
 .</p>
<h4 class="h4" id="ch11lev2sec5">
<strong>DELEGATION</strong>
</h4>
<p class="noindent">Delegation can be used when one view controller needs to get information from another view controller. Say you have two view controllers: A and B. The first view controller, A, creates B and presents B on top of itself. A knows about B because it created and presented B, so A can pass information along to B. But B doesn’t know about A—it’s just popped into being and doesn’t know where it came from or how it got there. So how can B talk to A? Through delegation!</p>
<div class="image"><img src="Image00245.jpg" />
</div>
<p class="indent">Delegation is when someone gives a job or a task to someone else. A <em>delegate</em>
 is like a boss who tells a delegating employee what to do. When the delegating employee is done with their task, sometimes they’ll report information back to the delegate boss.</p>
<p class="indent"><span id="page_167"></span>
 Delegation in Swift is pretty similar, but instead of having a boss and employee, we have a delegate and a delegating object. Since class B is the one being told what to do by class A, it’s the delegating object. We give class B a special property called a delegate to tell it who its delegate is—that way, it knows who to communicate with. The delegate can be any class that has a set of methods that have been defined in a <em>protocol</em>
 . A protocol is like an agreement between the two classes that tells them what the delegate can ask the delegating object to do. It has a list of method and property names that the delegate can use with the delegating object.</p>
<p class="indent">Class A creates class B, makes itself the delegate of class B, and gives class B a job to do that’s in the protocol. Once class B is done with its job, it reports back to class A. Let’s see how this works in our app.</p>
<p class="indent">The Birthdays table view controller is view controller A, and the Add Birthday view controller is view controller B. We’ll create a protocol called <span class="code">AddBirthdayViewControllerDelegate</span>
 and a method for that protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 , which the Add Birthday view controller will use to report back.</p>
<p class="indent">Take a look at <a href="text00022.html#ch11fig6">Figure 11-6</a>
 . When the user taps the Add button <span class="ent">➊</span>
 , the Birthdays table view controller creates the Add Birthday view controller <span class="ent">➋</span>
 and sets itself as the Add Birthday view controller’s delegate.</p>
<div class="image"><img src="Image00246.jpg" />
</div>
<p class="figcap"><a id="ch11fig6"></a>
 <em>Figure 11-6: A new birthday is added and passed from the Add Birthday view controller to the Birthdays table view controller using delegation.</em>
</p>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="figcap"><a id="ch11fig5"></a>
 <em>Figure 11-5: The Settings app uses sections to group rows of different device settings.</em>
</p>
<p class="indent">The table view data source methods are called by the table view controller every time the table view is reloaded. Xcode automatically gives you these method templates when you make a subclass of a <span class="code">UITableViewController</span>
 . You need to implement all three methods for the app to work, even though you’ll never call them directly in your code. The <span class="code">UITableViewController</span>
 class implements the <span class="code">UITableViewDataSource</span>
 protocol, which comes with these data source methods, to determine what will be displayed inside the table view. We’ll discuss protocols in “<a href="text00022.html#ch11lev2sec5">Delegation</a>
 ” on page 166. For now, you just need to know that a <span class="code">UITableViewController</span>
 uses these methods to display its content, and it automatically calls these methods so you don’t need to call them.</p>
<p class="indent">Let’s start with the method <span class="code">numberOfSections(in:)</span>
 . The Birthdays table view controller is a list that just displays <span class="code">Birthday</span>
 instances, so it doesn’t need multiple sections. To set the number of sections in the table view, we just need to return <span class="code">1</span>
 .</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func numberOfSections(in tableView: UITableView) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 <span class="blue1">1</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent"><span id="page_164"></span>
 This method takes a <span class="code">UITableView</span>
 called <span class="code">tableView</span>
 as a parameter, which is the table view that uses this class as its data source. We don’t need to worry about making this connection because the <span class="code">UITableViewController</span>
 comes with a built-in table view that is automatically hooked up to these methods. Each birthday will be displayed in its own row. So in <span class="code">tableView(_:numberOfRowsInSection:)</span>
 , in order to have the right number of rows for all of your birthdays, you need to return the number of <span class="code">Birthday</span>
 instances that you have in your <span class="code">birthdays</span>
 array. Do you remember the <span class="code">count</span>
 property of an array? It’s an integer that tells you how many items are in that array, and it’s perfect for this situation! Change this method to the following:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, <img class="inline" src="Image00184.jpg" />
<br />
    numberOfRowsInSection section: Int) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 birthdays.<span class="violet">count</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">In addition to the <span class="code">tableView</span>
 parameter, <span class="code">tableView(_:numberOfRowsInSection:)</span>
 also takes an <span class="code">Int</span>
 called <span class="code">section</span>
 . When the table view is loading itself, this method is called for each section in the table view. In our case, we have only one section, so we don’t need to bother checking which <span class="code">section</span>
 of the table view is being displayed here. We know it’s section 0, and we want it to have as many rows as there are birthdays, so we write <span class="code">return birthdays.count</span>
 .</p>
<p class="indent">Finally, you need to implement <span class="code">tableView(_:cellForRowAt:)</span>
 so that the table view will know what to put inside each cell. Since this method is commented out, you need to uncomment it by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it. (Be careful not to accidentally uncomment the other methods after it!) After you’ve done that, change it to the following code:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, cellForRowAt <img class="inline" src="Image00184.jpg" />
<br />
    indexPath: IndexPath) -&gt; UITableViewCell {</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="pink">let</span>
 cell = tableView.<span class="blue">dequeueReusableCell</span>
 (withIdentifier: <img class="inline" src="Image00093.jpg" />
<br />
        <span class="red">"birthdayCellIdentifier"</span>
 , for: indexPath)<br />
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 birthday = <span class="green1">birthdays</span>
 [indexPath.<span class="violet">row</span>
 ]<br />
<br />
  <span class="ent">➌</span>
 cell.<span class="violet">textLabel</span>
 ?.<span class="violet">text</span>
 = birthday.<span class="green1">firstName</span>
 <span class="blue">+</span>
 <span class="red">" "</span>
 <span class="blue">+</span>
 <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">lastName</span>
<br />
<br />
  <span class="ent">➍</span>
 cell.<span class="violet">detailTextLabel</span>
 ?.<span class="violet">text</span>
 = <span class="green1">dateFormatter</span>
 .<span class="blue">string</span>
 (from: <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">birthdate</span>
 )<br />
<br />
  <span class="ent">➎</span>
 <span class="pink">return</span>
 cell<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">You don’t call the method <span class="code">tableView(_:cellForRowAt:)</span>
 . It’s called when the table view is loaded onto the screen. It’s called for each cell on the screen and takes two parameters, <span class="code">tableView</span>
 and <span class="code">indexPath</span>
 . You already know <span id="page_165"></span>
 what the <span class="code">tableView</span>
 parameter is for. An <span class="code">IndexPath</span>
 is a Swift struct that’s used to represent a row’s position in a table view. An <span class="code">IndexPath</span>
 instance has a <span class="code">section</span>
 property and a <span class="code">row</span>
 property. Since this method will be called many times (once for every row in the table), we need the <span class="code">indexPath</span>
 to know which section and row we’re currently configuring. The <span class="code">indexPath.section</span>
 property gives the section number, and the <span class="code">indexPath.row</span>
 gives the row of the table view cell. The five lines of code inside <span class="code">tableView(_:cellForRowAt:)</span>
 will do the following:</p>
<div class="image"><img src="Image00244.jpg" />
</div>
<p class="bull">• Create a <span class="code">UITableViewCell</span>
</p>
<p class="bull">• Figure out which <span class="code">Birthday</span>
 in the <span class="code">birthdays</span>
 array will be displayed inside the cell</p>
<p class="bull">• Make two labels to display the birthday person’s name and birthdate in the cell</p>
<p class="bull">• Return the cell ready for display in the table view</p>
<p class="indentt">Let’s go through this code line by line.</p>
<p class="indent">First, create the <span class="code">UITableViewCell</span>
 . The code at <span class="ent">➊</span>
 does this using the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 . Before you can start using this method on a cell, though, you need to tell the method which cell you want to use from the storyboard. Earlier, when you were in the storyboard, you gave your cell the identifier <span class="code">birthdayCellIdentifier</span>
 (see <a href="text00022.html#ch11fig4">Figure 11-4</a>
 ). This identifier links your code to the cell and tells your method that it’s using the right cell. The string for when you call this method needs to be exactly the same as the string you set in the storyboard, or you’ll get an error and the app will crash when you run it.</p>
<p class="indent">In the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 , did you notice the words <em>Reusable Cell</em>
 ? The cells inside a table view are created once and then can be reused over and over. This helps everything run faster and smoother because creating the cell is what takes the most time. If you had 200 birthdays in your app, but only 10 would fit on your screen at one time, then you need only 10 cells to show your birthdays. When you scroll down to reveal more birthdays, the cells that scroll off the top of the screen are reused. They are filled with new information and show up again at the bottom of the screen. The <span class="code">UITableView</span>
 automatically does this work. When the table view is loaded, <span class="code">tableView(_:cellForRowAt:)</span>
 is called for every visible row. When the user scrolls to look at more cells, it’s called again for each row just as it is about to appear on the screen.</p>
<p class="indent">Next, we need to find out which <span class="code">Birthday</span>
 should be displayed inside the cell. We want to display one birthday from the <span class="code">birthdays</span>
 array in each row. The first birthday, which is at <span class="code">birthdays[0]</span>
 , should be displayed in row 0. The second birthday, at <span class="code">birthdays[1]</span>
 , should be displayed in row 1, and so on, which means the <span class="code">indexPath</span>
 ’s <span class="code">row</span>
 is the same as the position in the <span class="code">birthdays</span>
 array that we want to access. The code at <span class="ent">➋</span>
 accesses the <span id="page_166"></span>
 correct <span class="code">Birthday</span>
 object from the <span class="code">birthdays</span>
 array by using <span class="code">indexPath.row</span>
 . Once we have the right <span class="code">Birthday</span>
 object, we assign it to a constant named <span class="code">birthday</span>
 so we can set up the labels in this cell.</p>
<p class="indent">Notice that we’re using <span class="code">let</span>
 to assign the <span class="code">birthday</span>
 to a constant instead of a variable. We can use <span class="code">let</span>
 because each time <span class="code">tableView(_:cellForRowAt:)</span>
 is called, a new <span class="code">birthday</span>
 constant is created. Each cell gets its own <span class="code">birthday</span>
 constant that is assigned its own <span class="code">Birthday</span>
 object. Since we’re not going to change any of the <span class="code">birthday</span>
 constants—we’re just going to read their properties—we don’t want to make them variables.</p>
<p class="indent">Now that you have your cell and your birthday, it’s time to fill in the details. You need two labels for each cell to show the birthday person’s name and birthdate. You set the cell to the Subtitle style so that it has a Title label and a Subtitle label. Each cell will already contain these labels, so now you don’t have to create any labels yourself.</p>
<p class="indent">The labels exist as properties of <span class="code">UITableViewCell</span>
 and are called <span class="code">textLabel</span>
 and <span class="code">detailTextLabel</span>
 . The code at <span class="ent">➌</span>
 sets the text of the <span class="code">textLabel</span>
 to a string made up of the <span class="code">firstName</span>
 and <span class="code">lastName</span>
 of the <span class="code">birthday</span>
 with a space between them. At <span class="ent">➍</span>
 , you use the <span class="code">string(from:)</span>
 method of the <span class="code">dateFormatter</span>
 to display the birthdate in the <span class="code">detailTextLabel</span>
 .</p>
<p class="indent">When your cell is completely configured, <span class="code">tableView( _:cellForRowAt:)</span>
 returns the cell at <span class="ent">➎</span>
 so that it can be displayed at that <span class="code">indexPath</span>
 of the table view.</p>
<h3 class="h3" id="ch11lev1sec2">
<strong>PUTTING IT ALL TOGETHER</strong>
</h3>
<p class="noindent">Now you can add <span class="code">Birthday</span>
 instances to the app using the Add Birthday view controller, and you have a table view to list each <span class="code">Birthday</span>
 in the Birthdays table view controller. But when you try running the app and adding a <span class="code">Birthday</span>
 , it doesn’t appear. To make each <span class="code">Birthday</span>
 you add appear in the table view, you need to make the Add Birthday view controller communicate with the Birthdays table view controller. You do this by using <em>delegation</em>
 .</p>
<h4 class="h4" id="ch11lev2sec5">
<strong>DELEGATION</strong>
</h4>
<p class="noindent">Delegation can be used when one view controller needs to get information from another view controller. Say you have two view controllers: A and B. The first view controller, A, creates B and presents B on top of itself. A knows about B because it created and presented B, so A can pass information along to B. But B doesn’t know about A—it’s just popped into being and doesn’t know where it came from or how it got there. So how can B talk to A? Through delegation!</p>
<div class="image"><img src="Image00245.jpg" />
</div>
<p class="indent">Delegation is when someone gives a job or a task to someone else. A <em>delegate</em>
 is like a boss who tells a delegating employee what to do. When the delegating employee is done with their task, sometimes they’ll report information back to the delegate boss.</p>
<p class="indent"><span id="page_167"></span>
 Delegation in Swift is pretty similar, but instead of having a boss and employee, we have a delegate and a delegating object. Since class B is the one being told what to do by class A, it’s the delegating object. We give class B a special property called a delegate to tell it who its delegate is—that way, it knows who to communicate with. The delegate can be any class that has a set of methods that have been defined in a <em>protocol</em>
 . A protocol is like an agreement between the two classes that tells them what the delegate can ask the delegating object to do. It has a list of method and property names that the delegate can use with the delegating object.</p>
<p class="indent">Class A creates class B, makes itself the delegate of class B, and gives class B a job to do that’s in the protocol. Once class B is done with its job, it reports back to class A. Let’s see how this works in our app.</p>
<p class="indent">The Birthdays table view controller is view controller A, and the Add Birthday view controller is view controller B. We’ll create a protocol called <span class="code">AddBirthdayViewControllerDelegate</span>
 and a method for that protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 , which the Add Birthday view controller will use to report back.</p>
<p class="indent">Take a look at <a href="text00022.html#ch11fig6">Figure 11-6</a>
 . When the user taps the Add button <span class="ent">➊</span>
 , the Birthdays table view controller creates the Add Birthday view controller <span class="ent">➋</span>
 and sets itself as the Add Birthday view controller’s delegate.</p>
<div class="image"><img src="Image00246.jpg" />
</div>
<p class="figcap"><a id="ch11fig6"></a>
 <em>Figure 11-6: A new birthday is added and passed from the Add Birthday view controller to the Birthdays table view controller using delegation.</em>
</p>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="indent">The table view data source methods are called by the table view controller every time the table view is reloaded. Xcode automatically gives you these method templates when you make a subclass of a <span class="code">UITableViewController</span>
 . You need to implement all three methods for the app to work, even though you’ll never call them directly in your code. The <span class="code">UITableViewController</span>
 class implements the <span class="code">UITableViewDataSource</span>
 protocol, which comes with these data source methods, to determine what will be displayed inside the table view. We’ll discuss protocols in “<a href="text00022.html#ch11lev2sec5">Delegation</a>
 ” on page 166. For now, you just need to know that a <span class="code">UITableViewController</span>
 uses these methods to display its content, and it automatically calls these methods so you don’t need to call them.</p>
<p class="indent">Let’s start with the method <span class="code">numberOfSections(in:)</span>
 . The Birthdays table view controller is a list that just displays <span class="code">Birthday</span>
 instances, so it doesn’t need multiple sections. To set the number of sections in the table view, we just need to return <span class="code">1</span>
 .</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func numberOfSections(in tableView: UITableView) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 <span class="blue1">1</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent"><span id="page_164"></span>
 This method takes a <span class="code">UITableView</span>
 called <span class="code">tableView</span>
 as a parameter, which is the table view that uses this class as its data source. We don’t need to worry about making this connection because the <span class="code">UITableViewController</span>
 comes with a built-in table view that is automatically hooked up to these methods. Each birthday will be displayed in its own row. So in <span class="code">tableView(_:numberOfRowsInSection:)</span>
 , in order to have the right number of rows for all of your birthdays, you need to return the number of <span class="code">Birthday</span>
 instances that you have in your <span class="code">birthdays</span>
 array. Do you remember the <span class="code">count</span>
 property of an array? It’s an integer that tells you how many items are in that array, and it’s perfect for this situation! Change this method to the following:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, <img class="inline" src="Image00184.jpg" />
<br />
    numberOfRowsInSection section: Int) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 birthdays.<span class="violet">count</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">In addition to the <span class="code">tableView</span>
 parameter, <span class="code">tableView(_:numberOfRowsInSection:)</span>
 also takes an <span class="code">Int</span>
 called <span class="code">section</span>
 . When the table view is loading itself, this method is called for each section in the table view. In our case, we have only one section, so we don’t need to bother checking which <span class="code">section</span>
 of the table view is being displayed here. We know it’s section 0, and we want it to have as many rows as there are birthdays, so we write <span class="code">return birthdays.count</span>
 .</p>
<p class="indent">Finally, you need to implement <span class="code">tableView(_:cellForRowAt:)</span>
 so that the table view will know what to put inside each cell. Since this method is commented out, you need to uncomment it by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it. (Be careful not to accidentally uncomment the other methods after it!) After you’ve done that, change it to the following code:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, cellForRowAt <img class="inline" src="Image00184.jpg" />
<br />
    indexPath: IndexPath) -&gt; UITableViewCell {</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="pink">let</span>
 cell = tableView.<span class="blue">dequeueReusableCell</span>
 (withIdentifier: <img class="inline" src="Image00093.jpg" />
<br />
        <span class="red">"birthdayCellIdentifier"</span>
 , for: indexPath)<br />
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 birthday = <span class="green1">birthdays</span>
 [indexPath.<span class="violet">row</span>
 ]<br />
<br />
  <span class="ent">➌</span>
 cell.<span class="violet">textLabel</span>
 ?.<span class="violet">text</span>
 = birthday.<span class="green1">firstName</span>
 <span class="blue">+</span>
 <span class="red">" "</span>
 <span class="blue">+</span>
 <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">lastName</span>
<br />
<br />
  <span class="ent">➍</span>
 cell.<span class="violet">detailTextLabel</span>
 ?.<span class="violet">text</span>
 = <span class="green1">dateFormatter</span>
 .<span class="blue">string</span>
 (from: <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">birthdate</span>
 )<br />
<br />
  <span class="ent">➎</span>
 <span class="pink">return</span>
 cell<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">You don’t call the method <span class="code">tableView(_:cellForRowAt:)</span>
 . It’s called when the table view is loaded onto the screen. It’s called for each cell on the screen and takes two parameters, <span class="code">tableView</span>
 and <span class="code">indexPath</span>
 . You already know <span id="page_165"></span>
 what the <span class="code">tableView</span>
 parameter is for. An <span class="code">IndexPath</span>
 is a Swift struct that’s used to represent a row’s position in a table view. An <span class="code">IndexPath</span>
 instance has a <span class="code">section</span>
 property and a <span class="code">row</span>
 property. Since this method will be called many times (once for every row in the table), we need the <span class="code">indexPath</span>
 to know which section and row we’re currently configuring. The <span class="code">indexPath.section</span>
 property gives the section number, and the <span class="code">indexPath.row</span>
 gives the row of the table view cell. The five lines of code inside <span class="code">tableView(_:cellForRowAt:)</span>
 will do the following:</p>
<div class="image"><img src="Image00244.jpg" />
</div>
<p class="bull">• Create a <span class="code">UITableViewCell</span>
</p>
<p class="bull">• Figure out which <span class="code">Birthday</span>
 in the <span class="code">birthdays</span>
 array will be displayed inside the cell</p>
<p class="bull">• Make two labels to display the birthday person’s name and birthdate in the cell</p>
<p class="bull">• Return the cell ready for display in the table view</p>
<p class="indentt">Let’s go through this code line by line.</p>
<p class="indent">First, create the <span class="code">UITableViewCell</span>
 . The code at <span class="ent">➊</span>
 does this using the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 . Before you can start using this method on a cell, though, you need to tell the method which cell you want to use from the storyboard. Earlier, when you were in the storyboard, you gave your cell the identifier <span class="code">birthdayCellIdentifier</span>
 (see <a href="text00022.html#ch11fig4">Figure 11-4</a>
 ). This identifier links your code to the cell and tells your method that it’s using the right cell. The string for when you call this method needs to be exactly the same as the string you set in the storyboard, or you’ll get an error and the app will crash when you run it.</p>
<p class="indent">In the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 , did you notice the words <em>Reusable Cell</em>
 ? The cells inside a table view are created once and then can be reused over and over. This helps everything run faster and smoother because creating the cell is what takes the most time. If you had 200 birthdays in your app, but only 10 would fit on your screen at one time, then you need only 10 cells to show your birthdays. When you scroll down to reveal more birthdays, the cells that scroll off the top of the screen are reused. They are filled with new information and show up again at the bottom of the screen. The <span class="code">UITableView</span>
 automatically does this work. When the table view is loaded, <span class="code">tableView(_:cellForRowAt:)</span>
 is called for every visible row. When the user scrolls to look at more cells, it’s called again for each row just as it is about to appear on the screen.</p>
<p class="indent">Next, we need to find out which <span class="code">Birthday</span>
 should be displayed inside the cell. We want to display one birthday from the <span class="code">birthdays</span>
 array in each row. The first birthday, which is at <span class="code">birthdays[0]</span>
 , should be displayed in row 0. The second birthday, at <span class="code">birthdays[1]</span>
 , should be displayed in row 1, and so on, which means the <span class="code">indexPath</span>
 ’s <span class="code">row</span>
 is the same as the position in the <span class="code">birthdays</span>
 array that we want to access. The code at <span class="ent">➋</span>
 accesses the <span id="page_166"></span>
 correct <span class="code">Birthday</span>
 object from the <span class="code">birthdays</span>
 array by using <span class="code">indexPath.row</span>
 . Once we have the right <span class="code">Birthday</span>
 object, we assign it to a constant named <span class="code">birthday</span>
 so we can set up the labels in this cell.</p>
<p class="indent">Notice that we’re using <span class="code">let</span>
 to assign the <span class="code">birthday</span>
 to a constant instead of a variable. We can use <span class="code">let</span>
 because each time <span class="code">tableView(_:cellForRowAt:)</span>
 is called, a new <span class="code">birthday</span>
 constant is created. Each cell gets its own <span class="code">birthday</span>
 constant that is assigned its own <span class="code">Birthday</span>
 object. Since we’re not going to change any of the <span class="code">birthday</span>
 constants—we’re just going to read their properties—we don’t want to make them variables.</p>
<p class="indent">Now that you have your cell and your birthday, it’s time to fill in the details. You need two labels for each cell to show the birthday person’s name and birthdate. You set the cell to the Subtitle style so that it has a Title label and a Subtitle label. Each cell will already contain these labels, so now you don’t have to create any labels yourself.</p>
<p class="indent">The labels exist as properties of <span class="code">UITableViewCell</span>
 and are called <span class="code">textLabel</span>
 and <span class="code">detailTextLabel</span>
 . The code at <span class="ent">➌</span>
 sets the text of the <span class="code">textLabel</span>
 to a string made up of the <span class="code">firstName</span>
 and <span class="code">lastName</span>
 of the <span class="code">birthday</span>
 with a space between them. At <span class="ent">➍</span>
 , you use the <span class="code">string(from:)</span>
 method of the <span class="code">dateFormatter</span>
 to display the birthdate in the <span class="code">detailTextLabel</span>
 .</p>
<p class="indent">When your cell is completely configured, <span class="code">tableView( _:cellForRowAt:)</span>
 returns the cell at <span class="ent">➎</span>
 so that it can be displayed at that <span class="code">indexPath</span>
 of the table view.</p>
<h3 class="h3" id="ch11lev1sec2">
<strong>PUTTING IT ALL TOGETHER</strong>
</h3>
<p class="noindent">Now you can add <span class="code">Birthday</span>
 instances to the app using the Add Birthday view controller, and you have a table view to list each <span class="code">Birthday</span>
 in the Birthdays table view controller. But when you try running the app and adding a <span class="code">Birthday</span>
 , it doesn’t appear. To make each <span class="code">Birthday</span>
 you add appear in the table view, you need to make the Add Birthday view controller communicate with the Birthdays table view controller. You do this by using <em>delegation</em>
 .</p>
<h4 class="h4" id="ch11lev2sec5">
<strong>DELEGATION</strong>
</h4>
<p class="noindent">Delegation can be used when one view controller needs to get information from another view controller. Say you have two view controllers: A and B. The first view controller, A, creates B and presents B on top of itself. A knows about B because it created and presented B, so A can pass information along to B. But B doesn’t know about A—it’s just popped into being and doesn’t know where it came from or how it got there. So how can B talk to A? Through delegation!</p>
<div class="image"><img src="Image00245.jpg" />
</div>
<p class="indent">Delegation is when someone gives a job or a task to someone else. A <em>delegate</em>
 is like a boss who tells a delegating employee what to do. When the delegating employee is done with their task, sometimes they’ll report information back to the delegate boss.</p>
<p class="indent"><span id="page_167"></span>
 Delegation in Swift is pretty similar, but instead of having a boss and employee, we have a delegate and a delegating object. Since class B is the one being told what to do by class A, it’s the delegating object. We give class B a special property called a delegate to tell it who its delegate is—that way, it knows who to communicate with. The delegate can be any class that has a set of methods that have been defined in a <em>protocol</em>
 . A protocol is like an agreement between the two classes that tells them what the delegate can ask the delegating object to do. It has a list of method and property names that the delegate can use with the delegating object.</p>
<p class="indent">Class A creates class B, makes itself the delegate of class B, and gives class B a job to do that’s in the protocol. Once class B is done with its job, it reports back to class A. Let’s see how this works in our app.</p>
<p class="indent">The Birthdays table view controller is view controller A, and the Add Birthday view controller is view controller B. We’ll create a protocol called <span class="code">AddBirthdayViewControllerDelegate</span>
 and a method for that protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 , which the Add Birthday view controller will use to report back.</p>
<p class="indent">Take a look at <a href="text00022.html#ch11fig6">Figure 11-6</a>
 . When the user taps the Add button <span class="ent">➊</span>
 , the Birthdays table view controller creates the Add Birthday view controller <span class="ent">➋</span>
 and sets itself as the Add Birthday view controller’s delegate.</p>
<div class="image"><img src="Image00246.jpg" />
</div>
<p class="figcap"><a id="ch11fig6"></a>
 <em>Figure 11-6: A new birthday is added and passed from the Add Birthday view controller to the Birthdays table view controller using delegation.</em>
</p>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="indent">Let’s start with the method <span class="code">numberOfSections(in:)</span>
 . The Birthdays table view controller is a list that just displays <span class="code">Birthday</span>
 instances, so it doesn’t need multiple sections. To set the number of sections in the table view, we just need to return <span class="code">1</span>
 .</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func numberOfSections(in tableView: UITableView) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 <span class="blue1">1</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent"><span id="page_164"></span>
 This method takes a <span class="code">UITableView</span>
 called <span class="code">tableView</span>
 as a parameter, which is the table view that uses this class as its data source. We don’t need to worry about making this connection because the <span class="code">UITableViewController</span>
 comes with a built-in table view that is automatically hooked up to these methods. Each birthday will be displayed in its own row. So in <span class="code">tableView(_:numberOfRowsInSection:)</span>
 , in order to have the right number of rows for all of your birthdays, you need to return the number of <span class="code">Birthday</span>
 instances that you have in your <span class="code">birthdays</span>
 array. Do you remember the <span class="code">count</span>
 property of an array? It’s an integer that tells you how many items are in that array, and it’s perfect for this situation! Change this method to the following:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, <img class="inline" src="Image00184.jpg" />
<br />
    numberOfRowsInSection section: Int) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 birthdays.<span class="violet">count</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">In addition to the <span class="code">tableView</span>
 parameter, <span class="code">tableView(_:numberOfRowsInSection:)</span>
 also takes an <span class="code">Int</span>
 called <span class="code">section</span>
 . When the table view is loading itself, this method is called for each section in the table view. In our case, we have only one section, so we don’t need to bother checking which <span class="code">section</span>
 of the table view is being displayed here. We know it’s section 0, and we want it to have as many rows as there are birthdays, so we write <span class="code">return birthdays.count</span>
 .</p>
<p class="indent">Finally, you need to implement <span class="code">tableView(_:cellForRowAt:)</span>
 so that the table view will know what to put inside each cell. Since this method is commented out, you need to uncomment it by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it. (Be careful not to accidentally uncomment the other methods after it!) After you’ve done that, change it to the following code:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, cellForRowAt <img class="inline" src="Image00184.jpg" />
<br />
    indexPath: IndexPath) -&gt; UITableViewCell {</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="pink">let</span>
 cell = tableView.<span class="blue">dequeueReusableCell</span>
 (withIdentifier: <img class="inline" src="Image00093.jpg" />
<br />
        <span class="red">"birthdayCellIdentifier"</span>
 , for: indexPath)<br />
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 birthday = <span class="green1">birthdays</span>
 [indexPath.<span class="violet">row</span>
 ]<br />
<br />
  <span class="ent">➌</span>
 cell.<span class="violet">textLabel</span>
 ?.<span class="violet">text</span>
 = birthday.<span class="green1">firstName</span>
 <span class="blue">+</span>
 <span class="red">" "</span>
 <span class="blue">+</span>
 <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">lastName</span>
<br />
<br />
  <span class="ent">➍</span>
 cell.<span class="violet">detailTextLabel</span>
 ?.<span class="violet">text</span>
 = <span class="green1">dateFormatter</span>
 .<span class="blue">string</span>
 (from: <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">birthdate</span>
 )<br />
<br />
  <span class="ent">➎</span>
 <span class="pink">return</span>
 cell<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">You don’t call the method <span class="code">tableView(_:cellForRowAt:)</span>
 . It’s called when the table view is loaded onto the screen. It’s called for each cell on the screen and takes two parameters, <span class="code">tableView</span>
 and <span class="code">indexPath</span>
 . You already know <span id="page_165"></span>
 what the <span class="code">tableView</span>
 parameter is for. An <span class="code">IndexPath</span>
 is a Swift struct that’s used to represent a row’s position in a table view. An <span class="code">IndexPath</span>
 instance has a <span class="code">section</span>
 property and a <span class="code">row</span>
 property. Since this method will be called many times (once for every row in the table), we need the <span class="code">indexPath</span>
 to know which section and row we’re currently configuring. The <span class="code">indexPath.section</span>
 property gives the section number, and the <span class="code">indexPath.row</span>
 gives the row of the table view cell. The five lines of code inside <span class="code">tableView(_:cellForRowAt:)</span>
 will do the following:</p>
<div class="image"><img src="Image00244.jpg" />
</div>
<p class="bull">• Create a <span class="code">UITableViewCell</span>
</p>
<p class="bull">• Figure out which <span class="code">Birthday</span>
 in the <span class="code">birthdays</span>
 array will be displayed inside the cell</p>
<p class="bull">• Make two labels to display the birthday person’s name and birthdate in the cell</p>
<p class="bull">• Return the cell ready for display in the table view</p>
<p class="indentt">Let’s go through this code line by line.</p>
<p class="indent">First, create the <span class="code">UITableViewCell</span>
 . The code at <span class="ent">➊</span>
 does this using the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 . Before you can start using this method on a cell, though, you need to tell the method which cell you want to use from the storyboard. Earlier, when you were in the storyboard, you gave your cell the identifier <span class="code">birthdayCellIdentifier</span>
 (see <a href="text00022.html#ch11fig4">Figure 11-4</a>
 ). This identifier links your code to the cell and tells your method that it’s using the right cell. The string for when you call this method needs to be exactly the same as the string you set in the storyboard, or you’ll get an error and the app will crash when you run it.</p>
<p class="indent">In the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 , did you notice the words <em>Reusable Cell</em>
 ? The cells inside a table view are created once and then can be reused over and over. This helps everything run faster and smoother because creating the cell is what takes the most time. If you had 200 birthdays in your app, but only 10 would fit on your screen at one time, then you need only 10 cells to show your birthdays. When you scroll down to reveal more birthdays, the cells that scroll off the top of the screen are reused. They are filled with new information and show up again at the bottom of the screen. The <span class="code">UITableView</span>
 automatically does this work. When the table view is loaded, <span class="code">tableView(_:cellForRowAt:)</span>
 is called for every visible row. When the user scrolls to look at more cells, it’s called again for each row just as it is about to appear on the screen.</p>
<p class="indent">Next, we need to find out which <span class="code">Birthday</span>
 should be displayed inside the cell. We want to display one birthday from the <span class="code">birthdays</span>
 array in each row. The first birthday, which is at <span class="code">birthdays[0]</span>
 , should be displayed in row 0. The second birthday, at <span class="code">birthdays[1]</span>
 , should be displayed in row 1, and so on, which means the <span class="code">indexPath</span>
 ’s <span class="code">row</span>
 is the same as the position in the <span class="code">birthdays</span>
 array that we want to access. The code at <span class="ent">➋</span>
 accesses the <span id="page_166"></span>
 correct <span class="code">Birthday</span>
 object from the <span class="code">birthdays</span>
 array by using <span class="code">indexPath.row</span>
 . Once we have the right <span class="code">Birthday</span>
 object, we assign it to a constant named <span class="code">birthday</span>
 so we can set up the labels in this cell.</p>
<p class="indent">Notice that we’re using <span class="code">let</span>
 to assign the <span class="code">birthday</span>
 to a constant instead of a variable. We can use <span class="code">let</span>
 because each time <span class="code">tableView(_:cellForRowAt:)</span>
 is called, a new <span class="code">birthday</span>
 constant is created. Each cell gets its own <span class="code">birthday</span>
 constant that is assigned its own <span class="code">Birthday</span>
 object. Since we’re not going to change any of the <span class="code">birthday</span>
 constants—we’re just going to read their properties—we don’t want to make them variables.</p>
<p class="indent">Now that you have your cell and your birthday, it’s time to fill in the details. You need two labels for each cell to show the birthday person’s name and birthdate. You set the cell to the Subtitle style so that it has a Title label and a Subtitle label. Each cell will already contain these labels, so now you don’t have to create any labels yourself.</p>
<p class="indent">The labels exist as properties of <span class="code">UITableViewCell</span>
 and are called <span class="code">textLabel</span>
 and <span class="code">detailTextLabel</span>
 . The code at <span class="ent">➌</span>
 sets the text of the <span class="code">textLabel</span>
 to a string made up of the <span class="code">firstName</span>
 and <span class="code">lastName</span>
 of the <span class="code">birthday</span>
 with a space between them. At <span class="ent">➍</span>
 , you use the <span class="code">string(from:)</span>
 method of the <span class="code">dateFormatter</span>
 to display the birthdate in the <span class="code">detailTextLabel</span>
 .</p>
<p class="indent">When your cell is completely configured, <span class="code">tableView( _:cellForRowAt:)</span>
 returns the cell at <span class="ent">➎</span>
 so that it can be displayed at that <span class="code">indexPath</span>
 of the table view.</p>
<h3 class="h3" id="ch11lev1sec2">
<strong>PUTTING IT ALL TOGETHER</strong>
</h3>
<p class="noindent">Now you can add <span class="code">Birthday</span>
 instances to the app using the Add Birthday view controller, and you have a table view to list each <span class="code">Birthday</span>
 in the Birthdays table view controller. But when you try running the app and adding a <span class="code">Birthday</span>
 , it doesn’t appear. To make each <span class="code">Birthday</span>
 you add appear in the table view, you need to make the Add Birthday view controller communicate with the Birthdays table view controller. You do this by using <em>delegation</em>
 .</p>
<h4 class="h4" id="ch11lev2sec5">
<strong>DELEGATION</strong>
</h4>
<p class="noindent">Delegation can be used when one view controller needs to get information from another view controller. Say you have two view controllers: A and B. The first view controller, A, creates B and presents B on top of itself. A knows about B because it created and presented B, so A can pass information along to B. But B doesn’t know about A—it’s just popped into being and doesn’t know where it came from or how it got there. So how can B talk to A? Through delegation!</p>
<div class="image"><img src="Image00245.jpg" />
</div>
<p class="indent">Delegation is when someone gives a job or a task to someone else. A <em>delegate</em>
 is like a boss who tells a delegating employee what to do. When the delegating employee is done with their task, sometimes they’ll report information back to the delegate boss.</p>
<p class="indent"><span id="page_167"></span>
 Delegation in Swift is pretty similar, but instead of having a boss and employee, we have a delegate and a delegating object. Since class B is the one being told what to do by class A, it’s the delegating object. We give class B a special property called a delegate to tell it who its delegate is—that way, it knows who to communicate with. The delegate can be any class that has a set of methods that have been defined in a <em>protocol</em>
 . A protocol is like an agreement between the two classes that tells them what the delegate can ask the delegating object to do. It has a list of method and property names that the delegate can use with the delegating object.</p>
<p class="indent">Class A creates class B, makes itself the delegate of class B, and gives class B a job to do that’s in the protocol. Once class B is done with its job, it reports back to class A. Let’s see how this works in our app.</p>
<p class="indent">The Birthdays table view controller is view controller A, and the Add Birthday view controller is view controller B. We’ll create a protocol called <span class="code">AddBirthdayViewControllerDelegate</span>
 and a method for that protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 , which the Add Birthday view controller will use to report back.</p>
<p class="indent">Take a look at <a href="text00022.html#ch11fig6">Figure 11-6</a>
 . When the user taps the Add button <span class="ent">➊</span>
 , the Birthdays table view controller creates the Add Birthday view controller <span class="ent">➋</span>
 and sets itself as the Add Birthday view controller’s delegate.</p>
<div class="image"><img src="Image00246.jpg" />
</div>
<p class="figcap"><a id="ch11fig6"></a>
 <em>Figure 11-6: A new birthday is added and passed from the Add Birthday view controller to the Birthdays table view controller using delegation.</em>
</p>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func numberOfSections(in tableView: UITableView) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 <span class="blue1">1</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent"><span id="page_164"></span>
 This method takes a <span class="code">UITableView</span>
 called <span class="code">tableView</span>
 as a parameter, which is the table view that uses this class as its data source. We don’t need to worry about making this connection because the <span class="code">UITableViewController</span>
 comes with a built-in table view that is automatically hooked up to these methods. Each birthday will be displayed in its own row. So in <span class="code">tableView(_:numberOfRowsInSection:)</span>
 , in order to have the right number of rows for all of your birthdays, you need to return the number of <span class="code">Birthday</span>
 instances that you have in your <span class="code">birthdays</span>
 array. Do you remember the <span class="code">count</span>
 property of an array? It’s an integer that tells you how many items are in that array, and it’s perfect for this situation! Change this method to the following:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, <img class="inline" src="Image00184.jpg" />
<br />
    numberOfRowsInSection section: Int) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 birthdays.<span class="violet">count</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">In addition to the <span class="code">tableView</span>
 parameter, <span class="code">tableView(_:numberOfRowsInSection:)</span>
 also takes an <span class="code">Int</span>
 called <span class="code">section</span>
 . When the table view is loading itself, this method is called for each section in the table view. In our case, we have only one section, so we don’t need to bother checking which <span class="code">section</span>
 of the table view is being displayed here. We know it’s section 0, and we want it to have as many rows as there are birthdays, so we write <span class="code">return birthdays.count</span>
 .</p>
<p class="indent">Finally, you need to implement <span class="code">tableView(_:cellForRowAt:)</span>
 so that the table view will know what to put inside each cell. Since this method is commented out, you need to uncomment it by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it. (Be careful not to accidentally uncomment the other methods after it!) After you’ve done that, change it to the following code:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, cellForRowAt <img class="inline" src="Image00184.jpg" />
<br />
    indexPath: IndexPath) -&gt; UITableViewCell {</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="pink">let</span>
 cell = tableView.<span class="blue">dequeueReusableCell</span>
 (withIdentifier: <img class="inline" src="Image00093.jpg" />
<br />
        <span class="red">"birthdayCellIdentifier"</span>
 , for: indexPath)<br />
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 birthday = <span class="green1">birthdays</span>
 [indexPath.<span class="violet">row</span>
 ]<br />
<br />
  <span class="ent">➌</span>
 cell.<span class="violet">textLabel</span>
 ?.<span class="violet">text</span>
 = birthday.<span class="green1">firstName</span>
 <span class="blue">+</span>
 <span class="red">" "</span>
 <span class="blue">+</span>
 <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">lastName</span>
<br />
<br />
  <span class="ent">➍</span>
 cell.<span class="violet">detailTextLabel</span>
 ?.<span class="violet">text</span>
 = <span class="green1">dateFormatter</span>
 .<span class="blue">string</span>
 (from: <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">birthdate</span>
 )<br />
<br />
  <span class="ent">➎</span>
 <span class="pink">return</span>
 cell<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">You don’t call the method <span class="code">tableView(_:cellForRowAt:)</span>
 . It’s called when the table view is loaded onto the screen. It’s called for each cell on the screen and takes two parameters, <span class="code">tableView</span>
 and <span class="code">indexPath</span>
 . You already know <span id="page_165"></span>
 what the <span class="code">tableView</span>
 parameter is for. An <span class="code">IndexPath</span>
 is a Swift struct that’s used to represent a row’s position in a table view. An <span class="code">IndexPath</span>
 instance has a <span class="code">section</span>
 property and a <span class="code">row</span>
 property. Since this method will be called many times (once for every row in the table), we need the <span class="code">indexPath</span>
 to know which section and row we’re currently configuring. The <span class="code">indexPath.section</span>
 property gives the section number, and the <span class="code">indexPath.row</span>
 gives the row of the table view cell. The five lines of code inside <span class="code">tableView(_:cellForRowAt:)</span>
 will do the following:</p>
<div class="image"><img src="Image00244.jpg" />
</div>
<p class="bull">• Create a <span class="code">UITableViewCell</span>
</p>
<p class="bull">• Figure out which <span class="code">Birthday</span>
 in the <span class="code">birthdays</span>
 array will be displayed inside the cell</p>
<p class="bull">• Make two labels to display the birthday person’s name and birthdate in the cell</p>
<p class="bull">• Return the cell ready for display in the table view</p>
<p class="indentt">Let’s go through this code line by line.</p>
<p class="indent">First, create the <span class="code">UITableViewCell</span>
 . The code at <span class="ent">➊</span>
 does this using the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 . Before you can start using this method on a cell, though, you need to tell the method which cell you want to use from the storyboard. Earlier, when you were in the storyboard, you gave your cell the identifier <span class="code">birthdayCellIdentifier</span>
 (see <a href="text00022.html#ch11fig4">Figure 11-4</a>
 ). This identifier links your code to the cell and tells your method that it’s using the right cell. The string for when you call this method needs to be exactly the same as the string you set in the storyboard, or you’ll get an error and the app will crash when you run it.</p>
<p class="indent">In the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 , did you notice the words <em>Reusable Cell</em>
 ? The cells inside a table view are created once and then can be reused over and over. This helps everything run faster and smoother because creating the cell is what takes the most time. If you had 200 birthdays in your app, but only 10 would fit on your screen at one time, then you need only 10 cells to show your birthdays. When you scroll down to reveal more birthdays, the cells that scroll off the top of the screen are reused. They are filled with new information and show up again at the bottom of the screen. The <span class="code">UITableView</span>
 automatically does this work. When the table view is loaded, <span class="code">tableView(_:cellForRowAt:)</span>
 is called for every visible row. When the user scrolls to look at more cells, it’s called again for each row just as it is about to appear on the screen.</p>
<p class="indent">Next, we need to find out which <span class="code">Birthday</span>
 should be displayed inside the cell. We want to display one birthday from the <span class="code">birthdays</span>
 array in each row. The first birthday, which is at <span class="code">birthdays[0]</span>
 , should be displayed in row 0. The second birthday, at <span class="code">birthdays[1]</span>
 , should be displayed in row 1, and so on, which means the <span class="code">indexPath</span>
 ’s <span class="code">row</span>
 is the same as the position in the <span class="code">birthdays</span>
 array that we want to access. The code at <span class="ent">➋</span>
 accesses the <span id="page_166"></span>
 correct <span class="code">Birthday</span>
 object from the <span class="code">birthdays</span>
 array by using <span class="code">indexPath.row</span>
 . Once we have the right <span class="code">Birthday</span>
 object, we assign it to a constant named <span class="code">birthday</span>
 so we can set up the labels in this cell.</p>
<p class="indent">Notice that we’re using <span class="code">let</span>
 to assign the <span class="code">birthday</span>
 to a constant instead of a variable. We can use <span class="code">let</span>
 because each time <span class="code">tableView(_:cellForRowAt:)</span>
 is called, a new <span class="code">birthday</span>
 constant is created. Each cell gets its own <span class="code">birthday</span>
 constant that is assigned its own <span class="code">Birthday</span>
 object. Since we’re not going to change any of the <span class="code">birthday</span>
 constants—we’re just going to read their properties—we don’t want to make them variables.</p>
<p class="indent">Now that you have your cell and your birthday, it’s time to fill in the details. You need two labels for each cell to show the birthday person’s name and birthdate. You set the cell to the Subtitle style so that it has a Title label and a Subtitle label. Each cell will already contain these labels, so now you don’t have to create any labels yourself.</p>
<p class="indent">The labels exist as properties of <span class="code">UITableViewCell</span>
 and are called <span class="code">textLabel</span>
 and <span class="code">detailTextLabel</span>
 . The code at <span class="ent">➌</span>
 sets the text of the <span class="code">textLabel</span>
 to a string made up of the <span class="code">firstName</span>
 and <span class="code">lastName</span>
 of the <span class="code">birthday</span>
 with a space between them. At <span class="ent">➍</span>
 , you use the <span class="code">string(from:)</span>
 method of the <span class="code">dateFormatter</span>
 to display the birthdate in the <span class="code">detailTextLabel</span>
 .</p>
<p class="indent">When your cell is completely configured, <span class="code">tableView( _:cellForRowAt:)</span>
 returns the cell at <span class="ent">➎</span>
 so that it can be displayed at that <span class="code">indexPath</span>
 of the table view.</p>
<h3 class="h3" id="ch11lev1sec2">
<strong>PUTTING IT ALL TOGETHER</strong>
</h3>
<p class="noindent">Now you can add <span class="code">Birthday</span>
 instances to the app using the Add Birthday view controller, and you have a table view to list each <span class="code">Birthday</span>
 in the Birthdays table view controller. But when you try running the app and adding a <span class="code">Birthday</span>
 , it doesn’t appear. To make each <span class="code">Birthday</span>
 you add appear in the table view, you need to make the Add Birthday view controller communicate with the Birthdays table view controller. You do this by using <em>delegation</em>
 .</p>
<h4 class="h4" id="ch11lev2sec5">
<strong>DELEGATION</strong>
</h4>
<p class="noindent">Delegation can be used when one view controller needs to get information from another view controller. Say you have two view controllers: A and B. The first view controller, A, creates B and presents B on top of itself. A knows about B because it created and presented B, so A can pass information along to B. But B doesn’t know about A—it’s just popped into being and doesn’t know where it came from or how it got there. So how can B talk to A? Through delegation!</p>
<div class="image"><img src="Image00245.jpg" />
</div>
<p class="indent">Delegation is when someone gives a job or a task to someone else. A <em>delegate</em>
 is like a boss who tells a delegating employee what to do. When the delegating employee is done with their task, sometimes they’ll report information back to the delegate boss.</p>
<p class="indent"><span id="page_167"></span>
 Delegation in Swift is pretty similar, but instead of having a boss and employee, we have a delegate and a delegating object. Since class B is the one being told what to do by class A, it’s the delegating object. We give class B a special property called a delegate to tell it who its delegate is—that way, it knows who to communicate with. The delegate can be any class that has a set of methods that have been defined in a <em>protocol</em>
 . A protocol is like an agreement between the two classes that tells them what the delegate can ask the delegating object to do. It has a list of method and property names that the delegate can use with the delegating object.</p>
<p class="indent">Class A creates class B, makes itself the delegate of class B, and gives class B a job to do that’s in the protocol. Once class B is done with its job, it reports back to class A. Let’s see how this works in our app.</p>
<p class="indent">The Birthdays table view controller is view controller A, and the Add Birthday view controller is view controller B. We’ll create a protocol called <span class="code">AddBirthdayViewControllerDelegate</span>
 and a method for that protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 , which the Add Birthday view controller will use to report back.</p>
<p class="indent">Take a look at <a href="text00022.html#ch11fig6">Figure 11-6</a>
 . When the user taps the Add button <span class="ent">➊</span>
 , the Birthdays table view controller creates the Add Birthday view controller <span class="ent">➋</span>
 and sets itself as the Add Birthday view controller’s delegate.</p>
<div class="image"><img src="Image00246.jpg" />
</div>
<p class="figcap"><a id="ch11fig6"></a>
 <em>Figure 11-6: A new birthday is added and passed from the Add Birthday view controller to the Birthdays table view controller using delegation.</em>
</p>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<div class="box">
<pre>
<span class="ash">override func numberOfSections(in tableView: UITableView) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 <span class="blue1">1</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent"><span id="page_164"></span>
 This method takes a <span class="code">UITableView</span>
 called <span class="code">tableView</span>
 as a parameter, which is the table view that uses this class as its data source. We don’t need to worry about making this connection because the <span class="code">UITableViewController</span>
 comes with a built-in table view that is automatically hooked up to these methods. Each birthday will be displayed in its own row. So in <span class="code">tableView(_:numberOfRowsInSection:)</span>
 , in order to have the right number of rows for all of your birthdays, you need to return the number of <span class="code">Birthday</span>
 instances that you have in your <span class="code">birthdays</span>
 array. Do you remember the <span class="code">count</span>
 property of an array? It’s an integer that tells you how many items are in that array, and it’s perfect for this situation! Change this method to the following:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, <img class="inline" src="Image00184.jpg" />
<br />
    numberOfRowsInSection section: Int) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 birthdays.<span class="violet">count</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">In addition to the <span class="code">tableView</span>
 parameter, <span class="code">tableView(_:numberOfRowsInSection:)</span>
 also takes an <span class="code">Int</span>
 called <span class="code">section</span>
 . When the table view is loading itself, this method is called for each section in the table view. In our case, we have only one section, so we don’t need to bother checking which <span class="code">section</span>
 of the table view is being displayed here. We know it’s section 0, and we want it to have as many rows as there are birthdays, so we write <span class="code">return birthdays.count</span>
 .</p>
<p class="indent">Finally, you need to implement <span class="code">tableView(_:cellForRowAt:)</span>
 so that the table view will know what to put inside each cell. Since this method is commented out, you need to uncomment it by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it. (Be careful not to accidentally uncomment the other methods after it!) After you’ve done that, change it to the following code:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, cellForRowAt <img class="inline" src="Image00184.jpg" />
<br />
    indexPath: IndexPath) -&gt; UITableViewCell {</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="pink">let</span>
 cell = tableView.<span class="blue">dequeueReusableCell</span>
 (withIdentifier: <img class="inline" src="Image00093.jpg" />
<br />
        <span class="red">"birthdayCellIdentifier"</span>
 , for: indexPath)<br />
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 birthday = <span class="green1">birthdays</span>
 [indexPath.<span class="violet">row</span>
 ]<br />
<br />
  <span class="ent">➌</span>
 cell.<span class="violet">textLabel</span>
 ?.<span class="violet">text</span>
 = birthday.<span class="green1">firstName</span>
 <span class="blue">+</span>
 <span class="red">" "</span>
 <span class="blue">+</span>
 <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">lastName</span>
<br />
<br />
  <span class="ent">➍</span>
 cell.<span class="violet">detailTextLabel</span>
 ?.<span class="violet">text</span>
 = <span class="green1">dateFormatter</span>
 .<span class="blue">string</span>
 (from: <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">birthdate</span>
 )<br />
<br />
  <span class="ent">➎</span>
 <span class="pink">return</span>
 cell<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">You don’t call the method <span class="code">tableView(_:cellForRowAt:)</span>
 . It’s called when the table view is loaded onto the screen. It’s called for each cell on the screen and takes two parameters, <span class="code">tableView</span>
 and <span class="code">indexPath</span>
 . You already know <span id="page_165"></span>
 what the <span class="code">tableView</span>
 parameter is for. An <span class="code">IndexPath</span>
 is a Swift struct that’s used to represent a row’s position in a table view. An <span class="code">IndexPath</span>
 instance has a <span class="code">section</span>
 property and a <span class="code">row</span>
 property. Since this method will be called many times (once for every row in the table), we need the <span class="code">indexPath</span>
 to know which section and row we’re currently configuring. The <span class="code">indexPath.section</span>
 property gives the section number, and the <span class="code">indexPath.row</span>
 gives the row of the table view cell. The five lines of code inside <span class="code">tableView(_:cellForRowAt:)</span>
 will do the following:</p>
<div class="image"><img src="Image00244.jpg" />
</div>
<p class="bull">• Create a <span class="code">UITableViewCell</span>
</p>
<p class="bull">• Figure out which <span class="code">Birthday</span>
 in the <span class="code">birthdays</span>
 array will be displayed inside the cell</p>
<p class="bull">• Make two labels to display the birthday person’s name and birthdate in the cell</p>
<p class="bull">• Return the cell ready for display in the table view</p>
<p class="indentt">Let’s go through this code line by line.</p>
<p class="indent">First, create the <span class="code">UITableViewCell</span>
 . The code at <span class="ent">➊</span>
 does this using the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 . Before you can start using this method on a cell, though, you need to tell the method which cell you want to use from the storyboard. Earlier, when you were in the storyboard, you gave your cell the identifier <span class="code">birthdayCellIdentifier</span>
 (see <a href="text00022.html#ch11fig4">Figure 11-4</a>
 ). This identifier links your code to the cell and tells your method that it’s using the right cell. The string for when you call this method needs to be exactly the same as the string you set in the storyboard, or you’ll get an error and the app will crash when you run it.</p>
<p class="indent">In the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 , did you notice the words <em>Reusable Cell</em>
 ? The cells inside a table view are created once and then can be reused over and over. This helps everything run faster and smoother because creating the cell is what takes the most time. If you had 200 birthdays in your app, but only 10 would fit on your screen at one time, then you need only 10 cells to show your birthdays. When you scroll down to reveal more birthdays, the cells that scroll off the top of the screen are reused. They are filled with new information and show up again at the bottom of the screen. The <span class="code">UITableView</span>
 automatically does this work. When the table view is loaded, <span class="code">tableView(_:cellForRowAt:)</span>
 is called for every visible row. When the user scrolls to look at more cells, it’s called again for each row just as it is about to appear on the screen.</p>
<p class="indent">Next, we need to find out which <span class="code">Birthday</span>
 should be displayed inside the cell. We want to display one birthday from the <span class="code">birthdays</span>
 array in each row. The first birthday, which is at <span class="code">birthdays[0]</span>
 , should be displayed in row 0. The second birthday, at <span class="code">birthdays[1]</span>
 , should be displayed in row 1, and so on, which means the <span class="code">indexPath</span>
 ’s <span class="code">row</span>
 is the same as the position in the <span class="code">birthdays</span>
 array that we want to access. The code at <span class="ent">➋</span>
 accesses the <span id="page_166"></span>
 correct <span class="code">Birthday</span>
 object from the <span class="code">birthdays</span>
 array by using <span class="code">indexPath.row</span>
 . Once we have the right <span class="code">Birthday</span>
 object, we assign it to a constant named <span class="code">birthday</span>
 so we can set up the labels in this cell.</p>
<p class="indent">Notice that we’re using <span class="code">let</span>
 to assign the <span class="code">birthday</span>
 to a constant instead of a variable. We can use <span class="code">let</span>
 because each time <span class="code">tableView(_:cellForRowAt:)</span>
 is called, a new <span class="code">birthday</span>
 constant is created. Each cell gets its own <span class="code">birthday</span>
 constant that is assigned its own <span class="code">Birthday</span>
 object. Since we’re not going to change any of the <span class="code">birthday</span>
 constants—we’re just going to read their properties—we don’t want to make them variables.</p>
<p class="indent">Now that you have your cell and your birthday, it’s time to fill in the details. You need two labels for each cell to show the birthday person’s name and birthdate. You set the cell to the Subtitle style so that it has a Title label and a Subtitle label. Each cell will already contain these labels, so now you don’t have to create any labels yourself.</p>
<p class="indent">The labels exist as properties of <span class="code">UITableViewCell</span>
 and are called <span class="code">textLabel</span>
 and <span class="code">detailTextLabel</span>
 . The code at <span class="ent">➌</span>
 sets the text of the <span class="code">textLabel</span>
 to a string made up of the <span class="code">firstName</span>
 and <span class="code">lastName</span>
 of the <span class="code">birthday</span>
 with a space between them. At <span class="ent">➍</span>
 , you use the <span class="code">string(from:)</span>
 method of the <span class="code">dateFormatter</span>
 to display the birthdate in the <span class="code">detailTextLabel</span>
 .</p>
<p class="indent">When your cell is completely configured, <span class="code">tableView( _:cellForRowAt:)</span>
 returns the cell at <span class="ent">➎</span>
 so that it can be displayed at that <span class="code">indexPath</span>
 of the table view.</p>
<h3 class="h3" id="ch11lev1sec2">
<strong>PUTTING IT ALL TOGETHER</strong>
</h3>
<p class="noindent">Now you can add <span class="code">Birthday</span>
 instances to the app using the Add Birthday view controller, and you have a table view to list each <span class="code">Birthday</span>
 in the Birthdays table view controller. But when you try running the app and adding a <span class="code">Birthday</span>
 , it doesn’t appear. To make each <span class="code">Birthday</span>
 you add appear in the table view, you need to make the Add Birthday view controller communicate with the Birthdays table view controller. You do this by using <em>delegation</em>
 .</p>
<h4 class="h4" id="ch11lev2sec5">
<strong>DELEGATION</strong>
</h4>
<p class="noindent">Delegation can be used when one view controller needs to get information from another view controller. Say you have two view controllers: A and B. The first view controller, A, creates B and presents B on top of itself. A knows about B because it created and presented B, so A can pass information along to B. But B doesn’t know about A—it’s just popped into being and doesn’t know where it came from or how it got there. So how can B talk to A? Through delegation!</p>
<div class="image"><img src="Image00245.jpg" />
</div>
<p class="indent">Delegation is when someone gives a job or a task to someone else. A <em>delegate</em>
 is like a boss who tells a delegating employee what to do. When the delegating employee is done with their task, sometimes they’ll report information back to the delegate boss.</p>
<p class="indent"><span id="page_167"></span>
 Delegation in Swift is pretty similar, but instead of having a boss and employee, we have a delegate and a delegating object. Since class B is the one being told what to do by class A, it’s the delegating object. We give class B a special property called a delegate to tell it who its delegate is—that way, it knows who to communicate with. The delegate can be any class that has a set of methods that have been defined in a <em>protocol</em>
 . A protocol is like an agreement between the two classes that tells them what the delegate can ask the delegating object to do. It has a list of method and property names that the delegate can use with the delegating object.</p>
<p class="indent">Class A creates class B, makes itself the delegate of class B, and gives class B a job to do that’s in the protocol. Once class B is done with its job, it reports back to class A. Let’s see how this works in our app.</p>
<p class="indent">The Birthdays table view controller is view controller A, and the Add Birthday view controller is view controller B. We’ll create a protocol called <span class="code">AddBirthdayViewControllerDelegate</span>
 and a method for that protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 , which the Add Birthday view controller will use to report back.</p>
<p class="indent">Take a look at <a href="text00022.html#ch11fig6">Figure 11-6</a>
 . When the user taps the Add button <span class="ent">➊</span>
 , the Birthdays table view controller creates the Add Birthday view controller <span class="ent">➋</span>
 and sets itself as the Add Birthday view controller’s delegate.</p>
<div class="image"><img src="Image00246.jpg" />
</div>
<p class="figcap"><a id="ch11fig6"></a>
 <em>Figure 11-6: A new birthday is added and passed from the Add Birthday view controller to the Birthdays table view controller using delegation.</em>
</p>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="indent"><span id="page_164"></span>
 This method takes a <span class="code">UITableView</span>
 called <span class="code">tableView</span>
 as a parameter, which is the table view that uses this class as its data source. We don’t need to worry about making this connection because the <span class="code">UITableViewController</span>
 comes with a built-in table view that is automatically hooked up to these methods. Each birthday will be displayed in its own row. So in <span class="code">tableView(_:numberOfRowsInSection:)</span>
 , in order to have the right number of rows for all of your birthdays, you need to return the number of <span class="code">Birthday</span>
 instances that you have in your <span class="code">birthdays</span>
 array. Do you remember the <span class="code">count</span>
 property of an array? It’s an integer that tells you how many items are in that array, and it’s perfect for this situation! Change this method to the following:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, <img class="inline" src="Image00184.jpg" />
<br />
    numberOfRowsInSection section: Int) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 birthdays.<span class="violet">count</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">In addition to the <span class="code">tableView</span>
 parameter, <span class="code">tableView(_:numberOfRowsInSection:)</span>
 also takes an <span class="code">Int</span>
 called <span class="code">section</span>
 . When the table view is loading itself, this method is called for each section in the table view. In our case, we have only one section, so we don’t need to bother checking which <span class="code">section</span>
 of the table view is being displayed here. We know it’s section 0, and we want it to have as many rows as there are birthdays, so we write <span class="code">return birthdays.count</span>
 .</p>
<p class="indent">Finally, you need to implement <span class="code">tableView(_:cellForRowAt:)</span>
 so that the table view will know what to put inside each cell. Since this method is commented out, you need to uncomment it by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it. (Be careful not to accidentally uncomment the other methods after it!) After you’ve done that, change it to the following code:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, cellForRowAt <img class="inline" src="Image00184.jpg" />
<br />
    indexPath: IndexPath) -&gt; UITableViewCell {</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="pink">let</span>
 cell = tableView.<span class="blue">dequeueReusableCell</span>
 (withIdentifier: <img class="inline" src="Image00093.jpg" />
<br />
        <span class="red">"birthdayCellIdentifier"</span>
 , for: indexPath)<br />
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 birthday = <span class="green1">birthdays</span>
 [indexPath.<span class="violet">row</span>
 ]<br />
<br />
  <span class="ent">➌</span>
 cell.<span class="violet">textLabel</span>
 ?.<span class="violet">text</span>
 = birthday.<span class="green1">firstName</span>
 <span class="blue">+</span>
 <span class="red">" "</span>
 <span class="blue">+</span>
 <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">lastName</span>
<br />
<br />
  <span class="ent">➍</span>
 cell.<span class="violet">detailTextLabel</span>
 ?.<span class="violet">text</span>
 = <span class="green1">dateFormatter</span>
 .<span class="blue">string</span>
 (from: <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">birthdate</span>
 )<br />
<br />
  <span class="ent">➎</span>
 <span class="pink">return</span>
 cell<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">You don’t call the method <span class="code">tableView(_:cellForRowAt:)</span>
 . It’s called when the table view is loaded onto the screen. It’s called for each cell on the screen and takes two parameters, <span class="code">tableView</span>
 and <span class="code">indexPath</span>
 . You already know <span id="page_165"></span>
 what the <span class="code">tableView</span>
 parameter is for. An <span class="code">IndexPath</span>
 is a Swift struct that’s used to represent a row’s position in a table view. An <span class="code">IndexPath</span>
 instance has a <span class="code">section</span>
 property and a <span class="code">row</span>
 property. Since this method will be called many times (once for every row in the table), we need the <span class="code">indexPath</span>
 to know which section and row we’re currently configuring. The <span class="code">indexPath.section</span>
 property gives the section number, and the <span class="code">indexPath.row</span>
 gives the row of the table view cell. The five lines of code inside <span class="code">tableView(_:cellForRowAt:)</span>
 will do the following:</p>
<div class="image"><img src="Image00244.jpg" />
</div>
<p class="bull">• Create a <span class="code">UITableViewCell</span>
</p>
<p class="bull">• Figure out which <span class="code">Birthday</span>
 in the <span class="code">birthdays</span>
 array will be displayed inside the cell</p>
<p class="bull">• Make two labels to display the birthday person’s name and birthdate in the cell</p>
<p class="bull">• Return the cell ready for display in the table view</p>
<p class="indentt">Let’s go through this code line by line.</p>
<p class="indent">First, create the <span class="code">UITableViewCell</span>
 . The code at <span class="ent">➊</span>
 does this using the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 . Before you can start using this method on a cell, though, you need to tell the method which cell you want to use from the storyboard. Earlier, when you were in the storyboard, you gave your cell the identifier <span class="code">birthdayCellIdentifier</span>
 (see <a href="text00022.html#ch11fig4">Figure 11-4</a>
 ). This identifier links your code to the cell and tells your method that it’s using the right cell. The string for when you call this method needs to be exactly the same as the string you set in the storyboard, or you’ll get an error and the app will crash when you run it.</p>
<p class="indent">In the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 , did you notice the words <em>Reusable Cell</em>
 ? The cells inside a table view are created once and then can be reused over and over. This helps everything run faster and smoother because creating the cell is what takes the most time. If you had 200 birthdays in your app, but only 10 would fit on your screen at one time, then you need only 10 cells to show your birthdays. When you scroll down to reveal more birthdays, the cells that scroll off the top of the screen are reused. They are filled with new information and show up again at the bottom of the screen. The <span class="code">UITableView</span>
 automatically does this work. When the table view is loaded, <span class="code">tableView(_:cellForRowAt:)</span>
 is called for every visible row. When the user scrolls to look at more cells, it’s called again for each row just as it is about to appear on the screen.</p>
<p class="indent">Next, we need to find out which <span class="code">Birthday</span>
 should be displayed inside the cell. We want to display one birthday from the <span class="code">birthdays</span>
 array in each row. The first birthday, which is at <span class="code">birthdays[0]</span>
 , should be displayed in row 0. The second birthday, at <span class="code">birthdays[1]</span>
 , should be displayed in row 1, and so on, which means the <span class="code">indexPath</span>
 ’s <span class="code">row</span>
 is the same as the position in the <span class="code">birthdays</span>
 array that we want to access. The code at <span class="ent">➋</span>
 accesses the <span id="page_166"></span>
 correct <span class="code">Birthday</span>
 object from the <span class="code">birthdays</span>
 array by using <span class="code">indexPath.row</span>
 . Once we have the right <span class="code">Birthday</span>
 object, we assign it to a constant named <span class="code">birthday</span>
 so we can set up the labels in this cell.</p>
<p class="indent">Notice that we’re using <span class="code">let</span>
 to assign the <span class="code">birthday</span>
 to a constant instead of a variable. We can use <span class="code">let</span>
 because each time <span class="code">tableView(_:cellForRowAt:)</span>
 is called, a new <span class="code">birthday</span>
 constant is created. Each cell gets its own <span class="code">birthday</span>
 constant that is assigned its own <span class="code">Birthday</span>
 object. Since we’re not going to change any of the <span class="code">birthday</span>
 constants—we’re just going to read their properties—we don’t want to make them variables.</p>
<p class="indent">Now that you have your cell and your birthday, it’s time to fill in the details. You need two labels for each cell to show the birthday person’s name and birthdate. You set the cell to the Subtitle style so that it has a Title label and a Subtitle label. Each cell will already contain these labels, so now you don’t have to create any labels yourself.</p>
<p class="indent">The labels exist as properties of <span class="code">UITableViewCell</span>
 and are called <span class="code">textLabel</span>
 and <span class="code">detailTextLabel</span>
 . The code at <span class="ent">➌</span>
 sets the text of the <span class="code">textLabel</span>
 to a string made up of the <span class="code">firstName</span>
 and <span class="code">lastName</span>
 of the <span class="code">birthday</span>
 with a space between them. At <span class="ent">➍</span>
 , you use the <span class="code">string(from:)</span>
 method of the <span class="code">dateFormatter</span>
 to display the birthdate in the <span class="code">detailTextLabel</span>
 .</p>
<p class="indent">When your cell is completely configured, <span class="code">tableView( _:cellForRowAt:)</span>
 returns the cell at <span class="ent">➎</span>
 so that it can be displayed at that <span class="code">indexPath</span>
 of the table view.</p>
<h3 class="h3" id="ch11lev1sec2">
<strong>PUTTING IT ALL TOGETHER</strong>
</h3>
<p class="noindent">Now you can add <span class="code">Birthday</span>
 instances to the app using the Add Birthday view controller, and you have a table view to list each <span class="code">Birthday</span>
 in the Birthdays table view controller. But when you try running the app and adding a <span class="code">Birthday</span>
 , it doesn’t appear. To make each <span class="code">Birthday</span>
 you add appear in the table view, you need to make the Add Birthday view controller communicate with the Birthdays table view controller. You do this by using <em>delegation</em>
 .</p>
<h4 class="h4" id="ch11lev2sec5">
<strong>DELEGATION</strong>
</h4>
<p class="noindent">Delegation can be used when one view controller needs to get information from another view controller. Say you have two view controllers: A and B. The first view controller, A, creates B and presents B on top of itself. A knows about B because it created and presented B, so A can pass information along to B. But B doesn’t know about A—it’s just popped into being and doesn’t know where it came from or how it got there. So how can B talk to A? Through delegation!</p>
<div class="image"><img src="Image00245.jpg" />
</div>
<p class="indent">Delegation is when someone gives a job or a task to someone else. A <em>delegate</em>
 is like a boss who tells a delegating employee what to do. When the delegating employee is done with their task, sometimes they’ll report information back to the delegate boss.</p>
<p class="indent"><span id="page_167"></span>
 Delegation in Swift is pretty similar, but instead of having a boss and employee, we have a delegate and a delegating object. Since class B is the one being told what to do by class A, it’s the delegating object. We give class B a special property called a delegate to tell it who its delegate is—that way, it knows who to communicate with. The delegate can be any class that has a set of methods that have been defined in a <em>protocol</em>
 . A protocol is like an agreement between the two classes that tells them what the delegate can ask the delegating object to do. It has a list of method and property names that the delegate can use with the delegating object.</p>
<p class="indent">Class A creates class B, makes itself the delegate of class B, and gives class B a job to do that’s in the protocol. Once class B is done with its job, it reports back to class A. Let’s see how this works in our app.</p>
<p class="indent">The Birthdays table view controller is view controller A, and the Add Birthday view controller is view controller B. We’ll create a protocol called <span class="code">AddBirthdayViewControllerDelegate</span>
 and a method for that protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 , which the Add Birthday view controller will use to report back.</p>
<p class="indent">Take a look at <a href="text00022.html#ch11fig6">Figure 11-6</a>
 . When the user taps the Add button <span class="ent">➊</span>
 , the Birthdays table view controller creates the Add Birthday view controller <span class="ent">➋</span>
 and sets itself as the Add Birthday view controller’s delegate.</p>
<div class="image"><img src="Image00246.jpg" />
</div>
<p class="figcap"><a id="ch11fig6"></a>
 <em>Figure 11-6: A new birthday is added and passed from the Add Birthday view controller to the Birthdays table view controller using delegation.</em>
</p>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, <img class="inline" src="Image00184.jpg" />
<br />
    numberOfRowsInSection section: Int) -&gt; Int {</span>
<br />
    <span class="pink">return</span>
 birthdays.<span class="violet">count</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">In addition to the <span class="code">tableView</span>
 parameter, <span class="code">tableView(_:numberOfRowsInSection:)</span>
 also takes an <span class="code">Int</span>
 called <span class="code">section</span>
 . When the table view is loading itself, this method is called for each section in the table view. In our case, we have only one section, so we don’t need to bother checking which <span class="code">section</span>
 of the table view is being displayed here. We know it’s section 0, and we want it to have as many rows as there are birthdays, so we write <span class="code">return birthdays.count</span>
 .</p>
<p class="indent">Finally, you need to implement <span class="code">tableView(_:cellForRowAt:)</span>
 so that the table view will know what to put inside each cell. Since this method is commented out, you need to uncomment it by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it. (Be careful not to accidentally uncomment the other methods after it!) After you’ve done that, change it to the following code:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, cellForRowAt <img class="inline" src="Image00184.jpg" />
<br />
    indexPath: IndexPath) -&gt; UITableViewCell {</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="pink">let</span>
 cell = tableView.<span class="blue">dequeueReusableCell</span>
 (withIdentifier: <img class="inline" src="Image00093.jpg" />
<br />
        <span class="red">"birthdayCellIdentifier"</span>
 , for: indexPath)<br />
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 birthday = <span class="green1">birthdays</span>
 [indexPath.<span class="violet">row</span>
 ]<br />
<br />
  <span class="ent">➌</span>
 cell.<span class="violet">textLabel</span>
 ?.<span class="violet">text</span>
 = birthday.<span class="green1">firstName</span>
 <span class="blue">+</span>
 <span class="red">" "</span>
 <span class="blue">+</span>
 <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">lastName</span>
<br />
<br />
  <span class="ent">➍</span>
 cell.<span class="violet">detailTextLabel</span>
 ?.<span class="violet">text</span>
 = <span class="green1">dateFormatter</span>
 .<span class="blue">string</span>
 (from: <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">birthdate</span>
 )<br />
<br />
  <span class="ent">➎</span>
 <span class="pink">return</span>
 cell<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">You don’t call the method <span class="code">tableView(_:cellForRowAt:)</span>
 . It’s called when the table view is loaded onto the screen. It’s called for each cell on the screen and takes two parameters, <span class="code">tableView</span>
 and <span class="code">indexPath</span>
 . You already know <span id="page_165"></span>
 what the <span class="code">tableView</span>
 parameter is for. An <span class="code">IndexPath</span>
 is a Swift struct that’s used to represent a row’s position in a table view. An <span class="code">IndexPath</span>
 instance has a <span class="code">section</span>
 property and a <span class="code">row</span>
 property. Since this method will be called many times (once for every row in the table), we need the <span class="code">indexPath</span>
 to know which section and row we’re currently configuring. The <span class="code">indexPath.section</span>
 property gives the section number, and the <span class="code">indexPath.row</span>
 gives the row of the table view cell. The five lines of code inside <span class="code">tableView(_:cellForRowAt:)</span>
 will do the following:</p>
<div class="image"><img src="Image00244.jpg" />
</div>
<p class="bull">• Create a <span class="code">UITableViewCell</span>
</p>
<p class="bull">• Figure out which <span class="code">Birthday</span>
 in the <span class="code">birthdays</span>
 array will be displayed inside the cell</p>
<p class="bull">• Make two labels to display the birthday person’s name and birthdate in the cell</p>
<p class="bull">• Return the cell ready for display in the table view</p>
<p class="indentt">Let’s go through this code line by line.</p>
<p class="indent">First, create the <span class="code">UITableViewCell</span>
 . The code at <span class="ent">➊</span>
 does this using the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 . Before you can start using this method on a cell, though, you need to tell the method which cell you want to use from the storyboard. Earlier, when you were in the storyboard, you gave your cell the identifier <span class="code">birthdayCellIdentifier</span>
 (see <a href="text00022.html#ch11fig4">Figure 11-4</a>
 ). This identifier links your code to the cell and tells your method that it’s using the right cell. The string for when you call this method needs to be exactly the same as the string you set in the storyboard, or you’ll get an error and the app will crash when you run it.</p>
<p class="indent">In the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 , did you notice the words <em>Reusable Cell</em>
 ? The cells inside a table view are created once and then can be reused over and over. This helps everything run faster and smoother because creating the cell is what takes the most time. If you had 200 birthdays in your app, but only 10 would fit on your screen at one time, then you need only 10 cells to show your birthdays. When you scroll down to reveal more birthdays, the cells that scroll off the top of the screen are reused. They are filled with new information and show up again at the bottom of the screen. The <span class="code">UITableView</span>
 automatically does this work. When the table view is loaded, <span class="code">tableView(_:cellForRowAt:)</span>
 is called for every visible row. When the user scrolls to look at more cells, it’s called again for each row just as it is about to appear on the screen.</p>
<p class="indent">Next, we need to find out which <span class="code">Birthday</span>
 should be displayed inside the cell. We want to display one birthday from the <span class="code">birthdays</span>
 array in each row. The first birthday, which is at <span class="code">birthdays[0]</span>
 , should be displayed in row 0. The second birthday, at <span class="code">birthdays[1]</span>
 , should be displayed in row 1, and so on, which means the <span class="code">indexPath</span>
 ’s <span class="code">row</span>
 is the same as the position in the <span class="code">birthdays</span>
 array that we want to access. The code at <span class="ent">➋</span>
 accesses the <span id="page_166"></span>
 correct <span class="code">Birthday</span>
 object from the <span class="code">birthdays</span>
 array by using <span class="code">indexPath.row</span>
 . Once we have the right <span class="code">Birthday</span>
 object, we assign it to a constant named <span class="code">birthday</span>
 so we can set up the labels in this cell.</p>
<p class="indent">Notice that we’re using <span class="code">let</span>
 to assign the <span class="code">birthday</span>
 to a constant instead of a variable. We can use <span class="code">let</span>
 because each time <span class="code">tableView(_:cellForRowAt:)</span>
 is called, a new <span class="code">birthday</span>
 constant is created. Each cell gets its own <span class="code">birthday</span>
 constant that is assigned its own <span class="code">Birthday</span>
 object. Since we’re not going to change any of the <span class="code">birthday</span>
 constants—we’re just going to read their properties—we don’t want to make them variables.</p>
<p class="indent">Now that you have your cell and your birthday, it’s time to fill in the details. You need two labels for each cell to show the birthday person’s name and birthdate. You set the cell to the Subtitle style so that it has a Title label and a Subtitle label. Each cell will already contain these labels, so now you don’t have to create any labels yourself.</p>
<p class="indent">The labels exist as properties of <span class="code">UITableViewCell</span>
 and are called <span class="code">textLabel</span>
 and <span class="code">detailTextLabel</span>
 . The code at <span class="ent">➌</span>
 sets the text of the <span class="code">textLabel</span>
 to a string made up of the <span class="code">firstName</span>
 and <span class="code">lastName</span>
 of the <span class="code">birthday</span>
 with a space between them. At <span class="ent">➍</span>
 , you use the <span class="code">string(from:)</span>
 method of the <span class="code">dateFormatter</span>
 to display the birthdate in the <span class="code">detailTextLabel</span>
 .</p>
<p class="indent">When your cell is completely configured, <span class="code">tableView( _:cellForRowAt:)</span>
 returns the cell at <span class="ent">➎</span>
 so that it can be displayed at that <span class="code">indexPath</span>
 of the table view.</p>
<h3 class="h3" id="ch11lev1sec2">
<strong>PUTTING IT ALL TOGETHER</strong>
</h3>
<p class="noindent">Now you can add <span class="code">Birthday</span>
 instances to the app using the Add Birthday view controller, and you have a table view to list each <span class="code">Birthday</span>
 in the Birthdays table view controller. But when you try running the app and adding a <span class="code">Birthday</span>
 , it doesn’t appear. To make each <span class="code">Birthday</span>
 you add appear in the table view, you need to make the Add Birthday view controller communicate with the Birthdays table view controller. You do this by using <em>delegation</em>
 .</p>
<h4 class="h4" id="ch11lev2sec5">
<strong>DELEGATION</strong>
</h4>
<p class="noindent">Delegation can be used when one view controller needs to get information from another view controller. Say you have two view controllers: A and B. The first view controller, A, creates B and presents B on top of itself. A knows about B because it created and presented B, so A can pass information along to B. But B doesn’t know about A—it’s just popped into being and doesn’t know where it came from or how it got there. So how can B talk to A? Through delegation!</p>
<div class="image"><img src="Image00245.jpg" />
</div>
<p class="indent">Delegation is when someone gives a job or a task to someone else. A <em>delegate</em>
 is like a boss who tells a delegating employee what to do. When the delegating employee is done with their task, sometimes they’ll report information back to the delegate boss.</p>
<p class="indent"><span id="page_167"></span>
 Delegation in Swift is pretty similar, but instead of having a boss and employee, we have a delegate and a delegating object. Since class B is the one being told what to do by class A, it’s the delegating object. We give class B a special property called a delegate to tell it who its delegate is—that way, it knows who to communicate with. The delegate can be any class that has a set of methods that have been defined in a <em>protocol</em>
 . A protocol is like an agreement between the two classes that tells them what the delegate can ask the delegating object to do. It has a list of method and property names that the delegate can use with the delegating object.</p>
<p class="indent">Class A creates class B, makes itself the delegate of class B, and gives class B a job to do that’s in the protocol. Once class B is done with its job, it reports back to class A. Let’s see how this works in our app.</p>
<p class="indent">The Birthdays table view controller is view controller A, and the Add Birthday view controller is view controller B. We’ll create a protocol called <span class="code">AddBirthdayViewControllerDelegate</span>
 and a method for that protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 , which the Add Birthday view controller will use to report back.</p>
<p class="indent">Take a look at <a href="text00022.html#ch11fig6">Figure 11-6</a>
 . When the user taps the Add button <span class="ent">➊</span>
 , the Birthdays table view controller creates the Add Birthday view controller <span class="ent">➋</span>
 and sets itself as the Add Birthday view controller’s delegate.</p>
<div class="image"><img src="Image00246.jpg" />
</div>
<p class="figcap"><a id="ch11fig6"></a>
 <em>Figure 11-6: A new birthday is added and passed from the Add Birthday view controller to the Birthdays table view controller using delegation.</em>
</p>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="indent">In addition to the <span class="code">tableView</span>
 parameter, <span class="code">tableView(_:numberOfRowsInSection:)</span>
 also takes an <span class="code">Int</span>
 called <span class="code">section</span>
 . When the table view is loading itself, this method is called for each section in the table view. In our case, we have only one section, so we don’t need to bother checking which <span class="code">section</span>
 of the table view is being displayed here. We know it’s section 0, and we want it to have as many rows as there are birthdays, so we write <span class="code">return birthdays.count</span>
 .</p>
<p class="indent">Finally, you need to implement <span class="code">tableView(_:cellForRowAt:)</span>
 so that the table view will know what to put inside each cell. Since this method is commented out, you need to uncomment it by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it. (Be careful not to accidentally uncomment the other methods after it!) After you’ve done that, change it to the following code:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, cellForRowAt <img class="inline" src="Image00184.jpg" />
<br />
    indexPath: IndexPath) -&gt; UITableViewCell {</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="pink">let</span>
 cell = tableView.<span class="blue">dequeueReusableCell</span>
 (withIdentifier: <img class="inline" src="Image00093.jpg" />
<br />
        <span class="red">"birthdayCellIdentifier"</span>
 , for: indexPath)<br />
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 birthday = <span class="green1">birthdays</span>
 [indexPath.<span class="violet">row</span>
 ]<br />
<br />
  <span class="ent">➌</span>
 cell.<span class="violet">textLabel</span>
 ?.<span class="violet">text</span>
 = birthday.<span class="green1">firstName</span>
 <span class="blue">+</span>
 <span class="red">" "</span>
 <span class="blue">+</span>
 <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">lastName</span>
<br />
<br />
  <span class="ent">➍</span>
 cell.<span class="violet">detailTextLabel</span>
 ?.<span class="violet">text</span>
 = <span class="green1">dateFormatter</span>
 .<span class="blue">string</span>
 (from: <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">birthdate</span>
 )<br />
<br />
  <span class="ent">➎</span>
 <span class="pink">return</span>
 cell<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">You don’t call the method <span class="code">tableView(_:cellForRowAt:)</span>
 . It’s called when the table view is loaded onto the screen. It’s called for each cell on the screen and takes two parameters, <span class="code">tableView</span>
 and <span class="code">indexPath</span>
 . You already know <span id="page_165"></span>
 what the <span class="code">tableView</span>
 parameter is for. An <span class="code">IndexPath</span>
 is a Swift struct that’s used to represent a row’s position in a table view. An <span class="code">IndexPath</span>
 instance has a <span class="code">section</span>
 property and a <span class="code">row</span>
 property. Since this method will be called many times (once for every row in the table), we need the <span class="code">indexPath</span>
 to know which section and row we’re currently configuring. The <span class="code">indexPath.section</span>
 property gives the section number, and the <span class="code">indexPath.row</span>
 gives the row of the table view cell. The five lines of code inside <span class="code">tableView(_:cellForRowAt:)</span>
 will do the following:</p>
<div class="image"><img src="Image00244.jpg" />
</div>
<p class="bull">• Create a <span class="code">UITableViewCell</span>
</p>
<p class="bull">• Figure out which <span class="code">Birthday</span>
 in the <span class="code">birthdays</span>
 array will be displayed inside the cell</p>
<p class="bull">• Make two labels to display the birthday person’s name and birthdate in the cell</p>
<p class="bull">• Return the cell ready for display in the table view</p>
<p class="indentt">Let’s go through this code line by line.</p>
<p class="indent">First, create the <span class="code">UITableViewCell</span>
 . The code at <span class="ent">➊</span>
 does this using the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 . Before you can start using this method on a cell, though, you need to tell the method which cell you want to use from the storyboard. Earlier, when you were in the storyboard, you gave your cell the identifier <span class="code">birthdayCellIdentifier</span>
 (see <a href="text00022.html#ch11fig4">Figure 11-4</a>
 ). This identifier links your code to the cell and tells your method that it’s using the right cell. The string for when you call this method needs to be exactly the same as the string you set in the storyboard, or you’ll get an error and the app will crash when you run it.</p>
<p class="indent">In the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 , did you notice the words <em>Reusable Cell</em>
 ? The cells inside a table view are created once and then can be reused over and over. This helps everything run faster and smoother because creating the cell is what takes the most time. If you had 200 birthdays in your app, but only 10 would fit on your screen at one time, then you need only 10 cells to show your birthdays. When you scroll down to reveal more birthdays, the cells that scroll off the top of the screen are reused. They are filled with new information and show up again at the bottom of the screen. The <span class="code">UITableView</span>
 automatically does this work. When the table view is loaded, <span class="code">tableView(_:cellForRowAt:)</span>
 is called for every visible row. When the user scrolls to look at more cells, it’s called again for each row just as it is about to appear on the screen.</p>
<p class="indent">Next, we need to find out which <span class="code">Birthday</span>
 should be displayed inside the cell. We want to display one birthday from the <span class="code">birthdays</span>
 array in each row. The first birthday, which is at <span class="code">birthdays[0]</span>
 , should be displayed in row 0. The second birthday, at <span class="code">birthdays[1]</span>
 , should be displayed in row 1, and so on, which means the <span class="code">indexPath</span>
 ’s <span class="code">row</span>
 is the same as the position in the <span class="code">birthdays</span>
 array that we want to access. The code at <span class="ent">➋</span>
 accesses the <span id="page_166"></span>
 correct <span class="code">Birthday</span>
 object from the <span class="code">birthdays</span>
 array by using <span class="code">indexPath.row</span>
 . Once we have the right <span class="code">Birthday</span>
 object, we assign it to a constant named <span class="code">birthday</span>
 so we can set up the labels in this cell.</p>
<p class="indent">Notice that we’re using <span class="code">let</span>
 to assign the <span class="code">birthday</span>
 to a constant instead of a variable. We can use <span class="code">let</span>
 because each time <span class="code">tableView(_:cellForRowAt:)</span>
 is called, a new <span class="code">birthday</span>
 constant is created. Each cell gets its own <span class="code">birthday</span>
 constant that is assigned its own <span class="code">Birthday</span>
 object. Since we’re not going to change any of the <span class="code">birthday</span>
 constants—we’re just going to read their properties—we don’t want to make them variables.</p>
<p class="indent">Now that you have your cell and your birthday, it’s time to fill in the details. You need two labels for each cell to show the birthday person’s name and birthdate. You set the cell to the Subtitle style so that it has a Title label and a Subtitle label. Each cell will already contain these labels, so now you don’t have to create any labels yourself.</p>
<p class="indent">The labels exist as properties of <span class="code">UITableViewCell</span>
 and are called <span class="code">textLabel</span>
 and <span class="code">detailTextLabel</span>
 . The code at <span class="ent">➌</span>
 sets the text of the <span class="code">textLabel</span>
 to a string made up of the <span class="code">firstName</span>
 and <span class="code">lastName</span>
 of the <span class="code">birthday</span>
 with a space between them. At <span class="ent">➍</span>
 , you use the <span class="code">string(from:)</span>
 method of the <span class="code">dateFormatter</span>
 to display the birthdate in the <span class="code">detailTextLabel</span>
 .</p>
<p class="indent">When your cell is completely configured, <span class="code">tableView( _:cellForRowAt:)</span>
 returns the cell at <span class="ent">➎</span>
 so that it can be displayed at that <span class="code">indexPath</span>
 of the table view.</p>
<h3 class="h3" id="ch11lev1sec2">
<strong>PUTTING IT ALL TOGETHER</strong>
</h3>
<p class="noindent">Now you can add <span class="code">Birthday</span>
 instances to the app using the Add Birthday view controller, and you have a table view to list each <span class="code">Birthday</span>
 in the Birthdays table view controller. But when you try running the app and adding a <span class="code">Birthday</span>
 , it doesn’t appear. To make each <span class="code">Birthday</span>
 you add appear in the table view, you need to make the Add Birthday view controller communicate with the Birthdays table view controller. You do this by using <em>delegation</em>
 .</p>
<h4 class="h4" id="ch11lev2sec5">
<strong>DELEGATION</strong>
</h4>
<p class="noindent">Delegation can be used when one view controller needs to get information from another view controller. Say you have two view controllers: A and B. The first view controller, A, creates B and presents B on top of itself. A knows about B because it created and presented B, so A can pass information along to B. But B doesn’t know about A—it’s just popped into being and doesn’t know where it came from or how it got there. So how can B talk to A? Through delegation!</p>
<div class="image"><img src="Image00245.jpg" />
</div>
<p class="indent">Delegation is when someone gives a job or a task to someone else. A <em>delegate</em>
 is like a boss who tells a delegating employee what to do. When the delegating employee is done with their task, sometimes they’ll report information back to the delegate boss.</p>
<p class="indent"><span id="page_167"></span>
 Delegation in Swift is pretty similar, but instead of having a boss and employee, we have a delegate and a delegating object. Since class B is the one being told what to do by class A, it’s the delegating object. We give class B a special property called a delegate to tell it who its delegate is—that way, it knows who to communicate with. The delegate can be any class that has a set of methods that have been defined in a <em>protocol</em>
 . A protocol is like an agreement between the two classes that tells them what the delegate can ask the delegating object to do. It has a list of method and property names that the delegate can use with the delegating object.</p>
<p class="indent">Class A creates class B, makes itself the delegate of class B, and gives class B a job to do that’s in the protocol. Once class B is done with its job, it reports back to class A. Let’s see how this works in our app.</p>
<p class="indent">The Birthdays table view controller is view controller A, and the Add Birthday view controller is view controller B. We’ll create a protocol called <span class="code">AddBirthdayViewControllerDelegate</span>
 and a method for that protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 , which the Add Birthday view controller will use to report back.</p>
<p class="indent">Take a look at <a href="text00022.html#ch11fig6">Figure 11-6</a>
 . When the user taps the Add button <span class="ent">➊</span>
 , the Birthdays table view controller creates the Add Birthday view controller <span class="ent">➋</span>
 and sets itself as the Add Birthday view controller’s delegate.</p>
<div class="image"><img src="Image00246.jpg" />
</div>
<p class="figcap"><a id="ch11fig6"></a>
 <em>Figure 11-6: A new birthday is added and passed from the Add Birthday view controller to the Birthdays table view controller using delegation.</em>
</p>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="indent">Finally, you need to implement <span class="code">tableView(_:cellForRowAt:)</span>
 so that the table view will know what to put inside each cell. Since this method is commented out, you need to uncomment it by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it. (Be careful not to accidentally uncomment the other methods after it!) After you’ve done that, change it to the following code:</p>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, cellForRowAt <img class="inline" src="Image00184.jpg" />
<br />
    indexPath: IndexPath) -&gt; UITableViewCell {</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="pink">let</span>
 cell = tableView.<span class="blue">dequeueReusableCell</span>
 (withIdentifier: <img class="inline" src="Image00093.jpg" />
<br />
        <span class="red">"birthdayCellIdentifier"</span>
 , for: indexPath)<br />
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 birthday = <span class="green1">birthdays</span>
 [indexPath.<span class="violet">row</span>
 ]<br />
<br />
  <span class="ent">➌</span>
 cell.<span class="violet">textLabel</span>
 ?.<span class="violet">text</span>
 = birthday.<span class="green1">firstName</span>
 <span class="blue">+</span>
 <span class="red">" "</span>
 <span class="blue">+</span>
 <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">lastName</span>
<br />
<br />
  <span class="ent">➍</span>
 cell.<span class="violet">detailTextLabel</span>
 ?.<span class="violet">text</span>
 = <span class="green1">dateFormatter</span>
 .<span class="blue">string</span>
 (from: <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">birthdate</span>
 )<br />
<br />
  <span class="ent">➎</span>
 <span class="pink">return</span>
 cell<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">You don’t call the method <span class="code">tableView(_:cellForRowAt:)</span>
 . It’s called when the table view is loaded onto the screen. It’s called for each cell on the screen and takes two parameters, <span class="code">tableView</span>
 and <span class="code">indexPath</span>
 . You already know <span id="page_165"></span>
 what the <span class="code">tableView</span>
 parameter is for. An <span class="code">IndexPath</span>
 is a Swift struct that’s used to represent a row’s position in a table view. An <span class="code">IndexPath</span>
 instance has a <span class="code">section</span>
 property and a <span class="code">row</span>
 property. Since this method will be called many times (once for every row in the table), we need the <span class="code">indexPath</span>
 to know which section and row we’re currently configuring. The <span class="code">indexPath.section</span>
 property gives the section number, and the <span class="code">indexPath.row</span>
 gives the row of the table view cell. The five lines of code inside <span class="code">tableView(_:cellForRowAt:)</span>
 will do the following:</p>
<div class="image"><img src="Image00244.jpg" />
</div>
<p class="bull">• Create a <span class="code">UITableViewCell</span>
</p>
<p class="bull">• Figure out which <span class="code">Birthday</span>
 in the <span class="code">birthdays</span>
 array will be displayed inside the cell</p>
<p class="bull">• Make two labels to display the birthday person’s name and birthdate in the cell</p>
<p class="bull">• Return the cell ready for display in the table view</p>
<p class="indentt">Let’s go through this code line by line.</p>
<p class="indent">First, create the <span class="code">UITableViewCell</span>
 . The code at <span class="ent">➊</span>
 does this using the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 . Before you can start using this method on a cell, though, you need to tell the method which cell you want to use from the storyboard. Earlier, when you were in the storyboard, you gave your cell the identifier <span class="code">birthdayCellIdentifier</span>
 (see <a href="text00022.html#ch11fig4">Figure 11-4</a>
 ). This identifier links your code to the cell and tells your method that it’s using the right cell. The string for when you call this method needs to be exactly the same as the string you set in the storyboard, or you’ll get an error and the app will crash when you run it.</p>
<p class="indent">In the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 , did you notice the words <em>Reusable Cell</em>
 ? The cells inside a table view are created once and then can be reused over and over. This helps everything run faster and smoother because creating the cell is what takes the most time. If you had 200 birthdays in your app, but only 10 would fit on your screen at one time, then you need only 10 cells to show your birthdays. When you scroll down to reveal more birthdays, the cells that scroll off the top of the screen are reused. They are filled with new information and show up again at the bottom of the screen. The <span class="code">UITableView</span>
 automatically does this work. When the table view is loaded, <span class="code">tableView(_:cellForRowAt:)</span>
 is called for every visible row. When the user scrolls to look at more cells, it’s called again for each row just as it is about to appear on the screen.</p>
<p class="indent">Next, we need to find out which <span class="code">Birthday</span>
 should be displayed inside the cell. We want to display one birthday from the <span class="code">birthdays</span>
 array in each row. The first birthday, which is at <span class="code">birthdays[0]</span>
 , should be displayed in row 0. The second birthday, at <span class="code">birthdays[1]</span>
 , should be displayed in row 1, and so on, which means the <span class="code">indexPath</span>
 ’s <span class="code">row</span>
 is the same as the position in the <span class="code">birthdays</span>
 array that we want to access. The code at <span class="ent">➋</span>
 accesses the <span id="page_166"></span>
 correct <span class="code">Birthday</span>
 object from the <span class="code">birthdays</span>
 array by using <span class="code">indexPath.row</span>
 . Once we have the right <span class="code">Birthday</span>
 object, we assign it to a constant named <span class="code">birthday</span>
 so we can set up the labels in this cell.</p>
<p class="indent">Notice that we’re using <span class="code">let</span>
 to assign the <span class="code">birthday</span>
 to a constant instead of a variable. We can use <span class="code">let</span>
 because each time <span class="code">tableView(_:cellForRowAt:)</span>
 is called, a new <span class="code">birthday</span>
 constant is created. Each cell gets its own <span class="code">birthday</span>
 constant that is assigned its own <span class="code">Birthday</span>
 object. Since we’re not going to change any of the <span class="code">birthday</span>
 constants—we’re just going to read their properties—we don’t want to make them variables.</p>
<p class="indent">Now that you have your cell and your birthday, it’s time to fill in the details. You need two labels for each cell to show the birthday person’s name and birthdate. You set the cell to the Subtitle style so that it has a Title label and a Subtitle label. Each cell will already contain these labels, so now you don’t have to create any labels yourself.</p>
<p class="indent">The labels exist as properties of <span class="code">UITableViewCell</span>
 and are called <span class="code">textLabel</span>
 and <span class="code">detailTextLabel</span>
 . The code at <span class="ent">➌</span>
 sets the text of the <span class="code">textLabel</span>
 to a string made up of the <span class="code">firstName</span>
 and <span class="code">lastName</span>
 of the <span class="code">birthday</span>
 with a space between them. At <span class="ent">➍</span>
 , you use the <span class="code">string(from:)</span>
 method of the <span class="code">dateFormatter</span>
 to display the birthdate in the <span class="code">detailTextLabel</span>
 .</p>
<p class="indent">When your cell is completely configured, <span class="code">tableView( _:cellForRowAt:)</span>
 returns the cell at <span class="ent">➎</span>
 so that it can be displayed at that <span class="code">indexPath</span>
 of the table view.</p>
<h3 class="h3" id="ch11lev1sec2">
<strong>PUTTING IT ALL TOGETHER</strong>
</h3>
<p class="noindent">Now you can add <span class="code">Birthday</span>
 instances to the app using the Add Birthday view controller, and you have a table view to list each <span class="code">Birthday</span>
 in the Birthdays table view controller. But when you try running the app and adding a <span class="code">Birthday</span>
 , it doesn’t appear. To make each <span class="code">Birthday</span>
 you add appear in the table view, you need to make the Add Birthday view controller communicate with the Birthdays table view controller. You do this by using <em>delegation</em>
 .</p>
<h4 class="h4" id="ch11lev2sec5">
<strong>DELEGATION</strong>
</h4>
<p class="noindent">Delegation can be used when one view controller needs to get information from another view controller. Say you have two view controllers: A and B. The first view controller, A, creates B and presents B on top of itself. A knows about B because it created and presented B, so A can pass information along to B. But B doesn’t know about A—it’s just popped into being and doesn’t know where it came from or how it got there. So how can B talk to A? Through delegation!</p>
<div class="image"><img src="Image00245.jpg" />
</div>
<p class="indent">Delegation is when someone gives a job or a task to someone else. A <em>delegate</em>
 is like a boss who tells a delegating employee what to do. When the delegating employee is done with their task, sometimes they’ll report information back to the delegate boss.</p>
<p class="indent"><span id="page_167"></span>
 Delegation in Swift is pretty similar, but instead of having a boss and employee, we have a delegate and a delegating object. Since class B is the one being told what to do by class A, it’s the delegating object. We give class B a special property called a delegate to tell it who its delegate is—that way, it knows who to communicate with. The delegate can be any class that has a set of methods that have been defined in a <em>protocol</em>
 . A protocol is like an agreement between the two classes that tells them what the delegate can ask the delegating object to do. It has a list of method and property names that the delegate can use with the delegating object.</p>
<p class="indent">Class A creates class B, makes itself the delegate of class B, and gives class B a job to do that’s in the protocol. Once class B is done with its job, it reports back to class A. Let’s see how this works in our app.</p>
<p class="indent">The Birthdays table view controller is view controller A, and the Add Birthday view controller is view controller B. We’ll create a protocol called <span class="code">AddBirthdayViewControllerDelegate</span>
 and a method for that protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 , which the Add Birthday view controller will use to report back.</p>
<p class="indent">Take a look at <a href="text00022.html#ch11fig6">Figure 11-6</a>
 . When the user taps the Add button <span class="ent">➊</span>
 , the Birthdays table view controller creates the Add Birthday view controller <span class="ent">➋</span>
 and sets itself as the Add Birthday view controller’s delegate.</p>
<div class="image"><img src="Image00246.jpg" />
</div>
<p class="figcap"><a id="ch11fig6"></a>
 <em>Figure 11-6: A new birthday is added and passed from the Add Birthday view controller to the Birthdays table view controller using delegation.</em>
</p>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<div class="box">
<pre>
<span class="ash">override func tableView(_ tableView: UITableView, cellForRowAt <img class="inline" src="Image00184.jpg" />
<br />
    indexPath: IndexPath) -&gt; UITableViewCell {</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="pink">let</span>
 cell = tableView.<span class="blue">dequeueReusableCell</span>
 (withIdentifier: <img class="inline" src="Image00093.jpg" />
<br />
        <span class="red">"birthdayCellIdentifier"</span>
 , for: indexPath)<br />
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 birthday = <span class="green1">birthdays</span>
 [indexPath.<span class="violet">row</span>
 ]<br />
<br />
  <span class="ent">➌</span>
 cell.<span class="violet">textLabel</span>
 ?.<span class="violet">text</span>
 = birthday.<span class="green1">firstName</span>
 <span class="blue">+</span>
 <span class="red">" "</span>
 <span class="blue">+</span>
 <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">lastName</span>
<br />
<br />
  <span class="ent">➍</span>
 cell.<span class="violet">detailTextLabel</span>
 ?.<span class="violet">text</span>
 = <span class="green1">dateFormatter</span>
 .<span class="blue">string</span>
 (from: <img class="inline" src="Image00093.jpg" />
<br />
        birthday.<span class="green1">birthdate</span>
 )<br />
<br />
  <span class="ent">➎</span>
 <span class="pink">return</span>
 cell<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">You don’t call the method <span class="code">tableView(_:cellForRowAt:)</span>
 . It’s called when the table view is loaded onto the screen. It’s called for each cell on the screen and takes two parameters, <span class="code">tableView</span>
 and <span class="code">indexPath</span>
 . You already know <span id="page_165"></span>
 what the <span class="code">tableView</span>
 parameter is for. An <span class="code">IndexPath</span>
 is a Swift struct that’s used to represent a row’s position in a table view. An <span class="code">IndexPath</span>
 instance has a <span class="code">section</span>
 property and a <span class="code">row</span>
 property. Since this method will be called many times (once for every row in the table), we need the <span class="code">indexPath</span>
 to know which section and row we’re currently configuring. The <span class="code">indexPath.section</span>
 property gives the section number, and the <span class="code">indexPath.row</span>
 gives the row of the table view cell. The five lines of code inside <span class="code">tableView(_:cellForRowAt:)</span>
 will do the following:</p>
<div class="image"><img src="Image00244.jpg" />
</div>
<p class="bull">• Create a <span class="code">UITableViewCell</span>
</p>
<p class="bull">• Figure out which <span class="code">Birthday</span>
 in the <span class="code">birthdays</span>
 array will be displayed inside the cell</p>
<p class="bull">• Make two labels to display the birthday person’s name and birthdate in the cell</p>
<p class="bull">• Return the cell ready for display in the table view</p>
<p class="indentt">Let’s go through this code line by line.</p>
<p class="indent">First, create the <span class="code">UITableViewCell</span>
 . The code at <span class="ent">➊</span>
 does this using the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 . Before you can start using this method on a cell, though, you need to tell the method which cell you want to use from the storyboard. Earlier, when you were in the storyboard, you gave your cell the identifier <span class="code">birthdayCellIdentifier</span>
 (see <a href="text00022.html#ch11fig4">Figure 11-4</a>
 ). This identifier links your code to the cell and tells your method that it’s using the right cell. The string for when you call this method needs to be exactly the same as the string you set in the storyboard, or you’ll get an error and the app will crash when you run it.</p>
<p class="indent">In the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 , did you notice the words <em>Reusable Cell</em>
 ? The cells inside a table view are created once and then can be reused over and over. This helps everything run faster and smoother because creating the cell is what takes the most time. If you had 200 birthdays in your app, but only 10 would fit on your screen at one time, then you need only 10 cells to show your birthdays. When you scroll down to reveal more birthdays, the cells that scroll off the top of the screen are reused. They are filled with new information and show up again at the bottom of the screen. The <span class="code">UITableView</span>
 automatically does this work. When the table view is loaded, <span class="code">tableView(_:cellForRowAt:)</span>
 is called for every visible row. When the user scrolls to look at more cells, it’s called again for each row just as it is about to appear on the screen.</p>
<p class="indent">Next, we need to find out which <span class="code">Birthday</span>
 should be displayed inside the cell. We want to display one birthday from the <span class="code">birthdays</span>
 array in each row. The first birthday, which is at <span class="code">birthdays[0]</span>
 , should be displayed in row 0. The second birthday, at <span class="code">birthdays[1]</span>
 , should be displayed in row 1, and so on, which means the <span class="code">indexPath</span>
 ’s <span class="code">row</span>
 is the same as the position in the <span class="code">birthdays</span>
 array that we want to access. The code at <span class="ent">➋</span>
 accesses the <span id="page_166"></span>
 correct <span class="code">Birthday</span>
 object from the <span class="code">birthdays</span>
 array by using <span class="code">indexPath.row</span>
 . Once we have the right <span class="code">Birthday</span>
 object, we assign it to a constant named <span class="code">birthday</span>
 so we can set up the labels in this cell.</p>
<p class="indent">Notice that we’re using <span class="code">let</span>
 to assign the <span class="code">birthday</span>
 to a constant instead of a variable. We can use <span class="code">let</span>
 because each time <span class="code">tableView(_:cellForRowAt:)</span>
 is called, a new <span class="code">birthday</span>
 constant is created. Each cell gets its own <span class="code">birthday</span>
 constant that is assigned its own <span class="code">Birthday</span>
 object. Since we’re not going to change any of the <span class="code">birthday</span>
 constants—we’re just going to read their properties—we don’t want to make them variables.</p>
<p class="indent">Now that you have your cell and your birthday, it’s time to fill in the details. You need two labels for each cell to show the birthday person’s name and birthdate. You set the cell to the Subtitle style so that it has a Title label and a Subtitle label. Each cell will already contain these labels, so now you don’t have to create any labels yourself.</p>
<p class="indent">The labels exist as properties of <span class="code">UITableViewCell</span>
 and are called <span class="code">textLabel</span>
 and <span class="code">detailTextLabel</span>
 . The code at <span class="ent">➌</span>
 sets the text of the <span class="code">textLabel</span>
 to a string made up of the <span class="code">firstName</span>
 and <span class="code">lastName</span>
 of the <span class="code">birthday</span>
 with a space between them. At <span class="ent">➍</span>
 , you use the <span class="code">string(from:)</span>
 method of the <span class="code">dateFormatter</span>
 to display the birthdate in the <span class="code">detailTextLabel</span>
 .</p>
<p class="indent">When your cell is completely configured, <span class="code">tableView( _:cellForRowAt:)</span>
 returns the cell at <span class="ent">➎</span>
 so that it can be displayed at that <span class="code">indexPath</span>
 of the table view.</p>
<h3 class="h3" id="ch11lev1sec2">
<strong>PUTTING IT ALL TOGETHER</strong>
</h3>
<p class="noindent">Now you can add <span class="code">Birthday</span>
 instances to the app using the Add Birthday view controller, and you have a table view to list each <span class="code">Birthday</span>
 in the Birthdays table view controller. But when you try running the app and adding a <span class="code">Birthday</span>
 , it doesn’t appear. To make each <span class="code">Birthday</span>
 you add appear in the table view, you need to make the Add Birthday view controller communicate with the Birthdays table view controller. You do this by using <em>delegation</em>
 .</p>
<h4 class="h4" id="ch11lev2sec5">
<strong>DELEGATION</strong>
</h4>
<p class="noindent">Delegation can be used when one view controller needs to get information from another view controller. Say you have two view controllers: A and B. The first view controller, A, creates B and presents B on top of itself. A knows about B because it created and presented B, so A can pass information along to B. But B doesn’t know about A—it’s just popped into being and doesn’t know where it came from or how it got there. So how can B talk to A? Through delegation!</p>
<div class="image"><img src="Image00245.jpg" />
</div>
<p class="indent">Delegation is when someone gives a job or a task to someone else. A <em>delegate</em>
 is like a boss who tells a delegating employee what to do. When the delegating employee is done with their task, sometimes they’ll report information back to the delegate boss.</p>
<p class="indent"><span id="page_167"></span>
 Delegation in Swift is pretty similar, but instead of having a boss and employee, we have a delegate and a delegating object. Since class B is the one being told what to do by class A, it’s the delegating object. We give class B a special property called a delegate to tell it who its delegate is—that way, it knows who to communicate with. The delegate can be any class that has a set of methods that have been defined in a <em>protocol</em>
 . A protocol is like an agreement between the two classes that tells them what the delegate can ask the delegating object to do. It has a list of method and property names that the delegate can use with the delegating object.</p>
<p class="indent">Class A creates class B, makes itself the delegate of class B, and gives class B a job to do that’s in the protocol. Once class B is done with its job, it reports back to class A. Let’s see how this works in our app.</p>
<p class="indent">The Birthdays table view controller is view controller A, and the Add Birthday view controller is view controller B. We’ll create a protocol called <span class="code">AddBirthdayViewControllerDelegate</span>
 and a method for that protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 , which the Add Birthday view controller will use to report back.</p>
<p class="indent">Take a look at <a href="text00022.html#ch11fig6">Figure 11-6</a>
 . When the user taps the Add button <span class="ent">➊</span>
 , the Birthdays table view controller creates the Add Birthday view controller <span class="ent">➋</span>
 and sets itself as the Add Birthday view controller’s delegate.</p>
<div class="image"><img src="Image00246.jpg" />
</div>
<p class="figcap"><a id="ch11fig6"></a>
 <em>Figure 11-6: A new birthday is added and passed from the Add Birthday view controller to the Birthdays table view controller using delegation.</em>
</p>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="indent">You don’t call the method <span class="code">tableView(_:cellForRowAt:)</span>
 . It’s called when the table view is loaded onto the screen. It’s called for each cell on the screen and takes two parameters, <span class="code">tableView</span>
 and <span class="code">indexPath</span>
 . You already know <span id="page_165"></span>
 what the <span class="code">tableView</span>
 parameter is for. An <span class="code">IndexPath</span>
 is a Swift struct that’s used to represent a row’s position in a table view. An <span class="code">IndexPath</span>
 instance has a <span class="code">section</span>
 property and a <span class="code">row</span>
 property. Since this method will be called many times (once for every row in the table), we need the <span class="code">indexPath</span>
 to know which section and row we’re currently configuring. The <span class="code">indexPath.section</span>
 property gives the section number, and the <span class="code">indexPath.row</span>
 gives the row of the table view cell. The five lines of code inside <span class="code">tableView(_:cellForRowAt:)</span>
 will do the following:</p>
<div class="image"><img src="Image00244.jpg" />
</div>
<p class="bull">• Create a <span class="code">UITableViewCell</span>
</p>
<p class="bull">• Figure out which <span class="code">Birthday</span>
 in the <span class="code">birthdays</span>
 array will be displayed inside the cell</p>
<p class="bull">• Make two labels to display the birthday person’s name and birthdate in the cell</p>
<p class="bull">• Return the cell ready for display in the table view</p>
<p class="indentt">Let’s go through this code line by line.</p>
<p class="indent">First, create the <span class="code">UITableViewCell</span>
 . The code at <span class="ent">➊</span>
 does this using the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 . Before you can start using this method on a cell, though, you need to tell the method which cell you want to use from the storyboard. Earlier, when you were in the storyboard, you gave your cell the identifier <span class="code">birthdayCellIdentifier</span>
 (see <a href="text00022.html#ch11fig4">Figure 11-4</a>
 ). This identifier links your code to the cell and tells your method that it’s using the right cell. The string for when you call this method needs to be exactly the same as the string you set in the storyboard, or you’ll get an error and the app will crash when you run it.</p>
<p class="indent">In the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 , did you notice the words <em>Reusable Cell</em>
 ? The cells inside a table view are created once and then can be reused over and over. This helps everything run faster and smoother because creating the cell is what takes the most time. If you had 200 birthdays in your app, but only 10 would fit on your screen at one time, then you need only 10 cells to show your birthdays. When you scroll down to reveal more birthdays, the cells that scroll off the top of the screen are reused. They are filled with new information and show up again at the bottom of the screen. The <span class="code">UITableView</span>
 automatically does this work. When the table view is loaded, <span class="code">tableView(_:cellForRowAt:)</span>
 is called for every visible row. When the user scrolls to look at more cells, it’s called again for each row just as it is about to appear on the screen.</p>
<p class="indent">Next, we need to find out which <span class="code">Birthday</span>
 should be displayed inside the cell. We want to display one birthday from the <span class="code">birthdays</span>
 array in each row. The first birthday, which is at <span class="code">birthdays[0]</span>
 , should be displayed in row 0. The second birthday, at <span class="code">birthdays[1]</span>
 , should be displayed in row 1, and so on, which means the <span class="code">indexPath</span>
 ’s <span class="code">row</span>
 is the same as the position in the <span class="code">birthdays</span>
 array that we want to access. The code at <span class="ent">➋</span>
 accesses the <span id="page_166"></span>
 correct <span class="code">Birthday</span>
 object from the <span class="code">birthdays</span>
 array by using <span class="code">indexPath.row</span>
 . Once we have the right <span class="code">Birthday</span>
 object, we assign it to a constant named <span class="code">birthday</span>
 so we can set up the labels in this cell.</p>
<p class="indent">Notice that we’re using <span class="code">let</span>
 to assign the <span class="code">birthday</span>
 to a constant instead of a variable. We can use <span class="code">let</span>
 because each time <span class="code">tableView(_:cellForRowAt:)</span>
 is called, a new <span class="code">birthday</span>
 constant is created. Each cell gets its own <span class="code">birthday</span>
 constant that is assigned its own <span class="code">Birthday</span>
 object. Since we’re not going to change any of the <span class="code">birthday</span>
 constants—we’re just going to read their properties—we don’t want to make them variables.</p>
<p class="indent">Now that you have your cell and your birthday, it’s time to fill in the details. You need two labels for each cell to show the birthday person’s name and birthdate. You set the cell to the Subtitle style so that it has a Title label and a Subtitle label. Each cell will already contain these labels, so now you don’t have to create any labels yourself.</p>
<p class="indent">The labels exist as properties of <span class="code">UITableViewCell</span>
 and are called <span class="code">textLabel</span>
 and <span class="code">detailTextLabel</span>
 . The code at <span class="ent">➌</span>
 sets the text of the <span class="code">textLabel</span>
 to a string made up of the <span class="code">firstName</span>
 and <span class="code">lastName</span>
 of the <span class="code">birthday</span>
 with a space between them. At <span class="ent">➍</span>
 , you use the <span class="code">string(from:)</span>
 method of the <span class="code">dateFormatter</span>
 to display the birthdate in the <span class="code">detailTextLabel</span>
 .</p>
<p class="indent">When your cell is completely configured, <span class="code">tableView( _:cellForRowAt:)</span>
 returns the cell at <span class="ent">➎</span>
 so that it can be displayed at that <span class="code">indexPath</span>
 of the table view.</p>
<h3 class="h3" id="ch11lev1sec2">
<strong>PUTTING IT ALL TOGETHER</strong>
</h3>
<p class="noindent">Now you can add <span class="code">Birthday</span>
 instances to the app using the Add Birthday view controller, and you have a table view to list each <span class="code">Birthday</span>
 in the Birthdays table view controller. But when you try running the app and adding a <span class="code">Birthday</span>
 , it doesn’t appear. To make each <span class="code">Birthday</span>
 you add appear in the table view, you need to make the Add Birthday view controller communicate with the Birthdays table view controller. You do this by using <em>delegation</em>
 .</p>
<h4 class="h4" id="ch11lev2sec5">
<strong>DELEGATION</strong>
</h4>
<p class="noindent">Delegation can be used when one view controller needs to get information from another view controller. Say you have two view controllers: A and B. The first view controller, A, creates B and presents B on top of itself. A knows about B because it created and presented B, so A can pass information along to B. But B doesn’t know about A—it’s just popped into being and doesn’t know where it came from or how it got there. So how can B talk to A? Through delegation!</p>
<div class="image"><img src="Image00245.jpg" />
</div>
<p class="indent">Delegation is when someone gives a job or a task to someone else. A <em>delegate</em>
 is like a boss who tells a delegating employee what to do. When the delegating employee is done with their task, sometimes they’ll report information back to the delegate boss.</p>
<p class="indent"><span id="page_167"></span>
 Delegation in Swift is pretty similar, but instead of having a boss and employee, we have a delegate and a delegating object. Since class B is the one being told what to do by class A, it’s the delegating object. We give class B a special property called a delegate to tell it who its delegate is—that way, it knows who to communicate with. The delegate can be any class that has a set of methods that have been defined in a <em>protocol</em>
 . A protocol is like an agreement between the two classes that tells them what the delegate can ask the delegating object to do. It has a list of method and property names that the delegate can use with the delegating object.</p>
<p class="indent">Class A creates class B, makes itself the delegate of class B, and gives class B a job to do that’s in the protocol. Once class B is done with its job, it reports back to class A. Let’s see how this works in our app.</p>
<p class="indent">The Birthdays table view controller is view controller A, and the Add Birthday view controller is view controller B. We’ll create a protocol called <span class="code">AddBirthdayViewControllerDelegate</span>
 and a method for that protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 , which the Add Birthday view controller will use to report back.</p>
<p class="indent">Take a look at <a href="text00022.html#ch11fig6">Figure 11-6</a>
 . When the user taps the Add button <span class="ent">➊</span>
 , the Birthdays table view controller creates the Add Birthday view controller <span class="ent">➋</span>
 and sets itself as the Add Birthday view controller’s delegate.</p>
<div class="image"><img src="Image00246.jpg" />
</div>
<p class="figcap"><a id="ch11fig6"></a>
 <em>Figure 11-6: A new birthday is added and passed from the Add Birthday view controller to the Birthdays table view controller using delegation.</em>
</p>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<div class="image"><img src="Image00244.jpg" />
</div>
<p class="bull">• Create a <span class="code">UITableViewCell</span>
</p>
<p class="bull">• Figure out which <span class="code">Birthday</span>
 in the <span class="code">birthdays</span>
 array will be displayed inside the cell</p>
<p class="bull">• Make two labels to display the birthday person’s name and birthdate in the cell</p>
<p class="bull">• Return the cell ready for display in the table view</p>
<p class="indentt">Let’s go through this code line by line.</p>
<p class="indent">First, create the <span class="code">UITableViewCell</span>
 . The code at <span class="ent">➊</span>
 does this using the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 . Before you can start using this method on a cell, though, you need to tell the method which cell you want to use from the storyboard. Earlier, when you were in the storyboard, you gave your cell the identifier <span class="code">birthdayCellIdentifier</span>
 (see <a href="text00022.html#ch11fig4">Figure 11-4</a>
 ). This identifier links your code to the cell and tells your method that it’s using the right cell. The string for when you call this method needs to be exactly the same as the string you set in the storyboard, or you’ll get an error and the app will crash when you run it.</p>
<p class="indent">In the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 , did you notice the words <em>Reusable Cell</em>
 ? The cells inside a table view are created once and then can be reused over and over. This helps everything run faster and smoother because creating the cell is what takes the most time. If you had 200 birthdays in your app, but only 10 would fit on your screen at one time, then you need only 10 cells to show your birthdays. When you scroll down to reveal more birthdays, the cells that scroll off the top of the screen are reused. They are filled with new information and show up again at the bottom of the screen. The <span class="code">UITableView</span>
 automatically does this work. When the table view is loaded, <span class="code">tableView(_:cellForRowAt:)</span>
 is called for every visible row. When the user scrolls to look at more cells, it’s called again for each row just as it is about to appear on the screen.</p>
<p class="indent">Next, we need to find out which <span class="code">Birthday</span>
 should be displayed inside the cell. We want to display one birthday from the <span class="code">birthdays</span>
 array in each row. The first birthday, which is at <span class="code">birthdays[0]</span>
 , should be displayed in row 0. The second birthday, at <span class="code">birthdays[1]</span>
 , should be displayed in row 1, and so on, which means the <span class="code">indexPath</span>
 ’s <span class="code">row</span>
 is the same as the position in the <span class="code">birthdays</span>
 array that we want to access. The code at <span class="ent">➋</span>
 accesses the <span id="page_166"></span>
 correct <span class="code">Birthday</span>
 object from the <span class="code">birthdays</span>
 array by using <span class="code">indexPath.row</span>
 . Once we have the right <span class="code">Birthday</span>
 object, we assign it to a constant named <span class="code">birthday</span>
 so we can set up the labels in this cell.</p>
<p class="indent">Notice that we’re using <span class="code">let</span>
 to assign the <span class="code">birthday</span>
 to a constant instead of a variable. We can use <span class="code">let</span>
 because each time <span class="code">tableView(_:cellForRowAt:)</span>
 is called, a new <span class="code">birthday</span>
 constant is created. Each cell gets its own <span class="code">birthday</span>
 constant that is assigned its own <span class="code">Birthday</span>
 object. Since we’re not going to change any of the <span class="code">birthday</span>
 constants—we’re just going to read their properties—we don’t want to make them variables.</p>
<p class="indent">Now that you have your cell and your birthday, it’s time to fill in the details. You need two labels for each cell to show the birthday person’s name and birthdate. You set the cell to the Subtitle style so that it has a Title label and a Subtitle label. Each cell will already contain these labels, so now you don’t have to create any labels yourself.</p>
<p class="indent">The labels exist as properties of <span class="code">UITableViewCell</span>
 and are called <span class="code">textLabel</span>
 and <span class="code">detailTextLabel</span>
 . The code at <span class="ent">➌</span>
 sets the text of the <span class="code">textLabel</span>
 to a string made up of the <span class="code">firstName</span>
 and <span class="code">lastName</span>
 of the <span class="code">birthday</span>
 with a space between them. At <span class="ent">➍</span>
 , you use the <span class="code">string(from:)</span>
 method of the <span class="code">dateFormatter</span>
 to display the birthdate in the <span class="code">detailTextLabel</span>
 .</p>
<p class="indent">When your cell is completely configured, <span class="code">tableView( _:cellForRowAt:)</span>
 returns the cell at <span class="ent">➎</span>
 so that it can be displayed at that <span class="code">indexPath</span>
 of the table view.</p>
<h3 class="h3" id="ch11lev1sec2">
<strong>PUTTING IT ALL TOGETHER</strong>
</h3>
<p class="noindent">Now you can add <span class="code">Birthday</span>
 instances to the app using the Add Birthday view controller, and you have a table view to list each <span class="code">Birthday</span>
 in the Birthdays table view controller. But when you try running the app and adding a <span class="code">Birthday</span>
 , it doesn’t appear. To make each <span class="code">Birthday</span>
 you add appear in the table view, you need to make the Add Birthday view controller communicate with the Birthdays table view controller. You do this by using <em>delegation</em>
 .</p>
<h4 class="h4" id="ch11lev2sec5">
<strong>DELEGATION</strong>
</h4>
<p class="noindent">Delegation can be used when one view controller needs to get information from another view controller. Say you have two view controllers: A and B. The first view controller, A, creates B and presents B on top of itself. A knows about B because it created and presented B, so A can pass information along to B. But B doesn’t know about A—it’s just popped into being and doesn’t know where it came from or how it got there. So how can B talk to A? Through delegation!</p>
<div class="image"><img src="Image00245.jpg" />
</div>
<p class="indent">Delegation is when someone gives a job or a task to someone else. A <em>delegate</em>
 is like a boss who tells a delegating employee what to do. When the delegating employee is done with their task, sometimes they’ll report information back to the delegate boss.</p>
<p class="indent"><span id="page_167"></span>
 Delegation in Swift is pretty similar, but instead of having a boss and employee, we have a delegate and a delegating object. Since class B is the one being told what to do by class A, it’s the delegating object. We give class B a special property called a delegate to tell it who its delegate is—that way, it knows who to communicate with. The delegate can be any class that has a set of methods that have been defined in a <em>protocol</em>
 . A protocol is like an agreement between the two classes that tells them what the delegate can ask the delegating object to do. It has a list of method and property names that the delegate can use with the delegating object.</p>
<p class="indent">Class A creates class B, makes itself the delegate of class B, and gives class B a job to do that’s in the protocol. Once class B is done with its job, it reports back to class A. Let’s see how this works in our app.</p>
<p class="indent">The Birthdays table view controller is view controller A, and the Add Birthday view controller is view controller B. We’ll create a protocol called <span class="code">AddBirthdayViewControllerDelegate</span>
 and a method for that protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 , which the Add Birthday view controller will use to report back.</p>
<p class="indent">Take a look at <a href="text00022.html#ch11fig6">Figure 11-6</a>
 . When the user taps the Add button <span class="ent">➊</span>
 , the Birthdays table view controller creates the Add Birthday view controller <span class="ent">➋</span>
 and sets itself as the Add Birthday view controller’s delegate.</p>
<div class="image"><img src="Image00246.jpg" />
</div>
<p class="figcap"><a id="ch11fig6"></a>
 <em>Figure 11-6: A new birthday is added and passed from the Add Birthday view controller to the Birthdays table view controller using delegation.</em>
</p>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="bull">• Create a <span class="code">UITableViewCell</span>
</p>
<p class="bull">• Figure out which <span class="code">Birthday</span>
 in the <span class="code">birthdays</span>
 array will be displayed inside the cell</p>
<p class="bull">• Make two labels to display the birthday person’s name and birthdate in the cell</p>
<p class="bull">• Return the cell ready for display in the table view</p>
<p class="indentt">Let’s go through this code line by line.</p>
<p class="indent">First, create the <span class="code">UITableViewCell</span>
 . The code at <span class="ent">➊</span>
 does this using the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 . Before you can start using this method on a cell, though, you need to tell the method which cell you want to use from the storyboard. Earlier, when you were in the storyboard, you gave your cell the identifier <span class="code">birthdayCellIdentifier</span>
 (see <a href="text00022.html#ch11fig4">Figure 11-4</a>
 ). This identifier links your code to the cell and tells your method that it’s using the right cell. The string for when you call this method needs to be exactly the same as the string you set in the storyboard, or you’ll get an error and the app will crash when you run it.</p>
<p class="indent">In the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 , did you notice the words <em>Reusable Cell</em>
 ? The cells inside a table view are created once and then can be reused over and over. This helps everything run faster and smoother because creating the cell is what takes the most time. If you had 200 birthdays in your app, but only 10 would fit on your screen at one time, then you need only 10 cells to show your birthdays. When you scroll down to reveal more birthdays, the cells that scroll off the top of the screen are reused. They are filled with new information and show up again at the bottom of the screen. The <span class="code">UITableView</span>
 automatically does this work. When the table view is loaded, <span class="code">tableView(_:cellForRowAt:)</span>
 is called for every visible row. When the user scrolls to look at more cells, it’s called again for each row just as it is about to appear on the screen.</p>
<p class="indent">Next, we need to find out which <span class="code">Birthday</span>
 should be displayed inside the cell. We want to display one birthday from the <span class="code">birthdays</span>
 array in each row. The first birthday, which is at <span class="code">birthdays[0]</span>
 , should be displayed in row 0. The second birthday, at <span class="code">birthdays[1]</span>
 , should be displayed in row 1, and so on, which means the <span class="code">indexPath</span>
 ’s <span class="code">row</span>
 is the same as the position in the <span class="code">birthdays</span>
 array that we want to access. The code at <span class="ent">➋</span>
 accesses the <span id="page_166"></span>
 correct <span class="code">Birthday</span>
 object from the <span class="code">birthdays</span>
 array by using <span class="code">indexPath.row</span>
 . Once we have the right <span class="code">Birthday</span>
 object, we assign it to a constant named <span class="code">birthday</span>
 so we can set up the labels in this cell.</p>
<p class="indent">Notice that we’re using <span class="code">let</span>
 to assign the <span class="code">birthday</span>
 to a constant instead of a variable. We can use <span class="code">let</span>
 because each time <span class="code">tableView(_:cellForRowAt:)</span>
 is called, a new <span class="code">birthday</span>
 constant is created. Each cell gets its own <span class="code">birthday</span>
 constant that is assigned its own <span class="code">Birthday</span>
 object. Since we’re not going to change any of the <span class="code">birthday</span>
 constants—we’re just going to read their properties—we don’t want to make them variables.</p>
<p class="indent">Now that you have your cell and your birthday, it’s time to fill in the details. You need two labels for each cell to show the birthday person’s name and birthdate. You set the cell to the Subtitle style so that it has a Title label and a Subtitle label. Each cell will already contain these labels, so now you don’t have to create any labels yourself.</p>
<p class="indent">The labels exist as properties of <span class="code">UITableViewCell</span>
 and are called <span class="code">textLabel</span>
 and <span class="code">detailTextLabel</span>
 . The code at <span class="ent">➌</span>
 sets the text of the <span class="code">textLabel</span>
 to a string made up of the <span class="code">firstName</span>
 and <span class="code">lastName</span>
 of the <span class="code">birthday</span>
 with a space between them. At <span class="ent">➍</span>
 , you use the <span class="code">string(from:)</span>
 method of the <span class="code">dateFormatter</span>
 to display the birthdate in the <span class="code">detailTextLabel</span>
 .</p>
<p class="indent">When your cell is completely configured, <span class="code">tableView( _:cellForRowAt:)</span>
 returns the cell at <span class="ent">➎</span>
 so that it can be displayed at that <span class="code">indexPath</span>
 of the table view.</p>
<h3 class="h3" id="ch11lev1sec2">
<strong>PUTTING IT ALL TOGETHER</strong>
</h3>
<p class="noindent">Now you can add <span class="code">Birthday</span>
 instances to the app using the Add Birthday view controller, and you have a table view to list each <span class="code">Birthday</span>
 in the Birthdays table view controller. But when you try running the app and adding a <span class="code">Birthday</span>
 , it doesn’t appear. To make each <span class="code">Birthday</span>
 you add appear in the table view, you need to make the Add Birthday view controller communicate with the Birthdays table view controller. You do this by using <em>delegation</em>
 .</p>
<h4 class="h4" id="ch11lev2sec5">
<strong>DELEGATION</strong>
</h4>
<p class="noindent">Delegation can be used when one view controller needs to get information from another view controller. Say you have two view controllers: A and B. The first view controller, A, creates B and presents B on top of itself. A knows about B because it created and presented B, so A can pass information along to B. But B doesn’t know about A—it’s just popped into being and doesn’t know where it came from or how it got there. So how can B talk to A? Through delegation!</p>
<div class="image"><img src="Image00245.jpg" />
</div>
<p class="indent">Delegation is when someone gives a job or a task to someone else. A <em>delegate</em>
 is like a boss who tells a delegating employee what to do. When the delegating employee is done with their task, sometimes they’ll report information back to the delegate boss.</p>
<p class="indent"><span id="page_167"></span>
 Delegation in Swift is pretty similar, but instead of having a boss and employee, we have a delegate and a delegating object. Since class B is the one being told what to do by class A, it’s the delegating object. We give class B a special property called a delegate to tell it who its delegate is—that way, it knows who to communicate with. The delegate can be any class that has a set of methods that have been defined in a <em>protocol</em>
 . A protocol is like an agreement between the two classes that tells them what the delegate can ask the delegating object to do. It has a list of method and property names that the delegate can use with the delegating object.</p>
<p class="indent">Class A creates class B, makes itself the delegate of class B, and gives class B a job to do that’s in the protocol. Once class B is done with its job, it reports back to class A. Let’s see how this works in our app.</p>
<p class="indent">The Birthdays table view controller is view controller A, and the Add Birthday view controller is view controller B. We’ll create a protocol called <span class="code">AddBirthdayViewControllerDelegate</span>
 and a method for that protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 , which the Add Birthday view controller will use to report back.</p>
<p class="indent">Take a look at <a href="text00022.html#ch11fig6">Figure 11-6</a>
 . When the user taps the Add button <span class="ent">➊</span>
 , the Birthdays table view controller creates the Add Birthday view controller <span class="ent">➋</span>
 and sets itself as the Add Birthday view controller’s delegate.</p>
<div class="image"><img src="Image00246.jpg" />
</div>
<p class="figcap"><a id="ch11fig6"></a>
 <em>Figure 11-6: A new birthday is added and passed from the Add Birthday view controller to the Birthdays table view controller using delegation.</em>
</p>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="bull">• Figure out which <span class="code">Birthday</span>
 in the <span class="code">birthdays</span>
 array will be displayed inside the cell</p>
<p class="bull">• Make two labels to display the birthday person’s name and birthdate in the cell</p>
<p class="bull">• Return the cell ready for display in the table view</p>
<p class="indentt">Let’s go through this code line by line.</p>
<p class="indent">First, create the <span class="code">UITableViewCell</span>
 . The code at <span class="ent">➊</span>
 does this using the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 . Before you can start using this method on a cell, though, you need to tell the method which cell you want to use from the storyboard. Earlier, when you were in the storyboard, you gave your cell the identifier <span class="code">birthdayCellIdentifier</span>
 (see <a href="text00022.html#ch11fig4">Figure 11-4</a>
 ). This identifier links your code to the cell and tells your method that it’s using the right cell. The string for when you call this method needs to be exactly the same as the string you set in the storyboard, or you’ll get an error and the app will crash when you run it.</p>
<p class="indent">In the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 , did you notice the words <em>Reusable Cell</em>
 ? The cells inside a table view are created once and then can be reused over and over. This helps everything run faster and smoother because creating the cell is what takes the most time. If you had 200 birthdays in your app, but only 10 would fit on your screen at one time, then you need only 10 cells to show your birthdays. When you scroll down to reveal more birthdays, the cells that scroll off the top of the screen are reused. They are filled with new information and show up again at the bottom of the screen. The <span class="code">UITableView</span>
 automatically does this work. When the table view is loaded, <span class="code">tableView(_:cellForRowAt:)</span>
 is called for every visible row. When the user scrolls to look at more cells, it’s called again for each row just as it is about to appear on the screen.</p>
<p class="indent">Next, we need to find out which <span class="code">Birthday</span>
 should be displayed inside the cell. We want to display one birthday from the <span class="code">birthdays</span>
 array in each row. The first birthday, which is at <span class="code">birthdays[0]</span>
 , should be displayed in row 0. The second birthday, at <span class="code">birthdays[1]</span>
 , should be displayed in row 1, and so on, which means the <span class="code">indexPath</span>
 ’s <span class="code">row</span>
 is the same as the position in the <span class="code">birthdays</span>
 array that we want to access. The code at <span class="ent">➋</span>
 accesses the <span id="page_166"></span>
 correct <span class="code">Birthday</span>
 object from the <span class="code">birthdays</span>
 array by using <span class="code">indexPath.row</span>
 . Once we have the right <span class="code">Birthday</span>
 object, we assign it to a constant named <span class="code">birthday</span>
 so we can set up the labels in this cell.</p>
<p class="indent">Notice that we’re using <span class="code">let</span>
 to assign the <span class="code">birthday</span>
 to a constant instead of a variable. We can use <span class="code">let</span>
 because each time <span class="code">tableView(_:cellForRowAt:)</span>
 is called, a new <span class="code">birthday</span>
 constant is created. Each cell gets its own <span class="code">birthday</span>
 constant that is assigned its own <span class="code">Birthday</span>
 object. Since we’re not going to change any of the <span class="code">birthday</span>
 constants—we’re just going to read their properties—we don’t want to make them variables.</p>
<p class="indent">Now that you have your cell and your birthday, it’s time to fill in the details. You need two labels for each cell to show the birthday person’s name and birthdate. You set the cell to the Subtitle style so that it has a Title label and a Subtitle label. Each cell will already contain these labels, so now you don’t have to create any labels yourself.</p>
<p class="indent">The labels exist as properties of <span class="code">UITableViewCell</span>
 and are called <span class="code">textLabel</span>
 and <span class="code">detailTextLabel</span>
 . The code at <span class="ent">➌</span>
 sets the text of the <span class="code">textLabel</span>
 to a string made up of the <span class="code">firstName</span>
 and <span class="code">lastName</span>
 of the <span class="code">birthday</span>
 with a space between them. At <span class="ent">➍</span>
 , you use the <span class="code">string(from:)</span>
 method of the <span class="code">dateFormatter</span>
 to display the birthdate in the <span class="code">detailTextLabel</span>
 .</p>
<p class="indent">When your cell is completely configured, <span class="code">tableView( _:cellForRowAt:)</span>
 returns the cell at <span class="ent">➎</span>
 so that it can be displayed at that <span class="code">indexPath</span>
 of the table view.</p>
<h3 class="h3" id="ch11lev1sec2">
<strong>PUTTING IT ALL TOGETHER</strong>
</h3>
<p class="noindent">Now you can add <span class="code">Birthday</span>
 instances to the app using the Add Birthday view controller, and you have a table view to list each <span class="code">Birthday</span>
 in the Birthdays table view controller. But when you try running the app and adding a <span class="code">Birthday</span>
 , it doesn’t appear. To make each <span class="code">Birthday</span>
 you add appear in the table view, you need to make the Add Birthday view controller communicate with the Birthdays table view controller. You do this by using <em>delegation</em>
 .</p>
<h4 class="h4" id="ch11lev2sec5">
<strong>DELEGATION</strong>
</h4>
<p class="noindent">Delegation can be used when one view controller needs to get information from another view controller. Say you have two view controllers: A and B. The first view controller, A, creates B and presents B on top of itself. A knows about B because it created and presented B, so A can pass information along to B. But B doesn’t know about A—it’s just popped into being and doesn’t know where it came from or how it got there. So how can B talk to A? Through delegation!</p>
<div class="image"><img src="Image00245.jpg" />
</div>
<p class="indent">Delegation is when someone gives a job or a task to someone else. A <em>delegate</em>
 is like a boss who tells a delegating employee what to do. When the delegating employee is done with their task, sometimes they’ll report information back to the delegate boss.</p>
<p class="indent"><span id="page_167"></span>
 Delegation in Swift is pretty similar, but instead of having a boss and employee, we have a delegate and a delegating object. Since class B is the one being told what to do by class A, it’s the delegating object. We give class B a special property called a delegate to tell it who its delegate is—that way, it knows who to communicate with. The delegate can be any class that has a set of methods that have been defined in a <em>protocol</em>
 . A protocol is like an agreement between the two classes that tells them what the delegate can ask the delegating object to do. It has a list of method and property names that the delegate can use with the delegating object.</p>
<p class="indent">Class A creates class B, makes itself the delegate of class B, and gives class B a job to do that’s in the protocol. Once class B is done with its job, it reports back to class A. Let’s see how this works in our app.</p>
<p class="indent">The Birthdays table view controller is view controller A, and the Add Birthday view controller is view controller B. We’ll create a protocol called <span class="code">AddBirthdayViewControllerDelegate</span>
 and a method for that protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 , which the Add Birthday view controller will use to report back.</p>
<p class="indent">Take a look at <a href="text00022.html#ch11fig6">Figure 11-6</a>
 . When the user taps the Add button <span class="ent">➊</span>
 , the Birthdays table view controller creates the Add Birthday view controller <span class="ent">➋</span>
 and sets itself as the Add Birthday view controller’s delegate.</p>
<div class="image"><img src="Image00246.jpg" />
</div>
<p class="figcap"><a id="ch11fig6"></a>
 <em>Figure 11-6: A new birthday is added and passed from the Add Birthday view controller to the Birthdays table view controller using delegation.</em>
</p>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="bull">• Make two labels to display the birthday person’s name and birthdate in the cell</p>
<p class="bull">• Return the cell ready for display in the table view</p>
<p class="indentt">Let’s go through this code line by line.</p>
<p class="indent">First, create the <span class="code">UITableViewCell</span>
 . The code at <span class="ent">➊</span>
 does this using the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 . Before you can start using this method on a cell, though, you need to tell the method which cell you want to use from the storyboard. Earlier, when you were in the storyboard, you gave your cell the identifier <span class="code">birthdayCellIdentifier</span>
 (see <a href="text00022.html#ch11fig4">Figure 11-4</a>
 ). This identifier links your code to the cell and tells your method that it’s using the right cell. The string for when you call this method needs to be exactly the same as the string you set in the storyboard, or you’ll get an error and the app will crash when you run it.</p>
<p class="indent">In the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 , did you notice the words <em>Reusable Cell</em>
 ? The cells inside a table view are created once and then can be reused over and over. This helps everything run faster and smoother because creating the cell is what takes the most time. If you had 200 birthdays in your app, but only 10 would fit on your screen at one time, then you need only 10 cells to show your birthdays. When you scroll down to reveal more birthdays, the cells that scroll off the top of the screen are reused. They are filled with new information and show up again at the bottom of the screen. The <span class="code">UITableView</span>
 automatically does this work. When the table view is loaded, <span class="code">tableView(_:cellForRowAt:)</span>
 is called for every visible row. When the user scrolls to look at more cells, it’s called again for each row just as it is about to appear on the screen.</p>
<p class="indent">Next, we need to find out which <span class="code">Birthday</span>
 should be displayed inside the cell. We want to display one birthday from the <span class="code">birthdays</span>
 array in each row. The first birthday, which is at <span class="code">birthdays[0]</span>
 , should be displayed in row 0. The second birthday, at <span class="code">birthdays[1]</span>
 , should be displayed in row 1, and so on, which means the <span class="code">indexPath</span>
 ’s <span class="code">row</span>
 is the same as the position in the <span class="code">birthdays</span>
 array that we want to access. The code at <span class="ent">➋</span>
 accesses the <span id="page_166"></span>
 correct <span class="code">Birthday</span>
 object from the <span class="code">birthdays</span>
 array by using <span class="code">indexPath.row</span>
 . Once we have the right <span class="code">Birthday</span>
 object, we assign it to a constant named <span class="code">birthday</span>
 so we can set up the labels in this cell.</p>
<p class="indent">Notice that we’re using <span class="code">let</span>
 to assign the <span class="code">birthday</span>
 to a constant instead of a variable. We can use <span class="code">let</span>
 because each time <span class="code">tableView(_:cellForRowAt:)</span>
 is called, a new <span class="code">birthday</span>
 constant is created. Each cell gets its own <span class="code">birthday</span>
 constant that is assigned its own <span class="code">Birthday</span>
 object. Since we’re not going to change any of the <span class="code">birthday</span>
 constants—we’re just going to read their properties—we don’t want to make them variables.</p>
<p class="indent">Now that you have your cell and your birthday, it’s time to fill in the details. You need two labels for each cell to show the birthday person’s name and birthdate. You set the cell to the Subtitle style so that it has a Title label and a Subtitle label. Each cell will already contain these labels, so now you don’t have to create any labels yourself.</p>
<p class="indent">The labels exist as properties of <span class="code">UITableViewCell</span>
 and are called <span class="code">textLabel</span>
 and <span class="code">detailTextLabel</span>
 . The code at <span class="ent">➌</span>
 sets the text of the <span class="code">textLabel</span>
 to a string made up of the <span class="code">firstName</span>
 and <span class="code">lastName</span>
 of the <span class="code">birthday</span>
 with a space between them. At <span class="ent">➍</span>
 , you use the <span class="code">string(from:)</span>
 method of the <span class="code">dateFormatter</span>
 to display the birthdate in the <span class="code">detailTextLabel</span>
 .</p>
<p class="indent">When your cell is completely configured, <span class="code">tableView( _:cellForRowAt:)</span>
 returns the cell at <span class="ent">➎</span>
 so that it can be displayed at that <span class="code">indexPath</span>
 of the table view.</p>
<h3 class="h3" id="ch11lev1sec2">
<strong>PUTTING IT ALL TOGETHER</strong>
</h3>
<p class="noindent">Now you can add <span class="code">Birthday</span>
 instances to the app using the Add Birthday view controller, and you have a table view to list each <span class="code">Birthday</span>
 in the Birthdays table view controller. But when you try running the app and adding a <span class="code">Birthday</span>
 , it doesn’t appear. To make each <span class="code">Birthday</span>
 you add appear in the table view, you need to make the Add Birthday view controller communicate with the Birthdays table view controller. You do this by using <em>delegation</em>
 .</p>
<h4 class="h4" id="ch11lev2sec5">
<strong>DELEGATION</strong>
</h4>
<p class="noindent">Delegation can be used when one view controller needs to get information from another view controller. Say you have two view controllers: A and B. The first view controller, A, creates B and presents B on top of itself. A knows about B because it created and presented B, so A can pass information along to B. But B doesn’t know about A—it’s just popped into being and doesn’t know where it came from or how it got there. So how can B talk to A? Through delegation!</p>
<div class="image"><img src="Image00245.jpg" />
</div>
<p class="indent">Delegation is when someone gives a job or a task to someone else. A <em>delegate</em>
 is like a boss who tells a delegating employee what to do. When the delegating employee is done with their task, sometimes they’ll report information back to the delegate boss.</p>
<p class="indent"><span id="page_167"></span>
 Delegation in Swift is pretty similar, but instead of having a boss and employee, we have a delegate and a delegating object. Since class B is the one being told what to do by class A, it’s the delegating object. We give class B a special property called a delegate to tell it who its delegate is—that way, it knows who to communicate with. The delegate can be any class that has a set of methods that have been defined in a <em>protocol</em>
 . A protocol is like an agreement between the two classes that tells them what the delegate can ask the delegating object to do. It has a list of method and property names that the delegate can use with the delegating object.</p>
<p class="indent">Class A creates class B, makes itself the delegate of class B, and gives class B a job to do that’s in the protocol. Once class B is done with its job, it reports back to class A. Let’s see how this works in our app.</p>
<p class="indent">The Birthdays table view controller is view controller A, and the Add Birthday view controller is view controller B. We’ll create a protocol called <span class="code">AddBirthdayViewControllerDelegate</span>
 and a method for that protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 , which the Add Birthday view controller will use to report back.</p>
<p class="indent">Take a look at <a href="text00022.html#ch11fig6">Figure 11-6</a>
 . When the user taps the Add button <span class="ent">➊</span>
 , the Birthdays table view controller creates the Add Birthday view controller <span class="ent">➋</span>
 and sets itself as the Add Birthday view controller’s delegate.</p>
<div class="image"><img src="Image00246.jpg" />
</div>
<p class="figcap"><a id="ch11fig6"></a>
 <em>Figure 11-6: A new birthday is added and passed from the Add Birthday view controller to the Birthdays table view controller using delegation.</em>
</p>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="bull">• Return the cell ready for display in the table view</p>
<p class="indentt">Let’s go through this code line by line.</p>
<p class="indent">First, create the <span class="code">UITableViewCell</span>
 . The code at <span class="ent">➊</span>
 does this using the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 . Before you can start using this method on a cell, though, you need to tell the method which cell you want to use from the storyboard. Earlier, when you were in the storyboard, you gave your cell the identifier <span class="code">birthdayCellIdentifier</span>
 (see <a href="text00022.html#ch11fig4">Figure 11-4</a>
 ). This identifier links your code to the cell and tells your method that it’s using the right cell. The string for when you call this method needs to be exactly the same as the string you set in the storyboard, or you’ll get an error and the app will crash when you run it.</p>
<p class="indent">In the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 , did you notice the words <em>Reusable Cell</em>
 ? The cells inside a table view are created once and then can be reused over and over. This helps everything run faster and smoother because creating the cell is what takes the most time. If you had 200 birthdays in your app, but only 10 would fit on your screen at one time, then you need only 10 cells to show your birthdays. When you scroll down to reveal more birthdays, the cells that scroll off the top of the screen are reused. They are filled with new information and show up again at the bottom of the screen. The <span class="code">UITableView</span>
 automatically does this work. When the table view is loaded, <span class="code">tableView(_:cellForRowAt:)</span>
 is called for every visible row. When the user scrolls to look at more cells, it’s called again for each row just as it is about to appear on the screen.</p>
<p class="indent">Next, we need to find out which <span class="code">Birthday</span>
 should be displayed inside the cell. We want to display one birthday from the <span class="code">birthdays</span>
 array in each row. The first birthday, which is at <span class="code">birthdays[0]</span>
 , should be displayed in row 0. The second birthday, at <span class="code">birthdays[1]</span>
 , should be displayed in row 1, and so on, which means the <span class="code">indexPath</span>
 ’s <span class="code">row</span>
 is the same as the position in the <span class="code">birthdays</span>
 array that we want to access. The code at <span class="ent">➋</span>
 accesses the <span id="page_166"></span>
 correct <span class="code">Birthday</span>
 object from the <span class="code">birthdays</span>
 array by using <span class="code">indexPath.row</span>
 . Once we have the right <span class="code">Birthday</span>
 object, we assign it to a constant named <span class="code">birthday</span>
 so we can set up the labels in this cell.</p>
<p class="indent">Notice that we’re using <span class="code">let</span>
 to assign the <span class="code">birthday</span>
 to a constant instead of a variable. We can use <span class="code">let</span>
 because each time <span class="code">tableView(_:cellForRowAt:)</span>
 is called, a new <span class="code">birthday</span>
 constant is created. Each cell gets its own <span class="code">birthday</span>
 constant that is assigned its own <span class="code">Birthday</span>
 object. Since we’re not going to change any of the <span class="code">birthday</span>
 constants—we’re just going to read their properties—we don’t want to make them variables.</p>
<p class="indent">Now that you have your cell and your birthday, it’s time to fill in the details. You need two labels for each cell to show the birthday person’s name and birthdate. You set the cell to the Subtitle style so that it has a Title label and a Subtitle label. Each cell will already contain these labels, so now you don’t have to create any labels yourself.</p>
<p class="indent">The labels exist as properties of <span class="code">UITableViewCell</span>
 and are called <span class="code">textLabel</span>
 and <span class="code">detailTextLabel</span>
 . The code at <span class="ent">➌</span>
 sets the text of the <span class="code">textLabel</span>
 to a string made up of the <span class="code">firstName</span>
 and <span class="code">lastName</span>
 of the <span class="code">birthday</span>
 with a space between them. At <span class="ent">➍</span>
 , you use the <span class="code">string(from:)</span>
 method of the <span class="code">dateFormatter</span>
 to display the birthdate in the <span class="code">detailTextLabel</span>
 .</p>
<p class="indent">When your cell is completely configured, <span class="code">tableView( _:cellForRowAt:)</span>
 returns the cell at <span class="ent">➎</span>
 so that it can be displayed at that <span class="code">indexPath</span>
 of the table view.</p>
<h3 class="h3" id="ch11lev1sec2">
<strong>PUTTING IT ALL TOGETHER</strong>
</h3>
<p class="noindent">Now you can add <span class="code">Birthday</span>
 instances to the app using the Add Birthday view controller, and you have a table view to list each <span class="code">Birthday</span>
 in the Birthdays table view controller. But when you try running the app and adding a <span class="code">Birthday</span>
 , it doesn’t appear. To make each <span class="code">Birthday</span>
 you add appear in the table view, you need to make the Add Birthday view controller communicate with the Birthdays table view controller. You do this by using <em>delegation</em>
 .</p>
<h4 class="h4" id="ch11lev2sec5">
<strong>DELEGATION</strong>
</h4>
<p class="noindent">Delegation can be used when one view controller needs to get information from another view controller. Say you have two view controllers: A and B. The first view controller, A, creates B and presents B on top of itself. A knows about B because it created and presented B, so A can pass information along to B. But B doesn’t know about A—it’s just popped into being and doesn’t know where it came from or how it got there. So how can B talk to A? Through delegation!</p>
<div class="image"><img src="Image00245.jpg" />
</div>
<p class="indent">Delegation is when someone gives a job or a task to someone else. A <em>delegate</em>
 is like a boss who tells a delegating employee what to do. When the delegating employee is done with their task, sometimes they’ll report information back to the delegate boss.</p>
<p class="indent"><span id="page_167"></span>
 Delegation in Swift is pretty similar, but instead of having a boss and employee, we have a delegate and a delegating object. Since class B is the one being told what to do by class A, it’s the delegating object. We give class B a special property called a delegate to tell it who its delegate is—that way, it knows who to communicate with. The delegate can be any class that has a set of methods that have been defined in a <em>protocol</em>
 . A protocol is like an agreement between the two classes that tells them what the delegate can ask the delegating object to do. It has a list of method and property names that the delegate can use with the delegating object.</p>
<p class="indent">Class A creates class B, makes itself the delegate of class B, and gives class B a job to do that’s in the protocol. Once class B is done with its job, it reports back to class A. Let’s see how this works in our app.</p>
<p class="indent">The Birthdays table view controller is view controller A, and the Add Birthday view controller is view controller B. We’ll create a protocol called <span class="code">AddBirthdayViewControllerDelegate</span>
 and a method for that protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 , which the Add Birthday view controller will use to report back.</p>
<p class="indent">Take a look at <a href="text00022.html#ch11fig6">Figure 11-6</a>
 . When the user taps the Add button <span class="ent">➊</span>
 , the Birthdays table view controller creates the Add Birthday view controller <span class="ent">➋</span>
 and sets itself as the Add Birthday view controller’s delegate.</p>
<div class="image"><img src="Image00246.jpg" />
</div>
<p class="figcap"><a id="ch11fig6"></a>
 <em>Figure 11-6: A new birthday is added and passed from the Add Birthday view controller to the Birthdays table view controller using delegation.</em>
</p>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="indentt">Let’s go through this code line by line.</p>
<p class="indent">First, create the <span class="code">UITableViewCell</span>
 . The code at <span class="ent">➊</span>
 does this using the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 . Before you can start using this method on a cell, though, you need to tell the method which cell you want to use from the storyboard. Earlier, when you were in the storyboard, you gave your cell the identifier <span class="code">birthdayCellIdentifier</span>
 (see <a href="text00022.html#ch11fig4">Figure 11-4</a>
 ). This identifier links your code to the cell and tells your method that it’s using the right cell. The string for when you call this method needs to be exactly the same as the string you set in the storyboard, or you’ll get an error and the app will crash when you run it.</p>
<p class="indent">In the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 , did you notice the words <em>Reusable Cell</em>
 ? The cells inside a table view are created once and then can be reused over and over. This helps everything run faster and smoother because creating the cell is what takes the most time. If you had 200 birthdays in your app, but only 10 would fit on your screen at one time, then you need only 10 cells to show your birthdays. When you scroll down to reveal more birthdays, the cells that scroll off the top of the screen are reused. They are filled with new information and show up again at the bottom of the screen. The <span class="code">UITableView</span>
 automatically does this work. When the table view is loaded, <span class="code">tableView(_:cellForRowAt:)</span>
 is called for every visible row. When the user scrolls to look at more cells, it’s called again for each row just as it is about to appear on the screen.</p>
<p class="indent">Next, we need to find out which <span class="code">Birthday</span>
 should be displayed inside the cell. We want to display one birthday from the <span class="code">birthdays</span>
 array in each row. The first birthday, which is at <span class="code">birthdays[0]</span>
 , should be displayed in row 0. The second birthday, at <span class="code">birthdays[1]</span>
 , should be displayed in row 1, and so on, which means the <span class="code">indexPath</span>
 ’s <span class="code">row</span>
 is the same as the position in the <span class="code">birthdays</span>
 array that we want to access. The code at <span class="ent">➋</span>
 accesses the <span id="page_166"></span>
 correct <span class="code">Birthday</span>
 object from the <span class="code">birthdays</span>
 array by using <span class="code">indexPath.row</span>
 . Once we have the right <span class="code">Birthday</span>
 object, we assign it to a constant named <span class="code">birthday</span>
 so we can set up the labels in this cell.</p>
<p class="indent">Notice that we’re using <span class="code">let</span>
 to assign the <span class="code">birthday</span>
 to a constant instead of a variable. We can use <span class="code">let</span>
 because each time <span class="code">tableView(_:cellForRowAt:)</span>
 is called, a new <span class="code">birthday</span>
 constant is created. Each cell gets its own <span class="code">birthday</span>
 constant that is assigned its own <span class="code">Birthday</span>
 object. Since we’re not going to change any of the <span class="code">birthday</span>
 constants—we’re just going to read their properties—we don’t want to make them variables.</p>
<p class="indent">Now that you have your cell and your birthday, it’s time to fill in the details. You need two labels for each cell to show the birthday person’s name and birthdate. You set the cell to the Subtitle style so that it has a Title label and a Subtitle label. Each cell will already contain these labels, so now you don’t have to create any labels yourself.</p>
<p class="indent">The labels exist as properties of <span class="code">UITableViewCell</span>
 and are called <span class="code">textLabel</span>
 and <span class="code">detailTextLabel</span>
 . The code at <span class="ent">➌</span>
 sets the text of the <span class="code">textLabel</span>
 to a string made up of the <span class="code">firstName</span>
 and <span class="code">lastName</span>
 of the <span class="code">birthday</span>
 with a space between them. At <span class="ent">➍</span>
 , you use the <span class="code">string(from:)</span>
 method of the <span class="code">dateFormatter</span>
 to display the birthdate in the <span class="code">detailTextLabel</span>
 .</p>
<p class="indent">When your cell is completely configured, <span class="code">tableView( _:cellForRowAt:)</span>
 returns the cell at <span class="ent">➎</span>
 so that it can be displayed at that <span class="code">indexPath</span>
 of the table view.</p>
<h3 class="h3" id="ch11lev1sec2">
<strong>PUTTING IT ALL TOGETHER</strong>
</h3>
<p class="noindent">Now you can add <span class="code">Birthday</span>
 instances to the app using the Add Birthday view controller, and you have a table view to list each <span class="code">Birthday</span>
 in the Birthdays table view controller. But when you try running the app and adding a <span class="code">Birthday</span>
 , it doesn’t appear. To make each <span class="code">Birthday</span>
 you add appear in the table view, you need to make the Add Birthday view controller communicate with the Birthdays table view controller. You do this by using <em>delegation</em>
 .</p>
<h4 class="h4" id="ch11lev2sec5">
<strong>DELEGATION</strong>
</h4>
<p class="noindent">Delegation can be used when one view controller needs to get information from another view controller. Say you have two view controllers: A and B. The first view controller, A, creates B and presents B on top of itself. A knows about B because it created and presented B, so A can pass information along to B. But B doesn’t know about A—it’s just popped into being and doesn’t know where it came from or how it got there. So how can B talk to A? Through delegation!</p>
<div class="image"><img src="Image00245.jpg" />
</div>
<p class="indent">Delegation is when someone gives a job or a task to someone else. A <em>delegate</em>
 is like a boss who tells a delegating employee what to do. When the delegating employee is done with their task, sometimes they’ll report information back to the delegate boss.</p>
<p class="indent"><span id="page_167"></span>
 Delegation in Swift is pretty similar, but instead of having a boss and employee, we have a delegate and a delegating object. Since class B is the one being told what to do by class A, it’s the delegating object. We give class B a special property called a delegate to tell it who its delegate is—that way, it knows who to communicate with. The delegate can be any class that has a set of methods that have been defined in a <em>protocol</em>
 . A protocol is like an agreement between the two classes that tells them what the delegate can ask the delegating object to do. It has a list of method and property names that the delegate can use with the delegating object.</p>
<p class="indent">Class A creates class B, makes itself the delegate of class B, and gives class B a job to do that’s in the protocol. Once class B is done with its job, it reports back to class A. Let’s see how this works in our app.</p>
<p class="indent">The Birthdays table view controller is view controller A, and the Add Birthday view controller is view controller B. We’ll create a protocol called <span class="code">AddBirthdayViewControllerDelegate</span>
 and a method for that protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 , which the Add Birthday view controller will use to report back.</p>
<p class="indent">Take a look at <a href="text00022.html#ch11fig6">Figure 11-6</a>
 . When the user taps the Add button <span class="ent">➊</span>
 , the Birthdays table view controller creates the Add Birthday view controller <span class="ent">➋</span>
 and sets itself as the Add Birthday view controller’s delegate.</p>
<div class="image"><img src="Image00246.jpg" />
</div>
<p class="figcap"><a id="ch11fig6"></a>
 <em>Figure 11-6: A new birthday is added and passed from the Add Birthday view controller to the Birthdays table view controller using delegation.</em>
</p>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="indent">First, create the <span class="code">UITableViewCell</span>
 . The code at <span class="ent">➊</span>
 does this using the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 . Before you can start using this method on a cell, though, you need to tell the method which cell you want to use from the storyboard. Earlier, when you were in the storyboard, you gave your cell the identifier <span class="code">birthdayCellIdentifier</span>
 (see <a href="text00022.html#ch11fig4">Figure 11-4</a>
 ). This identifier links your code to the cell and tells your method that it’s using the right cell. The string for when you call this method needs to be exactly the same as the string you set in the storyboard, or you’ll get an error and the app will crash when you run it.</p>
<p class="indent">In the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 , did you notice the words <em>Reusable Cell</em>
 ? The cells inside a table view are created once and then can be reused over and over. This helps everything run faster and smoother because creating the cell is what takes the most time. If you had 200 birthdays in your app, but only 10 would fit on your screen at one time, then you need only 10 cells to show your birthdays. When you scroll down to reveal more birthdays, the cells that scroll off the top of the screen are reused. They are filled with new information and show up again at the bottom of the screen. The <span class="code">UITableView</span>
 automatically does this work. When the table view is loaded, <span class="code">tableView(_:cellForRowAt:)</span>
 is called for every visible row. When the user scrolls to look at more cells, it’s called again for each row just as it is about to appear on the screen.</p>
<p class="indent">Next, we need to find out which <span class="code">Birthday</span>
 should be displayed inside the cell. We want to display one birthday from the <span class="code">birthdays</span>
 array in each row. The first birthday, which is at <span class="code">birthdays[0]</span>
 , should be displayed in row 0. The second birthday, at <span class="code">birthdays[1]</span>
 , should be displayed in row 1, and so on, which means the <span class="code">indexPath</span>
 ’s <span class="code">row</span>
 is the same as the position in the <span class="code">birthdays</span>
 array that we want to access. The code at <span class="ent">➋</span>
 accesses the <span id="page_166"></span>
 correct <span class="code">Birthday</span>
 object from the <span class="code">birthdays</span>
 array by using <span class="code">indexPath.row</span>
 . Once we have the right <span class="code">Birthday</span>
 object, we assign it to a constant named <span class="code">birthday</span>
 so we can set up the labels in this cell.</p>
<p class="indent">Notice that we’re using <span class="code">let</span>
 to assign the <span class="code">birthday</span>
 to a constant instead of a variable. We can use <span class="code">let</span>
 because each time <span class="code">tableView(_:cellForRowAt:)</span>
 is called, a new <span class="code">birthday</span>
 constant is created. Each cell gets its own <span class="code">birthday</span>
 constant that is assigned its own <span class="code">Birthday</span>
 object. Since we’re not going to change any of the <span class="code">birthday</span>
 constants—we’re just going to read their properties—we don’t want to make them variables.</p>
<p class="indent">Now that you have your cell and your birthday, it’s time to fill in the details. You need two labels for each cell to show the birthday person’s name and birthdate. You set the cell to the Subtitle style so that it has a Title label and a Subtitle label. Each cell will already contain these labels, so now you don’t have to create any labels yourself.</p>
<p class="indent">The labels exist as properties of <span class="code">UITableViewCell</span>
 and are called <span class="code">textLabel</span>
 and <span class="code">detailTextLabel</span>
 . The code at <span class="ent">➌</span>
 sets the text of the <span class="code">textLabel</span>
 to a string made up of the <span class="code">firstName</span>
 and <span class="code">lastName</span>
 of the <span class="code">birthday</span>
 with a space between them. At <span class="ent">➍</span>
 , you use the <span class="code">string(from:)</span>
 method of the <span class="code">dateFormatter</span>
 to display the birthdate in the <span class="code">detailTextLabel</span>
 .</p>
<p class="indent">When your cell is completely configured, <span class="code">tableView( _:cellForRowAt:)</span>
 returns the cell at <span class="ent">➎</span>
 so that it can be displayed at that <span class="code">indexPath</span>
 of the table view.</p>
<h3 class="h3" id="ch11lev1sec2">
<strong>PUTTING IT ALL TOGETHER</strong>
</h3>
<p class="noindent">Now you can add <span class="code">Birthday</span>
 instances to the app using the Add Birthday view controller, and you have a table view to list each <span class="code">Birthday</span>
 in the Birthdays table view controller. But when you try running the app and adding a <span class="code">Birthday</span>
 , it doesn’t appear. To make each <span class="code">Birthday</span>
 you add appear in the table view, you need to make the Add Birthday view controller communicate with the Birthdays table view controller. You do this by using <em>delegation</em>
 .</p>
<h4 class="h4" id="ch11lev2sec5">
<strong>DELEGATION</strong>
</h4>
<p class="noindent">Delegation can be used when one view controller needs to get information from another view controller. Say you have two view controllers: A and B. The first view controller, A, creates B and presents B on top of itself. A knows about B because it created and presented B, so A can pass information along to B. But B doesn’t know about A—it’s just popped into being and doesn’t know where it came from or how it got there. So how can B talk to A? Through delegation!</p>
<div class="image"><img src="Image00245.jpg" />
</div>
<p class="indent">Delegation is when someone gives a job or a task to someone else. A <em>delegate</em>
 is like a boss who tells a delegating employee what to do. When the delegating employee is done with their task, sometimes they’ll report information back to the delegate boss.</p>
<p class="indent"><span id="page_167"></span>
 Delegation in Swift is pretty similar, but instead of having a boss and employee, we have a delegate and a delegating object. Since class B is the one being told what to do by class A, it’s the delegating object. We give class B a special property called a delegate to tell it who its delegate is—that way, it knows who to communicate with. The delegate can be any class that has a set of methods that have been defined in a <em>protocol</em>
 . A protocol is like an agreement between the two classes that tells them what the delegate can ask the delegating object to do. It has a list of method and property names that the delegate can use with the delegating object.</p>
<p class="indent">Class A creates class B, makes itself the delegate of class B, and gives class B a job to do that’s in the protocol. Once class B is done with its job, it reports back to class A. Let’s see how this works in our app.</p>
<p class="indent">The Birthdays table view controller is view controller A, and the Add Birthday view controller is view controller B. We’ll create a protocol called <span class="code">AddBirthdayViewControllerDelegate</span>
 and a method for that protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 , which the Add Birthday view controller will use to report back.</p>
<p class="indent">Take a look at <a href="text00022.html#ch11fig6">Figure 11-6</a>
 . When the user taps the Add button <span class="ent">➊</span>
 , the Birthdays table view controller creates the Add Birthday view controller <span class="ent">➋</span>
 and sets itself as the Add Birthday view controller’s delegate.</p>
<div class="image"><img src="Image00246.jpg" />
</div>
<p class="figcap"><a id="ch11fig6"></a>
 <em>Figure 11-6: A new birthday is added and passed from the Add Birthday view controller to the Birthdays table view controller using delegation.</em>
</p>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="indent">In the method <span class="code">dequeueReusableCell(withIdentifier:for:)</span>
 , did you notice the words <em>Reusable Cell</em>
 ? The cells inside a table view are created once and then can be reused over and over. This helps everything run faster and smoother because creating the cell is what takes the most time. If you had 200 birthdays in your app, but only 10 would fit on your screen at one time, then you need only 10 cells to show your birthdays. When you scroll down to reveal more birthdays, the cells that scroll off the top of the screen are reused. They are filled with new information and show up again at the bottom of the screen. The <span class="code">UITableView</span>
 automatically does this work. When the table view is loaded, <span class="code">tableView(_:cellForRowAt:)</span>
 is called for every visible row. When the user scrolls to look at more cells, it’s called again for each row just as it is about to appear on the screen.</p>
<p class="indent">Next, we need to find out which <span class="code">Birthday</span>
 should be displayed inside the cell. We want to display one birthday from the <span class="code">birthdays</span>
 array in each row. The first birthday, which is at <span class="code">birthdays[0]</span>
 , should be displayed in row 0. The second birthday, at <span class="code">birthdays[1]</span>
 , should be displayed in row 1, and so on, which means the <span class="code">indexPath</span>
 ’s <span class="code">row</span>
 is the same as the position in the <span class="code">birthdays</span>
 array that we want to access. The code at <span class="ent">➋</span>
 accesses the <span id="page_166"></span>
 correct <span class="code">Birthday</span>
 object from the <span class="code">birthdays</span>
 array by using <span class="code">indexPath.row</span>
 . Once we have the right <span class="code">Birthday</span>
 object, we assign it to a constant named <span class="code">birthday</span>
 so we can set up the labels in this cell.</p>
<p class="indent">Notice that we’re using <span class="code">let</span>
 to assign the <span class="code">birthday</span>
 to a constant instead of a variable. We can use <span class="code">let</span>
 because each time <span class="code">tableView(_:cellForRowAt:)</span>
 is called, a new <span class="code">birthday</span>
 constant is created. Each cell gets its own <span class="code">birthday</span>
 constant that is assigned its own <span class="code">Birthday</span>
 object. Since we’re not going to change any of the <span class="code">birthday</span>
 constants—we’re just going to read their properties—we don’t want to make them variables.</p>
<p class="indent">Now that you have your cell and your birthday, it’s time to fill in the details. You need two labels for each cell to show the birthday person’s name and birthdate. You set the cell to the Subtitle style so that it has a Title label and a Subtitle label. Each cell will already contain these labels, so now you don’t have to create any labels yourself.</p>
<p class="indent">The labels exist as properties of <span class="code">UITableViewCell</span>
 and are called <span class="code">textLabel</span>
 and <span class="code">detailTextLabel</span>
 . The code at <span class="ent">➌</span>
 sets the text of the <span class="code">textLabel</span>
 to a string made up of the <span class="code">firstName</span>
 and <span class="code">lastName</span>
 of the <span class="code">birthday</span>
 with a space between them. At <span class="ent">➍</span>
 , you use the <span class="code">string(from:)</span>
 method of the <span class="code">dateFormatter</span>
 to display the birthdate in the <span class="code">detailTextLabel</span>
 .</p>
<p class="indent">When your cell is completely configured, <span class="code">tableView( _:cellForRowAt:)</span>
 returns the cell at <span class="ent">➎</span>
 so that it can be displayed at that <span class="code">indexPath</span>
 of the table view.</p>
<h3 class="h3" id="ch11lev1sec2">
<strong>PUTTING IT ALL TOGETHER</strong>
</h3>
<p class="noindent">Now you can add <span class="code">Birthday</span>
 instances to the app using the Add Birthday view controller, and you have a table view to list each <span class="code">Birthday</span>
 in the Birthdays table view controller. But when you try running the app and adding a <span class="code">Birthday</span>
 , it doesn’t appear. To make each <span class="code">Birthday</span>
 you add appear in the table view, you need to make the Add Birthday view controller communicate with the Birthdays table view controller. You do this by using <em>delegation</em>
 .</p>
<h4 class="h4" id="ch11lev2sec5">
<strong>DELEGATION</strong>
</h4>
<p class="noindent">Delegation can be used when one view controller needs to get information from another view controller. Say you have two view controllers: A and B. The first view controller, A, creates B and presents B on top of itself. A knows about B because it created and presented B, so A can pass information along to B. But B doesn’t know about A—it’s just popped into being and doesn’t know where it came from or how it got there. So how can B talk to A? Through delegation!</p>
<div class="image"><img src="Image00245.jpg" />
</div>
<p class="indent">Delegation is when someone gives a job or a task to someone else. A <em>delegate</em>
 is like a boss who tells a delegating employee what to do. When the delegating employee is done with their task, sometimes they’ll report information back to the delegate boss.</p>
<p class="indent"><span id="page_167"></span>
 Delegation in Swift is pretty similar, but instead of having a boss and employee, we have a delegate and a delegating object. Since class B is the one being told what to do by class A, it’s the delegating object. We give class B a special property called a delegate to tell it who its delegate is—that way, it knows who to communicate with. The delegate can be any class that has a set of methods that have been defined in a <em>protocol</em>
 . A protocol is like an agreement between the two classes that tells them what the delegate can ask the delegating object to do. It has a list of method and property names that the delegate can use with the delegating object.</p>
<p class="indent">Class A creates class B, makes itself the delegate of class B, and gives class B a job to do that’s in the protocol. Once class B is done with its job, it reports back to class A. Let’s see how this works in our app.</p>
<p class="indent">The Birthdays table view controller is view controller A, and the Add Birthday view controller is view controller B. We’ll create a protocol called <span class="code">AddBirthdayViewControllerDelegate</span>
 and a method for that protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 , which the Add Birthday view controller will use to report back.</p>
<p class="indent">Take a look at <a href="text00022.html#ch11fig6">Figure 11-6</a>
 . When the user taps the Add button <span class="ent">➊</span>
 , the Birthdays table view controller creates the Add Birthday view controller <span class="ent">➋</span>
 and sets itself as the Add Birthday view controller’s delegate.</p>
<div class="image"><img src="Image00246.jpg" />
</div>
<p class="figcap"><a id="ch11fig6"></a>
 <em>Figure 11-6: A new birthday is added and passed from the Add Birthday view controller to the Birthdays table view controller using delegation.</em>
</p>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="indent">Next, we need to find out which <span class="code">Birthday</span>
 should be displayed inside the cell. We want to display one birthday from the <span class="code">birthdays</span>
 array in each row. The first birthday, which is at <span class="code">birthdays[0]</span>
 , should be displayed in row 0. The second birthday, at <span class="code">birthdays[1]</span>
 , should be displayed in row 1, and so on, which means the <span class="code">indexPath</span>
 ’s <span class="code">row</span>
 is the same as the position in the <span class="code">birthdays</span>
 array that we want to access. The code at <span class="ent">➋</span>
 accesses the <span id="page_166"></span>
 correct <span class="code">Birthday</span>
 object from the <span class="code">birthdays</span>
 array by using <span class="code">indexPath.row</span>
 . Once we have the right <span class="code">Birthday</span>
 object, we assign it to a constant named <span class="code">birthday</span>
 so we can set up the labels in this cell.</p>
<p class="indent">Notice that we’re using <span class="code">let</span>
 to assign the <span class="code">birthday</span>
 to a constant instead of a variable. We can use <span class="code">let</span>
 because each time <span class="code">tableView(_:cellForRowAt:)</span>
 is called, a new <span class="code">birthday</span>
 constant is created. Each cell gets its own <span class="code">birthday</span>
 constant that is assigned its own <span class="code">Birthday</span>
 object. Since we’re not going to change any of the <span class="code">birthday</span>
 constants—we’re just going to read their properties—we don’t want to make them variables.</p>
<p class="indent">Now that you have your cell and your birthday, it’s time to fill in the details. You need two labels for each cell to show the birthday person’s name and birthdate. You set the cell to the Subtitle style so that it has a Title label and a Subtitle label. Each cell will already contain these labels, so now you don’t have to create any labels yourself.</p>
<p class="indent">The labels exist as properties of <span class="code">UITableViewCell</span>
 and are called <span class="code">textLabel</span>
 and <span class="code">detailTextLabel</span>
 . The code at <span class="ent">➌</span>
 sets the text of the <span class="code">textLabel</span>
 to a string made up of the <span class="code">firstName</span>
 and <span class="code">lastName</span>
 of the <span class="code">birthday</span>
 with a space between them. At <span class="ent">➍</span>
 , you use the <span class="code">string(from:)</span>
 method of the <span class="code">dateFormatter</span>
 to display the birthdate in the <span class="code">detailTextLabel</span>
 .</p>
<p class="indent">When your cell is completely configured, <span class="code">tableView( _:cellForRowAt:)</span>
 returns the cell at <span class="ent">➎</span>
 so that it can be displayed at that <span class="code">indexPath</span>
 of the table view.</p>
<h3 class="h3" id="ch11lev1sec2">
<strong>PUTTING IT ALL TOGETHER</strong>
</h3>
<p class="noindent">Now you can add <span class="code">Birthday</span>
 instances to the app using the Add Birthday view controller, and you have a table view to list each <span class="code">Birthday</span>
 in the Birthdays table view controller. But when you try running the app and adding a <span class="code">Birthday</span>
 , it doesn’t appear. To make each <span class="code">Birthday</span>
 you add appear in the table view, you need to make the Add Birthday view controller communicate with the Birthdays table view controller. You do this by using <em>delegation</em>
 .</p>
<h4 class="h4" id="ch11lev2sec5">
<strong>DELEGATION</strong>
</h4>
<p class="noindent">Delegation can be used when one view controller needs to get information from another view controller. Say you have two view controllers: A and B. The first view controller, A, creates B and presents B on top of itself. A knows about B because it created and presented B, so A can pass information along to B. But B doesn’t know about A—it’s just popped into being and doesn’t know where it came from or how it got there. So how can B talk to A? Through delegation!</p>
<div class="image"><img src="Image00245.jpg" />
</div>
<p class="indent">Delegation is when someone gives a job or a task to someone else. A <em>delegate</em>
 is like a boss who tells a delegating employee what to do. When the delegating employee is done with their task, sometimes they’ll report information back to the delegate boss.</p>
<p class="indent"><span id="page_167"></span>
 Delegation in Swift is pretty similar, but instead of having a boss and employee, we have a delegate and a delegating object. Since class B is the one being told what to do by class A, it’s the delegating object. We give class B a special property called a delegate to tell it who its delegate is—that way, it knows who to communicate with. The delegate can be any class that has a set of methods that have been defined in a <em>protocol</em>
 . A protocol is like an agreement between the two classes that tells them what the delegate can ask the delegating object to do. It has a list of method and property names that the delegate can use with the delegating object.</p>
<p class="indent">Class A creates class B, makes itself the delegate of class B, and gives class B a job to do that’s in the protocol. Once class B is done with its job, it reports back to class A. Let’s see how this works in our app.</p>
<p class="indent">The Birthdays table view controller is view controller A, and the Add Birthday view controller is view controller B. We’ll create a protocol called <span class="code">AddBirthdayViewControllerDelegate</span>
 and a method for that protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 , which the Add Birthday view controller will use to report back.</p>
<p class="indent">Take a look at <a href="text00022.html#ch11fig6">Figure 11-6</a>
 . When the user taps the Add button <span class="ent">➊</span>
 , the Birthdays table view controller creates the Add Birthday view controller <span class="ent">➋</span>
 and sets itself as the Add Birthday view controller’s delegate.</p>
<div class="image"><img src="Image00246.jpg" />
</div>
<p class="figcap"><a id="ch11fig6"></a>
 <em>Figure 11-6: A new birthday is added and passed from the Add Birthday view controller to the Birthdays table view controller using delegation.</em>
</p>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="indent">Notice that we’re using <span class="code">let</span>
 to assign the <span class="code">birthday</span>
 to a constant instead of a variable. We can use <span class="code">let</span>
 because each time <span class="code">tableView(_:cellForRowAt:)</span>
 is called, a new <span class="code">birthday</span>
 constant is created. Each cell gets its own <span class="code">birthday</span>
 constant that is assigned its own <span class="code">Birthday</span>
 object. Since we’re not going to change any of the <span class="code">birthday</span>
 constants—we’re just going to read their properties—we don’t want to make them variables.</p>
<p class="indent">Now that you have your cell and your birthday, it’s time to fill in the details. You need two labels for each cell to show the birthday person’s name and birthdate. You set the cell to the Subtitle style so that it has a Title label and a Subtitle label. Each cell will already contain these labels, so now you don’t have to create any labels yourself.</p>
<p class="indent">The labels exist as properties of <span class="code">UITableViewCell</span>
 and are called <span class="code">textLabel</span>
 and <span class="code">detailTextLabel</span>
 . The code at <span class="ent">➌</span>
 sets the text of the <span class="code">textLabel</span>
 to a string made up of the <span class="code">firstName</span>
 and <span class="code">lastName</span>
 of the <span class="code">birthday</span>
 with a space between them. At <span class="ent">➍</span>
 , you use the <span class="code">string(from:)</span>
 method of the <span class="code">dateFormatter</span>
 to display the birthdate in the <span class="code">detailTextLabel</span>
 .</p>
<p class="indent">When your cell is completely configured, <span class="code">tableView( _:cellForRowAt:)</span>
 returns the cell at <span class="ent">➎</span>
 so that it can be displayed at that <span class="code">indexPath</span>
 of the table view.</p>
<h3 class="h3" id="ch11lev1sec2">
<strong>PUTTING IT ALL TOGETHER</strong>
</h3>
<p class="noindent">Now you can add <span class="code">Birthday</span>
 instances to the app using the Add Birthday view controller, and you have a table view to list each <span class="code">Birthday</span>
 in the Birthdays table view controller. But when you try running the app and adding a <span class="code">Birthday</span>
 , it doesn’t appear. To make each <span class="code">Birthday</span>
 you add appear in the table view, you need to make the Add Birthday view controller communicate with the Birthdays table view controller. You do this by using <em>delegation</em>
 .</p>
<h4 class="h4" id="ch11lev2sec5">
<strong>DELEGATION</strong>
</h4>
<p class="noindent">Delegation can be used when one view controller needs to get information from another view controller. Say you have two view controllers: A and B. The first view controller, A, creates B and presents B on top of itself. A knows about B because it created and presented B, so A can pass information along to B. But B doesn’t know about A—it’s just popped into being and doesn’t know where it came from or how it got there. So how can B talk to A? Through delegation!</p>
<div class="image"><img src="Image00245.jpg" />
</div>
<p class="indent">Delegation is when someone gives a job or a task to someone else. A <em>delegate</em>
 is like a boss who tells a delegating employee what to do. When the delegating employee is done with their task, sometimes they’ll report information back to the delegate boss.</p>
<p class="indent"><span id="page_167"></span>
 Delegation in Swift is pretty similar, but instead of having a boss and employee, we have a delegate and a delegating object. Since class B is the one being told what to do by class A, it’s the delegating object. We give class B a special property called a delegate to tell it who its delegate is—that way, it knows who to communicate with. The delegate can be any class that has a set of methods that have been defined in a <em>protocol</em>
 . A protocol is like an agreement between the two classes that tells them what the delegate can ask the delegating object to do. It has a list of method and property names that the delegate can use with the delegating object.</p>
<p class="indent">Class A creates class B, makes itself the delegate of class B, and gives class B a job to do that’s in the protocol. Once class B is done with its job, it reports back to class A. Let’s see how this works in our app.</p>
<p class="indent">The Birthdays table view controller is view controller A, and the Add Birthday view controller is view controller B. We’ll create a protocol called <span class="code">AddBirthdayViewControllerDelegate</span>
 and a method for that protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 , which the Add Birthday view controller will use to report back.</p>
<p class="indent">Take a look at <a href="text00022.html#ch11fig6">Figure 11-6</a>
 . When the user taps the Add button <span class="ent">➊</span>
 , the Birthdays table view controller creates the Add Birthday view controller <span class="ent">➋</span>
 and sets itself as the Add Birthday view controller’s delegate.</p>
<div class="image"><img src="Image00246.jpg" />
</div>
<p class="figcap"><a id="ch11fig6"></a>
 <em>Figure 11-6: A new birthday is added and passed from the Add Birthday view controller to the Birthdays table view controller using delegation.</em>
</p>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="indent">Now that you have your cell and your birthday, it’s time to fill in the details. You need two labels for each cell to show the birthday person’s name and birthdate. You set the cell to the Subtitle style so that it has a Title label and a Subtitle label. Each cell will already contain these labels, so now you don’t have to create any labels yourself.</p>
<p class="indent">The labels exist as properties of <span class="code">UITableViewCell</span>
 and are called <span class="code">textLabel</span>
 and <span class="code">detailTextLabel</span>
 . The code at <span class="ent">➌</span>
 sets the text of the <span class="code">textLabel</span>
 to a string made up of the <span class="code">firstName</span>
 and <span class="code">lastName</span>
 of the <span class="code">birthday</span>
 with a space between them. At <span class="ent">➍</span>
 , you use the <span class="code">string(from:)</span>
 method of the <span class="code">dateFormatter</span>
 to display the birthdate in the <span class="code">detailTextLabel</span>
 .</p>
<p class="indent">When your cell is completely configured, <span class="code">tableView( _:cellForRowAt:)</span>
 returns the cell at <span class="ent">➎</span>
 so that it can be displayed at that <span class="code">indexPath</span>
 of the table view.</p>
<h3 class="h3" id="ch11lev1sec2">
<strong>PUTTING IT ALL TOGETHER</strong>
</h3>
<p class="noindent">Now you can add <span class="code">Birthday</span>
 instances to the app using the Add Birthday view controller, and you have a table view to list each <span class="code">Birthday</span>
 in the Birthdays table view controller. But when you try running the app and adding a <span class="code">Birthday</span>
 , it doesn’t appear. To make each <span class="code">Birthday</span>
 you add appear in the table view, you need to make the Add Birthday view controller communicate with the Birthdays table view controller. You do this by using <em>delegation</em>
 .</p>
<h4 class="h4" id="ch11lev2sec5">
<strong>DELEGATION</strong>
</h4>
<p class="noindent">Delegation can be used when one view controller needs to get information from another view controller. Say you have two view controllers: A and B. The first view controller, A, creates B and presents B on top of itself. A knows about B because it created and presented B, so A can pass information along to B. But B doesn’t know about A—it’s just popped into being and doesn’t know where it came from or how it got there. So how can B talk to A? Through delegation!</p>
<div class="image"><img src="Image00245.jpg" />
</div>
<p class="indent">Delegation is when someone gives a job or a task to someone else. A <em>delegate</em>
 is like a boss who tells a delegating employee what to do. When the delegating employee is done with their task, sometimes they’ll report information back to the delegate boss.</p>
<p class="indent"><span id="page_167"></span>
 Delegation in Swift is pretty similar, but instead of having a boss and employee, we have a delegate and a delegating object. Since class B is the one being told what to do by class A, it’s the delegating object. We give class B a special property called a delegate to tell it who its delegate is—that way, it knows who to communicate with. The delegate can be any class that has a set of methods that have been defined in a <em>protocol</em>
 . A protocol is like an agreement between the two classes that tells them what the delegate can ask the delegating object to do. It has a list of method and property names that the delegate can use with the delegating object.</p>
<p class="indent">Class A creates class B, makes itself the delegate of class B, and gives class B a job to do that’s in the protocol. Once class B is done with its job, it reports back to class A. Let’s see how this works in our app.</p>
<p class="indent">The Birthdays table view controller is view controller A, and the Add Birthday view controller is view controller B. We’ll create a protocol called <span class="code">AddBirthdayViewControllerDelegate</span>
 and a method for that protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 , which the Add Birthday view controller will use to report back.</p>
<p class="indent">Take a look at <a href="text00022.html#ch11fig6">Figure 11-6</a>
 . When the user taps the Add button <span class="ent">➊</span>
 , the Birthdays table view controller creates the Add Birthday view controller <span class="ent">➋</span>
 and sets itself as the Add Birthday view controller’s delegate.</p>
<div class="image"><img src="Image00246.jpg" />
</div>
<p class="figcap"><a id="ch11fig6"></a>
 <em>Figure 11-6: A new birthday is added and passed from the Add Birthday view controller to the Birthdays table view controller using delegation.</em>
</p>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="indent">The labels exist as properties of <span class="code">UITableViewCell</span>
 and are called <span class="code">textLabel</span>
 and <span class="code">detailTextLabel</span>
 . The code at <span class="ent">➌</span>
 sets the text of the <span class="code">textLabel</span>
 to a string made up of the <span class="code">firstName</span>
 and <span class="code">lastName</span>
 of the <span class="code">birthday</span>
 with a space between them. At <span class="ent">➍</span>
 , you use the <span class="code">string(from:)</span>
 method of the <span class="code">dateFormatter</span>
 to display the birthdate in the <span class="code">detailTextLabel</span>
 .</p>
<p class="indent">When your cell is completely configured, <span class="code">tableView( _:cellForRowAt:)</span>
 returns the cell at <span class="ent">➎</span>
 so that it can be displayed at that <span class="code">indexPath</span>
 of the table view.</p>
<h3 class="h3" id="ch11lev1sec2">
<strong>PUTTING IT ALL TOGETHER</strong>
</h3>
<p class="noindent">Now you can add <span class="code">Birthday</span>
 instances to the app using the Add Birthday view controller, and you have a table view to list each <span class="code">Birthday</span>
 in the Birthdays table view controller. But when you try running the app and adding a <span class="code">Birthday</span>
 , it doesn’t appear. To make each <span class="code">Birthday</span>
 you add appear in the table view, you need to make the Add Birthday view controller communicate with the Birthdays table view controller. You do this by using <em>delegation</em>
 .</p>
<h4 class="h4" id="ch11lev2sec5">
<strong>DELEGATION</strong>
</h4>
<p class="noindent">Delegation can be used when one view controller needs to get information from another view controller. Say you have two view controllers: A and B. The first view controller, A, creates B and presents B on top of itself. A knows about B because it created and presented B, so A can pass information along to B. But B doesn’t know about A—it’s just popped into being and doesn’t know where it came from or how it got there. So how can B talk to A? Through delegation!</p>
<div class="image"><img src="Image00245.jpg" />
</div>
<p class="indent">Delegation is when someone gives a job or a task to someone else. A <em>delegate</em>
 is like a boss who tells a delegating employee what to do. When the delegating employee is done with their task, sometimes they’ll report information back to the delegate boss.</p>
<p class="indent"><span id="page_167"></span>
 Delegation in Swift is pretty similar, but instead of having a boss and employee, we have a delegate and a delegating object. Since class B is the one being told what to do by class A, it’s the delegating object. We give class B a special property called a delegate to tell it who its delegate is—that way, it knows who to communicate with. The delegate can be any class that has a set of methods that have been defined in a <em>protocol</em>
 . A protocol is like an agreement between the two classes that tells them what the delegate can ask the delegating object to do. It has a list of method and property names that the delegate can use with the delegating object.</p>
<p class="indent">Class A creates class B, makes itself the delegate of class B, and gives class B a job to do that’s in the protocol. Once class B is done with its job, it reports back to class A. Let’s see how this works in our app.</p>
<p class="indent">The Birthdays table view controller is view controller A, and the Add Birthday view controller is view controller B. We’ll create a protocol called <span class="code">AddBirthdayViewControllerDelegate</span>
 and a method for that protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 , which the Add Birthday view controller will use to report back.</p>
<p class="indent">Take a look at <a href="text00022.html#ch11fig6">Figure 11-6</a>
 . When the user taps the Add button <span class="ent">➊</span>
 , the Birthdays table view controller creates the Add Birthday view controller <span class="ent">➋</span>
 and sets itself as the Add Birthday view controller’s delegate.</p>
<div class="image"><img src="Image00246.jpg" />
</div>
<p class="figcap"><a id="ch11fig6"></a>
 <em>Figure 11-6: A new birthday is added and passed from the Add Birthday view controller to the Birthdays table view controller using delegation.</em>
</p>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="indent">When your cell is completely configured, <span class="code">tableView( _:cellForRowAt:)</span>
 returns the cell at <span class="ent">➎</span>
 so that it can be displayed at that <span class="code">indexPath</span>
 of the table view.</p>
<h3 class="h3" id="ch11lev1sec2">
<strong>PUTTING IT ALL TOGETHER</strong>
</h3>
<p class="noindent">Now you can add <span class="code">Birthday</span>
 instances to the app using the Add Birthday view controller, and you have a table view to list each <span class="code">Birthday</span>
 in the Birthdays table view controller. But when you try running the app and adding a <span class="code">Birthday</span>
 , it doesn’t appear. To make each <span class="code">Birthday</span>
 you add appear in the table view, you need to make the Add Birthday view controller communicate with the Birthdays table view controller. You do this by using <em>delegation</em>
 .</p>
<h4 class="h4" id="ch11lev2sec5">
<strong>DELEGATION</strong>
</h4>
<p class="noindent">Delegation can be used when one view controller needs to get information from another view controller. Say you have two view controllers: A and B. The first view controller, A, creates B and presents B on top of itself. A knows about B because it created and presented B, so A can pass information along to B. But B doesn’t know about A—it’s just popped into being and doesn’t know where it came from or how it got there. So how can B talk to A? Through delegation!</p>
<div class="image"><img src="Image00245.jpg" />
</div>
<p class="indent">Delegation is when someone gives a job or a task to someone else. A <em>delegate</em>
 is like a boss who tells a delegating employee what to do. When the delegating employee is done with their task, sometimes they’ll report information back to the delegate boss.</p>
<p class="indent"><span id="page_167"></span>
 Delegation in Swift is pretty similar, but instead of having a boss and employee, we have a delegate and a delegating object. Since class B is the one being told what to do by class A, it’s the delegating object. We give class B a special property called a delegate to tell it who its delegate is—that way, it knows who to communicate with. The delegate can be any class that has a set of methods that have been defined in a <em>protocol</em>
 . A protocol is like an agreement between the two classes that tells them what the delegate can ask the delegating object to do. It has a list of method and property names that the delegate can use with the delegating object.</p>
<p class="indent">Class A creates class B, makes itself the delegate of class B, and gives class B a job to do that’s in the protocol. Once class B is done with its job, it reports back to class A. Let’s see how this works in our app.</p>
<p class="indent">The Birthdays table view controller is view controller A, and the Add Birthday view controller is view controller B. We’ll create a protocol called <span class="code">AddBirthdayViewControllerDelegate</span>
 and a method for that protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 , which the Add Birthday view controller will use to report back.</p>
<p class="indent">Take a look at <a href="text00022.html#ch11fig6">Figure 11-6</a>
 . When the user taps the Add button <span class="ent">➊</span>
 , the Birthdays table view controller creates the Add Birthday view controller <span class="ent">➋</span>
 and sets itself as the Add Birthday view controller’s delegate.</p>
<div class="image"><img src="Image00246.jpg" />
</div>
<p class="figcap"><a id="ch11fig6"></a>
 <em>Figure 11-6: A new birthday is added and passed from the Add Birthday view controller to the Birthdays table view controller using delegation.</em>
</p>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<h3 class="h3" id="ch11lev1sec2">
<strong>PUTTING IT ALL TOGETHER</strong>
</h3>
<p class="noindent">Now you can add <span class="code">Birthday</span>
 instances to the app using the Add Birthday view controller, and you have a table view to list each <span class="code">Birthday</span>
 in the Birthdays table view controller. But when you try running the app and adding a <span class="code">Birthday</span>
 , it doesn’t appear. To make each <span class="code">Birthday</span>
 you add appear in the table view, you need to make the Add Birthday view controller communicate with the Birthdays table view controller. You do this by using <em>delegation</em>
 .</p>
<h4 class="h4" id="ch11lev2sec5">
<strong>DELEGATION</strong>
</h4>
<p class="noindent">Delegation can be used when one view controller needs to get information from another view controller. Say you have two view controllers: A and B. The first view controller, A, creates B and presents B on top of itself. A knows about B because it created and presented B, so A can pass information along to B. But B doesn’t know about A—it’s just popped into being and doesn’t know where it came from or how it got there. So how can B talk to A? Through delegation!</p>
<div class="image"><img src="Image00245.jpg" />
</div>
<p class="indent">Delegation is when someone gives a job or a task to someone else. A <em>delegate</em>
 is like a boss who tells a delegating employee what to do. When the delegating employee is done with their task, sometimes they’ll report information back to the delegate boss.</p>
<p class="indent"><span id="page_167"></span>
 Delegation in Swift is pretty similar, but instead of having a boss and employee, we have a delegate and a delegating object. Since class B is the one being told what to do by class A, it’s the delegating object. We give class B a special property called a delegate to tell it who its delegate is—that way, it knows who to communicate with. The delegate can be any class that has a set of methods that have been defined in a <em>protocol</em>
 . A protocol is like an agreement between the two classes that tells them what the delegate can ask the delegating object to do. It has a list of method and property names that the delegate can use with the delegating object.</p>
<p class="indent">Class A creates class B, makes itself the delegate of class B, and gives class B a job to do that’s in the protocol. Once class B is done with its job, it reports back to class A. Let’s see how this works in our app.</p>
<p class="indent">The Birthdays table view controller is view controller A, and the Add Birthday view controller is view controller B. We’ll create a protocol called <span class="code">AddBirthdayViewControllerDelegate</span>
 and a method for that protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 , which the Add Birthday view controller will use to report back.</p>
<p class="indent">Take a look at <a href="text00022.html#ch11fig6">Figure 11-6</a>
 . When the user taps the Add button <span class="ent">➊</span>
 , the Birthdays table view controller creates the Add Birthday view controller <span class="ent">➋</span>
 and sets itself as the Add Birthday view controller’s delegate.</p>
<div class="image"><img src="Image00246.jpg" />
</div>
<p class="figcap"><a id="ch11fig6"></a>
 <em>Figure 11-6: A new birthday is added and passed from the Add Birthday view controller to the Birthdays table view controller using delegation.</em>
</p>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="noindent">Now you can add <span class="code">Birthday</span>
 instances to the app using the Add Birthday view controller, and you have a table view to list each <span class="code">Birthday</span>
 in the Birthdays table view controller. But when you try running the app and adding a <span class="code">Birthday</span>
 , it doesn’t appear. To make each <span class="code">Birthday</span>
 you add appear in the table view, you need to make the Add Birthday view controller communicate with the Birthdays table view controller. You do this by using <em>delegation</em>
 .</p>
<h4 class="h4" id="ch11lev2sec5">
<strong>DELEGATION</strong>
</h4>
<p class="noindent">Delegation can be used when one view controller needs to get information from another view controller. Say you have two view controllers: A and B. The first view controller, A, creates B and presents B on top of itself. A knows about B because it created and presented B, so A can pass information along to B. But B doesn’t know about A—it’s just popped into being and doesn’t know where it came from or how it got there. So how can B talk to A? Through delegation!</p>
<div class="image"><img src="Image00245.jpg" />
</div>
<p class="indent">Delegation is when someone gives a job or a task to someone else. A <em>delegate</em>
 is like a boss who tells a delegating employee what to do. When the delegating employee is done with their task, sometimes they’ll report information back to the delegate boss.</p>
<p class="indent"><span id="page_167"></span>
 Delegation in Swift is pretty similar, but instead of having a boss and employee, we have a delegate and a delegating object. Since class B is the one being told what to do by class A, it’s the delegating object. We give class B a special property called a delegate to tell it who its delegate is—that way, it knows who to communicate with. The delegate can be any class that has a set of methods that have been defined in a <em>protocol</em>
 . A protocol is like an agreement between the two classes that tells them what the delegate can ask the delegating object to do. It has a list of method and property names that the delegate can use with the delegating object.</p>
<p class="indent">Class A creates class B, makes itself the delegate of class B, and gives class B a job to do that’s in the protocol. Once class B is done with its job, it reports back to class A. Let’s see how this works in our app.</p>
<p class="indent">The Birthdays table view controller is view controller A, and the Add Birthday view controller is view controller B. We’ll create a protocol called <span class="code">AddBirthdayViewControllerDelegate</span>
 and a method for that protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 , which the Add Birthday view controller will use to report back.</p>
<p class="indent">Take a look at <a href="text00022.html#ch11fig6">Figure 11-6</a>
 . When the user taps the Add button <span class="ent">➊</span>
 , the Birthdays table view controller creates the Add Birthday view controller <span class="ent">➋</span>
 and sets itself as the Add Birthday view controller’s delegate.</p>
<div class="image"><img src="Image00246.jpg" />
</div>
<p class="figcap"><a id="ch11fig6"></a>
 <em>Figure 11-6: A new birthday is added and passed from the Add Birthday view controller to the Birthdays table view controller using delegation.</em>
</p>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<h4 class="h4" id="ch11lev2sec5">
<strong>DELEGATION</strong>
</h4>
<p class="noindent">Delegation can be used when one view controller needs to get information from another view controller. Say you have two view controllers: A and B. The first view controller, A, creates B and presents B on top of itself. A knows about B because it created and presented B, so A can pass information along to B. But B doesn’t know about A—it’s just popped into being and doesn’t know where it came from or how it got there. So how can B talk to A? Through delegation!</p>
<div class="image"><img src="Image00245.jpg" />
</div>
<p class="indent">Delegation is when someone gives a job or a task to someone else. A <em>delegate</em>
 is like a boss who tells a delegating employee what to do. When the delegating employee is done with their task, sometimes they’ll report information back to the delegate boss.</p>
<p class="indent"><span id="page_167"></span>
 Delegation in Swift is pretty similar, but instead of having a boss and employee, we have a delegate and a delegating object. Since class B is the one being told what to do by class A, it’s the delegating object. We give class B a special property called a delegate to tell it who its delegate is—that way, it knows who to communicate with. The delegate can be any class that has a set of methods that have been defined in a <em>protocol</em>
 . A protocol is like an agreement between the two classes that tells them what the delegate can ask the delegating object to do. It has a list of method and property names that the delegate can use with the delegating object.</p>
<p class="indent">Class A creates class B, makes itself the delegate of class B, and gives class B a job to do that’s in the protocol. Once class B is done with its job, it reports back to class A. Let’s see how this works in our app.</p>
<p class="indent">The Birthdays table view controller is view controller A, and the Add Birthday view controller is view controller B. We’ll create a protocol called <span class="code">AddBirthdayViewControllerDelegate</span>
 and a method for that protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 , which the Add Birthday view controller will use to report back.</p>
<p class="indent">Take a look at <a href="text00022.html#ch11fig6">Figure 11-6</a>
 . When the user taps the Add button <span class="ent">➊</span>
 , the Birthdays table view controller creates the Add Birthday view controller <span class="ent">➋</span>
 and sets itself as the Add Birthday view controller’s delegate.</p>
<div class="image"><img src="Image00246.jpg" />
</div>
<p class="figcap"><a id="ch11fig6"></a>
 <em>Figure 11-6: A new birthday is added and passed from the Add Birthday view controller to the Birthdays table view controller using delegation.</em>
</p>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="noindent">Delegation can be used when one view controller needs to get information from another view controller. Say you have two view controllers: A and B. The first view controller, A, creates B and presents B on top of itself. A knows about B because it created and presented B, so A can pass information along to B. But B doesn’t know about A—it’s just popped into being and doesn’t know where it came from or how it got there. So how can B talk to A? Through delegation!</p>
<div class="image"><img src="Image00245.jpg" />
</div>
<p class="indent">Delegation is when someone gives a job or a task to someone else. A <em>delegate</em>
 is like a boss who tells a delegating employee what to do. When the delegating employee is done with their task, sometimes they’ll report information back to the delegate boss.</p>
<p class="indent"><span id="page_167"></span>
 Delegation in Swift is pretty similar, but instead of having a boss and employee, we have a delegate and a delegating object. Since class B is the one being told what to do by class A, it’s the delegating object. We give class B a special property called a delegate to tell it who its delegate is—that way, it knows who to communicate with. The delegate can be any class that has a set of methods that have been defined in a <em>protocol</em>
 . A protocol is like an agreement between the two classes that tells them what the delegate can ask the delegating object to do. It has a list of method and property names that the delegate can use with the delegating object.</p>
<p class="indent">Class A creates class B, makes itself the delegate of class B, and gives class B a job to do that’s in the protocol. Once class B is done with its job, it reports back to class A. Let’s see how this works in our app.</p>
<p class="indent">The Birthdays table view controller is view controller A, and the Add Birthday view controller is view controller B. We’ll create a protocol called <span class="code">AddBirthdayViewControllerDelegate</span>
 and a method for that protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 , which the Add Birthday view controller will use to report back.</p>
<p class="indent">Take a look at <a href="text00022.html#ch11fig6">Figure 11-6</a>
 . When the user taps the Add button <span class="ent">➊</span>
 , the Birthdays table view controller creates the Add Birthday view controller <span class="ent">➋</span>
 and sets itself as the Add Birthday view controller’s delegate.</p>
<div class="image"><img src="Image00246.jpg" />
</div>
<p class="figcap"><a id="ch11fig6"></a>
 <em>Figure 11-6: A new birthday is added and passed from the Add Birthday view controller to the Birthdays table view controller using delegation.</em>
</p>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<div class="image"><img src="Image00245.jpg" />
</div>
<p class="indent">Delegation is when someone gives a job or a task to someone else. A <em>delegate</em>
 is like a boss who tells a delegating employee what to do. When the delegating employee is done with their task, sometimes they’ll report information back to the delegate boss.</p>
<p class="indent"><span id="page_167"></span>
 Delegation in Swift is pretty similar, but instead of having a boss and employee, we have a delegate and a delegating object. Since class B is the one being told what to do by class A, it’s the delegating object. We give class B a special property called a delegate to tell it who its delegate is—that way, it knows who to communicate with. The delegate can be any class that has a set of methods that have been defined in a <em>protocol</em>
 . A protocol is like an agreement between the two classes that tells them what the delegate can ask the delegating object to do. It has a list of method and property names that the delegate can use with the delegating object.</p>
<p class="indent">Class A creates class B, makes itself the delegate of class B, and gives class B a job to do that’s in the protocol. Once class B is done with its job, it reports back to class A. Let’s see how this works in our app.</p>
<p class="indent">The Birthdays table view controller is view controller A, and the Add Birthday view controller is view controller B. We’ll create a protocol called <span class="code">AddBirthdayViewControllerDelegate</span>
 and a method for that protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 , which the Add Birthday view controller will use to report back.</p>
<p class="indent">Take a look at <a href="text00022.html#ch11fig6">Figure 11-6</a>
 . When the user taps the Add button <span class="ent">➊</span>
 , the Birthdays table view controller creates the Add Birthday view controller <span class="ent">➋</span>
 and sets itself as the Add Birthday view controller’s delegate.</p>
<div class="image"><img src="Image00246.jpg" />
</div>
<p class="figcap"><a id="ch11fig6"></a>
 <em>Figure 11-6: A new birthday is added and passed from the Add Birthday view controller to the Birthdays table view controller using delegation.</em>
</p>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="indent">Delegation is when someone gives a job or a task to someone else. A <em>delegate</em>
 is like a boss who tells a delegating employee what to do. When the delegating employee is done with their task, sometimes they’ll report information back to the delegate boss.</p>
<p class="indent"><span id="page_167"></span>
 Delegation in Swift is pretty similar, but instead of having a boss and employee, we have a delegate and a delegating object. Since class B is the one being told what to do by class A, it’s the delegating object. We give class B a special property called a delegate to tell it who its delegate is—that way, it knows who to communicate with. The delegate can be any class that has a set of methods that have been defined in a <em>protocol</em>
 . A protocol is like an agreement between the two classes that tells them what the delegate can ask the delegating object to do. It has a list of method and property names that the delegate can use with the delegating object.</p>
<p class="indent">Class A creates class B, makes itself the delegate of class B, and gives class B a job to do that’s in the protocol. Once class B is done with its job, it reports back to class A. Let’s see how this works in our app.</p>
<p class="indent">The Birthdays table view controller is view controller A, and the Add Birthday view controller is view controller B. We’ll create a protocol called <span class="code">AddBirthdayViewControllerDelegate</span>
 and a method for that protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 , which the Add Birthday view controller will use to report back.</p>
<p class="indent">Take a look at <a href="text00022.html#ch11fig6">Figure 11-6</a>
 . When the user taps the Add button <span class="ent">➊</span>
 , the Birthdays table view controller creates the Add Birthday view controller <span class="ent">➋</span>
 and sets itself as the Add Birthday view controller’s delegate.</p>
<div class="image"><img src="Image00246.jpg" />
</div>
<p class="figcap"><a id="ch11fig6"></a>
 <em>Figure 11-6: A new birthday is added and passed from the Add Birthday view controller to the Birthdays table view controller using delegation.</em>
</p>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="indent"><span id="page_167"></span>
 Delegation in Swift is pretty similar, but instead of having a boss and employee, we have a delegate and a delegating object. Since class B is the one being told what to do by class A, it’s the delegating object. We give class B a special property called a delegate to tell it who its delegate is—that way, it knows who to communicate with. The delegate can be any class that has a set of methods that have been defined in a <em>protocol</em>
 . A protocol is like an agreement between the two classes that tells them what the delegate can ask the delegating object to do. It has a list of method and property names that the delegate can use with the delegating object.</p>
<p class="indent">Class A creates class B, makes itself the delegate of class B, and gives class B a job to do that’s in the protocol. Once class B is done with its job, it reports back to class A. Let’s see how this works in our app.</p>
<p class="indent">The Birthdays table view controller is view controller A, and the Add Birthday view controller is view controller B. We’ll create a protocol called <span class="code">AddBirthdayViewControllerDelegate</span>
 and a method for that protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 , which the Add Birthday view controller will use to report back.</p>
<p class="indent">Take a look at <a href="text00022.html#ch11fig6">Figure 11-6</a>
 . When the user taps the Add button <span class="ent">➊</span>
 , the Birthdays table view controller creates the Add Birthday view controller <span class="ent">➋</span>
 and sets itself as the Add Birthday view controller’s delegate.</p>
<div class="image"><img src="Image00246.jpg" />
</div>
<p class="figcap"><a id="ch11fig6"></a>
 <em>Figure 11-6: A new birthday is added and passed from the Add Birthday view controller to the Birthdays table view controller using delegation.</em>
</p>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="indent">Class A creates class B, makes itself the delegate of class B, and gives class B a job to do that’s in the protocol. Once class B is done with its job, it reports back to class A. Let’s see how this works in our app.</p>
<p class="indent">The Birthdays table view controller is view controller A, and the Add Birthday view controller is view controller B. We’ll create a protocol called <span class="code">AddBirthdayViewControllerDelegate</span>
 and a method for that protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 , which the Add Birthday view controller will use to report back.</p>
<p class="indent">Take a look at <a href="text00022.html#ch11fig6">Figure 11-6</a>
 . When the user taps the Add button <span class="ent">➊</span>
 , the Birthdays table view controller creates the Add Birthday view controller <span class="ent">➋</span>
 and sets itself as the Add Birthday view controller’s delegate.</p>
<div class="image"><img src="Image00246.jpg" />
</div>
<p class="figcap"><a id="ch11fig6"></a>
 <em>Figure 11-6: A new birthday is added and passed from the Add Birthday view controller to the Birthdays table view controller using delegation.</em>
</p>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="indent">The Birthdays table view controller is view controller A, and the Add Birthday view controller is view controller B. We’ll create a protocol called <span class="code">AddBirthdayViewControllerDelegate</span>
 and a method for that protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 , which the Add Birthday view controller will use to report back.</p>
<p class="indent">Take a look at <a href="text00022.html#ch11fig6">Figure 11-6</a>
 . When the user taps the Add button <span class="ent">➊</span>
 , the Birthdays table view controller creates the Add Birthday view controller <span class="ent">➋</span>
 and sets itself as the Add Birthday view controller’s delegate.</p>
<div class="image"><img src="Image00246.jpg" />
</div>
<p class="figcap"><a id="ch11fig6"></a>
 <em>Figure 11-6: A new birthday is added and passed from the Add Birthday view controller to the Birthdays table view controller using delegation.</em>
</p>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="indent">Take a look at <a href="text00022.html#ch11fig6">Figure 11-6</a>
 . When the user taps the Add button <span class="ent">➊</span>
 , the Birthdays table view controller creates the Add Birthday view controller <span class="ent">➋</span>
 and sets itself as the Add Birthday view controller’s delegate.</p>
<div class="image"><img src="Image00246.jpg" />
</div>
<p class="figcap"><a id="ch11fig6"></a>
 <em>Figure 11-6: A new birthday is added and passed from the Add Birthday view controller to the Birthdays table view controller using delegation.</em>
</p>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<div class="image"><img src="Image00246.jpg" />
</div>
<p class="figcap"><a id="ch11fig6"></a>
 <em>Figure 11-6: A new birthday is added and passed from the Add Birthday view controller to the Birthdays table view controller using delegation.</em>
</p>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="figcap"><a id="ch11fig6"></a>
 <em>Figure 11-6: A new birthday is added and passed from the Add Birthday view controller to the Birthdays table view controller using delegation.</em>
</p>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="indent">The <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol is defined to have one method, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 . When the user taps Save <span class="ent">➌</span>
 , the Add Birthday view controller calls this method <span class="ent">➍</span>
 and passes the new birthday to its delegate, the Birthdays table view controller. The Birthdays table view controller takes that birthday, adds it to its <span class="code">birthdays</span>
 array, and then reloads its table view <span class="ent">➎</span>
 so that the new birthday will show up in the table.</p>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="indent">We’ll show you how to make an <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol with the method <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 that the Add Birthday view controller can call whenever a birthday is added to the app. The Birthdays table view controller will implement that protocol method so that whenever a birthday is added with the Add Birthday view controller, the Add Birthday view controller can just say to its delegate, <span id="page_168"></span>
 “Hey! Someone just added this birthday,” and the Birthdays table view controller will hear the message and say, “Oh! I’ll add that to my list and refresh my display so the new one shows up.”</p>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="indent">So now let’s do this in code!</p>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<h5 class="h5" id="ch11lev3sec1">
<strong>Creating a Protocol</strong>
</h5>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="noindent">First, we need to create the protocol. In the <em>AddBirthdayViewController.swift</em>
 file, <em>above</em>
 the <span class="code">AddBirthdayViewController</span>
 class, add this code defining the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="pink">protocol</span>
 AddBirthdayViewControllerDelegate {<br />
<br />
    <span class="ent">➋</span>
 <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <img class="inline" src="Image00093.jpg" />
<br />
           <span class="green1">Birthday</span>
 )<br />
<br />
  }<br />
<br />
  <span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
      <span class="ash">--<em>snip</em>
 --</span>
</pre>
</div>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="indent">You define the protocol at <span class="ent">➊</span>
 by typing the keyword <span class="code">protocol</span>
 followed by the name <span class="code">AddBirthdayViewControllerDelegate</span>
 . That’s a long name, but Swift programmers usually name their protocols after the calling classes and add the word <span class="code">Delegate</span>
 on the end. This is so you’ll be able to tell which class is using the protocol by looking at the protocol’s name. Since you’re a Swift programmer now, you should use the same naming conventions.</p>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="indent">In this protocol, <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 is the only function, and it’s used to pass the <span class="code">Birthday</span>
 object back to the delegate class <span class="ent">➋</span>
 . Notice that you’re including <span class="code">AddBirthdayViewController</span>
 as a parameter in this function. Again, Swift programmers do this based on convention when they implement protocol methods, so you should stick to doing it, too. It’s useful to know who sent back a message and for the delegate to have access to that object and its class.</p>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="indent">When the Add Birthday view controller calls this method, it will pass itself in as the <span class="code">addBirthdayViewController</span>
 parameter. You’ll see how this is done very soon. The other thing to note is the external parameter name <span class="code">didAddBirthday</span>
 . Many delegate protocol methods contain the words <em>did</em>
 and <em>will</em>
 because they’re used to describe something that the calling class has either just done or will do.</p>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="indent">Now that you have your protocol defined, you need to tell the Birthdays table view controller to adopt this protocol and use the protocol’s method.</p>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<h5 class="h5" id="ch11lev3sec2">
<strong>Making the Birthdays Table View Controller Conform to Protocol</strong>
</h5>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="noindent">To adopt the protocol, the Birthdays table view controller needs to make itself an <span class="code">AddBirthdayViewControllerDelegate</span>
 . To allow for this, you need to <span id="page_169"></span>
 add <span class="code">AddBirthdayViewControllerDelegate</span>
 to the class definition right after the <span class="code">UITableViewController</span>
 superclass. At the top of the class, add a comma after <span class="code">UITableViewController</span>
 and then type <span class="code">
<span class="codestrong">AddBirthdayViewControllerDelegate</span>
</span>
 :</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<div class="box">
<pre>
<span class="ash">class BirthdaysTableViewController: UITableViewController</span>
 , <img class="inline" src="Image00093.jpg" />
<br />
    <span class="green1">AddBirthdayViewControllerDelegate</span>
 <span class="ash">{</span>
</pre>
</div>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="indent">As soon as you do that, a red error appears. This happens because <span class="code">BirthdaysTableViewController</span>
 says it’s an <span class="code">AddBirthdayViewControllerDelegate</span>
 , but it hasn’t implemented the protocol yet! In order to do that, it needs to implement the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol definition. Not to worry—we’ll fix this soon.</p>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="indent">It’s important to note here that the <span class="code">BirthdaysTableViewController</span>
 is subclassing the <span class="code">UITableViewController</span>
 superclass. A class can have only one superclass, and that superclass name must be written before any protocols. But while a class can have only one superclass, it can adopt as many protocols as it wants—these will all be listed after the superclass and separated by commas.</p>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="indent">Now, to conform to the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol and fix the error, we need to add the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method to <span class="code">Birthdays TableViewController</span>
 . A good place to add that is at the end of the class, right after the navigation section:</p>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<div class="box">
<pre>
<span class="ent">➊</span>
 <span class="green">// MARK: - AddBirthdayViewControllerDelegate</span>
<br />
<br />
  <span class="pink">func</span>
 addBirthdayViewController(<span class="pink">_</span>
 addBirthdayViewController: <img class="inline" src="Image00093.jpg" />
<br />
      <span class="green1">AddBirthdayViewController</span>
 , didAddBirthday birthday: <span class="green1">Birthday</span>
 ) {<br />
<br />
    <span class="ent">➋</span>
 <span class="green1">birthdays</span>
 .<span class="blue">append</span>
 (birthday)<br />
    <span class="ent">➌</span>
 <span class="violet">tableView</span>
 .<span class="blue">reloadData</span>
 ()<br />
  }</pre>
</div>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="indent">When you start typing the function name, Xcode autocomplete suggests this entire method declaration. This is because it knows this class adopts the <span class="code">AddBirthdayViewController Delegate</span>
 protocol, and it’s expecting you to add this method. Note that unlike with a subclassed method, you don’t use the <span class="code">override</span>
 keyword before <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 because there is no original method to be overridden.</p>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="indent">In this method, you need to do two things. First, you need to add the <span class="code">Birthday</span>
 that was passed in by the Add Birthday view controller to the <span class="code">birthdays</span>
 array. You do this by using the <span class="code">append(_:)</span>
 method for an array <span class="ent">➋</span>
 . Next, you need to refresh the table view so that it shows this new birthday by calling the <span class="code">reloadData()</span>
 method on the <span class="code">tableView</span>
 property <span class="ent">➌</span>
 . When <span class="code">reloadData()</span>
 is called, the table view data source methods will be called again, and the newly added <span class="code">Birthday</span>
 will be displayed at the bottom of the birthday list.</p>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="indent"><span id="page_170"></span>
 You might have noticed that we added a comment above the method to mark this section: <span class="code">// MARK: - AddBirthdayViewControllerDelegate</span>
 <span class="ent">➊</span>
 . This isn’t necessary, but it’s good coding style to mark off different sections of your class, and it helps to keep your code clean and readable. The first part of the comment, <span class="code">MARK: -</span>
 , is a special keyword that Xcode recognizes for code comments, and it adds the <span class="code">AddBirthdayViewControllerDelegate</span>
 section to a drop-down table of contents menu that you can use at the top of your class. This drop-down menu helps you find methods and lets you jump to different places in your code. To use this menu, click <span class="code">Birthdays TableViewController</span>
 at the top of the editor pane, as shown in <a href="text00022.html#ch11fig7">Figure 11-7</a>
 .</p>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<div class="image"><img src="Image00247.jpg" />
</div>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="figcap"><a id="ch11fig7"></a>
 <em>Figure 11-7: Your class has a built-in table of contents for quickly jumping to a section.</em>
</p>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<h5 class="h5" id="ch11lev3sec3">
<strong>Giving the Add Birthday View Controller a Delegate</strong>
</h5>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="noindent">
<span class="code">BirthdaysTableViewController</span>
 has adopted the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol. Now it’s time to make the Add Birthday view controller use the <span class="code">AddBirthdayViewControllerDelegate</span>
 protocol to tell the Birthdays table view controller when it has added a birthday. To do this, the Add Birthday view controller first needs to define a delegate. We arrange for this by adding an optional delegate property of type <span class="code">AddBirthdayViewControllerDelegate</span>
 to the <span class="code">AddBirthdayViewController</span>
 class by inserting the following line right below the outlets:</p>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="noindent1">
<em>AddBirthdayViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<div class="box">
<pre>
<span class="ash">class AddBirthdayViewController: UIViewController {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    @IBOutlet var birthdatePicker: UIDatePicker!</span>
<br />
<br />
    <span class="pink">var</span>
 delegate: AddBirthdayViewControllerDelegate?<br />
<br />
    <span class="ash">override func viewDidLoad() {</span>
</pre>
</div>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="indent"><span id="page_171"></span>
 The delegate has to be an optional because you can’t set it until <em>after</em>
 the Add Birthday view controller has been created. You’ll learn where to set the delegate shortly.</p>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="indent">Now that the Add Birthday view controller has a delegate, in the <span class="code">saveTapped(_:)</span>
 method, you can pass a <span class="code">Birthday</span>
 to the delegate using the <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 method. Change <span class="code">saveTapped(_:)</span>
 to the following:</p>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<div class="box">
<pre>
<span class="ash">@IBAction func saveTapped(_ sender: UIBarButtonItem) {</span>
<br />
    <span class="ash">--<em>snip</em>
 --<br />
    let newBirthday = Birthday(firstName: firstName, <img class="inline" src="Image00184.jpg" />
<br />
        lastName: lastName, birthdate: birthdate)</span>
<br />
<br />
  <span class="ent">➊</span>
 <span class="green1">delegate</span>
 ?.<span class="green2">addBirthdayViewController</span>
 (<span class="pink">self</span>
 , didAddBirthday: newBirthday)<br />
    <span class="blue">dismiss</span>
 (animated: <span class="pink">true</span>
 , completion: <span class="pink">nil</span>
 )<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="indent">After the <span class="code">birthday</span>
 object is created, the code at <span class="ent">➊</span>
 passes it back to the delegate using <span class="code">addBirthdayViewController(_:didAddBirthday:)</span>
 .</p>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="indent">Great! You’re done making changes to the Add Birthday view controller. It now has a delegate that will listen for the call that a <span class="code">Birthday</span>
 was saved. Run the app to see what happens.</p>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="indent">Hmm . . . not much has changed. When you add a <span class="code">Birthday</span>
 , you still aren’t seeing it show up in the Birthdays table view controller. What gives?</p>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<h4 class="h4" id="ch11lev2sec6">
<strong>CONNECTING THE TWO CONTROLLERS BY SETTING A DELEGATE</strong>
</h4>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="noindent">There’s one last thing you have to do. The Birthdays table view controller is an <span class="code">AddBirthdayViewControllerDelegate</span>
 , and the Add Birthday view controller has an <span class="code">AddBirthdayViewControllerDelegate</span>
 property that holds the delegate it talks to when a <span class="code">Birthday</span>
 is saved. But we never specifically set the delegate property to be the Birthdays table view controller. So it’s time to connect the communication pipeline between our two view controllers.</p>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="indent">In the Navigation section of the <span class="code">BirthdaysTableViewController</span>
 class, there’s a method that’s been commented out called <span class="code">prepare(for:sender:)</span>
 . Uncomment that method by deleting the <span class="code">/*</span>
 and <span class="code">*/</span>
 that surround it.</p>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="indent">This method is automatically called whenever the Birthdays table view controller gives up its screen and the app transitions to another view controller using a storyboard segue. We’ll use this method to pass the Birthdays table view controller in to Add Birthday view controller to set itself as the Add Birthday view controller’s delegate. Write the following in the <span class="code">prepare(for:sender:)</span>
 method:</p>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="noindent1">
<em>BirthdaysTableViewController.swift</em>
</p>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<div class="box">
<pre>
<span class="ash">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</span>
<br />
    <span class="ash">// Get the new view controller using segue.destination</span>
<br />
<span id="page_172"></span>
   <span class="ent">➊</span>
 <span class="pink">let</span>
 navigationController = segue.<span class="violet">destination</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="violet">UINavigationController</span>
<br />
  <span class="ent">➋</span>
 <span class="pink">let</span>
 addBirthdayViewController = <img class="inline" src="Image00093.jpg" />
<br />
         navigationController.<span class="violet">topViewController</span>
 <span class="pink">as</span>
 ! <img class="inline" src="Image00093.jpg" />
<br />
         <span class="green1">AddBirthdayViewController</span>
<br />
  <span class="ent">➌</span>
 addBirthdayViewController.<span class="green1">delegate</span>
 = <span class="pink">self</span>
<br />
<span class="ash">}</span>
</pre>
</div>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="indent">It takes three lines of code to set the Add Birthday view controller delegate to the Birthdays table view controller. First, you need to be able to get to the <span class="code">AddBirthdayViewController</span>
 object from the <span class="code">segue</span>
 parameter. Xcode has left in a comment hinting at how you can do that. A <span class="code">UIStoryboardSegue</span>
 has a property called <span class="code">destination</span>
 at the other end of the segue that is being prepared in this method, but the <span class="code">destination</span>
 for this app isn’t the <span class="code">AddBirthdayViewController</span>
 .</p>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="indent">In <a href="text00020.html#ch09">Chapter 9</a>
 , you embedded the Add Birthday view controller into a navigation controller so you could have a navigation bar with Cancel and Save buttons. So you don’t expect to find the Add Birthday view controller at the other end of the segue. Instead, the <span class="code">destination</span>
 is a <span class="code">UINavigationController</span>
 that contains the Add Birthday view controller. The line at <span class="ent">➊</span>
 gets you <span class="code">navigationController</span>
 . The code <span class="code">segue.destination</span>
 will return a <span class="code">UIViewController</span>
 , but since our <span class="code">navigationController</span>
 is a specific type of <span class="code">ViewController</span>
 , we need to typecast it to a <span class="code">UINavigationController</span>
 using <span class="code">as</span>
 .</p>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="indent">Next, you can get the Add Birthday view controller, which is the <span class="code">topViewController</span>
 of the <span class="code">navigationController</span>
 <span class="ent">➋</span>
 . The <span class="code">topViewController</span>
 is just the view controller that’s being displayed in the <span class="code">navigationController</span>
 , but its property is of type <span class="code">UIViewController</span>
 , so this has to be typecast to an <span class="code">AddBirthdayViewController</span>
 to indicate that this controller is a specific subclass of <span class="code">UIViewController</span>
 . Finally, when you have an <span class="code">AddBirthdayViewController</span>
 , you can set the delegate to <span class="code">self</span>
 , which is currently the Birthdays table view controller <span class="ent">➌</span>
 .</p>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="indent">Now run the app and add some birthdays! What do you see in the Birthdays table view controller? Birthdays! Birthdays! Birthdays! We’re not quite done yet, though. If you quit the app and then run it again, the previous birthdays will disappear. We still need to save the birthdays to the device, which we’ll do in <a href="text00023.html#ch12">Chapter 12</a>
 .</p>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<h3 class="h3" id="ch11lev1sec3">
<strong>WHAT YOU LEARNED</strong>
</h3>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="noindent">In this chapter, you learned how to make a table view controller to display your list of birthdays. You also learned how to add a <span class="code">Birthday</span>
 in the Add Birthday view controller, and then how to use a delegate to add the <span class="code">Birthday</span>
 to the <span class="code">birthdays</span>
 array in the Birthdays table view controller so that it could be displayed.</p>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
<p class="indent">In <a href="text00023.html#ch12">Chapter 12</a>
 , you’ll learn how to save the birthdays to your device so that they show up even after you quit the app and then run it again. To save the birthdays, you’ll use Core Data, which we set up at the very beginning of our project.</p>
</body>
</html>
</body></html>