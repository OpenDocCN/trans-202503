<html><head></head><body>
<h2 class="h2" id="ch05"><span epub:type="pagebreak" id="page_101"/><span class="big"><strong>5</strong></span><br/><strong>ATTACHING SUBJECT MEDIA TO AN ACQUISITION HOST</strong></h2>&#13;
<div class="imagef"><img src="../images/common-01.jpg" alt="image"/></div>&#13;
<p class="noindent">This chapter discusses the physical attachment of subject storage media to an examination host, identification of the subject device on the system, and querying the device firmware for information. You’ll also learn about methods for removing HPA and DCO, unlocking ATA passwords, and decrypting self-encrypting drives. The chapter ends with several special storage topics. Let’s start by examining the subject PC hardware.</p>&#13;
<h3 class="h3" id="ch05lev1sec01"><strong>Examine Subject PC Hardware</strong></h3>&#13;
<p class="noindent">When a PC or notebook is seized in the field or delivered to a forensic lab for examination, more than just the internal disks can be examined. Included in the examination should be a complete review of the PC hardware configuration, BIOS settings, hardware clock, and so on.</p>&#13;
<div class="note">&#13;
<p class="notet"><span epub:type="pagebreak" id="page_102"/><strong>NOTE</strong></p>&#13;
<p class="notep"><em>The scope of this book covers “dead” disk acquisition, that is, drives and PCs that are already powered off. Depending on the organization, a triage process will exist for arriving at a crime or incident scene with live, running machines. This triage process may include taking photographs of screens, using mouse jigglers to prevent password-protected screensavers from activating, or running memory-dumping tools. First responder triage of live PCs is outside the scope of this book.</em></p>&#13;
</div>&#13;
<h4 class="h4" id="ch05lev2sec01"><em><strong>Physical PC Examination and Disk Removal</strong></em></h4>&#13;
<p class="noindenta">Before you unplug any drive cables or unscrew any drives from the drive bays, take photographs of the subject PC to document the hardware configuration, the number of disks it contains, and how the disks are cabled to the mainboard.</p>&#13;
<p class="indent">Remove disks with care, especially if they’re in old PCs that may not have been opened for many years. The top of each drive can be photographed to capture the serial number and other information on the label. For each disk, note the cable location on the mainboard. If a mainboard has multiple SATA ports, note which port each disk was using.</p>&#13;
<p class="indent">Open optical drive trays to confirm they don’t contain any discs. Most optical drives have a pinhole that can manually release the drive door without powering on the drive.</p>&#13;
<p class="indent">Examine the PCI slots for PCI SATA Express drives or PCI NVME drives. If a mainboard has an M.2 or mSATA slot, check for SSD circuit boards.</p>&#13;
<h4 class="h4" id="ch05lev2sec02"><em><strong>Subject PC Hardware Review</strong></em></h4>&#13;
<p class="noindenta">After removing all the drives from the subject PC enclosure, power on the subject mainboard and note the BIOS configuration, clock, boot order, potential BIOS logs, version, and so forth.</p>&#13;
<p class="indent">If you require further information about the subject PC, examine it using a forensic boot CD that contains various hardware analysis tools, such as lshw, dmidecode, biosdecode, lspic, and more.</p>&#13;
<p class="indent">You might be able to retrieve some vendor-specific information by using vendor-specific tools—for example, vpddecode for IBM and Lenovo hardware or ownership for Compaq hardware ownership tags.</p>&#13;
<p class="indent">Examine and document any additional hardware components as well, such as memory modules or PCI cards.</p>&#13;
<h3 class="h3" id="ch05lev1sec02"><strong>Attach Subject Disk to an Acquisition Host</strong></h3>&#13;
<p class="noindent">After physically attaching the subject drive to the examiner workstation (using a write-blocking mechanism), you need to identify the correct block device associated with the subject drive. To reliably identify the subject drive on the acquisition host, list the storage media devices, confirm any unique identifiers associated with the physical drive, and determine the corresponding device file in <em>/dev</em>. This section examines these steps in more detail.</p>&#13;
<h4 class="h4" id="ch05lev2sec03"><span epub:type="pagebreak" id="page_103"/><em><strong>View Acquisition Host Hardware</strong></em></h4>&#13;
<p class="noindenta">Understanding the examination host’s hardware configuration is useful for performance tuning, capacity planning, maintaining a stable platform, troubleshooting, isolating faults, and reducing the risk of human error. In this section, you’ll see examples of tools you can use for listing and viewing PC hardware.</p>&#13;
<p class="indent">Using the lshw tool, you can generate a quick overview of the examiner workstation hardware:</p>&#13;
<p class="programs"># <strong>lshw -businfo</strong></p>&#13;
<p class="indent">The bus information describes the device specific addresses, such as <a href="mailto:pci@domain:bus:slot.function">pci@domain:bus:slot.function</a>, <a href="mailto:scsi@host.channel.target.lun">scsi@host.channel.target.lun</a>, and <a href="mailto:usb@bus:device">usb@bus:device</a>.</p>&#13;
<p class="indent">You can also use lshw to specifically look for an attached device type. For example:</p>&#13;
<p class="programs"># <strong>lshw -businfo -class storage</strong><br/>Bus info          Device     Class          Description<br/>=======================================================<br/>...<br/>usb@2:5.2         scsi22     storage        Forensic SATA/IDE Bridge<br/>...<br/># <strong>lshw -businfo -class disk</strong><br/>Bus info          Device     Class          Description<br/>=======================================================<br/>...<br/>scsi@22:0.0.0     /dev/sdp   disk           120GB SSD 850<br/>...</p>&#13;
<p class="indent">Note that <span class="literal">scsi22</span> links to <span class="literal">scsi@22:.0.0.0</span>, which links to <em>/dev/sdp</em>. Identifying the Linux device file for an attached physical drive is discussed further in the following sections.</p>&#13;
<p class="indent">If the subject drive has been externally attached, it’s likely connected via USB, Thunderbolt, FireWire, or eSATA (and in rare cases, possibly Fibre Channel).</p>&#13;
<p class="indent">If the drive has been internally attached, it’s likely connected via SATA cable, a PCI Express slot, an M.2 interface, or SAS cable (or possibly legacy interfaces, such as parallel SCSI or IDE).</p>&#13;
<p class="indent">You can list the devices attached to the PCI bus (including parallel PCI and PCI Express) using the lspci tool:</p>&#13;
<p class="programs"># <strong>lspci</strong></p>&#13;
<p class="indent">The PCI bus categorizes devices by class (see <em><a href="http://pci-ids.ucw.cz/">http://pci-ids.ucw.cz/</a></em> for more information about PCI IDs and device classes). Devices matching the <em>Mass storage controller</em> class (class ID 01) are of interest because they manage attached storage media.</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_104"/>Newer versions of lspci (as of pciutils version 3.30) can list the PCI bus by device class, which can be useful to isolate specific hardware of interest. The following command lists all SATA mass storage controller (class ID 01, subclass ID 06) devices:</p>&#13;
<p class="programs"># <strong>lspci -d ::0106</strong></p>&#13;
<p class="indent">This command enumerates all the SCSI, IDE, RAID, ATA, SATA, SAS, and NVME mass storage controller devices on a system:</p>&#13;
<p class="programs"># <strong>for i in 00 01 04 05 06 07 08; do lspci -d ::01$i; done</strong></p>&#13;
<p class="indent">Another PCI class that can manage connected storage media is the <em>serial bus controller</em> class (class ID 0C). The following command lists all devices with the USB serial bus controller class (class ID 0C, subclass ID 03):</p>&#13;
<p class="programs"># <strong>lspci -d ::0C03</strong></p>&#13;
<p class="indent">This command enumerates all FireWire, USB, and Fibre Channel serial bus controllers on the examiner host:</p>&#13;
<p class="programs"># <strong>for i in 00 03 04; do lspci -d ::0C$i; done</strong></p>&#13;
<p class="indent">If the subject drive is attached via USB, it won’t appear on the PCI bus. You can list USB devices separately using lsusb. Without options, the command generates a list of all attached USB devices:</p>&#13;
<p class="programs"># <strong>lsusb</strong><br/>...<br/>Bus 001 Device 005: ID 0951:1665 Kingston Technology<br/>Bus 001 Device 002: ID 8087:0024 Intel Corp. Integrated Rate Matching Hub<br/>Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub</p>&#13;
<p class="indent">Here a USB thumb drive is attached to USB bus 1 and assigned a USB device ID of 5. Running <span class="literal">lsusb -v</span> will provide more detailed output about the USB device.<sup><a id="fn_22" href="footnote.xhtml#fn22">1</a></sup></p>&#13;
<p class="indent">The preceding tools and examples provide an overview of the storage media controllers and the hardware attached to an examiner workstation. The lshw(1), lspci(8), and lsusb(8) manual pages explain additional parameters and features, which you can use to view more detail about the hardware.</p>&#13;
<h4 class="h4" id="ch05lev2sec04"><span epub:type="pagebreak" id="page_105"/><em><strong>Identify the Subject Drive</strong></em></h4>&#13;
<p class="noindenta">Having an understanding of the examiner workstation hardware, especially the available bus systems and controllers, will help you locate where a subject disk is attached. The next step is to positively confirm the identity of the subject drive using some distinct information, such as a serial number, unique model number, or other unique property.</p>&#13;
<p class="indent">You can use multiple approaches to identify the subject device. If the subject disk is attached via the USB bus and listed with the lsusb tool, you can retrieve more information by specifying the subject disk’s <span class="literal"><span class="codeitalic">vendor</span>:<span class="codeitalic">productID</span></span>, as shown here:</p>&#13;
<p class="programs"># <strong>lsusb -vd 0781:5583</strong><br/><br/>Bus 004 Device 002: ID 0781:5583 SanDisk Corp.<br/>...<br/>  idVendor           0x0781 SanDisk Corp.<br/>  idProduct          0x5583<br/>  bcdDevice            1.00<br/>  iManufacturer           1 SanDisk<br/>  iProduct                2 Ultra Fit<br/>  iSerial                 3 4C530001200627113025<br/>...<br/>    wSpeedsSupported   0x000e<br/>      Device can operate at Full Speed (12Mbps)<br/>      Device can operate at High Speed (480Mbps)<br/>      Device can operate at SuperSpeed (5Gbps)<br/>...</p>&#13;
<p class="indent">From this output, you can use the unique information (serial number and so on) about the device to confirm the identity of the attached device as the subject drive. If the serial number or other unique properties match the physically attached drive, you’ve identified the correct device.</p>&#13;
<p class="indent">Nearly all drives are accessible via SCSI commands (directly attached NVME drives are a notable exception). To query for an attached storage device, you can use the lsscsi tool. It supports a number of transport layer protocols, including SATA, USB, SAS, FireWire, ATA, SCSI, Fibre Channel, and more. lsscsi is also useful for linking kernel device paths with device files in <em>/dev</em>:</p>&#13;
<p class="programs"># <strong>lsscsi -v</strong><br/>...<br/>[6:0:0:0]    disk    ATA      INTEL SSDSA2CW30 0302  /dev/sda<br/>  dir: /sys/bus/scsi/devices/6:0:0:0  [/sys/devices/pci0000:00/0000:00:1f.2/ata7/<br/>    host6/target6:0:0/6:0:0:0]<br/>...</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_106"/>The kernel outputs an informational message when devices are attached or detached from a host system. This is the kernel <em>ring buffer</em> and is viewed with the dmesg tool. Running <span class="literal">dmesg</span> with the <span class="literal">-T</span> flag prints human-readable timestamps, which are useful when you’re determining which device was added at a known time:</p>&#13;
<p class="programs"># <strong>dmesg -T</strong><br/>...<br/>[Sun May 15 13:44:45 2016] usb 2-1: new SuperSpeed USB device number 9 using<br/>    xhci_hcd<br/>[Sun May 15 13:44:45 2016] usb 2-1: New USB device found, idVendor=0781,<br/>    idProduct=5583<br/>[Sun May 15 13:44:45 2016] usb 2-1: New USB device strings: Mfr=1, Product=2,<br/>    SerialNumber=3<br/>[Sun May 15 13:44:45 2016] usb 2-1: Product: Ultra Fit<br/>[Sun May 15 13:44:45 2016] usb 2-1: Manufacturer: SanDisk<br/>[Sun May 15 13:44:45 2016] usb 2-1: SerialNumber: 4C530001141203113173<br/>[Sun May 15 13:44:45 2016] usb-storage 2-1:1.0: USB Mass Storage device detected<br/>[Sun May 15 13:44:45 2016] scsi host24: usb-storage 2-1:1.0<br/>[Sun May 15 13:44:46 2016] scsi 24:0:0:0: Direct-Access     SanDisk  Ultra Fit<br/>    1.00 PQ: 0 ANSI: 6<br/>[Sun May 15 13:44:46 2016] sd 24:0:0:0: Attached scsi generic sg5 type 0<br/>[Sun May 15 13:44:46 2016] sd 24:0:0:0: [sdf] 30375936 512-byte logical blocks:<br/>    (15.6 GB/14.5 GiB)<br/>[Sun May 15 13:44:46 2016] sd 24:0:0:0: [sdf] Write Protect is off<br/>[Sun May 15 13:44:46 2016] sd 24:0:0:0: [sdf] Mode Sense: 43 00 00 00<br/>[Sun May 15 13:44:46 2016] sd 24:0:0:0: [sdf] Write cache: disabled, read cache:<br/>    enabled, doesn't support DPO or FUA<br/>[Sun May 15 13:44:46 2016]  sdf: sdf1<br/>[Sun May 15 13:44:46 2016] sd 24:0:0:0: [sdf] Attached SCSI removable disk</p>&#13;
<p class="indent">You can use this output to identify an attached physical device, linking the USB device to a SCSI host ID and a block device name. In this example, <span class="literal">usb 2-1:</span> refers to bus 2 and physical port 1 (the plug). The USB drive is assigned <span class="literal">device number 9</span> and uses the <em>xhci_hcd driver</em> (which has USB3 support). The vendor and product ID strings, <span class="literal">idVendor=0781</span>, <span class="literal">idProduct=5583</span>, are displayed, followed by informational strings for the manufacturer, product, and serial number (these can be different from <span class="literal">idVendor</span> and <span class="literal">idProduct</span>). The Bulk-Only Transport <span class="literal">usb-storage</span> driver detects the device (not needed for UASP devices), and <span class="literal">scsi host24:</span> indicates a SCSI host number has been assigned to the device and corresponds to the SCSI address <span class="literal">24:0:0:0:</span>. Two devices are created, <span class="literal">sg5</span> (generic SCSI) and <span class="literal">sdf</span> (block device), which correspond to <em>/dev/sg5</em> and <em>/dev/sdf</em>. Some information about the (now established) SCSI device is queried, and partition tables are detected (<span class="literal">sdf1</span>).</p>&#13;
<p class="indent">A simpler command to list all attached storage devices, including descriptive information and device paths, is the <span class="literal">lsblk</span> command. Newer versions of lsblk provide output options for vendor, model, revision, serial number, and <span epub:type="pagebreak" id="page_107"/><em>WWN</em> (<em>World Wide Name</em>; <em><a href="https://en.wikipedia.org/wiki/World_Wide_Name">https://en.wikipedia.org/wiki/World_Wide_Name</a></em>) number. In addition, lsblk provides useful technical details, such as the device name, size, physical and logical sector size, transport (USB, SATA, SAS, and so on), SCSI address, and more:</p>&#13;
<p class="programs"># <strong>lsblk -pd -o TRAN,NAME,SERIAL,VENDOR,MODEL,REV,WWN,SIZE,HCTL,SUBSYSTEMS,HCTL</strong></p>&#13;
<p class="indent">Most of the tools demonstrated here are simply reading different files and directories from the Linux <em>/proc</em> directory. You’ll find more information about attached drives and other kernel structures in the <em>/proc</em> tree. Consult the proc(5) manual page for more information about the proc filesystem.</p>&#13;
<h3 class="h3" id="ch05lev1sec03"><strong>Query the Subject Disk for Information</strong></h3>&#13;
<p class="noindent">After attaching the subject drive to the examiner workstation and positively identifying the correct Linux device to work with, you can gather additional meta information about the device. You can query the device directly for information about the drive, the firmware, SMART data, and other configuration details.</p>&#13;
<p class="indent">A number of tools are available to query information stored in the hard drive. Typically, you access this firmware information using lower-level ATA or SCSI interface commands, which interact directly with the drive electronics.</p>&#13;
<h4 class="h4" id="ch05lev2sec05"><em><strong>Document Device Identification Details</strong></em></h4>&#13;
<p class="noindentb">At this point, you should have a number of details and technical identifiers about the drive attached to the examiner host, including the following:</p>&#13;
<p class="bull">• Vendor, make, and model</p>&#13;
<p class="bull">• Serial number or WWN</p>&#13;
<p class="bull">• Linux device name</p>&#13;
<p class="bull">• PCI <span class="literal"><span class="codeitalic">domain</span>:<span class="codeitalic">bus</span>:<span class="codeitalic">slot.function</span></span></p>&#13;
<p class="bull">• PCI <span class="literal"><span class="codeitalic">vendorID</span>:<span class="codeitalic">deviceID</span></span></p>&#13;
<p class="bull">• USB <span class="literal"><span class="codeitalic">bus</span>:<span class="codeitalic">device</span></span></p>&#13;
<p class="bull">• USB <span class="literal"><span class="codeitalic">vendorID</span>:<span class="codeitalic">productID</span></span></p>&#13;
<p class="bull">• SCSI <span class="literal"><span class="codeitalic">host</span>:<span class="codeitalic">channel</span>:<span class="codeitalic">target</span>:<span class="codeitalic">lun</span></span></p>&#13;
<p class="indentt">You can save this information for reporting purposes by redirecting the various tool command outputs to text files.</p>&#13;
<p class="indent">Document evidence for the use of a write blocker. If you’re using a hardware write blocker, such as Tableau, query it and save the results:</p>&#13;
<p class="programs"># <strong>tableau-parm /dev/sdc &gt; write-blocked.txt</strong></p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_108"/>Here <em>/dev/sdc</em> should be replaced with the relevant device of the subject drive.</p>&#13;
<p class="indent">If you’re using a software write blocker, such as wrtblk, query <span class="literal">blockdev</span> for a report on the current status of the device (including the read-only flag):</p>&#13;
<p class="programs"># <strong>blockdev --report /dev/sda &gt; wrtblk.txt</strong></p>&#13;
<p class="indent">Here <em>/dev/sda</em> should be replaced with the relevant device of the subject drive.</p>&#13;
<p class="indent">If the subject drive is attached via USB, you can specify it either by the <span class="literal"><span class="codeitalic">bus</span>:<span class="codeitalic">device</span></span> (using <span class="literal">-s</span>) or by <span class="literal"><span class="codeitalic">vendor</span>:<span class="codeitalic">product</span></span> (using <span class="literal">-d</span>). The following two commands will produce and save the same verbose output:</p>&#13;
<p class="programs"># <strong>lsusb -v -s 2:2 &gt; lsusb.txt</strong><br/># <strong>lsusb -v -d 13fe:5200 &gt; lsusb.txt</strong></p>&#13;
<p class="indent">Here <span class="literal">2:2</span> and <span class="literal">13fe:5200</span> should be replaced with the relevant values for the subject drive on your acquisition host.</p>&#13;
<p class="indent">The <span class="literal">lsblk</span> command can specify a Linux device, and the <span class="literal">-O</span> flag will output all available columns in the output:</p>&#13;
<p class="programs"># <strong>lsblk -O /dev/sda &gt; lsblk.txt</strong></p>&#13;
<p class="indent">Here <em>/dev/sda</em> should be replaced with the relevant device of the subject drive on your acquisition host.</p>&#13;
<p class="indent">The <span class="literal">lsscsi</span> command can also save a certain perspective of the attached drive, specifying the SCSI address to use:</p>&#13;
<p class="programs"># <strong>lsscsi -vtg -L 16:0:0:0 &gt; lsscsi.txt</strong></p>&#13;
<p class="indent">Here <span class="literal">16:0:0:0</span> should be replaced with the relevant SCSI address of the subject drive on your acquisition host.</p>&#13;
<p class="indent">Relevant dmesg output could also be copied into a text file if desired.</p>&#13;
<p class="indent">The examples shown in this section illustrated how to save command output for a specific subject drive. For brevity, subsequent chapters sometimes will not include examples of saving data to files, focusing instead on the construction of commands.</p>&#13;
<h4 class="h4" id="ch05lev2sec06"><em><strong>Query Disk Capabilities and Features with hdparm</strong></em></h4>&#13;
<p class="noindenta">Many of the tools discussed previously (lsusb, lspci, lsblk, and so on) have queried the Linux system and kernel structures for information. However, it’s possible to query a drive directly for additional information. The hdparm tool is useful for sending commands to most drives attached to a Linux system.</p>&#13;
<p class="indentb"><span epub:type="pagebreak" id="page_109"/>The hdparm tool operates by sending requests to the OS disk drivers (using ioctls) to retrieve information about the disk. From a forensics perspective, a number of items may be of interest or useful to document:</p>&#13;
<p class="bull">• Details about the drive geometry (physical and logical)</p>&#13;
<p class="bull">• The disk’s supported standards, features, and capabilities</p>&#13;
<p class="bull">• States and flags related to the drive configuration</p>&#13;
<p class="bull">• DCO and HPA information</p>&#13;
<p class="bull">• Security information</p>&#13;
<p class="bull">• Vendor information, such as make, model, and serial number</p>&#13;
<p class="bull">• The WWN device identifier (if it exists)</p>&#13;
<p class="bull">• Time needed for secure erase (for most disks, this is roughly the acquisition time)</p>&#13;
<p class="indentt">For more detailed information about hdparm’s features, see the hdparm(8) manual page.</p>&#13;
<p class="indent">The following example shows how to use hdparm to get an overview of the disk using the <span class="literal">-I</span> flag together with the raw disk device. The listing is annotated with comments relevant to forensic investigators.</p>&#13;
<p class="indent">The output begins with documenting information about the drive, including manufacturer, model, serial number, and the standards with which it is compliant. Also in the output are various drive parameters, such as physical and logical sector size, number of sectors, form factor, and other physical properties.</p>&#13;
<p class="programs"># <strong>hdparm -I /dev/sda</strong><br/><br/>/dev/sda:<br/><br/>ATA device, with non-removable media<br/>        Model Number:       WDC WD20EZRX-00D8PB0<br/>        Serial Number:      WD-WCC4NDA2N98P<br/>        Firmware Revision:  80.00A80<br/>        Transport:          Serial, SATA 1.0a, SATA II Extensions, SATA Rev 2.5,<br/>    SATA Rev 2.6, SATA Rev 3.0<br/>Standards:<br/>        Supported: 9 8 7 6 5<br/>        Likely used: 9<br/>Configuration:<br/>        Logical         max     current<br/>        cylinders       16383   16383<br/>        heads           16      16<br/>        sectors/track   63      63<br/>        --<br/>        CHS current addressable sectors:   16514064<br/>        LBA    user addressable sectors:  268435455<br/>        LBA48  user addressable sectors: 3907029168<br/>        Logical Sector size:                    512 bytes<br/>        Physical Sector size:                  4096 bytes<br/>        device size with M = 1024*1024:     1907729 MBytes<br/>        device size with M = 1000*1000:     2000398 MBytes (2000 GB)<br/>        cache/buffer size  = unknown<br/>        Nominal Media Rotation Rate: 5400<br/>Capabilities:<br/>        LBA, IORDY(can be disabled)<br/>        Queue depth: 32<br/>        Standby timer values: spec'd by Standard, with device specific minimum<br/>        R/W multiple sector transfer: Max = 16  Current = 16<br/>        DMA: mdma0 mdma1 mdma2 udma0 udma1 udma2 udma3 udma4 udma5 *udma6<br/>             Cycle time: min=120ns recommended=120ns<br/>        PIO: pio0 pio1 pio2 pio3 pio4<br/>             Cycle time: no flow control=120ns  IORDY flow control=120ns<br/>...</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_110"/>The next section of the output describes the features available on a drive, and the star (<span class="literal"><sub>*</sub></span>) indicates if a feature is currently enabled. (To understand vendor-specific features, you might need additional proprietary documentation.) This is useful when you’re preparing for a forensic acquisition, because it indicates the status of security feature sets and other things like the DCO (<span class="literal">Device Configuration Overlay feature set</span>).</p>&#13;
<p class="programs">...<br/>Commands/features:<br/>        Enabled Supported:<br/>           *    SMART feature set<br/>                Security Mode feature set<br/>           *    Power Management feature set<br/>           *    Write cache<br/>           *    Look-ahead<br/>           *    Host Protected Area feature set<br/>           *    WRITE_BUFFER command<br/>           *    READ_BUFFER command<br/>           *    NOP cmd<br/>           *    DOWNLOAD_MICROCODE<br/>                Power-Up In Standby feature set<br/>           *    SET_FEATURES required to spinup after power up<br/>                SET_MAX security extension<br/>           *    48-bit Address feature set<br/>           *    Device Configuration Overlay feature set<br/>           *    Mandatory FLUSH_CACHE<br/>           *    FLUSH_CACHE_EXT<br/>           *    SMART error logging<br/>           *    SMART self-test<br/>           *    General Purpose Logging feature set<br/>           *    64-bit World wide name<br/>           *    WRITE_UNCORRECTABLE_EXT command<br/>           *    {READ,WRITE}_DMA_EXT_GPL commands<br/>           *    Segmented DOWNLOAD_MICROCODE<br/>           *    Gen1 signaling speed (1.5Gb/s)<br/>           *    Gen2 signaling speed (3.0Gb/s)<br/>           *    Gen3 signaling speed (6.0Gb/s)<br/>           *    Native Command Queueing (NCQ)<br/>           *    Host-initiated interface power management<br/>           *    Phy event counters<br/>           *    NCQ priority information<br/>           *    READ_LOG_DMA_EXT equivalent to READ_LOG_EXT<br/>           *    DMA Setup Auto-Activate optimization<br/>                Device-initiated interface power management<br/>           *    Software settings preservation<br/>           *    SMART Command Transport (SCT) feature set<br/>           *    SCT Write Same (AC2)<br/>           *    SCT Features Control (AC4)<br/>           *    SCT Data Tables (AC5)<br/>                unknown 206[12] (vendor specific)<br/>                unknown 206[13] (vendor specific)<br/>                unknown 206[14] (vendor specific)<br/>...</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_111"/>The next section of the hdparm output provides more detail about the currently active security features, which are important when you’re determining if a drive is locked or encrypted. The time needed for a secure erase is also a rough estimate of how long an acquisition might take (if the subject drive is the performance bottleneck).</p>&#13;
<p class="programs">...<br/>Security:<br/>        Master password revision code = 65534<br/>                supported<br/>        not     enabled<br/>        not     locked<br/>        not     frozen<br/>        not     expired: security count<br/>                supported: enhanced erase<br/>        324min for SECURITY ERASE UNIT. 324min for ENHANCED SECURITY ERASE UNIT.<br/>...</p>&#13;
<p class="indent">The final section of the hdparm output displays the WWN again, but this time it’s broken down into the NAA (which describes the rest of the WWN), the IEEE OUI assigned vendor ID, and the rest of the WWN (which isunique to the drive).</p>&#13;
<p class="programs"><span epub:type="pagebreak" id="page_112"/>...<br/>Logical Unit WWN Device Identifier: 50014ee25fcfe40c<br/>        NAA             : 5<br/>        IEEE OUI        : 0014ee<br/>        Unique ID       : 25fcfe40c<br/>Checksum: correct</p>&#13;
<p class="indent">The hdparm output contains a number of items of interest to forensic investigators, either for documentation or as information for further analysis. To include the entire output of <span class="literal">hdparm -I</span> in a forensic report, you can redirect it to a text file.</p>&#13;
<p class="indent">A similar tool for querying SCSI drives is sdparm, which you can use to access SCSI mode pages. Running <span class="literal">sdparm</span> with the flags <span class="literal">-a -l</span> retrieves a verbose list of disk parameters. A more concise query using <span class="literal">sdparm -i</span> can extract the Vital Product Data (VPD), which provides unique identifying information about the make, model, and serial number of SCSI and SAS drives.</p>&#13;
<h4 class="h4" id="ch05lev2sec07"><em><strong>Extract SMART Data with smartctl</strong></em></h4>&#13;
<p class="noindenta">SMART was developed in the early 1990s to help monitor hard disks and predict failures. It was added to the SCSI-3 standard in 1995(SCSI-3 standard: X3T10/94-190 Rev 4) and the ATA-3 standard in 1997 (ATA-3 standard: X3.298-1997). Because certain details about the disk hardware may be of value in forensic investigations, in this section, you’ll learn several techniques to extract SMART information about the disk hardware.</p>&#13;
<p class="indent">The <span class="literal">smartctl</span> command is part of the smartmontools package and provides access to the SMART interface built into nearly all modern hard drives. The <span class="literal">smartctl</span> command queries attached ATA, SATA, SAS, and SCSI hardware.</p>&#13;
<p class="indentb">SMART provides a number of variables and statistics about a disk, some of which could be of interest to a forensic investigator. For example:</p>&#13;
<p class="bull">• Statistics about errors on the disk and the overall health of the disk</p>&#13;
<p class="bull">• Number of times the disk was powered on</p>&#13;
<p class="bull">• Number of hours the disk was in operation</p>&#13;
<p class="bull">• Number of bytes read and written (often expressed in gigabytes)</p>&#13;
<p class="bull">• Various SMART logs (temperature history, and so on)<sup><a id="fn_23" href="footnote.xhtml#fn23">2</a></sup></p>&#13;
<p class="indentt">The following example shows SMART data requested from a drive. The listing is annotated with comments relevant to forensic investigators.</p>&#13;
<p class="indent">The <span class="literal">-x</span> flag instructs smartctl to print all available information. The first block of output is the information section, which provides unique <span epub:type="pagebreak" id="page_113"/>identifying information about the drive. You can also retrieve most of this information using other tools, such as hdparm, as shown in previous examples.</p>&#13;
<p class="programs"># <strong>smartctl -x /dev/sda</strong><br/>smartctl 6.4 2014-10-07 r4002 [x86_64-linux-4.2.0-22-generic] (local build)<br/>Copyright (C) 2002-14, Bruce Allen, Christian Franke, www.smartmontools.org<br/><br/>=== START OF INFORMATION SECTION ===<br/>Model Family:     Western Digital Green<br/>Device Model:     WDC WD20EZRX-00D8PB0<br/>Serial Number:    WD-WCC4NDA2N98P<br/>LU WWN Device Id: 5 0014ee 25fcfe40c<br/>Firmware Version: 80.00A80<br/>User Capacity:    2,000,398,934,016 bytes [2.00 TB]<br/>Sector Sizes:     512 bytes logical, 4096 bytes physical<br/>Rotation Rate:    5400 rpm<br/>Device is:        In smartctl database [for details use: -P show]<br/>ATA Version is:   ACS-2 (minor revision not indicated)<br/>SATA Version is:  SATA 3.0, 6.0 Gb/s (current: 6.0 Gb/s)<br/>Local Time is:    Thu Jan 7 12:33:43 2016 CET<br/>SMART support is: Available - device has SMART capability.<br/>SMART support is: Enabled<br/>AAM feature is:   Unavailable<br/>APM feature is:   Unavailable<br/>Rd look-ahead is: Enabled<br/>Write cache is:   Enabled<br/>ATA Security is:  Disabled, NOT FROZEN [SEC1]<br/>Wt Cache Reorder: Enabled<br/>...</p>&#13;
<p class="indent">The following SMART data section shows the health of the drive and the results of self-tests. An unhealthy drive is an early warning of possible acquisition issues. Additional SMART capabilities are then listed.</p>&#13;
<p class="programs">...<br/>=== START OF READ SMART DATA SECTION ===<br/>SMART overall-health self-assessment test result: PASSED<br/><br/>General SMART Values:<br/>Offline data collection status:  (0x82) Offline data collection activity<br/>                                        was completed without error.<br/>                                        Auto Offline Data Collection: Enabled.<br/>Self-test execution status:      (   0) The previous self-test routine completed<br/>                                        without error or no self-test has ever<br/>                                        been run.<br/>Total time to complete Offline<br/>data collection:                (30480) seconds.<br/>Offline data collection<br/>capabilities:                    (0x7b) SMART execute Offline immediate.<br/>                                        Auto Offline data collection on/off support.<br/>                                        Suspend Offline collection upon new<br/>                                        command.<br/>                                        Offline surface scan supported.<br/>                                        Self-test supported.<br/>                                        Conveyance Self-test supported.<br/>                                        Selective Self-test supported.<br/>SMART capabilities:            (0x0003) Saves SMART data before entering<br/>                                        power-saving mode.<br/>                                        Supports SMART auto save timer.<br/>Error logging capability:        (0x01) Error logging supported.<br/>                                        General Purpose Logging supported.<br/>Short self-test routine<br/>recommended polling time:        (   2) minutes.<br/>Extended self-test routine<br/>recommended polling time:        ( 307) minutes.<br/>Conveyance self-test routine<br/>recommended polling time:        (   5) minutes.<br/>SCT capabilities:              (0x7035) SCT Status supported.<br/>                                        SCT Feature Control supported.<br/>                                        SCT Data Table supported.<br/>...</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_114"/>The next section provides more statistics about the drive. Of possible forensic interest here are statistics on the history of the drive usage; for example, the cumulative number of hours the drive has been powered on (<span class="literal">Power_On_Hours</span>) and how many times the drive has been powered up (<span class="literal">Power_Cycle_Count</span>). Both attributes may correlate with the PC from where they were taken. The total logical block addresses (LBAs) read and written indicates the drive volume usage in the past.</p>&#13;
<p class="programs">...<br/>SMART Attributes Data Structure revision number: 16<br/>Vendor Specific SMART Attributes with Thresholds:<br/>ID# ATTRIBUTE_NAME          FLAGS    VALUE WORST THRESH FAIL RAW_VALUE<br/>  1 Raw_Read_Error_Rate     POSR-K   200   200   051    -    0<br/>  3 Spin_Up_Time            POS--K   181   180   021    -    5908<br/>  4 Start_Stop_Count        -O--CK   100   100   000    -    61<br/>  5 Reallocated_Sector_Ct   PO--CK   200   200   140    -    0<br/>  7 Seek_Error_Rate         -OSR-K   200   200   000    -    0<br/>  9 Power_On_Hours          -O--CK   099   099   000    -    989<br/> 10 Spin_Retry_Count        -O--CK   100   253   000    -    0<br/> 11 Calibration_Retry_Count -O--CK   100   253   000    -    0<br/> 12 Power_Cycle_Count       -O--CK   100   100   000    -    59<br/>192 Power-Off_Retract_Count -O--CK   200   200   000    -    33<br/>193 Load_Cycle_Count        -O--CK   199   199   000    -    3721<br/>194 Temperature_Celsius     -O---K   119   110   000    -    31<br/>196 Reallocated_Event_Count -O--CK   200   200   000    -    0<br/>197 Current_Pending_Sector  -O--CK   200   200   000    -    4<br/>198 Offline_Uncorrectable   ----CK   200   200   000    -    4<br/>199 UDMA_CRC_Error_Count    -O--CK   200   200   000    -    0<br/>200 Multi_Zone_Error_Rate   ---R--   200   200   000    -    4<br/>                            ||||||_ K auto-keep<br/>                            |||||__ C event count<br/>                            ||||___ R error rate<br/>                            |||____ S speed/performance<br/>                            ||_____ O updated online<br/>                            |______ P prefailure warning<br/>...</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_115"/>The next section is the log directory, which describes the SMART logs available on the drive. The logs are included in the <span class="literal">smartctl -x</span> output with repeating entries removed (“skipped”). Some of these logs may be of interest in a forensic investigation.</p>&#13;
<p class="programs">...<br/>General Purpose Log Directory Version 1<br/>SMART           Log Directory Version 1 [multi-sector log support]<br/>Address    Access  R/W   Size  Description<br/>0x00       GPL,SL  R/O      1  Log Directory<br/>0x01           SL  R/O      1  Summary SMART error log<br/>0x02           SL  R/O      5  Comprehensive SMART error log<br/>0x03       GPL     R/O      6  Ext. Comprehensive SMART error log<br/>0x06           SL  R/O      1  SMART self-test log<br/>0x07       GPL     R/O      1  Extended self-test log<br/>0x09           SL  R/W      1  Selective self-test log<br/>0x10       GPL     R/O      1  SATA NCQ Queued Error log<br/>0x11       GPL     R/O      1  SATA Phy Event Counters log<br/>0x80-0x9f  GPL,SL  R/W     16  Host vendor specific log<br/>0xa0-0xa7  GPL,SL  VS      16  Device vendor specific log<br/>0xa8-0xb7  GPL,SL  VS       1  Device vendor specific log<br/>0xbd       GPL,SL  VS       1  Device vendor specific log<br/>0xc0       GPL,SL  VS       1  Device vendor specific log<br/>0xc1       GPL     VS      93  Device vendor specific log<br/>0xe0       GPL,SL  R/W      1  SCT Command/Status<br/>0xe1       GPL,SL  R/W      1  SCT Data Transfer<br/>...</p>&#13;
<p class="indent">The next section of log information displays the results of self-tests. Failed self-tests are an early warning that the acquisition could have issues.</p>&#13;
<p class="programs"><span epub:type="pagebreak" id="page_116"/>...<br/>SMART Extended Comprehensive Error Log Version: 1 (6 sectors)<br/>No Errors Logged<br/><br/>SMART Extended Self-test Log Version: 1 (1 sectors)<br/>Num  Test_Description  Status                 Remaining LifeTime(hours)  LBA_of...<br/># 1  Short offline     Completed without error      00%        0         -<br/><br/>SMART Selective self-test log data structure revision number 1<br/> SPAN  MIN_LBA  MAX_LBA  CURRENT_TEST_STATUS<br/>    1        0        0  Not_testing<br/>    2        0        0  Not_testing<br/>    3        0        0  Not_testing<br/>    4        0        0  Not_testing<br/>    5        0        0  Not_testing<br/>Selective self-test flags (0x0):<br/>  After scanning selected spans, do NOT read-scan remainder of disk.<br/>If Selective self-test is pending on power-up, resume after 0 minute delay.<br/><br/>SCT Status Version:                  3<br/>SCT Version (vendor specific):       258 (0x0102)<br/>SCT Support Level:                   1<br/>Device State:                        Active (0)<br/>...</p>&#13;
<p class="indent">The next output block describes a drive’s temperature statistics. This information could be useful to monitor during the acquisition process. For investigation purposes, the minimum and maximum temperatures reached during the drive’s lifetime might be of interest if correlated with environ-mental factors linked to a suspect’s PC. Vendor-specific SMART data is not part of the generic SMART standard, and you may need additional proprietary documentation to understand it.</p>&#13;
<p class="programs">...<br/>Current Temperature:                    31 Celsius<br/>Power Cycle Min/Max Temperature:     22/31 Celsius<br/>Lifetime    Min/Max Temperature:     20/41 Celsius<br/>Under/Over Temperature Limit Count:   0/0<br/>Vendor specific:<br/>01 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00<br/>00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00<br/>...</p>&#13;
<p class="indent">Some SMART-capable drives maintain a log of temperature history. You can calculate the history from the interval multiplied by the history size. In this example, 478 minutes are roughly 8 hours of temperature data. Some disks have a temperature-logging interval set much higher (one hour or <span epub:type="pagebreak" id="page_117"/>more). The temperature-logging interval is potentially useful for investigations: if a disk were seized immediately after a crime, known temperature variations might be correlated with the disk temperature record.</p>&#13;
<p class="programs">...<br/>SCT Temperature History Version:     2<br/>Temperature Sampling Period:         1 minute<br/>Temperature Logging Interval:        1 minute<br/>Min/Max recommended Temperature:      0/60 Celsius<br/>Min/Max Temperature Limit:           -41/85 Celsius<br/>Temperature History Size (Index):    478 (175)<br/><br/>Index    Estimated Time   Temperature Celsius<br/> 176    2016-01-07 05:00     ?  -<br/> ...    ..(300 skipped).    ..  -<br/> 477    2016-01-07 10:01     ?  -<br/>   0    2016-01-07 10:02    29  **********<br/>   1    2016-01-07 10:03    30  ***********<br/> ...    ..( 68 skipped).    ..  ***********<br/>  70    2016-01-07 11:12    30  ***********<br/>  71    2016-01-07 11:13    31  ************<br/> ...    ..(103 skipped).    ..  ************<br/> 175    2016-01-07 12:57    31  ************<br/>...</p>&#13;
<p class="indent">The final section of output in this example shows statistics of physical errors. It can be useful to compare these statistics with values during or at the end of an acquisition to ensure no physical errors arose during the process.</p>&#13;
<p class="programs">...<br/>SCT Error Recovery Control command not supported<br/><br/>Device Statistics (GP/SMART Log 0x04) not supported<br/><br/>SATA Phy Event Counters (GP Log 0x11)<br/>ID      Size     Value  Description<br/>0x0001  2            0  Command failed due to ICRC error<br/>0x0002  2            0  R_ERR response for data FIS<br/>0x0003  2            0  R_ERR response for device-to-host data FIS<br/>0x0004  2            0  R_ERR response for host-to-device data FIS<br/>0x0005  2            0  R_ERR response for non-data FIS<br/>0x0006  2            0  R_ERR response for device-to-host non-data FIS<br/>0x0007  2            0  R_ERR response for host-to-device non-data FIS<br/>0x0008  2            0  Device-to-host non-data FIS retries<br/>0x0009  2            6  Transition from drive PhyRdy to drive PhyNRdy<br/>0x000a  2            6  Device-to-host register FISes sent due to a COMRESET<br/>0x000b  2            0  CRC errors within host-to-device FIS<br/>0x000f  2            0  R_ERR response for host-to-device data FIS, CRC<br/>0x0012  2            0  R_ERR response for host-to-device non-data FIS, CRC<br/>0x8000  4        14532  Vendor specific</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_118"/>Other SMART logs might exist depending on the drive vendor. Consult the smartctl(8) manual page for more information about additional flags and queries that you can send to attached subject drives.</p>&#13;
<h3 class="h3" id="ch05lev1sec04"><strong>Enable Access to Hidden Sectors</strong></h3>&#13;
<p class="noindent">Forensic literature often includes handling the HPA and DCO as part of the imaging process. Indeed, some imaging software has the capability to detect and remove these hidden areas at acquisition time. This book positions the detection and removal of the HPA/DCO as part of the preparation process, not the actual imaging. There is no special technique to image these hidden areas once they’ve been made accessible. They’re simply disk sectors protected by drive configuration parameters. It is a simple preparatory step to make them available for a subsequent imaging process. Removing the HPA or DCO modifies the drive’s configuration, but it does not modify its contents.<sup><a id="fn_24" href="footnote.xhtml#fn24">3</a></sup></p>&#13;
<p class="indent">This section also covers drive maintenance sectors and service areas on a disk, but this topic is mentioned only briefly, because these areas are not easily accessible using common open source tools.</p>&#13;
<h4 class="h4" id="ch05lev2sec08"><em><strong>Remove a DCO</strong></em></h4>&#13;
<p class="noindenta">The DCO was developed to allow PC system manufacturers to make different drive models appear to have the same features. Using a DCO, certain features can be disabled, and the capacity of a drive (number of usable sectors) can be reduced to fit a vendor’s requirements. Identifying and removing the DCO is standard forensic practice when you’re analyzing a suspect drive.</p>&#13;
<p class="indent">The DCO is a general configuration overlay, and multiple features can be overridden. It does not only refer to the number of sectors on a drive.</p>&#13;
<p class="indent">Two hdparm commands can determine if a DCO exists and provide the number of real sectors available. The first command determines if the drive has the DCO feature set enabled. In this example, the current size of the disk is reported to be 474GB or 926773168 sectors (512-byte sector size) and the asterisk (<span class="literal"><sub>*</sub></span>) next to <span class="literal">Device Configuration Overlay feature set</span> indicates it is active:</p>&#13;
<p class="programs"># <strong>hdparm -I /dev/sdl</strong><br/><br/>/dev/sdl:<br/>ATA device, with non-removable media<br/>       Model Number:        WDC WD5003AZEX-00MK2A0<br/>...<br/>       LBA48  user addressable sectors:  926773168<br/>       Logical  Sector size:                   512 bytes<br/>       Physical Sector size:                  4096 bytes<br/>       device size with M = 1024*1024:      452525 MBytes<br/>       device size with M = 1000*1000:      474507 MBytes (474 GB)<br/>...<br/>          * Device Configuration Overlay feature set<br/>...</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_119"/>The second command specifically queries for the features modified by a DCO:</p>&#13;
<p class="programs"># <strong>hdparm --dco-identify /dev/sdl</strong><br/><br/>/dev/sdl:<br/>DCO Revision: 0x0002<br/>The following features can be selectively disabled via DCO:<br/>        Transfer modes:<br/>                 udma0 udma1 udma2 udma3 udma4 udma5 udma6<br/>        Real max sectors: 976773168<br/>        ATA command/feature sets:<br/>                 security HPA<br/>        SATA command/feature sets:<br/>                 NCQ interface_power_management SSP</p>&#13;
<p class="indent">In this example, “Real max sectors” is 976773168, which is 25GB less than the reported size, indicating the existence of a DCO. The reported size of 474GB is also a mismatch to the 500GB label on the physical drive. You can confirm the expected number of sectors by checking the drive model number with the vendor’s product documentation.</p>&#13;
<p class="indent">Having confirmed the existence of a DCO using hdparm, you can use the same command to remove it. First, run <span class="literal"><span class="codestrong">hdparm</span></span> to ensure the drive configuration is not locked or frozen:</p>&#13;
<p class="programs"># <strong>hdparm -I /dev/sdl</strong><br/><br/>/dev/sdl:<br/><br/>ATA device, with non-removable media<br/>        Model Number:       WDC WD5003AZEX-00MK2A0<br/>...<br/>Security:<br/>...<br/>        not   locked<br/>        not   frozen<br/>...</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_120"/>Some BIOSes or OSes will issue an ATA command to freeze the DCO configuration during boot to prevent malicious changes. In this case, hot plugging the drive power cable after booting should cause the drive to spin up in an unfrozen state.<sup><a id="fn_25" href="footnote.xhtml#fn25">4</a></sup> Many USB bridges automatically spin up an attached disk in an unfrozen state. If the drive is locked, refer to “<a href="ch05.xhtml#ch05lev2sec11">Identify and Unlock ATA Password-Protected Disks</a>” on <a href="ch05.xhtml#page_126">page 126</a>.</p>&#13;
<p class="indent">Once the drive is ready, you can send the appropriate ATA command to reset the DCO, making the additional hidden sectors available.</p>&#13;
<p class="indent">Simply running the <span class="literal">hdparm</span> command with the <span class="literal">--dco-restore</span> option will do nothing but generate a warning message:</p>&#13;
<p class="programs"># <strong>hdparm --dco-restore /dev/sdl</strong><br/><br/>/dev/sdl:<br/>Use of --dco-restore is VERY DANGEROUS.<br/>You are trying to deliberately reset your drive configuration back to the factory<br/>    defaults.<br/>This may change the apparent capacity and feature set of the drive, making all data<br/>    on it inaccessible.<br/>You could lose *everything*.<br/>Please supply the --yes-i-know-what-i-am-doing flag if you really want this.<br/>Program aborted.</p>&#13;
<p class="indent">Following the instructions, and including the <span class="literal">--yes-i-know-what-i-am-doing</span> flag, you can remove the DCO as follows:</p>&#13;
<p class="programs"># <strong>hdparm --yes-i-know-what-i-am-doing --dco-restore /dev/sdl</strong><br/><br/>/dev/sdl:<br/>issuing DCO restore command</p>&#13;
<p class="indent">Now when you run the <span class="literal">hdparm -I</span> command again, the full sectors will be revealed.</p>&#13;
<p class="programs"># <strong>hdparm -I /dev/sdl</strong><br/><br/>/dev/sdl:<br/><br/>ATA device, with non-removable media<br/>        Model Number:       WDC WD5003AZEX-00MK2A0<br/>...<br/>        LBA48  user addressable sectors:  976773168<br/>        Logical  Sector size:                   512 bytes<br/>        Physical Sector size:                  4096 bytes<br/>        device size with M = 1024*1024:      476940 MBytes<br/>        device size with M = 1000*1000:      500107 MBytes (500 GB)<br/>...</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_121"/>Now you can acquire the drive or analyze it with forensic tools. It’s important to note the DCO hidden area’s exact sector offset, which will be useful when you want to extract only the DCO sectors for separate analysis.</p>&#13;
<p class="indent">Removing the DCO using <span class="literal">hdparm</span> can be tricky. Read the hdparm(8) manual page if a particular drive is causing problems with the removal commands.</p>&#13;
<p class="indent">The tableau-parm tool has an <span class="literal">-r</span> flag that should remove the DCO (and possibly the HPA) from the drive.</p>&#13;
<h4 class="h4" id="ch05lev2sec09"><em><strong>Remove an HPA</strong></em></h4>&#13;
<p class="noindenta">The HPA was developed to allow PC system manufacturers to store data in a way that is normally inaccessible to a customer. Examples of HPA uses include diagnostic tools, recovery partitions, and so on. These special areas are often activated with BIOS hotkeys during startup.</p>&#13;
<p class="indent">You can detect the existence of an HPA using a single <span class="literal">hdparm</span> command:</p>&#13;
<p class="programs"># <strong>hdparm -N /dev/sdl</strong><br/><br/>/dev/sdl:<br/> max sectors   = 879095852/976773168, HPA is enabled</p>&#13;
<p class="indent">Here <span class="literal">HPA is enabled</span> indicates that an HPA exists. The <span class="literal">max sectors</span> provides the visible sector count followed by the real sector count. In this example, subtracting the two sector counts reveals a 50GB difference, which is the host protected area.</p>&#13;
<p class="indent">You can temporarily remove the HPA using the same command (as with the DCO removal, a warning message appears, and you need to use the <span class="literal">--yes-i-know-what-i-am-doing</span> flag):</p>&#13;
<p class="programs"># <strong>hdparm --yes-i-know-what-i-am-doing -N 976773168 /dev/sdl</strong><br/><br/>/dev/sdl:<br/> setting max visible sectors to 976773168 (temporary)<br/> max sectors   = 976773168/976773168, HPA is disabled</p>&#13;
<p class="indent">The result of this command is only temporary; the original HPA will be in place next time you cycle the drive’s power. To make the change permanent, add <span class="literal">p</span> to the sector count number as follows:</p>&#13;
<p class="programs"># <strong>hdparm --yes-i-know-what-i-am-doing -N p976773168 /dev/sdl</strong><br/><br/>/dev/sdl:<br/> setting max visible sectors to 976773168 (permanent)<br/> max sectors   = 976773168/976773168, HPA is disabled</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_122"/>The HPA is now removed, and you can acquire the drive or analyze it with forensic tools. It’s important to note the HPA hidden area’s exact sector offset, which will be useful when you want to extract only the HPA sectors for separate analysis.</p>&#13;
<p class="indent">Removing the HPA with hdparm can be tricky. Read the hdparm(8) manual page if a particular drive is causing problems with the removal commands.</p>&#13;
<p class="indent">Previously, the Sleuth Kit forensic suite had two utilities to detect and temporarily remove the HPA: disk_stat and disk_sreset. These were removed in 2009 because other tools, such as hdparm, included the same features.</p>&#13;
<h4 class="h4" id="ch05lev2sec10"><em><strong>Drive Service Area Access</strong></em></h4>&#13;
<p class="noindenta">Hard disk drives need to store information such as SMART logs, ATA passwords, bad sector lists, firmware, and other persistent information. This information is typically stored on the disk platters in reserved, user-inaccessible sectors called the <em>system area</em> (also known as the <em>service area</em>, <em>negative sectors</em>, or <em>maintenance sectors</em>). Access to this area is done through proprietary vendor commands, which are usually not public.</p>&#13;
<p class="indent">There is no common systematic approach to access a disk’s system areas. Each disk manufacturer implements system areas differently, there are no industry standards, and there are few publicly available tools. Some specialized commercial tools exist, such as Ace Laboratory’s PC-3000 (<em><a href="http://www.acelaboratory.com/catalog/">http://www.acelaboratory.com/catalog/</a></em>) or Atola Insight Forensic (<em><a href="http://www.atola.com/products/insight/supported-drives.html">http://www.atola.com/products/insight/supported-drives.html</a></em>), which can access service areas of many disks.<sup><a id="fn_26" href="footnote.xhtml#fn26">5</a>, <a id="fn_27" href="footnote.xhtml#fn27">6</a></sup></p>&#13;
<p class="indent">In some cases, it’s possible to bypass the standard SATA, USB, or SAS interfaces and access storage media using debug or diagnostic ports built into the drive electronics. These interfaces may use serial RS-232/TTL, JTAG for chip access,<sup><a id="fn_28" href="footnote.xhtml#fn28">7</a></sup> or undocumented vendor proprietary commands over the regular drive interface. Media access in this manner is not standard across manufacturers or even across drives from the same manufacturer.</p>&#13;
<p class="indent">For illustration purposes, the following example shows reading information over a serial interface on a Seagate Barracuda ST500DM002 drive. The drive has a serial port next to the SATA data plug and can be accessed with a USB 3V TTL cable. Standard serial terminal emulation software such as the Linux <span class="literal">cu</span> (connect UNIX) command is used in this example.</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_123"/><a href="ch05.xhtml#ch5fig1">Figure 5-1</a> shows a photo of the USB cable connected to the pin block at the back of the drive.</p>&#13;
<div class="image"><img src="../images/f05-01.jpg" alt="image"/></div>&#13;
<p class="figcap"><a id="ch5fig1"/><em>Figure 5-1: Serial port access to disk firmware</em></p>&#13;
<div class="note">&#13;
<p class="notet"><strong>NOTE</strong></p>&#13;
<p class="notep"><em><strong>Warning:</strong> This method should not be used without specialized training or tools. There is a risk of physically damaging the disk beyond repair.</em></p>&#13;
</div>&#13;
<p class="indent">After connecting a terminal and powering on the drive, a boot message is displayed. Entering <small>CTRL</small>-Z puts the drive in diagnostic mode with a command prompt from the drive firmware (similar to UNIX terminals or analog modems).</p>&#13;
<p class="programs">$ <strong>cu -s 38400 -l /dev/ttyUSB0</strong><br/>Connected.<br/><br/>Boot 0x10M<br/> Spin Up[0x00000000][0x0000B67C][0x0000BA10]<br/> Trans.<br/><br/>Rst 0x10M<br/> MC Internal LPC Process<br/> Spin Up<br/>(P) SATA Reset<br/><br/>ASCII Diag mode<br/><br/>F3 T&gt;</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_124"/>From thisdiagnostic interface, detailed underlying information about the disk can be retrieved. In the following example, a Level 2 <span class="literal">x</span> command reveals the internal physical drive geometry and partitioning for User and System areas:</p>&#13;
<p class="programs">F3 2&gt;x<br/><br/>User Partition<br/><br/> LBAs 000000000000-0000075D672E<br/> PBAs 000000000000-0000076F8EDD<br/> HdSkew 006E, CylSkew 002D<br/> ZonesPerHd 11<br/><br/> Head 0, PhyCyls 000000-040001, LogCyls 000000-03F19C<br/><br/>     Physical      Logical       Sec   Sym   Sym      Data<br/>  Zn Cylinders     Cylinders     Track Wedge Track    Rate<br/>  00 000000-0003FB 000000-0003FB 010F  0D77  000F4D40 1263.750<br/>  01 0003FC-005A41 0003FC-005A41 0130  0F1A  00112A40 1417.500<br/>...<br/><br/> Head 1, PhyCyls 000000-039877, LogCyls 000000-038B61<br/><br/>     Physical      Logical       Sec   Sym   Sym      Data<br/>  Zn Cylinders     Cylinders     Track Wedge Track    Rate<br/>  00 000000-00035B 000000-00035B 0130  0F16  001124A0 1415.625<br/>  01 00035C-004E72 00035C-004E72 0145  1025  00125E80 1516.875<br/>...<br/>System Partition<br/><br/> LBAs 000000000000-0000000972CF<br/> PBAs 000000000000-00000009811F<br/> HdSkew 006E, CylSkew 0018<br/> ZonesPerHd 02<br/><br/> Head 0, PhyCyls 040002-040155, LogCyls 000000-000152<br/><br/>     Physical      Logical       Sec   Sym   Sym      Data<br/>  Zn Cylinders     Cylinders     Track Wedge Track    Rate<br/>  00 040002-0400AB 000000-0000A9 0394  063D  00072AE0  592.500<br/>  01 0400AC-040155 0000AA-000152 0394  063D  00072AE0  592.500<br/><br/> Head 1, PhyCyls 039878-0399CB, LogCyls 000000-000152<br/><br/>     Physical      Logical       Sec   Sym   Sym      Data<br/>  Zn Cylinders     Cylinders     Track Wedge Track    Rate<br/>  00 039878-039921 000000-0000A9 0394  063D  00072AE0  592.500<br/>  01 039922-0399CB 0000AA-000152 0394  063D  00072AE0  592.500</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_125"/>Diagnostic interfaces, such as this one, can provide access to disk sectors in the system areas and other information that is not otherwise accessible.</p>&#13;
<p class="indent">Online forums exist that discuss low-level disk access and recovery, for example, HDDGURU (<em><a href="http://forum.hddguru.com/index.php">http://forum.hddguru.com/index.php</a></em>) and The HDD Oracle (<em><a href="http://www.hddoracle.com/index.php">http://www.hddoracle.com/index.php</a></em>).</p>&#13;
<p class="indent">Methods of accessing the underlying areas of SSD or flash storage media include the physical removal (desoldering) of memory chips, sometimes called <em>chip-off</em>. The memory contents from these chips can then be extracted and reconstructed into readable blocks of data.</p>&#13;
<p class="indent">Some devices (Internet-of-Things, mobile devices, and so on) may have a JTAG interface providing access to memory contents. JTAG is a well-documented standard and can be applied in a forensic context to extract data (see <em><a href="http://www.evidencemagazine.com/index.php?option=com_content&amp;task=view&amp;id=922">http://www.evidencemagazine.com/index.php?option=com_content&amp;task=view&amp;id=922</a></em>).</p>&#13;
<p class="indent">Covering these techniques in more depth is beyond the scope of this book. I’ve mentioned JTAG interfaces and Serial access to disks for illustration purposes to make you aware that such techniques exist in the forensics industry.</p>&#13;
<h3 class="h3" id="ch05lev1sec05"><strong>ATA Password Security and Self-Encrypting Drives</strong></h3>&#13;
<p class="noindent">This section covers the standard security features implemented by the disk vendors. These features include drive locking, password protection, self-encrypting drives, and other security mechanisms. Although some of the features discussed here are not widely used, they are still important to understand in a professional forensic lab setting.</p>&#13;
<p class="indent">Password recovery techniques are not described in detail here. The examples demonstrate how to attach password-protected media to an acquisition host in preparation for imaging. It is assumed that passwords are already known.</p>&#13;
<p class="indentb">Methods of acquiring passwords are beyond the scope of this book, but recovery techniques may include the following:</p>&#13;
<p class="bull">• Brute force, exhaustively attempting multiple passwords until the correct one is found.</p>&#13;
<p class="bull">• Finding passwords hidden or stored in an accessible location.</p>&#13;
<p class="bull">• Knowledge of password reuse across different accounts or devices. Recovery from one location provides access to all.</p>&#13;
<p class="bull">• Depending on the jurisdiction, a person may be legally compelled to provide passwords.</p>&#13;
<p class="bull">• The password may be volunteered by a friendly or cooperative owner (the victim perhaps) or a cooperating accomplice.</p>&#13;
<p class="bull">• Enterprise IT environments may have key escrow or backups in place.</p>&#13;
<h4 class="h4" id="ch05lev2sec11"><span epub:type="pagebreak" id="page_126"/><em><strong>Identify and Unlock ATA Password-Protected Disks</strong></em></h4>&#13;
<p class="noindenta">The ATA/ATAPI commands (<em><a href="http://www.t13.org/">http://www.t13.org/</a></em>) specify a security feature set that restricts access to a disk using passwords. When this feature is enabled, the firmware prevents the execution of certain ATA commands, including access to content, until the required password is provided. This is only an access control feature and doesn’t use encryption to protect data on the disk.</p>&#13;
<p class="indent">The hdparm tool can determine if a disk has the security feature set enabled. For example:</p>&#13;
<p class="programs"># <strong>hdparm -I /dev/sda</strong><br/>...<br/>Commands/features:<br/>        Enabled Supported:<br/>...<br/>           *    Security Mode feature set<br/>...<br/>Security:<br/>        Master password revision code = 1<br/>                supported<br/>                enabled<br/>                locked<br/>        not     frozen<br/>        not     expired: security count<br/>                supported: enhanced erase<br/>        Security level high<br/>        60min for SECURITY ERASE UNIT. 60min for ENHANCED SECURITY ERASE UNIT.<br/>...</p>&#13;
<p class="indent">The <span class="literal">Commands/features:</span> information indicates the <span class="literal">Security Mode feature set</span> exists and is enabled, and the <span class="literal">Security:</span> information also confirms the feature is supported and enabled.</p>&#13;
<p class="indent">If <span class="literal">Security:</span> has <span class="literal">enabled</span> listed, a user password has been set, and the drive will be locked on boot. If the drive is locked, as in the preceding example, access to the drive is prevented until a correct password is provided. The OS may generate a device error or failed command error as it tries to access the disk. The T13 standard outlines which commands are allowed when a disk is locked. Access to a number of commands, including to query SMART information, is still possible when a disk is locked.</p>&#13;
<p class="indent">Two passwords can be set, user and master. If the user password is set, security is enabled (as shown in the preceding example). Setting the master password alone does not enable security.</p>&#13;
<p class="indent">If a master password has never been set (it may still have a factory default password set), the <span class="literal">Master password revision code</span> will be set to 65534. The first time the master password is set, this value is set to 1 and incremented each time the master password is set again.</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_127"/>Two security levels control how correct passwords behave. The <span class="literal">Security level</span> refers to the <span class="literal">MASTER PASSWORD CAPABILITY</span> bit in the T13 standard and can be “high” or “maximum.” If the security level is set to high, either user or master passwords can unlock the drive. If the security level is set to maximum, the master password will allow security erase commands but only the user password can unlock the drive.</p>&#13;
<p class="indentb">Some PCs might issue a security freeze command after booting to prevent further security commands from being sent, even with correct passwords (to prevent malicious password-setting attacks). The Security output from hdparm will indicate if a drive is frozen. Many USB bridges automatically spin up an attached disk in an unfrozen state, but if you still have difficulty, here are several possibilities to try:</p>&#13;
<p class="bull">• Checking the BIOS for settings to enable/disable the freeze command</p>&#13;
<p class="bull">• Using a forensic boot CD that prevents freeze commands from being issued</p>&#13;
<p class="bull">• Attaching the disk to a separate controller card (not built into the mainboard)</p>&#13;
<p class="bull">• Hot plugging the disk into the system (if supported)</p>&#13;
<p class="bull">• Using a mainboard that does not issue freeze commands</p>&#13;
<p class="indentt">If you know the user password and the drive security is not frozen, you can unlock the drive as follows:</p>&#13;
<p class="programs"># <strong>hdparm --security-unlock "mysecret99" /dev/sdb</strong><br/>security_password="mysecret99"<br/><br/>/dev/sdb:<br/> Issuing SECURITY_UNLOCK command, password="mysecret99", user=user</p>&#13;
<p class="indent">By default, the user password is provided using hdparm, and the master password needs to be explicitly specified with an additional command line parameter. If you know the master password and the security level is set to high, you can use the master password to unlock the drive as follows:</p>&#13;
<p class="programs"># <strong>hdparm --user-master m --security-unlock "companysecret22" /dev/sdb</strong><br/>security_password="companysecret22"<br/><br/>/dev/sdb:<br/> Issuing SECURITY_UNLOCK command, password="companysecret22", user=master</p>&#13;
<p class="indent">If no passwords are known, access to the disk is not possible with regular tools. The password information is stored on the service/system areas of a disk and is generally not accessible without special hardware or tools. However, several further options are available and are discussed here.</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_128"/>The master password might be set to a factory default and can be used to gain access to the drive (if the security level is set to high and not maximum). You can easily find lists of factory default master passwords on the internet.</p>&#13;
<p class="indent">Using brute force to identify either the master or user password is inefficient, because the drive must be reset after five failed attempts. However, if you have a small set of likely passwords, multiple attempts become feasible and may lead to lucky success.</p>&#13;
<p class="indent">Specialized data recovery companies provide services and hardware tools that can recover or reset ATA Security Feature Set passwords from the service areas of a disk. Success is not guaranteed for all disks, but data recovery firms often list the disks they do support. In some cases, you might have to ship the disk to the firm’s laboratory, which may have chain-of-custody implications. See “<a href="ch05.xhtml#ch05lev2sec10">Drive Service Area Access</a>” on <a href="ch05.xhtml#page_122">page 122</a> for more information.</p>&#13;
<p class="indent">The hard disk vendor may be able to provide assistance to disable or reset the ATA password. This will depend on the cooperation of the drive vendor, the ability to prove ownership of the disk and its contents, the authority of the requesting party, and the motivation for recovering the data.</p>&#13;
<p class="indent">Hardware and firmware hacks and published methods by researchers may exist that provide access for certain hard drive models. The security research community is regularly finding innovative ways to access and modify data in hard-to-reach places.</p>&#13;
<h4 class="h4" id="ch05lev2sec12"><em><strong>Identify and Unlock Opal Self-Encrypting Drives</strong></em></h4>&#13;
<p class="noindenta"><em>Self-encrypting drives (SEDs)</em> are a form of full-disk encryption (FDE). Unlike software-based FDE (TrueCrypt, FileVault, LUKS, and so on) where the OS manages the encryption, SEDs have encryption capabilities built directly into the drive electronics and firmware. SEDs are OS agnostic and are based on vendor-independent standards. The international body responsible for defining the standard is the Trusted Computing Group (TCG; <em><a href="http://www.trustedcomputinggroup.org/">http://www.trustedcomputinggroup.org/</a></em>). The standard is the TCG Storage Security Subsystem Class: Opal, Specification Version 2.00.</p>&#13;
<p class="indent">This section identifies drives with Opal encryption and describes how appropriate keys can be used to unlock the drive. The recovery of encryption keys is outside the scope of this book. The examples shown here assume the key is known.</p>&#13;
<p class="indent">A physical examination of the drive can already indicate if it is an Opal SED. The existence of a <em>Physical Secure ID (PSID)</em> string printed on the label of the drive is shown in <a href="ch05.xhtml#ch5fig2">Figure 5-2</a>. This string is used for the Opal RevertSP feature, which generates a new key securely, destroying all data and resetting the drive to its original factory state. The PSID cannot be queried from the drive and must be physically read or scanned if a QR code exists. The existence of a PSID string does not mean the drive is locked and passwords are set; it just indicates the drive supports Opal full-disk encryption.</p>&#13;
<div class="image"><span epub:type="pagebreak" id="page_129"/><img src="../images/f05-02.jpg" alt="image"/></div>&#13;
<p class="figcap"><a id="ch5fig2"/><em>Figure 5-2: Opal SED PSID</em></p>&#13;
<p class="indent">Full-disk encryption has a chicken-and-egg problem. If an entire drive is encrypted, including the boot sector, how can the system execute the master boot record (MBR) and ask for a password or other security credentials? The solution was to implement a <em>shadow MBR</em> and store it in the system area of a disk (the same place where SMART data, bad block lists, and so on are stored). When an Opal disk is in a locked state, only the shadow MBR is visible to the host. It is a group of unencrypted sectors (can be large— 150MB in size, for example) that is executed as a normal MBR (the host is completely unaware that it is using a shadow MBR). This alternate boot area can execute code to request a password, access a Trusted Platform Module (TPM) chip or smartcard, or get other credentials. Once the disk has been unlocked, the proper MBR becomes visible, and a normal boot process can begin.</p>&#13;
<p class="indent">An open source command line tool was created to manage Opal SED encryption under Linux. Originally called msed, it was available at <em><a href="https://github.com/r0m30/msed/">https://github.com/r0m30/msed/</a></em>, but the tool was recently renamed sedutil-cli and moved to <em><a href="https://github.com/Drive-Trust-Alliance/sedutil/">https://github.com/Drive-Trust-Alliance/sedutil/</a></em>. This tool is still under development and may not work on all drives. Follow the instructions carefully and ensure that <span class="literal">libata.allow_tpm</span> is enabled in the kernel.</p>&#13;
<p class="indent">The following command scans the local system for all Opal-compliant SED drives. Out of four attached drives, one disk is detected as Opal version 2:</p>&#13;
<p class="programs"># <strong>sedutil-cli --scan</strong><br/><br/>Scanning for Opal compliant disks<br/>/dev/sda  2  Crucial_CT250MX200SSD1                 MU01<br/>/dev/sdb No  WDC WD20EZRX-00D8PB0                   80.00A80<br/>/dev/sdc No  INTEL SSDSA2CW300G3                    4PC10302<br/>/dev/sdd No  Kingston SHPM2280P2H/240G              OC34L5TA<br/>No more disks present ending scan</p>&#13;
<p class="indent">You can query the drive to find information about the Opal status, including if a disk is encrypted, locked, or has a shadow MBR (all three are shown in this example):</p>&#13;
<p class="programs"># <strong>sedutil-cli --query /dev/sda</strong><br/><br/>/dev/sda ATA Crucial_CT250MX200SSD1                  MU01             15030E69A241<br/>...<br/>Locking function (0x0002)<br/>   Locked = Y, LockingEnabled = Y, LockingSupported = Y, MBRDone = N,<br/>   MBREnabled = Y, MediaEncrypt = Y<br/>...</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_130"/>Two commands can be issued: one to disable locking and the second to inform the disk that the shadow MBR is not needed (MBR is “Done”). In this example, <em>xxmonkey</em> is the password:</p>&#13;
<p class="programs"># <strong>sedutil-cli --disableLockingRange 0 xxmonkey /dev/sda</strong><br/>- 16:33:34.480 INFO: LockingRange0 disabled<br/># <strong>sedutil-cli --setMBRDone on xxmonkey /dev/sda</strong><br/>- 16:33:54.341 INFO: MBRDone set on</p>&#13;
<p class="indent">At this point, a kernel message (dmesg) might show a change in available devices. The status in this example now shows the following:</p>&#13;
<p class="programs"># <strong>sedutil-cli --query /dev/sda</strong><br/><br/>/dev/sda ATA Crucial_CT250MX200SSD1                   MU01             15030E69A241<br/>...<br/>Locking function (0x0002)<br/>    Locked = N, LockingEnabled = Y, LockingSupported = Y, MBRDone = Y,<br/>    MBREnabled = Y, MediaEncrypt = Y<br/>...</p>&#13;
<p class="indent">The drive is no longer locked, and the shadow MBR is no longer visible. The proper MBR and the rest of the decrypted disk are available, and they can be accessed with regular forensic tools. Now the partition table of a Linux installation becomes visible, as shown in this example:</p>&#13;
<p class="programs"># <strong>mmls /dev/sda</strong><br/>DOS Partition Table<br/>Offset Sector: 0<br/>Units are in 512-byte sectors<br/><br/>     Slot    Start        End          Length       Description<br/>00:  Meta    0000000000   0000000000   0000000001   Primary Table (#0)<br/>01:  -----   0000000000   0000002047   0000002048   Unallocated<br/>02:  00:00   0000002048   0471887871   0471885824   Linux (0x83)<br/>03:  -----   0471887872   0471889919   0000002048   Unallocated<br/>04:  Meta    0471889918   0488396799   0016506882   DOS Extended (0x05)<br/>05:  Meta    0471889918   0471889918   0000000001   Extended Table (#1)<br/>06:  01:00   0471889920   0488396799   0016506880   Linux Swap / Solaris x86 (0x82)<br/>07:  -----   0488396800   0488397167   0000000368   Unallocated</p>&#13;
<p class="indent">A locked drive that has no shadow MBR enabled will produce multiple error messages in the kernel dmesg output.</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_131"/>The simple example described in this section was provided for illustration purposes only. Some Opal disks may behave differently with this tool. In real scenarios, the key might not be a simple password but instead be tied to the TPM or some other enterprise security mechanism. If the wrong commands are given in this situation, the data on the disk can be irrevocably destroyed (in an instant if the key is destroyed).</p>&#13;
<p class="indent">From a forensics perspective, it may be useful to image the shadow MBR for analysis as well. It could contain interesting artifacts from the time the disk encryption was set up. It is also conceivable that data could be hidden in the shadow MBR region of Opal-capable drives.</p>&#13;
<h4 class="h4" id="ch05lev2sec13"><em><strong>Encrypted Flash Thumb Drives</strong></em></h4>&#13;
<p class="noindenta">USB thumb drives sold as “secure” devices often come with a proprietary software encryption solution provided by the vendor. Some drives offer OS-independent encryption with authentication using keypads, fingerprint readers, or smartcards (see <a href="ch05.xhtml#ch5fig3">Figure 5-3</a>).</p>&#13;
<div class="image"><img src="../images/f05-03.jpg" alt="image"/></div>&#13;
<p class="figcap"><a id="ch5fig3"/><em>Figure 5-3: Encrypted USB sticks</em></p>&#13;
<p class="indent">Proprietary solutions might not have a compatible tool to manage access, making it difficult to acquire decrypted data with Linux. Devices with an onboard authentication mechanism should appear as a normal USB storage device after authentication.</p>&#13;
<p class="indent">Secure thumb drives that are locked may behave differently when attached to a host. Some don’t provide any indication that they’ve been plugged into the host. Some appear as a removable media device without media (like a memory card reader). Some will appear as a CD-ROM and have software available to run or install, which manages the drive.</p>&#13;
<p class="indent">Larger hardware-encrypted external drives also exist and may require a pin to unlock. An example of such a drive is described in <a href="ch07.xhtml#ch07">Chapter 7</a> (see <a href="ch07.xhtml#ch7fig1">Figure 7-1</a> on <a href="ch07.xhtml#page_216">page 216</a>).</p>&#13;
<h3 class="h3" id="ch05lev1sec06"><span epub:type="pagebreak" id="page_132"/><strong>Attach Removable Media</strong></h3>&#13;
<p class="noindent">This section covers the attachment of devices that use removable storage media. The most common examples of removable media are optical discs, memory cards, and magnetic tapes. In a way, attaching removable storage media to an acquisition host occurs twice. First the device electronics are attached, and then in an additional step, the removable media is inserted. Let’s begin with a discussion on optical media drives.</p>&#13;
<h4 class="h4" id="ch05lev2sec14"><em><strong>Optical Media Drives</strong></em></h4>&#13;
<p class="noindenta">Optical drives are typically attached internally via SATA or externally via USB. The drives appear in the Linux device tree but without media. Running forensic commands on an empty drive produces obvious results, as shown here:</p>&#13;
<p class="programs"># <strong>mmls /dev/cdrom</strong><br/>Error opening image file (raw_open: file "/dev/cdrom" - No medium found)</p>&#13;
<p class="indent">Two useful commands provide information about the attached drive and inserted discs. The <span class="literal">cd-drive</span> command provides details about an attached optical drive (internal or external), including various features, supported media, and so on:</p>&#13;
<p class="programs"># <strong>cd-drive</strong><br/>cd-drive version 0.83 x86_64-pc-linux-gnu<br/>...<br/>CD-ROM drive supports MMC 3<br/><br/>                       Drive: /dev/cdrom<br/>Vendor                      : ASUS<br/>Model                       : BW-16D1HT<br/>Revision                    : 1.01<br/>Profile List Feature<br/>        Blu Ray BD-RE<br/>        Blu Ray BD-R random recording<br/>        Blu Ray BD-R sequential recording<br/>        Blu Ray BD-ROM<br/>        DVD+R Double Layer - DVD Recordable Double Layer<br/>        DVD+R - DVD Recordable<br/>        DVD+RW - DVD Rewritable<br/>        DVD-R - Double-layer Jump Recording<br/>        DVD-R - Double-Layer Sequential Recording<br/>        Re-recordable DVD using Sequential Recording<br/>        Re-recordable DVD using Restricted Overwrite<br/>        Re-writable DVD<br/>        Re-recordable DVD using Sequential recording<br/>        Read only DVD<br/>        CD-RW Re-writable Compact Disc capable<br/>        Write once Compact Disc capable<br/>        Read only Compact Disc capable<br/>...<br/>Removable Medium Feature<br/>        Tray type loading mechanism<br/>        can eject the medium or magazine via the normal START/STOP command<br/>        can be locked into the Logical Unit<br/>...</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_133"/>When you insert a disc into the drive, you can retrieve information about the media using the <span class="literal">cd-info</span> command. The result includes the mode, format, and information about the publisher:</p>&#13;
<p class="programs"># <strong>cd-info</strong><br/>cd-info version 0.83 x86_64-pc-linux-gnu<br/>Disc mode is listed as: CD-DA<br/>CD-ROM Track List (1 - 1)<br/>  #: MSF       LSN    Type   Green? Copy? Channels Premphasis?<br/>  1: 00:02:00  000000 data   false  no<br/>170: 39:42:20  178520 leadout (400 MB raw, 400 MB formatted)<br/>Media Catalog Number (MCN): 0000000000000<br/>TRACK  1 ISRC: 000000000000<br/>Last CD Session LSN: 0<br/>audio status: invalid<br/>__________________________________<br/>CD Analysis Report<br/>CD-ROM with ISO 9660 filesystem<br/>ISO 9660: 154301 blocks, label `SOLARIS_2_5_1_SPARC '<br/>Application: NOT SPECIFIED<br/>Preparer   : SOLARIS_PRODUCT_ENGINEERING<br/>Publisher  : SUNSOFT_INC<br/>System     : SUNSOFT_INC<br/>Volume     : SOLARIS_2_5_1_SPARC<br/>Volume Set : SOLARIS_2_5_1_SERIES</p>&#13;
<p class="indent">You can eject the optical media using the <span class="literal">eject</span> shell command.</p>&#13;
<p class="indent">Using write blockers on optical drives is unnecessary. No timestamps are updated simply by accessing files on a disc. Modifying an optical disc requires explicit burn instructions, reducing the risk of accidental modification.</p>&#13;
<h4 class="h4" id="ch05lev2sec15"><em><strong>Magnetic Tape Drives</strong></em></h4>&#13;
<p class="noindenta">You can determine a list of attached tape drives using the lshw tool and the tape class. The output provides information about the drive vendor, serial number, and device information.</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_134"/>In this example, two tape drives are found (LTO and DAT):</p>&#13;
<p class="programs"># <strong>lshw -class tape</strong><br/>  *-tape<br/>       description: SCSI Tape<br/>       product: LTO-5 HH<br/>       vendor: TANDBERG<br/>       physical id: 0.0.0<br/>       bus info: scsi@13:0.0.0<br/>       logical name: /dev/nst0<br/>       version: Y629<br/>       serial: HU1246T99F<br/>       capabilities: removable<br/>       configuration: ansiversion=6<br/>  *-tape<br/>       description: SCSI Tape<br/>       product: DAT160<br/>       vendor: HP<br/>       physical id: 0.0.0<br/>       bus info: scsi@15:0.0.0<br/>       logical name: /dev/nst1<br/>       version: WU8A<br/>       serial: HU10123NFH<br/>       capabilities: removable<br/>       configuration: ansiversion=3</p>&#13;
<p class="indent">Magnetic tape drives are typically SCSI devices, which you can query using standard SCSI commands. The standard tool for controlling tapes is mt, which provides information about the drive status, controls the position of the tape, and ejects the media. The mt tool can provide basic information about the tape, but the tapeinfo tool is more comprehensive. In this example, the mt and tapeinfo tools query the status of an LTO tape drive with a loaded tape:</p>&#13;
<p class="programs"># <strong>mt -f /dev/nst0 status</strong><br/>SCSI 2 tape drive:<br/>File number=1, block number=0, partition=0.<br/>Tape block size 0 bytes. Density code 0x58 (no translation).<br/>Soft error count since last status=0<br/>General status bits on (81010000):<br/> EOF ONLINE IM_REP_EN<br/><br/># <strong>tapeinfo -f /dev/nst0</strong><br/>Product Type: Tape Drive<br/>Vendor ID: 'TANDBERG'<br/>Product ID: 'LTO-5 HH         '<br/>Revision: 'Y629'<br/>Attached Changer API: No<br/>SerialNumber: 'HU1246T99F'<br/>MinBlock: 1<br/>MaxBlock: 16777215<br/>SCSI ID: 0<br/>SCSI LUN: 0<br/>Ready: yes<br/>BufferedMode: yes<br/>Medium Type: Not Loaded<br/>Density Code: 0x58<br/>BlockSize: 0<br/>DataCompEnabled: yes<br/>DataCompCapable: yes<br/>DataDeCompEnabled: yes<br/>CompType: 0x1<br/>DeCompType: 0x1<br/>Block Position: 166723430<br/>Partition 0 Remaining Kbytes: 1459056<br/>Partition 0 Size in Kbytes: 1459056<br/>ActivePartition: 0<br/>EarlyWarningSize: 0<br/>NumPartitions: 0<br/>MaxPartitions: 1</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_135"/>The tape head is positioned at the second file on the tape (file 1 is after file 0). The block offset and file offset are useful when you’re forensically acquiring individual files from a tape.</p>&#13;
<p class="indent">Using mt, you can rewind tapes and take them offline (eject them):</p>&#13;
<p class="programs"># <strong>mt -f /dev/nst0 status</strong></p>&#13;
<p class="indent">When a tape device is attached to a Linux system, a number of corresponding devices are created.</p>&#13;
<p class="programs"># <strong>ls -1 /dev/*st0*</strong><br/>/dev/nst0<br/>/dev/nst0a<br/>/dev/nst0l<br/>/dev/nst0m<br/>/dev/st0<br/>/dev/st0a<br/>/dev/st0l<br/>/dev/st0m</p>&#13;
<p class="indent">The <span class="literal">st*</span> devices auto-rewind the tape after each command (which is not always desired), and the <span class="literal">nst*</span> devices are the nonrewinding devices. The <span class="literal">a</span>, <span class="literal">l</span>, and <span class="literal">m</span> characters represent the same device but with different characteristics (block size, compression). When you’re performing a forensic acquisition, you should use the <span class="literal">nst<sub>*</sub></span> devices (without an additional <span class="literal">a</span>, <span class="literal">l</span>, or <span class="literal">m</span> character).</p>&#13;
<h4 class="h4" id="ch05lev2sec16"><span epub:type="pagebreak" id="page_136"/><em><strong>Memory Cards</strong></em></h4>&#13;
<p class="noindenta">Memory cards typically attach to a host using a USB adapter with multiple slots for different types of memory cards. When attached, the adapter creates a removable SCSI device for each slot (even when the slots are empty). This behavior can be observed in the following dmesg output.</p>&#13;
<p class="programs">[ 2175.331711] usb 1-7: new high-speed USB device number 10 using xhci_hcd<br/>[ 2175.461244] usb 1-7: New USB device found, idVendor=058f, idProduct=6362<br/>[ 2175.461249] usb 1-7: New USB device strings: Mfr=1, Product=2, SerialNumber=3<br/>[ 2175.461252] usb 1-7: Manufacturer: Generic<br/>[ 2175.461938] usb-storage 1-7:1.0: USB Mass Storage device detected<br/>[ 2175.462143] scsi host15: usb-storage 1-7:1.0<br/>[ 2176.458662] scsi 15:0:0:0: Direct-Access     Generic  USB SD Reader    1.00<br/>    PQ: 0 ANSI: 0<br/>[ 2176.459179] scsi 15:0:0:1: Direct-Access     Generic  USB CF Reader    1.01<br/>    PQ: 0 ANSI: 0<br/>[ 2176.459646] scsi 15:0:0:2: Direct-Access     Generic  USB SM Reader    1.02<br/>    PQ: 0 ANSI: 0<br/>[ 2176.460089] scsi 15:0:0:3: Direct-Access     Generic  USB MS Reader    1.03<br/>    PQ: 0 ANSI: 0<br/>[ 2176.460431] sd 15:0:0:0: Attached scsi generic sg11 type 0<br/>[ 2176.460641] sd 15:0:0:1: Attached scsi generic sg12 type 0<br/>[ 2176.460863] sd 15:0:0:2: Attached scsi generic sg13 type 0<br/>[ 2176.461150] sd 15:0:0:3: Attached scsi generic sg14 type 0<br/>[ 2176.463711] sd 15:0:0:0: [sdj] Attached SCSI removable disk<br/>[ 2176.464510] sd 15:0:0:1: [sdk] Attached SCSI removable disk<br/>[ 2176.464944] sd 15:0:0:2: [sdl] Attached SCSI removable disk<br/>[ 2176.465339] sd 15:0:0:3: [sdm] Attached SCSI removable disk</p>&#13;
<p class="indent">As you insert media into the slots, the media is made available as a USB mass storage device with a linear sequence of “sectors,” which you can forensically acquire. Continuing on from the previous example, a memory card has now been inserted into a slot of the card reader and appears as block device:</p>&#13;
<p class="programs">[ 2310.750147] sd 15:0:0:0: [sdj] 7959552 512-byte logical blocks: (4.07 GB/3.79 GiB)<br/>[ 2310.753162]  sdj: sdj1</p>&#13;
<p class="indent">Hardware-querying tools, such as hdparm and smartctl, may produce unreliable results, because memory cards don’t have the ATA features of more complex drives with dedicated drive circuitry.</p>&#13;
<h3 class="h3" id="ch05lev1sec07"><strong>Attach Other Storage</strong></h3>&#13;
<p class="noindent">Sometimes storage media is attached to a forensic acquisition host and behaves in a unique way. In particular, it is useful to know about special behavior with portable devices, Apple computer systems, and NVME drives.</p>&#13;
<h4 class="h4" id="ch05lev2sec17"><span epub:type="pagebreak" id="page_137"/><em><strong>Apple Target Disk Mode</strong></em></h4>&#13;
<p class="noindenta">TDM allows Apple computers with OpenBoot firmware or newer firmware to boot into a state where the Mac system appears as an external disk enclosure and the internal disks are available as SCSI target devices. Earlier TDM implementations used the FireWire bus but have since moved to Thunderbolt. You activate this mode by holding down the T key while powering on the Apple computer.</p>&#13;
<p class="indent">A Linux machine without a Thunderbolt adapter can use FireWire to achieve the same result with an adapter. <a href="ch05.xhtml#ch5fig4">Figure 5-4</a> shows a photo of a Thunderbolt-to-FireWire adapter.</p>&#13;
<div class="image"><img src="../images/f05-04.jpg" alt="image"/></div>&#13;
<p class="figcap"><a id="ch5fig4"/><em>Figure 5-4: Thunderbolt to Firewire adapter</em></p>&#13;
<p class="indent">Be sure to boot the Apple device (while holding the T key) with the Thunderbolt-to-FireWire adapter already plugged in; otherwise, the Apple firmware will not use the FireWire adapter for the target device.</p>&#13;
<p class="indent">The following example shows dmesg output of an Apple notebook in TDM that is connected to a Linux machine using a Thunderbolt to FireWire adapter (Thunderbolt on the Apple; FireWire on the Linux machine):</p>&#13;
<p class="programs">[  542.964313] scsi host10: SBP-2 IEEE-1394<br/>[  542.964404] firewire_core 0000:0e:00.0: created device fw1: GUID<br/>    000a27020064d0ef, S800<br/>[  543.163093] firewire_sbp2 fw1.0: logged in to LUN 0000 (0 retries)<br/>[  543.163779] scsi 10:0:0:0: Direct-Access-RBC AAPL     FireWire Target 0000<br/>    PQ: 0 ANSI: 3<br/>[  543.164226] sd 10:0:0:0: Attached scsi generic sg10 type 14<br/>[  543.165006] sd 10:0:0:0: [sdj] 236978176 512-byte logical blocks:<br/>    (121 GB/113 GiB)<br/>[  543.165267] sd 10:0:0:0: [sdj] Write Protect is off<br/>[  543.165271] sd 10:0:0:0: [sdj] Mode Sense: 10 00 00 00<br/>[  543.165759] sd 10:0:0:0: [sdj] Write cache: enabled, read cache: enabled,<br/>    doesn't support DPO or FUA<br/>[  543.171533] sdj: sdj1 sdj2 sdj3<br/>[  543.173479] sd 10:0:0:0: [sdj] Attached SCSI disk</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_138"/>PC-based Linux systems with Thunderbolt ports are not common, and Linux kernel support is still under development. As an alternative, you can boot recent Apple computers with a forensic boot CD/USB device and acquire them to a locally attached evidence drive.</p>&#13;
<h4 class="h4" id="ch05lev2sec18"><em><strong>NVME SSDs</strong></em></h4>&#13;
<p class="noindenta">NVME drives compete with SATA Express in the way they attach directly to a PCI Express bus. As of this writing, hardware write blockers for NVME drives are very new. There are hot-pluggable USB bridges for NVME and SATA Express drives from Tableau (Guidance Software). For illustration purposes, the examples shown here use an NVME device directly attached to a Linux system.</p>&#13;
<p class="indent">You can use the nvme tool from the nvme-cli software package to list the attached NVME devices:</p>&#13;
<p class="programs"># <strong>nvme list</strong><br/>Node             Model                Version  Namepace Usage                   ...<br/>---------------- -------------------- -------- -------- --------------------------<br/>/dev/nvme0n1     INTEL SSDPE2MW400G4  1.0      1        400.09  GB / 400.09  GB ...<br/>/dev/nvme1n1     Samsung SSD 950 PRO  1.1      1          3.01  GB / 256.06  GB ...<br/>...</p>&#13;
<p class="indent">You should also check each NVME drive for multiple namespaces by using the nvme tool. In this example, only a single namespace exists:</p>&#13;
<p class="programs"># <strong>nvme list-ns /dev/nvme1</strong><br/>[   0]:0x1</p>&#13;
<p class="indent">Multiple namespaces may need to be acquired individually. This is a fundamental difference from other drives where a single drive is viewed as a linear set of sectors, which you can acquire in a single pass. NVME drives with multiple namespaces will likely need special consideration.<sup><a id="fn_29" href="footnote.xhtml#fn29">8</a></sup></p>&#13;
<p class="indent">It’s important to note that the NVME standard was created from scratch without backward compatibility with SCSI or ATA standards (AHCI, and so on). It has its own command set and operates independently from other disk systems. For this reason, some tools may not work as expected with NVME hardware. Any forensic tool operating directly on low-level device drivers, such as SATA or SAS, will not work with NVME. However, if forensic tools operate on the virtual block layer, they should continue to work normally. In addition, PCI forensic write blockers may act as a bridge and <span epub:type="pagebreak" id="page_139"/>make the device appear as a SCSI device. For example, here the Sleuth Kit mmls tool is used on an NVME drive attached to the examination host:</p>&#13;
<p class="programs"># <strong>mmls /dev/nvme1n1</strong><br/>DOS Partition Table<br/>Offset Sector: 0<br/>Units are in 512-byte sectors<br/><br/>     Slot    Start        End          Length       Description<br/>00:  Meta    0000000000   0000000000   0000000001   Primary Table (#0)<br/>01:  -----   0000000000   0000002047   0000002048   Unallocated<br/>02:  00:00   0000002048   0167774207   0167772160   Linux (0x83)<br/>03:  00:01   0167774208   0335546367   0167772160   Linux (0x83)<br/>04:  00:02   0335546368   0500118191   0164571824   Linux (0x83)</p>&#13;
<p class="indent">Notice that the device is <span class="literal">nvme1n1</span> and not simply <span class="literal">nvme1</span>. The namespace of the drive must be specified when you’re using commands on NVME drives.</p>&#13;
<p class="indent">As with other drives, NVME drives have a SMART log, but you can’t access it with current versions of smartctl (as of this writing). However, you can use the nvme tool to extract the SMART log as follows:</p>&#13;
<p class="programs"># <strong>nvme smart-log /dev/nvme1</strong><br/>Smart Log for NVME device:/dev/nvme1 namespace-id:ffffffff<br/>critical_warning          : 0<br/>temperature               : 46 C<br/>available_spare           : 100%<br/>available_spare_threshold : 10%<br/>percentage_used           : 0%<br/>data_units_read           : 2,616<br/>data_units_written        : 5,874<br/>host_read_commands        : 19,206<br/>host_write_commands       : 56,145<br/>controller_busy_time      : 0<br/>power_cycles              : 34<br/>power_on_hours            : 52<br/>unsafe_shutdowns          : 17<br/>media_errors              : 0<br/>num_err_log_entries       : 7</p>&#13;
<p class="indent">The nvme tool has a number of features for querying attached NVME drives. See the nvme(1) manual page or visit <em><a href="https://github.com/linux-nvme/">https://github.com/linux-nvme/</a></em> for more information.</p>&#13;
<p class="indent">As of this writing, NVME drives are an emerging technology. Because they have numerous benefits in terms of performance and efficiency, they may become more popular in the future.</p>&#13;
<h4 class="h4" id="ch05lev2sec19"><span epub:type="pagebreak" id="page_140"/><em><strong>Other Devices with Block or Character Access</strong></em></h4>&#13;
<p class="noindenta">You can image any device that is detected as a block device by the Linux kernel. Some devices will appear as a block device the moment they are attached to the host system. For example, many generic MP3/music players, cameras, and other mobile devices behave in this manner.</p>&#13;
<p class="indent">Some devices need to be switched into a different “disk” mode before they can become accessible as a block device. Often, you can select this mode from the device’s user interface.</p>&#13;
<p class="indent">Some USB devices are multifunctional and may provide other USB modes in addition to storage. You might need to switch the mode on these devices to usb-storage before acquiring them. A Linux tool called usb_modeswitch is able to query some multifunction USB devices and switch modes.</p>&#13;
<h3 class="h3" id="ch05lev1sec08"><strong>Closing Thoughts</strong></h3>&#13;
<p class="noindent">In this chapter, you learned to attach a subject drive to an acquisition machine and positively identify the device for imaging. You learned different aspects of PC hardware (USB, PCI, block devices, and so on), how to query your acquisition system, and how to query your drive for firmware and SMART information. I demonstrated the removal of the HPA and DCO as well as various types of security built into the hardware of some drives. You are now equipped with the knowledge necessary to perform a forensic acquisition, which will be the focus of <a href="ch06.xhtml#ch06">Chapter 6</a>.</p>&#13;
</body></html>