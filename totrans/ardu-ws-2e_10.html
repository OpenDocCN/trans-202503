<html><head></head><body>
		<section>&#13;
			<header>&#13;
				<h1 class="chapter"><span class="ChapterNumber"><span epub:type="pagebreak" id="Page_203" title="203"/>11</span><br/><span class="ChapterTitle">Numeric Keypads</span></h1>&#13;
			</header>&#13;
			<p class="ChapterIntro">In this chapter you will</p>&#13;
			<ul>&#13;
				<li>Learn how to connect numeric keypads to your Arduino</li>&#13;
				<li>Read values from the keypad in a sketch</li>&#13;
				<li>&#13;
					Expand on decision systems with the <code>switch case</code> statement</li>&#13;
				<li>Create a PIN-controlled lock or switch</li>&#13;
			</ul>&#13;
			<h2 id="h1-500587c11-0001">Using a Numeric Keypad</h2>&#13;
			<p class="BodyFirst">As your projects become more involved, you might want to accept numeric input from users when your Arduino isn’t connected to a device with a keyboard. For example, you might like the ability to turn something on or off by entering a secret number. One option would be to wire up 10 or more push buttons to various digital input pins (for the numbers 0 through 9), but it’s much easier to use a numeric keypad like the one shown in <a href="#figure11-1" id="figureanchor11-1">Figure 11-1</a>.</p>&#13;
			<span epub:type="pagebreak" id="Page_204" title="204"/>&#13;
			<figure>&#13;
				<img alt="f11001" src="image_fi/500587c11/f11001.png"/>&#13;
				<figcaption>&#13;
					<p><a id="figure11-1">Figure 11-1</a>: A numeric keypad</p>&#13;
				</figcaption>&#13;
			</figure>&#13;
			<p>&#13;
				One of the benefits of using a keypad is that it uses only 8 pins for 16 active buttons, and with the use of a clever Arduino library, you won’t need to add pull-down resistors for debouncing as we did in <span class="xref" itemid="xref_target_Chapter 4">Chapter 4</span>.</p>&#13;
			<p>&#13;
				At this point, you will need to download and install the Arduino Keypad library, which is available from<em> </em><a class="LinkURL" href="https://github.com/Chris--A/Keypad/archive/master.zip">https://github.com/Chris--A/Keypad/archive/master.zip</a>.</p>&#13;
			<h3 id="h2-500587c11-0001">Wiring a Keypad</h3>&#13;
			<p class="BodyFirst">Physically wiring the keypad to the Arduino is easy. With the keypad facing up, take a look at the end of the ribbon cable. You’ll see eight female connectors in a row, as shown in <a href="#figure11-2" id="figureanchor11-2">Figure 11-2</a>.</p>&#13;
			<figure>&#13;
				<img alt="f11002" src="image_fi/500587c11/f11002.png"/>&#13;
				<figcaption>&#13;
					<p><a id="figure11-2">Figure 11-2</a>: The keypad connector</p>&#13;
				</figcaption>&#13;
			</figure>&#13;
			<p><span epub:type="pagebreak" id="Page_205" title="205"/>Reading from left to right, the sockets are numbered from 8 to 1. For all the keypad projects in this book, you’ll plug the keypad pins into the Arduino pins as shown in <a href="#table11-1" id="tableanchor11-1">Table 11-1</a>.</p>&#13;
			<figure>&#13;
				<figcaption class="TableTitle">&#13;
					<p><a id="table11-1">Table 11-1</a>: Keypad-to-Arduino Connections</p>&#13;
				</figcaption>&#13;
				<table border="1" id="table-500587c11-0001">&#13;
					<thead>&#13;
						<tr>&#13;
							<td><b>Keypad pin number</b></td>&#13;
							<td><b>Arduino pin</b></td>&#13;
						</tr>&#13;
					</thead>&#13;
					<tbody>&#13;
						<tr>&#13;
							<td>8</td>&#13;
							<td>Digital 9</td>&#13;
						</tr>&#13;
						<tr>&#13;
							<td>7</td>&#13;
							<td>Digital 8</td>&#13;
						</tr>&#13;
						<tr>&#13;
							<td>6</td>&#13;
							<td>Digital 7</td>&#13;
						</tr>&#13;
						<tr>&#13;
							<td>5</td>&#13;
							<td>Digital 6</td>&#13;
						</tr>&#13;
						<tr>&#13;
							<td>4</td>&#13;
							<td>Digital 5</td>&#13;
						</tr>&#13;
						<tr>&#13;
							<td>3</td>&#13;
							<td>Digital 4</td>&#13;
						</tr>&#13;
						<tr>&#13;
							<td>2</td>&#13;
							<td>Digital 3</td>&#13;
						</tr>&#13;
						<tr>&#13;
							<td>1</td>&#13;
							<td>Digital 2</td>&#13;
						</tr>&#13;
					</tbody>&#13;
				</table>&#13;
			</figure>&#13;
			<h3 id="h2-500587c11-0002">Programming for the Keypad</h3>&#13;
			<p class="BodyFirst">When you write a sketch for the keypad, you must include certain lines of code to enable the keypad, as identified in <a href="#listing11-1" id="listinganchor11-1">Listing 11-1</a>. The required code starts at <span aria-label="annotation1" class="CodeAnnotation">1</span> and ends at <span aria-label="annotation5" class="CodeAnnotation">5</span>.</p>&#13;
			<pre><code>// Listing 11-1<span aria-label="annotation1" class="CodeAnnotationHang">1</span> // Beginning of keypad configuration code&#13;
#include &lt;Keypad.h&gt;&#13;
const byte ROWS = 4; // set display to four rows&#13;
const byte COLS = 4; // set display to four columns<span aria-label="annotation2" class="CodeAnnotationHang">2</span> char keys[ROWS][COLS] = { {'1','2','3','A'}, {'4','5','6','B'}, {'7','8','9','C'}, {'*','0','#','D'}&#13;
};<span aria-label="annotation3" class="CodeAnnotationHang">3</span> byte rowPins[ROWS] = {9, 8, 7, 6}; <span aria-label="annotation4" class="CodeAnnotationHang">4</span> byte colPins[COLS] = {5, 4, 3, 2}; &#13;
Keypad keypad = Keypad( makeKeymap(keys), rowPins, colPins, ROWS, COLS );<span aria-label="annotation5" class="CodeAnnotationHang">5</span> // End of keypad configuration code&#13;
void setup()&#13;
{ Serial.begin(9600);&#13;
} &#13;
void loop(){<span epub:type="pagebreak" id="Page_206" title="206"/>  char key = keypad.getKey();  if (key){ Serial.print(key); }&#13;
}</code></pre>&#13;
			<p class="CodeListingCaption"><a id="listing11-1">Listing 11-1</a>: Numeric keypad demonstration sketch</p>&#13;
			<p>&#13;
				At <span aria-label="annotation2" class="CodeAnnotation">2</span>, we introduce <code>keys</code>, a char variable array that contains one or more letters, numbers, or symbols that can be generated with a computer keyboard. In this case, it contains the numbers and symbols that your Arduino can expect from the keypad.</p>&#13;
			<p>&#13;
				The lines of code at <span aria-label="annotation3" class="CodeAnnotation">3</span> and <span aria-label="annotation4" class="CodeAnnotation">4</span> define which digital pins are used on the Arduino. Using these lines and <a href="#table11-1">Table 11-1</a>, you can change the digital pins used for input if you want.</p>&#13;
			<h3 id="h2-500587c11-0003">Testing the Sketch</h3>&#13;
			<p class="BodyFirst">After uploading the sketch, open the Serial Monitor and press some keys on the keypad. The characters for the keys you pressed will be displayed in the Serial Monitor, as shown in <a href="#figure11-3" id="figureanchor11-3">Figure 11-3</a>.</p>&#13;
			<figure>&#13;
				<img alt="f11003" src="image_fi/500587c11/f11003.png"/>&#13;
				<figcaption>&#13;
					<p><a id="figure11-3">Figure 11-3</a>: The result of pressing keys on the keypad</p>&#13;
				</figcaption>&#13;
			</figure>&#13;
			<h2 id="h1-500587c11-0002">Making Decisions with switch case</h2>&#13;
			<p class="BodyFirst">When you need to compare two or more variables against another value, you’ll often find it easier and neater to use a <code>switch case</code> statement instead of an <code>if then</code> statement, because <code>switch case</code> statements can make an indefinite number of comparisons and run code when the comparison returns true. For example, if we had the integer variable <code>xx</code> with a possible value of <code>1</code>, <code>2</code>, or <code>3</code> and we wanted to run different code based on whether the value was <code>1</code>, <code>2</code>, or <code>3</code>, we could use code like the following to replace our <code>if then</code> statement:</p>&#13;
			<pre><code>switch(xx)&#13;
{ case 1: // do something when the value of xx is 1 break;  // finish and move on with sketch case 2: // do something when the value of xx is 2<span epub:type="pagebreak" id="Page_207" title="207"/>  break; case 3: // do something when the value of xx is 3 break; default: // do something if xx is not 1, 2 or 3 // default is optional&#13;
}</code></pre>&#13;
			<p>&#13;
				The optional <code>default:</code> section at the end of this code segment lets you choose to run some code when true comparisons no longer exist in the <code>switch case</code> statement.</p>&#13;
			<h2 class="HeadProject" id="h1-500587c11-0003"><span>Project #32: Creating a Keypad-Controlled Lock</span></h2>&#13;
			<p class="BodyFirst">In this project, we’ll start to create a keypad-controlled lock. We’ll use the basic setup described in the sketch in <a href="#listing11-1">Listing 11-1</a>, but we’ll also include a six-digit secret code that a user needs to enter on the keypad. The Serial Monitor will tell the user whether the code they’ve input is correct or not.</p>&#13;
			<p>&#13;
				The secret code is stored in the sketch but is not displayed to the user. The sketch will call different functions depending on whether the input code (PIN) is correct. To activate and deactivate the lock, the user must press <code>*</code> and then the secret number, followed by <code>#</code>.</p>&#13;
			<h3 id="h2-500587c11-0004">The Sketch</h3>&#13;
			<p class="BodyFirst">Enter and upload this sketch:</p>&#13;
			<pre><code>// Project 32 - Creating a Keypad-Controlled Lock&#13;
// Beginning of necessary code&#13;
#include &lt;Keypad.h&gt;&#13;
const byte ROWS = 4; // set display to four rows&#13;
const byte COLS = 4; // set display to four columns&#13;
char keys[ROWS][COLS] = { {'1','2','3','A'}, {'4','5','6','B'}, {'7','8','9','C'}, {'*','0','#','D'}&#13;
};&#13;
byte rowPins[ROWS] = {9, 8, 7, 6}; &#13;
byte colPins[COLS] = {5, 4, 3, 2}; &#13;
Keypad keypad = Keypad( makeKeymap(keys), rowPins, colPins, ROWS, COLS );&#13;
// End of necessary code<span aria-label="annotation1" class="CodeAnnotationHang">1</span> char PIN[6]={'1','2','3','4','5','6'}; // our secret number&#13;
char attempt[6]={0,0,0,0,0,0};&#13;
int z=0;&#13;
void setup()<span epub:type="pagebreak" id="Page_208" title="208"/>{ Serial.begin(9600);&#13;
}&#13;
void correctPIN()   // do this if the correct PIN is entered&#13;
{ Serial.println("Correct PIN entered...");&#13;
}&#13;
void incorrectPIN() // do this if an incorrect PIN is entered&#13;
{ Serial.println("Incorrect PIN entered!");&#13;
}&#13;
void checkPIN()&#13;
{ int correct=0; <span aria-label="annotation2" class="CodeAnnotationHang">2</span>   for (int i = 0;  i &lt; 6 ;  i++ ) {&#13;
// Goes step-by-step through the 6-character array. &#13;
// If each char matches each char in the PIN, increments the &#13;
// counter.&#13;
if (attempt[i]==PIN[i]) { correct++; } } if (correct==6) {<span aria-label="annotation3" class="CodeAnnotationHang">3</span>     correctPIN(); }  else {<span aria-label="annotation4" class="CodeAnnotationHang">4</span>     incorrectPIN(); } for (int i=0; i&lt;6; i++) // removes previously entered code attempt  { attempt[i]=0; }&#13;
}&#13;
void readKeypad()&#13;
{ char key = keypad.getKey(); if (key != NO_KEY) {<span aria-label="annotation5" class="CodeAnnotationHang">5</span>     switch(key) { case '*': z=0; break; case '#': delay(100); // removes the possibility of switch bounce checkPIN();<span epub:type="pagebreak" id="Page_209" title="209"/>      break; default: attempt[z]=key; z++; } }&#13;
}&#13;
void loop()&#13;
{<span aria-label="annotation6" class="CodeAnnotationHang">6</span>   readKeypad();&#13;
}</code></pre>&#13;
			<h3 id="h2-500587c11-0005">Understanding the Sketch</h3>&#13;
			<p class="BodyFirst">After the usual setup routines (as described in <a href="#listing11-1">Listing 11-1</a>), the sketch continually “listens” to the keypad by running the function <code>readKeypad()</code> at <span aria-label="annotation6" class="CodeAnnotation">6</span>. After a key is pressed, the Arduino examines the value of the key using a <code>switch case</code> statement at <span aria-label="annotation5" class="CodeAnnotation">5</span>. The Arduino stores the values of the keys pressed on the keypad in the array <code>attempt</code>, and when the user presses <code>#</code>, the Arduino calls the function <code>checkPIN()</code>.</p>&#13;
			<p>&#13;
				At <span aria-label="annotation2" class="CodeAnnotation">2</span>, the Arduino compares the values of the pressed keys against the PIN stored in the array <code>PIN</code> at <span aria-label="annotation1" class="CodeAnnotation">1</span>. If the correct sequence is entered, the function <code>correctPIN()</code> at <span aria-label="annotation3" class="CodeAnnotation">3</span> is called, where you can add your own code to execute. If an incorrect sequence is entered, the function <code>incorrectPIN()</code> at <span aria-label="annotation4" class="CodeAnnotation">4</span> is called. Finally, once the user’s entry has been checked, the code deletes the entry from memory so the code is ready for the next test.</p>&#13;
			<h3 id="h2-500587c11-0006">Testing the Sketch</h3>&#13;
			<p class="BodyFirst">After you’ve uploaded the sketch to your Arduino, open the Serial Monitor window, press star (<code>*</code>) on the numeric keypad, type the secret number, and then enter the pound sign (<code>#</code>). Try entering both correct and incorrect numbers. Your results should be similar to the output shown in <a href="#figure11-4" id="figureanchor11-4">Figure 11-4</a>.</p>&#13;
			<p>&#13;
				This example serves as a perfect foundation for your own PIN-activated devices, such as locks, alarms, or anything else you can imagine. Just be sure to replace the code in <code>correctPIN()</code> and <code>incorrectPIN()</code> with the code you want to run when a correct or incorrect sequence is entered.</p>&#13;
			<figure>&#13;
				<img alt="f11004" src="image_fi/500587c11/f11004.png"/>&#13;
				<figcaption>&#13;
					<p><a id="figure11-4">Figure 11-4</a>: Results from entering correct and incorrect PINs</p>&#13;
				</figcaption>&#13;
			</figure>&#13;
			<h2 id="h1-500587c11-0004"><span epub:type="pagebreak" id="Page_210" title="210"/>Looking Ahead</h2>&#13;
			<p class="BodyFirst">You have learned yet another way to gather input for your Arduino. You’ve also gained the foundational knowledge to create a useful method of controlling a sketch using a numeric keypad, as well as the foundations for a combination lock to access anything that your Arduino can control. Furthermore, you’ve learned the very useful <code>switch case</code> statement. In the next chapter, you’ll learn about another form of input: the touchscreen.</p>&#13;
		</section>&#13;
	</body></html>