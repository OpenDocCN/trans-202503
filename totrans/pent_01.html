<html><head></head><body><section class="preface" epub:type="preface" id="penetration_testing_primer" title="Penetration Testing Primer"><div class="titlepage"><div><div><h2 class="title">Penetration Testing Primer</h2></div></div></div><p><a class="indexterm" id="iddle1923"/><span class="emphasis"><em>Penetration testing</em></span>, or <span class="emphasis"><em>pentesting</em></span> (not to be confused with testing ballpoint or fountain pens), involves simulating real attacks to assess the risk associated with potential security breaches. On a pentest (as opposed to a vulnerability assessment), the testers not only discover vulnerabilities that could be used by attackers but also exploit vulnerabilities, where possible, to assess what attackers might gain after a successful exploitation.</p><p>From time to time, a news story breaks about a major company being hit by a cyberattack. More often than not, the attackers didn’t use the latest and greatest zero-day (a vulnerability unpatched by the software publishers). Major companies with sizable security budgets fall victim to SQL injection vulnerabilities on their websites, social-engineering attacks against employees, weak passwords on Internet-facing services, and so on. In other <a class="indexterm" id="iddle1371"/><a class="indexterm" id="iddle1390"/><a class="indexterm" id="iddle1507"/><a class="indexterm" id="iddle1549"/><a class="indexterm" id="iddle1925"/><a class="indexterm" id="iddle1926"/><a class="indexterm" id="iddle1967"/><a class="indexterm" id="iddle1985"/><a class="indexterm" id="iddle2000"/><a class="indexterm" id="iddle2010"/><a class="indexterm" id="iddle2061"/><a class="indexterm" id="iddle2305"/><a class="indexterm" id="iddle2411"/>words, companies are losing proprietary data and exposing their clients’ personal details through security holes that could have been fixed. On a penetration test, we find these issues before an attacker does, and we recommend how to fix them and avoid future vulnerabilities.</p><p>The scope of your pentests will vary from client to client, as will your tasks. Some clients will have an excellent security posture, while others will have vulnerabilities that could allow attackers to breach the perimeter and gain access to internal systems.</p><p>You may also be tasked with assessing one or many custom web applications. You may perform social-engineering and client-side attacks to gain access to a client’s internal network. Some pentests will require you to act like an insider—a malicious employee or attacker who has already breached the perimeter—as you perform an <span class="emphasis"><em>internal penetration test</em></span>. Some clients will request an <span class="emphasis"><em>external penetration test</em></span>, in which you simulate an attack via the Internet. And some clients may want you to assess the security of the wireless networks in their office. In some cases, you may even audit a client’s physical security controls.</p><div class="sect1" title="The Stages of the Penetration Test"><div class="titlepage"><div><div><h2 class="title" id="stages_of_the_penetration_test" style="clear: both">The Stages of the Penetration Test</h2></div></div></div><p>Pentesting begins with the <span class="emphasis"><em>pre-engagement</em></span> phase, which involves talking to the client about their goals for the pentest, mapping out the scope (the extent and parameters of the test), and so on. When the pentester and the client agree about scope, reporting format, and other topics, the actual testing begins.</p><p>In the <span class="emphasis"><em>information-gathering</em></span> phase, the pentester searches for publicly available information about the client and identifies potential ways to connect to its systems. In the <span class="emphasis"><em>threat-modeling</em></span> phase, the tester uses this information to determine the value of each finding and the impact to the client if the finding permitted an attacker to break into a system. This evaluation allows the pentester to develop an action plan and methods of attack.</p><p>Before the pentester can start attacking systems, he or she performs a <span class="emphasis"><em>vulnerability analysis</em></span>. In this phase, the pentester attempts to discover vulnerabilities in the systems that can be taken advantage of in the <span class="emphasis"><em>exploitation</em></span> phase. A successful exploit might lead to a <span class="emphasis"><em>post-exploitation</em></span> phase, where the result of the exploitation is leveraged to find additional information, sensitive data, access to other systems, and so on.</p><p>Finally, in the <span class="emphasis"><em>reporting</em></span> phase, the pentester summarizes the findings for both executives and technical practitioners.</p><div class="note" title="Note"><h3 class="title"><a id="pref05note01"/>Note</h3><p>For more information on pentesting, a good place to start is the Penetration Testing Execution Standard (PTES) at <span class="emphasis"><em><a class="ulink" href="http://www.pentest-standard.org/" target="_top">http://www.pentest-standard.org/</a></em></span>.</p></div><div class="sect2" title="Pre-engagement"><div class="titlepage"><div><div><h3 class="title" id="pre-engagement">Pre-engagement</h3></div></div></div><p>Before the pentest begins, pentesters perform pre-engagement interactions with the client to make sure everyone is on the same page about the <a class="indexterm" id="iddle1084"/><a class="indexterm" id="iddle1180"/><a class="indexterm" id="iddle1182"/><a class="indexterm" id="iddle1205"/><a class="indexterm" id="iddle1920"/><a class="indexterm" id="iddle2107"/><a class="indexterm" id="iddle2289"/>penetration testing. Miscommunication between a pentester and a client who expects a simple vulnerability scan could lead to a sticky situation because penetration tests are much more intrusive.</p><p>The pre-engagement stage is when you should take the time to understand your client’s business goals for the pentest. If this is their first pentest, what prompted them to find a pentester? What exposures are they most worried about? Do they have any fragile devices you need to be careful with when testing? (I’ve encountered everything from windmills to medical devices hooked up to patients on networks.)</p><p>Ask questions about your client’s business. What matters most to them? For example, to a top online vendor, hours of downtime could mean thousands of dollars of lost revenue. To a local bank, having online banking sites go down for a few hours may annoy a few customers, but that downtime wouldn’t be nearly as devastating as the compromise of a credit card database. To an information security vendor, having their homepage plastered with rude messages from attackers could lead to a damaged reputation that snowballs into a major revenue loss.</p><p>Other important items to discuss and agree upon during the pre-engagement phase of the pentest include the following:</p><p><span class="strong"><strong>Scope</strong></span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none"><p>What IP addresses or hosts are in scope, and what is not in scope? What sorts of actions will the client allow you to perform? Are you allowed to use exploits and potentially bring down a service, or should you limit the assessment to merely detecting possible vulnerabilities? Does the client understand that even a simple port scan could bring down a server or router? Are you allowed to perform a social-engineering attack?</p></li></ul></div><p><span class="strong"><strong>The testing window</strong></span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none"><p>The client may want you to perform tests only during specific hours or on certain days.</p></li></ul></div><p><span class="strong"><strong>Contact information</strong></span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none"><p>Whom should you contact if you find something serious? Does the client expect you to contact someone 24 hours a day? Do they prefer that you use encryption for email?</p></li></ul></div><p><span class="strong"><strong>A “get out of jail free” card</strong></span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none"><p>Make sure you have authorization to perform a penetration test on the target. If a target is not owned by the company (for instance, because it’s hosted by a third party), make sure to verify that the client has formal approval from the third party to perform the penetration test. Regardless, make sure your contract includes a statement that limits your liability in case something unexpected happens, and get written permission to perform the test.</p></li></ul></div><p><span class="strong"><strong>Payment terms</strong></span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none"><p>How and when will you be paid, and how much?</p></li></ul></div><p><a class="indexterm" id="iddle1372"/><a class="indexterm" id="iddle1508"/><a class="indexterm" id="iddle1846"/><a class="indexterm" id="iddle1858"/><a class="indexterm" id="iddle1868"/><a class="indexterm" id="iddle1968"/><a class="indexterm" id="iddle2306"/><a class="indexterm" id="iddle2412"/>Finally, include a nondisclosure agreement clause in your contract. Clients will appreciate your written commitment to keep the penetration test and any findings confidential.</p></div><div class="sect2" title="Information Gathering"><div class="titlepage"><div><div><h3 class="title" id="information_gathering">Information Gathering</h3></div></div></div><p>Next is the information-gathering phase. During this phase, you analyze freely available sources of information, a process known as gathering <span class="emphasis"><em>open source intelligence (OSINT)</em></span>. You also begin to use tools such as port scanners to get an idea of what systems are out there on the Internet or internal network as well as what software is running. We’ll explore information gathering in more detail in <a class="xref" href="ch05.xhtml" title="Chapter 5. Information Gathering">Chapter 5</a>.</p></div><div class="sect2" title="Threat Modeling"><div class="titlepage"><div><div><h3 class="title" id="threat_modeling">Threat Modeling</h3></div></div></div><p>Based on the knowledge gained in the information-gathering phase, we move on to threat modeling. Here we think like attackers and develop plans of attack based on the information we’ve gathered. For example, if the client develops proprietary software, an attacker could devastate the organization by gaining access to their internal development systems, where the source code is developed and tested, and selling the company’s trade secrets to a competitor. Based on the data we found during information gathering, we develop strategies to penetrate a client’s systems.</p></div><div class="sect2" title="Vulnerability Analysis"><div class="titlepage"><div><div><h3 class="title" id="vulnerability_analysis">Vulnerability Analysis</h3></div></div></div><p>Next, pentesters begin to actively discover vulnerabilities to determine how successful their exploit strategies might be. Failed exploits can crash services, set off intrusion-detection alerts, and otherwise ruin your chances of successful exploitation. Often during this phase, pentesters run vulnerability scanners, which use vulnerability databases and a series of active checks to make a best guess about which vulnerabilities are present on a client’s system. But though vulnerability scanners are powerful tools, they can’t fully replace critical thinking, so we also perform manual analysis and verify results on our own in this phase as well. We’ll explore various vulnerability-identification tools and techniques in <a class="xref" href="ch06.xhtml" title="Chapter 6. Finding Vulnerabilities">Chapter 6</a>.</p></div><div class="sect2" title="Exploitation"><div class="titlepage"><div><div><h3 class="title" id="exploitation">Exploitation</h3></div></div></div><p>Now for the fun stuff: exploitation. Here we run exploits against the vulnerabilities we’ve discovered (sometimes using a tool like Metasploit) in an attempt to access a client’s systems. As you’ll see, some vulnerabilities will be remarkably easy to exploit, such as logging in with default passwords. We’ll look at exploitation in <a class="xref" href="ch08.xhtml" title="Chapter 8. Exploitation">Chapter 8</a>.</p></div><div class="sect2" title="Post Exploitation"><div class="titlepage"><div><div><h3 class="title" id="post_exploitation">Post Exploitation</h3></div></div></div><p>Some say pentests truly begin only after exploitation, in the post-exploitation phase. You got in, but what does that intrusion really mean to the client? If you broke into an unpatched legacy system that isn’t part of a domain or <a class="indexterm" id="iddle1356"/><a class="indexterm" id="iddle2062"/><a class="indexterm" id="iddle2078"/>otherwise networked to high-value targets, and that system contains no information of interest to an attacker, that vulnerability’s risk is significantly lower than if you were able to exploit a domain controller or a client’s development system.</p><p>During post exploitation, we gather information about the attacked system, look for interesting files, attempt to elevate our privileges where necessary, and so on. For example, we might dump password hashes to see if we can reverse them or use them to access additional systems. We might also try to use the exploited machine to attack systems not previously available to us by <span class="emphasis"><em>pivoting</em></span> into them. We’ll examine post exploitation in <a class="xref" href="ch13.xhtml" title="Chapter 13. Post Exploitation">Chapter 13</a>.</p></div><div class="sect2" title="Reporting"><div class="titlepage"><div><div><h3 class="title" id="reporting">Reporting</h3></div></div></div><p>The final phase of penetration testing is reporting. This is where we convey our findings to the customer in a meaningful way. We tell them what they’re doing correctly, where they need to improve their security posture, how you got in, what you found, how to fix problems, and so on.</p><p>Writing a good pentest report is an art that takes practice to master. You’ll need to convey your findings clearly to everyone from the IT staff charged with fixing vulnerabilities to upper management who signs off on the changes to external auditors. For instance, if a nontechnical type reads, “And then I used MS08-067 to get a shell,” he or she might think, “You mean, like a seashell?” A better way to communicate this thought would be to mention the private data you were able to access or change. A statement like “I was able to read your email,” will resonate with almost anyone.</p><p>The pentest report should include both an executive summary and a technical report, as discussed in the following sections.</p><div class="sect3" title="Executive Summary"><div class="titlepage"><div><div><h4 class="title" id="executive_summary">Executive Summary</h4></div></div></div><p>The executive summary describes the goals of the test and offers a high-level overview of the findings. The intended audience is the executives in charge of the security program. Your executive summary should include the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none"><p title="Background"><span class="title"><strong><span class="strong"><strong>Background</strong></span></strong></span>. A description of the purpose of the test and definitions of any terms that may be unfamiliar to executives, such as <span class="emphasis"><em>vulnerability</em></span> and <span class="emphasis"><em>countermeasure</em></span>.</p></li><li class="listitem" style="list-style-type: none"><p title="Overall posture"><span class="title"><strong><span class="strong"><strong>Overall posture</strong></span></strong></span>. An overview of the effectiveness of the test, the issues found (such as exploiting the MS08-067 Microsoft vulnerability), and general issues that cause vulnerabilities, such as a lack of patch management.</p></li><li class="listitem" style="list-style-type: none"><p title="Risk profile"><span class="title"><strong><span class="strong"><strong>Risk profile</strong></span></strong></span>. An overall rank of the organization’s security posture compared to similar organizations with measures such as high, moderate, or low. You should also include an explanation of the ranking.</p></li><li class="listitem" style="list-style-type: none"><p title="General findings"><span class="title"><strong><span class="strong"><strong>General findings</strong></span></strong></span>. A general synopsis of the issues identified along with statistics and metrics on the effectiveness of any countermeasures deployed.</p></li><li class="listitem" style="list-style-type: none"><p title="Recommendation summary"><span class="title"><strong><span class="strong"><strong>Recommendation summary</strong></span></strong></span>. <a class="indexterm" id="iddle2253"/><a class="indexterm" id="iddle2285"/>A high-level overview of the tasks required to remediate the issues discovered in the pentest.</p></li><li class="listitem" style="list-style-type: none"><p title="Strategic road map"><span class="title"><strong><span class="strong"><strong>Strategic road map</strong></span></strong></span>. Give the client short- and long-term goals to improve their security posture. For example, you might tell them to apply certain patches now to address short-term concerns, but without a long-term plan for patch management, the client will be in the same position after new patches have been released.</p></li></ul></div></div><div class="sect3" title="Technical Report"><div class="titlepage"><div><div><h4 class="title" id="technical_report">Technical Report</h4></div></div></div><p>This section of the report offers technical details of the test. It should include the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none"><p title="Introduction"><span class="title"><strong><span class="strong"><strong>Introduction</strong></span></strong></span>. An inventory of details such as scope, contacts, and so on.</p></li><li class="listitem" style="list-style-type: none"><p title="Information gathering"><span class="title"><strong><span class="strong"><strong>Information gathering</strong></span></strong></span>. Details of the findings in the information-gathering phase. Of particular interest is the client’s Internet footprint.</p></li><li class="listitem" style="list-style-type: none"><p title="Vulnerability assessment"><span class="title"><strong><span class="strong"><strong>Vulnerability assessment</strong></span></strong></span>. Details of the findings of the vulnerability-analysis phase of the test.</p></li><li class="listitem" style="list-style-type: none"><p title="Exploitation/vulnerability verification"><span class="title"><strong><span class="strong"><strong>Exploitation/vulnerability verification</strong></span></strong></span>. Details of the findings from the exploitation phase of the test.</p></li><li class="listitem" style="list-style-type: none"><p title="Post exploitation"><span class="title"><strong><span class="strong"><strong>Post exploitation</strong></span></strong></span>. Details of the findings of the post-exploitation phase of the test.</p></li><li class="listitem" style="list-style-type: none"><p title="Risk/exposure"><span class="title"><strong><span class="strong"><strong>Risk/exposure</strong></span></strong></span>. A quantitative description of the risk discovered. This section estimates the loss if the identified vulnerabilities were exploited by an attacker.</p></li><li class="listitem" style="list-style-type: none"><p title="Conclusion"><span class="title"><strong><span class="strong"><strong>Conclusion</strong></span></strong></span>. A final overview of the test.</p></li></ul></div></div></div></div><div class="sect1" title="Summary"><div class="titlepage"><div><div><h2 class="title" id="summary-id00001" style="clear: both">Summary</h2></div></div></div><p>This chapter has taken a brief look at the phases of penetration testing, including pre-engagement, information gathering, threat modeling, vulnerability analysis, exploitation, post exploitation, and reporting. Familiarity with these phases will be crucial as you begin your pentesting career, and you’ll learn more about them as you move through the book.</p></div></section></body></html>