<html><head></head><body>
<h2 class="h2" id="ch4"><span epub:type="pagebreak" id="page_75"/><span class="big"><strong>4</strong></span></h2>&#13;
<h2 class="h2a">CREATING YOUR FIRST ANDROID APP</h2>&#13;
<div class="image21"><img src="../images/circle.jpg" alt="Image"/></div>&#13;
<p class="noindent">To build the mobile version of the Hi-Lo guessing game app, we’re going to use Android Studio. If you didn’t set this up in <a href="ch1.xhtml#ch1">Chapter 1</a>, go back to “<a href="ch1.xhtml#toc_lev13">Installing Android Studio for Mobile App Development</a>” on <a href="ch1.xhtml#page_8">page 8</a> and set it up. As with the GUI version of the game, we’re going to create a user interface for the app, as shown in <a href="ch4.xhtml#ch4fig1">Figure 4-1</a>. The apps you’ve created so far could only be run on your desktop computer, but Android apps can run on any Android device, including phones, tablets, watches, TVs, and so on. If you don’t own an Android device, don’t worry—you can still code for Android, as the Android emulator that comes with Android Studio lets you simulate running a device.</p>&#13;
<div class="image"><span epub:type="pagebreak" id="page_76"/><img src="../images/f0076-01.jpg" alt="Image"/></div>&#13;
<p class="fig-cap"><em><a id="ch4fig1"/>Figure 4-1: The guessing game will become a mobile app in this chapter. The app runs on a simulated Android phone (left) and on an actual Android tablet (right).</em></p>&#13;
<p class="indent"><a href="ch4.xhtml#ch4fig1">Figure 4-1</a> shows our app running on the Android emulator, simulating how the app looks on a Nexus 6P, and on an Android tablet. Both versions are running the same code—and, even more conveniently, we can reuse a lot of the Java code we built for the previous desktop versions because Android is built on Java!</p>&#13;
<p class="indent">Notice that the emulator and the actual device look very similar, with some minor differences to account for the different screen sizes between the phone and the 7-inch tablet. In the same way that you can write a Java app for Windows and run it on macOS or Linux, you can write an Android mobile app in Java and run it on any of literally thousands of Android devices. Let’s get started building your first Android mobile app!</p>&#13;
<h3 class="h3"><a id="toc_lev64"/>Starting a New Android Studio App Project</h3>&#13;
<p class="noindent">The first time you start Android Studio, it may take a few minutes to update and run. When it starts, you’ll see a screen like the one shown in <a href="ch4.xhtml#ch4fig2">Figure 4-2</a>. Select the option labeled <strong>Start a new Android Studio project</strong>.</p>&#13;
<p class="indent">Name your new project <em>GuessingGame</em>, with no space. If you have a website, you can enter it in the Company Domain field, as shown in <a href="ch4.xhtml#ch4fig3">Figure 4-3</a>. Otherwise, leave the default example domain. Next, choose a project location. I’ve set up a folder called <em>AndroidProjects</em> to keep things organized, and you should do the same.</p>&#13;
<div class="image"><span epub:type="pagebreak" id="page_77"/><img src="../images/f0077-01.jpg" alt="Image"/></div>&#13;
<p class="fig-cap"><em><a id="ch4fig2"/>Figure 4-2: Once Android Studio finishes setting up, choose</em> <strong><em>Start a new Android Studio project</em></strong>.</p>&#13;
<div class="image"><img src="../images/f0077-02.jpg" alt="Image"/></div>&#13;
<p class="fig-cap"><em><a id="ch4fig3"/>Figure 4-3: Name your new Android Studio project</em> GuessingGame, <em>with no space.</em></p>&#13;
<p class="indent">Click <strong>Next</strong> after naming your project. Now you’ll have the opportunity to choose which Android version number your app should run on. The Android platform evolves rapidly as new devices and capabilities are developed, so we’ll need to pick a target. Fortunately, Android Studio <span epub:type="pagebreak" id="page_78"/>is regularly updated with both the latest Android versions and information on how many devices still use the older versions. You’ll also need to select a <em>software development kit (SDK)</em> or <em>application program interface (API)</em> level when you choose which versions of Android to support. SDK and API levels include tools you’ll use to develop your app, but they’re tied to specific versions of Android. The Target Android Devices window, shown in <a href="ch4.xhtml#ch4fig4">Figure 4-4</a>, allows you to choose a minimum SDK or API level for each app you develop.</p>&#13;
<div class="image"><img src="../images/f0078-01.jpg" alt="Image"/></div>&#13;
<p class="fig-cap"><em><a id="ch4fig4"/>Figure 4-4: Choose the Minimum SDK level for the Android devices you’re developing for.</em></p>&#13;
<p class="indent">Choose <strong>API 16 (Android 4.1, Jelly Bean)</strong> as the minimum SDK for the guessing game app. Android Studio will tell you that this runs on more than 99 percent of active Android devices. Click <strong>Next</strong>.</p>&#13;
<p class="indent">The New Project wizard will ask you what kind of <em>activity</em> you want to add to your app. An activity is just something the user can do. Each activity usually has its own screen layout with a user interface, like the ones shown in <a href="ch4.xhtml#ch4fig5">Figure 4-5</a>.</p>&#13;
<p class="indent">There are lots of choices for the main activity for an app, such as Google Maps, Login, Settings, Tabbed Activities, and more. The Basic Activity will give us a great foundation for the guessing game app, so choose that option and click <strong>Next</strong>.</p>&#13;
<p class="indent">We’ll use the default names provided by Android Studio on the following screen (shown in <a href="ch4.xhtml#ch4fig6">Figure 4-6</a>): <em>MainActivity</em> for the activity name and <em>activity_main</em> for the layout name. The activity file contains the Java source code that runs the app. The layout is a separate file that contains the app interface. Click <strong>Finish</strong> to complete your app project setup.</p>&#13;
<div class="image"><span epub:type="pagebreak" id="page_79"/><img src="../images/f0079-01.jpg" alt="Image"/></div>&#13;
<p class="fig-cap"><em><a id="ch4fig5"/>Figure 4-5: Choose Basic Activity as the basis for your app.</em></p>&#13;
<div class="image"><img src="../images/f0079-02.jpg" alt="Image"/></div>&#13;
<p class="fig-cap"><em><a id="ch4fig6"/>Figure 4-6: Leave the default values for activity name and layout name.</em></p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_80"/>The project may take a few moments to build, as Android Studio creates the project files and sets up the <em>GuessingGame</em> app project. After it finishes loading, Android Studio will open the project to a default view that looks like <a href="ch4.xhtml#ch4fig7">Figure 4-7</a>.</p>&#13;
<div class="image"><img src="../images/f0080-01.jpg" alt="Image"/></div>&#13;
<p class="fig-cap"><em><a id="ch4fig7"/>Figure 4-7: The default project view in Android Studio, complete with a GUI mobile layout view</em></p>&#13;
<p class="indent">If your project doesn’t open with this screen, click the Project tab in the upper left, expand the <em>app</em> folder in the Project Explorer, expand the <em>res</em> (short for <em>resources</em>) folder, expand <em>layout</em>, and then double-click the <em>content_main.xml</em> file to see a view similar to <a href="ch4.xhtml#ch4fig7">Figure 4-7</a>.</p>&#13;
<h3 class="h3"><a id="toc_lev65"/>Building the GUI Layout in Design View</h3>&#13;
<p class="noindent">Android apps separate the layout from the app code (the activity), so this app will be a little different from the desktop app we wrote in <a href="ch3.xhtml#ch3">Chapter 3</a>. The layout isn’t described in Java but in <em>eXtensible Markup Language (XML)</em>. Fortunately, despite this difference, we can still use a drag-and-drop palette similar to Eclipse’s WindowBuilder Editor to design the GUI view. The main difference in Android Studio is that the components have been named with mobile apps in mind.</p>&#13;
<p class="indent">Like the WindowBuilder Editor, Android Studio has two tabs, one for the design view and one for the source code. Click the Design tab in the lower-left corner of the main window containing the <em>content_main.xml</em> file. You’ll see the design view shown in <a href="ch4.xhtml#ch4fig8">Figure 4-8</a>.</p>&#13;
<div class="image"><span epub:type="pagebreak" id="page_81"/><img src="../images/f0081-01.jpg" alt="Image"/></div>&#13;
<p class="fig-cap"><em><a id="ch4fig8"/>Figure 4-8: Android Studio has a design view similar to the WindowBuilder Editor in Eclipse.</em></p>&#13;
<p class="indent"><a href="ch4.xhtml#ch4fig8">Figure 4-8</a> shows the four areas of the design view that we’ll be using the most: the Project Explorer pane <span class="ent">➊</span>, the Palette pane <span class="ent">➋</span>, the Preview pane <span class="ent">➌</span>, and the Properties pane <span class="ent">➍</span>.</p>&#13;
<p class="indent">In the center of the Preview pane, you’ll see a label—known as a <code>TextView</code> in Android terminology—reading <em>Hello World!</em>. Click the label and press <small>DELETE</small> (or right-click and select <strong>Delete</strong> from the menu) to delete it from the Preview pane. Then, click the <strong>Layouts</strong> option in the Palette pane, select a <strong>RelativeLayout</strong>, and drag it either to the Preview pane or onto the ConstraintLayout (in <a href="ch4.xhtml#ch4fig8">Figure 4-8</a>) in the Component Tree listing just below the Palette pane. We’ll start with an empty RelativeLayout to build our guessing game GUI view.</p>&#13;
<p class="indent">In the Palette pane, under Widgets, select <strong>TextView</strong>. A <code>TextView</code> in Android is similar to a <code>JLabel</code> in the Swing toolkit, and <em>widgets</em> are what we call most of the GUI components in Android. We’ll drag and drop to place GUI components in the design preview.</p>&#13;
<p class="indent">Click the <code>TextView</code> widget and drag it over the white app background in the simulated Android phone, placing the widget near the top to serve as the title of your app.</p>&#13;
<p class="indent">After placing the title <code>TextView</code>, you’ll see options appear in the Properties pane on the right. If the pane doesn’t appear, click Properties in the upper-right corner of the Design tab to expand the Properties pane. Find the <code>text</code> property of the <code>TextView</code> widget you’ve just added. Change the text to <span class="codestrong"><code>"</code></span><span class="codeitalic"><span class="codestrong"><code>Your Name</code></span></span><span class="codestrong"><code>'s Guessing Game"</code></span> and change the <code>textAppearance</code> property to <strong>Large</strong>. Then, drag the <code>TextView</code> to center it at the top of the screen as shown in <a href="ch4.xhtml#ch4fig9">Figure 4-9</a>. The gray dashed guideline helps with placement.</p>&#13;
<div class="image"><span epub:type="pagebreak" id="page_82"/><img src="../images/f0082-01.jpg" alt="Image"/></div>&#13;
<p class="fig-cap"><em><a id="ch4fig9"/>Figure 4-9: Placing GUI widgets/components in Android Studio is very similar to the process in Eclipse.</em></p>&#13;
<p class="indent">To add the label prompting the user to enter a number between 1 and 100, place another <code>TextView</code> widget onto the design preview just a small distance below the title. Change the <code>textAppearance</code> property to <strong>Medium</strong> in the Properties pane on the right. Then, type <span class="codestrong"><code>Enter a number between 1 and 100:</code></span> in the <code>text</code> property for the <code>TextView</code>.</p>&#13;
<p class="indent">Next, we’ll place the text field, also known as an <code>EditText</code> in Android, for the user’s guess. Text fields are listed just below Widgets in the Palette pane. There are many types of text fields in Android, and each behaves differently depending on the needs of your app. For example, Plain Text is a simple text field, Password hides characters as they’re typed, Phone shows the numeric keypad and formats the input as a phone number, and E-mail shows a modified keyboard with the @ symbol.</p>&#13;
<p class="indent">Choose a <strong>Number</strong> text field so the user can enter their guess from a numeric keyboard on their screen. Place this field just a little below the previous label. Then, place a Button widget an equal distance below the text field and change its <code>text</code> property to <span class="codestrong"><code>"Guess!"</code></span>. Finally, place another <code>TextView</code> widget below the button, giving it a <code>text</code> property of <span class="codestrong"><code>"Enter a number, then click Guess!"</code></span>. If you have trouble placing the widget the same distance below the button because you’re too close to the vertical center of the screen, place it lower or higher in the Properties pane under Layout_Margin (you may need to click <strong>View all properties</strong> and then click the gray arrow next to Layout_Margin to expand the margin properties), find <strong>layout_marginTop</strong>, and change the value to <strong>30dp</strong>. The finished GUI layout should look similar to <a href="ch4.xhtml#ch4fig10">Figure 4-10</a>.</p>&#13;
<div class="image"><span epub:type="pagebreak" id="page_83"/><img src="../images/f0083-01.jpg" alt="Image"/></div>&#13;
<p class="fig-cap"><em><a id="ch4fig10"/>Figure 4-10: The finished GUI layout for the Android guessing game app in design view</em></p>&#13;
<p class="indent">We’ll make one final change before naming the GUI components. Change the <code>width</code> property of the numeric text field, where the user enters their guess, to <strong>75dp</strong>; do so by clicking <strong>View all properties</strong> or the left-and-right arrow icon in the Properties pane. The original text field was too wide for a number-guessing game that uses only numbers between 1 and 100, so we’ve resized it to make it narrower.</p>&#13;
<p class="indent">With that small change, it’s time to start naming our GUI components so we’ll be able to find them easily in the Java code.</p>&#13;
<h3 class="h3"><a id="toc_lev66"/>Naming GUI Components in Android Studio</h3>&#13;
<p class="noindent">Just as we named GUI components in Eclipse, we’ll need to name the GUI elements in Android Studio so that we can access them from the code. But in Android Studio, the names of the GUI elements themselves won’t appear in the Java source code by default. Instead, we’ll have to connect these XML GUI components to the Java code by hand before we can use them in the code.</p>&#13;
<p class="indent">For now, though, we just need to change the <code>id</code> property of the number text field, the guess button, and the bottommost label to <span class="codestrong"><code>txtGuess</code></span>, <span class="codestrong"><code>btnGuess</code></span>, and <span class="codestrong"><code>lblOutput</code></span>, respectively. If a pop-up message asks you to update usages, click <strong>Yes</strong>. We’ll use these names for consistency and convenience. <a href="ch4.xhtml#ch4fig11">Figure 4-11</a> shows the renamed text field, button, and label.</p>&#13;
<div class="image"><span epub:type="pagebreak" id="page_84"/><img src="../images/f0084-01.jpg" alt="Image"/></div>&#13;
<p class="fig-cap"><em><a id="ch4fig11"/>Figure 4-11: Rename the <code>EditText</code>, <code>Button</code>, and <code>TextView</code> components (circled) by changing their id properties to <code>txtGuess</code>, <code>btnGuess</code>, and <code>lblOutput</code>, respectively.</em></p>&#13;
<p class="indent">One last thing we should do before we start coding in Java is hide the small <em>floating action button (fab)</em> icon, shown in the bottom right of the design preview in <a href="ch4.xhtml#ch4fig12">Figure 4-12</a>. Your project may not show the fab icon, but if it does, double-click the <em>activity_main.xml</em> file in the Project Explorer pane <span class="ent">➊</span>. Click the <em>activity_main.xml</em> tab above the design view <span class="ent">➋</span> and then click the fab icon <span class="ent">➌</span>. Go to Properties and set the <code>visibility</code> property to <strong>invisible</strong> <span class="ent">➍</span>.</p>&#13;
<div class="image"><img src="../images/f0084-02.jpg" alt="Image"/></div>&#13;
<p class="fig-cap"><em><a id="ch4fig12"/>Figure 4-12: Hide the fab icon by going to the</em> activity_main.xml <em>file, clicking the small envelope icon, and setting the</em> <code><em>visibility</em></code> <em>property to invisible.</em></p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_85"/>I’ve chosen to set the fab icon to invisible rather than delete it entirely, because you might want to use the floating action button to add new features to your app later on. The floating action button can share info from the app to Facebook, post a tweet in Twitter about how much you like the app, send an email to a friend about the app, and more.</p>&#13;
<p class="indent">Next, we’ll wire up the GUI so that we can use it in Java to program the rest of the app.</p>&#13;
<h3 class="h3"><a id="toc_lev67"/>Connecting the GUI to Java in Android Studio</h3>&#13;
<p class="noindent">It’s time to connect the GUI to Java so we can write the code for the guessing game app. First, let’s open the Java source code file by looking in the Project Explorer pane, under <em>app</em> <span class="ent">▸</span> <em>src</em> <span class="ent">▸</span> <em>main</em> <span class="ent">▸</span> <em>java</em> <span class="ent">▸</span> <em>com.example.guessinggame</em> (or your package name) <span class="ent">▸</span> <em>MainActivity</em>. Double-click <em>MainActivity</em> to open the <em>MainActivity.java</em> source code file.</p>&#13;
<p class="indent">You may have noticed the <em>java</em> folder in the Project Explorer has another package or two, possibly labeled the same, but with <em>(test)</em> or <em>(androidTest)</em> after the package name. These packages are used for testing in larger applications, where engineers evaluate app quality, security, and functionality for software quality assurance. We won’t tackle quality assurance, but it’s a great way to get into the software development industry.</p>&#13;
<p class="indent">The Java source code inside the <em>MainActivity.java</em> file will look something like <a href="ch4.xhtml#ch4fig13">Figure 4-13</a>.</p>&#13;
<div class="image"><img src="../images/f0085-01.jpg" alt="Image"/></div>&#13;
<p class="fig-cap"><em><a id="ch4fig13"/>Figure 4-13: The Java source code for the app is called</em> MainActivity.java <em>by default.</em></p>&#13;
<p class="indent">Notice that in Android Studio, a package declaration appears at the very top of the file by default. Packages help us organize all the files needed in <span epub:type="pagebreak" id="page_86"/>a more complex program, such as a mobile app. In this case, the package name is the company domain name from the Create New Project screen back in <a href="ch4.xhtml#ch4fig3">Figure 4-3</a> on <a href="ch4.xhtml#page_77">page 77</a>, but in reverse order—notice the <em>com</em> comes first.</p>&#13;
<p class="indent">Several Android <code>import</code> statements follow the package declaration. These work just as they do for Java on the desktop, importing existing features and functionality into the code.</p>&#13;
<p class="indent">The following <code>public class MainActivity</code> code snippet may be slightly different for you depending on the minimum API level you chose for your app, but the overall code will be similar, and the app we’re writing will work across multiple API levels. First we’ll declare our variables to connect the GUI to the program. Click just inside the opening brace for the class, on the next line down, and add these lines to declare variables for the text field, button, and output label:</p>&#13;
<p class="pre"><span class="ash">public class MainActivity extends AppCompatActivity {</span><br/>&#13;
    private EditText txtGuess;<br/>&#13;
    private Button btnGuess;<br/>&#13;
    private TextView lblOutput;</p>&#13;
<p class="indent">As you enter each new variable type, you may see a drop-down menu offering to import it (<code>android.widget.EditText</code>, for example). If you click the correct widget type to import, Android Studio will add the corresponding <code>import</code> statement for you. If you typed the three lines without clicking to accept the automatic imports, just click each widget type and then press <small>ALT</small>-<small>ENTER</small> (or <small>OPTION</small>-<small>ENTER</small> on macOS) to import any missing classes, as shown in <a href="ch4.xhtml#ch4fig14">Figure 4-14</a>.</p>&#13;
<div class="image"><img src="../images/f0086-01.jpg" alt="Image"/></div>&#13;
<p class="fig-cap"><em><a id="ch4fig14"/>Figure 4-14: Android Studio enables you to automatically import classes just as Eclipse did, either as you type or afterward with a simple key combination (</em><small><em>ALT</em></small><em>-</em><small><em>ENTER</em></small>, <em>or</em> <small><em>OPTION</em></small><em>-</em><small><em>ENTER</em></small> <em>on macOS).</em></p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_87"/>The following three <code>import</code> statements should now appear with the others near the top of your file:</p>&#13;
<p class="pre">import android.widget.EditText;<br/>&#13;
import android.widget.Button;<br/>&#13;
import android.widget.TextView;</p>&#13;
<p class="indent">After declaring the three variables for the GUI widgets, we need to connect those variables to the XML components for each one. We’ll do this in the <code>onCreate()</code> method, shown at the bottom of <a href="ch4.xhtml#ch4fig14">Figure 4-14</a>, which is the function that runs when the app is loaded. Android Studio has automatically generated the code to begin this method.</p>&#13;
<p class="indent">Look inside the top two or three lines of the <code>onCreate()</code> method, and find this line:</p>&#13;
<p class="pre">    setContentView(R.layout.<span class="codeitalic">activity_main</span>);</p>&#13;
<p class="indent">Right after that line, press <small>ENTER</small> a couple of times and type the following partial line of code to begin connecting the variable <code>txtGuess</code> to the <code>EditText</code> widget in the XML layout file:</p>&#13;
<p class="pre">    txtGuess = (EditText) findViewById(R.id.</p>&#13;
<p class="indent">The <code>findViewById()</code> function is how we connect GUI widgets in the XML layout to the variables we’ll use to represent them in the source code. The <code>R</code> inside that function refers to a special file called <em>R.java</em> that Android Studio generates to make it possible to connect resources. The <code>R</code> is short for <em>resources</em>, usually stored in the <em>res</em> folder in the project. As you begin to type the preceding line, you’ll see a pop-up menu like the one shown in <a href="ch4.xhtml#ch4fig15">Figure 4-15</a>. Find and double-click <code>txtGuess</code> in the drop-down list of options. If you don’t see the <code>txtGuess</code> option, go back to the design view for <em>content _main.xml</em> and make sure you gave the text field the <code>id</code> property of <code>txtGuess</code>.</p>&#13;
<p class="indent">Finish with the closing parenthesis followed by a semicolon, as shown in the following listing, and then set up the button and output label. The finished three lines of code inside your <code>onCreate()</code> method should look like this:</p>&#13;
<p class="pre"><span class="ash">protected void onCreate(Bundle savedInstanceState) {</span><br/>&#13;
    <span class="ash">super.onCreate(savedInstanceState);</span><br/>&#13;
    <span class="ash">setContentView(R.layout.</span><span class="ash"><em>activity_main</em></span><span class="ash">);</span><br/>&#13;
    txtGuess = (EditText) findViewById(R.id.<em>txtGuess</em>);<br/>&#13;
    btnGuess = (Button) findViewById(R.id.<em>btnGuess</em>);<br/>&#13;
    lblOutput = (TextView) findViewById(R.id.<em>lblOutput</em>);</p>&#13;
<p class="indent">If everything has been named correctly in the layout, these lines of code should connect the variables <code>txtGuess</code>, <code>btnGuess</code>, and <code>lblOutput</code> to the <code>EditText</code>, <code>Button</code>, and <code>TextView</code> components in the GUI layout. This is a good time to stop and save your project to capture the progress you’ve made so far.</p>&#13;
<div class="image"><span epub:type="pagebreak" id="page_88"/><img src="../images/f0088-01.jpg" alt="Image"/></div>&#13;
<p class="fig-cap"><em><a id="ch4fig15"/>Figure 4-15: Android Studio helps us “wire up” the Java code to the GUI resources in the layout with helpful drop-down options.</em></p>&#13;
<h3 class="h3"><a id="toc_lev68"/>Adding Methods to Check the Guess and Begin a New Game</h3>&#13;
<p class="noindent">Now, let’s work on writing the code for the <code>checkGuess()</code> function. We can begin writing the <code>checkGuess()</code> method just below the variable declarations for <code>txtGuess</code>, <code>btnGuess</code>, and <code>lblOutput</code> and just above the <code>onCreate()</code> method, as shown in <a href="ch4.xhtml#ch4fig16">Figure 4-16</a>.</p>&#13;
<p class="indent">First, we need to get the user’s guess from the GUI text field and store it in a <code>String</code> variable:</p>&#13;
<p class="pre"><span class="ash">public class MainActivity extends AppCompatActivity {</span><br/>&#13;
    <span class="ash">private EditText txtGuess;</span><br/>&#13;
    <span class="ash">private Button btnGuess;</span><br/>&#13;
    <span class="ash">private TextView lblOutput;</span><br/>&#13;
    public void checkGuess() {<br/>&#13;
        String guessText = txtGuess.getText().toString();</p>&#13;
<p class="indent">The code to get the user’s guess from the text field looks almost the same as in the desktop version of the app, except for the additional<code>.toString()</code> method at the end. There is a separate <code>Text</code> class in Android and the text that is entered into a text field is a <code>Text</code> object, so we have to convert that object to a <code>String</code> object.</p>&#13;
<div class="image"><span epub:type="pagebreak" id="page_89"/><img src="../images/f0089-01.jpg" alt="Image"/></div>&#13;
<p class="fig-cap"><em><a id="ch4fig16"/>Figure 4-16: Beginning to write the checkGuess() method in Java</em></p>&#13;
<p class="indent">Fortunately, the rest of the <code>checkGuess()</code> method can be copied and pasted directly from the Eclipse desktop GUI version of the app from <a href="ch3.xhtml#ch3">Chapter 3</a>, with no changes! The complete <code>checkGuess()</code> method should look like this:</p>&#13;
<p class="pre">public void checkGuess() {<br/>&#13;
  <span class="ent">➊</span> String guessText = txtGuess.getText().toString();<br/>&#13;
    String message = "";<br/>&#13;
  <span class="ent">➋</span> try {<br/>&#13;
      <span class="ent">➌</span> int guess = Integer.<em>parseInt</em>(guessText);<br/>&#13;
        if (guess &lt; theNumber)<br/>&#13;
            message = guess + " is too low. Try again.";<br/>&#13;
        else if (guess &gt; theNumber)<br/>&#13;
            message = guess + " is too high. Try again.";<br/>&#13;
        else {<br/>&#13;
            message = guess +<br/>&#13;
                " is correct. You win! Let's play again!";<br/>&#13;
            newGame();<br/>&#13;
        }<br/>&#13;
  <span class="ent">➍</span> } catch (Exception e) {<br/>&#13;
        message = "Enter a whole number between 1 and 100.";<br/>&#13;
  <span class="ent">➎</span> } finally {<br/>&#13;
        lblOutput.setText(message);<br/>&#13;
        txtGuess.requestFocus();<br/>&#13;
        txtGuess.selectAll();<br/>&#13;
    }<br/>&#13;
}</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_90"/>One of the convenient features of Java is that we can reuse code across platforms. Just as we used code from the command line game to make the desktop game, we can use code from the desktop version in the Android version. Let’s review this code to understand how it will work in the Android app.</p>&#13;
<p class="indent">At <span class="ent">➊</span>, we get the user’s guess from the text field and set up a string for the output message. At <span class="ent">➋</span>, we begin a <code>try-catch-finally</code> statement to handle user input errors or exceptions. Inside the <code>try</code> block, at <span class="ent">➌</span>, we parse the integer number of the user’s guess from the characters they enter. The rest of the <code>try</code> block contains the <code>if-else</code> statements that test whether the user guessed too high or too low, set the appropriate message, and start a new game. Next, the <code>catch</code> statement <span class="ent">➍</span> that tells the user to enter a whole number between 1 and 100. Then, the <code>finally</code> block <span class="ent">➎</span> sets the text on the <code>lblOutput</code> widget to the appropriate <code>message</code>, returns the cursor to the text field, and highlights the text to prepare for the user’s next guess.</p>&#13;
<p class="indent">You may have noticed that there are a couple of items underlined in red: <code>theNumber</code> and <code>newGame()</code>. This is because we haven’t defined them yet in this version of our app.</p>&#13;
<p class="indent">At the top of the <code>MainActivity</code> class, below the three GUI widget declarations, add a declaration for the secret number, <code>theNumber</code>:</p>&#13;
<p class="pre"><span class="ash">public class MainActivity extends AppCompatActivity {</span><br/>&#13;
    <span class="ash">private EditText txtGuess;</span><br/>&#13;
    <span class="ash">private Button btnGuess;</span><br/>&#13;
    <span class="ash">private TextView lblOutput;</span><br/>&#13;
    private int theNumber;</p>&#13;
<p class="indent">This is the same code we used in the desktop game, because the Java code to create an integer is the same across the command line, desktop, and Android mobile versions of the app.</p>&#13;
<p class="indent">The code for the <code>newGame()</code> method is also the same as the desktop version. Add the <code>newGame()</code> method just before the <code>onCreate()</code> statement:</p>&#13;
<p class="pre">    public void newGame() {<br/>&#13;
        theNumber = (int)(Math.<em>random</em>() * 100 + 1);<br/>&#13;
    }<br/>&#13;
<span class="ash">@Override</span><br/>&#13;
<span class="ash">protected void onCreate(Bundle savedInstanceState) {</span></p>&#13;
<p class="indent">Creating a new game in the Android app is just like doing so in the desktop app. We just set <code>theNumber</code> to a random integer from 1 to 100, using the <code>Math.random()</code> function.</p>&#13;
<p class="indent">We can add a call to <code>newGame()</code> inside the <code>onCreate()</code> method after the code that connects the three GUI components:</p>&#13;
<p class="pre"><span class="ash">protected void onCreate(Bundle savedInstanceState) {</span><br/>&#13;
    <span class="ash">super.onCreate(savedInstanceState);</span><br/>&#13;
    <span class="ash">setContentView(R.layout.</span><span class="ash"><em>activity_main</em></span><span class="ash">);</span><br/>&#13;
    <span class="ash">txtGuess = (EditText) findViewById(R.id.</span><span class="ash"><em>txtGuess</em></span><span class="ash">);</span><br/>&#13;
    <span class="ash">btnGuess = (Button) findViewById(R.id.</span><span class="ash"><em>btnGuess</em></span><span class="ash">);</span><br/>&#13;
    <span class="ash">lblOutput = (TextView) findViewById(R.id.</span><span class="ash"><em>lblOutput</em></span><span class="ash">);</span><br/>&#13;
    newGame();</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_91"/>When the game starts up, the program will call the <code>newGame()</code> method and pick a random number for the user to guess. Now, we just need to handle the button click event and learn how to run the app on our own Android device or on the Android emulator.</p>&#13;
<h3 class="h3"><a id="toc_lev69"/>Handling Events in Android</h3>&#13;
<p class="noindent">In Eclipse, we were able to add an event listener to the guess button just by double-clicking it in the design view. Unfortunately, it’s not that easy in Android Studio, because the GUI layout is separate from the source code. Fortunately, Android Studio helps us add event listeners by providing <em>code completion</em> options, similar to the content assist feature in Eclipse.</p>&#13;
<p class="indent">To add a listener for button clicks, begin typing the following partial line of code inside the <code>onCreate()</code> method on the next line after the call to <code>newGame()</code>:</p>&#13;
<p class="pre">    <span class="ash">txtGuess = (EditText) findViewById(R.id.</span><span class="ash"><span class="codeitalic">txtGuess</span></span><span class="ash">);</span><br/>&#13;
    <span class="ash">btnGuess = (Button) findViewById(R.id.</span><span class="ash"><em>btnGuess</em></span><span class="ash">);</span><br/>&#13;
    <span class="ash">lblOutput = (TextView) findViewById(R.id.</span><span class="ash"><em>lblOutput</em></span><span class="ash">);</span><br/>&#13;
    <span class="ash">newGame();</span><br/>&#13;
    btnGuess.setOn</p>&#13;
<p class="indent">Android Studio’s code completion feature will pop up with a list of code recommendations, as shown in <a href="ch4.xhtml#ch4fig17">Figure 4-17</a>. Choose <code>setOnClickListener()</code> from the list of options and double-click to add it to your program.</p>&#13;
<p class="indent">Inside the parentheses for <code>btnGuess.setOnClickListener()</code>, type <span class="codestrong"><code>new</code></span> and start typing <span class="codestrong"><code>OnClickListener</code></span>. Android Studio’s code completion feature will display a list of options, as shown in <a href="ch4.xhtml#ch4fig18">Figure 4-18</a>.</p>&#13;
<p class="indent">Choose <code>OnClickListener</code> from the list of options, and you’ll see Android Studio adds a few extra lines of code. Your event listener code for the <code>btnGuess</code> button should now look like the following:</p>&#13;
<p class="pre">btnGuess.setOnClickListener(new View.OnClickListener() {<br/>&#13;
    @Override<br/>&#13;
    public void onClick(View v) {<br/>&#13;
    }<br/>&#13;
});</p>&#13;
<p class="indent">Look familiar? This is another example of an anonymous inner class. The desktop version also had an anonymous inner class, but it was named slightly differently. The two will work virtually identically. You may have noticed that Android inserts <code>@Override</code> in several places. This is called a <em>compiler directive</em>, and it tells the compiler that you’re implementing your own version of a method in the parent class.</p>&#13;
<div class="image"><span epub:type="pagebreak" id="page_92"/><img src="../images/f0092-01.jpg" alt="Image"/></div>&#13;
<p class="fig-cap"><em><a id="ch4fig17"/>Figure 4-17: Android Studio’s code completion feature suggests code as we type, similar to Eclipse’s content assist feature.</em></p>&#13;
<div class="image"><img src="../images/f0092-02.jpg" alt="Image"/></div>&#13;
<p class="fig-cap"><em><a id="ch4fig18"/>Figure 4-18: Use the code completion feature to create a new OnClickListener to add to the button btnGuess.</em></p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_93"/>When the user clicks the Guess! button, we need to check their guess against the secret number. Add <code>checkGuess();</code> inside the braces of the <code>onClick()</code> method.</p>&#13;
<p class="pre"><span class="ash">public void onClick(View v) {</span><br/>&#13;
    checkGuess();<br/>&#13;
<span class="ash">}</span></p>&#13;
<p class="indent">The guessing game mobile app is now ready for its first run. The fully functional code for this first version of the guessing game is shown here. Your version may differ slightly, perhaps with a couple of extra methods for handling menu items, but because we’re not using the menu, these have been removed for space (see <a href="ch5.xhtml#ch5">Chapter 5</a> to learn how to create options menus and settings):</p>&#13;
<p class="pre">package com.brysonpayne.guessinggame;<br/>&#13;
import android.os.Bundle;<br/>&#13;
import android.support.design.widget.FloatingActionButton;<br/>&#13;
import android.support.design.widget.Snackbar;<br/>&#13;
import android.support.v7.app.AppCompatActivity;<br/>&#13;
import android.support.v7.widget.Toolbar;<br/>&#13;
import android.view.View;<br/>&#13;
import android.view.Menu;<br/>&#13;
import android.view.MenuItem;<br/>&#13;
import android.widget.EditText;<br/>&#13;
import android.widget.Button;<br/>&#13;
import android.widget.TextView;<br/>&#13;
import org.w3c.dom.Text;<br/>&#13;
public class MainActivity extends AppCompatActivity {<br/>&#13;
    private EditText txtGuess;<br/>&#13;
    private Button btnGuess;<br/>&#13;
    private TextView lblOutput;<br/>&#13;
    private int theNumber;<br/>&#13;
    public void checkGuess() {<br/>&#13;
        String guessText = txtGuess.getText().toString();<br/>&#13;
        String message = "";<br/>&#13;
        try {<br/>&#13;
            int guess = Integer.<em>parseInt</em>(guessText);<br/>&#13;
            if (guess &lt; theNumber)<br/>&#13;
                message = guess + " is too low. Try again.";<br/>&#13;
            else if (guess &gt; theNumber)<br/>&#13;
                message = guess + " is too high. Try again.";<br/>&#13;
            else {<br/>&#13;
                message = guess +<br/>&#13;
                      " is correct. You win! Let's play again!";<br/>&#13;
                newGame();<br/>&#13;
            }<br/>&#13;
       } catch (Exception e) {<br/>&#13;
           message = "Enter a whole number between 1 and 100.";<br/>&#13;
       } finally {<br/>&#13;
           lblOutput.setText(message);<br/>&#13;
           txtGuess.requestFocus();<br/>&#13;
           txtGuess.selectAll();<br/>&#13;
       }<br/>&#13;
   }<br/>&#13;
   public void newGame() {<br/>&#13;
       theNumber = (int)(Math.<em>random</em>() * 100 + 1);<br/>&#13;
  }<br/>&#13;
  @Override<br/>&#13;
  protected void onCreate(Bundle savedInstanceState) {<br/>&#13;
      super.onCreate(savedInstanceState);<br/>&#13;
      setContentView(R.layout.<em>activity_main</em>);<br/>&#13;
      txtGuess = (EditText) findViewById(R.id.<em>txtGuess</em>);<br/>&#13;
      btnGuess = (Button) findViewById(R.id.<em>btnGuess</em>);<br/>&#13;
      lblOutput = (TextView) findViewById(R.id.<em>lblOutput</em>);<br/>&#13;
      newGame();<br/>&#13;
      btnGuess.setOnClickListener(new View.OnClickListener() {<br/>&#13;
          @Override<br/>&#13;
          public void onClick(View v) {<br/>&#13;
              checkGuess();<br/>&#13;
          }<br/>&#13;
      });<br/>&#13;
      Toolbar toolbar = (Toolbar) findViewById(R.id.<em>toolbar</em>);<br/>&#13;
      setSupportActionBar(toolbar);<br/>&#13;
  }<br/>&#13;
}</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_94"/>In the next two sections, you’ll learn how to run the app on the Android emulator and on real Android devices.</p>&#13;
<h3 class="h3"><a id="toc_lev70"/>Running the App on the Android Emulator</h3>&#13;
<p class="noindent">Now we have a working version of the Java code to run the app, but we still need to test it. Unlike the command line and desktop apps, the mobile app can’t run on a PC by itself, because PCs don’t have the Android operating system. To run your app for testing, you’ll need either an Android device or an emulator that will simulate an Android device on your PC. In this section, we’ll create an Android virtual device for testing your apps.</p>&#13;
<p class="indent">While viewing the <em>MainActivity.java</em> file, press the run button or select the menu item <strong>Run</strong> <span class="ent">▸</span> <strong>Run ‘app’</strong>. A pop-up window will ask you to select a <em>deployment target</em>, which is a device you want to run the app on, as shown in <a href="ch4.xhtml#ch4fig19">Figure 4-19</a>.</p>&#13;
<div class="image"><span epub:type="pagebreak" id="page_95"/><img src="../images/f0095-01.jpg" alt="Image"/></div>&#13;
<p class="fig-cap"><em><a id="ch4fig19"/>Figure 4-19: To run an Android app, you must choose a target device—either an emulator or an actual device.</em></p>&#13;
<p class="indent">Click the <strong>Create New Virtual Device</strong> button to begin configuring a new <em>Android virtual device (AVD)</em>. Let’s begin by choosing the type of device, as shown in <a href="ch4.xhtml#ch4fig20">Figure 4-20</a>. Then click <strong>Next</strong>.</p>&#13;
<div class="image"><img src="../images/f0095-02.jpg" alt="Image"/></div>&#13;
<p class="fig-cap"><em><a id="ch4fig20"/>Figure 4-20: Choose a device to emulate.</em></p>&#13;
<p class="indent">We’ll select a Nexus 6P to start with, but feel free to test out other devices. If you decide to develop your own app for the Google Play Store, you’ll want to test it across a variety of screen sizes and device types, so you can try setting up several different emulators. But let’s start small for now with just one.</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_96"/>Next, we need to select the system image, usually either x86 or ARM. We’ll be using an ARM image, so click the <strong>Other Images</strong> tab, as shown in <a href="ch4.xhtml#ch4fig21">Figure 4-21</a>.</p>&#13;
<div class="image"><img src="../images/f0096-01.jpg" alt="Image"/></div>&#13;
<p class="fig-cap"><em><a id="ch4fig21"/>Figure 4-21: You can choose either an x86 or ARM emulator; ARM is slower but tends to work more consistently on different types of processors.</em></p>&#13;
<p class="indent">If the Android version, API level, or emulator you want is displayed in a gray font, click the <strong>Download</strong> link for the version you want.</p>&#13;
<p class="indent">Click <strong>Next</strong> when you’ve chosen the Android emulator you want. For now, let’s use the Nougat API 24 ARM Android 7.0 version with Google APIs. You’ll see a final screen asking you to verify your configuration, including any advanced settings changes you want to make. Let’s change the name of the AVD, the device you’re emulating, to <em>My Nexus 6P</em>, as shown in <a href="ch4.xhtml#ch4fig22">Figure 4-22</a>.</p>&#13;
<p class="indent">If you have trouble getting your emulator to run on an older computer or on a computer with less than 8 GB of RAM, click <strong>Show Advanced Settings</strong>, scroll down to Memory and Storage, and change the RAM amount to <strong>768 MB</strong>.</p>&#13;
<div class="image"><span epub:type="pagebreak" id="page_97"/><img src="../images/f0097-01.jpg" alt="Image"/></div>&#13;
<p class="fig-cap"><em><a id="ch4fig22"/>Figure 4-22: Name your new AVD.</em></p>&#13;
<p class="indent">Click <strong>Finish</strong>, and your new device will be created and saved to disk. Now it’s time to start the emulator and try out your device. You should see the Select Deployment Target window again, but this time, it shows <em>My Nexus 6P</em> as an available emulator. Now click <strong>OK</strong>, as shown in <a href="ch4.xhtml#ch4fig23">Figure 4-23</a>.</p>&#13;
<div class="image"><img src="../images/f0097-02.jpg" alt="Image"/></div>&#13;
<p class="fig-cap"><em><a id="ch4fig23"/>Figure 4-23: Choose the emulator you just created as your deployment target.</em></p>&#13;
<p class="indent">After a few moments, you’ll see the message “Starting AVD,” followed by an emulator window that looks like an Android startup screen, as shown in <a href="ch4.xhtml#ch4fig24">Figure 4-24</a>. This could take <em>several</em> minutes the first time you run the emulator. When the emulator starts up, you might see a lock screen.</p>&#13;
<div class="image"><span epub:type="pagebreak" id="page_98"/><img src="../images/f0098-01.jpg" alt="Image"/></div>&#13;
<p class="fig-cap"><em><a id="ch4fig24"/>Figure 4-24: The Android emulator booting up (left); the Android virtual device’s home screen (right)</em></p>&#13;
<p class="indent">If your emulator shows a lock screen, click the lock at the bottom of the screen and drag it up to unlock the virtual device, similar to swiping the lock upward on an actual Android phone. You might see a welcome screen or two, but feel free to click out of those until you reach the home screen, which is shown in <a href="ch4.xhtml#ch4fig24">Figure 4-24</a>.</p>&#13;
<p class="indent">Now, go back to Android Studio and press the run button again. This time, you’ll see your AVD in the Select Deployment Target dialog (see <a href="ch4.xhtml#ch4fig25">Figure 4-25</a>). Choose your device and click <strong>OK</strong>.</p>&#13;
<div class="image"><img src="../images/f0098-02.jpg" alt="Image"/></div>&#13;
<p class="fig-cap"><em><a id="ch4fig25"/>Figure 4-25: The emulator appears in the list of connected devices when running.</em></p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_99"/>The project will build one more time, and then it will transfer the executable version of the app to the emulator. (You may be asked to update your Android SDK Tools the first time you run the emulator.) After a few minutes, you’ll see your guessing game app running on the emulator!</p>&#13;
<p class="indent">We’ve coded the full app, so you should be able to play the game right away on your emulator. Take a look at <a href="ch4.xhtml#ch4fig26">Figure 4-26</a> to see what a round of the game might look like on the app.</p>&#13;
<div class="image"><img src="../images/f0099-01.jpg" alt="Image"/></div>&#13;
<p class="fig-cap"><em><a id="ch4fig26"/>Figure 4-26: The guessing game app running on the emulator screen (left), after one guess (center), and after a winning guess (right).</em></p>&#13;
<p class="indent">It works just like the desktop app, but on an Android emulator. Use your keyboard to type a guess and your mouse to click the Guess! button. There are a couple more things we’ll do to improve the user experience, just like we did with the GUI desktop app, but our Android mobile app is fully functional!</p>&#13;
<p class="indent">Before we improve the UX, we’ll cover how to run the app on a real Android device. For now, leave your Android emulator open. You can minimize it when you’re not using it, but leave it running in the background while programming to avoid the long startup time.</p>&#13;
<div class="note">&#13;
<p class="notet"><span class="noteg"><strong>NOTE</strong></span></p>&#13;
<p class="notep"><em>If you don’t have an Android device, you can skip to “<a href="ch3.xhtml#toc_lev55">Improving the UX</a>” on <a href="ch4.xhtml#page_102">page 102</a>.</em></p>&#13;
</div>&#13;
<h3 class="h3"><span epub:type="pagebreak" id="page_100"/><a id="toc_lev71"/>Running the App on a Real Android Device</h3>&#13;
<p class="noindent">Running the app on a real Android device can take some time and preparation, but if you have a USB cable to connect your device to your computer, you’ll be up and running quickly.</p>&#13;
<h4 class="h4"><em><a id="toc_lev72"/>Preparing Your Device</em></h4>&#13;
<p class="noindent">Before you can deploy your own apps to your Android device, you have to enable Developer mode on the device. You’ll also need to change a couple of settings to allow you to develop and debug apps.</p>&#13;
<p class="indent">On your Android device, tap <strong>Settings</strong> and then scroll to the bottom of the Settings menu to find the About tablet, About phone, or About device section. At the bottom of the About screen, you’ll find the Build number entry. Tap the build number at least seven times to enable the secret Developer mode. Developer mode allows you to test the apps you develop on your own device. <a href="ch4.xhtml#ch4fig27">Figure 4-27</a> shows the Settings menu (left) and the About menu (center) with Developer mode unlocked.</p>&#13;
<p class="indent">After you’ve unlocked Developer mode, tap the back arrow in the upper-left corner of the About screen and open <strong>Settings</strong> <span class="ent">▸</span> <strong>Developer options</strong>. Make sure the Developer options are turned <strong>On</strong>, as shown in <a href="ch4.xhtml#ch4fig27">Figure 4-27</a> (right). You should also turn on USB debugging.</p>&#13;
<div class="image"><img src="../images/f0100-01.jpg" alt="Image"/></div>&#13;
<p class="fig-cap"><em><a id="ch4fig27"/>Figure 4-27: The Settings menu on an Android Nexus 7 tablet (left), the About menu (center), and the Developer options (right).</em></p>&#13;
<p class="indent">Now you’re ready to connect an Android phone, tablet, or other device to your computer and run your app.</p>&#13;
<h4 class="h4"><span epub:type="pagebreak" id="page_101"/><em><a id="toc_lev73"/>Connecting Your Device</em></h4>&#13;
<p class="noindent">To connect an Android device to your computer, you’ll need a USB cable, preferably the one that came with your phone or tablet. It should be a micro-USB cable, and it is often supplied as part of the charger for your device. Note that not all charger cables are fully functional USB cables—if your cable doesn’t work after you complete the following steps, try a different one.</p>&#13;
<p class="indent">Connect your device to your computer using the USB cable. After you plug in, the screen on your phone or tablet will show a window like the one in <a href="ch4.xhtml#ch4fig28">Figure 4-28</a> asking whether you want to allow USB debugging from the computer you just attached to. Tap <strong>OK</strong>. You can select the checkbox beside <strong>Always allow from this computer</strong> to prevent the pop-up next time you connect by USB to the same computer.</p>&#13;
<div class="image"><img src="../images/f0101-01.jpg" alt="Image"/></div>&#13;
<p class="fig-cap"><em><a id="ch4fig28"/>Figure 4-28: When you connect your Android device to your computer for the first time, it will ask whether you want to allow USB debugging.</em></p>&#13;
<p class="indent">Allowing USB debugging enables a couple of things. First, we’ll be able to transfer the apps we program right to the Android device by transferring an <em>Android package file (APK)</em>. This is usually much faster than running apps on an emulator, and it’s a better way to test how the apps will behave on a real device. Also, we’ll be able to debug apps using the USB connection, meaning we’ll get information back from the Android device to help us debug. This information will include errors and other log entries that we’ll be able to read in a console-like application (called <em>logcat</em> in Android Studio). This is similar to the console output we used to find bugs in our command line and desktop GUI Java apps.</p>&#13;
<p class="indent">Now that you’ve connected a real Android device to your computer, let’s see how to run the guessing game app on it!</p>&#13;
<h4 class="h4"><em><a id="toc_lev74"/>Running the App on Your Device</em></h4>&#13;
<p class="noindent">Now we’re ready to try the app on the Android device. In Android Studio, press the run button or go to <strong>Run</strong> <span class="ent">▸</span> <strong>Run ‘app’</strong>. This time, the Select Deployment Target window will show <em>two</em> connected devices to choose from, as shown in <a href="ch4.xhtml#ch4fig29">Figure 4-29</a>: your emulator (My Nexus 6P) and your real Android device.</p>&#13;
<div class="image"><span epub:type="pagebreak" id="page_102"/><img src="../images/f0102-01.jpg" alt="Image"/></div>&#13;
<p class="fig-cap"><em><a id="ch4fig29"/>Figure 4-29: If you’ve unlocked Developer mode, enabled USB debugging, and connected your device successfully, you should be able to select your Android device to run your app.</em></p>&#13;
<p class="indent">Choose your real Android device this time and click <strong>OK</strong>. Android Studio may take a moment to build the application, but once it transfers the APK file to your device, you’ll see the guessing game app open right up on your tablet or phone. Play a round or two to verify that it works just as it did on the emulator (maybe even better, or at least faster). Very cool!</p>&#13;
<p class="indent">You may notice one important difference right away: the bottom part of the screen is covered by the numeric keypad, as shown in <a href="ch4.xhtml#ch4fig30">Figure 4-30</a>.</p>&#13;
<p class="indent">When we placed the text field (<code>EditText</code>) for the user’s guess, we chose a Number text field for our input so the numeric keypad would show up. But since the emulator runs on a computer, which has its own keyboard, you probably didn’t see this when you ran your app earlier.</p>&#13;
<p class="indent">Now that we’re able to run Android apps on an Android phone, tablet, or other device, let’s make a few final improvements to the user experience for the guessing game app.</p>&#13;
<div class="image"><img src="../images/f0102-02.jpg" alt="Image"/></div>&#13;
<p class="fig-cap"><em><a id="ch4fig30"/>Figure 4-30: The app runs on your own Android device and shows the numeric keypad by default.</em></p>&#13;
<h3 class="h3"><a id="toc_lev75"/>Improving the UX</h3>&#13;
<p class="noindent">The guessing game app works beautifully on both the Android emulator and on real Android devices, but there are a few UX items we can improve upon. First, we’ll center the user’s guess in the Number text field. Second, <span epub:type="pagebreak" id="page_103"/>we’ll learn how to treat the <small>ENTER</small> key just like the Guess! button to make the app more intuitive to the user.</p>&#13;
<h4 class="h4"><em><a id="toc_lev76"/>Centering the User’s Guess in the Text Field</em></h4>&#13;
<p class="noindent">In Android Studio, open the <em>content_main.xml</em> layout file again. Select the text field, called <code>txtGuess</code>, by clicking it in the design preview. Under the Properties pane, find <strong>textAlignment</strong>. The <code>textAlignment</code> property in Android is similar to the <code>horizontalAlignment</code> property in the desktop GUI—it allows us to change the alignment of the text the user enters.</p>&#13;
<p class="indent">Click the center text alignment option, the icon that looks like centered text. If you want to test it in the design preview without running the app, scroll to find the <code>text</code> property and enter a value of <span class="codestrong"><code>50</code></span>. The number should appear centered in the text field in the design preview pane. Be sure to delete the test value if you don’t want it to show up in the actual app.</p>&#13;
<h4 class="h4"><em><a id="toc_lev77"/>Adding a Listener for the Enter Key</em></h4>&#13;
<p class="noindent">Let’s set up an event listener to handle the <small>ENTER</small> key the same way we handled a click on the Guess! button, with a call to <code>checkGuess()</code>.</p>&#13;
<p class="indent">Go back to the <em>MainActivity.java</em> source code file, scroll down to the <code>onCreate()</code> method, and find where we added an <code>onClickListener</code> to the button <code>btnGuess</code>. (You may need to <em>expand</em> the event listener code by clicking the + in the left margin beside <code>btnGuess.setOnClickListener()</code> to make it look like the code shown here.) Right below that, we can add an event listener to the text field <code>txtGuess</code> to handle action events such as pressing the <small>ENTER</small> key. The following code adds a listener to <code>txtGuess</code>:</p>&#13;
<p class="pre"><span class="ash">btnGuess.setOnClickListener(new View.OnClickListener() {</span><br/>&#13;
    <span class="ash">public void onClick(View v) {</span><br/>&#13;
        <span class="ash">checkGuess();</span><br/>&#13;
    <span class="ash">}</span><br/>&#13;
<span class="ash">});</span><br/>&#13;
txtGuess.setOnEditorActionListener(new TextView.OnEditorActionListener() { <br/>&#13;
    @Override<br/>&#13;
    public boolean onEditorAction(TextView v, int actionId, KeyEvent event) {<br/>&#13;
        checkGuess();<br/>&#13;
      <span class="ent">➊</span> return true;<br/>&#13;
    }<br/>&#13;
});</p>&#13;
<p class="indent">The <em>editor action</em> we’re listening for is when the user presses the <small>ENTER</small> key while typing in the text field. When that event happens, we want to check the guess the user entered.</p>&#13;
<p class="indent">We changed the <code>return</code> statement to return a value of <code>true</code> <span class="ent">➊</span> because we want to keep the keyboard on the screen so the user can enter their next guess. The <code>return</code> statement tells the text field whether the event handler code <span epub:type="pagebreak" id="page_104"/>we’ve provided completed the event. By returning the value <code>true</code>, we’ve told Android that we’ve done everything that needs to be done to check the user’s guess. If we returned <code>false</code> here instead, Android would finish processing the <small>ENTER</small> key by removing the number keypad from the screen—as it does by default when you finish typing in a form on a web page. We don’t want the keypad to disappear after every guess, so we return <code>true</code>.</p>&#13;
<h4 class="h4"><em><a id="toc_lev78"/>Adding One More Finishing Touch</em></h4>&#13;
<p class="noindent">Run the app a few times to test it, and you’ll see the <small>ENTER</small> key allows you to enter and check guesses quickly and efficiently. You’ll also see your guesses centered nicely in the text field. However, when you win, depending on the API version, screen size, or density of your device, you may see an alignment problem like the one shown in <a href="ch4.xhtml#ch4fig31">Figure 4-31</a>.</p>&#13;
<p class="indent">The problem is that the <code>TextView</code> named <code>lblOutput</code> resizes to show the longer “You win! Let’s play again!” text, and some older APIs may not center this correctly. You can prevent this by expanding <code>lblOutput</code> to the full width of the screen in the design preview and by changing the <code>textAlignment</code> property to <code>center</code>. Now you have a complete guessing game app to play on your device and to share with friends! The final version 1.0 of the app is shown running on a Nexus 7, with Font settings at Large, in <a href="ch4.xhtml#ch4fig32">Figure 4-32</a>.</p>&#13;
<div class="image"><img src="../images/f0104-01.jpg" alt="Image"/></div>&#13;
<p class="fig-cap"><em><a id="ch4fig31"/>Figure 4-31: If you notice misaligned text, you may need to expand and center the TextView <code>lblOutput</code>.</em></p>&#13;
<div class="image"><img src="../images/f0104-02.jpg" alt="Image"/></div>&#13;
<p class="fig-cap"><em><a id="ch4fig32"/>Figure 4-32: Your finished version 1.0 of the mobile app, with all the user experience improvements in place</em></p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_105"/>Wow! You’ve gone from a simple, text-based, command line number-guessing program, to a sophisticated GUI desktop game, to a fully featured mobile app that runs on real Android devices. Are you starting to see the power and flexibility of Java? And in <a href="ch5.xhtml#ch5">Chapter 5</a>, we’ll make the app even more professional with a settings menu and the ability to store user preferences!</p>&#13;
<h3 class="h3"><a id="toc_lev79"/>What You Learned</h3>&#13;
<p class="noindent">You’ve seen that much of the Java code used in a text-based and GUI desktop program can build the foundation of a modern mobile app, thanks to Java’s reusability across multiple platforms. We have also picked up several new mobile-specific skills in this chapter:</p>&#13;
<p class="bull">• Starting a new Android Studio app project</p>&#13;
<p class="bull">• Building the GUI layout in design view in Android Studio, including changing the properties of various elements in the Properties pane</p>&#13;
<p class="bull">• Naming GUI components in a layout for easy use in Java code</p>&#13;
<p class="bull">• Connecting the Android GUI layout elements to your Java code</p>&#13;
<p class="bull">• Adding your own methods, such as <code>checkGuess()</code> and <code>newGame()</code>, to an Android app</p>&#13;
<p class="bull">• Reusing Java code in an Android app</p>&#13;
<p class="bull">• Handling events in Android, including button clicks and keyboard/editor actions such as pressing the <small>ENTER</small> key</p>&#13;
<p class="bull">• Testing apps by running them on an Android virtual device using the Android emulator</p>&#13;
<p class="bull">• Running an app on an Android phone, tablet, or other device by enabling Developer mode and USB debugging</p>&#13;
<p class="bull">• Improving the user experience by changing widget properties and adding user-friendly finishing touches</p>&#13;
<h3 class="h3"><a id="toc_lev80"/>Programming Challenges</h3>&#13;
<p class="noindent">Try these programming challenge exercises to review and practice what you’ve learned and to expand your programming skills by trying something new. If you get stuck, visit <em><a href="https://www.nostarch.com/learnjava/">https://www.nostarch.com/learnjava/</a></em> to download sample solutions.</p>&#13;
<h4 class="h4"><span epub:type="pagebreak" id="page_106"/><em><a id="toc_lev81"/>#1: “Toast”-ing to the Number of Tries</em></h4>&#13;
<p class="noindent">In the programming challenges for</p>&#13;
<p class="indent"><a href="ch3.xhtml#ch3">Chapter 3</a>, you changed the winning message to tell the user how many tries they took to win:</p>&#13;
<p class="pre">62 is correct! You win after 7 tries!</p>&#13;
<p class="indent">Let’s do something similar for the Android version, with a twist—or, should I say, a <em>Toast</em>? A Toast is an Android widget for creating pop-up message windows. Toast pop-ups are a convenient way to show a quick notice, such as an error or a note telling the user they’ve won the game. See the Toast message near the bottom of the screen in <a href="ch4.xhtml#ch4fig33">Figure 4-33</a>.</p>&#13;
<div class="image"><img src="../images/f0106-01.jpg" alt="Image"/></div>&#13;
<p class="fig-cap"><em><a id="ch4fig33"/>Figure 4-33: A Toast message pops up on the screen to alert the user to important information.</em></p>&#13;
<p class="indent">You can create a Toast message popup with the <code>Toast.makeText()</code> method. Here’s a sample to help you add a Toast pop-up to the <code>else</code> statement for winning the game:</p>&#13;
<p class="pre"><span class="ash">else {</span><br/>&#13;
    <span class="ash">message = guess +</span><br/>&#13;
            <span class="ash">" is correct. You win after " + numberOfTries + " tries!";</span><br/>&#13;
    Toast.<em>makeText</em>(MainActivity.this, message,<br/>&#13;
            Toast.<em>LENGTH_LONG</em>).show();<br/>&#13;
    <span class="ash">newGame();</span><br/>&#13;
<span class="ash">}</span></p>&#13;
<p class="indent">The Toast message in this code will pop up over the <code>MainActivity</code> (our guessing game), displaying the <code>String</code> <code>message</code> for a few seconds thanks to <code>Toast.LENGTH_LONG</code>. There’s also a <code>Toast.LENGTH_SHORT</code>, but it pops up and disappears so quickly that it can be hard to read. The <code>.show()</code> method at the end does the important part, showing the Toast on the screen.</p>&#13;
<p class="indent">As with the GUI desktop version, to accomplish this task, you’ll need to create a new variable at the top of your class (like <code>int numberOfTries = 0;</code>), add to the number of tries every time the <code>checkGuess()</code> method runs successfully, and change the output <code>message</code> to display the number of tries to the user when they win, both in a Toast pop-up and in the <code>lblOutput</code> field. After counting the number of tries, add the features you learned in <a href="ch3.xhtml#ch3">Chapter 3</a> for running out of tries or losing. Give the user seven tries and tell them how many tries are left after each guess.</p>&#13;
<h4 class="h4"><span epub:type="pagebreak" id="page_107"/><em><a id="toc_lev82"/>#2: Adding Visual Appeal</em></h4>&#13;
<p class="noindent">Explore some of the more aesthetic properties of the GUI components in Android Studio, including background colors, foreground colors, fonts, <code>textSize</code>, and more. Move components in your guessing game app around to make the interface more visually appealing. For an example of one way you could customize your game, see <a href="ch4.xhtml#ch4fig34">Figure 4-34</a>.</p>&#13;
<p class="indent">You can even add a custom background image (add an image file to the <em>app</em> <span class="ent">▸</span> <em>res</em> <span class="ent">▸</span> <em>drawable</em> folder and then select it as the <code>background</code> property for your layout or for a button or other component). Play with various settings—you can always undo by pressing <small>CTRL</small>-Z!</p>&#13;
<div class="image"><img src="../images/f0107-01.jpg" alt="Image"/></div>&#13;
<p class="fig-cap"><em><a id="ch4fig34"/>Figure 4-34: Changing the colors, fonts, text size, and arrangement of the components in your app can make it stand out!</em></p>&#13;
<h4 class="h4"><em><a id="toc_lev83"/>#3: Creating a MadLibs Mobile App</em></h4>&#13;
<p class="noindent">Look back at the <em>MadLibGUI.java</em> program you built in <a href="ch3.xhtml#ch3">Chapter 3</a> (Programming Challenge #3 on <a href="ch3.xhtml#page_74">page 74</a>). Now create a mobile version of your MadLibs app that prompts the user for several words in a GUI with labels and text fields, such as <code>txtBigAnimal</code>, <code>txtPastTenseVerb</code>, <code>txtSmallContainer</code>, and <code>txtFood</code>. Add a button that the user can press to generate their own MadLibs-style story. It may be a nice touch to include some default or initial text in each text field, just to give the user an idea of how the program works.</p>&#13;
<p class="indent">When the user clicks the button, the program should display the completed MadLibs story in a <code>TextView</code> or in an <code>EditText</code> widget—the <code>EditText</code> makes it possible to copy and paste the user’s funny story if they wish to share it. Play with the colors, fonts, and layout until you’re happy with the result and then share your creation with a friend!</p>&#13;
<div class="note">&#13;
<p class="notet"><span class="noteg"><strong>HINT</strong></span></p>&#13;
<p class="notep"><em>To make a TextView or EditText show multiple lines, use the escape character sequence \n to insert a new line in the String message you display using the setText() method, like so: "Once upon a time... \n There was a buffalo princess \n who lived in a soup can." This quote will span three lines, separated by new lines wherever the \n escape sequence appears.</em></p>&#13;
</div>&#13;
<span epub:type="pagebreak" id="page_108"/>&#13;
</body></html>