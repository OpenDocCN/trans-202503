<html><head></head><body>
<h2 class="h2" id="ch09"><span epub:type="pagebreak" id="page_141"/>9<br/>PI SPY PART 2: WI-FI AND BLUETOOTH TRACKING</h2>&#13;
<p class="noindent"><span class="big1">YOU CAN USE YOUR NEW RASPBERRY PI SKILLS TO SPY ON WHOEVER IS IN YOUR HOUSE BY LOCATING SIGNALS FROM THEIR TECHNOLOGY. ALMOST EVERYONE HAS A SMARTPHONE, TABLET, OR ANOTHER DEVICE THAT TRANSMITS A LOT OF UNSEEN DATA IN THEIR VICINITY. YOU’LL USE THIS DATA TO DETECT WHO IS AROUND.</span></p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_142"/>You’ll use your Raspberry Pi to detect devices through both your internet router and Bluetooth. You’ll send data from your Raspberry Pi to each device via the internet router or Bluetooth and retrieve information including the device’s name, the device’s type, whether it’s connected, and then whether the person who owns the device is around. This assumes that each device is owned by one person and not, say, shared among the family. Otherwise, knowing who’s around is much harder!</p>&#13;
<p class="indent">You’ll then create an LED visual display board indicator, or <em>status board</em>, that lights up when a user is in the home and goes off when the user is absent (<a href="ch09.xhtml#ch09fig01">Figure 9-1</a>).</p>&#13;
<div class="image"><img alt="Image" src="../images/09fig01.jpg"/></div>&#13;
<p class="figcap" id="ch09fig01"><strong>FIGURE 9-1</strong> A finished status board</p>&#13;
<h3 class="h3" id="ch09lev1sec1">WHAT YOU’LL NEED</h3>&#13;
<ul>&#13;
<li class="noindent">Raspberry Pi Zero W or Raspberry Pi 4 (suggested)</li>&#13;
<li class="noindent">10 female-to-female jumper wires</li>&#13;
<li class="noindent">5 LEDs—or the same number of LEDs as devices you want to track</li>&#13;
<li class="noindent">5 resistors (220 to 330 ohms)</li>&#13;
<li class="noindent">Cardboard</li>&#13;
<li class="noindent">Pictures (optional)</li>&#13;
<li class="noindent">Masking tape (optional)</li>&#13;
<li class="noindent">Push button</li>&#13;
</ul>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_143"/>You can use pictures of your family members or, to disguise the purpose of the status board, random pictures to represent each family member, as I have in <a href="ch09.xhtml#ch09fig01">Figure 9-1</a>.</p>&#13;
<h3 class="h3" id="ch09lev1sec2">CREATING YOUR STATUS BOARD</h3>&#13;
<p class="noindent">Let’s begin by creating the status board that will indicate who is in the vicinity.</p>&#13;
<p class="indent">If you have one, the Raspberry Pi Zero W is the best size for mounting onto the back of your status board, because it’s the smallest Pi. If you’re using a bigger Pi, such as the model 4, you might have to put it next to the status board on a sturdy surface. However, if you do use the Zero W, you may find it easier to make the project by using a model 4 and then transfering the SD card to your Pi Zero W.</p>&#13;
<h4 class="h4" id="ch09lev2sec1">Wiring Up the LEDs</h4>&#13;
<p class="noindent">Take one of the five LEDs and locate the longer (positive) leg. Wrap one leg from a resistor around this LED leg so that it’s tight and secure, as shown in <a href="ch09.xhtml#ch09fig02">Figure 9-2</a>. Now attach one end of a female-to-female jumper wire to the shorter (negative) leg of the LED. Attach the other female-to-female jumper wire to the resistor wire. Repeat this step for all five LEDs.</p>&#13;
<div class="image"><img alt="Image" src="../images/09fig02.jpg"/></div>&#13;
<p class="figcap" id="ch09fig02"><strong>FIGURE 9-2</strong> Wiring up an LED</p>&#13;
<h4 class="h4" id="ch09lev2sec2">Adding the LEDs to the Board</h4>&#13;
<p class="noindent">On the cardboard you’re using for your status board, lightly mark each location where you want to place an LED. If you’re attaching the Raspberry Pi to the board, ensure that you leave enough space for the Pi and all the wires. Carefully pierce a small hole in the board at <span epub:type="pagebreak" id="page_144"/>each previously marked location to hold each LED in place. You can use a pen or screwdriver to do this. Push each LED through a hole. Stick them down with masking tape to keep things neat and tidy, as well as to reduce the possibility of the wires touching each other and causing a short-out. The back of your status board should look similar to <a href="ch09.xhtml#ch09fig03">Figure 9-3</a>. Each of the numbers refers to the GPIO pin that the LED is connected to. (See the table on the next page for the GPIO pin numbers.) For example, the LED on the left, LED 1, is connected to GPIO 4.</p>&#13;
<div class="image"><img alt="Image" src="../images/09fig03.jpg"/></div>&#13;
<p class="figcap" id="ch09fig03"><strong>FIGURE 9-3</strong> Attaching the LEDs to the status board</p>&#13;
<p class="indent">You can now add your own touches to the front of the board. Perhaps add photos to represent the members of your home, and decorate it to suit your style and taste.</p>&#13;
<h4 class="h4" id="ch09lev2sec3">Connecting the LEDs to the Raspberry Pi</h4>&#13;
<p class="noindent">To power each LED, you need to take the longer, positive leg that has the resistor wrapped around it and attach its jumper wire to a GPIO pin. (Any one will work fine, but I suggest using the ones in the following table.) Then take the shorter, negative leg and attach its jumper wire to a ground GPIO pin labeled <em>GND</em>. <a href="ch09.xhtml#ch09fig04">Figure 9-4</a> shows these connections. The GND pins are located at physical pins 6, 9, 14, 20, 25, 30, 34, and 39. You can use any of these.</p>&#13;
<div class="image"><span epub:type="pagebreak" id="page_145"/><img alt="Image" src="../images/09fig04.jpg"/></div>&#13;
<p class="figcap" id="ch09fig04"><strong>FIGURE 9-4</strong> Connecting an LED to the Raspberry Pi</p>&#13;
<p class="indent">Now do the same for all your other LEDs to wire them up to the Raspberry Pi board (<a href="ch09.xhtml#ch09fig05">Figure 9-5</a>). The following table shows which GPIO pins to use.</p>&#13;
<table class="table1">&#13;
<colgroup>&#13;
<col style="width:50%"/>&#13;
<col style="width:50%"/>&#13;
</colgroup>&#13;
<thead>&#13;
<tr>&#13;
<td class="table-h" style="vertical-align: top;"><p class="tab_th"><strong>ITEM</strong></p></td>&#13;
<td class="table-h1" style="vertical-align: top;"><p class="tab_th"><strong>GPIO</strong></p></td>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td class="table-b1" style="vertical-align: top;"><p class="tabc"><span class="purple">LED 1</span></p></td>&#13;
<td class="table-b1a" style="vertical-align: top;"><p class="tabc"><span class="purple">4</span></p>&#13;
</td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table-b1" style="vertical-align: top;"><p class="tabc"><span class="purple">LED 2</span></p></td>&#13;
<td class="table-b1a" style="vertical-align: top;"><p class="tabc"><span class="purple">18</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table-b1" style="vertical-align: top;"><p class="tabc"><span class="purple">LED 3</span></p></td>&#13;
<td class="table-b1a" style="vertical-align: top;"><p class="tabc"><span class="purple">24</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table-b1" style="vertical-align: top;"><p class="tabc"><span class="purple">LED 4</span></p></td>&#13;
<td class="table-b1a" style="vertical-align: top;"><p class="tabc"><span class="purple">7</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table-b1" style="vertical-align: top;"><p class="tabc"><span class="purple">LED 5</span></p></td>&#13;
<td class="table-b1a" style="vertical-align: top;"><p class="tabc"><span class="purple">26</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table-b1" style="vertical-align: top;"><p class="tabc"><span class="purple">Shutdown button</span></p></td>&#13;
<td class="table-b1a" style="vertical-align: top;"><p class="tabc"><span class="purple">16</span></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<p class="indent">The last set of wires is for the shutdown button, which, when pressed, will power down the Raspberry Pi. Add a jumper wire to GPIO 16 and another one to a GND pin. If you need to, you can connect the LED to any of the pins, except for the 3V and 5V pins (1, 2, 4, and 17), depending on where your LEDs and Pi are positioned on the board. For example, if your Raspberry Pi is in the middle of the board, you may want to use GPIO 2, 3, 4, 14, 15, or 18 for the LEDs located to the right side and 13, 19, 26, 16, 20, or 21 for LEDs on the left. The other end of the LED is attached to one of the ground <span epub:type="pagebreak" id="page_146"/>pins to complete the circuit. If you do use different GPIO numbers or add more LEDs, take note of each GPIO pin number and its corresponding LED, as you’ll need them later when you code with Python.</p>&#13;
<div class="image"><img alt="Image" src="../images/09fig05.jpg"/></div>&#13;
<p class="figcap" id="ch09fig05"><strong>FIGURE 9-5</strong> Wiring up all the LEDs and the button</p>&#13;
<h4 class="h4" id="ch09lev2sec4">Attaching the Raspberry Pi</h4>&#13;
<p class="noindent">Most Raspberry Pis come with four small screw points, one in each corner of the board. These are perfect for mounting the Pi onto the status board. You can use either small screws to screw the Pi in place or adhesive glue dots to secure it. Use the screws if you want to remove the Raspberry Pi and use it for something else in the future.</p>&#13;
<h3 class="h3" id="ch09lev1sec3">TRACKING DEVICES WITH IP ADDRESSES</h3>&#13;
<p class="noindent">First, you’ll set the Pi to track your house members through their IP addresses. Take a moment to consider the enormous number of devices that use the internet: mobile phones, smart TVs, game consoles, smart watches, refrigerators, cars, tablets, and alarm systems, just to name a few. With so many devices connected, how does the correct data get to the correct device? How does the data for a video you’re streaming, for example, know to be sent to your tablet while someone else in the house is checking email or listening to music?</p>&#13;
<p class="indent">Well, every device connected to the internet is given an Internet Protocol (IP) address. From the outside, these addresses work similarly to zip codes: they indicate a set of devices within a certain <em>network</em>—your network will be your shared internet connection. From inside this network, each device is given its own unique IP address so the router knows what information to send where.</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_147"/>An IP address is made up of four sets of numbers: for example, 192.168.1.24. At last count, about 340 trillion trillion trillion IPv6 addresses were in use!<sup><a href="footnote.xhtml#ch09fn01" id="rch09fn01">1</a></sup></p>&#13;
<p class="indent">You’ll use the individual IP addresses of the devices on your network to check whether each device is nearby. Because your Raspberry Pi is connected to your home network, it will have its own IP address. Let’s discover what that is.</p>&#13;
<h3 class="h3" id="ch09lev1sec4">FINDING YOUR IP ADDRESS</h3>&#13;
<p class="noindent">Open the terminal and enter the following, which should give you some information about your network:</p>&#13;
<pre><span class="codegreen">pi@raspberrypi</span>:- <span class="codeblue">$</span> <span class="codestrong1">hostname –I</span></pre>&#13;
<p class="indent">This displays the IP address of your Raspberry Pi. In <a href="ch09.xhtml#ch09fig06">Figure 9-6</a>, my IP address is 192.168.1.171.</p>&#13;
<div class="image"><img alt="Image" src="../images/09fig06.jpg"/></div>&#13;
<p class="figcap" id="ch09fig06"><strong>FIGURE 9-6</strong> Getting the Raspberry Pi’s IP address</p>&#13;
<h3 class="h3" id="ch09lev1sec5">FINDING THE IP ADDRESSES OF OTHER DEVICES</h3>&#13;
<p class="noindent">There are two methods for finding the IP addresses of the other devices on your network. The first is to use an app such as Fing from your phone or tablet, and the second is to use a program called Nmap from your Pi.</p>&#13;
<h4 class="h4" id="ch09lev2sec5"><span epub:type="pagebreak" id="page_148"/>Using Fing</h4>&#13;
<p class="noindent"><em>Fing</em> will scan your router and network and return all the IP addresses, plus the name and the manufacturer of all connected devices. Write down this information so you can use it later in the program code. If you want to take this simpler route, download Fing to your phone or other device, and follow instructions at <em><a href="http://www.fing.io">www.fing.io</a></em>.</p>&#13;
<h4 class="h4" id="ch09lev2sec6">Using Nmap</h4>&#13;
<p class="noindent">Alternatively, you can write a small Python program on your Pi to scan and return the addresses. This has an advantage: you can copy and paste the numbers straight into the main program and not risk mistyping them. To do this, you’ll use a program called Nmap.</p>&#13;
<h5 class="h5">Installing Nmap</h5>&#13;
<p class="noindent"><em>Nmap (Network Mapper)</em> is a scanner used to discover devices and services on a computer network. Nmap sends a specific packet of data to the router and then analyzes the responses to build a table of information about the connected devices. From this table, the program builds a map of your network. To install Nmap, open the terminal window and enter the following:</p>&#13;
<pre><span class="codegreen">pi@raspberrypi</span>:- <span class="codeblue">$</span> <span class="codestrong1">sudo apt install nmap</span></pre>&#13;
<p class="indent">Nmap commands are executed from the terminal, so to use Python and the features of Nmap, you need to install a Python wrapper. A <em>wrapper</em> is a program that enables you to write Python code in the terminal to control some software. In the terminal, enter this:</p>&#13;
<pre><span class="codegreen">pi@raspberrypi</span>:- <span class="codeblue">$</span> <span class="codestrong1">sudo pip3 install python-nmap</span></pre>&#13;
<h5 class="h5">Writing a Program to Find the IP Addresses</h5>&#13;
<p class="noindent">Now that you have Nmap installed, you can write a Python program to search for the IP addresses of connected devices. Open IDLE and start a new Python file. Add the code in <a href="ch09.xhtml#ch09ex01">Listing 9-1</a> and save it. Before you run it, make sure your own phone or other device is connected to the router, because you’ll use your device as the tester for the final code.</p>&#13;
<pre><span class="ent">❶</span> <span class="codeorg">import</span> nmap&#13;
<span class="ent">❷</span> nm = nmap.PortScanner()&#13;
<span class="ent">❸</span> data = nm.scan(hosts=<span class="codegreen1">'192.168.1.0/24'</span>, arguments= <span class="codegreen1">'-sP'</span>)&#13;
   <span class="codepurple">print</span> (data[<span class="codegreen1">'scan'</span>])&#13;
   <span class="codepurple">print</span> (<span class="codegreen1">""</span>)&#13;
<span class="ent">❹</span> <span class="codeorg">for</span> host <span class="codeorg">in</span> nm.all_hosts():&#13;
    <span class="ent">❺</span> <span class="codepurple">print</span> (<span class="codegreen1">'Host : %s (%s)'</span> % (host, nm[host].hostname()))</pre>&#13;
<p class="caption"><a id="ch09ex01"/><strong>LISTING 9-1</strong> Nmap scanning program</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_149"/>Start by importing the <span class="literal">nmap</span> library <span class="ent">❶</span> and then create the variable <span class="literal">nm</span> to hold the <span class="literal">PortScanner()</span> function <span class="ent">❷</span> from the <span class="literal">nmap</span> library. This function, as you might have guessed, scans ports!</p>&#13;
<p class="indent">Next, add the code to scan the router <span class="ent">❸</span>. Most routers have a generic IP address that’s standard across all of them. This line scans all IP addresses in the range from 192.168.1.0 to 192.168.1.24 and then retrieves the data that each IP address holds about the connected devices.</p>&#13;
<p class="indent">However, you may need to check the IP range for your particular router and change the range to reflect this. For example, your router’s IP address range may start from 192.168.0.1, or you may have configured your own custom range. If in doubt, refer to the service provider’s guidance and documentation.</p>&#13;
<p class="indent">Now use a <span class="literal">for</span> loop to cycle through all the hosts (the devices) that have been found <span class="ent">❹</span>. This will provide you with the IP address as well as the name of each device that is currently connected to the router or was previously connected (many routers keep a list of all previously connected devices).</p>&#13;
<p class="indent">The list you retrieve provides lots of details about the devices, so you’ll print this out <span class="ent">❺</span> to help you identify each device. Once you’ve entered and saved the program, press <strong>F5</strong> to run it and you’ll be presented with a list of connected devices and IP addresses in the Python editor window, like the one in <a href="ch09.xhtml#ch09ex02">Listing 9-2</a>.</p>&#13;
<pre>Python 3.5.3&#13;
[GCC 6.3.0 20170124] on linux&#13;
Type "copyright", "credits" or "license()" for more information.&#13;
&gt;&gt;&gt;&#13;
=== RESTART: /home/pi/find_ipadresses.py ===&#13;
{'192.168.1.1': {'addresses': {'ipv4': '192.168.1.1'}, 'hostnames':&#13;
[{'name': 'TestBox.cc', 'type': 'PTR'}], 'vendor': {}, 'status':&#13;
{'reason': 'syn-ack', 'state': 'up'}}, '192.164.1.xxx':&#13;
{'addresses': {'ipv4': '192.168.1.xxx'}, 'hostnames': [{'name': '',&#13;
'type': ''}], 'vendor': {}, 'status': {'reason': 'conn-refused',&#13;
'state': 'up'}}}</pre>&#13;
<p class="caption"><a id="ch09ex02"/><strong>LISTING 9-2</strong> The IP addresses that have been found</p>&#13;
<p class="indent">Copy and paste your details into a text document or a new Python file. If you paste into a Python file, remember to add a <span class="literal">#</span> before each line to comment it out—this will stop any errors when the program runs. Now, try to identify whom each device belongs to and note the additional information next to the device name. You <span epub:type="pagebreak" id="page_150"/>might be able to make the identification from the device name, or you could quickly check who is in the house and use a process of elimination. For example, if you have two iPhone users in the house, and one phone is showing up, check the model number. If a person is out, you know that any phone that shows up is not theirs. Some users will make it easy for you by using their real name for their device name. You should also make a note of which device is yours.</p>&#13;
<p class="indent">Remember that in an ideal situation, the devices will be connected to the router and will return the current IP address. But IP addresses can change when the router is turned off or reset, so any devices in your home that are turned off may show up as their previous IP address. It’s best to wait until they go back online before you collect the addresses.</p>&#13;
<h3 class="h3" id="ch09lev1sec6">WRITING THE STATUS BOARD CODE</h3>&#13;
<p class="noindent">Now that you have a list of IP addresses, devices, and users, you can create the program that combines this information with the electronics in your status board to spy on who is present in your home. If you’re using a Pi Zero W, you’ll need to SSH in (see “Accessing the Raspberry Pi via SSH” on <a href="ch01.xhtml#page_25">page 25</a>) or use a remote desktop application to access your Pi. Otherwise, you could write and test the code in this section on a Raspberry Pi and then transfer its SD card to your Pi Zero W.</p>&#13;
<p class="indent">In Python code, you’d typically group common elements like LEDs together. Our code, though, will make more sense if you group the code by each person or device; that way, you can easily add LEDs and check for more people. That’s what you’ll do here.</p>&#13;
<p class="indent">This program uses the <span class="literal">gpiozero</span> library and the <span class="literal">PingServer()</span> class, which sends out pings. But what is a ping? You can think of a <em>ping</em> as a request that’s sent to your router. The request is made up of packets of data, represented as a string of zeros and ones, which request information from your router about all of the devices that are connected to it. The router then sends that information back to your Pi and the Python program. In this project, the data is sent back to your Raspberry Pi. You’ll use this information to find out who is around.</p>&#13;
<h4 class="h4" id="ch09lev2sec7">Setting Up and Identifying the First Device</h4>&#13;
<p class="noindent">Open your Python editor and add the code shown in <a href="ch09.xhtml#ch09ex03">Listing 9-3</a>.</p>&#13;
<p class="noindent">Then save it as <em>wifi_spy.py</em>.</p>&#13;
<pre><span class="ent">❶</span> <span class="codeorg">from</span> gpiozero <span class="codeorg">import</span> PingServer, LED, Button&#13;
<span class="ent">❷</span> <span class="codeorg">from</span> subprocess <span class="codeorg">import</span> check_call()&#13;
<span class="ent">❸</span> <span class="codeorg">from</span> signal <span class="codeorg">import</span> pause&#13;
&#13;
<span class="ent">❹</span> <span class="codeorg">def</span> <span class="codeblue1">shutdown</span>():&#13;
    check_call()([<span class="codegreen1">'sudo'</span>, <span class="codegreen1">'poweroff'</span>])&#13;
   &#13;
   <span class="codered"># first device apple phone</span>&#13;
<span class="ent">❺</span> <span class="codeitalic1">frank</span> = PingServer(<span class="codegreen2">'192.168.1.1'</span>) <span class="codered"># hub</span>&#13;
<span class="ent">❻</span> led = LED(4)</pre>&#13;
<p class="caption"><a id="ch09ex03"/><span epub:type="pagebreak" id="page_151"/><strong>LISTING 9-3</strong> Setting up and finding the first device</p>&#13;
<p class="indent">First, import the required functions <span class="ent">❶</span> from the <span class="literal">gpiozero</span> library. You need <span class="literal">PingServer()</span> to retrieve the data from the router, the <span class="literal">LED</span> class to control the LEDs, and the <span class="literal">Button</span> module to add the button function to shut down the board.</p>&#13;
<p class="indent">You also need to import <span class="literal">check_call()</span> from the <span class="literal">subprocess</span> library <span class="ent">❷</span>. This lets you use commands in the terminal to control the Raspberry Pi, and you’ll use this to let you shut down the Pi from the terminal.</p>&#13;
<p class="indent">Finally, import <span class="literal">pause</span> from the <span class="literal">signal</span> library so you can keep the program running continuously <span class="ent">❸</span>.</p>&#13;
<p class="indent">Next, create a <span class="literal">shutdown()</span> function that holds the code for shutting down the Pi <span class="ent">❹</span>. This uses the <span class="literal">check_call()</span> command to run the command <span class="literal">sudo poweroff</span>, which turns off the Pi.</p>&#13;
<p class="indent">Now you can start detecting people! I’ve put in a comment to help keep track of each person that the device and LED in the status board refers to; you should change this comment to reflect the first device in your house.</p>&#13;
<p class="indent">Create a variable to hold the details of the first IP address you check <span class="ent">❺</span>. You should name the variable after the user of the device, which you figured out in “Finding the IP Addresses of Other Devices” on <a href="ch09.xhtml#page_147">page 147</a>. This variable contains the command to ping the router and the device’s IP address. In place of the IP address I’ve put here, take the first IP address from the list you got earlier using Fing or Nmap and place that in the brackets, remembering the quote marks.</p>&#13;
<p class="indent">The last line identifies which GPIO pin is used by this person’s LED <span class="ent">❻</span>. Each individual should have their own LED, so here Frank is assigned the LED attached to GPIO pin 4.</p>&#13;
<h4 class="h4" id="ch09lev2sec8"><span epub:type="pagebreak" id="page_152"/>Finding the Rest of the Devices</h4>&#13;
<p class="noindent">Now you’ll use the same code structure to set up the variables for the other device IP addresses you want to check and assign an LED to each device. Add the lines of code from <a href="ch09.xhtml#ch09ex04">Listing 9-4</a> to the bottom of your program.</p>&#13;
<pre>   <span class="codered"># second device oneplus</span>&#13;
   <span class="codeitalic1">scott</span> = PingServer(<span class="codegreen2">'192.168.1.22'</span>) <span class="codered"># oneplus</span>&#13;
   led_<span class="codeitalic1">scott</span> = LED(18)&#13;
   &#13;
   <span class="codered"># third device laptop 1</span>&#13;
<span class="ent">❶</span> <span class="codeitalic1">liz</span> = PingServer(<span class="codegreen2">'192.168.1.72'</span>) <span class="codered"># laptop 1</span>&#13;
   led_<span class="codeitalic1">liz</span> = LED(24)&#13;
    &#13;
   <span class="codered"># fourth device raspberry pi</span>&#13;
   <span class="codeitalic1">jenny</span> = PingServer(<span class="codegreen2">'192.168.1.165'</span>) <span class="codered"># pi</span>&#13;
   led_<span class="codeitalic1">jenny</span> = LED(7)&#13;
   &#13;
   <span class="codered"># fifth device laptop 2</span>&#13;
   <span class="codeitalic1">jade</span> = PingServer(<span class="codegreen2">'192.168.1.209'</span>) <span class="codered"># laptop 2</span>&#13;
   led_<span class="codeitalic1">jade</span> = LED(26)</pre>&#13;
<p class="caption"><a id="ch09ex04"/><strong>LISTING 9-4</strong> Assigning LEDs to each device</p>&#13;
<p class="indent">As before, you create a variable to hold the results of each ping, indicating the name of the person who owns the device. Remember to replace each variable name with a name in your household, and replace each IP address with the corresponding IP address you collected earlier <span class="ent">❶</span>.</p>&#13;
<p class="indent">If you can’t locate enough devices, still add the code for each variable listed here and just use an IP address you already used. This will turn on multiple LEDs at once, but it will mean you can test that the wiring and the program code are working correctly. Once you have it all working, you can go back and delete or comment out those lines if you want.</p>&#13;
<h4 class="h4" id="ch09lev2sec9">Adding Delays, Responding to Data, and Adding the Button</h4>&#13;
<p class="noindent">Finally, you add the concluding section of the program code, shown in <a href="ch09.xhtml#ch09ex05">Listing 9-5</a>. This will put a delay between the pings for each person.</p>&#13;
<p class="indent">You delay between each ping because pinging the router too many times will create a lot of traffic and slow the network. You might get caught! Also, a person isn’t likely to leave the house and return every second, so you can run the check once a minute.</p>&#13;
<pre>   <span class="codered"># check every 60 seconds</span>&#13;
<span class="ent">❶</span> led.source_delay = 55&#13;
   led_<span class="codeitalic1">scott</span>.source_delay = 56&#13;
   led_<span class="codeitalic1">liz</span>.source_delay = 57&#13;
   led_<span class="codeitalic1">jenny</span>.source_delay = 58&#13;
   led_<span class="codeitalic1">jade</span>.source_delay = 59&#13;
      &#13;
   <span class="codered"># power on LEDs</span>&#13;
<span class="ent">❷</span> led.source = <span class="codeitalic1">frank</span>.values&#13;
   led_<span class="codeitalic1">scott</span>.source = <span class="codeitalic1">scott</span>.values&#13;
   led_<span class="codeitalic1">liz</span>.source = <span class="codeitalic1">liz</span>.values&#13;
   led_<span class="codeitalic1">jenny</span>.source = <span class="codeitalic1">jenny</span>.values&#13;
   led_<span class="codeitalic1">jade</span>.source = <span class="codeitalic1">jade</span>.values&#13;
      &#13;
   <span class="codered"># GPIO 16 for shutdown</span>&#13;
<span class="ent">❸</span> shutdown_btn = Button(16, hold_time=2)&#13;
<span class="ent">❹</span> shutdown_btn.when_held = shutdown&#13;
   &#13;
<span class="ent">❺</span> pause()</pre>&#13;
<p class="caption"><a id="ch09ex05"/><span epub:type="pagebreak" id="page_153"/><strong>LISTING 9-5</strong> Adding delays between pings</p>&#13;
<p class="indent">Replace the names I’ve used here with the names you used for your variables, and then list the delay in seconds as I’ve done <span class="ent">❶</span>. If you find your network is still running slow or you want to run the checks less frequently, increase the number of seconds for the delays. For example, you could increase the delays to 300, as a user is likely to be online for a while. Note that some smartphones may appear disconnected from your network when the phone screen locks.</p>&#13;
<p class="indent">Next the program needs to respond to the ping data. If the IP address sent in the ping is located on the router and confirmed as live, the corresponding LED is turned on <span class="ent">❷</span>. If the IP address isn’t found, then the device isn’t found, and the LED is turned off.</p>&#13;
<p class="indent">Finally, you set up the button to initiate the shutdown sequence <span class="ent">❸</span>. You set this to GPIO pin 16 (if you used a different pin, make sure you put that GPIO pin number here).</p>&#13;
<p class="indent">The value in <span class="literal">hold_time</span> refers to how long the button must be held down to trigger the shutdown sequence <span class="ent">❹</span>. This program sets the time to 2 seconds so that accidentally pressing the button for a moment won’t shut down the program. (You have to hold the button down for at least 2 seconds.) The <span class="literal">when_held</span> checks whether the button is being pressed and runs the function to shut down the Raspberry Pi and turn off the status board if it is.</p>&#13;
<p class="indent">Finally, use <span class="literal">pause()</span> <span class="ent">❺</span> to keep the program looping forever. That concludes the main program structure and status board hardware setup!</p>&#13;
<h4 class="h4" id="ch09lev2sec10"><span epub:type="pagebreak" id="page_154"/>Running the Program</h4>&#13;
<p class="noindent">Let’s give it a whirl! To check that the program code is working correctly, press <strong>F5</strong>. This will prompt you to save your program, and then it will execute. Depending on who is around and which devices are connected, you should see some of the LEDs light up.</p>&#13;
<p class="indent">Make sure your own device is on and connected to the router. To test whether the code is responding, turn off your device or set it to flight mode. You should see your own LED turn off! Remember that the code runs once a minute, so it might not turn off straight away.</p>&#13;
<h4 class="h4" id="ch09lev2sec11">Troubleshooting</h4>&#13;
<p class="noindent">If the status board doesn’t appear to work correctly, check for these common culprits:</p>&#13;
<ol>&#13;
<li class="noindent">Are any devices connected to the router?</li>&#13;
<li class="noindent">Are your LEDs faulty?</li>&#13;
<li class="noindent">Have you wired up the LEDs correctly? (Check that the positive/negative legs are connected the correct way.)</li>&#13;
<li class="noindent">Does the LED pin number match the pin number used in the code?</li>&#13;
<li class="noindent">Are you using the right IP address for each user in your house?</li>&#13;
<li class="noindent">Is the correct LED assigned to the correct user?</li>&#13;
</ol>&#13;
<h3 class="h3" id="ch09lev1sec7">SETTING UP THE CODE TO RUN AUTOMATICALLY</h3>&#13;
<p class="noindent">The last step of the project is to configure the program to run automatically so that your status board responds when the Raspberry Pi boots up. Once you have your program working and the status board functioning correctly, you can remove your monitor and attach the Raspberry Pi to the status board. Then, to start up the status board, simply plug in the power to your Raspberry Pi. To turn it off, press the shutdown button or touch the two wires together, and your Raspberry Pi will start the process of shutting down.</p>&#13;
<h4 class="h4" id="ch09lev2sec12"><span epub:type="pagebreak" id="page_155"/>Using Cron to Autostart the Program</h4>&#13;
<p class="noindent">To start up your status board automatically, you need to schedule the Python program to execute on boot-up. This uses <em>cron</em>, a simple time-based job-scheduling tool named after the Greek word for time, <em>chronos</em>. This tool enables you to create rules for triggering tasks automatically at specific times. For example, you might set rules to download files every hour, run an update every day at 4 <span class="small">PM</span>, or send an email at the same time each week.</p>&#13;
<p class="indent">You create these rules in a <em>crontab</em> (short for <em>cron table</em>) file, a simple text file that contains the task’s instructions and, most important, the time to trigger the task.</p>&#13;
<p class="indent">Before you add this task to the crontab file, you need to know where your <em>wifi_spy.py</em> program is saved in your Pi system. Unless you saved yours somewhere in particular, this location will probably be <em>/home/pi/wifi_spy.py</em>. Note the correct file path of <em>wifi_spy.</em><em>py</em>, and then you’ll edit the crontab.</p>&#13;
<p class="indent">Open the terminal and enter this:</p>&#13;
<pre><span class="codegreen">pi@raspberrypi</span>:- <span class="codeblue">$</span> <span class="codestrong1">crontab –e</span></pre>&#13;
<p class="indent">This will open the cron console (<a href="ch09.xhtml#ch09fig07">Figure 9-7</a>).</p>&#13;
<div class="image"><img alt="Image" src="../images/09fig07.jpg"/></div>&#13;
<p class="figcap" id="ch09fig07"><strong>FIGURE 9-7</strong> The crontab</p>&#13;
<p class="indent">The terminal should give you three methods of editing the cron file. Select option 2 to open the nano text editor—you’ll use this because it’s the simplest.</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_156"/>This should open the cron file in nano, and you should see a load of code already there that looks something like <a href="ch09.xhtml#ch09ex06">Listing 9-6</a>.</p>&#13;
<pre># daemon's notion of time and timezones.&#13;
#&#13;
# Output of the crontab jobs (including errors) is sent through&#13;
# email to the user the crontab file belongs to (unless redirected)&#13;
#&#13;
# For example, you can run a backup of all your user accounts&#13;
# at 5 am every week with:&#13;
# 0 5 * * 1 tar –zcf /var/backups/home.tgz /home/&#13;
#&#13;
# For more information, see the manual pages of crontab(5) and&#13;
cron(8)&#13;
#&#13;
# m h  dom mon dow    command</pre>&#13;
<p class="caption"><a id="ch09ex06"/><strong>LISTING 9-6</strong> Startup code in the crontab file</p>&#13;
<p class="indent">Scroll to the bottom of the text and locate the black space, and right at the end add the following line of code:</p>&#13;
<pre><span class="codestrong1">@reboot python3 /home/pi/wifi_spy.py &amp;</span></pre>&#13;
<p class="indent">The command is easy to understand: it states that on rebooting the Raspberry Pi, run Python in super user mode, open the <em>home/</em><em>pi</em> folder, and execute the program called <em>wifi_spy.py</em>. Make sure that you replace the filename with the name of your file, if required, and that the correct folder path is used.</p>&#13;
<p class="indent">The <span class="literal">&amp;</span> syntax at the end of the line of code is telling cron to run your program in the background so you can still do other things with your Raspberry Pi.</p>&#13;
<p class="indent">Once you have checked the code you added to the crontab file and are confident that it’s correct, press <span class="small">CTRL-</span>X to save and exit the file. Now, each time you boot up or reboot your Raspberry Pi, the crontab file will run and execute the status board program.</p>&#13;
<p class="indent">If you ever want to stop the program from automatically running, open the crontab file again from the terminal by using <span class="literal">crontab –e</span>, and comment out or delete the line of code that you added. Then save the file and reboot.</p>&#13;
<h4 class="h4" id="ch09lev2sec13">Rebooting to the Command Line</h4>&#13;
<p class="noindent">Because the status board is designed to run <em>headless</em> (without a screen or monitor), you don’t need the Raspberry Pi to boot to the desktop, as this takes longer and will use more memory and <span epub:type="pagebreak" id="page_157"/>processing power than is necessary. Instead, you’ll configure the Pi to boot to the command line. Open the terminal window and enter this:</p>&#13;
<pre><span class="codegreen">pi@raspberrypi</span>:- <span class="codeblue">$</span> <span class="codestrong1">sudo raspi-config</span></pre>&#13;
<p class="indent">This should bring up the Configuration tool in your terminal, as shown in <a href="ch09.xhtml#ch09fig08">Figure 9-8</a>. Select the third option, <strong>3</strong> <strong>Boot Options</strong>, and press <span class="small">ENTER</span>. Then select <strong>B1 Desktop / CLI</strong> and then the <strong>B1 Console</strong> option.</p>&#13;
<div class="image"><img alt="Image" src="../images/09fig08.jpg"/></div>&#13;
<p class="figcap" id="ch09fig08"><strong>FIGURE 9-8</strong> Booting to the command line option</p>&#13;
<p class="indent">Once this is set, use the down arrow key to select <strong>&lt;Finish&gt;</strong> and press <span class="small">ENTER</span>. You’ll be prompted to save the config file and reboot. Select <strong>Yes</strong>, and your Pi will restart. When it boots up again, the status board program should load.</p>&#13;
<p class="indent">Now for a visual indicator of who is around, plug in the power source, and your status board will tell you. You may need to wait a minute or two while the Pi connects to the router. Remove the HDMI cable from your Raspberry Pi, as you’re now truly headless!</p>&#13;
<h3 class="h3" id="ch09lev1sec8">TRACKING DEVICES WITH BLUETOOTH</h3>&#13;
<p class="noindent">In this section, you’ll look at how to spy on who is around by using Bluetooth instead of Wi-Fi. Similar to the way you used IP addresses to track devices, you can use the Raspberry Pi to scan for Bluetooth data transmissions and retrieve the address of the device. This address can then be used to trigger the relevant LED on your status board.</p>&#13;
<h4 class="h4" id="ch09lev2sec14"><span epub:type="pagebreak" id="page_158"/>What Is Bluetooth?</h4>&#13;
<p class="noindent"><em>Bluetooth</em> is the industry name for the standard range of radio waves between 2.402 and 2.480 GHz, used to enable devices to communicate wirelessly with each other over short distances of around 100–200 m. As with all technology, Bluetooth is always evolving, and the latest Bluetooth 4 technology can communicate over distances up to 200 m. Bluetooth requires little battery power, making it ideal for use on mobile devices.</p>&#13;
<p class="indent">Every device with Bluetooth is assigned its own unique address, with the format D2:72:F6:87:D2:8A. Because each address is unique to the device, if you get the address and know who owns each device, you can track people! From a security perspective, I recommend you remove or edit the addresses if you intend to share your program code or show others how it works.</p>&#13;
<h4 class="h4" id="ch09lev2sec15">Turning On the Raspberry Pi Bluetooth</h4>&#13;
<p class="noindent">The Raspberry Pi and Pi Zero W both come with Bluetooth hardware ready. If you have an older model Pi, you can still use this hack, but you’ll need to purchase a Bluetooth USB dongle and attach it via one of the USB ports.</p>&#13;
<p class="indent">To turn on Bluetooth on your Pi, locate the standard Bluetooth symbol at the top right of the desktop, click the symbol, and select <strong>Turn On Bluetooth</strong>.</p>&#13;
<p class="indent">The good news is that to find Bluetooth-enabled devices nearby, you don’t need to be connected to them–that would be a bit of a giveaway. If you have your own device handy, turn on and enable Bluetooth. Then return to your Pi, click the Bluetooth icon, and select the option <strong>Make Discoverable</strong>. The Bluetooth icon will start flashing green. Click the Bluetooth icon again and select the <strong>Add Devices</strong> option. A new window should open, and the Bluetooth hardware will begin scanning and searching for devices. Eventually, you’ll end up with a list of all nearby devices with Bluetooth enabled!</p>&#13;
<p class="indent">To collect Bluetooth addresses for the devices, you’ll write a simple Python script as you did when searching for IP addresses. The program scans for addresses, adds each address to a list, and then prints the list to the Python console. First you need to install some libraries.</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_159"/>To install the required Python libraries, open the terminal window and enter the following commands:</p>&#13;
<pre><span class="codegreen">pi@raspberrypi</span>:- <span class="codeblue">$</span> sudo apt install bluez&#13;
<span class="codegreen">pi@raspberrypi</span>:- <span class="codeblue">$</span> sudo apt install bluetooth libbluetooth-dev&#13;
<span class="codegreen">pi@raspberrypi</span>:- <span class="codeblue">$</span> sudo pip3 install pybluez</pre>&#13;
<p class="indent">When the three programs have finished downloading and installing, reboot your Raspberry Pi.</p>&#13;
<p class="indent">So let’s see which Bluetooth-enabled devices are in your home. Open a new Python file and copy the program in <a href="ch09.xhtml#ch09ex07">Listing 9-7</a>. Save it as <em>bluetooth_finder.py</em>.</p>&#13;
<pre><span class="codeorg">import</span> bluetooth&#13;
from time import sleep&#13;
<span class="codered"># find devices</span>&#13;
<span class="codepurple">print</span> (<span class="codegreen1">"Searching for devices..."</span>)&#13;
nearby_devices = bluetooth.discover_devices(lookup_names = <span class="codeorg">True</span>)&#13;
sleep(10)&#13;
<span class="codepurple">print</span> (<span class="codegreen1">"found %d devices"</span> % <span class="codepurple">len</span>(nearby_devices))&#13;
<span class="codeorg">for</span> addr, name <span class="codeorg">in</span> nearby_devices:&#13;
    <span class="codepurple">print</span> (<span class="codegreen1">"  %s - %s"</span> % (addr, name))</pre>&#13;
<p class="caption"><a id="ch09ex07"/><strong>LISTING 9-7</strong> Using Bluetooth to discover devices</p>&#13;
<p class="indent">This code controls the Bluetooth hardware to search for nearby devices that are transmitting a Bluetooth signal. Then it creates a nicely organized list of the addresses and prints them out.</p>&#13;
<p class="indent">The output should look something like <a href="ch09.xhtml#ch09ex08">Listing 9-8</a>.</p>&#13;
<pre>Python 3.5.3 (default, Jan 19 2017, 14:11:04)&#13;
 [GCC 6.3.0 20170124] on linux&#13;
Type "copyright", "credits" or "license()" for more information.&#13;
&gt;&gt;&gt;&#13;
 RESTART: /home/pi/bluetooth_finder.py&#13;
<span class="codeblue1">Searching for device...</span>&#13;
<span class="codeblue1">found 0 devices</span>&#13;
&gt;&gt;&gt;&#13;
 RESTART: /home/pi/bluetooth_finder.py&#13;
<span class="codeblue1">Searching for device...</span>&#13;
<span class="codeblue1">found 1 devices</span>&#13;
  <span class="codeblue1">D0:57:78:87:F6:8A - DANLAPTOP</span></pre>&#13;
<p class="caption"><a id="ch09ex08"/><strong>LISTING 9-8</strong> Output from scan</p>&#13;
<p class="indent">Once you have the program copied, you can use it to copy and paste the addresses or write them down to use them for your status board. Remember to check which address corresponds with which device, and carry out a little testing to ensure that you have the correct address for each person.</p>&#13;
<h4 class="h4" id="ch09lev2sec16"><span epub:type="pagebreak" id="page_160"/>Writing the Status Board Code</h4>&#13;
<p class="noindent">Now that you can locate Bluetooth devices and you have addresses for nearby devices, you can use these as ID codes to trigger the LEDs on your status board. This code will come in a few pieces so I can explain how each bit works. First, let’s set up some essentials.</p>&#13;
<h5 class="h5">Importing and Setting Up the LEDs</h5>&#13;
<p class="noindent">Let’s import the packages you need and set up the LEDs. Copy the program code in <a href="ch09.xhtml#ch09ex09">Listing 9-9</a> into a new Python file and name it <em>bluetooth_status_board.py</em>.</p>&#13;
<pre><span class="ent">❶</span> <span class="codeorg">import</span> Bluetooth&#13;
   <span class="codeorg">from</span> bluetooth <span class="codeorg">import</span> *&#13;
    &#13;
   <span class="codeorg">from</span> gpiozero <span class="codeorg">import</span> LED, Button&#13;
   <span class="codeorg">from</span> subprocess <span class="codeorg">import</span> check_call()&#13;
   <span class="codeorg">from</span> signal <span class="codeorg">import</span> pause&#13;
   <span class="codeorg">from</span> time <span class="codeorg">import</span> sleep&#13;
    &#13;
<span class="ent">❷</span> <span class="codeorg">def</span> <span class="codeblue1">shutdown</span>():&#13;
   <span class="ent">❸</span> check_call()([<span class="codegreen1">'sudo'</span>, <span class="codegreen1">'poweroff'</span>])&#13;
     &#13;
   <span class="codered"># define the LEDs</span>&#13;
<span class="ent">❹</span> led1 = LED(4)&#13;
   led2 = LED(18)&#13;
   led3 = LED(24)&#13;
   led4 = LED(7)&#13;
   led5 = LED(26)&#13;
   button = Button(16)&#13;
</pre>&#13;
<p class="caption"><a id="ch09ex09"/><strong>LISTING 9-9</strong> The first part of the Bluetooth status board code</p>&#13;
<p class="indent">Start the program by importing the <span class="literal">Bluetooth</span> library, followed by the <span class="literal">LED</span> and <span class="literal">Button</span> classes to control the status LEDs and the shutdown button <span class="ent">❶</span>, respectively. Then import the <span class="literal">subprocess</span> library so you can use <span class="literal">check_call()</span> from the terminal, as you did with the Wi-Fi version. Use the <span class="literal">sleep()</span> function to add delays or pauses in the program.</p>&#13;
<p class="indent">Next, create the <span class="literal">shutdown()</span> function <span class="ent">❷</span> and have it use <span class="literal">check_call()</span> to call the command <span class="literal">sudo shutdown</span> from the terminal, which will tell the Raspberry Pi to power off <span class="ent">❸</span>.</p>&#13;
<p class="indent">Then assign each LED on the status board to a GPIO pin <span class="ent">❹</span>. You also assign the button to pin 16.</p>&#13;
<h5 class="h5">Adding the Searching Code</h5>&#13;
<p class="noindent">Now you’ll add the code to search for the Bluetooth addresses you collected! You’ll use the searching code from <a href="ch09.xhtml#ch09ex07">Listing 9-7</a> to find devices that have Bluetooth enabled and then turn on the status <span epub:type="pagebreak" id="page_161"/>board LED if the corresponding Bluetooth address is found. Add the code in <a href="ch09.xhtml#ch09ex10">Listing 9-10</a> to the bottom of your current <em>bluetooth_sta</em><em>tus_board.py</em> file.</p>&#13;
<pre><span class="codeorg">while True</span>:&#13;
        <span class="codered"># find devices</span>&#13;
        <span class="codepurple">print</span> (<span class="codegreen1">"Searching for devices..."</span>)&#13;
     <span class="ent">❶</span> nearby_devices = bluetooth.discover_devices(lookup_names =&#13;
        <span class="codeorg">True</span>)&#13;
        sleep(5)&#13;
        <span class="codered"># search for particular devices</span>&#13;
        <span class="codered"># person 1</span>&#13;
     <span class="ent">❷</span> <span class="codeitalic1">liz</span> = bluetooth.lookup_name(<span class="codegreen1">"</span><span class="codegreen2">C5:ED:FB:F5:BB:D7</span><span class="codegreen1">"</span>, timeout=5)&#13;
     <span class="ent">❸</span> <span class="codeorg">if</span> (<span class="codeitalic1">liz</span> != <span class="codeorg">None</span>):&#13;
        <span class="ent">❹</span> <span class="codepurple">print</span> (<span class="codegreen1">"Test 1"</span>)&#13;
        <span class="ent">❺</span> led1.on()&#13;
     <span class="ent">❻</span> <span class="codeorg">else</span>:&#13;
            led1.off()&#13;
            <span class="codeorg">pass</span>&#13;
   &#13;
        <span class="codered"># person 2</span>&#13;
        <span class="codeitalic1">sarah</span> = bluetooth.lookup_name(<span class="codegreen1">"</span><span class="codegreen2">C5:ED:FB:F5:BB:D7</span><span class="codegreen1">"</span>, timeout=5)&#13;
        <span class="codeorg">if</span> (<span class="codeitalic1">sarah</span> != <span class="codeorg">None</span>):&#13;
            <span class="codepurple">print</span> (<span class="codegreen1">"Test 2"</span>)&#13;
            led2.on()&#13;
        <span class="codeorg">else</span>:&#13;
            led2.off()&#13;
            <span class="codeorg">pass</span></pre>&#13;
<p class="caption"><a id="ch09ex10"/><strong>LISTING 9-10</strong> Searching for your first two addresses</p>&#13;
<p class="indent">First, add the code to detect nearby Bluetooth devices and create a list of the found addresses <span class="ent">❶</span>. This time you don’t need to print this data, so comment out the print lines.</p>&#13;
<p class="indent">Then search for the particular addresses you found earlier! As with the IP addresses, assign a particular Bluetooth address to a variable (using the name of the person the Bluetooth address belongs to as the variable name), look up the Bluetooth address <span class="ent">❷</span>, and add a time delay of 5 seconds to allow the devices to send and receive the required data.</p>&#13;
<p class="indent">The next line <span class="ent">❸</span> checks whether the address for the target associated with LED 1 (in this case, <span class="literal">liz</span>) has been discovered, meaning the device is present in the house. If the address has been found, the value for the variable will not be <span class="literal">None</span>.</p>&#13;
<p class="indent">The line at <span class="ent">❹</span> is for testing purposes and can be commented out of your final program. If the Bluetooth address has been found, the corresponding LED, the first LED on the status board, will be turned on using <span class="literal">led1.on()</span> <span class="ent">❺</span>.</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_162"/>If the Bluetooth address isn’t found during the search, the LED is set to off, and the program passes on to the next check <span class="ent">❻</span>.</p>&#13;
<h5 class="h5">Adding More Targets</h5>&#13;
<p class="noindent">To add more targets, copy <a href="ch09.xhtml#ch09ex11">Listing 9-11</a> and paste it into your program again, changing the Bluetooth address to another you found and also remembering to change the variable name and the LED number. Keep the same level of indentation on these lines of code.</p>&#13;
<pre>        <span class="codered"># person 3</span>&#13;
        <span class="codeitalic1">frank</span> = bluetooth.lookup_name(<span class="codegreen1">"</span><span class="codegreen2">C5:ED:FB:F5:BB:D7</span><span class="codegreen1">"</span>, timeout=5)&#13;
        <span class="codeorg">if</span> (<span class="codeitalic1">frank</span> != <span class="codeorg">None</span>):&#13;
            <span class="codepurple">print</span> (<span class="codegreen1">"Test 3"</span>)&#13;
            led3.on()&#13;
        <span class="codeorg">else</span>:&#13;
            led3.off()&#13;
            <span class="codeorg">pass</span>&#13;
</pre>&#13;
<p class="caption"><a id="ch09ex11"/><strong>LISTING 9-11</strong> Adding more targets</p>&#13;
<p class="indent">If you have fewer devices, you can use fewer targets in your code, or you can use your own Bluetooth address multiple times to test that the wiring and the LEDs are functioning correctly.</p>&#13;
<h4 class="h4" id="ch09lev2sec17">Shutting Down</h4>&#13;
<p class="noindent">The concluding section of the code, shown in <a href="ch09.xhtml#ch09ex12">Listing 9-12</a>, sets up the shutdown button.</p>&#13;
<pre>        <span class="codered">#shutdown button</span>&#13;
     <span class="ent">❶</span> <span class="codeorg">if</span> button.is_pressed:&#13;
         <span class="ent">❷</span> shutdown()&#13;
        <span class="codeorg">else</span>:&#13;
            <span class="codeorg">pass</span></pre>&#13;
<p class="caption"><a id="ch09ex12"/><strong>LISTING 9-12</strong> Setting up the shutdown button</p>&#13;
<p class="indent">Add the <span class="literal">if button.is_pressed:</span> code to check whether the button has been pressed <span class="ent">❶</span>. If it has, the <span class="literal">shutdown()</span> function will run <span class="ent">❷</span>. This will turn the status board off, and your Raspberry Pi will shut down.</p>&#13;
<p class="indent">This completes the code for using Bluetooth addresses to trigger your status board. Now save the program code and test that it’s working correctly. You might also want to edit the crontab file by using the instructions in “Using Cron to Autostart the Program” on <a href="ch09.xhtml#page_155">page 155</a> so that this program runs on startup instead of the IP address finder. To ensure accuracy, run either the IP or the Bluetooth search, and not both at the same time.</p>&#13;
<p class="indent">Well done! You’ve used either Wi-Fi and IP addresses to track a mobile device or Bluetooth to get information about the devices <span epub:type="pagebreak" id="page_163"/>that are near you. Or you may have done both! You then created a visual status board on which an LED lights up only whenever a particular device is located, meaning that the owner of the device is likely nearby. Once you’ve added pictures or written the names of the people who own each device, you now have a nice, easy way to see who is about.</p>&#13;
<h3 class="h3" id="ch09lev1sec9">WRAPPING UP</h3>&#13;
<p class="noindent">Once your status board is up and running, you may want to add features to the project. To get your inventive juices flowing, you could try some of the following:</p>&#13;
<ol>&#13;
<li class="noindent">Assign different colors for each target.</li>&#13;
<li class="noindent">Add more LEDs.</li>&#13;
<li class="noindent">Make the LEDs flash.</li>&#13;
<li class="noindent">Build a bigger status board.</li>&#13;
<li class="noindent">Add a sound that plays when a device is detected.<span epub:type="pagebreak" id="page_164"/></li>&#13;
</ol>&#13;
</body></html>