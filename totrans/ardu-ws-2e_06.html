<html><head></head><body>
		<section>&#13;
			<header>&#13;
				<h1 class="chapter"><span class="ChapterNumber"><span epub:type="pagebreak" id="Page_125" title="125"/>7</span><br/><span class="ChapterTitle">Expanding Your Arduino</span></h1>&#13;
			</header>&#13;
			<p class="ChapterIntro">In this chapter you will</p>&#13;
			<ul>&#13;
				<li>Learn about the broad variety of Arduino shields</li>&#13;
				<li>Make your own Arduino shield using a ProtoShield</li>&#13;
				<li>See how Arduino libraries can expand the available functions</li>&#13;
				<li>Use a memory card module to record data that can be analyzed in a spreadsheet</li>&#13;
				<li>Build a temperature-logging device</li>&#13;
				<li>&#13;
					Learn how to make a stopwatch using <code>micros()</code> and <code>millis()</code></li>&#13;
				<li>Understand Arduino interrupts and their uses</li>&#13;
			</ul>&#13;
			<p>&#13;
				Another way to expand the capabilities of your Arduino is by using shields. A <em>shield</em> is a circuit board that connects via pins to the sockets on the sides of an Arduino. In the first project in this chapter, you’ll learn how to make your own shield. Over time, as you experiment with electronics and Arduino, you can make your circuits more permanent by building them onto a <em>ProtoShield</em>, a blank printed circuit board that you can use to mount custom circuitry.</p>&#13;
			<p><span epub:type="pagebreak" id="Page_126" title="126"/>Next, I’ll introduce a memory card module. We’ll use it in this chapter to create a temperature-logging device to record temperatures over time; the shield will be used to record data from the Arduino to be transferred elsewhere for analysis.</p>&#13;
			<p>&#13;
				You’ll learn about the functions <code>micros()</code> and <code>millis()</code>, which are very useful for keeping time, as you’ll see in the stopwatch project. Finally, we’ll examine interrupts.</p>&#13;
			<h2 id="h1-500587c07-0001">Shields</h2>&#13;
			<p class="BodyFirst">You can add functionality to your Arduino board by attaching shields. Hundreds of shields are available on the market, and they can be combined, or stacked, to work together. One popular project, for example, combines a GPS shield with a microSD memory card shield to create a device that logs and stores position over time, for example to record a car’s path of travel or the location of a new hiking trail. Other projects include Ethernet network adapters that let the Arduino access the internet (<a href="#figure7-1" id="figureanchor7-1">Figure 7-1</a>).</p>&#13;
			<figure>&#13;
				<img alt="f07001" src="image_fi/500587c07/f07001.png"/>&#13;
				<figcaption>&#13;
					<p><a id="figure7-1">Figure 7-1</a>: An Ethernet shield on an Arduino Uno</p>&#13;
				</figcaption>&#13;
			</figure>&#13;
			<p>&#13;
				GPS satellite receivers let you track the location of the Arduino (<a href="#figure7-2" id="figureanchor7-2">Figure 7-2</a>). MicroSD memory card interfaces let the Arduino store data on a memory card (<a href="#figure7-3" id="figureanchor7-3">Figure 7-3</a>).</p>&#13;
			<p><a href="#figure7-4" id="figureanchor7-4">Figure 7-4</a> shows a stack that includes an Arduino Uno, a microSD memory card shield to which data can be recorded, an Ethernet shield for connecting to the internet, and an LCD shield to display information.</p>&#13;
			<span epub:type="pagebreak" id="Page_127" title="127"/>&#13;
			<figure>&#13;
				<img alt="f07002" src="image_fi/500587c07/f07002.png"/>&#13;
				<figcaption>&#13;
					<p><a id="figure7-2">Figure 7-2</a>: A GPS receiver shield (with separate GPS module)</p>&#13;
				</figcaption>&#13;
			</figure>&#13;
			<figure>&#13;
				<img alt="f07003" src="image_fi/500587c07/f07003.png"/>&#13;
				<figcaption>&#13;
					<p><a id="figure7-3">Figure 7-3</a>: A MicroSD card shield</p>&#13;
				</figcaption>&#13;
			</figure>&#13;
			<figure>&#13;
				<img alt="f07004" src="image_fi/500587c07/f07004.png"/>&#13;
				<figcaption>&#13;
					<p><a id="figure7-4">Figure 7-4</a>: Three stacked shields with an Arduino Uno</p>&#13;
				</figcaption>&#13;
			</figure>&#13;
			<aside epub:type="sidebar">&#13;
				<div class="top hr">&#13;
					<hr/>&#13;
				</div>&#13;
				<section class="note"><span epub:type="pagebreak" id="Page_128" title="128"/>&#13;
				<h2><span class="NoteHead">WARNING</span></h2>&#13;
					<p>	When stacking shields, make sure that no shield uses the same digital or analog pins used by another shield at the same time. If you share pins between shields that use the same pin(s) for different functions, you may damage your entire creation, so take care. The suppliers of each shield should provide information showing which pins are used by their shields.</p>&#13;
					<div class="bottom hr">&#13;
						<hr/>&#13;
					</div>&#13;
				</section>&#13;
			</aside>&#13;
			<h2 id="h1-500587c07-0002">ProtoShields</h2>&#13;
			<p class="BodyFirst">You can buy a variety of shields online, or make your own using a ProtoShield. A ProtoShield is a blank circuit board that you can use to make your own permanent Arduino shields. ProtoShields come preassembled or in kit form, similar to the one shown in <a href="#figure7-5" id="figureanchor7-5">Figure 7-5</a>.</p>&#13;
			<p>&#13;
				A ProtoShield also makes a good base for a solderless breadboard, because it keeps a small circuit within the physical boundary of your Arduino creation (as shown in <a href="#figure7-6" id="figureanchor7-6">Figure 7-6</a>). Smaller solderless breadboards fit within the rows of sockets and can be temporarily mounted on the circuit board with Blu Tack reusable putty or mounted more permanently with double-sided tape. ProtoShields can also act as a more permanent foundation for circuits that have been tested on a breadboard.</p>&#13;
			<figure>&#13;
				<img alt="f07005" src="image_fi/500587c07/f07005.png"/>&#13;
				<figcaption>&#13;
					<p><a id="figure7-5">Figure 7-5</a>: A ProtoShield kit</p>&#13;
				</figcaption>&#13;
			</figure>&#13;
			<figure>&#13;
				<img alt="f07006" src="image_fi/500587c07/f07006.png"/>&#13;
				<figcaption>&#13;
					<p><a id="figure7-6">Figure 7-6</a>: An example of small project mounted on a ProtoShield’s solderless breadboard</p>&#13;
				</figcaption>&#13;
			</figure>&#13;
			<p>Building custom circuits on a ProtoShield requires some forward planning. You have to design the circuit, make a schematic, and then plan the layout of the components as they will sit on the ProtoShield. Finally, you will solder the completed circuit onto your custom shield, but you should always test it first using a solderless breadboard to ensure that it works. Some ProtoShields come with a PDF schematic file that you can download and print, intended specifically for drawing your project schematic.</p>&#13;
			<h2 class="HeadProject" id="h1-500587c07-0003"><span><span epub:type="pagebreak" id="Page_129" title="129"/>Project #21: Creating a Custom Shield</span></h2>&#13;
			<p class="BodyFirst">In this project, you’ll create a custom shield containing two LEDs and current-limiting resistors. This custom shield will make it easy to experiment with LEDs on digital outputs.</p>&#13;
			<h3 id="h2-500587c07-0001">The Hardware</h3>&#13;
			<p class="BodyFirst">The following hardware is required for this project:</p>&#13;
			<ul>&#13;
				<li>One blank Arduino ProtoShield with stacking headers</li>&#13;
				<li>Two LEDs of any color</li>&#13;
				<li>&#13;
					Two 560 <span class="NSSymbol">Ω</span> resistors</li>&#13;
				<li>&#13;
					Two 10 k<span class="NSSymbol">Ω</span> resistors</li>&#13;
				<li>Two push buttons</li>&#13;
				<li>Two 100 nF capacitors</li>&#13;
			</ul>&#13;
			<h3 id="h2-500587c07-0002">The Schematic</h3>&#13;
			<p class="BodyFirst">The circuit schematic is shown in <a href="#figure7-7" id="figureanchor7-7">Figure 7-7</a>.</p>&#13;
			<figure>&#13;
				<img alt="f07007" src="image_fi/500587c07/f07007.png"/>&#13;
				<figcaption>&#13;
					<p><a id="figure7-7">Figure 7-7</a>: Schematic for Project 21</p>&#13;
				</figcaption>&#13;
			</figure>&#13;
			<h3 id="h2-500587c07-0003"><span epub:type="pagebreak" id="Page_130" title="130"/>The Layout of the ProtoShield Board</h3>&#13;
			<p class="BodyFirst">The next step is to learn the layout of the holes on the ProtoShield. The rows and columns of holes on the ProtoShield generally match those of a solderless breadboard. However, each ProtoShield may vary, so take the time to determine how the holes are connected. On the example ProtoShield shown in <a href="#figure7-8" id="figureanchor7-8">Figure 7-8</a>, some holes are connected, as shown by the solid lines between the holes, but a lot of holes have been left unconnected. This design gives you a lot of flexibility in how you use your ProtoShield.</p>&#13;
			<figure>&#13;
				<img alt="f07008" src="image_fi/500587c07/f07008.png"/>&#13;
				<figcaption>&#13;
					<p><a id="figure7-8">Figure 7-8</a>: A blank ProtoShield shown from above</p>&#13;
				</figcaption>&#13;
			</figure>&#13;
			<p>Note the two groups of holes surrounded by rectangles along the top and bottom of the ProtoShield: this is where we solder the stackable headers that allow the ProtoShield to slot into the Arduino board.</p>&#13;
			<h3 id="h2-500587c07-0004">The Design</h3>&#13;
			<p class="BodyFirst">You need to convert the circuit shown in <a href="#figure7-7">Figure 7-7</a> into a physical layout that’s suitable for your ProtoShield. A good way to do this is to lay out your circuit using graph paper, as shown in <a href="#figure7-9" id="figureanchor7-9">Figure 7-9</a>. You can then mark the connected holes on the graph paper and easily experiment until you find a layout that works for your particular ProtoShield. If you don’t have any graph paper, you can generate and print your own at <a class="LinkURL" href="http://www.printfreegraphpaper.com/.">http://www.printfreegraphpaper.com/.</a></p>&#13;
			<span epub:type="pagebreak" id="Page_131" title="131"/>&#13;
			<figure>&#13;
				<img alt="f07009" src="image_fi/500587c07/f07009.png"/>&#13;
				<figcaption>&#13;
					<p><a id="figure7-9">Figure 7-9</a>: Planning our custom shield</p>&#13;
				</figcaption>&#13;
			</figure>&#13;
			<p>After you’ve drawn a plan for your circuit, test-fit the components into the ProtoShield to make sure that they’ll fit and that they aren’t too crowded. If the ProtoShield has space for a reset button, always include one, because the shield will block access to your Arduino’s RESET button.</p>&#13;
			<h3 id="h2-500587c07-0005">Soldering the Components</h3>&#13;
			<p class="BodyFirst">Once you’re satisfied with the layout of the circuit on your ProtoShield and you’ve tested the circuit to make sure it works, you can solder the components. Using a soldering iron is not that difficult, and you don’t need to buy an expensive soldering station for this type of work. A simple iron rated at 25 to 40 watts, like the one shown in <a href="#figure7-10" id="figureanchor7-10">Figure 7-10</a>, should do the job.</p>&#13;
			<figure>&#13;
				<img alt="f07010" src="image_fi/500587c07/f07010.png"/>&#13;
				<figcaption>&#13;
					<p><a id="figure7-10">Figure 7-10</a>: Soldering iron</p>&#13;
				</figcaption>&#13;
			</figure>&#13;
			<aside epub:type="sidebar">&#13;
				<div class="top hr">&#13;
					<hr/>&#13;
				</div>&#13;
				<section class="note">&#13;
					<h2><span class="NoteHead">NOTE</span></h2>&#13;
					<p>&#13;
							If soldering is new to you, download and read the instructional comic book from <a class="LinkURL" href="http://mightyohm.com/soldercomic/">http://mightyohm.com/soldercomic/</a>.</p>&#13;
					<div class="bottom hr">&#13;
						<hr/>&#13;
					</div>&#13;
				</section>&#13;
			</aside>&#13;
			<p><span epub:type="pagebreak" id="Page_132" title="132"/>When soldering the components, you may need to bridge them together with a small amount of solder and wire cutoffs, as shown in <a href="#figure7-11" id="figureanchor7-11">Figure 7-11</a>.</p>&#13;
			<p>&#13;
				Check each solder connection as you go, because mistakes are easier to locate and repair <em>before</em> the project is finished. When the time comes to solder the four header sockets or header pins, keep them aligned by using an existing shield to hold the new pins, as shown in <a href="#figure7-12" id="figureanchor7-12">Figure 7-12</a>.</p>&#13;
			<figure>&#13;
				<img alt="f07011" src="image_fi/500587c07/f07011.png"/>&#13;
				<figcaption>&#13;
					<p><a id="figure7-11">Figure 7-11</a>: A solder bridge</p>&#13;
				</figcaption>&#13;
			</figure>&#13;
			<figure>&#13;
				<img alt="f07012" src="image_fi/500587c07/f07012.png"/>&#13;
				<figcaption>&#13;
					<p><a id="figure7-12">Figure 7-12</a>: Soldering header pins</p>&#13;
				</figcaption>&#13;
			</figure>&#13;
			<p><a href="#figure7-13" id="figureanchor7-13">Figure 7-13</a> shows the finished product: a custom Arduino shield with two LEDs and two buttons.</p>&#13;
			<figure>&#13;
				<img alt="f07013" src="image_fi/500587c07/f07013.png"/>&#13;
				<figcaption>&#13;
					<p><a id="figure7-13">Figure 7-13</a>: The completed custom shield</p>&#13;
				</figcaption>&#13;
			</figure>&#13;
			<h3 id="h2-500587c07-0006"><span epub:type="pagebreak" id="Page_133" title="133"/>Testing Your ProtoShield</h3>&#13;
			<p class="BodyFirst">Before moving on, it’s a great idea to test your ProtoShield’s buttons and LEDs. The sketch in <a href="#listing7-1" id="listinganchor7-1">Listing 7-1</a> uses the two buttons to turn the LEDs on or off.</p>&#13;
			<pre><code>// Listing 7-1: ProtoShield test&#13;
void setup() &#13;
{ pinMode(2, INPUT); pinMode(3, INPUT); pinMode(5, OUTPUT); pinMode(6, OUTPUT);&#13;
}&#13;
void loop() &#13;
{ if (digitalRead(2) == HIGH) { digitalWrite(5, HIGH); digitalWrite(6, HIGH); } if (digitalRead(3) == HIGH) { digitalWrite(5, LOW); digitalWrite(6, LOW); }&#13;
}</code></pre>&#13;
			<p class="CodeListingCaption"><a id="listing7-1">Listing 7-1</a>: Testing the ProtoShield’s buttons and lights</p>&#13;
			<h2 id="h1-500587c07-0004">Expanding Sketches with Libraries</h2>&#13;
			<p class="BodyFirst">Just as an Arduino shield can expand our hardware, a <em>library</em> can add useful functions to our sketches. These functions can allow us to use hardware specific to a manufacturer’s shield. Anyone can create a library, just as suppliers of various Arduino shields often write their own libraries to match their hardware.</p>&#13;
			<p>&#13;
				The Arduino IDE already includes a set of preinstalled libraries. To include them in your sketches, choose <b>Sketch</b><span class="MenuArrow">▶</span><b>Include Library</b>. You should see the collection of preinstalled libraries with names such as Ethernet, LiquidCrystal, Servo, and so on. Many of these names will be self-explanatory. (If a library is required for a project in this book, it will be explained in detail in these pages.)</p>&#13;
			<p>&#13;
				If you buy a new piece of hardware, you’ll generally need to download and install its libraries from the hardware vendor’s site or from a provided link. There are two methods for installing an Arduino library: downloading the library in a ZIP file or using the Arduino Library Manager. Let’s see how both methods work by walking through a download of the library required by the microSD card shield (<a href="#figure7-3">Figure 7-3</a>).</p>&#13;
			<h3 id="h2-500587c07-0007"><span epub:type="pagebreak" id="Page_134" title="134"/>Downloading an Arduino Library as a ZIP File</h3>&#13;
			<p class="BodyFirst">First, let’s try downloading and installing a library in ZIP format. You’ll download the advanced library used by memory card modules to allow you to read and write data to microSD and SD cards:</p>&#13;
			<ol class="decimal">&#13;
				<li value="1">Visit <a class="LinkURL" href="https://github.com/greiman/SdFat/">https://github.com/greiman/SdFat/</a> and click <b>Code</b>. Make sure <b>HTTPS</b> is selected and then click <b>Download ZIP</b>, as demonstrated in <a href="#figure7-14" id="figureanchor7-14">Figure 7-14</a>.&#13;
					<figure>&#13;
						<img alt="f07014" src="image_fi/500587c07/f07014.png"/>&#13;
						<figcaption>&#13;
							<p><a id="figure7-14">Figure 7-14</a>: Library download page</p>&#13;
						</figcaption>&#13;
					</figure>&#13;
					</li>&#13;
				<li value="2">After a moment, the file <em>SdFat-master.zip</em> will appear in your <em>Downloads</em> folder, as shown in <a href="#figure7-15" id="figureanchor7-15">Figure 7-15</a>. If you are using an Apple computer, the ZIP file may be extracted automatically.&#13;
					<figure>&#13;
						<img alt="f07015" src="image_fi/500587c07/f07015.png"/>&#13;
						<figcaption>&#13;
							<p><a id="figure7-15">Figure 7-15</a>: <em>Downloads</em> folder containing <em>SdFat-master.zip</em></p>&#13;
						</figcaption>&#13;
					</figure>&#13;
					</li>&#13;
				<li value="3">Open the Arduino IDE and choose <b>Sketch</b><span class="MenuArrow">▶</span><b>Include Library</b><span class="MenuArrow">▶</span><b>Add .ZIP Library</b>, as shown in <a href="#figure7-16" id="figureanchor7-16">Figure 7-16</a>.<span epub:type="pagebreak" id="Page_135" title="135"/>&#13;
				<figure><img alt="f07016" src="image_fi/500587c07/f07016.png"/><figcaption>&#13;
							<p><a id="figure7-16">Figure 7-16</a>: Starting the library installation process</p>&#13;
						</figcaption>&#13;
					</figure>&#13;
					<p class="ListBody">You will be presented with a file manager dialog, as shown in <a href="#figure7-17" id="figureanchor7-17">Figure 7-17</a>. Navigate to your <em>Downloads</em> folder (or wherever you saved the ZIP file) and click <b>Open</b>.</p>&#13;
					<figure>&#13;
						<img alt="f07017" src="image_fi/500587c07/f07017.png"/>&#13;
						<figcaption>&#13;
							<p><a id="figure7-17">Figure 7-17</a>: Locating the ZIP file</p>&#13;
						</figcaption>&#13;
					</figure>&#13;
					<p class="ListBody">The Arduino IDE will now take care of the library installation. After a few moments, you will be notified that the library has been installed by a message in the IDE output window, as shown in <a href="#figure7-18" id="figureanchor7-18">Figure 7-18</a>.</p>&#13;
					<figure>&#13;
						<img alt="f07018" src="image_fi/500587c07/f07018.png"/>&#13;
						<figcaption>&#13;
							<p><a id="figure7-18">Figure 7-18</a>: Arduino library installation success</p>&#13;
						</figcaption>&#13;
					</figure>&#13;
					</li>&#13;
				<li value="4"><span epub:type="pagebreak" id="Page_136" title="136"/>You can verify that the SdFat<em> </em>library has been installed and is available by searching through the IDE’s Library Manager. To do this, click the Library Manager icon in the vertical group on the left of the IDE, then search using the box at the top, or scroll down until you see your library. For example, in <a href="#figure7-19" id="figureanchor7-19">Figure 7-19</a> you can see that SdFat appears in the Library Manager. &#13;
					<figure>&#13;
						<img alt="f07019" src="image_fi/500587c07/f07019.png"/>&#13;
						<figcaption>&#13;
							<p><a id="figure7-19">Figure 7-19</a>: Successful installation of the SdFat library</p>&#13;
						</figcaption>&#13;
					</figure>&#13;
					</li>&#13;
			</ol>&#13;
			<h3 id="h2-500587c07-0008">Importing an Arduino Library with Library Manager</h3>&#13;
			<p class="BodyFirst">The alternative method of installing an Arduino library is via the Arduino IDE’s built-in Library Manager. This is a tool for accessing an online repository of libraries that are available for use by the wider public and have been personally approved by the Arduino team, or are just very popular. You will generally access the Library Manager when instructed to by a hardware supplier.</p>&#13;
			<p>As an example, we’ll download the FastLED Arduino library, which is used by a popular type of RGB LED.</p>&#13;
			<p>&#13;
				To do this, open the Arduino IDE if you’ve not already done so, then open the Library Manager. Enter <b>FastLED</b> in the search box at the top of the manager, as shown in <a href="#figure7-20" id="figureanchor7-20">Figure 7-20</a>. As you type, the manager will return libraries that match your search data, and you can see the required library has appeared.</p>&#13;
				<span epub:type="pagebreak" id="Page_137" title="137"/>&#13;
				<figure>&#13;
				<img alt="f07020" src="image_fi/500587c07/f07020.png"/>&#13;
				<figcaption>&#13;
					<p><a id="figure7-20">Figure 7-20</a>: Searching the Library Manager</p>&#13;
				</figcaption>&#13;
			</figure>&#13;
			<p>&#13;
				Once the library is found and displayed in the Library Manager, move your mouse cursor over the library description. You may have the option to select a version number. Generally, the latest version is displayed by default, so you simply need to click <b>Install</b> and wait for installation to complete. Installation progress is shown in the output window, as shown in <a href="#figure7-21" id="figureanchor7-21">Figure 7-21</a>.</p>&#13;
			<figure>&#13;
				<img alt="f07021" src="image_fi/500587c07/f07021.png"/>&#13;
				<figcaption>&#13;
					<p><a id="figure7-21">Figure 7-21</a>: Library installation process</p>&#13;
				</figcaption>&#13;
			</figure>&#13;
			<p>You can check that the library has been installed using the method described earlier in this chapter.</p>&#13;
			<h2 id="h1-500587c07-0005">SD Memory Cards</h2>&#13;
			<p class="BodyFirst">By using SD or microSD cards with your Arduino, you can capture data from many sources, such as the TMP36 temperature sensor we used in <span class="xref" itemid="xref_target_Chapter 4">Chapter 4</span>. You can also use the cards to store web server data or any files that your project might use. To record and store the data you collect, you can use a memory card like the one shown in <a href="#figure7-22" id="figureanchor7-22">Figure 7-22</a>.</p>&#13;
			<span epub:type="pagebreak" id="Page_138" title="138"/>&#13;
			<figure>&#13;
				<img alt="f07022" src="image_fi/500587c07/f07022.png"/>&#13;
				<figcaption>&#13;
					<p><a id="figure7-22">Figure 7-22</a>: A microSD card with 16GB capacity</p>&#13;
				</figcaption>&#13;
			</figure>&#13;
			<p>Both microSD and SD memory cards are available to work with your Arduino.</p>&#13;
			<aside epub:type="sidebar">&#13;
				<div class="top hr">&#13;
					<hr/>&#13;
				</div>&#13;
				<section class="note">&#13;
					<h2><span class="NoteHead">NOTE</span></h2>&#13;
					<p>	If your memory card isn’t brand new, you’ll need to format it before you can use it. To format the card, plug it into a computer and follow your operating system’s instructions for formatting memory cards.</p>&#13;
					<div class="bottom hr">&#13;
						<hr/>&#13;
					</div>&#13;
				</section>&#13;
			</aside>&#13;
			<h3 id="h2-500587c07-0009">Connecting the Card Module</h3>&#13;
			<p class="BodyFirst">Before you can use the memory card, you’ll need to connect six wires from the card reader module to your Arduino. Both card reader types (microSD and SD) will have the same pins, which should be labeled as shown in <a href="#figure7-23" id="figureanchor7-23">Figure 7-23</a>.</p>&#13;
			<figure>&#13;
				<img alt="f07027" src="image_fi/500587c07/f07027.png"/>&#13;
				<figcaption>&#13;
					<p><a id="figure7-23">Figure 7-23</a>: SD card module</p>&#13;
				</figcaption>&#13;
			</figure>&#13;
			<p><span epub:type="pagebreak" id="Page_139" title="139"/>Make the connections between your Arduino and the card reader as shown in <a href="#table7-1" id="tableanchor7-1">Table 7-1</a>.</p>&#13;
			<figure>&#13;
				<figcaption class="TableTitle">&#13;
					<p><a id="table7-1">Table 7-1</a>: Connections Between the Card Module and Arduino</p>&#13;
				</figcaption>&#13;
				<table border="1" id="table-500587c07-0001">&#13;
					<thead>&#13;
						<tr>&#13;
							<td><b>Module pin label</b></td>&#13;
							<td><b>To Arduino pin</b></td>&#13;
							<td><b>Module pin functions</b></td>&#13;
						</tr>&#13;
					</thead>&#13;
					<tbody>&#13;
						<tr>&#13;
							<td>5 V or Vcc</td>&#13;
							<td>5 V</td>&#13;
							<td>Power</td>&#13;
						</tr>&#13;
						<tr>&#13;
							<td>GND</td>&#13;
							<td>GND</td>&#13;
							<td>GND</td>&#13;
						</tr>&#13;
						<tr>&#13;
							<td>CS</td>&#13;
							<td>D10</td>&#13;
							<td>Chip select</td>&#13;
						</tr>&#13;
						<tr>&#13;
							<td>MOSI</td>&#13;
							<td>D11</td>&#13;
							<td>Data in from Arduino</td>&#13;
						</tr>&#13;
						<tr>&#13;
							<td>MISO</td>&#13;
							<td>D12</td>&#13;
							<td>Data out to Arduino</td>&#13;
						</tr>&#13;
						<tr>&#13;
							<td>SCK</td>&#13;
							<td>D13</td>&#13;
							<td>Clock</td>&#13;
						</tr>&#13;
					</tbody>&#13;
				</table>&#13;
			</figure>&#13;
			<h3 id="h2-500587c07-0010">Testing Your SD Card</h3>&#13;
			<p class="BodyFirst">After you have finished connecting the card module to your Arduino—and you have a new or newly formatted card—now is the time to make sure the card is working correctly. To do so, follow these steps:</p>&#13;
			<ol class="decimal">&#13;
				<li value="1">Insert the memory card into the card module. Then connect the module to the Arduino and the Arduino to your PC via the USB cable.</li>&#13;
				<li value="2">Open the IDE and select <b>File</b><span class="MenuArrow">▶</span><b>Examples</b><span class="MenuArrow">▶</span><b>SdFat</b><span class="MenuArrow">▶</span><b>SdInfo</b>. This will load an example sketch.</li>&#13;
				<li value="3">Scroll down to line 36 in the sketch and change the value of <code>const int chipSelect</code> from <code>4</code> to <code>10</code>, as shown in <a href="#figure7-24" id="figureanchor7-24">Figure 7-24</a>. This is necessary as the pin used varies depending on the SD card hardware. Now upload this sketch to your Arduino. &#13;
					<figure>&#13;
						<img alt="f07024" src="image_fi/500587c07/f07024.png"/>&#13;
						<figcaption>&#13;
							<p><a id="figure7-24">Figure 7-24</a>: Altering the test sketch</p>&#13;
						</figcaption>&#13;
					</figure>&#13;
					</li>&#13;
				<li value="4">Finally, open the Serial Monitor window, set it to 9,600 baud, press any key on the keyboard, and press <span class="KeyCaps">enter</span>. After a moment, you should see some data about the microSD card, as shown in <a href="#figure7-25" id="figureanchor7-25">Figure 7-25</a>.</li>&#13;
			</ol>&#13;
			<span epub:type="pagebreak" id="Page_140" title="140"/>&#13;
			<figure>&#13;
				<img alt="f07025" src="image_fi/500587c07/f07025.png"/>&#13;
				<figcaption>&#13;
					<p><a id="figure7-25">Figure 7-25</a>: Results of a successful memory card test</p>&#13;
				</figcaption>&#13;
			</figure>&#13;
			<p>If the test results don’t appear in the Serial Monitor, try the following:</p>&#13;
			<ul>&#13;
				<li>Remove the USB cable from your Arduino and remove and reinsert the microSD card.</li>&#13;
				<li>&#13;
					Make sure that the wiring connections match those in <a href="#table7-1">Table 7-1</a>.</li>&#13;
				<li>Check that the Serial Monitor baud rate is 9,600 and that a regular Arduino Uno–compatible board is being used. The Mega and some other board models have the SPI pins in different locations.</li>&#13;
				<li>Reformat your memory card.</li>&#13;
				<li>Failing all else, try a new name-brand memory card.</li>&#13;
			</ul>&#13;
			<p>Finally, before either inserting your memory card or removing it, ensure the entire project is disconnected from the USB and/or power supply.</p>&#13;
			<h2 class="HeadProject" id="h1-500587c07-0006"><span>Project #22: Writing Data to the Memory Card</span></h2>&#13;
			<p class="BodyFirst">In this project, you’ll use a memory card to store data—specifically, a multiplication table.</p>&#13;
			<h3 id="h2-500587c07-0011">The Sketch</h3>&#13;
			<p class="BodyFirst">To write data to the memory card, connect your shield, insert a microSD card, and then enter and upload the following sketch:</p>&#13;
			<pre><code>// Project 22 - Writing Data to the Memory Card&#13;
#include &lt;SD.h&gt;&#13;
int b = 0;&#13;
void setup()&#13;
{ Serial.begin(9600); Serial.println("Initializing SD card..."); pinMode(10, OUTPUT); // check that the memory card exists and is usable if (!SD.begin(10)) { Serial.println("Card failed, or not present");<span epub:type="pagebreak" id="Page_141" title="141"/>    // stop sketch return; } Serial.println("memory card is ready");&#13;
}&#13;
void loop()&#13;
{<span aria-label="annotation1" class="CodeAnnotationHang">1</span>   // create the file for writing File dataFile = SD.open("DATA.TXT", FILE_WRITE); // if the file is ready, write to it: if (dataFile) <span aria-label="annotation2" class="CodeAnnotationHang">2</span>   {<b> </b> for ( int a = 0 ; a &lt; 11 ; a++ ) { dataFile.print(a); dataFile.print(" multiplied by two is "); b = a * 2;<span aria-label="annotation3" class="CodeAnnotationHang">3</span>       dataFile.println(b, DEC);<b> </b> }<span aria-label="annotation4" class="CodeAnnotationHang">4</span>     dataFile.close(); // close the file once the system has finished with it  // (mandatory) }   // if the file isn't ready, show an error: else { Serial.println("error opening DATA.TXT"); } Serial.println("finished"); do {} while (1);&#13;
}</code></pre>&#13;
			<figure>&#13;
				<img alt="f07026" src="image_fi/500587c07/f07026.png"/>&#13;
				<figcaption>&#13;
					<p><a id="figure7-26">Figure 7-26</a>: Output from Project 22</p>&#13;
				</figcaption>&#13;
			</figure>&#13;
			<p>&#13;
				The sketch creates a text file called <em>DATA.TXT</em> on the microSD card, as shown in <a href="#figure7-26" id="figureanchor7-26">Figure 7-26</a>.</p>&#13;
			<p>&#13;
				Let’s review the <code>void loop()</code> section of the sketch to see how it created the text file. The code in <code>void loop()</code> between <span aria-label="annotation1" class="CodeAnnotation">1</span> and <span aria-label="annotation2" class="CodeAnnotation">2</span> creates and opens the file for writing. To write text to the file, we use <code>dataFile.print()</code> or <code>dataFile.println()</code>.</p>&#13;
			<p>&#13;
				This code works in the same manner as, for example, <code>Serial.println()</code>, so you can write it in the same manner as you would to the Serial Monitor. At <span aria-label="annotation1" class="CodeAnnotation">1</span> we set the name of the created text file, which must be eight characters or less, followed by a dot, and then three characters, such as <em>DATA.TXT</em>.</p>&#13;
			<p>&#13;
				At <span aria-label="annotation3" class="CodeAnnotation">3</span>, we use <code>DEC</code> as the second parameter. This states that the variable is a decimal number and should be written to the text file as such. If we were writing a <code>float</code> variable instead, then we would use a digit for the number of decimal places to write (to a maximum of six).</p>&#13;
			<p><span epub:type="pagebreak" id="Page_142" title="142"/>When we’re finished writing data to the file, at <span aria-label="annotation4" class="CodeAnnotation">4</span>, we use <code>dataFile.close()</code> to close the file for writing. If this step is not followed, the computer will not be able to read the created text file.</p>&#13;
			<h2 class="HeadProject" id="h1-500587c07-0007"><span>Project #23: Creating a Temperature-Logging Device</span></h2>&#13;
			<p class="BodyFirst">Now that you know how to record data, let’s measure and record the temperature every minute for 8 hours using our memory card setup from Project 22 and the TMP36 temperature sensor circuit introduced in <span class="xref" itemid="xref_target_Chapter 4">Chapter 4</span>.</p>&#13;
			<h3 id="h2-500587c07-0012">The Hardware</h3>&#13;
			<p class="BodyFirst">The following hardware is required:</p>&#13;
			<ul>&#13;
				<li>One TMP36 temperature sensor</li>&#13;
				<li>One breadboard</li>&#13;
				<li>Various connecting wires</li>&#13;
				<li>Memory card and module</li>&#13;
				<li>Arduino and USB cable</li>&#13;
			</ul>&#13;
			<p>Insert the microSD card into the shield, and then insert the shield into the Arduino. Connect the left (5 V) pin of the TMP36 to Arduino 5 V, the middle pin to analog, and the right pin to GND.</p>&#13;
			<h3 id="h2-500587c07-0013">The Sketch</h3>&#13;
			<p class="BodyFirst">Enter and upload the following sketch:</p>&#13;
			<pre><code>// Project 23 - Creating a Temperature-Logging Device&#13;
#include &lt;SD.h&gt;&#13;
float sensor, voltage, celsius;&#13;
void setup()&#13;
{ Serial.begin(9600); Serial.println("Initializing SD card..."); pinMode(10, OUTPUT); // check that the memory card exists and can be used if (!SD.begin(10)) { Serial.println("Card failed, or not present"); // stop sketch return; } Serial.println("memory card is ready");&#13;
}&#13;
void loop()<span epub:type="pagebreak" id="Page_143" title="143"/>{ // create the file for writing File dataFile = SD.open("DATA.TXT", FILE_WRITE); // if the file is ready, write to it: if (dataFile)  { for ( int a = 0 ; a &lt; 481 ; a++ ) // 480 minutes in 8 hours { sensor = analogRead(0); voltage = (sensor * 5000) / 1024; // convert raw sensor value to // millivolts voltage = voltage - 500; celsius = voltage / 10; dataFile.print(" Log: "); dataFile.print(a, DEC);     dataFile.print(" Temperature: "); dataFile.print(celsius, 2); dataFile.println(" degrees C"); delay(599900); // wait just under one minute } dataFile.close(); // mandatory  Serial.println("Finished!"); do {} while (1); }&#13;
}</code></pre>&#13;
			<p>&#13;
				The sketch will take a little more than 8 hours to complete, but you can alter this period by lowering the value in <code>delay(599900)</code>.</p>&#13;
			<p>&#13;
				After the sketch has finished, remove the microSD card from the Arduino, insert it into your computer, and open the log file in a text editor, as shown in <a href="#figure7-27" id="figureanchor7-27">Figure 7-27</a>.</p>&#13;
			<figure>&#13;
				<img alt="f07031" src="image_fi/500587c07/f07031.png"/>&#13;
				<figcaption>&#13;
					<p><a id="figure7-27">Figure 7-27</a>: Results from Project 23</p>&#13;
				</figcaption>&#13;
			</figure>&#13;
			<p>&#13;
				For more serious analysis of the captured data, delimit the lines of text written to the log file with spaces or colons so that the file can be easily imported into a spreadsheet. For example, you could import the file into <span epub:type="pagebreak" id="Page_144" title="144"/>OpenOffice Calc or Excel to produce a spreadsheet like the one shown in <a href="#figure7-28" id="figureanchor7-28">Figure 7-28</a>.</p>&#13;
			<figure>&#13;
				<img alt="f07028" src="image_fi/500587c07/f07028.png"/>&#13;
				<figcaption>&#13;
					<p><a id="figure7-28">Figure 7-28</a>: Importing the data into a spreadsheet</p>&#13;
				</figcaption>&#13;
			</figure>&#13;
			<p>&#13;
				Then you can easily perform some statistical analysis of the data, as shown in <a href="#figure7-29" id="figureanchor7-29">Figure 7-29</a>.</p>&#13;
			<p>The temperature examples can be hacked to suit your own data analysis projects. You can use these same concepts to record any form of data that can be generated by an Arduino system.</p>&#13;
			<figure>&#13;
				<img alt="f07029" src="image_fi/500587c07/f07029.png"/>&#13;
				<figcaption>&#13;
					<p><a id="figure7-29">Figure 7-29</a>: Temperature analysis</p>&#13;
				</figcaption>&#13;
			</figure>&#13;
			<h2 id="h1-500587c07-0008">Timing Applications with millis() and micros()</h2>&#13;
			<p class="BodyFirst">Each time the Arduino starts running a sketch, it also records the passage of time using milliseconds and microseconds. A millisecond is one thousandth of a second (0.001), and a microsecond is one millionth of a second (0.000001). You can use these values to measure the passage of time when running sketches.</p>&#13;
			<p><span epub:type="pagebreak" id="Page_145" title="145"/>The following functions will access the time values stored in an <code>unsigned long</code> variable:</p>&#13;
			<pre><code>  unsigned long a,b; a = micros(); b = millis();</code></pre>&#13;
			<p>&#13;
				Due to the limitations of the <code>unsigned long</code> variable type (which stores only positive values), the value will reset to 0 after reaching 4,294,967,295, allowing for around 50 days of counting using <code>millis()</code> and 70 minutes using <code>micros()</code>. Furthermore, due to the limitations of the Arduino’s microprocessor, <code>micros()</code> values are always a multiple of four.</p>&#13;
			<p>&#13;
				Let’s use these values to see how long it takes for the Arduino to turn a digital pin from low to high and vice versa. To do this, we’ll read <code>micros()</code> before and after a <code>digitalWrite()</code> function, find the difference, and display it in the Serial Monitor. The only required hardware is your Arduino and cable.</p>&#13;
			<p>&#13;
				Enter and upload the sketch shown in <a href="#listing7-2" id="listinganchor7-2">Listing 7-2</a>.</p>&#13;
			<pre><code>// Listing 7-2&#13;
unsigned long starting, finished, elapsed;&#13;
void setup()&#13;
{ Serial.begin(9600); pinMode(3, OUTPUT); digitalWrite(3, LOW);&#13;
}&#13;
void loop()&#13;
{<span aria-label="annotation1" class="CodeAnnotationHang">1</span>   starting = micros();  digitalWrite(3, HIGH);<span aria-label="annotation2" class="CodeAnnotationHang">2</span>   finished = micros();<b> </b><span aria-label="annotation3" class="CodeAnnotationHang">3</span>   elapsed = finished – starting;  Serial.print("LOW to HIGH: "); Serial.print(elapsed); Serial.println(" microseconds"); delay(1000);<span aria-label="annotation4" class="CodeAnnotationHang">4</span>   starting = micros(); digitalWrite(3, LOW); finished = micros(); elapsed = finished - starting; Serial.print("HIGH to LOW: "); Serial.print(elapsed); Serial.println(" microseconds"); delay(1000);&#13;
}</code></pre>&#13;
			<p class="CodeListingCaption"><a id="listing7-2">Listing 7-2</a>: Timing digital pin state change with <code>micros()</code></p>&#13;
			<p><span epub:type="pagebreak" id="Page_146" title="146"/>The sketch takes readings of <code>micros()</code> before and after the <code>digitalWrite(HIGH)</code> function call, at <span aria-label="annotation1" class="CodeAnnotation">1</span> and <span aria-label="annotation2" class="CodeAnnotation">2</span>, and then it calculates the difference and displays it in the Serial Monitor at <span aria-label="annotation3" class="CodeAnnotation">3</span>. This is repeated for the opposite function at <span aria-label="annotation4" class="CodeAnnotation">4</span>.</p>&#13;
			<p>&#13;
				Now open the Serial Monitor to view the results, shown in <a href="#figure7-30" id="figureanchor7-30">Figure 7-30</a>.</p>&#13;
			<figure>&#13;
				<img alt="f07030" src="image_fi/500587c07/f07030.png"/>&#13;
				<figcaption>&#13;
					<p><a id="figure7-30">Figure 7-30</a>: Output from <a href="#listing7-2">Listing 7-2</a></p>&#13;
				</figcaption>&#13;
			</figure>&#13;
			<p>Because the resolution is 4 microseconds, if the value is 8 microseconds, we know that the duration is greater than 4 and less than or equal to 8.</p>&#13;
			<h2 class="HeadProject" id="h1-500587c07-0009"><span>Project #24: Creating a Stopwatch</span></h2>&#13;
			<p class="BodyFirst">Now that we can measure the elapsed time between two events, we can create a simple stopwatch using an Arduino. Our stopwatch will use two buttons: one to start or reset the count and one to stop counting and show the elapsed time. The sketch will continually check each button’s status. When the start button is pressed, a <code>millis()</code> value will be stored, and when the stop button is pressed, a new <code>millis()</code> value will be stored. The custom function <code>displayResult()</code> will convert the elapsed time from milliseconds into hours, minutes, and seconds. Finally, the time will be displayed in the Serial Monitor.</p>&#13;
			<h3 id="h2-500587c07-0014">The Hardware</h3>&#13;
			<p class="BodyFirst">Use the ProtoShield as described earlier in this chapter and the following additional hardware:</p>&#13;
			<ul>&#13;
				<li>One breadboard</li>&#13;
				<li>Two push buttons (S1 and S2)</li>&#13;
				<li>&#13;
					Two 10 k<span class="NSSymbol">Ω</span> resistors (R1 and R2)</li>&#13;
				<li>Various connecting wires</li>&#13;
				<li>Arduino and USB cable</li>&#13;
			</ul>&#13;
			<h3 id="h2-500587c07-0015"><span epub:type="pagebreak" id="Page_147" title="147"/>The Schematic</h3>&#13;
			<p class="BodyFirst">The circuit schematic is shown in <a href="#figure7-31" id="figureanchor7-31">Figure 7-31</a>.</p>&#13;
			<aside epub:type="sidebar">&#13;
				<div class="top hr">&#13;
					<hr/>&#13;
				</div>&#13;
				<section class="note">&#13;
					<h2><span class="NoteHead">NOTE</span></h2>&#13;
					<p>	You will use this circuit for the next project, so don’t pull it apart when you’re finished!</p>&#13;
					<div class="bottom hr">&#13;
						<hr/>&#13;
					</div>&#13;
				</section>&#13;
			</aside>&#13;
			<figure>&#13;
				<img alt="f07035" src="image_fi/500587c07/f07035.png"/>&#13;
				<figcaption>&#13;
					<p><a id="figure7-31">Figure 7-31</a>: Schematic for Project 24</p>&#13;
				</figcaption>&#13;
			</figure>&#13;
			<h3 id="h2-500587c07-0016">The Sketch</h3>&#13;
			<p class="BodyFirst">Enter and upload this sketch:</p>&#13;
			<pre><code>// Project 24 – Creating a Stopwatch&#13;
unsigned long starting, finished, elapsed;&#13;
void setup() &#13;
{ Serial.begin(9600); <span aria-label="annotation1" class="CodeAnnotationHang">1</span>   pinMode(2, INPUT); // the start button pinMode(3, INPUT); // the stop button Serial.println("Press 1 for Start/reset, 2 for elapsed time");<span epub:type="pagebreak" id="Page_148" title="148"/>}&#13;
void displayResult()&#13;
{ float h, m, s, ms; unsigned long over;<span aria-label="annotation2" class="CodeAnnotationHang">2</span>   elapsed = finished - starting; h    = int(elapsed / 3600000); over = elapsed % 3600000; m    = int(over / 60000); over = over % 60000; s    = int(over / 1000); ms   = over % 1000; Serial.print("Raw elapsed time: "); Serial.println(elapsed); Serial.print("Elapsed time: "); Serial.print(h, 0); Serial.print("h "); Serial.print(m, 0); Serial.print("m "); Serial.print(s, 0); Serial.print("s "); Serial.print(ms, 0); Serial.println("ms"); Serial.println(); &#13;
}&#13;
void loop() &#13;
{<span aria-label="annotation3" class="CodeAnnotationHang">3</span>   if (digitalRead(2) == HIGH) { starting = millis(); delay(200); // for debounce Serial.println("Started..."); }<span aria-label="annotation4" class="CodeAnnotationHang">4</span>   if (digitalRead(3) == HIGH) { finished = millis(); delay(200); // for debounce      displayResult(); }&#13;
}</code></pre>&#13;
			<p>&#13;
				The basis for our stopwatch is simple. At <span aria-label="annotation1" class="CodeAnnotation">1</span>, we set up the digital input pins for the start and stop buttons. At <span aria-label="annotation3" class="CodeAnnotation">3</span>, if the start button is pressed, then the Arduino notes the value for <code>millis()</code> that we use to calculate the elapsed time once the stop button is pressed at <span aria-label="annotation4" class="CodeAnnotation">4</span>. After the stop button is pressed, <span epub:type="pagebreak" id="Page_149" title="149"/>the elapsed time is calculated in the function <code>displayResult()</code> at <span aria-label="annotation2" class="CodeAnnotation">2</span> and shown in the Serial Monitor window.</p>&#13;
			<p>&#13;
				You should see results like those in <a href="#figure7-32" id="figureanchor7-32">Figure 7-32</a> in the Serial Monitor.</p>&#13;
			<figure>&#13;
				<img alt="f07032" src="image_fi/500587c07/f07032.png"/>&#13;
				<figcaption>&#13;
					<p><a id="figure7-32">Figure 7-32</a>: Output from Project 24</p>&#13;
				</figcaption>&#13;
			</figure>&#13;
			<h2 id="h1-500587c07-0010">Interrupts</h2>&#13;
			<p class="BodyFirst">An <em>interrupt </em>in the Arduino world is basically a signal that allows a function to be called at any time within a sketch—for example, when a digital input pin’s state changes or a timer event is triggered. Interrupts are perfect for calling a function to interrupt the normal operation of a sketch, such as when a button is pressed. This type of function is often referred to as an <em>interrupt handler</em>.</p>&#13;
			<p>When an interrupt is triggered, the normal operation and running of your program is halted temporarily as the interrupt function is called and executed. Then, when the interrupt function exits, whatever was happening in the program continues exactly where it left off.</p>&#13;
			<p>&#13;
				Interrupt functions should be short and simple. They should exit quickly, and keep in mind that if the interrupt function does something that the main loop is already doing, then the interrupt function is going to temporarily override the main loop’s activity before the main loop resumes. For example, if the main loop is regularly sending <em>Hello</em> out the serial port and the interrupt function sends <em>---</em> when it is triggered, then you could see any of these come out the serial port: <em>H----ello</em>, <em>He----llo</em>, <em>Hel----lo</em>, <em>Hell----o</em>, or <em>Hello----</em>.</p>&#13;
			<p>The Arduino Uno offers two interrupts that are available using digital pins 2 and 3. When properly configured, the Arduino will monitor the voltage applied to the pins. When the voltage changes in a certain defined way (when a button is pressed, for example), an interrupt is triggered, causing a corresponding function to run—maybe something that sends “Stop Pressing Me!”</p>&#13;
			<h3 id="h2-500587c07-0017"><span epub:type="pagebreak" id="Page_150" title="150"/>Interrupt Modes</h3>&#13;
			<p class="BodyFirst">One of four changes (or <em>modes</em>) can trigger an interrupt:</p>&#13;
			<ol class="none">&#13;
				<li><span class="RunInHead"><code class="bold">LOW</code></span>  No current is applied to the interrupt pin.</li>&#13;
				<li><span class="RunInHead"><code class="bold">CHANGE</code></span>  The current changes, either between on and off or between off and on.</li>&#13;
				<li><span class="RunInHead"><code class="bold">RISING</code></span>  The current changes from off to on at 5 V.</li>&#13;
				<li><span class="RunInHead"><code class="bold">FALLING</code></span>  The current changes from on at 5 V to off.</li>&#13;
			</ol>&#13;
			<p>&#13;
				For example, to detect when a button attached to an interrupt pin has been pressed, you could use the <code>RISING</code> mode. Or, for example, if you had an electric trip wire running around your garden (connected between 5 V and the interrupt pin), then you could use the <code>FALLING</code> mode to detect when the wire has been tripped and broken.</p>&#13;
			<aside epub:type="sidebar">&#13;
				<div class="top hr">&#13;
					<hr/>&#13;
				</div>&#13;
				<section class="note">&#13;
					<h2><span class="NoteHead">NOTE</span></h2>&#13;
					<p>&#13;
							The <code>delay()</code> and <code>Serial.available()</code> functions will not work within a function that has been called by an interrupt.</p>&#13;
					<div class="bottom hr">&#13;
						<hr/>&#13;
					</div>&#13;
				</section>&#13;
			</aside>&#13;
			<h3 id="h2-500587c07-0018">Configuring Interrupts</h3>&#13;
			<p class="BodyFirst">To configure interrupts, use the following in <code>void setup()</code>:</p>&#13;
			<pre><code>  attachInterrupt(0, <em>function</em>, <em>mode</em>); attachInterrupt(1, <em>function</em>, <em>mode</em>); </code></pre>&#13;
			<p>&#13;
				Here, <code>0</code> is for digital pin 2, <code>1</code> is for digital pin 3, <var>function</var> is the name of the function to call when the interrupt is triggered, and <var>mode</var> is one of the four modes that triggers the interrupt.</p>&#13;
			<h3 id="h2-500587c07-0019">Activating or Deactivating Interrupts</h3>&#13;
			<p class="BodyFirst">Sometimes you won’t want to use the interrupts within a sketch. You can deactivate a single interrupt using:</p>&#13;
			<pre><code>detachInterrupt(digitalPinToInterrupt<em>(pin)</em>)</code></pre>&#13;
			<p class="BodyContinued">where <var>pin</var> is the digital pin number used. Or you can deactivate them all using the following:</p>&#13;
			<pre><code>noInterrupts(); // deactivate interrupts</code></pre>&#13;
			<p class="BodyContinued">And then reactivate them with this:</p>&#13;
			<pre><code>interrupts(); // reactivate interrupts</code></pre>&#13;
			<p>Interrupts work quickly and they are very sensitive. These qualities make them useful for time-critical applications or for “emergency stop” buttons on projects.</p>&#13;
			<h2 class="HeadProject" id="h1-500587c07-0011"><span><span epub:type="pagebreak" id="Page_151" title="151"/>Project #25: Using Interrupts</span></h2>&#13;
			<p class="BodyFirst">We’ll use the circuit from Project 24 to demonstrate the use of interrupts. Our example will blink the built-in LED every 500 milliseconds, during which time both interrupt pins will be monitored. When the button on interrupt 0 is pressed, the value for <code>micros()</code> will be displayed in the Serial Monitor, and when the button on interrupt 1 is pressed, the value for <code>millis()</code> will be displayed.</p>&#13;
			<h3 id="h2-500587c07-0020">The Sketch</h3>&#13;
			<p class="BodyFirst">Enter and upload the following sketch:</p>&#13;
			<pre><code>// Project 25 – Using Interrupts&#13;
#define LED 13&#13;
void setup()&#13;
{ Serial.begin(9600); pinMode(13, OUTPUT); attachInterrupt(0, displayMicros, RISING); attachInterrupt(1, displayMillis, RISING); &#13;
}<span aria-label="annotation1" class="CodeAnnotationHang">1</span> void displayMicros()&#13;
{ Serial.write("micros() = "); Serial.println(micros());&#13;
}<span aria-label="annotation2" class="CodeAnnotationHang">2</span><b> </b>void displayMillis()&#13;
{ Serial.write("millis() = "); Serial.println(millis());&#13;
}<span aria-label="annotation3" class="CodeAnnotationHang">3</span> void loop()&#13;
{ digitalWrite(LED, HIGH); delay(500); digitalWrite(LED, LOW); delay(500);&#13;
}</code></pre>&#13;
			<p>&#13;
				This sketch will blink the onboard LED as shown in <code>void loop()</code> at <span aria-label="annotation3" class="CodeAnnotation">3</span>. When interrupt 0 is triggered, the function <code>displayMicros()</code> at <span aria-label="annotation1" class="CodeAnnotation">1</span> will be called; when interrupt 1 is triggered, the function <code>displayMillis()</code> at <span aria-label="annotation2" class="CodeAnnotation">2</span> will be called. After either function has finished, the sketch resumes running the code in <code>void loop()</code>.</p>&#13;
			<p><span epub:type="pagebreak" id="Page_152" title="152"/>Open the Serial Monitor window and press the two buttons to view the values for <code>millis()</code> and <code>micros()</code>, as shown in <a href="#figure7-33" id="figureanchor7-33">Figure 7-33</a>.</p>&#13;
			<figure>&#13;
				<img alt="f07033" src="image_fi/500587c07/f07033.png"/>&#13;
				<figcaption>&#13;
					<p><a id="figure7-33">Figure 7-33</a>: Output from Project 25</p>&#13;
				</figcaption>&#13;
			</figure>&#13;
			<h2 id="h1-500587c07-0012">Looking Ahead</h2>&#13;
			<p class="BodyFirst">This chapter has given you more tools and options that you can adapt to create and improve your own projects. In future chapters, we will work with more Arduino shields, use interrupts for timing projects, and use the memory card module in other data-logging applications.</p>&#13;
		</section>&#13;
	</body></html>