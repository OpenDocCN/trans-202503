<html><head></head><body>
		<section>&#13;
			<header>&#13;
				<h1 class="chapter"><span class="ChapterNumber"><span epub:type="pagebreak" id="Page_211" title="211"/>12</span><br/><span class="ChapterTitle">Accepting User Input with Touchscreens</span></h1>&#13;
			</header>&#13;
			<p class="ChapterIntro">In this chapter you will</p>&#13;
			<ul>&#13;
				<li>Learn how to connect a resistive touchscreen to your Arduino</li>&#13;
				<li>Discover the values that can be returned from the touchscreen</li>&#13;
				<li>Create a simple on/off touch switch</li>&#13;
				<li>&#13;
					Learn how to use the <code>map()</code> function</li>&#13;
				<li>Create an on/off touch switch with a dimmer-style control</li>&#13;
			</ul>&#13;
			<p>We see touchscreens everywhere today: on smartphones, tablets, and even portable video game systems. So why not use a touchscreen to accept input from an Arduino user?</p>&#13;
			<h2 id="h1-500587c12-0001">Touchscreens</h2>&#13;
			<p class="BodyFirst">Touchscreens can be quite expensive, but we’ll use an inexpensive model available from Adafruit (part numbers 333 and 3575), originally designed for the Nintendo DS game console.</p>&#13;
			<p>&#13;
				This touchscreen, which measures about 2.45 by 3 inches, is shown in <a href="#figure12-1" id="figureanchor12-1">Figure 12-1</a>.</p>&#13;
				<span epub:type="pagebreak" id="Page_212" title="212"/>&#13;
				<figure>&#13;
				<img alt="f12001" src="image_fi/500587c12/f12001.png"/>&#13;
				<figcaption>&#13;
					<p><a id="figure12-1">Figure 12-1</a>: A touchscreen mounted on a solderless breadboard</p>&#13;
				</figcaption>&#13;
			</figure>&#13;
			<p>&#13;
				Notice the horizontal ribbon cable connected to the small circuit board on the right. This <em>breakout board</em> is used to attach the Arduino and the breadboard to the touchscreen. The header pins included with the breakout board will need to be soldered before use. <a href="#figure12-2" id="figureanchor12-2">Figure 12-2</a> shows a close-up of the breakout board.</p>&#13;
			<figure>&#13;
				<img alt="f12002" src="image_fi/500587c12/f12002.png"/>&#13;
				<figcaption>&#13;
					<p><a id="figure12-2">Figure 12-2</a>: The touchscreen breakout board</p>&#13;
				</figcaption>&#13;
			</figure>&#13;
			<h3 id="h2-500587c12-0001">Connecting the Touchscreen</h3>&#13;
			<p class="BodyFirst">Connect the touchscreen breakout board to an Arduino as shown in <a href="#table12-1" id="tableanchor12-1">Table 12-1</a>.</p>&#13;
			<figure>&#13;
				<figcaption class="TableTitle">&#13;
					<p><a id="table12-1">Table 12-1</a>: Touchscreen Breakout Board Connections</p>&#13;
				</figcaption>&#13;
				<table border="1" id="table-500587c12-0001">&#13;
					<thead>&#13;
						<tr>&#13;
							<td><b>Breakout board pin</b></td>&#13;
							<td><b>Arduino pin</b></td>&#13;
						</tr>&#13;
					</thead>&#13;
					<tbody>&#13;
						<tr>&#13;
							<td>X−</td>&#13;
							<td>A3</td>&#13;
						</tr>&#13;
						<tr>&#13;
							<td>Y+</td>&#13;
							<td>A2</td>&#13;
						</tr>&#13;
						<tr>&#13;
							<td>X+</td>&#13;
							<td>A1</td>&#13;
						</tr>&#13;
						<tr>&#13;
							<td>Y−</td>&#13;
							<td>A0</td>&#13;
						</tr>&#13;
					</tbody>&#13;
				</table>&#13;
			</figure>&#13;
			<h2 class="HeadProject" id="h1-500587c12-0002"><span><span epub:type="pagebreak" id="Page_213" title="213"/>Project #33: Addressing Areas on the Touchscreen</span></h2>&#13;
			<p class="BodyFirst">The touchscreen has two layers of resistive coating between the top layer of plastic film and the bottom layer of glass. One coating acts as the x-axis, and the other is the y-axis. As current passes through each coating, the resistance of the coating varies depending on where it has been touched; when the current is measured, the x and y positions of the touched area can be determined.</p>&#13;
			<p>In this project, we’ll use the Arduino to record touched locations on the screen. We’ll also have it convert information from the touches into integers that represent areas of the screen.</p>&#13;
			<h3 id="h2-500587c12-0002">The Hardware</h3>&#13;
			<p class="BodyFirst">The following hardware is required:</p>&#13;
			<ul>&#13;
				<li>One Adafruit touchscreen, part 333</li>&#13;
				<li>One Adafruit breakout board, part 3575</li>&#13;
				<li>Male-to-male jumper wires</li>&#13;
				<li>One solderless breadboard</li>&#13;
				<li>Arduino and USB cable</li>&#13;
			</ul>&#13;
			<p>&#13;
				Connect the touchscreen as described in <a href="#table12-1">Table 12-1</a> and connect the Arduino to the PC via the USB cable.</p>&#13;
			<h3 id="h2-500587c12-0003">The Sketch</h3>&#13;
			<p class="BodyFirst">Enter and upload the following sketch:</p>&#13;
			<pre><code>// Project 33 - Addressing Areas on the Touchscreen&#13;
int x,y = 0;<span aria-label="annotation1" class="CodeAnnotationHang">1</span> int readX() // returns the value of the touchscreen's x-axis&#13;
{ int xr=0; pinMode(A0, INPUT); pinMode(A1, OUTPUT); pinMode(A2, INPUT); pinMode(A3, OUTPUT); digitalWrite(A1, LOW);  // set A1 to GND digitalWrite(A3, HIGH); // set A3 as 5V delay(5); xr=analogRead(0);       // stores the value of the x-axis return xr;&#13;
}<span aria-label="annotation2" class="CodeAnnotationHang">2</span> int readY() // returns the value of the touchscreen's y-axis&#13;
{ int yr=0; pinMode(A0, OUTPUT); pinMode(A1, INPUT);  pinMode(A2, OUTPUT); pinMode(A3, INPUT); <span epub:type="pagebreak" id="Page_214" title="214"/>  digitalWrite(14, LOW);  // set A0 to GND digitalWrite(16, HIGH); // set A2 as 5V delay(5); yr=analogRead(1);       // stores the value of the y-axis return yr; &#13;
}&#13;
void setup()&#13;
{ Serial.begin(9600);&#13;
}&#13;
void loop()&#13;
{ Serial.print(" x = "); x=readX();<span aria-label="annotation3" class="CodeAnnotationHang">3</span>   Serial.print(x); y=readY(); Serial.print(" y = ");<span aria-label="annotation4" class="CodeAnnotationHang">4</span>   Serial.println(y); delay (200);&#13;
}</code></pre>&#13;
			<p>&#13;
				The functions <code>readX()</code> and <code>readY()</code> at <span aria-label="annotation1" class="CodeAnnotation">1</span> and <span aria-label="annotation2" class="CodeAnnotation">2</span> read the current from the touchscreen’s resistive layers, measure it using <code>analogRead()</code>, and return the read values. The sketch rapidly runs these two functions to provide the real-time position of the screen area being touched and displays this information in the Serial Monitor at <span aria-label="annotation3" class="CodeAnnotation">3</span> and <span aria-label="annotation4" class="CodeAnnotation">4</span>. (The <code>delay(5)</code> in each function is required to allow the input/output pins time to change their states.)</p>&#13;
			<h3 id="h2-500587c12-0004">Testing the Sketch</h3>&#13;
			<p class="BodyFirst">To test the sketch, watch the Serial Monitor window while you touch the screen and notice how the x and y values change as you move your finger around the screen. Also take note of the values displayed when the screen is not being touched, as shown in <a href="#figure12-3" id="figureanchor12-3">Figure 12-3</a>.</p>&#13;
			<figure>&#13;
				<img alt="f12003" src="image_fi/500587c12/f12003.png"/>&#13;
				<figcaption>&#13;
					<p><a id="figure12-3">Figure 12-3</a>: Values that appear when the touchscreen is not touched</p>&#13;
				</figcaption>&#13;
			</figure>&#13;
			<p><span epub:type="pagebreak" id="Page_215" title="215"/>You can use the values that display when you’re not touching the screen in your sketch to detect when the screen is not being touched. Also, displays may vary slightly, so it is important to map out your own unit so you have an understanding of its display boundaries.</p>&#13;
			<h3 id="h2-500587c12-0005">Mapping the Touchscreen</h3>&#13;
			<p class="BodyFirst">You can plot the coordinates for each corner of your touchscreen by touching the corners of the screen and recording the values returned, as shown in <a href="#figure12-4" id="figureanchor12-4">Figure 12-4</a>.</p>&#13;
			<figure>&#13;
				<img alt="f12004" src="image_fi/500587c12/f12004.png"/>&#13;
				<figcaption>&#13;
					<p><a id="figure12-4">Figure 12-4</a>: A touchscreen map</p>&#13;
				</figcaption>&#13;
			</figure>&#13;
			<p>&#13;
				After you’ve created your touchscreen map, you can mathematically divide it into smaller regions, which you can then use with <code>if</code> statements to cause specific actions to occur depending on where the screen is touched. We’ll do that in Project 34.</p>&#13;
			<h2 class="HeadProject" id="h1-500587c12-0003"><span>Project #34: Creating a Two-Zone On/Off Touch Switch</span></h2>&#13;
			<p class="BodyFirst">In this project, we’ll use our touchscreen map to create an on/off switch. Start by dividing the touchscreen in half vertically, as shown in <a href="#figure12-5" id="figureanchor12-5">Figure 12-5</a>.</p>&#13;
			<p>&#13;
				The Arduino will determine which zone of the screen was touched by comparing the recorded coordinates of the touch to the boundaries of each half of the screen. When the zone has been determined, the code responds by returning <code>on</code> or <code>off</code> (though it could also send an on or off signal to a device).</p>&#13;
				<span epub:type="pagebreak" id="Page_216" title="216"/>&#13;
				<figure>&#13;
				<img alt="f12005" src="image_fi/500587c12/f12005.png"/>&#13;
				<figcaption>&#13;
					<p><a id="figure12-5">Figure 12-5</a>: On/off switch map</p>&#13;
				</figcaption>&#13;
			</figure>&#13;
			<h3 id="h2-500587c12-0006">The Sketch</h3>&#13;
			<p class="BodyFirst">Enter and upload the following sketch:</p>&#13;
			<pre><code>// Project 34 - Creating a Two-Zone On/Off Touch Switch&#13;
int x,y = 0;&#13;
void setup()&#13;
{ Serial.begin(9600); pinMode(10, OUTPUT);&#13;
}&#13;
void switchOn()&#13;
{ digitalWrite(10, HIGH); Serial.print("Turned ON at X = "); Serial.print(x); Serial.print(" Y = "); Serial.println(y); delay(200);&#13;
}&#13;
void switchOff()&#13;
{ digitalWrite(10, LOW); Serial.print("Turned OFF at X = "); Serial.print(x); Serial.print(" Y = ");<span epub:type="pagebreak" id="Page_217" title="217"/>  Serial.println(y); delay(200);&#13;
}&#13;
int readX() // returns the value of the touchscreen's x-axis&#13;
{ int xr=0; pinMode(A0, INPUT); pinMode(A1, OUTPUT); pinMode(A2, INPUT); pinMode(A3, OUTPUT); digitalWrite(A1, LOW);  // set A1 to GND digitalWrite(A3, HIGH); // set A3 as 5V delay(5); xr=analogRead(0); return xr;&#13;
}&#13;
int readY() // returns the value of the touchscreen's y-axis&#13;
{ int yr=0; pinMode(A0, OUTPUT); pinMode(A1, INPUT); pinMode(A2, OUTPUT); pinMode(A3, INPUT); digitalWrite(A0, LOW);  // set A0 to GND digitalWrite(A2, HIGH); // set A2 as 5V delay(5); yr=analogRead(1); return yr;&#13;
}&#13;
void loop()&#13;
{ x=readX(); y=readY();<span aria-label="annotation1" class="CodeAnnotationHang">1</span>   // test for ON if (x&lt;=515 &amp;&amp; x&gt;=80) { switchOn(); }<span aria-label="annotation2" class="CodeAnnotationHang">2</span>   // test for OFF if (x&lt;950 &amp;&amp; x&gt;=516) { switchOff(); }&#13;
}</code></pre>&#13;
			<h3 id="h2-500587c12-0007">Understanding the Sketch</h3>&#13;
			<p class="BodyFirst">The two <code>if</code> statements used in <code>void loop()</code> check for a touch on the left or right side of the screen. If the left side is touched, the touch is detected as an “on” press at <span aria-label="annotation1" class="CodeAnnotation">1</span>. If the right side is touched (an “off” press), the touch is detected at <span aria-label="annotation2" class="CodeAnnotation">2</span>.</p>&#13;
			<aside epub:type="sidebar">&#13;
				<div class="top hr">&#13;
					<hr/>&#13;
				</div>&#13;
				<section class="note"><span epub:type="pagebreak" id="Page_218" title="218"/>&#13;
				<h2><span class="NoteHead">NOTE</span></h2>&#13;
					<p>	The y-axis is ignored because the touchscreen is split vertically, so it doesn’t matter whether you touch the screen higher up or lower down. If we were to create horizontal boundaries, the y-axis would need to be checked as well, as you’ll see in Project 35.</p>&#13;
					<div class="bottom hr">&#13;
						<hr/>&#13;
					</div>&#13;
				</section>&#13;
			</aside>&#13;
			<h3 id="h2-500587c12-0008">Testing the Sketch</h3>&#13;
			<p class="BodyFirst">The output of this sketch is shown in <a href="#figure12-6" id="figureanchor12-6">Figure 12-6</a>. The status of the switch and the coordinates are shown after each screen touch.</p>&#13;
			<figure>&#13;
				<img alt="f12006" src="image_fi/500587c12/f12006.png"/>&#13;
				<figcaption>&#13;
					<p><a id="figure12-6">Figure 12-6</a>: Output from Project 34</p>&#13;
				</figcaption>&#13;
			</figure>&#13;
			<h2 id="h1-500587c12-0004">Using the map() Function</h2>&#13;
			<p class="BodyFirst">There may come a time when you need to convert an integer that falls within one range into a value that falls into another range. For example, the x values of your touchscreen might run from 100 to 900, but you might have to translate that to a range of 0 to 255 to control an 8-bit output.</p>&#13;
			<p>&#13;
				To do this we use the <code>map()</code> function, which is laid out as:</p>&#13;
			<pre><code>map(<var>value</var>, <var>fromLow</var>, <var>fromHigh</var>, <var>toLow</var>, <var>toHigh</var>);</code></pre>&#13;
			<p>For example, to translate 450 on the touchscreen to the range 0–255, you would use this code:</p>&#13;
			<pre><code>x = map(450, 100, 900, 0, 255);</code></pre>&#13;
			<p>&#13;
				This would give <code>x</code> a value of 95. You’ll use the <code>map()</code> function in Project 35.</p>&#13;
			<h2 class="HeadProject" id="h1-500587c12-0005"><span>Project #35: Creating a Three-Zone Touch Switch</span></h2>&#13;
			<p class="BodyFirst">In this project, we’ll create a three-zone touch switch for an LED on digital pin 3 that turns the LED on or off and adjusts the brightness from 0 to 255 using PWM (as explained in <span class="xref" itemid="xref_target_Chapter 3">Chapter 3</span>).</p>&#13;
			<h3 id="h2-500587c12-0009"><span epub:type="pagebreak" id="Page_219" title="219"/>The Touchscreen Map</h3>&#13;
			<p class="BodyFirst">Our touchscreen map is shown in <a href="#figure12-7" id="figureanchor12-7">Figure 12-7</a>.</p>&#13;
			<figure>&#13;
				<img alt="f12007" src="image_fi/500587c12/f12007.png"/>&#13;
				<figcaption>&#13;
					<p><a id="figure12-7">Figure 12-7</a>: Touchscreen map for a three-zone touch switch</p>&#13;
				</figcaption>&#13;
			</figure>&#13;
			<p>The touchscreen map is divided into off and on zones and a brightness control zone. We measure the values returned by the touchscreen to determine which part has been touched, then react accordingly.</p>&#13;
			<h3 id="h2-500587c12-0010">The Sketch</h3>&#13;
			<p class="BodyFirst">Enter and upload the following sketch:</p>&#13;
			<pre><code>// Project 35 - Creating a Three-Zone Touch Switch&#13;
int x,y = 0;&#13;
void setup()&#13;
{ pinMode(3, OUTPUT); Serial.begin(9600);&#13;
}&#13;
void switchOn()&#13;
{ digitalWrite(3, HIGH); delay(200);&#13;
}&#13;
void switchOff()&#13;
{ digitalWrite(3, LOW); delay(200);&#13;
}&#13;
void setBrightness()<span epub:type="pagebreak" id="Page_220" title="220"/>{ int PWMvalue;<span aria-label="annotation1" class="CodeAnnotationHang">1</span>   PWMvalue=map(x, 80, 950, 0, 255); analogWrite(3, PWMvalue);&#13;
}&#13;
int readX() // returns the value of x-axis&#13;
{ int xr=0; pinMode(A0, INPUT); pinMode(A1, OUTPUT); pinMode(A2, INPUT); pinMode(A3, OUTPUT); digitalWrite(A1, LOW);  // set A1 to GND digitalWrite(A3, HIGH); // set A3 as 5V delay(5); xr=analogRead(0); return xr;&#13;
}&#13;
int readY() // returns the value of y-axis&#13;
{ int yr=0; pinMode(A0, OUTPUT);  pinMode(A1, INPUT);  pinMode(A2, OUTPUT); pinMode(A3, INPUT);  digitalWrite(A0, LOW);  // set A0 to GND digitalWrite(A2, HIGH); // set A2 as 5V delay(5); yr=analogRead(1); return yr;&#13;
}&#13;
void loop()&#13;
{ x=readX(); y=readY();<span aria-label="annotation2" class="CodeAnnotationHang">2</span>   // test for ON if (x&lt;=950 &amp;&amp; x&gt;=515 &amp;&amp; y&gt;= 500 &amp;&amp; y&gt;900) { switchOn(); }<span aria-label="annotation3" class="CodeAnnotationHang">3</span>   // test for OFF if (x&gt;80 &amp;&amp; x&lt;515 &amp;&amp; y&gt;= 500 &amp;&amp; y&gt;900) { switchOff(); } // test for brightness<span aria-label="annotation4" class="CodeAnnotationHang">4</span>   if (y&gt;=100 &amp;&amp; y&lt;=500) { setBrightness(); } Serial.println(x);&#13;
}</code></pre>&#13;
			<h3 id="h2-500587c12-0011"><span epub:type="pagebreak" id="Page_221" title="221"/>Understanding the Sketch</h3>&#13;
			<p class="BodyFirst">Like the sketch for the two-zone map, this sketch will check for touches in the on and off zones (which are now smaller, because half the screen is reserved for the brightness zone) at <span aria-label="annotation2" class="CodeAnnotation">2</span> and <span aria-label="annotation3" class="CodeAnnotation">3</span> and for any touches above the horizontal divider, which we’ll use to determine brightness, at <span aria-label="annotation4" class="CodeAnnotation">4</span>. If the screen is touched in the brightness area, the position on the x-axis is converted to a relative value for PWM using the <code>map()</code> function at <span aria-label="annotation1" class="CodeAnnotation">1</span>, and the LED is adjusted accordingly using the function <code>setBrightness()</code><em>.</em></p>&#13;
			<p>You can use these same functions to create any number of switches or sliders with this simple and inexpensive touchscreen. Furthermore, you could create your own library to easily return X and Y values and control the brightness in any sketch you write in the future.</p>&#13;
			<h2 id="h1-500587c12-0006">Looking Ahead</h2>&#13;
			<p class="BodyFirst">This chapter introduced you to the touchscreen, another way of accepting user data and controlling your Arduino. In the next chapter, we’ll focus on the Arduino board itself, learn about some of the different versions available, and create our own version on a solderless breadboard.</p>&#13;
		</section>&#13;
	</body></html>