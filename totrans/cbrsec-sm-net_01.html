<html><head></head><body>
<div id="sbo-rt-content"><section aria-labelledby="header0101" class="chapter" epub:type="chapter" id="ch01" role="doc-chapter">
<header id="header0101">
<h1 class="cn"><span aria-label="xxiv" class="page" epub:type="pagebreak" id="pxxiv" role="doc-pagebreak"/><span aria-label="1" class="page" epub:type="pagebreak" id="p1" role="doc-pagebreak"/><a class="xref" href="nsp-enoka501485-0007.xhtml#rch01">1</a></h1>
<h1 class="ct">Getting Started with a Base Linux System and Network Map</h1>
</header>
<figure class="figure">
<p class="fig"><img alt="Chapter opening icon" height="100" src="images/nsp-enoka501485-ct.jpg" width="100"/></p>
</figure>
<p class="pf"><span class="page" data-locator="p1"/>This chapter presents two fundamental projects: setting up a basic Ubuntu system that you’ll use throughout the book and creating a network map. You’ll use this system as a base on top of which you will install and run various security tools, and the network map will provide a visual overview of all the devices in your network and how they interrelate and communicate.</p>
<p>We’ll start with a definition and overview of common Linux operating systems and then go through the steps to install a version of Linux (specifically, Ubuntu) in a virtual machine (VM), on a physical computer, and in the cloud. Regardless of where it’s installed, I’ll show you how to make Ubuntu more secure and then add it to your network map. Every time a new endpoint is added to your network, you must update your network map to ensure it’s always up-to-date. An out-of-date network map is no use to anyone.</p>
<section>
<h2 class="ah" id="ah0301"><span aria-label="2" class="page" epub:type="pagebreak" id="p2" role="doc-pagebreak"/><a class="xref" href="nsp-enoka501485-0007.xhtml#rah0301">Linux Operating Systems</a></h2>
<p class="paft">Linux is the operating system of choice, as Linux systems are open source and therefore very extensible, especially when compared to Windows or macOS. The level of control you have over the operating system and the applications that run on top of it is very granular, enabling you to have far better control over the security of your endpoints and your network.</p>
<p>Several Linux operating systems (or <i>distributions</i>) are available. Each distribution uses a different set of basic utilities and graphical user interfaces (GUIs), and each one looks and functions in a slightly different way. For example, Kali Linux is a distribution geared toward offensive operations and is commonly used by penetration testers to perform network assessments. Red Hat Linux is probably the most used enterprise distribution, and several other distributions are based on Red Hat, such as Fedora and CentOS. If you’re interested in Linux, try various distributions to find the one you like the most.</p>
<p>In this book, we’ll primarily use Ubuntu, which is one of the most user-friendly and among the easiest to use for beginners or those new to Linux in general. Ubuntu is available in three editions: Desktop, Server, and Core. For our purposes, the Desktop edition is sufficient. If you plan to use your Ubuntu servers for additional network services, such as a file or Dynamic Host Control Protocol (DHCP) server, the Server edition would be appropriate. Ubuntu Core is specifically for resource-limited applications, like internet of things (IoT) implementations.</p>
<p>The most recent versions of the Ubuntu operating system are available from <a class="url-i" href="https://ubuntu.com/download/">https://ubuntu.com/download/</a>. These downloads will be in ISO file format, meaning the file extension will be <i>.iso</i>. ISO files are logical images or containers that can be used to emulate physical media such as CDs or DVDs.</p>
<p>The following sections walk through installing Ubuntu, either as a physical device or as a virtual machine on either macOS or Windows, as well as in the cloud. Using a physical device allows you to take advantage of all of a system’s resources, such as CPU and RAM, but it requires that you have a physical system available onto which you can install Ubuntu. Using virtual machines provides several useful features, like the ability to take snapshots (this will be discussed later in this chapter). Creating a virtual machine in the cloud provides additional capabilities, like easy access to your system from any location, but often comes with additional security considerations. Once you’re finished with the platform-specific instructions for your setup, jump to “<a class="xref" href="nsp-enoka501485-0010.xhtml#ah0302">Finalizing the Linux Installation</a>” on <a class="xref" href="nsp-enoka501485-0010.xhtml#p8">page 8</a>.</p>
<p class="hd" id="hd0301"><a class="xref" href="nsp-enoka501485-0007.xhtml#rhd0301"><span class="ccust2">#1: Creating an Ubuntu Virtual Machine</span></a></p>
<p class="paft">Throughout this book, you’ll create Ubuntu systems for various purposes. Each of them will be based on the system we’ll create now, which will act as a standard base operating system, on top of which you can add tools and applications necessary for securing your network.</p>
<section>
<h3 class="bh" id="bh0301"><span aria-label="3" class="page" epub:type="pagebreak" id="p3" role="doc-pagebreak"/><a class="xref" href="nsp-enoka501485-0007.xhtml#rbh0301">Hypervisor Options</a></h3>
<p class="paft">A <i>hypervisor</i> is software that allows you to create and run virtual machines using a guest operating system. For this initial project, you can create an Ubuntu VM using an inexpensive commercial hypervisor from VMware. Multiple editions of VMware Workstation are available from <a class="url-i" href="https://www.vmware.com/">https://www.vmware.com/</a>. VMware Player (for Windows) and VMware Fusion Player (for Mac) are free for personal use, but they don’t have some of the more advanced features we’ll want to take advantage of in later chapters. I recommend using VMware Workstation Pro and VMware Fusion Pro. The commercial license for either of these is relatively inexpensive. An alternative solution is to use the free Workstation Player to begin with and then upgrade to the commercial license if you need to. The step-by-step instructions for Workstation and Player editions are mostly the same, with some slight differences between Workstation and Fusion.</p>
<p>Another option is to use VirtualBox, a free solution for creating and managing VMs maintained by Oracle. VirtualBox is available for all major operating systems, and you can download it from <a class="url-i" href="https://www.virtualbox.org/wiki/Downloads/">https://www.virtualbox.org/wiki/Downloads/</a>.</p>
</section>
<section>
<h3 class="bh" id="bh0302"><a class="xref" href="nsp-enoka501485-0007.xhtml#rbh0302">VMware Workstation and VMware Player for Windows</a></h3>
<p class="paft">To create your VM in VMware Workstation or VMware Player, follow these steps:</p>
<ol style="list-style-type:none">
<li class="nlf">1. Click <b>File▸New Virtual Machine</b> in VMware.</li>
<li class="nl">2. On the New Virtual Machine screen that opens, choose <b>Typical (recommended)</b> and click <b>Next</b>.</li>
<li class="nl">3. Select <b>Installer Disc Image File (iso)</b>.</li>
<li class="nl">4. Using the <b>Browse</b> button, navigate to and select the Ubuntu ISO you downloaded earlier; then click <b>Next</b>.</li>
<li class="nl">5. The Easy Install wizard will ask for the user details for your VM; fill out the Full Name, User Name, and Password fields, and click <b>Next</b>.</li>
<li class="nl">6. Give your VM a meaningful name indicating its role on your network when asked.</li>
<li class="nl">7. Save the VM to the default location (or anywhere you desire) and click <b>Next</b>.</li>
<li class="nl">8. Set the virtual disk size to 40GB if your host machine has enough disk space; otherwise, accept the default 20GB.</li>
<li class="nl">9. Store the virtual disk as a single file, rather than split into multiple files and click <b>Next</b>.</li>
<li class="nl">10. Click <b>Customize Hardware</b>.</li>
<li class="nl">11. If your host has enough RAM, increase the RAM of the VM from 2GB to 4GB.</li>
<li class="nl">12. Set Processors to 1.</li>
<li class="nl"><span aria-label="4" class="page" epub:type="pagebreak" id="p4" role="doc-pagebreak"/>13. Under Network Adapter, select <b>Bridged</b> mode to give your VM its own independent IP address and network connection.</li>
<li class="nl">14. Click <b>Sound Card▸Remove</b>.</li>
<li class="nl">15. Click <b>Printer▸Remove</b>.</li>
<li class="nll">16. Click <b>Finish</b>.</li>
</ol>
<p>Your virtual machine will be created, and the operating system will begin installing.</p>
</section>
<section>
<h3 class="bh" id="bh0303"><a class="xref" href="nsp-enoka501485-0007.xhtml#rbh0303">VMware Fusion and VMware Fusion Player for macOS</a></h3>
<p class="paft">Once you’ve installed VMware Fusion or VMware Fusion Player, follow these steps to create your first VM:</p>
<ol style="list-style-type:none">
<li class="nlf">1. Click <b>File▸New▸Continue</b> in VMware.</li>
<li class="nl">2. Drag and drop your ISO file onto the VMware Fusion window, or click the <b>Use Another Disc or Disc Image</b> button to locate the file in your filesystem; then click <b>Continue</b>.</li>
<li class="nl">3. The Easy Install wizard will ask you for the user details for your VM; fill out the Display Name, Account Name, and Password fields.</li>
<li class="nl">4. Ensure the Make your home folder accessible to the virtual machine checkbox is not ticked and click <b>Continue</b>.</li>
<li class="nl">5. Click <b>Customize Settings</b>.</li>
<li class="nl">6. Save the VM to the default location (or anywhere you desire).</li>
<li class="nl">7. Set the virtual disk size to 40GB if your host machine has enough disk space; otherwise, accept the default 20GB.</li>
<li class="nl">8. In the <b>Processors and Memory</b> menu, if your host has enough RAM, increase the RAM of the VM from 2GB to 4GB, and set Processors to 1.</li>
<li class="nll">9. Untick the <b>Connect</b> checkbox to either add or disconnect the following peripherals within their context menus: sound card, floppy, printer, and camera. (Disconnecting unused or superfluous peripherals from your virtual machines removes potential attack vectors.)</li>
</ol>
<p>Click the <b>Play</b> button to start your VM, and the operating system installation will begin.</p>
</section>
<section>
<h3 class="bh" id="bh0304"><a class="xref" href="nsp-enoka501485-0007.xhtml#rbh0304">VirtualBox</a></h3>
<p class="paft">The steps for creating a VM in VirtualBox are the same whether you’re using a Windows PC or Mac as the host system. Once you’ve downloaded and installed VirtualBox, follow these steps to create a VM:</p>
<ol style="list-style-type:none">
<li class="nlf">1. Click the <b>New</b> button at the top of the VirtualBox window.</li>
<li class="nl">2. Provide a relevant name for your VM, specify the location to save the files (the default folder is usually fine), and select the correct operating system from the drop-down menus: <b>Linux▸Ubuntu (64-bit)</b>; then click <b>Continue</b>.</li>
<li class="nl"><span aria-label="5" class="page" epub:type="pagebreak" id="p5" role="doc-pagebreak"/>3. If your host has enough RAM, increase the RAM of the VM from 2GB to 4GB, and click <b>Continue</b>.</li>
<li class="nl">4. Select <b>Create a New Virtual Hard Disk Now</b> and then click <b>Create</b>.</li>
<li class="nl">5. Select <b>VMDK</b> as the hard disk format and click <b>Continue</b>.</li>
<li class="nl">6. Select <b>Dynamically Allocated</b> and click <b>Continue</b> or <b>Next</b> (depending on your OS).</li>
<li class="nl">7. Set the virtual disk size to 40GB if your host machine has enough disk space; otherwise, accept the default 32GB and click <b>Create</b>.</li>
<li class="nl">8. Select the VM in VirtualBox and click <b>Settings</b>.</li>
<li class="nl">9. Go to <b>Settings▸System▸Motherboard</b>.</li>
<li class="nl">10. Under Boot Order, untick the <b>Floppy</b> checkbox.</li>
<li class="nl">11. Go to <b>Settings▸System▸Storage</b>.</li>
<li class="nl">12. Select the CD drive (it’ll be listed as <b>Controller: IDE</b> and have a CD icon next to it).</li>
<li class="nl">13. In the attributes pane, click the <b>CD icon</b> to choose a disk file, and point it at your Ubuntu ISO file.</li>
<li class="nl">14. Under <b>Settings▸Audio</b>, untick the <b>Enable Audio</b> checkbox.</li>
<li class="nl">15. Under <b>Settings▸Network▸Adapter 1</b>, switch the <b>Attached to</b> drop-down to <b>Bridged Adapter</b> so your VM will be assigned its own IP address and be logically separate from the host system’s network settings.</li>
<li class="nl">16. Click <b>OK</b>.</li>
</ol>
<p class="pcust1"><span class="ccust1">Note</span> The options for hard disk format are VDI, VHD, or VMDK. VDI is VirtualBox’s proprietary format. VHD was developed by Microsoft, is compatible with Windows, and can be easily mounted under the Windows operating system as a virtual disk. VMware originally developed VMDK, but it’s now an open file format. VMDK is compatible with both VirtualBox and VMware, so if you choose to switch from one to the other, your virtual hard disks shouldn’t cause any challenges.</p>
<p class="hd" id="hd0302"><a class="xref" href="nsp-enoka501485-0007.xhtml#rhd0302"><span class="ccust2">#2: Creating a Physical Linux System</span></a></p>
<p class="paft">Instead of creating a virtual machine, you might want to use a physical computer and install Ubuntu the same way you’d install Windows or macOS directly onto the hardware. Using a physical system has benefits like increased performance or reduced resource requirements in terms of memory and processing power. The main drawback is that physical systems usually aren’t as flexible as virtual machines. As you progress through this book, you’ll be asked to create multiple Linux systems, so we’ll assume that you’ll use mostly virtual machines. However, should you choose to use physical systems for each of these projects, you should still be able to follow along.</p>
<p><span aria-label="6" class="page" epub:type="pagebreak" id="p6" role="doc-pagebreak"/>To create a physical Ubuntu system, you need a <i>bootable USB drive</i>, which means you’ll install Ubuntu on a USB that you can plug into any computer and install it from there.</p>
</section>
<section>
<h3 class="bh" id="bh0305"><a class="xref" href="nsp-enoka501485-0007.xhtml#rbh0305">Bootable USB on Windows</a></h3>
<p class="paft">On a Windows computer, the simplest way to create a bootable Ubuntu USB is with Rufus, a small utility specifically for creating bootable media. Download the latest version from <a class="url-i" href="https://rufus.ie/">https://rufus.ie/</a>. Rufus is a <i>portable executable</i>, which means you don’t need to install it; just download and run it. Once downloaded, follow these steps:</p>
<ol style="list-style-type:none">
<li class="nlf">1. Plug in a USB thumb drive at least 16GB in size. Rufus will format this USB drive, so make sure it doesn’t contain anything you want to keep.</li>
<li class="nl">2. Run the Rufus executable.</li>
<li class="nl">3. Once Rufus is open, ensure the Device drop-down menu indicates that the correct USB drive is selected. It’s often easiest to plug in only your target USB device and unplug any others.</li>
<li class="nl">4. Under Boot Selection, choose <b>Disk or ISO Image</b>.</li>
<li class="nl">5. Click <b>Select</b>.</li>
<li class="nl">6. Navigate to your Ubuntu ISO file and select it.</li>
<li class="nl">7. Once selected, Rufus will load a set of default settings for the bootable USB; accept them and click <b>Start</b>.</li>
<li class="nl">8. Rufus might display a pop-up asking whether you want to write the media in ISO or DD image mode; choose <b>ISO Mode</b> and click <b>OK</b>. When installing Ubuntu later, if you aren’t able to proceed with the installation or it seems to hang, repeat this process and select <b>DD Mode</b> instead.</li>
<li class="nl">9. Rufus will display a pop-up to inform you that it will format the USB drive; click <b>OK</b> to proceed.</li>
</ol>
</section>
<section>
<h3 class="bh" id="bh0306"><a class="xref" href="nsp-enoka501485-0007.xhtml#rbh0306">Bootable USB on macOS</a></h3>
<p class="paft"><i>Etcher</i> is an open source utility for macOS used for writing operating system images to removable media such as USB drives and SD cards. Download the latest version from <a class="url-i" href="https://www.balena.io/etcher/">https://www.balena.io/etcher/</a>. Once it’s downloaded and installed, follow these steps:</p>
<ol style="list-style-type:none">
<li class="nlf">1. Plug in a USB thumb drive at least 16GB in size. Etcher will format your USB drive, so make sure it doesn’t contain anything you want to keep.</li>
<li class="nl">2. Run Etcher.</li>
<li class="nl">3. Once Etcher is open, click <b>Flash from File</b>, and select your Ubuntu ISO file.</li>
<li class="nl">4. Click <b>Select Target</b> and select your USB drive.</li>
<li class="nl">5. Click <b>Flash</b> to create your bootable Ubuntu USB (you might be asked to enter your computer password to allow Etcher to make changes to the USB).</li>
<li class="nl"><span aria-label="7" class="page" epub:type="pagebreak" id="p7" role="doc-pagebreak"/>6. The flashing process will begin, and a progress bar will appear. Once the process completes, you may be informed that “The disk you inserted was not readable by this computer.” If so, just eject the USB; don’t choose Initialize.</li>
</ol>
</section>
<section>
<h3 class="bh" id="bh0307"><a class="xref" href="nsp-enoka501485-0007.xhtml#rbh0307">Using the Bootable USB</a></h3>
<p class="paft">When the process completes, you’ll have a bootable Ubuntu Linux USB drive. Plug it into the computer on which you want to install Ubuntu and boot or reboot it. You might have to change the system’s boot order so it boots from the USB instead of the internal hard drive. To do that, you need to interrupt the boot sequence, which is typically done by pressing ESC, F8, F10, or F12. Do an internet search to find the correct interrupt key for your computer, or reboot the system and press each of those keys until you successfully enter the computer’s basic input/output system (BIOS).</p>
<p class="pcust1"><span class="ccust1">Note</span> Technically, most modern computers use the Unified Extensible Firmware Interface (UEFI), which has improved features over the outdated BIOS. We’ll use the terms BIOS and UEFI interchangeably.</p>
<p>From the BIOS, which is responsible for hardware management outside your operating system, change the boot order so that the computer boots from the USB first. Then restart the computer, and it will boot into the Ubuntu installation environment. On a Mac, just hold the OPTION key while the system boots and then choose to boot from USB.</p>
<p class="hd" id="hd0303"><a class="xref" href="nsp-enoka501485-0007.xhtml#rhd0303"><span class="ccust2">#3: Creating a Cloud-Based Linux System</span></a></p>
<p class="paft">It’s common to move network infrastructure to the cloud, which just means running our services on someone else’s computer(s). Websites and the web servers that run them are often easier to access (from anywhere in the world) and manage in the cloud than they would be on our private networks and VPN servers. (We’ll cover VPNs in greater detail in <a class="xref" href="nsp-enoka501485-0014.xhtml#ch05">Chapter 5</a>.) In this section, we’ll explain how to create your Linux computer using a cloud service provider. We’ll use Vultr for this project as it’s relatively inexpensive, it’s reliable, and it presents an easy learning curve if you haven’t used a cloud provider before. The steps should be similar regardless of provider, whether you’re using Amazon Web Services, Microsoft Azure, or something else.</p>
<ol style="list-style-type:none">
<li class="nlf">1. Create an account at <a class="url-i" href="https://www.vultr.com/">https://www.vultr.com/</a>.</li>
<li class="nl">2. On the account dashboard, click <b>+▸Deploy New Server</b>.</li>
<li class="nl">3. Choose <b>Cloud Compute</b>. The other options (High Frequency, Bare Metal, and so on) are for specialist applications, not suitable for our purposes.</li>
<li class="nl"><span aria-label="8" class="page" epub:type="pagebreak" id="p8" role="doc-pagebreak"/>4. Choose a location for your server. Choosing a location geographically close to you can improve access speeds to your VM; however, if you want to obfuscate your location, choose a location in a different country.</li>
<li class="nl">5. For Server Type, choose the latest available version of Ubuntu.</li>
<li class="nl">6. Choose a server size. The cheapest option is a good place to start; you can always upgrade your VM later if necessary.</li>
<li class="nl">7. Supply a hostname for your server.</li>
<li class="nll">8. Click <b>Deploy</b>.</li>
</ol>
<p>The service provider will now instantiate your Ubuntu VM, which is the same as creating a VM in VMware or VirtualBox. This process can take some time. Once your VM is confirmed to be up and running, your service provider will supply the IP address, username, and password to access your VM. You’ll then be able to complete the steps in the following sections to set up and secure your VM.</p>
</section>
</section>
<section>
<h2 class="ah" id="ah0302"><a class="xref" href="nsp-enoka501485-0007.xhtml#rah0302">Finalizing the Linux Installation</a></h2>
<p class="paft">If you created your Linux system in the cloud or using VMware and Easy Install, booting the VM will automatically install Ubuntu, create your user account, and present you with the Ubuntu desktop environment, which will be similar to a Windows or Mac desktop. If you used VirtualBox or are creating a physical Linux system, you’ll need to complete some additional steps to get to that stage.</p>
<p>In VirtualBox, follow these steps:</p>
<ol style="list-style-type:none">
<li class="nlf">1. Click the <b>Start</b> button to boot the VM.</li>
<li class="nl">2. Using the Ubuntu installation wizard, select your desired language and click <b>Install Ubuntu</b>.</li>
<li class="nl">3. Select your keyboard layout and click <b>Continue</b>.</li>
<li class="nl">4. On the Updates and Software screen, select <b>Minimal Installation</b> as you won’t need a lot of the additional software that would otherwise be installed with the operating system.</li>
<li class="nl">5. Tick both checkboxes to allow software updates to be installed from various sources.</li>
<li class="nl">6. Click <b>Continue</b>.</li>
<li class="nll">7. On the next screen, the wizard will ask if you want to erase the disk and install Ubuntu, with a warning, as shown in <a class="xref" href="nsp-enoka501485-0010.xhtml#fig0101">Figure 1-1</a>. Click the <b>Advanced Features</b> button and select <b>Use LVM with the New Ubuntu Installation</b>. Using LVM provides greater flexibility and control over your disks and their partitioning. LVM allows for advanced features such as naming logical volumes and dynamically resizing partitions and virtual hard disks when required.</li>
</ol>
<figure class="figure" id="fig0101">
<p class="fig"><span aria-label="9" class="page" epub:type="pagebreak" id="p9" role="doc-pagebreak"/><img alt="Ubuntu’s wizard displays the following warning when asking if you’d like to erase the disk and install Ubuntu: “Warning: This will delete all your programs, documents, photos, music, and any other files in all operating systems.” The clickable Advanced features button appears underneath this warning." height="170" src="images/nsp-enoka501485-fig0101.jpg" style="width:95%; height:auto;" width="1200"/></p>
<figcaption>
<p class="figh"><span class="fighn">Figure 1-1</span>: Ubuntu installation type prompt</p>
</figcaption>
</figure>
<p>Keep in mind that this installation wizard is referring only to the virtual machine and the virtual hard disk that is attached to it (which we created earlier). It does not affect the physical hard drive of your host system. There is no risk of losing your files or data by proceeding with the installation inside the VM.</p>
<ol style="list-style-type:none">
<li class="nlf">8. Click <b>OK▸Install Now</b>.</li>
<li class="nll">9. You’ll be asked to write the changes to disk (meaning the virtual hard disk of the VM). Click <b>Continue</b> to accept the configuration you just set for this VM.</li>
</ol>
<p>As Ubuntu installs, you’ll be asked for certain settings for the operating system, such as your location (for time zone settings), your name, your computer or hostname, and your user details such as username and password. Set those as appropriate and continue the installation. Eventually, the operating system installation will complete, and you’ll be presented with the Ubuntu desktop environment.</p>
<p class="pcust1"><span class="ccust1">Warning</span> Do not set or allow the user to log in automatically, as that configuration isn’t secure for any computer. Always use the <b>Require my Password to Log in</b> setting.</p>
<p>The first time you log in, Ubuntu will ask you to configure online accounts and whether you want to share anonymous statistics with the developer. This system needs to be a secure system and therefore shouldn’t be connected to services such as Google or Microsoft cloud services. Skip all of those configuration options and disallow sharing of data wherever possible. This advice is good for life (if you’re concerned about privacy), not just the configuration of Ubuntu virtual machines.</p>
<p>You’ll follow the same steps to complete Ubuntu installation on a physical system, the only difference being the disk partitioning will affect the physical hard drive within the computer, and not a virtual hard drive. Once you’ve installed Ubuntu, reset the boot order in the BIOS as you did before so the computer boots from the internal hard drive instead of USB, and also remove the bootable USB from the computer.</p>
</section>
<section>
<h2 class="ah" id="ah0303"><a class="xref" href="nsp-enoka501485-0007.xhtml#rah0303">Hardening Your Ubuntu System</a></h2>
<p class="paft">Now that you’ve created a base virtual or physical machine, you’ll make some initial configuration changes to ensure your system is secure. This process is called <i>hardening</i>, which broadly means keeping the system <span aria-label="10" class="page" epub:type="pagebreak" id="p10" role="doc-pagebreak"/>up-to-date with the latest operating system and software patches, installing some additional management software, and altering configuration files to make the system more secure.</p>
<p class="hd" id="hd0304"><a class="xref" href="nsp-enoka501485-0007.xhtml#rhd0304"><span class="ccust2">#4: Installing System Packages</span></a></p>
<p class="paft">In Ubuntu, you’ll use the Advanced Package Tool (APT) to ensure the system is up-to-date with all of the latest patches. In Linux, people use the term <i>packages</i> to refer to software, and APT is a package management utility used to install, uninstall, update, or otherwise manage the tools and software on your system.</p>
<p>APT is a command line interface (CLI) utility, which means you’ll use the Linux Terminal to interact with it, rather than a GUI tool like Windows Update.</p>
<p class="pcust1"><span class="ccust1">Note</span> Most operating systems have a CLI; Windows has Command Prompt and PowerShell, and macOS has its own Terminal. Essentially, a CLI is a more direct way to interact with the operating system using text commands. A CLI will look like a simple text editor with a prompt for your input. Command Prompt, Linux Terminal, and macOS Terminal are all black with white text by default. PowerShell is blue.</p>
<p>In a cloud deployment, you might have access only to the Linux Terminal by default, with no access to a GUI. If that’s the case, you’ll be presented with a terminal window immediately upon logging in. Otherwise, to access the terminal in Ubuntu, click the <b>Activities</b> menu at the top-left side of the screen in Ubuntu, type <b>Terminal</b>, and click it when it appears, the same way you’d search for and open an application in the Windows Start menu.</p>
<p>By default, even as an administrator, you can’t run certain commands or perform some actions on a Linux system because you don’t have the necessary permissions (called <i>privileges</i> in Linux). A lot of commands and actions are reserved for <i>superusers</i>, or the <i>root</i> user account in Linux. As a non-root (that is, a nonsuperuser) user in Linux, you need the <code>sudo</code> command, which stands for <i>superuser do</i>. For example, to use APT to update all the installed packages in your Ubuntu system, use the following commands, pressing ENTER after each command to execute them:</p>
<pre>
<p class="clf">$ <code class="b">sudo apt update</code></p>
<p class="cll">$ <code class="b">sudo apt upgrade</code></p>
</pre>
<p>The first command, <code>sudo apt update</code>, retrieves the list of available updates for each application currently installed. The second command, <code>sudo apt upgrade</code>, downloads and installs those updates. When prompted, enter your password; making you authenticate to run privileged commands is a <code>sudo</code> security feature. Every time you run a command with <code>sudo</code>, the action is logged in the <i>/var/log/auth.log</i> file, so all administrative actions can be audited after the fact. When asked to continue installing packages, enter <code class="b">Y</code> (for yes) and press ENTER.</p>
<p class="pcust1"><span aria-label="11" class="page" epub:type="pagebreak" id="p11" role="doc-pagebreak"/><span class="ccust1">Warning</span> On the command line in Linux and macOS, when your prompt displays a dollar sign (<code>$</code>), this means you’re currently in the context of (that is, operating as) a normal, non-administrative user. If your prompt displays a hash mark (<code>#</code>), you’re in the context of the root user and have full system access to make changes, move files, and delete files. Be careful if you’re operating in the context of root, as it’s easy to make mistakes and cause problems with your operating system. It’s always best to work primarily in the context of a normal user and use <code>sudo</code> when using the command line.</p>
<p>When you install new packages, APT often also installs any dependencies required for those packages (otherwise, your software would look for things it depends on, not find them, and fail to run successfully). However, when you remove or uninstall software, those dependencies might be left behind. Having unnecessary applications on your systems is insecure, as an attacker might exploit a vulnerability in those leftover packages to gain access to your network or use them to perform other nefarious activities. Run <code>sudo apt autoremove</code> and <code>sudo apt clean</code> as shown here to remove any no longer needed dependencies and delete previously downloaded packages, respectively:</p>
<pre>
<p class="clf">$ <code class="b">sudo apt autoremove</code></p>
<p class="cll">$ <code class="b">sudo apt clean</code></p>
</pre>
<p>To install new packages, use <code>sudo apt install</code>. A useful package that allows you to access and administer your system remotely via the command line is SSH (for <i>secure shell</i>). Run <code>sudo apt install openssh-server</code> to install SSH (to install a different package, you would substitute <code>openssh-server</code> for the package name).</p>
<p>You can install multiple packages with <code>apt</code> at the same time like this:</p>
<pre>
<p class="cls">$ <code class="b">sudo apt install openssh-server</code> <code class="bi">package_name1 package_name2</code></p>
</pre>
<p>Again, type your password and enter <code class="b">Y</code> if prompted. With SSH installed, you’ll be able to configure remote access to your system.</p>
<p class="hd" id="hd0305"><a class="xref" href="nsp-enoka501485-0007.xhtml#rhd0305"><span class="ccust2">#5: Managing Linux Users</span></a></p>
<p class="paft">Part of managing your network security is managing the user accounts and hosts within your network. You may need to add new users to your Ubuntu machines, such as a new user account for a new service or application, or to allow others to administer your systems. Adding new users is an administrative function and requires the <code>sudo</code> command. Use the <code>adduser</code> command to add new users:</p>
<pre>
<p class="cls">$ <code class="b">sudo adduser</code> <code class="bi">username</code></p>
</pre>
<p>You’ll be asked to specify a password for the user, but using passphrases is better, because they’re easier to remember, tend to be longer, and are harder to crack. (We’ll discuss passphrases and creating strong passwords in more detail in <a class="xref" href="nsp-enoka501485-0020.xhtml#ch11">Chapter 11</a>.)</p>
<p><span aria-label="12" class="page" epub:type="pagebreak" id="p12" role="doc-pagebreak"/>You also can set names, phone numbers, and other information for your users if you want; otherwise, press ENTER to leave these fields blank.</p>
<p>Deleting a user is just as easy:</p>
<pre>
<p class="cls">$ <code class="b">sudo deluser</code> <code class="bi">username</code></p>
</pre>
<p>In addition, you may want to give your new user <code>sudo</code> privileges to allow them to administer your system, which you can do with the <code>usermod</code> command:</p>
<pre>
<p class="cls">$ <code class="b">sudo usermod -aG sudo</code> <code class="bi">username</code></p>
</pre>
<p>The <code>-aG</code> (add group) parameter will add the user to the <i>sudo</i> group. User groups in Linux are a collection of user accounts, and they’re used to assign privileges and permissions to specific user accounts, such as the ability to read and write certain files. Keep in mind, however, that the fewer users with sudo privileges the better. Always practice the principle of least privilege and allow users only as much control as they require on a day-to-day basis. Providing administrator credentials and privileges to more people than necessary will lead to a far less secure network configuration.</p>
<p>Finally, you can reset the password for a given user with the <code>passwd</code> command:</p>
<pre>
<p class="cls">$ <code class="b">sudo passwd</code> <code class="bi">username</code></p>
</pre>
<p>Managing the users in your network is an important part of keeping your network secure. Having superfluous user accounts, especially if they have more privileges than they require, provides an easy way for adversaries to compromise and gain a foothold inside your network. This is easily preventable, so always be aware of the risks of additional or unnecessary user accounts.</p>
<p>Besides managing the users in your environment, each of your endpoints has a hostname, which is a friendly name or human-readable name used to identify the host. Often, these are configured as some default value by the operating system when it’s installed (like <code>ubuntu</code> for Ubuntu systems). It can be beneficial to choose a naming scheme for your hosts and to ensure each host has a different name. In Windows networks, for example, multiple hosts cannot have the same hostname, because this results in conflicts that create administrative problems within the network.</p>
<p>You can check the hostname of your Linux system with the <code>hostname</code> command:</p>
<pre>
<p class="clf">$ <code class="b">hostname</code></p>
<p class="cll">ubuntu</p>
</pre>
<p>To change the hostname, use the <code>hostname</code> command again, but this time use <code>sudo</code> and specify the desired hostname:</p>
<pre>
<p class="cls">$ <code class="b">sudo hostname</code> <code class="bi">your_hostname</code></p>
</pre>
<p><span aria-label="13" class="page" epub:type="pagebreak" id="p13" role="doc-pagebreak"/>Run the <code>hostname</code> command again to confirm the change has occurred. Reboot your server to make the change permanent.</p>
<p class="hd" id="hd0306"><a class="xref" href="nsp-enoka501485-0007.xhtml#rhd0306"><span class="ccust2">#6: Securing Remote Access</span></a></p>
<p class="paft">Now that you’ve made it possible to access the system remotely with SSH, you need to lock down that capability so only authorized users can log in to this host. Several settings are involved in this process. You’ll disable password login in favor of SSH keys, as well as disallow the root account from logging in directly via SSH. Allowing superusers such as root to log in interactively using utilities like SSH is bad practice because it allows attackers to perform attacks such as brute-forcing (continually guessing potential passwords until they find the one that works) and then be able to log in with complete access to your system. Likewise, with your other user accounts, using SSH keys to log in instead of passwords eliminates an entire class of potential attacks (username and password guessing) against your systems.</p>
<section>
<h3 class="bh" id="bh0308"><a class="xref" href="nsp-enoka501485-0007.xhtml#rbh0308">Generating SSH Keys</a></h3>
<p class="paft"><i>SSH key pairs</i> are generally accepted to be more secure than passwords or passphrases. SSH keys are cryptographically secure keys that can be used to authenticate a client computer (your local host) to an SSH server (your Ubuntu system). The first part of a key pair is your private key, which is held by and identifies your client, and must remain absolutely secret, just like a password. The other half is the public key, which can be freely shared. The public key is provided to your SSH server and is capable of decrypting your private key, thereby allowing authentication between the two endpoints. Each local user account that you want to use to log in to your Ubuntu system will need its own set of public and private keys.</p>
<p>To create an SSH key pair, open a terminal window on the computer you plan to use as your SSH client (the computer that will connect to your Ubuntu system via SSH). Enter <code>ssh-keygen</code> and press <span class="ac">enter</span>. Press <span class="ac">enter</span> again to accept the default file in which to save the keys. The default location of this file will be:</p>
<ul style="list-style-type:none">
<li class="blf">• Windows: <i>C:\Users\&lt;user&gt;\.ssh\id_rsa</i></li>
<li class="bl">• macOS: <i>/Users/&lt;user&gt;/.ssh/id_rsa</i></li>
<li class="bll">• Linux: <i>/home/&lt;user&gt;/.ssh/id_rsa</i></li>
</ul>
<p>Next, you’ll be asked for a passphrase for your private key, which is optional but recommended. By using a passphrase in addition to your SSH keys, your private key is never exposed on the network, meaning that to get access to your private key, attackers need access to your computer (if they have that, it’s probably already game over). Once you’ve entered your passphrase (or not), press ENTER, and your key pair will be created.</p>
<p>To provide the public key file to your Ubuntu system (or any other server you want to use your key pair to connect with), enter the following command:</p>
<pre>
<p class="clf"><span aria-label="14" class="page" epub:type="pagebreak" id="p14" role="doc-pagebreak"/>$ <code class="b">ssh-copy-id</code> <code class="bi">user@your_ubuntu_ip</code></p>
<p class="cl">The authenticity of host '192.168.1.10' can't be established.</p>
<p class="cl">ECDSA key fingerprint is aa:aa:aa:aa:aa:aa:aa:aa:aa:aa:aa:aa:aa:aa:aa:aa.</p>
<p class="cll">Are you sure you want to continue connecting (yes/no)? <code class="b">yes</code></p>
</pre>
<p>The prompt about an ECDSA key fingerprint might be shown, which just means that the remote computer wasn’t able to identify your local computer (because it hasn’t connected to it in this way before). If you receive this prompt, type <code class="b">yes</code> and press ENTER. Your Ubuntu system will ask you for the password of the user account you’re trying to use to connect (that is, the password for the remote user account). Enter the password, and the process is complete. At this point, you can use <code class="b">ssh</code> <code class="bi">user@your_ubuntu_ip</code> to log in to your Ubuntu system, and you’ll be prompted for the SSH key passphrase (not the passphrase for the user on the Ubuntu system) if you set one.</p>
<section>
<h4 class="ch" id="ch0301">Disallowing Password Authentication</h4>
<p class="paft">Next, change the SSH configuration on your Ubuntu system to disallow password authentication, forcing the use of your SSH keys to log in. Log in to your Ubuntu system as a standard, non-root user, and open the SSH configuration file in the terminal using Nano, the text editor installed by default on many Linux distributions, with the following command:</p>
<pre>
<p class="cls">$ <code class="b">sudo nano /etc/ssh/sshd_config</code></p>
</pre>
<p>Find the line with the setting: <code># PasswordAuthentication yes</code>. To search for text in Nano, press CTRL-W and then type your search term and press ENTER. The setting is currently commented out (the <code>#</code> at the start of the line tells SSH to ignore that line) because <code>yes</code> is the default configuration and doesn’t need to be set explicitly. Remove the <code>#</code> from the beginning of the line, and change <code>yes</code> to <code class="b">no</code>. For every system you create (and on which you enable SSH), you must change this setting.</p>
</section>
<section>
<h4 class="ch" id="ch0302">Disabling Root Login</h4>
<p class="paft">It’s also prudent to disable the ability for the root user to log in remotely. As mentioned earlier, on Linux, the root user has the highest level of permissions or privileges on the system. By disabling its ability to log in, you remove the capability of any would-be attackers to gain privileged access to the system. Technically, the root account on the most recent versions of Ubuntu can’t log in because it’s locked by default, but it’s always good to ensure it’s unable to log in anyway. Find the line:</p>
<pre>
<p class="cls">PermitRootLogin prohibit-password</p>
</pre>
<p class="pcon">and change <code>prohibit-password</code> to <code class="b">no</code>. With that done, save the changes you’ve made to the file. Press <span class="ac">ctrl</span>-O and then press <span class="ac">enter</span> to overwrite the file you’re editing. Press <span class="ac">ctrl</span>-X to exit the file and return to the terminal.</p>
<p><span aria-label="15" class="page" epub:type="pagebreak" id="p15" role="doc-pagebreak"/>Restart the SSH service so that it’s reloaded with the new configuration, using the following command:</p>
<pre>
<p class="cls">$ <code class="b">sudo systemctl restart ssh</code></p>
</pre>
<p>There’s one more thing left to test. Earlier, you disabled the ability to log in via SSH using password authentication by modifying the configuration file in <i>/etc/ssh/sshd_config</i>. From any computer in your network, try to SSH into your Ubuntu system using an account on that computer, with the password you configured (not the user account you provided with your SSH key):</p>
<pre>
<p class="clf">$ <code class="b">ssh</code> <code class="bi">user@your_ubuntu_ip</code></p>
<p class="cll">user@your_ubuntu_ip: Permission denied (publickey).</p>
</pre>
<p>Here, <code class="bi">user</code> is the username you use to log in to the system, and <code class="bi">your_ubuntu_ip</code> is the IP address of your Linux system. If you’re able to log in successfully, go back to the “<a class="xref" href="nsp-enoka501485-0010.xhtml#ch0301">Disallowing Password Authentication</a>” section and make sure your configuration is correct, or reboot Ubuntu. Leaving access open would create a vulnerability in your network, which is easy to fix but potentially a big problem if left unchecked.</p>
</section>
</section>
<section>
<h3 class="bh" id="bh0309"><a class="xref" href="nsp-enoka501485-0007.xhtml#rbh0309">Remote Login with SSH</a></h3>
<p class="paft">Both macOS and Windows have SSH built in. Using the computer for which you generated an SSH key and copied to your Ubuntu system, connect to your new Linux system by entering the following command:</p>
<pre>
<p class="clf">$ <code class="b">ssh</code> <code class="bi">user@your_ubuntu_ip</code></p>
<p class="cl">Enter passphrase for key '/Users/user/.ssh/id_rsa':</p>
<p class="cl2"><!--<ccust1>1</ccust1>-->❶ Welcome to Ubuntu (GNU/Linux 5.8.0-44-generic x86_6)</p>
<p class="cl2"><!--<ccust1>2</ccust1>-->❷ * Documentation:   https://help.ubuntu.com</p>
<p class="cl">* Management:      https://landscape.canonical.com</p>
<p class="cl">* Support:         https://ubuntu.com/advantage</p>
<p class="cl2f"><!--<ccust1>3</ccust1>-->❸ 6 updates can be installed immediately.</p>
<p class="cl">5 of these updates are security updates.</p>
<p class="cl">To see these additional updates run: apt list --upgradable</p>
<p class="clf">Your Hardware Enablement Stack (HWE) is supported until <!--<ccust1>4</ccust1>-->❹ April 2025.</p>
<p class="cl2l"><!--<ccust1>5</ccust1>-->❺ Last login: Mon Mar  8 17:02:46 from 192.168.1.12</p>
</pre>
<p>When you log in via SSH to Ubuntu, the operating system outputs a lot of useful information. The first line indicates which version of the operating system is currently installed <!--<ccust1>1</ccust1>-->❶. There are links to documentation and how to get help <!--<ccust1>2</ccust1>-->❷, followed by a list of any available updates for the system or installed packages <!--<ccust1>3</ccust1>-->❸. This useful list indicates when you need to run the update commands described earlier in “<a class="xref" href="nsp-enoka501485-0010.xhtml#hd0304">Installing System Packages</a>.” Next, Ubuntu shows when support for your operating system expires <!--<ccust1>4</ccust1>-->❹, at which point you’ll need to upgrade your distribution with the <code>sudo apt dist-upgrade</code> command or build a new system with the latest operating system. Finally, the last successful login to the system is shown <!--<ccust1>5</ccust1>-->❺, which can be useful for <span aria-label="16" class="page" epub:type="pagebreak" id="p16" role="doc-pagebreak"/>identifying suspicious activity. If the last login was at 3 AM or from an unfamiliar IP address, you might want to investigate that activity (unless you’re in the habit of administering your network and systems in the early hours).</p>
<p class="hd" id="hd0307"><a class="xref" href="nsp-enoka501485-0007.xhtml#rhd0307"><span class="ccust2">#7: Capturing VM Configurations</span></a></p>
<p class="paft">At this point, if you’re using a VM, your virtual machine is at a known-good state; you’ve finished configuring and hardening it, and it’s ready to be used in your network. It’s a good idea to save this state so that if something goes wrong, you can return to it without completely rebuilding the system. One of the benefits of using virtual machines is the ability to take <i>snapshots</i>. Snapshots save the current state of a virtual machine, including its power state (on, off, suspended, and so on), so that you can quickly return to a saved state if necessary. You can’t do that with a traditional, physical system, although we’ve all been in situations where we wish we could. You might choose to take a snapshot before installing a new program, for example, or before changing a VM’s network settings or before adding or deleting a new user.</p>
</section>
<section>
<h3 class="bh" id="bh0310"><a class="xref" href="nsp-enoka501485-0007.xhtml#rbh0310">Taking Snapshots in VMware</a></h3>
<p class="paft">Regardless of the version of VMware you’re using, simply right-click the virtual machine for which you want to create a snapshot, click <b>Snapshots▸Snapshot</b>, name your snapshot, and wait for the process to complete. That’s it. Now, if something happens to your VM, right-click the VM and then click <b>Snapshots▸Restore Snapshot</b> to revert to this known-good state. It’s that simple.</p>
</section>
<section>
<h3 class="bh" id="bh0311"><a class="xref" href="nsp-enoka501485-0007.xhtml#rbh0311">Taking Snapshots in VirtualBox</a></h3>
<p class="paft">In VirtualBox, click the menu button (three bullets and three lines) on the VM in the virtual machine panel on the left of the VirtualBox window and then click <b>Snapshots</b>. To create a snapshot, click <b>Take</b>. Name your snapshot, click <b>OK</b>, and wait for the process to complete. To revert to a snapshot, click the snapshot and then click <b>Restore</b>.</p>
<p class="pcust1"><span class="ccust1">Note</span> Every snapshot you create will effectively make a duplicate of your virtual machine. Multiple snapshots can take up a large amount of space on your host computer. Keep this in mind when creating snapshots, and remove old snapshots when they’re no longer needed. Some cloud providers charge for snapshot storage as well, so keep that in mind when creating snapshots in your cloud dashboard. Snapshots are also not a good long-term backup method. (We’ll discuss backups at length in <a class="xref" href="nsp-enoka501485-0018.xhtml#ch09">Chapter 9</a>.)</p>
</section>
</section>
<section>
<h2 class="ah" id="ah0304"><span aria-label="17" class="page" epub:type="pagebreak" id="p17" role="doc-pagebreak"/><a class="xref" href="nsp-enoka501485-0007.xhtml#rah0304">Network Topology</a></h2>
<p class="paft">Understanding how your systems and devices connect to and communicate with each other is critical when it comes to cybersecurity. With that in mind, let’s take a crash course on the <i>Internet Protocol (IP)</i> and IP addressing. IP is a standard protocol that defines the format of data sent over a network allowing computers and other network-connected devices to communicate with each other.</p>
<p>Each of your computers and other network-connected devices requires an <i>IP address</i>. An IP address is comparable to a street address or a post office box; computer A sends network traffic to computer B by embedding computer B’s IP address in the data it sends. It’s the same as writing an address on an envelope. Any intermediate devices between the two computers can interpret this address from the data and pass it along until it reaches its destination, just like the postal service.</p>
<p>Two commonly used versions of the internet protocol currently exist, version 4 and version 6, which means we have two types of IP addresses, IPv4 and IPv6. While IPv6 has been around since the 1990s, it still isn’t used often today. We won’t cover it in detail in later chapters as it’s largely outside the scope of this book, but it’s important to be aware of what it is and why it exists. IPv4 addresses are written in what is known as <i>dotted quad notation</i>, which is a fancy way of saying they’re composed of four numbers separated by periods, such as 192.168.1.1. Each of the four numbers can range from 0 to 255, meaning that IPv4 addresses range from 0.0.0.0 to 255.255.255.255, or a total of 4,294,967,296 possible addresses.</p>
<p>So many network-connected devices now exist in the world that there aren’t enough IPv4 addresses to go around, which is one of the reasons IPv6 was created. IPv6 has a larger address space, with a total of more than 340 trillion, trillion, trillion addresses. To put that in perspective, that’s 100 times more addresses than there are atoms on the surface of Earth, which is convenient as more and more internet-connected devices come online. Eventually, IPv6 will be in common use, and every device will be able to have its own public IPv6 address, until we run out of those (probably not in my lifetime).</p>
<p>As there aren’t enough IPv4 addresses for everyone, we’ve had to come up with clever workarounds to connect all of our devices to the internet. One of those solutions is <i>network address translation (NAT)</i>. Using NAT, several devices can be contacted via one IP address.</p>
<p>When you connect your home or office to the internet through your router, your internet service provider assigns you (and your network) a public IP address. You can find your IP address using services like <a class="url-i" href="https://www.whatismyip.com/">https://www.whatismyip.com/</a>. IP addresses are usually <i>dynamic</i>, meaning that when you disconnect from and reconnect to the internet, you will often receive a different IP address.</p>
<p>Your internet router is responsible for routing traffic from your private, internal network, to the public internet, and vice versa, which is how you’re able to access services and browse the internet generally. At a high level, NAT takes the public IP address assigned to your router and <span aria-label="18" class="page" epub:type="pagebreak" id="p18" role="doc-pagebreak"/>translates the traffic it receives so that traffic bound from the internet to one of your internal computers or devices receives the traffic destined for that specific device. It’s similar to the way letters and packages are delivered to office buildings at their street address, and then a clerk or mail department determines where that package needs to go internally, forwarding it to the right recipient. It also works in the reverse; traffic outbound from your computer to the internet must be translated from the internal IP address of your computer to the public IP address of your router before being forwarded on to reach its intended destination and return a service, like a web page.</p>
<p>Different IP addresses are reserved and available for use on the public internet and your private network. The private address ranges that can be used for private networks are:</p>
<ul style="list-style-type:none">
<li class="ulf">10.0.0.0 to 10.255.255.255</li>
<li class="ul">172.16.0.0 to 172.31.255.255</li>
<li class="ull">192.168.0.0 to 192.168.255.255</li>
</ul>
<p>All other IP addresses form part of the publicly available IP ranges or are as yet unassigned.</p>
<p class="hd" id="hd0308"><a class="xref" href="nsp-enoka501485-0007.xhtml#rhd0308"><span class="ccust2">#8: Checking Your IP Address</span></a></p>
<p class="paft">Addressing is usually handled by a router or server. If you have a wireless router, you can log in to that device, take a look at the client list or DHCP settings, and find out which address range is being used. Alternatively, you can just check the address of your computer(s). Understanding the addressing in your network, in addition to maintaining an asset inventory and network map, also means you can keep account of the addresses assigned to specific devices, the users who are responsible for or assigned to a specific piece of hardware, and where a particular device is physically located, among other metadata. (We discuss asset management further in <a class="xref" href="nsp-enoka501485-0017.xhtml#ch08">Chapter 8</a>.)</p>
<section>
<h3 class="bh" id="bh0312"><a class="xref" href="nsp-enoka501485-0007.xhtml#rbh0312">On Windows</a></h3>
<p class="paft">On Windows, click the Start menu, enter cmd, and press ENTER to open the command prompt. Next, enter <code class="b">ipconfig</code> and press ENTER:</p>
<pre>
<p class="clf">C:\Users\user&gt;<code class="b">ipconfig</code></p>
<p class="clf">Windows IP Configuration</p>
<p class="cl">Ethernet adapter Ethernet:</p>
<p class="cl"><code class="b">   IPv4 Address</code>. . . . . . . . . . . : 192.168.1.126</p>
<p class="cl">   <code class="b">Subnet Mask</code>. . . . . . . . . . . : 255.255.255.0</p>
<p class="cl">   <code class="b">Default Gateway</code>. . . . . . . . . : 192.168.1.1</p>
<p class="cll">C:\Users\user&gt;</p>
</pre>
<p><span aria-label="19" class="page" epub:type="pagebreak" id="p19" role="doc-pagebreak"/>The output will show your current IP address, the relevant <i>subnet mask</i>, and the <i>default gateway</i> your computer is using. The subnet mask indicates to which segment of a network your computer belongs, and the default gateway is the address of the device your computer uses to access other networks, such as the internet. The gateway is probably your router.</p>
</section>
<section>
<h3 class="bh" id="bh0313"><a class="xref" href="nsp-enoka501485-0007.xhtml#rbh0313">On a Mac</a></h3>
<p class="paft">Finding the IP address of a Mac is similar. Open a terminal window, type <code class="b">ifconfig</code>, and press ENTER:</p>
<pre>
<p class="clf">$ <code class="b">ifconfig</code></p>
<p class="cl"><code class="i">--snip--</code></p>
<p class="cl">en0: flags=8863&lt;UP,BROADCAST,SMART,RUNNING,SIMPLEX,MULTICAST&gt; mtu 1500</p>
<p class="cl">       options=400&lt;CHANNEL_IO&gt;</p>
<p class="cl">       ether 78:8d:43:a4:ce:29</p>
<p class="cl">       <code class="b">inet</code> 192.168.1.120 <code class="b">netmask</code> 0xffffff00 <code class="b">broadcast</code> 192.168.1.255</p>
<p class="cl">       media: autoselect</p>
<p class="cll">       status: active</p>
</pre>
<p>On macOS, the <code>ifconfig</code> output is a bit different: <code>inet</code> is the internet or IP address, <code>netmask</code> is the subnet mask, and <code>broadcast</code> is the <i>broadcast address</i> of the network. The subnet mask here is displayed in <i>hexadecimal (hex)</i> instead of decimal. Hex is another notation used by computers, different from the dotted quad notation. A broadcast address is a reserved address in a network used for sending traffic to all devices in that network segment (we’ll cover this more in <a class="xref" href="nsp-enoka501485-0019.xhtml#ch10">Chapter 10</a>, which discusses network security monitoring).</p>
</section>
<section>
<h3 class="bh" id="bh0314"><a class="xref" href="nsp-enoka501485-0007.xhtml#rbh0314">On Linux</a></h3>
<p class="paft">On a Linux system, open a terminal window, and enter the following:</p>
<div class="codeline1">
<p class="cl1f">$ <code class="b">ip addr</code></p>
<p class="cl1"><code class="i">--snip--</code></p>
<p class="cl1">2: ens32: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000</p>
<p class="cl1">    link/ether 00:0c:29:db:ee:7c brd ff:ff:ff:ff:ff:ff</p>
<p class="cl1">    altname enp2s0</p>
<p class="cl1">    <code class="b">inet</code>  192.168.1.30<code class="b">/24 brd</code> 192.168.1.255 scope global dynamic noprefixroute ens32</p>
<p class="cl1">       valid_lft 4106sec preferred_lft 4106sec</p>
<p class="cl1">    inet6 fe80::66e:1ae7:861f:9224/64 scope link noprefixroute</p>
<p class="cl1l">       valid_lft forever preferred_lft forever</p>
</div>
<p>The IP address is listed under <code>inet</code> again; the broadcast address is <code>brd</code>, and the subnet mask is shown as <code>/24</code>, in <i>CIDR notation</i>. CIDR is another way of representing the same subnet mask information in a shorter format.</p>
<p class="hd" id="hd0309"><span aria-label="20" class="page" epub:type="pagebreak" id="p20" role="doc-pagebreak"/><a class="xref" href="nsp-enoka501485-0007.xhtml#rhd0309"><span class="ccust2">#9: Creating a Network Map</span></a></p>
<p class="paft">To get a better understanding of your network and see more granular details, like ingress and egress points (that is, the places where traffic enters and leaves your network), creating a <i>network map</i> or <i>network diagram</i> is beneficial. A network diagram is a graphical representation of your network that allows you to see the overall architecture at a glance and makes it easier to identify potential issues when it comes to securing your network.</p>
<p>draw.io (<a class="url-i" href="https://www.draw.io/">https://www.draw.io/</a>) is a free and easy-to-use cloud editor that allows users to create various types of diagrams, one being the network diagram. Alternatively, Microsoft Visio is a commercial solution that achieves the same objective. If you choose to use draw.io, load the site and open the Citrix drop-down from the menu on the left. You can then drag and drop the relevant representations, as shown in <a class="xref" href="nsp-enoka501485-0010.xhtml#fig0102">Figure 1-2</a>, from the menu on the left to the canvas on the right.</p>
<figure class="figure" id="fig0102">
<p class="fig"><img alt="Screenshot showing draw.io that has a grid (or canvas) on the right side of its window and a menu on the left side. The menu contains the following drop-down options: General, Misc, Advanced, Citrix. The Citrix drop-down option contains various images of hardware." height="1200" src="images/nsp-enoka501485-fig0102.jpg" style="width:95%; height:auto;" width="1158"/></p>
<figcaption>
<p class="figh"><span class="fighn">Figure 1-2</span>: draw.io diagramming tool</p>
</figcaption>
</figure>
<p>At its most basic, a small network typically comprises a modem/router, usually provided by your internet service provider, which connects your network and all your devices to the internet, as well as a few devices: computers, laptops, mobile devices, peripherals such as printers, and so <span aria-label="21" class="page" epub:type="pagebreak" id="p21" role="doc-pagebreak"/>on. Keeping track of all the devices on your network better enables you to secure your network, because you know what should be connected and allowed to communicate, both within the network and between your network and the internet.</p>
<p>Always keep your network diagram up-to-date. Whenever you add a new computer, laptop, mobile device, switch, virtual machine, or other system or device to your network (and remove them as well), you should update your network diagram. When it comes to a transient device whose IP addresses aren’t static, it might be worth assigning the device a static IP address in your router (see <a class="xref" href="nsp-enoka501485-0013.xhtml#ch04">Chapter 4</a>). Otherwise, you can track the IP range that might be assigned to those devices. Even if a device isn’t always connected to your network, maintain a record of devices that will be consistently expected to connect (<a class="xref" href="nsp-enoka501485-0013.xhtml#ch04">Chapter 4</a> discusses this in greater detail), and note those IP addresses in your network diagram.</p>
<p>A network diagram also allows you to see where you can implement additional security controls to improve your security posture. For example, <a class="xref" href="nsp-enoka501485-0010.xhtml#fig0103">Figure 1-3</a> shows a small, basic network.</p>
<figure class="figure" id="fig0103">
<p class="fig"><img alt="The basic network diagram contains the Internet (at the very top), which connects to a Wireless Router, which is connected to Desktop 1 and Laptop 1." height="896" src="images/nsp-enoka501485-fig0103.jpg" style="width:95%; height:auto;" width="1200"/></p>
<figcaption>
<p class="figh"><span class="fighn">Figure 1-3</span>: A small network</p>
</figcaption>
</figure>
<p>This network layout is typical of most home networks, where a modem/router connects the network to the internet, and all the endpoints use that device as a gateway to the public network. The problem with this network architecture is that it also allows adversaries to use the same network infrastructure to access the private network, without many obstacles in their path. Later in this book, you’ll learn how to improve this network’s security by adding a firewall between the wireless router and the internet to better manage the ingress and egress traffic and block suspicious traffic entering or leaving the network (see <a class="xref" href="nsp-enoka501485-0012.xhtml#ch03">Chapter 3</a> for more details on firewalls).</p>
<p>When mapping your network, collect as much information as possible about all the devices it includes, such as their IP addresses, MAC addresses, <span aria-label="22" class="page" epub:type="pagebreak" id="p22" role="doc-pagebreak"/>hostnames, purpose, primary user or owner, location, serial numbers, and so on. Start with your computers and move on to mobile devices, such as phones and tablets, and then any IoT devices you might have—if your TV or refrigerator connects to the internet, be sure to capture those as well.</p>
<p class="hd" id="hd0310"><a class="xref" href="nsp-enoka501485-0007.xhtml#rhd0310"><span class="ccust2">#10: Transferring Files</span></a></p>
<p class="paft">You may want to transfer files to your Linux machine from another system or from your Linux machine to your local computer. The intuitive rsync tool can synchronize files and folders, either between two locations on one system or between two systems across a network. To transfer specific files from one computer to another, use the following:</p>
<pre>
<p class="clf">$ <code class="b">rsync -ruhP --remove-source-files --protect-args "</code><code class="bi">/path/to/source/</code><code class="b">" \</code></p>
<p class="cll">    <code class="b">"</code><code class="bi">user@computer_ip:/path/to/destination/</code><code class="b">"</code></p>
</pre>
<p>Immediately following the <code>rsync</code> command are four flags. The <code>r</code> flag stands for <i>recursive</i>, meaning that everything inside the source folder will be copied to the destination. The <code>u</code> flag stands for <i>update</i>, which indicates to rsync that if it finds a copy of a file in the destination location that is newer than the copy in the source directory, skip it. Next, <code>h</code> is the typical flag used for <i>human-readable output</i>: any numbers (dates, file sizes, and so on) will be shown in an easier-to-read format. The <code>P</code> flag is for <i>progress</i>, which tells rsync to output the progress of the copy to the screen so you can see how much data has been transferred, how much remains, and how long until the process is expected to complete.</p>
<p>Following this first set of flags, the <code>--remove-source-files</code> argument tells rsync to delete the source files once they’ve been successfully copied, and <code>--protect-args</code> tells rsync to interpret the following arguments (the source and destination directories) as one continuous string each, even if they’re separated by a space character, which would normally indicate to the terminal that the directories were separate and independent. Without this argument, if your source path has a space in it, the command will interpret each section of the path on either side of the space character as a separate path. The same is true of the destination path. You can exclude one or both of those arguments if you don’t want to delete the source files after copying them or if your source and/or destination directories have no space characters in them.</p>
<p>In practice, the following shows how the command might look between two Linux servers (which we’ll cover in greater detail in <a class="xref" href="nsp-enoka501485-0014.xhtml#ch05">Chapter 5</a>):</p>
<pre>
<p class="clf">$ <code class="b">rsync -ruhP --remove-source-files --protect-args test.txt \ user@192.168.1.30:/tmp</code></p>
<p class="cl">Enter passphrase for key '/Users/user/.ssh/id_rsa':</p>
<p class="cl">sending incremental file list</p>
<p class="cl">test.txt</p>
<p class="cll">              0 100%    0.00kB/s    0:00:00 (xfr#1, to-chk=0/1)</p>
</pre>
<p><span aria-label="23" class="page" epub:type="pagebreak" id="p23" role="doc-pagebreak"/>As we mentioned in the “<a class="xref" href="nsp-enoka501485-0010.xhtml#hd0306">Securing Remote Access</a>” section, remember to enter the passphrase for the SSH key pair you created earlier, not the passphrase for the user account you’re using for the file transfer. The bottom of this listing contains the progress percentage, the current transfer speed, expected time remaining, and the number of files remaining in the transfer.</p>
<p class="pcust1"><span class="ccust1">Note</span> The best feature of rsync is its ability to resume transfers if they get interrupted. The Secure File Transfer Protocol (SFTP) and Secure Copy Protocol (SCP) are alternatives you could use to transfer files between systems, but neither can stop a transfer and pick it up at the same point so that you don’t lose your transfer progress while transferring potentially large files or directories. For these reasons, rsync is superior to SFTP and SCP, so we’ll primarily use rsync throughout the remainder of this book.</p>
</section>
</section>
<section>
<h2 class="ah" id="ah0305"><a class="xref" href="nsp-enoka501485-0007.xhtml#rah0305">Summary</a></h2>
<p class="paft">In this chapter, you built and secured your first Linux machine, which you’ll need to follow the examples in several chapters of this book. You also learned how to harden your Linux system to increase its security and your overall security posture, including creating a secure SSH configuration by utilizing SSH key pairs, and the fundamentals of how to manage users in your network. You learned about mapping your network topology, how computers and other devices are interrelated, and how they communicate with each other. In <a class="xref" href="nsp-enoka501485-0011.xhtml#ch02">Chapter 2</a>, you’ll learn how to layout your network to passively increase your overall security.</p>
</section>
</section>
</div></body></html>