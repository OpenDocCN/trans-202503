- en: '26'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '26  '
- en: Shinobi Tradecraft
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: '忍者技艺  '
- en: Secret techniques to infiltrate without fail are deceptive, and they are varied
    and flexible and are done according to opportunity. Thus, as a basis, you should
    embrace the old ways of the shinobi who served under ancient great generals, but
    remember not only to keep to these ways but to adapt them, each dependent on the
    situation and the moment.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: '渗透的秘密技巧是具有欺骗性的，而且它们是多变灵活的，通常根据机会进行操作。因此，作为基础，你应该接受那些曾在古代伟大将军手下服役的忍者的传统方式，但记住不仅要遵守这些传统，还要根据情况和时机加以调整。  '
- en: Even if there is a din outside, be aware that the guardhouse should not be left
    completely empty. Also, you should listen for any sounds.
  id: totrans-3
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '即使外面有喧嚣，也要注意守卫所不应完全空无一人。此外，你应该留心任何声音。  '
- en: ''
  id: totrans-4
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '—Yoshimori Hyakushu #66'
  id: totrans-5
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '—吉守百首 #66  '
- en: While shinobi were sometimes hired to guard castles and other fortifications
    (as described in *Shōninki* ^([1](b01.xhtml#endnote-190))), non-shinobi soldiers
    or mercenaries—warriors trained to repel common invaders—occupied most guard stations
    in feudal Japan. But *Bansenshūkai* and the *Gunpo Jiyoshu* manual advise commanders
    defending against shinobi to hire their own, as these warriors could train ordinary
    guards to identify secret shinobi tactics, techniques, and procedures (TTPs).^([2](b01.xhtml#endnote-191))
    Though many are described in the scrolls, TTPs were constantly being developed
    and refined, and different clans had their own secret techniques that other shinobi
    did not know.
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: '虽然有时忍者被雇佣来守卫城堡和其他防御工事（如《*将忍记*》中所述^([1](b01.xhtml#endnote-190))），但在封建日本，大多数守卫岗位是由非忍者士兵或雇佣兵——受过训练以抵御普通入侵者的战士——担任的。但《*万川集海*》和《*军法自用书*》手册建议防御忍者的指挥官雇佣自己的战士，因为这些战士可以训练普通守卫识别忍者的秘密战术、技巧和程序（TTPs）。^([2](b01.xhtml#endnote-191))
    尽管这些在卷轴中有描述，TTPs却在不断发展和完善，不同的家族拥有自己独特的秘密技巧，其他忍者并不知晓。  '
- en: 'Shinobi TTPs were clever and elegant, and they often served multiple purposes.
    For example, a shinobi might covertly stick a common umbrella in the ground and
    open it within sight of a castle’s guards. Not only could the shinobi hide things
    from the guards’ view by placing them under the umbrella, but also the obvious
    sign of human activity might draw guards away from their posts.^([3](b01.xhtml#endnote-192))
    This technique also leveraged a prevailing superstition of the time: the idea
    that forgotten or lost umbrellas became possessed and haunted their previous owner,
    a phenomenon variously referred to as *tsukumogami*, *kasa-obake*, and *yokai*.^([4](b01.xhtml#endnote-193))'
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 忍者的TTPs巧妙而优雅，且常常具有多重用途。例如，一名忍者可能会悄悄地将一把普通的伞插入地面，并在城堡守卫可见的地方打开它。忍者不仅可以通过将物品藏在伞下而避免被守卫看到，而且伞的明显标志可能会吸引守卫离开岗位。^([3](b01.xhtml#endnote-192))
    这个技巧还利用了当时流行的一种迷信：人们认为被遗忘或丢失的伞会变得被附身，并困扰其原主人，这种现象被称为*付喪神*、*伞妖怪*或*妖怪*。^([4](b01.xhtml#endnote-193))
- en: 'Shinobi hired to instruct guards faced a unique pedagogical challenge: it was
    taboo or outright forbidden to write down TTPs or share them with outsiders, as
    doing so would compromise the integrity of the skill and put other shinobi’s lives
    at risk. Some passages in the scrolls even advise shinobi to kill any observer
    or victim who discovered a TTP.^([5](b01.xhtml#endnote-194))'
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: '被雇佣教授守卫的忍者面临着独特的教学挑战：书写TTPs或与外人分享它们是禁忌或完全禁止的，因为这样做会破坏技能的完整性，并使其他忍者的生命陷入危险。一些卷轴中甚至建议忍者杀死任何发现TTPs的观察者或受害者。^([5](b01.xhtml#endnote-194))  '
- en: So, instead of giving away specific techniques, shinobi stressed adopting the
    proper mindset, having a high level of awareness, and exercising the degree of
    scrutiny necessary to catch a shinobi.^([6](b01.xhtml#endnote-195)) This mental
    stance was bolstered by a risk assessment performed on the guards’ camp, knowledge
    of the enemy, and the most probable and impactful threat scenarios the enemy could
    deploy. It seems shinobi did provide guards with a general sense of a shinobi’s
    operating capabilities and examples of different threat scenarios, but probably
    described them in a manner that did not fully disclose trade secrets.^([7](b01.xhtml#endnote-196))They
    taught guards the indicators of potential shinobi activity—the sights, sounds,
    and other observables to look for on watch—and established rules to avoid mistakes.^([8](b01.xhtml#endnote-197))
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，忍者并没有传授具体的技巧，而是强调了采取正确心态、具备高度警觉性，以及执行足够的审查力度来发现忍者的必要性。^([6](b01.xhtml#endnote-195))这种心态通过对守卫营地的风险评估、对敌情的了解以及敌人可能采取的最有可能和最具影响力的威胁场景进行了支持。看起来，忍者确实为守卫提供了有关忍者操作能力的整体感知和不同威胁场景的示例，但可能以一种不完全揭露行业机密的方式来描述这些内容。^([7](b01.xhtml#endnote-196))他们教导守卫如何识别潜在的忍者活动——在守望时需要注意的视觉、听觉和其他可观察到的迹象——并建立了避免犯错的规则。^([8](b01.xhtml#endnote-197))
- en: 'Because of the innumerable techniques to learn, and because many of the guards
    in training lacked formal education, shinobi transmitted knowledge via poems to
    make the information easier to remember. (This explains the high number of poems
    about guard awareness found in the “100 Ninja Poems” of *Yoshimori Hyakushu*.
    These were not for shinobi per se but rather for shinobi to relay to guards.)
    Again, the poems provided just enough detail to describe shinobi tactics, and
    they provided realistic guidance but not so much as to overwhelm the guards with
    information. For instance, poem 66 (cited at the beginning of this chapter) provides
    straightforward advice: do not leave your post empty and listen for any sounds,
    including but not limited to the din that initially drew attention, such as footsteps
    approaching from the rear.^([9](b01.xhtml#endnote-198)) The poems were grouped
    thematically. Poems 64–67, 78, 79, 91, 93, and 94 all deal with examples of maintaining
    awareness and avoiding blunders. Examples include how to keep watch at night when
    tired; which direction to face; and why drinking, singing, and soliciting prostitutes
    on duty are bad ideas.'
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 由于学习方法众多，而且许多在训练中的守卫缺乏正式教育，忍者通过诗歌传递知识，以便使信息更易于记忆。（这也解释了在《百首忍诗》中出现的关于守卫警觉性的诗歌数量众多，*吉盛百首*的这些诗歌并非专门为忍者而作，而是忍者传递给守卫的。）这些诗歌提供了足够的细节来描述忍者战术，并提供了切实可行的指导，但并不至于让守卫因信息过多而感到不堪重负。例如，第66首诗（在本章开头引用）提供了直截了当的建议：不要让岗位空着，要留心听任何声音，包括但不限于最初引起注意的喧闹声，例如从后方接近的脚步声。^([9](b01.xhtml#endnote-198))这些诗歌按主题分组。诗歌64–67、78、79、91、93和94都涉及如何保持警觉和避免失误的例子。例子包括如何在疲劳时夜间守望；该面向哪个方向；以及为什么在值班时喝酒、唱歌和招妓都是糟糕的主意。
- en: Of course, if an adversary shinobi observed that guards were actively searching
    for shinobi TTPs, then the adversary deployed countermeasures. A clear example
    that appears in all three major scrolls involves a shinobi’s hiding in bushes
    or tall grass or crawling through a field. The shinobi’s activity disturbs the
    surrounding insects, who freeze and remain quiet to hide themselves. For a trained
    guard, the absence of buzzing, humming, or chirping indicates that a hidden person
    is approaching. Typically, if the guard suddenly becomes alert and starts searching
    for the intruder, and the shinobi knows they are exposed, the shinobi quietly
    withdraws.^([10](b01.xhtml#endnote-199)) That’s where the countermeasure comes
    in. Before the next attempt, the shinobi captures some crickets in a box. The
    crickets, untroubled to the presence of the shinobi carrying them, chirp away
    freely, filling any silence around the shinobi approaching the guard post. The
    guards now have no reason to suspect the shinobi’s approach.^([11](b01.xhtml#endnote-200))
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 当然，如果敌方忍者观察到警卫在积极寻找忍者的TTP，敌人就会部署反制措施。在所有三部主要卷轴中都有一个清晰的例子，涉及忍者藏身于灌木丛或高草丛中，或在田野中爬行。忍者的活动会扰动周围的昆虫，这些昆虫会停止活动并保持安静，以隐藏自己。对于受过训练的警卫来说，缺乏嗡嗡声、鸣叫声或啾啾声意味着一个隐藏的人正在接近。通常，如果警卫突然变得警觉并开始搜索入侵者，而忍者知道自己已暴露，忍者会悄悄撤退。^([10](b01.xhtml#endnote-199))
    这就是反制措施的所在。在下一次行动前，忍者会捕捉一些蟋蟀，放在盒子里。蟋蟀对忍者的存在不感到困扰，仍然自由地鸣叫，填补了忍者接近警卫哨所周围的寂静。警卫现在没有理由怀疑忍者的接近。^([11](b01.xhtml#endnote-200))
- en: 'Poem 68 vividly illustrates the challenges of TTP detection and countermeasures:
    “You should conduct a thorough search, following behind the party of a night patrol.
    This is called *kamaritsuke* [ambush detection].”^([12](b01.xhtml#endnote-201))
    At night, the commander would dispatch a primary search party to patrol the perimeter
    with the usual lanterns and other equipment, but the leader would also send a
    covert search party in the main group’s wake.^([13](b01.xhtml#endnote-202)) Guards
    on perimeter patrol were told by their shinobi advisers to look for anything out
    of place—especially sounds, movement, and people.^([14](b01.xhtml#endnote-203))
    Of course, enemy shinobi were aware of this guidance. The scrolls describe how
    attacking shinobis could hide in bushes, ditches, or other dark places while a
    patrol passed before they continued working.^([15](b01.xhtml#endnote-204)) However,
    in some cases, the enemy might follow the patrol party, their own movements covered
    by the sound and light of the defenders; the infiltrators might even attack the
    patrol from behind.^([16](b01.xhtml#endnote-205)) Thus, having a second, covert
    patrol behind the first could catch hidden enemy shinobi. This group of heavily
    armed troops searched likely hiding spots and stayed alert for an enemy also following
    the main patrol party.^([17](b01.xhtml#endnote-206)) However, as a counter to
    the counter, the attacking shinobi who was aware of the *kamaritsuke* technique
    might wait in the shadows for the second hidden patrol to pass or move to a place
    that the second patrol would not search. To combat this—the counter to the counter
    to the counter—poems 69 and 70 were added:^([18](b01.xhtml#endnote-207))'
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 诗篇68生动地展示了TTP检测和反制的挑战：“你应该进行彻底的搜索，紧跟夜间巡逻队的脚步。这被称为*监视* [伏击检测]。”^([12](b01.xhtml#endnote-201))
    夜晚，指挥官会派遣一个主力搜索小组，使用常规的灯笼和其他装备巡逻周围的边界，但领导者还会派遣一个隐蔽的搜索小组，紧跟在主力小组之后。^([13](b01.xhtml#endnote-202))
    在边界巡逻的警卫被他们的忍者顾问告知，要留意任何不寻常的事情——尤其是声音、动作和人影。^([14](b01.xhtml#endnote-203)) 当然，敌方忍者也知道这些指导方针。卷轴中描述了如何攻击的忍者能够隐藏在灌木丛、沟渠或其他黑暗的地方，等待巡逻队经过后继续行动。^([15](b01.xhtml#endnote-204))
    然而，在某些情况下，敌人可能会跟随巡逻队，他们的动作被防守方的声音和灯光所掩盖；入侵者甚至可能从后方攻击巡逻队。^([16](b01.xhtml#endnote-205))
    因此，在第一支巡逻队后面安排第二支隐蔽的巡逻队可以发现隐藏的敌方忍者。这支装备精良的部队会搜寻可能的藏身之地，并保持警惕，防止敌人也跟随主巡逻队。^([17](b01.xhtml#endnote-206))
    然而，作为反制措施，敌方忍者若意识到*监视*技巧，可能会在阴影中等待第二支隐蔽巡逻队经过，或者移动到第二支巡逻队不会搜索的地方。为了应对这种反制——即反制的反制——诗篇69和70应运而生：^([18](b01.xhtml#endnote-207))
- en: '69: “After the night patrol is conducted, it is important to conduct *kamaritsuke*
    over and over again.”'
  id: totrans-13
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 69：“在夜间巡逻完成后，进行*监视*是非常重要的，需要反复进行。”
- en: '70: “When undertaking *kamaritsuke*, it is said that you should make multiple
    rounds at intervals to enable you to find the enemy’s shinobi agents.”'
  id: totrans-14
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 70：“在进行 *kamaritsuke* 时，据说你应该间隔多次巡逻，以便找到敌方的忍者代理。”
- en: This guidance encouraged an inconsistent cadence of *kamaritsuke* patrols to
    interfere with the adversary’s ability to operate freely. Frequent, semiunpredictable
    patrols with one or more following *kamaritsuke* parties left little opportunity
    for enemy shinobi to execute actions confidently against either the fortification
    or the defenders’ patrol parties.^([19](b01.xhtml#endnote-208))
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 这一指导方针鼓励采取不规律的 *kamaritsuke* 巡逻频率，以干扰对手的自由行动能力。频繁且半不可预测的巡逻，伴随一支或多支 *kamaritsuke*
    队伍，让敌方忍者很难自信地对防御工事或巡逻队执行行动。^([19](b01.xhtml#endnote-208))
- en: A best-effort approach with TTP detection and countermeasures can quickly escalate,
    but eventually, it becomes too dangerous or impractical to attack the fortification.
    This result is often the best defenders can hope for against enemy shinobis.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 采用尽最大努力的 TTP 检测和反制措施可以迅速升级，但最终，攻击防御工事变得过于危险或不切实际。这通常是最好的防御者能期望的结果，对抗敌方忍者的策略也是如此。
- en: In this chapter, we will discuss how the philosophy behind shinobi tradecraft
    is applicable to understanding cyber threat actor TTPs. We will touch on how cyber
    threat intelligence could guide incident responders, security engineers, and threat
    hunters so they can better defend their organizations, much as the shinobi were
    able to improve the effectiveness of common castle guards and soldiers with intelligence-driven
    defense. We explore several of the prevailing frameworks used to describe cyber
    threat TTPs. Blending those frameworks with the knowledge of the shinobi makes
    it easier to understand both threats and why TTPs are useful. We will go over
    why the P in TTPs is often a mystery and will likely remain unknown, but we’ll
    also theorize about the procedures a rational adversary would likely take, based
    on how we know the shinobi acted. Lastly, we’ll explore guidance for how to incorporate
    cyber threat intelligence into your organization’s defense strategy and touch
    on why this can be so difficult to do.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 本章将讨论忍者战术背后的哲学如何适用于理解网络威胁行为者的 TTPs。我们将探讨网络威胁情报如何引导事件响应者、安全工程师和威胁猎人，以便他们能够更好地保护自己的组织，就像忍者通过情报驱动的防御提高了普通城堡守卫和士兵的有效性一样。我们将探索描述网络威胁
    TTPs 的几种主流框架。将这些框架与忍者的知识相结合，可以更容易地理解威胁以及 TTPs 的重要性。我们还将讨论为什么 TTP 中的 P 常常是个谜，且很可能保持未知，但我们也将基于对忍者行为的了解，推测理性对手可能采取的程序。最后，我们将探讨如何将网络威胁情报纳入组织的防御策略，并讨论为什么这项工作如此困难。
- en: Techniques, Tactics, and Procedures
  id: totrans-18
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 技术、战术和程序
- en: In cybersecurity, TTPs describe approaches for analyzing a specific threat actor’s
    or group’s patterns of behavior, activities, and methods. *Tactics* describe the
    adversary’s operational maneuvers, such as reconnaissance, lateral movement, and
    backdoor deployment. *Techniques* are the detailed technical methods the adversary
    uses to accomplish tasks, such as using a specific tool or software to execute
    weaponization or exploitation. *Procedures* detail standard policies and courses
    of action to perform, such as confirming whether an exploited target system has
    any active users logged in before conducting additional tasks, running malware
    through string analysis for tradecraft errors before deploying, or implementing
    precautionary self-cleanup after verifying connectivity on a target box.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 在网络安全领域，TTPs 描述了分析特定威胁行为者或群体的行为模式、活动和方法的途径。*战术*描述了对手的操作手段，例如侦察、横向移动和后门部署。*技术*是对手用来完成任务的详细技术方法，比如使用特定工具或软件来执行武器化或利用。*程序*详细说明了执行任务的标准政策和行动方案，比如在执行其他任务前确认被利用的目标系统是否有任何活跃用户登录，或在部署之前通过字符串分析运行恶意软件以检测战术错误，或在验证目标系统的连接性后实施预防性的自我清理。
- en: 'Once TTPs are identified and defined, defenders can search for indicators of
    them in their environment. They can even predict which TTPs could be used against
    them to support planning and implementing preemptive mitigations or countermeasures.
    To establish and communicate a common definition of cyber adversary TTPs, the
    industry has developed multiple concepts, models, analyses, and sharing methods,
    including:'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦TTP被识别并定义，防守者可以在环境中寻找相关的指示器。防守者甚至可以预测可能被用来攻击自己的TTP，从而支持规划和实施预防性的减缓措施或反制措施。为了建立并传达网络对手TTP的共同定义，业界已经开发出了多种概念、模型、分析和共享方法，包括：
- en: Pyramid of Pain^([20](b01.xhtml#endnote-209))
  id: totrans-21
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 疼痛金字塔^([20](b01.xhtml#endnote-209))
- en: ATT&CK™ framework^([21](b01.xhtml#endnote-210))
  id: totrans-22
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: ATT&CK™框架^([21](b01.xhtml#endnote-210))
- en: Attack LifeCycle model^([22](b01.xhtml#endnote-211))
  id: totrans-23
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 攻击生命周期模型^([22](b01.xhtml#endnote-211))
- en: Cyber Kill Chain framework^([23](b01.xhtml#endnote-212))
  id: totrans-24
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 网络杀伤链框架^([23](b01.xhtml#endnote-212))
- en: Diamond Model of Intrusion Analysis^([24](b01.xhtml#endnote-213))
  id: totrans-25
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 入侵分析钻石模型^([24](b01.xhtml#endnote-213))
- en: STIX (Structured Threat Information eXpression)^([25](b01.xhtml#endnote-214))
  id: totrans-26
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: STIX（结构化威胁信息表达式）^([25](b01.xhtml#endnote-214))
- en: Pyramid of Pain
  id: totrans-27
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 疼痛金字塔
- en: The Pyramid of Pain (see [Figure 26-1](#figure26-1)) is an excellent model for
    visualizing how awareness of an adversary’s indicators, tools, and TTPs can affect
    the defender’s security posture. It also shows how the difficulty of implementing
    measures and countermeasures increases for both defenders and attackers.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 疼痛金字塔（见[图26-1](#figure26-1)）是一个非常好的模型，用来直观展示对敌方指示器、工具和TTP的意识如何影响防守者的安全态势。它还展示了实施措施和反制措施的难度如何随着时间的推移对防守方和攻击方都增加。
- en: The name Pyramid of Pain refers to the idea that, while there is no way to guarantee
    absolute security or prevent all attacks, an adversary is less likely to target
    your organization if you make it extremely painful for them to expend the time,
    resources, and effort to do so.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 疼痛金字塔这个名称指的是这样一个观点：虽然没有办法保证绝对的安全或防止所有的攻击，但如果你让攻击者在投入时间、资源和精力时感到极大的痛苦，他们就不太可能会攻击你的组织。
- en: '![f26001](Images/f26001.png)'
  id: totrans-30
  prefs: []
  type: TYPE_IMG
  zh: '![f26001](Images/f26001.png)'
- en: 'Figure 26-1: Fortification of indicators of compromise (adapted from David
    Bianco’s Pyramid of Pain^([26](b01.xhtml#endnote-215)))'
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 图26-1：妥协指示器的加固（改编自David Bianco的疼痛金字塔^([26](b01.xhtml#endnote-215)))
- en: At the bottom of the pyramid are indicators of compromise (IoC)—such as domains,
    IPs, file hashes, and URLs—that can positively identify known malicious indicators.
    Defenders can block these indicators or raise alerts around them, but the adversary
    can also change them.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 在金字塔的底部是妥协指示器（IoC）——例如域名、IP、文件哈希和URL——这些可以用来正确定义已知的恶意指示器。防守者可以屏蔽这些指示器或围绕它们发出警报，但攻击者也可以更改这些指示器。
- en: Above the atomic indicators are host-based indicators, such as registry keys,
    dropped files, and artifacts. These can be detected or responded to, but threat
    detection or mitigation may not be automatic, and the adversary can alter them
    based on the target or operation.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 在原子级指示器之上是基于主机的指示器，例如注册表项、丢失的文件和伪造的物品。这些可以被检测或响应，但威胁检测或缓解可能不是自动的，攻击者可以根据目标或操作进行更改。
- en: The next level is tools—software or devices with which the adversary conducts
    or supports offensive actions. By searching for, removing access to, or disabling
    the functionality of known malicious tools in an environment, defenders may be
    able to detect and prevent the adversary from operating effectively.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 下一层是工具——攻击者用来进行或支持攻击行动的软件或设备。通过在环境中搜索、移除访问权限或禁用已知恶意工具的功能，防守者可能能够检测并防止攻击者有效地操作。
- en: At the top of the pyramid are the adversary’s tactics, techniques, and procedures.
    If you can identify or mitigate against these methods, it becomes difficult for
    the adversary to create or learn new TTPs to use against you—though of course,
    it is also painful for you as the defender to develop safeguards or countermeasures.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 在金字塔的顶部是敌方的战术、技术和程序。如果你能识别或减轻这些方法的影响，敌人就很难创造或学习新的TTP（战术、技术和程序）来对付你——当然，作为防守方，你在制定保护措施或反制措施时也会感到痛苦。
- en: ATT&CK Framework
  id: totrans-36
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: ATT&CK框架
- en: 'MITRE’s Adversarial Tactics, Techniques, and Common Knowledge (ATT&CK) framework
    derives many tactics from Lockheed Martin’s Cyber Kill Chain framework (see [Figure
    26-2](#figure26-2)). The Cyber Kill Chain framework outlines seven stages of the
    attack lifecycle: reconnaissance, weaponization, delivery, exploitation, installation,
    command and control, and actions on objectives. Each tactic identified in the
    ATT&CK framework lists techniques and methods, with examples, to detect or mitigate
    against.'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: MITRE的对抗性战术、技术和常识（ATT&CK）框架从洛克希德·马丁的网络杀伤链框架中衍生出了许多战术（见[图26-2](#figure26-2)）。网络杀伤链框架概述了攻击生命周期的七个阶段：侦察、武器化、交付、利用、安装、指挥与控制以及目标行动。ATT&CK框架中识别的每个战术都列出了检测或减轻的技术和方法，并附有示例。
- en: Note that “Procedures” is missing from the ATT&CK framework. This is understandable,
    as identifying these would likely require stealing and analyzing a nation-state’s
    or military’s book of offensive cyber operations. This is why the *Bansenshūkai*,
    *Ninpiden*, and *Shōninki* texts, which describe the procedures of a sophisticated
    espionage threat group, so greatly enrich the discussion.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，ATT&CK框架中缺少“程序”这一部分。这是可以理解的，因为识别这些程序可能需要窃取并分析某个国家或军事机构的进攻性网络行动手册。这就是为什么描述复杂间谍威胁组织程序的*《万川集海》*、*《忍秘传》*和*《将忍记》*等文本如此大大丰富了讨论。
- en: Threat Intelligence
  id: totrans-39
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 威胁情报
- en: When your security team understands these tactics and techniques—and has identified
    your attack surfaces, evaluated your current security controls, and performed
    analysis of previous incidents to determine your organization’s defensive effectiveness—it
    is possible to start predicting where adversaries are likely to target your environment.
    With a good set of threat predictions, you can then start threat hunting—looking
    for indicators and evidence threat actors left behind that may indicate compromise.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 当你的安全团队理解这些战术和技术，并识别了你的攻击面、评估了当前的安全控制措施，并对之前的事件进行了分析，以确定你组织的防御效果时，就可以开始预测对手可能会针对你的环境进行攻击。有了良好的威胁预测，你可以开始威胁狩猎——寻找威胁行为者留下的指标和证据，可能表明系统已经被攻破。
- en: '![f26002](Images/f26002.png)'
  id: totrans-41
  prefs: []
  type: TYPE_IMG
  zh: '![f26002](Images/f26002.png)'
- en: 'Figure 26-2: Ninja attack chain (adapted from MITRE’s ATT&CK framework^([27](b01.xhtml#endnote-216)))'
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 图26-2：忍者攻击链（改编自MITRE的ATT&CK框架^([27](b01.xhtml#endnote-216)))
- en: However, without a deep understanding of exactly how threat actors operate,
    it is difficult to effectively hunt or detect their presence.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，如果没有深入了解威胁行为者如何操作，就很难有效地进行狩猎或检测到他们的存在。
- en: Here, threat intelligence shows its value. *Threat intelligence* does not necessarily
    mean feeds such as lists of new IPs, domains, URLs, and file hashes associated
    with malware, hacking infrastructure, or threat groups. Rather, *cyber threat
    intelligence (CTI)* refers to traditional intelligence that collects and analyzes
    cyber threats such as malware, hacktivists, nation-states, criminals, DDoS attacks,
    and more. When consumed correctly, CTI provides actionable intelligence on and
    assessment of what the threat is doing, its motivations, and its TTPs. Simply
    put, CTI is one of the best ways to effectively understand and defend against
    threats because it requires decision makers to inform themselves and take defensive
    actions.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，威胁情报展示了其价值。*威胁情报*不一定意味着诸如与恶意软件、黑客基础设施或威胁组织相关的IP列表、域名、URL和文件哈希等信息流。而是，*网络威胁情报（CTI）*指的是传统的情报，收集和分析网络威胁，如恶意软件、黑客活动分子、国家行为者、犯罪分子、DDoS攻击等。当正确使用时，CTI提供了关于威胁正在做什么、其动机以及TTP的可操作情报和评估。简而言之，CTI是理解和防御威胁的最佳方法之一，因为它要求决策者自我告知并采取防御行动。
- en: Unfortunately, many CTI consumers pay attention only to the IoCs, as they can
    easily be ingested into SIEMs, firewalls, and other security devices to block
    or detect threats. Operating this way negates CTI’s real value, as detailed observations
    and assessments by CTI analysts describe behaviors, patterns, methods, attribution,
    and context. While CTI producers may not always reveal how they collect intelligence
    on a threat, they often strive to be transparent in their assessments of what
    they know and why they believe the threat conducts certain actions.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 不幸的是，许多CTI消费者仅关注IoCs，因为它们可以轻松地被导入SIEM、火墙和其他安全设备中，以阻止或检测威胁。以这种方式操作会忽视CTI的真正价值，因为CTI分析师通过详细的观察和评估描述了行为、模式、方法、归属和背景。尽管CTI生产者可能并不总是透露他们如何收集有关威胁的情报，但他们通常会努力在评估他们所知道的内容以及为什么相信威胁执行某些行动时保持透明。
- en: Of course, consuming intelligence reports with the intention of understanding
    a threat while also developing a deep understanding of your environment can be
    demanding. This process requires a broad skill set—one that includes the ability
    to quickly learn and make strategic decisions. But if a CTI consumer can dedicate
    the time to understand a threat’s every step, code, tactic, and technique, they
    can make decisions that allow them to successfully mitigate, detect, respond to,
    and even predict future threat movements.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 当然，以理解威胁为目的消耗情报报告，同时还要深入理解你的环境，这可能是非常具有挑战性的。这个过程需要广泛的技能组合——其中包括快速学习和做出战略决策的能力。然而，如果一个CTI使用者能够投入时间去理解威胁的每一步、代码、战术和技术，他们就能做出决策，帮助他们成功地缓解、检测、应对，甚至预测未来的威胁动态。
- en: Cyber Threat Intelligence
  id: totrans-47
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 网络威胁情报
- en: 'Having already bought dozens of security solutions and employed full-time security
    staff to handle numerous threat vectors, some may regard CTI as the final cost
    layer to top off their already “expense-in-depth” security model. CTI, though,
    may allow you to improve your security strategies, and it can amplify the effectiveness
    of all other security layers, thus justifying its cost. Unfortunately, in many
    cases, effectively using CTI can be akin to reading reports of the newest scientific
    discoveries in a given field, as it requires you to understand the implications
    of the discovery and then rapidly change culture, business strategies, and technologies
    in response. While possible, this intensity of consumption, synthesis, and action
    seems excessively demanding. This is the biggest challenge of CTI: it’s not a
    crystal ball that offers easy answers that are easy to follow through on. Review
    the guidance below to make sound decisions about your CTI program.'
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 在已经购买了数十种安全解决方案并雇佣了全职安全人员处理众多威胁渠道的情况下，一些人可能会认为CTI是他们已经实施的“深层防御”安全模型的最后一道成本层。然而，CTI可能会让你改进你的安全策略，并增强其他所有安全层的有效性，从而证明它的成本是值得的。不幸的是，在许多情况下，有效使用CTI就像是阅读某一领域最新科学发现的报告，因为它要求你理解这些发现的含义，然后迅速改变文化、业务策略和技术以应对。虽然这是可能的，但这种信息的消耗、综合和行动的强度似乎过于苛刻。这也是CTI的最大挑战：它不是一个可以提供简单答案的水晶球，也不是易于执行的解决方案。请参阅下面的指导，做出明智的决策来制定你的CTI计划。
- en: '*Develop cyber threat intelligence and threat hunting.* Consider subscribing
    your organization to a free or paid CTI report. Also, start developing your own
    internal CTI by collecting evidence of threats currently attacking your environment.
    Establish a CTI team to collect and analyze findings and analysis and report these
    findings to IT, security, and business stakeholders. These parties should understand
    who’s targeting the organization, how they’re infiltrating, what they’ll do once
    on the network, their assumed goals, and how they’re executing those goals. Implement
    strategic and operational safeguards, mitigations, and countermeasures in your
    information systems to defend against the specific tactics observed.'
  id: totrans-49
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '*开发网络威胁情报和威胁狩猎*。考虑为你的组织订阅免费的或付费的CTI报告。同时，通过收集当前攻击你环境的威胁证据，开始开发自己的内部CTI。建立一个CTI团队，收集并分析发现的威胁，并将这些发现报告给IT、安全和业务相关方。这些各方应该了解谁在针对组织，如何渗透网络，一旦进入网络，他们会做什么，预期的目标是什么，以及他们是如何执行这些目标的。在你的信息系统中实施战略性和操作性防护、缓解措施和对策，以防御观察到的特定战术。'
- en: Train your security and intelligence staff to threat hunt. Because not every
    threat can be engineered or blocked, a dedicated hunt team must constantly search
    for traces of threats in your network, guided by intelligence from your CTI partner,
    vendor, or team. Threat hunting can be augmented with purple team exercises, in
    which the red team performs adversarial activity on your network while your blue
    team attempts to hunt them, thereby learning how to counter a threat.
  id: totrans-50
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 训练你的安全和情报人员进行威胁狩猎。因为并不是每个威胁都能被构造或阻止，所以必须有一个专门的猎捕团队，始终在你的网络中搜索威胁的痕迹，这些痕迹由你的CTI合作伙伴、供应商或团队提供情报。威胁狩猎可以通过紫队演习得到增强，在这种演习中，红队在你的网络上执行对抗活动，而你的蓝队则试图追捕他们，从而学习如何应对威胁。
- en: '*Consume and leverage CTI.* Run a tabletop exercise with your email, IT, and
    security teams to simulate a threat’s TTPs and gauge your reaction. Suppose, for
    instance, you receive intelligence that a phishing campaign is targeting organizations
    like yours that use Google link shorteners (*http://goo.gl/*). You cannot simply
    block Google’s IPs, URLs, or domain without hindering business operations, and
    many organizational staff use link shorteners for legitimate purposes. Your CTI
    assesses that the adversary likely uses the goo.gl link because your antivirus
    software, proxy, or phishing protocol does not properly evaluate it as malicious.
    The security systems recognize that Google is a whitelisted site.'
  id: totrans-51
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '*消费并利用CTI*。与您的电子邮件、IT和安全团队进行桌面演练，模拟威胁的TTP（战术、技术和程序），并评估您的反应。例如，假设您收到情报，指出一个钓鱼活动正在针对像您这样的组织，这些组织使用Google链接缩短器（*http://goo.gl/*）。您不能仅仅阻止Google的IP、URL或域名，因为这样会妨碍业务操作，而且许多组织员工出于合法目的使用链接缩短器。您的CTI评估认为，攻击者可能使用goo.gl链接，因为您的防病毒软件、代理或钓鱼协议未能将其正确评估为恶意链接。安全系统识别到Google是一个白名单网站。'
- en: First, attempt to hunt for evidence of that link in your current emails. Many
    organizations hit an early barrier here, as their email administrator is not cooperative
    or does not have the necessary visibility or resources to search incoming email
    containing goo.gl hyperlinks. Additional barriers could include quarantining potential
    phishes, alerting non-IT and non-security staff to the presence of the threat,
    and training them on how to detect and avoid this threat.
  id: totrans-52
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 首先，尝试在您当前的电子邮件中寻找该链接的证据。许多组织在这里遇到早期障碍，因为他们的邮件管理员不合作，或者没有必要的可见性或资源来搜索包含goo.gl超链接的来邮。额外的障碍可能包括隔离潜在的钓鱼邮件、提醒非IT和非安全人员威胁的存在，并培训他们如何检测和避免此类威胁。
- en: Just as the adversary has different tools, tactics, and techniques to target
    your organization, your own tools require contemplation, understanding, ingenuity,
    and engineering to effectively block and respond to threats in a holistic, effective
    way. For example, your email administrator may create a rule to detect the goo.gl
    link shortener, but what about others? Hopefully, your CTI team would identify
    the threat from phishing with links and link shortening and recommend methods
    to detect, block, or mitigate those links. In addition, the team should keep people
    in your organization aware of this TTP. In other words, they should be looking
    not only for goo.gl but also for *all* link shorteners. Finally, decision makers
    have to strategically address this threat with new architecture, policies, or
    controls.
  id: totrans-53
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 就像对手有不同的工具、战术和技术来攻击您的组织一样，您的工具也需要经过深思熟虑、理解、创造性和工程设计，才能以全面、有效的方式有效地阻止和应对威胁。例如，您的邮件管理员可能会创建一个规则来检测goo.gl链接缩短器，但其他的呢？希望您的CTI团队能够识别出带有链接的钓鱼威胁，并推荐检测、阻止或缓解这些链接的方法。此外，团队还应让您组织中的人员意识到这一TTP。换句话说，他们不仅应该寻找goo.gl链接，还应寻找*所有*链接缩短器。最后，决策者必须通过新的架构、政策或控制措施战略性地应对这一威胁。
- en: Going through this process, however painful it may be, is necessary to identify
    where your organization needs to improve in detecting, mitigating, and responding
    to threats.
  id: totrans-54
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 然而，尽管这个过程可能很痛苦，但这是识别您的组织在检测、缓解和应对威胁方面需要改进的地方。
- en: Recommended Security Controls and Mitigations
  id: totrans-55
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 推荐的安全控制和缓解措施
- en: These recommendations are presented with NIST 800-53 standards and should be
    evaluated with the idea of security awareness, TTPs, and CTI in mind.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 这些建议依据NIST 800-53标准提出，应从安全意识、TTP和CTI的角度进行评估。
- en: 'Provide security awareness training to personnel in all roles within your organization
    to help employees determine how to rapidly respond to threats they encounter.
    [AT-2: Security Awareness Training; PM-13: Information Security Workforce]'
  id: totrans-57
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '向您组织内各个角色的员工提供安全意识培训，帮助员工迅速应对他们遇到的威胁。[AT-2: 安全意识培训；PM-13: 信息安全工作人员]'
- en: 'Dedicate a team to analyzing threats, incidents, intelligence, and adversary
    TTPs, as well as developing countermeasures and safeguards to combat those threats.
    [IR-10: Integrated Information Security Analysis Team]'
  id: totrans-58
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '专门组建一个团队，分析威胁、事件、情报和对手的TTP，并开发反制措施和防护措施以应对这些威胁。[IR-10: 集成信息安全分析团队]'
- en: 'Partner with external security groups and threat-sharing institutions to receive
    intelligence on threats relevant to your organization. [PM-15: Contacts with Security
    Groups and Associations]'
  id: totrans-59
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 与外部安全团体和威胁共享机构合作，接收与你组织相关的威胁情报。[PM-15：与安全团体和协会的联系]
- en: 'Implement a threat awareness program that shares details about threat intelligence,
    how to mitigate threats, and indicators of compromise. [PM-16: Threat Awareness
    Program]'
  id: totrans-60
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 实施一个威胁意识计划，分享有关威胁情报的细节、如何减轻威胁以及妥协指标的信息。[PM-16：威胁意识计划]
- en: 'Use credible threat intelligence and information to hunt for and monitor activity,
    behaviors, patterns, and other observables indicative of a threat. [SI-4: Information
    System Monitoring]'
  id: totrans-61
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用可靠的威胁情报和信息来寻找和监控活动、行为、模式以及其他表明威胁的可观察对象。[SI-4：信息系统监控]
- en: Debrief
  id: totrans-62
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 汇报
- en: In this chapter, we reviewed several shinobi TTPs, in particular how *kamaritsuke*
    TTPs co-evolved with countertactics by both defender and adversary until a fault-tolerant
    security system emerged. We explored other cyber threat tactics, which may also
    develop as each side tries to counter the other, until resiliency emerges. We
    discussed cyber threat intelligence and why just knowing what the adversary is
    doing, how they are doing it, and what they are going to do is not enough. To
    be useful, CTI must be consumed with an eye toward addressing the threat in some
    way. In the Castle Theory Thought Exercise, we looked at a clear example of defenders
    discovering an observable, followed by a shift in tactics regarding the threat.
    This thought exercise could be compared to spoofing system/network logs to deceive
    threat hunters, anomaly detectors, and even machine learning systems—and it could
    reemerge in modern times. The most important lesson of this chapter—perhaps even
    the book—is that it is critical to consume threat intelligence and respond against
    dynamic threats in innovative ways.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们回顾了几种忍者的战术、技巧和程序（TTPs），特别是*神速*的TTPs是如何与防御者和对手的反制策略共同演化，直到出现容错安全系统。我们探讨了其他的网络威胁战术，这些战术可能也会随着双方互相反制而发展，直到弹性得以体现。我们讨论了网络威胁情报以及为何仅仅知道对手在做什么、他们是如何做的以及他们接下来会做什么是不够的。要有用，网络威胁情报（CTI）必须以某种方式来应对威胁。通过《城堡理论思维练习》，我们看到了一个明确的例子，防御者发现可观察到的威胁后，战术随之发生变化。这一思维练习可以与伪造系统/网络日志以欺骗威胁猎人、异常检测器甚至机器学习系统进行类比——并且这种情况在现代可能会再次出现。本章最重要的教训——甚至可能是整本书的教训——就是必须以创新的方式利用威胁情报并应对动态的威胁。
