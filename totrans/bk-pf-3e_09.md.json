["```\nblock log\npass log quick proto { tcp, udp } to port ssh\n```", "```\n$ **sudo tcpdump -n -ttt -r /var/log/pflog**\n```", "```\n$ **sudo tcpdump -n -ttt -r /var/log/pflog**\ntcpdump: WARNING: snaplen raised from 116 to 160\nSep 13 13:00:30.556038 rule 10/(match) pass in on epic0: 194.54.107.19.34834 >\n194.54.103.66.113: S 3097635127:3097635127(0) win 16384 <mss 1460,nop,nop,sackOK,nop,wscale\n0,[|tcp]> (DF)\nSep 13 13:00:30.556063 rule 10/(match) pass out on fxp0: 194.54.107.19.34834 >\n194.54.103.66.113: S 3097635127:3097635127(0) win 16384 <mss 1460,nop,nop,sackOK,nop,wscale\n0,[|tcp]> (DF)\nSep 13 13:01:07.796096 rule 10/(match) pass in on epic0: 194.54.107.19.29572 >\n194.54.103.66.113: S 2345499144:2345499144(0) win 16384 <mss 1460,nop,nop,sackOK,nop,wscale\n0,[|tcp]> (DF)\nSep 13 13:01:07.796120 rule 10/(match) pass out on fxp0: 194.54.107.19.29572 >\n194.54.103.66.113: S 2345499144:2345499144(0) win 16384 <mss 1460,nop,nop,sackOK,nop,wscale\n0,[|tcp]> (DF)\nSep 13 13:01:15.096643 rule 10/(match) pass in on epic0: 194.54.107.19.29774 >\n194.54.103.65.53: 49442 [1au][|domain]\nSep 13 13:01:15.607619 rule 12/(match) pass in on epic0: 194.54.107.19.29774 >\n194.54.107.18.53: 34932 [1au][|domain]\n```", "```\n$ **sudo tcpdump -lnettti pflog0**\nApr 29 22:07:36.097434 rule 16/(match) pass in on xl0: 85.19.150.98.53 > 213.187.179.198.41101:\n63267*- 1/0/2 (68)\nApr 29 22:07:36.097760 rule def/(match) pass out on em0: 213.187.179.198.22 >\n192.168.103.44.30827: P 1825500807:1825500883(76) ack 884130750 win 17520 [tos 0x10]\nApr 29 22:07:36.098386 rule def/(match) pass in on em0: 192.168.103.44.30827 >\n213.187.179.198.22: . ack 76 win 16308 (DF) [tos 0x10]\nApr 29 22:07:36.099544 rule 442/(match) pass in on xl0: 93.57.15.161.4487 > 213.187.179.198.80:\nP ack 3570451894 win 65535 <nop,nop,timestamp 4170023961 0>\nApr 29 22:07:36.108037 rule 25/(match) pass out on xl0: 213.187.179.198.25 >\n213.236.166.45.65106: P 2038177705:2038177719(14) ack 149019161 win 17424 (DF)\nApr 29 22:07:36.108240 rule def/(match) pass out on em0: 213.187.179.198.22 >\n192.168.103.44.30827: P 76:232(156) ack 1 win 17520 [tos 0x10]\n```", "```\nmatch in log (matches) on $int_if from $testhost tag localnet\n```", "```\nApr 29 21:08:24.386474 rule 3/(match) match in on em0: 192.168.103.44.14054 > 81.93.163.115.80:\nS 1381487359:1381487359(0) win 16384 <mss 1460,nop,nop,sackOK,nop,wscale 3,nop,nop,timestamp\n735353043[|tcp]> (DF) ➊\nApr 29 21:08:24.386487 rule 11/(match) block in on em0: 192.168.103.44.14054 >\n81.93.163.115.80: S 1381487359:1381487359(0) win 16384 <mss 1460,nop,nop,sackOK,nop,wscale\n3,nop,nop,timestamp 735353043[|tcp]> (DF) ➋\nApr 29 21:08:24.386497 rule 17/(match) pass in on em0: 192.168.103.44.14054 > 81.93.163.115.80:\nS 1381487359:1381487359(0) win 16384 <mss 1460,nop,nop,sackOK,nop,wscale 3,nop,nop,timestamp\n735353043[|tcp]> (DF) ➌\nApr 29 21:08:24.386513 rule 17/(match) pass in on em0: 192.168.103.44.14054 > 81.93.163.115.80:\nS 1381487359:1381487359(0) win 16384 <mss 1460,nop,nop,sackOK,nop,wscale 3,nop,nop,timestamp\n735353043[|tcp]> (DF)\nApr 29 21:08:24.386553 rule 5/(match) match out on xl0: 213.187.179.198.14054 >\n81.93.163.115.80: S 1381487359:1381487359(0) win 16384 <mss 1460,nop,nop,sackOK,nop,wscale\n3,nop,nop,timestamp 735353043[|tcp]> (DF) ➍\nApr 29 21:08:24.386568 rule 16/(match) pass out on xl0: 213.187.179.198.14054 >\n81.93.163.115.80: S 1381487359:1381487359(0) win 16384 <mss 1460,nop,nop,sackOK,nop,wscale\n3,nop,nop,timestamp 735353043[|tcp]> (DF) ➎\n```", "```\nblock log (all)\npass log (all) quick proto tcp to port ssh keep state\n```", "```\nudp_services = \"{ domain, ntp }\"\npass log (all) inet proto udp to port $udp_services\n```", "```\n$ **sudo tcpdump -lnttti pflog0 port domain** \ntcpdump: WARNING: snaplen raised from 116 to 160\ntcpdump: listening on pflog0, link-type PFLOG\nSep 30 14:27:41.260190 212.5.66.14.53 > 194.54.107.19.53:[|domain]\nSep 30 14:27:41.260253 212.5.66.14.53 > 194.54.107.19.53:[|domain]\nSep 30 14:27:41.260267 212.5.66.14.53 > 194.54.107.19.53:[|domain]\nSep 30 14:27:41.260638 194.54.107.19.53 > 212.5.66.14.53:[|domain]\nSep 30 14:27:41.260798 194.54.107.19.53 > 212.5.66.14.53:[|domain]\nSep 30 14:27:41.260923 194.54.107.19.53 > 212.5.66.14.53:[|domain]\n```", "```\n$ **sudo ifconfig create pflog1**\n```", "```\npass log (to pflog1) proto tcp to $emailserver port $email\npass log (to pflog1) proto tcp from $emailserver to port smtp\n```", "```\nifconfig_pflog1=\"up\"\n```", "```\npflogd_flags=\"NO\"\n```", "```\nlocal2.info             @loghost.example.com\n```", "```\n$ **sudo nohup tcpdump -lnettti pflog0 | logger -t pf -p local2.info &**\n```", "```\npf: Sep 21 14:05:11.492590 rule 93/(match) pass in on ath0:\n10.168.103.11.15842 > 82.117.50.17.80: [|tcp] (DF)\npf: Sep 21 14:05:11.492648 rule 93/(match) pass out on xl0:\n194.54.107.19.15842 > 82.117.50.17.80: [|tcp] (DF)\npf: Sep 21 14:05:11.506289 rule 93/(match) pass in on ath0:\n10.168.103.11.27984 > 82.117.50.17.80: [|tcp] (DF)\npf: Sep 21 14:05:11.506330 rule 93/(match) pass out on xl0:\n194.54.107.19.27984 > 82.117.50.17.80: [|tcp] (DF)\npf: Sep 21 14:05:11.573561 rule 136/(match) pass in on ath0:\n10.168.103.11.6430 > 10.168.103.1.53:[|domain]\npf: Sep 21 14:05:11.574276 rule 136/(match) pass out on xl0:\n194.54.107.19.26281 > 209.62.178.21.53:[|domain]\n```", "```\n$ **pfctl -vs rules**\npass inet proto tcp from any to 192.0.2.225 port = smtp flags S/SA keep state label \"mail-in\"\n  [ Evaluations: 1664158 Packets: 1601986 Bytes: 763762591 States: 0 ]\n  [ Inserted: uid 0 pid 24490 ]\npass inet proto tcp from 192.0.2.225 to any port = smtp flags S/SA keep state label \"mail-out\"\n  [ Evaluations: 2814933 Packets: 2711211 Bytes: 492510664 States: 0 ]\n  [ Inserted: uid 0 pid 24490 ]\n```", "```\npass log proto { tcp, udp } to $emailserver port smtp label \"mail-in\"\npass log proto { tcp, udp } from $emailserver to port smtp label \"mail-out\"\n```", "```\n$ sudo pfctl -vsl\n    ➊      ➋       ➌        ➍        ➎       ➏        ➐       ➑\nmail-in 1664158 1601986 763762591 887895 682427415 714091 81335176\nmail-out 2814933 2711211 492510664 1407278 239776267 1303933 252734397\n```", "```\n   2 users     Load 0.24 0.28 0.27 (1-16 of 895)       Wed Apr 1 14:00:04 2015\n\nPR   D SRC                  DEST                 STATE    AGE   EXP  PKTS BYTES  RATE  PEAK   AVG RU G\nudp  O 192.168.103.1:56729  192.168.103.9:12345   1:0   8340m    25  372K  542M  1492  4774  1137  *\ntcp  I 10.168.103.15:47185  213.187.179.198:22    4:4   62377 86398  2954  613K 13264 23654    10  18\ntcp  I 10.168.103.15:2796   213.187.179.198:22    4:4   62368 86219  4014  679K     0     0    11  18\ntcp  I 10.168.103.15:15599  129.240.64.10:6667    4:4   61998 86375  9266  849K     0    58    14  *\ntcp  O 213.187.179.198:1559 129.240.64.10:6667    4:4   61998 86375  9266  849K     0    58    14  * 1\ntcp  I 10.168.103.15:8923   140.211.166.4:6667    4:4   61843 86385 15677 4794K     0   299    79  *\ntcp  O 213.187.179.198:8923 140.211.166.4:6667    4:4   61843 86385 15677 4794K     0   299    79  * 1\ntcp  I 10.168.103.15:47047  217.17.33.10:6667     4:4   61808 86385  7093  556K     0    88     9  *\ntcp  O 213.187.179.198:4704 217.17.33.10:6667     4:4   61808 86385  7093  556K     0    88     9  * 1\ntcp  I 10.168.103.15:30006  203.27.221.42:6667    4:4   61744 86375  6000  487K     0    49     8  *\ntcp  O 213.187.179.198:3000 203.27.221.42:6667    4:4   61744 86375  6000  487K     0    49     8  * 1\ntcp  I 10.168.103.15:31709  209.250.145.51:6667   4:4   61744 86385  6646  613K     0   114    10  *\ntcp  O 213.187.179.198:3170 209.250.145.51:6667   4:4   61744 86385  6646  613K     0   114    10  * 1\ntcp  I 192.168.103.254:5386 69.90.74.197:80       4:4   56718 29844    10  3282     0     0     0  *\ntcp  O 213.187.179.198:5386 69.90.74.197:80       4:4   56718 29844    10  3282     0     0     0  * 1\ntcp  I 10.168.103.15:33241  192.168.103.84:22     4:4   46916 82678  7555  897K     0     0    19  *\n```", "```\n2 users       Load 1.25 0.87 0.52  (1-16 of 239)        Fri Apr  3 14:01:59 2015\n\nRUL ANCHOR      A DIR L Q IF    PR   K   PKTS BYTES STATE MAX INFO\n  0             M In                      26M   12G 4946K     all max-mss 1440\n  1             M Out     nfe0          4853K 3162M 94858     inet from 10.0.0.0/8 to any queue(q_def\n  2             M Out     nfe0          3318K 2430M 61672     inet from 192.168.103.0/24 to any queue\n  3             M Out     nfe0  tcp     6404K 4341M  134K     from any to any port = www queue(q_web,\n  4             M Out     nfe0  tcp     84298   43M  1594     from any to any port = https queue(q_we\n  5             M Out     nfe0  tcp       502 34677    63     from any to any port = domain queue(q_d\n  6             M Out     nfe0  udp      512K   64M  257K     from any to any port = domain queue(q_d\n  7             M Out     nfe0  icmp       11  1008     3     all queue(q_dns, q_pri)\n  8             B Any L                 14638 1346K     0     return all\n  9             B Any  Q                   95  5628     0     return from <bruteforce> to any\n 10             P Any                   1139K 1005M   757     all flags any\n 11             P In   Q        tcp  K  18538 1350K   708     inet from any to any port = ftp\n 12             P Out           tcp  K      0     0     0     inet from 127.0.0.1/32 to any port = ftp\n 13             P Any                    1421  128K   134     all flags any\n 14             P In L    egres tcp  K  1830K   87M 18933     inet from any to any port = smtp queue\n 15             P In L    egres tcp  K     31  5240     2     from <nospamd> to any port = smtp\n```", "```\n2 users    Load 0.34 0.64 0.47  (1-16 of 51)        Fri Apr  3 14:04:04 2015\n\n         TYPE NAME                          VALUE       RATE NOTES\n           pf Status                      Enabled\n           pf Since                     139:05:08\n           pf Debug                           err\n           pf Hostid                   0x82aea702\n\n         nfe0 Bytes In                 6217042900            IPv4\n         nfe0 Bytes In                          0            IPv6\n         nfe0 Bytes Out                5993394114            IPv4\n         nfe0 Bytes Out                        64            IPv6\n         nfe0 Packets In                 12782504            IPv4, Passed\n         nfe0 Packets In                        0            IPv6, Passed\n         nfe0 Packets In                    11096            IPv4, Blocked\n         nfe0 Packets In                        0            IPv6, Blocked\n         nfe0 Packets Out                12551463            IPv4, Passed\n         nfe0 Packets Out                       1            IPv6, Passed\n         nfe0 Packets Out                     167            IPv4, Blocked\n```", "```\npfTop: Up State 1-17/771, View: default, Order: none, Cache: 10000                             14:05:42\n\nPR    DIR SRC                   DEST                           STATE            AGE   EXP   PKTS  BYTES\nudp   Out 192.168.103.1:56729   192.168.103.9:12345        SINGLE:NO_TRAFFIC  8346m    22   373K   543M\ntcp   In  10.168.103.15:47185   213.187.179.198:22    ESTABLISHED:ESTABLISHED 62715 86395   3232   667K\ntcp   In  10.168.103.15:2796    213.187.179.198:22    ESTABLISHED:ESTABLISHED 62706 86369   4071   686K\ntcp   In  10.168.103.15:15599   129.240.64.10:6667    ESTABLISHED:ESTABLISHED 62336 86379   9318   854K\ntcp   Out 213.187.179.198:15599 129.240.64.10:6667    ESTABLISHED:ESTABLISHED 62336 86379   9318   854K\ntcp   In  10.168.103.15:8923    140.211.166.4:6667    ESTABLISHED:ESTABLISHED 62181 86380  15755  4821K\ntcp   Out 213.187.179.198:8923  140.211.166.4:6667    ESTABLISHED:ESTABLISHED 62181 86380  15755  4821K\ntcp   In  10.168.103.15:47047   217.17.33.10:6667     ESTABLISHED:ESTABLISHED 62146 86379   7132   559K\ntcp   Out 213.187.179.198:47047 217.17.33.10:6667     ESTABLISHED:ESTABLISHED 62146 86379   7132   559K\ntcp   In  10.168.103.15:30006   203.27.221.42:6667    ESTABLISHED:ESTABLISHED 62082 86380   6034   489K\ntcp   Out 213.187.179.198:30006 203.27.221.42:6667    ESTABLISHED:ESTABLISHED 62082 86380   6034   489K\ntcp   In  10.168.103.15:31709   209.250.145.51:6667   ESTABLISHED:ESTABLISHED 62082 86379   6685   617K\ntcp   Out 213.187.179.198:31709 209.250.145.51:6667   ESTABLISHED:ESTABLISHED 62082 86379   6685   617K\ntcp   In  192.168.103.254:53863 69.90.74.197:80       ESTABLISHED:ESTABLISHED 57056 29506     10   3282\ntcp   Out 213.187.179.198:53863 69.90.74.197:80       ESTABLISHED:ESTABLISHED 57056 29506     10   3282\ntcp   In  10.168.103.15:33241   192.168.103.84:22     ESTABLISHED:ESTABLISHED 47254 82340   7555   897K\ntcp   Out 10.168.103.15:33241   192.168.103.84:22     ESTABLISHED:ESTABLISHED 47254 82340   7555   897K\n```", "```\ncollect 8 = global states inserts diff\ncollect 9 = global states removals diff\ncollect 10 = global states searches diff\n\nimage \"/var/www/users/peter/bsdly.net/pfstat-states.jpg\" {\n        from 1 days to now\n        width 980 height 300\n        left\n                graph 8 \"inserts\" \"states/s\" color 0 192 0 filled,\n                graph 9 \"removals\" \"states/s\" color 0 0 255\n        right\n                graph 10 \"searches\" \"states/s\" color 255 0 0\n}\n```", "```\nflowsrc 192.0.2.1 flowdst 192.0.2.105:3001\n```", "```\n$ **sudo ifconfig pflow0 create flowsrc 192.0.2.1 flowdst 192.0.2.105:3001**\n```", "```\npass out log inet proto tcp from <client> to port $email \\\n      label client-email keep state (pflow)\n```", "```\nset state-defaults pflow\n```", "```\nlogfile \"/var/log/flowd\"\nlisten on 192.0.2.105:3001\nflow source 192.0.2.1\nstore ALL\n```", "```\n$ **sudo flowd-reader /var/log/flowd**\nFLOW recv_time 2011-04-01T21:15:53.607179 proto 17 tcpflags 00 tos 00 agent\n[213.187.179.198] src [192.0.2.254]:55108 dst [192.0.2.1]:53 packets 1 octets\n62\nFLOW recv_time 2011-04-01T21:15:53.607179 proto 17 tcpflags 00 tos 00 agent\n[213.187.179.198] src [192.0.2.1]:53 dst [192.0.2.254]:55108 packets 1 octets\n129\n```", "```\nFLOW recv_time 2011-04-01T21:15:53.607179 proto 17 tcpflags 00 tos 00\nagent [213.187.179.198] src [192.0.2.254]:55108 dst [192.0.2.1]:53 gateway\n[0.0.0.0] packets 1 octets 62 in_if 0 out_if 0 sys_uptime_ms 1w5d19m59s.000\ntime_sec 2011-04-01T21:15:53 time_nanosec 103798508 netflow ver 5 flow_start\n1w5d19m24s.000 flow_finish 1w5d19m29s.000 src_AS 0 src_masklen 0 dst_AS 0\ndst_masklen 0 engine_type 10752 engine_id 10752 seq 5184351 source 0 crc32\n759adcbd\nFLOW recv_time 2011-04-01T21:15:53.607179 proto 17 tcpflags 00 tos 00\nagent [213.187.179.198] src [192.0.2.1]:53 dst [192.0.2.254]:55108 gateway\n[0.0.0.0] packets 1 octets 129 in_if 0 out_if 0 sys_uptime_ms 1w5d19m59s.000\ntime_sec 2011-04-01T21:15:53 time_nanosec 103798508 netflow ver 5 flow_start\n1w5d19m24s.000 flow_finish 1w5d19m29s.000 src_AS 0 src_masklen 0 dst_AS 0\ndst_masklen 0 engine_type 10752 engine_id 10752 seq 5184351 source 0 crc32\nf43cbb22\n```", "```\nlogfile \"/var/log/flowd.compact\"\nlisten on 192.0.2.105:3001\nflow source 192.0.2.1\nstore SRC_ADDR\nstore DST_ADDR\nstore SRCDST_PORT\nstore PACKETS\nstore OCTETS\ninternalnet = \"192.0.2.0/24\"\nunwired = \"10.168.103.0/24\"\ndiscard src $internalnet\ndiscard dst $internalnet\ndiscard src $unwired\ndiscard dst $unwired\n```", "```\n$ **sudo flowd-reader /var/log/flowd.compact | head**\nFLOW src [193.213.112.71]:38468 dst [192.0.2.1]:53 packets 1 octets 79\nFLOW src [192.0.2.1]:53 dst [193.213.112.71]:38468 packets 1 octets 126\nFLOW src [200.91.75.5]:33773 dst [192.0.2.1]:53 packets 1 octets 66\nFLOW src [192.0.2.1]:53 dst [200.91.75.5]:33773 packets 1 octets 245\nFLOW src [200.91.75.5]:3310 dst [192.0.2.1]:53 packets 1 octets 75\nFLOW src [192.0.2.1]:53 dst [200.91.75.5]:3310 packets 1 octets 199\nFLOW src [200.91.75.5]:2874 dst [192.0.2.1]:53 packets 1 octets 75\nFLOW src [192.0.2.1]:53 dst [200.91.75.5]:2874 packets 1 octets 122\nFLOW src [192.0.2.1]:15393 dst [158.37.91.134]:123 packets 1 octets 76\nFLOW src [158.37.91.134]:123 dst [192.0.2.1]:15393 packets 1 octets 76\n```", "```\n$ **sudo flowd-reader -v /var/log/flowd.compact | head**\nLOGFILE /var/log/flowd.compact\nFLOW src [193.213.112.71]:38468 dst [192.0.2.1]:53 packets 1 octets 79\nFLOW src [192.0.2.1]:53 dst [193.213.112.71]:38468 packets 1 octets 126\nFLOW src [200.91.75.5]:33773 dst [192.0.2.1]:53 packets 1 octets 66\nFLOW src [192.0.2.1]:53 dst [200.91.75.5]:33773 packets 1 octets 245\nFLOW src [200.91.75.5]:3310 dst [192.0.2.1]:53 packets 1 octets 75\nFLOW src [192.0.2.1]:53 dst [200.91.75.5]:3310 packets 1 octets 199\nFLOW src [200.91.75.5]:2874 dst [192.0.2.1]:53 packets 1 octets 75\nFLOW src [192.0.2.1]:53 dst [200.91.75.5]:2874 packets 1 octets 122\nFLOW src [192.0.2.1]:15393 dst [158.37.91.134]:123 packets 1 octets 76\n```", "```\nwebserver = 192.0.2.227\ndiscard all\naccept dst $webserver port 80 proto tcp\naccept src $webserver port 80 proto tcp\nstore RECV_TIME\nstore SRC_ADDR\nstore DST_ADDR\nstore PACKETS\nstore OCTETS\n```", "```\n$ **sudo flowd-reader -v -f towebserver.flowdfilter /var/log/flowd | tail**\nFLOW recv_time 2011-04-01T21:13:15.505524 src [89.250.115.174] dst\n[192.0.2.227] packets 6 octets 414\nFLOW recv_time 2011-04-01T21:13:15.505524 src [192.0.2.227] dst\n[89.250.115.174] packets 4 octets 725\nFLOW recv_time 2011-04-01T21:13:49.605833 src [216.99.96.53] dst [192.0.2.227]\npackets 141 octets 7481\nFLOW recv_time 2011-04-01T21:13:49.605833 src [192.0.2.227] dst [216.99.96.53]\npackets 212 octets 308264\nFLOW recv_time 2011-04-01T21:14:04.606002 src [91.121.94.14] dst [192.0.2.227]\npackets 125 octets 6634\nFLOW recv_time 2011-04-01T21:14:04.606002 src [192.0.2.227] dst [91.121.94.14]\npackets 213 octets 308316\nFLOW recv_time 2011-04-01T21:14:38.606384 src [207.46.199.44] dst\n[192.0.2.227] packets 10 octets 642\nFLOW recv_time 2011-04-01T21:14:38.606384 src [192.0.2.227] dst\n[207.46.199.44] packets 13 octets 16438\nFLOW recv_time 2011-04-01T21:15:14.606768 src [213.187.176.94] dst\n[192.0.2.227] packets 141 octets 7469\nFLOW recv_time 2011-04-01T21:15:14.606768 src [192.0.2.227] dst\n[213.187.176.94] packets 213 octets 308278\n```"]