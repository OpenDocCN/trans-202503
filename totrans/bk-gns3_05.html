<html><head></head><body><div class="chapter" title="Chapter&#xA0;5.&#xA0;Integrating Hosts and Using Wireshark"><div class="titlepage"><div><div><h1 class="title"><a id="integrating_hosts_and_using_wireshark"/>Chapter 5. Integrating Hosts and Using Wireshark</h1></div></div></div><p><a id="iddle1459" class="indexterm"/><a id="iddle1460" class="indexterm"/><a id="iddle1545" class="indexterm"/><a id="iddle1546" class="indexterm"/><a id="iddle1942" class="indexterm"/><a id="iddle1943" class="indexterm"/><a id="iddle2392" class="indexterm"/>Up to this point, you’ve learned how to create networks using Cisco devices, but GNS3 can do so much more! It uses a robust set of network tools that allow you to integrate external applications into your GNS3 projects. In this chapter, you’ll explore some of these tools by learning how to integrate PC hosts into projects using Virtual PC Simulator and VirtualBox. The chapter will also cover basic packet sniffing using Wireshark.</p><div class="sect1" title="Virtual PC Simulator"><div class="titlepage"><div><div><h1 class="title"><a id="virtual_pc_simulator"/>Virtual PC Simulator</h1></div></div></div><p>One way to add hosts to your projects is with VPCS, a small application that simulates up to nine DOS-like PCs. VPCS hosts have a limited set of commands but are well suited for testing end-to-end connectivity across your GNS3 networks. VPCS uses very few PC resources, which allows you to add numerous hosts to projects without bogging down your PC.</p><div class="sect2" title="Installing VPCS"><div class="titlepage"><div><div><h2 class="title"><a id="installing_vpcs"/>Installing VPCS</h2></div></div></div><p><a id="iddle1195" class="indexterm"/><a id="iddle1243" class="indexterm"/><a id="iddle1411" class="indexterm"/><a id="iddle1541" class="indexterm"/><a id="iddle1743" class="indexterm"/><a id="iddle2387" class="indexterm"/><a id="iddle2390" class="indexterm"/>If you’re running Windows or OS X, VPCS should have been included when you installed GNS3. If you’re using a Linux system, VPCS source code should have been included in your GNS3 for Linux download, but it will need to be compiled before you can use it. Compile and install it using the following commands, replacing <span class="emphasis"><em><code class="literal">x</code></em></span> with the version number of your VPCS source file:</p><a id="pro_id00019"/><pre class="programlisting">$ <span class="strong"><strong>unzip vpcs-x.zip</strong></span>
$ <span class="strong"><strong>cd vpcs-x/src</strong></span>
$ <span class="strong"><strong>sh mk.sh</strong></span>
$ <span class="strong"><strong>sudo cp vpcs /usr/local/bin/</strong></span></pre><p>To use VPCS, drag a VPCS host node from End Devices on the Devices toolbar to your workspace. Before you can start a VPCS host, it must be connected to another device in your project. After starting a VPCS host and opening a console, you’ll be presented with a window similar to <a class="xref" href="ch05.html#vpcs_console" title="Figure 5-1. The VPCS console">Figure 5-1</a>.</p><div class="figure"><a id="vpcs_console"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00038"/><img src="httpatomoreillycomsourcenostarchimages2208945.png.jpg" alt="The VPCS console"/></div></div><p class="title">Figure 5-1. The VPCS console</p></div><p>If you don’t see the VPCS console or if your application displays errors, verify that the program resides in <span class="emphasis"><em>/usr/local/bin/</em></span> (on Linux) and that the path has been set correctly in the GNS3 preferences. The developer provides very little in the way of support or documentation, so if you continue to have problems, you may want to visit the GNS3 forums (<span class="emphasis"><em><a class="ulink" href="http://community.gns3.com/">http://community.gns3.com/</a></em></span>) for a possible solution.</p></div><div class="sect2" title="VPCS Commands"><div class="titlepage"><div><div><h2 class="title"><a id="vpcs_commands"/>VPCS Commands</h2></div></div></div><p>The commands in VPCS are mostly self-explanatory, but I’ll cover a couple of them here to get you started. To see a full list of supported commands, you can enter a question mark, <code class="literal">?</code>. To display the configuration of your hosts, <a id="iddle1008" class="indexterm"/><a id="iddle1115" class="indexterm"/><a id="iddle1170" class="indexterm"/><a id="iddle1295" class="indexterm"/><a id="iddle1297" class="indexterm"/><a id="iddle1310" class="indexterm"/><a id="iddle1658" class="indexterm"/><a id="iddle1661" class="indexterm"/><a id="iddle1665" class="indexterm"/><a id="iddle1667" class="indexterm"/><a id="iddle1778" class="indexterm"/><a id="iddle2107" class="indexterm"/><a id="iddle2134" class="indexterm"/><a id="iddle2391" class="indexterm"/>you can enter the <code class="literal">show</code> command. To display the parameters for a specific command, enter the command name followed by a question mark. For example, entering <code class="literal">ping ?</code> would display all the options of the <code class="literal">ping</code> command.</p><div class="note" title="Note"><h3 class="title"><a id="ch05note01"/>Note</h3><p><span class="emphasis"><em>Like Cisco IOS, VPCS supports abbreviated command syntax. For example, the <code class="literal">ping</code> command can be entered as <code class="literal">p</code>. You can abbreviate any VPCS command, but you must enter enough letters of the command so that it’s unique from other commands that begin with the same letters.</em></span></p></div></div><div class="sect2" title="VPCS IP Addressing"><div class="titlepage"><div><div><h2 class="title"><a id="vpcs_ip_addressing"/>VPCS IP Addressing</h2></div></div></div><p>After launching VPCS, you need to configure the host for use with GNS3. Typically, this only requires setting the IP address, subnet mask, and gateway address.</p><p>VPCS supports IPv4 and IPv6 addressing. You can manually configure an IP address or acquire one automatically if a Dynamic Host Configuration Protocol (DHCP) server is running in your GNS3 project. To manually configure an IPv4 address, you would enter <span class="emphasis"><em><code class="literal">ip-address mask gateway</code></em></span>. The following example sets an IPv4 address to 192.168.1.50 using a subnet mask of 255.255.255.0 and sets the default gateway to 192.168.1.1:</p><a id="pro_id00020"/><pre class="programlisting">PC1&gt; <span class="strong"><strong>ip 192.168.1.50 255.255.255.0 192.168.1.1</strong></span></pre><p>You can enter the same IPv4 address using Classless Inter-Domain Routing (CIDR) notation in place of a standard subnet mask, as shown here:</p><a id="pro_id00021"/><pre class="programlisting">PC1&gt; <span class="strong"><strong>ip 192.168.1.50 /24 192.168.1.1</strong></span></pre><p>To manually configure an IPv6 address, enter the <code class="literal">ip</code> command followed by a valid IPv6 address and mask. The following example sets the IPv6 address to 2014:12:1a::50 using a 64-bit subnet mask:</p><a id="pro_id00022"/><pre class="programlisting">PC1&gt; <span class="strong"><strong>ip 2014:12:1a::50 /64</strong></span></pre><p>To configure a host automatically using DHCP, enter the <code class="literal">dhcp</code> command for each host that requires an address, as in this example:</p><a id="pro_id00023"/><pre class="programlisting">PC1&gt; <span class="strong"><strong>dhcp</strong></span></pre><p>Use the <code class="literal">save</code> command to save your VPCS settings with your GNS3 project.</p><a id="pro_id00024"/><pre class="programlisting">PC1&gt; <span class="strong"><strong>save</strong></span>
.  done</pre><p>The settings will be saved in the GNS3 projects folder under <span class="emphasis"><em>GNS3/projects/&lt;project_name&gt;/project-files/vpcs/&lt;vpcs_uuid&gt;</em></span>. Later, when you load your GNS3 project, the configuration settings will automatically be applied to the host.</p><p><a id="iddle1037" class="indexterm"/><a id="iddle1378" class="indexterm"/><a id="iddle1539" class="indexterm"/><a id="iddle1809" class="indexterm"/><a id="iddle1962" class="indexterm"/><a id="iddle2219" class="indexterm"/><a id="iddle2357" class="indexterm"/><a id="iddle2363" class="indexterm"/>To test VPCS, create a project using a VPCS host node and link it to some other device, like a router. Assign an IP address to your VPCS host and the other device, and then use <code class="literal">ping</code> or <code class="literal">trace</code> to test connectivity. If all goes well, you should receive a reply like the one in this example:</p><a id="pro_id00025"/><pre class="programlisting">PC1&gt; <span class="strong"><strong>ping 192.168.1.1</strong></span>
192.168.1.1 icmp_seq=1 ttl=255 time=35.821 ms</pre><p>After successfully pinging devices, you can examine the ARP cache (MAC address to IP table) using the <code class="literal">arp</code> command, as in the following:</p><a id="pro_id00026"/><pre class="programlisting">PC1&gt; <span class="strong"><strong>arp</strong></span>
cc:00:05:a9:00:00 192.168.1.1 expires in 114 seconds</pre><p>If a ping is unsuccessful, VPCS displays a “host not reachable” message:</p><a id="pro_id00027"/><pre class="programlisting">PC1&gt; <span class="strong"><strong>ping 192.168.1.1</strong></span>
host (192.168.1.1) not reachable</pre><p>You can troubleshoot this by verifying that your router interfaces are up in GNS3 and checking that all the IP addresses and subnet masks have been correctly assigned.</p><p>Another cause may be your PC’s firewall settings, especially if you’re using a Windows PC. In general, disabling your firewall entirely while working with GNS3 is a good idea and might resolve this and other issues.</p></div></div><div class="sect1" title="VirtualBox"><div class="titlepage"><div><div><h1 class="title"><a id="virtualbox"/>VirtualBox</h1></div></div></div><p>VPCS is a great tool for adding simple hosts to GNS3 and testing connectivity, but sometimes you need a host that’s running a real operating system rather than a simulated one. This is where VirtualBox comes in. VirtualBox can run most PC-based operating systems, including Windows, Linux, FreeBSD, and others. It’s also useful for running network operating systems such as Arista vEOS, Juniper Firefly, and NX-OSv.</p><p>The upside to using VirtualBox is that it provides you with hosts running actual operating systems; the downside is that those operating systems may need substantial resources from your PC. If all you need to do is test connectivity, then stick with VPCS, but if you need a host that provides a robust set of network utilities (to test the security of your GNS3 network, for example) or to run some other router or switch OS, then you might want to use VirtualBox.</p><div class="sect2" title="Installing on Windows"><div class="titlepage"><div><div><h2 class="title"><a id="installing_on_windows"/>Installing on Windows</h2></div></div></div><p>To install VirtualBox on Windows, download the appropriate installer from the VirtualBox website (<span class="emphasis"><em><a class="ulink" href="http://www.virtualbox.org/">http://www.virtualbox.org/</a></em></span>). Launch the installer and click <span class="strong"><strong>Next</strong></span> when you see the Welcome screen to bring up a customization <a id="iddle1032" class="indexterm"/><a id="iddle1035" class="indexterm"/><a id="iddle1508" class="indexterm"/><a id="iddle1742" class="indexterm"/><a id="iddle1903" class="indexterm"/><a id="iddle1919" class="indexterm"/><a id="iddle1928" class="indexterm"/><a id="iddle2355" class="indexterm"/><a id="iddle2367" class="indexterm"/>window. Make any desired customizations here and follow the onscreen instructions to complete the installation. I recommend accepting the default values to ensure that VirtualBox runs correctly with GNS3.</p><p>After the installation completes, you can launch the application by using the Windows Start menu or by clicking the VirtualBox icon.</p></div><div class="sect2" title="Installing on OS X"><div class="titlepage"><div><div><h2 class="title"><a id="installing_on_os_x-id00010"/>Installing on OS X</h2></div></div></div><p>To install VirtualBox on OS X, download the appropriate installer from the VirtualBox website (<span class="emphasis"><em><a class="ulink" href="http://www.virtualbox.org/">http://www.virtualbox.org/</a></em></span>) and launch it. When the VirtualBox installation screen appears, double-click the <span class="strong"><strong>VirtualBox.pkg</strong></span> icon and follow the onscreen instructions. The installation requires elevated privileges, so have your administrator password handy. Once the package is installed, you can launch it from your <span class="emphasis"><em>Applications</em></span> folder by double-clicking the VirtualBox icon.</p></div><div class="sect2" title="Installing on Linux"><div class="titlepage"><div><div><h2 class="title"><a id="installing_on_linux"/>Installing on Linux</h2></div></div></div><p>VirtualBox is supported on most Linux distributions, but check your Linux package manager to verify that it’s supported on your specific platform. On Ubuntu and most other Debian-based Linux systems, use the <code class="literal">apt-get</code> utility to update your package manager and install the latest version of VirtualBox. Be sure that you have Internet access and enter the following from a terminal window:</p><a id="pro_id00028"/><pre class="programlisting">$ <span class="strong"><strong>sudo apt-get update</strong></span>
$ <span class="strong"><strong>sudo apt-get install virtualbox</strong></span></pre><p>Once the utility is installed, you can launch it either by opening a terminal window and entering <code class="literal">virtualbox</code> or by launching it from your Linux window manager.</p></div><div class="sect2" title="Importing Appliances"><div class="titlepage"><div><div><h2 class="title"><a id="importing_appliances"/>Importing Appliances</h2></div></div></div><p>A VirtualBox <span class="emphasis"><em>appliance</em></span> is a preconfigured virtual machine, often running a custom Linux distribution, that you can use in your GNS3 projects. Using a real operating system gives you more commands and greater flexibility than using a simulator like VPCS. You can download preconfigured VirtualBox appliances from the GNS3 website under the Download section.</p><p>Appliances need to be imported into VirtualBox before you can use them. Appliance package names end in <span class="emphasis"><em>.ova</em></span>, which stands for <span class="emphasis"><em>Open Virtual Appliance</em></span>, and are often referred to as <a class="firstterm" href="apd.html#gloss01_047"><em class="firstterm">OVA</em></a> files. To import an appliance, launch VirtualBox, and you’ll be presented with the VirtualBox Manager window. From the VirtualBox Manager, you can import or create new virtual machine guests and manage all of your installed guest operating systems. Importing an appliance is a fast and easy way to add a guest because the configuration and installation of the operating system has already been done for you.</p><p><a id="iddle2293" class="indexterm"/><a id="iddle2364" class="indexterm"/><a id="iddle2368" class="indexterm"/><a id="iddle2369" class="indexterm"/>The appliances found on the GNS3 website are often optimized to use fewer PC resources than a standard installation of the same operating system. Unfortunately, this means your appliance might not have all the commands or tools you need, but you should be able to update or install additional software through its software package manager.</p><p>In <a class="xref" href="ch05.html#virtualbox_manager_showing_an_imported_l" title="Figure 5-2. VirtualBox Manager showing an imported Linux guest OS">Figure 5-2</a>, you can see that VirtualBox has been configured with one guest (Linux Microcore).</p><div class="figure"><a id="virtualbox_manager_showing_an_imported_l"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00039"/><img src="httpatomoreillycomsourcenostarchimages2208947.png.jpg" alt="VirtualBox Manager showing an imported Linux guest OS"/></div></div><p class="title">Figure 5-2. VirtualBox Manager showing an imported Linux guest OS</p></div><p>Selecting the guest OS displays basic information about the guest’s configuration, such as the base memory and how much disk space has been assigned to the virtual machine. To modify the settings of a virtual machine, highlight the guest and click <span class="strong"><strong>Settings</strong></span> in the toolbar. Just like real PCs, virtual PC guests often run better when given more resources, such as memory or additional CPU cores.</p><p>To import a VirtualBox guest appliance, download an image file and copy it to a folder in your user directory. Launch VirtualBox and select <span class="strong"><strong>File</strong></span> ▸ <span class="strong"><strong>Import Appliance</strong></span>; then click <span class="strong"><strong>Open Appliance</strong></span> and browse to the location where you saved the file. Select the image file and click <span class="strong"><strong>Continue</strong></span> followed by <span class="strong"><strong>Import</strong></span> to complete the process. To test your VirtualBox guest, click <span class="strong"><strong>Start</strong></span>, and your OS should boot up and run like a normal PC.</p><p>After testing your newly imported OS, you’re ready to configure the GNS3 VirtualBox preferences.</p></div><div class="sect2" title="VirtualBox Preferences"><div class="titlepage"><div><div><h2 class="title"><a id="virtualbox_preferences"/>VirtualBox Preferences</h2></div></div></div><p>To manage VirtualBox guests, GNS3 uses the VBoxManage application. This program is automatically installed when you install VirtualBox. Before <a id="iddle1406" class="indexterm"/><a id="iddle2258" class="indexterm"/><a id="iddle2339" class="indexterm"/><a id="iddle2365" class="indexterm"/><a id="iddle2366" class="indexterm"/>adding a VirtualBox guest to GNS3, verify the path to VBoxManage. Launch GNS3, select <span class="strong"><strong>GNS3</strong></span> ▸ <span class="strong"><strong>Preferences</strong></span> on OS X or <span class="strong"><strong>Edit</strong></span> ▸ <span class="strong"><strong>Preferences</strong></span> on Windows and Linux, and then click <span class="strong"><strong>VirtualBox</strong></span> to reach the window shown in <a class="xref" href="ch05.html#virtualbox_general_settings_tab" title="Figure 5-3. VirtualBox General Settings tab">Figure 5-3</a>.</p><div class="figure"><a id="virtualbox_general_settings_tab"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00040"/><img src="httpatomoreillycomsourcenostarchimages2208949.png.jpg" alt="VirtualBox General Settings tab"/></div></div><p class="title">Figure 5-3. VirtualBox General Settings tab</p></div><p>On Ubuntu Linux, the path on the General Settings tab should be set to <span class="emphasis"><em>/usr/bin/vboxmanage</em></span>. Adjust the path as necessary and then click <span class="strong"><strong>Apply</strong></span> and <span class="strong"><strong>OK</strong></span>. On Windows and OS X, the VBoxManage path shouldn’t need to be changed.</p><p>Unchecking <span class="strong"><strong>Use the local server</strong></span> will allow you to choose a local or remote GNS3 server when creating a VirtualBox host. Leaving the box checked ensures that VirtualBox guest will always run locally on your PC.</p><p>If you experience problems while starting a VirtualBox host or opening a console connection to a host, one or more of the default console port numbers may already be in use by another application running on your PC. To fix this, try closing the offending application or disabling your PC firewall. Another possible cause might be that the VirtualBox guest you’re using isn’t configured to accept console connections.</p></div><div class="sect2" title="VirtualBox Virtual Machine Settings"><div class="titlepage"><div><div><h2 class="title"><a id="virtualbox_virtual_machine_settings"/>VirtualBox Virtual Machine Settings</h2></div></div></div><p>After configuring (or at least reviewing) the VirtualBox preferences in GNS3, you need to set up one or more VirtualBox hosts to use in your projects. <a id="iddle1863" class="indexterm"/>Begin by selecting <span class="strong"><strong>VirtualBox VM</strong></span> from the left pane. Click <span class="strong"><strong>New</strong></span> and select your VirtualBox virtual machine from the VM list drop-down menu, as shown in <a class="xref" href="ch05.html#new_virtualbox_vm_screen" title="Figure 5-4. New VirtualBox VM screen">Figure 5-4</a>.</p><div class="figure"><a id="new_virtualbox_vm_screen"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00041"/><img src="httpatomoreillycomsourcenostarchimages2208951.png.jpg" alt="New VirtualBox VM screen"/></div></div><p class="title">Figure 5-4. New VirtualBox VM screen</p></div><p>Click <span class="strong"><strong>Finish</strong></span> to complete the installation. You should see the currently assigned settings for the virtual machine, as shown in <a class="xref" href="ch05.html#virtualbox_vms_preferences" title="Figure 5-5. VirtualBox VMs preferences">Figure 5-5</a>.</p><div class="figure"><a id="virtualbox_vms_preferences"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00042"/><img src="httpatomoreillycomsourcenostarchimages2208953.png.jpg" alt="VirtualBox VMs preferences"/></div></div><p class="title">Figure 5-5. VirtualBox VMs preferences</p></div><p><a id="iddle1180" class="indexterm"/><a id="iddle1292" class="indexterm"/><a id="iddle1344" class="indexterm"/><a id="iddle1850" class="indexterm"/><a id="iddle1998" class="indexterm"/><a id="iddle2159" class="indexterm"/><a id="iddle2231" class="indexterm"/><a id="iddle2348" class="indexterm"/><a id="iddle2354" class="indexterm"/>By default your virtual machine device can be found under End Devices in the Devices toolbar. By right-clicking the virtual machine icon in the Preferences window (Linux Microcore in this example), you can assign a different icon to the virtual machine and choose where it will reside in the Devices toolbar. This allows you to better organize all your GNS3 devices.</p><p>To modify the settings of a virtual machine, select the virtual machine and click <span class="strong"><strong>Edit</strong></span>. In most cases you’ll want to go to the General settings tab and select the <span class="strong"><strong>Enable remote console</strong></span> and <span class="strong"><strong>Start VM in headless mode</strong></span> boxes, as shown in <a class="xref" href="ch05.html#virtualbox_vm_configurationapostrophes_g" title="Figure 5-6. VirtualBox VM configuration’s General settings tab">Figure 5-6</a>. The first option allows you to access the console of a running virtual machine from GNS3’s assigned terminal application; the second option suppresses VirtualBox from opening a console window when you start a virtual machine in GNS3.</p><div class="figure"><a id="virtualbox_vm_configurationapostrophes_g"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00043"/><img src="httpatomoreillycomsourcenostarchimages2208955.png.jpg" alt="VirtualBox VM configuration’s General settings tab"/></div></div><p class="title">Figure 5-6. VirtualBox VM configuration’s General settings tab</p></div><p>To modify network settings, click the <span class="strong"><strong>Network</strong></span> tab. You can change the number of adapters installed in the virtual machine, the starting adapter number (usually 0 or 1), and the type of adapter installed in the virtual machine. When you’re finished, click <span class="strong"><strong>Apply</strong></span> and <span class="strong"><strong>OK</strong></span> to save the modifications.</p><p>After you have configured a virtual machine guest operating system, you can use it in your GNS3 projects.</p></div><div class="sect2" title="Using VirtualBox Hosts in a Project"><div class="titlepage"><div><div><h2 class="title"><a id="using_virtualbox_hosts_in_a_project"/>Using VirtualBox Hosts in a Project</h2></div></div></div><p>To add a VirtualBox host to a project, drag a VirtualBox host node icon from the End Devices window to your GNS3 workspace.</p><p>A VirtualBox host can be used only one time per GNS3 project. If you want to use a particular VirtualBox host more than once, launch VirtualBox and use the Clone feature to create a cloned copy of the virtual machine.</p><p><a id="iddle1022" class="indexterm"/><a id="iddle1288" class="indexterm"/><a id="iddle1487" class="indexterm"/><a id="iddle1647" class="indexterm"/><a id="iddle1659" class="indexterm"/><a id="iddle1722" class="indexterm"/><a id="iddle1731" class="indexterm"/><a id="iddle1802" class="indexterm"/><a id="iddle2064" class="indexterm"/><a id="iddle2205" class="indexterm"/><a id="iddle2237" class="indexterm"/><a id="iddle2360" class="indexterm"/>Then, launch GNS3 and follow the same steps outlined earlier to configure the cloned host under VirtualBox Preferences. The next time you add a VirtualBox host node to your workspace, the cloned OS will be available.</p><p>After a VirtualBox host node has been added to your workspace, you’re ready to link it to other GNS3 devices.</p></div><div class="sect2" title="Linking VirtualBox Host Nodes to Other Devices"><div class="titlepage"><div><div><h2 class="title"><a id="linking_virtualbox_host_nodes_to_other_d"/>Linking VirtualBox Host Nodes to Other Devices</h2></div></div></div><p>To add a link between a VirtualBox host node and another device, click the <span class="strong"><strong>Add a Link</strong></span> toolbar icon; then click your VirtualBox host node and choose an interface to use for the link. Select another device and choose an interface to complete the connection.</p><p>To boot the host, right-click the VirtualBox host node icon and select <span class="strong"><strong>Start</strong></span>. Test the connection by configuring an IP address on your VirtualBox host and the device to which it’s linked; then use the <code class="literal">ping</code> command to verify connectivity.</p><p>On most Linux systems, like Microcore, you can manually configure an IP address and default gateway using the <code class="literal">ifconfig</code> and <code class="literal">route</code> commands. To see a list of available network interface cards (NICs) in Linux, use the <code class="literal">ifconfig</code> command without any configuration options.</p><a id="pro_id00029"/><pre class="programlisting">$ <span class="strong"><strong>ifconfig</strong></span>

eth0      Link encap:Ethernet HWaddr 08:00:27:7F:91:0A
          UP BROADCAST MULTICAST MTU:1500 Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:0 (0.0 B) TX bytes:0 (0.0 B)
          Interrupt:10 Base address:0xd020

eth1      Link encap:Ethernet HWaddr 08:00:27:C5:FC:66
          UP BROADCAST MULTICAST MTU:1500 Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:0 (0.0 B) TX bytes:0 (0.0 B)
          Interrupt:9 Base address:0xd060</pre><div class="note" title="Note"><h3 class="title"><a id="ch05note02"/>Note</h3><p><span class="emphasis"><em>Not all Linux systems use the <code class="literal">ifconfig</code> or <code class="literal">route</code> command to configure TCP/IP, but most do. If these commands aren’t available with your distribution, check your Linux documentation to see how to configure an interface.</em></span></p></div><p>If you’re using a Windows PC virtual machine, you can manually configure an IP address by opening the Network and Sharing Center and clicking <span class="strong"><strong>Change Adapter Settings</strong></span>. Right-click the adapter you want to configure and select <span class="strong"><strong>Properties</strong></span> to modify the TCP/IP settings, as shown in <a class="xref" href="ch05.html#windows_tcpsolidusip_interface_propertie" title="Figure 5-7. Windows TCP/IP interface properties">Figure 5-7</a>.</p><div class="figure"><a id="windows_tcpsolidusip_interface_propertie"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00044"/><img src="httpatomoreillycomsourcenostarchimages2208957.png.jpg" alt="Windows TCP/IP interface properties"/></div></div><p class="title">Figure 5-7. Windows TCP/IP interface properties</p></div><p><a id="iddle1323" class="indexterm"/><a id="iddle1592" class="indexterm"/><a id="iddle1754" class="indexterm"/><a id="iddle1999" class="indexterm"/><a id="iddle2361" class="indexterm"/>Enter your IP address information and click <span class="strong"><strong>OK</strong></span> when finished. If you have a DHCP server configured in your GNS3 project, you can leave the fields blank and choose <span class="strong"><strong>Obtain an IP address automatically</strong></span> instead.</p></div><div class="sect2" title="Simple VirtualBox Project Using a Linux Virtual Machine"><div class="titlepage"><div><div><h2 class="title"><a id="simple_virtualbox_project_using_a_linux"/>Simple VirtualBox Project Using a Linux Virtual Machine</h2></div></div></div><p>Now that you’ve added a Linux VirtualBox virtual machine to GNS3, let’s create a simple project that networks the host to a Cisco IOS router. Begin by creating the project in <a class="xref" href="ch05.html#virtualbox_host_and_cisco_ios_router_pro" title="Figure 5-8. VirtualBox host and Cisco IOS router project">Figure 5-8</a>. Drag a VirtualBox Linux host and Dynamips router to your workspace and link them together using an Ethernet switch node.</p><div class="figure"><a id="virtualbox_host_and_cisco_ios_router_pro"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00045"/><img src="httpatomoreillycomsourcenostarchimages2208959.png.jpg" alt="VirtualBox host and Cisco IOS router project"/></div></div><p class="title">Figure 5-8. VirtualBox host and Cisco IOS router project</p></div><p><a id="iddle1542" class="indexterm"/><a id="iddle1810" class="indexterm"/><a id="iddle1935" class="indexterm"/><a id="iddle2412" class="indexterm"/><a id="iddle2414" class="indexterm"/>Start the devices and begin configuring your project by assigning an IP address to interface eth0 of the VirtualBox Linux host. Right-click the Linux Microcore node and select <span class="strong"><strong>Console</strong></span> to open the terminal. From the Linux terminal shell, enter the following command to assign the IP address:</p><a id="pro_id00030"/><pre class="programlisting">$ <span class="strong"><strong>sudo ifconfig eth0 10.1.1.1 netmask 255.255.255.0 up</strong></span></pre><p>Next, open a console to router R1, assign an IP address to interface f0/0, and bring up the interface.</p><a id="pro_id00031"/><pre class="programlisting">R1# <span class="strong"><strong>configure-terminal</strong></span>
R1(config)# <span class="strong"><strong>interface f0/0</strong></span>
R1(config-if)# <span class="strong"><strong>ip address 10.1.1.2 255.255.255.0</strong></span>
R1(config-if)# <span class="strong"><strong>no shutdown</strong></span>
R1(config-if)# <span class="strong"><strong>exit</strong></span>
R1(config)# <span class="strong"><strong>exit</strong></span>
R1#</pre><p>Finally, test connectivity by pinging your Linux host’s IP address from router R1.</p><a id="pro_id00032"/><pre class="programlisting">R1# <span class="strong"><strong>ping 10.1.1.1</strong></span>

Type escape sequence to abort.
Sending 5, 100-byte ICMP Echos to 10.1.1.1, timeout is 2 seconds:
!!!!!
Success rate is 100 percent (5/5), round-trip min/avg/max = 8/16/32 ms</pre><p>Now let’s take a look at how you can use Wireshark to analyze packets on your GNS3 networks.</p></div></div><div class="sect1" title="Wireshark"><div class="titlepage"><div><div><h1 class="title"><a id="wireshark"/>Wireshark</h1></div></div></div><p>Wireshark is one of the most robust packet analysis tools available to network engineers, and it’s free! A <span class="emphasis"><em>packet analyzer</em></span>, sometimes called a <span class="emphasis"><em>packet sniffer</em></span>, is software that allows you to capture IP packets as they traverse your network. You can then open the packets to reveal and analyze their contents. Packet sniffers like Wireshark are used to troubleshoot networking protocols, thwart hackers, and even identify viruses, but they are often overlooked by beginners. If you’re an aspiring networking engineer, using GNS3 and Wireshark together is an excellent way to learn the ins and outs of networking and how network protocols work.</p><div class="sect2" title="Installing on Windows"><div class="titlepage"><div><div><h2 class="title"><a id="installing_on_windows-id00011"/>Installing on Windows</h2></div></div></div><p>If you installed GNS3 using the Windows all-in-one installer, then Wireshark should already be installed. If you’re using OS X or Linux, then you need to download and install Wireshark manually.</p></div><div class="sect2" title="Installing on OS X"><div class="titlepage"><div><div><h2 class="title"><a id="installing_on_os_x-id00012"/>Installing on OS X</h2></div></div></div><p><a id="iddle1083" class="indexterm"/><a id="iddle1744" class="indexterm"/><a id="iddle1920" class="indexterm"/><a id="iddle2277" class="indexterm"/><a id="iddle2411" class="indexterm"/><a id="iddle2423" class="indexterm"/>Before installing Wireshark on OS X, you need to install XQuartz, an OS X version of the X Window System that’s similar to X.Org on Linux systems.</p><p>Download the appropriate version of XQuartz from the Mac OS Forge website (<span class="emphasis"><em><a class="ulink" href="http://xquartz.macosforge.org/">http://xquartz.macosforge.org/</a></em></span>). Double-click the installer and then click the <span class="emphasis"><em>XQuartz.dmg</em></span> installer package. Click <span class="strong"><strong>Continue</strong></span> until you reach the welcome screen, and then click <span class="strong"><strong>I Agree</strong></span> and <span class="strong"><strong>Install</strong></span> to complete the installation.</p><p>Next, download and install Wireshark from the developer website (<span class="emphasis"><em><a class="ulink" href="http://www.wireshark.org/">http://www.wireshark.org/</a></em></span>). Double-click the downloaded file, followed by the <span class="emphasis"><em>wireshark.dmg</em></span> installer package. At the welcome screen, click <span class="strong"><strong>Continue, I Agree</strong></span>, and <span class="strong"><strong>Install</strong></span> to complete the installation.</p><p>The first time you launch Wireshark, OS X will ask for the location of the X Window program. From the File window, click <span class="strong"><strong>Browse</strong></span>, navigate to the <span class="emphasis"><em>Applications/Utilities</em></span> folder, and then select <span class="strong"><strong>XQuartz</strong></span>.</p><div class="note" title="Note"><h3 class="title"><a id="ch05note03"/>Note</h3><p><span class="emphasis"><em>The first time you launch Wireshark, XQuartz opens an Xterm window but not Wireshark. This strange quirk is easily corrected by closing XQuartz and relaunching Wireshark. It may take a moment to open, but this is normal. When the application starts, you should see the Wireshark welcome screen.</em></span></p></div><p>Now that Wireshark is installed, let’s look at how to capture packets from devices in your projects.</p></div><div class="sect2" title="Installing on Linux"><div class="titlepage"><div><div><h2 class="title"><a id="installing_on_linux-id00013"/>Installing on Linux</h2></div></div></div><p>To install the latest version of Wireshark using the Advanced Package Tools on Ubuntu Linux, open a terminal program and enter the following commands:</p><a id="pro_id00033"/><pre class="programlisting">$ <span class="strong"><strong>sudo apt-get update</strong></span>
$ <span class="strong"><strong>sudo apt-get install wireshark</strong></span></pre><p>Confirm the installation when prompted, and the package will be installed. After the process has completed, Wireshark should be ready to use.</p></div><div class="sect2" title="Capturing Packets in GNS3"><div class="titlepage"><div><div><h2 class="title"><a id="capturing_packets_in_gns3"/>Capturing Packets in GNS3</h2></div></div></div><p>To begin capturing packets, right-click a link between two devices and select <span class="strong"><strong>Start Capture</strong></span>, as shown in <a class="xref" href="ch05.html#start_capturing_packets" title="Figure 5-9. Start capturing packets.">Figure 5-9</a>. (To stop a capture, right-click the same link and select <span class="strong"><strong>Stop Capture</strong></span>.)</p><div class="figure"><a id="start_capturing_packets"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00046"/><img src="httpatomoreillycomsourcenostarchimages2208961.png.jpg" alt="Start capturing packets."/></div></div><p class="title">Figure 5-9. Start capturing packets.</p></div><p><a id="iddle1356" class="indexterm"/><a id="iddle2121" class="indexterm"/>GNS3 prompts you for the source device, the interface name, and the encapsulation type to use for capturing data. You can capture data on Ethernet and serial interfaces. On Ethernet connections, you can choose only Ethernet encapsulation: DLT_EN10MB, but on serial connections, you can choose Cisco HDLC encapsulation: DLT_C_HDLC, Cisco PPP encapsulation: DLT PPP_SERIAL, or Frame Relay encapsulation: DLT_FRELAY.</p><p>To capture standard Cisco serial data (High-Level DataLink Control), choose <span class="strong"><strong>HDLC</strong></span>; to capture serial Point-to-Point Protocol data, choose <span class="strong"><strong>PPP</strong></span>; and to capture Frame-Relay data, select <span class="strong"><strong>FRELAY</strong></span>. Use the drop-down menu to make your selection, as shown in <a class="xref" href="ch05.html#source_selection_for_capturing_serial_pa" title="Figure 5-10. Source selection for capturing serial packets">Figure 5-10</a>.</p><div class="figure"><a id="source_selection_for_capturing_serial_pa"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00047"/><img src="httpatomoreillycomsourcenostarchimages2208963.png.jpg" alt="Source selection for capturing serial packets"/></div></div><p class="title">Figure 5-10. Source selection for capturing serial packets</p></div><p>After making a selection and clicking <span class="strong"><strong>OK</strong></span>, GNS3 will open Wireshark and begin capturing packets, as shown in <a class="xref" href="ch05.html#simple_wireshark_capture_from_gns3" title="Figure 5-11. Simple Wireshark capture from GNS3">Figure 5-11</a>. Notice that the Wireshark window is divided into three distinct panes.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p title="Packet List pane"><span class="title"><strong><span class="strong"><strong>➊ Packet List pane</strong></span></strong></span> The top pane of the window is dedicated to displaying individual packets as they’re being captured. Packet fields are displayed across the top and include the packet sequence number (No.), timestamp (Time), source IP address (Source), destination IP address (Destination), protocol name (Protocol), frame length size (Length), and information field (Info). Packets containing different protocol types are displayed in different colors to help identify them.</p></li><li class="listitem"><p title="Packet Details pane"><span class="title"><strong><span class="strong"><strong>➋ Packet Details pane</strong></span></strong></span> After a packet is selected from the packet list, details about the protocols and protocol fields of the packet are displayed in the middle pane. You can expand and collapse the fields to show or hide their details. The displayed field names are specific to the type of packet being captured and will change from one packet type to another.</p></li><li class="listitem"><p title="Packet Bytes pane"><span class="title"><strong><span class="strong"><strong>➌ Packet Bytes pane</strong></span></strong></span> The lower pane of the main window displays the raw data in hexadecimal format, with ASCII characters displayed to the right. This is what the data looks like natively as it crosses the network. Wireshark allows you to view this information in either hexadecimal or binary.</p></li></ul></div><div class="figure"><a id="simple_wireshark_capture_from_gns3"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00048"/><img src="httpatomoreillycomsourcenostarchimages2208965.png.jpg" alt="Simple Wireshark capture from GNS3"/></div></div><p class="title">Figure 5-11. Simple Wireshark capture from GNS3</p></div><p><a id="iddle2416" class="indexterm"/><a id="iddle2418" class="indexterm"/><a id="iddle2419" class="indexterm"/>If you don’t see any packets displayed in the packet list, close Wireshark and stop the capture. Be sure your router interfaces are up and have been assigned IP addresses and then restart a capture and start Wireshark again.</p><div class="note" title="Note"><h3 class="title"><a id="ch05note04"/>Note</h3><p><span class="emphasis"><em>To learn more about using Wireshark, I highly recommend reading</em></span> Practical Packet Analysis, 2nd Edition <span class="emphasis"><em>by Chris Sanders (No Starch Press, 2011). You could even become a Wireshark Certified Network Analyst (WCNA).</em></span></p></div><p>To change the default behavior of Wireshark in GNS3, go to <span class="strong"><strong>Preferences</strong></span> and select <span class="strong"><strong>Packet Capture</strong></span>. To prevent GNS3 from automatically starting Wireshark when you capture packets, uncheck <span class="strong"><strong>Automatically start the packet capture application</strong></span>, as shown in <a class="xref" href="ch05.html#wireshark_capture_preferences" title="Figure 5-12. Wireshark capture preferences">Figure 5-12</a>.</p><p>You have the option to save packet captures and analyze them later. To do so, select <span class="strong"><strong>Wireshark Traditional Capture</strong></span> from the drop-down menu (under Preconfigured packet capture reader commands) and then click <span class="strong"><strong>Set, Apply</strong></span>, and <span class="strong"><strong>OK</strong></span>. Now when GNS3 captures data, it will automatically save the captured files in a directory named <span class="emphasis"><em>captures</em></span> within your project folder, as in <span class="emphasis"><em>GNS3/projects/&lt;project_name&gt;/project-files/captures/</em></span>.</p><p>To review saved packet captures, launch Wireshark on your PC, select <span class="strong"><strong>File</strong></span> ▸ <span class="strong"><strong>Open</strong></span>, browse to the <span class="emphasis"><em>captures</em></span> folder, and select a capture file. The <span class="emphasis"><em>.pcap</em></span> capture files will be named after the GNS3 devices involved in the capture, as in <span class="emphasis"><em>R1_FastEthernet0-0_to_R2_FastEthernet0-0.pcap</em></span>.</p><div class="figure"><a id="wireshark_capture_preferences"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00049"/><img src="httpatomoreillycomsourcenostarchimages2208967.png.jpg" alt="Wireshark capture preferences"/></div></div><p class="title">Figure 5-12. Wireshark capture preferences</p></div><p><a id="iddle2109" class="indexterm"/><a id="iddle2415" class="indexterm"/><a id="iddle2417" class="indexterm"/>To learn more about Wireshark, check out the online User’s Guide (<span class="emphasis"><em><a class="ulink" href="http://www.wireshark.org/docs/wsug_html_chunked/">http://www.wireshark.org/docs/wsug_html_chunked/</a></em></span>). It’s well organized and provides a lot of information about using the software.</p></div></div><div class="sect1" title="Final Thoughts"><div class="titlepage"><div><div><h1 class="title"><a id="final_thoughts-id00014"/>Final Thoughts</h1></div></div></div><p>One key aspect of GNS3 is its modular design and ability to expand projects using other open source software. Using VPCS, you can add a large number of simple PC hosts, and with VirtualBox you can run hosts using full-blown operating systems such as Linux. This feature makes GNS3 very expandable because any network operating system that runs in VirtualBox can be added to your GNS3 projects.</p><p>Wireshark is one of the most underutilized tools around, but it’s also one of the most powerful. With Wireshark, you can dig deep and really see what’s happening on your networks. Whether you’re new to networking or already network certified, breaking out Wireshark and examining packets is a great way to hone your skills and increase your understanding of network protocols.</p><p>In <a class="xref" href="ch06.html" title="Chapter 6. Juniper Olive and VSRX Firefly">Chapter 6</a>, you’ll look at Quick Emulator, another open source PC emulator, and use it to create a special PC version of Juniper’s Junos OS known as Juniper Olive. Juniper Olive allows you to add fully functional Juniper routers to your GNS3 projects.</p></div></div></body></html>