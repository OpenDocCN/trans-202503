<html><head></head><body>
<h2 class="h2" id="ch08"><span epub:type="pagebreak" id="page_220"/><span class="num">8</span> Drawbot, The Robotic Artist</h2>&#13;
<p class="noindent1"><span epub:type="pagebreak" id="page_221"/><span class="red">As an homage to the Logo turtle project, in this project we’re going to make a Drawbot: a robot that you can program to move and draw. Logo was a programming language created in the late 1960s by Daniel G. Bobrow, Wally Feurzeig, Seymour Papert, and Cynthia Solomon. It was later adapted to support a robot with a drawing pen called a <span class="underline">turtle</span> (see</span> <a class="red" href="ch08.xhtml#ch08fig01">Figure 8-1</a><span class="red">).</span></p>&#13;
<p class="figuret"><span epub:type="pagebreak" id="page_222"/><a id="ch08fig01"/><strong>FIGURE 8-1:</strong> An early version of a Logo turtle</p>&#13;
<div class="image"><img alt="Image" src="../images/fig8_1.jpg"/></div>&#13;
<p class="indent">Turtles were connected to a computer to receive movement commands in the Logo language, such as <span class="literal">fd 10</span> to drive forward 10 spaces. As the turtle moved, it drew with the attached pen. These Logo turtles were an early educational system designed to teach programming concepts in a visual way.</p>&#13;
<p class="indent">You’re going to build your own Arduino-controlled turtle, the Drawbot (<a href="ch08.xhtml#ch08fig02">Figure 8-2</a>), which was inspired by the work of Seymour Papert and his team.</p>&#13;
<p class="figuret"><a id="ch08fig02"/><strong>FIGURE 8-2:</strong> A completed Drawbot</p>&#13;
<div class="image"><img alt="Image" src="../images/fig8_2.jpg"/></div>&#13;
<h3 class="h3" id="ch08lev1sec1"><strong>MATERIALS TO GATHER</strong></h3>&#13;
<p class="noindent">Your robot will have two wheels, each with a motor that’s controlled by the Arduino through a new component called an <em>H-bridge</em>. An H-bridge is a small modular circuit board similar to the transistor circuit you used in the last project, except that it will enable you to <span epub:type="pagebreak" id="page_223"/>control both the speed and the direction of the motor. This will give your robot the most flexibility and control. Gather your parts (shown in <a href="ch08.xhtml#ch08fig03">Figures 8-3</a> and <a href="ch08.xhtml#ch08fig04">8-4</a>), and let’s get started!</p>&#13;
<h4 class="h4" id="ch08lev2sec1"><strong>Electronic Parts</strong></h4>&#13;
<p class="bull">• One SparkFun RedBoard (DEV-13975), Arduino Uno (DEV-11021), or any other Arduino-compatible board</p>&#13;
<p class="bull">• One USB Mini-B cable (CAB-11301 or your board’s USB cable)</p>&#13;
<p class="bull">• One solderless breadboard (PRT-12002)</p>&#13;
<p class="bull">• Two geared hobby motors (ROB-13302*)</p>&#13;
<p class="bull">• One TB6612FNG H-bridge motor driver (ROB-09457* unsoldered or ROB-13845* presoldered)</p>&#13;
<p class="bull">• Two rubber wheels fit for the geared hobby motors (ROB-13259*)</p>&#13;
<p class="bull">• Male-to-male jumper wires (PRT-11026)</p>&#13;
<p class="bull">• Male-to-female jumper wires (PRT-09140*)</p>&#13;
<p class="bull">• One 4 AA battery holder (PRT-09835*)</p>&#13;
<div class="noter">&#13;
<p class="notet"><strong>NOTE</strong></p>&#13;
<p class="notep"><em>The parts marked with an asterisk (*) do not come with the standard SparkFun Inventor’s Kit but are available in the separate add-on kit.</em></p>&#13;
</div>&#13;
<p class="figuret"><a id="ch08fig03"/><strong>FIGURE 8-3:</strong> Components and materials for the Drawbot</p>&#13;
<div class="image"><img alt="Image" src="../images/fig8_3.jpg"/></div>&#13;
<h4 class="h4" id="ch08lev2sec2"><strong>Other Materials and Tools</strong></h4>&#13;
<p class="bull">• Pencil</p>&#13;
<p class="bull">• Craft knife</p>&#13;
<p class="bull">• Metal ruler</p>&#13;
<p class="bull">• Glue (hot glue gun or craft glue)</p>&#13;
<p class="bull">• (Optional) Drill and 3/16-inch drill bit</p>&#13;
<p class="bull"><span epub:type="pagebreak" id="page_224"/>• (Optional) Soldering iron</p>&#13;
<p class="bull">• Cardboard (about 12 inches square) or a cardboard box</p>&#13;
<p class="bull">• Ping-pong ball</p>&#13;
<p class="bull">• Enclosure template (see <a href="ch08.xhtml#ch08fig12">Figure 8-12</a> on page <a href="ch08.xhtml#page_235">235</a>)</p>&#13;
<p class="figuret"><a id="ch08fig04"/><strong>FIGURE 8-4:</strong> Recommended tools</p>&#13;
<div class="image"><img alt="Image" src="../images/fig8_4.jpg"/></div>&#13;
<h3 class="h3" id="ch08lev1sec2"><strong>NEW COMPONENTS</strong></h3>&#13;
<p class="noindent">You’ll be using two new components in this project: an H-bridge motor driver and geared hobby motors. Let’s take a look at how these components work.</p>&#13;
<h4 class="h4" id="ch08lev2sec3"><strong>The H-Bridge Motor Driver Integrated Circuit</strong></h4>&#13;
<p class="noindent">In <a href="ch07.xhtml#ch07">Project 7</a>, you used a transistor circuit to control a single motor with Arduino, which allowed you to control the speed of the motor but not the direction of its spin. In this project, you’ll use a new component called an <em>H-bridge motor driver</em> that will allow you to control both the speed and direction of the motor.</p>&#13;
<p class="indent">The H-bridge motor driver is an integrated circuit (IC) chip, made up of about a dozen transistors wired together internally inside a small plastic package. An <em>IC chip</em> is a prewired circuit that has been integrated into a single package to make building complex projects easier. There are many different ICs out there; one example is the brain behind the Arduino Uno, the ATMega328 chip. In this case, the H-bridge motor driver IC allows you to control a motor’s speed and direction of rotation by connecting power and just a few signal wires to the Arduino.</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_225"/>You might recall from <a href="ch07.xhtml#ch07">Project 7</a> that a transistor is simply a switch that can be controlled electronically. A standard H-bridge motor driver consists of four or five transistors (or switches) wired up in an H configuration, as shown in <a href="ch08.xhtml#ch08fig05">Figure 8-5</a>. (The motor shown in the middle isn’t included in the H-bridge IC; you’ll add that in.) By controlling which of the four main switches (labeled A–D) are open or closed, you can control the direction in which the current flows through the motor. The fifth switch (E) controls the speed of the motor’s rotation.</p>&#13;
<p class="figuret"><a id="ch08fig05"/><strong>FIGURE 8-5:</strong> H-bridge circuit for both direction and speed control</p>&#13;
<div class="image"><img alt="Image" src="../images/fig8_5.jpg"/></div>&#13;
<p class="indent">Remember that current flows from positive to negative. If you closed switches A and D, current would flow through the motor from left to right, turning the motor in one direction. If you instead closed switches B and C, current would flow through the motor from right to left, causing it to spin in the opposite direction.</p>&#13;
<p class="indent">Switch E is pulsed on and off rapidly through PWM (see “<a href="ch05.xhtml#ch05lev2sec11">Create Analog Signals with PWM</a>” on page <a href="ch05.xhtml#page_139">139</a>). The duty cycle of this PWM signal will determine how fast the motor spins. On your robot, you’ll have two motors, each with its own H-bridge circuit, and you’ll attach a wheel to each motor so you can control its spin speed and direction.</p>&#13;
<p class="indent">The H-bridge motor driver you’ll use in this project is the Toshiba TB6612FNG, shown in <a href="ch08.xhtml#ch08fig06">Figure 8-6</a>. It comes as a breakout board with holes for pins that are spaced 0.100 inches apart—perfect for inserting into a breadboard.</p>&#13;
<p class="figuret"><a id="ch08fig06"/><strong>FIGURE 8-6:</strong> TB6612FNG H-bridge motor driver breakout board (without pins soldered)</p>&#13;
<div class="image"><img alt="Image" src="../images/fig8_6.jpg"/></div>&#13;
<div class="noter">&#13;
<p class="notet"><span epub:type="pagebreak" id="page_226"/><strong>NOTE</strong></p>&#13;
<p class="notep"><em>The chip also has a standby pin that can be used to put the motor in standby mode to conserve power, but you won’t need this feature, so you’ll disable it.</em></p>&#13;
</div>&#13;
<p class="indent">The Toshiba TB6612FNG is actually a <em>dual</em> H-bridge IC. This means it has two full H-bridge circuits built into a little package, allowing you to control the two motors on your robot with a single board. The H-bridge distinguishes the two motors as A and B, as you can see on the underside of the board in <a href="ch08.xhtml#ch08fig06">Figure 8-6</a>. To control each H-bridge circuit, you use three signal wires: two for direction and one for speed.</p>&#13;
<p class="indent">You can buy the board either with or without pins already soldered on, so if you want to save yourself the trouble of soldering, make sure you get the presoldered board (ROB-13845). If you have the board without header pins already soldered on (ROB-09457), it’s not a problem, but you’ll need to solder male headers onto the pins; for soldering instructions, see “<a href="app01.xhtml#app01lev1sec2">How to Solder</a>” on page <a href="app01.xhtml#page_302">302</a>. In either case, before you start building this project you should have a board that looks like <a href="ch08.xhtml#ch08fig07">Figure 8-7</a>.</p>&#13;
<p class="figuret"><a id="ch08fig07"/><strong>FIGURE 8-7:</strong> DEV-12211 H-bridge motor driver with headers soldered on</p>&#13;
<div class="image"><img alt="Image" src="../images/fig8_7.jpg"/></div>&#13;
<h4 class="h4" id="ch08lev2sec4"><strong>Geared Hobby Motor</strong></h4>&#13;
<p class="noindent">The basic hobby motor that we used in <a href="ch07.xhtml#ch07">Project 7</a> is great for simple mechanisms like spinning fans, but it doesn’t offer a lot of <em>torque</em> (rotational force). In this project, we want to use a motor to move the entire project around, so we need to use a <em>geared motor</em>—a motor that’s attached to a <em>gearbox</em> (see <a href="ch08.xhtml#ch08fig08">Figure 8-8</a>).</p>&#13;
<p class="figuret"><a id="ch08fig08"/><strong>FIGURE 8-8:</strong> A geared hobby motor consists of a basic motor and a gearbox</p>&#13;
<div class="image"><img alt="Image" src="../images/fig8_8.jpg"/></div>&#13;
<p class="indent">A gearbox essentially converts mechanical rotations into torque. This gearbox has a 48:1 gear reduction, which means 48 rotations of the motor equal one rotation of the output shaft. This slows down the motor by a factor of roughly 1/48 and results in a multiplication of the torque by a factor of 48. Basically, the output speed is slower, but the torque is a lot higher.</p>&#13;
<h3 class="h3" id="ch08lev1sec3"><span epub:type="pagebreak" id="page_227"/><strong>BUILD THE DRAWBOT PROTOTYPE</strong></h3>&#13;
<p class="noindent">Now, let’s wire this up to see how it all works. You’ll connect just one motor for now to test the H-bridge motor driver, so you’ll use only one half of the dual H-bridge board. <a href="ch08.xhtml#ch08fig09">Figure 8-9</a> shows how the board and Arduino should be wired. The board is split horizontally, with the top half controlling Motor A and the bottom half controlling Motor B, though the power pins are used for both motors. Connect 5 V and GND from the Arduino to the power rails on the breadboard, and make sure to add a jumper wire to connect the two 5 V rails of the breadboard so you can use either rail to give power; this will save you from crossing too many wires and keep your board neat.</p>&#13;
<p class="figuret"><a id="ch08fig09"/><strong>FIGURE 8-9:</strong> H-bridge test circuit</p>&#13;
<div class="image"><img alt="Image" src="../images/fig8_9.jpg"/></div>&#13;
<p class="indent">Starting from the top left of the H-bridge, connect 5 V to the top two pins, VM and VCC. VM controls the power for the motors, and VCC controls the power for the chip. Next, use a jumper wire to connect one of the chip’s GND pins to the GND rail of the breadboard. There are three pins available for ground on the H-bridge, as you can see in <a href="ch08.xhtml#ch08fig07">Figure 8-7</a>, and you can use any of these.</p>&#13;
<p class="indent">Next you’ll connect the motor. The motor has two wires: red and black. The orientation of the wires doesn’t actually matter, but for consistency connect the red wire to the pin labeled A01 and the black wire to pin A02.</p>&#13;
<p class="indent">The remaining pins on the left side are those for controlling the second motor and another GND pin, so leave them for now. The pins on the top right of the H-bridge breakout board are for the signal wire connections for Motor A. The topmost pin, labeled PWMA, controls the motor’s speed. Connect this to pin 11 on the Arduino. (Remember <span epub:type="pagebreak" id="page_228"/>that pins 3, 5, 6, 9, 10, and 11 all have PWM capability and can be used with the <span class="literal">analogWrite()</span> function.)</p>&#13;
<p class="indent">The next two pins, labeled AIN2 and AIN1, are used to control the direction and drive of Motor A, which you can do by setting these pins to different combinations of HIGH and LOW. <a href="ch08.xhtml#ch08tab01">Table 8-1</a> shows the combinations. Connect AIN2 to Arduino pin 12 and AIN1 to Arduino pin 11.</p>&#13;
<p class="tabcapt"><a id="ch08tab01"/><strong>TABLE 8-1:</strong> H-bridge motor controller functions</p>&#13;
<table class="all">&#13;
<tr>&#13;
<td class="tablecr"><p class="center"><strong>AIN1</strong></p></td>&#13;
<td class="tablecr"><p class="center"><strong>AIN2</strong></p></td>&#13;
<td class="tablec"><p class="center"><strong>FUNCTION</strong></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="tablecr"><p class="center"><span class="red1">HIGH</span></p></td>&#13;
<td class="tablecr"><p class="center"><span class="red1">LOW</span></p></td>&#13;
<td class="tablec"><p class="center"><span class="red1">Clockwise</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="tablecr"><p class="center"><span class="red1">LOW</span></p></td>&#13;
<td class="tablecr"><p class="center"><span class="red1">HIGH</span></p></td>&#13;
<td class="tablec"><p class="center"><span class="red1">Counterclockwise</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="tablecr"><p class="center"><span class="red1">HIGH</span></p></td>&#13;
<td class="tablecr"><p class="center"><span class="red1">HIGH</span></p></td>&#13;
<td class="tablec"><p class="center"><span class="red1">Electronic brake (see note)</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="tablecr1"><p class="center"><span class="red1">LOW</span></p></td>&#13;
<td class="tablecr1"><p class="center"><span class="red1">LOW</span></p></td>&#13;
<td class="tablec1"><p class="center"><span class="red1">Stop/coast</span></p></td>&#13;
</tr>&#13;
</table>&#13;
<div class="noter">&#13;
<p class="notet"><strong>NOTE</strong></p>&#13;
<p class="notep"><em>Setting both pins HIGH will employ</em> electronic braking. <em>The two wires of the motor are essentially shorted together, causing the motor’s spinning to stop abruptly. By contrast, setting both to LOW would just stop actively spinning the motors, meaning the wheels would coast to a stop rather than stopping deliberately.</em></p>&#13;
</div>&#13;
<p class="indent">Lastly you’ll need to disable the STBY pin. As mentioned earlier, this H-bridge IC has a standby pin that allows you to put the chip into a low-power sleep mode, which is useful for applications where power consumption is a concern. For this project, you don’t need this feature, so you’ll disable it. This chip is designed with STBY as an <em>active low</em> input. This means that when this pin is LOW, it goes into standby mode. To disable standby, you’ll connect this pin directly to 5 V on the power rail.</p>&#13;
<h3 class="h3" id="ch08lev1sec4"><strong>PROGRAM THE DRAWBOT</strong></h3>&#13;
<p class="noindent">Let’s start the sketch with a little test. This simple example will spin the motor clockwise slowly for 1 second, change directions and spin counterclockwise quickly for 1 second, and then stop for 1 second before starting again. Open the Arduino IDE, and copy the code in <a href="ch08.xhtml#ch08ex01">Listing 8-1</a> into your window. When you’re done, click <strong>Upload</strong> and watch what happens!</p>&#13;
<p class="ex-caption"><a id="ch08ex01"/><strong>LISTING 8-1:</strong> H-bridge motor controller example of speed and direction control</p>&#13;
<div class="pre">&#13;
<p class="programs"><span class="ent">➊</span> <span class="green">const byte</span> AIN1 = 13;<br/>  <span class="green">const byte</span> AIN2 = 12;<br/>  <span class="green">const byte</span> PWMA = 11;<br/><br/>  <span class="green">void</span> <span class="green1">setup</span>()<br/>  {<br/>    <span class="orange">pinMode</span>(AIN1, <span class="green">OUTPUT</span>);<br/>    <span class="orange">pinMode</span>(AIN2, <span class="green">OUTPUT</span>);<br/>    <span class="orange">pinMode</span>(PWMA, <span class="green">OUTPUT</span>);<br/>  }<br/><span epub:type="pagebreak" id="page_229"/><br/>  <span class="green">void</span> <span class="green1">loop</span>()<br/>  {<br/>    <span class="ash">//set direction to clockwise</span><br/><span class="ent">➋</span>   <span class="orange">digitalWrite</span>(AIN1, <span class="green">HIGH</span>);<br/>    <span class="orange">digitalWrite</span>(AIN2, <span class="green">LOW</span>);<br/><span class="ent">➌</span>   <span class="orange">analogWrite</span>(PWMA, 50);<br/>    <span class="orange">delay</span>(1000);<br/><br/>    <span class="ash">//set direction to counterclockwise</span><br/><span class="ent">➍</span>   <span class="orange">digitalWrite</span>(AIN1, <span class="green">LOW</span>);<br/>    <span class="orange">digitalWrite</span>(AIN2, <span class="green">HIGH</span>);<br/>    <span class="orange">analogWrite</span>(PWMA, 255);<br/>    <span class="orange">delay</span>(1000);<br/><br/>    <span class="ash">//brake</span><br/><span class="ent">➎</span>   <span class="orange">digitalWrite</span>(AIN1, <span class="green">HIGH</span>);<br/>    <span class="orange">digitalWrite</span>(AIN2, <span class="green">HIGH</span>);<br/>    <span class="orange">delay</span>(1000);<br/>  }</p>&#13;
</div>&#13;
<p class="indent">The sketch starts with a new data type: <span class="literal">const byte</span> <span class="ent">➊</span>. The keyword <span class="literal">const</span> is used to declare a <em>constant</em>, which is like a variable but with a value that can’t be changed again later in the code. Thus, constants are useful for declaring things that will stay the same throughout the code, like pin numbers or configurations. In this case, these constants define the pin numbers that control the H-bridge. Since the pin numbers are numbers between 0 and 13, you can define these constants as the data type <span class="literal">byte</span>.</p>&#13;
<div class="noter">&#13;
<p class="notet"><strong>NOTE</strong></p>&#13;
<p class="notep"><em>Most of the time it doesn’t matter too much whether you use a constant or a variable, but constants use less memory on the Arduino, so it’s good practice to use them when you can, and you may see them used in other people’s examples online. Also, while it’s not a hard-and-fast rule, constant names are typically in all capital letters.</em></p>&#13;
</div>&#13;
<p class="indent">Next, you set the pins as outputs, and then set the direction you want the motor to spin using two <span class="literal">digitalWrite()</span> functions <span class="ent">➋</span> on pins <span class="literal">AIN1</span> and <span class="literal">AIN2</span>. The first loop block sets <span class="literal">AIN1</span> to <span class="literal">HIGH</span> and <span class="literal">AIN2</span> to <span class="literal">LOW</span>, which spins the motor clockwise. To set the speed, you use an <span class="literal">analogWrite()</span> function <span class="ent">➌</span> on the <span class="literal">PWMA</span> pin. You may recall from <a href="ch05.xhtml#ch05">Project 5</a> that you can use <span class="literal">analogWrite()</span> to set an analog pin to a PWM value from <span class="literal">0</span> to <span class="literal">255</span>; the value given here, <span class="literal">50</span>, is relatively slow. The motor will spin for 1 second because of <span class="literal">delay(1000)</span>, and the next loop block changes directions with two more <span class="literal">digitalWrite()</span> functions <span class="ent">➍</span>. Here the sketch simply swaps which pin is <span class="literal">HIGH</span> and which is <span class="literal">LOW</span>, sets the speed to <span class="literal">255</span> with <span class="literal">analogWrite()</span>, and adds another <span class="literal">delay(1000)</span> to set it to spin for 1 second.</p>&#13;
<p class="indent">The last part of the sketch sets both <span class="literal">AIN1</span> and <span class="literal">AIN2</span> to <span class="literal">HIGH</span> <span class="ent">➎</span>, with another <span class="literal">delay(1000)</span>. This applies an electronic brake and stops the motor for 1 second before the loop begins again and repeats the pattern.</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_230"/>Using this code as an example, you can now control both the speed and direction of a motor with just three lines of code! But we can make this even simpler. Let’s clean up the code by using custom functions.</p>&#13;
<h4 class="h4" id="ch08lev2sec5"><strong>Create a Custom Function</strong></h4>&#13;
<p class="noindent">At the moment, every time you want to control the motor you’re using three lines of code: two to control the direction and one to set the speed. In this section you’ll make a custom function that will take just one number to determine both the direction and the speed of the spin. This number can be anything between <span class="literal">-255</span> and <span class="literal">255</span> and will spin the motor clockwise if the number is positive and counterclockwise if it’s negative. Add the code in <a href="ch08.xhtml#ch08ex02">Listing 8-2</a> to the very end of your sketch.</p>&#13;
<p class="ex-caption"><a id="ch08ex02"/><strong>LISTING 8-2:</strong> Custom function to set the motor speed of Motor A</p>&#13;
<div class="pre">&#13;
<p class="programs">  <span class="green">void</span> <span class="ent">➊</span>setMotorA(<span class="ent">➋</span><span class="green">int</span> motorSpeed)<br/>  {<br/><span class="ent">➌</span>   <span class="green1">if</span> (motorSpeed &gt; 0)<br/>    {<br/>      <span class="orange">digitalWrite</span>(AIN1, <span class="green">HIGH</span>);<br/>      <span class="orange">digitalWrite</span>(AIN2, <span class="green">LOW</span>);<br/>    }<br/><span class="ent">➍</span>   <span class="green1">else if</span> (motorSpeed &lt; 0)<br/>    {<br/>      <span class="orange">digitalWrite</span>(AIN1, <span class="green">LOW</span>);<br/>      <span class="orange">digitalWrite</span>(AIN2, <span class="green">HIGH</span>);<br/>    }<br/><span class="ent">➎</span>   <span class="green1">else</span><br/>    {<br/>      <span class="orange">digitalWrite</span>(AIN1, <span class="green">HIGH</span>);<br/>      <span class="orange">digitalWrite</span>(AIN2, <span class="green">HIGH</span>);<br/>    }<br/><span class="ent">➏</span>   <span class="orange">analogWrite</span>(PWMA, <span class="orange">abs</span>(motorSpeed));<br/>  }</p>&#13;
</div>&#13;
<p class="indent">Name the function <span class="literal">setMotorA()</span> <span class="ent">➊</span>. This function uses a number as a single argument named <span class="literal">motorSpeed</span> <span class="ent">➋</span> to set the motor’s speed. First, a simple <span class="literal">if()</span> statement determines whether the number is positive or negative by checking whether <span class="literal">motorSpeed</span> is greater or less than zero. If <span class="literal">motorSpeed</span> is positive <span class="ent">➌</span>, the <span class="literal">if()</span> statement sets the direction pins so that the motor spins clockwise. If it’s negative <span class="ent">➍</span>, an <span class="literal">else if()</span> statement sets the direction pins to spin the motor counterclockwise. If it’s neither positive nor negative (that is, if it’s <span class="literal">0</span>), a final <span class="literal">else</span> statement <span class="ent">➎</span> sets both direction pins <span class="literal">HIGH</span> to apply the brake and stop the motor.</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_231"/>The line at <span class="ent">➏</span> uses the <span class="literal">abs()</span> mathematical function to find the <em>absolute value</em> of <span class="literal">motorSpeed</span>. The <span class="literal">analogWrite()</span> function sets the speed of the motor, but it works only with values from <span class="literal">0</span> to <span class="literal">255</span>. The <span class="literal">abs()</span> function makes sure that the positive part, or <em>absolute magnitude</em>, of <span class="literal">motorSpeed</span> is used to set the speed.</p>&#13;
<h4 class="h4" id="ch08lev2sec6"><strong>Clean Up the Code</strong></h4>&#13;
<p class="noindent">Now, let’s clean up the <span class="literal">loop()</span> with this new function. You can see in <a href="ch08.xhtml#ch08ex03">Listing 8-3</a> that the <span class="literal">loop()</span> code is much shorter and easier to read. Make these changes to the <span class="literal">loop()</span> in your sketch and upload it to your board. It should behave the same way as before. Now, if you want to set the motor to a different speed or direction, you can do it with just a single line of code!</p>&#13;
<p class="ex-caption"><a id="ch08ex03"/><strong>LISTING 8-3:</strong> Simplified version of the <span class="literal">loop()</span> using the custom function <span class="literal">setMotorA()</span></p>&#13;
<div class="pre">&#13;
<p class="programs"><span class="green">void</span> <span class="green1">loop</span>()<br/>{<br/>  <span class="ash">//set direction to clockwise</span><br/>  setMotorA(100);<br/>  <span class="orange">delay</span>(1000);<br/><br/>  <span class="ash">//set direction to counterclockwise</span><br/>  setMotorA(-255);<br/>  <span class="orange">delay</span>(1000);<br/><br/>  <span class="ash">//stop</span><br/>  setMotorA(0);<br/>  <span class="orange">delay</span>(1000);<br/>}</p>&#13;
</div>&#13;
<p class="indent">This code sets a <span class="literal">setMotorA()</span> value and a delay to make each change in speed and direction. Now you have the beginnings of your Drawbot! Next, you’ll wire the second motor.</p>&#13;
<h3 class="h3" id="ch08lev1sec5"><strong>WIRE THE SECOND MOTOR</strong></h3>&#13;
<p class="noindent">The DrawBot needs a second motor so it can zip around on two wheels. <a href="ch08.xhtml#ch08fig10">Figure 8-10</a> shows how the second motor will be wired. Plug Motor B in on the left side of the breakout board just below the connections for the first motor, with the red wire connected to B02 and the black wire connected to B01. Next, add the signal control lines to the H-bridge breakout board, just below the STBY pin on the right side. Connect the PWMB pin on the H-bridge to Arduino pin 10 for speed control, and connect the BIN1 and BIN2 pins to Arduino pins 8 and 9, respectively, for direction control.</p>&#13;
<p class="figuret"><span epub:type="pagebreak" id="page_232"/><a id="ch08fig10"/><strong>FIGURE 8-10:</strong> Wiring diagram for the motor driver and two motors</p>&#13;
<div class="image"><img alt="Image" src="../images/fig8_10.jpg"/></div>&#13;
<p class="indent">Now, you’ll need to add code to control the second motor, as shown in <a href="ch08.xhtml#ch08ex04">Listing 8-4</a>.</p>&#13;
<p class="ex-caption"><a id="ch08ex04"/><strong>LISTING 8-4:</strong> Adding constants and <span class="literal">pinMode()</span> functions for Motor B</p>&#13;
<div class="pre">&#13;
<p class="programs">  <span class="ash1">const byte AIN1 = 13;</span><br/>  <span class="ash1">const byte AIN2 = 12;</span><br/>  <span class="ash1">const byte PWMA = 11;</span><br/><br/><span class="ent">➊</span> <span class="green">const byte</span> BIN1 = 8;<br/>  <span class="green">const byte</span> BIN2 = 9;<br/>  <span class="green">const byte</span> PWMB = 10;<br/><br/>  <span class="ash1">void setup()</span><br/>  <span class="ash1">{</span><br/>    <span class="ash1">pinMode(AIN1, OUTPUT);</span><br/>    <span class="ash1">pinMode(AIN2, OUTPUT);</span><br/>    <span class="ash1">pinMode(PWMA, OUTPUT);</span><br/><br/><span class="ent">➋</span>   <span class="orange">pinMode</span>(BIN1, <span class="green">OUTPUT</span>);<br/>    <span class="orange">pinMode</span>(BIN2, <span class="green">OUTPUT</span>);<br/>    <span class="orange">pinMode</span>(PWMB, <span class="green">OUTPUT</span>);<br/>  }</p>&#13;
</div>&#13;
<p class="indent">This code adds the three additional constants <span class="ent">➊</span> for the signal control pins for Motor B, and sets each of these pins as <span class="literal">OUTPUT</span> <span class="ent">➋</span> in the <span class="literal">setup()</span>.</p>&#13;
<p class="indent">Next, you’ll again write a custom function to control Motor B. This code is so similar to the <span class="literal">setMotorA()</span> function that you can save yourself some typing by highlighting the code for <span class="literal">setMotorA()</span>, copying it (<small>CTRL</small>-C), pasting it (<small>CTRL</small>-V) below the <span class="literal">setMotorA()</span> function, and changing the <span class="literal">A</span>s to <span class="literal">B</span>s. This is a technique that programmers use a lot, and it can save you a lot of time. You just need to make sure <span epub:type="pagebreak" id="page_233"/>you’re careful to change all the <span class="literal">A</span>s to <span class="literal">B</span>s in this second custom function (<a href="ch08.xhtml#ch08ex05">Listing 8-5</a>), or the code won’t work.</p>&#13;
<p class="ex-caption"><a id="ch08ex05"/><strong>LISTING 8-5:</strong> Custom function for Motor B</p>&#13;
<div class="pre">&#13;
<p class="programs"><span class="green">void</span> setMotorB(<span class="green">int</span> motorSpeed)<br/>{<br/>  <span class="green1">if</span> (motorSpeed &gt; 0)<br/>  {<br/>    <span class="orange">digitalWrite</span>(BIN1, <span class="green">HIGH</span>);<br/>    <span class="orange">digitalWrite</span>(BIN2, <span class="green">LOW</span>);<br/>  }<br/>  <span class="green1">else if</span> (motorSpeed &lt; 0)<br/>  {<br/>    <span class="orange">digitalWrite</span>(BIN1, <span class="green">LOW</span>);<br/>    <span class="orange">digitalWrite</span>(BIN2, <span class="green">HIGH</span>);<br/>  }<br/>  <span class="green1">else</span><br/>  {<br/>    <span class="orange">digitalWrite</span>(BIN1, <span class="green">HIGH</span>);<br/>    <span class="orange">digitalWrite</span>(BIN2, <span class="green">HIGH</span>);<br/>  }<br/>  <span class="orange">analogWrite</span>(PWMB, <span class="orange">abs</span>(motorSpeed));<br/>}</p>&#13;
</div>&#13;
<p class="indent">The sketch will now need <span class="literal">motorSpeed</span> values for both <span class="literal">setMotorA()</span> and <span class="literal">setMotorB()</span>. Let’s add those to test the motors out together.</p>&#13;
<h3 class="h3" id="ch08lev1sec6"><strong>DRIVE BOTH MOTORS</strong></h3>&#13;
<p class="noindent">To make your Drawbot drive forward, you’ll need the right motor to spin clockwise and the left motor to spin counterclockwise. This may seem counterintuitive, but take a look at a robot base from the side. <a href="ch08.xhtml#ch08fig11">Figure 8-11</a> shows a robot frame from both sides with arrows indicating the forward direction.</p>&#13;
<p class="figuret"><a id="ch08fig11"/><strong>FIGURE 8-11:</strong> Side views of the robot from the right and left sides. To move forward, the right wheel must spin clockwise and the left wheel must spin counterclockwise.</p>&#13;
<div class="image"><img alt="Image" src="../images/fig8_11.jpg"/></div>&#13;
<p class="indent">On the right side of the robot, the wheel needs to spin clockwise for the robot to move forward, but on the left side of the robot, the wheel needs to spin counterclockwise. Pay attention to the direction in which each axle is spinning. If you need to, attach a piece of masking tape to the spinning end of the motor so that you can see the axle’s direction.</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_234"/>Now, to make the robot go backward, you just reverse those directions. After adding the custom function code for <span class="literal">setMotorB()</span> to your sketch, adjust your <span class="literal">loop()</span> to look like <a href="ch08.xhtml#ch08ex06">Listing 8-6</a>, and then upload this code and watch your motors spin!</p>&#13;
<p class="ex-caption"><a id="ch08ex06"/><strong>LISTING 8-6:</strong> New <span class="literal">loop()</span> code to test both motors</p>&#13;
<div class="pre">&#13;
<p class="programs"><span class="green">void</span> <span class="green1">loop</span>()<br/>{<br/>  <span class="ash">//drive forward medium speed for one second</span><br/>  setMotorA(100);<br/>  setMotorB(-100);<br/>  <span class="orange">delay</span>(1000)<br/><br/>  <span class="ash">//drive backward quickly for one second</span><br/>  setMotorA(-255);<br/>  setMotorB(255);<br/>  <span class="orange">delay</span>(1000);<br/><br/>  <span class="ash">//stop for one second</span><br/>  setMotorA(0);<br/>  setMotorB(0);<br/>  <span class="orange">delay</span>(1000);<br/>}</p>&#13;
</div>&#13;
<p class="indent">You should see that Motor A (right side) is spinning clockwise and Motor B (left side) is spinning counterclockwise, and then after 1 second they flip. If you find that the motors are spinning in the same direction, swap the red and black wire connections on <em>one</em> of<em> </em>the motors.</p>&#13;
<p class="indent">With just a few lines of code, you can make your Drawbot move forward, turn right, turn left, move backward, and jiggle around!</p>&#13;
<p class="indent">Now it’s time to build a frame or a <em>chassis</em> for your Drawbot. Because the code you wrote is all in the <span class="literal">loop()</span> part of the sketch, your motors will continue to spin, stop, spin, and stop. To stop the motors from spinning while you’re building the chassis for your Drawbot, temporarily disconnect the USB cable from your computer.</p>&#13;
<h3 class="h3" id="ch08lev1sec7"><strong>BUILD THE DRAWBOT CHASSIS</strong></h3>&#13;
<p class="noindent">If you’re using the SIK with the breadboard holder and Arduino baseplate, you’ll need to make the chassis of the Drawbot at least as large as the baseplate itself. The baseplate measures 6 inches by 4.25 inches. Use a piece of cardboard or thin plywood to make your chassis. For our design, we made the chassis a rectangular 6 × 8-inch cutout, as shown in <a href="ch08.xhtml#ch08fig12">Figure 8-12</a>. You can download a PDF of this template from <em><a href="https://www.nostarch.com/arduinoinventor/">https://www.nostarch.com/arduinoinventor/</a></em>.</p>&#13;
<p class="figuret"><span epub:type="pagebreak" id="page_235"/><a id="ch08fig12"/><strong>FIGURE 8-12:</strong> Drawbot chassis, bottom view (not full size)</p>&#13;
<div class="image"><img alt="Image" src="../images/fig8_12.jpg"/></div>&#13;
<p class="indent">Using tape or a hot glue gun, attach the motors to the underside of the chassis, oriented as shown in <a href="ch08.xhtml#ch08fig13">Figure 8-13</a>, with the motor hub near the back and the longer end of the motor body toward the front. (Hot glue is a great semipermanent method for attaching things because you can simply scrape it away with a craft knife and remove the part if you want to reuse it later.) You may need to temporarily disconnect the motors from your breadboard circuit while you’re attaching them to the chassis, so just remember to reconnect them to the circuit after you’ve glued them down. Refer back to <a href="ch08.xhtml#ch08fig10">Figure 8-10</a> if you need help rewiring it.</p>&#13;
<p class="figuret"><a id="ch08fig13"/><strong>FIGURE 8-13:</strong> Attaching the motors to the chassis with hot glue</p>&#13;
<div class="image"><img alt="Image" src="../images/fig8_13.jpg"/></div>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_236"/>We have a hole in our base template that’s designed for a pen or marker. A Drawbot needs to be able to draw, after all! To give the pen more stability, we glued two smaller pieces of cardboard together to create a taller pen holder. Glue these pieces down right on top of the hole, as shown in <a href="ch08.xhtml#ch08fig14">Figure 8-14</a>.</p>&#13;
<p class="figuret"><a id="ch08fig14"/><strong>FIGURE 8-14:</strong> Gluing the pen holder onto the chassis</p>&#13;
<div class="image"><img alt="Image" src="../images/fig8_14.jpg"/></div>&#13;
<p class="indent">Finally, attach the wheels to the motors. You’ll notice that the motor axles have two flat edges (<a href="ch08.xhtml#ch08fig15">Figure 8-15</a>). Make sure you line these up with the flat edges on the axle holes of the wheels. The fit may be a little tight. Hold on to the entire motor while pushing the wheel on so that you don’t accidentally rip the motor off your chassis.</p>&#13;
<p class="figuret"><a id="ch08fig15"/><strong>FIGURE 8-15:</strong> Profile of motor axle. Line up the flat edges with the flats of the opening on the wheel.</p>&#13;
<div class="image"><img alt="Image" src="../images/fig8_15.jpg"/></div>&#13;
<p class="indent">The Drawbot will move around using the two motor wheels as power and steering and a skid caster at the other end for balance. This method is called <em>differential steering</em>. This particular Drawbot is designed as a front-wheel-drive system, using a ping-pong ball as a skid caster in the back. As the Drawbot moves around, it will skid the ping-pong ball over the surface. Glue the ping-pong ball into place as shown in <a href="ch08.xhtml#ch08fig16">Figure 8-16</a>, trying to center it as much as possible for the best balance.</p>&#13;
<div class="noter">&#13;
<p class="notet"><strong>NOTE</strong></p>&#13;
<p class="notep"><em>If you want to make your own wheels, use the shape and dimensions in <a href="ch08.xhtml#ch08fig15">Figure 8-15</a> for the axle holes.</em></p>&#13;
</div>&#13;
<p class="figuret"><a id="ch08fig16"/><strong>FIGURE 8-16:</strong> Attaching a ping-pong ball as a skid caster</p>&#13;
<div class="image"><img alt="Image" src="../images/fig8_16.jpg"/></div>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_237"/>Now, set the breadboard holder, the Arduino, and a battery pack on top of the chassis, as shown in <a href="ch08.xhtml#ch08fig17">Figure 8-17</a>. Use a little bit of tape or dabs of glue to make sure they don’t move around.</p>&#13;
<p class="figuret"><a id="ch08fig17"/><strong>FIGURE 8-17:</strong> The breadboard holder, the Arduino, and a battery pack on the cardboard chassis</p>&#13;
<div class="image"><img alt="Image" src="../images/fig8_17.jpg"/></div>&#13;
<h4 class="h4" id="ch08lev2sec7"><strong>Test and Troubleshoot</strong></h4>&#13;
<p class="noindent">Reconnect the USB cable to your Arduino board or plug in your battery pack and watch what happens. You might need to hold on to the cable so that it doesn’t get tangled up. The robot should move forward slowly for 1 second, reverse direction quickly for 1 second, and then stop for 1 second. Because all of your code is in the <span class="literal">loop()</span>, the Drawbot will repeat this motion over and over again until you disconnect it from power. While you’re working on tweaking your code, you may want to put the Drawbot’s back end up on a few books to keep the wheels from touching the table.</p>&#13;
<p class="indent">Now, if your robot doesn’t behave like you expect it to, you’ll need to do a little troubleshooting to figure out what’s going on. First, identify the problem. There are two common problems that we’ve seen with this bot: moving in the wrong direction and turning in circles. If it moves backward first instead of forward, switch the red and black wires for both motors going to the H-bridge. If your robot moves in circles instead of moving forward or backward, try flipping the motor wires on either Motor A or Motor B—don’t flip both of them, or you’ll get the same problem again. You should now have a Drawbot that moves forward and then backward, stops, and repeats this motion.</p>&#13;
<p class="indent">Before moving on, test how far the Drawbot moves in 1 second and make a note of this. You’ll add a marker pen for it to start drawing lines, and you may need to adjust the speeds and the times <span epub:type="pagebreak" id="page_238"/>so that the Drawbot is easier to control. Slower speeds and shorter times might be best if you’re working on a small table.</p>&#13;
<h4 class="h4" id="ch08lev2sec8"><strong>Turn and Make Patterns: A Robot Square Dance</strong></h4>&#13;
<p class="noindent">Now that you’ve mastered moving your robot forward and backward, see what fun patterns you can make with your new creation. Before you put a marker onto your Drawbot, try turning corners.</p>&#13;
<p class="indent">To turn the robot to the right, both motors need to spin counterclockwise, and to turn the robot left, they need to spin clockwise. See if you can get your Drawbot to do a little square dance! To draw a square, the basic steps are as follows:</p>&#13;
<p class="bull">• Move forward.</p>&#13;
<p class="bull">• Turn 90 degrees.</p>&#13;
<p class="bull">• Move forward.</p>&#13;
<p class="bull">• Turn 90 degrees.</p>&#13;
<p class="bull">• Move forward.</p>&#13;
<p class="bull">• Turn 90 degrees.</p>&#13;
<p class="bull">• Move forward.</p>&#13;
<p class="bull">• Turn 90 degrees.</p>&#13;
<p class="indent"><a href="ch08.xhtml#ch08fig18">Figure 8-18</a> illustrates the steps needed. You’ll notice that you repeat the same steps four times. You already know you can use a <span class="literal">loop()</span> for repeated actions, but loops repeat forever, and you want your Drawbot to stop after four turns. Luckily there’s a programming technique that’s perfect for repeating a part of the code a set number of times: a <span class="literal">for()</span> loop.</p>&#13;
<p class="figuret"><a id="ch08fig18"/><strong>FIGURE 8-18:</strong> Steps to a simple square dance</p>&#13;
<div class="image"><img alt="Image" src="../images/fig8_18.jpg"/></div>&#13;
<p class="indent">A <span class="literal">for()</span> loop starts with the command <span class="literal">for</span>, followed by a set of parentheses. Inside the parentheses there are three sections. See <a href="ch08.xhtml#ch08ex07">Listing 8-7</a>.</p>&#13;
<p class="ex-caption"><span epub:type="pagebreak" id="page_239"/><a id="ch08ex07"/><strong>LISTING 8-7:</strong> The <span class="literal">for()</span> loop</p>&#13;
<div class="pre">&#13;
<p class="programs"><span class="green1">for</span>(<span class="ent">➊</span><span class="green">int</span> count = 0; <span class="ent">➋</span>count &lt; 4; <span class="ent">➌</span>count++)<br/>  {<br/>  <span class="ent">➍</span> <span class="ash">//insert code here that you want to repeat</span><br/>  }</p></div>&#13;
<p class="indent">The first part <span class="ent">➊</span> is the declaration and initialization of a counter variable that keeps track of repetitions of the loop. You declare this variable as an integer, name it <span class="literal">count</span>, and initialize it to <span class="literal">0</span>. You can name this variable anything you want, so long as you use the same variable name in the next two parts. The next part is the <em>condition statement</em> <span class="ent">➋</span>, which controls whether the <span class="literal">for()</span> loop continues to repeat or stops. Here, you continue repeating as long as the condition statement <span class="literal">count &lt; 4</span> is <span class="literal">true</span>. Since <span class="literal">count</span> was initialized at <span class="literal">0</span>, this condition is <span class="literal">true</span> on the first pass, and the loop will repeat. The third part is the <em>increment statement</em> <span class="ent">➌</span>, which tells the <span class="literal">for()</span> loop what to do with the counter variable after each repetition. Here, <span class="literal">count++</span> is a shorthand for <span class="literal">count = count + 1</span>. This increments the counter variable by 1 for each repetition. The final part <span class="ent">➍</span> is the code that you want to repeat or loop through, like any code you place inside curly brackets.</p>&#13;
<p class="indent">So in all, the <span class="literal">for()</span> loop’s arguments are saying that the loop should continue to run until it’s run four times, at which point the count will be incremented to <span class="literal">4</span>, the condition statement will be <span class="literal">false</span>, and the loop will exit. The <span class="literal">for()</span> loop is a really handy way to clean up code and repeat instructions a particular number of times.</p>&#13;
<p class="indent">Now, use this new skill to write your square dance code. Replace the <span class="literal">loop()</span> in your sketch with the <span class="literal">loop()</span> in <a href="ch08.xhtml#ch08ex08">Listing 8-8</a>. Everything else will stay the same.</p>&#13;
<p class="ex-caption"><a id="ch08ex08"/><strong>LISTING 8-8:</strong> Square dance code</p>&#13;
<div class="pre">&#13;
<p class="programs">  <span class="green">void</span> <span class="green1">loop</span>()<br/>  {<br/><span class="ent">➊</span>   <span class="green1">for</span>(<span class="green">int</span> count = 0; count &lt; 4; count++)<br/>    {<br/>      <span class="ash">//drive forward</span><br/>    <span class="ent">➋</span> setMotorA(100);<br/>      setMotorB(-100);<br/>    <span class="ent">➌</span> <span class="orange">delay</span>(500);<br/><br/>      <span class="ash">//turn right</span><br/>    <span class="ent">➍</span> setMotorA(-100);<br/>      setMotorB(-100);<br/>      <span class="orange">delay</span>(250);<br/>    }<br/><span class="ent">➎</span>   <span class="orange">delay</span>(1000);<br/>  }</p>&#13;
</div>&#13;
<div class="sidebar">&#13;
<p class="sidebart"><span epub:type="pagebreak" id="page_240"/><strong>SHORTHAND FOR QUICKLY MANIPULATING VARIABLES</strong></p>&#13;
<p class="noindent">Often you may want to increment, decrement, or just modify the value of a variable in code. The most common use is to increment the value of a variable by one for each repetition of a loop, which you can do with the code <span class="literal">variableName = variableName + 1</span>. But there are also a few shorthand methods to modify values of variables, shown in the following table.</p>&#13;
<table class="all">&#13;
<tr>&#13;
<td class="tablecr"><p class="center"><strong>SHORTHAND CODE</strong></p></td>&#13;
<td class="tablecr"><p class="center"><strong>LONGHAND CODE</strong></p></td>&#13;
<td class="tablec"><p class="center"><strong>DESCRIPTION</strong></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="tablecr"><p class="center"><span class="red1"><span class="literal">variableName++;</span></span></p></td>&#13;
<td class="tablecr"><p class="center"><span class="red1"><span class="literal">variableName = variableName + 1;</span></span></p></td>&#13;
<td class="tablec"><p class="center"><span class="red1">Increment by 1</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="tablecr"><p class="center"><span class="red1"><span class="literal">variableName += 2;</span></span></p></td>&#13;
<td class="tablecr"><p class="center"><span class="red1"><span class="literal">variableName = variableName + 2;</span></span></p></td>&#13;
<td class="tablec"><p class="center"><span class="red1">Increment by 2</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="tablecr"><p class="center"><span class="red1"><span class="literal">variableName += n;</span></span></p></td>&#13;
<td class="tablecr"><p class="center"><span class="red1"><span class="literal">variableName = variableName + <em>n</em>;</span></span></p></td>&#13;
<td class="tablec"><p class="center"><span class="red1">Increment by <em>n</em></span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="tablecr"><p class="center"><span class="red1"><span class="literal">variableName--;</span></span></p></td>&#13;
<td class="tablecr"><p class="center"><span class="red1"><span class="literal">variableName = variableName - 1;</span></span></p></td>&#13;
<td class="tablec"><p class="center"><span class="red1">Decrement by 1</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="tablecr"><p class="center"><span class="red1"><span class="literal">variableName -= 2;</span></span></p></td>&#13;
<td class="tablecr"><p class="center"><span class="red1"><span class="literal">variableName = variableName - 2;</span></span></p></td>&#13;
<td class="tablec"><p class="center"><span class="red1">Decrement by 2</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="tablecr"><p class="center"><span class="red1"><span class="literal">variableName -= n;</span></span></p></td>&#13;
<td class="tablecr"><p class="center"><span class="red1"><span class="literal">variableName + variableName - <em>n</em>;</span></span></p></td>&#13;
<td class="tablec"><p class="center"><span class="red1">Decrement by <em>n</em></span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="tablecr"><p class="center"><span class="red1"><span class="literal">variableName *= n;</span></span></p></td>&#13;
<td class="tablecr"><p class="center"><span class="red1"><span class="literal">variableName = variableName * <em>n</em>;</span></span></p></td>&#13;
<td class="tablec"><p class="center"><span class="red1">Multiply by <em>n</em></span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="tablecr1"><p class="center"><span class="red1"><span class="literal">variableName /= n;</span></span></p></td>&#13;
<td class="tablecr1"><p class="center"><span class="red1"><span class="literal">variableName = variableName / <em>n</em>;</span></span></p></td>&#13;
<td class="tablec1"><p class="center"><span class="red1">Divide by <em>n</em></span><br/></p></td>&#13;
</tr>&#13;
</table>&#13;
</div>&#13;
<p class="indent">To draw a square, the sketch uses the <span class="literal">for()</span> loop <span class="ent">➊</span> to repeat the steps four times. The robot first drives forward <span class="ent">➋</span> for just half a second <span class="ent">➌</span>. You want to make sure that it doesn’t go too far and draw all over your floors. Next, to turn the robot, the sketch sets both motors to spin counterclockwise <span class="ent">➍</span>. To complete each square, you add a short, 1-second delay <span class="ent">➎</span>. Notice that the delay is after the curly bracket for the <span class="literal">for()</span> loop. The Drawbot will repeat the steps—move forward and turn four times—and then wait for 1 second before the whole <span class="literal">loop()</span> repeats. This will give you a chance to manually move the Drawbot or reposition it if you need to. The values in this code worked well in our office, but you may need to fine-tune <span epub:type="pagebreak" id="page_241"/>and play around with the speed settings and timing for your own Drawbot. Tweak your sketch until you get your Drawbot moving in a square-like pattern. Don’t worry if it’s not perfect—just keep testing out the speeds of the corner turns. This is part of the art you’ll be creating!</p>&#13;
<p class="indent">We’ve included the full sketch for the square-dancing Drawbot in <a href="ch08.xhtml#ch08ex09">Listing 8-9</a>.</p>&#13;
<p class="ex-caption"><a id="ch08ex09"/><strong>LISTING 8-9:</strong> Complete Drawbot square dance code</p>&#13;
<div class="pre">&#13;
<p class="programs"><span class="green">const byte</span> AIN1 = 13;<br/><span class="green">const byte</span> AIN2 = 12;<br/><span class="green">const byte</span> PWMA = 11;<br/><br/><span class="green">const byte</span> BIN1 = 8;<br/><span class="green">const byte</span> BIN2 = 9;<br/><span class="green">const byte</span> PWMB = 10;<br/><br/><span class="green">void</span> <span class="green1">setup</span>()<br/>{<br/>  <span class="orange">pinMode</span>(AIN1, <span class="green">OUTPUT</span>);<br/>  <span class="orange">pinMode</span>(AIN2, <span class="green">OUTPUT</span>);<br/>  <span class="orange">pinMode</span>(PWMA, <span class="green">OUTPUT</span>);<br/><br/>  <span class="orange">pinMode</span>(BIN1, <span class="green">OUTPUT</span>);<br/>  <span class="orange">pinMode</span>(BIN2, <span class="green">OUTPUT</span>);<br/>  <span class="orange">pinMode</span>(PWMB, <span class="green">OUTPUT</span>);<br/>}<br/><br/><span class="green">void</span> <span class="green1">loop</span>()<br/>{<br/>  <span class="green1">for</span>(<span class="green">int</span> count = 0; count &lt; 4; count++)<br/>  {<br/>    <span class="ash">//drive forward</span><br/>    setMotorA(100);<br/>    setMotorB(-100);<br/>    <span class="orange">delay</span>(500);<br/><br/>    <span class="ash">//turn right</span><br/>    setMotorA(-100);<br/>    setMotorB(-100);<br/>    <span class="orange">delay</span>(250);<br/>  }<br/>  <span class="orange">delay</span>(1000);<br/>}<br/><br/><span class="green">void</span> setMotorA(<span class="green">int</span> motorSpeed)<br/>{<br/><span epub:type="pagebreak" id="page_242"/>  <span class="green1">if</span> (motorSpeed &gt; 0)<br/>  {<br/>    <span class="orange">digitalWrite</span>(AIN1, <span class="green">HIGH</span>);<br/>    <span class="orange">digitalWrite</span>(AIN2, <span class="green">LOW</span>);<br/>  }<br/>  <span class="green1">else if</span> (motorSpeed &lt; 0)<br/>  {<br/>    <span class="orange">digitalWrite</span>(AIN1, <span class="green">LOW</span>);<br/>    <span class="orange">digitalWrite</span>(AIN2, <span class="green">HIGH</span>);<br/>  }<br/>  <span class="green1">else</span><br/>  {<br/>    <span class="orange">digitalWrite</span>(AIN1, <span class="green">LOW</span>);<br/>    <span class="orange">digitalWrite</span>(AIN2, <span class="green">LOW</span>);<br/>  }<br/>  <span class="orange">analogWrite</span>(PWMA, <span class="orange">abs</span>(motorSpeed));<br/>}<br/><br/><span class="green">void</span> setMotorB(<span class="green">int</span> motorSpeed)<br/>{<br/>  <span class="green1">if</span> (motorSpeed &gt; 0)<br/>  {<br/>    <span class="orange">digitalWrite</span>(BIN1, <span class="green">HIGH</span>);<br/>    <span class="orange">digitalWrite</span>(BIN2, <span class="green">LOW</span>);<br/>  }<br/>  <span class="green1">else if</span> (motorSpeed &lt; 0)<br/>  {<br/>    <span class="orange">digitalWrite</span>(BIN1, <span class="green">LOW</span>);<br/>    <span class="orange">digitalWrite</span>(BIN2, <span class="green">HIGH</span>);<br/>  }<br/>  <span class="green1">else</span><br/>  {<br/>    <span class="orange">digitalWrite</span>(BIN1, <span class="green">LOW</span>);<br/>    <span class="orange">digitalWrite</span>(BIN2, <span class="green">LOW</span>);<br/>  }<br/>  <span class="orange">analogWrite</span>(PWMB, <span class="orange">abs</span>(motorSpeed));<br/>}</p>&#13;
</div>&#13;
<p class="indent">As we mentioned earlier, the chassis template includes a notch on the front end to place a marker. We suggest using either a washable or dry-erase marker. Find a large piece of poster paper or dry-erase board that you can lay on the floor. Be really careful not to draw all over your floor! It might get you in trouble. (Trust us, we’ve made this mistake before, and we definitely regret it.)</p>&#13;
<p class="indent">Place your Drawbot on the drawing surface. Use a piece of masking tape to secure the marker in place, positioning it so that it makes good contact with the drawing surface. Move the Drawbot <span epub:type="pagebreak" id="page_243"/>around manually on the drawing surface to test the marker placement. Now, plug the USB cable in to your computer and watch what happens. Be quick to grab the Drawbot if it looks like it’s going to run off your drawing surface and onto the floor.</p>&#13;
<p class="indent">To mix things up, change marker colors or modify your code to draw different size squares. See if you can make your Drawbot draw spirals and stars! <a href="ch08.xhtml#ch08fig19">Figure 8-19</a> shows some of the fun patterns our Drawbot made in our office.</p>&#13;
<p class="figuret"><a id="ch08fig19"/><strong>FIGURE 8-19:</strong> Drawbot in action—make sure you use a large piece of paper to keep it from drawing all over the floor!</p>&#13;
<div class="image"><img alt="Image" src="../images/fig8_19.jpg"/></div>&#13;
<p class="indent">If you want to add some style to your Drawbot, try digging through your craft supplies or finding some spare cardboard and see what you can come up with. We placed an old pretzel jar container on our Drawbot at the office. It’s now called Pretzel Bot, and it drives around and gives away free pretzels (<a href="ch08.xhtml#ch08fig20">Figure 8-20</a>).</p>&#13;
<p class="figuret"><a id="ch08fig20"/><strong>FIGURE 8-20:</strong> Pretzel Bot! The Arduino and breadboard are hidden inside the box.</p>&#13;
<div class="image"><img alt="Image" src="../images/fig8_20.jpg"/></div>&#13;
<h3 class="h3" id="ch08lev1sec8"><span epub:type="pagebreak" id="page_244"/><strong>GOING FURTHER</strong></h3>&#13;
<p class="noindent">The Drawbot is an introduction to basic robotics. The simplest robots are really just a controller and two motors, and that’s what you have here. We’ll give you a few ideas to take it to the next level.</p>&#13;
<h4 class="h4" id="ch08lev2sec9"><strong>Hack</strong></h4>&#13;
<p class="noindent">Preprogrammed motion is fun, but every time you want to change up the pattern, you have to reupload the sketch. But with some changes to the code, you can use the Serial Monitor to control your Drawbot while it’s still going.</p>&#13;
<p class="indent">So far, you’ve used the Serial Monitor only to read data the Arduino sends back to the computer as the project is working, such as sensor data, but the Serial Monitor can also send data to the Arduino. Open the Serial Monitor window, and you’ll see a small text box at the top with a button labeled Send, as shown in <a href="ch08.xhtml#ch08fig21">Figure 8-21</a>. This box allows you to send data to the Arduino so you can control it from the Serial Monitor.</p>&#13;
<p class="figuret"><a id="ch08fig21"/><strong>FIGURE 8-21:</strong> Serial Monitor window</p>&#13;
<div class="image"><img alt="Image" src="../images/fig8_21.jpg"/></div>&#13;
<p class="indent">The <em>P8_DrawbotSerial.ino</em> sketch (downloadable from <em><a href="https://www.nostarch.com/arduinoinventor/">https://www.nostarch.com/arduinoinventor/</a></em>) uses the Serial Monitor to send just three numbers to control Motor A, Motor B, and the driving time.</p>&#13;
<p class="indent">Take a look at the code. This new sketch declares three variables to hold the speed of Motor A, the speed of Motor B, and the delay time, which are the three numbers you send. You initialize communication with the Arduino with <span class="literal">Serial.begin(9600);</span> to send and receive data using the Serial Monitor. The Arduino reads the data you put into the Serial Monitor and assigns any integers to the three <span class="literal">speedA</span>, <span class="literal">speedB</span>, and <span class="literal">delayTime</span> variables, which are then used for the familiar <span class="literal">setMotorA()</span>, <span class="literal">setMotorB()</span>, and <span class="literal">delay()</span> functions. See the comments in the code for a more complete explanation.</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_245"/>Upload the sketch to your Drawbot, open the Serial Monitor, enter <strong>100 -100 500</strong>, and press <small>ENTER</small> or click <strong>Send</strong> (see <a href="ch08.xhtml#ch08fig22">Figure 8-22</a>). The Drawbot should move forward for half a second and then stop. Now you can fine-tune your Drawbot routines without having to reupload the code each time! The code will run once and doesn’t repeat unless you give it additional commands. What happens when you enter six numbers, such as <span class="literal">100 -100 500 -100 -100 250</span>? See if you can choreograph a dance routine that is represented by a sequence of numbers.</p>&#13;
<p class="figuret"><a id="ch08fig22"/><strong>FIGURE 8-22:</strong> Choreographing a robo-dance</p>&#13;
<div class="image"><img alt="Image" src="../images/fig8_22.jpg"/></div>&#13;
<h4 class="h4" id="ch08lev2sec10"><strong>Modify</strong></h4>&#13;
<p class="noindent">What other shapes can you program your Drawbot to create? Use what you learned with <span class="literal">for()</span> loops and see if you can hack your code to make it draw a triangle or star. You’ll have to do some experimenting to get the timing and speeds just right. What happens when you move just one wheel at a time?</p>&#13;
<h4 class="h4" id="ch08lev2sec11"><strong>Bonus</strong></h4>&#13;
<p class="noindent">There’s a bonus script (at <em><a href="https://www.nostarch.com/arduinoinventor/">https://www.nostarch.com/arduinoinventor/</a></em>) that will let you control the turtle with even simpler commands, like <span class="literal">fd 10</span> and <span class="literal">bk 10</span> to move forward or backward 10 spaces. Download <em>P8_BonusTurtle.ino</em> and load it into your IDE. Then open your Serial Monitor and enter a few of the following commands: <span class="literal">fd 10</span> to move forward 10 spaces, <span class="literal">bk 10</span> to move backward 10 spaces, <span class="literal">rt 90</span> to turn right 90 degrees, and <span class="literal">lt 90</span> to turn left 90 degrees. See if you can instruct your new turtle to do a square dance with these instructions!</p>&#13;
</body></html>