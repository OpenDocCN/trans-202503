<html><head></head><body>
<h2 class="h2" id="ch19"><span epub:type="pagebreak" id="page_287"/><span class="big"><span class="blue"><strong>19</strong></span></span><br/><strong>RECEIVING FILE INPUT AND OUTPUT</strong></h2>&#13;
<div class="imagec"><img alt="image" src="graphics/common01.jpg"/></div>&#13;
<p class="noindent">The programs you’ve written so far in this book took input from the keyboard and sent output to the screen. But what if you wanted to create a virtual phone book and use thousands of lines of data in the program? Working with that much data could make it difficult to write and maintain your program. You’d have to input every name and phone number each time you ran the program!</p>&#13;
<p class="indent">Fortunately, a program can also receive input from a file and send its output to a file, and both files can be saved on your computer. So all the phone book information could be neatly tucked away in a file, and you’d only have to input the data once. Today, many programs process data that is stored in files.</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_288"/>In most programming languages, working with files is an advanced topic, but Small Basic makes file handling super simple. In this chapter, you’ll learn about the <span class="literal">File</span> object and how it makes working with files a breeze!</p>&#13;
<h3 class="h3" id="ch19lev1sec01"><span class="blue"><strong>The Case for Files</strong></span></h3>&#13;
<p class="noindent">In your programs, you’ve used variables and arrays to store data. But data stored in variables and arrays is temporary: all that data is lost when the program ends or when you turn off your computer. When you run your program again, it won’t remember the input you entered the last time it ran. If you want to permanently store the data created in a program, you need to save that data in a file. Data stored in files is called <em>persistent data</em> because it’s retained even after you turn off your computer. It’s as persistent as a squirrel caching acorns.</p>&#13;
<p class="indent">Files provide a convenient way to handle large amounts of data. If your program requires lots of data (like the names of your friends), you can’t ask a user to input that data each time they run the program. Most likely, they will get annoyed and stop using the program. If a program can read its input data from a file, a user won’t need to enter data by hand and might want to run the program many times. When programs use files, a user could even customize the application by changing the data file. For example, if you write a spelling game that reads its input from a file, the user can set the game’s difficulty by changing the input file. For example, they could use short words for an easy game and long words for a more difficult game.</p>&#13;
<p class="indent">Getting data from a file is called <em>reading the file</em>, and the files a program reads are generally called <em>input files</em>. Similarly, sending data to a file is called <em>writing to the file</em>, and the files a program writes to (or creates) are called <em>output files</em>. Storing data to (and reading data from) files on disk is called <em>file access</em>. Working with files is called <em>file I/O</em>, which is short for input/output.</p>&#13;
<p class="indent">Before we start working with files in programs, let’s look at filenames and how files are saved on your computer.</p>&#13;
<h4 class="h4" id="ch19lev2sec01"><em><strong>Naming Files</strong></em></h4>&#13;
<p class="noindent">When you create a new file, you give it a name. You can call it <em>Fred</em> or <em>DontOpenMe</em> if you want, but it’s usually best to name it more specifically, such as <em>myFriends</em> or <em>myLoveStory</em>.</p>&#13;
<p class="indent">The Windows operating system is case insensitive and doesn’t see any difference between uppercase and lowercase letters in filenames, so <em>myFile</em>, <em>Myfile</em>, and <em>MYFILE</em> would all refer to the same file. Windows also supports filenames with two parts that are separated by a period, such as <em>myFile.dat</em>. The part following the period (<em>dat</em> in this example) is called the <em>file extension</em>. The file extension usually indicates what kind of file it is (such as a photo or text file). <a href="ch19.html#ch19table1">Table 19-1</a> lists some of the most common file extensions <span epub:type="pagebreak" id="page_289"/>and their meanings. File extensions are usually added automatically by the programs you use. For example, the Small Basic IDE adds an <em>.sb</em> extension to source code files.</p>&#13;
<p class="tablecap"><a id="ch19table1"/><strong>Table 19-1:</strong> Common File Extensions</p>&#13;
<table class="topbot">&#13;
<thead>&#13;
<tr>&#13;
<td class="table_th" style="vertical-align: top;"><p class="table"><strong>Extension</strong></p></td>&#13;
<td class="table_th" style="vertical-align: top;"><p class="table"><strong>File type</strong></p></td>&#13;
<td class="table_th" style="vertical-align: top;"><p class="table"><strong>Used for</strong></p></td>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td class="table_1" style="vertical-align: top;"><p class="table"><em>.dat</em></p></td>&#13;
<td class="table_1" style="vertical-align: top;"><p class="table">General data file</p></td>&#13;
<td class="table_1" style="vertical-align: top;"><p class="table">Storing information about a specific application</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;"><p class="table"><em>.exe</em></p></td>&#13;
<td style="vertical-align: top;"><p class="table">Executable file</p></td>&#13;
<td style="vertical-align: top;"><p class="table">Applications</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1" style="vertical-align: top;"><p class="table"><em>.gif</em></p></td>&#13;
<td class="table_1" style="vertical-align: top;"><p class="table">Graphic Interchange Format</p></td>&#13;
<td class="table_1" style="vertical-align: top;"><p class="table">Website images</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;"><p class="table"><em>.html</em></p></td>&#13;
<td style="vertical-align: top;"><p class="table">Hypertext Markup Language website file</p></td>&#13;
<td style="vertical-align: top;"><p class="table">Web pages</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1" style="vertical-align: top;"><p class="table"><em>.jpg</em></p></td>&#13;
<td class="table_1" style="vertical-align: top;"><p class="table">An image encoded with the JPEG standard</p></td>&#13;
<td class="table_1" style="vertical-align: top;"><p class="table">Photos from a digital camera</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;"><p class="table"><em>.mp3</em></p></td>&#13;
<td style="vertical-align: top;"><p class="table">Music encoded in MPEG layer 3 audio format</p></td>&#13;
<td style="vertical-align: top;"><p class="table">Audio files</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1" style="vertical-align: top;"><p class="table"><em>.pdf</em></p></td>&#13;
<td class="table_1" style="vertical-align: top;"><p class="table">Portable Document Format file for reading</p></td>&#13;
<td class="table_1" style="vertical-align: top;"><p class="table">Ebooks</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;"><p class="table"><em>.txt</em></p></td>&#13;
<td style="vertical-align: top;"><p class="table">General text file</p></td>&#13;
<td style="vertical-align: top;"><p class="table">Notes you might write in Notepad</p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<p class="indent">You’ll be working with text (<em>.txt</em>) files in this chapter.</p>&#13;
<h4 class="h4" id="ch19lev2sec02"><em><strong>File Organization</strong></em></h4>&#13;
<p class="noindent">Imagine dozens of books organized in a cabinet with several shelves. Each shelf has a different label (such as Science, Math, Novels, Dr. Seuss, and so on) and is filled with books in that category. Each shelf serves as a container that groups related books together. Similarly, files on a computer are stored in containers called <em>directories</em> (or <em>folders</em>). A directory can contain files as well as other directories. A directory within a directory is called a <em>subdirectory</em>.</p>&#13;
<p class="indent">The <em>filesystem</em> is the part of the operating system that is responsible for organizing files and directories on a computer and providing ways to manage them. When you call a file-related method from your Small Basic program (to create, delete, read from, or write to a file), the operating system’s filesystem handles all the low-level details for you, so you don’t have to worry whether the actual files are stored on a hard drive, flash memory, a CD, a DVD, and so on. The Small Basic library talks to the operating system to access files stored on various media, as illustrated in <a href="ch19.html#ch19fig1">Figure 19-1</a>.</p>&#13;
<div class="image"><img alt="image" src="graphics/f19-01.jpg"/></div>&#13;
<p class="figcap"><a id="ch19fig1"/><em>Figure 19-1: How the filesystem lets you access files on different media</em></p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_290"/>The filesystem has a tree structure, like the one shown in <a href="ch19.html#ch19fig2">Figure 19-2</a>. The top of the tree is called the <em>root directory</em> (the drive letter <em>D:</em> in this figure). The root directory has a number of files and other directories under it. Each of these directories might contain other files and subdirectories.</p>&#13;
<p class="indent">You can locate any file by following a path from the root directory down the tree until you reach that file. The sequence of directories you follow makes up the <em>pathname</em> for the file. For example, to find the last file in <a href="ch19.html#ch19fig2">Figure 19-2</a>, you would look in the root directory <em>D:</em>, then in <em>Book</em>, and then in <em>Chapter03</em> to locate the file. If you write the path using a backslash (\) to separate each directory, the pathname is <em>D:\Book\Chapter03\Ch03.docx</em>. You can locate each file on the system using its pathname.</p>&#13;
<div class="image"><img alt="image" src="graphics/f19-02.jpg"/></div>&#13;
<p class="figcap"><a id="ch19fig2"/><em>Figure 19-2: The filesystem as a tree</em></p>&#13;
<p class="indent">To access a file from a Small Basic program, you need to specify the file’s pathname. To learn how, look at the executable file <em>Test.exe</em> in <a href="ch19.html#ch19fig2">Figure 19-2</a>. When you run this file, the running program knows its <em>current directory</em> (which is <em>D:\Book\Chapter01\Examples</em> in this case). If you want <em>Test.exe</em> to access a data file (such as <em>Test1.dat</em> or <em>Test2.dat</em>), you need to specify the pathname—the sequence of folders, starting from the root, that the program needs to navigate to reach the file. This is also called the <em>absolute path</em>. In <a href="ch19.html#ch19fig2">Figure 19-2</a>, the absolute path for <em>Test1.dat</em> is <em>D:\Book\Chapter01\Examples\Test1.dat</em>, and the absolute path for <em>Test2.dat</em> is <em>D:\Book\Chapter01\Examples\Data\Test2.dat</em>.</p>&#13;
<p class="indent">If you write a program that only you will use, you can save the data files needed by this program anywhere you like and access these files using absolute paths hardcoded in your program. For example, you can write this:</p>&#13;
<p class="programs">str <span class="brown">=</span> <span class="blue1">File</span><span class="brown">.ReadContents(</span><span class="red">"D:\Book\Chapter01\Examples\Test1.dat"</span><span class="brown">)</span></p>&#13;
<p class="indent">But if you give this program to a friend to try, it will fail unless your friend has the same file tree as you. A better solution is to build the desired path(s) in your program at runtime, like this:</p>&#13;
<p class="programs">path <span class="brown">=</span> <span class="blue1">Program</span><span class="brown">.Directory</span><br/>str <span class="brown">=</span> <span class="blue1">File</span><span class="brown">.ReadContents(</span>path <span class="brown">+</span> <span class="red">"\Test1.dat"</span><span class="brown">)</span></p>&#13;
<p class="indent">Now the program will add <em>Test1.dat</em> to the end of its current directory, which means it will look for <em>Test1.dat</em> in the same folder that the program is in. Then your friend only needs to place <em>Test.exe</em> and <em>Test1.dat</em> in the same folder; the absolute path will no longer matter. You can just zip your <span epub:type="pagebreak" id="page_291"/>program’s folder (right-click the folder, click Send to, and click Compressed (zipped) folder) and send that ZIP file to your friend. Your friend can save the files contained in the ZIP file under <em>C:\</em>, <em>D:\</em>, <em>C:\Temp</em>, or any other folder of their choice, and your program will work as you designed it.</p>&#13;
<p class="indent">With an understanding of files and pathnames, you’re ready to learn about the <span class="literal">File</span> object and how to use its methods to read data from files, write data to files, and perform other file management operations. Let’s go single file!</p>&#13;
<h3 class="h3" id="ch19lev1sec02"><span class="blue"><strong>The File Object</strong></span></h3>&#13;
<p class="noindent">Small Basic’s <span class="literal">File</span> object includes all the methods that handle reading and writing file data, deleting and copying files, and listing directory contents. Because this object supports many methods, this section is divided into two parts. First, we’ll explore the methods related to reading from and writing to files. Second, we’ll look at the methods related to file management.</p>&#13;
<h4 class="h4" id="ch19lev2sec03"><em><strong>File I/O Methods</strong></em></h4>&#13;
<p class="noindent">The <span class="literal">File</span> object’s most frequently used methods are those used to write data to files and read data from files. Let’s explore these methods in detail.</p>&#13;
<p class="indent">To start, open Notepad and type some words in the editor so it looks like <a href="ch19.html#ch19fig3">Figure 19-3</a>. Make sure that you don’t press <small>ENTER</small> after the last line.</p>&#13;
<div class="image"><img alt="image" src="graphics/f19-03.jpg"/></div>&#13;
<p class="figcap"><a id="ch19fig3"/><em>Figure 19-3: An example text file</em></p>&#13;
<p class="indent">Save the file as <em>Test1.txt</em> in <em>C:\Temp</em> so its absolute pathname is <em>C:\Temp\Test1.txt</em>. If you don’t want to create the file, you can find it in this chapter’s folder; just copy it to <em>C:\Temp</em>.</p>&#13;
<h5 class="h5" id="ch19lev3sec01"><strong>Reading from a File</strong></h5>&#13;
<p class="noindent">Now let’s try reading the contents of <em>Test1.txt</em>. You can use the <span class="literal">File</span> object’s <span class="literal">ReadContents()</span> method to read the entire contents of a file at once. This method opens a file, reads it, and returns its entire contents as a string. Enter and run the program in <a href="ch19.html#ch19ex1">Listing 19-1</a> to see how this method works.</p>&#13;
<p class="programs">1 <span class="green"><span class="codeitalic">' ReadContentsDemo.sb</span></span><br/>2 path <span class="brown">=</span> <span class="red">"C:\Temp\Test1.txt"</span><br/>3 str <span class="brown">=</span> <span class="blue1">File</span><span class="brown">.ReadContents(</span>path<span class="brown">)</span><br/>4 len <span class="brown">=</span> <span class="blue1">Text</span><span class="brown">.GetLength(</span>str<span class="brown">)</span><br/>5 <span class="blue1">TextWindow</span><span class="brown">.WriteLine(</span>str<span class="brown">)</span><br/>6 <span class="blue1">TextWindow</span><span class="brown">.WriteLine(</span><span class="red">"This file has "</span> <span class="brown">+</span> len <span class="brown">+</span> <span class="red">" characters."</span><span class="brown">)</span></p>&#13;
<p class="listcap"><a id="ch19ex1"/><em>Listing 19-1: Demonstrating the</em> <span class="literal"><span class="codeitalic">ReadContents()</span></span> <em>method</em></p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_292"/>Here is the output of this program:</p>&#13;
<p class="programs">This<br/>is a<br/><br/>Test.<br/>This file has 19 characters.</p>&#13;
<p class="indent">Line 2 sets the file’s absolute path. Line 3 reads the entire contents of the file and saves the returned string in a variable named <span class="literal">str</span> using the <span class="literal">ReadContents()</span> method. <span class="literal">ReadContents()</span> takes one argument: the pathname of the file you want to read. Line 4 gets the length of the string and saves it in a variable named <span class="literal">len</span>. Lines 5–6 display the <span class="literal">str</span> and <span class="literal">len</span> variables.</p>&#13;
<p class="indent">But why does <span class="literal">GetLength()</span> output 19 characters for the string’s length when the string <span class="literal">"This is a Test."</span> contains only 15? To understand what’s going on, you need to examine the actual characters that make up the <span class="literal">str</span> variable. Remember from <a href="ch18.html#ch18">Chapter 18</a> that characters are encoded in a format (such as ASCII or Unicode). Add the following code to the end of <a href="ch19.html#ch19ex1">Listing 19-1</a>, and run the program again:</p>&#13;
<p class="programs"><span class="purple"><span class="codestrong">For</span></span> N <span class="brown">=</span> <span class="red">1</span> <span class="purple"><span class="codestrong">To</span></span> len<br/>  ch <span class="brown">=</span> <span class="blue1">Text</span><span class="brown">.GetSubText(</span>str<span class="brown">,</span> N<span class="brown">,</span> <span class="red">1</span><span class="brown">)</span>   <span class="green"><span class="codeitalic">' Gets one character</span></span><br/>  code <span class="brown">=</span> <span class="blue1">Text</span><span class="brown">.GetCharacterCode(</span>ch<span class="brown">)</span>  <span class="green"><span class="codeitalic">' Gets the code for this character</span></span><br/>  <span class="blue1">TextWindow</span><span class="brown">.WriteLine(</span>code<span class="brown">)</span>        <span class="green"><span class="codeitalic">' Displays it</span></span><br/><span class="purple"><span class="codestrong">EndFor</span></span></p>&#13;
<p class="indent">This code shows that the <span class="literal">str</span> variable has 19 characters. <a href="ch19.html#ch19fig4">Figure 19-4</a> breaks down what the program is doing.</p>&#13;
<div class="image"><img alt="image" src="graphics/f19-04.jpg"/></div>&#13;
<p class="figcap"><a id="ch19fig4"/><em>Figure 19-4: The 19 characters of the</em> <span class="literal"><span class="codeitalic">str</span></span> <em>variable in <a href="ch19.html#ch19ex1">Listing 19-1</a></em></p>&#13;
<p class="indent">Notepad inserts two special characters (called <em>carriage return</em> and <em>line feed</em>, whose ASCII codes are 13 and 10) to mark the end of each line. Think of the <em>newline</em> (or end-of-line) marker as a pair of characters produced when you press <small>ENTER</small> on the keyboard. Without these characters, the lines <span epub:type="pagebreak" id="page_293"/>in the file would run together in one long line. The newline characters are <em>control characters</em>; they only control the position of the cursor on the screen or the printer.</p>&#13;
<p class="indent">The <span class="literal">ReadContents()</span> method returns the entire contents of the file as a single string, including newline characters between lines in the file.</p>&#13;
<h5 class="h5" id="ch19lev3sec02"><strong>Writing to a File</strong></h5>&#13;
<p class="noindent">The <span class="literal">WriteContents()</span> method lets you save the contents of a string in a program to a file of your choice. If you want to create multiple lines of text, you need to insert the newline characters manually. For example, let’s write a program that reads text input from the keyboard and writes it back to a file. The program is shown in <a href="ch19.html#ch19ex2">Listing 19-2</a>.</p>&#13;
<p class="programs"> 1 <span class="green"><span class="codeitalic">' WriteContentsDemo.sb</span></span><br/> 2 CR <span class="brown">=</span> <span class="blue1">Text</span><span class="brown">.GetCharacter(</span><span class="red">13</span><span class="brown">)</span>                 <span class="green"><span class="codeitalic">' Code for carriage return</span></span><br/> 3 LF <span class="brown">=</span> <span class="blue1">Text</span><span class="brown">.GetCharacter(</span><span class="red">10</span><span class="brown">)</span>                 <span class="green"><span class="codeitalic">' Code for line feed</span></span><br/> 4 outFile <span class="brown">=</span> <span class="red">"C:\Temp\Out.txt"</span>                <span class="green"><span class="codeitalic">' Absolute path of output file</span></span><br/> 5<br/> 6 strOut <span class="brown">=</span> <span class="red">""</span>                                <span class="green"><span class="codeitalic">' Text to be written to file</span></span><br/> 7 strIn <span class="brown">=</span> <span class="red">""</span>                                 <span class="green"><span class="codeitalic">' One line (read from the user)</span></span><br/> 8 <span class="purple"><span class="codestrong">While</span></span><span class="brown">(</span>strIn <span class="brown">&lt;&gt;</span> <span class="red">"exit"</span><span class="brown">)</span>                     <span class="green"><span class="codeitalic">' Until user enters exit</span></span><br/> 9   <span class="blue1">TextWindow</span><span class="brown">.Write(</span><span class="red">"Data (exit to end): "</span><span class="brown">)</span> <span class="green"><span class="codeitalic">' Prompts for text</span></span><br/>10   strIn <span class="brown">=</span> <span class="blue1">TextWindow</span><span class="brown">.Read()</span>                <span class="green"><span class="codeitalic">' Reads line</span></span><br/>11   <span class="purple"><span class="codestrong">If</span></span> <span class="brown">(</span>strIn <span class="brown">&lt;&gt;</span> <span class="red">"exit"</span><span class="brown">)</span> <span class="purple"><span class="codestrong">Then</span></span>                <span class="green"><span class="codeitalic">' If user didn't enter exit</span></span><br/>12     strOut <span class="brown">=</span> strOut <span class="brown">+</span> strIn <span class="brown">+</span> CR <span class="brown">+</span> LF      <span class="green"><span class="codeitalic">' Appends text to strOut</span></span><br/>13   <span class="purple"><span class="codestrong">EndIf</span></span><br/>14 <span class="purple"><span class="codestrong">EndWhile</span></span><br/>15<br/>16 <span class="blue1">File</span><span class="brown">.WriteContents(</span>outFile<span class="brown">,</span> strOut<span class="brown">)</span>        <span class="green"><span class="codeitalic">' Writes strOut to file</span></span></p>&#13;
<p class="listcap"><a id="ch19ex2"/><em>Listing 19-2: Demonstrating the</em> <span class="literal"><span class="codeitalic">WriteContents()</span></span> <em>method</em></p>&#13;
<p class="indent">Here’s a sample run of this program showing the user input:</p>&#13;
<p class="programs">Data (exit to end): <span class="codestrong">If Peter Piper picked a peck of pickled peppers,</span><br/>Data (exit to end): <span class="codestrong">Where's the peck of pickled peppers? I'm hungry.</span><br/>Data (exit to end): <span class="codestrong">exit</span></p>&#13;
<p class="indent">Now open the output file <em>C:\Temp\Out.txt</em> in Notepad and check its contents. The file contains what the user entered in the text window. Pretty cool, huh? You wrote all of that text without using Notepad!</p>&#13;
<p class="indent">Here’s how the program works. We define the codes for the carriage return and the line feed characters in lines 2–3 and define the output file’s path in line 4. We then start a loop to get the user’s text (line 8–14). In each iteration of the loop, we prompt the user to enter any text they want (line 9) and read the input text into a variable named <span class="literal">strIn</span> (line 10). If the user enters any text other than <span class="literal">exit</span> (line 11), we append that text followed by a carriage return and line feed to the <span class="literal">strOut</span> string (line 12). When the user enters <span class="literal">exit</span>, the loop ends, and we call <span class="literal">WriteContents()</span> to write <span class="literal">strOut</span> to the <span epub:type="pagebreak" id="page_294"/>output file (line 16). If the file doesn’t exist, <span class="literal">WriteContents()</span> automatically creates it. If the file does exist, <span class="literal">WriteContents()</span> overwrites its contents with whatever is in the <span class="literal">strOut</span> variable.</p>&#13;
<div class="sidebar">&#13;
<p class="sidebart" id="ch19sb01"><strong>TRY IT OUT 19-1</strong></p>&#13;
<p class="noindent">Write a program that reads an input text file, converts the text to lowercase, and then saves the result to a new output file.</p>&#13;
</div>&#13;
<h5 class="h5" id="ch19lev3sec03"><strong>Checking for Errors</strong></h5>&#13;
<p class="noindent">Similar to when you work with user input, you can’t control what the user saves in a file that your program reads. Sometimes the data in a file might be incorrect due to human error. Many things can go wrong (as you’ll see in a moment), and your programs need to be ready to handle these errors.</p>&#13;
<p class="indent">Fortunately, Small Basic is always prepared! A call to <span class="literal">WriteContents()</span> returns <span class="literal">"SUCCESS"</span> or <span class="literal">"FAILED"</span> automatically based on whether the operation was successful. A well-written program checks the returned string and takes action in case of failure. Let’s update <a href="ch19.html#ch19ex2">Listing 19-2</a> to check the return value of <span class="literal">WriteContents()</span>. Replace the statement on line 16 with the code in <a href="ch19.html#ch19ex3">Listing 19-3</a>.</p>&#13;
<p class="programs">1 result <span class="brown">=</span> <span class="blue1">File</span><span class="brown">.WriteContents(</span>outFile<span class="brown">,</span> strOut<span class="brown">)</span> <span class="green"><span class="codeitalic">' Writes strOut to file</span></span><br/>2 <span class="purple"><span class="codestrong">If</span></span> <span class="brown">(</span>result <span class="brown">=</span> <span class="red">"SUCCESS"</span><span class="brown">)</span> <span class="purple"><span class="codestrong">Then</span></span><br/>3   <span class="blue1">TextWindow</span><span class="brown">.WriteLine(</span><span class="red">"Output saved to: "</span> <span class="brown">+</span> outFile<span class="brown">)</span><br/>4 <span class="purple"><span class="codestrong">Else</span></span><br/>5   <span class="blue1">TextWindow</span><span class="brown">.WriteLine(</span><span class="red">"Failed to write to: "</span> <span class="brown">+</span> outFile<span class="brown">)</span><br/>6   <span class="blue1">TextWindow</span><span class="brown">.WriteLine(</span><span class="blue1">File</span><span class="brown">.LastError)</span><br/>7 <span class="purple"><span class="codestrong">EndIf</span></span></p>&#13;
<p class="listcap"><a id="ch19ex3"/><em>Listing 19-3: Checking the return value of</em> <span class="literal"><span class="codeitalic">WriteContents()</span></span></p>&#13;
<p class="indent">First, we save the return of <span class="literal">WriteContents()</span> in a variable named <span class="literal">result</span> (line 1), and then we check the method’s return value. If the method succeeds (line 2), we inform the user that the output has been saved successfully (line 3). If the operation fails (line 4), we tell the user that the program failed to write to the output file (line 5), and then we display the reason for the failure using the <span class="literal">File</span> object’s <span class="literal">LastError</span> property (line 6). This property is automatically updated by <span class="literal">WriteContents()</span> if writing to a file fails.</p>&#13;
<p class="indent">After writing the code to handle the failure case, we need to test the code by making it fail on purpose. Here are some things that can cause <span class="literal">WriteContents()</span> to fail:</p>&#13;
<ol>&#13;
<li><p class="noindenta">The path of the output file doesn’t exist.</p></li>&#13;
<li><p class="noindenta">The output file is already open in another program.</p></li>&#13;
<li><p class="noindenta">There is not enough space to save the file.</p></li>&#13;
</ol>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_295"/>Let’s experiment with the first possibility to see what happens.</p>&#13;
<h5 class="h5" id="ch19lev3sec04"><strong>Path Doesn’t Exist</strong></h5>&#13;
<p class="noindent">Run the short program in <a href="ch19.html#ch19ex4">Listing 19-4</a>.</p>&#13;
<p class="programs">1 <span class="green"><span class="codeitalic">' BadPath.sb</span></span><br/>2 path <span class="brown">=</span> <span class="red">"C:\Temp\Folder1\Out.txt"</span><br/>3 res <span class="brown">=</span> <span class="blue1">File</span><span class="brown">.WriteContents(</span>path<span class="brown">,</span> <span class="red">"Hello"</span><span class="brown">)</span><br/>4 <span class="blue1">TextWindow</span><span class="brown">.WriteLine(</span>res <span class="brown">+</span> <span class="red">": "</span> <span class="brown">+</span> <span class="blue1">File</span><span class="brown">.LastError)</span></p>&#13;
<p class="listcap"><a id="ch19ex4"/><em>Listing 19-4: Writing to a file when the path doesn’t exist</em></p>&#13;
<p class="indent">You should see this output:</p>&#13;
<p class="programs">FAILED: Could not find a part of the path 'C:\Temp\Folder1\Out.txt'.</p>&#13;
<p class="indent">The program attempts to write the string <span class="literal">"Hello"</span> to an output file (lines 2–3). The directory <em>Temp</em> exists, but the subdirectory <em>Folder1</em> doesn’t exist, so <span class="literal">WriteContents()</span> fails.</p>&#13;
<h5 class="h5" id="ch19lev3sec05"><strong>Appending to a File</strong></h5>&#13;
<p class="noindent">The <span class="literal">AppendContents()</span> method opens the specified file and adds data to the end of the file without erasing its original contents. <span class="literal">AppendContents()</span> takes two arguments: the pathname of the output file and the string you want to append to the end of the file. If the operation is successful, the method returns <span class="literal">"SUCCESS"</span>; otherwise, it returns <span class="literal">"FAILED"</span>. If the file you pass to <span class="literal">AppendContents()</span> doesn’t exist, it’s created for you, and the string is written to it. If the file already exists, the string is appended to its end.</p>&#13;
<p class="indent">To see the <span class="literal">AppendContents()</span> method in use, let’s say you need to maintain a log file that records actions, errors, and other events in your program. To keep the program simple, let’s just record the times when your program is executed. Every time your program runs, you add a record to a log file that includes the date and time. The complete program is shown in <a href="ch19.html#ch19ex5">Listing 19-5</a>.</p>&#13;
<p class="programs"> 1 <span class="green"><span class="codeitalic">' AppendContentsDemo.sb</span></span><br/> 2 outFile <span class="brown">=</span> <span class="blue1">Program</span><span class="brown">.Directory +</span> <span class="red">"\Log.txt"</span><br/> 3<br/> 4 strLog <span class="brown">=</span> <span class="blue1">Clock</span><span class="brown">.WeekDay +</span> <span class="red">", "</span> <span class="brown">+</span> <span class="blue1">Clock</span><span class="brown">.Date +</span> <span class="red">", "</span> <span class="brown">+</span> <span class="blue1">Clock</span><span class="brown">.Time</span><br/> 5 result <span class="brown">=</span> <span class="blue1">File</span><span class="brown">.AppendContents(</span>outFile<span class="brown">,</span> strLog<span class="brown">)</span><br/> 6 <span class="purple"><span class="codestrong">If</span></span> <span class="brown">(</span>result <span class="brown">=</span> <span class="red">"FAILED"</span><span class="brown">)</span> <span class="purple"><span class="codestrong">Then</span></span><br/> 7   <span class="blue1">TextWindow</span><span class="brown">.WriteLine(</span><span class="red">"Failed to write to: "</span> <span class="brown">+</span> outFile<span class="brown">)</span><br/> 8   <span class="blue1">TextWindow</span><span class="brown">.WriteLine(</span><span class="blue1">File</span><span class="brown">.LastError)</span><br/> 9 <span class="purple"><span class="codestrong">EndIf</span></span><br/>10<br/>11 <span class="blue1">TextWindow</span><span class="brown">.WriteLine(</span><span class="red">"Thank you for using this program. And for using</span><br/>   <span class="red">deodorant."</span><span class="brown">)</span></p>&#13;
<p class="listcap"><a id="ch19ex5"/><em>Listing 19-5: Demonstrating the</em> <span class="literal"><span class="codeitalic">AppendContents()</span></span> <em>method</em></p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_296"/>When you run this program, it creates a log string that contains the current day of the week, date, and time (line 4), and it appends this string to the end of a log file named <em>Log.txt</em> that is in the program’s directory (line 5). If writing to the file fails, the program displays an error message explaining the cause of the failure (lines 7–8). Then the program displays a message (line 11) and ends.</p>&#13;
<p class="indent">Each time you run this program, a new line is appended to the end of the <em>Log.txt</em> file. Here’s the output of <em>Log.txt</em> after running the program three times:</p>&#13;
<p class="programs">Sunday, 7/19/2015, 12:40:39 PM<br/>Sunday, 7/19/2015, 12:43:21 PM<br/>Sunday, 7/19/2015, 12:47:25 PM</p>&#13;
<h5 class="h5" id="ch19lev3sec06"><strong>ReadLine(), WriteLine(), and InsertLine()</strong></h5>&#13;
<p class="noindent">The <span class="literal">ReadContents()</span> and <span class="literal">WriteContents()</span> methods let you read and write the entire contents of a file at once. Sometimes this is just what you need. But in other situations, reading or writing one line at a time might be better.</p>&#13;
<p class="indent">The <span class="literal">File</span> object provides the <span class="literal">ReadLine()</span> method for reading a single line of text from a file. A line of text consists of a string of characters that ends with a carriage return and line feed pair. <span class="literal">ReadLine()</span> reads all the text on that line up to (but not including) the carriage return character. This method takes two arguments: the path of the file and the line number of the text to be read. The first line of a file is line number 1, the second line is 2, and so on. If the file contains the specified line number, the method returns the text at that line. Otherwise, it returns an empty string.</p>&#13;
<p class="indent">The <span class="literal">File</span> object also provides the <span class="literal">WriteLine()</span> method for outputting a line of text to a file. This method takes three arguments: the path of the file, the line number to write text to, and the text to write. Keep the following information in mind when you’re using this method:</p>&#13;
<ol>&#13;
<li><p class="noindenta">If the file doesn’t exist, <span class="literal">WriteLine()</span> creates it.</p></li>&#13;
<li><p class="noindenta">If the file contains the specified line number, <span class="literal">WriteLine()</span> overwrites that line.</p></li>&#13;
<li><p class="noindenta">If the specified line number is larger than the number of lines in the file, the specified text is appended to the end of the file. For example, if the file contains three lines and you ask <span class="literal">WriteLine()</span> to write new text at line 100, the specified text is written at line 4.</p></li>&#13;
<li><p class="noindenta"><span class="literal">WriteLine()</span> automatically writes a carriage return and line feed at the end of the passed text. This means you don’t have to append these characters to your strings manually.</p></li>&#13;
<li><p class="noindenta">If the operation is successful, <span class="literal">WriteLine()</span> returns <span class="literal">"SUCCESS"</span>; otherwise, it returns <span class="literal">"FAILED"</span>.</p></li>&#13;
</ol>&#13;
<p class="indent">In addition to <span class="literal">ReadLine()</span> and <span class="literal">WriteLine()</span>, the <span class="literal">File</span> object provides the <span class="literal">InsertLine()</span> method for you to insert a line of text into a file, at a specified <span epub:type="pagebreak" id="page_297"/>line number. As with the <span class="literal">WriteLine()</span> method, this method takes three arguments: the path of the file, the line number where you want the new text to be inserted, and the text you want to insert. <span class="literal">InsertLine()</span> won’t overwrite any existing content at the specified line. If the operation is successful, <span class="literal">InsertLine()</span> returns <span class="literal">"SUCCESS"</span>; otherwise, it returns <span class="literal">"FAILED"</span>.</p>&#13;
<p class="indent">As an example, let’s write a simple program that creates login names from the first and last names of users. The program will read an input file that contains the first and last names of users, and it will create an output file that contains the login names for these users. The login name for a user is composed of the first letter of the user’s first name and up to five characters from their last name. For example, if the user’s name is Jack Skellington, his login name is <em>jskell</em>. If the user’s name is Stan Lee (three-letter last name), his login name will be <em>slee</em>. The complete program is shown in <a href="ch19.html#ch19ex6">Listing 19-6</a>.</p>&#13;
<p class="programs"> 1 <span class="green"><span class="codeitalic">' LoginName.sb</span></span><br/> 2 inFile <span class="brown">=</span> <span class="blue1">Program</span><span class="brown">.Directory +</span> <span class="red">"\Users.txt"</span><br/> 3 outFile <span class="brown">=</span> <span class="blue1">Program</span><span class="brown">.Directory +</span> <span class="red">"\LoginNames.txt"</span><br/> 4<br/> 5 N <span class="brown">=</span> <span class="red">1</span>             <span class="green"><span class="codeitalic">' Tracks the line number</span></span><br/> 6 <span class="purple"><span class="codestrong">While</span></span> <span class="brown">(</span>N <span class="brown">&gt;</span> <span class="red">0</span><span class="brown">)</span>     <span class="green"><span class="codeitalic">' We'll set N = 0 when we detect end of file</span></span><br/> 7   strLine <span class="brown">=</span> <span class="blue1">File</span><span class="brown">.ReadLine(</span>inFile<span class="brown">,</span> N<span class="brown">)</span>      <span class="green"><span class="codeitalic">' Reads the Nth line</span></span><br/> 8   <span class="purple"><span class="codestrong">If</span></span> <span class="brown">(</span>strLine <span class="brown">=</span> <span class="red">""</span><span class="brown">)</span> <span class="purple"><span class="codestrong">Then</span></span>                  <span class="green"><span class="codeitalic">' If the string's empty</span></span><br/> 9     N <span class="brown">=</span> <span class="red">0</span>                                 <span class="green"><span class="codeitalic">' Exits the While loop</span></span><br/>10   <span class="purple"><span class="codestrong">Else</span></span>                                    <span class="green"><span class="codeitalic">' We have an entry</span></span><br/>11     idx <span class="brown">=</span> <span class="blue1">Text</span><span class="brown">.GetIndexOf(</span>strLine<span class="brown">,</span> <span class="red">" "</span><span class="brown">)</span>   <span class="green"><span class="codeitalic">' Finds space in strLine</span></span><br/>12     firstChar <span class="brown">=</span> <span class="blue1">Text</span><span class="brown">.GetSubText(</span>strLine<span class="brown">,</span> <span class="red">1</span><span class="brown">,</span> <span class="red">1</span><span class="brown">)</span><br/>13     lastName <span class="brown">=</span> <span class="blue1">Text</span><span class="brown">.GetSubText(</span>strLine<span class="brown">,</span> idx <span class="brown">+</span> <span class="red">1</span><span class="brown">,</span> <span class="red">5</span><span class="brown">)</span><br/>14     loginName <span class="brown">=</span> firstChar <span class="brown">+</span> lastName<br/>15     loginName <span class="brown">=</span> <span class="blue1">Text</span><span class="brown">.ConvertToLowerCase(</span>loginName<span class="brown">)</span><br/>16     <span class="blue1">File</span><span class="brown">.WriteLine(</span>outFile<span class="brown">,</span> N<span class="brown">,</span> loginName<span class="brown">)</span> <span class="green"><span class="codeitalic">' Saves to a file</span></span><br/>17     N <span class="brown">=</span> N <span class="brown">+</span> <span class="red">1</span>                             <span class="green"><span class="codeitalic">' Gets ready for the next line</span></span><br/>18   <span class="purple"><span class="codestrong">EndIf</span></span><br/>19 <span class="purple"><span class="codestrong">EndWhile</span></span></p>&#13;
<p class="listcap"><a id="ch19ex6"/><em>Listing 19-6: Creating login names from first and last names</em></p>&#13;
<p class="indent">We start by giving the paths for the input and output files (lines 2–3). We then start a loop to read the contents of the input file, one line at a time (lines 6–19). After reading a line (line 7), we check whether that line is empty, and if it is (line 8), we set <span class="literal">N</span> equal to 0 to end the loop (line 9). Otherwise, we process the user’s name that is read from the input file to create the lowercase login name (lines 11–15). First, we find the space between the first name and the last name (line 11). Next, we get the first letter of the first name (line 12) and the first five letters of the last name (line 13), combine them to create the login name (line 14), and convert the login name to lowercase (line 15). Then we write the login name to the output file (line 16) and increment <span class="literal">N</span> by 1 to read the next line in the input file (line 17).</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_298"/>To keep the code simple, we didn’t add error-checking code. We also assumed that the input file was properly formatted: each line contained a user’s first and last names separated by a single space. <a href="ch19.html#ch19table2">Table 19-2</a> shows an example input file for this program and the output file.</p>&#13;
<p class="tablecap"><a id="ch19table2"/><strong>Table 19-2:</strong> Creating Login Names</p>&#13;
<table class="topbot">&#13;
<thead>&#13;
<tr>&#13;
<td class="table_th" style="vertical-align: top;"><p class="table"><strong>User’s name</strong></p></td>&#13;
<td class="table_th" style="vertical-align: top;"><p class="table"><strong>Login name</strong></p></td>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td style="vertical-align: top;"><p class="table">Tina Fey</p></td>&#13;
<td style="vertical-align: top;"><p class="table"><em>tfey</em></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;"><p class="table">Jimmy Fallon</p></td>&#13;
<td style="vertical-align: top;"><p class="table"><em>jfallo</em></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;"><p class="table">David Letterman</p></td>&#13;
<td style="vertical-align: top;"><p class="table"><em>dlette</em></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;"><p class="table">Jay Leno</p></td>&#13;
<td style="vertical-align: top;"><p class="table"><em>jleno</em></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;"><p class="table">Amy Poehler</p></td>&#13;
<td style="vertical-align: top;"><p class="table"><em>apoehl</em></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<div class="sidebar">&#13;
<p class="sidebart" id="ch19sb02"><strong>TRY IT OUT 19-2</strong></p>&#13;
<p class="noindent">Write a program that reads an input file and counts the number of lines, characters, and spaces it contains.</p>&#13;
</div>&#13;
<h4 class="h4" id="ch19lev2sec04"><em><strong>File Management</strong></em></h4>&#13;
<p class="noindent">In addition to the methods that let you perform file I/O, the <span class="literal">File</span> object also provides a couple of methods related to file and directory management. Using these methods, you can copy and delete files, create and delete directories, and list files and directories from your program.</p>&#13;
<h5 class="h5" id="ch19lev3sec07"><strong>Copying and Deleting Files</strong></h5>&#13;
<p class="noindent">You can use the <span class="literal">CopyFile()</span> method to create a copy of an existing file. This method takes the pathnames of the source file and the destination file as arguments. The source file isn’t affected by this operation. If the operation is successful, the method returns <span class="literal">"SUCCESS"</span>. Otherwise, it returns <span class="literal">"FAILED"</span>.</p>&#13;
<p class="indent">If the destination path points to a location that doesn’t exist, the method attempts to create it automatically. For example, look at the following code:</p>&#13;
<p class="programs">srcPath <span class="brown">=</span> <span class="red">"C:\Temp\Test1.txt"</span>              <span class="green"><span class="codeitalic">' Path of the source file</span></span><br/>dstPath <span class="brown">=</span> <span class="red">"C:\Temp\Temp1\Temp2\Test1.txt"</span>  <span class="green"><span class="codeitalic">' Path of the destination file</span></span><br/><span class="blue1">File</span><span class="brown">.CopyFile(</span>srcPath<span class="brown">,</span> dstPath<span class="brown">)</span></p>&#13;
<p class="indent">If the subfolders <em>Temp</em>, <em>Temp1</em>, and <em>Temp2</em> don’t exist, <span class="literal">CopyFile()</span> attempts to create all the directories in the destination path, beginning with the root. When you run this code, you’ll have two copies of the <em>Test1.txt</em> file: the original source file and the duplicate file under <em>C:\Temp\Temp1\Temp2</em>.</p>&#13;
<div class="note">&#13;
<p class="notet"><span epub:type="pagebreak" id="page_299"/><span class="notes"><strong>WARNING</strong></span></p>&#13;
<p class="notep"><em>If the destination path points to an existing file, that file will be overwritten. So be careful when you use the</em> <span class="literal"><span class="codeitalic">CopyFile()</span></span> <em>method, because you might overwrite some of your files!</em></p>&#13;
</div>&#13;
<p class="indent">If you want to delete a file, use the <span class="literal">DeleteFile()</span> method. This method takes one argument: the pathname of the file you want to delete. If the operation is successful, the method returns <span class="literal">"SUCCESS"</span>. Otherwise, it returns <span class="literal">"FAILED"</span>.</p>&#13;
<div class="note">&#13;
<p class="notet"><span class="notes"><strong>WARNING</strong></span></p>&#13;
<p class="notep"><em>The deleted file doesn’t go to the recycle bin; instead, it’s completely deleted from your system. So be extra careful when you use the</em> <span class="literal"><span class="codeitalic">DeleteFile()</span></span> <em>method!</em></p>&#13;
</div>&#13;
<p class="indent">Using <span class="literal">CopyFile()</span> and <span class="literal">DeleteFile()</span>, you can create your own subroutines for moving and renaming files. To move a file to a new location, copy the file to the new location and then delete the original file. To rename a file, make a copy of the file, give the copy a new name, and then delete the original file.</p>&#13;
<h5 class="h5" id="ch19lev3sec08"><strong>Creating and Deleting Directories</strong></h5>&#13;
<p class="noindent">You can easily create or delete a directory. The <span class="literal">CreateDirectory()</span> method takes a single argument: the pathname of the directory you want to create. If the directories don’t exist, the method attempts to create all the directories in the path, beginning with the root. If the operation is successful, the method returns <span class="literal">"SUCCESS"</span>. Otherwise, it returns <span class="literal">"FAILED"</span>. Here’s an example:</p>&#13;
<p class="programs"><span class="blue1">File</span><span class="brown">.CreateDirectory(</span><span class="red">"C:\Temp\Temp1\Temp2"</span><span class="brown">)</span></p>&#13;
<p class="indent">If the directories <em>C:\Temp</em>, <em>C:\Temp\Temp1</em>, and <em>C:\Temp\Temp1\Temp2</em> don’t exist, <span class="literal">CreateDirectory()</span> creates them. If the directory path already exists, the function does nothing and returns <span class="literal">"SUCCESS"</span>.</p>&#13;
<p class="indent">The <span class="literal">DeleteDirectory()</span> method also takes a single argument: the pathname of the directory you want to delete. All files and folders under the path are deleted. If the operation is successful, the method returns <span class="literal">"SUCCESS"</span>. Otherwise, it returns <span class="literal">"FAILED"</span>. <a href="ch19.html#ch19fig5">Figure 19-5</a> shows an example of <span class="literal">DeleteDirectory()</span>.</p>&#13;
<div class="image"><img alt="image" src="graphics/f19-05.jpg"/></div>&#13;
<p class="figcap"><a id="ch19fig5"/><em>Figure 19-5: Demonstrating the</em> <span class="literal"><span class="codeitalic">DeleteDirectory()</span></span> <em>method</em></p>&#13;
<div class="note">&#13;
<p class="notet"><span epub:type="pagebreak" id="page_300"/><span class="notes"><strong>WARNING</strong></span></p>&#13;
<p class="notep"><em>When you call</em> <span class="literal"><span class="codeitalic">DeleteDirectory()</span></span>, <em>all the files and folders under the pathname are deleted. So make sure you don’t have any files tucked away that you don’t want to delete!</em></p>&#13;
</div>&#13;
<h5 class="h5" id="ch19lev3sec09"><strong>List Files and Directories</strong></h5>&#13;
<p class="noindent">The <span class="literal">File</span> object includes the <span class="literal">GetFiles()</span> method, which lets you list all the files in a directory. This method takes the path of the target directory as its argument. The example in <a href="ch19.html#ch19ex7">Listing 19-7</a> shows you how to use this method.</p>&#13;
<p class="programs">1 <span class="green"><span class="codeitalic">' GetFilesDemo.sb</span></span><br/>2 path <span class="brown">=</span> <span class="red">"D:\Temp"</span><br/>3 fileArray <span class="brown">=</span> <span class="blue1">File</span><span class="brown">.GetFiles(</span>path<span class="brown">)</span><br/>4 count <span class="brown">=</span> <span class="blue1">Array</span><span class="brown">.GetItemCount(</span>fileArray<span class="brown">)</span><br/>5 <span class="blue1">TextWindow</span><span class="brown">.WriteLine(</span>path <span class="brown">+</span> <span class="red">" contains "</span> <span class="brown">+</span> count <span class="brown">+</span> <span class="red">" files:"</span><span class="brown">)</span><br/>6 <span class="purple"><span class="codestrong">For</span></span> N <span class="brown">=</span> <span class="red">1</span> <span class="purple"><span class="codestrong">To</span></span> count<br/>7   <span class="blue1">TextWindow</span><span class="brown">.WriteLine(</span><span class="red">" "</span> <span class="brown">+</span> fileArray[N]<span class="brown">)</span><br/>8 <span class="purple"><span class="codestrong">EndFor</span></span></p>&#13;
<p class="listcap"><a id="ch19ex7"/><em>Listing 19-7: Demonstrating the</em> <span class="literal"><span class="codeitalic">GetFiles()</span></span> <em>method</em></p>&#13;
<p class="indent">Here is the output after running this program (change the <span class="literal">path</span> variable in line 2 to a directory on your computer):</p>&#13;
<p class="programs">D:\Temp contains 3 files:<br/>  D:\Temp\Fig01.bmp<br/>  D:\Temp\keys.txt<br/>  D:\Temp\Test.sb</p>&#13;
<p class="indent">We start by specifying the path of the directory we want to list (line 2). Next, we call <span class="literal">GetFiles()</span> with the desired path (line 3). This method creates an array that contains the pathnames of all the files in the directory; we save the identifier of the returned array in <span class="literal">fileArray</span>. Then we call <span class="literal">GetItemCount()</span> to find out the number of elements in the returned array (line 4) and use a <span class="literal">For</span> loop to display its elements (lines 6–8).</p>&#13;
<div class="note">&#13;
<p class="notet"><span class="notes"><strong>NOTE</strong></span></p>&#13;
<p class="notep"><em>If</em> <span class="literal"><span class="codeitalic">GetFiles()</span></span> <em>fails, then</em> <span class="literal"><span class="codeitalic">fileArray</span></span> <em>stores the string</em> <span class="literal"><span class="codeitalic">"FAILED"</span></span><em>. In this case, the call to</em> <span class="literal"><span class="codeitalic">Array.GetItemCount(fileArray)</span></span> <em>returns</em> <span class="literal"><span class="codeitalic">0</span></span><em>. So you might not need to perform an extra check on the return of</em> <span class="literal"><span class="codeitalic">GetFiles()</span></span>.</p>&#13;
</div>&#13;
<p class="indent">The <span class="literal">GetDirectories()</span> method lets you list all the subdirectories in a given directory. <a href="ch19.html#ch19ex8">Listing 19-8</a> shows an example of this method.</p>&#13;
<p class="programs">1 <span class="green"><span class="codeitalic">' GetDirectoriesDemo.sb</span></span><br/>2 path <span class="brown">=</span> <span class="red">"D:\Temp"</span><br/>3 dirArray <span class="brown">=</span> <span class="blue1">File</span><span class="brown">.GetDirectories(</span>path<span class="brown">)</span><br/>4 count <span class="brown">=</span> <span class="blue1">Array</span><span class="brown">.GetItemCount(</span>dirArray<span class="brown">)</span><br/>5 <span class="blue1">TextWindow</span><span class="brown">.WriteLine(</span>path <span class="brown">+</span> <span class="red">" contains "</span> <span class="brown">+</span> count <span class="brown">+</span> <span class="red">" directories:"</span><span class="brown">)</span><br/>6 <span class="purple"><span class="codestrong">For</span></span> N <span class="brown">=</span> <span class="red">1</span> <span class="purple"><span class="codestrong">To</span></span> count                        <span class="green"><span class="codeitalic">' Displays the array's elements</span></span><br/>7   <span class="blue1">TextWindow</span><span class="brown">.WriteLine(</span><span class="red">" "</span> <span class="brown">+</span> dirArray[N]<span class="brown">)</span><br/>8 <span class="purple"><span class="codestrong">EndFor</span></span></p>&#13;
<p class="listcap"><a id="ch19ex8"/><em>Listing 19-8: Demonstrating the</em> <span class="literal"><span class="codeitalic">GetDirectories()</span></span> <em>method</em></p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_301"/>Here is the output after running this program:</p>&#13;
<p class="programs">D:\Temp contains 3 directories:<br/>  D:\Temp\Chapter01<br/>  D:\Temp\Chapter02<br/>  D:\Temp\Chapter03</p>&#13;
<p class="indent">But your output will probably look different, depending on what your <em>Temp</em> directory looks like. This program is similar to <a href="ch19.html#ch19ex7">Listing 19-7</a>. We start by storing the path we’re interested in (line 2). Next, we call <span class="literal">GetDirectories()</span> with the path (line 3). This method creates an array that contains the pathnames of all the directories in the specified path; we save the identifier of the returned array in <span class="literal">dirArray</span>. Then we call <span class="literal">GetItemCount()</span> to find out the number of elements in the returned array (line 4) and use a <span class="literal">For</span> loop to display its elements (lines 6–8). Try changing line 2 to access a different directory.</p>&#13;
<p class="indent">At this point, we’ve covered everything you need to know about the <span class="literal">File</span> object. Let’s put some of this newfound knowledge to work to create some cool applications!</p>&#13;
<h3 class="h3" id="ch19lev1sec03"><span class="blue"><strong>Practical Programs</strong></span></h3>&#13;
<p class="noindent">We’ll present two programs intended to highlight different aspects of file I/O and give you some ideas and new techniques that you can use in your own creations.</p>&#13;
<h4 class="h4" id="ch19lev2sec05"><em><strong>The Poet</strong></em></h4>&#13;
<p class="noindent">In this example, we’ll modify the Poet program we created in <a href="ch16.html#ch16">Chapter 16</a> so it reads its input from files instead of hardcoding the word lists into the program. By doing so, your program will be more awesome and concise, and it will be easy to add words to!</p>&#13;
<p class="indent">The program uses five input files: <em>article.txt</em>, <em>adjective.txt</em>, <em>noun.txt</em>, <em>verb.txt</em>, and <em>preposition.txt</em>. The <em>article.txt</em> file contains a list of articles and qualifiers; the <em>adjective.txt</em> file contains a list of adjectives, and so on. To take advantage of the way Small Basic handles arrays, each of the five files is formatted to make it easy to be read into an array in your program.</p>&#13;
<p class="indent">Look at this statement:</p>&#13;
<p class="programs">art <span class="brown">=</span> <span class="blue1">File</span><span class="brown">.ReadContents(</span><span class="red">"article.txt"</span><span class="brown">)</span></p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_302"/>We automatically load the contents of the <em>article.txt</em> file into an array named <span class="literal">art</span> that contains the five elements shown in <a href="ch19.html#ch19fig6">Figure 19-6</a>.</p>&#13;
<div class="image"><img alt="image" src="graphics/f19-06.jpg"/></div>&#13;
<p class="figcap"><a id="ch19fig6"/><em>Figure 19-6: Reading the contents of</em> article.txt <em>into an array named</em> <span class="literal"><span class="codeitalic">art</span></span></p>&#13;
<p class="indent">Open the file <em>Poet_Incomplete.sb</em> from this chapter’s folder, which also contains the background image and the five input files we’ll need. The file has an empty placeholder for the <span class="literal">CreateLists()</span> subroutine, which you’ll add now. This subroutine is shown in <a href="ch19.html#ch19ex9">Listing 19-9</a>.</p>&#13;
<p class="programs">1 <span class="purple"><span class="codestrong">Sub</span></span> CreateLists<br/>2   article <span class="brown">=</span> <span class="blue1">File</span><span class="brown">.ReadContents(</span>path <span class="brown">+</span> <span class="red">"\article.txt"</span><span class="brown">)</span><br/>3   adjective <span class="brown">=</span> <span class="blue1">File</span><span class="brown">.ReadContents(</span>path <span class="brown">+</span> <span class="red">"\adjective.txt"</span><span class="brown">)</span><br/>4   noun <span class="brown">=</span> <span class="blue1">File</span><span class="brown">.ReadContents(</span>path <span class="brown">+</span> <span class="red">"\noun.txt"</span><span class="brown">)</span><br/>5   verb <span class="brown">=</span> <span class="blue1">File</span><span class="brown">.ReadContents(</span>path <span class="brown">+</span> <span class="red">"\verb.txt"</span><span class="brown">)</span><br/>6   prepos <span class="brown">=</span> <span class="blue1">File</span><span class="brown">.ReadContents(</span>path <span class="brown">+</span> <span class="red">"\preposition.txt"</span><span class="brown">)</span><br/>7 <span class="purple"><span class="codestrong">EndSub</span></span></p>&#13;
<p class="listcap"><a id="ch19ex9"/><em>Listing 19-9: The</em> <span class="literal"><span class="codeitalic">CreateLists()</span></span> <em>subroutine</em></p>&#13;
<p class="indent">Run this program. It should work the same way as before but with an advantage: the user can now change the input files to create their own custom poems.</p>&#13;
<h4 class="h4" id="ch19lev2sec06"><em><strong>Math Wizard</strong></em></h4>&#13;
<p class="noindent">In this example, we’ll create a program featuring a wizard who seems to know a lot about math. The wizard isn’t Merlin, Gandalf, or Harry Potter: welcome to the world of the Math Wizard! The wizard starts by asking the user to think of a <em>secret</em> number. He then requests that the user perform some mathematical operations on that number (such as doubling the number, subtracting 2, dividing the answer by 10, and so on). At the end, the wizard uses his magical powers to tell the user the resulting number after performing these operations (although he doesn’t know the user’s secret number)!</p>&#13;
<p class="indent">The idea of the program is very simple. We’ll save each math puzzle in a text file that has the format shown in <a href="ch19.html#ch19fig7">Figure 19-7</a>. The first line contains the puzzle’s answer, and the remaining lines contain the instructions that the <span epub:type="pagebreak" id="page_303"/>wizard asks the user to perform. This program includes 11 puzzles saved in <em>Puzzle01.txt</em>, <em>Puzzle02.txt</em>, <em>..., Puzzle11.txt</em>. You can add more puzzles by creating additional puzzle files (follow the format shown in <a href="ch19.html#ch19fig7">Figure 19-7</a>).</p>&#13;
<div class="image"><img alt="image" src="graphics/f19-07.jpg"/></div>&#13;
<p class="figcap"><a id="ch19fig7"/><em>Figure 19-7: The format of a puzzle file</em></p>&#13;
<p class="indent">The strategy for developing this program is outlined as follows:</p>&#13;
<ol>&#13;
<li><p class="noindenta">When the program starts, we’ll list the files in the program’s directory to get the pathnames of the puzzle files.</p></li>&#13;
<li><p class="noindenta">For each round of the program, we’ll select one of the available puzzles.</p></li>&#13;
<li><p class="noindenta">We read the first line of the selected puzzle’s file and interpret it as the puzzle’s answer. The remaining lines represent the instructions the wizard displays.</p></li>&#13;
<li><p class="noindenta">The wizard displays the puzzle’s instructions one by one until the program reaches an empty line. The wizard asks the user to press <small>ENTER</small> after each instruction.</p></li>&#13;
<li><p class="noindenta">The wizard displays the puzzle’s answer.</p></li>&#13;
</ol>&#13;
<p class="indent">Open the <em>Wizard_Incomplete.sb</em> file from this chapter’s folder. This file contains the program’s main code, shown in <a href="ch19.html#ch19ex10">Listing 19-10</a>, and empty placeholders for the <span class="literal">DoPuzzle()</span> subroutine that you’ll add. The folder also contains the text files for the 11 premade puzzles.</p>&#13;
<p class="programs"> 1 <span class="green"><span class="codeitalic">' Wizard_Incomplete.sb</span></span><br/> 2 <span class="blue1">TextWindow</span><span class="brown">.Title =</span> <span class="red">"MATH WIZARD"</span><br/> 3 <span class="blue1">TextWindow</span><span class="brown">.WriteLine(</span><span class="red">"========== MATH WIZARD =========="</span><span class="brown">)</span><br/> 4 <span class="blue1">TextWindow</span><span class="brown">.WriteLine(</span><span class="red">"Press Enter after each instruction"</span><span class="brown">)</span><br/> 5 <span class="blue1">TextWindow</span><span class="brown">.WriteLine(</span><span class="red">"=================================="</span><span class="brown">)</span><br/> 6 <span class="blue1">TextWindow</span><span class="brown">.WriteLine(</span><span class="red">""</span><span class="brown">)</span><br/> 7<br/> 8 puzzle <span class="brown">=</span> <span class="blue1">File</span><span class="brown">.GetFiles(</span><span class="blue1">Program</span><span class="brown">.Directory)</span> <span class="green"><span class="codeitalic">' Stores filenames into an array</span></span><br/> 9<br/>10 <span class="purple"><span class="codestrong">For</span></span> P <span class="brown">=</span> <span class="red">1</span> <span class="purple"><span class="codestrong">To</span></span> <span class="blue1">Array</span><span class="brown">.GetItemCount(</span>puzzle<span class="brown">)</span><br/>11   path <span class="brown">=</span> puzzle[P]                        <span class="green"><span class="codeitalic">' File in the app's directory</span></span><br/>12   <span class="purple"><span class="codestrong">If</span></span> <span class="brown">(</span><span class="blue1">Text</span><span class="brown">.EndsWith(</span>path<span class="brown">,</span> <span class="red">".txt"</span><span class="brown">)=</span> <span class="red">"True"</span><span class="brown">)</span> <span class="purple"><span class="codestrong">Then</span></span><br/>13     DoPuzzle<span class="brown">()</span><br/>14   <span class="purple"><span class="codestrong">EndIf</span></span><br/>15 <span class="purple"><span class="codestrong">EndFor</span></span><br/>16 <span class="blue1">TextWindow</span><span class="brown">.WriteLine(</span><span class="red">"The game was won, the math was fun, and the magic is</span><br/>   <span class="red">done!"</span><span class="brown">)</span><br/>17 <span class="blue1">TextWindow</span><span class="brown">.WriteLine(</span><span class="red">"There is one Math Wizard to rule them all! Bye!"</span><span class="brown">)</span></p>&#13;
<p class="listcap"><a id="ch19ex10"/><em>Listing 19-10: The main code of the Math Wizard program</em></p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_304"/>After displaying the program’s title and its instructions (lines 2–6), we call <span class="literal">GetFiles()</span> to get a list of all the files in the program’s directory, and we save the identifier of the returned array in the <span class="literal">puzzle</span> variable (line 8). We then start a loop to process the files we found (lines 10–15). In each iteration, we get one pathname from the <span class="literal">puzzle</span> array (line 11) and check whether it has a <em>.txt</em> extension (line 12). If the file has a <em>.txt</em> extension (which means it contains a puzzle), we call <span class="literal">DoPuzzle()</span> to show that puzzle to the user (line 13). The program ends with a message from the Math Wizard (lines 16–17).</p>&#13;
<p class="indent">Add the <span class="literal">DoPuzzle()</span> subroutine shown in <a href="ch19.html#ch19ex11">Listing 19-11</a> to the bottom of the <em>Wizard_Incomplete.sb</em> program.</p>&#13;
<p class="programs"> 1 <span class="purple"><span class="codestrong">Sub</span></span> DoPuzzle<br/> 2   puzzleAns <span class="brown">=</span> <span class="blue1">File</span><span class="brown">.ReadLine(</span>path<span class="brown">,</span> <span class="red">1</span><span class="brown">)</span>   <span class="green"><span class="codeitalic">' Reads answer from first line</span></span><br/> 3   N <span class="brown">=</span> <span class="red">2</span>                                <span class="green"><span class="codeitalic">' Starts from second line</span></span><br/> 4   line <span class="brown">=</span> <span class="red">"?"</span>                           <span class="green"><span class="codeitalic">' To enter the loop</span></span><br/> 5   <span class="purple"><span class="codestrong">While</span></span> <span class="brown">(</span>line <span class="brown">&lt;&gt;</span> <span class="red">""</span><span class="brown">)</span>                   <span class="green"><span class="codeitalic">' Loops as long as we have instructions</span></span><br/> 6     line <span class="brown">=</span> <span class="blue1">File</span><span class="brown">.ReadLine(</span>path<span class="brown">,</span> N<span class="brown">)</span>      <span class="green"><span class="codeitalic">' Reads the Nth line</span></span><br/> 7     <span class="purple"><span class="codestrong">If</span></span> <span class="brown">(</span>line <span class="brown">&lt;&gt;</span> <span class="red">""</span><span class="brown">)</span> <span class="purple"><span class="codestrong">Then</span></span>               <span class="green"><span class="codeitalic">' If we have an instruction</span></span><br/> 8       <span class="blue1">TextWindow</span><span class="brown">.Write(</span>line <span class="brown">+</span> <span class="red">"... "</span><span class="brown">)</span>  <span class="green"><span class="codeitalic">' Writes instruction</span></span><br/> 9       <span class="blue1">TextWindow</span><span class="brown">.PauseWithoutMessage()</span> <span class="green"><span class="codeitalic">' Waits for user to press a key</span></span><br/>10       <span class="blue1">TextWindow</span><span class="brown">.WriteLine(</span><span class="red">""</span><span class="brown">)</span><br/>11       N <span class="brown">=</span> N <span class="brown">+</span> <span class="red">1</span>                        <span class="green"><span class="codeitalic">' Prepares to read next line</span></span><br/>12     <span class="purple"><span class="codestrong">EndIf</span></span><br/>13   <span class="purple"><span class="codestrong">EndWhile</span></span><br/>14   <span class="blue1">TextWindow</span><span class="brown">.WriteLine(</span><span class="red">"You still have: "</span> <span class="brown">+</span> puzzleAns<span class="brown">)</span><br/>15   <span class="blue1">TextWindow</span><span class="brown">.WriteLine(</span><span class="red">""</span><span class="brown">)</span><br/>16 <span class="purple"><span class="codestrong">EndSub</span></span></p>&#13;
<p class="listcap"><a id="ch19ex11"/><em>Listing 19-11: The</em> <span class="literal"><span class="codeitalic">DoPuzzle()</span></span> <em>subroutine</em></p>&#13;
<p class="indent">We read the first line from the file and save it in <span class="literal">puzzleAns</span> (line 2). Next, we set <span class="literal">N</span> to 2 to read the second line of the file and set the <span class="literal">line</span> string to <span class="literal">"?"</span> to enter the <span class="literal">While</span> loop (lines 3–4). In each iteration of the loop, we read one line from the puzzle’s file (line 6) and check whether the program reached the last instruction. If <span class="literal">line</span> is not empty (line 7), we display the instruction the program just read (line 8) and wait for the user to press any key (line 9). When the player presses any key, we increment <span class="literal">N</span> to read the next instruction in the file (line 11). When the program reads an empty line, the <span class="literal">While</span> loop ends, and the program moves to line 14, where we display the puzzle’s answer followed by an empty line (lines 14–15).</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_305"/><a href="ch19.html#ch19fig8">Figure 19-8</a> shows a sample run of the program.</p>&#13;
<div class="image"><img alt="image" src="graphics/f19-08.jpg"/></div>&#13;
<p class="figcap"><a id="ch19fig8"/><em>Figure 19-8: Sample output of the Math Wizard program</em></p>&#13;
<div class="sidebar">&#13;
<p class="sidebart" id="ch19sb03"><strong>TRY IT OUT 19-3</strong></p>&#13;
<p class="noindent">Think of ways to improve the Math Wizard program, and try to implement them. For example, add some colors to make the output look fancier or draw something after each puzzle.</p>&#13;
</div>&#13;
<h3 class="h3a" id="ch19lev1sec04"><span class="blues"><strong>Programming Challenges</strong></span></h3>&#13;
<p class="noindent">If you get stuck, check out <em><a href="http://nostarch.com/smallbasic/">http://nostarch.com/smallbasic/</a></em> for the solutions and for more resources and review questions for teachers and students.</p>&#13;
<ol>&#13;
<li><p class="noindenta">Let’s write a spelling quiz game using homonyms. Homonyms are words that sound the same but have different meanings. Use Notepad to create the following text file:</p>&#13;
<p class="programs">In your math class;ad/add;add<br/>Halloween queen;which/witch;witch<br/>Eyes do this;sea/see;see<br/>In the church;altar/alter;altar<br/>A rabbit;hair/hare;hare<br/>A good story;tail/tale;tale<br/>Animals have them;clause/claws;claws<br/>Pencils do this;right/write;write</p>&#13;
<p class="indent">Each line in this file contains three fields separated by semicolons. The first field is the hint you’ll show the player, such as <span class="literal">In your math class</span>. The second field is the two possible answers that your player will choose from, such as <span class="literal">ad/add</span>. The third field is the correct answer, such as <span class="literal">add</span>.</p>&#13;
<p class="indent">In each round, have the program display the hint and the two possible answers to the player, and then wait for them to enter their answer. Have the program compare the user’s answer with the correct answer, and then let them know whether their answer is correct.</p></li>&#13;
<li><span epub:type="pagebreak" id="page_306"/><p class="noindenta">Write a science quiz that tests the student’s knowledge of the animal kingdom. First, use Notepad to create the following text file:</p>&#13;
<p class="programs">1=Invertebrates;2=Fish;3=Amphibians;4=Reptiles;5=Birds;6=Mammals<br/>Bat;6<br/>Clam;1<br/>Dog;6<br/>Frog;3<br/>Lizard;4<br/>Peacock;5<br/>Salamander;3<br/>Salmon;2<br/>Spider;1<br/>Turkey;5<br/>Turtle;4</p>&#13;
<p class="indent">The first line contains the possible classifications. Each of the remaining lines contains an animal’s name and its correct classification. Display an animal’s name to the player, and then ask them to classify that animal by entering the number of the correct class. Then process the player’s answer and let them know whether their answer is correct; if their answer is incorrect, display the correct classification.</p></li>&#13;
</ol>&#13;
</body></html>