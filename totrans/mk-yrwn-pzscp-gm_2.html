<html><head></head><body>
<p class="timage5"><img alt="Image" src="../images/pg017-01.jpg"/></p>&#13;
<h2 class="h2a" id="ch02"><span epub:type="pagebreak" id="page_17"/><span class="big">2</span><br/>Herding Cats: Your First PuzzleScript Game</h2>&#13;
<p class="noindent">In this chapter, we’ll make our own PuzzleScript game. Specifically, it will be a game about herding cats. (You can never have too many games about cats. Remember that when you’re a famous game designer.) You can play it at <em><a href="https://w.itch.io/herding-cats/">https://w.itch.io/herding-cats/</a></em>. After you’ve played the game, we’ll go over how to make it!</p>&#13;
<p class="imagel"><span epub:type="pagebreak" id="page_18"/><img alt="Image" src="../images/pg018-01.jpg"/></p>&#13;
<p class="indent">In <em>Herding Cats</em>, your goal is to make friends with all the different cats in each level. Press <strong>X</strong> on your keyboard to start, and then use the arrow keys on your keyboard to move around. You can use the <strong>Z</strong> key to rewind time if you make a mistake and want to redo your moves. Press <strong>R</strong> to restart the level you’re on. (Most PuzzleScript games use the same keys to play a game.)</p>&#13;
<p class="indent">At the start of each level, all the cats will be sleeping. When you wake up a cat, it’ll start following you. A woken cat will follow you everywhere, but it can make it hard to fit through some spots.</p>&#13;
<p class="indent">The game can get tricky. You don’t have to solve every level to read the rest of the chapter! Just get a feel for how the game works.</p>&#13;
<h3 class="h3" id="ch2.1">Opening a Blank Project</h3>&#13;
<p class="noindent">Let’s start with a blank game. Navigate to <em><a href="https://www.puzzlescript.net/">https://www.puzzlescript.net/</a></em> and click <strong>Make A Game</strong>. Clear your PuzzleScript work area by clicking the <strong>Load Example</strong> drop-down menu at the top of PuzzleScript and selecting <strong>Blank Project</strong>.</p>&#13;
<p class="image"><span epub:type="pagebreak" id="page_19"/><img alt="Image" src="../images/pg019-01.jpg"/></p>&#13;
<p class="indent">You should see a totally blank PuzzleScript project like this.</p>&#13;
<p class="image"><img alt="Image" src="../images/pg019-02.jpg"/></p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_20"/>Next, you’ll add a game title and your name at the top of the script, above <code>OBJECTS</code>. Click at the start of the very first line and press <small>ENTER</small> three times to move the <code>OBJECTS</code> section down to make room, and then add these lines:</p>&#13;
<pre><span class="purplebold">title</span> <span class="orangeitalic">Herding Cats!</span>&#13;
<span class="purplebold">author</span> <span class="orangeitalic">anna anthropy</span>&#13;
<span class="purplebold">homepage</span> <span class="orangeitalic">www.puzzlescript.net</span></pre>&#13;
<p class="indent">The result should look something like this.</p>&#13;
<p class="imagel"><img alt="Image" src="../images/pg020-01.jpg"/></p>&#13;
<p class="indent">If you make a mistake and need to undo it, hold down the <small>CTRL</small> key and press <strong>Z</strong>. <small>CTRL</small>-Z is almost universally the undo shortcut in the tools you’ll work with.</p>&#13;
<p class="indent">Now let’s look at how to create objects.</p>&#13;
<h3 class="h3" id="ch2.2"><span epub:type="pagebreak" id="page_21"/>Creating Objects</h3>&#13;
<p class="noindent">Every object in your game has to look like something. An object’s appearance gives the player important information about what it does. For example, in the <em>Simple Block Pushing Game</em>, all the pushable objects look like boxes with flat, easy-to-push sides. The player has arms, showing that they can push objects.</p>&#13;
<p class="indent">PuzzleScript lets you use pixels to draw objects. A <em>pixel</em> (a combination of the words <em>picture element</em>) is just a single dot of color. PuzzleScript objects are 5 pixels wide by 5 pixels tall—25 pixels in total. For example, here’s a door I drew.</p>&#13;
<pre><span class="green">Door</span>&#13;
<span class="brown">Brown</span> <span class="white">White</span> <span class="blue">Blue</span>&#13;
<span class="white">11111</span>&#13;
<span class="white">1</span><span class="brown">000</span><span class="white">1</span>&#13;
<span class="white">1</span><span class="brown">000</span><span class="white">1</span>&#13;
<span class="white">1</span><span class="brown">00</span><span class="blue">2</span><span class="white">1</span>&#13;
<span class="white">1</span><span class="brown">000</span><span class="white">1</span></pre>&#13;
<p class="indent">The pictures you draw are made up of numbers; each number represents a single pixel. Which number the pixel is corresponds to the color you want the pixel to be.</p>&#13;
<p class="indent">From top to bottom, you see the name of the object on the first line (<code>Door</code>), the colors I want on the second line, and then numbers for the 25 pixels below that. Because I want a brown door with a white frame and a blue doorknob, I enter those colors on the second line as <code>Brown White Blue</code>. These words should display in their colors as you type them.</p>&#13;
<p class="indent">Next, I use the numbers representing each color to enter where the colors go, one pixel at a time. Computers start counting at 0, so the first color I enter, <code>Brown</code>, is color <code>0</code>, <code>White</code> is color <code>1</code>, and <code>Blue</code> is color <code>2</code>. The numbers representing each color will also display in those colors, so you can imagine what your rendered drawing will look like as you enter the colors. (Keep in mind that in this <code>Door</code> example, if you try to enter a number higher than 2, such as 3 or 4, the number will display as white because you’ve defined the colors using only the numbers 0, 1, and 2.)</p>&#13;
<div class="note">&#13;
<p class="note1"><span epub:type="pagebreak" id="page_22"/><strong><span class="snote">NOTE:</span></strong> If you have a hard time remembering that computers start counting at 0, think of a bunch of people standing in line for the bathroom. If I’m at the front of the line, how many people are in front of me? Zero! If I’m right behind the person at the front of the line, how many people are in front of me? One! The next person is 2, the next is 3, and the next is 4. Five people in line would be numbered 0, 1, 2, 3, and 4.</p>&#13;
</div>&#13;
<p class="indent"><em>Herding Cats</em> needs some objects, so let’s draw them now!</p>&#13;
<h4 class="h4" id="ch2.2.1">Drawing the Background</h4>&#13;
<p class="noindent">To draw objects in <em>Herding Cats</em>, we first need a <code>Background</code>. Every PuzzleScript game must have a background. Let’s draw one that looks like grass at the beginning of the <code>OBJECTS</code> section:</p>&#13;
<pre><span class="lightgray">========</span>&#13;
<span class="purplebold"><span class="codestrong1">OBJECTS</span></span>&#13;
<span class="lightgray">========</span>&#13;
<span class="green">Background</span>&#13;
<span class="darkgreen">DarkGreen</span> <span class="green">Green</span>&#13;
<span class="darkgreen">0</span><span class="green">1</span><span class="darkgreen">000</span>&#13;
<span class="green">1</span><span class="darkgreen">00</span><span class="green">1</span><span class="darkgreen">0</span>&#13;
<span class="darkgreen">00</span><span class="green">1</span><span class="darkgreen">00</span>&#13;
<span class="darkgreen">0</span><span class="green">1</span><span class="darkgreen">00</span><span class="green">1</span>&#13;
<span class="darkgreen">000</span><span class="green">1</span><span class="darkgreen">0</span></pre>&#13;
<p class="indent">The zeros are dark green and the ones are regular green. I’ve scattered them around like little blades of grass because I’m trying to create an image that, when repeated, will just create a big field strewn here and there with grass.</p>&#13;
<p class="indent">Remember that with this code we’re drawing just one square of grass that is five pixels wide by five pixels tall. But we’ll never see just one square of grass in the game; instead, we’ll see a bunch of these background squares, like this.</p>&#13;
<p class="imagel"><span epub:type="pagebreak" id="page_23"/><img alt="Image" src="../images/pg023-01.jpg"/></p>&#13;
<p class="indent">Now we’ll add some walls in the <code>OBJECTS</code> section.</p>&#13;
<h4 class="h4" id="ch2.2.2">Drawing Walls</h4>&#13;
<p class="noindent">To draw the walls with a stacked brick pattern and make them look more like brick walls, use <code>Red</code> for the bricks and <code>DarkBrown</code> for the mortar between them. Then fill out the pixels so the brown mortar crisscrosses the red bricks:</p>&#13;
<pre><span class="green">Wall</span>&#13;
<span class="red">Red</span> <span class="darkbrown">DarkBrown</span>&#13;
<span class="red">0</span><span class="darkbrown">1</span><span class="red">000</span>&#13;
<span class="red">0</span><span class="darkbrown">1</span><span class="red">000</span>&#13;
<span class="darkbrown">11111</span>&#13;
<span class="red">000</span><span class="darkbrown">1</span><span class="red">0</span>&#13;
<span class="darkbrown">11111</span></pre>&#13;
<p class="indent">Mine has four bricks, but you can make your wall look however you want. When there are a bunch of these chunks onscreen, it’ll look like one big, continuous brick wall.</p>&#13;
<p class="indent">Before we can see what our walls actually look like in the game, we need to add a few more requirements to the <code>LEGEND</code> section.</p>&#13;
<h4 class="h4" id="ch2.2.3"><span epub:type="pagebreak" id="page_24"/>Adding the Background and Wall to the Legend</h4>&#13;
<p class="noindent">Any object we want to appear at the start of a level needs to have a symbol in the <code>LEGEND</code> section. For now, add a symbol for the background and the walls:</p>&#13;
<pre><span class="lightgray">=======</span>&#13;
<span class="purplebold">LEGEND</span>&#13;
<span class="lightgray">=======</span>&#13;
<span class="green">.</span> <span class="white">=</span> <span class="green">Background</span>&#13;
<span class="green">#</span> <span class="white">=</span> <span class="green">Wall</span></pre>&#13;
<p class="indent">I chose the <strong>.</strong> as the symbol for background tiles because it has a lot of empty space around it. Conversely, I picked the <code>#</code> to represent walls because it’s dense, square, and wall-like. Try to choose symbols that remind you of the objects they represent so you can tell at a glance what a level looks like.</p>&#13;
<h4 class="h4" id="ch2.2.4">Creating the Collision Layers</h4>&#13;
<p class="noindent">Whenever we add an object to our game, we have to remember to add it to the <code>COLLISIONLAYERS</code> section as well! Let’s add our wall object like this:</p>&#13;
<pre><span class="lightgray">================</span>&#13;
<span class="purplebold">COLLISIONLAYERS</span>&#13;
<span class="lightgray">================</span>&#13;
<span class="green">Background</span>&#13;
<span class="green">Wall</span></pre>&#13;
<p class="indent">Each line in the <code>COLLISIONLAYERS</code> section represents a separate layer. The <code>Background</code> gets its own layer. Everything else—the walls, the player, and the cats—will be on a second collision layer. If walls and cats weren’t on the same layer, cats could walk through walls. That would be impressive, even for a cat.</p>&#13;
<p class="image"><span epub:type="pagebreak" id="page_25"/><img alt="Image" src="../images/pg025-01.jpg"/></p>&#13;
<h4 class="h4" id="ch2.2.5">Creating a Sample Level</h4>&#13;
<p class="noindent">Now that we’ve added the wall to the <code>LEGEND</code> and the <code>COLLISIONLAYERS</code> sections, let’s make a sample level in the <code>LEVELS</code> section just to see what our <code>Background</code> and <code>Wall</code> objects look like. Use the symbols for the background and wall to create a level:</p>&#13;
<pre><span class="lightgray">=======</span>&#13;
<span class="purplebold"><span class="codestrong1">LEVELS</span></span>&#13;
<span class="lightgray">=======</span>&#13;
<span class="lightgray">###....</span>&#13;
<span class="lightgray">#.#.###</span>&#13;
<span class="lightgray">#.###.#</span>&#13;
<span class="lightgray">#.....#</span>&#13;
<span class="lightgray">##..###</span>&#13;
<span class="lightgray">.####..</span></pre>&#13;
<p class="indent">Click <strong>Run</strong> and then press the <strong>X</strong> on your keyboard to see the level we just drew. I made my wall very squiggly so I can really get an idea of how my walls look in use.</p>&#13;
<p class="imagel"><span epub:type="pagebreak" id="page_26"/><img alt="Image" src="../images/pg026-01.jpg"/></p>&#13;
<p class="indent">Now that you can see what your background and walls look like, you might want to change them. When you make changes to any object’s appearance and then click <strong>Rebuild</strong>, your sample level will update to show the new look. This is a great way to keep track of what your objects look like as you work on them.</p>&#13;
<h4 class="h4" id="ch2.2.6">Drawing the Player</h4>&#13;
<p class="noindent">Now we need a player character. In the <code>OBJECTS</code> section, I drew a player with pink hair, a white dress, and two little hands. (That’s what I was trying to draw, anyway.) You can make your player look the way you want by choosing colors and filling pixels with those colors. But notice the gray periods (<code>.</code>) in the drawing.</p>&#13;
<pre><span class="green">Player</span>&#13;
<span class="brown">Brown</span> <span class="pink">Pink</span> <span class="white">White</span>&#13;
<span class="lightgray">.</span><span class="pink">111</span><span class="lightgray">.</span>&#13;
<span class="lightgray">.</span><span class="brown">00</span><span class="pink">11</span>&#13;
<span class="lightgray">.</span><span class="brown">00</span><span class="pink">11</span>&#13;
<span class="lightgray">.</span><span class="white">222</span><span class="lightgray">.</span>&#13;
<span class="brown">0</span><span class="white">222</span><span class="brown">0</span></pre>&#13;
<p class="indent">When you’re drawing objects in PuzzleScript, a period (<code>.</code>) in the code means that a pixel is transparent. Where there’s a period, you’ll <span epub:type="pagebreak" id="page_27"/>see through that part of the object to whatever is behind it (which is usually the background).</p>&#13;
<p class="indent">We don’t need to have see-through pixels on the background, because there’s nothing behind it. Also, we don’t really need to see through the walls because the walls can be square. But the player isn’t square, so we fill in the unused parts of their picture with see-through pixels.</p>&#13;
<p class="imagel"><img alt="Image" src="../images/pg027-01.jpg"/></p>&#13;
<p class="indent">Whenever something moves around (like the player), it’s a good idea to give it a see-through background so we can tell what it’s moving around on. Earlier I mentioned trying to show what objects can do by using their appearance. For example, a player standing on top of the grass looks like it can move, whereas the rigid, square walls that don’t share any space with the background look fixed in place.</p>&#13;
<h4 class="h4" id="ch2.2.7">Drawing Cats</h4>&#13;
<p class="noindent">Last and most important, we need to add our cats. Let’s think about the cats in <em>Herding Cats</em>. What do they do? Well, when they’re awake, they follow the player around, but when they’re asleep, they just sleep until someone wakes them up. To make <em>Herding Cats</em> work the way we want it to, we need two different kinds of cats: one that stays in place, which we’ll call <code>SleepingCat</code>, and another that follows the player, which we’ll call <code>AwakeCat</code>.</p>&#13;
<p class="image"><span epub:type="pagebreak" id="page_28"/><img alt="Image" src="../images/pg028-01.jpg"/></p>&#13;
<p class="indent">We’ll start by drawing two different objects in the <code>OBJECTS</code> section to create the two basic types of cats.</p>&#13;
<pre><span class="green">SleepingCat</span>&#13;
<span class="black">Black</span> <span class="yellow">Yellow</span>&#13;
<span class="lightgray">.....</span>&#13;
<span class="black">0</span><span class="lightgray">.</span><span class="black">0</span><span class="lightgray">..</span>&#13;
<span class="yellow">1</span><span class="black">0</span><span class="yellow">1</span><span class="lightgray">..</span>&#13;
<span class="black">00000</span>&#13;
<span class="lightgray">.</span><span class="black">0000</span>&#13;
<span class="green">AwakeCat</span>&#13;
<span class="black">Black</span> <span class="yellow">Yellow</span>&#13;
<span class="black">0</span><span class="lightgray">.</span><span class="black">0</span><span class="lightgray">..</span>&#13;
<span class="yellow">1</span><span class="black">0</span><span class="yellow">1</span><span class="lightgray">.</span><span class="black">0</span>&#13;
<span class="black">00000</span>&#13;
<span class="lightgray">.</span><span class="black">0000</span>&#13;
<span class="lightgray">.</span><span class="black">0</span><span class="lightgray">..</span><span class="black">0</span></pre>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_29"/>The sleeping cat is lying down. As with most sleeping cats, you can’t see its legs because they’re tucked underneath. This cat looks stationary. But the awake cat is standing up, ready to follow the player.</p>&#13;
<p class="imagel"><img alt="Image" src="../images/pg029-01.jpg"/></p>&#13;
<p class="indent">Click <strong>Save</strong> at the top of the screen to save your work so far. It’s a good idea to save often in case you accidentally close the window, your computer crashes, or your cat jumps on your keyboard. (If you’ve saved your game, you can click the <strong>Load</strong> menu next to the Save button to load the saved version of your game.)</p>&#13;
<p class="indent">This would be a good time to take another break, pet another cat, or make another sandwich. See you in a minute!</p>&#13;
<h3 class="h3" id="ch2.3">Using Your Objects</h3>&#13;
<p class="noindent">Before we can use our new objects, we need to tell PuzzleScript what to do with them by adding them to the <code>LEGEND</code> and <code>COLLISIONLAYERS</code> sections of our code. Go to the legend and pick a symbol for the player and the sleeping cat objects, as shown here:</p>&#13;
<pre><span class="white">. = Background</span>&#13;
<span class="white"># = Wall</span>&#13;
<span class="green">P</span> <span class="white">=</span> <span class="green">Player</span>&#13;
<span class="green">m</span> <span class="white">=</span> <span class="green">SleepingCat</span></pre>&#13;
<p class="image"><span epub:type="pagebreak" id="page_30"/><img alt="Image" src="../images/pg030-01.jpg"/></p>&#13;
<p class="indent">There’s no symbol for the <code>AwakeCat</code> object because the legend gives PuzzleScript a list of all the objects we want to build our levels from. I picked <code>m</code> for the <code>SleepingCat</code> because it looks like a little cat sitting down with its legs tucked under. (Cute, right?) Because all the levels start with all the cats asleep, we have only sleeping cats at the beginning of a level. The awake cats appear only when a sleeping cat awakens!</p>&#13;
<h4 class="h4" id="ch2.3.1">Adding More Collision Layers</h4>&#13;
<p class="noindent">We’ll need only two collision layers for our objects: the <code>Background</code> and everything else. Add the following lines to the <code>COLLISIONLAYERS</code> section. Next, we’ll want to add the player and both kinds of cats to the <code>COLLISIONLAYERS</code> section.</p>&#13;
<pre><span class="green">Background</span>&#13;
<span class="green">Player</span><span class="white">,</span> <span class="green">SleepingCat</span><span class="white">,</span> <span class="green">AwakeCat</span><span class="white">,</span> <span class="green">Wall</span></pre>&#13;
<p class="indent">The background is on its own layer, and everything else moves around on top of it. The player, sleeping cat, awake cat, and wall are on the same layer so they can bump into each other and get in each other’s way. Otherwise, they wouldn’t be able to bump into each other. Walls aren’t really walls if you can walk right through them.</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_31"/>Next, we need to update our test level. But before we do, save your work!</p>&#13;
<h4 class="h4" id="ch2.3.2">Creating a Test Level</h4>&#13;
<p class="noindent">Let’s create a test level to make sure everything in our game works the way we expect it to. Enter something similar to the following code in the <code>LEVELS</code> section, making sure the level contains every object in the legend: <code>Wall</code> (<code>#</code>), <code>SleepingCat</code> (<code>m</code>), one <code>Player</code> (<code>p</code>), and <code>Background</code> spaces (<code>.</code>). Be sure to add a wall somewhere in the middle, too, not just around the edges!</p>&#13;
<pre><span class="lightgray">=======</span>&#13;
<span class="purplebold"><span class="codestrong1">LEVELS</span></span>&#13;
<span class="lightgray">=======</span>&#13;
<span class="lightgray">#######</span>&#13;
<span class="lightgray">#..#..#</span>&#13;
<span class="lightgray">#.m#m.#</span>&#13;
<span class="lightgray">#..#..#</span>&#13;
<span class="lightgray">#.....#</span>&#13;
<span class="lightgray">#..p..#</span>&#13;
<span class="lightgray">#######</span></pre>&#13;
<p class="indent">Click <strong>Save</strong> and then click <strong>Run</strong>. You should see the game’s title screen appear in the window at the right side of the screen, as shown here.</p>&#13;
<p class="image"><img alt="Image" src="../images/pg031-01.jpg"/></p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_32"/>Now press <strong>X</strong> on your keyboard to start the game. You should see the test level that you created.</p>&#13;
<p class="imagel"><img alt="Image" src="../images/pg032-01.jpg"/></p>&#13;
<p class="indent">Cool! Now test your level by moving the player with the arrow keys. The player should move but not through walls or cats. Make sure that all objects are working correctly. The cats will just sit there because we haven’t added rules to tell them what to do yet.</p>&#13;
<h4 class="h4" id="ch2.3.3">Creating Rules for Cats</h4>&#13;
<p class="noindent">Now we’ll add a rule that states when a <code>Player</code> object touches a <code>SleepingCat</code> object, the sleeping cat should wake up and become an <code>AwakeCat</code> object. Add this rule to the <code>RULES</code> section of your code:</p>&#13;
<pre><span class="lightgray">======</span>&#13;
<span class="purplebold"><span class="codestrong1">RULES</span></span>&#13;
<span class="lightgray">======</span>&#13;
<span class="white">[</span> <span class="green">Player</span> <span class="white">|</span> <span class="green">SleepingCat</span> <span class="white">]</span> <span class="red">-&gt;</span> <span class="white">[</span> <span class="green">Player</span> <span class="white">|</span> <span class="green">AwakeCat</span> <span class="white">]</span></pre>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_33"/>This rule means if the <code>Player</code> is next to a <code>SleepingCat</code>, change them to a <code>Player</code> next to an <code>AwakeCat</code>. Click <strong>Rebuild</strong> at the top of the PuzzleScript screen to make PuzzleScript add everything you changed to the game you’re already playing. Then try to move the player next to the cats to see if they wake up.</p>&#13;
<p class="indent">The cats should wake up, but they’re a little late in doing so: instead of waking up when you touch them, they wake up on the next move. To see what I mean, walk up to a cat and then walk away from it. The cat wakes up after the next move the player makes, not right when the player walks up to it. We want the cats to perk up as soon as they see the player! What’s the deal, cats?</p>&#13;
<p class="indent">To understand the issue with the game play so far, think about how rules work:</p>&#13;
<ol>&#13;
<li class="noindent">The player decides in which direction to move.</li>&#13;
<li class="noindent">PuzzleScript checks all the rules and makes any changes the rules tell it to.</li>&#13;
<li class="noindent">Everything that wants to move finally moves.</li>&#13;
</ol>&#13;
<p class="indent">You press an arrow key to move the player next to a cat, and the player becomes a moving <code>&gt; Player</code>. Next, PuzzleScript checks the rules to see whether the player is next to any cats. Because they’re not next to any cats yet, the cats stay asleep and the <code>&gt; Player</code> finally moves. Then PuzzleScript waits for the next arrow keypress, and the cat remains asleep! When you press an arrow key again, the player becomes a <code>&gt; Player</code> again, and PuzzleScript checks the rules again. This time it sees that the player is next to a cat, so the cat becomes an awake cat, and the player moves away.</p>&#13;
<p class="indent">To fix this hiccup in the game play, we add the keyword <code>late</code> to the rule so it will check whether the player is next to a cat right after the player moves instead of right before the player’s next move. The new rule looks like this:</p>&#13;
<pre><span class="fuschia">late</span> <span class="white">[</span> <span class="green">Player</span> <span class="white">|</span> <span class="green">SleepingCat</span> <span class="white">]</span> <span class="red">-&gt;</span> <span class="white">[</span> <span class="green">Player</span> <span class="white">|</span> <span class="green">AwakeCat</span> <span class="white">]</span></pre>&#13;
<p class="indent">Adding <code>late</code> to the start of a rule tells PuzzleScript to check the rule after objects have moved instead of before. Essentially, we’ve added another step to the way PuzzleScript processes our rule, so this happens:</p>&#13;
<ol>&#13;
<li class="noindent">The player decides in which direction to move.</li>&#13;
<li class="noindent">PuzzleScript checks all the rules and makes any changes the rules tell it to.</li>&#13;
<li class="noindent"><span epub:type="pagebreak" id="page_34"/>Everything that wants to move finally moves.</li>&#13;
<li class="noindent">PuzzleScript checks all the <code>late</code> rules and makes any changes they tell it to.</li>&#13;
</ol>&#13;
<p class="indent">Now the cats should wake up right after the player moves instead of waiting until the next cycle! Test this code. (You might need to click Run to start a new game if all your cats are already awake.) Your cats should perk up as soon as the player gets close.</p>&#13;
<h4 class="h4" id="ch2.3.4">Making Cats Follow the Player</h4>&#13;
<p class="noindent">Now let’s add this rule to make the awake cats follow the player:</p>&#13;
<pre><span class="white">======</span>&#13;
<span class="white">RULES</span>&#13;
<span class="white">======</span>&#13;
<span class="white">late [ Player | SleepingCat ] -&gt; [ Player | AwakeCat ]</span>&#13;
<span class="white">[</span> <span class="fuschia">&gt;</span> <span class="green">Player</span> <span class="white">]</span> <span class="white">[</span> <span class="green">AwakeCat</span> <span class="white">]</span> <span class="red">-&gt;</span> <span class="white">[</span> <span class="fuschia">&gt;</span> <span class="green">Player</span> <span class="white">] [</span> <span class="fuschia">&gt;</span> <span class="green">AwakeCat</span> <span class="white">]</span></pre>&#13;
<p class="indent">There are no vertical bars (<code>|</code>) in this rule because <code>[ &gt; Player | AwakeCat ]</code> would mean that the player and the cat would have to be next to each other for the cat to move. But we want the cats to move with the group regardless of what shape the group is in. So the easiest thing to do is to just have the cats make the same movements no matter where or how far from the player they are. As long as a cat is awake, it should move however the player does. To do that, we enclose the <code>Player</code> and the <code>AwakeCat</code> objects in separate square brackets, meaning they don’t have to be right next to each other. The player and the cat can be anywhere, and the rule will still trigger. Essentially, this new rule states that if a player is trying to move, every awake cat will try to move in the same direction.</p>&#13;
<p class="indent">Click <strong>Rebuild</strong> and try it out! Wake up the cats and get them moving! Pretend you’re a morning aerobics instructor for cats! Let’s get those tails shaking!</p>&#13;
<p class="imagel"><span epub:type="pagebreak" id="page_35"/><img alt="Image" src="../images/pg035-01.jpg"/></p>&#13;
<p class="indent">The game still doesn’t work exactly like it should. Right now, groups don’t stick together. For example, if you’re blocked by a wall but a cat friend is not, the cat will keep walking and the group will break up. To make the shape of the group important, we need to make sure the group stays together.</p>&#13;
<p class="indent">If we make the group stay together, we need to make sure that cats outside the group can add other cats to the group, too. Otherwise, once the player has woken up a few cats, they would be stuck in the middle of the cats and unable to reach any new ones!</p>&#13;
<p class="indent">We have two challenges: we want the player and the cats to move as a group, and we want to allow cats already in the group to awaken other cats, just as the player does. Fortunately, these two problems have the same solution.</p>&#13;
<h3 class="h3" id="ch2.4"><span epub:type="pagebreak" id="page_36"/>Defining Properties of Objects</h3>&#13;
<p class="noindent">To address both problems with our game play, we need the same rules to apply to the player and the cat objects. We could write two versions of every rule—one for the player and another for the cats—but then if we ever wanted to change that rule, we’d have to change it twice. Also, if we wanted to add a new rule, we’d have to write it twice! One characteristic of programmers is that we’re lazy. Why do extra work when we can play with our real cat instead? Let’s make our code clean and efficient the first time.</p>&#13;
<p class="indent">We’ll use the <code>LEGEND</code> section to tell PuzzleScript to treat different kinds of objects in the same way. The <code>LEGEND</code> section doesn’t just let us tell PuzzleScript what symbols refer to which objects. It also lets us tell PuzzleScript which words refer to which objects, so we can use one word to include the player and cats in a group.</p>&#13;
<h4 class="h4" id="ch2.4.1">Allowing Cats to Wake Up Other Cats</h4>&#13;
<p class="noindent">Let’s add an entry to the legend to describe any object that can be a member of the player’s group, whether that’s the player or the cats following them around. That way, anyone in the group (player or cats) can wake up sleeping cats. We’ll call this type of object a <code>WakerUpper</code>.</p>&#13;
<pre><span class="green">WakerUpper</span> <span class="white">=</span> <span class="green">Player</span> <span class="purplebold">or</span> <span class="green">AwakeCat</span></pre>&#13;
<p class="indent">Now in our rules, instead of checking whether the player is next to a sleeping cat, we check whether any <code>WakerUpper</code> is next to a sleeping cat. Keep in mind that the player and any cat that has already joined their group count as <code>WakerUpper</code>s.</p>&#13;
<p class="indent">We’ll add <code>WakerUpper</code> to our current <code>late</code> rule by changing this line:</p>&#13;
<pre><span class="fuschia">late</span> <span class="white">[</span> <span class="green">Player</span> <span class="white">|</span> <span class="green">SleepingCat</span> <span class="white">]</span> <span class="red">-&gt;</span> <span class="white">[</span> <span class="green">Player</span> <span class="white">|</span> <span class="green">AwakeCat</span> <span class="white">]</span></pre>&#13;
<p class="noindent">to this:</p>&#13;
<pre><span class="fuschia">late</span> <span class="white">[</span> <span class="green">WakerUpper</span> <span class="white">|</span> <span class="green">SleepingCat</span> <span class="white">]</span> <span class="red">-&gt;</span> <span class="white">[</span> <span class="green">WakerUpper</span> <span class="white">|</span> <span class="green">AwakeCat</span> <span class="white">]</span></pre>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_37"/>Now the cats in the game should be able to wake up other cats. The current rule looks for any objects marked as <code>WakerUpper</code>, and the legend defines the player and awakened cats as <code>WakerUpper</code>. Try playing the game, and then save your work!</p>&#13;
<h4 class="h4" id="ch2.4.2">Keeping Cats Together</h4>&#13;
<p class="noindent">We’ve solved the first problem: cats can wake up other cats. Next, we have to figure out how to stop the group from splitting apart when it moves.</p>&#13;
<p class="indent">First, let’s determine why the group splits apart. Remember that the <code>&gt;</code> symbol means that something is <em>trying</em> to move. Because of the following rule, whenever the player tries to move, all the cats try to move in the same direction:</p>&#13;
<pre><span class="white">[</span> <span class="fuschia">&gt;</span> <span class="green">Player</span> <span class="white">] [</span> <span class="green">AwakeCat</span> <span class="white">]</span> <span class="red">-&gt;</span> <span class="white">[</span> <span class="fuschia">&gt;</span> <span class="green">Player</span> <span class="white">] [</span> <span class="fuschia">&gt;</span> <span class="green">AwakeCat</span> <span class="white">]</span></pre>&#13;
<p class="indent">But if the player tries to move again and their way is blocked, every cat still tries to move anyway and the group splits up.</p>&#13;
<p class="indent">To keep the player and cats together as a group, we need to stop everyone in the group from moving if any one member of the group is blocked. We can do this by adding another rule and using the keyword <code>cancel</code>:</p>&#13;
<pre><span class="white">======</span>&#13;
<span class="white">RULES</span>&#13;
<span class="white">======</span>&#13;
<span class="white">late [ WakerUpper | SleepingCat ] -&gt; [ WakerUpper | AwakeCat ]</span>&#13;
<span class="white">[ &gt; Player ] [ AwakeCat ] -&gt; [ &gt; Player ] [ &gt; AwakeCat ]</span>&#13;
<span class="white">[</span> <span class="fuschia">&gt;</span> <span class="green">WakerUpper</span> <span class="white">|</span> <span class="green">Wall</span> <span class="white">]</span> <span class="red">-&gt;</span> <span class="purplebold">cancel</span></pre>&#13;
<p class="indent">This rule states that “if a <code>WakerUpper</code> tries to move into a wall, stop everyone from moving.” Everyone stays where they are. Because we used <code>WakerUpper</code>, this rule will check the player and all the awake cats, and the group should stay together.</p>&#13;
<p class="imagel"><span epub:type="pagebreak" id="page_38"/><img alt="Image" src="../images/pg038-01.jpg"/></p>&#13;
<p class="indent">Keep in mind that PuzzleScript reads all your scripting from top to bottom, the same as you do. PuzzleScript applies your rules in the order they’re listed, starting at the top and working its way to the bottom. We want the “if a <code>WakerUpper</code> tries to move into a wall” rule to happen at the very end, after all the <code>WakerUpper</code> members decide where they’re moving. So make sure this last rule is at the very bottom of your <code>RULES</code> section!</p>&#13;
<p class="indent">Save your work, and then try to play the game. Do the player and cats stay in a group?</p>&#13;
<h3 class="h3" id="ch2.5">Winning the Game</h3>&#13;
<p class="noindent">Earlier, we decided that the goal of the game would be to wake up all the cats and have them join your group. Well, we’ve woken up all the cats in the level.</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_39"/>But the level still hasn’t ended because we haven’t added a win condition for PuzzleScript to check for yet.</p>&#13;
<p class="indent">Some games can go on forever, but not this one. To win <em>Herding Cats</em>, we need to add a win condition. What win condition would make sense? Well, the goal in <em>Herding Cats</em> is simply to have all cats join the group. To accomplish that, we need to wake up all the cats! Okay then, let’s try this as our win condition:</p>&#13;
<pre><span class="purple">No</span> <span class="green">SleepingCat</span></pre>&#13;
<p class="indent">You win if there are no more sleeping cats, and all the cats are now awake cats.</p>&#13;
<p class="indent">Add the <code>No SleepingCat</code> line to the <code>WINCONDITIONS</code> section, and then run your game to see whether you can win your level. You should see the message <code>Win Condition Satisfied</code> when the last cat wakes up, as shown here.</p>&#13;
<p class="image"><img alt="Image" src="../images/pg039-01.jpg"/></p>&#13;
<p class="indent">And you’re back at the title screen.</p>&#13;
<p class="image"><img alt="Image" src="../images/pg040-01.jpg"/></p>&#13;
<h3 class="h3" id="ch2.6"><span epub:type="pagebreak" id="page_40"/>Adding Sounds</h3>&#13;
<p class="noindent">To make the game more interesting and fun, let’s add sound effects to your game. See these little buttons beneath the game screen? Try clicking each of them!</p>&#13;
<p class="imagel"><img alt="Image" src="../images/pg040-02.jpg"/></p>&#13;
<p class="indent">These buttons produce different sound effects like jump sounds, pew pew sounds, and bird tweets. The random sound button at the far right gives you a completely random sound, and the X on the far left clears the information panel below the game screen, along with any sounds you’ve added! Be careful with the X button: you don’t want to accidentally erase any sounds that you like and might still want to use!</p>&#13;
<p class="indent">Each time you click a button, such as the bird button, a line like <code>birdSound: 40166309</code> appears. That number is the sound effect in a form that PuzzleScript understands. When you click a number, you should hear the sound. When you find a sound you like, write down its number.</p>&#13;
<p class="imagel"><span epub:type="pagebreak" id="page_41"/><img alt="Image" src="../images/pg041-01.jpg"/></p>&#13;
<p class="indent">Try to find a sound you could play that would indicate in an exciting way that you won the level! The powerup sound button with the + on it might be a good one. Keep clicking it until you get to a sound you like. Then enter the number of the sound into the <code>SOUNDS</code> section of your game, like this:</p>&#13;
<pre><span class="lightgray">=======</span>&#13;
<span class="purplebold">SOUNDS</span>&#13;
<span class="lightgray">=======</span>&#13;
<span class="purple">Endlevel</span> <span class="orangeund">72533508</span></pre>&#13;
<p class="image"><img alt="Image" src="../images/pg041-02.jpg"/></p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_42"/>The keyword <code>Endlevel</code> tells PuzzleScript to play this sound when the level ends. Now run your game again and try to win the level. Do you hear your cool sound when you win?</p>&#13;
<p class="indent">How about adding a sound to the cats when they wake up? Find a sound effect that sounds meowy, and then add it to your list of sounds, like so:</p>&#13;
<pre><span class="purple">sfx0</span> <span class="orangeund">9963503</span></pre>&#13;
<p class="indent">The code <code>sfx0</code> stands for “sound effects 0.” If you add another sound effect, you would call it <code>sfx1</code>, then <code>sfx2</code>, and so on. (Remember that 0 is always the number of the person in the front of the bathroom line!)</p>&#13;
<p class="indent">You can make the <code>sfx0</code> sound play whenever you want it to by putting it at the end of a rule, like this:</p>&#13;
<pre><span class="fuschia">late</span> <span class="white">[</span> <span class="green">WakerUpper</span> <span class="white">|</span> <span class="green">SleepingCat</span> <span class="white">]</span> <span class="red">-&gt;</span> <span class="white">[</span> <span class="green">WakerUpper</span> <span class="white">|</span> <span class="green">AwakeCat</span> <span class="white">]</span> <span class="purplebold">sfx0</span></pre>&#13;
<p class="indent">This line tells PuzzleScript to play <code>sfx0</code> every time the rule for waking up a cat runs, meaning every time a cat wakes up.</p>&#13;
<p class="indent">Save your game and test it out. Listen to the beautiful symphony of weird video game sounds your game has now. <em>Magnificent!</em></p>&#13;
<p class="image"><img alt="Image" src="../images/pg042-01.jpg"/></p>&#13;
<h3 class="h3" id="ch2.7"><span epub:type="pagebreak" id="page_43"/>What You Learned</h3>&#13;
<p class="noindent">Now you know all the parts that make up a PuzzleScript game. You know how to draw the objects that make up your game, add the rules that tell the game what to do with those objects, and set up the collision layers that tell the game which objects interact with which objects. You also know that the <code>LEGEND</code> section tells PuzzleScript what words and symbols refer to which objects. You learned about adding a win condition to be able to finish the game and adding sounds to make the game more fun and communicative.</p>&#13;
<p class="indent">The one important part of a PuzzleScript game we haven’t talked a lot about yet is levels. In the next chapter, you’ll learn how to use PuzzleScript’s handy, built-in level editor to make puzzles for your game. You’ll also learn how to use level design to tell your game’s story. Take another break, and we’ll meet again in <a href="ch03.xhtml">Chapter 3</a>!<span epub:type="pagebreak" id="page_44"/></p>&#13;
</body></html>