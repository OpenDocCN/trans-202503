<html><head></head><body>
<h2 class="h2" id="ch27"><span epub:type="pagebreak" id="page_213"/>—27—<br/>Heaps in Politics and Academia</h2>&#13;
<p class="noindent">Early the next morning, Frank snuck out of the safe house and made his way across town to the police academy. Once on campus, surrounded by police officers, cadets, and retired officers, he felt himself relax. He even smiled broadly as he cut across the quad to the academy’s faculty office building.</p>&#13;
<p class="indent">Frank hadn’t been in the building in years. As a rule, the professors maintained an open-door policy that allowed students to stop by with questions anytime. In reality, few students ever took advantage of this access, preferring instead to wait until the night before a test to realize how much they didn’t know. Frank often held out longer, waiting until he sat down to take the exam before realizing his ignorance.</p>&#13;
<p class="indent">A quick scan of the faculty directory indicated that Dr. Loop occupied the sole office on the building’s top floor. Frank wasn’t surprised. The peculiar design of the faculty building made office assignments a contentious topic in the best of times. Each floor held exactly half the offices of the floor beneath it, meaning that not only were the views better as you went up, but each office doubled in size. After years of bitter fighting, the dean had imposed a strict tenure-based priority for offices—the occupant of any office <span epub:type="pagebreak" id="page_214"/>must have served a longer tenure than anyone in the offices directly below. In effect, he had turned the faculty building into a large tenure-based heap.</p>&#13;
<div class="image"><img src="../images/f0214-01.jpg" alt="image"/></div>&#13;
<p class="indent">Dr. Olivia Loop, Professor of Wizard Criminology, had taught at the police academy for 70 years. Only Dr. Babbleton, Professor of Floating-Point Operations, came close to matching her tenure, at 61 years.</p>&#13;
<p class="indent">By the time Frank reached the top floor, he was breathing hard and wondering how a 95-year-old professor managed that climb multiple times a day. Then again, she did have the benefit of constant exercise.</p>&#13;
<p class="indent">“Come in, come in,” called Dr. Loop through her open door. “Have a seat before you fall down. Those stairs can be tough, even for a youngster like you.”</p>&#13;
<div class="image"><img src="../images/f0214-02.jpg" alt="image"/></div>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_215"/>Frank entered the office and slumped gratefully into one of the hard wooden chairs in front of Dr. Loop’s desk. He struggled for breath for another moment as Dr. Loop watched him silently.</p>&#13;
<p class="indent">“Nice office,” Frank finally managed.</p>&#13;
<p class="indent">“It <em>is</em> wonderful, isn’t it?” said Dr. Loop. “I had to wait 70 years to make it here—70 years! Professor Iterator simply refused to retire for the longest time. But I just waited patiently. You know what happened the day Professor Iterator called it quits?”</p>&#13;
<p class="indent">Frank shook his head, still too winded to give a proper response.</p>&#13;
<p class="indent">“That young upstart, Dr. Lambda, tried to steal my office!”</p>&#13;
<p class="indent">“Really?” Frank wheezed.</p>&#13;
<p class="indent">Dr. Loop shrugged. “You know how it is. Retirement at the police academy is always an exciting affair. Due to our tenure system, only the most senior professor can put in for retirement. Once that happens, no one can resist the chance to sneak into a better office.</p>&#13;
<p class="indent">“Honestly, it was all Professor Iterator’s fault. After 75 years, he just packed up and stormed out, muttering about troublesome kids. As per tradition, the only person he told was the one nearest the door—Dr. Lambda, who has been here only 11 years.</p>&#13;
<div class="image"><img src="../images/f0215-01.jpg" alt="image"/></div>&#13;
<p class="indent">“Not caring about our well-established system for office assignments, Dr. Lambda packed the contents of his meager office and moved straight up here. Ha! It happens every time someone leaves. The professor with the very last office in the entire building runs upstairs and tries to take the top office. Every single time, I tell you!</p>&#13;
<div class="image"><img src="../images/f0215-02.jpg" alt="image"/></div>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_216"/>“Of course, once I heard of Dr. Iterator’s departure, I raced right up here to claim the office for myself. It was rightfully mine, you see. I had the only legitimate claim, having been here for 70 years. But Dr. Babbleton heard me running up the stairs and decided to try for it as well. It always happens like that, you know.</p>&#13;
<div class="image"><img src="../images/f0216-01.jpg" alt="image"/></div>&#13;
<p class="indent">“Once an office opens up, both the professors who live below it rush up to make a claim. Unless a grant application is due—then it can take a few weeks for anyone to notice. In this case, Dr. Babbleton and I also had to contend with Dr. Lambda’s predictable attempt to get the best office.</p>&#13;
<p class="indent">“Anyway, there we were—Dr. Lambda, Dr. Babbleton, and me. We argued for a good hour about the tenure rules. Dr. Lambda had no claim and we all knew it, but he stubbornly held his ground for a while. The argument really came down to Dr. Babbleton, who had been here a paltry 61 years, and me. Inevitably, I won out—forcing Dr. Lambda to move down into my old room. Dr. Babbleton remained in her office on the floor below.</p>&#13;
<div class="image"><img src="../images/f0216-02.jpg" alt="image"/></div>&#13;
<p class="indent">“Dr. Lambda packed up his belongings and moved to my office, but the poor man found two other professors already waiting there. They had occupied the office below mine and were looking for an opportunity to upgrade.</p>&#13;
<div class="image"><span epub:type="pagebreak" id="page_217"/><img src="../images/f0217-01.jpg" alt="image"/></div>&#13;
<p class="indent">“They both had better claims on my old office, one having been here 30 years and the other 40. This time, Dr. Lambda didn’t put up much of a fight. Dr. Variable won that office. He deserved it, too, after 40 years.</p>&#13;
<div class="image"><img src="../images/f0217-02.jpg" alt="image"/></div>&#13;
<p class="indent">“As luck would have it, Dr. Lambda finally caught a break on the next floor down. There the two professors below were both more junior than Dr. Lambda. I think he took particular pleasure in claiming victory and shutting the door in their faces.</p>&#13;
<div class="image"><img src="../images/f0217-03.jpg" alt="image"/></div>&#13;
<p class="indent">“In a way, Dr. Lambda was lucky,” explained Dr. Loop. “When he tried to steal the top office, he ended up on the other side of the building with more junior professors. He got to move up a whole floor. The rules only state that the occupant of any office must have served a longer tenure than anyone in the offices <em>directly</em> below. So, by pure luck, Dr. Lambda now has an office on the second floor while some of his more senior colleagues are still on the first floor.”</p>&#13;
<p class="indent">Frank waited politely to see if the story would continue. When it didn’t, he ventured, “Dr. Loop, if I could have a moment of your time? I have a few questions.”</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_218"/>“Of course,” said Dr. Loop. “I assume this is about this week’s assignment?”</p>&#13;
<p class="indent">Frank balked, thrown off in mid-thought. “What? No. I’m not a student here.”</p>&#13;
<p class="indent">“You aren’t? Then you should consider the police force. It’s a noble career.”</p>&#13;
<p class="indent">“I graduated over 10 years ago.”</p>&#13;
<p class="indent">“Is that so?” Dr. Loop shrugged again. “After a while, all the kids just blend together.”</p>&#13;
<p class="indent">“Okay,” Frank said, desperately trying to regain his train of thought. “Right. I need to know about security spells.”</p>&#13;
<p class="indent">“Oh, I don’t <em>teach</em> magic,” explained Dr. Loop. “I teach Wizard Criminology, it’s the study of—”</p>&#13;
<p class="indent">“I took your class,” Frank interrupted. “I don’t want to know how to perform spells. I want to know what types of security spells exist. Particularly in police stations.”</p>&#13;
<p class="indent">Dr. Loop’s expression suddenly grew hard. “That’s very sensitive information,” she said, her voice cold. “Known only to a few people.”</p>&#13;
<p class="indent">“That’s why I’m here,” said Frank.</p>&#13;
<p class="indent">“Why, exactly, do you need this information?” she asked.</p>&#13;
<p class="indent">“I’m investigating a theft at the Capital Police Station,” he shot back. First the blathering story, now she was grilling him? He didn’t have time for this.</p>&#13;
<p class="indent">“I will need to see your badge,” prompted Dr. Loop. She made a beckoning motion with her hand.</p>&#13;
<p class="indent">Frank reached into his trench cloak and retrieved his Private Investigator badge. He tossed it on her desk.</p>&#13;
<p class="indent">“A PI?” Dr. Loop laughed. Then, her voice grew hard again. “Get out of my office.”</p>&#13;
<p class="indent">“Doctor Loop—” started Frank, but stopped at the sound of a crossbow being cocked.</p>&#13;
<div class="sidebar">&#13;
<p class="sidebart"><span epub:type="pagebreak" id="page_219"/><strong>POLICE ALGORITHMS 101: HEAPS</strong></p>&#13;
<p class="sbsub"><em><strong>Excerpt from Professor Drecker’s Lecture</strong></em></p>&#13;
<p class="noindent">A <em>max heap</em> is a binary tree–based data structure that maintains a special ordered relationship between a node and its children. Specifically, a heap stores the elements according to the <em>heap property</em>, which for a max heap states that the value at any node in the tree is larger (or equal to) every element below it. This structure allows the max heap to efficiently support several important operations: (1) efficiently finding the largest element, (2) removing the largest element, and (3) inserting an arbitrary element. These three operations make heaps ideal data structures for implementing priority queues.</p>&#13;
<div class="image"><img src="../images/f0219-01.jpg" alt="image"/></div>&#13;
<p class="indent">Heaps are often visualized as trees, though they’re easy to implement as arrays, where each element in the array corresponds to a node in the tree, with the root node at index 0, as shown in the following diagram. Child node indexes are defined relative to the indexes of their parents. Specifically, a node at index <em>i</em> has children at indexes 2<em>i</em> + 1 and 2<em>i</em> + 2. So the node at index 1 will have a child at index (2 × 1) + 1 = <strong>3</strong>, and at (2 × 1) + 2 = <strong>4</strong>, as shown in the diagram.</p>&#13;
<div class="image"><span epub:type="pagebreak" id="page_220"/><img src="../images/f0220-01.jpg" alt="image"/></div>&#13;
<p class="indent">Alternatively, some heap implementations just skip array index 0 for simplicity. The root node is instead placed at index 1. In this case, a node at index <em>i</em> has children at indexes 2<em>i</em> and 2<em>i</em> + 1, making the index computations simpler. Either way, the indexing scheme allows the algorithm to compute the index of a child based on the parent, and a parent based on the child.</p>&#13;
<p class="indent">Since the root node (the first element in the array) always corresponds to the maximum value in a max heap, you can always find this value in constant time (that is, in the same amount of time no matter how many values are in the array). This allows a user to efficiently look up the highest-valued item on the priority queue.</p>&#13;
<p class="indent">If you want to add an element or remove the max element, the processes are more complicated, as they require first breaking and then restoring the heap property.</p>&#13;
<p class="indent">You add a new element to the heap by first appending it to the back of the array (the first empty space in the bottom level of the tree). This new value might be larger than its parent, which would break the heap property, so you need to push this node up the tree until it is no longer larger than its parent and the heap property is restored. More formally, if the new value is larger than the value of its parent node, <span epub:type="pagebreak" id="page_221"/>you bubble it up by swapping it with its parent. For example, if we were to add 60 to the preceding heap, we would insert it at the bottom and swap it upward twice, because at both levels it is larger than its parent node.</p>&#13;
<div class="image"><img src="../images/f0221-01.jpg" alt="image"/></div>&#13;
<p class="indent">Removal of the max element is similar. The original max value is swapped with the last element of the array, making the last element the new root node.</p>&#13;
<div class="image"><img src="../images/f0221-02.jpg" alt="image"/></div>&#13;
<p class="indent">Then the original max value (current last element) is deleted. We have now deleted the correct node, but likely broken the heap property in the process.</p>&#13;
<div class="image"><img src="../images/f0221-03.jpg" alt="image"/></div>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_222"/>Starting at the new root node, we walk that node down the tree in order to restore the heap property. At each level we compare that node’s value to both its children. If it is smaller than either of its children, we move the new root node downward to restore the heap property by swapping places with the larger of its two children. The downward swaps terminate when there are no larger children.</p>&#13;
<div class="image"><img src="../images/f0222-01.jpg" alt="image"/></div>&#13;
<p class="indent">Both insertion of new elements and deletion of the maximum element require us to walk at most one path between the top and bottom of the tree. Since we can approximately double the number of nodes in a heap while adding only a single level of new nodes to the bottom, the operations can be fast even for large heaps. Specifically, we can double the number of nodes and add only one additional step to both of these operations! Furthermore, both operations guarantee that the tree remains balanced, so future operations will be efficient.</p>&#13;
</div>&#13;
</body></html>