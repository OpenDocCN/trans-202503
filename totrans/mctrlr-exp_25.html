<html><head></head><body>
<div id="book-content">
<div id="sbo-rt-content"><h2 class="h2a" id="ch25"><span epub:type="pagebreak" id="page_235"/><strong>25  Nintendo CIC and Clones</strong></h2>&#13;
<p class="noindent">Back in the late Seventies, there was a manufacturer of home television videogames known as Atari. Atari’s consoles had some great games from Atari, and from dozens of fly-by-night companies they also had some shitty ones. By 1983, the latter had saturated the market, resulting in a market crash and Atari dumping well over half a million cartridges in a New Mexico landfill. Not only did Atari’s reputation suffer for these bad games, but as they were simply ROM chips on a circuit board, Atari was often paid no licensing fees for these crummy third-party games.</p>&#13;
<p class="indent">As Nintendo prepared for their 1985 launch of the Nintendo Entertainment System (NES) in the North American market, they needed a way to avoid the same fate. Their solution was the Checking Integrated Circuit (CIC), a lockout chip required in every NES cartridge, granting Nintendo the authority to license cartridge manufacturing by constricting CIC supply. By having separate versions for NTSC and PAL markets, they could also provide for regional lockout, preventing the poor children of the United Kingdom from learning that in the outside world, the Teenage Mutant Hero Turtles were ninjas, and that the one called Michelangelo used illegal nunchucks.</p>&#13;
<p class="indent">The scheme worked by having one CIC chip in the NES console, and another CIC chip in the game cartridge. Starting at reset, each of these would generate a stream of pseudo-random bits, and any disagreement of those bits would cause the console to reboot and try again.</p>&#13;
<p class="indent">Given Nintendo’s strict control of game content, there were tempting profits for anyone who could manufacture games without the CIC chip. In this chapter, we’ll first discuss the analog circuitry that was designed to glitch out the console’s CIC chip, stunning it into not resetting when the expected sequence failed to arrive. We’ll then discuss Tengen’s reverse engineering of the CIC chip, their clone of it, and the open source clones that appeared in the 21st century.</p>&#13;
<div class="image"><span epub:type="pagebreak" id="page_236"/><img id="ch25fig1" src="../images/f0236-01.jpg" alt="Image" width="777" height="763"/></div>&#13;
<p class="figcap">Figure 25.1: Nintendo’s NES CIC Chip</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_237"/>An additional bypass, albeit one a little less sophisticated, is to simply reuse the CIC from a legitimate but cheap cartridge. One might also build a “man in the middle” cartridge that accepts any legitimately licensed cartridge, as a way to temporarily borrow its CIC.</p>&#13;
<h3 class="h3" id="ch00lev1sec73"><strong>Glitching the Console’s CIC</strong></h3>&#13;
<p class="noindent">Before compatible counterfeits of the CIC chip were made, an intriguing alternative existed: rather than send the proper pseudo-random sequence, a cartridge might send a crazy pulse on the cartridge edge connector to stun the console’s CIC chip, with the aim of preventing that chip’s firmware from resetting the console and ending the game.</p>&#13;
<p class="indent">This works because the console’s chip runs entirely independent of the CPU, and the game continues to run until that CIC resets the console. If the CIC crashes, its firmware never runs and the console never resets!</p>&#13;
<p class="indent">The best, and perhaps only, documentation for this glitching technique is Horton (2004). Horton describes seven different variants of the gitching circuit, manufactured by Camerica, Color-dreams and AVE. Each of these variants sends a negative voltage glitch on pin 35 or 70, which are directly wired to the CIC chip. This crashes the chip so that its ROM code won’t reset the CPU. <a href="ch25.xhtml#ch25fig2">Figure 25.2</a> shows one of these cartridges, easily identified by a glitch configuration switch on the rear and the absence of any Nintendo seal of quality.</p>&#13;
<div class="image"><span epub:type="pagebreak" id="page_238"/><img id="ch25fig2" src="../images/f0238-01.jpg" alt="Image" width="777" height="877"/></div>&#13;
<p class="figcap">Figure 25.2: Unlicensed Cartridge without a CIC</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_239"/>Nintendo eventually ended the era of the glitching cartridges by introducing resistors and protection diodes on pins 35 and 70, so that the cartridge couldn’t crash the console’s CIC chip.</p>&#13;
<h3 class="h3" id="ch00lev1sec74"><strong>Tengen’s Rabbit: A CIC Clone</strong></h3>&#13;
<p class="noindent">With the glitching vulnerability closed, manufacturers of unlicensed games were forced to either include instructions for cutting a pin of the lockout chip in the console or come up with something that could convincingly generate the pseudo-random sequence of a real CIC chip. Tengen, a subsidiary of Atari, managed to do the latter.</p>&#13;
<p class="indent">The story here is mostly folklore, so please bear with me if at times I don’t let the truth get in the way of a good story. As I understand it, there was a team of three or four engineers who were reverse engineering Nintendo’s CIC chip by photographing its mask ROM and digging through Sharp’s documentation of the chip family. This team worked many late nights, and eventually came out with a functioning clone of the CIC chip, which Tengen packaged as their Rabbit chip, shown in <a href="ch25.xhtml#ch25fig3">Figure 25.3</a>, then later combined into a mapper chip known as the Rambo.<sup><a id="ch25fn_1" href="footnotes.xhtml#ch25fn1">1</a></sup></p>&#13;
<p class="indent">Nintendo, of course, was furious at Tengen for breaking their subsidy lock, producing games without authorization and manufacturing even their licensed games in unlicensed quantities. They sued for damages in the famous case, <em>Atari Games Corp. v. Nintendo of America Inc</em>.</p>&#13;
<div class="image"><span epub:type="pagebreak" id="page_240"/><img id="ch25fig3" src="../images/f0240-01.jpg" alt="Image" width="777" height="1081"/></div>&#13;
<p class="figcap">Figure 25.3: Tengen’s Rabbit</p>&#13;
<div class="image"><span epub:type="pagebreak" id="page_241"/><img id="ch25fig4" src="../images/f0241-01.jpg" alt="Image" width="699" height="1077"/></div>&#13;
<p class="figcap">Figure 25.4: Tengen’s Rabbit Diffusion ROM</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_242"/>Atari had a decent defense: they only copied portions necessary for compatibility, that none of the creative portions of the work were copied, and that the reverse engineering was performed by clean-room methods. Unfortunately, Atari’s attorneys were a little too eager to earn their fees. They had requested a copy of Nintendo’s CIC firmware <em>before</em> they were sued by Nintendo, by lying to the copyright office and claiming that they had <em>already</em> been sued. Oops!</p>&#13;
<p class="indent">Nintendo won as a result of Atari’s unclean hands, and what might have been a commercially successful example of reverse engineering for compatibility was instead dumped in the scrap bin of history. Well, for a dozen years, at least.</p>&#13;
<h3 class="h3" id="ch00lev1sec75"><strong>A Modern Rabbit Clone</strong></h3>&#13;
<p class="noindent">Details are scattered among forum posts, but by 2006 a dump of the Rabbit chip’s ROM had made it to the <code>#nesdev</code> forums in Neviksti (2006). Fox (2006) was then published to the forum, as a translation of the ROM disassembly to C. You can find it reproduced on <a href="ch25.xhtml#page_245">page 245</a>.</p>&#13;
<p class="indent">Reading through the forum thread is fascinating, and not just because it’s from a time before social media engagement metrics trashed any hope of long-form discussion. By the third page, Zack S has two CICs wired to one another, reproducing the check and reset circuits without a console or game.</p>&#13;
<p class="indent">By the seventh page, Neviksti’s ROM photographs are beginning to be decoded to bits, with explanations of the ROM circuit reverse engineered from the die photographs.</p>&#13;
<p class="indent">This is a somewhat unique case for this book, in that a commercial exploit of firmware protection was then <em>itself</em> exploited to provide a break that was just as good as a fresh hack of the original chip! The CIC was cloned into the Rabbit, then the Rabbit was cloned by forums years before the CIC itself had been publicly dumped.</p>&#13;
<div class="image"><span epub:type="pagebreak" id="page_243"/><img id="ch25fig5" src="../images/f0243-01.jpg" alt="Image" width="740" height="281"/></div>&#13;
<p class="figcap">Figure 25.5: Nintendo CIC (SM590) Pinout</p>&#13;
<h3 class="h3" id="ch00lev1sec76"><strong>Cloning Nintendo’s CIC</strong></h3>&#13;
<p class="noindent">By late 2006, Tengen’s Rabbit chip had been reverse engineered and cloned from die photographs, but Nintendo’s original CIC chip had not been cloned except by Tengen. That gap was filled by Segher (2010), an excellent article sourcing images and ROM dumps by Neviksti, as well as a description of the Sharp SM590 architecture that the chip uses.</p>&#13;
<p class="indent">Speaking of the SM590, it’s a 4-bit CPU, and that’s the least bonkers thing about it. The 10-bit program counter is divided into a 1-bit field, a 2-bit page, and a 7-bit step. The step is counted in polynomial rather than linear order, as an LFSR uses fewer transistors than a linear counter! Like a PIC, the hardware call stack is held apart from RAM.</p>&#13;
<h3 class="h3" id="ch00lev1sec77"><span epub:type="pagebreak" id="page_244"/><strong>Sharp SM590 Backdoor</strong></h3>&#13;
<p class="noindent">After all this labor to dump the CIC’s ROM, perhaps there was an easier way? Riddle (2019) documents a backdoor test mode, in which the SM590’s ROM can be dumped through the I/O pins.</p>&#13;
<p class="indent">Given the pinout in <a href="ch25.xhtml#ch25fig5">Figure 25.5</a>, the backdoor is activated by lowering pins 7, 14, and 13 in that order. ROM data will then appear in 508-byte groups, repeating every 2,032 clock cycles on pins 12–19 and 4–1.</p>&#13;
<p class="indent">The start position is somewhat unpredictable, but Riddle suggests that it can be synchronized either by counting clock cycles after pin 7 is lowered, or by synchronizing on the long string of zeroes at the end of the dump.</p>&#13;
<p class="indent">Riddle notes that the SM591 and SM595 might require changing fields to get all the data, as not all of memory is covered. We’ll see how those were dumped in <a href="app07.xhtml#app07_4">Chapter G.4</a>.</p>&#13;
<div class="imagel"><span epub:type="pagebreak" id="page_245"/><img src="../images/f0245-01.jpg" alt="Image" width="819" height="1108"/></div>&#13;
<div class="imagel"><span epub:type="pagebreak" id="page_246"/><img src="../images/f0246-01.jpg" alt="Image" width="827" height="1099"/></div>&#13;
<div class="imagel"><span epub:type="pagebreak" id="page_247"/><img src="../images/f0247-01.jpg" alt="Image" width="827" height="1099"/></div>&#13;
<div class="imagel"><span epub:type="pagebreak" id="page_248"/><img src="../images/f0248-01.jpg" alt="Image" width="828" height="830"/></div>&#13;
</div>
</div>
</body></html>