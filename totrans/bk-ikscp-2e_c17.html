<html xmlns="http://www.w3.org/1999/xhtml" xmlns:dk="http://www.kirsanov.com" xmlns:epub="http://www.idpf.org/2007/ops" xmlns:svg="http://www.w3.org/2000/svg" epub:prefix="index: http://www.index.com/" lang="en" xml:lang="en">
	<head>
		<meta content="text/html; charset=UTF-8" http-equiv="Content-Type"/>
		<title>Chapter 17: Filters</title>
		<link href="NSTemplate_v1_inkbook.css" rel="stylesheet" type="text/css"/>
<meta content="urn:uuid:53262340-c02e-40d5-9273-c34656cedc88" name="Adept.expected.resource"/>
	</head>
	<body>
		<section><a id="ch17"/>
		<header>
				<h1 class="chapterTitle"><span class="ChapterNumber"><span epub:type="pagebreak" id="Page_353" title="353"/>17</span><br/><span class="ChapterTitle">Filters</span></h1>
			</header>
			<p class="ChapterIntro"><a id="353"/>Inkscape filters are a way to apply complex bitmap processing algorithms to the
objects in your drawing. True to the vector spirit, filters are nondestructive: you can
always change the parameters of any filter, and the original vector object remains fully
editable. Examples of what filters can do include blurring, sharpening, color
adjustments, adding texture, various distortions, 3D-like effects such as bevels, and
many others.  Moreover, you can combine filters into arbitrarily complex <em>filter
stacks</em>.</p>
			<p>
				SVG filters (as defined by the SVG standard and implemented by Inkscape) are
extremely powerful; a whole book could be written on their uses and
capabilities. Unfortunately, they can also be quite technical, especially if you're
trying to compose your own filter stacks. In this chapter, I start by
looking at some simple ways to use filters, such as blurring (<a href="#section17.1">17.1</a>)
and blend modes (<a href="#section17.2">17.2</a>). Then I describe 
in more general terms how to manage filters on objects (<a href="#section17.3">17.3</a>) and give an overview
of the library of preset filters that come with Inkscape (<a href="#section17.4">17.4</a>).
Finally, for those who want more power and are not afraid to get more
technical, I describe the <span class="ui">Filter Editor</span> dialog (<a href="#section17.5">17.5</a>), where you
can create your own filter stacks from standard filter primitives.</p>
			<a id="section17.1"/><h2>
				17.1 <a id="354"/><span epub:type="pagebreak" id="Page_354" title="354"/>Blur</h2>
			<p>
				Properly called <em>Gaussian
blur</em> (named after Carl Friedrich Gauss, a German mathematician), this effect smoothly
dissolves an object, as if you were viewing it through an out-of-focus lens. It is just one
of the 14 filter primitives that Inkscape supports, but of all these primitives, <span class="ui">Blur</span>
is the most easily accessible. For any selected object, you can apply blurring with a
slider at the bottom of the <span class="ui">Fill and Stroke</span> dialog, as shown in <a href="#fig17-1">Figure 17-1</a>.</p>
			<a id="fig17-1"/><figure>
				<img alt="" src="19/fi-blurslider.svg.png"/>
				<figcaption>
					<p>
						Figure 17-1: The <span class="ui">Blur</span> slider in the <span class="ui">Fill and Stroke</span>
dialog</p>
				</figcaption>
			</figure>
			<p>
				The same paired opacity and blur sliders are available in the <span class="ui">Layers</span> dialog (<a href="c04.xhtml#section4.9.4">4.9.4</a>),
where they apply to the selected layer as a whole.</p>
			<p>
				Easy blurring expands Inkscape's capabilities enormously.
Blur is everywhere in the physical world—non-crisp shadows, glows and halos, or anything viewed out of focus or in motion—so
it is essential whenever you're drawing anything realistic. 
It is also not something you can easily imitate
with regular vector shapes or gradients.
Inkscape therefore treats blur as a fundamental property of an object,
similar to opacity and the blend modes (<a href="#section17.2">17.2</a>).</p>
			<p>
				The <span class="ui">Blur</span> slider controls the <em>amount</em> of blur in a range from 0 to 100 percent; 
1 percent barely changes the appearance of an object, and 100 percent turns any object into
a shapeless puff. Technically, 100 percent blur makes the blur radius equal to half the size of the object, but
the scale is not uniform: going from 0 to 10 percent increases the blur radius much less
than from 90 to 100 percent because you need more precise control at the lower end of the scale.</p>
			<p>
				Setting blur as a percentage ensures that it works the same for objects
of any size: a large object blurred by 10 percent has a larger <em>absolute</em>
amount of blur (larger blur radius), but it looks proportional to a small
object that is also blurred by 10 percent. If you want to get the same blur radius in objects
of different sizes, you would need to use different blur percentages, as <a href="#fig17-2">Figure 17-2</a> demonstrates.</p>
			<a id="fig17-2"/><figure>
				<img alt="" src="19/fi-blurscale.svg.png"/>
				<figcaption>
					<p>Figure 17-2: Blur amount (same in A and B) and blur radius
(same in A and C)</p>
				</figcaption>
			</figure>
			<p><a id="355"/><span epub:type="pagebreak" id="Page_355" title="355"/>Blurring an object expands its bounding box but only if the visual
bounding box type is used (which is the default, <a href="c04.xhtml#section4.3">4.3</a>). For example, if you
want to export a blurred object without cropping the blur, 
you cannot use the object's geometric bounding box as the export area (<a href="c18.xhtml#section18.6">18.6</a>).</p>
			<p>You can think of each blurred object as residing in its own fully transparent
layer, so it never "smears" any adjacent nonblurred objects. Since that per-object
layer is transparent, the edges of a blurred object become partially
translucent. However, you can blur a group, and in that case, members of the group
are blurred together, as if placed on a single layer blurred as a whole.</p>
			<p>
				In<a href="#fig17-3">Figure 17-3</a>, on the left are two adjacent rectangles with no gap between them and no
blur. In the middle, each rectangle is blurred by 20 percent separately; as you can see, the
striped background shows through the blurry gap between the objects. On the right,
however, the same rectangles are grouped, and then the group is blurred by 20 percent;
now there is no gap—blurring only adds transparency at the edges, but it cannot reveal
what was fully covered in the center of the opaque group.</p>
			<a id="fig17-3"/><figure>
				<img alt="" src="19/fi-blurgap.svg.png"/>
				<figcaption>
					<p>Figure 17-3: Blurring separate objects vs. blurring a
group</p>
				</figcaption>
			</figure>
			<p>
				Grouping also allows you to apply several layers of blurring to the same object. For
example, you can blur the object itself, then group it (possibly even with itself, to produce
a group of one object) and blur the group. Naturally, by blurring a
group, you can make objects look <em>more</em> blurred than before, but not<em>less</em>. (Similarly, as you saw in <a href="c16.xhtml#section16.3">16.3</a>, you can make a clone more blurred than its original object, but not less.)</p>
			<aside epub:type="sidebar">
				<div class="top hr">
					<hr/>
				</div>
				<section class="note">
					<h2><span class="NoteHead">NOTE</span></h2>
					<p>
						Blurring is not the same as <em>feathering</em>, as <a href="#fig17-4">Figure 17-4</a> demonstrates. Blur affects the entire object—in
particular, lines on a bitmap object or object boundaries inside a group
are all blurred. Feathering, on the other hand, is simply blurred transparency that
masks out the outermost edges of an object (such as a photo). Inkscape can do feathering
as well, using a predefined composite filter (<a href="#section17.4.2">17.4.2</a>) or a blurred mask (<a href="c18.xhtml#section18.3.2">18.3.2</a>).</p>
					<div class="bottom hr">
						<hr/>
					</div>
				</section>
			</aside>
			<a id="fig17-4"/>
			<figure>
				<img alt="" src="19/fi-blurfeather.svg.png"/>
				<figcaption>
					<p>Figure 17-4: Blurring vs. feathering</p>
				</figcaption>
			</figure>
			<a id="section17.1.1"/>
			<h3>
				17.1.1 <a id="356"/><span epub:type="pagebreak" id="Page_356" title="356"/>Blur and Transformations</h3>
			<p>What happens when you transform a blurred object?</p>
			<p>
				Moving a blurred object moves it as a whole, without affecting the blur in any way.
Proportional (uniform) scaling also scales the object as a whole, including
the blur radius, so that the blur percentage (in the <span class="ui">Fill and Stroke</span> dialog) does not
change.</p>
			<p>
				Nonuniform scaling is more interesting. For example, if you squeeze a blurred object
vertically, its blur will squeeze with it and become <em>nonuniform</em>—now the object
is more blurred horizontally than vertically. Such nonuniform blur can approximate real-world<em>motion blur</em>—the way the object would look in a photo if
captured in fast motion (in this case, horizontal). So, if you want to apply nonuniform
blur to a nonsqueezed object, start by stretching it in the opposite
direction, blur it, and then squeeze it back into shape (this only works for
paths and bitmaps), as shown in <a href="#fig17-5">Figure 17-5</a>.</p>
			<a id="fig17-5"/><figure>
				<img alt="" src="19/fi-motionblur.svg.png"/>
				<figcaption>
					<p>Figure 17-5: Motion blur, step-by-step</p>
				</figcaption>
			</figure>
			<p>
				You can also create nonuniform motion blur by
setting different horizontal and vertical blur values in the <span class="ui">Filters<span class="MenuArrow"> ▶ </span>Blurs<span class="MenuArrow"> ▶ </span>Blur...</span> adjustable filter
dialog, but the stretch/squeeze method described here is usually easier.</p>
			<aside epub:type="sidebar">
				<div class="top hr">
					<hr/>
				</div>
				<section class="box">
					<h2>Transformed Blur in SVG</h2>
					<p>
						At the SVG level, to make blur nonuniform, you need to apply it to an object with a <code>transform</code> attribute (<a href="b01.xhtml#sectionA.7">A.7</a>),
which affects the blur as well. When you stretch a
path without blur, this stretching is by default embedded into the points of the
path (<a href="b01.xhtml#sectionA.7">A.7</a>), but once you apply the blur, reverse squeezing will instead add the<code>transform</code> attribute, squeezing the blur as well.</p>
					<div class="bottom hr">
						<hr/>
					</div>
				</section>
			</aside>
			<p>
				To create motion blur on a group or text object (that is, not a path or bitmap), use
this trick. Stretch the object, then group it with itself (Ctrl-G, <a href="c04.xhtml#section4.8">4.8</a>), apply a blur to
the group, and squeeze it back. The grouping step ensures that in the end, you get an
object with the correct proportions but also with the squeezing <code>transform</code>
attribute affecting the blur.</p>
			<p>
				Similar remarks apply to the way many other filters behave when transformed. For
example, squeezing and/or rotating objects allows you to create perspective-distorted
variants of texture filters (<a href="#section17.4">17.4</a>) for applying to walls and floors in 3D scenes
(<a href="c22.xhtml">Chapter 22</a>). Of course, transforming filters by stretching and squeezing objects is not as
convenient as dragging handles on canvas would be—but it works.</p>
			<aside epub:type="sidebar">
				<div class="top hr">
					<hr/>
				</div>
				<section class="note">
					<h2><span class="NoteHead">NOTE</span></h2>
					<p><a id="357"/><span epub:type="pagebreak" id="Page_357" title="357"/>Filters work on the rendered image of the object on your screen—that is, any
filter gets as input a bitmap that is created for the current zoom level. This is why
filters may be slow to work with: every time you zoom in or out, all the filters in your view are reapplied to the
new rendering. This also explains why some filters may look slightly
different depending on the zoom. For example, a sharpening filter, when applied to a bitmap
object at 100 percent zoom, works on the image features as you would expect. However, if
you zoom in closely enough, you will see the pixels of the bitmap object as rectangles
(<a href="c18.xhtml#section18.2.3">18.2.3</a>), and the sharpening will now apply to the borders of those rectangular pixels!</p>
					<div class="bottom hr">
						<hr/>
					</div>
				</section>
			</aside>
			<a id="section17.1.2"/>
			<h3>17.1.2 Tweaking for Blur</h3>
			<p>
				The Blur mode of the Tweak tool blurs the selected objects under the brush more
(by default) or less (with Shift pressed). The amount of blur added or removed depends
on <span class="ui">Force</span>, pen pressure (if you're using a tablet pen), the closeness of the object to
the center of brush, and how long you apply the brush.</p>
			<a id="section17.2"/><h2>
				17.2 Blend Modes <span class="NoteHead">[1.1]</span></h2>
			<p>
				Choosing a blend mode affects how the colors of an object <em>blend</em> (mix) with
those of the background objects beneath it. Like blur, blend modes are easily accessible in
the <span class="ui">Layers</span> and <span class="ui">Fill and Stroke</span> dialogs—where you can change them for layers and for individual objects, correspondingly.</p>
			<p>
				There are 16 blend modes, including the <span class="ui">Normal</span> mode that all objects have by default.  Each blend mode is basically a formula that calculates the visible color in every point where two or more objects are stacked on top of each other. In the default <span class="ui">Normal</span> mode, the color of the background object is taken into account only if the foreground object has less than 100 percent opacity. In all other modes, however, even if the foreground is fully opaque, the background may still show through in some way (depending on the mode and the color of the top object).</p>
			<p>
				You may be familiar with how blending modes work from bitmap graphic editors, such as GIMP or Adobe Photoshop, that let you change how each layer of a drawing blends into the layers below it. In Inkscape, blend modes are also often used for tweaking the look of imported bitmaps with colored "lenses" using various modes, and in this way, they are indispensable—you cannot achieve quite the same effects with <span class="ui">Normal</span>-mode colored transparencies.  You can adjust the colors of a bitmap using an external bitmap editor (Inkscape will even re-read a linked image that was changed by an external program, <a href="c18.xhtml#section18.2.1">18.2.1</a>), or you can use a predefined composite filter, such as <span class="ui">Sepia</span>. In most cases, however, an easier and more flexible approach is to place a flat-color or gradient overlay on top of an image, change the blend mode of that overlay object, and adjust its opacity for the force of the effect.</p>
			<p>
				I will not overwhelm you with details and formulae of all the modes; instead, I will try to meaningfully group and contrast various modes
and give some practical tips on how to achieve common useful effects. Refer to <a id="figref15"/><a href="c15b.xhtml#ill-fig15">Figure 15 in the color insert</a>
that demonstrates applying four colored overlays (blue, orange, black, and white) to <em>Mona Lisa</em>. The top row shows the original bitmap
and two <span class="ui">Normal</span>-mode overlays: one with 100 percent opacity (not transparent at all) and <a id="358"/><span epub:type="pagebreak" id="Page_358" title="358"/>another with 50 percent opacity.
All other blend modes below are shown at 100 percent foreground opacity; if you lower it, each mode's effect will be reduced in a way you would expect.</p>
			<p><span class="ui">Color Dodge</span>, <span class="ui">Color Burn</span>, <span class="ui">Hard Light</span>, and <span class="ui">Soft Light</span> form two contrasting pairs, with <span class="ui">Color Dodge</span> somewhat similar to <span class="ui">Hard Light</span>, and <span class="ui">Color Burn</span> to <span class="ui">Soft Light</span>. In this group, the two modes on the left (<span class="ui">Color Dodge</span> and <span class="ui">Hard Light</span>) either lighten the background colors or render the foreground opaque; the <span class="ui">Color Burn</span> either darkens the background or renders foreground opaque. Finally, <span class="ui">Soft Light</span> does something meaningful for all four sample foreground colors; of all the modes, it is the most similar to the partially opaque <span class="ui">Normal</span> mode, but it is in fact more useful. Where <span class="ui">Normal</span> mixes colors by fading out the background, <span class="ui">Soft Light</span> tints the background without dulling its saturation and contrast.</p>
			<p><span class="ui">Multiply</span>, <span class="ui">Screen</span>, <span class="ui">Darken</span>, and <span class="ui">Lighten</span> is another group of four modes that fall into two contrasting pairs: <span class="ui">Multiply</span> is quite similar to <span class="ui">Darken</span>, and <span class="ui">Screen</span> is similar to <span class="ui">Lighten</span>. Here, the two modes on the left (<span class="ui">Multiply</span> and <span class="ui">Darken</span>) make the background darker if the foreground is dark, all the way to rendering it black; those on the right (<span class="ui">Screen</span> and <span class="ui">Lighten</span>) make the background lighter, all the way to white. This means a white foreground has no effect in <span class="ui">Multiply</span> and <span class="ui">Darken</span>, and a black foreground is invisible in <span class="ui">Screen</span> and <span class="ui">Lighten</span>. The <span class="ui">Darken</span> and <span class="ui">Lighten</span> modes just choose whichever of the background and foreground colors is darker or lighter, whereas<span class="ui">Multiply</span> and <span class="ui">Screen</span> actually combine the two colors.</p>
			<p><span class="ui">Overlay</span> is my favorite mode; I often use it with a scattering of elliptic-gradient lenses to deepen highlights (with white) and shadows (with black) in a photo as well as to make it sunnier or gloomier overall. It also works very well for tinting, mixing in the foreground color without fading out the background (similar to <span class="ui">Soft Light</span>) but at the same time emphasizing the lights or shades in an image (depending on whether the foreground color is light or dark).</p>
			<p><span class="ui">Difference</span> and <span class="ui">Exclusion</span> are two modes that, instead of adding, <em>subtract</em> the foreground from the background (using slightly different formulae). Thus, a black foreground has no effect (because black is "zero color" in RGB), whereas a white foreground <em>inverts</em> the background. Other colors produce various "tinted inversion" effects, more dramatic for light colors than for dark ones.</p>
			<p>
				The four modes in the last group, <span class="ui">Hue</span>, <span class="ui">Saturation</span>, <span class="ui">Color</span>, and <span class="ui">Luminosity</span>, are different from all the other modes in that they act not on the RGB channels of the background and foreground colors, but convert them to the HSL model (<a href="c08.xhtml#section8.4.3">8.4.3</a>) and combine the HSL channels in various ways.</p>
			<ul>
				<li>
					The <span class="ui">Hue</span> mode combines the foreground hue and the saturation and lightness of the background. Unlike all other approaches to tinting, this one does not use the background's own hue at all; for a flat-color overlay, it creates a purely monochromatic image out of a de-hued version of the background and the foreground hue.</li>
				<li>
					The <span class="ui">Saturation</span> mode applies the foreground saturation to the hue and lightness of the background. This is a natural way to vary saturation of an image, from full desaturation (if the foreground has zero saturation, such as white or black) to psychedelically oversaturated colors if the foreground has fully saturated color (such as bright orange).</li>
				<li><a id="359"/><span epub:type="pagebreak" id="Page_359" title="359"/>The <span class="ui">Color</span> mode takes the hue and saturation from the foreground and combines them with the background lightness. Think of it as a combination of <span class="ui">Hue</span> (tints the background) and <span class="ui">Saturation</span> (adjusts background saturation) modes.</li>
				<li>
					Finally, the <span class="ui">Luminosity</span> mode takes the luminosity (lightness) of the foreground and combines it with the hue and saturation of the background. If your foreground is a flat color and the background is an image, as in <a id="figref15-ill"/><a href="c15b.xhtml#ill-fig15">Figure 15 in the color insert</a>, <span class="ui">Luminosity</span> renders the image in its own colors but equalizes  all of them to the same level of lightness. The result is rarely useful—or even discernible—because it's the relative lightness of pixels, not their hue or saturation, that carries most of the visual information in an image.</li>
			</ul>
			<aside epub:type="sidebar">
				<div class="top hr">
					<hr/>
				</div>
				<section class="box">
					<h2>Blend Modes in SVG</h2>
					<p>
						In past versions of Inkscape, a subset of blend modes (applicable only to layers, not individual objects) was implemented via filters using the <code>feBlend</code> primitive (which is why they ended up in this chapter). Now, Inkscape uses the <code>mix-blend-mode</code> CSS property instead.  It is defined in the (still draft as of this writing) <em>Compositing and Blending Level 1</em> specification (<a href="https://drafts.fxtf.org/compositing-1/">https://drafts.fxtf.org/compositing-1/</a>), which is planned to become part of CSS and SVG.</p>
					<div class="bottom hr">
						<hr/>
					</div>
				</section>
			</aside>
			<a id="section17.3"/>
			<h2>17.3 Filter Management</h2>
			<p>
				A filter applied to an object is part of its style. As such, one object's filter can be copied to
another object by copying and then pasting style (<a href="c08.xhtml#ch8">Chapter 8</a>).
The name of a filter for a selected object is reported in the status bar, for example:<span class="ui">Group of 1 object; <em>filtered (Specular Light)</em></span>.</p>
			<p>
				In SVG, an object can have only a single filter applied. However, most filters consist of several filter
primitives stacked on top of one another, and you can always combine two or more individual filters
by putting one filter's stack of primitives on top of another's. When you apply a preset filter (<a href="#section17.4">17.4</a>)
to an object that already has a filter, Inkscape is smart enough to combine their primitives for you
so that you get the desired combined effect of both filters (for example, a texture overlay and a drop shadow).</p>
			<p>
				If, for some reason, automatic combining of filters does not work for you, use the following trick. Apply
one filter, then group the object with itself (Ctrl-G) and apply the second filter to the group. By
repeating this operation, you can process your object with any number of filters in any order. You can even
double down on a filter by applying it to your object twice (although in most cases, if a filter appears
too weak, it is better to go into the <span class="ui">Filter Editor</span>, <a href="#section17.5">17.5</a>, and try to figure out which
parameters of which primitives to adjust to crank it up).</p>
			<p>If the scale of the applied filter is not what you need (for example, if the bubbles or 
feathered edges are too large or too small for your object) and the filter does not
allow you to adjust that with a dialog, you can use this simple trick: scale your object
up (or down)—for example, by pressing Ctrl-&lt; or Ctrl-&gt; a few
times—then apply the filter and scale the result back down (or up) by the same
multiplier.</p>
			<p><a id="360"/><span epub:type="pagebreak" id="Page_360" title="360"/>To remove any filters applied to any of the selected objects, use the <span class="ui"><strong>Filters<span class="MenuArrow"> ▶ </span>Remove Filters</strong></span> command.</p>
			<a id="section17.3.1"/>
			<h3>
				17.3.1 Editing the Filter Area <span class="NoteHead">[1.1]</span></h3>
			<p>
				As you've already seen in the section on blurring (<a href="#section17.1">17.1</a>), applying a filter may expand an object's visual bounding box.
This is true for other filters besides blur that need to paint, scatter, or shift the image beyond the original bounding box. In SVG, any filtered
object has an associated <em>filter area</em>—the virtual canvas on which the filter is allowed to draw. It is the size of the filter area
that Inkscape treats as the new visual bounding box of the filtered object.</p>
			<p>
				Usually, you don't need to worry about this. Inkscape sets the filter area size automatically when you blur an object or choose one of the
preset filters (<a href="#section17.4">17.4</a>), based on the nature of each filter (for example, extending the pre-filter bounding box by the blur radius).
Most of the time this works perfectly—but sometimes, especially when you're combining filters or copy-pasting a filter to a different object,
this automatic filter area may cause clipping of the filter's outer fringes so you need to manually fix it.</p>
			<p>
				The easiest way to edit the filter area is to switch to the Node tool (<a href="c12.xhtml#section12.5">12.5</a>) or any of the shape tools (<a href="c11.xhtml#ch11">Chapter 11</a>)
and drag any of the two small diamond-shaped handles in the top-left and bottom-right corners of the visual bounding box, as shown in <a href="#fig17-6">Figure 17-6</a>. Usually you extend the
filter area to prevent clipping, but you can also use this approach to clip your filtered object if that's what you need (in that case, however,
watch for any other objects that, due to duplication or style pasting, use the same filter—they may end up clipped too).</p>
			<a id="fig17-6"/><figure>
				<img alt="" src="19/fi-editarea.svg.png"/>
				<figcaption>
					<p>Figure 17-6: Editing the filter area via handles in the Node tool</p>
				</figcaption>
			</figure>
			<p>
				Interactive editing of the filter area does not work for clones and symbols.
You can also edit the area of any filter numerically in the <span class="ui">Filter Editor</span> dialog (<a href="#section17.5.4">17.5.4</a>).</p>
			<a id="section17.4"/><h2>17.4 Preset Filters</h2>
			<p>SVG defines a limited number of filter primitives out of which you can build arbitrarily complex composite filters. Before going that way, however, let's look at an impressive collection of preset composite filters that come with Inkscape.</p>
			<p><a id="361"/><span epub:type="pagebreak" id="Page_361" title="361"/>To apply a
preset filter to a selected object or objects, simply choose a command from the submenus
of the <span class="ui"><strong>Filters</strong></span> menu. To get a brief description of an individual preset filter (or of any menu command,
for that matter), just hover the mouse over its command in the menu and read the
status bar, as shown in <a href="#fig17-7">Figure 17-7</a>.</p>
			<a id="fig17-7"/><figure>
				<img alt="" src="19/fi-presets.svg.png"/>
				<figcaption>
					<p>Figure 17-7: Preset filter effects</p>
				</figcaption>
			</figure>
			<p>
				Most filters will apply immediately. Others—those with an "..." at the end of their names in the menu—will display a dialog where you can adjust their parameters. Such a dialog always has the <span class="ui">Live preview</span> checkbox that you can turn on to view the result on canvas updated live for any changes of parameters (however, this checkbox locks the canvas so you can't select a different object, nor can you even scroll or zoom). Clicking <span class="ui">Apply</span> creates the filter with the current parameters but does not close the dialog (so you can select another object to apply it to); <span class="ui">Close</span> cancels the dialog and the preview (no need to undo).</p>
			<p><a href="#fig17-8">Figure 17-8</a> shows an example of a pretty complex adjustable effect whose dialog contains several numeric parameters and a color chooser.</p>
			<a id="fig17-8"/>
			<figure>
				<img alt="" src="19/fi-preset-dialog.svg.png"/>
				<figcaption>
					<p>Figure 17-8: Dialog of an adjustable preset filter</p>
				</figcaption>
			</figure>
			<p>
				I don't describe all preset filters here—there are just too many of them (and
more are added with each Inkscape version). However, I do describe each of the 
submenus of the <span class="ui">Filters</span> menu and give brief notes and illustrations of the most notable
filters in each submenu (usually the adjustable ones).</p>
			<aside epub:type="sidebar">
				<div class="top hr">
					<hr/>
				</div>
				<section class="note">
					<h2><span class="NoteHead">NOTE</span></h2>
					<p><a id="362"/><span epub:type="pagebreak" id="Page_362" title="362"/>All the preset filters are stored in the file
filters.svg in the inkscape/filters folder of your Inkscape
data folder (look it up in the <span class="ui">Preferences</span>, <span class="ui">System</span> page).
You can add your own preset filters to the menu either by editing filters.svg or by placing another SVG file with your filters
in the same inkscape/filters folder.
After that, any filters defined in that file will be listed in a <span class="ui">Bundled</span> submenu under<span class="ui">Filters</span>. (All such filters will apply immediately; 
you cannot create an adjustable filter with a dialog.)</p>
					<div class="bottom hr">
						<hr/>
					</div>
				</section>
			</aside>
			<a id="section17.4.1"/>
			<h3>17.4.1 The Bevels Submenu</h3>
			<p>
				The <span class="ui">Bevels</span> submenu presents many variations on the theme of bevels
(pseudo-3D raised edges), as shown in <a href="#fig17-9">Figure 17-9</a>. Here you will find opaque and translucent materials, glossy
and matte finishes, bevels lit by multiple sources of light, with and without shadows,
with depressions in the middle and with raised borders, and so on. Most of these filters 
preserve the original color of the object, though they may make it lighter or darker in
places for the 3D effect.</p>
			<a id="fig17-9"/><figure>
				<img alt="" src="19/fi-filters-bevels.svg.png"/>
				<figcaption>
					<p>
						Figure 17-9: Filters from the <span class="ui">Bevels</span>
submenu</p>
				</figcaption>
			</figure>
			<p><a id="363"/><span epub:type="pagebreak" id="Page_363" title="363"/>Most of the adjustable filters in this group let you specify how raised the bevel is (<span class="ui">Smoothness</span>), the coordinates of the
light source (<span class="ui">Elevation</span> and <span class="ui">Azimuth</span>), as well as the <span class="ui">Brightness</span> and color of the highlight. If the filter you've chosen is
not adjustable, you can still move the light source if you apply it, open the <span class="ui">Filter Editor</span>, select the <span class="ui">Specular Light</span> or <span class="ui">Diffuse
Light</span> primitive in the filter stack applied to the object, and play with the <span class="ui">Elevation</span> and <span class="ui">Azimuth</span> parameters there.</p>
			<a id="section17.4.2"/><h3>17.4.2 The Blurs Submenu</h3>
			<p>
				The <span class="ui">Blurs</span> submenu (<a href="#fig17-10">Figure 17-10</a>) includes the basic adjustable <span class="ui">Blur</span> where you can set
horizontal and vertical blur amounts separately. If you want a non-horizontal and non-vertical
motion blur, rotate your object to make its motion direction horizontal, blur it with horizontal
blur, and then rotate back.</p>
			<a id="fig17-10"/><figure>
				<img alt="" src="19/fi-filters-blurs.svg.png"/>
				<figcaption>
					<p>
						Figure 17-10: Filters from the <span class="ui">Blurs</span>
submenu</p>
				</figcaption>
			</figure>
			<p>
				The <span class="ui">Blur content only</span> checkbox in <span class="ui">Blur</span> blurs only the inside of an
object (for example, the image on a bitmap) but leaves its edges (where its opacity drops to zero) unaffected. The <span class="ui">Feather</span> effect
does the opposite: it blurs the transparency mask of an object but does not affect its content.</p>
			<p><span class="ui">Apparition</span> and <span class="ui">Evanescent</span> overlay a faded-out blurred copy of an object over a normal copy
to make it look softer and a little unreal without blurring it to unrecognizability; of these, <span class="ui">Apparition</span> works on the object's edge (like <span class="ui">Feather</span>), while <span class="ui">Evanescent</span> works on its content. Finally,<span class="ui">Out of Focus</span> attempts to model the real-world myopic view of an object's content a little better
than a plain blur would.</p>
			<a id="section17.4.3"/><h3>17.4.3 The Bumps Submenu</h3>
			<p>
				The <span class="ui">Bumps</span> submenu (<a href="#fig17-11">Figure 17-11</a>) has filters that add various pseudo-3D textures that emphasize the features in an image. They are similar to the "embossing" effect you may have seen in other software.</p>
				<a id="fig17-11"/>
				<figure>
				<img alt="" src="19/fi-filters-bumps.svg.png"/>
				<figcaption>
					<p>
						Figure 17-11: Filters from the <span class="ui">Bumps</span> submenu</p>
				</figcaption>
			</figure>
			<a id="section17.4.4"/>
			<h3>
				17.4.4 <a id="364"/><span epub:type="pagebreak" id="Page_364" title="364"/>The Color Submenu</h3>
			<p>
				The <span class="ui">Color</span> submenu collects various ways to adjust or transform an object's colors. They are most useful for imported bitmaps, but you can also use them on vector designs, especially complex ones that you can group and filter as a whole without having to repaint each object separately.</p>
			<p>
				Personally, I prefer to use semitransparent overlays with blend modes (<a href="#section17.2">17.2</a>), because with them, I have full control over which parts of an image to affect, but there are cases where blend modes just don't cut it. Still, this submenu includes <span class="ui">Simple Blend</span> that emulates any of the blend modes as an effect. You can also:</p>
			<ul>
				<li>
					Adjust <span class="ui">Lightness-Contrast</span>.</li>
				<li><span class="ui">Invert</span> per-channel.</li>
				<li>
					Convert to <span class="ui">Grayscale</span> controlling how much each of the RGB channels contributes to the result.</li>
				<li>
					Use <span class="ui">Color Shift</span> to rotate hues.</li>
				<li>
					Emulate various types of <span class="ui">Color Blindness</span>.</li>
				<li>
					Render an image in two (<span class="ui">Duochrome</span>) or three (<span class="ui">Trichrome</span>) colors.</li>
				<li>
					Adjustably <span class="ui">Colorize</span> an image with a chosen color.</li>
				<li>
					Make colors <span class="ui">Fluorescent</span>.</li>
				<li><span class="ui">Extract Channel</span> to get one of the RGB or CMY channels, or <span class="ui">Nudge</span> them relative to one another for that "misaligned print" antique look.</li>
			</ul><a id="section17.4.5"/>
			<h3>17.4.5 The Distort Submenu</h3>
			<p>
				The <span class="ui">Distort</span> submenu's filters apply random distortions to an object's content, transparency mask, or both (<a href="#fig17-12">Figure 17-12</a>).  This includes the versatile adjustable <span class="ui">Roughen</span> where you can set the frequency and amplitude of a random ripple, as well as a number of preset variations on this theme.</p>
				<a id="fig17-12"/>
				<figure>
				<img alt="" src="19/fi-filters-distorts.svg.png"/>
				<figcaption>
					<p>
						Figure 17-12: Filters from the <span class="ui">Distort</span> submenu</p>
				</figcaption>
			</figure>
			<a id="section17.4.6"/>
			<h3>17.4.6 The Fill and Transparency Submenu</h3>
			<p>
				The <span class="ui">Fill and Transparency</span> submenu contains several essential filters:</p>
			<ul>
				<li><span class="ui">Channel Transparency</span> (adjustable) makes parts of an object transparent depending on RGB channel values (for example, to make holes in areas where Red is above a certain threshold).</li>
				<li><span class="ui">Fast Crop</span> does not change the look of the object in any way but adds a rectangular crop frame with X-shaped handles in the top-left and bottom-right corners. Drag the handles to nondestructively crop the object.</li>
				<li><a id="365"/><span epub:type="pagebreak" id="Page_365" title="365"/><span class="ui">Light Eraser</span> renders white or light-colored areas of an object transparent (with the <span class="ui">Invert</span> checkbox, it renders everything except light-colored areas transparent).</li>
				<li><span class="ui">Fill Background</span> fills the transparent parts of an object's bounding box (plus extensions, <a href="#section17.3.1">17.3.1</a>) with an opaque color (this filter is not adjustable, use the <span class="ui">Filter Editor</span> to change the color); <span class="ui">Flatten Transparency</span> does the same with white.</li>
				<li><span class="ui">Opacity</span> (adjustable) thresholds an object's opacity, making all blurred or transparency-gradient edges crisp.</li>
				<li><span class="ui">Silhouette</span> (adjustable) replaces all colors in an object by black or another color of your choice.</li>
			</ul><a id="section17.4.7"/>
			<h3>17.4.7 The Image Effects Submenu</h3>
			<p>
				The <span class="ui">Image Effects</span> submenu contains a few classic bitmap processing algorithms, including <span class="ui">Edge Detect</span> (renders a black-and-white version of the image showing the color boundaries in the original) and <span class="ui">Sharpen</span> (emphasizes color boundaries by increasing their contrast).</p>
				<a id="section17.4.8"/>
				<h3>17.4.8 The Image Paint and Draw Submenu</h3>
			<p>
				The <span class="ui">Image Paint and Draw</span> submenu collects filters that emulate various painting and drawing techniques and materials (<a href="#fig17-13">Figure 17-13</a>). Not all of these emulations are convincing, but many can be inspiring.</p>
				<a id="fig17-13"/>
				<figure>
				<img alt="" src="19/fi-filters-imagepaint.svg.png"/>
				<figcaption>
					<p>
						Figure 17-13: Filters from the <span class="ui">Image Paint and Draw</span> submenu</p>
				</figcaption>
			</figure>
			<a id="section17.4.9"/>
			<h3>17.4.9 The Materials Submenu</h3>
			<p>
				The <span class="ui">Materials</span> submenu's filters imitate various materials, tinted by the object's color and clipped by its opacity mask (<a href="#fig17-14">Figure 17-14</a>). Those with "3D" in the name also add a bevel at the edge.</p>
				<a id="fig17-14"/>
				<figure>
				<img alt="" src="19/fi-filters-materials.svg.png"/>
				<figcaption>
					<p>
						Figure 17-14: Filters from the <span class="ui">Materials</span> submenu</p>
				</figcaption>
			</figure>
			<a id="section17.4.10"/>
			<h3>
				17.4.10 <a id="366"/><span epub:type="pagebreak" id="Page_366" title="366"/>The Morphology Submenu</h3>
			<p><span class="ui">Morphology</span> is Greek for "studying forms"; these filters imitate inset/outset (<a href="c12.xhtml#section12.4">12.4</a>) and various kinds of filling and stroking, as shown in <a href="#fig17-15">Figure 17-15</a>.</p>
			<a id="fig17-15"/>
			<figure>
				<img alt="" src="19/fi-filters-morpho.svg.png"/>
				<figcaption>
					<p>
						Figure 17-15: Filters from the <span class="ui">Morphology</span> submenu</p>
				</figcaption>
			</figure>
			<a id="section17.4.11"/>
			<h3>17.4.11 The Non-Realistic 3D Shaders Submenu</h3>
			<p>
				The <span class="ui">Non-Realistic 3D Shaders</span>, used on flat-colored shapes, are similar to bevels but are thicker, go further in from the edge, and have a much higher contrast between light and shade (hence "non-realistic"), as <a href="#fig17-16">Figure 17-16</a> demonstrates.</p>
				<a id="fig17-16"/>
				<figure>
				<img alt="" src="19/fi-filters-nonreal.svg.png"/>
				<figcaption>
					<p>
						Figure 17-16: Filters from the <span class="ui">Non-Realistic 3D Shaders</span> submenu</p>
				</figcaption>
			</figure>
			<a id="section17.4.12"/>
			<h3>17.4.12 The Overlays Submenu</h3>
			<p><span class="ui">Overlays</span> do not change the object itself but treat it as a pad
for displaying some kind of texture, adding it as an overlay on the
object's original color (and sometimes fully obscuring it), as shown in <a href="#fig17-17">Figure 17-17</a>. This group includes the generic
adjustable <span class="ui">Noise Fill</span>.</p>
			<a id="fig17-17"/><figure>
				<img alt="" src="19/fi-filters-overlays.svg.png"/>
				<figcaption>
					<p>
						Figure 17-17: Filters from the <span class="ui">Overlays</span>
submenu</p>
				</figcaption>
			</figure>
			<a id="section17.4.13"/>
			<h3>17.4.13 The Pixel Tools Submenu</h3>
			<p><span class="ui">Pixel Tools</span> has a single filter, <span class="ui">Pixelize</span>, which suppresses pixel-level anti-aliasing (see <a href="c01.xhtml#fig1-1">Figure 1-1</a>). It
does not rasterize vector shapes—but with this filter, at any level of zoom, they have perfectly crisp (and usually visibly jagged) edges.</p>
			<a id="section17.4.14"/><h3>
				17.4.14 <a id="367"/><span epub:type="pagebreak" id="Page_367" title="367"/>The Protrusions and Ridges Submenus</h3>
			<p><span class="ui">Protrusions</span> are fun filters that add various extensions to your shapes, such as dripping liquid or fire. 
The <span class="ui">Ridges</span> submenu filters turn an object into a narrow ridge along the edge and treat this ridge in various ways (<a href="#fig17-18">Figure 17-18</a>).</p>
			<a id="fig17-18"/><figure>
				<img alt="" src="19/fi-filters-protrusions-ridges.svg.png"/>
				<figcaption>
					<p>
						Figure 17-18: Filters from the <span class="ui">Protrusions</span> and <span class="ui">Ridges</span> submenus</p>
				</figcaption>
			</figure>
			<a id="section17.4.15"/>
			<h3>17.4.15 The Scatter and Shadows and Glows Submenus</h3>
			<p>
				The <span class="ui">Scatter</span> submenu filters explode an object into variously shaped
fragments—tree leaves, cubes (looking more like squares), random spray splotches—and scatter
those fragments randomly around.</p>
			<p>
				The <span class="ui">Shadows and Glows</span> submenu is the place to go for your trusty all-purpose <span class="ui">Drop Shadow</span>:
the adjustable filter lets you select the color and opacity of the shadow (or glow), its displacement relative to the object, and the blur radius (<a href="#fig17-19">Figure 17-19</a>). 
This group also includes a few other filters implementing inner and outer shadows and glows and their combinations.</p>
			<a id="fig17-19"/><figure>
				<img alt="" src="19/fi-filters-scatter-shadows.svg.png"/>
				<figcaption>
					<p>
						Figure 17-19: Filters from the <span class="ui">Scatter</span> and <span class="ui">Shadows and Glows</span>
submenus</p>
				</figcaption>
			</figure>
			<a id="section17.4.16"/>
			<h3>17.4.16 The Textures Submenu</h3>
			<p>
				The <span class="ui">Textures</span> submenu contains various naturalistic textures:
crumpled plastic, jam spread, bark, horizontally striped carpet, and so on (<a href="#fig17-20">Figure 17-20</a>).</p>
			<a id="fig17-20"/><figure>
				<img alt="" src="19/fi-filters-textures.svg.png"/>
				<figcaption>
					<p>
						Figure 17-20: Filters from the <span class="ui">Textures</span> submenu</p>
				</figcaption>
			</figure>
			<a id="section17.5"/>
			<h2>
				17.5 <a id="368"/><span epub:type="pagebreak" id="Page_368" title="368"/>The Filter Editor Dialog</h2>
			<p>
				The preset filters that come with Inkscape are useful not only by themselves but
also as starting points for your own derivative filters. Choosing one of the preset
filters—closest to what you want to get—and working from it is usually 
easier than starting from scratch. Let's look at the <span class="ui">Filter
Editor</span> dialog (<span class="ui">Filters<span class="MenuArrow"> ▶ </span>Filter Editor...</span> from the menu) shown in <a href="#fig17-21">Figure 17-21</a>.</p>
			<a id="fig17-21"/><figure>
				<img alt="" src="19/fi-dialog.svg.png"/>
				<figcaption>
					<p>
						Figure 17-21: Major areas of the <span class="ui">Filter Editor</span> dialog</p>
				</figcaption>
			</figure>
			<a id="section17.5.1"/>
			<h3>17.5.1 The Filters List</h3>
			<p>The top left pane of the dialog lists all filters defined in your
document; select any of them and edit its structure and parameters in the
rest of the dialog. If the currently selected object has a filter applied, that filter will show a
check mark in the list—by setting or removing the check mark, you can apply or unapply
any filter to any object.</p>
			<p>
				Right-click a filter and choose <span class="ui"><strong>Select</strong></span> to select all objects in the document that
use this filter. Filters not currently used by any object remain in the list; to remove 
unused filters from the document, use the <span class="ui"><strong>File<span class="MenuArrow"> ▶ </span>Clean Up Document</strong></span> command.</p>
			<p>
				Under the list, the <span class="ui">New</span> button adds a new filter. If you open
this dialog in an empty document, the list of filters is also empty. Click<span class="ui"><strong>New</strong></span> to create a new empty filter—usually called <code>filter1</code>
(to rename it, just click its name in the list twice and edit the name in place). You can also
duplicate or delete a filter in the list by right-clicking it and using the
corresponding pop-up menu commands.</p>
			<p><a id="369"/><span epub:type="pagebreak" id="Page_369" title="369"/>Now, create or select some object in the document and check the
checkbox for your new filter. Nothing changes—an empty filter does not affect the
rendering of an object. For the filter to actually do something, you need to add some
primitives to it.</p>
			<a id="section17.5.2"/><h3>17.5.2 The Stack of Primitives</h3>
			<p>
				The area to the right of the filter list is the main
filter construction board, where you list, arrange, and connect the stack of<em>primitives</em> that constitute a filter. This will be empty until you add primitives to a filter.</p>
			<p>
				The 16 primitives supported by Inkscape are listed in a drop-down list
next to the <span class="ui">Add Effect</span> button. When you choose a primitive in the list, it displays a
brief description and illustration below—read those descriptions to
get a rough idea of what each primitive does. A detailed explanation of all
primitives is beyond the scope of this book; refer to the SVG specification (<a href="http://w3.org/TR/SVG11/">http://w3.org/TR/SVG11/</a>) for complete details.</p>
			<p>
				Instead, let's look at the step-by-step process of creating a fairly complex
filter that uses several different primitives. My filter is called Sandy Blur; I designed it for the
background coloring of the rose image (see <a href="c25.xhtml#fig25-5">Figure 25-5</a>). This filter aims to imitate blurry
watercolor strokes on rough paper.</p>
			<p>
				Plain Gaussian blur would not work for me: it is too smooth, too obviously computer-generated,
too boring. For an acceptable watercolor imitation, I needed to model both the small-scale
roughness of the paper texture and the larger-scale "blotches" resulting from the watercolor
paint flowing and sticking differently in different spots. For both those sources of
unevenness, I used the <span class="ui">Turbulence</span> primitive that creates random fractal noise at
a given scale (<a href="#fig17-22">Figure 17-22</a>).</p>
			<a id="fig17-22"/><figure>
				<img alt="" src="19/fi-turbsinstack.svg.png"/>
				<figcaption>
					<p>
						Figure 17-22: The two <span class="ui">Turbulence</span> primitives</p>
				</figcaption>
			</figure>
			<p>
				The two <span class="ui">Turbulence</span> primitives are the first two components of the filter—the
two topmost boxes in the stack. Each filter primitive has one or more <em>inputs</em> and
one <em>output</em>; in the list, inputs are depicted by lines coming into the
primitive box horizontally from the right, and the output is the line going from the box
vertically downward. You can wire the connections by dragging, starting from an input
triangle at the right-hand edge of a primitive's box.</p>
			<p>As you can see, the outputs of some primitives are inputs for
others. Generally, information flows top to bottom in the stack of primitives, and the output of the bottommost primitive is what
you see rendered in the document window. You can rearrange the primitives by
dragging; a right-click menu allows you to duplicate or delete a primitive.</p>
			<p><a id="370"/><span epub:type="pagebreak" id="Page_370" title="370"/>What are the vertically stacked boxes on the right? These are the predefined sources
that any primitive can use as input. The most useful of these
are <span class="ui">Source Graphic</span> and <span class="ui">Source Alpha</span>. <span class="ui">Source Graphic</span>, as the name implies, supplies the rendered image of the
object being filtered, at the current zoom's resolution. The <span class="ui">Source Alpha</span> provides a grayscale representation of the original object's
opacity (alpha) mask; points that are fully opaque (regardless of color) in the<span class="ui">Source Graphic</span> will be opaque black on the <span class="ui">Source Alpha</span> image, and points that
are transparent will be transparent black.</p>
			<a id="section17.5.3"/><h3>17.5.3 Parameters of a Primitive</h3>
			<p>
				Let's look again at the two <span class="ui">Turbulence</span> primitives at the top of the stack. They both
take <span class="ui">Source Alpha</span> as input and pass their result—random noise—down to other
primitives. What's different is the parameters of these filters.</p>
			<p>
				When you select a filter primitive in the stack, its parameters are displayed in the
bottom pane of the dialog. <a href="#fig17-23">Figure 17-23</a> shows the parameters of the two <span class="ui">Turbulence</span> primitives.</p>
			<a id="fig17-23"/><figure>
				<img alt="" src="19/fi-turbsparams.svg.png"/>
				<figcaption>
					<p>
						Figure 17-23: The parameters of the two <span class="ui">Turbulence</span>
primitives</p>
				</figcaption>
			</figure>
			<p>
				These two primitives have the same <span class="ui">Type</span> (<span class="ui">Fractal Noise</span>,
which looks better in this case than the other option, <span class="ui">Turbulence</span>), but they differ in<span class="ui">Base Frequency</span> and <span class="ui">Octaves</span>. The <span class="ui">Base Frequency</span> parameter sets the
scale of the turbulence; higher frequency results in smaller, sand-like texture, while
lower frequency produces larger clouds. The number of <span class="ui">Octaves</span> specifies how deep the recursion is in the algorithm: increasing<span class="ui">Octaves</span> produces sharper unevenness with more small details; decreasing this
value gives a smoother, more nebulous image.</p>
			<p>
				Now, to combine the two turbulence outputs, I used
another primitive named <span class="ui">Composite</span>, as shown in <a href="#fig17-24">Figure 17-24</a>.</p>
			<a id="fig17-24"/><figure>
				<img alt="" src="19/fi-composite.svg.png"/>
				<figcaption>
					<p>
						Figure 17-24: The <span class="ui">Composite</span> primitive</p>
				</figcaption>
			</figure>
			<p><a id="371"/><span epub:type="pagebreak" id="Page_371" title="371"/>It has two inputs and combines them, pixel by pixel, using one of a number of
methods.  Here, I used the <span class="ui">Arithmetic</span> method; with the numeric values
of the four coefficients (<span class="ui">K1</span> to <span class="ui">K4</span>) as shown, it results in the large-scale wave and small-scale
ripples being combined into a composite with somewhat increased contrast, as <a href="#fig17-25">Figure 17-25</a> demonstrates.</p>
			<a id="fig17-25"/><figure>
				<img alt="" src="19/fi-twoturbs.svg.png"/>
				<figcaption>
					<p>Figure 17-25: The result of compositing two turbulences</p>
				</figcaption>
			</figure>
			<p>
				So far, I didn't use the image of the object itself to which the
filter will apply—that is, I didn't use the <span class="ui">Source Graphic</span>. Supposedly, that object would be some kind of
a broad brush-like path, likely created with the Calligraphic pen tool (<a href="c14.xhtml#section14.2">14.2</a>). Of course,
the first thing to do to a flat-color, crisp-edged path to make it more like
a watercolor stroke is to blur it, as shown in <a href="#fig17-26">Figure 17-26</a>.</p>
			<a id="fig17-26"/><figure>
				<img alt="" src="19/fi-blur.svg.png"/>
				<figcaption>
					<p>
						Figure 17-26: The <span class="ui">Gaussian Blur</span> primitive</p>
				</figcaption>
			</figure>
			<p><a id="372"/><span epub:type="pagebreak" id="Page_372" title="372"/>The <span class="ui">Standard Deviation</span> parameter of <span class="ui">Gaussian Blur</span> is similar to the blur amount you
would adjust in the <span class="ui">Fill and Stroke</span> dialog (<a href="#fig17-1">Figure 17-1</a>), except that here it is measured in
absolute <code>px</code> units (<a href="b01.xhtml#sectionA.6">A.6</a>), not as a percentage of the object's size.</p>
			<p>
				How to combine the blurred stroke with the turbulence? <span class="ui">Composite</span> won't work here. Any
of its modes will result in a smooth blur being <em>overlaid</em> with the turbulent
ripples, the underlying smoothness not going anywhere (try it). It won't look like
watercolor on a rough paper—more like computer-produced blur viewed through a
spotted glass.</p>
			<p>
				Consider what happens when you paint with a real brush on a real paper. The
blurriness of your stroke results from the softness of the brush—you apply more
pressure in the middle than on the edges of the brush. When a brush meets a dimple in the
paper, that pressure is changed: if this area of the paper is higher, it will get
more paint, as if it were closer to the maximum-pressure point of the
brush; if it is a depression, it will get less paint. In other words, the roughness of
the paper jitters the blurred stroke <em>in the plane of the drawing</em>, as if randomly
displacing parts of the stroke sideways. How do you achieve this with filters?</p>
			<p>
				The <span class="ui">Displacement Map</span> primitive is a perfect match for the job. It takes its first
input and moves its pixels around according to its second input. You can choose which of
the channels (Red, Green, Blue, or Alpha) of the second input will move the first one in
each of the two axis directions (X and Y), as well as the scale of this displacement. In this
case, the first input was the blurred object, and the second input was the composite
turbulence field, of which I took the Alpha channel for both axes (<a href="#fig17-27">Figure 17-27</a>).</p>
			<a id="fig17-27"/><figure>
				<img alt="" src="19/fi-displacement.svg.png"/>
				<figcaption>
					<p>
						Figure 17-27: The <span class="ui">Displacement Map</span> primitive</p>
				</figcaption>
			</figure>
			<p>
				As an added bonus, the result looks rougher in some areas and smoother in
others. This is because in the smooth areas, the displacement map hits the almost-flat
inner parts of the blurred stroke—where the high-frequency jitter just moves around
pixels of almost the same
color, which barely disturbs the <a id="373"/><span epub:type="pagebreak" id="Page_373" title="373"/>smoothness.
On the edges of the
stroke, however, different-colored pixels are mixed and jittered, producing visible
roughness. All this is additionally modulated by the low-frequency noise, producing a
convincing watercolor simulation.</p>
			<p>
				However, if you apply this filter to a light-colored stroke (and not black, as in<a href="#fig17-27">Figure 17-27</a>), the result is still not perfect. When you're looking at a real rough
paper with watercolor strokes on it, what you see is not just the spatial distribution of 
paint; you also see the roughness itself, which looks like a pattern of shades. Without
this shading, light-colored strokes with this filter still look too unnaturally
flat. Fortunately, that was easy to fix; I already had the high-frequency turbulence
source, which worked nicely as shading once I composed it with the
displacement-mapped blur (<a href="#fig17-28">Figure 17-28</a>).</p>
			<a id="fig17-28"/><figure>
				<img alt="" src="19/fi-final.svg.png"/>
				<figcaption>
					<p>
						Figure 17-28: The final filter and the parameters of the last<span class="ui">Composite</span> primitive that overlays the shading</p>
				</figcaption>
			</figure>
			<p>At this point, the filter looked pretty decent. I could
keep improving on it, adding various smears, water leaks, diffusion, and so on; however,
since my demo image used this filter only for the background, it was 
good enough for the purpose.</p>
			<a id="section17.5.4"/><h3>17.5.4 The Filter Area</h3>
			<p>
				The second tab in the filter parameter area in the <span class="ui">Filter Editor</span> dialog is called<span class="ui">Filter General Settings</span>. It contains parameters that apply to the entire filter
stack, not any single primitive. Currently, the only thing you can change here is the<em>filter area</em>—the area that the filter will render into, measured in the units
of the bounding box of the object to which the filter is applied. You can edit this area interactively on canvas
(<a href="#section17.3.1">17.3.1</a>), but the <span class="ui">Filter Editor</span> allows you to set it numerically.</p>
			<p><a id="374"/><span epub:type="pagebreak" id="Page_374" title="374"/>The <span class="ui">Coordinates</span> widgets specify the top-left corner of the area, and the<span class="ui">Dimensions</span> specify the bottom-right corner. All values are measured in
the units of the pre-filter bounding box size.</p>
			<p>
				For example, if you set the<span class="ui">Coordinates</span> to 0/0 in and the <span class="ui">Dimensions</span> to 1/1, the area will be
equal to the pre-filter bounding box. This will work if your filter does not reach
beyond the object—for example, if it's just a color change with a <span class="ui">Color Matrix</span> primitive.
However, for anything like blur that paints outside the bounding box,
you need to provide sufficient margins for this to prevent cropping. When
you apply blur via the <span class="ui">Fill and Stroke</span> dialog or use one of the preset filters, these margins are set
for you automatically; however, when creating a new
filter stack from scratch, you must take care of it yourself. The default is
0.1/0.1 for <span class="ui">Coordinates</span> and 1.2/1.2 for<span class="ui">Dimensions</span>, which results in 10 percent margins on all sides of the
object, as shown in <a href="#fig17-29">Figure 17-29</a>.</p>
			<a id="fig17-29"/><figure>
				<img alt="" src="19/fi-area.svg.png"/>
				<figcaption>
					<p>Figure 17-29: Specifying the filter area</p>
				</figcaption>
			</figure>
			<p>
				If Inkscape uses the visual bounding box (which is the default, <a href="c04.xhtml#section4.3">4.3</a>), the
bounding box of a filtered object—the frame you see when you select it in the Selector—is 
the enlarged filter area. Among other things, this means that, when exporting a
selected object to bitmap (<a href="c18.xhtml#section18.6">18.6</a>), Inkscape will make sure the bitmap contains the
blurred edges without cropping.</p>
			<a id="section17.6"/><h2>17.6 Filter Rendering Options</h2>
			<p>The rendering speed of Inkscape filters has been greatly improved over the years. Still,
with complex or large-area filters it may still be an issue. That's why Inkscape
has a number of preference options to tweak the performance of filters (and rendering in general).</p>
			<p>
				First, you can always switch to Outline mode (<a href="c03.xhtml#section3.14">3.14</a>) to speed
up rendering while working on a document. There is also the No Filters mode, which is the
same as normal mode except that filters aren't rendered; this is perhaps the easiest workaround
if filters are the main source of slowness for you.</p>
			<p><span class="NoteHead">[1.1]</span></p>
			<p><a id="375"/><span epub:type="pagebreak" id="Page_375" title="375"/>Options that affect rendering speed are collected on the <span class="ui">Rendering</span> page of the <span class="ui">Preferences</span> dialog (<a href="#fig17-30">Figure 17-30</a>).
You can set the <span class="ui">Number of threads</span> (simultaneously executing rendering pipelines), four by default; it is often
recommended to set this equal to the number of logical processors your CPU has (in my case it is eight).
You can also increase the <span class="ui">Rendering cache</span> (64MB by default) and enlarge the <span class="ui">Rendering tile multiplier</span> (16 by default).
If you have modern enough hardware and plentiful RAM, it is worth increasing these values to see how much of an improvement you can get.
Also, if you notice slowdowns when the screen is updated during editing (for example, when you're dragging nodes),
try switching <span class="ui">Redraw while editing</span> from the default <span class="ui">Responsive</span> to <span class="ui">Conservative</span>.</p>
			<a id="fig17-30"/><figure>
				<img alt="" src="19/fi-prefs.png"/>
				<figcaption>
					<p>
						Figure 17-30: The <span class="ui">Rendering</span> page of the <span class="ui">Preferences</span> dialog</p>
				</figcaption>
			</figure>
			<p>
				Options that apply specifically to filters include the two groups of radio buttons: <span class="ui">Gaussian blur quality for display</span>
and <span class="ui">Filter effects quality for display</span>—this is where you search for the speed/quality tradeoff that works best for you.
The first group affects only blur; the default,<span class="ui">Average quality</span>, looks <em>almost</em> perfect and renders reasonably fast. At
lower quality settings, visible defects appear, but rendering becomes even faster; the
higher settings bring little quality improvement but are significantly slower.</p>
			<p>
				The second set of radio buttons applies to all filters (including blur). It also
offers to trade an improvement in rendering speed for worse rendering quality, but its
speed advantage is less significant, so here the <span class="ui">Better quality</span> option is
probably optimal.</p>
			<aside epub:type="sidebar">
				<div class="top hr">
					<hr/>
				</div>
				<section class="note">
					<h2><span class="NoteHead">NOTE</span></h2>
					<p><a id="376"/><span epub:type="pagebreak" id="Page_376" title="376"/>Bitmap export (<a href="c18.xhtml#section18.6">18.6</a>) as well as rasterization of filters for
PS/EPS/PDF export (<a href="#section17.7">17.7</a>) always use the highest quality setting, which is why exporting is usually
slower than rendering the same image on the screen at the same resolution.</p>
					<div class="bottom hr">
						<hr/>
					</div>
				</section>
			</aside>
			<a id="section17.7"/>
			<h2>17.7 Exporting Filters to PS and PDF</h2>
			<p>
				PostScript
and PDF formats, while being vector, do not support anything like SVG's
filters. By default, during export, Inkscape offers to rasterize (convert into a bitmap) any object with a filter applied.
This fully preserves the appearance the filter had in Inkscape, but it may increase the file size significantly. In the
export options dialog, you can specify the resolution of the bitmaps, as well as turn
rasterization off, in which case objects remain vectors but lose any filtering (<a href="#fig17-31">Figure 17-31</a>).</p>
			<a id="fig17-31"/><figure>
				<img alt="" src="19/fi-export.svg.png"/>
				<figcaption>
					<p>Figure 17-31: Specifying the treatment of filters when saving a document as PDF</p>
				</figcaption>
			</figure>
			<p>
				When exporting via the command line (<a href="b03.xhtml#sectionC.4">C.4</a>), the corresponding options are<code>--export-dpi</code> to specify the resolution and<code>--export-ignore-filters</code> to turn off rasterization.</p>
		</section>
	</body>
</html>