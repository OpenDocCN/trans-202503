<html><head></head><body><section epub:type="chapter" id="repetition_a_deeper_exploration_of_loops" title="Chapter&#xA0;7.&#xA0;Repetition: A Deeper Exploration of Loops"><div class="titlepage"><div class="book"><div class="book"><h2 class="title1">Chapter 7. Repetition: A Deeper Exploration of Loops</h2></div></div></div><p class="calibre3"><a class="calibre" id="iddle1212"/><a class="calibre" id="iddle1273"/><a class="calibre" id="iddle1496"/><a class="calibre" id="iddle1501"/><a class="calibre" id="iddle1650"/><a class="calibre" id="iddle1830"/>You’ve seen some of Scratch’s repetition structures before, but this chapter
covers them in greater detail. It’s time to discuss new blocks that create loops, nested
loops, and recursion. By the end of this chapter, we’ll have explored the following
programming concepts:</p><div class="book"><ul class="itemizedlist"><li class="listitem1"><p class="calibre3">Repetition structures to execute statements repeatedly</p></li><li class="listitem1"><p class="calibre3">How to validate user input</p></li><li class="listitem1"><p class="calibre3">Counter-controlled and event-controlled loops</p></li><li class="listitem1"><p class="calibre3">Procedures that can call themselves with recursion</p></li></ul></div><p class="calibre3">Although most people find repetitive tasks boring, computers seem to like nothing more.
<span class="calibre"><em class="calibre6">Repetition structures</em></span>, better known as <span class="calibre"><em class="calibre6">loops</em></span>, are
programming commands that tell a computer to repeatedly execute a statement or a sequence of
statements. The simplest kind of loop is a <span class="calibre"><em class="calibre6">definite loop</em></span>, which repeats a
sequence of statements a specific number of times. These loops <a class="calibre" id="iddle1193"/><a class="calibre" id="iddle1199"/><a class="calibre" id="iddle1203"/><a class="calibre" id="iddle1204"/><a class="calibre" id="iddle1228"/><a class="calibre" id="iddle1229"/><a class="calibre" id="iddle1379"/><a class="calibre" id="iddle1430"/><a class="calibre" id="iddle1431"/><a class="calibre" id="iddle1437"/><a class="calibre" id="iddle1494"/><a class="calibre" id="iddle1498"/><a class="calibre" id="iddle1499"/><a class="calibre" id="iddle1500"/><a class="calibre" id="iddle1503"/><a class="calibre" id="iddle1504"/>are also called <span class="calibre"><em class="calibre6">counter-controlled loops</em></span> or <span class="calibre"><em class="calibre6">counted
loops</em></span>. Other types of loops continue to repeat until some condition occurs; these are
called <span class="calibre"><em class="calibre6">condition-controlled loops</em></span> or <span class="calibre"><em class="calibre6">indefinite loops</em></span>.
Another loop, called an <span class="calibre"><em class="calibre6">infinite loop</em></span>, repeats forever.</p><p class="calibre3">In this chapter, you’ll learn about the different repetition structures available in
Scratch. I’ll explain both counter-controlled and condition-controlled loops in detail, and
I’ll introduce you to the <span class="calibre"><strong class="calibre5">stop</strong></span> block, which you can use to
end infinite loops. You’ll learn how to use loops to validate user input, as well.</p><p class="calibre3">The chapter also discusses <span class="calibre"><em class="calibre6">nested loops</em></span> (loops that contain other loops)
and shows several examples of their use. We’ll also talk about
<span class="calibre"><em class="calibre6">recursion</em></span>—a procedure calling itself—as another way to achieve
repetition. At last, we’ll develop a number of interesting applications that use both loops
and conditionals, and we’ll look at incorporating loops into practical programs.</p><div class="book" title="More Loop Blocks in Scratch"><div class="titlepage1"><div class="book"><div class="book"><h2 class="title2" id="more_loop_blocks_in_scratch">More Loop Blocks in Scratch</h2></div></div></div><p class="calibre3">As you learned in <a class="xref" href="ch02.html" title="Chapter 2. Motion and Drawing">Chapter 2</a>, loop blocks allow you to repeat a
command or a set of commands in a program. Scratch supports the three repetition blocks shown in
<a class="xref" href="ch07.html#scratchapostrophes_repeat_blocks" title="Figure 7-1. Scratch’s repeat blocks">Figure 7-1</a>.</p><div class="figure"><a id="scratchapostrophes_repeat_blocks" class="calibre"/><div class="book"><div class="book"><a id="med_id00224" class="calibre"/><img alt="Scratch’s repeat blocks" src="httpatomoreillycomsourcenostarchimages2134793.png.jpg" class="calibre7"/></div></div><div class="figure-title">Figure 7-1. Scratch’s repeat blocks</div></div><p class="calibre3">You’ve already used two of these blocks, the <span class="calibre"><strong class="calibre5">repeat</strong></span>
and the <span class="calibre"><strong class="calibre5">forever</strong></span> blocks, in many examples throughout this book. In
this section, we’ll examine the third kind of loop block—the <span class="calibre"><strong class="calibre5">repeat until</strong></span> block—and explain some of the technical terms associated with loops
in general.</p><p class="calibre3">Each repetition of a loop is called an <span class="calibre"><em class="calibre6">iteration</em></span>, and the word
<span class="calibre"><em class="calibre6">count</em></span> is often used to describe the number of times a loop repeats. The
<span class="calibre"><strong class="calibre5">repeat</strong></span> block, which you are very familiar with, is a
counter-controlled loop because it repeats its commands a specific number of times. We usually use
this loop when we know the number of repetitions the loop will need to execute, as when we want to
draw a polygon with a known number of sides.</p><p class="calibre3">On the other hand, the <span class="calibre"><strong class="calibre5">repeat until</strong></span> block is a
condition-controlled loop. The statements inside this block are repeated based on the truth or
falsity of its test expression. We use this block when we don’t know in advance how many times
the loop will need to repeat and want the repetition to continue until some condition is met. You
can say, for example, “Repeat the <span class="calibre"><strong class="calibre5">ask</strong></span> command until the
user enters a positive number.” Or, “Repeat firing missiles until the player’s
energy level drops below a certain value.” The following sections explain condition-controlled
loops in more detail.</p><div class="book" title="The repeat until Block"><div class="titlepage1"><div class="book"><div class="book"><h3 class="title3" id="repeat_until_block">The repeat until Block</h3></div></div></div><p class="calibre3"><a class="calibre" id="iddle1104"/><a class="calibre" id="iddle1279"/><a class="calibre" id="iddle1366"/><a class="calibre" id="iddle1886"/>Let’s say you are developing a game that presents the player with an elementary
math question. If the player’s answer is incorrect, the game asks the same question again to
give the player another chance. In other words, the game asks the same question
<span class="calibre"><em class="calibre6">until</em></span> the player enters the correct answer. Clearly, the <span class="calibre"><strong class="calibre5">repeat</strong></span> block is inappropriate for this task because you don’t know in
advance how many times it will take the player to enter the right answer; the first try might be a
winner, or it may take 100 tries. The <span class="calibre"><strong class="calibre5">repeat until</strong></span> block can help
you in scenarios like this one. The structure of the <span class="calibre"><strong class="calibre5">repeat until</strong></span>
block is illustrated in <a class="xref" href="ch07.html#repeat_until_block_allows_you_to_execute" title="Figure 7-2. The repeat until block allows you to execute a series of instructions repeatedly until some condition is true.">Figure 7-2</a>.</p><div class="figure"><a id="repeat_until_block_allows_you_to_execute" class="calibre"/><div class="book"><div class="book"><a id="med_id00225" class="calibre"/><img alt="The repeat until block allows you to execute a series of instructions repeatedly until some condition is true." src="httpatomoreillycomsourcenostarchimages2134795.png.jpg" class="calibre7"/></div></div><div class="figure-title">Figure 7-2. The <span class="calibre">repeat until</span> block allows you to execute a series of
instructions repeatedly until some condition is true.</div></div><p class="calibre3">This block contains a Boolean expression whose value is tested at the entry of the loop. If
the expression is false, the commands inside the loop are executed. When the last command in the
loop is executed, the loop starts over, and the expression is tested again. If the expression is
still false, the commands inside the loop are executed again. This cycle repeats
<span class="calibre"><em class="calibre6">until</em></span> the test expression becomes true. When that happens, the commands inside
the loop are skipped, and the program moves to the command that immediately follows the loop.</p><p class="calibre3">Note that if the test condition is already true before the program runs the loop the first
time, the commands in the loop won’t be executed. Also, the <span class="calibre"><strong class="calibre5">repeat
until</strong></span> block won’t terminate unless a command (either inside the loop or in some
other active part of the program) causes the test condition to become true. If the result of the
test condition never becomes true, we get into an infinite loop.</p><p class="calibre3"><a class="xref" href="ch07.html#simple_example_showing_the_repeat_until" title="Figure 7-3. A simple example showing the repeat until block in action">Figure 7-3</a> shows a practical example of using
the <span class="calibre"><strong class="calibre5">repeat until</strong></span> block. In this example, as long as the
<code class="literal">Player</code> sprite is more than 100 steps away from the <code class="literal">Guard</code>
sprite, the <code class="literal">Guard</code> sprite will continue to move in its current direction
(horizontally in this case), bouncing when it touches the left or the right edge of the Stage. If
the distance between the two sprites becomes less than 100, the <span class="calibre"><strong class="calibre5">repeat
until</strong></span> block will terminate, and the <code class="literal">Guard</code> sprite will start to chase
the <code class="literal">Player</code> sprite. The code for the chase is not shown in the figure. The
<span class="calibre"><strong class="calibre5">distance to</strong></span> block is found in the <span class="calibre"><em class="calibre6">Sensing</em></span>
palette.</p><div class="figure"><a id="simple_example_showing_the_repeat_until" class="calibre"/><div class="book"><div class="book"><a id="med_id00226" class="calibre"/><img alt="A simple example showing the repeat until block in action" src="httpatomoreillycomsourcenostarchimages2134797.png.jpg" class="calibre7"/></div></div><div class="figure-title">Figure 7-3. A simple example showing the <span class="calibre">repeat until</span> block in
action</div></div><div class="sidebar"><a id="try_it_out_7-1" class="calibre"/><div class="sidebar-title">Try It Out 7-1</div><p class="calibre3"><a class="calibre" id="iddle1162"/><a class="calibre" id="iddle1163"/><a class="calibre" id="iddle1192"/><a class="calibre" id="iddle1200"/><a class="calibre" id="iddle1380"/><a class="calibre" id="iddle1381"/><a class="calibre" id="iddle1497"/><a class="calibre" id="iddle1505"/><a class="calibre" id="iddle1746"/><a class="calibre" id="iddle2050"/>Open the application <span class="calibre"><em class="calibre6">Chase.sb2</em></span> and run it. Use the arrow keys to
move the <code class="literal">Player</code> sprite close to the <code class="literal">Guard</code> to see the chase in
action. How would you change the test condition to unleash the <code class="literal">Guard</code> sprite if
the <span class="calibre"><em class="calibre6">y</em></span>-position of the <code class="literal">Player</code> sprite goes outside a certain
range (for example, –50 to 50)? Implement this change to check your solution.</p><p class="calibre3"><span class="calibre"><em class="calibre6">Chase.sb2</em></span></p></div></div><div class="book" title="Building a forever if Block"><div class="titlepage1"><div class="book"><div class="book"><h3 class="title3" id="building_a_forever_if_block">Building a forever if Block</h3></div></div></div><p class="calibre3">Infinite loops are useful in a lot of programming situations. In the previous chapters, for
example, you used the <span class="calibre"><strong class="calibre5">forever</strong></span> block to play background music, and
you animated sprites by changing their costumes continuously. The <span class="calibre"><strong class="calibre5">forever</strong></span> block is an <span class="calibre"><em class="calibre6">unconditional infinite loop</em></span> because it
doesn’t have a test condition that controls the execution of the commands inside it.</p><p class="calibre3">You can easily change that, however, by nesting an <span class="calibre"><strong class="calibre5">if</strong></span> block
inside a <span class="calibre"><strong class="calibre5">forever</strong></span> block to create a <span class="calibre"><em class="calibre6">conditional infinite
loop</em></span>, as shown in <a class="xref" href="ch07.html#you_can_create_a_foreversolidusif_loop_b" title="Figure 7-4. You can create a forever/if loop by combining a forever block with an if block.">Figure 7-4</a>. The test
condition of the <span class="calibre"><strong class="calibre5">if</strong></span> block is tested at the beginning of every
iteration, and its commands only execute when the test condition is true. Note that since the
<span class="calibre"><strong class="calibre5">forever</strong></span> block is supposed to execute forever, you can’t
snap command blocks after it.</p><div class="figure"><a id="you_can_create_a_foreversolidusif_loop_b" class="calibre"/><div class="book"><div class="book"><a id="med_id00227" class="calibre"/><img alt="You can create a forever/if loop by combining a forever block with an if block." src="httpatomoreillycomsourcenostarchimages2134799.png.jpg" class="calibre7"/></div></div><div class="figure-title">Figure 7-4. You can create a <span class="calibre">forever/if</span> loop by combining a <span class="calibre">forever</span> block with an <span class="calibre">if</span> block.</div></div><p class="calibre3"><a class="calibre" id="iddle1043"/><a class="calibre" id="iddle1044"/><a class="calibre" id="iddle1974"/>The combined <span class="calibre"><strong class="calibre5">forever/if</strong></span> structure is frequently used
to control sprite movement with the keyboard arrow keys, as demonstrated in <a class="xref" href="ch07.html#these_scripts_allow_you_to_move_a_sprite" title="Figure 7-5. These scripts allow you to move a sprite using the keyboard arrow keys. Each script responds to one of the four keys.">Figure 7-5</a>.</p><div class="figure"><a id="these_scripts_allow_you_to_move_a_sprite" class="calibre"/><div class="book"><div class="book"><a id="med_id00228" class="calibre"/><img alt="These scripts allow you to move a sprite using the keyboard arrow keys. Each script responds to one of the four keys." src="httpatomoreillycomsourcenostarchimages2134801.png.jpg" class="calibre7"/></div></div><div class="figure-title">Figure 7-5. These scripts allow you to move a sprite using the keyboard arrow keys. Each script responds
to one of the four keys.</div></div><p class="calibre3"><span class="calibre"><em class="calibre6">ArrowKeys1.sb2</em></span></p><p class="calibre3">When the green flag icon is pressed, the four keyboard arrow keys (left, right, up, and down)
are monitored in four independent infinite loops. When any of these keys is pressed, the
corresponding loop causes a change in the <span class="calibre"><em class="calibre6">x</em></span>- or
<span class="calibre"><em class="calibre6">y</em></span>-coordinate of the sprite.</p><p class="calibre3">Create these scripts in Scratch (or open <span class="calibre"><em class="calibre6">ArrowKeys1.sb2</em></span>) and run the
program. Notice that if you press the up and right arrow keys simultaneously, the sprite will move
diagonally in the northeast direction. Try other combinations of the arrow keys to see how the
application responds.</p><div class="sidebar"><a id="try_it_out_7-2" class="calibre"/><div class="sidebar-title">Try It Out 7-2</div><p class="calibre3">Another way to control the sprite’s movement with the arrow keys is shown below. Compare
this method to the one shown in <a class="xref" href="ch07.html#these_scripts_allow_you_to_move_a_sprite" title="Figure 7-5. These scripts allow you to move a sprite using the keyboard arrow keys. Each script responds to one of the four keys.">Figure 7-5</a>. Which is
more responsive to keyboard strokes? How does the alternate script behave if you press two keys (for
example, up and right) simultaneously? Now, try placing the four <span class="calibre"><strong class="calibre5">if</strong></span> blocks in <a class="xref" href="ch07.html#these_scripts_allow_you_to_move_a_sprite" title="Figure 7-5. These scripts allow you to move a sprite using the keyboard arrow keys. Each script responds to one of the four keys.">Figure 7-5</a> together in a
single <span class="calibre"><strong class="calibre5">forever</strong></span> loop and press two arrow keys at the same time.
How does the sprite’s behavior change?</p><div class="informalfigure"><a id="med_id00229a" class="calibre"/><div class="book"><a id="med_id00229" class="calibre"/><img alt="image with no caption" src="httpatomoreillycomsourcenostarchimages2134803.png.jpg" class="calibre7"/></div></div></div></div></div><div class="book" title="Stop Commands"><div class="titlepage1"><div class="book"><div class="book"><h2 class="title2" id="stop_commands">Stop Commands</h2></div></div></div><p class="calibre3"><a class="calibre" id="iddle1205"/><a class="calibre" id="iddle2004"/><a class="calibre" id="iddle2005"/>Let’s say you’re writing a program to find the first integer less than 1,000
that is evenly divisible by 3, 5, and 7. You can write a script that checks the numbers 999, 998,
997, and so on, one by one, in a loop. You want to <span class="calibre"><em class="calibre6">stop</em></span> the search when you
find the number you’re looking for (945 in this example).</p><p class="calibre3">How can you tell Scratch to end the loop and stop the script? You can use the <span class="calibre"><strong class="calibre5">stop</strong></span> command (from the <span class="calibre"><em class="calibre6">Control</em></span> palette) to end active
scripts. The drop-down menu provides the three options shown in <a class="xref" href="ch07.html#using_the_stop_command_in_scratch" title="Figure 7-6. Using the stop command in Scratch">Figure 7-6</a>.</p><div class="figure"><a id="using_the_stop_command_in_scratch" class="calibre"/><div class="book"><div class="book"><a id="med_id00230" class="calibre"/><img alt="Using the stop command in Scratch" src="httpatomoreillycomsourcenostarchimages2134805.png.jpg" class="calibre7"/></div></div><div class="figure-title">Figure 7-6. Using the <span class="calibre">stop</span> command in Scratch</div></div><p class="calibre3">The first option immediately terminates the script that calls it. The second option, on the
other hand, stops all running scripts in your application; it is equivalent to the red stop icon
located at the top of the Stage. Note that you can’t snap any commands after the <span class="calibre"><strong class="calibre5">stop</strong></span> block when you use either of these two options.</p><p class="calibre3"><span class="calibre"><em class="calibre6">StopDemo.sb2</em></span></p><p class="calibre3">The third <span class="calibre"><strong class="calibre5">stop</strong></span> option allows a sprite or the Stage to end
all of its scripts except the one that invoked the <span class="calibre"><strong class="calibre5">stop</strong></span> block.
This command is shaped as a stack block, so you can add blocks below it to execute after it suspends
the sprite’s other scripts. Let’s see this command in action in a simple game,
illustrated in <a class="xref" href="ch07.html#in_this_gamecomma_the_player_moves_the_w" title="Figure 7-7. In this game, the player moves the witch on the Stage while trying to avoid the two balls.">Figure 7-7</a>.</p><div class="figure"><a id="in_this_gamecomma_the_player_moves_the_w" class="calibre"/><div class="book"><div class="book"><a id="med_id00231" class="calibre"/><img alt="In this game, the player moves the witch on the Stage while trying to avoid the two balls." src="httpatomoreillycomsourcenostarchimages2134807.png.jpg" class="calibre7"/></div></div><div class="figure-title">Figure 7-7. In this game, the player moves the witch on the Stage while trying to avoid the two
balls.</div></div><p class="calibre3">The two balls in this figure move around the Stage and chase the witch. The player moves the
witch sprite with the keyboard and tries to avoid being touched by the two balls. If the red ball
touches the player at any time, the game ends. If the green ball touches the player, it will stop
chasing the player, but the red ball will start to move a little faster—which makes escaping
it a real challenge.</p><p class="calibre3">The scripts for moving the witch sprite are similar to those of <a class="xref" href="ch07.html#these_scripts_allow_you_to_move_a_sprite" title="Figure 7-5. These scripts allow you to move a sprite using the keyboard arrow keys. Each script responds to one of the four keys.">Figure 7-5</a>, so I won’t show them here. The scripts
for the two balls are shown in <a class="xref" href="ch07.html#scripts_for_the_green_ball_left_parenthe" title="Figure 7-8. Scripts for the green ball (left) and red ball (right)">Figure 7-8</a>—let’s take a look at those.</p><div class="figure"><a id="scripts_for_the_green_ball_left_parenthe" class="calibre"/><div class="book"><div class="book"><a id="med_id00232" class="calibre"/><img alt="Scripts for the green ball (left) and red ball (right)" src="httpatomoreillycomsourcenostarchimages2134809.png.jpg" class="calibre7"/></div></div><div class="figure-title">Figure 7-8. Scripts for the green ball (left) and red ball (right)</div></div><p class="calibre3">When the green ball touches the player, it increases the <code class="literal">speed</code> variable
(which sets the movement speed of the red ball), and it invokes the <span class="calibre"><strong class="calibre5">stop
this script</strong></span> command to terminate its script. All other scripts in the game should
continue to run normally. Using the <span class="calibre"><strong class="calibre5">stop this script</strong></span> command
works well here because we only want to speed up the red ball once. If the red ball touches the
player, however, it executes the <span class="calibre"><strong class="calibre5">stop all</strong></span> command, which causes
all running scripts in the application to stop.</p><div class="sidebar"><a id="try_it_out_7-3" class="calibre"/><div class="sidebar-title">Try It Out 7-3</div><p class="calibre3">Load this game and play it to see how it works. Watch what happens to the yellow border around
the two scripts of <a class="xref" href="ch07.html#scripts_for_the_green_ball_left_parenthe" title="Figure 7-8. Scripts for the green ball (left) and red ball (right)">Figure 7-8</a> when the green and the
red balls touch the <code class="literal">Player</code>.</p></div><p class="calibre3">You can also use the <span class="calibre"><strong class="calibre5">stop</strong></span> block to terminate a procedure
and make it return to the caller at any point during its execution. The next section shows this
concept in action.</p><div class="book" title="Ending a Computational Loop"><div class="titlepage1"><div class="book"><div class="book"><h3 class="title3" id="ending_a_computational_loop">Ending a Computational Loop</h3></div></div></div><p class="calibre3"><a class="calibre" id="iddle1433"/><a class="calibre" id="iddle1502"/><a class="calibre" id="iddle1607"/><a class="calibre" id="iddle1727"/><a class="calibre" id="iddle2056"/><a class="calibre" id="iddle2060"/><span class="calibre"><em class="calibre6">NumberSearch.sb2</em></span></p><p class="calibre3">Let’s say that we want to find the first power of 2 that is larger than 1,000.
We’ll write a procedure that checks the numbers 2<sup class="calibre36">1</sup>,
2<sup class="calibre36">2</sup>, 2<sup class="calibre36">3</sup>, 2<sup class="calibre36">4</sup>, and so
on, in a loop. When we find the number we need, we want the program to say the answer and stop the
procedure. <a class="xref" href="ch07.html#two_ways_to_find_the_first_power_of_2_th" title="Figure 7-9. Two ways to find the first power of 2 that is larger than 1,000">Figure 7-9</a> shows two ways to implement
this approach.</p><div class="figure"><a id="two_ways_to_find_the_first_power_of_2_th" class="calibre"/><div class="book"><div class="book"><a id="med_id00233" class="calibre"/><img alt="Two ways to find the first power of 2 that is larger than 1,000" src="httpatomoreillycomsourcenostarchimages2134811.png.jpg" class="calibre7"/></div></div><div class="figure-title">Figure 7-9. Two ways to find the first power of 2 that is larger than 1,000</div></div><p class="calibre3">The procedure on the left in <a class="xref" href="ch07.html#two_ways_to_find_the_first_power_of_2_th" title="Figure 7-9. Two ways to find the first power of 2 that is larger than 1,000">Figure 7-9</a>
initializes the <code class="literal">result</code> variable to 2, which is the first power of 2 to be
checked, and enters an infinite loop in search for the answer. It checks the value of
<code class="literal">result</code> in each iteration of the loop. If <code class="literal">result</code> is greater
than 1,000, the procedure invokes the <span class="calibre"><strong class="calibre5">stop this script</strong></span> command to
stop and return to the caller. Otherwise, the command after the <span class="calibre"><strong class="calibre5">if</strong></span> block (which multiplies the previous value of <code class="literal">result</code> by 2)
executes, and the next iteration of the loop begins. If you trace through this procedure,
you’ll see that the <span class="calibre"><strong class="calibre5">if</strong></span> block finds
<code class="literal">result</code> to be 2 in the first iteration, 4 in the second iteration, 8 in the third
iteration, and so on. This continues until <code class="literal">result</code> exceeds 1,000; at this point,
the procedure stops and returns to the caller, which displays the result using the <span class="calibre"><strong class="calibre5">say</strong></span> block.</p><p class="calibre3"><a class="xref" href="ch07.html#two_ways_to_find_the_first_power_of_2_th" title="Figure 7-9. Two ways to find the first power of 2 that is larger than 1,000">Figure 7-9</a> (right) shows another way to
implement the procedure. Here, we used a <span class="calibre"><strong class="calibre5">repeat until</strong></span> block that
continues to loop until <code class="literal">result</code> becomes greater than 1,000. As in the first
implementation, the loop continues to double the value of <code class="literal">result</code> until it exceeds
1,000. When this happens, the loop terminates naturally, and the procedure returns to the caller.
Note that we did not have to use the <span class="calibre"><strong class="calibre5">stop</strong></span> block in this
case.</p><p class="calibre3">The <span class="calibre"><strong class="calibre5">stop</strong></span> block is also useful when you need to validate
input from users. You’ll see an example of this practical application next.</p></div><div class="book" title="Validating User Input"><div class="titlepage1"><div class="book"><div class="book"><h3 class="title3" id="validating_user_input">Validating User Input</h3></div></div></div><p class="calibre3">When you write an application that reads some data from the user, you should always check that
the entered values are valid before starting to process the data. Repetition structures can help you
with this task. If the user’s input is invalid, you can use a loop to display an appropriate
error message and ask the user to reenter the value.</p><p class="calibre3">To demonstrate, let’s say that you are developing a game with two levels and you want to
let the user select a level to play. The only valid entries in this case are the numbers 1 and 2. If
the user enters a number other than these two numbers, you’d like to offer another chance to
enter an acceptable value. One way to implement this check is shown in <a class="xref" href="ch07.html#input_validation_using_the_forever_block" title="Figure 7-10. Input validation using the forever block">Figure 7-10</a>.</p><div class="figure"><a id="input_validation_using_the_forever_block" class="calibre"/><div class="book"><div class="book"><a id="med_id00234" class="calibre"/><img alt="Input validation using the forever block" src="httpatomoreillycomsourcenostarchimages2134813.png.jpg" class="calibre7"/></div></div><div class="figure-title">Figure 7-10. Input validation using the <span class="calibre">forever</span> block</div></div><p class="calibre3">The <span class="calibre"><strong class="calibre5">GetLevel</strong></span> procedure asks the user to enter a choice and
checks the answer inside a <span class="calibre"><strong class="calibre5">forever</strong></span> loop. If the user’s
answer is invalid, the loop prompts the user to reenter the level. If the user enters a valid
number, the procedure calls <span class="calibre"><strong class="calibre5">stop this script</strong></span> to terminate the
loop and end the procedure. When this happens, the main script, which has been patiently waiting for
the <span class="calibre"><strong class="calibre5">GetLevel</strong></span> procedure to return, moves on to execute the
<span class="calibre"><strong class="calibre5">say</strong></span> command. <a class="xref" href="ch07.html#input_validation_using_the_repeat_until" title="Figure 7-11. Input validation using the repeat until block">Figure 7-11</a> shows how to achieve the same task using the
<span class="calibre"><strong class="calibre5">repeat until</strong></span> block.</p><div class="figure"><a id="input_validation_using_the_repeat_until" class="calibre"/><div class="book"><div class="book"><a id="med_id00235" class="calibre"/><img alt="Input validation using the repeat until block" src="httpatomoreillycomsourcenostarchimages2134815.png.jpg" class="calibre7"/></div></div><div class="figure-title">Figure 7-11. Input validation using the <span class="calibre">repeat until</span> block</div></div><p class="calibre3">The procedure in <a class="xref" href="ch07.html#input_validation_using_the_repeat_until" title="Figure 7-11. Input validation using the repeat until block">Figure 7-11</a> asks the user to
enter a choice and waits for the answer. If the user enters 1 or 2, the condition in the header of
the <span class="calibre"><strong class="calibre5">repeat until</strong></span> block evaluates to true, which naturally
terminates the loop and ends the procedure. On the other hand, if the user enters anything other
than 1 or 2, the loop’s condition evaluates to false, and the <span class="calibre"><strong class="calibre5">ask</strong></span> command inside the loop executes. This command waits for the user’s input
again, and the <span class="calibre"><strong class="calibre5">repeat until</strong></span> block will continue asking for input
until the user enters a valid choice. Once again, note that this implementation doesn’t
require a <span class="calibre"><strong class="calibre5">stop</strong></span> block.</p></div></div><div class="book" title="Counters"><div class="titlepage1"><div class="book"><div class="book"><h2 class="title2" id="counters">Counters</h2></div></div></div><p class="calibre3"><a class="calibre" id="iddle1164"/><a class="calibre" id="iddle1230"/><a class="calibre" id="iddle1495"/><a class="calibre" id="iddle1675"/><a class="calibre" id="iddle1747"/>Sometimes, you’ll need to keep track of the number of iterations a loop performs.
For example, if you want to give users only three chances to enter the correct password,
you’ll have to count their attempts and lock them out after the third try.</p><p class="calibre3">You can handle such programming scenarios by using a variable (commonly referred to as the
<span class="calibre"><em class="calibre6">loop counter</em></span>) that counts the number of loop iterations. Let’s jump right
in and explore some examples that demonstrate practical ways to use loop counters.</p><div class="book" title="Check a Password"><div class="titlepage1"><div class="book"><div class="book"><h3 class="title3" id="check_a_password">Check a Password</h3></div></div></div><p class="calibre3">The program in <a class="xref" href="ch07.html#this_script_gives_the_user_three_chances" title="Figure 7-12. This script gives the user three chances to enter the correct password.">Figure 7-12</a> asks the user to
enter a password for unlocking a laptop. The <code class="literal">Laptop</code> sprite has two costumes: the
off image indicates that the laptop is locked, and the on image indicates that the laptop is
unlocked. The user will be denied access to the laptop if an invalid password is entered three
times.</p><p class="calibre3"><span class="calibre"><em class="calibre6">Password Check.sb2</em></span></p><div class="figure"><a id="this_script_gives_the_user_three_chances" class="calibre"/><div class="book"><div class="book"><a id="med_id00236" class="calibre"/><img alt="This script gives the user three chances to enter the correct password." src="httpatomoreillycomsourcenostarchimages2134817.png.jpg" class="calibre7"/></div></div><div class="figure-title">Figure 7-12. This script gives the user three chances to enter the correct password.</div></div><p class="calibre3">When the green flag is clicked, the <code class="literal">Laptop</code> sprite switches to the
<code class="literal">off</code> costume and calls the <span class="calibre"><strong class="calibre5">GetPassword</strong></span>
procedure to authenticate the user. This procedure is expected to return the password check result
to the main script using the <code class="literal">gotPass</code> flag. When the procedure returns, the
<span class="calibre"><strong class="calibre5">if/else</strong></span> block checks the <code class="literal">gotPass</code> flag to
decide whether or not the user should be allowed to access the system. If <code class="literal">gotPass</code>
was set to 1, meaning the user entered the correct password, the <span class="calibre"><strong class="calibre5">if</strong></span> block executes a <span class="calibre"><strong class="calibre5">say</strong></span> command that displays
<span class="calibre"><em class="calibre6">Access granted</em></span>
<a class="calibre" id="iddle1231"/><a class="calibre" id="iddle1232"/>and changes the laptop’s costume to the <code class="literal">on</code> image. Otherwise,
the script displays <span class="calibre"><em class="calibre6">Access denied!</em></span> and the sprite continues to show its initial
<code class="literal">off</code> costume.</p><p class="calibre3">The <span class="calibre"><strong class="calibre5">GetPassword</strong></span> procedure sets the
<code class="literal">gotPass</code> flag to 0, to indicate that it hasn’t received a valid password
yet, and initializes the <code class="literal">failCount</code> variable (our loop counter) to 0. It then
executes a <span class="calibre"><strong class="calibre5">repeat</strong></span> loop with a maximum repeat count of three.
During each iteration of the loop, the user is prompted to enter a password. If the user enters the
correct password (<code class="literal">Pass123</code> in this example), the <code class="literal">gotPass</code> flag
is set to 1, the procedure stops itself by invoking the <span class="calibre"><strong class="calibre5">stop this
script</strong></span> command, and execution returns to the caller. Otherwise, if the user hasn’t
used up all three attempts, an error message is displayed, and the user is given another chance. If
the user fails three consecutive times, the <span class="calibre"><strong class="calibre5">repeat</strong></span> loop
automatically terminates, and the procedure returns to the caller with the value of the
<code class="literal">gotPass</code> flag still set to 0.</p><div class="sidebar"><a id="try_it_out_7-4" class="calibre"/><div class="sidebar-title">Try It Out 7-4</div><p class="calibre3">Open this application and run it. What happens if you enter <code class="literal">paSS123</code>
(instead of <code class="literal">Pass123</code>) for the password? What does this tell you about string
comparison in Scratch? Try to implement the <span class="calibre"><strong class="calibre5">GetPassword</strong></span> procedure
using a <span class="calibre"><strong class="calibre5">repeat until</strong></span> block.</p></div></div><div class="book" title="Counting by a Constant Amount"><div class="titlepage1"><div class="book"><div class="book"><h3 class="title3" id="counting_by_a_constant_amount">Counting by a Constant Amount</h3></div></div></div><p class="calibre3">Of course, you don’t always have to increase your counters by 1 each time through a
loop. The script in <a class="xref" href="ch07.html#you_can_increment_and_decrement_counters" title="Figure 7-13. You can increment and decrement counters by amounts other than 1.">Figure 7-13</a> at ①, for
example, has a sprite count from 5 to 55 in increments of 5. The script at ② causes the sprite
to count down from 99 to 0 in decrements of 11—in other words, 99, 88, 77,..., 11, 0.</p><p class="calibre3"><span class="calibre"><em class="calibre6">CountingBy ConstAmount.sb2</em></span></p><div class="figure"><a id="you_can_increment_and_decrement_counters" class="calibre"/><div class="book"><div class="book"><a id="med_id00237" class="calibre"/><img alt="You can increment and decrement counters by amounts other than 1." src="httpatomoreillycomsourcenostarchimages2134819.png.jpg" class="calibre7"/></div></div><div class="figure-title">Figure 7-13. You can increment and decrement counters by amounts other than 1.</div></div><p class="calibre3">To see this counting technique in a practical application, let’s say that we want to
find the sum of all even integers from 2 to 20 (inclusive). (That is, we want the sum 2 + 4 + 6 + 8
+ ... + 20.) The script of <a class="xref" href="ch07.html#this_script_finds_the_sum_of_all_even_in" title="Figure 7-14. This script finds the sum of all even integers from 2 to 20.">Figure 7-14</a> does exactly
that.</p><div class="figure"><a id="this_script_finds_the_sum_of_all_even_in" class="calibre"/><div class="book"><div class="book"><a id="med_id00238" class="calibre"/><img alt="This script finds the sum of all even integers from 2 to 20." src="httpatomoreillycomsourcenostarchimages2134821.png.jpg" class="calibre7"/></div></div><div class="figure-title">Figure 7-14. This script finds the sum of all even integers from 2 to 20.</div></div><p class="calibre3"><a class="calibre" id="iddle1605"/>This script starts by initializing the <code class="literal">sum</code> variable to 0 and the
<code class="literal">count</code> variable to 2, and then enters a conditional loop that repeats until
<code class="literal">count</code> exceeds 20. Each time the loop iterates, the value of
<code class="literal">count</code> is added to the current sum and the <code class="literal">count</code> variable is
increased by 2 to get the next even integer in the sequence. Predict the output of this script then
run it to check your answer.</p><div class="sidebar"><a id="non-integer_repeat_count" class="calibre"/><div class="sidebar-title">Non-Integer Repeat Count</div><p class="calibre3">What do you think would happen if you asked Scratch to repeat a loop 2.5 times? The three
examples shown below demonstrate how Scratch handles non-integer repeat counts.</p><p class="calibre3"><span class="calibre"><em class="calibre6">Non-Integer RepeatCount.sb2</em></span></p><div class="informalfigure"><a id="med_id00239a" class="calibre"/><div class="book"><a id="med_id00239" class="calibre"/><img alt="image with no caption" src="httpatomoreillycomsourcenostarchimages2134823.png.jpg" class="calibre7"/></div></div><p class="calibre3">Of course, there is no such thing as “repeat 2.5 times,” but Scratch doesn’t
prevent you from entering such values. Rather than giving an error message, Scratch automatically
rounds a decimal repeat count to its nearest integer.</p></div></div></div><div class="book" title="Revisiting Nested Loops"><div class="titlepage1"><div class="book"><div class="book"><h2 class="title2" id="revisiting_nested_loops">Revisiting Nested Loops</h2></div></div></div><p class="calibre3"><a class="calibre" id="iddle1596"/><a class="calibre" id="iddle1599"/><a class="calibre" id="iddle1601"/>Back in <a class="xref" href="ch02.html#rotated_squares" title="Rotated Squares">Rotated Squares</a>, we used nested loops to draw rotated squares.
One loop (the <span class="calibre"><em class="calibre6">inner loop</em></span>) was responsible for drawing the square, while the
other loop (the <span class="calibre"><em class="calibre6">outer loop</em></span>) controlled the number of rotations. In this
section, you’ll learn how to use the concept of loop counters in conjunction with nested loops
to create iterations in two (or more) dimensions. This technique is an essential part of programming
and, as you’ll see in a moment, can be used to solve a wide range of programming
problems.</p><p class="calibre3">To set the stage, let’s say that a local restaurant offers four kinds of pizza (P1, P2,
P3, and P4) and three kinds of salads (S1, S2, and S3). If you ate there, you would have 12 possible
combinations to choose from; you could have P1 with any of three salad types, P2 with any of three
salad types, and so on. The restaurant’s owner wants to print out a menu that lists the
available pizza/salad combinations along with their combined prices and calorie contents.
Let’s see how nested loops can be used to generate a list of all possible combinations.
(I’ll leave calculating the prices and calorie content as an exercise for you.)</p><p class="calibre3">If you think about it, you’ll see that we just need two loops: one loop (the outer loop)
to cycle through the pizza types and another loop (the inner loop) to cycle through the salad types.
The outer loop starts with P1, while the inner loop tries S1, S2, and S3. The outer loop then moves
to P2, and the inner loop again chooses S1, S2, and S3. This continues until the outer loop has
passed through all four pizza types. An implementation of this idea is illustrated in <a class="xref" href="ch07.html#visualizing_nested_loopsdot_the_variable" title="Figure 7-15. Visualizing nested loops. The variable P controls the outer loop and the variable S controls the inner loop.">Figure 7-15</a>.</p><p class="calibre3"><span class="calibre"><em class="calibre6">NestedLoops1.sb2</em></span></p><div class="figure"><a id="visualizing_nested_loopsdot_the_variable" class="calibre"/><div class="book"><div class="book"><a id="med_id00240" class="calibre"/><img alt="Visualizing nested loops. The variable P controls the outer loop and the variable S controls the inner loop." src="httpatomoreillycomsourcenostarchimages2134825.png.jpg" class="calibre7"/></div></div><div class="figure-title">Figure 7-15. Visualizing nested loops. The variable <code class="literal">P</code> controls the outer loop and the
variable <code class="literal">S</code> controls the inner loop.</div></div><p class="calibre3">The script uses two loops and two counters. The counter for the outer loop is named
<code class="literal">P</code>, and the counter for the inner loop is named <code class="literal">S</code>. In the first
iteration of the outer loop (where <code class="literal">P = 1</code>), the value of counter
<code class="literal">S</code> is set to 1, and the inner loop repeats three times. Each time, it executes a
say command to display the current values of <code class="literal">P</code> and <code class="literal">S</code>, and then
it increments <code class="literal">S</code> by 1. Thus, the first iteration of the outer loop causes the
sprite to say “P1,S1” and “P1,S2” and “P1,S3.”</p><p class="calibre3"><a class="calibre" id="iddle1343"/><a class="calibre" id="iddle1600"/><a class="calibre" id="iddle1773"/><a class="calibre" id="iddle1876"/>When the inner loop terminates after looping three times, <code class="literal">P</code> is
incremented by 1, and the second iteration of the outer loop starts. The value of
<code class="literal">S</code> is reset to 1, and the inner loop is executed again. This causes the sprite to
say “P2,S1” and “P2,S2” and “P2,S3.” The process continues in a
similar manner, causing the sprite to say “P3,S1” and “P3,S2” and
“P3,S3” and finally “P4,S1” and “P4,S2” and “P4,S3”
before the script ends. Trace through this script to make sure you understand how it works.</p><p class="calibre3">Now that you’ve seen what nested loops can do, let’s apply this technique to solve
an interesting math problem. We want to write a program to find three positive integers
<span class="calibre"><em class="calibre6">n<sub class="calibre38">1</sub>, n<sub class="calibre38">2</sub>,</em></span> and
<span class="calibre"><em class="calibre6">n<sub class="calibre38">3</sub></em></span> such that <span class="calibre"><em class="calibre6">n<sub class="calibre38">1</sub> +
n<sub class="calibre38">2</sub> + n<sub class="calibre38">3</sub> = 25</em></span> and
<span class="calibre"><em class="calibre6">(n<sub class="calibre38">1</sub>)<sup class="calibre36">2</sup> +
(n<sub class="calibre38">2</sub>)<sup class="calibre36">2</sup> +
(n<sub class="calibre38">3</sub>)<sup class="calibre36">2</sup></em></span> = 243. Because computers are good
at repetitive tasks, our plan is to try all possible combinations of numbers (a technique called
<span class="calibre"><em class="calibre6">exhaustive search</em></span>) and let the computer do the hard work.</p><p class="calibre3">Based on our first equation, the first number, <span class="calibre"><em class="calibre6">n<sub class="calibre38">1</sub></em></span>,
can have any value between 1 and 23 since we’ll need to add two numbers to it to get 25. (You
might have noticed that <span class="calibre"><em class="calibre6">n<sub class="calibre38">1</sub></em></span> can’t be more than 15
because 16<sup class="calibre36">2</sup> = 256, which is greater than 243. But we’ll just ignore
our second equation for now and set the upper limit of the loop to 23 anyway.)</p><p class="calibre3">The second number, <span class="calibre"><em class="calibre6">n<sub class="calibre38">2</sub></em></span>, can be any value between 1
and 24 – <span class="calibre"><em class="calibre6">n<sub class="calibre38">1</sub></em></span>. For example, if
<span class="calibre"><em class="calibre6">n<sub class="calibre38">1</sub></em></span> is 10, the maximum possible value of
<span class="calibre"><em class="calibre6">n<sub class="calibre38">2</sub></em></span> is 14 because
<span class="calibre"><em class="calibre6">n<sub class="calibre38">3</sub></em></span> must be at least 1. If we know
<span class="calibre"><em class="calibre6">n<sub class="calibre38">1</sub></em></span> and <span class="calibre"><em class="calibre6">n<sub class="calibre38">2</sub></em></span>,
we can compute <span class="calibre"><em class="calibre6">n<sub class="calibre38">3</sub></em></span> as 25 –
(<span class="calibre"><em class="calibre6">n<sub class="calibre38">1</sub></em></span> + <span class="calibre"><em class="calibre6">n<sub class="calibre38">2</sub></em></span>).
Then, we’ll need to check whether the sum of the squares of these three numbers is 243. If it
is, we are done. Otherwise, we need to try a different combination of
<span class="calibre"><em class="calibre6">n<sub class="calibre38">1</sub></em></span> and <span class="calibre"><em class="calibre6">n<sub class="calibre38">2</sub></em></span>.
You can see the finished script to find <span class="calibre"><em class="calibre6">n<sub class="calibre38">1</sub></em></span>,
<span class="calibre"><em class="calibre6">n<sub class="calibre38">2</sub></em></span>, and <span class="calibre"><em class="calibre6">n<sub class="calibre38">3</sub></em></span>
in <a class="xref" href="ch07.html#this_script_searches_for_three_positive" title="Figure 7-16. This script searches for three positive numbers whose sum is 25 and whose sum of squares is 243.">Figure 7-16</a>.</p><p class="calibre3"><span class="calibre"><em class="calibre6">NestedLoops2.sb2</em></span></p><div class="figure"><a id="this_script_searches_for_three_positive" class="calibre"/><div class="book"><div class="book"><a id="med_id00241" class="calibre"/><img alt="This script searches for three positive numbers whose sum is 25 and whose sum of squares is 243." src="httpatomoreillycomsourcenostarchimages2134827.png.jpg" class="calibre7"/></div></div><div class="figure-title">Figure 7-16. This script searches for three positive numbers whose sum is 25 and whose sum of squares is
243.</div></div><p class="calibre3"><a class="calibre" id="iddle1732"/><a class="calibre" id="iddle1818"/><a class="calibre" id="iddle1820"/><a class="calibre" id="iddle2027"/>The outer loop tries all values of <code class="literal">n1</code> from 1 to 23. For each value of
<code class="literal">n1</code>, the inner loop tries all values of <code class="literal">n2</code> from 1 to (24
– <code class="literal">n1</code>). For each combination of <code class="literal">n1</code> and
<code class="literal">n2</code>, the script sets <code class="literal">n3</code> equal to 25 –
(<code class="literal">n1</code> + <code class="literal">n2</code>), and then it checks to see whether the sum of the
squares of these three numbers is 243. If it is, the script says the answer and stops.</p><div class="sidebar"><a id="try_it_out_7-5" class="calibre"/><div class="sidebar-title">Try It Out 7-5</div><p class="calibre3">Create the script shown in <a class="xref" href="ch07.html#this_script_searches_for_three_positive" title="Figure 7-16. This script searches for three positive numbers whose sum is 25 and whose sum of squares is 243.">Figure 7-16</a> and run
it to find <span class="calibre"><em class="calibre6">n</em></span><sub class="calibre31">1</sub>,
<span class="calibre"><em class="calibre6">n</em></span><sub class="calibre31">2</sub>, and <span class="calibre"><em class="calibre6">n</em></span><sub class="calibre31">3</sub>.
If you study the script carefully, you’ll find that it tries some
(<span class="calibre"><em class="calibre6">n</em></span><sub class="calibre31">1</sub>, <span class="calibre"><em class="calibre6">n</em></span><sub class="calibre31">2</sub>)
combinations more than once. For example, the numbers (1, 2) are tested in the first iteration of
the outer loop, whereas the numbers (2, 1) are tried in the second iteration. These two tests are
redundant; we only need one of them. You can fix this by having the inner loop start from
<span class="calibre"><em class="calibre6">n</em></span><sub class="calibre31">1</sub> instead of 1. Make this change to the script and then
run it to make sure it still works as expected.</p></div></div><div class="book" title="Recursion: Procedures that Call Themselves"><div class="titlepage1"><div class="book"><div class="book"><h2 class="title2" id="recursion_procedures_that_call_themselve">Recursion: Procedures that Call Themselves</h2></div></div></div><p class="calibre3">The repetition structures introduced so far allow us to repeat a command or a set of commands
through iteration. Another powerful technique that produces repetition is
<span class="calibre"><em class="calibre6">recursion</em></span>. Recursion allows a procedure to either call itself directly or do so
indirectly through another procedure (for example, <code class="literal">A</code> calls <code class="literal">B</code>,
<code class="literal">B</code> calls <code class="literal">C</code>, then <code class="literal">C</code> calls
<code class="literal">A</code>). It may not be obvious why you want to do this, but it turns out that
recursion can simplify the solution of many computer science problems. Let’s demonstrate this
concept by considering the simple example shown in <a class="xref" href="ch07.html#recursive_procedure" title="Figure 7-17. A recursive procedure">Figure 7-17</a>.</p><p class="calibre3"><span class="calibre"><em class="calibre6">Recursion.sb2</em></span></p><div class="figure"><a id="recursive_procedure" class="calibre"/><div class="book"><div class="book"><a id="med_id00242" class="calibre"/><img alt="A recursive procedure" src="httpatomoreillycomsourcenostarchimages2134829.png.jpg" class="calibre7"/></div></div><div class="figure-title">Figure 7-17. A recursive procedure</div></div><p class="calibre3">The <span class="calibre"><strong class="calibre5">Tic</strong></span> procedure executes two <span class="calibre"><strong class="calibre5">say</strong></span> commands (the first says “Tic” and the second says “Tac”),
then calls itself again. The second call does the same thing, and the sprite would continue saying,
“Tic Tac” forever if no outside action stopped it. Of course, the only way to stop it in
this case is to click the red stop icon. Having a procedure call itself this way allowed us to
repeat the two <span class="calibre"><strong class="calibre5">say</strong></span> commands forever without using any loop
blocks. The form of recursion used in this example is called <span class="calibre"><em class="calibre6">tail recursion</em></span>
because the recursive call is located at the very end of the procedure. Scratch also allows
recursive calls to come before the last line, but we won’t explore that type of recursion in
this book.</p><p class="calibre3"><a class="calibre" id="iddle1227"/><a class="calibre" id="iddle1288"/><a class="calibre" id="iddle1819"/>Since infinite recursion is generally not a good idea, you must control the execution of
a recursive procedure with conditionals. For example, the procedure could include an <span class="calibre"><strong class="calibre5">if</strong></span> block that determines whether the recursive call should be made. To
demonstrate this technique, <a class="xref" href="ch07.html#if_block_is_used_to_determine_whether_le" title="Figure 7-18. The if block is used to determine whether (or not) the recursive call should be made.">Figure 7-18</a> shows a
recursive procedure that counts from some initial number (specified by the parameter
<code class="literal">count</code>) down to 0.</p><div class="figure"><a id="if_block_is_used_to_determine_whether_le" class="calibre"/><div class="book"><div class="book"><a id="med_id00243" class="calibre"/><img alt="The if block is used to determine whether (or not) the recursive call should be made." src="httpatomoreillycomsourcenostarchimages2134831.png.jpg" class="calibre7"/></div></div><div class="figure-title">Figure 7-18. The <span class="calibre">if</span> block is used to determine whether (or not) the
recursive call should be made.</div></div><p class="calibre3">Let’s walk through how <span class="calibre"><strong class="calibre5">CountDown</strong></span> works when it is
called with an argument of three. When the procedure starts, the <span class="calibre"><strong class="calibre5">say</strong></span> command shows the number 3, then checks whether <code class="literal">count</code> is greater
than 0. Since 3 is greater than 0, the procedure subtracts 1 from <code class="literal">count</code> to call
itself with an argument of 2.</p><p class="calibre3">In the second call, the procedure shows the number 2 and, because 2 is greater than 0, calls
itself one more time with an argument of 1. This continues until the call
<code class="literal">CountDown(0)</code> is made. After showing the number 0 in a voice bubble, the procedure
checks whether <code class="literal">count</code> is greater than 0. Since the expression in the header of the
<span class="calibre"><strong class="calibre5">if</strong></span> block evaluates to false, no further recursive calls will be
made, and the procedure returns. Try to follow the return path shown in <a class="xref" href="ch07.html#if_block_is_used_to_determine_whether_le" title="Figure 7-18. The if block is used to determine whether (or not) the recursive call should be made.">Figure 7-18</a>.</p><p class="calibre3">Now that we’ve covered the basics of tail recursion, we can apply it to more interesting
applications. Let’s consider, for example, the <span class="calibre"><strong class="calibre5">Blade</strong></span>
procedure shown in <a class="xref" href="ch07.html#using_a_spriteapostrophes_direction_to_s" title="Figure 7-19. Using a sprite’s direction to stop recursion">Figure 7-19</a>.</p><p class="calibre3"><span class="calibre"><em class="calibre6">RecursionBlade.sb2</em></span></p><div class="figure"><a id="using_a_spriteapostrophes_direction_to_s" class="calibre"/><div class="book"><div class="book"><a id="med_id00244" class="calibre"/><img alt="Using a sprite’s direction to stop recursion" src="httpatomoreillycomsourcenostarchimages2134833.png.jpg" class="calibre7"/></div></div><div class="figure-title">Figure 7-19. Using a sprite’s direction to stop recursion</div></div><p class="calibre3"><a class="calibre" id="iddle1029"/><a class="calibre" id="iddle1030"/><a class="calibre" id="iddle1737"/><a class="calibre" id="iddle1885"/>We assume that the sprite that executes this procedure starts somewhere on the Stage
pointing in the direction of 90°. After drawing an equilateral triangle, the sprite moves 12
steps forward and then turns 10° counterclockwise. The procedure then checks the new direction
of the sprite. If the sprite is not pointing in the direction of 90°, the procedure calls
itself again to draw the next triangle in the sequence. Otherwise, the recursive call doesn’t
happen, and the procedure ends after drawing the saw blade shown in <a class="xref" href="ch07.html#using_a_spriteapostrophes_direction_to_s" title="Figure 7-19. Using a sprite’s direction to stop recursion">Figure 7-19</a>.</p><p class="calibre3">For simple examples like the ones shown here, it is probably easier to use a <span class="calibre"><strong class="calibre5">repeat</strong></span> block to achieve the desired repetition. But as I mentioned at the
start of this section, there are many problems that are easier to solve with recursion rather than
iteration.</p><div class="sidebar"><a id="try_it_out_7-6" class="calibre"/><div class="sidebar-title">Try It Out 7-6</div><p class="calibre3">What does the following procedure do? Implement it and call it with different arguments to
check your answer.</p><div class="informalfigure"><a id="med_id00245a" class="calibre"/><div class="book"><a id="med_id00245" class="calibre"/><img alt="image with no caption" src="httpatomoreillycomsourcenostarchimages2134835.png.jpg" class="calibre7"/></div></div></div></div><div class="book" title="Scratch Projects"><div class="titlepage1"><div class="book"><div class="book"><h2 class="title2" id="scratch_projects-id00018">Scratch Projects</h2></div></div></div><p class="calibre3">Now that you know how to use repetition to your advantage in Scratch scripts, it’s time
to put what we’ve learned in this chapter to some practical use. In this section, I’ll
guide you through a range of projects to help you strengthen your understanding of programming and
provide you with some ideas for your own projects.</p><div class="book" title="Analog Clock"><div class="titlepage1"><div class="book"><div class="book"><h3 class="title3" id="analog_clock">Analog Clock</h3></div></div></div><p class="calibre3">The <span class="calibre"><strong class="calibre5">current</strong></span> block from the <span class="calibre"><em class="calibre6">Sensing</em></span>
palette can report the current year, month, date, day of the week, hour, minutes, or seconds,
depending on what you select from the drop-down menu. Our first project will use this block to
implement the analog clock shown in <a class="xref" href="ch07.html#analog_clock_application" title="Figure 7-20. The Analog Clock application">Figure 7-20</a>. The application
contains four sprites: the <code class="literal">Sec</code>, <code class="literal">Min</code>, and
<code class="literal">Hour</code> sprites, which represent the three hands of the clock, and the
<code class="literal">Time</code> sprite (a small white dot), which displays the time in digital format (see
the thought bubble in the figure).</p><p class="calibre3"><span class="calibre"><em class="calibre6">AnalogClock.sb2</em></span></p><div class="figure"><a id="analog_clock_application" class="calibre"/><div class="book"><div class="book"><a id="med_id00246" class="calibre"/><img alt="The Analog Clock application" src="httpatomoreillycomsourcenostarchimages2134837.png.jpg" class="calibre7"/></div></div><div class="figure-title">Figure 7-20. The Analog Clock application</div></div><p class="calibre3">The clock starts running when the green flag is clicked. In response, all four sprites start a
<span class="calibre"><strong class="calibre5">forever</strong></span> loop to update their status based on the current system
time. The scripts for the <code class="literal">Sec</code> and <code class="literal">Min</code> sprites are shown in
<a class="xref" href="ch07.html#scripts_for_the_sec_and_min_sprites" title="Figure 7-21. The scripts for the Sec and Min sprites">Figure 7-21</a>.</p><div class="figure"><a id="scripts_for_the_sec_and_min_sprites" class="calibre"/><div class="book"><div class="book"><a id="med_id00247" class="calibre"/><img alt="The scripts for the Sec and Min sprites" src="httpatomoreillycomsourcenostarchimages2134839.png.jpg" class="calibre7"/></div></div><div class="figure-title">Figure 7-21. The scripts for the <code class="literal">Sec</code> and <code class="literal">Min</code> sprites</div></div><p class="calibre3">The number of seconds and minutes reported by the <span class="calibre"><strong class="calibre5">current</strong></span>
block ranges from 0 to 59. When the system reports 0 seconds, the <code class="literal">Sec</code> sprite
should point up (toward 0°), at 15 seconds, the <code class="literal">Sec</code> sprite should point
right (toward 90°), and so on. Every second, the <code class="literal">Sec</code> hand should turn
6° (360° divided by 60 seconds) clockwise. A similar reasoning applies to the
<code class="literal">Min</code> hand. If you watch this clock running, you’ll notice the
<code class="literal">Sec</code> hand jumping every second and the <code class="literal">Min</code> hand jumping every
minute. Now, let’s look at the script for the <code class="literal">Hour</code> sprite, shown in <a class="xref" href="ch07.html#script_for_the_hour_sprite" title="Figure 7-22. The script for the Hour sprite">Figure 7-22</a>.</p><div class="figure"><a id="script_for_the_hour_sprite" class="calibre"/><div class="book"><div class="book"><a id="med_id00248" class="calibre"/><img alt="The script for the Hour sprite" src="httpatomoreillycomsourcenostarchimages2134841.png.jpg" class="calibre7"/></div></div><div class="figure-title">Figure 7-22. The script for the <code class="literal">Hour</code> sprite</div></div><p class="calibre3"><a class="calibre" id="iddle1069"/><a class="calibre" id="iddle1070"/><a class="calibre" id="iddle1743"/>The <span class="calibre"><strong class="calibre5">current(hour)</strong></span> block reports the system
clock’s hour as a number from 0 to 23. We need the <code class="literal">Hour</code> hand to point
toward 0° (that is, up) for hour 0, 30° for hour one, 60° for hour two, and so on, as
illustrated in the figure. Of course, if the current time is, let’s say, 11:50, we don’t
want the <code class="literal">Hour</code> hand to point exactly at 11 but rather more toward 12. We can make
this adjustment by taking the current minutes into account.</p><p class="calibre3">Since every hour (or 60 minutes) corresponds to 30° on the face of the clock, every
minute is worth 2°. Therefore, every minute, we need to adjust the angle of the
<code class="literal">Hour</code> hand by the current number of minutes divided by 2, as shown in the
script.</p><p class="calibre3">The script for the <code class="literal">Time</code> sprite is trivial and isn’t shown here. It
uses nested <span class="calibre"><strong class="calibre5">join</strong></span> blocks to construct a display string of the form
<span class="calibre"><em class="calibre6">hour</em></span>:<span class="calibre"><em class="calibre6">min</em></span>:<span class="calibre"><em class="calibre6">sec</em></span> and shows this string in
a think bubble, as shown in <a class="xref" href="ch07.html#analog_clock_application" title="Figure 7-20. The Analog Clock application">Figure 7-20</a>.</p><div class="sidebar"><a id="try_it_out_7-7" class="calibre"/><div class="sidebar-title">Try It Out 7-7</div><p class="calibre3">Open the application and run it. Change the script for the <code class="literal">Min</code> sprite to
make it move smoothly, instead of jumping every minute. (Hint: Use the same idea we applied to
smooth the movement of the hour hand.) Also, change the script of the <code class="literal">Time</code> sprite
to display a string of the form “3:25:00 <span class="smaller">PM</span>”
(12-hour format) instead of “15:25:00” (24-hour format). Think of other ways to enhance
the application and try to implement them as well.</p></div></div><div class="book" title="Bird Shooter Game"><div class="titlepage1"><div class="book"><div class="book"><h3 class="title3" id="bird_shooter_game">Bird Shooter Game</h3></div></div></div><p class="calibre3">Now, let’s make a simple game that uses most of the blocks we introduced in this
chapter. The player’s goal will be to knock two birds out of the sky, and you can see the user
interface in <a class="xref" href="ch07.html#user_interface_of_the_bird_shooter_game" title="Figure 7-23. User interface of the bird shooter game">Figure 7-23</a>.</p><p class="calibre3"><span class="calibre"><em class="calibre6">BirdShooter.sb2</em></span></p><div class="figure"><a id="user_interface_of_the_bird_shooter_game" class="calibre"/><div class="book"><div class="book"><a id="med_id00249" class="calibre"/><img alt="User interface of the bird shooter game" src="httpatomoreillycomsourcenostarchimages2134843.png.jpg" class="calibre7"/></div></div><div class="figure-title">Figure 7-23. User interface of the bird shooter game</div></div><p class="calibre3">As shown, the game contains five sprites: <code class="literal">Bird1</code>, a clone of
<code class="literal">Bird1</code>, <code class="literal">Bird2</code>, a shooter, and a bullet. The player can move the
shooter horizontally using the left and right keyboard arrows. Pressing the spacebar fires a bullet
into the sky. If the bullet hits <code class="literal">Bird1</code> or its clone, the player gets a point.
<code class="literal">Bird2</code> is an endangered species, so the player isn’t allowed to shoot that
one; if the bullet hits that sprite, the game ends. The player has one minute to shoot as many birds
as possible.</p><p class="calibre3">Each bird uses two costumes. When switching between these two costumes, the birds appear to be
flapping their wings.</p><p class="calibre3">The Stage has two backgrounds named <code class="literal">start</code> and <code class="literal">end</code>. The
<code class="literal">start</code> background is shown in <a class="xref" href="ch07.html#user_interface_of_the_bird_shooter_game" title="Figure 7-23. User interface of the bird shooter game">Figure 7-23</a>. The <code class="literal">end</code> background is
identical, with the addition of the words <span class="calibre"><em class="calibre6">Game Over</em></span> to the center of the image.
The scripts that belong to the Stage are shown in <a class="xref" href="ch07.html#scripts_for_the_stage_in_the_bird_shoote" title="Figure 7-24. The scripts for the Stage in the bird shooter game">Figure 7-24</a>.</p><div class="figure"><a id="scripts_for_the_stage_in_the_bird_shoote" class="calibre"/><div class="book"><div class="book"><a id="med_id00250" class="calibre"/><img alt="The scripts for the Stage in the bird shooter game" src="httpatomoreillycomsourcenostarchimages2134845.png.jpg" class="calibre7"/></div></div><div class="figure-title">Figure 7-24. The scripts for the Stage in the bird shooter game</div></div><p class="calibre3">When the green flag icon is pressed, the Stage switches to the <code class="literal">start</code>
background, resets the timer, and starts a loop that updates and checks the remaining game time,
which is tracked by the <code class="literal">TimeLeft</code> variable. When <code class="literal">TimeLeft</code>
reaches 0 or when the Stage receives the <code class="literal">GameOver</code> broadcast message, it executes
the <code class="literal">GameOver</code> handler. This script waits for a short time to allow the birds to
hide themselves, switches to the <code class="literal">end</code> backdrop, and calls <span class="calibre"><strong class="calibre5">stop all</strong></span> to end any running scripts. As you’ll see soon, the
<code class="literal">GameOver</code> message will be sent by the <code class="literal">Bullet</code> sprite when it
hits <code class="literal">Bird2</code>. Let’s now take a look at the script for the
<code class="literal">Shooter</code> sprite, shown in <a class="xref" href="ch07.html#script_for_the_shooter_sprite" title="Figure 7-25. The script for the Shooter sprite">Figure 7-25</a>.</p><div class="figure"><a id="script_for_the_shooter_sprite" class="calibre"/><div class="book"><div class="book"><a id="med_id00251" class="calibre"/><img alt="The script for the Shooter sprite" src="httpatomoreillycomsourcenostarchimages2134847.png.jpg" class="calibre7"/></div></div><div class="figure-title">Figure 7-25. The script for the <code class="literal">Shooter</code> sprite</div></div><p class="calibre3">This script starts by positioning the shooter in the middle of the bottom edge of the Stage.
The script then enters an infinite loop that detects whether the left or right arrow keys have been
pressed and moves the shooter in the corresponding direction. Now let’s move on to the scripts
for <code class="literal">Bird1</code>, shown in <a class="xref" href="ch07.html#scripts_for_the_bird1_sprite" title="Figure 7-26. The scripts for the Bird1 sprite">Figure 7-26</a>.</p><div class="figure"><a id="scripts_for_the_bird1_sprite" class="calibre"/><div class="book"><div class="book"><a id="med_id00252" class="calibre"/><img alt="The scripts for the Bird1 sprite" src="httpatomoreillycomsourcenostarchimages2134849.png.jpg" class="calibre7"/></div></div><div class="figure-title">Figure 7-26. The scripts for the <code class="literal">Bird1</code> sprite</div></div><p class="calibre3">When the game starts, <code class="literal">Bird1</code> clones itself, moves to left edge of the Stage,
and calls the <span class="calibre"><strong class="calibre5">Start</strong></span> procedure. The clone also starts at the left
edge of the Stage (but at a different height) and calls <span class="calibre"><strong class="calibre5">Start</strong></span>.
This procedure uses a <span class="calibre"><strong class="calibre5">forever</strong></span> loop to move the bird and its clone
horizontally across the Stage, from left to right with random steps. When the bird approaches the
right edge of the stage, it is moved back to the left edge, as if it wraps around and reappears. The
last script hides both birds when the <code class="literal">GameOver</code> message is broadcast.</p><p class="calibre3">The scripts for <code class="literal">Bird2</code> are very similar to those of
<code class="literal">Bird1</code>, so we won’t show them here. When the green flag is clicked,
<code class="literal">Bird2</code> moves to the right edge of the Stage at a height of 40 and then executes a
loop similar to that of the <span class="calibre"><strong class="calibre5">Start</strong></span> procedure of <a class="xref" href="ch07.html#scripts_for_the_bird1_sprite" title="Figure 7-26. The scripts for the Bird1 sprite">Figure 7-26</a>. The bird simply moves from left to right, wrapping around
when it reaches the right edge of the Stage. <code class="literal">Bird2</code> also responds to the
<code class="literal">GameOver</code> broadcast by hiding itself.</p><p class="calibre3">Of course, the player can’t hit any birds just by moving the shooter around, and
that’s where the <code class="literal">Bullet</code> sprite comes in. The main script for this sprite is
shown in <a class="xref" href="ch07.html#main_script_of_the_bullet_sprite" title="Figure 7-27. The main script of the Bullet sprite">Figure 7-27</a>.</p><div class="figure"><a id="main_script_of_the_bullet_sprite" class="calibre"/><div class="book"><div class="book"><a id="med_id00253" class="calibre"/><img alt="The main script of the Bullet sprite" src="httpatomoreillycomsourcenostarchimages2134851.png.jpg" class="calibre7"/></div></div><div class="figure-title">Figure 7-27. The main script of the <code class="literal">Bullet</code> sprite</div></div><p class="calibre3">When the green flag is clicked, this script initializes the variables <code class="literal">Fired</code>
(the number of bullets fired) and <code class="literal">Hits</code> (how many birds have been hit) to 0. It
then points the <code class="literal">Bullet</code> sprite up and hides it. After that, it enters an infinite
loop to repeatedly check the status of the spacebar key. When spacebar is pressed, the script
increments <code class="literal">Fired</code> by 1 and creates a clone of the <code class="literal">Bullet</code> sprite
to move the bullet upward, as we’ll see next. The script then waits some time to prevent the
player from firing another bullet too soon. Now we’re ready to study the script of the cloned
bullet, shown in <a class="xref" href="ch07.html#startup_handler_of_a_cloned_bullet" title="Figure 7-28. The startup handler of a cloned Bullet">Figure 7-28</a>.</p><p class="calibre3">First, the <code class="literal">Bullet</code> is moved to the center of the <code class="literal">Shooter</code>
and is made visible ①. The <code class="literal">Bullet</code> is then moved upward in increments of 10
steps using a <span class="calibre"><strong class="calibre5">repeat until</strong></span> block ②. If the bullet’s
<span class="calibre"><em class="calibre6">y</em></span>-coordinate exceeds 160, then the <code class="literal">Bullet</code> has reached the
upper edge of the Stage without touching any birds. In this case, the <span class="calibre"><strong class="calibre5">repeat
until</strong></span> block exits ⑤, and the clone is deleted. A hit check, however, is performed
each time the bullet moves. If the bullet touches <code class="literal">Bird1</code> (or its clone) ③,
the script increases the <code class="literal">Hits</code> variable and plays a sound to make the game more
exciting. On the other hand, if the bullet touches <code class="literal">Bird2</code> ④, the script
broadcasts <code class="literal">GameOver</code> to signal the end of the game. In both cases, the clone is
deleted since it has finished its job.</p><div class="figure"><a id="startup_handler_of_a_cloned_bullet" class="calibre"/><div class="book"><div class="book"><a id="med_id00254" class="calibre"/><img alt="The startup handler of a cloned Bullet" src="httpatomoreillycomsourcenostarchimages2134853.png.jpg" class="calibre7"/></div></div><div class="figure-title">Figure 7-28. The startup handler of a cloned <code class="literal">Bullet</code></div></div><p class="calibre3">The game is now fully functional, but you could add many features to it. Here are two
suggestions:</p><div class="book"><ul class="itemizedlist"><li class="listitem1"><p class="calibre3">Give the player a limited number of bullets and keep score based on the number of missed
shots.</p></li><li class="listitem1"><p class="calibre3">Add more birds and have them move at different speeds. Reward the player with more points for
hitting faster birds.</p></li></ul></div><div class="sidebar"><a id="try_it_out_7-8" class="calibre"/><div class="sidebar-title">Try It Out 7-8</div><p class="calibre3">Open the game and play it to see how it works. Modify the game with some of the enhancements
suggested above—or come up with a few of your own and implement those!</p></div></div><div class="book" title="Free-Fall Simulation"><div class="titlepage1"><div class="book"><div class="book"><h3 class="title3" id="free-fall_simulation">Free-Fall Simulation</h3></div></div></div><p class="calibre3"><a class="calibre" id="iddle1348"/><a class="calibre" id="iddle1387"/><a class="calibre" id="iddle1388"/><a class="calibre" id="iddle1762"/>In this section, I’ll present an application that simulates the motion of a
falling object. Ignoring the effects of buoyancy and air resistance, when an object at rest is
dropped from some height, the distance <span class="calibre"><em class="calibre6">d</em></span> (in meters) fallen by the object
during time <span class="calibre"><em class="calibre6">t</em></span> (in seconds) is given by <span class="calibre"><em class="calibre6">d</em></span> = ½
<span class="calibre"><em class="calibre6">gt</em></span><sup class="calibre36">2</sup>, where <span class="calibre"><em class="calibre6">g</em></span> = 9.8
m/s<sup class="calibre36">2</sup> is the gravitational acceleration. The goal of this simulation is to
show the position of the falling object at times 0.5 s, 1.0 s, 1.5 s, 2.0 s, and so on, until the
object reaches the ground. The interface for this simulation is shown in <a class="xref" href="ch07.html#user_interface_for_the_free-fall_simulat" title="Figure 7-29. User interface for the free-fall simulation">Figure 7-29</a>.</p><p class="calibre3"><span class="calibre"><em class="calibre6">FreeFall.sb2</em></span></p><div class="figure"><a id="user_interface_for_the_free-fall_simulat" class="calibre"/><div class="book"><div class="book"><a id="med_id00255" class="calibre"/><img alt="User interface for the free-fall simulation" src="httpatomoreillycomsourcenostarchimages2134855.png.jpg" class="calibre7"/></div></div><div class="figure-title">Figure 7-29. User interface for the free-fall simulation</div></div><p class="calibre3">An object at rest (the ball in the figure) will be allowed to fall from a height of 35 m. A
simple substitution in the above formula shows that the object will reach the ground after
<span class="inlinemediaobject"><a id="inline_id00045" class="calibre"/><img alt="" src="httpatomoreillycomsourcenostarchimages2134857.png.jpg" class="calibre8"/></span> s. The application has one sprite (called <code class="literal">Ball</code>) that has the
two costumes shown in the figure. When it is time to show the position of the falling ball, the
sprite changes momentarily to the <code class="literal">marker</code> costume, makes a stamp, and switches
back to the <code class="literal">ball</code> costume.</p><p class="calibre3">The simulation starts when the green flag is clicked. In response, the <code class="literal">Ball</code>
sprite runs the script shown in <a class="xref" href="ch07.html#script_for_the_ball_sprite_in_the_free-f" title="Figure 7-30. Script for the Ball sprite in the free-fall simulation">Figure 7-30</a>.</p><p class="calibre3">During initialization ①, the sprite moves to its starting position, switches to the
<code class="literal">ball</code> costume, clears its voice bubble from the previous run, and clears the Stage
from any previous stamps. It then initializes <code class="literal">t</code> and <code class="literal">counter</code> to
0. The variable <code class="literal">t</code> represents the duration of the fall, and
<code class="literal">counter</code> keeps track of the number of loop repetitions.</p><p class="calibre3">The script then enters an infinite loop ② to calculate the simulation parameters at
different time intervals. It performs those calculations and updates the ball’s position every
0.05 s ③ to ensure the ball’s smooth movement. Every 0.05 s, the value of the time
variable <code class="literal">t</code> is updated, and the distance the ball has fallen
(<code class="literal">d</code>) is calculated. The value of the <code class="literal">counter</code> variable is also
incremented by 1.</p><div class="figure"><a id="script_for_the_ball_sprite_in_the_free-f" class="calibre"/><div class="book"><div class="book"><a id="med_id00256" class="calibre"/><img alt="Script for the Ball sprite in the free-fall simulation" src="httpatomoreillycomsourcenostarchimages2134859.png.jpg" class="calibre7"/></div></div><div class="figure-title">Figure 7-30. Script for the <code class="literal">Ball</code> sprite in the free-fall simulation</div></div><p class="calibre3">If the ball reaches the ground (which happens at <code class="literal">d</code> ≥
<code class="literal">35</code>), the script sets the ball’s <span class="calibre"><em class="calibre6">y</em></span>-position to that of
the ground, displays the actual duration of the journey, and stops the script to end the simulation
④.</p><p class="calibre3">Otherwise, the script sets the vertical position of the ball in accordance with the fallen
distance ⑤. Since a height of 35 m corresponds to 268 pixels on the Stage (see <a class="xref" href="ch07.html#user_interface_for_the_free-fall_simulat" title="Figure 7-29. User interface for the free-fall simulation">Figure 7-29</a>), a distance of <span class="calibre"><em class="calibre6">d</em></span> meters
corresponds to <code class="literal">268 *</code> (<code class="literal">d / 35</code>). The final
<span class="calibre"><em class="calibre6">y</em></span>-position is established by subtracting this number from the initial
<span class="calibre"><em class="calibre6">y</em></span>-position, which is 136.</p><p class="calibre3">Since the iteration duration is 0.05 s, it takes 10 iterations to get 0.5 s. Thus, when the
counter becomes 10, 20, 30, and so on, the <code class="literal">Ball</code> sprite switches to (and stamps)
the <code class="literal">marker</code> costume to show the position of the falling ball at those instants
⑥.</p><p class="calibre3"><a class="xref" href="ch07.html#output_of_the_free-fall_simulation" title="Figure 7-31. Output of the free-fall simulation">Figure 7-31</a> illustrates the result of running this
simulation. Note how the distance fallen in each time interval increases as the object falls.
Because of gravity, the ball accelerates—its velocity increases—at a rate of 9.8
m/s<sup class="calibre36">2</sup>.</p><div class="sidebar"><a id="try_it_out_7-9" class="calibre"/><div class="sidebar-title">Try It Out 7-9</div><p class="calibre3">Open the application and run it to understand how it works. Try converting the simulation into
a game in which players drop the ball to hit a moving object on the ground. You can add a score,
change the speed of the target, or even set the action on another planet (change the gravitational
acceleration).</p></div><div class="figure"><a id="output_of_the_free-fall_simulation" class="calibre"/><div class="book"><div class="book"><a id="med_id00257" class="calibre"/><img alt="Output of the free-fall simulation" src="httpatomoreillycomsourcenostarchimages2134861.png.jpg" class="calibre7"/></div></div><div class="figure-title">Figure 7-31. Output of the free-fall simulation</div></div></div><div class="book" title="Projectile Motion Simulator"><div class="titlepage1"><div class="book"><div class="book"><h3 class="title3" id="projectile_motion_simulator">Projectile Motion Simulator</h3></div></div></div><p class="calibre3"><a class="calibre" id="iddle1782"/><a class="calibre" id="iddle1805"/><a class="calibre" id="iddle1806"/>Consider a ball fired at some initial velocity
(<span class="calibre"><em class="calibre6">v</em></span><sub class="calibre38">0</sub>) from a cannon that points at an angle
<span class="calibre"><em class="calibre6">q</em></span> from the horizontal. You can analyze the ball’s trajectory by resolving
the velocity vector (<span class="calibre"><em class="calibre6">v</em></span><sub class="calibre38">0</sub>) into its horizontal and
vertical components at different times. The horizontal component remains constant, but the vertical
component is affected by gravity. When the motions corresponding to these two components are
combined, the resulting path is a parabola. Let’s examine the equations that govern projectile
motion (neglecting air resistance).</p><p class="calibre3"><span class="calibre"><em class="calibre6">Projectile .sb2</em></span></p><p class="calibre3">The origin of our coordinate system is the point at which the ball begins its flight, so the
ball’s <span class="calibre"><em class="calibre6">x</em></span>-coordinate at any time, <span class="calibre"><em class="calibre6">t</em></span>, is given by
<span class="calibre"><em class="calibre6">x</em></span>(<span class="calibre"><em class="calibre6">t</em></span>) <span class="calibre"><em class="calibre6">=
v</em></span><sub class="calibre38">0</sub><span class="calibre"><em class="calibre6"><sub class="calibre38">x</sub>t</em></span>, and the
<span class="calibre"><em class="calibre6">y</em></span>-coordinate is <span class="calibre"><em class="calibre6">y</em></span>(<span class="calibre"><em class="calibre6">t</em></span>) <span class="calibre"><em class="calibre6">=
v</em></span><sub class="calibre38">0</sub><span class="calibre"><em class="calibre6"><sub class="calibre38">y</sub>t</em></span> –
(0.5)<span class="calibre"><em class="calibre6">gt<sup class="calibre36">2</sup></em></span>, where
<span class="calibre"><em class="calibre6">v</em></span><sub class="calibre38">0</sub><span class="calibre"><em class="calibre6"><sub class="calibre38">x</sub> =
v</em></span><sub class="calibre38">0</sub> cos <span class="calibre"><em class="calibre6">q</em></span> is the <span class="calibre"><em class="calibre6">x</em></span>-
component of <span class="calibre"><em class="calibre6">v</em></span><sub class="calibre38">0</sub>;
<span class="calibre"><em class="calibre6">v</em></span><sub class="calibre38">0</sub><span class="calibre"><em class="calibre6"><sub class="calibre38">y</sub> =
v</em></span><sub class="calibre38">0</sub> sin <span class="calibre"><em class="calibre6">q</em></span> is the
<span class="calibre"><em class="calibre6">y</em></span>-component of <span class="calibre"><em class="calibre6">v</em></span><sub class="calibre38">0</sub>; and
<span class="calibre"><em class="calibre6">g</em></span> = 9.8 m/s<sup class="calibre36">2</sup> is the gravitational acceleration.
Using these equations, we can calculate the total flight time, the maximum height, and the
horizontal range of the ball. The equations for these quantities are shown in <a class="xref" href="ch07.html#parabolic_trajectory_of_a_ball" title="Figure 7-32. Parabolic trajectory of a ball">Figure 7-32</a>.</p><div class="figure"><a id="parabolic_trajectory_of_a_ball" class="calibre"/><div class="book"><div class="book"><a id="med_id00258" class="calibre"/><img alt="Parabolic trajectory of a ball" src="httpatomoreillycomsourcenostarchimages2134863.png.jpg" class="calibre7"/></div></div><div class="figure-title">Figure 7-32. Parabolic trajectory of a ball</div></div><p class="calibre3">This information is all we need to realistically simulate the ball’s motion, so
let’s create a Scratch program so we can see this bit of physics in action and deepen our
understanding of trajectories. The user interface of the simulation is shown in <a class="xref" href="ch07.html#user_interface_for_the_projectile_motion" title="Figure 7-33. User interface for the projectile motion simulator">Figure 7-33</a>.</p><div class="figure"><a id="user_interface_for_the_projectile_motion" class="calibre"/><div class="book"><div class="book"><a id="med_id00259" class="calibre"/><img alt="User interface for the projectile motion simulator" src="httpatomoreillycomsourcenostarchimages2134865.png.jpg" class="calibre7"/></div></div><div class="figure-title">Figure 7-33. User interface for the projectile motion simulator</div></div><p class="calibre3">As shown, the application contains four sprites. The <code class="literal">Wheel</code> sprite provides
a rotation shaft for the cannon, while the <code class="literal">Cannon</code> sprite, which rotates in
accordance with the <code class="literal">angle</code> slider, provides a visual indication of the launch
angle. The <code class="literal">Fire</code> sprite is a button that the user clicks to fire the ball, and the
<code class="literal">Ball</code> sprite contains the main script for calculating the ball’s coordinates
and drawing its trajectory. The user specifies the launch angle and the initial velocity using the
two slider controls, then clicks the <code class="literal">Fire</code> button. The <code class="literal">Ball</code>
starts from point (–180, –140) on the Stage and draws the parabolic trajectory for the
specified parameters. The two monitors at the lower-right corner of the Stage show the flight time
and the horizontal range during the flight.</p><p class="calibre3">The simulation starts when the green flag icon is clicked. The scripts for the
<code class="literal">Cannon</code> sprite (not shown here) point the cannon in the direction specified by the
<code class="literal">angle</code> slider control. The user can also specify the angle by clicking and
dragging the cannon. When the user clicks the <code class="literal">Fire</code> button, it broadcasts a
<code class="literal">Fire</code> message, which is received and processed by the <code class="literal">Ball</code>
sprite via the script shown in <a class="xref" href="ch07.html#script_for_the_ball_sprite" title="Figure 7-34. Script for the Ball sprite">Figure 7-34</a>.</p><p class="calibre3">To prepare to fire ①, the <code class="literal">Ball</code> moves in front of the
<code class="literal">Cannon</code> and the <code class="literal">Wheel</code> and positions itself at the launch point.
It puts its pen down and clears all pen marks from the Stage. The script then calculates the
horizontal (or <span class="calibre"><em class="calibre6">x</em></span>) and vertical (or <span class="calibre"><em class="calibre6">y</em></span>) components of the
initial velocity (named <code class="literal">vx</code> and <code class="literal">vy</code>, respectively) and
initializes the time variable (<code class="literal">t</code>) to 0.</p><div class="figure"><a id="script_for_the_ball_sprite" class="calibre"/><div class="book"><div class="book"><a id="med_id00260" class="calibre"/><img alt="Script for the Ball sprite" src="httpatomoreillycomsourcenostarchimages2134867.png.jpg" class="calibre7"/></div></div><div class="figure-title">Figure 7-34. Script for the <code class="literal">Ball</code> sprite</div></div><p class="calibre3">The script then enters an infinite loop ②, which calculates and updates the ball’s
position every 0.02 s. First, the vertical distance (<code class="literal">dy</code>) of the sprite is
calculated ③. If the calculated value is negative, then the ball has reached ground level.
When this happens, the <span class="calibre"><strong class="calibre5">stop this script</strong></span> command is called to end
the simulation.</p><p class="calibre3">If <code class="literal">dy</code> is not negative, the horizontal distance (<code class="literal">d</code>) is
calculated ④. The two distances (<code class="literal">dy</code> and <code class="literal">d</code>) are then
scaled in accordance with the Stage’s backdrop. In the vertical direction, we have 320 steps
(from –140 to 180) that correspond to 100 m, and in the horizontal direction, we have 420
steps (from –180 to 240) that correspond to 100 m. This means a vertical distance of
<code class="literal">dy</code> meters is equivalent to <code class="literal">320 * dy / 100</code> steps, and a
horizontal distance of <code class="literal">d</code> meters is equivalent to <code class="literal">420 * d / 100</code>
steps. The <span class="calibre"><em class="calibre6">x</em></span>- and <span class="calibre"><em class="calibre6">y</em></span>-coordinates of the ball are updated,
and the ball is moved to its current position on its trajectory. The time variable
(<code class="literal">t</code>) is then incremented by a small amount (0.02 s in this case), and the loop is
repeated to calculate the next position of the ball.</p><p class="calibre3">As an example, if the ball is projected with a 70° launch angle and an initial speed of
30 m/s, as shown in <a class="xref" href="ch07.html#user_interface_for_the_projectile_motion" title="Figure 7-33. User interface for the projectile motion simulator">Figure 7-33</a>, the total flight
time is 5.75 s, and the range is 59 m. An examination of the monitors in <a class="xref" href="ch07.html#user_interface_for_the_projectile_motion" title="Figure 7-33. User interface for the projectile motion simulator">Figure 7-33</a> shows that our simulation is very accurate. We
could improve the simulation by updating our calculations more often (for example, every 0.01 s
instead of every 0.02 s), but that would slow down the simulation. It’s necessary to adjust
this parameter to achieve a good compromise between speed and accuracy.</p><div class="sidebar"><a id="try_it_out_7-10" class="calibre"/><div class="sidebar-title">Try It Out 7-10</div><p class="calibre3"><a class="calibre" id="iddle1514"/><a class="calibre" id="iddle1515"/><a class="calibre" id="iddle1534"/><a class="calibre" id="iddle1535"/><a class="calibre" id="iddle1641"/><a class="calibre" id="iddle1642"/><a class="calibre" id="iddle1770"/><a class="calibre" id="iddle1772"/><a class="calibre" id="iddle1776"/>Open the application and run it to understand how it works. Then try converting this
simulation into a game. You could, for example, show an object at a random height at the right edge
of the stage and ask the player to try to hit it. If the player misses the target, the game can
provide some hints on adjusting the firing angle and velocity.</p></div></div><div class="book" title="Other Applications"><div class="titlepage1"><div class="book"><div class="book"><h3 class="title3" id="other_applications-id00019">Other Applications</h3></div></div></div><p class="calibre3">The extra resources for this book (available at <span class="calibre"><em class="calibre6"><a class="xref" href="http://nostarch.com/learnscratch/" target="_top">http://nostarch.com/learnscratch/</a></em></span>) contain three more games that you can explore
on your own, with full explanations of each script. The first is an educational game that can be
used to test the counting skills of elementary students. It shows an amount of money in pennies and
asks the player to find the smallest number of coins needed to get that amount.</p><p class="calibre3"><span class="calibre"><em class="calibre6">MatchThat Amount.sb2</em></span></p><p class="calibre3">The second application is a planetary motion simulation for a simple solar system that
contains a sun and a single planet. The third application is also a simulation, this one
demonstrating the dynamics of motion as a single gas molecule collides with the walls of a
container.</p><p class="calibre3"><span class="calibre"><em class="calibre6">Orbit.sb2 Molecules InMotion.sb2</em></span></p><p class="calibre3">Open up these applications, run them, and read through my explanations to understand how they
work. If you feel inspired to flex your programming muscles, try modifying the scripts to make them
do new things!</p></div></div><div class="book" title="Summary"><div class="titlepage1"><div class="book"><div class="book"><h2 class="title2" id="summary-id00020">Summary</h2></div></div></div><p class="calibre3">In this chapter, we explored different ways to repeat commands in Scratch. We first examined
the various loop blocks and explained the technical terms associated with them. Then, we discussed
definite and indefinite loops and the difference between counter-controlled and condition-controlled
loops. We explored the <span class="calibre"><strong class="calibre5">repeat until</strong></span> block and the <span class="calibre"><strong class="calibre5">forever if</strong></span> structure and used them in several examples. I also explained
Scratch’s <span class="calibre"><strong class="calibre5">stop</strong></span> commands and how you can use them to stop
infinite loops and procedures. From there, we went on to discuss using loops to validate data from
user input.</p><p class="calibre3">You then learned how to use counters to keep track of how many iterations of a loop have
passed and how to use counters with nested loops to create iterations in two or more dimensions.
After that, we looked at recursion—a procedure calling itself—as another way to achieve
repetition. In the last section, we developed several applications that tied these new concepts
together to create practical programs.</p><p class="calibre3">The next chapter will expand on the topics you learned here and teach you how to use counters
and loops to process strings and create a different class of interesting programs, such as a binary
to decimal converter, a hangman game, and a math tutor for teaching fractions.</p><p class="calibre3">If you want to further explore the new concepts from this chapter, I suggest trying out some
of the following problems.</p></div><div class="book" title="Problems"><div class="titlepage1"><div class="book"><div class="book"><h2 class="title2" id="problems-id00021">Problems</h2></div></div></div><div class="book" title="Frequently Asked Questions"><a id="ch07qa1" class="calibre"/><table class="calibre21"><colgroup class="calibre10"><col class="calibre22"/><col class="c"/></colgroup><tbody class="calibre15"><tr class="calibre12" title="Q:"><td class="calibre20"><a id="ch07qa1qe1" class="calibre"/><a id="ch07qa1q1" class="calibre"/><p class="calibre3"><strong class="calibre5">Q:</strong></p></td><td class="calibre20"><p class="calibre3">1. <a class="calibre" id="iddle1347"/><a class="calibre" id="iddle1719"/>Create an input validation loop that only accepts numbers in the range of 1 through
10.</p></td></tr><tr class="calibre18" title="Q:"><td class="calibre20"><a id="ch07qa1qe2" class="calibre"/><a id="ch07qa1q2" class="calibre"/><p class="calibre3"><strong class="calibre5">Q:</strong></p></td><td class="calibre20"><p class="calibre3">2. Write a script that asks the user, “Are you sure you want to quit [Y, N]?” The
script then checks the user’s input and only accepts the letters <span class="calibre"><em class="calibre6">Y</em></span> and
<span class="calibre"><em class="calibre6">N</em></span> as valid answers.</p></td></tr><tr class="calibre12" title="Q:"><td class="calibre20"><a id="ch07qa1qe3" class="calibre"/><a id="ch07qa1q3" class="calibre"/><p class="calibre3"><strong class="calibre5">Q:</strong></p></td><td class="calibre20"><p class="calibre3">3. Write a program that calculates and displays the sum of all integers between 1 and
20.</p></td></tr><tr class="calibre18" title="Q:"><td class="calibre20"><a id="ch07qa1qe4" class="calibre"/><a id="ch07qa1q4" class="calibre"/><p class="calibre3"><strong class="calibre5">Q:</strong></p></td><td class="calibre20"><p class="calibre3">4. Write a program that calculates and displays the sum of all odd integers between 1 and
20.</p></td></tr><tr class="calibre12" title="Q:"><td class="calibre20"><a id="ch07qa1qe5" class="calibre"/><a id="ch07qa1q5" class="calibre"/><p class="calibre3"><strong class="calibre5">Q:</strong></p></td><td class="calibre20"><p class="calibre3">5. Write a program that displays the first 10 numbers in the following sequence (using the
<span class="calibre"><strong class="calibre5">say</strong></span> command): 5, 9, 13, 17, 21, ....</p><div class="informalfigure"><a id="med_id00261a" class="calibre"/><div class="book"><a id="med_id00261" class="calibre"/><img alt="image with no caption" src="httpatomoreillycomsourcenostarchimages2134869.png.jpg" class="calibre7"/></div></div></td></tr><tr class="calibre18" title="Q:"><td class="calibre20"><a id="ch07qa1qe6" class="calibre"/><a id="ch07qa1q6" class="calibre"/><p class="calibre3"><strong class="calibre5">Q:</strong></p></td><td class="calibre20"><p class="calibre3">6. What does the script on the right do? Implement the script and run it to check your
answer.</p></td></tr><tr class="calibre12" title="Q:"><td class="calibre20"><a id="ch07qa1qe7" class="calibre"/><a id="ch07qa1q7" class="calibre"/><p class="calibre3"><strong class="calibre5">Q:</strong></p></td><td class="calibre20"><p class="calibre3">7. If the remainder of dividing a whole number (<span class="calibre"><em class="calibre6">x</em></span>) by another whole
number (<span class="calibre"><em class="calibre6">y</em></span>) is 0, we say that <span class="calibre"><em class="calibre6">y</em></span> is a factor of
<span class="calibre"><em class="calibre6">x</em></span>. For example, 1, 2, 4, and 8 are factors of 8. The script below finds and
displays all the factors of a given number (other than the number itself). Study this script and
explain how it works. What are the outputs of this script when the input numbers are 125, 324, and
419?</p><div class="informalfigure"><a id="med_id00262a" class="calibre"/><div class="book"><a id="med_id00262" class="calibre"/><img alt="image with no caption" src="httpatomoreillycomsourcenostarchimages2134871.png.jpg" class="calibre7"/></div></div></td></tr><tr class="calibre18" title="Q:"><td class="calibre20"><a id="ch07qa1qe8" class="calibre"/><a id="ch07qa1q8" class="calibre"/><p class="calibre3"><strong class="calibre5">Q:</strong></p></td><td class="calibre20"><p class="calibre3">8. An integer is said to be prime if it is divisible by only 1 and itself. For example, 2, 3,
5, 7, 11 are prime numbers, but 4, 6, and 8 are not. The procedure on the next page tests whether a
number is a prime number or not. Study this procedure and explain how it works. What are the outputs
of this procedure for the inputs 127, 327, and 523?</p><div class="informalfigure"><a id="med_id00263a" class="calibre"/><div class="book"><a id="med_id00263" class="calibre"/><img alt="image with no caption" src="httpatomoreillycomsourcenostarchimages2134873.png.jpg" class="calibre7"/></div></div></td></tr><tr class="calibre12" title="Q:"><td class="calibre20"><a id="ch07qa1qe9" class="calibre"/><a id="ch07qa1q9" class="calibre"/><p class="calibre3"><strong class="calibre5">Q:</strong></p></td><td class="calibre20"><p class="calibre3">9. <a class="calibre" id="iddle1349"/>Although the procedure in problem 8 checks all integers up to one-half the input value,
it is sufficient to set the upper limit to the square root of the input. Make this change to the
procedure and test it to see if it still gives the same answers.</p></td></tr><tr class="calibre18" title="Q:"><td class="calibre20"><a id="ch07qa1qe10" class="calibre"/><a id="ch07qa1q10" class="calibre"/><p class="calibre3"><strong class="calibre5">Q:</strong></p></td><td class="calibre20"><p class="calibre3">10. The sequence of numbers</p><p class="calibre3">0, 1, 1, 2, 3, 5, 8, 13, 21, 34 ....</p><p class="calibre3">is called a Fibonacci series. The first two numbers in the series are 0 and 1. Each subsequent
number is then calculated as the sum of the previous two. Write a program that calculates the
<span class="calibre"><em class="calibre6">n</em></span>th term of the Fibonacci series, where <span class="calibre"><em class="calibre6">n</em></span> is entered by
the user.</p></td></tr><tr class="calibre12" title="Q:"><td class="calibre20"><a id="ch07qa1qe11" class="calibre"/><a id="ch07qa1q11" class="calibre"/><p class="calibre3"><strong class="calibre5">Q:</strong></p></td><td class="calibre20"><p class="calibre3">11. Consider the following program and its generated output. Re-create the program and run it
to see how it works. Change the turn angle (from 10°) and the argument in the recursive call
(to <span class="calibre"><strong class="calibre5">side + 1</strong></span> or <span class="calibre"><strong class="calibre5">side + 3</strong></span>, and
so on) to discover what else you can create.</p><div class="informalfigure"><a id="med_id00264a" class="calibre"/><div class="book"><a id="med_id00264" class="calibre"/><img alt="image with no caption" src="httpatomoreillycomsourcenostarchimages2134875.png.jpg" class="calibre7"/></div></div></td></tr></tbody></table></div></div></section></body></html>