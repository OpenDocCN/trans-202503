<?xml version='1.0' encoding='utf-8'?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" epub:prefix="z3998: http://www.daisy.org/z3998/2012/vocab/structure/#" lang="en" xml:lang="en">
  <head>
    <title>Project 12: Temperature and Humidity Data Logger</title>
    <link href="../styles/9781593278717.css" rel="stylesheet" type="text/css"/>
    <link href="../68851547a55f.css" rel="stylesheet" type="text/css"/>
  </head>
  <body>
    <div id="sbo-rt-content"><h2 class="h2" id="ch12"><span epub:type="pagebreak" id="page_153"/><strong>12<br/>Temperature and Humidity Data Logger</strong></h2>
<p class="noindent"><span class="violet">In this project, you’re going to build a data logger that automatically stores data on temperature and humidity. You’ll learn how to read and log data from your environment, which is useful in numerous applications.</span></p>
<div class="image"><span epub:type="pagebreak" id="page_154"/><img src="../images/f0154-01.jpg" alt="image"/></div>
<p class="cap"><span class="violet"><strong>PARTS REQUIRED</strong></span></p>
<p class="cap1">Raspberry Pi</p>
<p class="cap1">Breadboard</p>
<p class="cap1">DHT22 temperature and humidity sensor (DHT11 and AM2302 also work)</p>
<p class="cap1">4.7 kΩ resistor</p>
<p class="cap1">Jumper wires</p>
<p class="cap"><span class="violet"><strong>SOFTWARE REQUIRED</strong></span></p>
<p class="cap1">Adafruit_Python_DHT library</p>
<p class="indentt"><span epub:type="pagebreak" id="page_155"/>You’ll use the DHT22 temperature and humidity sensor to collect data, which will then be saved in a <em>.txt</em> file that you can then use to build charts, graphs, and other visualizations. This project gives you the basics of data collection, which is useful in many different applications that use sensors—for example, monitoring soil dampness, taking the temperature of water in a fish tank, or even registering the exact time unexpected movement was detected around your house. You can apply the concepts from this project to any sensor.</p>
<h3 class="h3" id="lev123"><span class="violet"><strong>INTRODUCING THE DHT22 SENSOR</strong></span></h3>
<p class="noindent">The DHT22 (shown in <a href="ch12.xhtml#ch12fig1">Figure 12-1</a>) is a digital temperature and humidity sensor with a built-in chip that converts analog to digital signals, so there’s no need to use an analog-to-digital converter. This makes wiring really simple.</p>
<div class="image"><a id="ch12fig1"/><img src="../images/f0155-01.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 12-1:</strong> DHT22 temperature and humidity sensor</p>
<h3 class="h3" id="lev124"><span class="violet"><strong>WIRING THE CIRCUIT</strong></span></h3>
<p class="noindent">This is a simple circuit that just has the DHT22 sensor wired to your Pi via a resistor. Follow these instructions, using the circuit diagram in <a href="ch12.xhtml#ch12fig2">Figure 12-2</a> as a reference.</p>
<ol>
<li class="noindent"><p class="list">Connect GND and 3.3 V on the Pi to the breadboard’s blue and red power rails, respectively.</p></li>
<li class="noindent"><p class="list">Connect the DHT22 sensor according to the following table, with pins starting at 1 from left to right when the sensor is facing you. Make sure to wire the resistor between pin 2 of the sensor and the breadboard’s red power rail.</p></li>
</ol>
<table class="topbot-d">
<thead>
<tr>
<td style="vertical-align: top;" class="border_th-l"><p class="tab_th"><span epub:type="pagebreak" id="page_156"/><strong>DHT22</strong></p></td>
<td style="vertical-align: top;" class="border_tha"><p class="tab_th"><strong>RASPBERRY PI</strong></p></td>
</tr>
</thead>
<tbody>
<tr>
<td style="vertical-align: top;" class="table-l"><p class="tabc"><span class="violet">1</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="violet">3.3 V</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-l"><p class="tabc"><span class="violet">2</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="violet">GPIO 4; also connect to 3.3 V through a 4.7 kΩ resistor</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-l"><p class="tabc"><span class="violet">3</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="violet">Don’t connect</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-l"><p class="tabc"><span class="violet">4</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="violet">GND</span></p></td>
</tr>
</tbody>
</table>
<div class="image"><a id="ch12fig2"/><img src="../images/f0156-01.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 12-2:</strong> Wiring the DHT22 sensor to the Pi</p>
<h3 class="h3" id="lev125"><span class="violet"><strong>WRITING THE SCRIPT</strong></span></h3>
<p class="noindent">You’ll use the Adafruit_Python_DHT library, which allows you to easily control the DHT22 sensor and read the data.</p>
<h4 class="h4" id="lev126"><span class="violet"><strong>Installing the DHT22 Library</strong></span></h4>
<p class="noindent">This library can also be used with similar sensors, like DHT11 and AM2302 (the wired version of the DHT22 from Adafruit), if you’re using those instead.</p>
<p class="indent">Open the terminal and enter the following:</p>
<div class="box">
<p class="programs">pi@raspberrypi:~ $ <span class="codestrong">sudo apt update</span><br/>pi@raspberrypi:~ $ <span class="codestrong">sudo apt install build-essential python-dev</span></p>
</div>
<p class="indent">From the terminal, navigate to the desktop, make a folder called <em>Libraries</em> if you haven’t already, and move into the newly created folder as follows:</p>
<div class="box">
<p class="programs">pi@raspberrypi:~ $ <span class="codestrong">cd ~/Desktop</span><br/>pi@raspberrypi:~/Desktop $ <span class="codestrong">mkdir Libraries</span><br/><span epub:type="pagebreak" id="page_157"/>pi@raspberrypi:~/Desktop $ <span class="codestrong">cd Libraries</span><br/>pi@raspberrypi:~/Desktop/Libraries $</p>
</div>
<p class="indent">Clone the library by entering the following command:</p>
<div class="box">
<p class="programs">pi@raspberrypi:~/Desktop/Libraries $ <span class="codestrong">git clone https://github.com/</span><br/><span class="codestrong">adafruit/Adafruit_Python_DHT.git</span></p>
</div>
<p class="indent">Finally, move to the <em>Adafruit_Python_DHT</em> directory and install the library with these commands:</p>
<div class="box">
<p class="programs">pi@raspberrypi:~/Desktop/Libraries $ <span class="codestrong">cd Adafruit_Python_DHT</span><br/>pi@raspberrypi:~/Desktop/Libraries/Adafruit_Python_DHT $ <span class="codestrong">sudo python</span><br/><span class="codestrong">setup.py install</span></p>
</div>
<p class="indent">With the necessary library installed, it’s time to write the script.</p>
<h4 class="h4" id="lev127"><span class="violet"><strong>Entering the Script</strong></span></h4>
<p class="noindent">The DHT22 library is not supported by Python 3, so you need to use Python 2.7. Open <strong>Python 2.7 (IDLE)</strong> and go to <strong>File</strong> <span class="ent">▸</span> <strong>New File</strong> to create a new script. Copy the code from <a href="ch12.xhtml#ch12list1">Listing 12-1</a> to the Python Editor and save the script as <em>temperature_humidity_data_logger.py</em> inside the <em>Sensors</em> folder (remember that you can download all the scripts at <em><a href="https://www.nostarch.com/RaspberryPiProject/">https://www.nostarch.com/RaspberryPiProject/</a></em>):</p>
<p class="listing" id="ch12list1"><strong>LISTING 12-1:</strong> The temperature and humidity data logger script</p>
<div class="box">
<p class="programs">  <span class="red1">#import necessary libraries</span><br/><span class="ent">➊</span> <span class="orange">import</span> Adafruit_DHT<br/>  <span class="orange">import</span> time<br/><br/>  <span class="red1">#comment and uncomment the lines below depending on your sensor</span><br/>  <span class="red1">#sensor = Adafruit_DHT.DHT11</span><br/><span class="ent">➋</span> sensor = Adafruit_DHT.DHT22<br/>  <span class="red1">#sensor = Adafruit_DHT.AM2302</span><br/><br/>  <span class="red1">#DHT pin connects to GPIO 4</span><br/>  sensor_pin = 4<br/><br/>  <span class="red1">#create a variable to control the while loop</span><br/>  running = <span class="orange">True</span><br/><br/>  <span class="red1">#new .txt file created with header</span><br/><span class="ent">➌</span> file = <span class="purple">open</span>(<span class="green">'sensor_readings.txt'</span>, <span class="green">'w'</span>)<br/><span class="ent">➍</span> file.write(<span class="green">'time and date, temperature, humidity\n'</span>)<br/><br/>  <span class="red1">#loop forever</span><br/>  <span class="orange">while</span> running:<br/>      <span class="orange">try</span>:<br/>          <span class="red1">#read the humidity and temperature</span><br/>       <span class="ent">➎</span> humidity, temperature = Adafruit_DHT.read_retry(sensor,<br/>  sensor_pin)<br/><br/><span epub:type="pagebreak" id="page_158"/>          <span class="red1">#uncomment the line below to convert to Fahrenheit</span><br/>       <span class="ent">➏</span> <span class="red1">#temperature = temperature * 9/5.0 + 32</span><br/><br/>          <span class="red1">#sometimes you won't get a reading and</span><br/>          <span class="red1">#the results will be null</span><br/>          <span class="red1">#the next statement guarantees that</span><br/>          <span class="red1">#it only saves valid readings</span><br/>       <span class="ent">➐</span> <span class="orange">if</span> humidity <span class="orange">is not None</span> and temperature <span class="orange">is not None</span>:<br/>              <span class="red1">#print temperature and humidity</span><br/>              <span class="purple">print</span>(<span class="green">'Temperature = '</span> + <span class="purple">str</span>(temperature) +<br/>  <span class="green">', Humidity = '</span> + <span class="purple">str</span>(humidity))<br/>              <span class="red1">#save time, date, temperature and humidity in .txt file</span><br/>           <span class="ent">➑</span> file.write(time.strftime(<span class="green">'%H:%M:%S %d/%m/%Y'</span>) + <span class="green">', '</span> +<br/>                  <span class="purple">str</span>(temperature) + <span class="green">', '</span> + <span class="purple">str</span>(humidity) + <span class="green">'\n'</span>)<br/>          <span class="orange">else</span>:<br/>              <span class="purple">print</span>(<span class="green">'Failed to get reading. Try again!'</span>)<br/>          <span class="red1">#wait 10s between each sensor reading</span><br/>       <span class="ent">➒</span> time.sleep(10)<br/>      <span class="red1">#if KeyboardInterrupt triggered, stop loop and close .txt file</span><br/>      <span class="orange">except</span> <span class="purple">KeyboardInterrupt</span>:<br/>          <span class="purple">print</span> (<span class="green">'Program stopped'</span>)<br/>          running = <span class="orange">False</span><br/>       <span class="ent">➓</span> file.close()</p>
</div>
<p class="indent">First, you import the Adafruit_DHT library <span class="ent">➊</span> you just installed, as well as the built-in time library. Then, at <span class="ent">➋</span>, you uncomment the line that corresponds to the sensor you’re using. If you’re using DHT22, you don’t need to change anything.</p>
<p class="indent">The line at <span class="ent">➎</span> reads the temperature and humidity and saves the readings in the <span class="literal">temperature</span> and <span class="literal">humidity</span> variables, respectively. If you want your temperature readings in Fahrenheit, uncomment the line at <span class="ent">➏</span> to make the conversion from Celsius.</p>
<p class="indent">Sometimes the sensor can’t read the data and sends a <span class="literal">null</span> result to the Pi. The <span class="literal">if</span> statement at <span class="ent">➐</span> guarantees that the Pi saves data only if it is not <span class="literal">null</span>. You also timestamp each reading using <span class="literal">time.strftime("%H:%M:%S %d/%m/%Y")</span>—the argument in the parentheses here indicates the format you want the time and date to appear in: hours, minutes, seconds, day, month, and year, respectively.</p>
<p class="indent">This script reads and records the temperature and humidity every 10 seconds, but you can change this at <span class="ent">➒</span> by changing the delay time. The sensor is capable of taking readings every 2 seconds, but no faster than that.</p>
<h4 class="h4" id="lev128"><span class="violet"><strong>Creating, Writing, and Closing .txt files</strong></span></h4>
<p class="noindent">The DHT22 temperature and humidity readings are automatically saved in a <em>.txt</em> file that you create with the <span class="literal">open()</span> function <span class="ent">➌</span> and <span epub:type="pagebreak" id="page_159"/>store in the <span class="literal">file</span> variable. This function accepts the name you want to give the file as an argument and, in this case, a <span class="literal">'</span><span class="literal">w'</span> telling Python you want this file to be in <em>write mode</em>, meaning the program can write and make changes to the file. The write mode overwrites existing files with the same name.</p>
<div class="note">
<p class="notet"><strong>NOTE</strong></p>
<p class="notep"><em>Every time you run the code, it will overwrite whatever was already in the</em> sensor_readings.txt <em>file. If you don’t want this to happen, change the filename at</em> <span class="ent">➍</span> <em>to create a new file each time you run the script.</em></p>
</div>
<p class="indent">The <span class="literal">file.write()</span> function writes to the file and accepts a string as an argument. For example, with <span class="literal">file.write('time and date, temperature, humidity\n')</span> at <span class="ent">➍</span>, you write “time and date, temperature, humidity” into the file. At <span class="ent">➐</span>, you write the sensor data to the file and at<span class="ent">➑</span> the timestamp. The <span class="literal">\n</span> tells Python to start the next display text on the next line, known as a <em>newline</em>.</p>
<p class="indent">Finally, the <span class="literal">file.close()</span> function <span class="ent">➓</span> saves and closes the file.</p>
<h4 class="h4" id="lev129"><span class="violet"><strong>Running the Script</strong></span></h4>
<p class="noindent">Press <strong>F5</strong> or go to <strong>Run</strong> <span class="ent">▸</span> <strong>Run Module</strong> to run the script. Let the script run for a few hours to gather a decent amount of data, and when you’re happy with the data logging period, stop the script by pressing <small>CTRL</small>-C. You should then have a <em>sensor_readings.txt</em> file that contains all your data in your <em>Sensors</em> folder.</p>
<h3 class="h3" id="lev130"><span class="violet"><strong>TAKING IT FURTHER</strong></span></h3>
<p class="noindent">In this project you’ve learned a very useful concept: data logging. Now you can use data logging in other monitoring projects. Here are some ideas:</p>
<ul>
<li class="noindent">Use a PIR motion sensor that makes a timestamp every time it detects movement.</li>
<li class="noindent">Build a weather station data logger with the Sense HAT.</li>
<li class="noindent">Search for other monitoring sensor applications—for example, soil moisture, rain, and light sensors—to build a greenhouse data logger.<span epub:type="pagebreak" id="page_160"/></li>
</ul>
</div>
  </body>
</html>
