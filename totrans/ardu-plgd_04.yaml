- en: '**3'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: THE REGULATED POWER SUPPLY**
  prefs: []
  type: TYPE_NORMAL
- en: '![image](../images/common-01.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Whether you use a standard bench power supply or run your Arduino off the USB
    port of your computer, sooner or later you’re going to need a stand-alone, regulated
    power supply capable of providing a variable voltage. This project shows you how
    to make exactly that, using only a handful of inexpensive parts. A variable power
    supply is one of the most frequently used tools in many workshops. This one is
    easy and fun to build, and you will find that you end up using it over and over
    again.
  prefs: []
  type: TYPE_NORMAL
- en: When set for 5V or 3.3V, the Regulated Power Supply can power most Arduino projects
    with ease. You can also use it to power some ancillary piece of equipment, to
    vary a particular voltage in a system while the main power is fixed, or simply
    to test a lamp circuit, LED, motor, or other device.
  prefs: []
  type: TYPE_NORMAL
- en: The circuit uses the extremely versatile LM317 regulator chip. If you ever find
    yourself in need of a precision voltage regulator with some unusual demands, look
    up the LM317 on the web. The JavaScript Electronic Notebook has a particularly
    good article titled “LM 317 Voltage Regulator Designer” by Martin E. Meserve,
    which can be found at *[http://www.k7mem.com/Electronic_Notebook/power_supplies/lm317.html](http://www.k7mem.com/Electronic_Notebook/power_supplies/lm317.html)*.
  prefs: []
  type: TYPE_NORMAL
- en: '**Required Tools**'
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Soldering iron and solder
  prefs: []
  type: TYPE_NORMAL
- en: Drill and drill bits (3/8 and 1/4 inches)
  prefs: []
  type: TYPE_NORMAL
- en: Hacksaw or keyhole saw (nibbler or other)
  prefs: []
  type: TYPE_NORMAL
- en: Phillips head screwdriver
  prefs: []
  type: TYPE_NORMAL
- en: (Optional) Tapered reamer set
  prefs: []
  type: TYPE_NORMAL
- en: (Optional) Crimping tool
  prefs: []
  type: TYPE_NORMAL
- en: '**Parts List**'
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'The Regulated Power Supply is capable of providing an adjustable voltage from
    1.25V to about 12V at up to 1.5 A, depending on the fundamental power you use.
    It uses the LM317 single-chip voltage regulator to set the voltage. To build this
    project, you will need the following parts:'
  prefs: []
  type: TYPE_NORMAL
- en: One Arduino Pro Mini or clone
  prefs: []
  type: TYPE_NORMAL
- en: One LM317 voltage regulator
  prefs: []
  type: TYPE_NORMAL
- en: One LM7805 voltage regulator
  prefs: []
  type: TYPE_NORMAL
- en: Two 2.2-ohm, 5 W resistors
  prefs: []
  type: TYPE_NORMAL
- en: Three 10-kilohm, 1/8 W resistors
  prefs: []
  type: TYPE_NORMAL
- en: Three 6.8-kilohm, 1/8 W resistors
  prefs: []
  type: TYPE_NORMAL
- en: One 68 μF tantalum capacitor
  prefs: []
  type: TYPE_NORMAL
- en: Three 0.1 μF ceramic capacitors
  prefs: []
  type: TYPE_NORMAL
- en: One 1 μF tantalum capacitor
  prefs: []
  type: TYPE_NORMAL
- en: One 16×2 LCD
  prefs: []
  type: TYPE_NORMAL
- en: One I²C adapter, if not included with the LCD
  prefs: []
  type: TYPE_NORMAL
- en: Four 4-40 screws
  prefs: []
  type: TYPE_NORMAL
- en: Eight 4-40 nuts
  prefs: []
  type: TYPE_NORMAL
- en: One 5 mm LED (for power indicator)
  prefs: []
  type: TYPE_NORMAL
- en: One SPST switch
  prefs: []
  type: TYPE_NORMAL
- en: One 470-ohm, 1/8 W resistor
  prefs: []
  type: TYPE_NORMAL
- en: One 10-kilohm, 1/8 W potentiometer
  prefs: []
  type: TYPE_NORMAL
- en: One Hammond panel/case (#1456CE3WHBU)
  prefs: []
  type: TYPE_NORMAL
- en: Two banana plug jacks
  prefs: []
  type: TYPE_NORMAL
- en: One 3.5 mm jack
  prefs: []
  type: TYPE_NORMAL
- en: One 12V 2 A AC adapter
  prefs: []
  type: TYPE_NORMAL
- en: One power adapter jack
  prefs: []
  type: TYPE_NORMAL
- en: One PCB/shield
  prefs: []
  type: TYPE_NORMAL
- en: Six 1×4 headers
  prefs: []
  type: TYPE_NORMAL
- en: Four 1×4 housings
  prefs: []
  type: TYPE_NORMAL
- en: Four 1×2 headers
  prefs: []
  type: TYPE_NORMAL
- en: One heavy-duty TO-220 heat sink
  prefs: []
  type: TYPE_NORMAL
- en: One medium-duty TO-220 heat sink
  prefs: []
  type: TYPE_NORMAL
- en: Four male crimp connectors
  prefs: []
  type: TYPE_NORMAL
- en: Four female crimp connectors
  prefs: []
  type: TYPE_NORMAL
- en: 30-gauge hookup wire
  prefs: []
  type: TYPE_NORMAL
- en: One knob to cover the potentiometer shaft
  prefs: []
  type: TYPE_NORMAL
- en: Double-sided foam tape
  prefs: []
  type: TYPE_NORMAL
- en: 'A note on heat-sink selection: there are a wide variety of heat sinks available.
    The one pictured in [Figure 3-2](ch03.xhtml#ch03fig2) is the Futurlec TO220ST,
    which works okay but runs pretty warm as you approach the 1 A range. A larger
    one that will still fit in an enclosure may be better. Futurlec TO220SMAL, the
    heat sink for the LM7805, is sufficient for the job.'
  prefs: []
  type: TYPE_NORMAL
- en: '**Downloads**'
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'You will find the following files in this book’s online resources to help you
    complete this project:'
  prefs: []
  type: TYPE_NORMAL
- en: '**Templates** *PowerSupplyFront.dxf, PowerSupplyFrontBottom.dxf*'
  prefs: []
  type: TYPE_NORMAL
- en: '**Sketch** *PowerSupply.ino*'
  prefs: []
  type: TYPE_NORMAL
- en: '**Shield file** *VoltageRegulator.pcb*'
  prefs: []
  type: TYPE_NORMAL
- en: '**WHAT THE REGULATED POWER SUPPLY IS AND ISN’T**'
  prefs: []
  type: TYPE_NORMAL
- en: The power supply in this project is not intended to replace a regular bench
    power supply. It does not provide any current limiting and is rated up to 1.5
    A, due to the current capacity of the LM317\. However, for a wide variety of applications—including
    all of the projects in this book—it works very well. If you’re new to Arduino,
    it will provide a solid power supply and save you a lot of batteries, if that’s
    how you’ve been powering your projects. If you already have a full-sized bench
    supply, this project will be indispensable as a second supply. The Regulated Power
    Supply can be used for several projects in this book that require a secondary
    power supply.
  prefs: []
  type: TYPE_NORMAL
- en: I have used the Regulated Power Supply in other applications, and at the end
    of this project, I’ll illustrate a more simplified version that can be used as
    a remote supply. There are times when you just don’t have the proper voltage supply
    for a project, and this build fits the bill.
  prefs: []
  type: TYPE_NORMAL
- en: '**A Flexible Voltage Regulator Circuit**'
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: The basic LM317 regulator circuit in [Figure 3-1](ch03.xhtml#ch03fig1) is the
    heart of this voltage regulator. Though it is relatively rudimentary, the chip’s
    simplicity belies what a powerful and versatile tool it can be.
  prefs: []
  type: TYPE_NORMAL
- en: '![image](../images/f03-01.jpg)'
  prefs: []
  type: TYPE_IMG
- en: '*Figure 3-1: This is the schematic diagram for the regulator component of the
    Regulated Power Supply. The complete schematic with the display is shown in [Figure
    3-4](ch03.xhtml#ch03fig4)*.'
  prefs: []
  type: TYPE_NORMAL
- en: I have used some variation of this circuit for many applications, from a stand-alone
    variable supply to an integrated part of a larger system, always with good results.
  prefs: []
  type: TYPE_NORMAL
- en: In the shop, I sometimes use kind of a “hair-wired” version, shown in [Figure
    3-2](ch03.xhtml#ch03fig2) (left), for testing LEDs and controlling things like
    motor speed and lamp intensity. I’ve also used a breadboard version, shown in
    [Figure 3-2](ch03.xhtml#ch03fig2) (right), to implement the regulator circuit.
    In both cases, I used a trimmer potentiometer, which requires an alignment tool
    or screwdriver to make adjustments.
  prefs: []
  type: TYPE_NORMAL
- en: '![image](../images/f03-02.jpg)'
  prefs: []
  type: TYPE_IMG
- en: '*Figure 3-2: The “hair-wired” version of the voltage regulator circuit with
    a heat sink screwed to the LM317 (left) and a breadboard version of the regulator
    (right). I used this in an application with minimal power requirements and thus
    did not include the heat sink*.'
  prefs: []
  type: TYPE_NORMAL
- en: While those regulator circuits worked, one reason for using the more refined
    Regulated Power Supply format in [Figure 3-1](ch03.xhtml#ch03fig1) was to eliminate
    the awkward trimmer potentiometer and instead use a standard 270-degree potentiometer
    and knob so that I could make adjustments quickly, easily, and repeatedly. But
    the main reason I built it was to have a secondary variable-voltage power supply
    with digital readout readily available on the bench.
  prefs: []
  type: TYPE_NORMAL
- en: '**How the Circuit Works**'
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: The circuit for this project is not overly complex. In essence, it measures
    the voltage at the output of the LM317 regulator using the onboard analog-to-digital
    converter (ADC) and compares it to an internal reference voltage. The result is
    sent to the LCD screen. However, the Arduino Pro Mini 5V version can accept a
    maximum of only 5V at the analog inputs. We therefore use a *voltage divider*
    to make sure that the voltage at the analog input pin doesn’t exceed 5V. (Make
    sure voltage supplied to the LM317 is no greater than 12V.)
  prefs: []
  type: TYPE_NORMAL
- en: In this case, a voltage divider comprises two resistors connected in series,
    straddling the output of the LM317 and the ground rail of the breadboard (see
    the schematic in [Figure 3-4](ch03.xhtml#ch03fig4)). The voltage coming from the
    LM317 gets divided across the two resistors, R2 and R3\. As you will note in the
    sketch, converting from the divided voltage back to the original levels for the
    display is simply a matter of reversing the arithmetic.
  prefs: []
  type: TYPE_NORMAL
- en: 'As shown in the schematic in [Figure 3-4](ch03.xhtml#ch03fig4), the output
    of the LM317 connects to both the R2-R3 voltage divider and to resistor R1\. Together,
    resistor R1 in parallel with R9 and the load, or whatever you want to power with
    the power supply, can be seen as another voltage divider. The R1-R9 voltage divider
    has a resistance of only 1.1 ohms, so the voltage drop across it is going to be
    relatively small. According to Ohm’s law (*I* = *V*/*R*) the voltage across R1
    and R9 is going to be 1.65V for a maximum current drain of 1.5 A (the maximum
    supported by the regulator IC): 1.5 A = 1.65V/1.1 Ω.'
  prefs: []
  type: TYPE_NORMAL
- en: This means that when the LM317 provides about 12V and the load draws 1.5 A,
    there will be a 1.65V voltage drop across R1 and R9, leaving 10.45V at the power
    supply’s output.
  prefs: []
  type: TYPE_NORMAL
- en: Looking at the schematic in [Figure 3-4](ch03.xhtml#ch03fig4), we are comparing
    the voltage at analog inputs A0 and A2 of the Pro Mini. If you use the same values
    for the voltage divider for A0 and A1, you can eliminate one of the sets of resistors
    and simply connect A0 to A1.
  prefs: []
  type: TYPE_NORMAL
- en: '**VOLTAGE DIVIDER RESISTOR VALUES**'
  prefs: []
  type: TYPE_NORMAL
- en: 'The values of the resistors needed to achieve a certain voltage are determined
    using this formula:'
  prefs: []
  type: TYPE_NORMAL
- en: '![image](../images/e0074-01.jpg)'
  prefs: []
  type: TYPE_IMG
- en: The schematic of a typical voltage divider circuit is shown in [Figure 3-3](ch03.xhtml#ch03fig3).
  prefs: []
  type: TYPE_NORMAL
- en: '![image](../images/f03-03.jpg)'
  prefs: []
  type: TYPE_IMG
- en: '*Figure 3-3: A typical voltage divider circuit*'
  prefs: []
  type: TYPE_NORMAL
- en: You can do the algebra if you’d like, but it’s easiest to use an online calculator,
    such as the one at *[http://www.daycounter.com/Calculators/VoltageDivider-Calculator.phtml](http://www.daycounter.com/Calculators/VoltageDivider-Calculator.phtml)*.
    In this project, the objective is to achieve an output of around 5V. We’ll start
    with a 12V input and a 10-kilohm resistor, represented by R1 in the formula and
    marked R2 in the schematic. Fill in the calculator fields with this information,
    and the formula will give you a resistor value of 7.1-kilohm for R2 in the schematic
    and R1 in the formula. The closest standard resistor value is 6.8 kilohm, so the
    project uses that along with the 10-kilohm resistor in its voltage divider.
  prefs: []
  type: TYPE_NORMAL
- en: But why start with a 10-kilohm resistor? The first reason is to avoid drawing
    too much current. Even if the entire 12V dropped across the 10-kilohm resistor,
    it would result only in a nominal drain of 1.2 mA. Second, I have a lot of 10-kilohm
    resistors in the parts bin, and I am sure you do, too.
  prefs: []
  type: TYPE_NORMAL
- en: I use three sets of voltage dividers in this circuit. The first looks at the
    voltage at the output of the regulator, which is ultimately displayed on the LCD.
    The other two divide the voltage in front of and behind the voltage-dropping resistor
    so that the amperage can be measured according to the formula *I* = *V*/*R*, where
    *V* is the voltage drop across resistors R1 and R9, and R is the value of those
    two resistors combined. Could I have eliminated one set of voltage dividers? Yes,
    by joining A0 and A1 together. I thought, however, that I might want to change
    those values at some point to increase the accuracy of the ammeter by bringing
    the value closer to the Arduino reference voltage, so I did not join them in my
    version of the project.
  prefs: []
  type: TYPE_NORMAL
- en: '**The Schematic**'
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: While I wanted the Regulated Power Supply to be relatively robust, I didn’t
    want it to be overly complex or hard to build. The hair-wired and breadboard versions
    did well in temporary or emergency applications when used with a digital multimeter
    (DMM), but I sought to build something more permanent that would have its own
    voltage and current readout, and that would stay on the workbench or sit on my
    desk as a regular addition to the tool set. [Figure 3-4](ch03.xhtml#ch03fig4)
    shows the full schematic for the Regulated Power Supply.
  prefs: []
  type: TYPE_NORMAL
- en: '![image](../images/f03-04.jpg)'
  prefs: []
  type: TYPE_IMG
- en: '*Figure 3-4: Schematic for the Regulated Power Supply*'
  prefs: []
  type: TYPE_NORMAL
- en: '**The Breadboard**'
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: As in all of my Arduino projects, I began with the standard breadboard. To make
    life easy, I used a standard potentiometer with pins that would fit into the 0.100-inch-spaced
    breadboard holes. With a little effort, a standard 16 mm rotary potentiometer
    (R7 in the schematic) with printed circuit board connectors will just about fit
    into every other hole in a breadboard. [Figure 3-5](ch03.xhtml#ch03fig5) shows
    an overhead view of the finished breadboard before you power it.
  prefs: []
  type: TYPE_NORMAL
- en: '![image](../images/f03-05.jpg)'
  prefs: []
  type: TYPE_IMG
- en: '*Figure 3-5: The breadboard for the Regulated Power Supply. The capacitors
    in the schematic—C1, C2, and C3—are not included in the breadboard but should
    be included in the completed unit*.'
  prefs: []
  type: TYPE_NORMAL
- en: '***Preparing the Arduino Pro Mini and LCD***'
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: The Arduino Pro Mini may or may not come with the male headers attached. If
    it doesn’t, you’ll have to solder them yourself (see “[Preparing the Arduino Board](ch00.xhtml#ch00lev1sec1)”
    on [page 2](ch00.xhtml#page_2)). Make sure the number of header pins in your strip
    matches the corresponding holes in the Pro Mini; you may have to cut the strip
    to the proper number of pins if the included strip is too long. Trim two strips
    of headers to size and place the long ends of the two header strips into a breadboard,
    spaced so that the Pro Mini board will fit over them. Put the Pro Mini in place,
    and solder all the header pins. Then, take two header pins (use the surplus from
    the longer header or purchase these separately), insert them in the A4 and A5
    holes in the Pro Mini, and solder. These are the pins used for the LCD.
  prefs: []
  type: TYPE_NORMAL
- en: Finally, install five header pins on the edge of the board (at the TX0 and RXI
    end). Some boards come with straight headers, others with the long pins bent at
    a 90 degree angle. In most of the applications, I have found it easier to work
    with straight headers. You can use right-angle headers, but it may be more difficult
    to plug in the connector for programming the board, so I recommend replacing any
    right-angle pins with straight ones. You also might want to take a 1/2-inch length
    of 22-gauge wire and solder it to the short end of the RST pin so it sticks up.
    A female header connector will connect to this during programming.
  prefs: []
  type: TYPE_NORMAL
- en: You will now have to get the LCD/I²C assembly ready. If you purchased the display
    and adapter separately, you will have to assemble them. Go to “[Affixing the I²C
    Board to the LCD](ch00.xhtml#ch00lev1sec2)” on [page 3](ch00.xhtml#page_3) for
    instructions. If you purchased the display with the I²C adapter, it’s ready for
    assembly.
  prefs: []
  type: TYPE_NORMAL
- en: '***Building the Breadboard***'
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: 'Here’s the step-by-step guide to putting together the breadboard:'
  prefs: []
  type: TYPE_NORMAL
- en: Insert wires to connect the two positive (red) rails together.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Insert wires to connect the two negative (blue) rails together.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '**WARNING**'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '*Be careful not to cross the two and connect the positive rails to negative
    rails. That could cause a short circuit and damage the hardware*.'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Insert the 10-kilohm rotary potentiometer into the breadboard.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Insert the LM317, with or without heat sink attached, near the potentiometer,
    as shown in [Figure 3-5](ch03.xhtml#ch03fig5). (See [Figure 3-6](ch03.xhtml#ch03fig6)
    for the pinout of the LM317.)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![image](../images/f03-06.jpg)'
  prefs:
  - PREF_IND
  type: TYPE_IMG
- en: '*Figure 3-6: Pinout of the LM317 regulator*'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: With the potentiometer shaft facing you, connect the leftmost pin and center
    pin of the potentiometer together, and then connect both to the adjustment (ADJ)
    pin of the LM317.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: With the potentiometer in the same orientation, connect the rightmost pin to
    the blue negative rail (ground).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Connect a 470-ohm resistor from the output pin to the ADJ pin on the LM317.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Connect a 1.2-ohm resistor (R1 in [Figure 3-4](ch03.xhtml#ch03fig4)—I used two
    2.2-ohm resistors in parallel) from the output pin of the LM317 to a load of your
    choosing. For test purposes, I used a 1/8 W resistor and connected a 5V, 30 mA
    incandescent indicator lamp for the load. (You may want to use the actual R1 and
    R9 resistors that you will use in the finished unit, so you can adjust the sketch
    before completing the unit.)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Connect the input pin of the LM317 to the 12V system input voltage. This is
    the wire going from the LM317 to the upper alligator clip in [Figure 3-5](ch03.xhtml#ch03fig5).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Connect the blue negative rails to the negative side of the input power (probably
    a wall plug).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Insert the LM7805 into the breadboard, as shown in [Figure 3-5](ch03.xhtml#ch03fig5).
    (See [Figure 3-7](ch03.xhtml#ch03fig7) for the pinout of the LM7805.)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![image](../images/f03-07.jpg)'
  prefs:
  - PREF_IND
  type: TYPE_IMG
- en: '*Figure 3-7: Pinout of the LM7805 regulator*'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Connect the output pin of the LM7805 to the red positive rail of the breadboard.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Connect the input pin of the LM317 to the input pin of the LM7805\. This is
    the point at which the input voltage from the power source will be connected.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Connect the ground pin of the LM7805 to the blue negative rail of the breadboard.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Insert a 6.8-kilohm resistor, and connect one side to the blue negative rail.
    This is resistor R3; the other side will connect to resistor R2\. See [Figure
    3-5](ch03.xhtml#ch03fig5) for a top view of the breadboard.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Insert a 10-kilohm resistor (R2) into the breadboard with one side connected
    to the LM317 output pin and the other side connected to resistor R3 from step
    15.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Connect resistor R1 from step 8 from the output pin of the LM317 to a blank
    hole in the breadboard. This row will be the output of the regulator.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Connect the voltage divider: first, insert a 10-kilohm resistor (R4) into the
    breadboard. Then, connect one side of resistor R4 to the same row as R1 (you’ll
    have to use a jumper wire) and the other side to an empty row on the breadboard.'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Insert a 6.8-kilohm resistor (R5) into the board with one side connected to
    the open side of R4 and the other side of R5 connected to the blue negative rail.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Insert the Arduino Pro Mini in the breadboard so that it straddles the center
    break, as shown in [Figures 3-4](ch03.xhtml#ch03fig4) and [3-5](ch03.xhtml#ch03fig5).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Use a jumper to connect the VCC terminal of the Pro Mini to the red positive
    rail.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Use a jumper to connect the GND pins of the Arduino Pro Mini to the blue negative
    rail. (There are at least two to choose from—one is located between RST and D2,
    and the other is located between RAW and RST on the other side. Take your pick.)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Use a jumper wire to connect the joining point of R4 and R5 to pins A1 and A0
    on the Arduino Pro Mini.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Find the junction point of R2 and R3, and use a jumper to connect that junction
    point to the A2 terminal on the Arduino Pro Mini.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Load the sketch onto the Arduino Pro Mini. (I often remove the Pro Mini from
    the circuit completely to program it. It’s a little less confusing.)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Connect the LCD/I²C display by connecting VCC and GND to the red positive and
    blue negative rails on the breadboard, respectively.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Connect the SDA to analog pin A4 on the Arduino Pro Mini and SCL to analog pin
    A5.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Connect the input of the LM7805 voltage regulator to some pin where the +12V
    will be attached.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Connect the output of the LM7805 to the red positive rail, and connect the ground
    to the blue negative rail.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Once all of those connections are in place, you’re set to go. Upload the sketch
    and test the circuit.
  prefs: []
  type: TYPE_NORMAL
- en: '**The Sketch**'
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: The Regulated Power Supply sketch is about as simple as I could make it. The
    only difficulty is that although I use 1% tolerance resistors throughout, I’ve
    found some variation in resistance value. So be aware that you may need to make
    an adjustment to the sketch to accommodate for this.
  prefs: []
  type: TYPE_NORMAL
- en: 'Here is the sketch:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: 'First, this sketch imports some libraries and sets up the LCD (see “[On Writing
    Code to Set Up LCDs](ch01.xhtml#ch01box1)” on [page 36](ch01.xhtml#page_36)).
    It then defines a series of variables, all floats, to use when setting the voltage,
    reading from the analog pins, calculating values to display on the LCD, and so
    on. The `setup()` loop is very short: it has only two lines for initializing the
    LCD. The main `loop()` reads the battery voltage and current, and performs the
    necessary calculations to display on the LCD. The `volt_disp` value is the voltage
    to be displayed on the LCD.'
  prefs: []
  type: TYPE_NORMAL
- en: '**The Shield**'
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: While the circuitry is not overly complex, using a shield will simplify many
    of the connections for driving the LCD and constructing the voltage dividers,
    and it will make the assembly of the Regulated Power Supply easier than point-to-point
    wiring. [Figure 3-8](ch03.xhtml#ch03fig8) shows the shield I designed, though
    you could also design your own, of course. The PCB file is available at *[https://www.nostarch.com/arduinoplayground/](https://www.nostarch.com/arduinoplayground/)*.
  prefs: []
  type: TYPE_NORMAL
- en: While I used two layers to construct the shield, with a little effort and a
    slightly larger board, the circuitry could be accommodated on a single layer.
  prefs: []
  type: TYPE_NORMAL
- en: '![image](../images/f03-08.jpg)'
  prefs: []
  type: TYPE_IMG
- en: '*Figure 3-8: The PCB shield used in the Regulated Power Supply. Black is the
    top layer, dark gray is the bottom layer, and light gray is the silkscreen layer*.'
  prefs: []
  type: TYPE_NORMAL
- en: 'The shield doesn’t need to be populated in any particular sequence, but some
    components will be easier to fit before others. I suggest soldering in this order:'
  prefs: []
  type: TYPE_NORMAL
- en: First, insert 2.2-ohm, 5 W resistors R1 and R9 into the PCB. These are voltage-dropping
    resistors that create the voltage for the ammeter (mA), which provide a total
    resistance (R1 in the schematic) of 1.1 ohms at 10 W. The resistors are a little
    longer than the configuration on the board, so you’ll have to bend the leads to
    make them fit. When the Regulated Power Supply is running close to its maximum
    rating, expect these resistors—and the LM317 itself—to get a little warm.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Capacitor C1, a 68 μF tantalum capacitor, will be a tight fit for the holes.
    To make sure it doesn’t interfere with the LM317, install the capacitor first.
    Then, install the LM317, making sure to leave room for the heat sink. Remember
    that the heat sink is likely to get pretty warm.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Make sure to install the LM317 with the pins correctly oriented according to
    the pinout in [Figure 3-6](ch03.xhtml#ch03fig6) and the schematic in [Figure 3-4](ch03.xhtml#ch03fig4).
    If you use the provided shield files, the thick line on the LM317 silkscreen corresponds
    to the metal tab on the IC. If you insert the part the wrong way, the system won’t
    work, and the part could burn out. It would also be a pain to remove.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Install the LM7805 regulator in the upper-right section of the PCB, and make
    sure it matches the pinout in [Figure 3-7](ch03.xhtml#ch03fig7) and the schematic
    in [Figure 3-4](ch03.xhtml#ch03fig4). You can use the heavy line in the silkscreen
    image of the PCB as a guide.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Try both voltage regulator ICs in the shield with the heat sinks installed
    (at least temporarily) to make sure they can fit without touching any active components.
    Remember that the heat sinks are active: the heat sink (tab) of the LM7805 is
    at ground potential, and the heat sink (tab) of the LM317 is at the output potential.'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Install resistors R2, R3, R4, and R5\. It’s easier to place those before installing
    the female headers for the Arduino Pro Mini.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Then, solder in C1, C2, and the wires that will connect the Arduino Pro Mini
    to potentiometer R6, which you will mount on the chassis. You can leave the wires
    a little long and trim them when you install the shield in the enclosure. Install
    capacitors C4 and C5 as indicated in the schematic in [Figure 3-4](ch03.xhtml#ch03fig4).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Next, solder the female headers that comprise the mount for the Pro Mini and
    the connector for the LCD. The LCD connections are the SDA, SCL, −, and + connections
    in the bottom right of the PCB. I used male stakes and a female-to-female connector
    cable to connect from the LCD to the shield. (To learn how to make the custom
    connector, see “[Connectors Used in This Book](ch00.xhtml#ch00lev1sec6)” on [page
    18](ch00.xhtml#page_18).)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: For the LCD and Arduino Pro Mini, I usually insert the headers into the board,
    solder just one pin, and then, with my finger on the top, heat that one pin and
    push on the connector to make sure it fits flush against the board. For the pins
    of the Pro Mini, I use only female headers for those that are active—that is,
    that have copper traces going to them. I also like to place one pin (I usually
    use a 1×4 pin header) right at the last pin on the Pro Mini to make alignment
    easy. This would translate to pins RAW, GND, RST, and VCC. In addition, I like
    to place at least two headers diagonally for mechanical stability. This would
    correspond to pins D8 and D9 on the Pro Mini. The male headers on the Pro Mini
    for A4 and A5 are located just above pins A2, A3, and VCC on the main row of connections.
  prefs: []
  type: TYPE_NORMAL
- en: '**Construction**'
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: When the Regulated Power Supply is all soldered together, you will need to prepare
    an enclosure and mount the circuit inside. I selected a nice-looking, powder-coated
    metal enclosure, approximately 2 1/4 × 3 1/4 × 4 3/4 inches. [Figure 3-9](ch03.xhtml#ch03fig9)
    shows the completed unit driving a couple of incandescent panel lamps.
  prefs: []
  type: TYPE_NORMAL
- en: '![image](../images/f03-09.jpg)'
  prefs: []
  type: TYPE_IMG
- en: '*Figure 3-9: The completed Regulated Power Supply*'
  prefs: []
  type: TYPE_NORMAL
- en: Bear in mind, though, that while the case is not delicate, the paint is easy
    to scratch, so be careful. It’s also a little pricey—coming in around $20—but
    as I will have it on my workbench all the time, I thought it was worth it. Of
    course, you could also use a different enclosure of your choosing and modify the
    templates provided with this book accordingly.
  prefs: []
  type: TYPE_NORMAL
- en: '***Preparing the Enclosure***'
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: If the front panel of the enclosure is sloped, you will need to put a piece
    of scrap wood behind the areas you need to center punch and drill to help hold
    it in place. Make sure to measure, center punch, and drill holes carefully.
  prefs: []
  type: TYPE_NORMAL
- en: The templates for this project are shown in [Figures 3-10](ch03.xhtml#ch03fig10)
    and [3-11](ch03.xhtml#ch03fig11), and they can be downloaded from *[https://www.nostarch.com/arduinoplayground/](https://www.nostarch.com/arduinoplayground/)*.
  prefs: []
  type: TYPE_NORMAL
- en: '![image](../images/f03-10.jpg)'
  prefs: []
  type: TYPE_IMG
- en: '*Figure 3-10: Sloping face of the Regulated Power Supply enclosure*'
  prefs: []
  type: TYPE_NORMAL
- en: '![image](../images/f03-11.jpg)'
  prefs: []
  type: TYPE_IMG
- en: '*Figure 3-11: Front and bottom of the Regulated Power Supply enclosure*'
  prefs: []
  type: TYPE_NORMAL
- en: 'Here is how I suggest you prepare the enclosure:'
  prefs: []
  type: TYPE_NORMAL
- en: Center punch and drill holes for the potentiometer, on-off switch (1/4 inches),
    and power indicator LED. See [Figure 3-10](ch03.xhtml#ch03fig10) for the front
    panel dimensions.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Center punch and drill the hole for the power input jack in the rear of the
    panel (see [Figure 3-10](ch03.xhtml#ch03fig10)).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Drill holes for the output binders and 3.5 mm jack on the front of the case,
    as shown in [Figure 3-11](ch03.xhtml#ch03fig11).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Carefully measure and mark the cutout for the LCD, as shown in [Figure 3-10](ch03.xhtml#ch03fig10).
    Center punch and drill 1/2-inch holes in the corners of the LCD screen area to
    help initiate saw cutting. You can eyeball this based on the diagram in [Figure
    3-10](ch03.xhtml#ch03fig10) or download a PDF file of the template. Either trace
    the image onto your enclosure with carbon paper or simply mark the corners with
    a center punch and connect the punch marks.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Carefully cut out a hole for the LCD. There are a variety of tools you can use
    to do this. I first drilled holes A and B and then used a keyhole saw with a fine
    hacksaw blade (available at local hardware stores) to cut between the holes. Remember
    that the cutting occurs on the outward thrust, so you needn’t keep pressure on
    the blade on the return stroke. You can clean up the burrs with a file.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Carefully fit the display into the window, and file where necessary to get a
    secure fit. The backlight protrudes on one side of the display, so in order to
    avoid crushing the backlight, you can use nuts as spacers to keep it separated
    from the panel.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Drill holes F, G, H, and I, and fasten the display in place. As you do so, check
    carefully that the spacer nuts are wide enough (4-40 nuts come in different dimensions),
    and, if necessary, use two nuts or a nut and a washer to space out for the backlight.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '***Mounting the Circuit Board***'
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: Once you have assembled and tested the shield and mounted the LCD, install the
    potentiometer, on-off switch, LED, and power jack. Then it’s time to mount the
    shield in the enclosure. Originally, I drilled four holes in the board so that
    I could screw it into the enclosure, but I’ve found that 3M double-sided mounting
    tape also does the trick. I mounted the entire board, heat sinks and all, with
    a 1 1/4-inch length of the 3/4-inch wide double-sided adhesive. (The manufacturer
    claims it will hold 2 pounds.)
  prefs: []
  type: TYPE_NORMAL
- en: The adhesive is relatively aggressive, so before applying it, make sure you
    plan carefully where you want to mount the board so it will not be in the way
    of other components. I mounted the board upside down on the top section of the
    case so all components and connections were on the same platform (see [Figure
    3-12](ch03.xhtml#ch03fig12)).
  prefs: []
  type: TYPE_NORMAL
- en: '![image](../images/f03-12.jpg)'
  prefs: []
  type: TYPE_IMG
- en: '*Figure 3-12: The completed (upside-down) assembly with the board, LCD, output
    connectors, potentiometer, on-off switch, LED, and output power jack all mounted
    on the inside of the top of the enclosure*.'
  prefs: []
  type: TYPE_NORMAL
- en: The final step is to connect the on-off switch, LED pilot lamp, LED current-limiting
    resistor, potentiometer, power input jack, and output connectors to the PCB according
    to the project schematic. I used 28-gauge hookup wire to tie everything. The two
    binding posts/banana plug jacks and the 3.5 mm jacks are wired in parallel. [Figure
    3-12](ch03.xhtml#ch03fig12) illustrates how I mounted the shield. Note that I
    used small wire ties, which are optional, to keep the wires neat.
  prefs: []
  type: TYPE_NORMAL
- en: Before closing up the enclosure, make sure there are no areas that might result
    in a short circuit. For example, I placed a small piece of insulating tape between
    the LCD screen and the shield. They might not be touching at the time of assembly
    but could touch when you close the enclosure. You can apply insulating tape to
    prevent this kind of short.
  prefs: []
  type: TYPE_NORMAL
- en: After testing for short circuits, all that remains is to put the two halves
    of the case together. The connections for the output—the binding terminal/banana
    jack and 3.5 mm jack—are in parallel. The final step is to screw the two pieces
    together, and you’re off and running. I put a pointer knob on the potentiometer
    even though there are no markings on the case. You can add a dial if you want,
    but I find the digital readout sufficient.
  prefs: []
  type: TYPE_NORMAL
- en: 'And, the coup de grâce: remove the protective paper from the adhesive on some
    rubber feet, and install them on the bottom of the enclosure. Voilà!'
  prefs: []
  type: TYPE_NORMAL
- en: The full Regulated Power Supply project will take up a decent amount of space
    on your workbench, but you will find the digital readout and banana jacks invaluable.
    If you’re feeling adventurous, however, you can build a smaller version of the
    same circuit, minus the jacks and LCD, shown in [Figure 3-13](ch03.xhtml#ch03fig13).
  prefs: []
  type: TYPE_NORMAL
- en: '![image](../images/f03-13.jpg)'
  prefs: []
  type: TYPE_IMG
- en: '*Figure 3-13: This is the quick-and-dirty power supply with the top off. I
    made it before biting the bullet and making the full-fledged Regulated Power Supply*.'
  prefs: []
  type: TYPE_NORMAL
- en: You can find instructions on how to build the Mini Regulated Power Supply at
    *[https://www.nostarch.com/arduinoplayground/](https://www.nostarch.com/arduinoplayground/)*.
  prefs: []
  type: TYPE_NORMAL
