<html><head></head><body><div id="sbo-rt-content"><section>
<header>
<h1 class="chapter">
<span class="ChapterNumber"><span epub:type="pagebreak" title="105" id="Page_105"/>6</span><br/>
<span class="ChapterTitle">Network Communications</span></h1>
</header><figure class="opener">
<img src="Images/chapterart.png" alt="" width="206" height="206"/>
</figure>
<h2 id="h1-501645c06-0001" class="HeadProject"><span><span epub:type="pagebreak" title="106" id="Page_106"/>Sketch 48: Opening a Web Page</span></h2>
<p class="BodyFirst">A web page is really just a text file containing the description of that page in enough detail to draw it on the screen. A program called a <span class="KeyTerm">browser</span> reads and renders that file into a viewable page. The file itself resides on a computer somewhere on the internet, and in order to display it, we must first upload it to the user’s computer. The browser arranges for this to be done, but the file must have a unique name that identifies it—unique in the <em>whole world</em>, because the internet is a planetwide network. This unique name is called the <span class="KeyTerm">Uniform</span> (or <span class="KeyTerm">Universal</span>) <span class="KeyTerm">Resource Locator</span>, shortened to <span class="KeyTerm">URL</span>. Most people know this by the term <span class="KeyTerm">web address</span>, and an example is <a href="https://www.microsoft.com" class="LinkURL">https://www.microsoft.com</a>.</p>
<p>The URL contains the directions for how to find the web page, and it is the equivalent of a filename. Displaying the page is a complex operation, and browsers are very complicated software systems. </p>
<p>Processing opens and displays web pages using a function named <code>link()</code>, which accepts a URL as a parameter. This function passes the URL to the default browser on your computer, which opens and displays the page. So the following call will open the Microsoft page in a browser:</p>
<pre><code>link ("https://www.microsoft.com"); </code></pre>
<p class="BodyContinued">If the browser is already open, it may open a new tab.</p>
<h3 id="h2-501645c06-0001">Example A</h3>
<p class="BodyFirst">This sketch opens the Microsoft page as previously described <span class="CodeAnnotation" aria-label="annotation1">1</span>. It does so when a mouse button is pressed while the cursor is within the display window.</p>
<h3 id="h2-501645c06-0002">Example B </h3>
<p class="BodyFirst">This sketch is a combination of Example A and Sketch 37. The user types a URL, and the sketch builds a string from the characters being typed. When the user types <span class="KeyCaps">ENTER</span>, the sketch passes the URL to <code>link()</code>, and the browser will open and display the corresponding page.</p>
<p>When the user types a character, it is usually placed in the variable <code>key</code>, then added to the string. However, some keys do not produce characters, such as the arrow keys, or <span class="KeyCaps">shift</span>. In Processing, uppercase characters involve two key presses: the <span class="KeyCaps">SHIFT</span> key and the character. The Processing system refers to these as <span class="KeyTerm">coded</span> keys and treats them differently. If the <code>key</code> variable has the value <code>CODED</code>, then the key pressed was one of these special ones, and the <code>keyCode</code> variable indicates what key was pressed <span class="CodeAnnotation" aria-label="annotation1">1</span>. The value <code>UP</code>, for example, indicates that the up-arrow key was pressed.</p>
<p>In this sketch, we’ll ignore all coded keys, because the <span class="KeyCaps">shift</span> key is needed to send uppercase letters and some punctuation (like the colon, “:”), but it should not be thought of as a key press. The <code>keyPressed()</code> function ignores coded keys using the following code:</p>
<pre><code>if (key == CODED) return;</code></pre>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="boxcustom1">
<p class="BoxCodeLabel">Example A</p>
<pre><code>void setup ()
{ 
  size (200, 200);
}
  
void draw () 
{ 
  rect(20, 20, 60, 60); 
} 

void mousePressed () 
{ 
<span class="CodeAnnotationCode" aria-label="annotation1">1</span> link ("https://www.microsoft.com"); 
}</code></pre>
<p class="BoxCodeLabel">Example B</p>
<pre><code>String url = "";

void setup ()
{ 
  size (240, 200);
}
  
void draw ()
{
  background (200, 200, 200);
  fill(0);
  text (url, 20, height-20);
}

void keyPressed ()
{
  fill(0);
  <span class="CodeAnnotationHang" aria-label="annotation1">1</span> if (key == CODED) return;
//  if (keyCode==SHIFT) return;
  if (url.length()&gt;0 &amp;&amp; key==BACKSPACE)
    url = url.substring (0, url.length()-1);
  else if(key==ENTER || key==RETURN)
    link (url); 
  else
    url = url + key;
}</code></pre>
<span epub:type="pagebreak" title="107" id="Page_107"/><figure class="graphic"><img src="Images/g048001.png" alt="g048001" width="508" height="404"/></figure>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<h2 id="h1-501645c06-0002" class="HeadProject"><span><span epub:type="pagebreak" title="108" id="Page_108"/>Sketch 49: Loading Images from a Web Page</span></h2>
<p class="BodyFirst">Since a web page is really just a text file, as you saw in Sketch 48, it should be possible to read that file and see what is inside. For example, it should be possible to identify any sound files (for example, MP3s) accessed by the page, or which images (.<em>jpg</em>, <em>.gif</em>, <em>.png</em>, and so on) will be a part of the page. This sketch will locate image files referenced in a web page and display them in the display window.</p>
<p>The first thing to do is to read the page. It contains <span class="KeyTerm">HTML</span>, a language for describing the document, and reading it turns out to be easy: Processing allows URLs to be used just like filenames in the <code>loadStrings()</code> function. You can read the Mink Hollow Media web page as a text file by directly passing the URL to <code>loadStrings()</code>:</p>
<pre><code>String webin[] = loadStrings("https://minkhollowmedia.ca");</code></pre>
<p>Or, as is done in this sketch, <code>loadStrings(url+"/"+file)</code>, where <code>url</code> is the web address and <code>file</code> is the name of the file that we want <span class="CodeAnnotation" aria-label="annotation1">1</span>. At this point, the web page is available as a collection of strings in the array <code>webin</code>, one per line in the file. </p>
<p>HTML uses what is called an <code>img</code> tag to display images in a page:</p>
<pre><code>&lt;img src="imagename.jpg"&gt;</code></pre>
<p>The filename of an image follows the text <code>src="</code>, so the sketch should look for this sequence of characters within the strings in <code>webin</code>. If found, the following characters, up to the closing quote character (<code>"</code>), are the filename. We can locate a string within another string using the <code>indexOf()</code> function <span class="CodeAnnotation" aria-label="annotation2">2</span>:</p>
<pre><code>i = s.indexOf ("src=", j);</code></pre>
<p>In this example, <code>indexOf()</code> searches the string <code>s</code> for the string <code>"src="</code>, starting at the character index <code>j</code>. It returns the index of the location where the string was found, or −1 if it was not found. If the string is found, we call the <code>getName()</code> function <span class="CodeAnnotation" aria-label="annotation3">3</span> to extract the filename itself from the string. The <code>getName()</code> function reads and saves characters until it encounters the terminal double quote and returns the filename as a string <span class="CodeAnnotation" aria-label="annotation4">4</span>. This string is used as a filename for <code>loadImage()</code>, and if an image with that name can be loaded, then it is displayed. </p>
<p>There are many legal ways to specify a filename, and the code here also tries one other: it will take the URL and add a slash (<code>/</code>) and the filename <span class="CodeAnnotation" aria-label="annotation1">1</span> to see if that works. Some images will not be located using this method, and some files that are not images (like JavaScript, video, and audio) can be extracted. They will fail to display as images, and error messages will appear in the console.</p>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="note">
<h2><span class="NoteHead">NOTE</span></h2>
<p>	You could save the extracted images as files by simply calling <code>save(</code><code>)</code> when the image is successfully loaded. The act of extracting information from a web page using a program is called <span class="KeyTerm">scraping</span>.</p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="boxcustom1">

<pre><code>String [] webIn;
String url = "https://minkhollowmedia.ca/41-2/games";
String file = "",  name="",  s="";
int index = 0, i=0;
PImage next;

void setup ()
{
  size (400, 400);
  <span class="CodeAnnotationHang" aria-label="annotation1">1</span> webIn = loadStrings(url+"/"+file);
  fill (0);
}

void draw ()
{
  background (200);
  if (next != null) image (next, 0, 0);
  index = index + 1;
  if (index&gt;=webIn.length) 
  {
    text ("DONE", 10, 370);
    return;
  }
  text (webIn[index], 10, 370);
  s = webIn[index].toLowerCase();
  <span class="CodeAnnotationHang" aria-label="annotation2">2</span> i = s.indexOf ("src=", i);
  if (i&lt;0) return;
  s = webIn[index];
  <span class="CodeAnnotationHang" aria-label="annotation3">3</span> name = getName(s.substring(i+4));
  if (name == null) return;
  if (name.charAt(0) != '/') next = loadImage (url+"/"+name);
  if (next == null) next = loadImage (name);
}
  
String getName (String s)
{
  int i=1;
  if (s.charAt(0) != '"') return null;
  while (i&lt;s.length())
  {
    <span class="CodeAnnotationHang" aria-label="annotation4">4</span> if (s.charAt(i) == '"') return s.substring(1, i);
    i = i + 1;
  }
  return null;
}</code></pre>
<span epub:type="pagebreak" title="109" id="Page_109"/><figure class="graphic"><img src="Images/g049001.png" alt="g049001" width="340" height="645"/></figure>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<h2 id="h1-501645c06-0003" class="HeadProject"><span><span epub:type="pagebreak" title="110" id="Page_110"/>Sketch 50: Client/Server Communication </span></h2>
<p class="BodyFirst">A lot of computer network communication is based on what is called a <span class="KeyTerm">client/server</span> model. It could just as easily be called a <span class="KeyTerm">listener/speaker</span> or <span class="KeyTerm">receiver/sender</span> model because it amounts to having one computer or process sending information across a network (the <span class="KeyTerm">server</span>) and another computer, or many other computers, receiving that data (the <span class="KeyTerm">clients</span>).</p>
<p>Here’s how client/server software should work. A server first announces to the world that it is active and sending data. It must have an address that can be used to identify it uniquely, and it must start sending data (bytes, for example). A client identifies a server that it wishes to collect data from by using the server’s address. If the address represents an active server, the client starts to read data from the server. The server must indicate when new data is available, and if data is requested and none has yet been sent, the client waits until data is present.</p>
<p>This example has a server sending character data and a client receiving and displaying the data, implemented as two different sketches. The server sends the message “This is a message from J Parker” repeatedly; the client reads characters from the server, constructs a string from them, and displays this string in the display window.</p>
<p>Processing does not have a native ability to build client/server systems, but a library exists that enables it. Processing uses external libraries for many things, including video, audio, and various specific interfaces. For this example, we need to import the Network library at the beginning of both the client and server sketches <span class="CodeAnnotation" aria-label="annotation1">1</span>, using this line:</p>
<pre><code>import processing.net.*; </code></pre>
<p>In the server code, the first step is to create a <code>Server</code> (part of the Network library) and assign it to the variable named <code>sender</code>, and then specify the port (in this case, port 5000), which is simply a number. A <span class="KeyTerm">port</span> is like a television channel, used to send or receive data, and all that matters here is that no other software is using this port. The server sends characters one at a time from a string to the outside world through the port by calling the <code>write</code> function <span class="CodeAnnotation" aria-label="annotation2">2</span>:</p>
<pre><code>sender = new Server(this, 5000);
<var>--snip--</var>
sender.write(nextChar);</code></pre>
<p class="BodyContinued"><code>nextChar</code> is a character from the message.</p>
<p>The client sketch first tries to connect to the server. The client must know the <span class="KeyTerm">IP address</span> of the server, which is its unique identifier (<code>***.***.***.***</code> in this case). The client connects to the server through the constructor using the same port <span class="CodeAnnotation" aria-label="annotation3">3</span>:</p>
<pre><code>me  = new Client(this, "***.***.***.***", 5000);</code></pre>
<p>The client reads characters, one at a time, using the <code>readChar()</code> function <span class="CodeAnnotation" aria-label="annotation4">4</span>:</p>
<pre><code>nextChar = (char)me.readChar ();</code></pre>
<p>In this example, you have to start the server first and find out its IP address. You can use the <code>ipconfig</code> program on the computer where you are running the server sketch to find the IP address. Then you can start the client on some other computer on your network. </p>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="note">
<h2><span class="NoteHead">Note</span></h2>
<p>	The address ***.***.***.*** was used to avoid publishing a real address.</p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="boxcustom1">
<p class="BoxCodeLabel">Server</p>
<pre><code><span class="CodeAnnotationHang" aria-label="annotation1">1</span> import processing.net.*;
Server sender;
int ind = 0;
char nextChar;
String message = "This is a message from J Parker ";

void setup () 
{
  size(200, 100);
  <span class="CodeAnnotationHang" aria-label="annotation2">2</span> sender = new Server(this, 5000);   // Create server
}

void draw () 
{
  background(200);
  if (ind &gt;= message.length()) ind = 0;
  nextChar = message.charAt(ind);
  sender.write(nextChar);
  text ("IP address: "+sender.ip(), 30, 40);
  ind = ind + 1;
}</code></pre>
<p class="BoxCodeLabel">Client</p>
<pre><code><span class="CodeAnnotationHang" aria-label="annotation1">1</span> import processing.net.*; 
Client me;  
char nextChar = ' ';
String message = "";

void setup () 
{ 
  size(200, 200); 
  <span class="CodeAnnotationHang" aria-label="annotation3">3</span> me = new Client(this,"***.***.***.***", 
                 5000); 
  fill (20);
  frameRate (10);
} 
 
void draw () 
{ 
  if (me.available() &gt; 0) 
  { 
    background(50, 250, 50);
    text ("IP address: "+me.ip(), 30, 40);
    <span class="CodeAnnotationHang" aria-label="annotation4">4</span> nextChar = (char)me.readChar ();
    message = message + nextChar;
    if (message.length() &gt; 20) 
      message = message.substring(1,message.length());
    text (message, 10, 100);
  } else 
  {
    background (200, 30, 10);
    text ("No server at port 5000.", 10, 20);
  }
}</code></pre>

<span epub:type="pagebreak" title="111" id="Page_111"/><figure class="graphic"><img src="Images/g050001.png" alt="g050001" width="480" height="251"/></figure>
<div class="bottom hr"><hr/></div>
</section>
</aside>
</section>
</div></body></html>