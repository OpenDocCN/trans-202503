<html><head></head><body>
<h2 class="h2" id="ch08"><span epub:type="pagebreak" id="page_141"/><strong><span class="big">8</span><br/>VIRTUAL SHADES: DRAWING AND DRAGGING IMAGES</strong></h2>
<div class="imagel"><img alt="Image" src="../images/common.jpg"/></div>
<p class="noindent">For the “Fruit Loot” and “Tic Tac Toe” games in <a href="ch03.xhtml#ch03">Chapters 3</a> and <a href="ch06.xhtml#ch06">6</a>, you animated the <span class="literal">Canvas</span> and <span class="literal">ImageSprite</span> components from App Inventor’s Drawing and Animation drawer by programming <span class="literal">EdgeReached</span>, <span class="literal">TouchDown</span>, and other event handlers.</p>
<p class="indent">In this chapter, we’ll program <span class="literal">Canvas</span> and <span class="literal">ImageSprite</span> moving, drawing, and dragging methods and event handlers to create an app that lets users draw, type, and drag images across a smartphone or tablet screen. Developers use similar functions to build apps that allow users to move elements, take handwritten notes, and doodle on the screen.</p>
<h3 class="h3" id="ch00lev1sec52"><strong>BUILDING THE “VIRTUAL SHADES” APP</strong></h3>
<p class="noindent">The “Virtual Shades” app lets users take pictures of themselves with their cameras and then drag images of sunglasses over their selfies to try them on virtually. As you build the app, you’ll learn to use the <span class="literal">Camera</span> to create the <span epub:type="pagebreak" id="page_142"/><span class="literal">Canvas</span> background, the <span class="literal">Slider</span> to adjust other components, and the <span class="literal">Notifier</span> to collect user input. You’ll also practice using many programming concepts you’ve already learned.</p>
<p class="indent">To get started, log in to App Inventor and create a new project named <span class="codestrong">VirtualShades</span>.</p>
<h4 class="h4" id="ch00lev2sec53"><strong>DECOMPOSING “VIRTUAL SHADES”</strong></h4>
<p class="noindent">For this app, users should be able to take a picture that becomes the <span class="literal">Canvas</span> background, drag various pairs of sunglasses over the picture, and change the size of the sunglasses to get the right fit. They also should be able to doodle and add text to the photo; save it as a graphic that they can view, email, or text later; and erase the sunglasses as well as all drawing and text at any time.</p>
<p class="indent">We can break this action into eight steps:</p>
<ol>
<li><p class="noindent">When the user clicks the picture button, open the device’s camera. Set the picture the user takes as the <span class="literal">Canvas</span> background.</p></li>
<li><p class="noindent">When the user clicks the <span class="literal">ListPicker</span>, show the list of available sunglasses.</p></li>
<li><p class="noindent">After the user selects a pair of sunglasses, display them on the <span class="literal">Canvas</span>.</p></li>
<li><p class="noindent">When the user drags the sunglasses around the <span class="literal">Canvas</span>, move them where the user drags. When the user moves the <span class="literal">Slider</span>’s thumb, adjust the size of the sunglasses.</p></li>
<li><p class="noindent">When the user clicks the draw button, show a <span class="literal">Notifier</span> alert letting the user know where to draw. When the user drags a finger around the <span class="literal">Canvas</span>, draw on the <span class="literal">Canvas</span> where the user drags.</p></li>
<li><p class="noindent">When the user clicks the type button, show a <span class="literal">Notifier</span> with a text box where the user can enter text. After the user submits the text, display it at the bottom of the <span class="literal">Canvas</span>.</p></li>
<li><p class="noindent">After the user clicks the save button, store a picture of the <span class="literal">Canvas</span> on the device, and show a <span class="literal">Notifier</span> alert letting the user know the storage location.</p></li>
<li><p class="noindent">When the user clicks the trash button, erase all sunglasses, marks, and typing from the <span class="literal">Canvas</span>.</p></li>
</ol>
<p class="indent">You’ll need the following components:</p>
<ul>
<li><p class="noindent"><span class="codestrong">Button</span> (5) for the user to click to open the camera, draw, type, save, and erase the <span class="literal">Canvas</span></p></li>
<li><p class="noindent"><span class="codestrong">Camera</span> to open the device’s camera</p></li>
<li><p class="noindent"><span class="codestrong">Canvas</span> to enable dragging and drawing</p></li>
<li><p class="noindent"><span class="codestrong">HorizontalArrangement</span> (2) to hold the <span class="literal">Label</span>, <span class="literal">Slider</span>, and <span class="literal">Button</span>s</p></li>
<li><p class="noindent"><span class="codestrong">ImageSprite</span> (4) for the user to drag around the <span class="literal">Canvas</span></p></li>
<li><p class="noindent"><span class="codestrong">Label</span> to provide <span class="literal">Slider</span> directions</p></li>
<li><p class="noindent"><span class="codestrong">ListPicker</span> for the user to click to choose sunglasses <span class="literal">ImageSprite</span>s</p></li>
<li><p class="noindent"><span class="codestrong">Notifier</span> to show alerts and capture user text input</p></li>
<li><span epub:type="pagebreak" id="page_143"/><p class="noindent">Procedure to clear images from the <span class="literal">Canvas</span> and reset the <span class="literal">Slider</span></p></li>
<li><p class="noindent"><span class="codestrong">Slider</span> for the user to adjust the size of <span class="literal">ImageSprite</span>s</p></li>
<li><p class="noindent">Variable (2) to store the <span class="literal">ImageSprite</span>s and their descriptions</p></li>
<li><p class="noindent"><span class="codestrong">VerticalArrangement</span> to hold all visible components except the picture <span class="literal">Button</span></p></li>
</ul>
<h4 class="h4" id="ch00lev2sec54"><strong>LAYING OUT “VIRTUAL SHADES” IN THE DESIGNER</strong></h4>
<p class="noindent">Now let’s start laying out the app in the Designer by adjusting the app screen.</p>
<h5 class="h5" id="ch00lev3sec95"><strong>Adjusting the Screen</strong></h5>
<p class="noindent">First, change the screen’s horizontal alignment to center all contents. Then, to give users the most space to “try on” sunglasses, make the screen stay in portrait mode even when the user rotates the device. To do this, select <strong>Portrait</strong> under <span class="codestrong">ScreenOrientation</span>. Also, hide the status bar and screen title so they won’t take up space by unclicking the checkboxes under both <span class="codestrong">ShowStatusBar</span> and <span class="codestrong">TitleVisible</span>.</p>
<h5 class="h5" id="ch00lev3sec96"><strong>Adding the Canvas and ImageSprites</strong></h5>
<p class="noindent">Let’s place most of the visible components on the screen in a <span class="literal">VerticalArrangement</span> so that we can set their visibility as a group. When the app opens, only the <span class="literal">Button</span> to take a picture should show; the other components will go in the <span class="literal">VerticalArrangement</span> so we can hide them until later.</p>
<p class="indent">Drag a <span class="codestrong">VerticalArrangement</span> from the Layout drawer onto the Viewer. In the Properties pane, click the drop-down arrow under <span class="codestrong">AlignHorizontal</span> and select <strong>Center: 3</strong>, and set its height and width to <strong>Fill parent</strong> to make it cover the entire screen.</p>
<p class="indent">Now add components to the <span class="literal">VerticalArrangement</span> in the order in which we want them to appear. Start by dragging a <span class="codestrong">Canvas</span> from the Drawing and Animation drawer onto the Viewer inside of <span class="codestrong">VerticalArrangement1</span>. In the Properties pane, remove the <span class="literal">Canvas</span>’s background color by clicking the box under <span class="codestrong">BackgroundColor</span> and selecting <strong>None</strong>. Change its text size to <span class="codestrong">25</span> in the text box under <span class="codestrong">FontSize</span>. Make its height and width <strong>Fill parent</strong>, and increase the width of the line that can be drawn on it to <span class="codestrong">4</span> in the text box under <span class="codestrong">LineWidth</span>. Remove its paint color by clicking the box under <span class="codestrong">PaintColor</span> and selecting <strong>None</strong>. Lastly, left-align its text by clicking the drop-down arrow under <span class="codestrong">TextAlignment</span> and selecting <strong>left: 0</strong>.</p>
<p class="indent">Now, drag four <span class="codestrong">ImageSprite</span>s from the Drawing and Animation drawer onto the <span class="literal">Canvas</span>, click them in the Components pane, and rename them <span class="codestrong">Sunglasses1</span>, <span class="codestrong">Sunglasses2</span>, <span class="codestrong">Sunglasses3</span>, and <span class="codestrong">Sunglasses4</span>. Upload the images <em>tanSunglasses.png</em>, <em>purpleSunglasses.png</em>, <em>redSunglasses.png</em>, and <em>blackSunglasses.png</em>, all of which come with the resources for this book, to the <span class="literal">ImageSprite</span>s by clicking <strong>Picture</strong> in the Properties pane for each. Also, make each <span class="literal">ImageSprite</span> invisible by deselecting the box under <strong>Visible</strong>, and change both the <span class="codestrong">X</span> and <span class="codestrong">Y</span> property for each to <span class="codestrong">0</span> so that they appear at the top left of the <span class="literal">Canvas</span> when they show up in the app.</p>
<h5 class="h5" id="ch00lev3sec97"><span epub:type="pagebreak" id="page_144"/><strong>Adding User Buttons and Controls</strong></h5>
<p class="noindent">Drag a <span class="codestrong">ListPicker</span> from the User Interface drawer into <span class="codestrong">VerticalArrangement1</span> under the <span class="literal">Canvas</span> and make its background color red, its font bold, its height 35 pixels, and its width <strong>Fill parent</strong>. Also, change the default text to <span class="codestrong">Choose Glasses</span> and make the text white.</p>
<p class="indent">Now we’ll add a <span class="literal">Label</span> and <span class="literal">Slider</span>, which we want to position side by side to save space. That means we need to place them within a <span class="literal">HorizontalArrangement</span>. Drag a <span class="codestrong">HorizontalArrangement</span> from the Layout drawer into <span class="codestrong">VerticalArrangement1</span> under the <span class="literal">ListPicker</span> and rename it <span class="codestrong">SliderArrangement</span>. Then, select <strong>Center: 3</strong> under <span class="codestrong">AlignHorizontal</span> and make its width <strong>Fill parent</strong>.</p>
<p class="indent">Drag a <span class="codestrong">Label</span> and a <span class="codestrong">Slider</span> from the User Interface drawer into <span class="codestrong">SliderArrangement</span>, with the <span class="literal">Label</span> on the left. Make the <span class="literal">Label</span>’s font bold, change its default text to <span class="codestrong">Adjust Sunglasses Width:</span>, center-align its text, and make the text red.</p>
<p class="indent">Make <span class="literal">Slider1</span>’s <span class="codestrong">ColorLeft</span> red to match the color scheme and <strong>Width</strong> 40 percent so it will fit next to the <span class="literal">Label</span>. Also, so the user can change the width of the sunglasses from 150 to 250 pixels, make the <span class="literal">Slider</span>’s <span class="codestrong">MaxValue 250</span> and <span class="codestrong">MinValue 150</span>. Then set the <span class="codestrong">ThumbPosition</span> to <span class="codestrong">200</span> so the <span class="literal">Slider</span>’s thumb will sit in the middle of the slider when it appears. Next, disable the <span class="literal">Slider</span>’s thumb by unclicking the checkbox under <span class="codestrong">ThumbEnabled</span>, which will keep the <span class="literal">Slider</span> from moving until we program it to work after a user drags sunglasses onto the <span class="literal">Canvas</span>.</p>
<p class="indent">Now let’s add the <span class="literal">Button</span>s. We’ll place the first four <span class="literal">Button</span>s side by side in a second <span class="literal">HorizontalArrangement</span>, also to save space. Place this <span class="codestrong">HorizontalArrangement</span> under <span class="codestrong">SliderArrangement</span> in <span class="codestrong">VerticalArrangement1</span> and name it <span class="codestrong">ButtonArrangement</span>, center its contents by selecting <strong>Center: 3</strong> under <span class="codestrong">AlignHorizontal</span>, and make its width <strong>Fill parent</strong>.</p>
<p class="indent">Drag four buttons from the User Interface drawer into <span class="codestrong">ButtonArrangement</span> and rename them, from left to right, <span class="codestrong">DrawBtn</span>, <span class="codestrong">TypeBtn</span>, <span class="codestrong">SaveBtn</span>, and <span class="codestrong">TrashBtn</span>. Then, in the Properties pane for each, under <strong>Image</strong>, upload <em>DrawBtn.png</em>, <em>TypeBtn.png</em>, <em>SaveBtn.png</em>, and <em>TrashBtn.png</em>, respectively, all of which come with the resources for this book. Set the height of each <span class="literal">Button</span> to 50 pixels and remove each <span class="literal">Button</span>’s default text from the text box under <strong>Text</strong>. Note that the four buttons may not be fully visible in the Viewer, but you should see them when you test on a device.</p>
<p class="indent">Now that we’ve placed all the components we need inside of <span class="literal">VerticalArrangement1</span>, we need to hide it until after the user takes a picture. To make it invisible, in its Properties pane, unclick the checkbox under <strong>Visible</strong>.</p>
<p class="indent">Finally, add the last <span class="literal">Button</span>, which is the only visible component we’ll place outside of <span class="literal">VerticalArrangement1</span>. Users click this Button to open the camera when they first enter the app. Drag the new <span class="codestrong">Button</span> from the User Interface drawer onto the Viewer, and rename it <span class="codestrong">TakePicBtn</span> in the Components pane. Make its height and width <strong>Fill parent</strong> to cover the entire screen. Next, add a background image to the <span class="literal">Button</span> by clicking the text box under <strong>Image</strong> and uploading <em>TakePictureBtn.png</em>, which comes with the resources for this book. Also remove the <span class="literal">Button</span>’s default text.</p>
<h5 class="h5" id="ch00lev3sec98"><span epub:type="pagebreak" id="page_145"/><strong>Preparing the Non-Visible Components</strong></h5>
<p class="noindent">Now let’s add and adjust the non-visible components. Drag a <span class="codestrong">Camera</span> component from the Media drawer and a <span class="codestrong">Notifier</span> component from the User Interface drawer. Change the <span class="codestrong">Notifier</span>’s <span class="codestrong">BackgroundColor</span> to red.</p>
<p class="indent">At this point, your screen should look like <a href="ch08.xhtml#ch8fig1">Figure 8-1</a>.</p>
<div class="image" id="ch8fig1"><img alt="Image" src="../images/08fig01.jpg"/></div>
<p class="figcap"><em>Figure 8-1: The Viewer, Components, and partial Media panes after you’ve laid out “Virtual Shades”</em></p>
<p class="indent">Now that you’ve laid out all components, move to the Blocks Editor to program the app.</p>
<h3 class="h3" id="ch00lev1sec53"><strong>PROGRAMMING “VIRTUAL SHADES” IN THE BLOCKS EDITOR</strong></h3>
<p class="noindent">For “Virtual Shades,” we’ll create two list variables and a procedure, and we’ll program 15 event handlers with three conditionals and one <span class="literal">for each</span> loop.</p>
<h4 class="h4" id="ch00lev2sec55"><span epub:type="pagebreak" id="page_146"/><strong>STEP 1: SETTING THE SELFIE AS THE CANVAS BACKGROUND</strong></h4>
<p class="noindent">In this step, we want the user to take a photo that will become the <span class="literal">Canvas</span> background for the user to drag and draw on.</p>
<h5 class="h5" id="ch00lev3sec99"><strong>Taking the Photo</strong></h5>
<p class="noindent">We start by having the app open the camera when a user clicks <span class="literal">TakePicBtn</span>. Here is the event handler for this.</p>
<div class="image"><img alt="Image" src="../images/f0146-01.jpg"/></div>
<p class="indent">In the Blocks pane, click <span class="codestrong">TakePicBtn</span> and drag the <span class="codestrong">whenTakePicBtn.Click</span> event handler block <span class="ent">➊</span> to the Viewer. Then, drag <span class="codestrong">Camera1</span>’s <span class="codestrong">callCamera1.TakePicture</span> method call block <span class="ent">➋</span> next to the word <span class="literal">do</span>. When the user clicks <span class="literal">TakePicBtn</span>, these blocks open the camera so the user can take the photo.</p>
<h5 class="h5" id="ch00lev3sec100"><strong>Setting the Canvas Background and Showing App Controls</strong></h5>
<p class="noindent">After the user takes the selfie, we need the picture to become the <span class="literal">Canvas</span> background, <span class="literal">TakePicBtn</span> to disappear, and the <span class="literal">VerticalArrangement</span> that holds the <span class="literal">Canvas</span> and other user interface components to appear. The <span class="literal">Camera</span>’s <span class="literal">AfterPicture</span> event handler programs this action.</p>
<div class="image"><img alt="Image" src="../images/f0146-02.jpg"/></div>
<p class="indent">Drag <span class="codestrong">Camera1</span>’s <span class="codestrong">whenCamera1.AfterPicture</span> event handler block <span class="ent">➊</span> to the Viewer. This event handler reports the value for the <span class="literal">image</span> event parameter, which is the picture taken by the <span class="literal">Camera</span>. We’ll set the <span class="literal">Canvas</span> background to that value.</p>
<p class="indent">Drag <span class="codestrong">Canvas1</span>’s <span class="codestrong">setCanvas1.BackgroundImageto</span> block <span class="ent">➋</span> into the <span class="codestrong">whenCamera1.AfterPicture</span> block. Then mouse over the <span class="codestrong">image</span> event parameter and snap its <span class="codestrong">get image</span> block <span class="ent">➌</span> to the right of the <span class="codestrong">setCanvas1.BackgroundImageto</span> block. These blocks set the user’s picture as the <span class="literal">Canvas</span> background.</p>
<p class="indent">Now, to make <span class="literal">TakePicBtn</span> disappear, drag its <span class="codestrong">setTakePicBtn.Visibleto</span> block <span class="ent">➍</span> into the event handler block and snap in a <span class="codestrong">false</span> block <span class="ent">➎</span>.</p>
<p class="indent">Next, we’ll make the <span class="literal">Canvas</span> and components in the <span class="literal">VerticalArrangement</span> visible so the user can drag and “try on” the sunglasses and draw and type on the <span class="literal">Canvas</span>. Drag <span class="codestrong">VerticalArrangement1</span>’s <span class="codestrong">setVerticalArrangement1.Visibleto</span> block <span class="ent">➏</span> into the event handler and attach a <span class="codestrong">true</span> block to it <span class="ent">➐</span>.</p>
<p class="indent"><span epub:type="pagebreak" id="page_147"/>Put together, the blocks in step 1 open the camera when the user clicks the picture button and, after the user takes a picture, set the <span class="literal">Canvas</span> background to that picture, hide the button by setting its <span class="literal">Visible</span> property to <span class="literal">false</span>, and show the <span class="literal">VerticalArrangement</span> containing the <span class="literal">Canvas</span> and app controls by setting its <span class="literal">Visible</span> property to <span class="literal">true</span>.</p>
<p class="indent">To see how these blocks work, live-test with a device. You should see the full-screen <span class="literal">TakePicBtn</span> when you open the app. When you click it, your camera should open, and the picture you take should become the background of the top portion of your app screen, where you placed the <span class="literal">Canvas</span>. If the picture is rotated the wrong way in the app, close and reopen the app, rotate your camera, and take another photo until it displays the way you want.</p>
<p class="indent">Below the picture, you should see the <span class="literal">ListPicker</span> with the app’s Slider and the draw, type, save, and trash buttons beneath it, but none of these controls should work yet. Leave the app open on your device to keep live-testing.</p>
<h4 class="h4" id="ch00lev2sec56"><strong>STEP 2: ADDING SUNGLASSES TO CHOOSE FROM</strong></h4>
<p class="noindent">Now let’s program step 2 of the app, the <span class="literal">ListPicker</span>’s <span class="literal">BeforePicking</span> event handler, which will set the options for the <span class="literal">ListPicker</span> that the user clicks to select each pair of sunglasses.</p>
<p class="indent">To provide these options, we’ll create a global variable called <span class="literal">glassesDescriptions</span> to hold descriptions of the four pairs of sunglasses. We’ll also create a related global list variable, <span class="literal">glassesSprites</span>, which will hold the <span class="literal">ImageSprite</span>s that display the sunglasses. Creating these as global variables allows us to use them in every event handler and procedure in the app.</p>
<h5 class="h5" id="ch00lev3sec101"><strong>Creating the glassesDescriptions and glassesSprites List Variables</strong></h5>
<p class="noindent">The following blocks create <span class="literal">glassesDescriptions</span>, the variable that holds the options we’ll add to the <span class="literal">ListPicker</span> to describe each pair of sunglasses, and <span class="literal">glassesSprites</span>, the variable that holds the <span class="literal">ImageSprites</span> (<span class="literal">Sunglasses1</span> through <span class="literal">Sunglasses4</span>) that display the corresponding pictures of the sunglasses.</p>
<div class="image"><img alt="Image" src="../images/f0147-01.jpg"/></div>
<p class="indent">To create the variables, drag two <span class="codestrong">initialize global name</span> blocks <span class="ent">➊</span> from the Variables block drawer to the Viewer and name one variable <span class="codestrong">glassesDescriptions</span> and the other <span class="codestrong">glassesSprites</span>. Then attach a <span class="codestrong">make a list</span> block <span class="ent">➋</span> from the Lists drawer to each <span class="codestrong">initialize global</span> block.</p>
<p class="indent"><span epub:type="pagebreak" id="page_148"/>Add two more sockets to each <span class="codestrong">make a list</span> block’s two default inputs by clicking the blue mutator icon to the left of the words <span class="codestrong">make a list</span> and dragging the additional <span class="codestrong">item</span> blocks to the <span class="codestrong">make a list</span> block in the dialog that opens. Finally, for <span class="literal">glassesDescriptions</span>, drag in four empty string blocks <span class="ent">➌</span>, snap them into the sockets of the <span class="codestrong">make a list</span> block, and enter the text shown. For <span class="literal">glassesSprites</span>, click <span class="literal">Sunglasses1</span> through <span class="literal">Sunglasses4</span> in the Blocks pane and drag each <span class="literal">ImageSprite</span>’s getter block <span class="ent">➍</span> into its socket in the <span class="literal">make a list</span> block. These blocks create the two variables so that each item in <span class="literal">glassesSprites</span> corresponds with the item at the same index position in <span class="literal">glassesDescriptions</span>.</p>
<h5 class="h5" id="ch00lev3sec102"><strong>Setting the ListPicker Options</strong></h5>
<p class="noindent">Next, we’ll code the <span class="literal">ListPicker</span>’s <span class="literal">BeforePicker</span> event handler, which sets the <span class="literal">ListPicker</span>’s elements to the items in <span class="literal">glassesDescriptions</span>.</p>
<div class="image"><img alt="Image" src="../images/f0148-01.jpg"/></div>
<p class="indent">To add the blocks, drag <span class="codestrong">ListPicker1</span>’s <span class="codestrong">whenListPicker1.BeforePicking</span> event handler block <span class="ent">➊</span> to the Viewer. Then drag its <span class="codestrong">setListPicker1.Elementsto</span> block <span class="ent">➋</span> inside the event handler block, and snap the <span class="codestrong">get global glassesDescriptions</span> block <span class="ent">➌</span> to the right of the <span class="codestrong">setListPicker1.Elementsto</span> block.</p>
<p class="indent">Live-test the app to see how these blocks work. When you click the <span class="literal">ListPicker</span>, you should see the selection options, which are descriptions of each pair of sunglasses. Nothing should happen yet when you select a pair, except that the <span class="literal">ListPicker</span> should close. Leave the app open on your device to keep live-testing.</p>
<h4 class="h4" id="ch00lev2sec57"><strong>STEP 3: SELECTING A PAIR OF SUNGLASSES TO TRY</strong></h4>
<p class="noindent">Let’s now program the <span class="literal">ListPicker</span>’s <span class="literal">AfterPicking</span> event handler, which tells the app what to do after the user picks a pair of sunglasses. At that point, if there’s already a pair of sunglasses on the <span class="literal">Canvas</span>, the app should remove it and reset the <span class="literal">Slider</span> that adjusts the width of the sunglasses, in case the user previously adjusted it. If, on the other hand, it’s the user’s first pick from the <span class="literal">ListPicker</span>, we want the app to enable the <span class="literal">Slider</span>. Then, we want the app to show the pair of sunglasses the user selected.</p>
<h5 class="h5" id="ch00lev3sec103"><strong>Creating the clearSprite Procedure</strong></h5>
<p class="noindent">To clear an existing <span class="literal">ImageSprite</span> and reset the <span class="literal">Slider</span>, we’ll use a procedure called <span class="literal">clearSprite</span>, which we’ll call in the <span class="literal">ListPicker</span>’s <span class="literal">AfterPicking</span> event handler and later in the handler we’ll create to clear the <span class="literal">Canvas</span>. The <span class="literal">clearSprite</span> procedure uses a conditional block to test whether there’s an image on the <span class="literal">Canvas</span>. If there is, it removes the image and moves the <span class="literal">Slider</span> thumb back to its starting position.</p>
<div class="image"><span epub:type="pagebreak" id="page_149"/><img alt="Image" src="../images/f0149-01.jpg"/></div>
<p class="indent">Click the <strong>Procedures</strong> blocks drawer in the Blocks pane, drag the <span class="codestrong">to procedure do</span> block <span class="ent">➊</span> to the Viewer, and name the procedure <span class="codestrong">clearSprite</span>. Next, we’ll test whether there’s an <span class="literal">ImageSprite</span> on the <span class="literal">Canvas</span> by determining whether the current <span class="literal">ListPicker</span> selection index is <span class="literal">1</span> or greater. Since the four sunglasses <span class="literal">ImageSprite</span>s have the index positions <span class="literal">1</span> through <span class="literal">4</span>, we’ll know by checking the index whether one of them is showing on the <span class="literal">Canvas</span>. If it is, then the app needs to clear it.</p>
<p class="indent">Snap an <span class="codestrong">if then</span> block <span class="ent">➋</span> inside the <span class="codestrong">clearSprite</span> procedure block and a <span class="literal">≥</span> comparison block <span class="ent">➌</span> into the <span class="codestrong">if then</span> block’s <span class="codestrong">if</span> socket. Fill the comparison block’s left operand socket with the <span class="codestrong">ListPicker.SelectionIndex</span> block <span class="ent">➍</span> and its right socket with a <span class="codestrong">1</span> number block <span class="ent">➎</span>. So far, the <span class="literal">if then</span> block sets up the test condition by saying, “If the <span class="literal">ListPicker1</span> selection index is greater than or equal to <span class="literal">1</span>” and the sentence stops there. The next blocks complete the sentence by telling the app what to do if the condition is met.</p>
<h5 class="h5" id="ch00lev3sec104"><strong>Clearing All ImageSprites and Resetting the Slider</strong></h5>
<p class="noindent">If the <span class="literal">ListPicker1</span> selection index is greater than or equal to <span class="literal">1</span>, the following blocks loop through and hide all <span class="literal">ImageSprite</span>s and reset the <span class="literal">Slider</span>.</p>
<div class="image"><img alt="Image" src="../images/f0149-02.jpg"/></div>
<p class="indent">To place the blocks, drag a <span class="codestrong">for each item</span> block <span class="ent">➊</span> inside the <span class="codestrong">if then</span> block’s <span class="codestrong">then</span> socket, and change <span class="codestrong">item</span> to <span class="codestrong">sprite</span>. Then snap a <span class="codestrong">get global glassesSprites</span> block <span class="ent">➋</span> to the right of the <span class="codestrong">for each</span> block next to the word <span class="literal">list</span>. Next, click the plus sign to the left of <strong>Any component</strong> near the bottom of the Blocks pane, click the <strong>Any ImageSprite</strong> drawer, and drag a <span class="codestrong">setImageSprite.Visible</span> block <span class="ent">➌</span> inside the <span class="codestrong">for each</span> block. Fill the setter block’s top socket by mousing over the <span class="codestrong">sprite</span> item and dragging in a <span class="codestrong">get sprite</span> block <span class="ent">➍</span>, and fill its bottom socket with a <span class="codestrong">false</span> block <span class="ent">➎</span>. Now, when the procedure is called, all <span class="literal">ImageSprite</span>s will become invisible.</p>
<p class="indent">Next we’ll add the blocks that reset the <span class="literal">Slider</span>. We need to do this because, later in the code, we’ll program an <span class="literal">ImageSprite</span>’s width to change <span epub:type="pagebreak" id="page_150"/>when a user changes the <span class="literal">Slider</span>’s <span class="literal">ThumbPosition</span>. Just in case the user has changed the <span class="literal">ThumbPosition</span> for one of the <span class="literal">ImageSprite</span>s when it was showing on the <span class="literal">Canvas</span>, the next blocks change the <span class="literal">Slider</span>’s <span class="literal">ThumbPosition</span> and the <span class="literal">ImageSprite</span>’s width back to the <span class="literal">200</span> we set in the Designer.</p>
<p class="indent">Drag <span class="codestrong">Slider1</span>’s <span class="codestrong">setSlider1.ThumbPosition</span> block <span class="ent">➏</span> inside the <span class="codestrong">if then</span> block under the <span class="codestrong">for each</span> block, and snap a <span class="codestrong">200</span> number block <span class="ent">➐</span> to its right. Now, when the procedure is called, these blocks reset the <span class="literal">Slider</span>.</p>
<h5 class="h5" id="ch00lev3sec105"><strong>Calling clearSprite and Enabling the Slider</strong></h5>
<p class="noindent">Now that we’ve created the procedure, let’s build the <span class="literal">AfterPicker</span> event handler.</p>
<div class="image"><img alt="Image" src="../images/f0150-01.jpg"/></div>
<p class="indent">The <span class="literal">AfterPicker</span> event handler will first call the <span class="literal">clearSprite</span> procedure we just created to clear any <span class="literal">ImageSprite</span>s from the screen and reset the <span class="literal">Slider</span>. It will then enable the <span class="literal">Slider</span>, if necessary, and show the selected pair of sunglasses.</p>
<p class="indent">Drag <span class="codestrong">ListPicker1</span>’s <span class="codestrong">whenListPicker1.AfterPicking</span> block <span class="ent">➊</span> to the Viewer. Then, drag the <span class="codestrong">call clearSprite</span> block <span class="ent">➋</span> into the event handler block. These blocks call the <span class="literal">clearSprite</span> procedure after the user selects a pair of sunglasses in the <span class="literal">ListPicker</span>.</p>
<p class="indent">Next, we’ll add the conditional block that lets the app know when to turn on the <span class="literal">Slider</span>, which we turned off in the Designer by unclicking the <span class="literal">ThumbEnabled</span> property. We disabled the thumb so that a user can’t move it before selecting a pair of sunglasses, which would cause an error.</p>
<p class="indent">It’s possible, though, that the user has already enabled the <span class="literal">Slider</span> by previously selecting a pair of sunglasses, so we must check for that. In the Blocks pane, drag an <span class="codestrong">if then</span> block <span class="ent">➌</span> into the event handler under the <span class="codestrong">call clearSprite</span> block. Then, fill the <span class="codestrong">if</span> socket with an <span class="codestrong">=</span> comparison operator block <span class="ent">➍</span>, and fill the operator block’s left operand socket by dragging in <span class="codestrong">Slider1</span>’s <span class="codestrong">Slider1.ThumbEnabled</span> block <span class="ent">➎</span>. Fill its right operand socket with a <span class="codestrong">false</span> block <span class="ent">➏</span>.</p>
<p class="indent">Next, fill the <span class="codestrong">if then</span> block’s <span class="codestrong">then</span> socket with a <span class="codestrong">setSlider1.ThumbEnabled</span> block <span class="ent">➐</span> and drag a <span class="codestrong">true</span> block <span class="ent">➑</span> to its right. Now, after the user selects a pair of sunglasses, this <span class="literal">if then</span> block will enable the <span class="literal">Slider</span>’s thumb <em>only if</em> it’s currently not enabled. Although the app will check this condition each time the user selects a pair of sunglasses, it will enable the <span class="literal">Slider</span>’s thumb only once, after the user’s first selection.</p>
<h5 class="h5" id="ch00lev3sec106"><span epub:type="pagebreak" id="page_151"/><strong>Showing the Selected ImageSprite</strong></h5>
<p class="noindent">Finally, the <span class="literal">AfterPicker</span> event handler will display the selected pair of sunglasses on the <span class="literal">Canvas</span>. When added to the event handler, the following blocks will make this happen.</p>
<div class="image"><img alt="Image" src="../images/f0151-01.jpg"/></div>
<p class="indent">These blocks set the <span class="literal">Visible</span> property of the user’s selected <span class="literal">ImageSprite</span> to <span class="literal">true</span> after they identify the correct <span class="literal">ImageSprite</span> by matching its index position in the <span class="literal">glassesSprites</span> list with the index of the selected <span class="literal">ListPicker1</span> option.</p>
<p class="indent">To place these blocks, click the <strong>Any ImageSprite</strong> drawer and drag a <span class="codestrong">setImageSprite.Visible</span> block <span class="ent">➊</span> inside the event handler block under the <span class="codestrong">if then</span> block. Fill the <span class="codestrong">setImageSprite.Visible</span> block’s top socket with a <span class="codestrong">select list item</span> block <span class="ent">➋</span> from the Lists blocks drawer. Next, fill the <span class="codestrong">select list item</span> block’s list socket with a <span class="codestrong">get global glassesSprites</span> block <span class="ent">➌</span> and its index socket with <span class="codestrong">ListPicker1</span>’s <span class="codestrong">ListPicker1.SelectionIndex</span> block <span class="ent">➍</span>. Now, fill the <span class="codestrong">setImageSprite.Visible</span> block’s bottom socket with a <span class="codestrong">true</span> block <span class="ent">➎</span>.</p>
<p class="indent">That’s it for step 3. After the user selects a pair of sunglasses, the blocks for this step clear any existing <span class="literal">ImageSprite</span> from the <span class="literal">Canvas</span> and reset the <span class="literal">Slider</span>, enable the <span class="literal">Slider</span> if it’s the user’s first time picking from the <span class="literal">ListPicker</span>, and show the selected sunglasses on the <span class="literal">Canvas</span>.</p>
<p class="indent">Let’s live-test the blocks for this step. When you click the <span class="literal">ListPicker</span> and make a selection, the sunglasses you selected should show on the <span class="literal">Canvas</span> after the <span class="literal">ListPicker</span> closes. You won’t be able to move the glasses around on the screen yet—not until we program step 4. Leave the app open on the screen to keep live-testing.</p>
<h4 class="h4" id="ch00lev2sec58"><strong>STEP 4: TRYING ON SUNGLASSES</strong></h4>
<p class="noindent">In this step, we’ll program two event handlers: the <span class="literal">ImageSprite Dragged</span> event handler that moves the sunglasses around the <span class="literal">Canvas</span> when the user drags them and the <span class="literal">Slider PositionChanged</span> event handler that makes the sunglasses bigger or smaller when the user adjusts the <span class="literal">Slider</span>.</p>
<h5 class="h5" id="ch00lev3sec107"><strong>Setting the Sunglasses1 X- and Y-Coordinates After Dragging</strong></h5>
<p class="noindent">We’ll have to program a <span class="literal">Dragged</span> event handler that moves the <span class="literal">ImageSprites</span> when the user drags the sunglasses around the screen. The following blocks move <span class="literal">Sunglasses1</span>.</p>
<p class="indent">Drag <span class="codestrong">Sunglasses1</span>’s <span class="codestrong">whenSunglasses1.Dragged</span> block <span class="ent">➊</span> to the Viewer. Then drag its <span class="codestrong">callSunglasses1.MoveTo</span> block <span class="ent">➋</span> into the event handler block. These blocks call the <span class="literal">MoveTo</span> method to move <span class="literal">Sunglasses1</span> to a given point when a user drags <span class="literal">Sunglasses1</span>.</p>
<div class="image"><span epub:type="pagebreak" id="page_152"/><img alt="Image" src="../images/f0152-01.jpg"/></div>
<p class="indent">To use this method, we need to provide the coordinates for that point as the arguments for the method’s <span class="literal">x</span> and <span class="literal">y</span> parameters. We’ll set those coordinates using the <span class="literal">Dragged</span> event handler’s reported event parameter arguments for the coordinates at which the user’s drag of the <span class="literal">ImageSprite</span> ended (<span class="literal">currentX</span> and <span class="literal">currentY</span>).</p>
<p class="indent">To add the blocks for the <span class="literal">x</span> parameter, snap a <span class="codestrong">-</span> operator block <span class="ent">➌</span> to the right of the letter <span class="codestrong">x</span>. Then, mouse over the <span class="codestrong">currentX</span> event parameter and drag its <span class="codestrong">get currentX</span> block <span class="ent">➍</span> into the subtraction block’s first operand socket.</p>
<p class="indent">Next, we need to subtract half the <span class="literal">ImageSprite</span>’s width from its x-coordinate to shift it to the left, so that users can drag it from its top-center point, which is easier than dragging it from the default position, the top-left edge. To do this, drag a <span class="codestrong">×</span> operator block <span class="ent">➎</span> into the subtraction block’s second operand socket. Then, fill the multiplication block’s left operand socket by dragging in <span class="codestrong">Sunglasses1</span>’s <span class="codestrong">Sunglasses1.Width</span> block <span class="ent">➏</span> and its right operand socket with a <span class="codestrong">0.5</span> number block <span class="ent">➐</span>. These blocks tell the app that, when a user drags <span class="literal">Sunglasses1</span>, it should move <span class="literal">Sunglasses1</span> to the x-coordinate of the point to which the user dragged it, minus half the sprite’s width.</p>
<p class="indent">To add the blocks for the <span class="literal">MoveTo</span> block’s <span class="literal">y</span> parameter, mouse over the <span class="codestrong">currentY</span> event parameter and snap its <span class="codestrong">get currentY</span> block <span class="ent">➑</span> in next to the letter <span class="literal">y</span>. These blocks tell the app that, when a user drags <span class="literal">Sunglasses1</span>, it should move <span class="literal">Sunglasses1</span> to the y-coordinate of the point to which the user dragged it.</p>
<h5 class="h5" id="ch00lev3sec108"><strong>Creating a Dragged Event Handler for All Sunglasses ImageSprites</strong></h5>
<p class="noindent">We now need to program the exact same <span class="literal">Dragged</span> event response for <span class="literal">Sunglasses2</span>, <span class="literal">Sunglasses3</span>, and <span class="literal">Sunglasses4</span>. The following generic event handler accomplishes this task.</p>
<div class="image"><img alt="Image" src="../images/f0152-02.jpg"/></div>
<p class="indent"><span epub:type="pagebreak" id="page_153"/>To create this any <span class="literal">ImageSprite Dragged</span> event handler, right-click the <span class="literal">Sunglasses1 Dragged</span> event handler that we just placed and select <strong>Make Generic</strong>. Now the blocks for step 4 move the four sunglasses <span class="literal">ImageSprite</span>s around the <span class="literal">Canvas</span> when the user drags them.</p>
<p class="indent">Let’s live-test to see these blocks work. Once you select a pair of sunglasses, they should move around the <span class="literal">Canvas</span> where you drag them. If they’re not moving correctly, debug and test again. Before you test again, you may need to refresh the app in your Companion to make sure your changes take effect. You can refresh by making any change to the app in the Designer. Once this part of step 4 is working, move to the next part of the step, where we’ll program the <span class="literal">Slider</span> to allow a user to change the sunglasses’ sizes.</p>
<h5 class="h5" id="ch00lev3sec109"><strong>Adjusting the Width of the Selected Sunglasses</strong></h5>
<p class="noindent">Since the 200-pixel-wide sunglasses might not fit correctly on a user’s photo, we’ll program the app to let the user adjust the size of the sunglasses by moving the <span class="literal">Slider</span>. The <span class="literal">Slider1 PositionChanged</span> event handler accomplishes this.</p>
<div class="image"><img alt="Image" src="../images/f0153-01.jpg"/></div>
<p class="indent">These blocks handle the action that takes place when the thumb position of the <span class="literal">Slider</span> changes from the initial value of <span class="literal">200</span> that we set in the Designer. Once the <span class="literal">Slider</span> position changes, the <span class="literal">whenSlider1.PositionChanged</span> block provides the argument for a <span class="literal">thumbPosition</span> event parameter, which holds the numerical value of the thumb position after the change.</p>
<p class="indent">We’ll first place the blocks that set the selected <span class="literal">ImageSprite</span>’s new width to the value of <span class="literal">thumbPosition</span>, which will be somewhere between a minimum of 150 and maximum of 250, the <span class="literal">MinValue</span> and <span class="literal">MaxValue</span> properties we set for the <span class="literal">Slider</span> in the Designer. Drag <span class="codestrong">Slider1</span>’s <span class="codestrong">whenSlider1.PositionChanged</span> block <span class="ent">➊</span> to the Viewer. Next, drag a <span class="codestrong">setImageSprite.Width</span> block <span class="ent">➋</span> from the Any ImageSprite drawer into the event handler block. Fill the <span class="codestrong">setImageSprite.Width</span> block’s top socket with a <span class="codestrong">select list item</span> block <span class="ent">➌</span>, and fill that <span class="codestrong">select list item</span> block’s top socket with a <span class="codestrong">get global glassesSprites</span> block <span class="ent">➍</span> and its bottom socket with the <span class="codestrong">ListPicker1.SelectionIndex</span> block <span class="ent">➎</span>. Now, fill the <span class="codestrong">setImageSprite.Width</span> block’s bottom socket by mousing over the <span class="codestrong">thumbPosition</span> event parameter and dragging in a <span class="codestrong">get thumbPosition</span> block <span class="ent">➏</span>.</p>
<h5 class="h5" id="ch00lev3sec110"><span epub:type="pagebreak" id="page_154"/><strong>Adjusting the Height of the Selected Sunglasses</strong></h5>
<p class="noindent">The next blocks set the height of the selected sunglasses when the <span class="literal">Slider</span> position changes. This is the second half of the <span class="literal">Slider1 PositionChanged</span> event handler.</p>
<div class="image"><img alt="Image" src="../images/f0154-01.jpg"/></div>
<p class="indent">These blocks set the pixel height of the selected sunglasses to the value of the <span class="literal">thumbPosition</span> multiplied by 0.4. Since the height of each pair of sunglasses is 80 pixels, which is 0.4 times the default 200-pixel width, we use this formula to maintain the same proportion between the sunglasses’ height and width when the width changes. This will keep the glasses from looking distorted when a user moves the <span class="literal">Slider</span>.</p>
<p class="indent">To place these blocks, duplicate the <span class="literal">setImageSprite.Width</span> block. In the copy, change <span class="codestrong">Width</span> to <span class="codestrong">Height</span>, and snap the <span class="codestrong">setImageSprite.Height</span> block <span class="ent">➊</span> into the event handler block. Then replace the block in the <span class="codestrong">to</span> socket with a <span class="codestrong">×</span> operator block <span class="ent">➋</span>. Fill that multiplication block’s left operand socket by dragging in a <span class="codestrong">get thumbPosition</span> block <span class="ent">➌</span> and its right socket with a <span class="codestrong">0.4</span> number block <span class="ent">➍</span>.</p>
<p class="indent">You’ve now completed step 4. Let’s live-test again to see how these blocks work. You should be able to drag your selected pair of sunglasses around the <span class="literal">Canvas</span> and move the <span class="literal">Slider</span> to the left to make the glasses smaller and to the right to make them larger. If the sunglasses aren’t changing size correctly or proportionally, debug and test again. Once step 4 is working, move on to step 5, where we’ll program the app to let users draw on the picture.</p>
<h4 class="h4" id="ch00lev2sec59"><strong>STEP 5: LETTING USERS DRAW ON THE CANVAS</strong></h4>
<p class="noindent">Let’s now program step 5 of the app. When a user clicks the draw button, the app should display a notification that the user can draw anywhere on the <span class="literal">Canvas</span>. Also, when the user drags a finger on the <span class="literal">Canvas</span>, the app should draw on the <span class="literal">Canvas</span> along the finger’s path, unless the user is dragging one of the sunglasses <span class="literal">ImageSprite</span>s at the same time.</p>
<h5 class="h5" id="ch00lev3sec111"><strong>Letting Users Know They Can Draw</strong></h5>
<p class="noindent">Here is the code that tells the user where to draw on the app screen.</p>
<div class="image"><img alt="Image" src="../images/f0154-02.jpg"/></div>
<p class="indent">Drag the <span class="codestrong">whenDrawBtn.Click</span> block <span class="ent">➊</span> to the Viewer and then drag <span class="codestrong">Notifier1</span>’s <span class="codestrong">callNotifier1.ShowAlert</span> method call block <span class="ent">➋</span> inside it.</p>
<p class="indent"><span epub:type="pagebreak" id="page_155"/>The <span class="literal">ShowAlert</span> method that we’re calling requires an argument for its <span class="literal">notice</span> parameter, which holds the information we want the <span class="literal">Notifier</span> to display. To provide that argument, snap in an empty string block <span class="ent">➌</span> and enter <span class="codestrong">Drag on the screen anywhere above the buttons to draw.</span> into its text area. Now, when the user clicks the draw button, these blocks will display an alert saying the user can drag on the <span class="literal">Canvas</span> to draw.</p>
<h5 class="h5" id="ch00lev3sec112"><strong>Drawing Lines on the Canvas</strong></h5>
<p class="noindent">Next, we’ll tell the app where to draw when a user drags the <span class="literal">Canvas</span> and in what color. The following blocks handle this <span class="literal">Canvas1 Dragged</span> event.</p>
<div class="image"><img alt="Image" src="../images/f0155-01.jpg"/></div>
<p class="indent">Drag the <span class="codestrong">whenCanvas1.Dragged</span> block <span class="ent">➊</span> to the Viewer. When the user drags the <span class="literal">Canvas</span>, this event handler will store the following seven event parameters as arguments: the x- and y-coordinates for the point at which the user first touched the <span class="literal">Canvas</span> (<span class="literal">startX</span> and <span class="literal">startY</span>), the point at which the current drag began (<span class="literal">prevX</span> and <span class="literal">prevY</span>), the point at which the current drag ended (<span class="literal">currentX</span> and <span class="literal">currentY</span>), and a Boolean value for whether the drag also dragged an <span class="literal">ImageSprite</span> (<span class="literal">draggedAnySprite</span>). We’ll use a number of these values in the blocks we add to the <span class="literal">Dragged</span> event handler.</p>
<p class="indent">To add the blocks to make the app draw a line where the user dragged, drag the <span class="codestrong">callCanvas1.DrawLine</span> method call block <span class="ent">➋</span> into the event handler block. This method requires us to provide arguments for its <span class="literal">x1</span> and <span class="literal">y1</span> parameters, which hold the x- and y-coordinates for the point at which the app should start drawing, and <span class="literal">x2</span> and <span class="literal">y2</span> parameters, which hold the x- and y-coordinates for the point at which the app should stop drawing.</p>
<p class="indent">We’ll get these arguments from the <span class="literal">whenCanvas1.Dragged</span> block. Mouse over the block’s parameters and drag a <span class="codestrong">get prevX</span> block <span class="ent">➌</span> into the <span class="codestrong">callCanvas1.DrawLine</span> block’s top socket, a <span class="codestrong">get prevY</span> block <span class="ent">➍</span> into its second socket, a <span class="codestrong">get currentX</span> block <span class="ent">➎</span> into its third socket, and a <span class="codestrong">get currentY</span> block <span class="ent">➏</span> into its last socket. Now, when the user drags on the <span class="literal">Canvas</span>, these blocks direct the app to draw a line from the point at which the user begins to drag the <span class="literal">Canvas</span> to the point at which the user stops.</p>
<h5 class="h5" id="ch00lev3sec113"><span epub:type="pagebreak" id="page_156"/><strong>Determining the Canvas Line Color</strong></h5>
<p class="noindent">Right now, despite the blocks we just placed, the user’s lines won’t show up. That’s because we set the <span class="literal">PaintColor</span> for <span class="literal">Canvas1</span> to None in the Designer. To update this, we’ll have the app draw a transparent line if the user also drags an <span class="literal">ImageSprite</span> along with the <span class="literal">Canvas</span> and a red line if the user drags only the <span class="literal">Canvas</span>. The following <span class="literal">if then else</span> block directs this behavior.</p>
<div class="image"><img alt="Image" src="../images/f0156-01.jpg"/></div>
<p class="indent">Drag an <span class="codestrong">if then</span> block to the Viewer, click the blue mutator icon to add an <span class="codestrong">else</span> input to the block, and then snap the <span class="codestrong">if then else</span> block <span class="ent">➊</span> inside the event handler block. Now, mouse over the event handler’s <span class="codestrong">draggedAnySprite</span> parameter, and drag a <span class="codestrong">get draggedAnySprite</span> block <span class="ent">➋</span> into the <span class="codestrong">if then else</span> block’s <span class="codestrong">if</span> socket, which checks whether the user has dragged one of the <span class="literal">ImageSprite</span>s. Then, drag a <span class="codestrong">setCanvas1.PaintColor</span> block <span class="ent">➌</span> into the <span class="codestrong">if then else</span> block’s <span class="codestrong">then</span> socket and snap a <span class="codestrong">1</span> number block <span class="ent">➍</span> to its right to make the color transparent. The blocks in this <span class="literal">then</span> socket dictate what happens if the user has also dragged an <span class="literal">ImageSprite</span>.</p>
<p class="indent">Next duplicate the <span class="codestrong">setCanvas1.PaintColor</span> block <span class="ent">➎</span> and drag the copy into the <span class="codestrong">if then else</span> block’s <span class="codestrong">else</span> socket, which determines what happens if the user hasn’t dragged an <span class="literal">ImageSprite</span>. Replace the <span class="codestrong">1</span> number block with a red color block <span class="ent">➏</span> from the Colors drawer.</p>
<p class="indent">Now, each time a user drags the <span class="literal">Canvas</span>, the app tests whether the user is also dragging a sunglasses <span class="literal">ImageSprite</span>. If so, the app draws an invisible line because of the <span class="literal">1</span> value we set. If the user’s not dragging an <span class="literal">ImageSprite</span>, the app draws a red line.</p>
<p class="indent">Let’s live-test to see how these blocks work. When you click <span class="literal">DrawBtn</span>, you should see an alert letting you know you can draw on the screen by dragging your finger above the buttons. When you drag on the <span class="literal">Canvas</span>, you should see your drawing in red on the device screen, unless you’re also dragging a pair of sunglasses. If you’re dragging a pair of sunglasses, you shouldn’t see any lines drawn. If any part of this step isn’t working correctly, debug and test again. Once step 5 is working, continue on to the next step, where we’ll program the app to let users type on the picture.</p>
<h4 class="h4" id="ch00lev2sec60"><strong>STEP 6: LETTING USERS TYPE ON THE CANVAS</strong></h4>
<p class="noindent">When a user clicks <span class="literal">TypeBtn</span>, the app’s <span class="literal">Notifier</span> should open a text dialog in which the user can enter the desired text to display on the <span class="literal">Canvas</span>. After the user clicks OK to close the dialog, the app should display any text entered into the dialog in blue near the bottom of the <span class="literal">Canvas</span>.</p>
<h5 class="h5" id="ch00lev3sec114"><strong>Opening the Text Dialog for Input</strong></h5>
<p class="noindent">The <span class="literal">TypeBtn.Click</span> event handler opens the text dialog to collect the entered text when the user clicks <span class="literal">TypeBtn</span>.</p>
<div class="image"><span epub:type="pagebreak" id="page_157"/><img alt="Image" src="../images/f0157-01.jpg"/></div>
<p class="indent">Drag the <span class="codestrong">whenTypeBtn.Click</span> block <span class="ent">➊</span> to the Viewer, then drag the <span class="codestrong">callNotifier1.ShowTextDialog</span> method call block <span class="ent">➋</span> into it. This <span class="literal">ShowTextDialog</span> method call requires an argument for its <span class="literal">message</span> parameter, which holds the message we’ll show the user in the text dialog that opens; its <span class="literal">title</span> parameter, which holds a title that will show at the top of the text dialog; and its <span class="literal">cancelable</span> parameter. If the <span class="literal">cancelable</span> parameter were set to <span class="literal">true</span>, the app would add an OK and a Cancel button to the text dialog. Then, when we program the app to display the user’s response later in this step, the app would display the word “Cancel” on the <span class="literal">Canvas</span> if the user clicked Cancel. We’ll set the <span class="literal">cancelable</span> parameter to <span class="literal">false</span> instead, which adds only an OK button to the dialog. After we program the second part of this step, pressing the OK button should place the user’s text on the <span class="literal">Canvas</span>.</p>
<p class="indent">For the <span class="literal">message</span> parameter, snap an empty string block <span class="ent">➌</span> into the <span class="codestrong">message</span> socket and enter <span class="codestrong">Type your brief message below. Click OK to close this box.</span> For the <span class="literal">title</span> parameter, snap an empty string block <span class="ent">➍</span> into the <span class="codestrong">title</span> socket and enter <span class="codestrong">Type on the Screen</span>; then, set the <span class="literal">cancelable</span> parameter by changing the default <span class="codestrong">true</span> block to <span class="codestrong">false</span> <span class="ent">➎</span>.</p>
<h5 class="h5" id="ch00lev3sec115"><strong>Displaying the User’s Input on the Canvas</strong></h5>
<p class="noindent">Now we’ll program the <span class="literal">Notifier AfterTextInput</span> event handler, which tells the app how and where to display the user’s message (reported as the response event parameter) on the <span class="literal">Canvas</span>. Once the user clicks OK in the dialog, the app should set the paint color to blue and print the response at specific coordinates on the <span class="literal">Canvas</span>.</p>
<div class="image"><img alt="Image" src="../images/f0157-02.jpg"/></div>
<p class="indent">Drag the <span class="codestrong">whenNotifier1.AfterTextInput</span> block <span class="ent">➊</span> to the Viewer. Then, to set the paint color, drag the <span class="codestrong">setCanvas1.PaintColor</span> block <span class="ent">➋</span> into the event handler block and snap a blue color block <span class="ent">➌</span> into its right socket. After the user closes the text dialog, these blocks will change the <span class="literal">Canvas</span> paint color to blue.</p>
<p class="indent">Next, to call the method that draws the text on the <span class="literal">Canvas</span>, drag the <span class="codestrong">callCanvas1.DrawText</span> method call block into the <span class="codestrong">whenNotifier1.AfterTextInput</span> <span epub:type="pagebreak" id="page_158"/>event handler block <span class="ent">➍</span>. This <span class="literal">DrawText</span> method takes arguments for its <span class="literal">text</span> parameter, which is the user input it should display on the screen, and for its <span class="literal">x</span> and <span class="literal">y</span> parameters, which are the x- and y-coordinates for the point at which the input should begin to show on the <span class="literal">Canvas</span>.</p>
<p class="indent">To provide the argument for the method’s <span class="literal">text</span> parameter, mouse over the <span class="codestrong">AfterTextInput</span> handler’s <span class="codestrong">response</span> event parameter and drag its <span class="codestrong">get response</span> block <span class="ent">➎</span> into the <span class="codestrong">text</span> socket. For the text location, we’ll set it at 10 pixels in from the <span class="literal">Canvas</span>’s left edge and 20 pixels up from the bottom so that it will display close to the bottom of the picture.</p>
<p class="indent">To do this, for the <span class="literal">callCanvas1.DrawText</span> block’s <span class="literal">x</span> parameter, drag in a <span class="codestrong">10</span> number block <span class="ent">➏</span>, and for its <span class="literal">y</span> parameter, drag in a <span class="codestrong">-</span> operator block <span class="ent">➐</span>. Fill the subtraction block’s left operand socket by dragging in the <span class="codestrong">Canvas1.Height</span> block <span class="ent">➑</span> and fill its right operand socket by dragging in a <span class="codestrong">20</span> number block <span class="ent">➒</span>. This sets the <span class="literal">x</span> parameter to <span class="literal">10</span> and the <span class="literal">y</span> parameter to the height of the <span class="literal">Canvas</span> minus 20 pixels—or, in other words, 20 pixels from the bottom of the <span class="literal">Canvas</span>.</p>
<p class="indent">Now test these blocks. When you click <span class="literal">TypeBtn</span>, a dialog should open in which you can enter the text you want typed on the <span class="literal">Canvas</span>. Enter some text and click <strong>OK</strong>. You should see the text typed in blue at the left side of the <span class="literal">Canvas</span>, near the bottom. If any part of this step isn’t working correctly, debug and test again. Once step 6 is working, let’s program the app to allow users to save the <span class="literal">Canvas</span>.</p>
<h4 class="h4" id="ch00lev2sec61"><strong>STEP 7: LETTING USERS SAVE A PICTURE OF THE CANVAS</strong></h4>
<p class="noindent">In this step, we’ll let a user save a picture of the <span class="literal">Canvas</span>, along with any selected sunglasses, drawing, and typing, to a device as an image file. The <span class="literal">SaveBtn.click</span> event handler saves the user’s creation.</p>
<div class="image"><img alt="Image" src="../images/f0158-01.jpg"/></div>
<p class="indent">First, we’ll tell the app to show an alert when the user clicks the save button. Drag the <span class="codestrong">whenSaveBtn.click</span> block <span class="ent">➊</span> to the Viewer and then place the <span class="codestrong">callNotifier1.ShowAlert</span> method call block <span class="ent">➋</span> inside of it.</p>
<p class="indent">The next blocks provide the argument for the <span class="literal">ShowAlert</span> method’s <span class="literal">notice</span> parameter, which is the notice we want the <span class="literal">Notifier</span> to show. We want that notice to tell the user where on the device the picture is saved and call the method that saves the picture while displaying the storage location.</p>
<p class="indent">To place these blocks, drag a <span class="codestrong">join</span> block <span class="ent">➌</span> into the <span class="codestrong">callNotifier1.ShowAlert</span> block’s <span class="codestrong">notice</span> socket. Then fill the <span class="codestrong">join</span> block’s top socket with an empty string block <span class="ent">➍</span> and enter <span class="codestrong">The Canvas is saved at</span>, including the final space, into its text area. Next, fill the <span class="codestrong">join</span> block’s bottom socket by dragging in a <span class="codestrong">callCanvas1.Save</span> method call block <span class="ent">➎</span>.</p>
<p class="indent"><span epub:type="pagebreak" id="page_159"/>Let’s test these blocks. When you click <span class="literal">SaveBtn</span>, you should see an alert reading, “The Canvas is saved at &lt;<em>file location</em>&gt;.” You should be able to find the file when you go to that location or look in the device’s File Manager, but you may need to close the app before the file appears. Once this step works as it should, close the app on your device and move on to program the app’s last step, which allows the user to clear the <span class="literal">Canvas</span>.</p>
<h4 class="h4" id="ch00lev2sec62"><strong>STEP 8: LETTING USERS CLEAR THE CANVAS</strong></h4>
<p class="noindent">In this final step, we’ll program the app to let the user clear the sunglasses, as well as all drawings and typed text, from the <span class="literal">Canvas</span>, so that only the background image remains. The <span class="literal">TrashBtn.click</span> event handler clears the <span class="literal">Canvas</span>.</p>
<div class="image"><img alt="Image" src="../images/f0159-01.jpg"/></div>
<p class="indent">These blocks call the <span class="literal">clearSprite</span> procedure, which hides all <span class="literal">ImageSprite</span>s, like it did when we used it in the <span class="literal">AfterPicker</span> event handler. Then they call the built-in <span class="literal">Canvas Clear</span> method, which clears all text and drawings from the <span class="literal">Canvas</span>, when the user clicks the trash button.</p>
<p class="indent">Drag the <span class="codestrong">whenTrashBtn.click</span> block <span class="ent">➊</span> to the Viewer and then drag the <span class="codestrong">call clearSprite</span> block <span class="ent">➋</span> into it. Next drag a <span class="codestrong">callCanvas1.Clear</span> block <span class="ent">➌</span> into the event handler block under the <span class="codestrong">call clearSprite</span> block.</p>
<p class="indent">Now let’s test the completed app! Open the app on your device. You should see the <span class="literal">TakePicBtn</span>. Click it, and your camera should open. When you take a picture, that picture should become the background of the top portion of your app screen. Below the picture, you should see the <span class="literal">ListPicker</span>, with the <span class="literal">Slider</span> and the draw, type, save, and trash buttons beneath it.</p>
<p class="indent">When you click Choose Glasses, you should see all four sunglasses options listed, and, when you select a pair, the <span class="literal">ListPicker</span> should close and your selected sunglasses should appear at the top of the <span class="literal">Canvas</span>. You should be able to drag the glasses around the <span class="literal">Canvas</span> and use the <span class="literal">Slider</span> to change their size.</p>
<p class="indent">Test each button. When you click <span class="literal">DrawBtn</span>, the app should display the notice telling you that you can draw on the <span class="literal">Canvas</span>, and when you drag your finger along the <span class="literal">Canvas</span> at any place except on the <span class="literal">ImageSprite</span>, a red line should appear. When you click <span class="literal">TypeBtn</span>, a dialog should open prompting you to type a message, and after you type it and click OK, your message should appear in blue at the bottom of the <span class="literal">Canvas</span>.</p>
<p class="indent">When you click <span class="literal">SaveBtn</span>, you should see a notice alerting you that a picture of the <span class="literal">Canvas</span> has been saved at a given location on your device. When you click <span class="literal">TrashBtn</span>, the <span class="literal">ImageSprite</span> and all text and drawing should disappear from the <span class="literal">Canvas</span>. If you placed your blocks correctly, you’ve successfully created the “Virtual Shades” app!</p>
<h3 class="h3" id="ch00lev1sec54"><span epub:type="pagebreak" id="page_160"/><strong>SUMMARY</strong></h3>
<p class="noindent">In this chapter, you built the “Virtual Shades” app, which lets users try on sunglasses, draw and type on the <span class="literal">Canvas</span>, and save a picture of the <span class="literal">Canvas</span> to their devices to keep and share.</p>
<p class="indent">Along the way, you learned how to set the <span class="literal">Canvas</span> line size and colors to prepare for drawing, let users take a selfie through the app and make it the app background, let users adjust components with the <span class="literal">Slider</span>, and use the <span class="literal">Notifier</span> component to not only display information but also collect user input.</p>
<p class="indent">You also practiced declaring and initializing list variables, creating procedures, providing required arguments for built-in methods with parameters, using comparison operators to test conditions, and adding conditionals and loops to control app flow.</p>
<h3 class="h3" id="ch00lev1sec55"><strong>ON YOUR OWN</strong></h3>
<p class="noindent">Modify and extend the “Virtual Shades” app by working on the following exercises. Be sure to adjust your algorithm to plan the changes before you add any components or blocks, and save the new versions of the apps you create. You can find solutions online at <em><a href="https://nostarch.com/programwithappinventor/">https://nostarch.com/programwithappinventor/</a></em>.</p>
<ol>
<li><p class="noindent">Change the app so that it allows users to choose the <span class="literal">Canvas</span> paint color to draw and type on the <span class="literal">Canvas</span>.</p></li>
<li><p class="noindent">Change the app so that it allows users to speak the words they want entered on the <span class="literal">Canvas</span>.</p></li>
<li><p class="noindent">Extend the app so that users can opt not to take a background photo and instead create art on a blank <span class="literal">Canvas</span>.</p></li>
</ol>
</body></html>