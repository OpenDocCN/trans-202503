<html><head></head><body>
<p class="h1-part" id="part01"><span epub:type="pagebreak" id="page_15"/><strong><span class="blue">LEDs</span></strong></p>&#13;


<h2 class="h2s" id="ch01"><span epub:type="pagebreak" id="page_16"/><strong>1<br/>LED Light Bar</strong></h2>&#13;
<p class="intro"><span class="blue">In this project we’ll flash a row of LEDs back and forth in sequence, sort of like KITT from the 1980s TV series <em>Knight Rider</em>.</span></p>&#13;
<div class="image"><img alt="Image" src="../images/p0016-01.jpg"/></div>&#13;
<div class="image"><span epub:type="pagebreak" id="page_17"/><img alt="Image" src="../images/p0017-01.jpg"/></div>&#13;
<p class="cap"><strong>PARTS REQUIRED</strong></p>&#13;
<p class="cap1"><strong>Arduino board</strong></p>&#13;
<p class="cap1"><strong>Breadboard</strong></p>&#13;
<p class="cap1"><strong>Jumper wires</strong></p>&#13;
<p class="cap1"><strong>8 LEDs</strong></p>&#13;
<p class="cap1"><strong>8 220-ohm resistors</strong></p>&#13;
<h3 class="h3" id="ch00lev1sec3"><span epub:type="pagebreak" id="page_18"/><span class="blue"><strong>HOW IT WORKS</strong></span></h3>&#13;
<p class="noindent">An LED emits light when a small current is passed through it. LEDs are <em>polarized</em>, which means one side is positive and one side is negative. This is because the LED will work only with current flowing in one direction, from positive to negative. The longer leg of the LED is positive and must connect to a positive power connection. The Arduino sketch controls the sequence of flashes.</p>&#13;
<p class="indent">LEDs are delicate parts, requiring only a small amount of voltage to light up—smaller than the voltage the Arduino provides. To prevent the LEDs from being overloaded with voltage and burning out, we use <em>resistors</em>, which limit the amount of voltage passing through them to the LED on the other end.</p>&#13;
<p class="indent">You can change the color of your LEDs and use this light bar to decorate a car, scooter, bike, picture frame, subwoofer, or almost anything else you choose. You can add up to 10 LEDs on the Uno before you run out of pins.</p>&#13;
<h3 class="h3" id="ch00lev1sec4"><span class="blue"><strong>THE BUILD</strong></span></h3>&#13;
<ol>&#13;
<li><p class="noindents">Insert the LEDs into the breadboard with their shorter, negative legs in the GND rail at the top of your breadboard. Then connect this rail to GND on the Arduino, as shown in <a href="ch01.xhtml#ch1fig1">Figure 1-1</a>.</p>&#13;
<p class="figcap"><a id="ch1fig1"/><strong>FIGURE 1-1:</strong> The LEDs flash back and forth in sequence. The short leg of the LED is in the GND rail of the breadboard, and the long leg is connected to the Arduino via a resistor.</p>&#13;
<div class="image"><img alt="Image" src="../images/f1-01.jpg"/></div></li>&#13;
<li><p class="noindents"><span epub:type="pagebreak" id="page_19"/>Connect the LEDs in sequence to Arduino digital pins 2–9, as shown in the following circuit diagram. Place a 220-ohm resistor between each LED and digital pin, ensuring that the resistors bridge the center divide in the breadboard.</p>&#13;
<table class="all">&#13;
<thead>&#13;
<tr>&#13;
<td class="table_thb" style="vertical-align: top;"><p class="tablec"><strong>LEDS</strong></p></td>&#13;
<td class="table_th" style="vertical-align: top;"><p class="tablec"><strong>ARDUINO</strong></p></td>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td class="table_1b" style="vertical-align: top;"><p class="tablec"><span class="blue">Positive legs</span></p></td>&#13;
<td class="table_2" style="vertical-align: top;"><p class="tablec"><span class="blue">Pins 2–9 via resistor</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1ba" style="vertical-align: top;"><p class="tablec"><span class="blue">Negative legs</span></p></td>&#13;
<td class="table_2" style="vertical-align: top;"><p class="tablec"><span class="blue">GND</span></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table></li>&#13;
<li><p class="noindents">Check your setup against <a href="ch01.xhtml#ch1fig2">Figure 1-2</a>, and then upload the code in “<a href="ch01.xhtml#ch00lev1sec5">The Sketch</a>” below.</p>&#13;
<p class="figcap"><a id="ch1fig2"/><strong>FIGURE 1-2:</strong> The circuit diagram for the LED light bar</p>&#13;
<div class="image"><img alt="Image" src="../images/f1-02.jpg"/></div></li>&#13;
</ol>&#13;
<h3 class="h3" id="ch00lev1sec5"><span class="blue"><strong>THE SKETCH</strong></span></h3>&#13;
<p class="noindent">The sketch sets the pins connected to the LEDs as outputs, and then defines a function to turn all the LEDs off at the same time. This function is called in the loop cycle to turn the LEDs off, and then the LEDs are turned on one at a time—with a 200-millisecond delay between each one—to create a sweeping effect. Another loop sends the sequence back the other way.</p>&#13;
<p class="programs1"><span class="ash">// Used with kind permission from</span><br/><span class="ash">// Warwick A Smith, startingelectronics.com</span><br/><span class="ash">// Knight Rider display on eight LEDs</span><br/><br/><span class="green1">void</span> <span class="green2">setup</span>() {<br/>  <span class="green2">for</span> (<span class="green1">int</span> i = 2; i &lt; 10; i++) { <span class="ash">// Choose pins 2-9</span><br/>    <span class="orange">pinMode</span>(i, <span class="green1">OUTPUT</span>); <span class="ash">// Set the pins as outputs</span><br/>  }<br/>}<br/><span class="ash"><span epub:type="pagebreak" id="page_20"/>// Define function to turn off all LEDs at the same time</span><br/><span class="green1">void</span> allLEDsOff(<span class="green1">void</span>) {<br/>  <span class="green2">for</span> (<span class="green1">int</span> i = 2; i &lt; 10; i++) {<br/>    <span class="orange">digitalWrite</span>(i, <span class="green1">LOW</span>);<br/>  }<br/>}<br/><br/><span class="ash">// Switch on LEDs in sequence from left to right</span><br/><span class="green1">void</span> <span class="green2">loop</span>() {<br/>  <span class="green2">for</span> (<span class="green1">int</span> i = 2; i &lt; 9; i++) { <span class="ash">// Run loop once for each LED</span><br/>    allLEDsOff(); <span class="ash">// Turn off all LEDs</span><br/>    <span class="orange">digitalWrite</span>(i, <span class="green1">HIGH</span>); <span class="ash">// Turn on current LED</span><br/>    <span class="orange">delay</span>(200); <span class="ash">// Delay of 200 ms,</span><br/>                <span class="ash">// then repeat loop to move on to next LED</span><br/>  }<br/>  <span class="green2">for</span> (<span class="green1">int</span> i = 9; i &gt; 2; i--) { <span class="ash">// Light LEDs from right to left</span><br/>    allLEDsOff();<br/>    <span class="orange">digitalWrite</span>(i, <span class="green1">HIGH</span>);<br/>    <span class="orange">delay</span>(200);<br/>  }<br/>}</p>&#13;
<h3 class="h3" id="ch00lev1sec6"><span class="blue"><strong>TROUBLESHOOTING</strong></span></h3>&#13;
<p class="ques"><strong>Q.</strong> <em>The code compiles, but some or all of the LEDs do not light up as expected.</em></p>&#13;
<p class="bull">• If none of the LEDs light, make sure you’ve connected the GND wire from the Arduino to the correct breadboard power rail and that the Arduino has power connected.</p>&#13;
<p class="bull">• If only some LEDs light, check that the LEDs are inserted the correct way, with the longer wire to positive power and the shorter wire to GND. Because LEDs are polarized, they must be connected the correct way. Check that the resistors are inserted fully and lined up in the same row as the corresponding LED leg.</p>&#13;
<p class="bull">• Make sure the LEDs are connected to the Arduino pins defined in “<a href="ch01.xhtml#ch00lev1sec5">The Sketch</a>” on <a href="ch01.xhtml#page_19">page 19</a>. The first part of the sketch defines pins 2–9 as outputs, so these are the pins you should use.</p>&#13;
<p class="bull">• If an LED still fails to light, it may have burnt out or be faulty. An easy way to check is to swap the LED with another in the sequence and see if that resolves the issue. If you find that the LED works in another position, it means the resistor is either faulty or not inserted fully. Depending on the outcome, replace the LED or resistor with a functioning component.</p>&#13;


<h2 class="h2s" id="ch02"><span epub:type="pagebreak" id="page_21"/><strong>2<br/>Light-Activated Night-Light</strong></h2>&#13;
<p class="intro"><span class="blue">This project is a simple test of a photoresistor’s functionality: we’ll create a night light that gets brighter depending on the amount of light detected.</span></p>&#13;
<div class="image"><img alt="Image" src="../images/p0021-01.jpg"/></div>&#13;
<div class="image"><span epub:type="pagebreak" id="page_22"/><img alt="Image" src="../images/p0022-01.jpg"/></div>&#13;
<p class="cap"><strong>PARTS REQUIRED</strong></p>&#13;
<p class="cap1"><strong>Arduino board</strong></p>&#13;
<p class="cap1"><strong>Breadboard</strong></p>&#13;
<p class="cap1"><strong>Jumper wires</strong></p>&#13;
<p class="cap1"><strong>Photoresistor</strong></p>&#13;
<p class="cap1"><strong>LED</strong></p>&#13;
<p class="cap1"><strong>10k-ohm resistor</strong></p>&#13;
<h3 class="h3" id="ch00lev1sec7"><span epub:type="pagebreak" id="page_23"/><span class="blue"><strong>HOW IT WORKS</strong></span></h3>&#13;
<p class="noindent">A <em>photoresistor</em> is a variable resistor that reacts to light; the less light that shines on it, the higher the resistance it provides. This resistance value varies the voltage that’s sent to the input pin of the Arduino, which in turn sends that voltage value to the output pin as the power level of the LED, so in low light the LED will be bright. There are different styles of photoresistors, but they usually have a small, clear, oval head with wavy lines (see <a href="ch02.xhtml#ch2fig1">Figure 2-1</a>). Photoresistors do not have polarity, so it doesn’t matter which way you connect the legs.</p>&#13;
<p class="indent">The principles at work here are similar to those of a child’s night-light. You can use a photoresistor to control more than just LEDs, as we’ll see in upcoming chapters. Since we only have two power and GND connections, we won’t be using the breadboard power rails here.</p>&#13;
<p class="figcap"><a id="ch2fig1"/><strong>FIGURE 2-1:</strong> A photoresistor</p>&#13;
<div class="image"><img alt="Image" src="../images/f2-01.jpg"/></div>&#13;
<h3 class="h3" id="ch00lev1sec8"><span class="blue"><strong>THE BUILD</strong></span></h3>&#13;
<ol>&#13;
<li><p class="noindents">Place your photoresistor in the breadboard, connecting one leg to GND directly on the Arduino and the other leg to Arduino A0.</p></li>&#13;
<li><p class="noindents">Connect one leg of the 10k-ohm resistor to +5V, and connect the other leg to the A0 photoresistor leg, as shown in the circuit diagram in <a href="ch02.xhtml#ch2fig2">Figure 2-2</a>.</p>&#13;
<p class="figcap"><span epub:type="pagebreak" id="page_24"/><a id="ch2fig2"/><strong>FIGURE 2-2:</strong> The circuit diagram for the light-activated LED</p>&#13;
<div class="image"><img alt="Image" src="../images/f2-02.jpg"/></div></li>&#13;
<li><p class="noindents">Insert the longer, positive leg of the LED directly into pin 13 on the Arduino and the shorter, negative leg directly into Arduino GND. We would normally use a resistor to limit the current to an LED, but we don’t need one here because pin 13 on the Arduino has one built in.</p></li>&#13;
<li><p class="noindents">Upload the code in “<a href="ch02.xhtml#ch00lev1sec9">The Sketch</a>” below.</p></li>&#13;
</ol>&#13;
<h3 class="h3" id="ch00lev1sec9"><span class="blue"><strong>THE SKETCH</strong></span></h3>&#13;
<p class="noindent">The sketch first connects the photoresistor to Arduino pin A0 as our <span class="literal">INPUT</span> and the LED to pin 13 as our <span class="literal">OUTPUT</span>. We run the serial communication with <span class="literal">Serial.begin(9600)</span>, which (when your Arduino is connected to your PC) will send information to the Arduino’s Serial <span epub:type="pagebreak" id="page_25"/>Monitor. This means the resistance value of the photoresistor will be displayed in the Serial Monitor on your computer, as shown in <a href="ch02.xhtml#ch2fig3">Figure 2-3</a>.</p>&#13;
<p class="figcap"><a id="ch2fig3"/><strong>FIGURE 2-3:</strong> The Serial Monitor will display the resistance of the photoresistor.</p>&#13;
<div class="image"><img alt="Image" src="../images/f2-03.jpg"/></div>&#13;
<p class="indent">The loop reads the photoresistor’s analog value and sends it to the LED as a voltage value. The A0 pin can read 1,024 values, which means there are 1,024 possible brightness levels for the LED. Minuscule changes between this many levels aren’t very visible, so we divide that number by 4 to scale down to only 256 values, making it easier to detect when there is a change in voltage to the LED.</p>&#13;
<p class="programs1"><span class="green1">int</span> lightPin = A0; <span class="ash">// Pin connected to the photoresistor</span><br/><span class="green1">int</span> ledPin = 13; <span class="ash">// Pin connected to the LED</span><br/><span class="green1">void</span> <span class="green2">setup</span>() {<br/>  <span class="orange">Serial</span>.<span class="orange">begin</span>(9600); <span class="ash">// Begin serial communication</span><br/>  <span class="orange">pinMode</span>(ledPin, <span class="green1">OUTPUT</span>); <span class="ash">// Setting the LED pin as an output</span><br/>}<br/><br/><span class="ash">// This loop reads the analog pin value and</span><br/><span class="ash">// sends that to the LED as an output</span><br/><span class="green1">void</span> <span class="green2">loop</span>() {<br/>  <span class="ash">// Read the value of the photoresistor</span><br/>  <span class="orange">Serial</span>.<span class="orange">println</span>(<span class="orange">analogRead</span>(lightPin));<br/>  <span class="ash">// Write the value to the Serial Monitor</span><br/>  <span class="ash">// Send the value to the ledPin and divide by 4</span><br/>  <span class="orange">analogWrite</span>(ledPin, <span class="orange">analogRead</span>(lightPin) / 4);<br/>  <span class="orange">delay</span>(10); <span class="ash">// Short delay before the sequence loops again</span><br/>}</p>&#13;
<h3 class="h3" id="ch00lev1sec10"><span epub:type="pagebreak" id="page_26"/><span class="blue"><strong>TROUBLESHOOTING</strong></span></h3>&#13;
<p class="ques"><strong>Q.</strong> <em>The code compiles, but the LED does not light when it’s dark.</em></p>&#13;
<p class="bull">• Make sure that the LED is inserted with the long, positive leg in pin 13 and the short, negative leg in GND next to it.</p>&#13;
<p class="bull">• Make sure the photoresistor is connected to Arduino A0 as shown in the circuit diagram in <a href="ch02.xhtml#ch2fig2">Figure 2-2</a>. Open the Serial Monitor to see if there’s a reading. If you’re getting a reading but the LED doesn’t light, the LED may be faulty, so try replacing it with another one.</p>&#13;


<h2 class="h2s" id="ch03"><span epub:type="pagebreak" id="page_27"/><strong>3<br/>Seven-Segment LED Count Down Timer</strong></h2>&#13;
<p class="intro"><span class="blue">In this project we’ll create a simple timer that counts down from 9 to 0. This can be used in any number of useful projects!</span></p>&#13;
<div class="image"><img alt="Image" src="../images/p0027-01.jpg"/></div>&#13;
<div class="image"><span epub:type="pagebreak" id="page_28"/><img alt="Image" src="../images/p0028-01.jpg"/></div>&#13;
<p class="cap"><strong>PARTS REQUIRED</strong></p>&#13;
<p class="cap1"><strong>Arduino board</strong></p>&#13;
<p class="cap1"><strong>Breadboard</strong></p>&#13;
<p class="cap1"><strong>Jumper wires</strong></p>&#13;
<p class="cap1"><strong>Seven-segment, single-digit common-cathode LED</strong></p>&#13;
<p class="cap1"><strong>8 220-ohm resistors</strong></p>&#13;
<h3 class="h3" id="ch00lev1sec11"><span epub:type="pagebreak" id="page_29"/><span class="blue"><strong>HOW IT WORKS</strong></span></h3>&#13;
<p class="noindent">A seven-segment LED display shows a single digit or character using LED segments. Each segment is an individual LED, and by controlling which segments are lit at any time, we can display numeric values. We’re using a single-digit display in this project, shown in <a href="ch03.xhtml#ch3fig1">Figure 3-1</a>, but there are also two-, three-, four-, and eight-digit variations available.</p>&#13;
<p class="figcap"><a id="ch3fig1"/><strong>FIGURE 3-1:</strong> A seven-segment LED</p>&#13;
<div class="image"><img alt="Image" src="../images/f3-01.jpg"/></div>&#13;
<div class="noter">&#13;
<p class="notet"><strong>NOTE</strong></p>&#13;
<p class="notep"><em>The</em> cathode <em>of a device is the negative connection, usually indicated with a minus sign (–) and sometimes referred to as</em> ground <em>(abbreviated</em> GND<em>). It is connected to negative power. The</em> anode <em>of a device is the positive connection, usually indicated with a plus sign (+) and connected to positive power.</em></p>&#13;
</div>&#13;
<p class="indent">This project will create a simple timer to count down from 9 to 0. The seven-segment LED has 10 pins. Seven pins control the seven LEDs that light up to form each digit, and the eighth pin controls the decimal point. The other two pins are the common-cathode (–) or common-anode (+) pins, which add power to the project. Our seven-segment LED is common cathode, meaning one side of each LED needs to connect to ground. It’s important to note that the code will work only with a common-cathode LED. If you have a common-anode LED you want to use, check the troubleshooting section at the end of this chapter before uploading the sketch. Each LED segment requires a resistor to limit the current; otherwise, it will burn out.</p>&#13;
<p class="indent">The pins are labeled with a letter, as shown in <a href="ch03.xhtml#ch3fig2">Figure 3-2</a>. The numbered pins control the segments as shown on the right. The Arduino creates the number by turning the LEDs off or on in different combinations.</p>&#13;
<p class="figcap"><span epub:type="pagebreak" id="page_30"/><a id="ch3fig2"/><strong>FIGURE 3-2:</strong> A typical pin layout for a seven-segment LED</p>&#13;
<div class="image"><img alt="Image" src="../images/f3-02.jpg"/></div>&#13;
<h3 class="h3" id="ch00lev1sec12"><span class="blue"><strong>THE BUILD</strong></span></h3>&#13;
<ol>&#13;
<li><p class="noindents">Place the seven-segment display in a breadboard as shown in <a href="ch03.xhtml#ch3fig3">Figure 3-3</a>, making sure the pins straddle either side of the center break. Connect LED pins 3 and 8 to the GND rail.</p>&#13;
<p class="figcap"><a id="ch3fig3"/><strong>FIGURE 3-3:</strong> The seven-segment LED pins should straddle the center break of the breadboard.</p>&#13;
<div class="image"><img alt="Image" src="../images/f3-03.jpg"/></div></li>&#13;
<li><p class="noindents"><span epub:type="pagebreak" id="page_31"/>Connect LED pins 1, 2, 4, 5, 6, 7, and 9 as shown in the following table, remembering to insert a 220-ohm resistor between the LED and the Arduino connection. It’s important that the resistors straddle the center break on the breadboard, as shown in the circuit diagram in <a href="ch03.xhtml#ch3fig4">Figure 3-4</a>.</p>&#13;
<table class="all">&#13;
<thead>&#13;
<tr>&#13;
<td class="table_thb" style="vertical-align: middle;"><p class="tablec"><strong>ARDUINO</strong></p></td>&#13;
<td class="table_thr" style="vertical-align: middle;"><p class="tablec"><strong>SEVEN-SEGMENT LED SECTION</strong></p></td>&#13;
<td class="table_thb" style="vertical-align: middle;"><p class="tablec"><strong>SEVEN-SEGMENT LED DISPLAY</strong></p></td>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td class="table_1b" style="vertical-align: top;"><p class="tablec"><span class="blue">Pin 2</span></p></td>&#13;
<td class="table_1" style="vertical-align: top;"><p class="tablec"><span class="blue">A</span></p></td>&#13;
<td class="table_1b" style="vertical-align: top;"><p class="tablec"><span class="blue">Pin 7</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1b" style="vertical-align: top;"><p class="tablec"><span class="blue">Pin 3</span></p></td>&#13;
<td class="table_1" style="vertical-align: top;"><p class="tablec"><span class="blue">B</span></p></td>&#13;
<td class="table_1b" style="vertical-align: top;"><p class="tablec"><span class="blue">Pin 6</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1b" style="vertical-align: top;"><p class="tablec"><span class="blue">Pin 4</span></p></td>&#13;
<td class="table_1" style="vertical-align: top;"><p class="tablec"><span class="blue">C</span></p></td>&#13;
<td class="table_1b" style="vertical-align: top;"><p class="tablec"><span class="blue">Pin 4</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1b" style="vertical-align: top;"><p class="tablec"><span class="blue">Pin 5</span></p></td>&#13;
<td class="table_1" style="vertical-align: top;"><p class="tablec"><span class="blue">D</span></p></td>&#13;
<td class="table_1b" style="vertical-align: top;"><p class="tablec"><span class="blue">Pin 2</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1b" style="vertical-align: top;"><p class="tablec"><span class="blue">Pin 6</span></p></td>&#13;
<td class="table_1" style="vertical-align: top;"><p class="tablec"><span class="blue">E</span></p></td>&#13;
<td class="table_1b" style="vertical-align: top;"><p class="tablec"><span class="blue">Pin 1</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1b" style="vertical-align: top;"><p class="tablec"><span class="blue">Pin 7</span></p></td>&#13;
<td class="table_1" style="vertical-align: top;"><p class="tablec"><span class="blue">F</span></p></td>&#13;
<td class="table_1b" style="vertical-align: top;"><p class="tablec"><span class="blue">Pin 9</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1b" style="vertical-align: top;"><p class="tablec"><span class="blue">Pin 8</span></p></td>&#13;
<td class="table_1" style="vertical-align: top;"><p class="tablec"><span class="blue">G</span></p></td>&#13;
<td class="table_1b" style="vertical-align: top;"><p class="tablec"><span class="blue">Pin 10</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1b" style="vertical-align: top;"><p class="tablec"><span class="blue">Pin 9</span></p></td>&#13;
<td class="table_1" style="vertical-align: top;"><p class="tablec"><span class="blue">DP</span></p></td>&#13;
<td class="table_1b" style="vertical-align: top;"><p class="tablec"><span class="blue">Pin 5</span></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<p class="figcap"><a id="ch3fig4"/><strong>FIGURE 3-4:</strong> The circuit diagram for the seven-segment LED countdown timer</p>&#13;
<div class="image"><img alt="Image" src="../images/f3-04.jpg"/></div></li>&#13;
<li><p class="noindents">Upload the code in “<a href="ch03.xhtml#ch00lev1sec13">The Sketch</a>” on <a href="ch03.xhtml#page_32">page 32</a>.</p></li>&#13;
</ol>&#13;
<h3 class="h3" id="ch00lev1sec13"><span epub:type="pagebreak" id="page_32"/><span class="blue"><strong>THE SKETCH</strong></span></h3>&#13;
<p class="noindent">The sketch starts by defining the digits 0 to 9 as combinations of off (<span class="literal">0</span>) and on (<span class="literal">1</span>) LEDs. The pins controlling the LEDs are set as output, so they can set their corresponding LEDs to either <span class="literal">HIGH</span> or <span class="literal">LOW</span>. The combination of <span class="literal">1</span> and <span class="literal">0</span> values lights up to form the digit.</p>&#13;
<p class="indent">Note that these patterns are for common-cathode displays. For common-anode displays, change each <span class="literal">1</span> to <span class="literal">0</span> and each <span class="literal">0</span> to <span class="literal">1</span>. In the code, a value of <span class="literal">1</span> means the LED is on, and <span class="literal">0</span> means the LED is off.</p>&#13;
<p class="programs1"><span class="ash">// Arduino seven-segment display example software</span><br/><span class="ash">// <a href="http://hacktronics.com/Tutorials/arduino-and-7-segment-led.html">http://hacktronics.com/Tutorials/arduino-and-7-segment-led.html</a></span><br/><span class="ash">// License: <a href="http://www.opensource.org/licenses/mit-license.php">http://www.opensource.org/licenses/mit-license.php</a></span><br/><br/><span class="ash">// Define the LEDs to be lit to create a number</span><br/><span class="green1">byte</span> seven_seg_digits[10][7] = { { 1, 1, 1, 1, 1, 1, 0 }, <span class="ash">// = 0</span><br/>  { 0, 1, 1, 0, 0, 0, 0 }, <span class="ash">// = 1</span><br/>  { 1, 1, 0, 1, 1, 0, 1 }, <span class="ash">// = 2</span><br/>  { 1, 1, 1, 1, 0, 0, 1 }, <span class="ash">// = 3</span><br/>  { 0, 1, 1, 0, 0, 1, 1 }, <span class="ash">// = 4</span><br/>  { 1, 0, 1, 1, 0, 1, 1 }, <span class="ash">// = 5</span><br/>  { 1, 0, 1, 1, 1, 1, 1 }, <span class="ash">// = 6</span><br/>  { 1, 1, 1, 0, 0, 0, 0 }, <span class="ash">// = 7</span><br/>  { 1, 1, 1, 1, 1, 1, 1 }, <span class="ash">// = 8</span><br/>  { 1, 1, 1, 0, 0, 1, 1 }  <span class="ash">// = 9</span><br/>};<br/><br/><span class="ash">// Set the seven-segment LED pins as output</span><br/><span class="green1">void</span> <span class="green2">setup</span>() {<br/>  <span class="orange">pinMode</span>(2, <span class="green1">OUTPUT</span>);<br/>  <span class="orange">pinMode</span>(3, <span class="green1">OUTPUT</span>);<br/>  <span class="orange">pinMode</span>(4, <span class="green1">OUTPUT</span>);<br/>  <span class="orange">pinMode</span>(5, <span class="green1">OUTPUT</span>);<br/>  <span class="orange">pinMode</span>(6, <span class="green1">OUTPUT</span>);<br/>  <span class="orange">pinMode</span>(7, <span class="green1">OUTPUT</span>);<br/>  <span class="orange">pinMode</span>(8, <span class="green1">OUTPUT</span>);<br/>  <span class="orange">pinMode</span>(9, <span class="green1">OUTPUT</span>);<br/>  writeDot(0); <span class="ash">// Start with the decimal point off</span><br/>}<br/><br/><span class="green1">void</span> writeDot(<span class="green1">byte</span> dot) {<br/>  <span class="orange">digitalWrite</span>(9, dot);<br/>}<br/><br/><span class="green1">void</span> sevenSegWrite(<span class="green1">byte</span> digit) {<br/>  <span class="green1">byte</span> pin = 2;<br/>  <span class="green2">for</span> <span class="green1">(byte</span> segCount = 0; segCount &lt; 7; ++segCount) {<br/>    <span class="orange">digitalWrite</span>(pin, seven_seg_digits[digit][segCount]);<br/>    ++pin;<br/>  }<br/>}<br/><span class="green1"><span epub:type="pagebreak" id="page_33"/>void</span> <span class="green2">loop</span>() {<br/>  <span class="green2">for</span> <span class="green1">(byte</span> count = 10; count &gt; 0; --count) { <span class="ash">// Start the countdown</span><br/>    <span class="orange">delay</span>(1000); <span class="ash">// 1 second between each digit</span><br/>    sevenSegWrite(count - 1); <span class="ash">// Counting down by 1</span><br/>  }<br/>  <span class="orange">delay</span>(4000);<br/>}</p>&#13;
<h3 class="h3" id="ch00lev1sec14"><span class="blue"><strong>TROUBLESHOOTING</strong></span></h3>&#13;
<p class="ques"><strong>Q.</strong> <em>Some LED segments do not light up.</em></p>&#13;
<p class="quesp">Check that the LEDs’ wires are inserted securely and line up with the resistors on the breadboard.</p>&#13;
<p class="ques"><strong>Q.</strong> <em>The display is not showing numbers correctly and looks erratic.</em></p>&#13;
<p class="bull">• Recheck that your wiring matches the diagrams as shown, as it’s easy to insert some wires in the wrong place.</p>&#13;
<p class="bull">• If all wiring is in the correct place and the timer’s still not working, the configuration of your seven-segment LED may be different from the one used here. Check the data sheet for your part and use that to direct your circuit along with the seven-segment pin table. You can also check which pin corresponds to each LED by connecting it up: attach the GND pin of the seven-segment LED to the negative end of a battery; connect a jumper wire to the positive end of the battery, via a 220-ohm resistor; and touch each pin in turn to light the segments individually. Note which segment each pin lights up.</p>&#13;
<p class="bull">• Remember, this wiring is for a seven-segment, common-cathode LED; for common-anode displays, change each <span class="literal">1</span> to <span class="literal">0</span> and each <span class="literal">0</span> to <span class="literal">1</span> in the sketch.</p>&#13;


<h2 class="h2s" id="ch04"><span epub:type="pagebreak" id="page_34"/><strong>4<br/>LED Scrolling Marquee</strong></h2>&#13;
<p class="intro"><span class="blue">In this project we’ll use a built-in driver module to create a scrolling message on an 8×8 matrix.</span></p>&#13;
<div class="image"><img alt="Image" src="../images/p0034-01.jpg"/></div>&#13;
<div class="image"><span epub:type="pagebreak" id="page_35"/><img alt="Image" src="../images/p0035-01.jpg"/></div>&#13;
<p class="cap"><strong>PARTS REQUIRED</strong></p>&#13;
<p class="cap1"><strong>Arduino board</strong></p>&#13;
<p class="cap1"><strong>Female-to-male jumper wires</strong></p>&#13;
<p class="cap1"><strong>8×8 LED Maxim 7219 matrix module</strong></p>&#13;
<p class="cap"><strong>LIBRARY REQUIRED</strong></p>&#13;
<p class="cap1"><strong>MaxMatrix</strong></p>&#13;
<h3 class="h3" id="ch00lev1sec15"><span epub:type="pagebreak" id="page_36"/><span class="blue"><strong>HOW IT WORKS</strong></span></h3>&#13;
<p class="noindent">An LED matrix is an array of LEDs that you can control individually to make patterns, text, images, or whatever you can program. The 8×8 LED matrix we’ll use in this project comes prebuilt with a <em>driver module</em>—a board, driven by a Maxim 7219 chip, that lets you control the entire matrix with only five pins connected to your Arduino. These modules are inexpensive and can be chained together so you have multiple matrices running from one sketch.</p>&#13;
<p class="indent">The matrix module has three pins: DIN, CS, and CLK, shown in <a href="ch04.xhtml#ch4fig1">Figure 4-1</a>. <em>DIN</em> stands for Data IN, <em>CS</em> for Chip Select, and <em>CLK</em> for CLocK. The remaining two pins connected to your Arduino power the matrix. The CLK pin senses pulses and controls the speed at which the Arduino and matrix communicate with each other in sync. The matrix uses a <em>serial peripheral interface (SPI)</em> communication protocol to speak with the Arduino, and the CS pin detects which SPI device is in use. DIN reads the data—in this case, the project’s sketch—from the Arduino.</p>&#13;
<p class="figcap"><a id="ch4fig1"/><strong>FIGURE 4-1:</strong> The Maxim 7219 chip controls the LED matrix.</p>&#13;
<div class="image"><img alt="Image" src="../images/f4-01.jpg"/></div>&#13;
<p class="indent">Each module has extra connections so you can add another module. By chaining together modules and changing the number of matrices in the code, you could scroll a message over a larger area.</p>&#13;
<h3 class="h3" id="ch00lev1sec16"><span epub:type="pagebreak" id="page_37"/><span class="blue"><strong>THE BUILD</strong></span></h3>&#13;
<ol>&#13;
<li><p class="noindents">Connect the module directly to the Arduino using the female-to-male jumper wires, connecting the female end to the module. As shown in the following table, connect VCC on the LED matrix module to +5V on the Arduino, GND to GND, DIN to Arduino pin 8, CS to Arduino pin 9, and CLK to Arduino pin 10.</p>&#13;
<table class="all">&#13;
<thead>&#13;
<tr>&#13;
<td class="table_thb" style="vertical-align: top;"><p class="tablec"><strong>LED MATRIX MODULE</strong></p></td>&#13;
<td class="table_th" style="vertical-align: top;"><p class="tablec"><strong>ARDUINO</strong></p></td>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td class="table_1b" style="vertical-align: top;"><p class="tablec"><span class="blue">VCC</span></p></td>&#13;
<td class="table_2" style="vertical-align: top;"><p class="tablec"><span class="blue">+5V</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1b" style="vertical-align: top;"><p class="tablec"><span class="blue">GND</span></p></td>&#13;
<td class="table_2" style="vertical-align: top;"><p class="tablec"><span class="blue">GND</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1b" style="vertical-align: top;"><p class="tablec"><span class="blue">DIN</span></p></td>&#13;
<td class="table_2" style="vertical-align: top;"><p class="tablec"><span class="blue">Pin 8</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1b" style="vertical-align: top;"><p class="tablec"><span class="blue">CS</span></p></td>&#13;
<td class="table_2" style="vertical-align: top;"><p class="tablec"><span class="blue">Pin 9</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1ba" style="vertical-align: top;"><p class="tablec"><span class="blue">CLK</span></p></td>&#13;
<td class="table_2" style="vertical-align: top;"><p class="tablec"><span class="blue">Pin 10</span></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table></li>&#13;
<li><p class="noindents">Confirm that your setup matches the circuit diagram in <a href="ch04.xhtml#ch4fig2">Figure 4-2</a>, and upload the code in “<a href="ch04.xhtml#ch00lev1sec17">The Sketch</a>” on <a href="ch04.xhtml#page_38">page 38</a>.</p>&#13;
<p class="figcap"><a id="ch4fig2"/><strong>FIGURE 4-2:</strong> The circuit diagram for the scrolling LED marquee</p>&#13;
<div class="image"><img alt="Image" src="../images/f4-02.jpg"/></div></li>&#13;
</ol>&#13;
<h3 class="h3" id="ch00lev1sec17"><span epub:type="pagebreak" id="page_38"/><span class="blue"><strong>THE SKETCH</strong></span></h3>&#13;
<p class="noindent">This sketch works by calling on the MaxMatrix library to control the matrix module. We then define the characters to display, and set the Arduino pins that control the matrix. Your message will be displayed in a continuous loop on the LEDs.</p>&#13;
<p class="programs1">#include &lt;MaxMatrix.h&gt; <span class="ash">// Call on the MaxMatrix library</span><br/><br/>PROGMEM <span class="green1">const unsigned char</span> CH[] = {<br/>3, 8, B00000000, B00000000, B00000000, B00000000, B00000000, <span class="ash">// space</span><br/>1, 8, B01011111, B00000000, B00000000, B00000000, B00000000, <span class="ash">// !</span><br/>3, 8, B00000011, B00000000, B00000011, B00000000, B00000000, <span class="ash">// "</span><br/>5, 8, B00010100, B00111110, B00010100, B00111110, B00010100, <span class="ash">// #</span><br/>4, 8, B00100100, B01101010, B00101011, B00010010, B00000000, <span class="ash">// $</span><br/>5, 8, B01100011, B00010011, B00001000, B01100100, B01100011, <span class="ash">// %</span><br/>5, 8, B00110110, B01001001, B01010110, B00100000, B01010000, <span class="ash">// &amp;</span><br/>1, 8, B00000011, B00000000, B00000000, B00000000, B00000000, <span class="ash">// '</span><br/>3, 8, B00011100, B00100010, B01000001, B00000000, B00000000, <span class="ash">// (</span><br/>3, 8, B01000001, B00100010, B00011100, B00000000, B00000000, <span class="ash">// )</span><br/>5, 8, B00101000, B00011000, B00001110, B00011000, B00101000, <span class="ash">// *</span><br/>5, 8, B00001000, B00001000, B00111110, B00001000, B00001000, <span class="ash">// +</span><br/>2, 8, B10110000, B01110000, B00000000, B00000000, B00000000, <span class="ash">// ,</span><br/>4, 8, B00001000, B00001000, B00001000, B00001000, B00000000, <span class="ash">// -</span><br/>2, 8, B01100000, B01100000, B00000000, B00000000, B00000000, <span class="ash">// .</span><br/>4, 8, B01100000, B00011000, B00000110, B00000001, B00000000, <span class="ash">// /</span><br/>4, 8, B00111110, B01000001, B01000001, B00111110, B00000000, <span class="ash">// 0</span><br/>3, 8, B01000010, B01111111, B01000000, B00000000, B00000000, <span class="ash">// 1</span><br/>4, 8, B01100010, B01010001, B01001001, B01000110, B00000000, <span class="ash">// 2</span><br/>4, 8, B00100010, B01000001, B01001001, B00110110, B00000000, <span class="ash">// 3</span><br/>4, 8, B00011000, B00010100, B00010010, B01111111, B00000000, <span class="ash">// 4</span><br/>4, 8, B00100111, B01000101, B01000101, B00111001, B00000000, <span class="ash">// 5</span><br/>4, 8, B00111110, B01001001, B01001001, B00110000, B00000000, <span class="ash">// 6</span><br/>4, 8, B01100001, B00010001, B00001001, B00000111, B00000000, <span class="ash">// 7</span><br/>4, 8, B00110110, B01001001, B01001001, B00110110, B00000000, <span class="ash">// 8</span><br/>4, 8, B00000110, B01001001, B01001001, B00111110, B00000000, <span class="ash">// 9</span><br/>2, 8, B01010000, B00000000, B00000000, B00000000, B00000000, <span class="ash">// :</span><br/>2, 8, B10000000, B01010000, B00000000, B00000000, B00000000, <span class="ash">// ;</span><br/>3, 8, B00010000, B00101000, B01000100, B00000000, B00000000, <span class="ash">// &lt;</span><br/>3, 8, B00010100, B00010100, B00010100, B00000000, B00000000, <span class="ash">// =</span><br/>3, 8, B01000100, B00101000, B00010000, B00000000, B00000000, <span class="ash">// &gt;</span><br/>4, 8, B00000010, B01011001, B00001001, B00000110, B00000000, <span class="ash">// ?</span><br/>5, 8, B00111110, B01001001, B01010101, B01011101, B00001110, <span class="ash">// @</span><br/>4, 8, B01111110, B00010001, B00010001, B01111110, B00000000, <span class="ash">// A</span><br/>4, 8, B01111111, B01001001, B01001001, B00110110, B00000000, <span class="ash">// B</span><br/>4, 8, B00111110, B01000001, B01000001, B00100010, B00000000, <span class="ash">// C</span><br/>4, 8, B01111111, B01000001, B01000001, B00111110, B00000000, <span class="ash">// D</span><br/>4, 8, B01111111, B01001001, B01001001, B01000001, B00000000, <span class="ash">// E</span><br/>4, 8, B01111111, B00001001, B00001001, B00000001, B00000000, <span class="ash">// F</span><br/>4, 8, B00111110, B01000001, B01001001, B01111010, B00000000, <span class="ash">// G</span><br/>4, 8, B01111111, B00001000, B00001000, B01111111, B00000000, <span class="ash">// H</span><br/>3, 8, B01000001, B01111111, B01000001, B00000000, B00000000, <span class="ash">// I</span><br/>4, 8, B00110000, B01000000, B01000001, B00111111, B00000000, <span class="ash">// J</span><br/><span epub:type="pagebreak" id="page_39"/>4, 8, B01111111, B00001000, B00010100, B01100011, B00000000, <span class="ash">// K</span><br/>4, 8, B01111111, B01000000, B01000000, B01000000, B00000000, <span class="ash">// L</span><br/>5, 8, B01111111, B00000010, B00001100, B00000010, B01111111, <span class="ash">// M</span><br/>5, 8, B01111111, B00000100, B00001000, B00010000, B01111111, <span class="ash">// N</span><br/>4, 8, B00111110, B01000001, B01000001, B00111110, B00000000, <span class="ash">// O</span><br/>4, 8, B01111111, B00001001, B00001001, B00000110, B00000000, <span class="ash">// P</span><br/>4, 8, B00111110, B01000001, B01000001, B10111110, B00000000, <span class="ash">// Q</span><br/>4, 8, B01111111, B00001001, B00001001, B01110110, B00000000, <span class="ash">// R</span><br/>4, 8, B01000110, B01001001, B01001001, B00110010, B00000000, <span class="ash">// S</span><br/>5, 8, B00000001, B00000001, B01111111, B00000001, B00000001, <span class="ash">// T</span><br/>4, 8, B00111111, B01000000, B01000000, B00111111, B00000000, <span class="ash">// U</span><br/>5, 8, B00001111, B00110000, B01000000, B00110000, B00001111, <span class="ash">// V</span><br/>5, 8, B00111111, B01000000, B00111000, B01000000, B00111111, <span class="ash">// W</span><br/>5, 8, B01100011, B00010100, B00001000, B00010100, B01100011, <span class="ash">// X</span><br/>5, 8, B00000111, B00001000, B01110000, B00001000, B00000111, <span class="ash">// Y</span><br/>4, 8, B01100001, B01010001, B01001001, B01000111, B00000000, <span class="ash">// Z</span><br/>2, 8, B01111111, B01000001, B00000000, B00000000, B00000000, <span class="ash">// [</span><br/>4, 8, B00000001, B00000110, B00011000, B01100000, B00000000, <span class="ash">// \</span><br/>2, 8, B01000001, B01111111, B00000000, B00000000, B00000000, <span class="ash">// ]</span><br/>3, 8, B00000010, B00000001, B00000010, B00000000, B00000000, <span class="ash">// hat</span><br/>4, 8, B01000000, B01000000, B01000000, B01000000, B00000000, <span class="ash">// _</span><br/>2, 8, B00000001, B00000010, B00000000, B00000000, B00000000, <span class="ash">// `</span><br/>4, 8, B00100000, B01010100, B01010100, B01111000, B00000000, <span class="ash">// a</span><br/>4, 8, B01111111, B01000100, B01000100, B00111000, B00000000, <span class="ash">// b</span><br/>4, 8, B00111000, B01000100, B01000100, B00101000, B00000000, <span class="ash">// c</span><br/>4, 8, B00111000, B01000100, B01000100, B01111111, B00000000, <span class="ash">// d</span><br/>4, 8, B00111000, B01010100, B01010100, B00011000, B00000000, <span class="ash">// e</span><br/>3, 8, B00000100, B01111110, B00000101, B00000000, B00000000, <span class="ash">// f</span><br/>4, 8, B10011000, B10100100, B10100100, B01111000, B00000000, <span class="ash">// g</span><br/>4, 8, B01111111, B00000100, B00000100, B01111000, B00000000, <span class="ash">// h</span><br/>3, 8, B01000100, B01111101, B01000000, B00000000, B00000000, <span class="ash">// i</span><br/>4, 8, B01000000, B10000000, B10000100, B01111101, B00000000, <span class="ash">// j</span><br/>4, 8, B01111111, B00010000, B00101000, B01000100, B00000000, <span class="ash">// k</span><br/>3, 8, B01000001, B01111111, B01000000, B00000000, B00000000, <span class="ash">// l</span><br/>5, 8, B01111100, B00000100, B01111100, B00000100, B01111000, <span class="ash">// m</span><br/>4, 8, B01111100, B00000100, B00000100, B01111000, B00000000, <span class="ash">// n</span><br/>4, 8, B00111000, B01000100, B01000100, B00111000, B00000000, <span class="ash">// o</span><br/>4, 8, B11111100, B00100100, B00100100, B00011000, B00000000, <span class="ash">// p</span><br/>4, 8, B00011000, B00100100, B00100100, B11111100, B00000000, <span class="ash">// q</span><br/>4, 8, B01111100, B00001000, B00000100, B00000100, B00000000, <span class="ash">// r</span><br/>4, 8, B01001000, B01010100, B01010100, B00100100, B00000000, <span class="ash">// s</span><br/>3, 8, B00000100, B00111111, B01000100, B00000000, B00000000, <span class="ash">// t</span><br/>4, 8, B00111100, B01000000, B01000000, B01111100, B00000000, <span class="ash">// u</span><br/>5, 8, B00011100, B00100000, B01000000, B00100000, B00011100, <span class="ash">// v</span><br/>5, 8, B00111100, B01000000, B00111100, B01000000, B00111100, <span class="ash">// w</span><br/>5, 8, B01000100, B00101000, B00010000, B00101000, B01000100, <span class="ash">// x</span><br/>4, 8, B10011100, B10100000, B10100000, B01111100, B00000000, <span class="ash">// y</span><br/>3, 8, B01100100, B01010100, B01001100, B00000000, B00000000, <span class="ash">// z</span><br/>3, 8, B00001000, B00110110, B01000001, B00000000, B00000000, <span class="ash">// {</span><br/>1, 8, B01111111, B00000000, B00000000, B00000000, B00000000, <span class="ash">// |</span><br/>3, 8, B01000001, B00110110, B00001000, B00000000, B00000000, <span class="ash">// }</span><br/>4, 8, B00001000, B00000100, B00001000, B00000100, B00000000, <span class="ash">// ~</span><br/>};<br/><span epub:type="pagebreak" id="page_40"/><br/>  <span class="green1">int</span> data = 8;   <span class="ash">// Pin connected to DIN pin of MAXIM7219 module</span><br/>  <span class="green1">int</span> load = 9;   <span class="ash">// Pin connected to CS pin of MAXIM7219 module</span><br/>  <span class="green1">int</span> <span class="orange">clock</span> = 10; <span class="ash">// Pin connected to CLK pin of MAXIM7219 module</span><br/><br/><span class="ent">➊</span> <span class="green1">int</span> maxInUse = 1; <span class="ash">// Set the number of matrices you are using</span><br/>  MaxMatrix m(data, load, <span class="orange">clock</span>, maxInUse); <span class="ash">// Define the module</span><br/>  <span class="green1">byte</span> <span class="orange">buffer</span>[10];<br/><br/>  <span class="ash">// Set message to scroll on the screen</span><br/><span class="ent">➋</span> <span class="green1">char</span> string1[] = <span class="green1">" Arduino Project Handbook . . . "</span>;<br/>  <span class="green1">void</span> <span class="green2">setup</span>() {<br/>    m.init(); <span class="ash">// Start module</span><br/>    m.setIntensity(0);<br/>    <span class="orange">Serial</span>.<span class="orange">begin</span>(9600); <span class="ash">// Start serial communication</span><br/>  }<br/><br/>  <span class="green1">void</span> <span class="green2">loop</span>() {<br/>    <span class="green1">byte</span> c;<br/>    <span class="green2">while</span> (<span class="orange">Serial</span>.<span class="orange">available</span>() &gt; 0) {<br/>      <span class="green1">byte</span> c = <span class="orange">Serial</span>.<span class="orange">read</span>();<br/>      <span class="orange">Serial</span>.<span class="orange">println</span>(c, <span class="green1">DEC</span>);<br/>      printCharWithShift(c, 100);<br/>    }<br/>    <span class="orange">delay</span>(100);<br/>    m.shiftLeft(false, true);<br/>    printStringWithShift(string1, 100);<br/>  }<br/><br/>  <span class="ash">// The remainder of this sketch moves the scrolling characters</span><br/>  <span class="ash">// depending on the number of matrices that are attached</span><br/>  <span class="green1">void</span> printCharWithShift(<span class="green1">char</span> c, <span class="green1">int</span> shift_speed) {<br/>    <span class="green2">if</span> (c &lt; 32) <span class="green2">return</span>;<br/>    c -= 32;<br/>    memcpy_P(<span class="orange">buffer</span>, CH + 7 * c, 7);<br/>    m.writeSprite(maxInUse * 8, 0, <span class="orange">buffer</span>);<br/>    m.setColumn(maxInUse * 8 + <span class="orange">buffer</span>[0], 0);<br/>    <span class="green2">for</span> (<span class="green1">int</span> i = 0; i &lt; <span class="orange">buffer</span>[0] + 1; i++) {<br/>      <span class="orange">delay</span>(shift_speed);<br/>      m.shiftLeft(false, false);<br/>    }<br/>  }<br/><br/>  <span class="green1">void</span> printStringWithShift(<span class="green1">char</span>* s, int shift_speed) {<br/>    <span class="green2">while</span> (*s != 0) {<br/>      printCharWithShift(*s, shift_speed);<br/>      s++;<br/>    }<br/>  }<br/><br/> <span class="green1">void</span> printString(<span class="green1">char</span>* s) {<br/>   <span class="green1">int</span> col = 0;<br/><span epub:type="pagebreak" id="page_41"/>   <span class="green2">while</span> (*s != 0) {<br/>     <span class="green2">if</span> (*s &lt; 32) <span class="green2">continue</span>;<br/>     <span class="green1">char</span> c = *s - 32;<br/>     memcpy_P(<span class="orange">buffer</span>, CH + 7 * c, 7);<br/>     m.writeSprite(col, 0, <span class="orange">buffer</span>);<br/>     m.setColumn(col + <span class="orange">buffer</span>[0], 0);<br/>     col += <span class="orange">buffer</span>[0] + 1;<br/>     s++;<br/>   }<br/>}</p>&#13;
<p class="indent">You can change the message on the LED matrix by altering the text inside the quotation marks at <span class="ent">➋</span>. If you want to chain your matrices together, change the number at <span class="ent">➊</span> to the number you have (the maximum number of matrices you can chain together is seven).</p>&#13;
<h3 class="h3" id="ch00lev1sec18"><span class="blue"><strong>TROUBLESHOOTING</strong></span></h3>&#13;
<p class="ques"><strong>Q.</strong> <em>The matrix does not light up or the LED shows erratic symbols.</em></p>&#13;
<p class="bull">• If none of the LEDs light, make sure you have connected the matrix as shown in the circuit diagram in <a href="ch04.xhtml#ch4fig2">Figure 4-2</a>; the pins must match exactly.</p>&#13;
<p class="bull">• Make sure that your Arduino is powered and the TX light is flashing. If not, recheck your batteries or power supply.</p>&#13;
<p class="bull">• Make sure the Maxim 7219 chip is securely inserted in the module.</p>&#13;


<h2 class="h2s" id="ch05"><span epub:type="pagebreak" id="page_42"/><strong>5<br/>Mood Light</strong></h2>&#13;
<p class="intro"><span class="blue">In this project we’ll create a soothing mood light using a single multicolored LED.</span></p>&#13;
<div class="image"><img alt="Image" src="../images/p0042-01.jpg"/></div>&#13;
<div class="image"><span epub:type="pagebreak" id="page_43"/><img alt="Image" src="../images/p0043-01.jpg"/></div>&#13;
<p class="cap"><strong>PARTS REQUIRED</strong></p>&#13;
<p class="cap1"><strong>Arduino board</strong></p>&#13;
<p class="cap1"><strong>Breadboard</strong></p>&#13;
<p class="cap1"><strong>Jumper wires</strong></p>&#13;
<p class="cap1"><strong>RGB common-cathode LED</strong></p>&#13;
<p class="cap1"><strong>3 220-ohm resistors</strong></p>&#13;
<h3 class="h3" id="ch00lev1sec19"><span epub:type="pagebreak" id="page_44"/><span class="blue"><strong>HOW IT WORKS</strong></span></h3>&#13;
<p class="noindent">LEDs come in many different colors and forms, but one of the most useful is the RGB LED. As its name implies, an RGB LED is actually three LEDs in one: red, green, and blue (see <a href="ch05.xhtml#ch5fig1">Figure 5-1</a>).</p>&#13;
<p class="figcap"><a id="ch5fig1"/><strong>FIGURE 5-1:</strong> The primary colors of the RGB LED</p>&#13;
<div class="image"><img alt="Image" src="../images/f5-01.jpg"/></div>&#13;
<p class="indent">RGB is an <em>additive</em> color model, which means that by combining the light of two or more colors we can create other colors. Red, green, and blue are the additive primary colors used as the base for other colors, as shown in <a href="ch05.xhtml#ch5fig2">Figure 5-2</a>.</p>&#13;
<p class="figcap"><span epub:type="pagebreak" id="page_45"/><a id="ch5fig2"/><strong>FIGURE 5-2:</strong> RGB is an additive color model.</p>&#13;
<div class="image"><img alt="Image" src="../images/f5-02.jpg"/></div>&#13;
<p class="indent">Let’s look at an RGB LED in a bit more detail in <a href="ch05.xhtml#ch5fig3">Figure 5-3</a>.</p>&#13;
<p class="figcap"><a id="ch5fig3"/><strong>FIGURE 5-3:</strong> An RGB LED</p>&#13;
<div class="image"><img alt="Image" src="../images/f5-03.jpg"/></div>&#13;
<p class="indent">You’ll see that the RGB LED has four legs instead of the usual two: one each for red, green, and blue, and the fourth one is either the cathode or anode. We’ll be using a <em>common-cathode</em> RGB LED like the one in the figure, where the longest leg is the cathode and connects to ground.</p>&#13;
<p class="indent">We can use our RGB LED to create a random-color output that cycles through the colors of the rainbow, fading each one in and out. This lighting effect is used quite often in clubs or bars to create a relaxing mood. You could also place the LED in an opaque vase or box for a soothing night-light.</p>&#13;
<h3 class="h3" id="ch00lev1sec20"><span class="blue"><strong>THE BUILD</strong></span></h3>&#13;
<ol>&#13;
<li><p class="noindents">Begin by placing the common-cathode RGB LED into your breadboard with the red leg in the hole to the left of the long GND (or cathode) leg. Connect a 220-ohm resistor to each of the three color legs.</p>&#13;
<div class="noter">&#13;
<p class="notet"><strong>NOTE</strong></p>&#13;
<p class="notep"><em>On some RGB LEDs the green and blue legs are the other way around.</em></p>&#13;
</div></li>&#13;
<li><p class="noindents">Connect the red leg to Arduino pin 11, GND to Arduino GND, green to Arduino pin 10, and blue to Arduino pin 9.</p>&#13;
<table class="all">&#13;
<thead>&#13;
<tr>&#13;
<td class="table_thb" style="vertical-align: top;"><span epub:type="pagebreak" id="page_46"/><p class="tablec"><strong>COMMON-CATHODE RGB LED</strong></p></td>&#13;
<td class="table_th" style="vertical-align: top;"><p class="tablec"><strong>ARDUINO</strong></p></td>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td class="table_1b" style="vertical-align: top;"><p class="tablec"><span class="blue">Red</span></p></td>&#13;
<td class="table_2" style="vertical-align: top;"><p class="tablec"><span class="blue">Pin 11</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1b" style="vertical-align: top;"><p class="tablec"><span class="blue">GND</span></p></td>&#13;
<td class="table_2" style="vertical-align: top;"><p class="tablec"><span class="blue">GND</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1b" style="vertical-align: top;"><p class="tablec"><span class="blue">Green</span></p></td>&#13;
<td class="table_2" style="vertical-align: top;"><p class="tablec"><span class="blue">Pin 10</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1ba" style="vertical-align: top;"><p class="tablec"><span class="blue">Blue</span></p></td>&#13;
<td class="table" style="vertical-align: top;"><p class="tablec"><span class="blue">Pin 9</span></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table></li>&#13;
<li><p class="noindents">Confirm that your setup matches the circuit diagram in <a href="ch05.xhtml#ch5fig4">Figure 5-4</a>, and upload the code in “<a href="ch05.xhtml#ch00lev1sec21">The Sketch</a>” on <a href="ch05.xhtml#page_47">page 47</a>.</p>&#13;
<p class="figcap"><a id="ch5fig4"/><strong>FIGURE 5-4:</strong> The circuit diagram for the mood light</p>&#13;
<div class="image"><img alt="Image" src="../images/f5-04.jpg"/></div></li>&#13;
</ol>&#13;
<h3 class="h3" id="ch00lev1sec21"><span epub:type="pagebreak" id="page_47"/><span class="blue"><strong>THE SKETCH</strong></span></h3>&#13;
<p class="noindent">The sketch first sets Arduino pins 9, 10, and 11 as outputs. This sketch varies the brightness (power) value of each light on the RGB LED in turn by switching them on and off incredibly quickly—the longer an LED is lit for, the brighter it appears. To do this the Arduino uses a technique called <em>pulse width modulation (PWM)</em>. The Arduino creates a pulse by switching the power on and off very quickly. The duration that the power is on or off (known as the <em>pulse width</em>) in the cycle determines the average output, and by varying this pulse width the Arduino can simulate voltages between full on (5 volts) and off (0 volts). If the signal from the Arduino is on for half the time and off for half, the average output will be 2.5 volts, halfway between 0 and 5. If the signal is on for 80 percent and off for 20 percent, the voltage is 4 volts, and so on.</p>&#13;
<p class="indent">We define an RGB value between <span class="literal">0</span> and <span class="literal">255</span>, with an increment of <span class="literal">5</span> volts, to create a fade effect. In simple terms, each color of the LED brightens from 0 to 5 volts in sequence, and then fades out when it reaches its maximum value of <span class="literal">255</span>. The Arduino can handle values between <span class="literal">0</span> and <span class="literal">1023</span> (1,024 values in total), but because this is such a high number we divide it by 4 and use <span class="literal">255</span> as the maximum LED value so the color change is more noticeable.</p>&#13;
<p class="programs1"><span class="green1">int</span> redPin = 11;   <span class="ash">// Pin connected to red leg of the RGB LED</span><br/><span class="green1">int</span> greenPin = 10; <span class="ash">// Pin connected to green leg of the RGB LED</span><br/><span class="green1">int</span> bluePin = 9;   <span class="ash">// Pin connected to blue leg of the RGB LED</span><br/><br/><span class="green1">void</span> <span class="green2">setup</span>() {<br/>  setRgb(0, 0, 0); <span class="ash">// Set all colors at 0</span><br/>}<br/><br/><span class="green1">void</span> <span class="green2">loop</span>() {<br/>  <span class="green1">int</span> Rgb[3]; <span class="ash">// 3 RGB pins</span><br/><br/>  Rgb[0] = 0; <span class="ash">// A value for each</span><br/>  Rgb[1] = 0;<br/>  Rgb[2] = 0;<br/><br/>  <span class="ash">// Colors increase and decrease in value</span><br/>  <span class="green2">for</span> (<span class="green1">int</span> decrease = 0; decrease &lt; 3; decrease += 1) {<br/>    <span class="green1">int</span> increase = decrease == 2 ? 0 : decrease + 1;<br/><br/>    <span class="green2">for</span> (<span class="green1">int</span> i = 0; i &lt; 255; i += 1) { <span class="ash">// Fade the colors</span><br/>      Rgb[decrease] -= 1;<br/>      Rgb[increase] += 1;<br/>      setRgb(Rgb[0], Rgb[1], Rgb[2]);<br/>      <span class="orange">delay</span>(20);<br/>    }<br/><span epub:type="pagebreak" id="page_48"/>  }<br/>}<br/><br/><span class="green1">void</span> setRgb (<span class="green1">int</span> red, <span class="green1">int</span> green, <span class="green1">int</span> blue) {<br/>  <span class="orange">analogWrite</span>(redPin, red);<br/>  <span class="orange">analogWrite</span>(greenPin, green);<br/>  <span class="orange">analogWrite</span>(bluePin, blue);<br/>}</p>&#13;
<h3 class="h3" id="ch00lev1sec22"><span class="blue"><strong>TROUBLESHOOTING</strong></span></h3>&#13;
<p class="ques"><strong>Q.</strong> <em>The code compiles, but the RGB LED does not light up as expected.</em></p>&#13;
<p class="bull">• If the RGB LED does not light at all, make sure you’ve connected the GND wire from the Arduino to the correct leg on the RGB LED—the long cathode leg—and that the Arduino has power connected.</p>&#13;
<p class="bull">• If you have a common-anode RGB LED, then you should connect the long leg to +5V on the Arduino. Check the data sheet for your part to find out which kind of RGB LED you have.</p>&#13;
<p class="bull">• If the colors don’t appear as expected, your RGB LED may have a different pin configuration; check your data sheet or try swapping the connections to the green and blue legs around.</p>&#13;


<h2 class="h2s" id="ch06"><span epub:type="pagebreak" id="page_49"/><strong>6<br/>Rainbow Strip Light</strong></h2>&#13;
<p class="intro"><span class="blue">In this chapter we’ll use an RGB LED strip light to create a decorative ambient strip of rainbow colors.</span></p>&#13;
<div class="image"><img alt="Image" src="../images/p0049-01.jpg"/></div>&#13;
<div class="image"><span epub:type="pagebreak" id="page_50"/><img alt="Image" src="../images/p0050-01.jpg"/></div>&#13;
<p class="cap"><strong>PARTS REQUIRED</strong></p>&#13;
<p class="cap1"><strong>Arduino board</strong></p>&#13;
<p class="cap1"><strong>Solid-core wires</strong></p>&#13;
<p class="cap1"><strong>RGB LED strip (WS2812B 5V 32-LED strip)</strong></p>&#13;
<p class="cap"><strong>LIBRARY REQUIRED</strong></p>&#13;
<p class="cap1"><strong>PololuLedStrip</strong></p>&#13;
<h3 class="h3" id="ch00lev1sec23"><span epub:type="pagebreak" id="page_51"/><span class="blue"><strong>HOW IT WORKS</strong></span></h3>&#13;
<p class="noindent">LED strip lights are often used to create ambiance as a decorative feature, such as backlighting for a TV or lighting beneath kitchen cabinets. They are low-powered, typically between 5 and 12 volts, so they’re easy to install anywhere with their own power supply—and they look good too!</p>&#13;
<p class="indent">Strip lights generally come in two varieties. Single-color or multicolor <em>nonaddressable</em> strips can only light all the LEDs in one color at a time. RGB multicolored strips are generally <em>addressable</em>, which means that each LED has its own chip and can be individually controlled, allowing multiple colors on different LEDs to light at a time.</p>&#13;
<p class="indent">We’ll be using a strip light of addressable RGB LEDs. Unlike the RGB LED from Project 5, the LEDs on a strip light are <em>surface mounted</em>. This means that the components are placed directly onto the surface of a printed circuit board—in this case, a flexible strip—rather than being individually inserted into a circuit.</p>&#13;
<p class="indent">There are two main kinds of addressable RGB strip lights. Three-pin RGB LED strips have GND, Data, and +5V connections to control the LEDs. The Data pin connects to the Arduino and uses the same <em>pulse width modulation (PWM)</em> function explained in Project 5 to create the colors and sequence on the strip. Four-pin RGB LED strips have GND, Clock, Data In, and +5V connections and use <em>Serial Peripheral Interface (SPI)</em> to control their LEDs. SPI is a communication method that allows the two-way transfer of data between devices.</p>&#13;
<p class="indent">Our addressable RGB LED strip, shown in <a href="ch06.xhtml#ch6fig1">Figure 6-1</a>, is the three-pin type using PWM. It calls on the PololuLedStrip library, created by Pololu Robotics and Electronics (<em><a href="https://www.pololu.com/">https://www.pololu.com/</a></em>), to control the LEDs.</p>&#13;
<p class="figcap"><a id="ch6fig1"/><strong>FIGURE 6-1:</strong> A three-pin addressable RGB LED strip light</p>&#13;
<div class="image"><img alt="Image" src="../images/f6-01.jpg"/></div>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_52"/>We’ll use our RGB LED strip to create a color output that cycles through the colors of the rainbow, fading each color in and out, as shown in <a href="ch06.xhtml#ch6fig2">Figure 6-2</a>.</p>&#13;
<p class="figcap"><a id="ch6fig2"/><strong>FIGURE 6-2:</strong> RGB LED strip cycling through the colors of the rainbow</p>&#13;
<div class="image"><img alt="Image" src="../images/f6-02.jpg"/></div>&#13;
<h3 class="h3" id="ch00lev1sec24"><span class="blue"><strong>THE BUILD</strong></span></h3>&#13;
<ol>&#13;
<li><p class="noindents">Download and add the PololuLedStrip library to your Arduino IDE (check the primer for guidance on saving libraries).</p></li>&#13;
<li><p class="noindents">The setup for this project is very simple and doesn’t take long to complete. Most three-pin addressable RGB LED strips come without wires attached to the strip connections, so you’ll have to connect them. With the LEDs facing upward, begin by soldering solid-core wire to the three connections at the left end of the strip, as shown in <a href="ch06.xhtml#ch6fig3">Figure 6-3</a>.</p>&#13;
<p class="figcap"><a id="ch6fig3"/><strong>FIGURE 6-3:</strong> Soldering wires to the left-side connections</p>&#13;
<div class="image"><img alt="Image" src="../images/f6-03.jpg"/></div></li>&#13;
<li><p class="noindents">Connect the LED’s GND pin to Arduino GND, DI to Arduino pin 12, and +5V to Arduino +5V, as shown in the following table.</p>&#13;
<table class="all">&#13;
<thead>&#13;
<tr>&#13;
<td class="table_thb" style="vertical-align: top;"><p class="tablec"><strong>RGB LED STRIP</strong></p></td>&#13;
<td class="table_th" style="vertical-align: top;"><p class="tablec"><strong>ARDUINO</strong></p></td>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td class="table_1b" style="vertical-align: top;"><p class="tablec"><span class="blue">GND</span></p></td>&#13;
<td class="table_2" style="vertical-align: top;"><p class="tablec"><span class="blue">GND</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1b" style="vertical-align: top;"><p class="tablec"><span class="blue">DI (data in)</span></p></td>&#13;
<td class="table_2" style="vertical-align: top;"><p class="tablec"><span class="blue">Pin 12</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1ba" style="vertical-align: top;"><p class="tablec"><span class="blue">+5V</span></p></td>&#13;
<td class="table" style="vertical-align: top;"><p class="tablec"><span class="blue">+5V</span></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table></li>&#13;
<li><p class="noindents"><span epub:type="pagebreak" id="page_53"/>Check your setup against the circuit diagram in <a href="ch06.xhtml#ch6fig4">Figure 6-4</a>, and then upload the code in “<a href="ch06.xhtml#ch00lev1sec25">The Sketch</a>” below and power the Arduino using your battery pack.</p>&#13;
<p class="figcap"><a id="ch6fig4"/><strong>FIGURE 6-4:</strong> The circuit diagram for the rainbow strip light</p>&#13;
<div class="image"><img alt="Image" src="../images/f6-04.jpg"/></div></li>&#13;
</ol>&#13;
<h3 class="h3" id="ch00lev1sec25"><span class="blue"><strong>THE SKETCH</strong></span></h3>&#13;
<p class="noindent">The sketch first calls on the PololuLedStrip library, which we use to control the individual LEDs. Next, it defines the pin to control the data going from the Arduino to the LED strip as 12 and sets the number of LEDs on the strip to 32—you would change this if your strip had a different number of LEDs.</p>&#13;
<p class="indent">Next is a calculation to control the hue, saturation, and value (HSV) of our LEDs to generate the RGB colors. You can change these using an HSV chart if you want; just do a quick internet search to find a chart for reference.</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_54"/>The WS2812B data sheet states that the color of each LED is encoded as three LED brightness values, which must be sent in GRB (green-red-blue) order. The first color transmitted applies to the LED that is closest to the data input connector, the second color transmitted applies to the next LED in the strip, and so on.</p>&#13;
<p class="programs1"><span class="ash">/* PololuLedStrip Library Copyright (c) 2012 Pololu Corporation.</span><br/><span class="ash">For more information, see <a href="http://www.pololu.com/">http://www.pololu.com/</a>;</span><br/><span class="ash"><a href="http://forum.pololu.com/">http://forum.pololu.com/</a></span><br/><br/><span class="ash">Permission is hereby granted, free of charge, to any person</span><br/><span class="ash">obtaining a copy of this software and associated documentation files</span><br/><span class="ash">(the "Software"), to deal in the Software without restriction,</span><br/><span class="ash">including without limitation the rights to use, copy, modify, merge,</span><br/><span class="ash">publish, distribute, sublicense, and/or sell copies of the Software,</span><br/><span class="ash">and to permit persons to whom the Software is furnished to do so,</span><br/><span class="ash">subject to the following conditions:</span><br/><span class="ash">The above copyright notice and this permission notice shall be</span><br/><span class="ash">included in all copies or substantial portions of the Software.</span><br/><br/><span class="ash">THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,</span><br/><span class="ash">EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES</span><br/><span class="ash">OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NON</span><br/><span class="ash">INFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS</span><br/><span class="ash">BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN</span><br/><span class="ash">ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN</span><br/><span class="ash">CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE</span><br/><span class="ash">SOFTWARE.</span><br/><br/><span class="ash">LedStripRainbow: Example Arduino sketch that shows how to make a</span><br/><span class="ash">moving rainbow pattern on an Addressable RGB LED Strip from Pololu.</span><br/><span class="ash">To use this, you will need to plug an Addressable RGB LED strip from</span><br/><span class="ash">Pololu into pin 12.  After uploading the sketch, you should see a</span><br/><span class="ash">moving rainbow. */</span><br/><br/>#include &lt;PololuLedStrip.h&gt;<br/><br/><span class="ash">// Create an ledStrip object and specify the pin it will use.</span><br/>PololuLedStrip&lt;12&gt; ledStrip;<br/><br/><span class="ash">// Create a buffer for holding the colors (3 bytes per color).</span><br/>#define LED_COUNT 32<br/>rgb_color colors[LED_COUNT];<br/><br/><span class="green1">void</span> <span class="green2">setup</span>() {<br/>}<br/><br/><span class="ash">// Converts a color from HSV to RGB.</span><br/><span class="ash">// h is hue, as a number between 0 and 360.</span><br/><span class="ash">// s is saturation, as a number between 0 and 255.</span><br/><span class="ash">// v is value, as a number between 0 and 255.</span><br/><span epub:type="pagebreak" id="page_55"/><br/>rgb_color hsvToRgb(<span class="green1">uint16_t</span> h, <span class="green1">uint8_t</span> s, <span class="green1">uint8_t</span> v) {<br/>  <span class="green1">uint8_t</span> f = (h % 60) * 255 / 60;<br/>  <span class="green1">uint8_t</span> p = (255 - s) * (<span class="green1">uint16_t</span>)v / 255;<br/>  <span class="green1">uint8_t</span> q = (255 - f * (<span class="green1">uint16_t</span>)s / 255) * (<span class="green1">uint16_t</span>)v / 255;<br/>  <span class="green1">uint8_t</span> t = (255 - (255 - f) * <span class="green1">(uint16_t</span>)s / 255) * <span class="green1">(uint16_t</span>)v / 255;<br/>  <span class="green1">uint8_t</span> r = 0, g = 0, b = 0;<br/>  <span class="green2">switch</span>((h / 60) % 6) {<br/>    <span class="green2">case</span> 0: r = v; g = t; b = p; <span class="green2">break</span>;<br/>    <span class="green2">case</span> 1: r = q; g = v; b = p; <span class="green2">break</span>;<br/>    <span class="green2">case</span> 2: r = p; g = v; b = t; <span class="green2">break</span>;<br/>    <span class="green2">case</span> 3: r = p; g = q; b = v; <span class="green2">break</span>;<br/>    <span class="green2">case</span> 4: r = t; g = p; b = v; <span class="green2">break</span>;<br/>    <span class="green2">case</span> 5: r = v; g = p; b = q; <span class="green2">break</span>;<br/>  }<br/>  <span class="green2">return</span> (rgb_color) {<br/>    r, g, b<br/>  };<br/>}<br/><br/><span class="green1">void</span> <span class="green2">loop</span>() {<br/>  <span class="ash">// Update the colors.</span><br/>  <span class="green1">uint16_t</span> <span class="orange">time</span> = <span class="orange">millis</span>() &gt;&gt; 2;<br/>  <span class="green2">for</span> <span class="green1">(uint16_t</span> i = 0; i &lt; LED_COUNT; i++) {<br/>    <span class="green1">byte</span> x = (<span class="orange">time</span> &gt;&gt; 2) - (i &lt;&lt; 3);<br/>    colors[i] = hsvToRgb((<span class="green1">uint32_t</span>)x * 359 / 256, 255, 255);<br/>  }<br/><br/>  <span class="ash">// Write the colors to the LED strip.</span><br/>  ledStrip.<span class="orange">write</span>(colors, LED_COUNT);<br/>  <span class="orange">delay</span>(10);<br/>}</p>&#13;
<h3 class="h3" id="ch00lev1sec26"><span class="blue"><strong>TROUBLESHOOTING</strong></span></h3>&#13;
<p class="ques"><strong>Q.</strong> <em>The code compiles, but the RGB LED does not light up as expected.</em></p>&#13;
<p class="bull">• If the RGB LED strip does not light, make sure that your wires are connected as shown in <a href="ch06.xhtml#ch6fig4">Figure 6-4</a>, and that your LED strip is the WS2812B type specified.</p>&#13;
<p class="bull">• If you aren’t doing so already, use an external power source for the RGB LED strip.</p>&#13;


<h2 class="h2s" id="ch07"><span epub:type="pagebreak" id="page_56"/><strong>7<br/>NeoPixel Compass</strong></h2>&#13;
<p class="intro"><span class="blue">In this chapter we’ll use a three-axis sensor and an RGB LED ring to create a compass that indicates north by lighting the LEDs in that direction.</span></p>&#13;
<div class="image"><img alt="Image" src="../images/p0056-01.jpg"/></div>&#13;
<div class="image"><span epub:type="pagebreak" id="page_57"/><img alt="Image" src="../images/p0057-01.jpg"/></div>&#13;
<p class="cap"><strong>PARTS REQUIRED</strong></p>&#13;
<p class="cap1"><strong>Arduino board</strong></p>&#13;
<p class="cap1"><strong>Jumper wires</strong></p>&#13;
<p class="cap1"><strong>HMC5883L three-axis sensor</strong></p>&#13;
<p class="cap1"><strong>Adafruit NeoPixel ring with 16 RGB LEDs</strong></p>&#13;
<p class="cap1"><strong>9V battery pack with 6 AA batteries</strong></p>&#13;
<p class="cap"><strong>LIBRARIES REQUIRED</strong></p>&#13;
<p class="cap1"><strong>Wire</strong></p>&#13;
<p class="cap1"><strong>FastLED</strong></p>&#13;
<p class="cap1"><strong>HMC5883L</strong></p>&#13;
<h3 class="h3" id="ch00lev1sec27"><span epub:type="pagebreak" id="page_58"/><span class="blue"><strong>HOW IT WORKS</strong></span></h3>&#13;
<p class="noindent">The HMC5883L three-axis sensor (<a href="ch07.xhtml#ch7fig1">Figure 7-1</a>) is a multichip module that senses magnetic force. The module measures both the direction and the magnitude of Earth’s magnetic fields. We will use the HMC5883L library to turn our project into an electronic compass.</p>&#13;
<p class="figcap"><a id="ch7fig1"/><strong>FIGURE 7-1:</strong> The HMC5883L three-axis module runs on 3.3V rather than 5V.</p>&#13;
<div class="image"><img alt="Image" src="../images/f7-01.jpg"/></div>&#13;
<p class="indent">Earth’s magnetic field is believed to be generated by electric currents in the conductive material of its core that are created by heat escaping. Since Earth is effectively a magnet, the north end of a compass magnet is drawn to align with its magnetic field.</p>&#13;
<p class="indent">To visualize our compass direction we will use the Adafruit NeoPixel ring, shown in <a href="ch07.xhtml#ch7fig2">Figure 7-2</a>. The NeoPixel ring is made up of 16 RGB LEDs, each of which has its own driver chip and so can be controlled individually. A single data line controls the LEDs, and we’ll use the FastLED library to control the colors.</p>&#13;
<p class="figcap"><a id="ch7fig2"/><strong>FIGURE 7-2:</strong> The Adafruit 16 RGB NeoPixel ring</p>&#13;
<div class="image"><img alt="Image" src="../images/f7-02.jpg"/></div>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_59"/>When the project is powered up, the HMC5883L module will detect magnetic north and display it on the NeoPixel ring by lighting the LEDs in that direction. If you turn around while holding the powered NeoPixel compass, the LED lights will move to always point north.</p>&#13;
<h3 class="h3" id="ch00lev1sec28"><span class="blue"><strong>THE BUILD</strong></span></h3>&#13;
<div class="noter">&#13;
<p class="notet"><strong>NOTE</strong></p>&#13;
<p class="notep"><em>The pin labeled DRDY on the compass module is not used in this project.</em></p>&#13;
</div>&#13;
<p class="noindent">Your HMC5883L module may arrive with the header pins loose, so the first step is to solder the header pins into the module. You will need the strip of five header pins that should come with the module. Insert the header pins into the five available holes on the module and solder each pin for a couple of seconds (check the “<a href="pref02.xhtml#ch00lev1sec123">Quick Soldering Guide</a>” on <a href="pref02.xhtml#page_12">page 12</a> if you need help). The module communicates with the Arduino using I2C and the Wire library.</p>&#13;
<ol>&#13;
<li><p class="noindents">In order to use the compass properly you need to calibrate the HMC5883L module. Connect the module to the Arduino as shown in the following table.</p>&#13;
<table class="all">&#13;
<thead>&#13;
<tr>&#13;
<td class="table_thb" style="vertical-align: top;"><p class="tablec"><strong>HMC5883L MODULE</strong></p></td>&#13;
<td class="table_th" style="vertical-align: top;"><p class="tablec"><strong>ARDUINO</strong></p></td>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td class="table_1b" style="vertical-align: top;"><p class="tablec"><span class="blue">VCC</span></p></td>&#13;
<td class="table_2" style="vertical-align: top;"><p class="tablec"><span class="blue">+3.3V</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1b" style="vertical-align: top;"><p class="tablec"><span class="blue">GND</span></p></td>&#13;
<td class="table_2" style="vertical-align: top;"><p class="tablec"><span class="blue">GND</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1b" style="vertical-align: top;"><p class="tablec"><span class="blue">SCL</span></p></td>&#13;
<td class="table_2" style="vertical-align: top;"><p class="tablec"><span class="blue">Pin A5 (SLC)</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1ba" style="vertical-align: top;"><p class="tablec"><span class="blue">SDA</span></p></td>&#13;
<td class="table" style="vertical-align: top;"><p class="tablec"><span class="blue">Pin A4 (SDA)</span></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table></li>&#13;
<li><p class="noindents">Download the HMC5883L library and add it to the Arduino library folder on your PC. Check the library section in the primer if you need a reminder of how to do this. Once you have the library saved, restart your Arduino IDE. When it opens again, it should have the library saved in <em>Examples</em>. Select <strong>File</strong> ▸ <strong>Examples</strong> ▸ <strong>Arduino-HMC5883L-Master</strong> ▸ <strong>HMC5883L_calibrate</strong>. If you can’t see the sketch, make sure you’ve saved the library in your Arduino library folder. The following sketch will be shown in the IDE main window:</p>&#13;
<p class="programs1"><span class="ash">/*</span><br/>   <span class="ash">Calibrate HMC5883L. Output for HMC5883L_calibrate_processing.pde</span><br/>   <span class="ash">Read more: <a href="http://www.jarzebski.pl/arduino/czujniki-i-sensory/3-osiowy-magnetometr-hmc5883l.html">http://www.jarzebski.pl/arduino/czujniki-i-sensory/3-osiowy-magnetometr-hmc5883l.html</a></span><br/>   <span class="ash">GIT: <a href="https://github.com/jarzebski/Arduino-HMC5883L">https://github.com/jarzebski/Arduino-HMC5883L</a></span><br/>   <span class="ash">Web: <a href="http://www.jarzebski.pl">http://www.jarzebski.pl</a></span><br/>   <span class="ash">(c) 2014 by Korneliusz Jarzebski</span><br/><span class="ash">*/</span><br/><span epub:type="pagebreak" id="page_60"/><br/>#include &lt;<span class="orange">Wire</span>.h&gt;<br/>#include &lt;HMC5883L.h&gt;<br/><br/>HMC5883L compass;<br/><br/><span class="green1">int</span> minX = 0;<br/><span class="green1">int</span> maxX = 0;<br/><span class="green1">int</span> minY = 0;<br/><span class="green1">int</span> maxY = 0;<br/><span class="green1">int</span> offX = 0;<br/><span class="green1">int</span> offY = 0;<br/><br/><span class="green1">void</span> <span class="green2">setup</span>() {<br/>  <span class="orange">Serial</span>.<span class="orange">begin</span>(9600);<br/><br/>  <span class="ash">// Initialize Initialize HMC5883L</span><br/>  <span class="green2">while</span> (!compass.<span class="orange">begin</span>()) {<br/>    <span class="orange">delay</span>(500);<br/>  }<br/>  <span class="ash">// Set measurement range</span><br/>  compass.setRange(HMC5883L_RANGE_1_3GA);<br/>  <span class="ash">// Set measurement mode</span><br/>  compass.setMeasurementMode(HMC5883L_CONTINOUS);<br/>  <span class="ash">// Set data rate</span><br/>  compass.setDataRate(HMC5883L_DATARATE_30HZ);<br/>  <span class="ash">// Set number of samples averaged</span><br/>  compass.setSamples(HMC5883L_SAMPLES_8);<br/>}<br/><br/><span class="green1">void</span> <span class="green2">loop</span>() {<br/>  Vector mag = compass.readRaw();<br/>  <span class="ash">// Determine Min / Max values</span><br/>  <span class="green2">if</span> (mag.XAxis &lt; minX) minX = mag.XAxis;<br/>  <span class="green2">if</span> (mag.XAxis &gt; maxX) maxX = mag.XAxis;<br/>  <span class="green2">if</span> (mag.YAxis &lt; minY) minY = mag.YAxis;<br/>  <span class="green2">if</span> (mag.YAxis &gt; maxY) maxY = mag.YAxis;<br/><br/>  <span class="ash">// Calculate offsets</span><br/>  offX = (maxX + minX)/2;<br/>  offY = (maxY + minY)/2;<br/><br/>  <span class="codestrong">/*Serial.print(mag.XAxis);</span><br/>  <span class="codestrong">Serial.print(":");</span><br/>  <span class="codestrong">Serial.print(mag.YAxis);</span><br/>  <span class="codestrong">Serial.print(":");</span><br/>  <span class="codestrong">Serial.print(minX);</span><br/>  <span class="codestrong">Serial.print(":");</span><br/>  <span class="codestrong">Serial.print(maxX);</span><br/>  <span class="codestrong">Serial.print(":");</span><br/>  <span class="codestrong">Serial.print(minY);</span><br/>  <span class="codestrong">Serial.print(":");</span><br/>  <span class="codestrong">Serial.print(maxY);</span><br/>  <span class="codestrong">Serial.print(":"); */</span><br/><span epub:type="pagebreak" id="page_61"/>  <span class="orange">Serial</span>.<span class="orange">print</span>(offX);<br/>  <span class="orange">Serial</span>.<span class="orange">print</span>(<span class="green1">":"</span>);<br/>  <span class="orange">Serial</span>.<span class="orange">print</span>(offY);<br/>  <span class="orange">Serial</span>.<span class="orange">print</span>(<span class="green1">"\n"</span>);<br/>}</p></li>&#13;
<li><p class="noindents">We only need the X and Y <span class="literal">Serial.print</span> lines in this last bunch of <span class="literal">Serial.print</span> commands, so comment out the <span class="literal">Serial.print</span> lines of the sketch shown in bold. Upload the sketch to the Arduino and open the Serial Monitor. A series of numbers will display, as shown in <a href="ch07.xhtml#ch7fig3">Figure 7-3</a>.</p>&#13;
<p class="figcap"><a id="ch7fig3"/><strong>FIGURE 7-3:</strong> The calibration numbers will be shown in the IDE Serial Monitor window.</p>&#13;
<div class="image"><img alt="Image" src="../images/f7-03.jpg"/></div></li>&#13;
<li><p class="noindents">Rotate the sensor 360 degrees while it’s connected to the Arduino IDE Serial Monitor, and you should see two digits displayed; in <a href="ch07.xhtml#ch7fig3">Figure 7-3</a>, they’re 13 and –294. You’ll need these calibration numbers in the sketch later, so make a note of them.</p></li>&#13;
<li><p class="noindents">You can improve the accuracy of your compass by finding the <em>magnetic declination</em> for your location. The magnetic declination, or variation, is the angle on the horizontal plane between magnetic north (where a compass points) and true north (the direction toward the geographic North Pole). You can find your magnetic declination by visiting <em><a href="http://www.magnetic-declination.com/">http://www.magnetic-declination.com/</a></em> and entering your location in the search bar at the top left. Your result will appear as shown in <a href="ch07.xhtml#ch7fig4">Figure 7-4</a>.</p>&#13;
<p class="figcap"><span epub:type="pagebreak" id="page_62"/><a id="ch7fig4"/><strong>FIGURE 7-4:</strong> The magnetic declination for your location can be found at <em><a href="http://www.magnetic-declination.com/">http://www.magnetic-declination.com/</a></em>.</p>&#13;
<div class="image"><img alt="Image" src="../images/f7-04.jpg"/></div></li>&#13;
<li><p class="noindents">The values you need are the magnetic declination and the declination; in <a href="ch07.xhtml#ch7fig4">Figure 7-4</a>, they’re –2° 26' and NEGATIVE (WEST), respectively, but yours will be different. Record these values too, as we’ll use them in the sketch at the end of the project—with one minor change. For example, my values were –2 and 26. We don’t put the negative (minus) sign before the first value but instead put it after, like so:</p>&#13;
<p class="programs1">  float declinationAngle = (2 - (26.0 / 60.0)) / (180 / M_PI);</p>&#13;
<p class="indent">If your location’s declination were POSITIVE (WEST), then you would add the positive (plus) sign instead:</p>&#13;
<p class="programs1">  float declinationAngle = (2 + (26.0 / 60.0)) / (180 / M_PI);</p>&#13;
<p class="indent">Next, add the NeoPixel ring to the Arduino by connecting V on the NeoPixel to +5V on the Arduino, GND to GND, and In on the NeoPixel to pin 3 on the Arduino.</p>&#13;
<table class="all">&#13;
<thead>&#13;
<tr>&#13;
<td class="table_thb" style="vertical-align: top;"><p class="tablec"><strong>NEOPIXEL</strong></p></td>&#13;
<td class="table_th" style="vertical-align: top;"><p class="tablec"><strong>ARDUINO</strong></p></td>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td class="table_1b" style="vertical-align: top;"><p class="tablec"><span class="blue">V</span></p></td>&#13;
<td class="table_2" style="vertical-align: top;"><p class="tablec"><span class="blue">+5V</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1b" style="vertical-align: top;"><p class="tablec"><span class="blue">GND</span></p></td>&#13;
<td class="table_2" style="vertical-align: top;"><p class="tablec"><span class="blue">GND</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1ba" style="vertical-align: top;"><p class="tablec"><span class="blue">In</span></p></td>&#13;
<td class="table" style="vertical-align: top;"><p class="tablec"><span class="blue">Pin 3</span></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table></li>&#13;
<li><p class="noindents"><span epub:type="pagebreak" id="page_63"/>Check your setup against the circuit diagram in <a href="ch07.xhtml#ch7fig5">Figure 7-5</a>, and then upload the code in “<a href="ch07.xhtml#ch00lev1sec29">The Sketch</a>” below.</p>&#13;
<p class="figcap"><a id="ch7fig5"/><strong>FIGURE 7-5:</strong> The circuit diagram for the NeoPixel compass</p>&#13;
<div class="image"><img alt="Image" src="../images/f7-05.jpg"/></div></li>&#13;
</ol>&#13;
<h3 class="h3" id="ch00lev1sec29"><span class="blue"><strong>THE SKETCH</strong></span></h3>&#13;
<p class="noindent">First we call on the Wire, FastLED, and HMC5883L libraries. The Wire library is installed with the Arduino IDE, but you need to add the others. Download them in the book’s resources at <em><a href="http://www.nostarch.com/arduinohandbook2/">http://www.nostarch.com/arduinohandbook2/</a></em>, and follow the guide in the primer for more information on adding libraries.</p>&#13;
<p class="indent">Next we declare the number of LEDs on the NeoPixel ring (16) and assign pin 3 on the Arduino to control it. We then call on a number of settings in the HMC5883L library to control the compass module. At <span class="ent">➊</span> we add the compass offset values for <span class="literal">X</span> and <span class="literal">Y</span>, which should match your calibration from Step 4 earlier; mine were 13, –294, respectively. At <span class="ent">➋</span> we add the magnetic declination from Step 6. Again, remember to change it to the one for your location.</p>&#13;
<p class="indent">The next set of calculations allows the sensor to map to a 360-degree rotation. Then we set the LEDs on the NeoPixel to move depending on the readings of the sensor to point north. Three LEDs are lit: one red LED that points north and a green LED on either side of it. The compass is best used outdoors with the module, away from any strong electrical or magnetic sources, and should be powered from a battery pack rather than a USB connection.</p>&#13;
<p class="programs1"><span class="ash">// Code by brainy-bits.com and used with kind permission</span><br/><span class="ash">// <a href="https://brainy-bits.com/tutorials/find-your-way-using-the-hmc5883l/">https://brainy-bits.com/tutorials/find-your-way-using-the-hmc5883l/</a></span><br/><br/>#include &lt;<span class="orange">Wire</span>.h&gt;<br/>#include <span class="green1">"FastLED.h"</span><br/>#include &lt;HMC5883L.h&gt;<br/><span epub:type="pagebreak" id="page_64"/><br/>#define NUM_LEDS 16  <span class="ash">// Number of LEDs on Ring</span><br/>#define DATA_PIN_RING 3 <span class="ash">// Pin 3 connected to RGB Ring</span><br/><br/>CRGB leds_RING[NUM_LEDS];<br/><br/>HMC5883L compass;<br/><span class="green1">int</span> fixedHeadingDegrees; <span class="ash">// Used to store Heading value</span><br/><br/><span class="green1">void</span> <span class="green2">setup</span>() {<br/>  <span class="orange">Serial</span>.<span class="orange">begin</span>(9600);<br/>  <span class="orange">Wire</span>.<span class="orange">begin</span>(); <span class="ash">//Setup I2C</span><br/>  <span class="ash">// Set up the FastLED library with the neopixel ring data</span><br/>  FastLED.addLeds&lt;NEOPIXEL,DATA_PIN_RING&gt;(leds_RING, NUM_LEDS);<br/><br/>  <span class="ash">// Set measurement range</span><br/>  compass.setRange(HMC5883L_RANGE_1_3GA);<br/><br/>  <span class="ash">// Set measurement mode</span><br/>  compass.setMeasurementMode(HMC5883L_CONTINOUS);<br/><br/>  <span class="ash">// Set data rate</span><br/>  compass.setDataRate(HMC5883L_DATARATE_30HZ);<br/><br/>  <span class="ash">// Set number of samples averaged</span><br/>  compass.setSamples(HMC5883L_SAMPLES_8);<br/><br/>  <span class="ash">// Set calibration offset. See HMC5883L_calibration.ino</span><br/><span class="ent">➊</span> compass.setOffset(13, -224);<br/> }<br/><br/> <span class="green1">void</span> <span class="green2">loop</span>() {<br/>   Vector norm = compass.readNormalize();<br/><br/>   <span class="ash">// Calculate heading</span><br/>   <span class="green1">float</span> heading = <span class="orange">atan2</span>(norm.YAxis, norm.XAxis);<br/><br/>   <span class="ash">// Set declination angle on your location and fix heading</span><br/>   <span class="ash">// Find your declination on http://magnetic-declination.com/</span><br/>   <span class="ash">// (+) Positive or (-) for negative</span><br/>   <span class="ash">// For Dumfries, Scotland declination angle is -2 '26W (negative)</span><br/>   <span class="ash">// Formula: (deg + (min / 60.0)) / (180 / M_PI);</span><br/>   <span class="green1">float</span> declinationAngle = (2.0 – (26.0 / 60.0)) / (180 / M_PI);<br/><span class="ent">➋</span>  heading -= declinationAngle;<br/><br/>   <span class="ash">// Correct for heading &lt; 0deg and heading &gt; 360deg</span><br/>   <span class="green2">if</span> (heading &lt; 0) {<br/>     heading += 2 * <span class="green1">PI</span>;<br/>   }<br/><br/>   if (heading &gt; 2 * <span class="green1">PI</span>) {<br/>     heading -= 2 * <span class="green1">PI</span>;<br/>   }<br/><span epub:type="pagebreak" id="page_65"/><br/>   <span class="ash">// Convert to degrees</span><br/>   <span class="green1">float</span> headingDegrees = heading * 180 / M_PI;<br/><br/>   <span class="ash">// To fix rotation speed of HMC5883L compass module</span><br/>   <span class="green2">if</span> (headingDegrees &gt;= 1 &amp;&amp; headingDegrees &lt; 240) {<br/>     fixedHeadingDegrees = <span class="orange">map</span>(headingDegrees * 100, 0, 239 * 100, 0, 179 * 100) / 100.00;<br/>   }<br/>   <span class="green2">else</span> {<br/>     <span class="green2">if</span> (headingDegrees &gt;= 240) {<br/>       fixedHeadingDegrees = <span class="orange">map</span>(headingDegrees*100, 240*100, 360*100, 180*100, 360*100) / 100.00;<br/>     }<br/>   }<br/><br/>   <span class="green1">int</span> headvalue = fixedHeadingDegrees / 18;<br/>   <span class="green1">int</span> ledtoheading = <span class="orange">map</span>(headvalue, 0, 15, 15, 0);<br/><br/>   <span class="ash">// Clear the ring</span><br/>   FastLED.<span class="orange">clear</span>();<br/><br/>   <span class="ash">// New heading</span><br/>   <span class="green2">if</span> (ledtoheading == 0) {<br/>     leds_RING[15] = CRGB::Red;<br/>     leds_RING[0] = CRGB::Green;<br/>     leds_RING[14] = CRGB::Green;<br/>   }<br/>   <span class="green2">else</span> {<br/>     <span class="green2">if</span> (ledtoheading == 15) {<br/>       leds_RING[0] = CRGB::Red;<br/>       leds_RING[15] = CRGB::Green;<br/>       leds_RING[1] = CRGB::Green;<br/>     }<br/>     <span class="green2">else</span> {<br/>       leds_RING[ledtoheading] = CRGB::Red;<br/>       leds_RING[ledtoheading+1] = CRGB::Green;<br/>       leds_RING[ledtoheading-1] = CRGB::Green;<br/>     }<br/>   }<br/><br/>   FastLED.setBrightness(50);<br/>   FastLED.show();<br/>   <span class="orange">delay</span>(100);<br/>}</p>&#13;
<h3 class="h3" id="ch00lev1sec30"><span epub:type="pagebreak" id="page_66"/><span class="blue"><strong>TROUBLESHOOTING</strong></span></h3>&#13;
<p class="ques"><strong>Q.</strong> <em>The code compiles, but the RGB LEDs do not light up as expected.</em></p>&#13;
<p class="bull">• If no LEDs are lit, double-check your wiring, particularly that the data pin of the NeoPixel is connected to pin 3 on the Arduino.</p>&#13;
<p class="bull">• Check that your power for the NeoPixel is connected to GND and +5V. The compass module should be connected to GND and +3.3V. The Arduino should be powered by your battery pack, not the USB cable from your PC.</p>&#13;
<p class="bull">• Make sure you have calibrated the module and entered the values using the steps shown earlier. The compass module should be held horizontally and in line with the RGB ring. The ring and the module should always be moved together.</p>&#13;
<p class="bull">• The module is best used outdoors, as it is very sensitive to metal and electrical interference.</p>&#13;
<p class="bull">• Try to keep the power for your Arduino and the sensor as far apart as possible to avoid interference.</p>&#13;
</body></html>