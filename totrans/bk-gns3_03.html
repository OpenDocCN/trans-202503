<html><head></head><body><div class="chapter" title="Chapter&#xA0;3.&#xA0;Configuration"><div class="titlepage"><div><div><h1 class="title"><a id="configuration"/>Chapter 3. Configuration</h1></div></div></div><p><a id="iddle1198" class="indexterm"/><a id="iddle1214" class="indexterm"/><a id="iddle1491" class="indexterm"/><a id="iddle1566" class="indexterm"/>Installing GNS3 is only the first step on the road to creating projects; the second step is configuration. Fortunately, GNS3 has never been easier to configure, and you need to perform only a few tasks. In this chapter, I’ll cover the basic GNS3 configuration options you need to get IOS routers up and running using Dynamips.</p><div class="sect1" title="Acquiring an IOS Image"><div class="titlepage"><div><div><h1 class="title"><a id="acquiring_an_ios_image"/>Acquiring an IOS Image</h1></div></div></div><p>The virtual Dynamips routers provided by GNS3 are emulated hardware devices. Like a freshly formatted PC hard drive, your virtual routers are patiently waiting for you to install an operating system so they can do something useful. What they need is Cisco IOS!</p><p><a id="iddle1244" class="indexterm"/><a id="iddle1319" class="indexterm"/><a id="iddle1397" class="indexterm"/><a id="iddle1554" class="indexterm"/><a id="iddle1569" class="indexterm"/><a id="iddle2137" class="indexterm"/>Before you can boot up a router, you’ll need to install and configure at least one Cisco IOS image file in GNS3, though you’re on your own when it comes to acquiring one. IOS is the intellectual property of Cisco Systems and not ordinarily available to the public. Additionally, because the GNS3 developers have no affiliation with Cisco, they can’t legally supply you with an IOS image either (so please don’t ask).</p><p>The simplest way to acquire an IOS image file is to copy an image from a Cisco router that you own. The upside to this approach is that you’re not stealing an image; you already have an IOS image that’s licensed for your router. The downside is that GNS3 supports only a few models out of the hundreds that Cisco manufactures, and your router may not be one of them. (See <a class="xref" href="apb.html" title="Appendix B. Cisco Hardware Compatible with GNS3">Appendix B</a> for a complete list of compatible Cisco routers and hardware configurations.)</p><p>To copy an IOS image file from a router to a workstation, log on to your router and use the Cisco <code class="literal">copy</code> command to copy the image file from your router’s flash memory to an FTP server. If you don’t know the name of your IOS image file, you can use the <code class="literal">show flash</code> command on your router. In the following example, the IOS image filename is <span class="emphasis"><em>c7200-ios-version.bin</em></span>; my FTP server is running on a PC with the IP address 192.168.1.25, and my FTP username and password are <span class="emphasis"><em>jason</em></span> and <span class="emphasis"><em>mypass</em></span>, respectively.</p><a id="pro_id00015"/><pre class="programlisting"># <span class="strong"><strong>copy flash:c7200-ios-version.bin ftp://jason:mypass@192.168.1.25</strong></span></pre><p>When the command is executed from the router, the image file will be copied from the router’s flash memory to an FTP server running on 192.168.1.25 using the supplied credentials.</p><p>If you want to use TFTP instead, download a free TFTP server from the Jounin website (<span class="emphasis"><em><a class="ulink" href="http://tftpd32.jounin.net/">http://tftpd32.jounin.net/</a></em></span>). When the server is installed and running, use the following <code class="literal">tftp</code> command to copy the file from your router to your TFTP server:</p><a id="pro_id00016"/><pre class="programlisting"># <span class="strong"><strong>copy flash:c7200-ios-version.bin tftp</strong></span>
Address or name of remote host []? <span class="strong"><strong>192.168.1.25</strong></span>
Destination filename [c7200-ios-version.bin]? <span class="strong"><strong>&lt;enter&gt;</strong></span></pre><p>Press <span class="smaller">ENTER</span> after <code class="literal">Destination filename [c7200-ios-version.bin]</code> to complete the copy.</p><p>If, on the other hand, you don’t own a Cisco router, there are more unsavory ways to find IOS image files, as you’ll surely find with a simple Internet search. While companies like Cisco and Juniper have turned a blind eye to this sort of thing in the past (as long as the software is used only for educational purposes), you may not want to use a bootleg version of Cisco IOS. Such images may work just fine, but there’s always the possibility that they contain malware or have been tampered with in unexpected ways.</p><p><a id="iddle1206" class="indexterm"/><a id="iddle1316" class="indexterm"/><a id="iddle1328" class="indexterm"/><a id="iddle1576" class="indexterm"/><a id="iddle1587" class="indexterm"/><a id="iddle1752" class="indexterm"/>Lastly, if you work for a large company that happens to be a Cisco partner, you should be able to log on to the Cisco website using your partner credentials and get any IOS image you desire. Be aware that this sort of activity could be grounds for marching you to the corporate gallows, so get permission before using your company account.</p><p>However you obtain an IOS image, you can use only image files that are designed for router models supported by GNS3, and some IOS versions for a given model may work better than others. If you find that a Dynamips router is acting persnickety, try swapping the IOS for a different version because this often corrects the problem.</p><div class="note" title="Note"><h3 class="title"><a id="ch03note01"/>Note</h3><p><span class="emphasis"><em>In general, stay away from c26xx images because they seem to be the least stable!</em></span></p></div><p>Choosing the right router and IOS image is critical to creating stable projects. Recommended IOS versions are c36xx, c37xx, and c7200 (but not the c7200p) because these are the most stable versions for Dynamips and GNS3. Consider the IOS version number, as well. While new IOS versions provide the latest bells and whistles, older versions tend to use fewer PC resources, such as processor power and memory. If you’re creating simple projects for CCNA study, you might want to use an older IOS from the 12.2 or 12.3 train to conserve resources, but if you’re studying for your CCIE, you might need to install the newest IOS available.</p></div><div class="sect1" title="Setting Up Your First IOS Router"><div class="titlepage"><div><div><h1 class="title"><a id="setting_up_your_first_ios_router"/>Setting Up Your First IOS Router</h1></div></div></div><p>Once you have an IOS image, you need to do a few things before you can start using your virtual routers. First, verify the path to Dynamips (this is specific to Linux). Next, copy your IOS images to a folder and then add the images to GNS3. Finally, set an Idle-PC value for each IOS image that you’ve added to GNS3. I’ll walk you through these steps now.</p><div class="sect2" title="Configuring Dynamips"><div class="titlepage"><div><div><h2 class="title"><a id="configuring_dynamips"/>Configuring Dynamips</h2></div></div></div><p>On Windows and OS X, the preferences should be set up for you, but on Linux you should verify that the path to the Dynamips application is correct. Go to <span class="strong"><strong>Edit</strong></span> ▸ <span class="strong"><strong>Preferences</strong></span>, select <span class="strong"><strong>Dynamips</strong></span>, and click the <span class="strong"><strong>General settings</strong></span> tab, as shown in <a class="xref" href="ch03.html#dynamips_preferencescomma_general_settin" title="Figure 3-1. Dynamips preferences, General settings tab">Figure 3-1</a>.</p><p>Verify that the Path to Dynamips field points to <span class="emphasis"><em>/usr/local/bin/dynamips</em></span>. If you’ve installed the Dynamips application in some other directory, set the path to that directory instead.</p><div class="figure"><a id="dynamips_preferencescomma_general_settin"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00009"/><img src="httpatomoreillycomsourcenostarchimages2208887.png.jpg" alt="Dynamips preferences, General settings tab"/></div></div><p class="title">Figure 3-1. Dynamips preferences, General settings tab</p></div><p><a id="iddle1027" class="indexterm"/><a id="iddle1331" class="indexterm"/><a id="iddle1401" class="indexterm"/>Next, click the <span class="strong"><strong>Advanced settings</strong></span> tab to display the settings in <a class="xref" href="ch03.html#dynamips_preferencescomma_advanced_setti" title="Figure 3-2. Dynamips preferences, Advanced settings tab">Figure 3-2</a>.</p><div class="figure"><a id="dynamips_preferencescomma_advanced_setti"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00010"/><img src="httpatomoreillycomsourcenostarchimages2208889.png.jpg" alt="Dynamips preferences, Advanced settings tab"/></div></div><p class="title">Figure 3-2. Dynamips preferences, Advanced settings tab</p></div><p><a id="iddle1199" class="indexterm"/><a id="iddle1259" class="indexterm"/><a id="iddle1342" class="indexterm"/><a id="iddle1343" class="indexterm"/><a id="iddle1345" class="indexterm"/><a id="iddle1407" class="indexterm"/><a id="iddle1567" class="indexterm"/><a id="iddle1572" class="indexterm"/><a id="iddle1584" class="indexterm"/><a id="iddle1593" class="indexterm"/><a id="iddle1782" class="indexterm"/><a id="iddle1793" class="indexterm"/><a id="iddle1821" class="indexterm"/><a id="iddle2156" class="indexterm"/>The Dynamips Advanced settings options mostly relate to Dynamips stability and memory usage. As a rule you shouldn’t change them, but I’ll discuss the options so you can decide for yourself.</p><p>The Memory usage optimisation settings are all about conserving memory in your PC. The less memory Dynamips uses per router, the more routers you can add to your projects. The Enable ghost IOS support option reduces memory consumption in your PC by allocating one shared region of memory that multiple routers can use, as long as they’re running the same IOS image. This is a good reason to use the same router model multiple times in a project; using several different models, with different IOS versions, will eat up more of your PC’s memory. The Enable mmap support option allows the contents of router memory to be written to a file on your hard drive, similar to a cache or swap file. The Enable sparse memory support option reduces the amount of virtual memory used by your routers so you can run more router instances per Dynamips process.</p></div><div class="sect2" title="Adding IOS Images to GNS3"><div class="titlepage"><div><div><h2 class="title"><a id="adding_ios_images_to_gns3"/>Adding IOS Images to GNS3</h2></div></div></div><p>Before you start creating projects using IOS routers, add at least one IOS image to GNS3. To add an IOS image, select <span class="strong"><strong>Edit</strong></span> ▸ <span class="strong"><strong>Preferences</strong></span> on Windows and Linux, or select <span class="strong"><strong>GNS3</strong></span> ▸ <span class="strong"><strong>Preferences</strong></span> on OS X. Expand <span class="strong"><strong>Dynamips</strong></span> from the pane on the left and click <span class="strong"><strong>IOS routers</strong></span>, as shown in <a class="xref" href="ch03.html#ios_routers_preferences" title="Figure 3-3. IOS routers preferences">Figure 3-3</a>.</p><div class="figure"><a id="ios_routers_preferences"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00011"/><img src="httpatomoreillycomsourcenostarchimages2208891.png.jpg" alt="IOS routers preferences"/></div></div><p class="title">Figure 3-3. IOS routers preferences</p></div><p>Click <span class="strong"><strong>New</strong></span> to start the wizard and then click the <span class="strong"><strong>Browse</strong></span> button to locate your image file. After selecting your image file, you’ll be asked whether you would like to decompress the IOS image, as shown in <a class="xref" href="ch03.html#deciding_whether_to_decompress_the_ios_i" title="Figure 3-4. Deciding whether to decompress the IOS image">Figure 3-4</a>.</p><div class="figure"><a id="deciding_whether_to_decompress_the_ios_i"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00012"/><img src="httpatomoreillycomsourcenostarchimages2208893.png.jpg" alt="Deciding whether to decompress the IOS image"/></div></div><p class="title">Figure 3-4. Deciding whether to decompress the IOS image</p></div><p>It’s a good idea to let GNS3 decompress your image files; otherwise, your routers will have to decompress the images every time a router loads. Decompressing the images ahead of time will make your routers boot much faster. After decompressing your image, click <span class="strong"><strong>Next</strong></span>, and GNS3 will attempt to recognize the router platform that your IOS belongs to, as shown in <a class="xref" href="ch03.html#name_and_platform_screen" title="Figure 3-5. Name and platform screen">Figure 3-5</a>.</p><div class="figure"><a id="name_and_platform_screen"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00013"/><img src="httpatomoreillycomsourcenostarchimages2208895.png.jpg" alt="Name and platform screen"/></div></div><p class="title">Figure 3-5. Name and platform screen</p></div><p>GNS3 has determined that my image file belongs to a c3745 router platform and has automatically named it <span class="emphasis"><em>c3745</em></span>. If you think this is incorrect, you can use the Platform drop-down menu to choose another platform, but in my experience, GNS3 does a good job of getting this correct. You can change the name of your router to anything you like by entering a name in the Name field.</p><p><a id="iddle1111" class="indexterm"/><a id="iddle1142" class="indexterm"/><a id="iddle1578" class="indexterm"/><a id="iddle1784" class="indexterm"/><a id="iddle1841" class="indexterm"/><a id="iddle2044" class="indexterm"/>In general, from here, you can just click through all the configuration settings to configure a basic router model, but the wizard provides opportunities for you to customize router memory and other features during this process. For now, click <span class="strong"><strong>Next</strong></span> to continue. You should be presented with the Memory screen, shown in <a class="xref" href="ch03.html#ios_memory_screen" title="Figure 3-6. IOS Memory screen">Figure 3-6</a>.</p><div class="figure"><a id="ios_memory_screen"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00014"/><img src="httpatomoreillycomsourcenostarchimages2208897.png.jpg" alt="IOS Memory screen"/></div></div><p class="title">Figure 3-6. IOS Memory screen</p></div><p>Your routers should run fine with the default memory setting. But if you’re unsure, click <span class="strong"><strong>Check for minimum RAM requirements</strong></span>, and GNS3 will launch a web browser and take you to the Cisco Feature Navigator web page at <span class="emphasis"><em><a class="ulink" href="http://www.cisco.com/">http://www.cisco.com/</a></em></span>. From here, you can search for your IOS image’s specific memory requirements. Enter that value in the Default RAM field. When you’re done, click <span class="strong"><strong>Next</strong></span>, and you will be presented with the Network adapters screen, as shown in <a class="xref" href="ch03.html#network_adapters_screen" title="Figure 3-7. Network adapters screen">Figure 3-7</a>.</p><div class="figure"><a id="network_adapters_screen"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00015"/><img src="httpatomoreillycomsourcenostarchimages2208899.png.jpg" alt="Network adapters screen"/></div></div><p class="title">Figure 3-7. Network adapters screen</p></div><p>The default setting configures your router with the same standard options that are provided with a real model of the same Cisco router. If you would like to add more interfaces, use the drop-down menu next to the available slots and choose the desired network modules. The slot options <a id="iddle1109" class="indexterm"/><a id="iddle1207" class="indexterm"/><a id="iddle1249" class="indexterm"/><a id="iddle1470" class="indexterm"/><a id="iddle1472" class="indexterm"/><a id="iddle1589" class="indexterm"/><a id="iddle1734" class="indexterm"/><a id="iddle1773" class="indexterm"/><a id="iddle1777" class="indexterm"/><a id="iddle1805" class="indexterm"/><a id="iddle1913" class="indexterm"/>will be limited to actual options that are available in the real version of the Cisco router. When you’re done, click <span class="strong"><strong>Next</strong></span> and choose any WIC modules that you would like to install. Then click <span class="strong"><strong>Next</strong></span> again to display the Idle-PC screen, shown in <a class="xref" href="ch03.html#idle-pc_screen" title="Figure 3-8. Idle-PC screen">Figure 3-8</a>.</p><div class="figure"><a id="idle-pc_screen"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00016"/><img src="httpatomoreillycomsourcenostarchimages2208901.png.jpg" alt="Idle-PC screen"/></div></div><p class="title">Figure 3-8. Idle-PC screen</p></div><p>If you start a router in GNS3 without an Idle-PC setting, your computer’s CPU usage will quickly spike to 100 percent and remain there. This happens because Dynamips doesn’t yet know whether your virtual router is doing something that requires system resources, so it overcompensates by giving it all the resources it can. GNS3 will run sluggishly until this is corrected, and if CPU usage is left at 100 percent for a long time, your PC’s processor could overheat.</p><p>You can easily fix this by having GNS3 look for places in the IOS program code where an idle loop exists (idle loops cause the CPU to spike); the result of this calculation is called an <span class="emphasis"><em>Idle-PC value</em></span>. When the proper Idle-PC value is applied, Dynamips should periodically <span class="emphasis"><em>sleep</em></span> the router when these idle loops are executed, which greatly reduces CPU usage. If you don’t care about all the details, just remember that the Idle-PC value is what keeps Dynamips from eating your processor for lunch.</p><p>To have GNS3 automatically find a value, click the <span class="strong"><strong>Idle-PC finder</strong></span> button, and GNS3 will attempt to search for a value. If GNS3 finds a suitable value, then you’re done; click <span class="strong"><strong>Finish</strong></span>. If it’s unsuccessful, leave the field blank and click <span class="strong"><strong>Next</strong></span> to save the router without an Idle-PC configuration.</p></div><div class="sect2" title="Setting a Manual Idle-PC Value"><div class="titlepage"><div><div><h2 class="title"><a id="setting_a_manual_idle-pc_value"/>Setting a Manual Idle-PC Value</h2></div></div></div><p>If GNS3 is unable to find an Idle-PC value automatically, you’ll need to find one manually. You need to calculate an Idle-PC value only once per IOS image. GNS3 applies this setting to <span class="emphasis"><em>all</em></span> virtual routers using that image file. Close the Preferences window, and drag a router from the Devices toolbar to your GNS3 workspace, as shown in <a class="xref" href="ch03.html#adding_a_router_to_a_blank_workspace" title="Figure 3-9. Adding a router to a blank workspace">Figure 3-9</a>.</p><div class="figure"><a id="adding_a_router_to_a_blank_workspace"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00017"/><img src="httpatomoreillycomsourcenostarchimages2208903.png.jpg" alt="Adding a router to a blank workspace"/></div></div><p class="title">Figure 3-9. Adding a router to a blank workspace</p></div><p><a id="iddle1068" class="indexterm"/><a id="iddle1138" class="indexterm"/><a id="iddle1232" class="indexterm"/><a id="iddle1238" class="indexterm"/><a id="iddle1726" class="indexterm"/><a id="iddle2067" class="indexterm"/><a id="iddle2265" class="indexterm"/>Next, boot the router by right-clicking the router icon and selecting <span class="strong"><strong>Start</strong></span>; then verify that the IOS loads correctly by immediately right-clicking the router again and selecting <span class="strong"><strong>Console</strong></span>. A Cisco console window should open and display the router’s boot messages. If the router boots correctly, you’re ready to begin the Idle-PC calculation; if not, make sure that the model and default RAM settings assigned to the router are correct, or try a different IOS image.</p><p>If you’re running Linux and a Cisco console does not appear after selecting Console, check your GNS3 Console Settings. Go to <span class="strong"><strong>Edit</strong></span> ▸ <span class="strong"><strong>Preferences</strong></span>, click <span class="strong"><strong>General</strong></span>, and select the <span class="strong"><strong>Console applications</strong></span> tab, as shown in <a class="xref" href="ch03.html#choosing_a_console_application_using_ubu" title="Figure 3-10. Choosing a Console application using Ubuntu Linux">Figure 3-10</a>.</p><p>Using the Preconfigured commands drop-down menu, select your Linux terminal type and then click <span class="strong"><strong>Set, Apply</strong></span>, and <span class="strong"><strong>OK</strong></span>.</p><p>When the router boots, your computer’s CPU usage will quickly surge to 100 percent. Monitor your CPU usage so that after you’ve set an Idle-PC value, you can verify that your CPU usage has settled down. On Windows, press <span class="smaller">CTRL-ALT-DEL</span> and click <span class="strong"><strong>Task Manager</strong></span> to display CPU usage. On OS X, open the Activity Monitor program from the Applications/Utilities folder and click <a class="firstterm" href="apd.html#gloss01_016"><em class="firstterm">CPU</em></a>. On Linux systems, use System Monitor or enter <span class="strong"><strong><code class="literal">top</code></strong></span> at the terminal.</p><div class="figure"><a id="choosing_a_console_application_using_ubu"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00018"/><img src="httpatomoreillycomsourcenostarchimages2208905.png.jpg" alt="Choosing a Console application using Ubuntu Linux"/></div></div><p class="title">Figure 3-10. Choosing a Console application using Ubuntu Linux</p></div><p><a id="iddle1233" class="indexterm"/><a id="iddle1727" class="indexterm"/><a id="iddle2266" class="indexterm"/>To begin calculating a value, right-click your router and select <span class="strong"><strong>Idle-PC</strong></span> from the menu, as shown in <a class="xref" href="ch03.html#manually_calculating_idle-pc_values" title="Figure 3-11. Manually calculating Idle-PC values">Figure 3-11</a>.</p><p>GNS3 should now calculate Idle-PC values and provide one or more values to choose from. This can take a minute, so give it time to display the results in the Idle-PC values window, shown in <a class="xref" href="ch03.html#idle-pc_values" title="Figure 3-12. Idle-PC values">Figure 3-12</a>.</p><p>If there is an asterisk (*) next to a given value, then GNS3 has determined that value to be the best, and you should choose it. Click <span class="strong"><strong>Apply</strong></span> to choose the value, and recheck your CPU usage.</p><p>Occasionally, GNS3 miscalculates the value, and processor usage remains high. If this happens, try again using a different value from the drop-down menu, and click <span class="strong"><strong>Apply</strong></span> again to choose the new value. If no asterisk is displayed, you’ll need to find a value that works using a simple trial-and-error method. When you’re done, click <span class="strong"><strong>OK</strong></span> to save the value.</p><div class="figure"><a id="manually_calculating_idle-pc_values"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00019"/><img src="httpatomoreillycomsourcenostarchimages2208907.png.jpg" alt="Manually calculating Idle-PC values"/></div></div><p class="title">Figure 3-11. Manually calculating Idle-PC values</p></div><div class="figure"><a id="idle-pc_values"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00020"/><img src="httpatomoreillycomsourcenostarchimages2208909.png.jpg" alt="Idle-PC values"/></div></div><p class="title">Figure 3-12. Idle-PC values</p></div><p><a id="iddle1126" class="indexterm"/><a id="iddle2344" class="indexterm"/>After a working Idle-PC value has been applied, you’re ready to create some projects!</p></div></div><div class="sect1" title="Final Thoughts"><div class="titlepage"><div><div><h1 class="title"><a id="final_thoughts-id00004"/>Final Thoughts</h1></div></div></div><p>Now that you’ve assigned one or more IOS image files to your routers and configured basic options in GNS3, you’re ready to begin working with your routers. You can select any virtual router displayed on the Routers Device toolbar. Give it a try. Drag a couple of routers to the workspace, start them up, and enter a few IOS commands.</p><p>Just like real Cisco routers, the limitations of your Dynamips virtual routers are determined by the IOS version they’re running. If you find that your router is missing an IOS command or that the syntax for a given command is not what you expected, you may need to try a different IOS version. If you’re studying for the CCNA or CCNP exam, this shouldn’t be an issue because those certifications require a fairly straightforward set of commands and features. If you’re studying for a CCIE or other advanced Cisco certification, you might need the latest IOS that supports a more robust set of features. When in doubt, visit the Cisco website to find out what features and capabilities are supported by a specific router model or IOS. Cisco’s Feature Navigator web page is an awesome tool that allows you to search for IOS information by features, technology, software, image, or product code, and it also allows you to compare software versions.</p><p>Now that you’ve assigned an IOS image and configured basic options in GNS3, let’s move on to creating projects!</p></div></div></body></html>