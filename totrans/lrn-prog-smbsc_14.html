<html><head></head><body>
<h2 class="h2" id="ch14"><span epub:type="pagebreak" id="page_195"/><span class="big"><span class="blue"><strong>14</strong></span></span><br/><strong>CREATING CONDITIONAL WHILE LOOPS</strong></h2>&#13;
<div class="imagec"><img alt="image" src="graphics/common01.jpg"/></div>&#13;
<p class="noindent">In <a href="ch13.html#ch13">Chapter 13</a>, we showed you how to use the <code>For</code> loop to repeat code a certain number of times. <code>For</code> loops are ideal to use when you know exactly how many times you want to repeat code. <code>While</code> is another Small Basic keyword that lets you create loops. It’s useful when you don’t know how many times you want to repeat a loop in advance, because <code>While</code> loops keep running code as long as a condition is true.</p>&#13;
<p class="indent">A <code>While</code> loop condition is similar to how your parents keep telling you to clean your room until it’s spotless or how you keep eating Thanksgiving turkey until you’re stuffed! When the loop’s condition becomes false, the loop ends, and the program moves on.</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_196"/>In this chapter, you’ll learn how to write <code>While</code> loops and use them to verify user input and make games. <code>While</code> loops are a powerful programming concept; once you master them, you’ll be able to make all kinds of cool applications.</p>&#13;
<h3 class="h3" id="ch14lev1sec01"><span class="blue"><strong>When to Use While Loops</strong></span></h3>&#13;
<p class="noindent">Let’s say you want to make a number-guessing game that selects a random number between 1 and 100 and prompts a player to guess it. If the player’s guess is wrong, the game tells them whether their guess was higher or lower than the secret number, and then it asks them to guess again. The game keeps asking the player to guess the number until they get it right.</p>&#13;
<p class="indent">A <code>For</code> loop isn’t the best choice to use here, because you don’t know how many times it will take a player to guess the secret number. Maybe the player will get it right on the first try, or it might take 100 tries! <code>While</code> loops are perfect in cases like this one.</p>&#13;
<p class="indent">In the next section, you’ll learn the <code>While</code> loop’s syntax and use it to create your own number-guessing game.</p>&#13;
<h3 class="h3" id="ch14lev1sec02"><span class="blue"><strong>Writing a While Loop</strong></span></h3>&#13;
<p class="noindent">Try out the code in <a href="ch14.html#ch14ex1">Listing 14-1</a>.</p>&#13;
<pre> 1 <span class="green"><span class="codeitalic">' GuessMyNumber.sb</span></span><br/> 2 num <span class="brown">=</span> <span class="blue1">Math</span><span class="brown">.GetRandomNumber(</span><span class="red">100</span><span class="brown">)</span> <span class="green"><span class="codeitalic">' From 1 to 100</span></span><br/> 3 ans <span class="brown">=</span> <span class="red">0</span>               <span class="green"><span class="codeitalic">' Any value that isn't equal to num</span></span><br/> 4 <span class="purple"><span class="codestrong">While</span></span> <span class="brown">(</span>ans <span class="brown">&lt;&gt;</span> num<span class="brown">)</span>    <span class="green"><span class="codeitalic">' Repeats as long as the guess is wrong</span></span><br/> 5   <span class="blue1">TextWindow</span><span class="brown">.Write(</span><span class="red">"Enter your guess [1-100]: "</span><span class="brown">)</span><br/> 6   ans <span class="brown">=</span> <span class="blue1">TextWindow</span><span class="brown">.ReadNumber()</span><br/> 7   <span class="purple"><span class="codestrong">If</span></span> <span class="brown">(</span>ans <span class="brown">=</span> num<span class="brown">)</span> <span class="purple"><span class="codestrong">Then</span></span> <span class="green"><span class="codeitalic">' Player guessed correctly</span></span><br/> 8     <span class="blue1">TextWindow</span><span class="brown">.WriteLine(</span><span class="red">"Good job! You get sprinkles!"</span><span class="brown">)</span><br/> 9   <span class="purple"><span class="codestrong">ElseIf</span></span> <span class="brown">(</span>ans <span class="brown">&gt;</span> num<span class="brown">)</span> <span class="purple"><span class="codestrong">Then</span></span><br/>10     <span class="blue1">TextWindow</span><span class="brown">.WriteLine(</span><span class="red">"Too High. Lower your standards."</span><span class="brown">)</span><br/>11   <span class="purple"><span class="codestrong">Else</span></span><br/>12     <span class="blue1">TextWindow</span><span class="brown">.WriteLine(</span><span class="red">"Too Low. Aim for the stars!"</span><span class="brown">)</span><br/>13   <span class="purple"><span class="codestrong">EndIf</span></span><br/>14 <span class="purple"><span class="codestrong">EndWhile</span></span></pre>&#13;
<p class="listcap"><a id="ch14ex1"/><em>Listing 14-1: Number-guessing game</em></p>&#13;
<p class="indent">The program randomly selects a number from 1 to 100 and assigns it to <code>num</code> (line 2). Then a variable called <code>ans</code>, which will hold the player’s guess, is created and set to 0 (line 3). We set this initial value to 0 because we need it to be different from the correct answer. Let’s take a closer look at the first line of the <code>While</code> loop (line 4):</p>&#13;
<pre><span class="purple"><span class="codestrong">While</span></span> <span class="brown">(</span>ans <span class="brown">&lt;&gt;</span> num<span class="brown">)</span></pre>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_197"/>This piece of code simply says, “As long as <code>ans</code> is not equal to <code>num</code>, run the statement(s) between the <code>While</code> and the <code>EndWhile</code> keywords.”</p>&#13;
<p class="indent">First, the test condition (<code>ans &lt;&gt; num</code>) is evaluated. If it’s true, the program runs the statements in the loop’s body and keeps repeating until the condition becomes false. When the test condition becomes false, the loop ends, and the program moves to the next statement after the <code>EndWhile</code> keyword. The flowchart in <a href="ch14.html#ch14fig1">Figure 14-1</a> illustrates how the <code>While</code> loop works.</p>&#13;
<div class="image"><img alt="image" src="graphics/f14-01.jpg"/></div>&#13;
<p class="figcap"><a id="ch14fig1"/><em>Figure 14-1: Flowchart of the</em> <code><span class="codeitalic">While</code></span> <em>loop</em></p>&#13;
<p class="indent">In the number-guessing game, when the program runs line 4 for the first time, the condition (<code>ans &lt;&gt; num</code>) is true (because we know that <code>num</code> can’t be 0), and the loop runs the statements in its body (lines 5–13). During each iteration of the loop, the player is prompted to enter a guess (line 5), which is saved into the variable <code>ans</code> (line 6). The code then compares the player’s guess with the secret number. If the player guessed correctly (line 7), the code displays <code>Good Job! You get sprinkles!</code> and moves to the statement after <code>EndIf</code>. In this example, it finds <code>EndWhile</code>, which takes your program back to check the condition of the <code>While</code> loop. Because <code>ans</code> is now equal to <code>num</code>, the test condition is false and the <code>While</code> loop terminates, ending the program (because there are no statements after <code>EndWhile</code>).</p>&#13;
<p class="indent">If the player’s guess was incorrect, the code checks whether the guess was higher than the secret number (line 9). If it’s higher, the program displays <code>Too High. Lower your standards.</code> Then the loop goes for another round. If the player’s guess is lower than the secret number (the <code>Else</code> statement on line 11), the program displays <code>Too Low. Aim for the stars!</code> (line 12) and starts another round.</p>&#13;
<p class="indent">Here is an example of a rather lucky user playing the game:</p>&#13;
<pre>Enter your guess [1-100]: <span class="codestrong">50</span><br/>Too High. Lower your standards.<br/>Enter your guess [1-100]: <span class="codestrong">25</span><br/>Too Low. Aim for the stars!<br/>Enter your guess [1-100]: <span class="codestrong">37</span><br/>Good Job! You get sprinkles!</pre>&#13;
<p class="indent">Play this game several times to see how it works!</p>&#13;
<div class="note">&#13;
<p class="notet"><span epub:type="pagebreak" id="page_198"/><span class="notes"><strong>NOTE</strong></span></p>&#13;
<p class="notep"><em>Although it’s not required by Small Basic, we’ll make programs easier to read by using parentheses around the</em> <code><span class="codeitalic">While</code></span> <em>loop’s condition and indenting the body of a</em> <code><span class="codeitalic">While</code></span> <em>loop.</em></p>&#13;
</div>&#13;
<p class="indent">In the next section, we’ll show you how to use a <code>While</code> loop to check data entered by a user.</p>&#13;
<div class="sidebar">&#13;
<p class="sidebart" id="ch14sb01"><strong>TRY IT OUT 14-1</strong></p>&#13;
<p class="noindent">How much wood could a woodchuck chuck if a woodchuck could chuck wood? Open the <em>Woodchuck.sb</em> file from this chapter’s folder, and run it to answer this age-old question. Then figure out some ways to improve the program.</p>&#13;
</div>&#13;
<h3 class="h3" id="ch14lev1sec03"><span class="blue"><strong>Validating Your Inputs</strong></span></h3>&#13;
<p class="noindent">When you write a program that reads data from a user, you should always check the input data before continuing with your program. This is called <em>validation</em>. In this section, we’ll show you how to use <code>While</code> loops to ensure that your user enters the correct input to your program.</p>&#13;
<p class="indent">Let’s say you need the user to enter a number between 1 and 5 (including 1 or 5). If they enter a number less than 1 or greater than 5, you need to prompt them to re-enter a number. <a href="ch14.html#ch14ex2">Listing 14-2</a> shows you how to use a <code>While</code> loop to achieve this.</p>&#13;
<pre>1 <span class="green"><span class="codeitalic">' InputValidation.sb</span></span><br/>2 num <span class="brown">= -</span><span class="red">1</span>   <span class="green"><span class="codeitalic">' Invalid value (to force a pass through the loop)</span></span><br/>3<br/>4 <span class="purple"><span class="codestrong">While</span></span> <span class="brown">((</span>num <span class="brown">&lt;</span> <span class="red">1</span><span class="brown">) Or (</span>num <span class="brown">&gt;</span> <span class="red">5</span><span class="brown">))</span><br/>5   <span class="blue1">TextWindow</span><span class="brown">.Write(</span><span class="red">"Enter a number between 1 and 5: "</span><span class="brown">)</span><br/>6   num <span class="brown">=</span> <span class="blue1">TextWindow</span><span class="brown">.ReadNumber()</span><br/>7 <span class="purple"><span class="codestrong">EndWhile</span></span><br/>8 <span class="blue1">TextWindow</span><span class="brown">.WriteLine(</span><span class="red">"You entered: "</span> <span class="brown">+</span> num<span class="brown">)</span></pre>&#13;
<p class="listcap"><a id="ch14ex2"/><em>Listing 14-2: Using a</em> <code><span class="codeitalic">While</code></span> <em>loop to check the input number</em></p>&#13;
<p class="indent">Line 2 sets the variable <code>num</code> (which will hold the number entered by the user) to –1. This makes the condition of the <code>While</code> loop (line 4) true, so the loop’s body runs at least once. Although the loop in this example runs fine without the initialization statement on line 2 (because the variable <code>num</code> will be seen as 0), we recommend that you always initialize your variables and not rely on their default values. This will help you prevent future mistakes.</p>&#13;
<p class="indent">The program prompts the user for a number and assigns their input to the <code>num</code> variable (lines 5–6). Then the loop runs again. If <code>num</code> is less than 1 or greater than 5 (the user entered an invalid number), the loop’s body runs again, prompting the user to re-enter the number. If <code>num</code> is between 1 and 5 (inclusive), the loop ends, and the program moves to line 8 to display the number.</p>&#13;
<div class="note">&#13;
<p class="notet"><span epub:type="pagebreak" id="page_199"/><span class="notes"><strong>TIP</strong></span></p>&#13;
<p class="notep"><em>Make sure you initialize any variable before you use it in a</em> <code><span class="codeitalic">While</code></span> <em>loop’s test condition. If you don’t, your program might skip over the loop entirely!</em></p>&#13;
</div>&#13;
<p class="indent">Now you know how to verify user input using a <code>While</code> loop.</p>&#13;
<div class="sidebar">&#13;
<p class="sidebart" id="ch14sb02"><strong>TRY IT OUT 14-2</strong></p>&#13;
<p class="noindent">Write a program that asks a user whether they think SpongeBob could become Santa, and then prompt them to enter <code>Y</code> (for yes) or <code>N</code> (for no). They can also enter <code>y</code> or <code>n</code>. Write a <code>While</code> loop that only accepts <code>Y</code>, <code>y</code>, <code>N</code>, or <code>n</code> as valid inputs. Then tell the user what they did wrong each time.</p>&#13;
</div>&#13;
<h3 class="h3" id="ch14lev1sec04"><span class="blue"><strong>Infinite Loops</strong></span></h3>&#13;
<p class="noindent">If a <code>While</code> loop’s condition doesn’t become false, the loop runs forever, creating an <em>infinite loop</em>. Sometimes this can cause a problem, but sometimes infinite loops are useful, such as when you want to make a game run forever.</p>&#13;
<p class="indent">But how do you create an infinite loop in Small Basic? There are a few ways to do this, but here is a common shortcut that many Small Basic programmers use:</p>&#13;
<pre><span class="purple"><span class="codestrong">While</span></span> <span class="brown">(</span><span class="red">"True"</span><span class="brown">)</span><br/>  <span class="blue1">TextWindow</span><span class="brown">.WriteLine(</span><span class="red">"Loop forever!"</span><span class="brown">)</span><br/><span class="purple"><span class="codestrong">EndWhile</span></span></pre>&#13;
<p class="indent">In this code, the loop’s condition is always true; the loop never stops, and it displays <code>Loop forever!</code> forever. To see this in action, you’ll program a simple game that quizzes kids on their addition skills. The complete code is shown in <a href="ch14.html#ch14ex3">Listing 14-3</a>. Run this program to see how it works.</p>&#13;
<pre> 1 <span class="green"><span class="codeitalic">' AddTutor.sb</span></span><br/> 2 <span class="purple"><span class="codestrong">While</span></span> <span class="brown">(</span><span class="red">"True"</span><span class="brown">)</span><br/> 3   num1 <span class="brown">=</span> <span class="blue1">Math</span><span class="brown">.GetRandomNumber(</span><span class="red">10</span><span class="brown">)</span> <span class="green"><span class="codeitalic">' Sets num1 between 1 and 10</span></span><br/> 4   num2 <span class="brown">=</span> <span class="blue1">Math</span><span class="brown">.GetRandomNumber(</span><span class="red">10</span><span class="brown">)</span> <span class="green"><span class="codeitalic">' Sets num2 between 1 and 10</span></span><br/> 5   correctAns <span class="brown">=</span> num1 <span class="brown">+</span> num2        <span class="green"><span class="codeitalic">' Adds both numbers</span></span><br/> 6   <span class="blue1">TextWindow</span><span class="brown">.Write(</span><span class="red">"What is "</span> <span class="brown">+</span> num1 <span class="brown">+</span> <span class="red">" + "</span> <span class="brown">+</span> num2 <span class="brown">+</span> <span class="red">"? "</span><span class="brown">)</span><br/> 7   ans <span class="brown">=</span> <span class="blue1">TextWindow</span><span class="brown">.ReadNumber()</span>   <span class="green"><span class="codeitalic">' User enters an answer</span></span><br/> 8   <span class="purple"><span class="codestrong">If</span></span> <span class="brown">(</span>ans <span class="brown">=</span> correctAns<span class="brown">)</span> <span class="purple"><span class="codestrong">Then</span></span>      <span class="green"><span class="codeitalic">' Checks if the answer is correct</span></span><br/> 9     <span class="blue1">TextWindow</span><span class="brown">.WriteLine(</span><span class="red">"This is correct."</span><span class="brown">)</span><br/>10   <span class="purple"><span class="codestrong">Else</span></span>                            <span class="green"><span class="codeitalic">' Gives the correct answer</span></span><br/>11     <span class="blue1">TextWindow</span><span class="brown">.WriteLine(</span><span class="red">"Sorry. The answer is "</span> <span class="brown">+</span> correctAns<span class="brown">)</span><br/>12   <span class="purple"><span class="codestrong">EndIf</span></span><br/>13 <span class="purple"><span class="codestrong">EndWhile</span></span></pre>&#13;
<p class="listcap"><a id="ch14ex3"/><em>Listing 14-3: A program that quizzes a user with addition problems</em></p>&#13;
<p class="indent">In lines 3 and 4, <code>num1</code> and <code>num2</code> are set to random numbers between 1 and 10. Line 5 adds them together to set the correct answer. Line 6 <span epub:type="pagebreak" id="page_200"/>asks the user for the correct answer. Line 7 gets the user’s answer. Line 8 checks whether the answer is true, and if it is, line 9 tells them they’re right. Otherwise, line 11 tells them the correct answer. The game runs forever. When the user wants to quit, they can close the application by clicking the X icon in the upper-right corner of the application’s window.</p>&#13;
<div class="note">&#13;
<p class="notet"><span class="notes"><strong>TIP</strong></span></p>&#13;
<p class="notep"><em>You can use a</em> <code><span class="codeitalic">Goto</code></span> <em>statement inside a</em> <code><span class="codeitalic">While</code></span> <em>loop to jump to a label outside the loop in order to break out of the loop.</em></p>&#13;
</div>&#13;
<p class="indent">Now it’s time to put what you’ve learned in this chapter to work by designing a complete game. Head to the fridge to get plenty of brain food before reading on!</p>&#13;
<div class="sidebar">&#13;
<p class="sidebart" id="ch14sb03"><strong>TRY IT OUT 14-3</strong></p>&#13;
<p class="noindent">Change the <em>AddTutor.sb</em> program so it won’t give the correct answer to the player when they get it wrong. Instead, have the program tell the player that their answer is incorrect and let them try again.</p>&#13;
</div>&#13;
<h3 class="h3" id="ch14lev1sec05"><span class="blue"><strong>Create a Rock-Paper-Scissors Game</strong></span></h3>&#13;
<p class="noindent">In this section, you’ll create a rock-paper-scissors game in which a user plays against the computer. <a href="ch14.html#ch14fig2">Figure 14-2</a> shows the user interface for this game. The three buttons represent rock, paper, and scissors. The player chooses one by clicking it. Then the computer randomly picks an action. The rules that determine the winner are paper beats rock, rock beats scissors, and scissors beats paper.</p>&#13;
<div class="image"><img alt="image" src="graphics/f14-02.jpg"/></div>&#13;
<p class="figcap"><a id="ch14fig2"/><em>Figure 14-2: The user interface for the rock-paper-scissors game</em></p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_201"/>Images <em>P1</em>, <em>P2</em>, and <em>P3</em> show the player’s selection, and images <em>C1</em>, <em>C2</em>, and <em>C3</em> show the computer’s choice. Images <em>W0</em>, <em>W1</em>, <em>W2</em>, and <em>W3</em> show the result of each round of the game. Everything else you see in <a href="ch14.html#ch14fig2">Figure 14-2</a> is part of the background image, including the rock, paper, and scissors images that represent the three buttons.</p>&#13;
<h4 class="h4" id="ch14lev2sec01"><em><strong>Step 1: Open the Startup File</strong></em></h4>&#13;
<p class="noindent">Open the file <em>RockPaper_Incomplete.sb</em> from this chapter’s folder and follow along. The folder includes all the images you need for this game. The startup file, shown in <a href="ch14.html#ch14ex4">Listing 14-4</a>, contains the main part of the game. It also contains empty placeholders for all the subroutines you need to add.</p>&#13;
<pre> 1 <span class="green"><span class="codeitalic">' RockPaper_Incomplete.sb</span></span><br/> 2 <span class="blue1">GraphicsWindow</span><span class="brown">.Title =</span> <span class="red">"Rock, Paper, Scissors"</span><br/> 3 <span class="blue1">GraphicsWindow</span><span class="brown">.CanResize =</span> <span class="red">"False"</span><br/> 4 <span class="blue1">GraphicsWindow</span><span class="brown">.Width =</span> <span class="red">480</span><br/> 5 <span class="blue1">GraphicsWindow</span><span class="brown">.Height =</span> <span class="red">360</span><br/> 6<br/> 7 path <span class="brown">=</span> <span class="blue1">Program</span><span class="brown">.Directory</span><br/> 8 <span class="blue1">GraphicsWindow</span><span class="brown">.DrawImage(</span>path <span class="brown">+</span> <span class="red">"\Bkgnd.png"</span><span class="brown">,</span> <span class="red">0</span><span class="brown">,</span> <span class="red">0</span><span class="brown">)</span><br/> 9 choice1 <span class="brown">=</span> <span class="red">0</span>              <span class="green"><span class="codeitalic">' 0 = Unknown; 1 = Rock; 2 = Paper; 3 = Scissors</span></span><br/>10 <span class="blue1">GraphicsWindow</span><span class="brown">.MouseDown =</span> OnMouseDown<br/>11<br/>12 <span class="purple"><span class="codestrong">While</span></span> <span class="brown">(</span><span class="red">"True"</span><span class="brown">)</span>                        <span class="green"><span class="codeitalic">' Loops forever</span></span><br/>13   <span class="purple"><span class="codestrong">If</span></span> <span class="brown">(</span>choice1 <span class="brown">&lt;&gt;</span> <span class="red">0</span><span class="brown">)</span> <span class="purple"><span class="codestrong">Then</span></span>              <span class="green"><span class="codeitalic">' If player made a choice</span></span><br/>14     blankImg <span class="brown">=</span> path <span class="brown">+</span> <span class="red">"\W3.png"</span>       <span class="green"><span class="codeitalic">' Clears last result</span></span><br/>15     <span class="blue1">GraphicsWindow</span><span class="brown">.DrawImage(</span>blankImg<span class="brown">,</span> <span class="red">115</span><span class="brown">,</span> <span class="red">310</span><span class="brown">)</span><br/>16     choice2 <span class="brown">=</span> <span class="blue1">Math</span><span class="brown">.GetRandomNumber(</span><span class="red">3</span><span class="brown">)</span> <span class="green"><span class="codeitalic">' 1 to 3</span></span><br/>17     SwitchImages<span class="brown">()</span>                    <span class="green"><span class="codeitalic">' Shows player and computer choices</span></span><br/>18     ShowWinner<span class="brown">()</span>                      <span class="green"><span class="codeitalic">' Shows image for the result</span></span><br/>19     choice1 <span class="brown">=</span> <span class="red">0</span>                       <span class="green"><span class="codeitalic">' Ready for another round</span></span><br/>20   <span class="purple"><span class="codestrong">EndIf</span></span><br/>21   <span class="blue1">Program</span><span class="brown">.Delay(</span><span class="red">10</span><span class="brown">)</span>                   <span class="green"><span class="codeitalic">' Waits a little, then checks again</span></span><br/>22 <span class="purple"><span class="codestrong">EndWhile</span></span></pre>&#13;
<p class="listcap"><a id="ch14ex4"/><em>Listing 14-4: Setting up the window and choice</em></p>&#13;
<p class="indent">If you run the program now, all you’ll see is the background image because you haven’t created any of the subroutines yet. You’ll get there, but first let’s check out the setup and main loop of the game. First, the size of the graphics window is set, and the background image is drawn (lines 2–8). The variable <code>choice1</code> holds the player’s choice: <code>0</code> means unknown, <code>1</code> means rock, <code>2</code> means paper, and <code>3</code> means scissors. To start, we set <code>choice1</code> to <code>0</code>, because the player hasn’t made a choice yet (line 9). Then we register a handler for the <code>MouseDown</code> event to be able to find out when the player clicks one of the three buttons (line 10). Then the game’s main loop starts (lines 12–22).</p>&#13;
<p class="indent">The loop continuously checks the value of <code>choice1</code>. As you’ll see in a moment, this variable is changed by the <code>OnMouseDown()</code> subroutine when the player makes a choice. If <code>choice1</code> is 0, the loop waits for 10 milliseconds (line 21) and checks again. Using a loop makes the program wait for <code>choice1</code> <span epub:type="pagebreak" id="page_202"/>to become a value other than 0 (this is called <em>polling</em>; it’s similar to asking “Are we there yet?” during a long trip). When <code>choice1</code> becomes a value other than 0 (line 13), the body of the <code>If</code> block is executed (lines 14–19). We draw image <code>W3</code> to show a blank result (lines 14–15). Next, we set the computer’s choice, <code>choice2</code>, to a random value between 1 and 3 (line 16). Then we call <code>SwitchImages()</code> to show the images that correspond to <code>choice1</code> and <code>choice2</code> (line 17). Then we call <code>ShowWinner()</code> to show the result of this round of the game (line 18). Finally, we set <code>choice1</code> back to <code>0</code> to tell the <code>OnMouseDown()</code> subroutine that the main loop is ready for another round of the game (line 19).</p>&#13;
<p class="indent">Next, you’ll add each subroutine one at a time.</p>&#13;
<h4 class="h4" id="ch14lev2sec02"><em><strong>Step 2: Add the MouseDown Handler</strong></em></h4>&#13;
<p class="noindent">Now let’s handle the <code>MouseDown</code> event to figure out the player’s choice. Add the <code>OnMouseDown()</code> subroutine in <a href="ch14.html#ch14ex5">Listing 14-5</a> to the bottom of the program.</p>&#13;
<pre> 1 <span class="purple"><span class="codestrong">Sub</span></span> OnMouseDown<br/> 2   <span class="purple"><span class="codestrong">If</span></span> <span class="brown">(</span>choice1 <span class="brown">=</span> <span class="red">0</span><span class="brown">)</span> <span class="purple"><span class="codestrong">Then</span></span>        <span class="green"><span class="codeitalic">' Ready for another round</span></span><br/> 3     y <span class="brown">=</span> <span class="blue1">GraphicsWindow</span><span class="brown">.MouseY</span>  <span class="green"><span class="codeitalic">' Vertical click position</span></span><br/> 4     <span class="purple"><span class="codestrong">If</span></span> <span class="brown">((</span>y <span class="brown">&gt;</span> <span class="red">80</span><span class="brown">) And (</span>y <span class="brown">&lt;</span> <span class="red">120</span><span class="brown">))</span> <span class="purple"><span class="codestrong">Then</span></span>  <span class="green"><span class="codeitalic">' Within range</span></span><br/> 5       x <span class="brown">=</span> <span class="blue1">GraphicsWindow</span><span class="brown">.MouseX</span>       <span class="green"><span class="codeitalic">' Horizontal click</span></span><br/> 6       <span class="purple"><span class="codestrong">If</span></span> <span class="brown">((</span>x <span class="brown">&gt;</span> <span class="red">40</span><span class="brown">) And (</span>x <span class="brown">&lt;</span> <span class="red">80</span><span class="brown">))</span> <span class="purple"><span class="codestrong">Then</span></span>       <span class="green"><span class="codeitalic">' Rock</span></span><br/> 7         choice1 <span class="brown">=</span> <span class="red">1</span><br/> 8       <span class="purple"><span class="codestrong">ElseIf</span></span> <span class="brown">((</span>x <span class="brown">&gt;</span> <span class="red">110</span><span class="brown">) And (</span>x <span class="brown">&lt;</span> <span class="red">150</span><span class="brown">))</span> <span class="purple"><span class="codestrong">Then</span></span> <span class="green"><span class="codeitalic">' Paper</span></span><br/> 9         choice1 <span class="brown">=</span> <span class="red">2</span><br/>10       <span class="purple"><span class="codestrong">ElseIf</span></span> <span class="brown">((</span>x <span class="brown">&gt;</span> <span class="red">175</span><span class="brown">) And (</span>x <span class="brown">&lt;</span> <span class="red">215</span><span class="brown">))</span> <span class="purple"><span class="codestrong">Then</span></span> <span class="green"><span class="codeitalic">' Scissors</span></span><br/>11         choice1 <span class="brown">=</span> <span class="red">3</span><br/>12       <span class="purple"><span class="codestrong">EndIf</span></span><br/>13     <span class="purple"><span class="codestrong">EndIf</span></span><br/>14   <span class="purple"><span class="codestrong">EndIf</span></span><br/>15 <span class="purple"><span class="codestrong">EndSub</span></span></pre>&#13;
<p class="listcap"><a id="ch14ex5"/><em>Listing 14-5: Checking the choice the user clicked</em></p>&#13;
<p class="indent">Small Basic calls this subroutine when the player clicks anywhere in the graphics window. First, the subroutine checks the value of <code>choice1</code> (line 2). If <code>choice1</code> is <code>0</code>, the subroutine checks where the player clicked to see whether they clicked one of the three buttons. If <code>choice1</code> is not 0, that means the main loop is still processing the player’s last choice, so the subroutine just ignores the mouse click. This way your game won’t get confused if the player clicks all over the place.</p>&#13;
<p class="indent">To see whether the player clicks one of the three image buttons, the subroutine checks the vertical position of the click (line 4). If it’s within the range of the images, the subroutine checks the horizontal position (line 6). The <code>If/ElseIf</code> ladder then compares the horizontal position with the left and right edges of each image and sets <code>choice1</code> accordingly (lines 6–12).</p>&#13;
<div class="note">&#13;
<p class="notet"><span epub:type="pagebreak" id="page_203"/><span class="notes"><strong>TIP</strong></span></p>&#13;
<p class="notep"><em>If you want to find out the exact positions of the three image buttons, add this code to your program:</em></p>&#13;
<pre><span class="blue1">GraphicsWindow</span><span class="brown">.MouseMove =</span> OnMouseMove<br/><span class="purple"><span class="codestrong">Sub</span></span> OnMouseMove<br/>  mx <span class="brown">=</span> <span class="blue1">GraphicsWindow</span><span class="brown">.MouseX</span><br/>  my <span class="brown">=</span> <span class="blue1">GraphicsWindow</span><span class="brown">.MouseY</span><br/>  <span class="blue1">TextWindow</span><span class="brown">.WriteLine(</span>mx <span class="brown">+</span> <span class="red">", "</span> <span class="brown">+</span> my<span class="brown">)</span><br/><span class="purple"><span class="codestrong">EndSub</span></span></pre>&#13;
<p class="indent"><em>Move the mouse over the background image to see the coordinates displayed in the text window. Don’t forget to delete this code before you share your game with your friends!</em></p>&#13;
</div>&#13;
<h4 class="h4" id="ch14lev2sec03"><em><strong>Step 3: Switch the Images</strong></em></h4>&#13;
<p class="noindent">When the player makes a choice, you need to show the computer’s pick so they know the computer isn’t cheating. To create some excitement, you’ll animate the images before showing the final choices. Add the <code>SwitchImages()</code> subroutine in <a href="ch14.html#ch14ex6">Listing 14-6</a>.</p>&#13;
<pre> 1 <span class="purple"><span class="codestrong">Sub</span></span> SwitchImages<br/> 2   <span class="purple"><span class="codestrong">For</span></span> M <span class="brown">=</span> <span class="red">1</span> <span class="purple"><span class="codestrong">To</span></span> <span class="red">10</span>  <span class="green"><span class="codeitalic">' Flips images 10 times</span></span><br/> 3     N <span class="brown">=</span> <span class="red">1</span> <span class="brown">+</span> <span class="blue1">Math</span><span class="brown">.Remainder(</span>M<span class="brown">,</span> <span class="red">3</span><span class="brown">)</span>     <span class="green"><span class="codeitalic">' N = 1,2,3,1,2,3...</span></span><br/> 4     img1 <span class="brown">=</span> path <span class="brown">+</span> <span class="red">"\P"</span> <span class="brown">+</span> N <span class="brown">+</span> <span class="red">".png"</span>  <span class="green"><span class="codeitalic">' {\P1, \P2, or \P3}.png</span></span><br/> 5     img2 <span class="brown">=</span> path <span class="brown">+</span> <span class="red">"\C"</span> <span class="brown">+</span> N <span class="brown">+</span> <span class="red">".png"</span>  <span class="green"><span class="codeitalic">' {\C1, \C2, or \C3}.png</span></span><br/> 6     <span class="blue1">GraphicsWindow</span><span class="brown">.DrawImage(</span>img1<span class="brown">,</span>  <span class="red">40</span><span class="brown">,</span> <span class="red">150</span><span class="brown">)</span> <span class="green"><span class="codeitalic">' Draws img1</span></span><br/> 7     <span class="blue1">GraphicsWindow</span><span class="brown">.DrawImage(</span>img2<span class="brown">,</span> <span class="red">280</span><span class="brown">,</span> <span class="red">150</span><span class="brown">)</span> <span class="green"><span class="codeitalic">' Draws img2</span></span><br/> 8     <span class="blue1">Program</span><span class="brown">.Delay(</span><span class="red">100</span><span class="brown">)</span>               <span class="green"><span class="codeitalic">' Waits a short time</span></span><br/> 9   <span class="purple"><span class="codestrong">EndFor</span></span><br/>10<br/>11   <span class="green"><span class="codeitalic">' Shows the actual choices of the player and the computer</span></span><br/>12   img1 <span class="brown">=</span> path <span class="brown">+</span> <span class="red">"\P"</span> <span class="brown">+</span> choice1 <span class="brown">+</span> <span class="red">".png"</span><br/>13   img2 <span class="brown">=</span> path <span class="brown">+</span> <span class="red">"\C"</span> <span class="brown">+</span> choice2 <span class="brown">+</span> <span class="red">".png"</span><br/>14   <span class="blue1">GraphicsWindow</span><span class="brown">.DrawImage(</span>img1<span class="brown">,</span>  <span class="red">40</span><span class="brown">,</span> <span class="red">150</span><span class="brown">)</span><br/>15   <span class="blue1">GraphicsWindow</span><span class="brown">.DrawImage(</span>img2<span class="brown">,</span> <span class="red">280</span><span class="brown">,</span> <span class="red">150</span><span class="brown">)</span><br/>16 <span class="purple"><span class="codestrong">EndSub</span></span></pre>&#13;
<p class="listcap"><a id="ch14ex6"/><em>Listing 14-6: Switching images for a visual effect</em></p>&#13;
<p class="indent"><code>SwitchImages()</code> starts by switching the images for the player and the computer 10 times very quickly for a fun visual effect (lines 2–9). Then the code shows the images that correspond to <code>choice1</code> and <code>choice2</code> by appending a number to the letters <code>P</code> and <code>C</code>, which represent the names of the images.</p>&#13;
<p class="indent">Run the code to test it. When you click any of the three image buttons, the player and the computer selections will change 10 times before landing on the images that correspond to the actual choices. (Don’t flip images too quickly, or you’ll get a headache!)</p>&#13;
<h4 class="h4" id="ch14lev2sec04"><span epub:type="pagebreak" id="page_204"/><em><strong>Step 4: Announce the Winner</strong></em></h4>&#13;
<p class="noindent">The last part of the game, the <code>ShowWinner()</code> subroutine, checks the result and displays the winner. Add the <code>ShowWinner()</code> subroutine in <a href="ch14.html#ch14ex7">Listing 14-7</a>.</p>&#13;
<pre> 1 <span class="purple"><span class="codestrong">Sub</span></span> ShowWinner<br/> 2   <span class="green"><span class="codeitalic">' W0: Tie; W1: Player1; W2: Computer</span></span><br/> 3   <span class="purple"><span class="codestrong">If</span></span> <span class="brown">((</span>choice1 <span class="brown">=</span> <span class="red">1</span><span class="brown">) And (</span>choice2 <span class="brown">=</span> <span class="red">2</span><span class="brown">))</span> <span class="purple"><span class="codestrong">Then</span></span>     <span class="green"><span class="codeitalic">' Paper (2) beats rock (1)</span></span><br/> 4     img <span class="brown">=</span> <span class="red">"\W2.png"</span><br/> 5   <span class="purple"><span class="codestrong">ElseIf</span></span> <span class="brown">((</span>choice1 <span class="brown">=</span> <span class="red">1</span><span class="brown">) And (</span>choice2 <span class="brown">=</span> <span class="red">3</span><span class="brown">))</span> <span class="purple"><span class="codestrong">Then</span></span> <span class="green"><span class="codeitalic">' Rock (1) beats scissors (3)</span></span><br/> 6     img <span class="brown">=</span> <span class="red">"\W1.png"</span><br/> 7   <span class="purple"><span class="codestrong">ElseIf</span></span> <span class="brown">((</span>choice1 <span class="brown">=</span> <span class="red">2</span><span class="brown">) And (</span>choice2 <span class="brown">=</span> <span class="red">1</span><span class="brown">))</span> <span class="purple"><span class="codestrong">Then</span></span> <span class="green"><span class="codeitalic">' Paper (2) beats rock (1)</span></span><br/> 8     img <span class="brown">=</span> <span class="red">"\W1.png"</span><br/> 9   <span class="purple"><span class="codestrong">ElseIf</span></span> <span class="brown">((</span>choice1 <span class="brown">=</span> <span class="red">2</span><span class="brown">) And (</span>choice2 <span class="brown">=</span> <span class="red">3</span><span class="brown">))</span> <span class="purple"><span class="codestrong">Then</span></span> <span class="green"><span class="codeitalic">' Scissors (3) beats paper (2)</span></span><br/>10     img <span class="brown">=</span> <span class="red">"\W2.png"</span><br/>11   <span class="purple"><span class="codestrong">ElseIf</span></span> <span class="brown">((</span>choice1 <span class="brown">=</span> <span class="red">3</span><span class="brown">) And (</span>choice2 <span class="brown">=</span> <span class="red">1</span><span class="brown">))</span> <span class="purple"><span class="codestrong">Then</span></span> <span class="green"><span class="codeitalic">' Rock (1) beats scissors (3)</span></span><br/>12     img <span class="brown">=</span> <span class="red">"\W2.png"</span><br/>13   <span class="purple"><span class="codestrong">ElseIf</span></span> <span class="brown">((</span>choice1 <span class="brown">=</span> <span class="red">3</span><span class="brown">) And (</span>choice2 <span class="brown">=</span> <span class="red">2</span><span class="brown">))</span> <span class="purple"><span class="codestrong">Then</span></span> <span class="green"><span class="codeitalic">' Scissors (3) beats paper (2)</span></span><br/>14     img <span class="brown">=</span> <span class="red">"\W1.png"</span><br/>15   <span class="purple"><span class="codestrong">Else</span></span><br/>16     img <span class="brown">=</span> <span class="red">"\W0.png"</span><br/>17   <span class="purple"><span class="codestrong">EndIf</span></span><br/>18<br/>19   <span class="blue1">GraphicsWindow</span><span class="brown">.DrawImage(</span>path <span class="brown">+</span> img<span class="brown">,</span> <span class="red">115</span><span class="brown">,</span> <span class="red">310</span><span class="brown">)</span><br/>20 <span class="purple"><span class="codestrong">EndSub</span></span></pre>&#13;
<p class="listcap"><a id="ch14ex7"/><em>Listing 14-7: Checking who won to display the right image</em></p>&#13;
<p class="indent">This subroutine compares the values of <code>choice1</code> and <code>choice2</code> using an <code>If/ElseIf</code> ladder and decides which image (<code>img</code>) to display (lines 3–17). Remember that choice <code>1</code> means rock, <code>2</code> means paper, and <code>3</code> means scissors. Then, line 19 draws the selected image.</p>&#13;
<div class="sidebar">&#13;
<p class="sidebart" id="ch14sb04"><strong>TRY IT OUT 14-4</strong></p>&#13;
<p class="noindent">See if you can turn the rock-paper-scissors game into a two-player game!</p>&#13;
</div>&#13;
<h3 class="h3a" id="ch14lev1sec06"><span class="blues"><strong>Programming Challenges</strong></span></h3>&#13;
<p class="noindent">If you get stuck, check out <em><a href="http://nostarch.com/smallbasic/">http://nostarch.com/smallbasic/</a></em> for the solutions and for more resources and review questions for teachers and students.</p>&#13;
<ol>&#13;
<li><p class="noindenta">Open the file <em>Race_Incomplete.sb</em> from this chapter’s folder. This application simulates a race between two players. When you run the program, you’ll see the following interface. Follow the comments provided in the application’s source code to write the missing code and complete the application.</p>&#13;
<div class="image1"><span epub:type="pagebreak" id="page_205"/><img alt="image" src="graphics/f0205-01.jpg"/></div></li>&#13;
<li><p class="noindenta">Open the file <em>SimpleSlot.sb</em> from this chapter’s folder. This program simulates a simple slot machine, as shown in the following figure. When you click the mouse, the game displays three objects at random. If all three objects are alike, you win $20. If two are alike, you win $5; otherwise, you lose $1. After playing the game, study the code and explain how the program works.</p>&#13;
<div class="image1"><img alt="image" src="graphics/f0205-02.jpg"/></div></li>&#13;
<li><p class="noindenta">Open the file <em>Space.sb</em> from this chapter’s folder. In this game, you shoot at a UFO flying across the top of the screen (see the following figure). Use the left and right arrow keys to move, and press the spacebar to shoot. You have only 100 shots, and the game tracks your score. Think of some ways to improve the game and add them.</p>&#13;
<div class="image1"><img alt="image" src="graphics/f0205-03.jpg"/></div><span epub:type="pagebreak" id="page_206"/></li>&#13;
</ol>&#13;
</body></html>