<html><head></head><body><div class="chapter" title="Chapter&#xA0;5.&#xA0;Views"><div class="titlepage"><div><div><h1 class="title"><a id="views"/>Chapter 5. Views</h1></div></div></div><p><a class="indexterm" id="iddle1244"/><a class="indexterm" id="iddle1533"/><a class="indexterm" id="iddle1544"/><a class="indexterm" id="iddle2320"/>A <span class="emphasis"><em>view</em></span> is the user interface to your application.
        Typically, views include web pages for displaying database records and forms for creating
        and updating those records. Views also sometimes take the form of responses to API
        requests.</p><p>This chapter covers the most common Rails view template type, called <span class="emphasis"><em>Embedded
          Ruby</em></span>, as well as view-specific helpers and layouts. You’ll also learn how
        to avoid duplication in your HTML code with partials and how to generate forms to accept
        user input.</p><p>Enter <span class="strong"><strong><code class="literal">bin/rails server</code></strong></span> to start
        the Rails server now. And keep it running in a terminal window as you work through the
        examples in this chapter, so you can see the changes you make to the application in your web
        browser and watch the server output.</p><div class="sect1" title="Embedded Ruby"><div class="titlepage"><div><div><h1 class="title"><a id="embedded_ruby"/>Embedded Ruby</h1></div></div></div><p><a class="indexterm" id="iddle1020"/><a class="indexterm" id="iddle1021"/><a class="indexterm" id="iddle1123"/><a class="indexterm" id="iddle1143"/><a class="indexterm" id="iddle1148"/><a class="indexterm" id="iddle1375"/><a class="indexterm" id="iddle1519"/><a class="indexterm" id="iddle1534"/><a class="indexterm" id="iddle1545"/><a class="indexterm" id="iddle1866"/><a class="indexterm" id="iddle1919"/><a class="indexterm" id="iddle2214"/>Embedded Ruby (ERB), the default template type in Rails, is used to build view
          templates. An Embedded Ruby template contains a mixture of Ruby code and HTML that is
          similar to ASP, JSP, or PHP.</p><p>Templates are stored in a subdirectory of <span class="emphasis"><em>app/views</em></span> named after
          the controller. For example, you’ll find the templates for the posts controller in
            <span class="emphasis"><em>app/views/posts</em></span>. The Rails convention is to name templates after
          the action they represent, with the file extension <span class="emphasis"><em>.html.erb</em></span>. The
          default template for the <code class="literal">index</code> action is
            <span class="emphasis"><em>index.html.erb</em></span>.</p><p>Embedded Ruby contains three special tags for executing Ruby code. These tags are used
          for output, control flow, and comments. Let’s take a look at each of these.</p><div class="sect2" title="Output"><div class="titlepage"><div><div><h2 class="title"><a id="output"/>Output</h2></div></div></div><p>The <code class="literal">&lt;%= %&gt;</code> tag (also called the <span class="emphasis"><em>output
              tag</em></span>) executes the code it contains and prints the return value on the page.
            Open the file <span class="emphasis"><em>app/views/posts/show.html.erb</em></span> in your editor to see
            several examples of this tag.</p><p>For instance, this tag prints the title of the current post:</p><a id="pro_id00133"/><pre class="programlisting">&lt;%= @post.title %&gt;</pre><p>Note that any HTML in the title is escaped by default. That is, any reserved
            characters are converted to character references and displayed on the page instead of
            being interpreted as HTML. This safeguard prevents malicious users from entering HTML
            code on your page that could cause a page to break or even a cross-site scripting
            attack. Cross-site scripting attacks and other security concerns are covered in <a class="xref" href="ch11.html" title="Chapter 11. Security">Chapter 11</a>.</p></div><div class="sect2" title="Control Flow"><div class="titlepage"><div><div><h2 class="title"><a id="control_flow-id00008"/>Control Flow</h2></div></div></div><p>The <code class="literal">&lt;% %&gt;</code> tag executes the code it contains without
            printing anything on the page. This tag is useful for control flow statements such as
            loops or conditionals. Open the file <span class="emphasis"><em>app/views/posts/index.html.erb</em></span>
            to see this tag in action.</p><p>This example uses the <code class="literal">each</code> method to loop over an array of
            posts:</p><a id="pro_id00134"/><pre class="programlisting">&lt;% @posts.each do |post| %&gt;
  &lt;tr&gt;
    &lt;td&gt;&lt;%= post.title %&gt;&lt;/td&gt;
    &lt;td&gt;&lt;%= post.body %&gt;&lt;/td&gt;
    &lt;td&gt;&lt;%= link_to 'Show', post %&gt;&lt;/td&gt;
    &lt;td&gt;&lt;%= link_to 'Edit', edit_post_path(post) %&gt;&lt;/td&gt;
    &lt;td&gt;&lt;%= link_to 'Destroy', post, method: :delete,
              data: { confirm: 'Are you sure?' } %&gt;&lt;/td&gt;
  &lt;/tr&gt;
&lt;% end %&gt;</pre><p><a class="indexterm" id="iddle1022"/><a class="indexterm" id="iddle1535"/><a class="indexterm" id="iddle1546"/><a class="indexterm" id="iddle1682"/><a class="indexterm" id="iddle1801"/><a class="indexterm" id="iddle2005"/><a class="indexterm" id="iddle2286"/>Output tags are used inside the loop to print the values of
              <code class="literal">post.title</code> and <code class="literal">post.body</code>. This example also
            shows three instances of the <code class="literal">link_to</code> helper. These helpers create
            links to the <code class="literal">show</code>, <code class="literal">edit</code>, and
              <code class="literal">destroy</code> actions for each post. We’ll discuss helpers in the
            next section.</p></div><div class="sect2" title="Comments"><div class="titlepage"><div><div><h2 class="title"><a id="comments"/>Comments</h2></div></div></div><p>Finally, the <code class="literal">&lt;%# %&gt;</code> tag is used to enter comments.
              <span class="emphasis"><em>Comments</em></span> are usually notes to yourself or other programmers
            describing what your code does. Unlike HTML comments (which start with
              <code class="literal">&lt;!--</code> and end with <code class="literal">--&gt;</code>), ERB comments will
            not appear in the HTML source. Use ERB comments for notes that you don’t want to
            be visible in the HTML generated by the view template.</p><p>The ERB templates you’ve looked at so far were generated by the Rails scaffold
            when we first created our blog. They’re uncommented, but you can easily add your
            own comments. Here’s one:</p><a id="pro_id00135"/><pre class="programlisting">&lt;%# This code is crazy %&gt;</pre><p>In addition to notes to the programmer, you can also use ERB comments to remove code
            temporarily from the page. Add a hash sign (<code class="literal">#</code>) after the first
            percent sign (<code class="literal">%</code>) in any other ERB tag, and the code inside that tag
            will not be executed.</p></div></div><div class="sect1" title="Helpers"><div class="titlepage"><div><div><h1 class="title"><a id="helpers"/>Helpers</h1></div></div></div><p><span class="emphasis"><em>Helpers</em></span> are Ruby methods that simplify the code inside your
          views, making it easier to read. Rails includes helpers for creating links to resources,
          formatting numbers, and other common tasks. You can also easily write your own helper
          methods.</p><p>By using helpers, you can avoid placing too much logic in your view. If it takes more
          than a single line of code to display a value, then that code should probably be in a
          helper method.</p><div class="sect2" title="URL Helpers"><div class="titlepage"><div><div><h2 class="title"><a id="url_helpers"/>URL Helpers</h2></div></div></div><p>Create links with the <code class="literal">link_to</code> helper method:</p><a id="pro_id00136"/><pre class="programlisting">link_to 'Show', post</pre><p>This example generates an HTML link like this: <code class="literal">&lt;a href="/posts/1"&gt;
              Show&lt;/a&gt;</code>, assuming <code class="literal">post</code> has an
              <code class="literal">id</code> of 1.</p><p>You can also use the URL and path helpers you saw in the last chapter to create
            links:</p><a id="pro_id00137"/><pre class="programlisting">link_to 'Edit', edit_post_path(post)</pre><p>This example generates a link like this: <code class="literal">&lt;a
              href="/posts/1/edit"&gt;Edit&lt;/a&gt;</code>.</p><p><a class="indexterm" id="iddle1477"/><a class="indexterm" id="iddle1624"/><a class="indexterm" id="iddle1705"/><a class="indexterm" id="iddle1895"/><a class="indexterm" id="iddle1897"/><a class="indexterm" id="iddle1898"/><a class="indexterm" id="iddle1899"/><a class="indexterm" id="iddle1941"/>You can also include the HTTP verb to use for the link as well as additional
            data attributes. Use this for links that change state on the server, such as a link to
            destroy a resource. Remember that GET requests should not be used to change
            state.</p><a id="pro_id00138"/><pre class="programlisting">link_to 'Destroy', post, method: :delete,
  data: { confirm: 'Are you sure?'}</pre><p>This example generates a link with <code class="literal">data-method="delete"</code> and
              <code class="literal">data-confirm="Are you sure?"</code>. Rails includes the jQuery unobtrusive
            Java-Script library (jquery_ujs.js) by default. This library uses the method and confirm
            attributes to build a hidden form at run-time that creates a confirmation window and
            then submits the destroy link using a proper DELETE request. Aren’t you glad you
            don’t have to do that yourself?</p><div class="note" title="Note"><h3 class="title"><a id="ch05note01"/>Note</h3><p><span class="emphasis"><em>Web browsers are only able to issue GET and POST requests. Rails fakes
                the DELETE request by passing a parameter named <code class="literal">_method</code> with the
                value <code class="literal">delete</code>. When you update a record, the PATCH request is
                handled the same way.</em></span></p></div></div><div class="sect2" title="Number Helpers"><div class="titlepage"><div><div><h2 class="title"><a id="number_helpers"/>Number Helpers</h2></div></div></div><p>Rails includes several handy methods for displaying numbers:</p><a id="pro_id00139"/><pre class="programlisting">number_to_currency
number_to_human
number_to_human_size
number_to_percentage
number_with_delimiter
number_with_precision</pre><p>Each method accepts a number and returns a string representing that number with some
            formatting applied. That formatting is related to the word at the end of the
            method.</p><p>The <code class="literal">number_to_currency</code> method, shown next, rounds the given
            number to two decimal places and prepends a dollar sign:</p><a id="pro_id00140"/><pre class="programlisting">number_to_currency 100</pre><p>So this example returns <code class="literal">"$100.00"</code>.</p><p>The methods <code class="literal">number_to_human</code> and
              <code class="literal">number_to_human_size</code> convert numbers into easy-to-read string
            representations.</p><a id="pro_id00141"/><pre class="programlisting">number_to_human 1000000
number_to_human_size 1024</pre><p>So these examples return <code class="literal">"1 million"</code> and <code class="literal">"1
              KB"</code>, respectively.</p><p><a class="indexterm" id="iddle1102"/><a class="indexterm" id="iddle1103"/><a class="indexterm" id="iddle1104"/><a class="indexterm" id="iddle1108"/><a class="indexterm" id="iddle1597"/><a class="indexterm" id="iddle1683"/><a class="indexterm" id="iddle1726"/><a class="indexterm" id="iddle1900"/><a class="indexterm" id="iddle1946"/><a class="indexterm" id="iddle1981"/><a class="indexterm" id="iddle1985"/>Format percentages with <code class="literal">number_to_percentage</code>. This method
            rounds the number to three decimal places, by default, and appends a percent sign. You
            can specify a precision as an option.</p><a id="pro_id00142"/><pre class="programlisting">number_to_percentage 12.345
number_to_percentage 12.345, precision: 1</pre><p>These examples return <code class="literal">"12.345%"</code> and <code class="literal">"12.3%"</code>,
            respectively.</p><p>In addition to URL and number helpers, Rails also has built-in helpers for working
            with dates and assets such as images, CSS files, and JavaScript files. Later in this
            chapter, I cover helpers for creating forms and form fields.</p><p>I can’t cover all of the helpers in Rails here, so for now, let’s see
            how to add your own helper methods.</p></div><div class="sect2" title="Your Own Helpers"><div class="titlepage"><div><div><h2 class="title"><a id="your_own_helpers"/>Your Own Helpers</h2></div></div></div><p>You can easily create your own helpers by adding methods to the appropriate file in
            the <span class="emphasis"><em>app/helpers</em></span> directory. The Rails scaffold generator has created
            a couple of mostly empty files in that directory for you automatically.</p><p>Add helpers that are only needed in a single controller to the helper file for that
            controller. For example, helpers that are only used in posts views should be added to
            the <code class="literal">PostsHelper</code> module in
              <span class="emphasis"><em>app/helpers/posts_helper.rb.</em></span></p><p>Add helpers used throughout the application to the
              <code class="literal">ApplicationHelper</code> module in
              <span class="emphasis"><em>app/helpers/application_helper.rb</em></span>. Open this file and let’s
            see how it works:</p><a id="pro_id00143"/><pre class="programlisting">module ApplicationHelper
  <span class="strong"><strong>def friendly_date(d)</strong></span>
    <span class="strong"><strong>d.strftime("%B %e, %Y")</strong></span>
  <span class="strong"><strong>end</strong></span>
end</pre><p>This code defines a new helper method called <code class="literal">friendly_date</code>. You
            can use this method in any view in your application to format a date for display.</p><a id="pro_id00144"/><pre class="programlisting">friendly_date Time.new(2014, 12, 25)</pre><p>This example returns <code class="literal">"December 25, 2014"</code>. If you later decide to
            display dates in a different format throughout your application, you only have to change
            this method instead of changing all of your views.</p></div></div><div class="sect1" title="The Posts Index Page"><div class="titlepage"><div><div><h1 class="title"><a id="posts_index_page"/>The Posts Index Page</h1></div></div></div><p>Now that you know more about how views work in Rails, let’s update the index
          view to look more like a blog. Go to <span class="emphasis"><em>http://localhost:3000/posts</em></span> in
          your browser to see the index page, shown in <a class="xref" href="ch05.html#posts_index_page-id00009" title="Figure 5-1. The posts index page">Figure 5-1</a>.</p><div class="figure"><a id="posts_index_page-id00009"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00005"/><img alt="The posts index page" src="httpatomoreillycomsourcenostarchimages2169068.png.jpg"/></div></div><p class="title">Figure 5-1. The posts index page</p></div><p><a class="indexterm" id="iddle1144"/>Your blog posts are currently displayed in a table. Open the file
            <span class="emphasis"><em>app/views/posts/index.html.erb</em></span> in your editor:</p><a id="pro_id00145"/><pre class="programlisting">  &lt;h1&gt;Listing posts&lt;/h1&gt;

➊ &lt;table&gt;
    &lt;thead&gt;
      &lt;tr&gt;
        &lt;th&gt;Title&lt;/th&gt;
        &lt;th&gt;Body&lt;/th&gt;
        &lt;th&gt;&lt;/th&gt;
        &lt;th&gt;&lt;/th&gt;
        &lt;th&gt;&lt;/th&gt;
      &lt;/tr&gt;
    &lt;/thead&gt;

    &lt;tbody&gt;
➋     &lt;% @posts.each do |post| %&gt;
        &lt;tr&gt;
          &lt;td&gt;&lt;%= post.title %&gt;&lt;/td&gt;
          &lt;td&gt;&lt;%= post.body %&gt;&lt;/td&gt;
          &lt;td&gt;&lt;%= link_to 'Show', post %&gt;&lt;/td&gt;
          &lt;td&gt;&lt;%= link_to 'Edit', edit_post_path(post) %&gt;&lt;/td&gt;
          &lt;td&gt;&lt;%= link_to 'Destroy', post, method: :delete,
                    data: { confirm: 'Are you sure?' } %&gt;&lt;/td&gt;
        &lt;/tr&gt;
       &lt;% end %&gt;
      &lt;/tbody&gt;
    &lt;/table&gt;

    &lt;br&gt;

    &lt;%= link_to 'New Post', new_post_path %&gt;</pre><p>This template first creates an HTML table ➊ and adds a table header to the
          page. It then loops over each post ➋ and displays that post’s attributes in a
          table row.</p><p>A proper blog would display each post title as a heading followed by the post body in
          a paragraph. Update the index view to look like this:</p><a id="pro_id00146"/><pre class="programlisting">  &lt;h1&gt;Listing posts&lt;/h1&gt;

➊  <span class="strong"><strong>&lt;% @posts.each do |post| %&gt;</strong></span>
➋  <span class="strong"><strong>&lt;h2&gt;&lt;%= link_to post.title, post %&gt;&lt;/h2&gt;</strong></span>
➌  <span class="strong"><strong>&lt;p&gt;&lt;i&gt;&lt;%= friendly_date post.created_at %&gt;&lt;/i&gt;</strong></span>
 <span class="strong"><strong>&lt;p&gt;&lt;%= post.body %&gt;</strong></span>
➍  <span class="strong"><strong>&lt;p&gt;</strong></span>
   <span class="strong"><strong>&lt;%= link_to 'Edit', edit_post_path(post) %&gt;</strong></span>
   <span class="strong"><strong>&lt;%= link_to 'Destroy', post, method: :delete,</strong></span>
         data: { confirm: 'Are you sure?' } %&gt;
  <span class="strong"><strong>&lt;/p&gt;</strong></span>
  <span class="strong"><strong>&lt;% end %&gt;</strong></span>

  &lt;br&gt;

  &lt;%= link_to 'New Post', new_post_path %&gt;</pre><p>The template still loops over each post ➊ as before. Instead of displaying the
          post attributes in table cells, however, it now shows the <code class="literal">title</code>
          ➋ in a second-level heading and uses the <code class="literal">friendly_date</code> helper
          ➌ you added in the previous section to format the <code class="literal">created_at</code>
          date. The links ➍ to <code class="literal">edit</code> and <code class="literal">destroy</code> the
          post are now at the bottom, and the link to <code class="literal">show</code> the post is now around
          the post <code class="literal">title</code>. Refresh the page in your browser to see the changes,
          shown in <a class="xref" href="ch05.html#updated_posts_index_page" title="Figure 5-2. The updated posts index page">Figure 5-2</a>.</p><div class="figure"><a id="updated_posts_index_page"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00006"/><img alt="The updated posts index page" src="httpatomoreillycomsourcenostarchimages2169070.png.jpg"/></div></div><p class="title">Figure 5-2. The updated posts index page</p></div><p>Our blog still won’t win any design awards, but it’s looking
          better!</p></div><div class="sect1" title="Layouts"><div class="titlepage"><div><div><h1 class="title"><a id="layouts"/>Layouts</h1></div></div></div><p><a class="indexterm" id="iddle1135"/><a class="indexterm" id="iddle1254"/><a class="indexterm" id="iddle1402"/><a class="indexterm" id="iddle1408"/><a class="indexterm" id="iddle1506"/><a class="indexterm" id="iddle1527"/><a class="indexterm" id="iddle1677"/><a class="indexterm" id="iddle1701"/><a class="indexterm" id="iddle1791"/><a class="indexterm" id="iddle2322"/><a class="indexterm" id="iddle2331"/>You may have noticed that the views you’ve seen so far only include the
          contents of the web page without the other required elements such as
            <code class="literal">html</code>, <code class="literal">head</code>, and <code class="literal">body</code>. These
          elements are the basic structure of all web pages.</p><p>Check the server output in your terminal to see what’s happening when you load
          the index page:</p><a id="pro_id00147"/><pre class="programlisting">   --<span class="emphasis"><em>snip</em></span>--
➊  Started GET "/posts" for 127.0.0.1 at 2014-03-09 18:34:40 -0500
➋  Processing by PostsController#index as HTML
     Post Load (0.2ms) SELECT "posts".* FROM "posts"
➌    Rendered posts/index.html.erb within layouts/application (62.5ms)
   Completed 200 OK in 92ms (Views: 91.2ms | ActiveRecord: 0.2ms)
   --<span class="emphasis"><em>snip</em></span>--</pre><p>Here, we have a GET request ➊ for the path <span class="emphasis"><em>/posts</em></span>. It is
          processed by the index method ➋ in PostsController. Finally, the server renders
          posts/index.html.erb within layouts/application ➌.</p><p>In Rails, a <span class="emphasis"><em>layout</em></span> is a file containing the basic HTML required
          for every page on your site. Rather than repeat the same HTML in every view, you only
          write it once inside the layout file. This is another way that Rails removes needless
          duplication.</p><p>Let’s jump right in and dissect the layout for your blog. The server output
          calls it <code class="literal">layouts/application</code>, so open
            <span class="emphasis"><em>app/views/layouts/application.html.erb</em></span> to see the layout for your
          application:</p><a id="pro_id00148"/><pre class="programlisting">➊ &lt;!DOCTYPE html&gt;
  &lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;Blog&lt;/title&gt;
    &lt;%= stylesheet_link_tag 'application', media: 'all',
➋         'data-turbolinks-track' =&gt; true %&gt;
    &lt;%= javascript_include_tag 'application',
➌         'data-turbolinks-track' =&gt; true %&gt;
➍   &lt;%= csrf_meta_tags %&gt;
  &lt;/head&gt;
  &lt;body&gt;

➎ &lt;%= yield %&gt;

&lt;/body&gt;
&lt;/html&gt;</pre><p>This file contains the basic HTML for every page on your site: the HTML5
            <code class="literal">doctype</code> ➊ followed by the <code class="literal">head</code> section and
            <code class="literal">body</code> section.</p><p>The <code class="literal">head</code> section sets the title of the page. It then includes Rails
          helpers for linking to your site’s CSS ➋ and JavaScript ➌ files. It
          also includes a helper ➍ that protects your application from <span class="emphasis"><em>cross-site
            request forgery (CSRF)</em></span> attacks, which I’ll cover in <a class="xref" href="ch11.html" title="Chapter 11. Security">Chapter 11</a>. The <code class="literal">body</code> section includes the
            <code class="literal">yield</code> statement ➎.</p><p><a class="indexterm" id="iddle1068"/><a class="indexterm" id="iddle1070"/><a class="indexterm" id="iddle1172"/><a class="indexterm" id="iddle1178"/><a class="indexterm" id="iddle1304"/><a class="indexterm" id="iddle1767"/><a class="indexterm" id="iddle1816"/><a class="indexterm" id="iddle2037"/><a class="indexterm" id="iddle2202"/>The rest of this section covers these helper methods and the
            <code class="literal">yield</code> statement.</p><div class="sect2" title="Asset Tag Helpers"><div class="titlepage"><div><div><h2 class="title"><a id="asset_tag_helpers"/>Asset Tag Helpers</h2></div></div></div><p>In a Rails application, files such as CSS, JavaScript, and images are called
              <span class="emphasis"><em>assets</em></span>. Assets are external files needed by the web browser
            accessing your application. These files are stored in subdirectories of the
              <span class="emphasis"><em>app/assets</em></span> directory.</p><p>As your application grows, you may need several CSS and JavaScript files to control
            your site’s appearance and client-side functionality. The Rails server output also
            lists the CSS and JavaScript files your application is already using:</p><a id="pro_id00149"/><pre class="programlisting">  --<span class="emphasis"><em>snip</em></span>--
➊ Started GET "/assets/scaffolds.css?body=1" for 127.0.0.1 at ...

➊ Started GET "/assets/application.css?body=1" for 127.0.0.1 at ...

➋ Started GET "/assets/turbolinks.js?body=1" for 127.0.0.1 at ...

➋ Started GET "/assets/jquery.js?body=1" for 127.0.0.1 at ...

➋ Started GET "/assets/posts.js?body=1" for 127.0.0.1 at ...

➋ Started GET "/assets/jquery_ujs.js?body=1" for 127.0.0.1 at ...

➋ Started GET "/assets/application.js?body=1" for 127.0.0.1 at ...

➊ Started GET "/assets/posts.css?body=1" for 127.0.0.1 at ...</pre><p>As you can see, our simple blog is already using three different CSS files ➊
            and five JavaScript files ➋. Rather than list each of these files separately in
            the layout, Rails uses CSS and JavaScript files called <span class="emphasis"><em>manifests</em></span> to
            require individual CSS and JavaScript files. A manifest file is simply a list of other
            files needed by your application.</p><p>A Rails feature known as the <span class="emphasis"><em>asset pipeline</em></span> combines these CSS
            and JavaScript files together into two files and compresses them when your application
            is running in the production environment. These files are named
              <span class="emphasis"><em>application.css</em></span> and <span class="emphasis"><em>application.js</em></span>. By
            combining these files, your application receives fewer requests from users, which should
            improve its performance.</p><p>The <code class="literal">head</code> section of the layout contains ERB tags for adding the
            CSS and JavaScript manifest files that your application needs.</p><div class="sect3" title="stylesheet_link_tag"><div class="titlepage"><div><div><h3 class="title"><a id="stylesheetunderscorelinkunderscoretag"/>stylesheet_link_tag</h3></div></div></div><p>The <code class="literal">stylesheet_link_tag</code> method adds an HTML link tag for the
              default CSS manifest, <span class="emphasis"><em>application.css</em></span>, and each of the CSS files
              referenced in the manifest. Open the file
                <span class="emphasis"><em>app/assets/stylesheets/application.css</em></span> to see how it
              works.</p><a id="pro_id00150"/><pre class="programlisting"> /*
  --<span class="emphasis"><em>snip</em></span>-
  *

➊ *= require_tree .
➋ *= require_self
  */</pre><p><a class="indexterm" id="iddle1073"/><a class="indexterm" id="iddle1411"/><a class="indexterm" id="iddle1412"/><a class="indexterm" id="iddle1768"/><a class="indexterm" id="iddle2095"/><a class="indexterm" id="iddle2099"/><a class="indexterm" id="iddle2260"/>This file starts with a block of comments explaining its purpose as well
              as the lines starting with <code class="literal">require_tree</code> ➊ and
                <code class="literal">require_self</code> ➋. The <code class="literal">require_tree</code>.
              statement includes all other CSS files in the
                <span class="emphasis"><em>app/assets/stylesheets</em></span> directory and subdirectories. The
              require_self statement means the contents of this CSS file are included at the
              bottom.</p></div><div class="sect3" title="javascript_include_tag"><div class="titlepage"><div><div><h3 class="title"><a id="javascriptunderscoreincludeunderscoretag"/>javascript_include_tag</h3></div></div></div><p>The <code class="literal">javascript_include_tag</code> method adds a script tag for the
              default JavaScript manifest, <span class="emphasis"><em>application.js</em></span>, and each of the
              JavaScript files listed in the manifest. Now open the JavaScript manifest
                <span class="emphasis"><em>app/assets/javascript/application.js</em></span>.</p><a id="pro_id00151"/><pre class="programlisting">--<span class="emphasis"><em>snip</em></span>-
//
//= require jquery
//= require jquery_ujs
//= require turbolinks
//= require_tree .</pre><p>This file is similar to the CSS manifest. It starts with a block of comments
              explaining its purpose and then includes the JavaScript libraries,
                <code class="literal">jquery</code>, <code class="literal">jquery_ujs</code>, and
                <code class="literal">turbolinks</code> by default, as well as any other JavaScript files in
              the <span class="emphasis"><em>app/assets/javascript</em></span> directory and subdirectories.</p><div class="note" title="Note"><h3 class="title"><a id="ch05note02"/>Note</h3><p><span class="emphasis"><em>The asset pipeline, turbolinks, and other performance issues are
                  discussed in more detail in <a class="xref" href="ch12.html" title="Chapter 12. Performance">Chapter 12</a>.</em></span></p></div></div></div><div class="sect2" title="CSRF Meta Tags Helper"><div class="titlepage"><div><div><h2 class="title"><a id="csrf_meta_tags_helper"/>CSRF Meta Tags Helper</h2></div></div></div><p>The <code class="literal">csrf_meta_tags</code> method adds two meta tags to the head of each
            web page. These tags are designed to protect your application from CSRF attacks.</p><p>If you view the source on any page of your application, you should see a meta tag
            named <code class="literal">csrf-token</code> that contains a long string of random hexadecimal
            digits. This token is unique to your current session and is passed to your application
            any time a form is submitted.</p><a id="pro_id00152"/><pre class="programlisting">&lt;meta content="authenticity_token" name="csrf-param" /&gt;
&lt;meta content="..." name="csrf-token" /&gt;</pre><p><a class="indexterm" id="iddle1030"/><a class="indexterm" id="iddle1333"/><a class="indexterm" id="iddle1334"/><a class="indexterm" id="iddle1699"/><a class="indexterm" id="iddle1865"/><a class="indexterm" id="iddle1933"/><a class="indexterm" id="iddle2088"/><a class="indexterm" id="iddle2271"/><a class="indexterm" id="iddle2348"/>In a CSRF attack, a trusted user of your application visits a malicious
            site. The malicious site then attempts to submit requests to your application as that
            trusted user. Because the malicious site has no way of knowing this secret token, these
            requests fail. CSRF and other security concerns are covered in <a class="xref" href="ch11.html" title="Chapter 11. Security">Chapter 11</a>.</p></div><div class="sect2" title="Yield"><div class="titlepage"><div><div><h2 class="title"><a id="yield"/>Yield</h2></div></div></div><p>In a layout, the <code class="literal">yield</code> statement identifies where content from
            the view should be inserted. In this case, the HTML generated by
              <span class="emphasis"><em>app/views/posts/index.html</em></span> is inserted between the
              <code class="literal">body</code> tags to form the complete web page that is sent to the
            user.</p><p>The <code class="literal">yield</code> statement is not required to be the only statement in
            the <code class="literal">body</code> element. You can add other elements to the body as needed.
            For example, you might add a common header or footer here that appears on each page of
            your application.</p></div></div><div class="sect1" title="Partials"><div class="titlepage"><div><div><h1 class="title"><a id="partials"/>Partials</h1></div></div></div><p>Like helpers, <span class="emphasis"><em>partials</em></span> are used to extract code into meaningful
          units and to avoid duplicating code that is common to multiple views. The difference is
          that whereas helpers contain shared Ruby code, partials contain shared HTML code.</p><p>Partials are stored in view templates with filenames that begin with an underscore.
          For example, <span class="emphasis"><em>app/views/posts/_form.html.erb</em></span> is a partial that renders
          a post form.</p><p>Code that is repeated across multiple pages is commonly separated out into partials to
          make the template code easier to follow. If you look at the new post and edit post
          templates, <span class="emphasis"><em>app/views/posts/new.html.erb</em></span> and
            <span class="emphasis"><em>app/views/posts/edit.html.erb,</em></span> respectively, you’ll see they
          both render the same form partial with this line of code:</p><a id="pro_id00153"/><pre class="programlisting">&lt;%= render 'form' %&gt;</pre><p>Here, the partial is named <span class="emphasis"><em>_form.html.erb</em></span> but is referred to
          simply as <code class="literal">form</code> when rendered.</p><p>If you find yourself repeating the same HTML code on more than one page, or in more
          than one place on a single page, you should copy that code into a partial and replace it
          with a <code class="literal">render</code> statement.</p><div class="sect2" title="Collections"><div class="titlepage"><div><div><h2 class="title"><a id="collections"/>Collections</h2></div></div></div><p>Partials can also be used to eliminate loops in view templates. When you use the
              <code class="literal">:collection</code> option, a corresponding partial is inserted into the
            template for each member of the collection. Using <code class="literal">:collection</code>
            doesn’t necessarily remove code duplication entirely, but it can simplify the
            template.</p><p><a class="indexterm" id="iddle1149"/><a class="indexterm" id="iddle1348"/>For example, you could move the code inside the <code class="literal">&lt;% @posts.each
              ... %&gt;</code> block in <span class="emphasis"><em>index.html.erb</em></span> into a new file named
              <span class="emphasis"><em>app/views/posts/_post.html.erb</em></span>. You could then replace the block
            with a single line of code like this one:</p><a id="pro_id00154"/><pre class="programlisting">&lt;%= render :partial =&gt; 'post', :collection =&gt; @posts %&gt;</pre><p>In this example, Rails understands that <code class="literal">@posts</code> is an array of
            post objects, so it looks for a partial named
              <span class="emphasis"><em>app/views/posts/_post.html.erb</em></span> and renders it on the page once
            for each object in the array. Because this action is so common, you can simplify even
            further to this:</p><a id="pro_id00155"/><pre class="programlisting">&lt;%= render @posts %&gt;</pre><p>Let’s get some hands-on experience with partials by adding comments to the
            post show page.</p></div><div class="sect2" title="Showing Comments"><div class="titlepage"><div><div><h2 class="title"><a id="showing_comments"/>Showing Comments</h2></div></div></div><p>You added a model for comments in <a class="xref" href="ch03.html" title="Chapter 3. Models">Chapter 3</a> and a controller in <a class="xref" href="ch04.html" title="Chapter 4. Controllers">Chapter 4</a>, but you still can’t see them on the page. Nearly every
            post should have comments, and you don’t want to repeat that code in every single
            page, so this is a perfect opportunity to put partials to work.</p><p>To get started, open <span class="emphasis"><em>app/views/posts/show.html.erb</em></span> in your
            editor:</p><a id="pro_id00156"/><pre class="programlisting">&lt;p id='notice'&gt;&lt;%= notice %&gt;&lt;/p&gt;

&lt;p&gt;
  &lt;strong&gt;Title:&lt;/strong&gt;
  &lt;%= @post.title %&gt;
&lt;/p&gt;

&lt;p&gt;
 &lt;strong&gt;Body:&lt;/strong&gt;
 &lt;%= @post.body %&gt;
&lt;/p&gt;

&lt;%= link_to 'Edit', edit_post_path(@post) %&gt; |
&lt;%= link_to 'Back', posts_path %&gt;</pre><p>Let’s first clean up this page a bit like we did the posts index page by
            wrapping the <code class="literal">title</code> in a heading tag and the <code class="literal">body</code>
            in a paragraph, as shown here:</p><a id="pro_id00157"/><pre class="programlisting">&lt;p id='notice'&gt;&lt;%= notice %&gt;&lt;/p&gt;

<span class="strong"><strong>&lt;h2&gt;&lt;%= @post.title %&gt;&lt;/h2&gt;</strong></span>

<span class="strong"><strong>&lt;p&gt;&lt;%= @post.body %&gt;&lt;/p&gt;</strong></span>

&lt;%= link_to 'Edit', edit_post_path(@post) %&gt; |
&lt;%= link_to 'Back', posts_path %&gt;</pre><p><a class="indexterm" id="iddle1384"/><a class="indexterm" id="iddle1590"/><a class="indexterm" id="iddle1687"/><a class="indexterm" id="iddle1881"/><a class="indexterm" id="iddle2052"/>Now add a heading and a render statement for the comments at the bottom of
            the page:</p><a id="pro_id00158"/><pre class="programlisting">--<span class="emphasis"><em>snip</em></span>--

<span class="strong"><strong>&lt;h3&gt;Comments&lt;/h3&gt;</strong></span>

<span class="strong"><strong>&lt;%= render @post.comments %&gt;</strong></span></pre><p>This code shows the comments under the heading by rendering the
              <code class="literal">@post.comments</code> collection with a partial. For this to work,
            you’ll also need to create a partial for rendering a single comment. Create a new
            file named <span class="emphasis"><em>app/views/comments/_comment.html.erb</em></span> containing
            this:</p><a id="pro_id00159"/><pre class="programlisting"><span class="strong"><strong>&lt;p&gt;&lt;%= comment.author %&gt; said:&lt;/p&gt;</strong></span>

<span class="strong"><strong>&lt;blockquote&gt;</strong></span>
  <span class="strong"><strong>&lt;%= comment.body %&gt;</strong></span>
<span class="strong"><strong>&lt;/blockquote&gt;</strong></span></pre><p>If you added any comments earlier using the Rails console, you should now see them
            at the bottom of the page. Of course, you can’t ask your users to add comments
            using the console; they expect a comment form. Let’s see how forms are created in
            a Rails application.</p></div></div><div class="sect1" title="Forms"><div class="titlepage"><div><div><h1 class="title"><a id="forms"/>Forms</h1></div></div></div><p>Accepting input from users can be one of the more difficult parts of building a web
          application. Rails includes an elegant system for generating forms.</p><p>Rails provides helper methods for the various form controls. When bound to a model,
          these helper methods generate the correct HTML markup for passing values back to the
          controller automatically.</p><p>Go to <span class="emphasis"><em>http://localhost:3000/posts/new</em></span> in your browser to see the
          New Post form created by the Rails scaffold generator, as shown in <a class="xref" href="ch05.html#new_post_form" title="Figure 5-3. The New Post form">Figure 5-3</a>.</p><div class="figure"><a id="new_post_form"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00007"/><img alt="The New Post form" src="httpatomoreillycomsourcenostarchimages2169072.png.jpg"/></div></div><p class="title">Figure 5-3. The New Post form</p></div><p><a class="indexterm" id="iddle1547"/><a class="indexterm" id="iddle1548"/>This simple form consists of a text box for the post <code class="literal">title</code>,
          a text area for the post <code class="literal">body</code>, and a button labeled Create Post to
          submit the form.</p><div class="sect2" title="Form Helpers"><div class="titlepage"><div><div><h2 class="title"><a id="form_helpers"/>Form Helpers</h2></div></div></div><p>You can use helpers to generate a form and all of the necessary fields and labels.
            Open the file <span class="emphasis"><em>app/views/posts/_form.html.erb</em></span> to see an example of a
            Rails form:</p><a id="pro_id00160"/><pre class="programlisting">➊ &lt;%= form_for(@post) do |f| %&gt;
➋   &lt;% if @post.errors.any? %&gt;
➌     &lt;div id="error_explanation"&gt;
        &lt;h2&gt;&lt;%= pluralize(@post.errors.count, 'error') %&gt;
          prohibited this post from being saved:&lt;/h2&gt;

        &lt;ul&gt;
        &lt;% @post.errors.full_messages.each do |msg| %&gt;
          &lt;li&gt;&lt;%= msg %&gt;&lt;/li&gt;
        &lt;% end %&gt;
        &lt;/ul&gt;
      &lt;/div&gt;
     &lt;% end %&gt;

➍    &lt;div class='field'&gt;
       &lt;%= f.label :title %&gt;&lt;br&gt;
       &lt;%= f.text_field :title %&gt;
     &lt;/div&gt;
     &lt;div class='field'&gt;
       &lt;%= f.label :body %&gt;&lt;br&gt;
       &lt;%= f.text_area :body %&gt;
     &lt;/div&gt;
     &lt;div class='actions'&gt;
       &lt;%= f.submit %&gt;
     &lt;/div&gt;
   &lt;% end %&gt;</pre><p>This partial is used when creating a new post and editing an existing post. The form
            begins with a call to the <code class="literal">form_for</code> method ➊ with a block that
            contains the rest of the form. Next an <code class="literal">if</code> statement ➋ checks
            to see if the post contains any errors. If the form has errors, the
              <code class="literal">error_explanation div</code> ➌ appears before the rest of the form.
            Otherwise, nothing is shown here. Finally, you’ll see the form controls
            ➍.</p></div><div class="sect2" title="Form Errors"><div class="titlepage"><div><div><h2 class="title"><a id="form_errors"/>Form Errors</h2></div></div></div><p>Let’s first look at the code for displaying errors like the one shown in <a class="xref" href="ch05.html#post_creation_error" title="Figure 5-4. Post creation error">Figure 5-4</a>. Remember from our discussion of controllers that if a
              <code class="literal">create</code> or <code class="literal">update</code> action fails, the form will be
            rendered again. Try creating a new post with a blank title to see the error.</p><div class="figure"><a id="post_creation_error"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00008"/><img alt="Post creation error" src="httpatomoreillycomsourcenostarchimages2169074.png.jpg"/></div></div><p class="title">Figure 5-4. Post creation error</p></div><p><a class="indexterm" id="iddle1564"/><a class="indexterm" id="iddle1587"/><a class="indexterm" id="iddle1588"/><a class="indexterm" id="iddle1789"/><a class="indexterm" id="iddle2242"/><a class="xref" href="ch05.html#post_creation_error" title="Figure 5-4. Post creation error">Figure 5-4</a> shows the <code class="literal">error_explanation
              div</code> with the number of errors in a heading followed by a bulleted list of
            the actual errors. Also, the label for the <code class="literal">title</code> field now has a red
            background and the text box for the <code class="literal">title</code> is outlined in red. Rails
            does this by wrapping these elements in a <code class="literal">div</code> with class
              <code class="literal">field_with_errors</code>.</p><p>Now that you know how to display errors, let’s look at the
              <code class="literal">form_for</code> method and other helper methods for creating form
            controls.</p></div><div class="sect2" title="Form Controls"><div class="titlepage"><div><div><h2 class="title"><a id="form_controls"/>Form Controls</h2></div></div></div><p>Use the <code class="literal">form_for</code> block to create a form bound to a model. For
            example, this particular form is bound to the model stored in
            <code class="literal">@post</code>:</p><a id="pro_id00161"/><pre class="programlisting">&lt;%= form_for(@post) do |f| %&gt;</pre><p>Within this block, you have access to helper methods to add controls such as labels,
            text fields, and buttons to the form. Use the <span class="emphasis"><em>form builder object</em></span>
            (in this case <code class="literal">f</code>) to call these methods.</p><a id="pro_id00162"/><pre class="programlisting">&lt;%= f.label :title %&gt;</pre><p>The <code class="literal">label</code> helper is used to create a label tag for the specified
            field. The previous statement will generate this HTML: <code class="literal">&lt;label
              for="post_title"&gt; Title&lt;/label&gt;</code>. Rails converts the field name to a
            string and capitalizes the first letter. Your users can click this label to focus the
            cursor in the text field for the title. Of course, you still have to create that text
            field, and Rails has a helper for that, too.</p><a id="pro_id00163"/><pre class="programlisting">&lt;%= f.text_field :title %&gt;</pre><p><a class="indexterm" id="iddle1345"/><a class="indexterm" id="iddle1349"/><a class="indexterm" id="iddle1589"/><a class="indexterm" id="iddle1591"/><a class="indexterm" id="iddle1700"/><a class="indexterm" id="iddle1960"/><a class="indexterm" id="iddle1961"/><a class="indexterm" id="iddle2060"/><a class="indexterm" id="iddle2203"/>The <code class="literal">text_field</code> helper generates the following HTML:
              <code class="literal">&lt;input id= "post_title" name="post[title]" type="text" /&gt;</code>.
            Note that the <code class="literal">id</code> of this input (<code class="literal">post_title</code>)
            matches the <code class="literal">for</code> value of the label tag in the previous paragraph.
            Also notice the name of this field. Rails sets names on form fields to indicate both the
            model (<code class="literal">post</code>) and the attribute to modify
            (<code class="literal">title</code>).</p><p>The next few lines of code add a <code class="literal">label</code> for the post
              <code class="literal">body</code> followed by a <code class="literal">text_area</code> for entering the
              <code class="literal">body</code> text. These controls work the same as the
              <code class="literal">title</code> fields. The <code class="literal">text_area</code> helper generates
            this HTML: <code class="literal">&lt;textarea id= "post_body"
              name="post[body]"&gt;&lt;/textarea&gt;</code>.</p><p>Besides controls for entering the <code class="literal">title</code> and
              <code class="literal">body</code> text, you need a button to submit the form:</p><a id="pro_id00164"/><pre class="programlisting">&lt;%= f.submit %&gt;</pre><p>The <code class="literal">submit</code> helper generates a submit button. The button’s
            label is based on the class name of the current model and whether the model has been
            saved to the database. In the case of a new post, the value will be <code class="literal">"Create
              Post"</code> and the HTML looks like this: <code class="literal">&lt;input name="commit"
              type="submit" value="Create Post" /&gt;</code>. If the post has already been saved
            to the database, the value is <code class="literal">"Update Post"</code>.</p><p>Rails includes form helpers for every field you need, and you can always add your
            own helpers to create custom fields. Built-in examples include
              <code class="literal">check_box</code>, <code class="literal">hidden_field</code>,
              <code class="literal">password_field</code>, <code class="literal">radio_button</code>, and
              <code class="literal">text_area</code>.</p><p>Helper methods for HTML5 field types, such as <code class="literal">email_field</code>,
              <code class="literal">phone_field</code>, and <code class="literal">url_field</code>, are also included.
            These fields look like regular text fields, but on mobile devices, you’ll see an
            alternate keyboard. Use these field types to ensure that your application is
            mobile-friendly.</p></div></div><div class="sect1" title="Comment Form"><div class="titlepage"><div><div><h1 class="title"><a id="comment_form"/>Comment Form</h1></div></div></div><p>Now let’s put your new form knowledge to work and add the comment form. First,
          add another heading to the end of the post show page at
            <span class="emphasis"><em>app/views/posts/show.html.erb</em></span>:</p><a id="pro_id00165"/><pre class="programlisting">&lt;h4&gt;New Comment&lt;/h4&gt;</pre><p>Add the form for creating a comment underneath that new heading, as shown next. The
          array being passed to the <code class="literal">form_for</code> method contains both
            <code class="literal">@post</code> and <code class="literal">@post.comments.build</code>. Because every
          comment belongs to a post, you must pass the post and comment to the method. In this case,
          you’re using the current post and a new comment created by
            <code class="literal">@post.comments.build</code>.</p><a id="pro_id00166"/><pre class="programlisting">&lt;%= form_for [@post, @post.comments.build] do |f| %&gt;
  &lt;div class='field'&gt;
    &lt;%= f.label :author %&gt;&lt;br&gt;
    &lt;%= f.text_field :author %&gt;
  &lt;/div&gt;
  &lt;div class='field'&gt;
    &lt;%= f.label :body %&gt;&lt;br&gt;
    &lt;%= f.text_area :body %&gt;
  &lt;/div&gt;
  &lt;div class='actions'&gt;
    &lt;%= f.submit %&gt;
  &lt;/div&gt;
 &lt;% end %&gt;</pre><p>The rest of the comment form should look similar to the post form; even the field
          names are the same. Refresh the page in your browser and make sure the form renders like
          the one shown in <a class="xref" href="ch05.html#new_comment_form" title="Figure 5-5. The New Comment form">Figure 5-5</a>.</p><div class="figure"><a id="new_comment_form"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00009"/><img alt="The New Comment form" src="httpatomoreillycomsourcenostarchimages2169076.png.jpg"/></div></div><p class="title">Figure 5-5. The New Comment form</p></div><p>Now enter an author name and comment body and click the <span class="strong"><strong>Create
            Comment</strong></span> button. Submitting the form should display your new comment and add a
          flash message to the top of the page that says “Comment was successfully
          created.”</p><p>Check the output of the <code class="literal">rails server</code> command in your terminal to
          see exactly what happened. Assuming your post has an <code class="literal">id</code> of 1, you
          should first see a POST to the path <code class="literal">/posts/1/comments</code>. This calls the
            <code class="literal">CommentsController#create</code> method.</p><p>You added this controller and method in the last chapter; recall that the
            <code class="literal">create</code> method builds and saves a new comment and then redirects the
          user back to the post. You should see this redirect as a GET request for
            <code class="literal">/posts/1</code> in the output. This happens when the user is redirected back
          to the post show page.</p></div><div class="sect1" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="summary-id00010"/>Summary</h1></div></div></div><p>Spend some time working on your application’s views. We cleaned up the index
          page a little, but I recommend you improve it further. The other pages could also use some
          work. The following exercises should give you some ideas.</p><p>In the next chapter, you’ll set up Git for version control and deploy your
          application to the web for everyone to see.</p></div><div class="sect1" title="Exercises"><div class="titlepage"><div><div><h1 class="title"><a id="exercises-id00011"/>Exercises</h1></div></div></div><div class="qandaset" title="Frequently Asked Questions"><a id="ch05qa1"/><table border="0" summary="Q and A Set" width="100%"><col align="left" width="1%"/><col/><tbody><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch05qa1qe1"/><a id="ch05qa1q1"/><p>Q:</p></td><td align="left" valign="top"><p>1. Our blog’s heading only appears on the <code class="literal">index</code> page.
                Move the <code class="literal">h1</code> element from the posts index page to the application
                layout. While you’re at it, come up with something a little more interesting
                to call it than “Listing posts.” Also, change the <code class="literal">h1</code>
                headings on the New Post and Edit Post pages to <code class="literal">h2</code>
                headings.</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch05qa1qe2"/><a id="ch05qa1q2"/><p>Q:</p></td><td align="left" valign="top"><p>2. In <a class="xref" href="ch03.html" title="Chapter 3. Models">Chapter 3</a>, you added an <code class="literal">author</code> field to
                the posts table. Add a text field for <code class="literal">author</code> to the post form and
                update the <code class="literal">post_params</code> method in
                  <code class="literal">PostsController</code> to permit <code class="literal">author</code> as a
                parameter.</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch05qa1qe3"/><a id="ch05qa1q3"/><p>Q:</p></td><td align="left" valign="top"><p>3. Users can create comments now, but you have no way to remove them. You need
                to be able to remove the inevitable spam posts! First, update the comment resource
                in <span class="emphasis"><em>config/routes.rb</em></span> to add a route for the
                  <code class="literal">destroy</code> action. The <code class="literal">:only</code> option should be
                  <code class="literal">:only =&gt; [:create, :destroy]</code>. Next, add the
                  <code class="literal">destroy</code> action in the CommentsController, similar to the
                  <code class="literal">destroy</code> action for posts. Finally, add a link to this action at
                the bottom of <span class="emphasis"><em>app/views/comments/_comment.html.erb</em></span>:</p></td></tr></tbody></table></div><a id="pro_id00167"/><pre class="programlisting">&lt;%= link_to 'Destroy', [comment.post, comment],
  method: :delete, data: { confirm: 'Are you sure?' } %&gt;</pre></div></div></body></html>