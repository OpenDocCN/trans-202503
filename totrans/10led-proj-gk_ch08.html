<?xml version='1.0' encoding='utf-8'?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" epub:prefix="z3998: http://www.daisy.org/z3998/2012/vocab/structure/#" lang="en" xml:lang="en">
  <head>
    <title>Project 8: Optical Screwdriver by John Baichtal</title>
    <link href="../styles/9781593278472.css" rel="stylesheet" type="text/css"/>
    <link href="../68851547a55f.css" rel="stylesheet" type="text/css"/>
  </head>
  <body>
    <div id="sbo-rt-content"><h2 class="h2" id="ch08"><span epub:type="pagebreak" id="page_146"/><span class="big">8</span><br/>Optical Screwdriver by John Baichtal</h2>
<p class="ch-sub"><span epub:type="pagebreak" id="page_147"/>This project is a light-based beatbox in wand form, used with a light-sensor-equipped synth to create cool audio effects.</p>
<div class="image"><img src="../images/f0147-01.jpg" alt="image"/></div>
<p class="noindent"><span epub:type="pagebreak" id="page_148"/>In this project, you’ll make an optical screwdriver that flashes an LED at a light sensor, which then tells the synth what beats to play depending on the input it receives. You can modify the rate and length of beats, creating complicated synthesized music.</p>
<p class="indent">I’ll show you how to make three different variants of the screwdriver, ranging from simple to advanced. You don’t have to make all three; just choose the level of awesomeness you’re prepared to handle.</p>
<p class="indent">The first version is a super-basic Arduino project easy enough for anyone to build. You’ll also need to assemble a test rig—an elementary synth consisting of an Arduino, a speaker, and a light sensor—to make sure it works. After that I’ll show you how to level up your screwdriver with a couple of improvements: a simplified microcontroller and a wand-shaped printed circuit board (PCB).</p>
<h3 class="h3" id="lev99"><strong>BUILD THE BASIC SCREWDRIVER</strong></h3>
<p class="noindent">Let’s begin with the easiest possible configuration for the optical screwdriver: a plain-jane Arduino with an LED and three potentiometers, as shown in <a href="ch08.xhtml#ch08fig1">Figure 8-1</a>. While not particularly wand-like, it gives you an unsexy equivalent that works identically—it makes optical LED flashes that interact with a sensor-equipped synthesizer. The three pots will be used to control the speed, duration, and pauses of the flashing LED.</p>
<div class="image"><a id="ch08fig1"/><img src="../images/f0148-01.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 8-1:</strong> A basic version of the screwdriver</p>
<h4 class="h4" id="lev100"><span epub:type="pagebreak" id="page_149"/><strong>Get the Parts</strong></h4>
<p class="noindent">You’ll need just a few parts to complete the first stage of this project. I’m also including the parts for the test rig you’ll need to build in order to hear anything. The test rig is simply a light sensor, Arduino, and speaker.</p>
<div class="note">
<p class="notet"><strong>NOTE</strong></p>
<p class="notep"><em>See “<a href="intro.xhtml#lev17">Getting Started with the Arduino and the Arduino IDE</a>” on <a href="intro.xhtml#page_15">page 15</a> for setup instructions.</em></p>
</div>
<ul>
<li class="noindent">Two Arduino Uno boards or similar (Adafruit P/N 50)</li>
<li class="noindent">Half-sized breadboard (Adafruit P/N 64)</li>
<li class="noindent">Jumper assortment (Adafruit P/N 153)</li>
<li class="noindent">Wall wart or 9 V battery clip (Adafruit P/N 63 or Adafruit P/N 80)</li>
<li class="noindent">Super-bright LED (for example, SparkFun P/N 531)</li>
<li class="noindent">Three 10 kΩ potentiometers (I used SparkFun P/N 9939, but P/N 9288 also works; I used slim knobs from Adafruit, P/N 2057)</li>
<li class="noindent">Light sensor (Adafruit P/N 161)</li>
<li class="noindent">8 Ω speaker (for example, Adafruit P/N 1313; you’ll need to solder on your own wires)</li>
<li class="noindent">220 Ω and 10 kΩ resistors (SparkFun P/N 10969 is a good multipack)</li>
</ul>
<h4 class="h4" id="lev101"><strong>Assemble the Circuit</strong></h4>
<p class="noindent">The bare-bones screwdriver probably won’t challenge you, but never fear—this project levels up quick! Let’s begin:</p>
<ol>
<li class="noindent"><p class="list"><strong>Plug in the LED.</strong> Connect the long lead of the LED to pin 9 with a 220 Ω resistor in between, then connect the short lead to GND right next to it. <a href="ch08.xhtml#ch08fig2">Figure 8-2</a> shows how it should look.</p>
<div class="image"><a id="ch08fig2"/><img src="../images/f0149-01.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 8-2:</strong> Adding the LED and resistor to the breadboard</p></li>
<li class="noindent"><p class="list"><strong>Wire up the potentiometers.</strong> Add the three pots. For each pot, connect the leftmost lead to GND and the rightmost to 5V. The <span epub:type="pagebreak" id="page_150"/>center lead is the data connection, as shown in <a href="ch08.xhtml#ch08fig3">Figure 8-3</a>. It doesn’t matter which lead is GND and which is 5V, as long as the center lead goes to data. Connect one of each wire to pins A0, A1, and A2, shown as purple wires in <a href="ch08.xhtml#ch08fig3">Figure 8-3</a>.</p>
<div class="image"><a id="ch08fig3"/><img src="../images/f0150-01.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 8-3:</strong> Connecting the pots to the appropriate analog pins</p></li>
<li class="noindent"><p class="list"><strong>Add power.</strong> Connect the Arduino to power by plugging it into either a wall wart or a 9 V battery. You’ll also need to power the prototyping board, so connect the 5V and GND pins on the Arduino to the power and ground buses on both sides of the board. These new wires are shown in red (power) and black (ground) in <a href="ch08.xhtml#ch08fig4">Figure 8-4</a>.</p>
<div class="image"><a id="ch08fig4"/><img src="../images/f0150-02.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 8-4:</strong> Connecting the breadboard to the Arduino’s 5V and GND pins</p></li>
</ol>
<h4 class="h4" id="lev102"><strong>Code It</strong></h4>
<p class="noindent">The sketch is essentially the Blink example sketch, to which I’ve added potentiometers to modify the beat. You can download it along with the other project files for this book at <em><a href="https://nostarch.com/LEDHandbook/">https://nostarch.com/LEDHandbook/</a></em>.</p>
<p class="indent"><span epub:type="pagebreak" id="page_151"/>Let’s go through the code part by part:</p>
<p class="programs"><span class="light-teal">void</span> <span class="green">setup</span>() {<br/><br/>  <span class="orange">pinMode</span>(9, <span class="light-teal">OUTPUT</span>); <span class="gray">//change to 0 with the Tiny85</span><br/>  <span class="orange">pinMode</span>(A0, <span class="light-teal">INPUT</span>);<br/>  <span class="orange">pinMode</span>(A1, <span class="light-teal">INPUT</span>);<br/>  <span class="orange">pinMode</span>(A2, <span class="light-teal">INPUT</span>);<br/>}</p>
<div class="note">
<p class="notet"><strong>NOTE</strong></p>
<p class="notep"><em>Remember to change all instances of pin 9 to pin 0 if you employ the ATtiny85 microcontroller—more on this later!</em></p>
</div>
<p class="indent">The <span class="literal">void setup()</span> function runs once when the Arduino is powered on or reset. In this case the setup is telling the Arduino which pins will be for input and which for output.</p>
<p class="indent">Next is the loop.</p>
<p class="programs"><span class="light-teal">void</span> <span class="green">loop</span>() {<br/>  <span class="light-teal">int</span> speedKnob = <span class="orange">analogRead</span>(A0); <br/>  <span class="light-teal">int</span> durationKnob = <span class="orange">analogRead</span>(A1);<br/>  <span class="light-teal">int</span> skipKnob = <span class="orange">analogRead</span>(A2);<br/><br/>  <span class="light-teal">int</span> currentSpeed = <span class="orange">map</span>(speedKnob, 0, 1027, 10, 900);<br/>  <span class="light-teal">int</span> currentDuration = <span class="orange">map</span>(durationKnob, 0, 1027, 100, 800);<br/>  <span class="light-teal">int</span> currentSkip = <span class="orange">map</span>(skipKnob, 0, 1027, 1, 150);</p>
<p class="indent">The first part of <span class="literal">void loop()</span> declares a series of variables corresponding with the three pots—speed, duration, and skip. For the sake of writing code, I’ve labeled time between beats as <em>speed</em>, the length of each beat as <em>duration</em>, and the brightness level of the LED in the “off” state as <em>skip</em>. This gives us the option of “bright to dim” rather than “on or off,” for a smoother flow.</p>
<p class="indent">Finally, the code maps out the readings from the three pots and changes their values to something we can use—data comes in from the pots at a range of 0–1023, so the code translates that value into seconds. Feel free to change these values to make the screwdriver work better for you!</p>
<p class="programs">  <span class="orange">digitalWrite</span>(9, <span class="light-teal">HIGH</span>); <span class="gray">//the LED turns on</span><br/>  <span class="orange">delay</span>(currentDuration);<br/>  <span class="orange">digitalWrite</span>(9, <span class="light-teal">LOW</span>); <span class="gray">//the LED turns off for a moment</span><br/>  <span class="orange">delay</span>(10);<br/>  <span class="orange">digitalWrite</span>(9, currentSkip); <span class="gray">//the LED dims</span><br/>  <span class="orange">delay</span>(currentDuration * 0.5);<br/>  <span class="orange">digitalWrite</span>(9, <span class="light-teal">LOW</span>); <span class="gray">//the LED turns off</span><br/>  <span class="orange">delay</span>(currentSpeed);<br/>}</p>
<p class="indent"><span epub:type="pagebreak" id="page_152"/>The final part of the code governs the actual work of the sketch: turning on and off an LED. The LED turns on for a number of microseconds equal to the value of <span class="literal">currentDuration</span>, or between 100 and 800. When the synth’s light sensor detects those beats, it responds with sound. Holding the screwdriver closer makes louder beats, while pulling it back yields more subtle sounds.</p>
<h4 class="h4" id="lev103"><strong>Build the Test Rig</strong></h4>
<p class="noindent">Unless you have a light-detecting synth handy, you’ll have to build one. This rig emits a beat that is modified by data sent via the light sensor, so it can interact with the screwdriver. You’ll need the extra Arduino from the parts list, as well as the speaker. You can see the ultra-simple test rig I built in <a href="ch08.xhtml#ch08fig5">Figure 8-5</a>.</p>
<div class="image"><a id="ch08fig5"/><img src="../images/f0152-01.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 8-5:</strong> The test rig helps you ensure the screwdriver works.</p>
<ol>
<li class="noindent"><p class="list"><strong>Wire up the speaker.</strong> Plug the speaker’s positive lead into pin 9 of the second Arduino, and the negative lead into GND. <a href="ch08.xhtml#ch08fig6">Figure 8-6</a> shows how it connects.</p>
<div class="image"><a id="ch08fig6"/><img src="../images/f0152-02.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 8-6:</strong> Connecting the speaker to the Arduino</p></li>
<li class="noindent"><p class="list"><strong>Attach the light sensor and resistor.</strong> Connect one lead of the light sensor to pin A0 and the other to 5V. Slide a 10 kΩ resistor into the same A0 pin, or wrap the light sensor lead and resistor <span epub:type="pagebreak" id="page_153"/>together. Connect the other lead of the resistor to GND, as shown in <a href="ch08.xhtml#ch08fig7">Figure 8-7</a>.</p>
<div class="image"><a id="ch08fig7"/><img src="../images/f0153-01.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 8-7:</strong> Attaching the light sensor and resistor</p></li>
<li class="noindent"><p class="list"><strong>Code it.</strong> The test rig’s code is a variant of the <span class="literal">tonePitchFollower</span> example sketch, which changes a tone based on the level detected by the light sensor. I’ve added a bit more pizzazz by tying the beat length and pause length to the same light sensor, allowing the optical screwdriver to simultaneously modify the beat’s tone, its length, and the time between beats via the light sensor.</p>
<p class="programs"><span class="light-teal">void</span> <span class="green">setup</span>() {<br/>}<br/><br/><span class="light-teal">void</span> <span class="green">loop</span>() {<br/><br/>  <span class="light-teal">int</span> sensorReading = <span class="orange">analogRead</span>(A0);<br/>  <span class="light-teal">int</span> thisPitch = <span class="orange">map</span>(sensorReading, 400, 1000, 120,<br/>1500);<br/>  <span class="light-teal">int</span> reverseReading = <span class="orange">map</span>(sensorReading, 400, 1000,<br/>1023, 1);<br/><br/>  <span class="orange">tone</span>(9, thisPitch, reverseReading);<br/>  <span class="orange">delay</span>(10);<br/><br/>}</p></li>
<li class="noindent"><p class="list"><strong>Test it.</strong> The test rig creates a looping series of tones, 100 per second, with a frequency equal to the light sensor reading, and determines the duration of tone by remapping the sensor reading. Even without the screwdriver, you can play with the test rig by putting your finger over the light sensor and changing its reading.</p></li>
</ol>
<p class="indent"><span epub:type="pagebreak" id="page_154"/>When you add the screwdriver’s weirdly flashing light into the mix, even more complicated patterns emerge as the fluctuations in light create complex sonic structures.</p>
<h3 class="h3" id="lev104"><strong>BUILD THE WAND VERSION WITH AN ATTINY85</strong></h3>
<p class="noindent">Next I’ll show you how to swap in an ATtiny85, a smaller microcontroller than the ATmega328p featured in the Arduino. This is a simpler chip, without the extra bells and whistles of the Arduino board, but it’s also more compact, which allows you to move the screwdriver circuit off the prototyping board and onto a more portable wand.</p>
<h4 class="h4" id="lev105"><strong>Get the Parts</strong></h4>
<p class="noindent">Grab the following parts to build a soldered version of the basic screwdriver using the ATtiny85. If you want to, reuse the parts from the earlier prototype build.</p>
<h5 class="h5" id="lev106"><strong>Components</strong></h5>
<ul>
<li class="noindent">Arduino Uno (reuse the one from “<a href="ch08.xhtml#lev103">Build the Test Rig</a>” on <a href="ch08.xhtml#page_152">page 152</a>)</li>
<li class="noindent">ATtiny85 microcontroller (for example, SparkFun P/N 9378)</li>
<li class="noindent">Super-bright LED (for example, SparkFun P/N 531)</li>
<li class="noindent">Two 220 Ω resistors</li>
<li class="noindent">10 μF capacitor (SparkFun P/N 523)</li>
<li class="noindent">Perma-Proto board (Adafruit P/N 571; these boards require you to solder the components)</li>
<li class="noindent">8-pin IC socket (Adafruit P/N 2202)</li>
<li class="noindent">Three potentiometers (I suggest SparkFun P/N 9288 because they can be soldered in place)</li>
<li class="noindent">5 V power supply (for example, SparkFun P/N 12889)</li>
<li class="noindent">Barrel jack for the power supply (Adafruit P/N 373 or SparkFun P/N 10811)</li>
</ul>
<div class="note">
<p class="notet"><strong>NOTE</strong></p>
<p class="notep"><em>You shouldn’t use a 9 V battery because the ATtiny85 lacks the power management features of the Uno, which allows input voltage to be converted to 5 V. If you use a 9 V battery, your chip will overload.</em></p>
</div>
<h5 class="h5" id="lev107"><strong>Tools</strong></h5>
<ul>
<li class="noindent">Soldering iron</li>
<li class="noindent">Solder</li>
</ul>
<div class="note">
<p class="notet"><strong>NOTE</strong></p>
<p class="notep"><em>See the appendix for soldering instructions.</em></p>
</div>
<p class="indent">Let’s take a look at the technical details of the ATtiny85. It has eight pins, consisting of power, ground, and a variety of analog and digital data pins. <a href="ch08.xhtml#ch08fig8">Figure 8-8</a> breaks down the pin layout.</p>
<div class="image"><span epub:type="pagebreak" id="page_155"/><a id="ch08fig8"/><img src="../images/f0155-01.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 8-8:</strong> The ATtiny85’s eight pins control a surprising amount of computing power.</p>
<h4 class="h4" id="lev108"><strong>Flashing the ATtiny85</strong></h4>
<p class="noindent">One downside to using the ATtiny85 is that we lose some of that ease of programming we have with the Arduino. The Arduino has a lovely USB-based bootloader, but its smaller cousin does not, so you’ll have to use a separate Arduino to program the ATtiny85. Since the pins of the chip are needed to program it, we can’t assemble the project before programming it. With this version of the optical screwdriver, you won’t be able to reflash the chip once it’s installed on the circuit board.</p>
<p class="indent">Here’s how to do so:</p>
<ol>
<li class="noindent"><p class="list"><strong>Wire up the ATtiny85.</strong> Use the Arduino from “<a href="ch08.xhtml#lev103">Build the Test Rig</a>” on <a href="ch08.xhtml#page_152">page 152</a> as shown in <a href="ch08.xhtml#ch08fig9">Figure 8-9</a>. The pinout shown in <a href="ch08.xhtml#ch08fig8">Figure 8-8</a> becomes important in this step as you wire it up. Connect pin 1 to digital pin 10, shown as a blue wire in <a href="ch08.xhtml#ch08fig9">Figure 8-9</a>. Connect pin 4 to GND via a black wire. Plug a red wire from pin 5 into a power bus. Plug pins 6, 7, and 8 into 13, 12, and 11 on the Arduino, shown as yellow, white, and green wires, respectively.</p></li>
<li class="noindent"><p class="list"><strong>Connect the LED and capacitor.</strong> You’ll also need to connect an LED, with a 220 Ω resistor protecting it, to pin 8 on the ATtiny85; this LED will flash to show that it’s working. Next, you’ll need to connect the short pin of a 10 µF capacitor to the Arduino’s Reset pin (shown as a burgundy wire) and the long pin to GND.</p></li>
<li class="noindent"><p class="list"><strong>Connect the power and ground.</strong> Finally, connect the breadboard’s power and GND buses to their respective Arduino pins.</p></li>
<li class="noindent"><p class="list"><strong>Install the ArduinoISP sketch on the Uno.</strong> Find this in the Tools menu of the Arduino program, then set the Uno’s programmer to “ArduinoISP” by choosing <strong>ArduinoISP</strong> from the list of programmers. Go to <strong>Tools</strong> <span class="ent">▸</span> <strong>Board</strong> and choose the correct ATtiny model. Then upload the sketch!</p></li>
</ol>
<p class="indent">You can also buy products that allow you to program your ATtiny85 without needing a second Arduino—for example, the Tiny <span epub:type="pagebreak" id="page_156"/>AVR Programmer from SparkFun (P/N 11801) and the ISP Shield from Evil Mad Scientist (<em><a href="http://emsl.us/253">http://emsl.us/253</a></em>).</p>
<p class="indent">This is a necessarily stripped-down description of the process. For a more thorough guide to programming an ATtiny, go to MIT’s High-Low Tech page at <em><a href="http://highlowtech.org/">http://highlowtech.org/</a></em>, click <strong>Tutorials</strong>, then click the link for <strong>Programming an ATtiny w/ Arduino 1.6 (or 1.0)</strong>. David Caminati also has a good tutorial at <em><a href="http://fritzing.org/projects/programmer-for-attiny85-with-arduino-uno-as-interf/">http://fritzing.org/projects/programmer-for-attiny85-with-arduino-uno-as-interf/</a></em>.</p>
<div class="image"><a id="ch08fig9"/><img src="../images/f0156-01.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 8-9:</strong> Programming the ATtiny85 with another Arduino</p>
<h4 class="h4" id="lev109"><strong>Build the ATtiny85 Screwdriver</strong></h4>
<p class="noindent">The next challenge involves turning that loose jumble of wires into something a little more solid. You’ll use a credit card–sized prototyping board from Adafruit and design it so that, besides a power supply wire, you can hold the entire screwdriver in one hand.</p>
<ol>
<li class="noindent"><p class="list"><strong>Solder in the pots.</strong> Solder the three potentiometers to the prototyping board, as shown in <a href="ch08.xhtml#ch08fig10">Figure 8-10</a>. Connect the outer two leads of each pot to power and ground.</p>
<div class="image"><a id="ch08fig10"/><img src="../images/f0156-02.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 8-10:</strong> Attaching the potentiometers</p></li>
<li class="noindent"><p class="list"><span epub:type="pagebreak" id="page_157"/><strong>Attach the IC socket.</strong> Next, solder in the IC socket as shown in <a href="ch08.xhtml#ch08fig11">Figure 8-11</a>. The top of the ATtiny85 has a notch that should be pointed toward the star, as shown in the figure. Connect pins 2, 3, and 7 to the center leads of each pot, from right to left, respectively, and connect pin 8 to power and pin 4 to ground (refer back to <a href="ch08.xhtml#ch08fig8">Figure 8-8</a> for the ATtiny85 pinout). If you get these in the wrong order, you might get unexpected results, so make sure to take note of which pot is connected to which pin.</p>
<div class="image"><a id="ch08fig11"/><img src="../images/f0157-01.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 8-11:</strong> Soldering in the IC socket</p></li>
<li class="noindent"><p class="list"><strong>Wire up the LED.</strong> Connect the long lead of the LED to pin 5 of the ATtiny85 via a 220 Ω resistor, and connect the short lead of the LED to ground. <a href="ch08.xhtml#ch08fig12">Figure 8-12</a> shows how it should look.</p>
<div class="image"><a id="ch08fig12"/><img src="../images/f0157-02.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 8-12:</strong> Adding the LED and resistor</p></li>
<li class="noindent"><p class="list"><strong>Add power.</strong> Solder in the barrel jack (shown in <a href="ch08.xhtml#ch08fig13">Figure 8-13</a>), connecting the center lead to power and either of the two side leads to ground.</p>
<p class="indent">As long as you’ve already flashed the ATtiny85 with the sketch, you should be able to plug it in right away.</p>
<div class="image"><span epub:type="pagebreak" id="page_158"/><a id="ch08fig13"/><img src="../images/f0158-01.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 8-13:</strong> Soldering in the power jack</p></li>
</ol>
<p class="indent">That’s your circuit all soldered!</p>
<h4 class="h4" id="lev110"><strong>Code It</strong></h4>
<p class="noindent">The code from the initial build works with this version too! You do, however, have to make one critical change. There is no pin 9 on an ATtiny85, so you have to change that to a <span class="literal">0</span>. Remember this line from the original code?</p>
<p class="programs"><span class="orange">pinMode</span>(9, <span class="light-teal">OUTPUT</span>); <span class="gray">//change to 0 with the Tiny85</span></p>
<p class="indent">You need to change that <span class="literal">9</span> and the following <span class="literal">9</span>s to <span class="literal">0</span>s.</p>
<p class="programs"><span class="orange">digitalWrite</span>(9, <span class="light-teal">HIGH</span>); <span class="gray">//the LED turns on</span><br/><span class="orange">delay</span>(currentDuration);<br/><span class="orange">digitalWrite</span>(9, <span class="light-teal">LOW</span>); <span class="gray">//the LED turns off for a moment</span><br/><span class="orange">delay</span>(10);<br/><span class="orange">digitalWrite</span>(9, currentSkip); <span class="gray">//the LED dims</span><br/><span class="orange">delay</span>(currentDuration * 0.5);<br/><span class="orange">digitalWrite</span>(9, <span class="light-teal">LOW</span>); <span class="gray">//the LED turns off</span><br/><span class="orange">delay</span>(currentSpeed);</p>
<p class="indent">When you’ve made the changes, upload the sketch using the programming rig mentioned earlier in the chapter—that is, by wiring the ATtiny85 to the Arduino and then loading the code to the Arduino. Once the ATtiny85 is programmed, it can be placed in the socket and you’ll be ready to go.</p>
<h3 class="h3" id="lev111"><strong>MAKE A PCB WAND</strong></h3>
<p class="noindent">Without the need for a full-sized Arduino, you can make the optical screwdriver much smaller and, well, sexier. In fact, you can make it small enough to fit on a wand-shaped printed circuit board (PCB), <span epub:type="pagebreak" id="page_159"/>shown in <a href="ch08.xhtml#ch08fig14">Figure 8-14</a>. The previous version of the screwdriver was for folks who didn’t want to buy or mill their own circuit boards. If you’re up to that challenge, however, this variant of the project is for you!</p>
<div class="image"><a id="ch08fig14"/><img src="../images/f0159-01.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 8-14:</strong> This wand-shaped PCB accommodates the screwdriver’s components.</p>
<div class="sidebar">
<p class="sidebart"><strong>ABOUT FRITZING</strong></p>
<p class="spara">Fritzing is a simple circuit design program that allows you to build circuits either through traditional schematic symbols, breadboarded components, or PCB design. To create a design, you simply drag components out of a palette and draw traces between them. I use the program all the time, and you’ll probably find it useful as well. Download it at <em><a href="http://www.fritzing.org/">http://www.fritzing.org/</a></em>.</p>
<div class="image"><img src="../images/f0159-02.jpg" alt="image"/></div>
</div>
<h4 class="h4" id="lev112"><strong>Get the Parts</strong></h4>
<p class="noindent">Most of these parts are the same as the components we used in the previous version of the project. You’ll need the following to complete this version.</p>
<h5 class="h5" id="lev113"><strong>Components</strong></h5>
<ul>
<li class="noindent">Super-bright LED (for example, SparkFun P/N 531)</li>
<li class="noindent">ATtiny85 (SparkFun P/N 9378)</li>
<li class="noindent"><span epub:type="pagebreak" id="page_160"/>8-pin IC socket (Adafruit P/N 2202)</li>
<li class="noindent">Three 10 kΩ potentiometers (SparkFun P/N 9939 or P/N 9288)</li>
<li class="noindent">Mini power switch (SparkFun P/N 102)</li>
<li class="noindent">Battery clips (SparkFun P/N 7949)</li>
<li class="noindent">Surface-mount LED (SparkFun P/N 12619)</li>
<li class="noindent">Two surface-mount resistors (Jameco P/N 2008882)</li>
<li class="noindent">Two AA batteries</li>
</ul>
<h5 class="h5" id="lev114"><strong>Tools</strong></h5>
<ul>
<li class="noindent">Soldering iron</li>
<li class="noindent">Solder</li>
</ul>
<div class="note">
<p class="notet"><strong>NOTE</strong></p>
<p class="notep"><em>See the appendix for soldering instructions.</em></p>
</div>
<h4 class="h4" id="lev115"><strong>Build It</strong></h4>
<p class="noindent">Follow these steps to build your optical screwdriver wand, shown in <a href="ch08.xhtml#ch08fig15">Figure 8-15</a>.</p>
<div class="image"><a id="ch08fig15"/><img src="../images/f0160-01.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 8-15:</strong> The completed optical screwdriver in use</p>
<ol>
<li class="noindent"><p class="list"><strong>Design the PCB outline.</strong> I used Inkscape (<em><a href="https://inkscape.org/">https://inkscape.org/</a></em>) to draw a vector shape corresponding with the shape I wanted the PCB to be. <a href="ch08.xhtml#ch08fig16">Figure 8-16</a> shows what I came up with: a pencil shape about 8 inches long and 3/4 inches wide. The Inkscape file is available with all the other resources for this book (<em><a href="https://nostarch.com/LEDHandbook/">https://nostarch.com/LEDHandbook/</a></em>). You can make your circuit board any shape you want. In the Inkscape file, the PCB can be any color, but this won’t affect how it looks in the end; what the program looks for are the vectors. Fritzing offers a tutorial on how to make a shape that will work with the program at <em><a href="http://fritzing.org/pcb-custom-shape/">http://fritzing.org/pcb-custom-shape/</a></em>.</p>
<div class="image"><span epub:type="pagebreak" id="page_161"/><a id="ch08fig16"/><img src="../images/f0161-01.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 8-16:</strong> I designed a pencil shape in Inkscape for the wand.</p></li>
<li class="noindent"><p class="list"><strong>Make the circuit in Fritzing.</strong> Add the circuit to the board shape, as shown in <a href="ch08.xhtml#ch08fig17">Figure 8-17</a>. Don’t worry—I’ll describe how to do each substep!</p>
<div class="image"><a id="ch08fig17"/><img src="../images/f0161-02.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 8-17:</strong> The optical screwdriver added to the circuit board design</p>
<ol type="a">
<li class="noindent"><p class="list"><strong>Add the PCB outline.</strong> To add the circuit board outline you made in Inkscape, click once on the default PCB, then click the <strong>Load Image File</strong> button in the Inspector to replace it with your own. <a href="ch08.xhtml#ch08fig18">Figure 8-18</a> shows the PCB outline, ready to be loaded with components. Remember that the blue color doesn’t mean anything; it’s just a placeholder. The real decision on color is made when you pay for the PCB to be milled.</p>
<div class="image"><a id="ch08fig18"/><img src="../images/f0161-03.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 8-18:</strong> The PCB file has been loaded.</p></li>
<li class="noindent"><p class="list"><strong>Add batteries.</strong> Drag battery clips out of the parts palette and add them to the circuit board. Connect the two batteries in series as you see in <a href="ch08.xhtml#ch08fig19">Figure 8-19</a>. The black lines in the figure represent screen printing that will appear on the PCB, while the circles represent holes drilled in the PCB, with green representing populated terminals and red signifying unpopulated terminals.</p>
<div class="image"><a id="ch08fig19"/><img src="../images/f0161-04.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 8-19:</strong> Adding the battery clips</p></li>
<li class="noindent"><p class="list"><span epub:type="pagebreak" id="page_162"/><strong>Add the switch.</strong> The switch has three mounting holes (see <a href="ch08.xhtml#ch08fig20">Figure 8-20</a>); you should connect the battery to the middle one.</p>
<div class="image"><a id="ch08fig20"/><img src="../images/f0162-01.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 8-20:</strong> Adding the switch</p></li>
<li class="noindent"><p class="list"><strong>Add the surface-mount LED and resistor.</strong> You can see from <a href="ch08.xhtml#ch08fig21">Figure 8-21</a> that the LED and resistor don’t have mounting holes, but rather mounting pads. That means these components are surface-mount rather than through-hole. Connect the top lead of the switch to the first pad of the LED, connect the LED and resistor in series, and then ground the resistor to the negative terminal of the battery assembly. This resistor serves as a power indicator, so no matter what happens with the screwdriver you’ll know if the batteries are working!</p>
<div class="image"><a id="ch08fig21"/><img src="../images/f0162-02.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 8-21:</strong> Adding the LED and resistor</p></li>
<li class="noindent"><p class="list"><strong>Add the three pots.</strong> Drag the three pots from the palette and add them as shown in <a href="ch08.xhtml#ch08fig22">Figure 8-22</a>. The left-hand pin connects to power via the switch, and the right-hand pin connects to GND. The center (data) pins remain unpopulated for now.</p>
<div class="image"><a id="ch08fig22"/><img src="../images/f0162-03.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 8-22:</strong> Connecting the three pots</p></li>
<li class="noindent"><p class="list"><strong>Add the ATtiny85.</strong> Add the ATtiny85 socket by connecting the pins as you did in the previous project: pins 2, 6, and 7 connect to the pots, while pin 4 connects to ground and pin 8 to power. <a href="ch08.xhtml#ch08fig23">Figure 8-23</a> shows how it should be wired up.</p>
<div class="image"><a id="ch08fig23"/><img src="../images/f0162-04.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 8-23:</strong> Adding the ATtiny85 socket</p></li>
<li class="noindent"><p class="list"><span epub:type="pagebreak" id="page_163"/><strong>Add the resistor and super-bright LED.</strong> The final piece involves the LED and the resistor that protects it. Add the components in series, with the resistor attached to pin 5 of the ATtiny85 and the negative lead of the LED connecting to ground. <a href="ch08.xhtml#ch08fig24">Figure 8-24</a> shows the completed PCB.</p>
<div class="image"><a id="ch08fig24"/><img src="../images/f0163-01.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 8-24:</strong> The PCB is complete.</p></li>
</ol></li>
<li class="noindent"><p class="list"><strong>Output the Gerbers.</strong> Export the Gerbers, the design files used by the fabrication staff to mill the boards. Go to <strong>File</strong> <span class="ent">▸</span> <strong>Export</strong> <span class="ent">▸</span> <strong>For Production</strong> and select <strong>Extended Gerbers</strong>. You will be asked to save the files to a folder.</p>
<p class="indent">When the Gerber files are output, check them on a Gerber checker like MCN (<a href="ch08.xhtml#ch08fig25">Figure 8-25</a>), available from <em><a href="http://mcn-audio.com/">http://mcn-audio.com/</a></em>. This tool lets you inspect the traces visible on the PCB to ensure they are wired as expected. I’ve had many PCBs ruined by foolishly trusting that the software got it right, so I definitely recommend it.</p>
<div class="image"><a id="ch08fig25"/><img src="../images/f0163-02.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 8-25:</strong> Check your Gerbers with MCN or a similar application.</p></li>
<li class="noindent"><p class="list"><strong>Get the PCB milled.</strong> Chose one of a thousand PCB milling services. I use OSHPark (<em><a href="http://www.oshpark.com/">http://www.oshpark.com/</a></em>) because they’re easy and inexpensive. <a href="ch08.xhtml#ch08fig26">Figure 8-26</a> shows my milled circuit boards, back from the service.</p>
<div class="image"><span epub:type="pagebreak" id="page_164"/><a id="ch08fig26"/><img src="../images/f0164-01.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 8-26:</strong> The circuit boards are done. Now to add components!</p></li>
<li class="noindent"><p class="list"><strong>Solder in the components.</strong> Solder in the components as you would expect. Of particular importance is the ATtiny85, which is susceptible to damage. Rather than soldering the IC directly into the circuit board, solder in the socket and place the IC in the socket. This also allows you to refresh the ATtiny85 at a future date.</p></li>
<li class="noindent"><p class="list"><strong>Code it.</strong> Upload the optical screwdriver sketch to the ATtiny85 as described earlier in the chapter. It should work the same! Your completed project should look like <a href="ch08.xhtml#ch08fig27">Figure 8-27</a>.</p>
<div class="image"><a id="ch08fig27"/><img src="../images/f0164-02.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 8-27:</strong> The completed screwdriver flashing out a beat with the help of a home-built synth</p></li>
</ol>
<h3 class="h3" id="lev116"><span epub:type="pagebreak" id="page_165"/><strong>SUMMARY</strong></h3>
<p class="noindent">Considered by many to be the simplest form of electronics project, a blinking LED nevertheless can offer some cool challenges and opportunities. This project shows how combining digital and analog makes for an intriguing tool that you can make yourself.</p>
</div>
  </body>
</html>
