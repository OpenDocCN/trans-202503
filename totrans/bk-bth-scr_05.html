<html><head></head><body>
<div id="sbo-rt-content" class="calibre1"><section aria-labelledby="ch4" epub:type="chapter" role="doc-chapter">
<hgroup>
<h2 class="title" id="ch4">
<span class="cn"><span aria-label=" Page 35. " epub:type="pagebreak" id="pg_35" role="doc-pagebreak" class="calibre2"/><span class="sans_dogma_ot_bold_b_">4</span></span>
<span class="ct1"><span class="sans_dogma_ot_bold_b_">CONDITIONAL EXECUTION</span></span>
</h2>
</hgroup>
<figure class="opener"><img alt="" class="opener1" height="407" src="../images/chapter.jpg" width="408"/>
</figure>
<p class="chapterintro">The <span class="sans_thesansmonocd_w5regular_1">if</span> command, which is quite likely common to all programming languages, causes one or more lines of code to be executed only when a condition is true, and a different section of code can be executed only when that condition is false.</p>
<p class="tx">The basics are straightforward, but in Batch the <i class="calibre6">conditional clause</i>, or the entity that evaluates to true or false, is quite different from similar clauses in other languages. Most of the compare operators are unique to Batch, and in this chapter you’ll learn the syntax to determine whether a path or file exists and whether a variable is populated. It’s also important to understand the different techniques for evaluating the return code.</p>
<p class="tx">In addition, you’ll learn how to efficiently manage instances where multiple conditions need to be evaluated as well as some common stumbling blocks to avoid. It’s disturbingly easy to write an <span class="sans_thesansmonocd_w5regular_">if</span> command that works most of the time but either aborts or fails to execute as intended under certain data conditions.</p>
<section aria-labelledby="sec1" epub:type="division">
<h3 class="h" id="sec1"><span id="h1-30"/><span aria-label=" Page 36. " epub:type="pagebreak" id="pg_36" role="doc-pagebreak"/><span class="sans_futura_std_bold_b_">The Basic if Command</span></h3>
<p class="tni">In its most basic incarnation, the <span class="sans_thesansmonocd_w5regular_">if</span> command executes one or more lines of code if a condition is true. I’ll show how you can expand this command to execute a different bit of code if that same condition is false, but let’s start with its basic structure.</p>
<p class="tx">Nearly every Batch command implementation starts with the command name itself and is often followed by arguments and/or options. For instance, the <span class="sans_thesansmonocd_w5regular_">set</span> command always starts with those three letters. Usually, it’s followed by an argument consisting of a variable name, an equal sign, and a value, but in <span class="xref"><a href="chapter2.xhtml" class="calibre3">Chapter 2</a></span> you learned that it works with no arguments or options at all. (Such a command writes out a list of active variables.)</p>
<p class="tx">The <span class="sans_thesansmonocd_w5regular_">if</span> command is unique. It also starts with its command name, but the similarities end there; it can span multiple lines and has two major components. Here’s the general form where you’d replace the italicized text with code:</p>
<pre class="pre"><code class="calibre11">if <var class="calibre12">conditional clause</var> (
   <var class="calibre12">true code block</var>
)
</code></pre>
<p class="tx">The <i class="calibre6">conditional clause</i> is an expression that evaluates to true or false. If it’s true, the interpreter executes the command or commands inside the <i class="calibre6">true code block</i>, and if it’s false, this code doesn’t execute. In <span class="xref"><a href="chapter16.xhtml" class="calibre3">Chapter 16</a></span>, I’ll discuss code blocks in more depth, but for now, a code block is simply one or more lines of code set between parentheses.</p>
<p class="tx">With this syntax, the open parenthesis must not only follow the conditional clause; it also must be on the same line. Other languages allow (or even encourage) you to put the open parenthesis on the next line and line it up with the close parenthesis, but this is verboten in Batch. However, good form dictates that the close parenthesis should line up with the beginning of the <span class="sans_thesansmonocd_w5regular_">if</span> command with the intervening commands indented. My convention calls for three spaces of indentation, but any amount will do. Here’s a functioning example:</p>
<pre class="pre"><code class="calibre11">if "%today%" equ "07/04/2026" (
   set event=sestercentennial
)
</code></pre>
<p class="tni">The conditional clause, <span class="sans_thesansmonocd_w5regular_">"%today%" equ "07/04/2026"</span>, is looking for equality between a resolved variable and some hardcoded text. This conditional clause is fairly straightforward, but I’ll soon demonstrate far more impressive ones using different compare operators, keywords, and even an option. Many coding languages put the conditional clause inside parentheses; for better or worse, the clause stands on its own in Batch, and the parentheses are used to enclose the upcoming code block.</p>
<p class="tx">If the conditional clause is true, the command in the code block (in this example, the <span class="sans_thesansmonocd_w5regular_">set</span> command) is executed, resulting in <span class="sans_thesansmonocd_w5regular_">event</span> being set to the term for a quarter-millennium celebration.</p>
<p class="tx"><span aria-label=" Page 37. " epub:type="pagebreak" id="pg_37" role="doc-pagebreak"/>The following more compact format fitting on a single line is functionally equivalent to the previous example:</p>
<pre class="pre"><code class="calibre11">if "%today%" equ "07/04/2026"  (set event=sestercentennial)</code></pre>
<p class="tx">You no longer need the parentheses when using a single line. The following is functionally equivalent to both prior examples:</p>
<pre class="pre"><code class="calibre11">if "%today%" equ "07/04/2026"  set event=sestercentennial</code></pre>
<p class="tni">Technically, because of the lack of parentheses, the <span class="sans_thesansmonocd_w5regular_">set</span> command is no longer in a code block. In lieu of a concise term, it’s now just the command that executes when the conditional clause is true.</p>
<p class="tx">In both of the prior examples, I’ve left two spaces after the conditional clause, and I often leave more than two. Syntactically this isn’t needed, but since nothing clearly delineates the conditional clause from what comes after it, readability is enhanced with a little separation.</p>
<p class="tx">You can even execute multiple commands on a single line with the <span class="sans_thesansmonocd_w5regular_">&amp;</span> command separator, as discussed in <span class="xref"><a href="chapter2.xhtml" class="calibre3">Chapter 2</a></span>:</p>
<pre class="pre"><code class="calibre11">if "%today%" equ "07/04/2026"  set event=sestercentennial&amp; set code=ugly</code></pre>
<p class="tx">If the conditional clause is true, an additional <span class="sans_thesansmonocd_w5regular_">set</span> command, which happens to be self-critiquing of the code, is executed. I’ve seen this technique used on occasion, usually when setting an error code and error message, but in instances such as this, using a single line just makes the code inscrutable.</p>
<p class="tx">If there’s anything remotely interesting in the logic being performed, use multiple lines of code:</p>
<pre class="pre"><code class="calibre11">if "%today%" equ "07/04/2026" (
   set event=sestercentennial
   set code=elegant
)
</code></pre>
<p class="tni">Elegant is undoubtedly a gross overstatement here, but I hope you agree that this technique makes the code far more readable. With just a glance, the reader knows that if the condition is true, two variables are set.</p>
</section>
<section aria-labelledby="sec2" epub:type="division">
<h3 class="h" id="sec2"><span id="h1-31"/><span class="sans_futura_std_bold_b_">The Conditional Clause</span></h3>
<p class="tni">The examples in the previous section all use a straightforward conditional clause, but the clause can be far more dynamic, taking on many other forms and using different operators and keywords.</p>
<section aria-labelledby="sec3" epub:type="division">
<h4 class="h1" id="sec3"><span id="h2-10"/><span class="sans_futura_std_heavy_oblique_bi_">Compare Operators</span></h4>
<p class="tni">A <i class="calibre6">compare operator</i>, unsurprising enough, compares two operands for equality or for one being greater than the other. You may have guessed that <span aria-label=" Page 38. " epub:type="pagebreak" id="pg_38" role="doc-pagebreak"/>the <span class="sans_thesansmonocd_w5regular_">equ</span> operator in the previous examples represents equality, and you’d be right.</p>
<p class="tx">Here’s the complete list of Batch compare operators:</p>
<p class="runinpara"><span class="sans_thesansmonocd_w7bold_b_">equ</span> <b class="calibre10">or</b> <span class="sans_thesansmonocd_w7bold_b_">==</span>    Equal</p>
<p class="runinpara1"><span class="sans_thesansmonocd_w7bold_b_">neq</span>    Not equal</p>
<p class="runinpara1"><span class="sans_thesansmonocd_w7bold_b_">lss</span>    Less than</p>
<p class="runinpara1"><span class="sans_thesansmonocd_w7bold_b_">leq</span>    Less than or equal</p>
<p class="runinpara1"><span class="sans_thesansmonocd_w7bold_b_">gtr</span>    Greater than</p>
<p class="runinpara2"><span class="sans_thesansmonocd_w7bold_b_">geq</span>    Greater than or equal</p>
<p class="tx">You can choose between two functionally equivalent alternatives for the equality operator. To differentiate from the single equal sign used for assignment, such as in a <span class="sans_thesansmonocd_w5regular_">set</span> command, Batch uses double equal signs for the compare operator. My preferred syntax is the <span class="sans_thesansmonocd_w5regular_">equ</span> operator because it looks similar to the others, but some coders prefer the <span class="sans_thesansmonocd_w5regular_">==</span> operator for the opposite reason.</p>
<p class="tx">The <span class="sans_thesansmonocd_w5regular_">neq</span> operator evaluates the conditional clause to true if the two operands being compared are <i class="calibre6">not</i> equal. The last four operators determine which operand is greater or less than the other. For example, assuming that <span class="sans_thesansmonocd_w5regular_">age</span> is set to a numeric value, the following one-line code block executes only if the variable is set to a value greater than <span class="sans_thesansmonocd_w5regular_">12</span>:</p>
<pre class="pre"><code class="calibre11">if %age% gtr 12 (
   &gt; con echo Adult Movie Theater Ticket Required
)
</code></pre>
<p class="tx">You might be tempted to try <span class="sans_thesansmonocd_w5regular_">%age% &gt; 12</span> as the conditional clause, but the greater-than sign already has a defined purpose in Batch; in fact, it’s being used in this code block to write a short message to the console. For this reason, you must use the three-character alpha code of <span class="sans_thesansmonocd_w5regular_">gtr</span> as the operator. Similarly, the operators listed in this section are needed for greater-than or equal, less-than, and less-than or equal compares.</p>
<p class="tx">Less intuitively, these operators also work on alphanumeric values. All numbers are less than all letters; <span class="sans_thesansmonocd_w5regular_">a</span> is less than <span class="sans_thesansmonocd_w5regular_">A</span>; <span class="sans_thesansmonocd_w5regular_">A</span> is less than <span class="sans_thesansmonocd_w5regular_">b</span>; <span class="sans_thesansmonocd_w5regular_">b</span> is less than <span class="sans_thesansmonocd_w5regular_">B</span>; and so on. This’ll do nothing to end the larger debate, but at least in the Batch universe, <span class="sans_thesansmonocd_w5regular_">Picard</span> is greater than <span class="sans_thesansmonocd_w5regular_">Kirk</span>.</p>
</section>
<section aria-labelledby="sec4" epub:type="division">
<h4 class="h1" id="sec4"><span id="h2-11"/><span class="sans_futura_std_heavy_oblique_bi_">Conditional Clause Keywords</span></h4>
<p class="tni">You’ll find the following indispensable keywords in the help for the <span class="sans_thesansmonocd_w5regular_">if</span> command, but make no mistake; these keywords are specific to the conditional clause:</p>
<p class="runinpara"><span class="sans_thesansmonocd_w7bold_b_">exist</span>    The <span class="sans_thesansmonocd_w5regular_">exist</span> keyword checks for the existence of either a path or a file and returns true if found. You can hardcode the path or file, or for flexibility, you can use a variable containing the potential path or file:</p>
<pre class="list"><code class="calibre11"><span class="sans_thesansmonocd_w5regular_">if exist C:\Batch\myFile.txt      set do=something</span>
if exist %pathAndFileName%        set do=something
</code></pre>
<p class="listbody"><span aria-label=" Page 39. " epub:type="pagebreak" id="pg_39" role="doc-pagebreak"/>You can also string multiple variables together to build the path or filename.</p>
<p class="runinpara"><span class="sans_thesansmonocd_w7bold_b_">defined</span>    The following conditional clause using the <span class="sans_thesansmonocd_w5regular_">defined</span> keyword checks whether a variable is defined—that is, does it resolve to anything, even a space? A common mistake is to use percent signs around the variable, but here’s the correct syntax using this keyword:</p>
<pre class="list"><code class="calibre11"><span class="sans_thesansmonocd_w5regular_">if defined varThatMayBeEmpty      set do=something</span>
</code></pre>
<p class="listbody">This is functionally equivalent to the following with percent signs resolving the variable:</p>
<pre class="list"><code class="calibre11"><span class="sans_thesansmonocd_w5regular_">if "%varThatMayBeEmpty%" neq ""  set do=something</span>
</code></pre>
<p class="listcontinued">This keyword is often used to validate expected input variables. If one or more is not defined, you can take appropriate action, possibly initiating an abort.</p>
<p class="runinpara"><span class="sans_thesansmonocd_w7bold_b_">not</span>    The <span class="sans_thesansmonocd_w5regular_">not</span> keyword negates any conditional clause when used at the very beginning of the clause. This is extremely useful in setting defaults for variables in the event that they’ve not yet been set by someone or something else. For instance, the following ensures that <span class="sans_thesansmonocd_w5regular_">skyColor</span> is set to its usual color:</p>
<pre class="list"><code class="calibre11"><span class="sans_thesansmonocd_w5regular_">if not defined skyColor           set skyColor=Blue</span>
</code></pre>
<p class="listbody">You can couple the <span class="sans_thesansmonocd_w5regular_">not</span> keyword with the <span class="sans_thesansmonocd_w5regular_">exist</span> keyword to determine whether a specific file doesn’t exist. Armed with that knowledge, you can then create a file, initiate an abort, or do whatever makes sense for your application. Some coders use the <span class="sans_thesansmonocd_w5regular_">not</span> keyword with the <span class="sans_thesansmonocd_w5regular_">equ</span> operator, but I find this iffy at best and much prefer the <span class="sans_thesansmonocd_w5regular_">neq</span> operator alone. Logically there’s no difference, but whatever your preference, be consistent.</p>
<p class="warning"><span class="sans_dogma_ot_bold_b_1">WARNING</span></p>
<p class="warning-txt"><i class="calibre6">After two decades of Batch coding I still try to add s to the end of the exist keyword more often than I care to admit. Notepad++ faithfully alerts me every time because it emboldens keywords; that spurious character drops the bold font for the entire word, making it stand out. Code without an editor like this at your own peril.</i></p>
</section>
<section aria-labelledby="sec5" epub:type="division">
<h4 class="h1" id="sec5"><span id="h2-12"/><span class="sans_futura_std_heavy_oblique_bi_">The Case-Insensitive Option</span></h4>
<p class="tni">The <span class="sans_thesansmonocd_w5regular_">if</span> command has exactly one option, and much like the keywords we’ve looked at so far, it applies to the conditional clause. The <span class="sans_thesansmonocd_w5regular_">/i</span> option makes the equality (and inequality) operator in the conditional clause case-insensitive.</p>
<p class="tx">To demonstrate, the conditional clause without the option in the following <span class="sans_thesansmonocd_w5regular_">if</span> command evaluates to true only if <span class="sans_thesansmonocd_w5regular_">myMood</span> resolves exactly to <span class="sans_thesansmonocd_w5regular_">happy</span>—the hardcoded value on the right side of the inequality:</p>
<pre class="pre"><code class="calibre11">if "%myMood%" equ "happy"         set do=something</code></pre>
<p class="tx"><span aria-label=" Page 40. " epub:type="pagebreak" id="pg_40" role="doc-pagebreak"/>Here’s the same code with the addition of the <span class="sans_thesansmonocd_w5regular_">/i</span> option:</p>
<pre class="pre"><code class="calibre11">if /i "%myMood%" equ "happy"      set do=something</code></pre>
<p class="tni">The conditional clause now evaluates to true if the variable resolves to <span class="sans_thesansmonocd_w5regular_">HAPPY</span>, <span class="sans_thesansmonocd_w5regular_">Happy</span>, <span class="sans_thesansmonocd_w5regular_">happy</span>, or any of the other 29 possible permutations on the capitalization of the word.</p>
<blockquote class="calibre8">
<p class="warning"><span class="sans_dogma_ot_bold_b_1">NOTE</span></p>
</blockquote>
<p class="warning-txt"><i class="calibre6">The /i option probably looks a bit different from others that I’ve mentioned already and ones yet to come. As mentioned previously, I use lowercase for Batch commands even though the case doesn’t matter to the interpreter. Options also work regardless of the case. Even so, since options are usually just a forward slash followed by a single character, I typically capitalize them for emphasis. But depending on the font, the capital I often looks like a lowercase L, so I depart from my personal convention for the /i option, used most often with the if command. And yes, the irony that this is the option concerned with case-insensitivity has not been lost on me.</i></p>
</section>
<section aria-labelledby="sec6" epub:type="division">
<h4 class="h1" id="sec6"><span id="h2-13"/><span class="sans_futura_std_heavy_oblique_bi_">The errorlevel Variable</span></h4>
<p class="tni">After calling an executable or performing many Batch commands, a return code is stored in the <span class="sans_thesansmonocd_w5regular_">errorlevel</span> pseudo-environment variable. (The command in <span class="xref"><a href="chapter1.xhtml" class="calibre3">Chapter 1</a></span> that copied a file is one example of many to come that will set this variable.) You’ll learn more about pseudo-environment variables in <span class="xref"><a href="chapter21.xhtml" class="calibre3">Chapter 21</a></span>, but for now, consider <span class="sans_thesansmonocd_w5regular_">errorlevel</span> to be a variable containing a return code that you shouldn’t set with the <span class="sans_thesansmonocd_w5regular_">set</span> command. (If you do, you’ll just break the <span class="sans_thesansmonocd_w5regular_">errorlevel</span> variable.) The <span class="sans_thesansmonocd_w5regular_">errorlevel</span> variable can be evaluated like any other in Batch as part of an <span class="sans_thesansmonocd_w5regular_">if</span> command. For example, the following recognizes a return code of <span class="sans_thesansmonocd_w5regular_">1</span> or greater as a failure:</p>
<pre class="pre"><code class="calibre11">if %errorlevel% geq 1    set msg=FAILURE</code></pre>
<p class="tx">Batch also supports an archaic syntax that works only for this unique variable, where the percent signs and the equality operator are removed. The following is functionally equivalent to the previous example:</p>
<pre class="pre"><code class="calibre11">if errorlevel 1          set msg=FAILURE</code></pre>
<p class="tx">At first this may seem simplified and appealing because content has been dropped with nothing added, but the syntax disguises a surprising batveat. Many Batch coders mistakenly interpret this conditional clause as looking for equality between the return code and <span class="sans_thesansmonocd_w5regular_">1</span>. After all, testing it with a return code of <span class="sans_thesansmonocd_w5regular_">0</span> correctly returns false, and testing it with a return code of <span class="sans_thesansmonocd_w5regular_">1</span> correctly returns true. But the conditional clause <span class="sans_thesansmonocd_w5regular_">errorlevel 1</span> is equivalent to both <span class="sans_thesansmonocd_w5regular_">%errorlevel% geq 1</span> and <span class="sans_thesansmonocd_w5regular_">%errorlevel% gtr 0</span>. It evaluates to true for all positive integers.</p>
<p class="tx">Couple this syntax with the <span class="sans_thesansmonocd_w5regular_">not</span> keyword for something truly opaque:</p>
<pre class="pre"><code class="calibre11">if not errorlevel 0      set msg=The Return Code is NEGATIVE</code></pre>
<p class="tni"><span aria-label=" Page 41. " epub:type="pagebreak" id="pg_41" role="doc-pagebreak"/>Doesn’t this look like a conditional clause that would evaluate to true when the return code isn’t equal to <span class="sans_thesansmonocd_w5regular_">0</span>? It’s really the negation of the return code being greater than or equal to <span class="sans_thesansmonocd_w5regular_">0</span>. The <span class="sans_thesansmonocd_w5regular_">%errorlevel% lss 0</span> conditional clause is functionally equivalent and far more readable.</p>
<p class="tx">Another problem with the syntax lacking a compare operator is that more often than not, <span class="sans_thesansmonocd_w5regular_">0</span> represents a good return code, and all others, including negative values, indicate a problem of some sort.</p>
<p class="tx">The <span class="sans_thesansmonocd_w5regular_">neq</span> operator results in this conditional clause being true for all nonzero values:</p>
<pre class="pre"><code class="calibre11">if %errorlevel% neq 0    set msg=FAILURE</code></pre>
<p class="tx">You may run across the arcane syntax, so it’s important to understand how it works, but it’s more important to not propagate it. Always use percent signs (or exclamation marks) and a compare operator to evaluate the <span class="sans_thesansmonocd_w5regular_">errorlevel</span> pseudo-environment variable.</p>
</section>
</section>
<section aria-labelledby="sec7" epub:type="division">
<h3 class="h" id="sec7"><span id="h1-32"/><span class="sans_futura_std_bold_b_">The if...else Construct</span></h3>
<p class="tni">One of the unwritten rules of coding languages is that an <span class="sans_thesansmonocd_w5regular_">if</span> command must come with the possibility of an <span class="sans_thesansmonocd_w5regular_">else</span> keyword. The keywords I mentioned earlier are associated with the conditional clause, but this one is tied to the <span class="sans_thesansmonocd_w5regular_">if</span> command itself. Here’s the general form of the <span class="sans_thesansmonocd_w5regular_">if...else</span> construct, where once again the italicized text must be replaced with code:</p>
<pre class="pre"><code class="calibre11">if <var class="calibre12">conditional clause</var> (
   <var class="calibre12">true code block</var>
) else (
   <var class="calibre12">false code block</var>
)
</code></pre>
<p class="tni">The first two lines and the close parenthesis starting the third are identical to the general form I showed at the beginning of this chapter. The <span class="sans_thesansmonocd_w5regular_">else</span> keyword follows, and it in turn is followed by the <span class="sans_thesansmonocd_w5regular_italic_i_">false code block</span>, set between a second set of parentheses. This represents the code that executes when the <span class="sans_thesansmonocd_w5regular_italic_i_">conditional clause</span> evaluates to false.</p>
<p class="tx">Here’s a simple example of an <span class="sans_thesansmonocd_w5regular_">if...else</span> construct:</p>
<pre class="pre"><code class="calibre11">if %fahrenheit% gtr 70 (
   set pants=shorts
) else (
   set pants=jeans
)
</code></pre>
<p class="tni">If the <span class="sans_thesansmonocd_w5regular_">fahrenheit</span> variable is greater than <span class="sans_thesansmonocd_w5regular_">70</span>, the <span class="sans_thesansmonocd_w5regular_">pants</span> variable is set to <span class="sans_thesansmonocd_w5regular_">shorts</span>. Otherwise, the <span class="sans_thesansmonocd_w5regular_">pants</span> variable is set to <span class="sans_thesansmonocd_w5regular_">jeans</span>. One or the other code block will always execute.</p>
<p class="tx"><span aria-label=" Page 42. " epub:type="pagebreak" id="pg_42" role="doc-pagebreak"/>You can condense this construct into a single line of code:</p>
<pre class="pre"><code class="calibre11">if %fahrenheit% gtr 70 (set pants=shorts) else (set pants=jeans)</code></pre>
<p class="tni">The parentheses surrounding the code in the <span class="sans_thesansmonocd_w5regular_italic_i_">false code block</span> are technically optional, but they should be included for readability.</p>
<p class="tx">Unless you have contempt for those that’ll be reading your code, the one-line <span class="sans_thesansmonocd_w5regular_">if...else</span> construct is usually bad practice, although you might make exceptions for the simplest of tasks.</p>
<p class="tx">Unlike in other languages, in Batch the <span class="sans_thesansmonocd_w5regular_">else</span> keyword can’t be coded on a line of its own; it can’t even start or end a line. To clearly demarcate the two code blocks, it’s best to code the keyword sandwiched between the close and open parentheses on a single line.</p>
</section>
<section aria-labelledby="sec8" epub:type="division">
<h3 class="h" id="sec8"><span id="h1-33"/><span class="sans_futura_std_bold_b_">The else if Construct</span></h3>
<p class="tni">The <span class="sans_thesansmonocd_w5regular_">if...else</span> construct is great when there are exactly two branches in the logical flow, one for true and one for false. When there are more than two branches, the <span class="sans_thesansmonocd_w5regular_">else if</span> construct allows for multiple conditional clauses. <a href="#Lis4-1" class="calibre3">Listing 4-1</a> has three clauses and four branches, one branch for each conditional clause and a default branch that executes when none of the clauses evaluates to true.</p>
<span id="Lis4-1"/>
<pre class="pre"><code class="calibre11">if %fahrenheit% gtr 80 (
   set pants=shorts
) else if %fahrenheit% gtr 60 (
   set pants=light khakis
) else if %fahrenheit% gtr 32 (
   set pants=jeans
) else (
   set pants=lined jeans
)
</code></pre>
<p class="listingcaption"><span class="futura_std_book_oblique_i_">Listing 4-1: An else if construct with four logical branches</span></p>
<p class="tni">This logic assumes that <span class="sans_thesansmonocd_w5regular_">fahrenheit</span> is set to an integer describing the temperature. If it’s greater than <span class="sans_thesansmonocd_w5regular_">80</span> degrees, the first <span class="sans_thesansmonocd_w5regular_">set</span> command executes. If it’s greater than <span class="sans_thesansmonocd_w5regular_">60</span>, which is to say between 61 and 80, inclusive, the second <span class="sans_thesansmonocd_w5regular_">set</span> command executes. If the first two conditional clauses are false and the mercury registers as above freezing, the third <span class="sans_thesansmonocd_w5regular_">set</span> command executes. If all three clauses are false, the temperature is <span class="sans_thesansmonocd_w5regular_">32</span> degrees or below, so the fourth and final <span class="sans_thesansmonocd_w5regular_">set</span> command assigns a very warm pair of <span class="sans_thesansmonocd_w5regular_">pants</span>.</p>
<p class="tx">There’s no open parenthesis immediately after the first <span class="sans_thesansmonocd_w5regular_">else</span> keyword. Instead, it’s followed by another <span class="sans_thesansmonocd_w5regular_">if</span> command with a conditional clause of its own and only then by the open parenthesis.</p>
<p class="tx"><a href="#Lis4-1" class="calibre3">Listing 4-1</a> contains two <span class="sans_thesansmonocd_w5regular_">else if</span> clauses, but you can code any number depending on the need. The interpreter executes the code block corresponding to the first conditional clause that evaluates to true; afterward, <span aria-label=" Page 43. " epub:type="pagebreak" id="pg_43" role="doc-pagebreak"/>control jumps to the end of the entire construct without evaluating the other clauses.</p>
<p class="tx">Many times, you’ll want a final code block executed if none of the conditional clauses is true—that is, a default code block. For instance, if <a href="#Lis4-1" class="calibre3">Listing 4-1</a> fails to set a certain variable, someone is in danger of leaving the house without the proper attire. The final <span class="sans_thesansmonocd_w5regular_">else</span> keyword is not followed by an <span class="sans_thesansmonocd_w5regular_">if</span> command, so its code block, the default code block, executes if none of the three conditional clauses prior to it evaluated to true.</p>
<p class="tx">In <a href="#Lis4-1" class="calibre3">Listing 4-1</a>, <span class="sans_thesansmonocd_w5regular_">fahrenheit</span> is being interrogated to determine in which of four ranges it falls. This is a popular use of <span class="sans_thesansmonocd_w5regular_">else if</span> conditional clauses, but they don’t have to be so closely linked. Each conditional clause can interrogate completely different variables or make use of the three keywords covered earlier. For example, here’s a reimagining of <a href="#Lis4-1" class="calibre3">Listing 4-1</a> with only the three conditional clauses changed:</p>
<pre class="pre"><code class="calibre11">if /i "%season%" equ "Summer" (
   set pants=shorts
) else if exist C:\Batch\Spring.txt (
   set pants=light khakis
) else if %celsius% gtr 0 (
   set pants=jeans
) else (
   set pants=lined jeans
)
</code></pre>
<p class="tni">The first conditional clause performs a case-insensitive compare for equality of a resolved variable and hardcoded text. The second clause is looking for the existence of a file, and the third is looking to see whether the value of the <span class="sans_thesansmonocd_w5regular_">celsius</span> variable is above the freezing point. Once again, due to the default code block, this code is guaranteed to set the variable to one of the four values.</p>
</section>
<section aria-labelledby="sec9" epub:type="division">
<h3 class="h" id="sec9"><span id="h1-34"/><span class="sans_futura_std_bold_b_">Enhanced Equality Determination Techniques</span></h3>
<p class="tni">I would be remiss if I didn’t mention an important batveat associated with these conditional clauses. In some of the examples in this chapter I’ve surrounded each side of the equality with double quotes in a conditional clause, but without them the commands would still work—most of the time. The following two <span class="sans_thesansmonocd_w5regular_">if</span> commands are very similar but <i class="calibre6">not</i> functionally equivalent:</p>
<pre class="pre"><code class="calibre11">if /i "%myMood%" equ "happy"      set do=something
if /i %myMood% equ happy          set do=something
</code></pre>
<p class="tni">If <span class="sans_thesansmonocd_w5regular_">myMood</span> is set to <span class="sans_thesansmonocd_w5regular_">happy</span>, the clause evaluates to true, and if it’s set to <span class="sans_thesansmonocd_w5regular_">sad</span>, the result is false. Either way, it works for both commands.</p>
<p class="tx">That’s great, but now imagine that the variable hasn’t been set or that it’s been set to null or some number of spaces. The command without the <span aria-label=" Page 44. " epub:type="pagebreak" id="pg_44" role="doc-pagebreak"/>double quotes will crash, but it hints at the issue with the following cryptic message (assuming you haven’t used the <span class="sans_thesansmonocd_w5regular_">echo off</span> command mentioned in <span class="xref"><a href="chapter2.xhtml" class="calibre3">Chapter 2</a></span>):</p>
<pre class="pre"><code class="calibre11">happy was unexpected at this time.

C:\Batch&gt;  if /i  equ happy          set do=something
</code></pre>
<p class="tni">The first line here is the error message, and it’s followed by what has confused the interpreter. To understand the error, we must think like the interpreter. Once it sees the <span class="sans_thesansmonocd_w5regular_">if</span> command start the line, it expects one out of a finite list of items to come next (maybe <span class="sans_thesansmonocd_w5regular_">not</span>, <span class="sans_thesansmonocd_w5regular_">exist</span>, <span class="sans_thesansmonocd_w5regular_">defined</span>, or <span class="sans_thesansmonocd_w5regular_">/i</span>), with anything unrecognizable assumed to be the left side of a conditional clause. Obviously, it finds <span class="sans_thesansmonocd_w5regular_">/i</span>. Assuming that one of the three keywords doesn’t come next, the interpreter is now expecting exactly three items in a specific order: some text; an operator such as <span class="sans_thesansmonocd_w5regular_">equ</span>, <span class="sans_thesansmonocd_w5regular_">neq</span>, or <span class="sans_thesansmonocd_w5regular_">==</span>; and some more text. If the value of <span class="sans_thesansmonocd_w5regular_">myMood</span> is pretty much anything, it will resolve to be the first text field. The interpreter will then be pleased to find the <span class="sans_thesansmonocd_w5regular_">equ</span> operator, and knowing that it’s dealing with an equality, it’ll interpret the hardcoded <span class="sans_thesansmonocd_w5regular_">happy</span> as being the right side of that equality. <i class="calibre6">Success</i>.</p>
<p class="tx">This all blows up when the variable resolves to nothing or any number of spaces. The interpreter sees <span class="sans_thesansmonocd_w5regular_">if /i</span> to start the statement, so it doesn’t expect to see <span class="sans_thesansmonocd_w5regular_">equ</span> next. The <span class="sans_thesansmonocd_w5regular_">not</span> keyword would’ve made sense, but not <span class="sans_thesansmonocd_w5regular_">equ</span>. As a result, it incorrectly considers <span class="sans_thesansmonocd_w5regular_">equ</span> to be the left side of what might be an equality and what comes next to be the operator. But what comes next is the <span class="sans_thesansmonocd_w5regular_">happy</span> text, and the list of operators clearly doesn’t contain this word. As the message states, the interpreter doesn’t expect to see <span class="sans_thesansmonocd_w5regular_">happy</span> at this time. <i class="calibre6">Failure</i>.</p>
<p class="tx">Fortunately, there are two methods of evaluating variables that might resolve to nothing.</p>
<section aria-labelledby="sec10" epub:type="division">
<h4 class="h1" id="sec10"><span id="h2-14"/><span class="sans_futura_std_heavy_oblique_bi_">The Preceding Dot Technique</span></h4>
<p class="tni">One common technique to get around this issue is to prefix each side of the equality with a dot, or almost any character as long as it’s applied consistently, so that the interpreter will definitely find something on both sides of the equality:</p>
<pre class="pre"><code class="calibre11">if /i .%myMood% equ .happy         set do=something</code></pre>
<p class="tni">The preceding dot technique works nicely when the variable is set to null, as the command resolves to <span class="sans_thesansmonocd_w5regular_">if /i . equ .happy</span>. The dot isn’t equal to the dot followed by the word, so it evaluates to false, and we move on. If the variable had been set to <span class="sans_thesansmonocd_w5regular_">happy</span>, the command would’ve been resolved to <span class="sans_thesansmonocd_w5regular_">if /i .happy equ .happy</span>, and equality would’ve been found. <i class="calibre6">Success.</i></p>
<p class="tx">But I’m not a fan of this technique because it’s susceptible to yet another batveat. Now imagine that the variable is set to a two-word mood, such as <span class="sans_thesansmonocd_w5regular_">irritably depressed</span>—not good on many levels having nothing to do with the Batch code. Again, it blows up:</p>
<pre class="pre"><code class="calibre11"><span aria-label=" Page 45. " epub:type="pagebreak" id="pg_45" role="doc-pagebreak"/>depressed was unexpected at this time.
C:\Batch&gt;  if /i .irritably depressed equ .happy            set do=something
</code></pre>
<p class="tni">Don’t get down. The interpreter is fooled by the embedded space. Don’t tell anyone, but it really isn’t that bright. It thinks that <span class="sans_thesansmonocd_w5regular_">.irritably</span> is the left side of the clause and finds <span class="sans_thesansmonocd_w5regular_">depressed</span> to be a completely unexpected operator. <i class="calibre6">Failure</i>. But there’s another technique.</p>
</section>
<section aria-labelledby="sec11" epub:type="division">
<h4 class="h1" id="sec11"><span id="h2-15"/><span class="sans_futura_std_heavy_oblique_bi_">The Double Quotes Technique</span></h4>
<p class="tni">Coming full circle, this brings us back to the example with the double quotes around each side of the equality:</p>
<pre class="pre"><code class="calibre11">if /i "%myMood%" equ "happy"      set do=something</code></pre>
<p class="tni">The double quotes here provide something on either side of the equality just as the dot did, but that’s not all.</p>
<p class="tx">The interpreter considers everything inside the double quotes to be one entity. When the variable with the embedded space is resolved, the interpreter sees this:</p>
<pre class="pre"><code class="calibre11">if /i "irritably depressed" equ "happy"</code></pre>
<p class="tni">Despite the embedded space, the interpreter treats <span class="sans_thesansmonocd_w5regular_">"irritably depressed"</span> as one entity, or in this case the left side of the equality, with the right side being <span class="sans_thesansmonocd_w5regular_">"happy"</span>. The upshot is that Batch correctly recognizes these two entities as not being equal. <i class="calibre6">Success</i>.</p>
<p class="tx">If there’s a chance that the alphanumeric variable being interrogated might not be set or that it might contain embedded spaces, I almost always encase each side of the clause with double quotes. However, you may have noticed that I don’t have double quotes encasing <span class="sans_thesansmonocd_w5regular_">%errorlevel%</span> when used in a conditional clause. That variable will always be set to a number, so there’s no need for the quotes. Even more important, when the interpreter sees numbers being compared without quotes, it does a numeric compare, meaning that <span class="sans_thesansmonocd_w5regular_">000</span> is equivalent to <span class="sans_thesansmonocd_w5regular_">0</span>. Adding the quotes results in a text compare, and <span class="sans_thesansmonocd_w5regular_">"000"</span> isn’t equal to <span class="sans_thesansmonocd_w5regular_">"0"</span>.</p>
</section>
<section aria-labelledby="sec12" epub:type="division">
<h4 class="h1" id="sec12"><span id="h2-16"/><span class="sans_futura_std_heavy_oblique_bi_">Preceding Dot vs. Double Quotes</span></h4>
<p class="tni">When comparing alphanumeric values, I <i class="calibre6">usually</i> encase each side of the equality with double quotes. It works when a value is null; it works when a value is one or more spaces; it works when a value has embedded spaces; and it works for more typical non-null spaceless values. However, I’m using the nondefinitive qualifier <i class="calibre6">usually</i> because of an extremely fine point.</p>
<p class="tx">Consider the case of a variable containing a value with a trailing space. Perhaps the value <span class="sans_thesansmonocd_w5regular_">sad</span> is padded with a trailing space to make a four-character value. Is that equal to the three-character value <span class="sans_thesansmonocd_w5regular_">sad</span>? In the purest and most accurate sense, no, they aren’t equal—and using the double quote method <span aria-label=" Page 46. " epub:type="pagebreak" id="pg_46" role="doc-pagebreak"/>correctly finds them to be different. But in a less strict scenario you might consider these values to be equivalent.</p>
<p class="tx">Using the dot method will find equality between the two values because the trailing space becomes just another space between the left side of the equality and the operator. In this narrow instance of trailing spaces, the dot method is better, but it’ll work only if the variables don’t have any embedded spaces.</p>
<p class="tx">In the final analysis, the double quote technique is far superior to the dot method, with one very distinctive case when it isn’t. Get into the habit of using double quotes for almost all non-numeric compares.</p>
<blockquote class="calibre8">
<p class="warning"><span class="sans_dogma_ot_bold_b_1">NOTE</span></p>
</blockquote>
<p class="warning-txt"><i class="calibre6">Batch provides an interesting and compact alternative to the if command, although it does behave differently. It’s not a command, it doesn’t have any keywords, and it doesn’t even support a conditional clause. In <a href="chapter28.xhtml" class="calibre3">Chapter 28</a>, I’ll return to the topic of conditional execution and provide more details about what it is than what it isn’t.</i></p>
</section>
</section>
<section aria-labelledby="sec13" epub:type="division">
<h3 class="h" id="sec13"><span id="h1-35"/><span class="sans_futura_std_bold_b_">Summary</span></h3>
<p class="tni">The <span class="sans_thesansmonocd_w5regular_">if</span> command is instrumental in virtually all, if not all, coding languages, and Batch is no different. In this chapter you learned about the conditional clause, including its valid operators for comparing two operands and its keywords for proving out the existence of a variable, path, or file, and what happens when the clause evaluates to true and false. You also learned how to evaluate multiple clauses so as to execute multiple branches of logic conditionally.</p>
<p class="tx">As is often the case, Batch gives you a little more to consider, so I detailed useful techniques to enhance your conditional clauses comparing both alphanumeric and numeric values. But what makes a value alphanumeric or numeric? I’ll answer that question in the next two chapters concerning data types.</p>
</section>
</section>
</div></body></html>