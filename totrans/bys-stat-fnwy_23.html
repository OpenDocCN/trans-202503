<html><head></head><body>
<h2 class="h2" id="ch19"><span epub:type="pagebreak" id="page_183"/><strong><span class="big">19</span><br/>FROM HYPOTHESIS TESTING TO PARAMETER ESTIMATION</strong></h2>&#13;
<div class="image1"><img alt="Image" src="../images/common.jpg"/></div>&#13;
<p class="noindent">So far, we’ve used posterior odds to compare only two hypotheses. That’s fine for simple problems; even if we have three or four hypotheses, we can test them all by conducting multiple hypothesis tests, as we did in the previous chapter. But sometimes we want to search a really large space of possible hypotheses to explain our data. For example, you might want to guess how many jelly beans are in a jar, the height of a faraway building, or the exact number of minutes it will take for a flight to arrive. In all these cases, there are many, many possible hypotheses—too many to conduct hypothesis tests for all of them.</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_184"/>Luckily, there’s a technique for handling this scenario. In <a href="ch15.xhtml#ch15">Chapter 15</a>, we learned how to turn a parameter estimation problem into a hypothesis test. In this chapter, we’re going to do the opposite: by looking at a virtually continuous range of possible hypotheses, we can use the Bayes factor and posterior odds (a hypothesis test) as a form of parameter estimation! This approach allows us to evaluate more than just two hypotheses and provides us with a simple framework for estimating any parameter.</p>&#13;
<h3 class="h3" id="ch19lev1sec1"><strong>Is the Carnival Game Really Fair?</strong></h3>&#13;
<p class="noindent">Suppose you’re at a carnival. While walking through the games, you notice someone arguing with a carnival attendant near a pool of little plastic ducks. Curious, you get closer and hear the player yelling, “This game is rigged! You said there was a 1 in 2 chance of getting a prize and I’ve picked up 20 ducks and only received one prize! It looks to me like the chance of getting a prize is only 1 in 20!”</p>&#13;
<p class="indent">Now that you have a strong understanding of probability, you decide to settle this argument yourself. You explain to the attendant and the angry customer that if you observe some more games that day, you’ll be able to use the Bayes factor to determine who’s right. You decide to break up the results into two hypotheses: <em>H</em><sub>1</sub>, which represents the attendant’s claim that the probability of a prize is 1/2, and <em>H</em><sub>2</sub>, the angry customer’s claim that the probability of a prize is just 1/20:</p>&#13;
<div class="equ-image"><img alt="Image" src="../images/f0184-01.jpg"/></div>&#13;
<p class="indent">The attendant argues that because he didn’t watch the customer pick up ducks, he doesn’t think you should use his reported data, since no one else can verify it. This seems fair to you. You decide to watch the next 100 games and use that as your data instead. After the customer has picked up 100 ducks, you observe that 24 of them came with prizes.</p>&#13;
<p class="indent">Now, on to the Bayes factor! Since we don’t have a strong opinion about the claim from either the customer or the attendant, we won’t worry about the prior odds or calculating our full posterior odds yet.</p>&#13;
<p class="indent">To get our Bayes factor, we need to compute <em>P</em>(<em>D</em> | <em>H</em>) for each hypothesis:</p>&#13;
<p class="equ"><em>P</em>(<em>D</em> | <em>H</em><sub>1</sub>) = (0.5)<sup>24</sup> × (1 – 0.5)<sup>76</sup></p>&#13;
<p class="equ"><em>P</em>(<em>D</em> | <em>H</em><sub>2</sub>) = (0.05)<sup>24</sup> × (1 – 0.05)<sup>76</sup></p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_185"/>Now, individually, both of these probabilities are quite small, but all we care about is the ratio. We’ll look at our ratio in terms of <em>H</em><sub>2</sub>/<em>H</em><sub>1</sub> so that our result will tell us how many times better the customer’s hypothesis explains the data than the attendant’s:</p>&#13;
<div class="equ-image"><img alt="Image" src="../images/f0185-01.jpg"/></div>&#13;
<p class="indent">Our Bayes factor tells us that <em>H</em><sub>1</sub>, the attendant’s hypothesis, explains the data 653 times as well as <em>H</em><sub>2</sub>, which means that the attendant’s hypothesis (that the probability of getting a prize when picking up a duck is 0.5) is the more likely one.</p>&#13;
<p class="indent">This should immediately seem strange. Clearly, the probability of getting only 24 prizes out of a total of 100 ducks seems really unlikely if the true probability of a prize is 0.5. We can use R’s <span class="literal">pbinom()</span> function (introduced in <a href="ch13.xhtml#ch13">Chapter 13</a>) to calculate the binomial distribution, which will tell us the probability of seeing 24 <em>or fewer</em> prizes, assuming that the probability of getting a prize is really 0.5:</p>&#13;
<p class="programs">&gt; <span class="codestrong1">pbinom(24,100,0.5)</span><br/>&#13;
9.050013e-08</p>&#13;
<p class="indent">As you can see, the probability of getting 24 or fewer prizes if the true probability of a prize is 0.5 is extremely low; expanding it out to the full decimal values, we get a probability of 0.00000009050013! Something is definitely up with <em>H</em><sub>1</sub>. Even though we don’t believe the attendant’s hypothesis, it still explains the data much better than the customer’s.</p>&#13;
<p class="indent">So what’s missing? In the past, we’ve often found that the prior probability usually matters a lot when the Bayes factor alone doesn’t give us an answer that makes sense. But as we saw in <a href="ch18.xhtml#ch18">Chapter 18</a>, there are cases in which the prior isn’t the root cause of our problem. In this case, using the following equation seems reasonable, since we don’t have a strong opinion either way:</p>&#13;
<div class="equ-image"><img alt="Image" src="../images/f0185-02.jpg"/></div>&#13;
<p class="indent">But maybe the problem here is that you have a preexisting mistrust in carnival games. Because the result of the Bayes factor favors the attendant’s hypothesis so strongly, we’d need our prior odds to be at least 653 to get a posterior odds that favors the customer’s hypothesis:</p>&#13;
<div class="equ-image"><img alt="Image" src="../images/f0185-03.jpg"/></div>&#13;
<p class="indent">That’s a really deep distrust of the fairness of the game! There must be some problem here other than the prior.</p>&#13;
<h4 class="h4" id="ch19lev2sec1"><span epub:type="pagebreak" id="page_186"/><strong><em>Considering Multiple Hypotheses</em></strong></h4>&#13;
<p class="noindent">One obvious problem is that, while it seems intuitively clear that the attendant is wrong in his hypothesis, the customer’s alternative hypothesis is just too extreme to be right, either, so we have two wrong hypotheses. What if the customer thought the probability of winning was 0.2, rather than 0.05? We’ll call this hypothesis <em>H</em><sub>3</sub>. Testing <em>H</em><sub>3</sub> against the attendant’s hypothesis radically changes the results of our likelihood ratio:</p>&#13;
<div class="equ-image"><img alt="Image" src="../images/f0186-01.jpg"/></div>&#13;
<p class="indent">Here we see that <em>H</em><sub>3</sub> explains the data wildly better than <em>H</em><sub>1</sub>. With a Bayes factor of 917,399, we can be certain that <em>H</em><sub>1</sub> is far from the best hypothesis for explaining the data we’ve observed, because <em>H</em><sub>3</sub> blows it out of the water. The trouble we had in our first hypothesis test was that the customer’s belief was a far worse description of the event than the attendant’s belief. As we can see, though, that doesn’t mean the attendant was right. When we came up with an alternative hypothesis, we saw that it was a much better guess than either the attendant’s or the customer’s.</p>&#13;
<p class="indent">Of course, we haven’t really solved our problem. What if there’s an even better hypothesis out there?</p>&#13;
<h4 class="h4" id="ch19lev2sec2"><strong><em>Searching for More Hypotheses with R</em></strong></h4>&#13;
<p class="noindent">We want a more general solution that searches all of our possible hypotheses and picks out the best one. To do this, we can use R’s <span class="literal">seq()</span> function to create a sequence of hypotheses we want to compare to our <em>H</em><sub>1</sub>.</p>&#13;
<p class="indent">We’ll consider every increment of 0.01 between 0 and 1 as a possible hypothesis. That means we’ll consider 0.01, 0.02, 0.03, and so on. We’ll call 0.01—the amount we’re increasing each hypothesis by—<span class="literal">dx</span> (a common notation from calculus representing the “smallest change”) and use it to define a <span class="literal">hypotheses</span> variable, which represents all of the possible hypotheses we want to consider. Here we use R’s <span class="literal">seq()</span> function to generate a range of values for each hypothesis between 0 and 1 by incrementing the values by our <span class="literal">dx</span>:</p>&#13;
<p class="programs">dx &lt;- 0.01<br/>&#13;
hypotheses &lt;- seq(0,1,by=dx)</p>&#13;
<p class="indent">Next, we need a function that can calculate our likelihood ratio for any two hypotheses. Our <span class="literal">bayes.factor()</span> function will take two arguments: <span class="literal">h_top</span>, which is the probability of getting a prize for the hypothesis on the top (the numerator) and <span class="literal">h_bottom</span>, which is the hypothesis we’re competing against (the attendant’s hypothesis). We set this up like so:</p>&#13;
<p class="programs">bayes.factor &lt;- function(h_top,h_bottom){<br/>&#13;
  ((h_top)^24*(1-h_top)^76)/((h_bottom)^24*(1-h_bottom)^76)<br/>&#13;
}</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_187"/>Finally, we compute the likelihood ratio for all of these possible hypotheses:</p>&#13;
<p class="programs">bfs &lt;- bayes.factor(hypotheses,0.5)</p>&#13;
<p class="indent">Then, we use R’s base plotting functionality to see what these likelihood ratios look like:</p>&#13;
<p class="programs">plot(hypotheses,bfs, type='l')</p>&#13;
<p class="indent"><a href="ch19.xhtml#ch19fig01">Figure 19-1</a> shows the resulting plot.</p>&#13;
<div class="image"><a id="ch19fig01"/><img alt="Image" src="../images/19fig01.jpg"/></div>&#13;
<p class="figcap"><em>Figure 19-1: Plotting the Bayes factor for each of our hypotheses</em></p>&#13;
<p class="indent">Now we can see a clear distribution of different explanations for the data we’ve observed. Using R, we can look at a wide range of possible hypotheses, where each point in our line represents the Bayes factor for the corresponding hypothesis on the x-axis.</p>&#13;
<p class="indent">We can also see how high the largest Bayes factor is by using the <span class="literal">max()</span> function with our vector of <span class="literal">bfs</span>:</p>&#13;
<p class="programs">&gt; <span class="codestrong1">max(bfs)</span><br/>&#13;
1.47877610^{6}</p>&#13;
<p class="indent">Then we can check which hypothesis corresponds to the highest likelihood ratio, telling us which hypothesis we should believe in the most. To do this, enter:</p>&#13;
<p class="programs">&gt; <span class="codestrong1">hypotheses[which.max(bfs)]</span><br/>&#13;
0.24</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_188"/>Now we know that a probability of 0.24 is our best guess, since this hypothesis produces the highest likelihood ratio when compared with the attendant’s. In <a href="ch10.xhtml#ch10">Chapter 10</a>, you learned that using the mean or expectation of our data is often a good way to come up with a parameter estimate. Here we’ve simply chosen the hypothesis that individually explains the data the best, because we don’t currently have a way to weigh our estimates by their probability of occurring.</p>&#13;
<h4 class="h4" id="ch19lev2sec3"><strong><em>Adding Priors to Our Likelihood Ratios</em></strong></h4>&#13;
<p class="noindent">Now suppose you present your findings to the customer and the attendant. Both agree that your findings are pretty convincing, but then another person walks up to you and says, “I used to make games like these, and I can tell you that for some strange industry reason, the people who design these duck games never put the prize rate between 0.2 and 0.3. I’d bet you the odds are 1,000 to 1 that the real prize rate is not in this range. Other than that, I have no clue.”</p>&#13;
<p class="indent">Now we have some prior odds that we’d like to use. Since the former game maker has given us some solid odds about his prior beliefs in the probability of getting a prize, we can try to multiply this by our current list of Bayes factors and compute the posterior odds. To do this, we create a list of prior odds ratios for every hypothesis we have. As the former game maker told us, the prior odds ratio for all probabilities between 0.2 and 0.3 should be 1/1,000. Since the maker has no opinion about other hypotheses, the odds ratio for these will just be 1. We can use a simple <span class="literal">ifelse</span> statement, using our vector of <span class="literal">hypotheses</span>, to create a vector of our odds ratios:</p>&#13;
<p class="programs">priors &lt;- ifelse(hypotheses &gt;= 0.2 &amp; hypotheses &lt;= 0.3, 1/1000,1)</p>&#13;
<p class="indent">Then we can once again use <span class="literal">plot()</span> to display this distribution of priors:</p>&#13;
<p class="programs">plot(hypotheses,priors,type='l')</p>&#13;
<p class="indent"><a href="ch19.xhtml#ch19fig02">Figure 19-2</a> shows our distribution of prior odds.</p>&#13;
<p class="indent">Because R is a vector-based language (for more information on this, see <a href="app01.xhtml#app01">Appendix A</a>), we can simply multiply our <span class="literal">priors</span> by our <span class="literal">bfs</span> and get a new vector of <span class="literal">posteriors</span> representing our Bayes factors:</p>&#13;
<p class="programs">posteriors &lt;- priors*bfs</p>&#13;
<p class="indent">Finally, we can plot a chart of the posterior odds of each of our many hypotheses:</p>&#13;
<p class="programs">plot(hypotheses,posteriors,type='l')</p>&#13;
<p class="indent"><a href="ch19.xhtml#ch19fig03">Figure 19-3</a> shows the plot.</p>&#13;
<div class="image"><span epub:type="pagebreak" id="page_189"/><a id="ch19fig02"/><img alt="Image" src="../images/19fig02.jpg"/></div>&#13;
<p class="figcap"><em>Figure 19-2: Visualizing our prior odds ratios</em></p>&#13;
<div class="image"><a id="ch19fig03"/><img alt="Image" src="../images/19fig03.jpg"/></div>&#13;
<p class="figcap"><em>Figure 19-3: Plotting our distribution of Bayes factors</em></p>&#13;
<p class="indent">As we can see, we get a very strange distribution of possible beliefs. We have reasonable confidence in the values between 0.15 and 0.2 and between 0.3 and 0.35, but find the range between 0.2 and 0.3 to be extremely unlikely. But this distribution is an honest representation of the strength of belief in each hypothesis, given what we’ve learned about the duck game manufacturing process.</p>&#13;
<p class="indent">While this visualization is helpful, we really want to be able to treat this data like a true probability distribution. That way, we can ask questions about how much we believe in ranges of possible hypotheses and calculate the expectation of our distribution to get a single estimate for what we believe the hypothesis to be.</p>&#13;
<h3 class="h3" id="ch19lev1sec2"><span epub:type="pagebreak" id="page_190"/><strong>Building a Probability Distribution</strong></h3>&#13;
<p class="noindent">A true probability distribution is one where the sum of all possible beliefs equals 1. Having a probability distribution would allow us to calculate the expectation (or mean) of our data to make a better estimate about the true rate of getting a prize. It would also allow us to easily sum ranges of values so we could come up with confidence intervals and other similar estimates.</p>&#13;
<p class="indent">The problem is that if we add up all the posterior odds for our hypotheses, they don’t equal 1, as shown in this calculation:</p>&#13;
<p class="programs">&gt; <span class="codestrong1">sum(posteriors)</span><br/>&#13;
3.140687510^{6}</p>&#13;
<p class="indent">This means we need to normalize our posterior odds so that they do sum to 1. To do so, we simply divide each value in our <span class="literal">posteriors</span> vector by the sum of all the values:</p>&#13;
<p class="programs">p.posteriors &lt;- posteriors/sum(posteriors)</p>&#13;
<p class="indent">Now we can see that our <span class="literal">p.posteriors</span> values add up to 1:</p>&#13;
<p class="programs">&gt; <span class="codestrong1">sum(p.posteriors)</span><br/>&#13;
1</p>&#13;
<p class="indent">Finally, let’s plot our new <span class="literal">p.posteriors</span>:</p>&#13;
<p class="programs">plot(hypotheses,p.posteriors,type='l')</p>&#13;
<p class="indent"><a href="ch19.xhtml#ch19fig04">Figure 19-4</a> shows the plot.</p>&#13;
<div class="image"><a id="ch19fig04"/><img alt="Image" src="../images/19fig04.jpg"/></div>&#13;
<p class="figcap"><em>Figure 19-4: Our normalized posterior odds (note the scale on the y-axis)</em></p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_191"/>We can also use our <span class="literal">p.posteriors</span> to answer some common questions we might have about our data. For example, we can now calculate the probability that the true rate of getting a prize is less than what the attendant claims. We just add up all the probabilities for values less than 0.5:</p>&#13;
<p class="programs">sum(p.posteriors[which(hypotheses &lt; 0.5)])<br/>&#13;
&gt; 0.9999995</p>&#13;
<p class="indent">As we can see, the probability that the prize rate is lower than the attendant’s hypothesis is nearly 1. That is, we can be almost certain that the attendant is overstating the true prize rate.</p>&#13;
<p class="indent">We can also calculate the expectation of our distribution and use this result as our estimate for the true probability. Recall that the expectation is just the sum of the estimates weighted by their value:</p>&#13;
<p class="programs">&gt; sum(p.posteriors*hypotheses)<br/>&#13;
0.2402704</p>&#13;
<p class="indent">Of course, we can see our distribution is a bit atypical, with a big gap in the middle, so we might want to simply choose the most <em>likely</em> estimate, as follows:</p>&#13;
<p class="programs">&gt; hypotheses[which.max(p.posteriors)]<br/>&#13;
0.19</p>&#13;
<p class="indent">Now we’ve used the Bayes factor to come up with a range of probabilistic estimates for the true possible rate of winning a prize in the duck game. This means that we’ve used the Bayes factor as a form of parameter estimation!</p>&#13;
<h3 class="h3" id="ch19lev1sec3"><strong>From the Bayes Factor to Parameter Estimation</strong></h3>&#13;
<p class="noindent">Let’s take a moment to look at our likelihood ratios alone again. When we weren’t using a prior probability for any of the hypotheses, you might have felt that we already had a perfectly good approach to solving this problem without needing the Bayes factor. We observed 24 ducks with prizes and 76 ducks without prizes. Couldn’t we just use our good old beta distribution to solve this problem? As we’ve discussed many times since <a href="ch05.xhtml#ch05">Chapter 5</a>, if we want to estimate the rate of some event, we can always use the beta distribution. <a href="ch19.xhtml#ch19fig05">Figure 19-5</a> shows a plot of a beta distribution with an alpha of 24 and a beta of 76.</p>&#13;
<div class="image"><span epub:type="pagebreak" id="page_192"/><a id="ch19fig05"/><img alt="Image" src="../images/19fig05.jpg"/></div>&#13;
<p class="figcap"><em>Figure 19-5: The beta distribution with an alpha of 24 and a beta of 76</em></p>&#13;
<p class="indent">Except for the scale of the y-axis, the plot looks nearly identical to the original plot of our likelihood ratios! In fact, if we do a few simple tricks, we can get these two plots to line up perfectly. If we scale our beta distribution by the size of our <span class="literal">dx</span> and normalize our <span class="literal">bfs</span>, we can see that these two distributions get quite close (<a href="ch19.xhtml#ch19fig06">Figure 19-6</a>).</p>&#13;
<div class="image"><a id="ch19fig06"/><img alt="Image" src="../images/19fig06.jpg"/></div>&#13;
<p class="figcap"><em>Figure 19-6: Our initial distribution of likelihood ratios maps pretty closely to Beta(24,76).</em></p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_193"/>There seems to be only a slight difference now. We can fix it by using the weakest prior that indicates that getting a prize and not getting a prize are equally likely—that is, by adding 1 to both the alpha and beta parameters, as shown in <a href="ch19.xhtml#ch19fig07">Figure 19-7</a>.</p>&#13;
<div class="image"><a id="ch19fig07"/><img alt="Image" src="../images/19fig07.jpg"/></div>&#13;
<p class="figcap"><em>Figure 19-7: Our likelihood ratios map perfectly to a Beta(24+1,76+1) distribution.</em></p>&#13;
<p class="indent">Now we can see that the two distributions are perfectly aligned. <a href="ch05.xhtml#ch05">Chapter 5</a> mentioned that the beta distribution was difficult to derive from our basic rules of probability. However, by using the Bayes factor, we’ve been able to empirically re-create a modified version of it that assumes a prior of Beta(1,1). And we did it without any fancy mathematics! All we had to do was:</p>&#13;
<ol>&#13;
<li class="noindent">Define the probability of the evidence given a hypothesis.</li>&#13;
<li class="noindent">Consider all possible hypotheses.</li>&#13;
<li class="noindent">Normalize these values to create a probability distribution.</li>&#13;
</ol>&#13;
<p class="indent">Every time we’ve used the beta distribution in this book, we’ve used a beta-distributed prior. This made the math easier, since we can arrive at the posterior by combining the alpha and beta parameters from the likelihood and prior beta distributions. In other words:</p>&#13;
<p class="equ">Beta(α<sub>posterior</sub>, β<sub>posterior</sub>) = Beta(α<sub>prior</sub> + α<sub>likelihood</sub>, β<sub>prior</sub> + β<sub>likelihood</sub>)</p>&#13;
<p class="indent">However, by building our distribution from the Bayes factor, we were able to easily use a unique prior distribution. Not only is the Bayes factor a <span epub:type="pagebreak" id="page_194"/>great tool for setting up hypothesis tests, but, as it turns out, it’s also all we need to create any probability distribution we might want to use to solve our problem, whether that’s hypothesis testing or parameter estimation. We just need to be able to define the basic comparison between two hypotheses, and we’re on our way.</p>&#13;
<p class="indent">When we built our A/B test in <a href="ch15.xhtml#ch15">Chapter 15</a>, we figured out how to reduce many hypothesis tests to a parameter estimation problem. Now you’ve seen how the most common form of hypothesis testing can also be used to perform parameter estimation. Given these two related insights, there is virtually no limit to the type of probability problems we can solve using only the most basic rules of probability.</p>&#13;
<h3 class="h3" id="ch19lev1sec4"><strong>Wrapping Up</strong></h3>&#13;
<p class="noindent">Now that you’ve finished your journey into Bayesian statistics, you can appreciate the true beauty of what you’ve been learning. From the basic rules of probability, we can derive Bayes’ theorem, which lets us convert evidence into a statement expressing the strength of our beliefs. From Bayes’ theorem, we can derive the Bayes factor, a tool for comparing how well two hypotheses explain the data we’ve observed. By iterating through possible hypotheses and normalizing the results, we can use the Bayes factor to create a parameter estimate for an unknown value. This, in turn, allows us to perform countless other hypothesis tests by comparing our estimates. And all we need to do to unlock all this power is use the basic rules of probability to define our likelihood, <em>P</em>(<em>D</em> | <em>H</em>)!</p>&#13;
<h3 class="h3" id="ch19lev1sec5"><strong>Exercises</strong></h3>&#13;
<p class="noindent">Try answering the following questions to see how well you understand using the Bayes factor and posterior odds to do parameter estimation. The solutions can be found at <em><a href="https://nostarch.com/learnbayes/">https://nostarch.com/learnbayes/</a></em>.</p>&#13;
<ol>&#13;
<li class="noindent">Our Bayes factor assumed that we were looking at <em>H</em><sub>1</sub>: <em>P</em>(prize) = 0.5. This allowed us to derive a version of the beta distribution with an alpha of 1 and a beta of 1. Would it matter if we chose a different probability for <em>H</em><sub>1</sub>? Assume <em>H</em><sub>1</sub>: <em>P</em>(prize) = 0.24, then see if the resulting distribution, once normalized to sum to 1, is any different than the original hypothesis.</li>&#13;
<li class="noindent">Write a prior for the distribution in which each hypothesis is 1.05 times more likely than the previous hypothesis (assume our <span class="literal">dx</span> remains the same).</li>&#13;
<li class="noindent">Suppose you observed another duck game that included 34 ducks with prizes and 66 ducks without prizes. How would you set up a test to answer “What is the probability that you have a better chance of winning a prize in this game than in the game we used in our example?” Implementing this requires a bit more sophistication than the R used in this book, but see if you can learn this on your own to kick off your adventures in more advanced Bayesian statistics!</li>&#13;
</ol>&#13;
</body></html>