<html><head></head><body>
<h2 class="h2" id="ch10"><span epub:type="pagebreak" id="page_179"/><span class="big"><strong>10</strong></span><br/><strong>CONDITIONS AND LOOPS</strong></h2>&#13;
<div class="image"><img src="../images/common-01.jpg" alt="image"/></div>&#13;
<p class="noindent">To write more sophisticated programs with R, you’ll need to control the flow and order of execution in your code. One fundamental way to do this is to make the execution of certain sections of code dependent on a <em>condition</em>. Another basic control mechanism is the <em>loop</em>, which repeats a block of code a certain number of times. In this chapter, we’ll explore these core programming techniques using <code>if</code>-<code>else</code> statements, <code>for</code> and <code>while</code> loops, and other control structures.</p>&#13;
<h3 class="h3" id="ch10lev1sec33"><strong>10.1 if Statements</strong></h3>&#13;
<p class="noindent">The <code>if</code> statement is the key to controlling exactly which operations are carried out in a given chunk of code. An <code>if</code> statement runs a block of code only if a certain condition is true. These constructs allow a program to respond differently depending on whether a condition is <code>TRUE</code> or <code>FALSE</code>.</p>&#13;
<h4 class="h4" id="ch10lev2sec87"><span epub:type="pagebreak" id="page_180"/><strong><em>10.1.1 Stand-Alone Statement</em></strong></h4>&#13;
<p class="noindent">Let’s start with the stand-alone <code>if</code> statement, which looks something like this:</p>&#13;
<pre>if(<span class="codeitalic">condition</span>){<br/>    <span class="codeitalic">do any code here</span><br/>}</pre>&#13;
<p class="indent">The <code><span class="codeitalic">condition</code></span> is placed in parentheses after the <code>if</code> keyword. This condition must be an expression that yields a single logical value (<code>TRUE</code> or <code>FALSE</code>). If it’s <code>TRUE</code>, the code in the braces, <code>{}</code>, will be executed. If the condition isn’t satisfied, the code in the braces is skipped, and R does nothing (or continues on to execute any code after the closing brace).</p>&#13;
<p class="indent">Here’s a simple example. In the console, store the following:</p>&#13;
<pre>R&gt; a &lt;- 3<br/>R&gt; mynumber &lt;- 4</pre>&#13;
<p class="indent">Now, in the R editor, write the following code chunk:</p>&#13;
<pre>if(a&lt;=mynumber){<br/>    a &lt;- a^2<br/>}</pre>&#13;
<p class="indent">When this chunk is executed, what will the value of <code>a</code> be? It depends on the condition defining the <code>if</code> statement, as well as what’s actually specified in the braced area. In this case, when the condition <code>a&lt;=mynumber</code> is evaluated, the result is <code>TRUE</code> since 3 is indeed less than or equal to 4. That means the code inside the braces is executed, which sets <code>a</code> to <code>a^2</code>, or 9.</p>&#13;
<p class="indentb">Now highlight the entire chunk of code in the editor and send it to the console for evaluation. Remember, you can do this in several ways:</p>&#13;
<p class="bull">• Copy and paste the selected text from the editor directly into the console.</p>&#13;
<p class="bull">• From the menu, select <strong>Edit</strong> → <strong>Run line or selection</strong> in Windows or select <strong>Edit</strong> → <strong>Execute</strong> in OS X.</p>&#13;
<p class="bull">• Use the keystroke shortcut such as <small>CTRL</small>-R in Windows or -<small>RETURN</small> on a Mac.</p>&#13;
<p class="indentt">Once you execute the code in the console, you’ll see something like this:</p>&#13;
<pre>R&gt; if(a&lt;=mynumber){<br/>+   a &lt;- a^2<br/>+ }</pre>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_181"/>Then, look at the object <code>a</code>, shown here:</p>&#13;
<pre>R&gt; a<br/>[1] 9</pre>&#13;
<p class="indent">Next, suppose you execute the same <code>if</code> statement again right away. Will <code>a</code> be squared once more, giving 81? Nope! Since <code>a</code> is now 9 and <code>mynumber</code> is still 4, the condition <code>a&lt;=mynumber</code> will be <code>FALSE</code>, and the code in the braces will not be executed; <code>a</code> will remain at 9.</p>&#13;
<p class="indent">Note that after you send the <code>if</code> statement to the console, each line after the first is prefaced by a <code>+</code>. These <code>+</code> signs do not represent any kind of arithmetic addition; rather, they indicate that R is expecting more input before it begins execution. For example, when a left brace is opened, R will not begin any kind of execution until that section is closed with a right brace. To avoid redundancy, in future examples I won’t show this repetition of code sent from the editor to the console.</p>&#13;
<div class="note">&#13;
<p class="notet"><strong><span class="notes">NOTE</span></strong></p>&#13;
<p class="notep"><em>You can change the</em> <code><span class="codeitalic">+</code></span> <em>symbol by assigning a different character string to the</em> <code><span class="codeitalic">continue</code></span> <em>component of R’s</em> <code><span class="codeitalic">options</code></span> <em>command, in the way you reset the prompt in <a href="ch01.xhtml#ch01lev2sec06">Section 1.2.1</a>.</em></p>&#13;
</div>&#13;
<p class="indent">The <code>if</code> statement offers a huge amount of flexibility—you can place any kind of code in the braced area, including more <code>if</code> statements (see the upcoming discussion of nesting in <a href="ch10.xhtml#ch10lev2sec90">Section 10.1.4</a>), enabling your program to make a sequence of decisions.</p>&#13;
<p class="indent">To illustrate a more complicated <code>if</code> statement, consider the following two new objects:</p>&#13;
<pre>R&gt; myvec &lt;- c(2.73,5.40,2.15,5.29,1.36,2.16,1.41,6.97,7.99,9.52)<br/>R&gt; myvec<br/> [1] 2.73 5.40 2.15 5.29 1.36 2.16 1.41 6.97 7.99 9.52<br/>R&gt; mymat &lt;- matrix(c(2,0,1,2,3,0,3,0,1,1),5,2)<br/>R&gt; mymat<br/>     [,1] [,2]<br/>[1,]    2    0<br/>[2,]    0    3<br/>[3,]    1    0<br/>[4,]    2    1<br/>[5,]    3    1</pre>&#13;
<p class="indent">Use these two objects in the code chunk given here:</p>&#13;
<pre>if(any((myvec-1)&gt;9)||matrix(myvec,2,5)[2,1]&lt;=6){<br/>    cat("Condition satisfied --\n")<br/>    new.myvec &lt;- myvec<br/>    new.myvec[seq(1,9,2)] &lt;- NA<br/>    mylist &lt;- list(aa=new.myvec,bb=mymat+0.5)<br/>    cat("-- a list with",length(mylist),"members now exists.")<br/>}</pre>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_182"/>Send this to the console, and it produces the following output:</p>&#13;
<pre>Condition satisfied --<br/>-- a list with 2 members now exists.</pre>&#13;
<p class="indent">Indeed, an object <code>mylist</code> has been created that you can examine.</p>&#13;
<pre>R&gt; mylist<br/>$aa<br/> [1]   NA 5.40   NA 5.29   NA 2.16   NA 6.97   NA 9.52<br/><br/>$bb<br/>     [,1] [,2]<br/>[1,]  2.5  0.5<br/>[2,]  0.5  3.5<br/>[3,]  1.5  0.5<br/>[4,]  2.5  1.5<br/>[5,]  3.5  1.5</pre>&#13;
<p class="indentb">In this example, the condition consists of two parts separated by an OR statement using <code>||</code>, which produces a single logical result. Let’s walk through it.</p>&#13;
<p class="bull">• The first part of the condition looks at <code>myvec</code>, takes <code>1</code> away from each element, and checks whether any of the results are greater than 9. If you run this part on its own, it yields <code>FALSE</code>.</p>&#13;
<p class="programs-b">R&gt; myvec-1<br/>[1] 1.73 4.40 1.15 4.29 0.36 1.16 0.41 5.97 6.99 8.52<br/>R&gt; (myvec-1)&gt;9<br/>[1] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE<br/>R&gt; any((myvec-1)&gt;9)<br/>[1] FALSE</p>&#13;
<p class="bull">• The second part of the condition uses positional matching in a call to <code>matrix</code> to construct a two-row, five-column, column-filled matrix using entries of the original <code>myvec</code>. Then, the number in the second row of the first column of that result is checked to see whether it’s less than or equal to 6, which it is.</p>&#13;
<p class="programs-b">R&gt; matrix(myvec,2,5)<br/>     [,1] [,2] [,3] [,4] [,5]<br/>[1,] 2.73 2.15 1.36 1.41 7.99<br/>[2,] 5.40 5.29 2.16 6.97 9.52<br/>R&gt; matrix(myvec,2,5)[2,1]<br/>[1] 5.4<br/>R&gt; matrix(myvec,2,5)[2,1]&lt;=6<br/>[1] TRUE</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_183"/>This means the overall condition being checked by the <code>if</code> statement will be <code>FALSE||TRUE</code>, which evaluates as <code>TRUE</code>.</p>&#13;
<pre>R&gt; any((myvec-1)&gt;9)||matrix(myvec,2,5)[2,1]&lt;=6<br/>[1] TRUE</pre>&#13;
<p class="indent">As a result, the code inside the braces is accessed and executed. First, it prints the <code>"Condition satisfied"</code> string and copies <code>myvec</code> to <code>new.myvec</code>. Using <code>seq</code>, it then accesses the odd-numbered indexes of <code>new.myvec</code> and overwrites them with <code>NA</code>. Next, it creates <code>mylist</code>. In this list, <code>new.myvec</code> is stored in a member named <code>aa</code>, and then it takes the original <code>mymat</code>, increases all its elements by 0.5, and stores the result in <code>bb</code>. Lastly, it prints the length of the resulting list.</p>&#13;
<p class="indent">Note that <code>if</code> statements don’t have to match the exact style I’m using here. Some programmers, for example, prefer to open the left brace on a new line after the condition, or some may prefer a different amount of indentation.</p>&#13;
<h4 class="h4" id="ch10lev2sec88"><strong><em>10.1.2 else Statements</em></strong></h4>&#13;
<p class="noindent">The <code>if</code> statement executes a chunk of code if and only if a defined condition is <code>TRUE</code>. If you want something different to happen when the condition is <code>FALSE</code>, you can add an <code>else</code> declaration. Here’s an example in pseudocode:</p>&#13;
<pre>if(<span class="codeitalic">condition</span>){<br/>    <span class="codeitalic">do any code in here if condition is</span> TRUE<br/>} else {<br/>    <span class="codeitalic">do any code in here if condition is</span> FALSE<br/>}</pre>&#13;
<p class="indent">You set the condition, then in the first set of braces you place the code to run if the condition is <code>TRUE</code>. After this, you declare <code>else</code> followed by a new set of braces where you can place code to run if the condition is <code>FALSE</code>.</p>&#13;
<p class="indent">Let’s return to the first example in <a href="ch10.xhtml#ch10lev2sec87">Section 10.1.1</a>, once more storing these values at the console prompt.</p>&#13;
<pre>R&gt; a &lt;- 3<br/>R&gt; mynumber &lt;- 4</pre>&#13;
<p class="indent">In the editor, create a new version of the earlier <code>if</code> statement.</p>&#13;
<pre>if(a&lt;=mynumber){<br/>    cat("Condition was",a&lt;=mynumber)<br/>    a &lt;- a^2<br/>} else {<br/>    cat("Condition was",a&lt;=mynumber)<br/>    a &lt;- a-3.5<br/>}<br/>a</pre>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_184"/>Here, you again square <code>a</code> if the condition <code>a&lt;=mynumber</code> is <code>TRUE</code>, but if <code>FALSE</code>, <code>a</code> is overwritten by the result of itself minus 3.5. You also print text to the console stating whether the condition was met. After resetting <code>a</code> and <code>mynumber</code> to their original values, the first run of the <code>if</code> loop computes <code>a</code> as 9, just as earlier, outputting the following:</p>&#13;
<pre>Condition was TRUE<br/>R&gt; a<br/>[1] 9</pre>&#13;
<p class="indent">Now, immediately highlight and execute the entire statement again. This time around, <code>a&lt;=mynumber</code> will evaluate to <code>FALSE</code> and execute the code after <code>else</code>.</p>&#13;
<pre>Condition was FALSE<br/>R&gt; a<br/>[1] 5.5</pre>&#13;
<h4 class="h4" id="ch10lev2sec89"><strong><em>10.1.3 Using ifelse for Element-wise Checks</em></strong></h4>&#13;
<p class="noindent">An <code>if</code> statement can check the condition of only a single logical value. If you pass in, for example, a vector of logicals for the condition, the <code>if</code> statement will only check (and operate based on) the very first element. It will issue a warning saying as much, as the following dummy example shows:</p>&#13;
<pre>R&gt; if(c(FALSE,TRUE,FALSE,TRUE,TRUE)){}<br/>Warning message:<br/>In if (c(FALSE, TRUE, FALSE, TRUE, TRUE)) { :<br/>  the condition has length &gt; 1 and only the first element will be used</pre>&#13;
<p class="indent">There is, however, a shortcut function available, <code>ifelse</code>, which can perform this kind of vector-oriented check in relatively simple cases. To demonstrate how it works, consider the objects <code>x</code> and <code>y</code> defined as follows:</p>&#13;
<pre>R&gt; x &lt;- 5<br/>R&gt; y &lt;- -5:5<br/>R&gt; y<br/> [1] -5 -4 -3 -2 -1 0 1 2 3 4 5</pre>&#13;
<p class="indent">Now, suppose you want to produce the result of <code>x/y</code> but with any instance of <code>Inf</code> (that is, any instance where <code>x</code> is divided by zero) replaced with <code>NA</code>. In other words, for each element in <code>y</code>, you want to check whether <code>y</code> is zero. If so, you want the code to output <code>NA</code>, and if not, it should output the result of <code>x/y</code>.</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_185"/>As you’ve just seen, a simple <code>if</code> statement won’t work here. Since it accepts only a single logical value, it can’t run through the entire logical vector produced by <code>y==0</code>.</p>&#13;
<pre>R&gt; y==0<br/> [1] FALSE FALSE FALSE FALSE FALSE  TRUE FALSE FALSE FALSE FALSE FALSE</pre>&#13;
<p class="indent">Instead, you can use the element-wise <code>ifelse</code> function for this kind of scenario.</p>&#13;
<pre>R&gt; result &lt;- ifelse(test=y==0,yes=NA,no=x/y)<br/>R&gt; result<br/> [1] -1.000000 -1.250000 -1.666667 -2.500000 -5.000000 NA 5.000000 2.500000<br/> [9]  1.666667  1.250000  1.000000</pre>&#13;
<p class="indent">Using exact matching, this command creates the desired <code>result</code> vector in one line. Three arguments must be specified: <code>test</code> takes a logical-valued data structure, <code>yes</code> provides the element to return if the condition is satisfied, and <code>no</code> gives the element to return if the condition is <code>FALSE</code>. As noted in the function documentation (which you can access with <code>?ifelse</code>), the returned structure will be of “the same length and attributes as <code>test</code>.”</p>&#13;
<div class="ex">&#13;
<p class="ext"><a id="ch10exc1"/><strong>Exercise 10.1</strong></p>&#13;
<ol type="a">&#13;
<li><p class="noindents">Create the following two vectors:</p>&#13;
<pre>vec1 &lt;- c(2,1,1,3,2,1,0)<br/>vec2 &lt;- c(3,8,2,2,0,0,0)</pre>&#13;
<p class="indent">Without executing them, determine which of the following <code>if</code> statements would result in the string being printed to the console. Then confirm your answers in R.</p>&#13;
<ol type="i">&#13;
<li><pre>if((vec1[1]+vec2[2])==10){ cat("Print me!") }</pre></li>&#13;
<li><pre>if(vec1[1]&gt;=2&amp;&amp;vec2[1]&gt;=2){ cat("Print me!") }</pre></li>&#13;
<li><pre>if(all((vec2-vec1)[c(2,6)]&lt;7)){ cat("Print me!") }</pre></li>&#13;
<li><pre>if(!is.na(vec2[3])){ cat("Print me!") }</pre></li>&#13;
</ol></li>&#13;
<li><p class="noindents">Using <code>vec1</code> and <code>vec2</code> from (a), write and execute a line of code that multiplies the corresponding elements of the two vectors together <em>if</em> their sum is greater than 3. Otherwise, the code should simply sum the two elements.</p></li>&#13;
<li><p class="noindents"><span epub:type="pagebreak" id="page_186"/>In the editor, write R code that takes a square character matrix and checks <em>if</em> any of the character strings on the diagonal (top left to bottom right) begin with the letter <em>g</em>, lowercase or uppercase. If satisfied, these specific entries should be overwritten with the string <code>"HERE"</code>. Otherwise, the entire matrix should be replaced with an identity matrix of the same dimensions. Then, try your code on the following matrices, checking the result each time:</p>&#13;
<ol type="i">&#13;
<li><pre>mymat &lt;- matrix(as.character(1:16),4,4)</pre></li>&#13;
<li><pre>mymat &lt;- matrix(c("DANDELION","Hyacinthus","Gerbera",<br/>                  "MARIGOLD","geranium","ligularia",<br/>                  "Pachysandra","SNAPDRAGON","GLADIOLUS"),3,3)</pre></li>&#13;
<li><pre>mymat &lt;- matrix(c("GREAT","exercises","right","here"),2,2,<br/>                  byrow=T)</pre></li>&#13;
</ol>&#13;
<p class="indent">Hint: This requires some thought—you will find the functions <code>diag</code> from <a href="ch03.xhtml#ch03lev2sec27">Section 3.2.1</a> and <code>substr</code> from <a href="ch04.xhtml#ch04lev2sec45">Section 4.2.4</a> useful.</p></li>&#13;
</ol>&#13;
</div>&#13;
<h4 class="h4" id="ch10lev2sec90"><strong><em>10.1.4 Nesting and Stacking Statements</em></strong></h4>&#13;
<p class="noindent">An <code>if</code> statement can itself be placed within the outcome of another <code>if</code> statement. By <em>nesting</em> or <em>stacking</em> several statements, you can weave intricate paths of decision-making by checking a number of conditions at various stages during execution.</p>&#13;
<p class="indent">In the editor, modify the <code>mynumber</code> example once more as follows:</p>&#13;
<pre>if(a&lt;=mynumber){<br/>    cat("First condition was TRUE\n")<br/>    a &lt;- a^2<br/>    if(mynumber&gt;3){<br/>        cat("Second condition was TRUE")<br/>        b &lt;- seq(1,a,length=mynumber)<br/>    } else {<br/>        cat("Second condition was FALSE")<br/>        b &lt;- a*mynumber<br/>    }<br/>} else {<br/>    cat("First condition was FALSE\n")<br/>    a &lt;- a-3.5<br/>    if(mynumber&gt;=4){<br/>        cat("Second condition was TRUE")<br/>        b &lt;- a^(3-mynumber)<br/>    } else {<br/>        cat("Second condition was FALSE")<br/>        b &lt;- rep(a+mynumber,times=3)<br/>    }<br/>}<br/>a<br/>b</pre>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_187"/>Here you see the same initial decision being made as earlier. The value <code>a</code> is squared if it’s less than or equal to <code>mynumber</code>; if not, it has 3.5 subtracted from it. But now there’s another <code>if</code> statement within each braced area. If the first condition is satisfied and <code>a</code> is squared, you then check whether <code>mynumber</code> is greater than 3. If <code>TRUE</code>, <code>b</code> is assigned <code>seq(1,a,length=mynumber)</code>. If <code>FALSE</code>, <code>b</code> is assigned <code>a*mynumber</code>.</p>&#13;
<p class="indent">If the first condition fails and you subtract 3.5 from <code>a</code>, then you check a second condition to see whether <code>mynumber</code> is greater than or equal to 4. If it is, then <code>b</code> becomes <code>a^(3-mynumber)</code>. If it’s not, <code>b</code> becomes <code>rep(a+mynumber,times=3)</code>. Note that I’ve indented the code within each subsequent braced area to make it easier to see which lines are relevant to each possible decision.</p>&#13;
<p class="indent">Now, reset <code>a &lt;- 3</code> and <code>mynumber &lt;- 4</code> either directly in the console or from the editor. When you run the <code>mynumber</code> example code, you’ll get the following output:</p>&#13;
<pre>First condition was TRUE<br/>Second condition was TRUE<br/>R&gt; a<br/>[1] 9<br/>R&gt; b<br/>[1] 1.000000 3.666667 6.333333 9.000000</pre>&#13;
<p class="indent">The result indicates exactly which code was invoked—the first condition and second condition were both <code>TRUE</code>. Trying another run of the same code, after first setting</p>&#13;
<pre>R&gt; a &lt;- 6<br/>R&gt; mynumber &lt;- 4</pre>&#13;
<p class="noindent">you see this output:</p>&#13;
<pre>First condition was FALSE<br/>Second condition was TRUE<br/>R&gt; a<br/>[1] 2.5<br/>R&gt; b<br/>[1] 0.4</pre>&#13;
<p class="indent">This time the first condition fails, but the second condition checked inside the <code>else</code> statement is <code>TRUE</code>.</p>&#13;
<p class="indent">Alternatively, you could accomplish the same thing by sequentially <em>stacking</em> <code>if</code> statements and using a combination of logical expressions in each condition. In the following example, you check for the same four situations, <span epub:type="pagebreak" id="page_188"/>but this time you stack <code>if</code> statements by placing a new <code>if</code> declaration immediately following an <code>else</code> declaration:</p>&#13;
<pre>if(a&lt;=mynumber &amp;&amp; mynumber&gt;3){<br/>    cat("Same as 'first condition TRUE and second TRUE'")<br/>    a &lt;- a^2<br/>    b &lt;- seq(1,a,length=mynumber)<br/>} else if(a&lt;=mynumber &amp;&amp; mynumber&lt;=3){<br/>    cat("Same as 'first condition TRUE and second FALSE'")<br/>    a &lt;- a^2<br/>    b &lt;- a*mynumber<br/>} else if(mynumber&gt;=4){<br/>    cat("Same as 'first condition FALSE and second TRUE'")<br/>    a &lt;- a-3.5<br/>    b &lt;- a^(3-mynumber)<br/>} else {<br/>    cat("Same as 'first condition FALSE and second FALSE'")<br/>    a &lt;- a-3.5<br/>    b &lt;- rep(a+mynumber,times=3)<br/>}<br/>a<br/>b</pre>&#13;
<p class="indent">Just as before, only one of the four braced areas will end up being executed. Comparing this to the nested version, the first two braced areas correspond to what was originally the first condition (<code>a&lt;=mynumber</code>) being satisfied, but this time you use <code>&amp;&amp;</code> to check two expressions at once. If neither of those two situations is met, this means the first condition is false, so in the third statement, you just have to check whether <code>mynumber&gt;=4</code>. For the final <code>else</code> statement, you don’t need to check any conditions because that statement will be executed only if all the previous conditions were not met.</p>&#13;
<p class="indent">If you again reset <code>a</code> and <code>mynumber</code> to 3 and 4, respectively, and execute the stacked statements shown earlier, you get the following result:</p>&#13;
<pre>Same as 'first condition TRUE and second TRUE'<br/>R&gt; a<br/>[1] 9<br/>R&gt; b<br/>[1] 1.000000 3.666667 6.333333 9.000000</pre>&#13;
<p class="indent">This produces the same values for <code>a</code> and <code>b</code> as earlier. If you execute the code again using the second set of initial values (<code>a</code> as 6 and <code>mynumber</code> as 4), you get the following:</p>&#13;
<pre>Same as 'first condition FALSE and second TRUE'<br/>R&gt; a<br/>[1] 2.5<br/>R&gt; b<br/>[1] 0.4</pre>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_189"/>This again matches the results of using the nested version of the code.</p>&#13;
<h4 class="h4" id="ch10lev2sec91"><strong><em>10.1.5 The switch Function</em></strong></h4>&#13;
<p class="noindent">Let’s say you need to choose which code to run based on the value of a single object (a common scenario). One option is to use a series of <code>if</code> statements, where you compare the object with various possible values to produce a logical value for each condition. Here’s an example:</p>&#13;
<pre>if(mystring=="Homer"){<br/>    foo &lt;- 12<br/>} else if(mystring=="Marge"){<br/>    foo &lt;- 34<br/>} else if(mystring=="Bart"){<br/>    foo &lt;- 56<br/>} else if(mystring=="Lisa"){<br/>    foo &lt;- 78<br/>} else if(mystring=="Maggie"){<br/>    foo &lt;- 90<br/>} else {<br/>    foo &lt;- NA<br/>}</pre>&#13;
<p class="indent">The goal of this code is simply to assign a numeric value to an object <code>foo</code>, where the exact number depends on the value of <code>mystring</code>. The <code>mystring</code> object can take one of the five possibilities shown, or if <code>mystring</code> doesn’t match any of these, <code>foo</code> is assigned <code>NA</code>.</p>&#13;
<p class="indent">This code works just fine as it is. For example, setting</p>&#13;
<pre>R&gt; mystring &lt;- "Lisa"</pre>&#13;
<p class="noindent">and executing the chunk, you’ll see this:</p>&#13;
<pre>R&gt; foo<br/>[1] 78</pre>&#13;
<p class="indent">Setting the following</p>&#13;
<pre>R&gt; mystring &lt;- "Peter"</pre>&#13;
<p class="noindent">and executing the chunk again, you’ll see this:</p>&#13;
<pre>R&gt; foo<br/>[1] NA</pre>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_190"/>This setup using <code>if</code>-<code>else</code> statements is quite cumbersome for such a basic operation, though. R can handle this type of multiple-choice decision in a far more compact form via the <code>switch</code> function. For example, you could rewrite the stacked <code>if</code> statements as a much shorter <code>switch</code> statement as follows:</p>&#13;
<pre>R&gt; mystring &lt;- "Lisa"<br/>R&gt; foo &lt;- switch(EXPR=mystring,Homer=12,Marge=34,Bart=56,Lisa=78,Maggie=90,NA)<br/>R&gt; foo<br/>[1] 78</pre>&#13;
<p class="noindent">and</p>&#13;
<pre>R&gt; mystring &lt;- "Peter"<br/>R&gt; foo &lt;- switch(EXPR=mystring,Homer=12,Marge=34,Bart=56,Lisa=78,Maggie=90,NA)<br/>R&gt; foo<br/>[1] NA</pre>&#13;
<p class="indent">The first argument, <code>EXPR</code>, is the object of interest and can be either a numeric or a character string. The remaining arguments provide the values or operations to carry out based on the value of <code>EXPR</code>. If <code>EXPR</code> is a string, these argument tags must <em>exactly</em> match the possible results of <code>EXPR</code>. Here, the <code>switch</code> statement evaluates to 12 if <code>mystring</code> is <code>"Homer"</code>, 34 if <code>mystring</code> is <code>"Marge"</code>, and so on. The final, untagged value, <code>NA</code>, indicates the result if <code>mystring</code> doesn’t match any of the preceding items.</p>&#13;
<p class="indent">The integer version of <code>switch</code> works in a slightly different way. Instead of using tags, the outcome is determined purely with positional matching. Consider the following example:</p>&#13;
<pre>R&gt; mynum &lt;- 3<br/>R&gt; foo &lt;- switch(mynum,12,34,56,78,NA)<br/>R&gt; foo<br/>[1] 56</pre>&#13;
<p class="indent">Here, you provide an integer <code>mynum</code> as the first argument, and it’s positionally matched to <code>EXPR</code>. The example code then shows five untagged arguments: <code>12</code> to <code>NA</code>. The <code>switch</code> function simply returns the value in the specific position requested by <code>mynum</code>. Since <code>mynum</code> is 3, the statement assigns 56 to <code>foo</code>. Had <code>mynum</code> been 1, 2, 4, or 5, <code>foo</code> would’ve been assigned 12, 34, 78, or <code>NA</code>, respectively. Any other value of <code>mynum</code> (less than 1 or greater than 5) will return <code>NULL</code>.</p>&#13;
<pre>R&gt; mynum &lt;- 0<br/>R&gt; foo &lt;- switch(mynum,12,34,56,78,NA)<br/>R&gt; foo<br/>NULL</pre>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_191"/>In these types of situations, the <code>switch</code> function behaves the same way as a set of stacked <code>if</code> statements, so it can serve as a convenient shortcut. However, if you need to examine multiple conditions at once or you need to execute a more complicated set of operations based on this decision, you’ll need to use the explicit <code>if</code> and <code>else</code> control structures.</p>&#13;
<div class="ex">&#13;
<p class="ext"><a id="ch10exc2"/><strong>Exercise 10.2</strong></p>&#13;
<ol type="a">&#13;
<li><p class="noindents">Write an explicit stacked set of <code>if</code> statements that does the same thing as the integer version of the <code>switch</code> function illustrated earlier. Test it with <code>mynum &lt;- 3</code> and <code>mynum &lt;- 0</code>, as in the text.</p></li>&#13;
<li><p class="noindents">Suppose you are tasked with computing the precise dosage amounts of a certain drug in a collection of hypothetical scientific experiments. These amounts depend upon some predetermined set of “dosage thresholds” (<code>lowdose</code>, <code>meddose</code>, and <code>highdose</code>), as well as a predetermined dose level factor vector named <code>doselevel</code>. Look at the following items (i–iv) to see the intended form of these objects. Then write a set of nested <code>if</code> statements that produce a new numeric vector called <code>dosage</code>, according to the following rules:</p>&#13;
<p class="dash">– First, <em>if</em> there are any instances of <code>"High"</code> in <code>doselevel</code>, perform the following operations:</p>&#13;
<p class="d-star">* Check <em>if</em> <code>lowdose</code> is greater than or equal to 10. If so, overwrite <code>lowdose</code> with 10; <em>otherwise</em>, overwrite <code>lowdose</code> by itself divided by 2.</p>&#13;
<p class="d-star">* Check <em>if</em> <code>meddose</code> is greater than or equal to 26. If so, overwrite <code>meddose</code> by 26.</p>&#13;
<p class="d-star">* Check <em>if</em> <code>highdose</code> is less than 60. If so, overwrite <code>highdose</code> with 60; <em>otherwise</em>, overwrite <code>highdose</code> by itself multiplied by 1.5.</p>&#13;
<p class="d-star">* Create a vector named <code>dosage</code> with the value of <code>lowdose</code> repeated (<code>rep</code>) to match the <code>length</code> of <code>doselevel</code>.</p>&#13;
<p class="d-star">* Overwrite the elements in <code>dosage</code> corresponding to the index positions of instances of <code>"Med"</code> in <code>doselevel</code> by <code>meddose</code>.</p>&#13;
<p class="d-star">* Overwrite the elements in <code>dosage</code> corresponding to the index positions of instances of <code>"High"</code> in <code>doselevel</code> by <code>highdose</code>.</p>&#13;
<p class="dash">– <em>Otherwise</em> (in other words, if there are no instances of <code>"High"</code> in <code>doselevel</code>), perform the following operations:</p>&#13;
<p class="d-star">* Create a new version of <code>doselevel</code>, a factor vector with levels <code>"Low"</code> and <code>"Med"</code> only, and label these with <code>"Small"</code> and <code>"Large"</code>, respectively (refer to <a href="ch04.xhtml#ch04lev1sec18">Section 4.3</a> for details or see <code>?factor</code>).</p>&#13;
<p class="d-star"><span epub:type="pagebreak" id="page_192"/>* Check to see <em>if</em> <code>lowdose</code> is less than 15 AND <code>meddose</code> is less than 35. If so, overwrite <code>lowdose</code> by itself multiplied by 2 and overwrite <code>meddose</code> by itself plus <code>highdose</code>.</p>&#13;
<p class="d-star">* Create a vector named <code>dosage</code>, which is the value of <code>lowdose</code> repeated (<code>rep</code>) to match the <code>length</code> of <code>doselevel</code>.</p>&#13;
<p class="d-star">* Overwrite the elements in <code>dosage</code> corresponding to the index positions of instances of <code>"Large"</code> in <code>doselevel</code> by <code>meddose</code>.</p>&#13;
<p class="dashp">Now, confirm the following:</p>&#13;
<ol type="i">&#13;
<li><p class="noindents">Given</p>&#13;
<pre>lowdose &lt;- 12.5<br/>meddose &lt;- 25.3<br/>highdose &lt;- 58.1<br/>doselevel &lt;- factor(c("Low","High","High","High","Low","Med",<br/>                      "Med"),levels=c("Low","Med","High"))</pre>&#13;
<p class="noindent">the result of <code>dosage</code> after running the nested <code>if</code> statements is as follows:</p>&#13;
<pre>R&gt; dosage<br/>[1] 10.0 60.0 60.0 60.0 10.0 25.3 25.3</pre></li>&#13;
<li><p class="noindents">Using the same <code>lowdose</code>, <code>meddose</code>, and <code>highdose</code> thresholds as in (i), given</p>&#13;
<pre>doselevel &lt;- factor(c("Low","Low","Low","Med","Low","Med",<br/>                      "Med"),levels=c("Low","Med","High"))</pre>&#13;
<p class="noindent">the result of <code>dosage</code> after running the nested <code>if</code> statements is as follows:</p>&#13;
<pre>R&gt; dosage<br/>[1] 25.0 25.0 25.0 83.4 25.0 83.4 83.4</pre>&#13;
<p class="indent">Also, <code>doselevel</code> has been overwritten as follows:</p>&#13;
<pre>R&gt; doselevel<br/>[1] Small Small Small Large Small Large Large<br/>Levels: Small Large</pre></li>&#13;
<li><p class="noindents">Given</p>&#13;
<pre>lowdose &lt;- 9<br/>meddose &lt;- 49<br/>highdose &lt;- 61<br/>doselevel &lt;- factor(c("Low","Med","Med"),<br/>                    levels=c("Low","Med","High"))</pre>&#13;
<p class="noindent"><span epub:type="pagebreak" id="page_193"/>the result of <code>dosage</code> after running the nested <code>if</code> statements is as follows:</p>&#13;
<pre>R&gt; dosage<br/>[1] 9 49 49</pre>&#13;
<p class="indent">Also, <code>doselevel</code> has been overwritten as follows:</p>&#13;
<pre>R&gt; doselevel<br/>[1] Small Large Large<br/>Levels: Small Large</pre></li>&#13;
<li><p class="noindents">Using the same <code>lowdose</code>, <code>meddose</code>, and <code>highdose</code> thresholds as (iii), as well as the same <code>doselevel</code> as (i), the result of <code>dosage</code> after running the nested <code>if</code> statements is as follows:</p>&#13;
<pre>R&gt; dosage<br/>[1] 4.5 91.5 91.5 91.5 4.5 26.0 26.0</pre></li>&#13;
</ol></li>&#13;
<li><p class="noindents">Assume the object <code>mynum</code> will only ever be a single integer between 0 and 9. Use <code>ifelse</code> and <code>switch</code> to produce a command that takes in <code>mynum</code> and returns a matching character string for all possible values 0, 1, ..., 9. Supplied with <code>3</code>, for example, it should return <code>"three"</code>; supplied with <code>0</code>, it should return <code>"zero"</code>.</p></li>&#13;
</ol>&#13;
</div>&#13;
<h3 class="h3" id="ch10lev1sec34"><strong>10.2 Coding Loops</strong></h3>&#13;
<p class="noindent">Another core programming mechanism is the <em>loop</em>, which repeats a specified section of code, often while incrementing an index or counter. There are two styles of looping: the <code>for</code> loop repeats code as it works its way through a vector, element by element; the <code>while</code> loop simply repeats code until a specific condition evaluates to <code>FALSE</code>. Looplike behavior can also be achieved with R’s suite of <code>apply</code> functions, which are discussed in <a href="ch10.xhtml#ch10lev2sec94">Section 10.2.3</a>.</p>&#13;
<h4 class="h4" id="ch10lev2sec92"><strong><em>10.2.1 for Loops</em></strong></h4>&#13;
<p class="noindent">The R <code>for</code> loop always takes the following general form:</p>&#13;
<pre>for(<span class="codeitalic">loopindex</span> in <span class="codeitalic">loopvector</span>){<br/>    <span class="codeitalic">do any code in here</span><br/>}</pre>&#13;
<p class="indent">Here, the <code><span class="codeitalic">loopindex</code></span> is a placeholder that represents an element in the <code><span class="codeitalic">loopvector</code></span>—it starts off as the first element in the vector and moves to the next element with each loop repetition. When the <code>for</code> loop begins, it runs the code in the braced area, replacing any occurrence of the <code><span class="codeitalic">loopindex</code></span> with the first element of the <code><span class="codeitalic">loopvector</code></span>. When the loop reaches the closing <span epub:type="pagebreak" id="page_194"/>brace, the <code><span class="codeitalic">loopindex</code></span> is incremented, taking on the second element of the <code><span class="codeitalic">loopvector</code></span>, and the braced area is repeated. This continues until the loop reaches the final element of the <code><span class="codeitalic">loopvector</code></span>, at which point the braced code is executed for the final time, and the loop exits.</p>&#13;
<p class="indent">Here’s a simple example written in the editor:</p>&#13;
<pre>for(myitem in 5:7){<br/>    cat("--BRACED AREA BEGINS--\n")<br/>    cat("the current item is",myitem,"\n")<br/>    cat("--BRACED AREA ENDS--\n\n")<br/>}</pre>&#13;
<p class="indent">This loop prints the current value of the <code><span class="codeitalic">loopindex</code></span> (which I’ve named <code>myitem</code> here) as it increments from 5 to 7. Here’s the output after sending to the console:</p>&#13;
<pre>--BRACED AREA BEGINS--<br/>the current item is 5<br/>--BRACED AREA ENDS--<br/><br/>--BRACED AREA BEGINS--<br/>the current item is 6<br/>--BRACED AREA ENDS--<br/><br/>--BRACED AREA BEGINS--<br/>the current item is 7<br/>--BRACED AREA ENDS--</pre>&#13;
<p class="indent">You can use loops to manipulate objects that exist outside the loop. Consider the following example:</p>&#13;
<pre>R&gt; counter &lt;- 0<br/>R&gt; for(myitem in 5:7){<br/>+   counter &lt;- counter+1<br/>+   cat("The item in run",counter,"is",myitem,"\n")<br/>+ }<br/>The item in run 1 is 5<br/>The item in run 2 is 6<br/>The item in run 3 is 7</pre>&#13;
<p class="indent">Here, I’ve initially defined an object, <code>counter</code>, and set it to zero in the workspace. Then, inside the loop, <code>counter</code> is overwritten by itself plus 1. Each time the loop repeats, <code>counter</code> increases, and the current value is printed to the console.</p>&#13;
<h5 class="h5" id="ch10lev3sec23"><strong>Looping via Index or Value</strong></h5>&#13;
<p class="noindent">Note the difference between using the <code><span class="codeitalic">loopindex</code></span> to directly represent elements in the <code><span class="codeitalic">loopvector</code></span> and using it to represent <em>indexes</em> of a vector. The <span epub:type="pagebreak" id="page_195"/>following two loops use these two different approaches to <code>print</code> double each number in <code>myvec</code>:</p>&#13;
<pre>R&gt; myvec &lt;- c(0.4,1.1,0.34,0.55)<br/>R&gt; for(i in myvec){<br/>+   print(2*i)<br/>+ }<br/>[1] 0.8<br/>[1] 2.2<br/>[1] 0.68<br/>[1] 1.1<br/>R&gt; for(i in 1:length(myvec)){<br/>+   print(2*myvec[i])<br/>+ }<br/>[1] 0.8<br/>[1] 2.2<br/>[1] 0.68<br/>[1] 1.1</pre>&#13;
<p class="indent">The first loop uses the <code><span class="codeitalic">loopindex</code> i</span> to directly represent the elements in <code>myvec</code>, printing the value of each element times 2. In the second loop, on the other hand, you use <code>i</code> to represent integers in the sequence <code>1:length(myvec)</code>. These integers form all the possible index positions of <code>myvec</code>, and you use these indexes to extract <code>myvec</code>’s elements (once again multiplying each element by 2 and printing the result). Though it takes a slightly longer form, using vector index positions provides more flexibility in terms of how you can use the <code><span class="codeitalic">loopindex</code></span>. This will become clearer when your needs demand more complicated <code>for</code> loops, such as in the next example.</p>&#13;
<p class="indent">Suppose you want to write some code that will inspect any list object and gather information about any matrix objects stored as members in the list. Consider the following list:</p>&#13;
<pre>R&gt; foo &lt;- list(aa=c(3.4,1),bb=matrix(1:4,2,2),cc=matrix(c(T,T,F,T,F,F),3,2),<br/>               dd="string here",ee=matrix(c("red","green","blue","yellow")))<br/>R&gt; foo<br/>$aa<br/>[1] 3.4 1.0<br/><br/>$bb<br/>     [,1] [,2]<br/>[1,]    1    3<br/>[2,]    2    4<br/><br/>$cc<br/>      [,1]  [,2]<br/>[1,]  TRUE  TRUE<br/>[2,]  TRUE FALSE<br/>[3,] FALSE FALSE<br/><br/>$dd<br/>[1] "string here"<br/><br/>$ee<br/>     [,1]<br/>[1,] "red"<br/>[2,] "green"<br/>[3,] "blue"<br/>[4,] "yellow"</pre>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_196"/>Here you’ve created <code>foo</code>, which contains three matrices of varying dimensions and data types. You’ll write a <code>for</code> loop that goes through each member of a list like this one and checks whether the member is a matrix. If it is, the loop will retrieve the number of rows and columns and the data type of the matrix.</p>&#13;
<p class="indent">Before you write the <code>for</code> loop, you should create some vectors that will store information about the list members: <code>name</code> for the list member names, <code>is.mat</code> to indicate whether each member is a matrix (with <code>"Yes"</code> or <code>"No"</code>), <code>nc</code> and <code>nr</code> to store the number of rows and columns for each matrix, and <code>data.type</code> to store the data type of each matrix.</p>&#13;
<pre>R&gt; name &lt;- names(foo)<br/>R&gt; name<br/>[1] "aa" "bb" "cc" "dd" "ee"<br/>R&gt; is.mat &lt;- rep(NA,length(foo))<br/>R&gt; is.mat<br/>[1] NA NA NA NA NA<br/>R&gt; nr &lt;- is.mat<br/>R&gt; nc &lt;- is.mat<br/>R&gt; data.type &lt;- is.mat</pre>&#13;
<p class="indent">Here, you store the names of the members of <code>foo</code> as <code>name</code>. You also set up <code>is.mat</code>, <code>nr</code>, <code>nc</code>, and <code>data.type</code>, which are all assigned vectors of length <code>length(foo)</code> filled with <code>NA</code>s. These values will be updated as appropriate by your <code>for</code> loop, which you’re now ready to write. Enter the following code in the editor:</p>&#13;
<pre>for(i in 1:length(foo)){<br/>    member &lt;- foo[[i]]<br/>    if(is.matrix(member)){<br/>        is.mat[i] &lt;- "Yes"<br/>        nr[i] &lt;- nrow(member)<br/>        nc[i] &lt;- ncol(member)<br/>        data.type[i] &lt;- class(as.vector(member))<br/>    } else {<br/>        is.mat[i] &lt;- "No"<br/>    }<br/>}<br/>bar &lt;- data.frame(name,is.mat,nr,nc,data.type,stringsAsFactors=FALSE)</pre>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_197"/>Initially, set up the <code><span class="codeitalic">loopindex</code> i</span> so that it will increment through the index positions of <code>foo</code> (the sequence <code>1:length(foo)</code>). In the braced code, the first command is to write the member of <code>foo</code> at position <code>i</code> to an object <code>member</code>. Next, you can check whether that member is a matrix using <code>is.matrix</code> (refer to <a href="ch06.xhtml#ch06lev2sec61">Section 6.2.3</a>). If <code>TRUE</code>, you do the following: the <code>i</code>th position of <code>is.mat</code> vector is set as <code>"Yes"</code>; the <code>i</code>th element of <code>nr</code> and <code>nc</code> is set as the number of rows and number of columns of <code>member</code>, respectively; and the <code>i</code>th element of <code>data.type</code> is set as the result of <code>class(as.vector(member))</code>. This final command first coerces the matrix into a vector with <code>as.vector</code> and then uses the <code>class</code> function (covered in <a href="ch06.xhtml#ch06lev2sec60">Section 6.2.2</a>) to find the data type of the elements.</p>&#13;
<p class="indent">If <code>member</code> isn’t a matrix and the <code>if</code> condition fails, the corresponding entry in <code>is.mat</code> is set to <code>"No"</code>, and the entries in the other vectors aren’t changed (so they will remain <code>NA</code>).</p>&#13;
<p class="indent">After the loop is run, a data frame <code>bar</code> is created from the vectors (note the use of <code>stringsAsFactors=FALSE</code> in order to prevent the character string vectors in <code>bar</code> being automatically converted to factors; see <a href="ch05.xhtml#ch05lev2sec52">Section 5.2.1</a>). After executing the code, <code>bar</code> looks like this:</p>&#13;
<pre>R&gt; bar<br/>  name is.mat nr nc data.type<br/>1   aa     No NA NA      &lt;NA&gt;<br/>2   bb    Yes  2  2   integer<br/>3   cc    Yes  3  2   logical<br/>4   dd     No NA NA      &lt;NA&gt;<br/>5   ee    Yes  4  1 character</pre>&#13;
<p class="indent">As you can see, this matches the nature of the matrices present in the list <code>foo</code>.</p>&#13;
<h5 class="h5" id="ch10lev3sec24"><strong>Nesting for Loops</strong></h5>&#13;
<p class="noindent">You can also nest <code>for</code> loops, just like <code>if</code> statements. When a <code>for</code> loop is nested in another <code>for</code> loop, the inner loop is executed in full before the outer loop <code><span class="codeitalic">loopindex</code></span> is incremented, at which point the inner loop is executed all over again. Create the following objects in your R console:</p>&#13;
<pre>R&gt; loopvec1 &lt;- 5:7<br/>R&gt; loopvec1<br/>[1] 5 6 7<br/>R&gt; loopvec2 &lt;- 9:6<br/>R&gt; loopvec2<br/>[1] 9 8 7 6<br/>R&gt; foo &lt;- matrix(NA,length(loopvec1),length(loopvec2))<br/>R&gt; foo<br/>     [,1] [,2] [,3] [,4]<br/>[1,]   NA   NA   NA   NA<br/>[2,]   NA   NA   NA   NA<br/>[3,]   NA   NA   NA   NA</pre>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_198"/>The following nested loop fills <code>foo</code> with the result of multiplying each integer in <code>loopvec1</code> by each integer in <code>loopvec2</code>:</p>&#13;
<pre>R&gt; for(i in 1:length(loopvec1)){<br/>+   for(j in 1:length(loopvec2)){<br/>+       foo[i,j] &lt;- loopvec1[i]*loopvec2[j]<br/>+   }<br/>+ }<br/>R&gt; foo<br/>     [,1] [,2] [,3] [,4]<br/>[1,]   45   40   35   30<br/>[2,]   54   48   42   36<br/>[3,]   63   56   49   42</pre>&#13;
<p class="indent">Note that nested loops require a unique <code><span class="codeitalic">loopindex</code></span> for each use of <code>for</code>. In this case, the <code><span class="codeitalic">loopindex</code></span> is <code>i</code> for the outer loop and <code>j</code> for the inner loop. When the code is executed, <code>i</code> is first assigned <code>1</code>, the inner loop begins, and then <code>j</code> is also assigned <code>1</code>. The only command in the inner loop is to take the product of the <code>i</code>th element of <code>loopvec1</code> and the <code>j</code>th element of <code>loopvec2</code> and assign it to row <code>i</code>, column <code>j</code> of <code>foo</code>. The inner loop repeats until <code>j</code> reaches <code>length(loopvec2)</code> and fills the first row of <code>foo</code>; then <code>i</code> increments, and the inner loop is started up again. The entire procedure is complete after <code>i</code> reaches <code>length(loopvec1)</code> and the matrix is filled.</p>&#13;
<p class="indent">Inner <code><span class="codeitalic">loopvector</code></span>s can even be defined to match the current value of the <code><span class="codeitalic">loopindex</code></span> of the outer loop. Using <code>loopvec1</code> and <code>loopvec2</code> from earlier, here’s an example:</p>&#13;
<pre>R&gt; foo &lt;- matrix(NA,length(loopvec1),length(loopvec2))<br/>R&gt; foo<br/>     [,1] [,2] [,3] [,4]<br/>[1,]   NA   NA   NA   NA<br/>[2,]   NA   NA   NA   NA<br/>[3,]   NA   NA   NA   NA<br/>R&gt; for(i in 1:length(loopvec1)){<br/>+   for(j in 1:i){<br/>+       foo[i,j] &lt;- loopvec1[i]+loopvec2[j]<br/>+   }<br/>+ }<br/>R&gt; foo<br/>     [,1] [,2] [,3] [,4]<br/>[1,]   14   NA   NA   NA<br/>[2,]   15   14   NA   NA<br/>[3,]   16   15   14   NA</pre>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_199"/>Here, the <code>i</code>th row, <code>j</code>th column element of <code>foo</code> is filled with the sum of <code>loopvec1[i]</code> and <code>loopvec2[j]</code>. However, the inner loop values for <code>j</code> are now decided based on the value of <code>i</code>. For example, when <code>i</code> is <code>1</code>, the inner <code><span class="codeitalic">loopvector</code></span> is <code>1:1</code>, so the inner loop executes only once before returning to the outer loop. With <code>i</code> as <code>2</code>, the inner <code><span class="codeitalic">loopvector</code></span> is then <code>1:2</code>, and so on. This makes it so each row of <code>foo</code> is only partially filled. Extra care must be taken when programming loops this way. Here, for example, the values for <code>j</code> depend on the length of <code>loopvec1</code>, so an error will occur if <code>length(loopvec1)</code> is greater than <code>length(loopvec2)</code>.</p>&#13;
<p class="indent">Any number of <code>for</code> loops can be nested, but the computational expense can become a problem if nested loops are used unwisely. Loops in general add some computational cost, so to produce more efficient code in R, you should always ask “Can I do this in a vector-oriented fashion?” Only when the individual operations are not possible or straightforward to achieve en masse should you explore an iterative, looped approach. You can find some relevant and valuable comments on R loops and associated best-practice coding in the “R Help Desk” article by Ligges and Fox (<a href="ref.xhtml#ref41">2008</a>).</p>&#13;
<div class="ex">&#13;
<p class="ext"><a id="ch10exc3"/><strong>Exercise 10.3</strong></p>&#13;
<ol type="a">&#13;
<li><p class="noindents">In the interests of efficient coding, rewrite the nested loop example from this section, where the matrix <code>foo</code> was filled with the multiples of the elements of <code>loopvec1</code> and <code>loopvec2</code>, using only a single <code>for</code> loop.</p></li>&#13;
<li><p class="noindents">In <a href="ch10.xhtml#ch10lev2sec91">Section 10.1.5</a>, you used the command</p>&#13;
<pre>switch(EXPR=mystring,Homer=12,Marge=34,Bart=56,Lisa=78,Maggie=90,<br/>       NA)</pre>&#13;
<p class="noindent">to return a number based on the supplied value of a single character string. This line won’t work if <code>mystring</code> is a character vector. Write some code that will take a character vector and return a vector of the appropriate numeric values. Test it on the following vector:</p>&#13;
<pre>c("Peter","Homer","Lois","Stewie","Maggie","Bart")</pre></li>&#13;
<li><p class="noindents">Suppose you have a list named <code>mylist</code> that can contain other lists as members, but assume those “member lists” cannot themselves contain lists. Write nested loops that can search any possible <code>mylist</code> defined in this way and count how many matrices are present. Hint: Simply set up a counter before commencing the loops that is incremented each time a matrix is found, regardless <span epub:type="pagebreak" id="page_200"/>of whether it is a straightforward member of <code>mylist</code> or it is a member of a member list of <code>mylist</code>.</p>&#13;
<p class="indent">Then confirm the following:</p>&#13;
<ol type="i">&#13;
<li><p class="noindents">That the answer is 4 if you have the following:</p>&#13;
<pre>mylist &lt;- list(aa=c(3.4,1),bb=matrix(1:4,2,2),<br/>               cc=matrix(c(T,T,F,T,F,F),3,2),dd="string here",<br/>               ee=list(c("hello","you"),matrix(c("hello",<br/>                                                 "there"))),<br/>               ff=matrix(c("red","green","blue","yellow")))</pre></li>&#13;
<li><p class="noindents">That the answer is 0 if you have the following:</p>&#13;
<pre>mylist &lt;- list("tricked you",as.vector(matrix(1:6,3,2)))</pre></li>&#13;
<li><p class="noindents">That the answer is 2 if you have the following:</p>&#13;
<pre>mylist &lt;- list(list(1,2,3),list(c(3,2),2),<br/>               list(c(1,2),matrix(c(1,2))),<br/>               rbind(1:10,100:91))</pre></li>&#13;
</ol></li>&#13;
</ol>&#13;
</div>&#13;
<h4 class="h4" id="ch10lev2sec93"><strong><em>10.2.2 while Loops</em></strong></h4>&#13;
<p class="noindent">To use <code>for</code> loops, you must know, or be able to easily calculate, the number of times the loop should repeat. In situations where you don’t know how many times the desired operations need to be run, you can turn to the <code>while</code> loop. A <code>while</code> loop runs and repeats while a specified condition returns <code>TRUE</code>, and takes the following general form:</p>&#13;
<pre>while(<span class="codeitalic">loopcondition</span>){<br/>    <span class="codeitalic">do any code in here</span><br/>}</pre>&#13;
<p class="indent">A <code>while</code> loop uses a single logical-valued <code><span class="codeitalic">loopcondition</code></span> to control how many times it repeats. Upon execution, the <code><span class="codeitalic">loopcondition</code></span> is evaluated. If the condition is found to be <code>TRUE</code>, the braced area code is executed line by line as usual until complete, at which point the <code><span class="codeitalic">loopcondition</code></span> is checked again. The loop terminates only when the condition evaluates to <code>FALSE</code>, and it does so immediately—the braced code is <em>not</em> run one last time.</p>&#13;
<p class="indent">This means the operations carried out in the braced area must somehow cause the loop to exit, either by affecting the <code><span class="codeitalic">loopcondition</code></span> somehow or by declaring <code>break</code>, which you’ll see a little later. If not, the loop will keep repeating forever, creating an <em>infinite loop</em>, which will freeze the console (and, depending on the operations specified inside the braced area, R can crash because of memory constraints). If that occurs, you can terminate the loop in the R user interface by clicking the Stop button in the top menu or by pressing <small>ESC</small>.</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_201"/>As a simple example of a <code>while</code> loop, consider the following code:</p>&#13;
<pre>myval &lt;- 5<br/>while(myval&lt;10){<br/>    myval &lt;- myval+1<br/>    cat("\n'myval' is now",myval,"\n")<br/>    cat("'mycondition' is now",myval&lt;10,"\n")<br/>}</pre>&#13;
<p class="indent">Here, you set a new object <code>myval</code> to <code>5</code>. Then you start a <code>while</code> loop with the condition <code>myval&lt;10</code>. Since this is <code>TRUE</code> to begin with, you enter the braced area. Inside the loop you increment <code>myval</code> by 1, print its current value, and print the logical value of the condition <code>myval&lt;5</code>. The loop continues until the condition <code>myval&lt;10</code> is <code>FALSE</code> at the next evaluation. Execute the code chunk, and you see the following:</p>&#13;
<pre>'myval' is now 6<br/>'mycondition' is now TRUE<br/><br/>'myval' is now 7<br/>'mycondition' is now TRUE<br/><br/>'myval' is now 8<br/>'mycondition' is now TRUE<br/><br/>'myval' is now 9<br/>'mycondition' is now TRUE<br/><br/>'myval' is now 10<br/>'mycondition' is now FALSE</pre>&#13;
<p class="indent">As expected, the loop repeats until <code>myval</code> is set to <code>10</code>, at which point <code>myval&lt;10</code> returns <code>FALSE</code>, causing the loop to exit because the initial condition is no longer <code>TRUE</code>.</p>&#13;
<p class="indent">In more complicated settings, it’s often useful to set the <code><span class="codeitalic">loopcondition</code></span> to be a separate object so that you can modify it as necessary within the braced area. For the next example, you’ll use a <code>while</code> loop to iterate through an integer vector and create an identity matrix (see <a href="ch03.xhtml#ch03lev2sec30">Section 3.3.2</a>) with the dimension matching the current integer. This loop should stop when it reaches a number in the vector that’s greater than 5 or when it reaches the end of the integer vector.</p>&#13;
<p class="indent">In the editor, define some initial objects, followed by the loop itself.</p>&#13;
<pre>mylist &lt;- list()<br/>counter &lt;- 1<br/>mynumbers &lt;- c(4,5,1,2,6,2,4,6,6,2)<br/>mycondition &lt;- mynumbers[counter]&lt;=5<br/>while(mycondition){<br/>    mylist[[counter]] &lt;- diag(mynumbers[counter])<br/>    counter &lt;- counter+1<br/>    if(counter&lt;=length(mynumbers)){<br/>        mycondition &lt;- mynumbers[counter]&lt;=5<br/>    } else {<br/>        mycondition &lt;- FALSE<br/>    }<br/>}</pre>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_202"/>The first object, <code>mylist</code>, will store all the matrices that the loop creates. You’ll use the vector <code>mynumbers</code> to provide the matrix sizes, and you’ll use <code>counter</code> and <code>mycondition</code> to control the loop.</p>&#13;
<p class="indent">The <code><span class="codeitalic">loopcondition</code></span>, <code>mycondition</code>, is initially set to <code>TRUE</code> since the first element of <code>mynumbers</code> is less than or equal to 5. Inside the loop beginning at <code>while</code>, the first line uses double square brackets and the value of <code>counter</code> to dynamically create a new entry at that position in <code>mylist</code> (you did this earlier with named lists in <a href="ch05.xhtml#ch05lev2sec51">Section 5.1.3</a>). This entry is assigned an identity matrix whose size matches the corresponding element of <code>mynumbers</code>. Next, the <code>counter</code> is incremented, and now you have to update <code>mycondition</code>. Here you want to check whether <code>mynumbers[counter]&lt;=5</code>, but you also need to check whether you’ve reached the end of the integer vector (otherwise, you can end up with an error by trying to retrieve an index position outside the range of <code>mynumbers</code>). So, you can use an <code>if</code> statement to first check the condition <code>counter&lt;=length(mynumbers)</code>. If <code>TRUE</code>, then set <code>mycondition</code> to the outcome of <code>mynumbers[counter]&lt;=5</code>. If not, this means you’ve reached the end of <code>mynumbers</code>, so you make sure the loop exits by setting <code>mycondition &lt;- FALSE</code>.</p>&#13;
<p class="indent">Execute the loop with those predefined objects, and it will produce the <code>mylist</code> object shown here:</p>&#13;
<pre>R&gt; mylist<br/>[[1]]<br/>     [,1] [,2] [,3] [,4]<br/>[1,]    1    0    0    0<br/>[2,]    0    1    0    0<br/>[3,]    0    0    1    0<br/>[4,]    0    0    0    1<br/><br/>[[2]]<br/>     [,1] [,2] [,3] [,4] [,5]<br/>[1,]    1    0    0    0    0<br/>[2,]    0    1    0    0    0<br/>[3,]    0    0    1    0    0<br/>[4,]    0    0    0    1    0<br/>[5,]    0    0    0    0    1<br/><br/>[[3]]<br/>     [,1]<br/>[1,]    1<br/>[[4]]<br/>     [,1] [,2]<br/>[1,]    1    0<br/>[2,]    0    1</pre>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_203"/>As expected, you have a list with four members—identity matrices of size 4 × 4, 5 × 5, 1 × 1, and 2 × 2—matching the first four elements of <code>mynumbers</code>. The loop stopped executing when it reached the fifth element of <code>mynumbers</code>(<code>6</code>) since that’s greater than 5.</p>&#13;
<div class="ex">&#13;
<p class="ext"><a id="ch10exc4"/><strong>Exercise 10.4</strong></p>&#13;
<ol type="a">&#13;
<li><p class="noindents">Based on the most recent example of storing identity matrices in a list, determine what the resulting <code>mylist</code> would look like for each of the following possible <code>mynumbers</code> vectors, without executing anything:</p>&#13;
<ol type="i">&#13;
<li><p class="noindents"><code>mynumbers &lt;- c(2,2,2,2,5,2)</code></p></li>&#13;
<li><p class="noindents"><code>mynumbers &lt;- 2:20</code></p></li>&#13;
<li><p class="noindents"><code>mynumbers &lt;- c(10,1,10,1,2)</code></p></li>&#13;
</ol>&#13;
<p class="indent">Then, confirm your answers in R (note you’ll also have to reset the initial values of <code>mylist</code>, <code>counter</code>, and <code>mycondition</code> each time, just as in the text).</p></li>&#13;
<li><p class="noindents">For this problem, I’ll introduce the <em>factorial</em> operator. The factorial of a non-negative integer <em>x</em>, expressed as <em>x</em>!, refers to <em>x</em> multiplied by the product of all integers less than <em>x</em>, down to 1. Formally, it is written like this:</p>&#13;
<p class="center">“<em>x</em> factorial” = <em>x</em>! = <em>x</em> × (<em>x</em> − 1) × (<em>x</em> − 2) × ... × 1</p>&#13;
<p class="indent">Note that there is a special case of <em>zero factorial</em>, which is always 1. That is:</p>&#13;
<p class="center">0! = 1</p>&#13;
<p class="indent">For example, to work out 3 factorial, you compute the following:</p>&#13;
<p class="center">3 × 2 × 1 = 6</p>&#13;
<p class="indent">To work out 7 factorial, you compute the following:</p>&#13;
<p class="center">7 × 6 × 5 × 4 × 3 × 2 × 1 = 5040</p>&#13;
<p class="indent">Write a <code>while</code> loop that computes and stores as a new object the factorial of any non-negative integer <code>mynum</code> by decrementing <code>mynum</code> by <code>1</code> at each repetition of the braced code.</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_204"/>Using your loop, confirm the following:</p>&#13;
<ol type="i">&#13;
<li><p class="noindents">That the result of using <code>mynum &lt;- 5</code> is <code>120</code></p></li>&#13;
<li><p class="noindents">That using <code>mynum &lt;- 12</code> yields <code>479001600</code></p></li>&#13;
<li><p class="noindents">That having <code>mynum &lt;- 0</code> correctly returns <code>1</code></p></li>&#13;
</ol></li>&#13;
<li><p class="noindents">Consider the following code, where the operations in the braced area of the <code>while</code> loop have been omitted:</p>&#13;
<pre>mystring &lt;- "R fever"<br/>index &lt;- 1<br/>ecount &lt;- 0<br/>result &lt;- mystring<br/>while(ecount&lt;2 &amp;&amp; index&lt;=nchar(mystring)){<br/>    # several omitted operations #<br/>}<br/>result</pre>&#13;
<p class="indent">Your task is to complete the code in the braced area so it inspects <code>mystring</code> character by character until it reaches the second instance of the letter <em>e</em> or the end of the string, whichever comes first. The <code>result</code> object should be the entire character string if there is no second <em>e</em> or the character string made up of all the characters up to, but not including, the second <em>e</em> if there is one. For example, <code>mystring &lt;- "R fever"</code> should provide <code>result</code> as <code>"R fev"</code>. This must be achieved by following these operations in the braces:</p>&#13;
<ol>&#13;
<li><p class="noindents">Use <code>substr</code> (<a href="ch04.xhtml#ch04lev2sec45">Section 4.2.4</a>) to extract the single character of <code>mystring</code> at position <code>index</code>.</p></li>&#13;
<li><p class="noindents">Use a check for equality to determine whether this single-character string is either <code>"e"</code> OR <code>"E"</code>. If so, increase <code>ecount</code> by <code>1</code>.</p></li>&#13;
<li><p class="noindents">Next, perform a separate check to see whether <code>ecount</code> is equal to <code>2</code>. If so, use <code>substr</code> to set <code>result</code> equal to the characters between <code>1</code> and <code>index-1</code> inclusive.</p></li>&#13;
<li><p class="noindents">Increment <code>index</code> by <code>1</code>.</p></li>&#13;
</ol>&#13;
<p class="indent">Test your code—ensure the previous <code>result</code> for <code>mystring &lt;- "R fever"</code>. Furthermore, confirm the following:</p>&#13;
<p class="dash">– Using <code>mystring &lt;- "beautiful"</code> provides <code>result</code> as <code>"beautiful"</code></p>&#13;
<p class="dash">– Using <code>mystring &lt;- "ECCENTRIC"</code> provides <code>result</code> as <code>"ECC"</code></p>&#13;
<p class="dash">– Using <code>mystring &lt;- "ElAbOrAte"</code> provides <code>result</code> as <code>"ElAbOrAt"</code></p>&#13;
<p class="dash">– Using <code>mystring &lt;- "eeeeek!"</code> provides <code>result</code> as <code>"e"</code></p></li>&#13;
</ol>&#13;
</div>&#13;
<h4 class="h4" id="ch10lev2sec94"><strong><em>10.2.3 Implicit Looping with apply</em></strong></h4>&#13;
<p class="noindent">In some situations, especially for relatively routine <code>for</code> loops (such as executing some function on each member of a list), you can avoid some of the details associated with explicit looping by using the <code>apply</code> function. The <code>apply</code> <span epub:type="pagebreak" id="page_205"/>function is the most basic form of implicit looping—it takes a function and applies it to each <em>margin</em> of an array.</p>&#13;
<p class="indent">For a simple illustrative example, let’s say you have the following matrix:</p>&#13;
<pre>R&gt; foo &lt;- matrix(1:12,4,3)<br/>R&gt; foo<br/>     [,1] [,2] [,3]<br/>[1,]    1    5    9<br/>[2,]    2    6   10<br/>[3,]    3    7   11<br/>[4,]    4    8   12</pre>&#13;
<p class="indent">Say you want to find the sum of each row. If you call the following, you just get the grand total of all elements, which is not what you want.</p>&#13;
<pre>R&gt; sum(foo)<br/>[1] 78</pre>&#13;
<p class="indent">Instead, you could use a <code>for</code> loop like this one:</p>&#13;
<pre>R&gt; row.totals &lt;- rep(NA,times=nrow(foo))<br/>R&gt; for(i in 1:nrow(foo)){<br/>+   row.totals[i] &lt;- sum(foo[i,])<br/>+ }<br/>R&gt; row.totals<br/>[1] 15 18 21 24</pre>&#13;
<p class="indent">This cycles through each row and stores the sum in <code>row.totals</code>. But you can use <code>apply</code> to get the same result in a more compact form. To call <code>apply</code>, you have to specify at least three arguments. The first argument, <code>X</code>, is the object you want to cycle through. The next argument, <code>MARGIN</code>, takes an integer that flags which margin of <code>X</code> to operate on (rows, columns, etc.). Finally, <code>FUN</code> provides the function you want to perform on each margin. With the following call, you get the same result as the earlier <code>for</code> loop.</p>&#13;
<pre>R&gt; row.totals2 &lt;- apply(X=foo,MARGIN=1,FUN=sum)<br/>R&gt; row.totals2<br/>[1] 15 18 21 24</pre>&#13;
<p class="indent">The <code>MARGIN</code> index follows the positional order of the dimension for matrices and arrays, as discussed in <a href="ch03.xhtml#ch03">Chapter 3</a>—<code>1</code> always refers to rows, <code>2</code> to columns, <code>3</code> to layers, <code>4</code> to blocks, and so on. To instruct R to sum each column of <code>foo</code> instead, simply change the <code>MARGIN</code> argument to <code>2</code>.</p>&#13;
<pre>R&gt; apply(X=foo,MARGIN=2,FUN=sum)<br/>[1] 10 26 42</pre>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_206"/>The operations supplied to <code>FUN</code> should be appropriate for the <code>MARGIN</code> selected. So, if you select rows or columns with <code>MARGIN=1</code> or <code>MARGIN=2</code>, make sure the <code>FUN</code> function is appropriate for vectors. Or if you have a three-dimensional array and use <code>apply</code> with <code>MARGIN=3</code>, be sure to set <code>FUN</code> to a function appropriate for matrices. Here’s an example for you to enter:</p>&#13;
<pre>R&gt; bar &lt;- array(1:18,dim=c(3,3,2))<br/>R&gt; bar<br/>, , 1<br/><br/>     [,1] [,2] [,3]<br/>[1,]    1    4    7<br/>[2,]    2    5    8<br/>[3,]    3    6    9<br/><br/>, , 2<br/><br/>     [,1] [,2] [,3]<br/>[1,]   10   13   16<br/>[2,]   11   14   17<br/>[3,]   12   15   18</pre>&#13;
<p class="indent">Then, make the following call:</p>&#13;
<pre>R&gt; apply(bar,3,FUN=diag)<br/>     [,1] [,2]<br/>[1,]    1   10<br/>[2,]    5   14<br/>[3,]    9   18</pre>&#13;
<p class="indent">This extracts the diagonal elements of each of the matrix layers of <code>bar</code>. Each call to <code>diag</code> on a matrix returns a vector, and these vectors are returned as columns of a new matrix. The <code>FUN</code> argument can also be any appropriate user-defined function, and you’ll look at some examples of using <code>apply</code> with your own functions in <a href="ch11.xhtml#ch11">Chapter 11</a>.</p>&#13;
<h5 class="h5" id="ch10lev3sec25"><strong>Other apply Functions</strong></h5>&#13;
<p class="noindent">There are different flavors of the basic <code>apply</code> function. The <code>tapply</code> function, for example, performs operations on subsets of the object of interest, where those subsets are defined in terms of one or more factor vectors. As an example, let’s return to the code from <a href="ch08.xhtml#ch08lev2sec75">Section 8.2.3</a>, which reads in a web-based data file on diamond pricing, sets appropriate variable names of the data frame, and displays the first five records.</p>&#13;
<pre>R&gt; dia.url &lt;- "http://www.amstat.org/publications/jse/v9n2/4cdata.txt"<br/>R&gt; diamonds &lt;- read.table(dia.url)<br/>R&gt; names(diamonds) &lt;- c("Carat","Color","Clarity","Cert","Price")<br/>R&gt; diamonds[1:5,]<br/> Carat Color Clarity Cert Price<br/>1 0.30     D     VS2  GIA  1302<br/>2 0.30     E     VS1  GIA  1510<br/>3 0.30     G    VVS1  GIA  1510<br/>4 0.30     G     VS1  GIA  1260<br/>5 0.31     D     VS1  GIA  1641</pre>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_207"/>To add up the total value of the diamonds present for the full data set but separated according to <code>Color</code>, you can use <code>tapply</code> like this:</p>&#13;
<pre>R&gt; tapply(diamonds$Price,INDEX=diamonds$Color,FUN=sum)<br/>     D      E      F      G      H      I<br/>113598 242349 392485 287702 302866 207001</pre>&#13;
<p class="indent">This sums the relevant elements of the target vector <code>diamonds$Price</code>. The corresponding factor vector <code>diamonds$Color</code> is passed to <code>INDEX</code>, and the function of interest is specified with <code>FUN=sum</code> exactly as earlier.</p>&#13;
<p class="indent">Another particularly useful alternative is <code>lapply</code>, which can operate member by member on a list. In <a href="ch10.xhtml#ch10lev2sec92">Section 10.2.1</a>, recall you wrote a <code>for</code> loop to inspect matrices in the following list:</p>&#13;
<pre>R&gt; baz &lt;- list(aa=c(3.4,1),bb=matrix(1:4,2,2),cc=matrix(c(T,T,F,T,F,F),3,2),<br/>               dd="string here",ee=matrix(c("red","green","blue","yellow")))</pre>&#13;
<p class="indent">Using <code>lapply</code>, you can check for matrices in the list with a single short line of code.</p>&#13;
<pre>R&gt; lapply(baz,FUN=is.matrix)<br/>$aa<br/>[1] FALSE<br/><br/>$bb<br/>[1] TRUE<br/><br/>$cc<br/>[1] TRUE<br/><br/>$dd<br/>[1] FALSE<br/><br/>$ee<br/>[1] TRUE</pre>&#13;
<p class="indent">Note that no margin or index information is required for <code>lapply</code>; R knows to apply <code>FUN</code> to each member of the specified list. The returned value is itself a list. Another variant, <code>sapply</code>, returns the same results as <code>lapply</code> but in an array form.</p>&#13;
<pre><span epub:type="pagebreak" id="page_208"/>R&gt; sapply(baz,FUN=is.matrix)<br/>   aa    bb    cc    dd    ee<br/>FALSE  TRUE  TRUE FALSE  TRUE</pre>&#13;
<p class="indent">Here, the result is provided as a vector. In this example, <code>baz</code> has a <code>names</code> attribute that is copied to the corresponding entries of the returned object.</p>&#13;
<p class="indent">Other variants of <code>apply</code> include <code>vapply</code>, which is similar to <code>sapply</code> albeit with some relatively subtle differences, and <code>mapply</code>, which can operate on multiple vectors or lists at once. To learn more about <code>mapply</code>, see the <code>?mapply</code> help file; <code>vapply</code> and <code>sapply</code> are both covered in the <code>?lapply</code> help file.</p>&#13;
<p class="indent">All of R’s <code>apply</code> functions allow for additional arguments to be passed to <code>FUN</code>; most of them do this via an ellipsis. For example, take another look at the matrix <code>foo</code>:</p>&#13;
<pre>R&gt; apply(foo,1,sort,decreasing=TRUE)<br/>     [,1] [,2] [,3] [,4]<br/>[1,]    9   10   11   12<br/>[2,]    5    6    7    8<br/>[3,]    1    2    3    4</pre>&#13;
<p class="indent">Here you’ve applied <code>sort</code> to each row of the matrix and supplied the additional argument <code>decreasing=TRUE</code> to sort the rows from largest to smallest.</p>&#13;
<p class="indent">Some programmers prefer using the suite of <code>apply</code> functions wherever possible to improve the compactness and neatness of their code. However, note that these functions generally do not offer any substantial improvement in terms of computational speed or efficiency over an explicit loop (this is particularly the case with more recent versions of R). Plus, when you’re first learning the R language, explicit loops can be easier to read and follow since the operations are laid out clearly line by line.</p>&#13;
<div class="ex">&#13;
<p class="ext"><a id="ch10exc5"/><strong>Exercise 10.5</strong></p>&#13;
<ol type="a">&#13;
<li><p class="noindents">Continuing on from the most recent example in the text, write an implicit loop that calculates the product of all the column elements of the matrix returned by the call to <code>apply(foo,1,sort,decreasing=TRUE)</code>.</p></li>&#13;
<li><p class="noindents">Convert the following <code>for</code> loop to an implicit loop that does exactly the same thing:</p>&#13;
<pre>matlist &lt;- list(matrix(c(T,F,T,T),2,2),<br/>                matrix(c("a","c","b","z","p","q"),3,2),<br/>                matrix(1:8,2,4))<br/>matlist<br/>for(i in 1:length(matlist)){<br/>    matlist[[i]] &lt;- t(matlist[[i]])<br/>}<br/>matlist</pre></li>&#13;
<li><p class="noindents"><span epub:type="pagebreak" id="page_209"/>In R, store the following 4 × 4 × 2 × 3 array as the object <code>qux</code>:</p>&#13;
<pre>R&gt; qux &lt;- array(96:1,dim=c(4,4,2,3))</pre>&#13;
<p class="indent">That is, it is a four-dimensional array comprised of three blocks, with each block being an array made up of two layers of 4 × 4 matrices. Then, do the following:</p>&#13;
<ol type="i">&#13;
<li><p class="noindents">Write an implicit loop that obtains the diagonal elements of all second-layer matrices only to produce the following matrix:</p>&#13;
<pre>     [,1] [,2] [,3]<br/>[1,]   80   48   16<br/>[2,]   75   43   11<br/>[3,]   70   38    6<br/>[4,]   65   33    1</pre></li>&#13;
<li><p class="noindents">Write an implicit loop that will return the <code>dim</code>ensions of each of the three matrices formed by accessing the fourth column of every matrix in <code>qux</code>, regardless of layer or block, wrapped by another implicit loop that finds the row sums of that returned structure, resulting simply in the following vector:</p>&#13;
<pre>[1] 12 6</pre></li>&#13;
</ol></li>&#13;
</ol>&#13;
</div>&#13;
<h3 class="h3" id="ch10lev1sec35"><strong>10.3 Other Control Flow Mechanisms</strong></h3>&#13;
<p class="noindent">To round off this chapter, you’ll look at three more control flow mechanisms: <code>break</code>, <code>next</code>, and <code>repeat</code>. These mechanisms are often used in conjunction with the loops and <code>if</code> statements you’ve seen already.</p>&#13;
<h4 class="h4" id="ch10lev2sec95"><strong><em>10.3.1 Declaring break or next</em></strong></h4>&#13;
<p class="noindent">Normally a <code>for</code> loop will exit only when the <code><span class="codeitalic">loopindex</code></span> exhausts the <code><span class="codeitalic">loopvector</code></span>, and a <code>while</code> loop will exit only when the <code><span class="codeitalic">loopcondition</code></span> evaluates to <code>FALSE</code>. But you can also preemptively terminate a loop by declaring <code>break</code>.</p>&#13;
<p class="indent">For example, say you have a number, <code>foo</code>, that you want to divide by each element in a numeric vector <code>bar</code>.</p>&#13;
<pre>R&gt; foo &lt;- 5<br/>R&gt; bar &lt;- c(2,3,1.1,4,0,4.1,3)</pre>&#13;
<p class="indent">Furthermore, let’s say you want to divide <code>foo</code> by <code>bar</code> element by element but want to halt execution if one of the results evaluates to <code>Inf</code> (which will result if dividing by zero). To do this, you can check each iteration with the <span epub:type="pagebreak" id="page_210"/><code>is.finite</code> function (<a href="ch06.xhtml#ch06lev2sec55">Section 6.1.1</a>), and you can issue a <code>break</code> command to terminate the loop if it returns <code>FALSE</code>.</p>&#13;
<pre>R&gt; loop1.result &lt;- rep(NA,length(bar))<br/>R&gt; loop1.result<br/>[1] NA NA NA NA NA NA NA<br/>R&gt; for(i in 1:length(bar)){<br/>+   temp &lt;- foo/bar[i]<br/>+   if(is.finite(temp)){<br/>+       loop1.result[i] &lt;- temp<br/>+   } else {<br/>+       break<br/>+   }<br/>+ }<br/>R&gt; loop1.result<br/>[1] 2.500000 1.666667 4.545455 1.250000     NA     NA     NA</pre>&#13;
<p class="indent">Here, the loop divides the numbers normally until it reaches the fifth element of <code>bar</code> and divides by zero, resulting in <code>Inf</code>. Upon the resulting conditional check, the loop ends immediately, leaving the remaining entries of <code>loop1.result</code> as they were originally set—<code>NA</code>s.</p>&#13;
<p class="indent">Invoking <code>break</code> is a fairly drastic move. Often, a programmer will include it only as a safety catch that’s meant to highlight or prevent unintended calculations. For more routine operations, it’s best to use another method. For instance, the example loop could easily be replicated as a <code>while</code> loop or the vector-oriented <code>ifelse</code> function, rather than relying on a <code>break</code>.</p>&#13;
<p class="indent">Instead of <code>break</code>ing and completely ending a loop, you can use <code>next</code> to simply advance to the next iteration and continue execution. Consider the following, where using <code>next</code> avoids division by zero:</p>&#13;
<pre>R&gt; loop2.result &lt;- rep(NA,length(bar))<br/>R&gt; loop2.result<br/>[1] NA NA NA NA NA NA NA<br/>R&gt; for(i in 1:length(bar)){<br/>+   if(bar[i]==0){<br/>+       next<br/>+   }<br/>+   loop2.result[i] &lt;- foo/bar[i]<br/>+ }<br/>R&gt; loop2.result<br/>[1] 2.500000 1.666667 4.545455 1.250000       NA 1.219512 1.666667</pre>&#13;
<p class="indent">First, the loop checks to see whether the <code>i</code>th element of <code>bar</code> is zero. If it is, <code>next</code> is declared, and as a result, R ignores any subsequent lines of code in the braced area of the loop and returns to the top, automatically advancing to the next value of the <code><span class="codeitalic">loopindex</code></span>. In the current example, the loop skips the fifth entry of <code>bar</code> (leaving the original <code>NA</code> value for that place) and continues through the rest of <code>bar</code>.</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_211"/>Note that if you use either <code>break</code> or <code>next</code> in a nested loop, the command will apply only to the innermost loop. Only that inner loop will exit or advance to the next iteration, and any outer loops will continue as normal. For example, let’s return to the nested <code>for</code> loops from <a href="ch10.xhtml#ch10lev2sec92">Section 10.2.1</a> that you used to fill a matrix with multiples of two vectors. This time you’ll use <code>next</code> in the inner loop to skip certain values.</p>&#13;
<pre>R&gt; loopvec1 &lt;- 5:7<br/>R&gt; loopvec1<br/>[1] 5 6 7<br/>R&gt; loopvec2 &lt;- 9:6<br/>R&gt; loopvec2<br/>[1] 9 8 7 6<br/>R&gt; baz &lt;- matrix(NA,length(loopvec1),length(loopvec2))<br/>R&gt; baz<br/>     [,1] [,2] [,3] [,4]<br/>[1,]   NA   NA   NA   NA<br/>[2,]   NA   NA   NA   NA<br/>[3,]   NA   NA   NA   NA<br/>R&gt; for(i in 1:length(loopvec1)){<br/>+   for(j in 1:length(loopvec2)){<br/>+       temp &lt;- loopvec1[i]*loopvec2[j]<br/>+       if(temp&gt;=54){<br/>+           next<br/>+       }<br/>+       baz[i,j] &lt;- temp<br/>+   }<br/>+ }<br/>R&gt; baz<br/>     [,1] [,2] [,3] [,4]<br/>[1,]   45   40   35   30<br/>[2,]   NA   48   42   36<br/>[3,]   NA   NA   49   42</pre>&#13;
<p class="indent">The inner loop skips to the <code>next</code> iteration if the product of the current elements is greater than or equal to 54. Note the effect applies <em>only to that innermost loop</em>—that is, only the <code>j <span class="codeitalic">loopindex</code></span> is preemptively incremented, while <code>i</code> is left untouched, and the outer loop continues normally.</p>&#13;
<p class="indent">I’ve been using <code>for</code> loops to illustrate <code>next</code> and <code>break</code>, but they behave the same way inside <code>while</code> loops.</p>&#13;
<h4 class="h4" id="ch10lev2sec96"><strong><em>10.3.2 The repeat Statement</em></strong></h4>&#13;
<p class="noindent">Another option for repeating a set of operations is the <code>repeat</code> statement. The general definition is simple.</p>&#13;
<pre><span epub:type="pagebreak" id="page_212"/>repeat{<br/>    <span class="codeitalic">do any code in here</span><br/>}</pre>&#13;
<p class="indent">Notice that a <code>repeat</code> statement doesn’t include any kind of <code><span class="codeitalic">loopindex</code></span> or <code><span class="codeitalic">loopcondition</code></span>. To stop repeating the code inside the braces, you must use a <code>break</code> declaration inside the braced area (usually within an <code>if</code> statement); without it, the braced code will repeat without end, creating an infinite loop. To avoid this, you must make sure the operations will at some point cause the loop to reach a <code>break</code>.</p>&#13;
<p class="indent">To see <code>repeat</code> in action, you’ll use it to calculate the famous mathematical series the <em>Fibonacci sequence</em>. The Fibonacci sequence is an infinite series of integers beginning with 1,1,2,3,5,8,13,. . . where each term in the series is determined by the sum of the two previous terms. Formally, if <em>F<sub>n</sub></em> represents the <em>n</em>th Fibonacci number, then you have:</p>&#13;
<table>&#13;
<colgroup>&#13;
<col style="width:50%"/>&#13;
<col style="width:50%"/>&#13;
</colgroup>&#13;
<tbody>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table"><p class="tablec"><em>F</em><sub>n</sub><sub>+</sub><sub>1</sub> = <em>F<sub>n</sub></em> + <em>F</em><sub>n</sub><sub>−</sub><sub>1</sub>;</p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="tablec"><em>n</em> = 2,3,4,5,. . . ,</p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<p class="noindent">where</p>&#13;
<p class="center"><em>F</em><sub>1</sub> = <em>F<sub>2</sub></em> = 1.</p>&#13;
<p class="indent">The following <code>repeat</code> statement computes and prints the Fibonacci sequence, ending when it reaches a term greater than 150:</p>&#13;
<pre>R&gt; fib.a &lt;- 1<br/>R&gt; fib.b &lt;- 1<br/>R&gt; repeat{<br/>+   temp &lt;- fib.a+fib.b<br/>+   fib.a &lt;- fib.b<br/>+   fib.b &lt;- temp<br/>+   cat(fib.b,", ",sep="")<br/>+   if(fib.b&gt;150){<br/>+       cat("BREAK NOW...\n")<br/>+       break<br/>+   }<br/>+ }<br/>2, 3, 5, 8, 13, 21, 34, 55, 89, 144, 233, BREAK NOW...</pre>&#13;
<p class="indent">First, the sequence is initialized by storing the first two terms, both 1, as <code>fib.a</code> and <code>fib.b</code>. Then, the <code>repeat</code> statement is entered, and it uses <code>fib.a</code> and <code>fib.b</code> to compute the next term in the sequence, stored as <code>temp</code>. Next, <code>fib.a</code> is overwritten to be <code>fib.b</code>, and <code>fib.b</code> is overwritten to be <code>temp</code> so that the two variables move forward through the series. That is, <code>fib.b</code> becomes the newly calculated Fibonacci number, and <code>fib.a</code> becomes the second-to-last number in the series so far. Use of <code>cat</code> then prints the new value of <code>fib.b</code> to the console. Finally, a check is made to see whether the latest term is greater than 150, and if it is, <code>break</code> is declared.</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_213"/>When you run the code, the braced area is repeated over and over until <code>fib.b</code> reaches the first number that is greater than 150, namely, 89 + 144 = 233. Once that happens, the <code>if</code> statement condition evaluates as <code>TRUE</code>, and R runs into <code>break</code>, terminating the loop.</p>&#13;
<p class="indent">The <code>repeat</code> statement is not as commonly used as the standard <code>while</code> or <code>for</code> loops, but it’s useful if you don’t want to be bound by formally specifying the <code><span class="codeitalic">loopindex</code></span> and <code><span class="codeitalic">loopvector</code></span> of a <code>for</code> loop or the <code><span class="codeitalic">loopcondition</code></span> of a <code>while</code> loop. However, with <code>repeat</code>, you have to take a bit more caution to prevent infinite loops.</p>&#13;
<div class="ex">&#13;
<p class="ext"><a id="ch10exc6"/><strong>Exercise 10.6</strong></p>&#13;
<ol type="a">&#13;
<li><p class="noindents">Using the same objects from <a href="ch10.xhtml#ch10lev2sec95">Section 10.3.1</a>,</p>&#13;
<pre>foo &lt;- 5<br/>bar &lt;- c(2,3,1.1,4,0,4.1,3)</pre>&#13;
<p class="noindent">do the following:</p>&#13;
<ol type="i">&#13;
<li><p class="noindents">Write a <code>while</code> loop—<em>without</em> using <code>break</code> or <code>next</code>—that will reach exactly the same result as the <code>break</code> example in <a href="ch10.xhtml#ch10lev2sec95">Section 10.3.1</a>. That is, produce the same vector as <code>loop2.result</code> in the text.</p></li>&#13;
<li><p class="noindents">Obtain the same result as <code>loop3.result</code>, the example concerning <code>next</code>, using an <code>ifelse</code> function instead of a loop.</p></li>&#13;
</ol></li>&#13;
<li><p class="noindents">To demonstrate <code>while</code> loops in <a href="ch10.xhtml#ch10lev2sec93">Section 10.2.2</a>, you used the vector</p>&#13;
<pre>mynumbers &lt;- c(4,5,1,2,6,2,4,6,6,2)</pre>&#13;
<p class="noindent">to progressively fill <code>mylist</code> with identity matrices whose dimensions matched the values in <code>mynumbers</code>. The loop was instructed to stop when it reached the end of the numeric vector or a number that was greater than 5.</p>&#13;
<ol type="i">&#13;
<li><p class="noindents">Write a <code>for</code> loop using a <code>break</code> declaration that does the same thing.</p></li>&#13;
<li><p class="noindents">Write a <code>repeat</code> statement that does the same thing.</p></li>&#13;
</ol></li>&#13;
<li><p class="noindents">Suppose you have two lists, <code>matlist1</code> and <code>matlist2</code>, both filled with numeric matrices as their members. Assume that all members have finite, nonmissing values, but <em>do not</em> assume that the dimensions of the matrices are the same throughout. Write a nested pair of <code>for</code> loops that aim to create a result list, <code>reslist</code>, of all possible <em>matrix products</em> (refer to <a href="ch03.xhtml#ch03lev2sec33">Section 3.3.5</a>) of the members of the two lists according to the following guidelines:</p>&#13;
<p class="dash">– The <code>matlist1</code> object should be indexed/searched in the outer loop, and the <code>matlist2</code> object should be indexed/searched in the inner loop.</p>&#13;
<p class="dash"><span epub:type="pagebreak" id="page_214"/>– You’re interested only in the possible matrix products of the members of <code>matlist1</code> with the members of <code>matlist2</code> in that order.</p>&#13;
<p class="dash">– If a particular multiple isn’t possible (that is, if the <code>ncol</code> of a member of <code>matlist1</code> doesn’t match the <code>nrow</code> of a member of <code>matlist2</code>), then you should skip that multiplication, store the string <code>"not possible"</code> at the relevant position in <code>reslist</code>, and proceed directly to the <code>next</code> matrix multiplication.</p>&#13;
<p class="dash">– You can define a <code>counter</code> that is incremented at each comparison (inside the inner loop) to keep track of the current position of <code>reslist</code>.</p>&#13;
<p class="indent">Note, therefore, that the <code>length</code> of <code>reslist</code> will be equal to <code>length(matlist1)*length(matlist2)</code>. Now, confirm the following results:</p>&#13;
<ol type="i">&#13;
<li><p class="noindents">If you have</p>&#13;
<pre>matlist1 &lt;- list(matrix(1:4,2,2),matrix(1:4),matrix(1:8,4,2))<br/>matlist2 &lt;- matlist1</pre>&#13;
<p class="noindent">then all members of <code>reslist</code> should be <code>"not possible"</code> apart from members <code>[[1]]</code> and <code>[[7]]</code>.</p></li>&#13;
<li><p class="noindents">If you have</p>&#13;
<pre>matlist1 &lt;- list(matrix(1:4,2,2),matrix(2:5,2,2),<br/>                 matrix(1:16,4,2))<br/>matlist2 &lt;- list(matrix(1:8,2,4),matrix(10:7,2,2),<br/>                 matrix(9:2,4,2))</pre>&#13;
<p class="noindent">then only the <code>"not possible"</code> members of <code>reslist</code> should be <code>[[3]]</code>, <code>[[6]]</code>, and <code>[[9]]</code>.</p></li>&#13;
</ol></li>&#13;
</ol>&#13;
</div>&#13;
<h5 class="h5" id="ch10lev3sec26"><strong>Important Code in This Chapter</strong></h5>&#13;
<table class="topbot">&#13;
<thead>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table_th"><p class="table"><strong>Function/operator</strong></p></td>&#13;
<td style="vertical-align: top;" class="table_th"><p class="table"><strong>Brief description</strong></p></td>&#13;
<td style="vertical-align: top;" class="table_th"><p class="table"><strong>First occurrence</strong></p></td>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><code>if( ){ }</code></p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table">Conditional check</p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><a href="ch10.xhtml#ch10lev2sec87">Section 10.1.1</a>, <a href="ch10.xhtml#page_180">p. 180</a></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><code>if( ){ } else { }</code></p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table">Check and alternative</p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><a href="ch10.xhtml#ch10lev2sec88">Section 10.1.2</a>, <a href="ch10.xhtml#page_183">p. 183</a></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><code>ifelse</code></p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table">Element-wise <code>if-else</code> check</p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><a href="ch10.xhtml#ch10lev2sec89">Section 10.1.3</a>, <a href="ch10.xhtml#page_185">p. 185</a></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><code>switch</code></p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table">Multiple <code>if</code> choices</p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><a href="ch10.xhtml#ch10lev2sec91">Section 10.1.5</a>, <a href="ch10.xhtml#page_190">p. 190</a></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><code>for( ){ }</code></p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table">Iterative loop</p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><a href="ch10.xhtml#ch10lev2sec92">Section 10.2.1</a>, <a href="ch10.xhtml#page_194">p. 194</a></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><code>while( ){ }</code></p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table">Conditional loop</p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><a href="ch10.xhtml#ch10lev2sec93">Section 10.2.2</a>, <a href="ch10.xhtml#page_200">p. 200</a></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><code>apply</code></p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table">Implicit loop by margin</p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><a href="ch10.xhtml#ch10lev2sec94">Section 10.2.3</a>, <a href="ch10.xhtml#page_205">p. 205</a></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><code>tapply</code></p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table">Implicit loop by factor</p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><a href="ch10.xhtml#ch10lev2sec94">Section 10.2.3</a>, <a href="ch10.xhtml#page_207">p. 207</a></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><code>lapply</code></p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table">Implicit loop by member</p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><a href="ch10.xhtml#ch10lev2sec94">Section 10.2.3</a>, <a href="ch10.xhtml#page_207">p. 207</a></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><code>sapply</code></p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table">As <code>lapply</code>, array returned</p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><a href="ch10.xhtml#ch10lev2sec94">Section 10.2.3</a>, <a href="ch10.xhtml#page_207">p. 207</a></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><code>break</code></p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table">Exit explicit loop</p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><a href="ch10.xhtml#ch10lev2sec95">Section 10.3.1</a>, <a href="ch10.xhtml#page_210">p. 210</a></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><code>next</code></p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table">Skip to next loop iteration</p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><a href="ch10.xhtml#ch10lev2sec95">Section 10.3.1</a>, <a href="ch10.xhtml#page_210">p. 210</a></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><code>repeat{ }</code></p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table">Repeat code until <code>break</code></p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><a href="ch10.xhtml#ch10lev2sec96">Section 10.3.2</a>, <a href="ch10.xhtml#page_212">p. 212</a><span epub:type="pagebreak" id="page_215"/></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
</body></html>