<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" xmlns:ns="http://www.w3.org/2001/10/synthesis" lang="en-us" xml:lang="en-us">
	<head>
		<title>Ethical Hacking: A Hands-on Introduction to Breaking In</title>
		<link href="../styles/9781718501881.css" rel="stylesheet" type="text/css"/>
<meta content="urn:uuid:3776231c-affd-4772-8376-b44c973236be" name="Adept.expected.resource"/>
	</head>
	<body>
		<h2 class="h2" id="ch8"><span epub:type="pagebreak" id="page_131"/><strong><span class="big">8</span><br/>SCANNING TARGETS</strong></h2>
		<p class="verse"><em>No thief, however skillful, can rob one of knowledge, and that is why knowledge is the best and safest treasure to acquire.</em></p>
		<p class="chap-au">—L. Frank Baum, <em>The Lost Princess of Oz</em></p>
		<div class="imagec">
			<img alt="image" src="../images/common.jpg"/>
		</div>
		<p class="noindents">The more you know about a victim, the more effectively you can influence their behavior. For example, a victim is more likely to click a phishing email if it’s sent by someone they know. In this chapter, we’ll explore some of the tools and techniques hackers use to learn about their victims. These tools search and catalog relevant publicly available information from the internet. You’ll use these tools to identify devices on the public internet that contain vulnerabilities that you can exploit.</p>
		<p class="indent">This process of collecting and cataloging information from public sources is called <em>open source intelligence (OSINT)</em>. Let’s discuss how OSINT and social engineering techniques can identify and exploit vulnerable machines. I’ll begin by discussing an OSINT technique called <em>link analysis</em>.</p>
		<h3 class="h3" id="ch08lev1"><span epub:type="pagebreak" id="page_132"/><strong>Link Analysis</strong></h3>
		<p class="noindent">Link analysis identifies connections between related pieces of publicly available information. For example, you could look up a victim’s phone number in a phone book to link their number to their name. Or, to take a more extreme example, state actors like the NSA may have access to the telephone company’s private logs. This allows them to identify your recent contacts, often referred to as your <em>first-degree connections</em>.</p>
		<p class="indent">The true power of this technique comes from its ability to identify who your contacts have themselves contacted, also known as your <em>second-degree connections</em>. Exploring second-degree connections allows hackers to discover hidden links between a person of interest and another person being investigated (see <a href="ch08.xhtml#ch8fig1">Figure 8-1</a>).</p>
		<div class="image" id="ch8fig1">
			<img alt="image" src="../images/ch08fig01.jpg"/>
		</div>
		<p class="figcap"><em>Figure 8-1: Firstand second-degree connections</em></p>
		<p class="indent">Hackers and security researchers don’t have access to the same private data sources as governments and must rely on public sources.</p>
		<p class="indent">An example of such a public source is the <em>whois</em> database, which contains contact information for websites. This allows users to report any issues to the website’s administrators. The contact information often includes the system administrator’s email address and phone number.</p>
		<p class="indent">To protect their information from being exposed, system administrators will often pay an extra fee to keep this information private. However, the law requires some domains to publish their contact information. For example, the National Telecommunications and Information Administration (NTIA) requires all <em>.us</em> domains to publish their contact information. This means that you can view the contact information for, say, <em>zoom.us</em> by running the following command in your Kali Linux terminal:</p>
		<p class="programs">kali@kali:~$ <span class="codestrong1">whois zoom.us</span></p>
		<p class="indent">The command should print out a lot of information, including an address, phone number, and contact email. Scroll up in the terminal so that you can see all of this. The following is a short snippet of the result (I’ve redacted the phone number and email address as a courtesy).</p>
		<p class="programs"><span epub:type="pagebreak" id="page_133"/>Admin Country: us<br/>Admin Phone: +1.xxxxxxxx<br/>Admin Phone Ext:<br/>Admin Fax:<br/>Admin Fax Ext:<br/>Admin Email: xxxxx@zoom.us</p>
		<p class="indent">An attacker could use this information to send a phishing email to the system administrator and attempt to steal their username and password. If this fails, the attacker might attempt to use link analysis to discover the system administrator’s username and password. Let’s explore how the Maltego link analysis tool makes this possible.</p>
		<h4 class="h4" id="ch08lev2"><strong><em>Maltego</em></strong></h4>
		<p class="noindent"><em>Maltego</em> allows hackers and security researchers to discover connections between pieces of publicly available information on the internet. These sources include forum posts, web pages, and records from the whois database.</p>
		<p class="indent">Maltego refers to programs like whois as <em>transforms</em>. By applying a transform to a piece of data, a hacker can discover related information. Some of Maltego’s transforms identify related infrastructure such as DNS servers and web servers, whereas other transforms search public forums to find usernames or email addresses.</p>
		<p class="indent">Let’s use Maltego to see what open source information we can find on the <em><a href="http://maltego.com">maltego.com</a></em> domain. Start up your Kali Linux virtual machine and search for Maltego in the <strong>Applications</strong> menu. Maltego offers both free and paid versions. We’ll use the free version, so select <strong>Maltego CE free</strong>. Follow the instructions in the setup wizard and select the defaults.</p>
		<p class="indent">During the setup process, you’ll be asked to provide an email address. Instead of using your personal email address, let’s create an account on <em><a href="http://Protonmail.com">Protonmail.com</a></em>, an anonymous encrypted mail service, and use that address to register for Maltego. If Protonmail is banned in your country, download the Opera browser, enable its built-in VPN, and select a country other than your own. This will route your requests through an encrypted channel to another country. (We’ll discuss creating an anonymous infrastructure in more depth in <a href="ch16.xhtml#ch16">Chapter 16</a>.) After you have done this, you should be able to use Protonmail.</p>
		<p class="indent">After you’ve completed the setup process, you should see an empty canvas in the Maltego interface. To get started, add pieces of data, which Maltego refers to as <em>entities</em>, to this canvas. Maltego supports several entities such as telephone numbers, email addresses, physical locations, company names, and web domains. Click <strong>New Entity Type</strong>, search for <strong>domain</strong>, and then add the <strong>Domain</strong> entity to the canvas, as shown in <a href="ch08.xhtml#ch8fig2">Figure 8-2</a>.</p>
		<div class="image" id="ch8fig2">
			<span epub:type="pagebreak" id="page_134"/>
			<img alt="image" src="../images/ch08fig02.jpg"/>
		</div>
		<p class="figcap"><em>Figure 8-2: Adding an entity to the canvas</em></p>
		<p class="indent">Because we’re searching for information about Maltego itself, change the URL of the domain entity from <em><a href="http://paterva.com">paterva.com</a></em> to <em><a href="http://maltego.com">maltego.com</a></em>. Right-click the domain entity and run it through a whois transform by clicking the play button next to the <strong>Domain owner detail</strong> option (<a href="ch08.xhtml#ch8fig3">Figure 8-3</a>).</p>
		<div class="image" id="ch8fig3">
			<img alt="image" src="../images/ch08fig03.jpg"/>
		</div>
		<p class="figcap"><em>Figure 8-3: Example of running a Maltego transform</em></p>
		<p class="indent"><span epub:type="pagebreak" id="page_135"/>Running the transform will produce other entities related to the domain. <a href="ch08.xhtml#ch8fig4">Figure 8-4</a> shows the output of the transform. Notice that the output includes information you would find in a whois query.</p>
		<div class="image" id="ch8fig4">
			<img alt="image" src="../images/ch08fig04.jpg"/>
		</div>
		<p class="figcap"><em>Figure 8-4: Results of the Maltego transform</em></p>
		<p class="indent">What could an attacker do with this information? Well, by applying consecutive transforms, they might discover information about a company’s users and infrastructure. You can install the additional transform by selecting <strong>Transforms</strong> ▶<strong>Transform Hub</strong> (<a href="ch08.xhtml#ch8fig5">Figure 8-5</a>).</p>
		<div class="image" id="ch8fig5">
			<img alt="image" src="../images/ch08fig05.jpg"/>
		</div>
		<p class="figcap"><em>Figure 8-5: The Transform Hub’s list of transforms</em></p>
		<p class="indent"><span epub:type="pagebreak" id="page_136"/>One of the most useful pieces of information you can obtain is the system administrator’s username and password. Over the years, hackers have stolen databases containing login credentials from companies like LinkedIn, Adobe, and MasterCard. If you obtain a system administrator’s email address, you can search these leaked databases to find an associated password.</p>
		<p class="indent">The website <em><a href="https://haveibeenpwned.com/">https://haveibeenpwned.com/</a></em> keeps track of these leaks and stores a list of email addresses associated with leaked passwords. Check the website directly to see if one of your passwords has been leaked, or search the database in Maltego by installing the <em>haveibeenpwned</em> transform and running it on the email address you discovered.</p>
		<h4 class="h4" id="ch08lev3"><strong><em>Leaked Credential Databases</em></strong></h4>
		<p class="noindent">You might notice that the transform will tell you whether the email address has been exposed in a leak, but it won’t show the password. How do hackers obtain the passwords associated with leaked email addresses? They’ll often turn to other databases containing plaintext usernames, email addresses, and passwords. One of the largest lists ever leaked contained approximately 1.4 billion email address (or username) and password pairs. You can find such a list available via the following Magnet link:</p>
		<p class="programs">magnet:?xt=urn:btih:7ffbcd8cee06aba2ce6561688cf68ce2addca0a3&amp;dn=<br/>
    BreachCompilation&amp;tr=udp%3A%2F%2Ftracker.openbittorrent.com%3A80&amp;tr=udp%3<br/>
    A%2F%2Ftracker.leechers-paradise.org%3A6969&amp;tr=udp%3A%2F%2Ftracker.<br/>
    coppersurfer.tk%3A6969&amp;tr=udp%3A%2F%2Fglotorrents.pw%3A6969&amp;tr=udp%3A%2F<br/>
    %2Ftracker.opentrackr.org%3A133</p>
		<div class="note">
			<p class="notet"><strong><span class="notes">NOTE</span></strong></p>
			<p class="notep"><em>Possession of this password list may be illegal in your country, so check your local laws before downloading the database.</em></p>
		</div>
		<p class="indent"><em>Magnet links</em> are an improvement on torrent files. Instead of downloading a file from a single server, torrents allow you to download parts of the file from multiple machines called <em>peers</em>. A torrent file contains a link to a torrent tracker server, which keeps track of all the peers and facilitates connections between them. But this makes the torrent tracker server a single point of failure. With magnet links, each peer keeps track of other peers, instead, thus eliminating the need for a single tracker.</p>
		<p class="indent">Because the plaintext database is very large (41GB), it won’t fit on your virtual machine as originally configured. You’ll need to increase the size of the virtual machine hard drive if you want to store this file. Do this by clicking <strong>File</strong> ▶<strong>Virtual Media Manager</strong> (<a href="ch08.xhtml#ch8fig6">Figure 8-6</a>).</p>
		<div class="image" id="ch8fig6">
			<span epub:type="pagebreak" id="page_137"/>
			<img alt="image" src="../images/ch08fig06.jpg"/>
		</div>
		<p class="figcap"><em>Figure 8-6: How to increase hard drive size</em></p>
		<p class="indent">Select the <strong>Properties</strong> tab <span class="ent">➊</span> in VirtualBox and then click the virtual machine images that you would like to increase in size <span class="ent">➋</span>. Next, move the slider <span class="ent">➌</span> to a new size. Be careful though, because moving the slider all the way to the right could fill your hard drive and make your primary operating system unusable. Check the available space on your hard drive before you do this step.</p>
		<p class="indent">The <span class="literal">rtorrent</span> utility supports magnet links. You can install it by running the following command:</p>
		<p class="programs">kali@kali:~$ <span class="codestrong1">sudo apt-get install rtorrent</span></p>
		<p class="indent">Now you can use it to download the file:</p>
		<p class="programs">kali@kali:~$ <span class="codestrong1">rtorrent <span class="codeitalic">&lt;magnet link goes here&gt;</span></span></p>
		<p class="indent">The data in the database is organized alphabetically and contains search tools that allow you to find particular information in less than a second. The leak contains a <em>README</em> file with instructions on how to use the tools.</p>
		<h4 class="h4" id="ch08lev4"><strong><em>SIM Jacking</em></strong></h4>
		<p class="noindent">If you find a password in the list, you can attempt to log in to the victim’s accounts. But some systems require users to perform an additional verification step after they log in, a process commonly referred to as <em>two-factor authentication</em>. For instance, the system might send a text message to the user’s smartphone containing a unique code that the user must provide during authentication. Other systems will call a user and ask them to verify that they’re currently logging in. However, if you don’t have access to a victim’s phone, you won’t be able to access their account.</p>
		<p class="indent"><span epub:type="pagebreak" id="page_138"/>Although these authentication methods are creative, attackers have found ways of defeating two-factor authentication using a technique called <em>SIM jacking</em>. This attack is based on the fact that telecommunications companies can transfer your old phone number to a new phone when you purchase one. Attackers sometimes use social engineering techniques to trick those companies into transferring the victim’s phone number to the hacker’s phone. To do this, the attacker uses information collected from link analysis and leaked databases to answer the customer representative’s questions and impersonate the victim. Once the phone number has been transferred, all text messages and calls are forwarded to the hacker’s phone, allowing them to circumvent two-factor authentication.</p>
		<p class="indent">In addition, certain SIM cards allow hackers to spoof phone numbers or change their voices in real time. We commonly refer to these as <em>encrypted SIMs</em>.</p>
		<h3 class="h3" id="ch08lev5"><strong>Google Dorking</strong></h3>
		<p class="noindent">Maltego isn’t the only way to collect data about a victim. Attackers can also use Google to obtain open source data. This technique is more lucrative than you might think, as Google attempts to find and index all web pages, some of which allow system administrators to control systems like IP cameras. A system administrator can explicitly tell Google not to crawl a specific resource by listing it in the <em>robots.txt</em> file on the web server. However, some web crawlers will ignore this file, so the best way to protect these web pages is to require user authentication.</p>
		<p class="indent">By using carefully crafted Google searches, you can discover web pages that let you view or control systems. Let’s cover some of these queries to find sensitive pages.</p>
		<div class="note">
			<p class="notet"><strong><span class="notes">NOTE</span></strong></p>
			<p class="notep"><em>The Computer Fraud and Abuse Act (CFAA) prohibits unauthorized access to systems you do not own. Because you are operating outside of your own virtual environment, clicking any of the links you discover during this process could constitute unauthorized access.</em></p>
		</div>
		<p class="indent">Google allows you to use special filters to make your search more specific. For example, you can use the <span class="literal">inurl</span> filter to search for pages whose URLs contain certain patterns that can indicate the page’s functionality. For example, the following search will show you live cameras that have been intentionally made public:</p>
		<p class="programs">inurl:"live/cam.html"</p>
		<p class="indent">We assume that these cameras were intentionally made public because they’ve been assigned to a dedicated web page (<em>cam.html</em>). The following query attempts to discover IP cameras that were unintentionally exposed:</p>
		<p class="programs">"Pop-up" + "Live Image" inurl:index.html</p>
		<p class="indent"><span epub:type="pagebreak" id="page_139"/>This query searches for <em>index.html</em> pages that contain the terms “live image” and “pop-up.” These words are typically associated with web pages that control cameras. You can make the search more specific by adding additional terms.</p>
		<p class="indent">Other queries search exposed logs for plaintext usernames and passwords. For example, the following query uses the <span class="literal">filetype</span>, <span class="literal">intext</span>, and <span class="literal">after</span> filters to find log files discovered after 2019 that contain email addresses and passwords:</p>
		<p class="programs">filetype:log intext:password after:2019 intext:@gmail.com | @yahoo.com</p>
		<p class="indent">You can find a list of these Google queries by visiting <em><a href="https://exploit-db.com/google-hacking-database/">https://exploit-db.com/google-hacking-database/</a></em>.</p>
		<h3 class="h3" id="ch08lev6"><strong>Scanning the Entire Internet</strong></h3>
		<p class="noindent">Certain systems attempt to find and catalog every device on the internet and test them for vulnerabilities. They do this by performing a SYN scan on all 2<sup>32</sup>, or 4,294,967,296, IPv4 addresses on the internet. In this section, we’ll look at two tools, <em>Masscan</em> and <em>Shodan</em>, which allow attackers to scan the internet. There are also great academic tools, like <em>Zmap</em> from the University of Michigan: <em><a href="https://zmap.io/">https://zmap.io/</a></em>.</p>
		<h4 class="h4" id="ch08lev7"><strong><em>Masscan</em></strong></h4>
		<p class="noindent">Masscan is an internet-scale scanner that scans for open TCP and UDP ports. Its creator, Robert Graham, has implemented his own custom TCP/IP stack, allowing the program to scan the entire IPv4 internet in less than 10 minutes. This is possible because Masscan is capable of transmitting up to 10 million packets per second. Unlike <span class="literal">nmap</span>, which synchronously sends SYN packets and waits for SYN-ACK responses, Masscan sends multiple SYN packets independently, or asynchronously, without waiting for a response to the previous packet.</p>
		<p class="indent">Transmitting this many packets requires special hardware and software. The machine running Masscan must have a 10Gbps Ethernet adapter and the <em>PF_RING ZC</em> driver installed. Running Masscan on a virtual machine also limits the number of packets you can transmit. Masscan performs best when you run it directly on a Linux machine.</p>
		<p class="indent">For our purposes, we’ll run it at a much more modest rate of only 100,000 packets per second. We’ll also scan only a single port. With this configuration, it will take about 10 hours to scan every IPv4 device on the internet. Still, this configuration lets us use our Kali Linux virtual machine without any special hardware or software.</p>
		<h5 class="h5" id="ch08lev8"><strong>Using an Exclusion List</strong></h5>
		<p class="noindent">One more thing: you don’t actually want to scan the entire internet. The administrators of certain government and military servers don’t take kindly to being scanned. For this reason, several groups have compiled lists of IP <span epub:type="pagebreak" id="page_140"/>addresses that you should not scan, called <em>exclusion lists</em>. You can find such an exclusion list at <em><a href="https://github.com/robertdavidgraham/masscan/blob/master/data/exclude.conf">https://github.com/robertdavidgraham/masscan/blob/master/data/exclude.conf</a></em>. This list includes the IP addresses of machines at the NASA headquarters, the NASA Information and Electronic Systems Laboratory, and a US Navy computer and telecommunications station. Do <strong>NOT</strong> scan these.</p>
		<p class="indent">Download this list and save it to a file called <em>exclude.txt</em>. It should look something like this:</p>
		<p class="programs">## NASA Headquarters<br/>
#138.76.0.0<br/>
## NASA Information and Electronic Systems Laboratory<br/>
#138.115.0.0<br/>
## Navy Computers and Telecommunications Station<br/>
#138.136.0.0 - 138.136.255.255</p>
		<p class="indent">You might say that this exclusion list could double as an attack list. But you are an ethical hacker and hacking these systems would be unethical. The list also contains several honey pots operated by the FBI and other agencies. A <em>honey pot</em> is a vulnerable machine intentionally placed in a network as bait for attackers. When a hacker compromises one of these machines, the owner can discover the hacker’s tools and techniques by monitoring the honey pot’s activity.</p>
		<p class="indent">Here are some FBI honey pots included in the exclusion list (it’s important to update your exclusion list regularly because these might change):</p>
		<p class="programs">## (FBI's honeypot)<br/>
#205.97.0.0<br/>
## (FBI's honeypot)<br/>
#205.98.0.0</p>
		<h5 class="h5" id="ch08lev9"><strong>Performing a Masscan Scan</strong></h5>
		<p class="noindent">Now let’s use Masscan to execute a quick scan of our virtual network. Open your preferred text editor and add the following:</p>
		<p class="programs"><span class="ent">➊</span> rate = 100000.00<br/>
   output-format = xml<br/>
   output-status = all<br/>
   output-filename = scan.xml<br/><span class="ent">➋</span> ports = 0-65535<br/><span class="ent">➌</span> range = 192.168.1.0-192.168.1.255<br/><span class="ent">➍</span> excludefile = exclude.txt</p>
		<p class="indent">The <span class="literal">rate</span> represents the number of packets to transmit per second <span class="ent">➊</span>. The next options determine the format of the output file, along with the type of information to include. We also specify the range of ports to scan <span class="ent">➋</span>. Here, we’re scanning all possible ports, from 0 to 65,535. Next, we specify the range of IP addresses <span class="ent">➌</span> to scan. We’ll scan all the IP addresses in our <span epub:type="pagebreak" id="page_141"/>virtual environment. Finally, we specify our execution list <span class="ent">➍</span>. Though we don’t need it for our environment, you should include it when doing public internet scans.</p>
		<p class="indent">Save the file as <em>scan.conf</em>. Although it’s possible to supply these parameters as command line arguments, creating a configuration file like this one makes it easier to repeat the scan.</p>
		<p class="indent">Open a terminal on your Kali Linux virtual machine and run the scan by executing the following command:</p>
		<p class="programs">kali@kali:~$ <span class="codestrong1">sudo masscan -c scan.conf</span></p>
		<p class="indent">Your Kali Linux virtual machine should come with Masscan preinstalled. As the scan runs, you should see the following status screen:</p>
		<p class="programs">Starting masscan (http://bit.ly/14GZzcT)<br/>
 --forced options: -sS -Pn -n --randomize-hosts -v --send-eth<br/>Initiating SYN Stealth Scan<br/>Scanning 256 hosts [65536 ports/host]<br/>rate: 13.39-kpps,   4.28% done,   0:20:56 remaining, found=0</p>
		<p class="indent">After the scan completes, you can view the XML results by opening <em>scan.xml</em> in Mousepad or your preferred text editor. It will contain a list of machines and open ports:</p>
		<p class="programs">   &lt;?xml version="1.0"?&gt;<br/>
   &lt;!-masscan v1.0 scan --&gt;<br/>
   &lt;?xml-stylesheet href="" type="text/xsl"?&gt;<br/>
   &lt;nmaprun scanner="masscan" start="1606781854" version="1.0-BETA"<br/>
        
			<img alt="image" src="../images/arrow01.jpg"/>
			 xmloutputversion="1.03"&gt;<br/>
   &lt;scaninfo type="syn" protocol="tcp" /&gt;<br/><span class="ent">➊</span> &lt;host endtime="1606781854"&gt;&lt;address addr="192.168.1.101" addrtype="ipv4"/&gt;&lt;<br/>
       
			<img alt="image" src="../images/arrow01.jpg"/>
			 ports&gt;&lt;port protocol="tcp" portid="32228"&gt;&lt;state state="closed" reason<br/>
       
			<img alt="image" src="../images/arrow01.jpg"/>
			 ="rst-ack" reason_ttl="64"/&gt;&lt;/port&gt;&lt;/ports&gt;&lt;/host&gt;<br/>
   &lt;host endtime="1606781854"&gt;&lt;address addr="192.168.1.101" addrtype="ipv4"/&gt;&lt;<br/>
       
			<img alt="image" src="../images/arrow01.jpg"/>
			 ports&gt;&lt;port protocol="tcp" portid="65128"&gt;&lt;state state="closed" reason<br/>
       
			<img alt="image" src="../images/arrow01.jpg"/>
			 ="rst-ack" reason_ttl="64"/&gt;&lt;/port&gt;&lt;/ports&gt;&lt;/host&gt;<br/>
                              ...</p>
		<p class="indent">The line that begins with <span class="literal">host endtime=</span> <span class="ent">➊</span> indicates that Masscan has detected an open TCP port (<span class="literal">portid=</span>) with the ID <span class="literal">32228</span> on a machine with the IP address (<span class="literal">addr=</span>) <span class="literal">192.168.1.101</span>.</p>
		<h5 class="h5" id="ch08lev10"><strong>Reading Banner Information</strong></h5>
		<p class="noindent">Masscan can also open a TCP connection on a port and download <em>banners</em> information that normally includes details about the application running on that port. For example, the banner might include the application’s version. This is extremely useful because as soon as a company discloses a known vulnerability in some software, a powerful machine running Masscan can identify all internet-facing vulnerable machines in less than 10 minutes.</p>
		<p class="indent"><span epub:type="pagebreak" id="page_142"/>For example, servers running older versions of the OpenSSL library are vulnerable to an attack called Heartbleed. In <a href="ch09.xhtml#ch9">Chapter 9</a>, we’ll examine the details of Heartbleed, which can allow hackers to read a server’s memory. For now, let’s see how a hacker might use Masscan to detect all the machines on the internet that are vulnerable to the attack.</p>
		<p class="indent">Earlier I mentioned that Masscan used its own custom TCP/IP implementation. Although this implementation works seamlessly for scanning, it conflicts with an operating system’s TCP/IP implementation when it attempts to establish a TCP connection and download a banner. You can circumvent this by using the <span class="literal">--source-ip</span> option to assign a unique network ID to the packets Masscan sends. Carefully select this IP address to ensure that it’s unique on the network (so that IP packets aren’t forwarded to another machine):</p>
		<p class="programs">kali@kali:~$ <span class="codestrong1">sudo masscan 192.168.1.0/24 -p443 --banners --heartbleed --source-ip 192.168.1.200</span></p>
		<p class="indent">Here we’ve specified the range of IP addresses to scan using <em>CIDR notation</em> (see <a href="ch02.xhtml#ch2">Chapter 2</a> for an explanation of CIDR notation). Next, we select the port to check. In this case, we are checking port 443 (<span class="literal">-p443</span>), which is associated with the HTTPS protocol. We then need to inspect the banner (<span class="literal">--banners</span>) for the OpenSSL version numbers associated with the Heartbleed (<span class="literal">--heartbleed</span>) vulnerability. Simultaneously establishing multiple TCP connections can cause conflicts between Masscan’s TCP/IP stack and that of the operating system, so we label outgoing packets with a new source IP address (<span class="literal">--source-ip</span>) not used by other machines on the network to avoid conflicts.</p>
		<p class="indent">Once the scan completes, we should see the following output:</p>
		<p class="programs">   Starting masscan (http://bit.ly/14GZzcT)<br/>
    --forced options: -sS -Pn -n --randomize-hosts -v --send-eth<br/>
   Initiating SYN Stealth Scan<br/>
   Scanning 256 hosts [1 port/host]<br/>
   Discovered open port 443/tcp on 192.168.1.1<br/>
   Banner on port 443/tcp on 192.168.1.1: [ssl] TLS/1.1 cipher:0xc014, pfSense-5<br/>
       
			<img alt="image" src="../images/arrow01.jpg"/>
			 f57a7f8465ea, pfSense-5f57a7f8465ea<br/><span class="ent">➊</span> Banner on port 443/tcp on 192.168.1.1: [vuln] SSL[heartbeat]</p>
		<p class="indent">The scan detected that port 443 is open on one host <span class="ent">➊</span> and that the machine might be running a vulnerable version of OpenSSL.</p>
		<p class="indent">You’ll need to follow extra steps if you decide to run this scan outside of your virtual test environment, especially if you’re running the scan over Wi-Fi. In particular, you’ll need to prevent your operating system from interfering by blocking the port that Masscan uses with a firewall. On Linux, the <span class="literal">iptables</span> program allows editing of firewall rules. Run the following command to create a new rule:</p>
		<p class="programs">kali@kali:~$ <span class="codestrong1">iptables -A INPUT -p tcp --dport 3000 -j DROP</span></p>
		<p class="indent"><span epub:type="pagebreak" id="page_143"/>This rule drops (<span class="literal">-j DROP</span>) all incoming (<span class="literal">-A INPUT</span>) packets associated with the TCP protocol (<span class="literal">-p tcp</span>) on port 3000 (<span class="literal">--dport</span>3000). I discuss firewalls in more detail in <a href="ch16.xhtml#ch16">Chapter 16</a>. For additional nuances on Masscan, read the Masscan documentation at <em><a href="https://github.com/robertdavidgraham/masscan/">https://github.com/robertdavidgraham/masscan/</a></em>.</p>
		<h4 class="h4" id="ch08lev11"><strong><em>Shodan</em></strong></h4>
		<p class="noindent">Like Google, <em>Shodan</em> is a search engine. But unlike Google, which searches for web pages, Shodan searches for active IP addresses. When it finds one, it collects as much information about that device as it can, including information on the device’s operating system, open ports, software versions, and location. Shodan catalogs this information and makes it searchable through a web page and Python API, so when hackers and security researchers discover a software vulnerability, they can use Shodan to find vulnerable devices.</p>
		<p class="indent">For example, the following search query returns Apache version 2.4.46 web servers that support HTTPS:</p>
		<p class="programs">apache 2.4.46 https</p>
		<p class="indent"><a href="ch08.xhtml#ch8fig7">Figure 8-7</a> shows the redacted result of running the query on Shodan.</p>
		<div class="image" id="ch8fig7">
			<img alt="image" src="../images/ch08fig07.jpg"/>
		</div>
		<p class="figcap"><em>Figure 8-7: The redacted results of running a query on Shodan</em></p>
		<p class="indent"><span epub:type="pagebreak" id="page_144"/>Shodan also supports several filters for refining the search results. For example, the <span class="literal">os</span> filter limits the results to include only certain operating systems and the <span class="literal">city</span> filter limits results to machines in a specific city. The following search query returns Linux servers in Charlottesville, Virginia, that run Apache and support HTTPS:</p>
		<p class="programs">os:linux city:Charlottesville apache 2.4.46 https</p>
		<p class="indent">You can find a list of Shodan filters at <em><a href="https://github.com/JavierOlmedo/shodan-filters/">https://github.com/JavierOlmedo/shodan-filters/</a></em>. Shodan allows only registered users to run filtered queries, but you can always register with your Protonmail account.</p>
		<p class="indent">However, there’s a downside to using Shodan: it logs your IP address every time you query Shodan. This is bad, because Shodan now knows your IP address and who you’re scanning. Thus, it might be better to set up your own scanning machine. In <a href="ch16.xhtml#ch16">Chapter 16</a>, I’ll show you how you can set up such an anonymous hacking environment. Now let’s discuss some limitations of current scanning methods.</p>
		<h3 class="h3" id="ch08lev12"><strong>IPv6 and NAT Limitations</strong></h3>
		<p class="noindent">Internet scanners are unable to scan private IP ranges behind routers that implement a system called <em>network address translation (NAT)</em>. This means that, often, the only devices that show up on public scans are public devices like cable modems and the Wi-Fi routers. To understand NAT and how it affects scanning, we must first discuss the limitations of IPv4.</p>
		<h4 class="h4" id="ch08lev13"><strong><em>Internet Protocol Version 6 (IPv6)</em></strong></h4>
		<p class="noindent">So far, I’ve discussed scanning the approximately four billion possible addresses in IPv4. However, there are approximately eight billion people on Earth, some of whom have multiple devices like phones, laptops, video game consoles, and IoT devices. There are approximately 50 billion internet-connected devices. Four billion addresses is not enough.</p>
		<p class="indent">Two solutions were proposed to deal with this problem. The first was to share a single IP address between multiple people using NAT and the second was to create a new version of IP called <em>Internet Protocol (IPv6)</em> that contains a larger number of possible addresses.</p>
		<p class="indent">The designers of IPv6 proposed allocating more bits to each IP address. Instead of using 32-bit IPv4 addresses, IPv6 addresses are 128 bits long, which increases the number of possible IP addresses from four billion to 2<sup>128</sup>, or 340 undecillion (one trillion multiplied by itself three times).</p>
		<p class="indent">Unlike IPv4 addresses, for which 8-bit segments are represented by decimal numbers between 0 and 255, IPv6 addresses are represented as hexadecimal numbers, each of which represents an 8-bit sequence. IPv6 addresses <span epub:type="pagebreak" id="page_145"/>are commonly written as eight pairs of hexadecimal numbers separated by colons. Following is an example of an IPv6 address:</p>
		<p class="programs">81d2:1e2f:426b:f4d1:6669:3f50:bf31:bc0e</p>
		<p class="indent">Because the IPv6 search space is so large, tools like Masscan can’t scan every IPv6 address.</p>
		<p class="indent">You might be wondering why some machines still use IPv4 if a new standard exists. Switching to IPv6 requires updating the NICs and routers in the network. So, until infrastructure is updated, several systems will need to maintain backward compatibility with IPv4.</p>
		<h4 class="h4" id="ch08lev14"><strong><em>NAT</em></strong></h4>
		<p class="noindent">Because we can’t instantaneously upgrade all the equipment in the network to IPv6, home Wi-Fi routers use NAT to allow all devices in the home to share a single IP address. For example, consider the small home network depicted in <a href="ch08.xhtml#ch8fig8">Figure 8-8</a>, consisting of a laptop and mobile phone.</p>
		<div class="image" id="ch8fig8">
			<img alt="image" src="../images/ch08fig08.jpg"/>
		</div>
		<p class="figcap"><em>Figure 8-8: Example home network that uses NAT</em></p>
		<p class="indent">The cable modem is assigned a single IP address by the ISP, and it shares that address with the Wi-Fi router (the cable modem and router are bundled into a single device in some home networks). The router then creates its own internal LAN that contains the IP addresses in private IP range like 192.168.0.0/16 or 10.0.0.0/8. These IP addresses are completely internal and will never be seen by an external network.</p>
		<p class="indent">The Wi-Fi router must also map those internal IP addresses to a single external IP address. How is this possible? The router manages the mapping using port numbers. For example, the laptop may be mapped to the external IP address on port 1, whereas the mobile device may be mapped to the same external IP address on port 2.</p>
		<p class="indent">But remember that network communication occurs between processes, and each device (like the laptop and phone) may be running multiple <span epub:type="pagebreak" id="page_146"/>processes. Thus, the devices might each need multiple ports through which to make connections. We can solve this problem by assigning a unique port to each process. For example, the browser process running on port 562 of the laptop with IP address 192.168.1.101 might be assigned the external address (168.1.25.153) on port 8002, whereas the game running on port 452 of the laptop is assigned to port 5002 on the same external address. The table that keeps track of these assignments is called the NAT table.</p>
		<p class="indent">You can see an example of this kind of mapping in <a href="ch08.xhtml#ch8fig9">Figure 8-9</a>. When the packet leaves the internal network, the source IP is replaced with an entry in the NAT table, making it appear as though all the traffic is coming from a single IP address running multiple processes.</p>
		<div class="image" id="ch8fig9">
			<img alt="image" src="../images/ch08fig09.jpg"/>
		</div>
		<p class="figcap"><em>Figure 8-9: How the source IP address and port are replaced</em></p>
		<p class="indent">If a packet arrives at the modem at 168.1.25.153 on port 8002, the modem will forward it to the router, which then will replace the destination address with the corresponding private address.</p>
		<p class="indent">NAT also prevents scanning services like Masscan from directly connecting to devices connected to routers that implement NAT. This is why we designed the reverse shell in <a href="ch04.xhtml#ch4">Chapter 4</a>. It initiated the connection to the server, and not the other way around.</p>
		<h3 class="h3" id="ch08lev15"><strong>Vulnerability Databases</strong></h3>
		<p class="noindent"><em>Vulnerability databases</em> contain collections of known vulnerabilities. As I’ve discussed, once a hacker uses OSINT techniques to learn about a victim’s systems, they can search vulnerability databases for a way to access those systems.</p>
		<p class="indent">One popular vulnerability database is Exploit Database (<em><a href="https://exploit-db.com/">https://exploit-db.com/</a></em>), which contains information on vulnerabilities and instructions on how to exploit them. <a href="ch08.xhtml#ch8fig10">Figure 8-10</a> shows its interface.</p>
		<div class="image" id="ch8fig10">
			<span epub:type="pagebreak" id="page_147"/>
			<img alt="image" src="../images/ch08fig10.jpg"/>
		</div>
		<p class="figcap"><em>Figure 8-10: Exploit Database’s list of vulnerabilities</em></p>
		<p class="indent">In addition, NIST maintains the <em>National Vulnerability Database (NVD)</em>, which contains a collection of known vulnerabilities, at <em><a href="https://nvd.nist.gov/vuln/search">https://nvd.nist.gov/vuln/search</a></em>. NIST also provides feeds that allow ethical hackers to get updates when new vulnerabilities are discovered. This database is synced with the <em>Common Vulnerabilities and Exposures (CVE)</em> database maintained by Mitre. <a href="ch08.xhtml#ch8fig11">Figure 8-11</a> shows a CVE database entry about an Apache vulnerability.</p>
		<div class="image" id="ch8fig11">
			<img alt="image" src="../images/ch08fig11.jpg"/>
		</div>
		<p class="figcap"><em>Figure 8-11: Entry for Apache Server CVE 2020-9491 vulnerability</em></p>
		<p class="indent">CVE entries follow a particular naming structure: CVE-YYYY-NNNN, where YYYY represents the year the vulnerability was discovered, and NNNN is a unique number assigned to the vulnerability.</p>
		<p class="indent">These tools can do damage in the wrong hands. For example, an attacker may receive an NVD update about a new CVE vulnerability and then search Shodan for devices running vulnerable software. This scenario isn’t just hypothetical. In October 2020, the NSA released the top CVE vulnerabilities exploited by one particular state actor. Researchers will continue to discover new vulnerabilities and new lists of preferred vulnerabilities will emerge, so the cycle will continue. This is why it’s so important to keep your systems updated and patched.</p>
		<p class="indent">You can also search these databases from the Kali Linux command line by running the following:</p>
		<p class="programs">searchsploit <span class="codeitalic">&lt;keywords&gt;</span></p>
		<p class="indent"><span epub:type="pagebreak" id="page_148"/>For example, the following search shows the results of running a <span class="literal">searchsploit</span> query on Apache 2.4:</p>
		<p class="programs">kali@kali:~/Desktop\$ <span class="codestrong1">searchsploit apache 2.4</span><br/>
-----------------------------------------------------------------------------------------<br/>Exploit Title                                                       |  Path<br/>
----------------------------------------------------------------------------------------<br/>Apache + PHP &lt; 5.3.12 / &lt; 5.4.2 cgi-bin Remote Code Execution     | php/remote/29290.c<br/>Apache + PHP &lt; 5.3.12 / &lt; 5.4.2 Remote Code Execution + Scanner   | php/remote/29316.py<br/>Apache 2.2.4 413 Error HTTP Request Method Cross-Site Scripting   | unix/remote/30835.sh<br/>Apache 2.4.17 Denial of Service                                   | windows/dos/39037.php<br/>Apache 2.4.17 &lt; 2.4.38 'apache2ctl graceful' 'logrotate'Local..   | linux/local/46676.php<br/>Apache 2.4.23 mod_http2 Denial of Service                         | linux/dos/40909.py<br/>Apache 2.4.7 + PHP 7.0.2 'openssl_seal()'Uninitialized Memory..   | php/remote/40142.php<br/>Apache 2.4.7 mod_status Scoreboard Handling Race Condition        | linux/dos/34133.txt<br/>Apache &lt; 2.2.34 / &lt; 2.4.27 OPTIONS Memory Leak                    | linux/webapps/42745.py</p>
		<p class="indent">Each entry contains the name of the vulnerability and a path to a script that a hacker can use to exploit it. You can view the exploitation script by using the <span class="literal">-p</span> flag followed by the unique number that identifies the exploit. Each exploit file is named using a unique number. For example, the second Remote Code Execution exploit is named <em>29316.py</em>, so we can view information on the file that implements the exploit by using the following command:</p>
		<p class="programs">kali@kali:~$ <span class="codestrong1">searchsploit -p 29316</span><br/>
  Exploit: Apache + PHP &lt; 5.3.12 / &lt; 5.4.2 - Remote Code Execution + Scanner<br/>
      URL: https://www.exploit-db.com/exploits/29316<br/>
   <span class="ent">➊</span> Path: /usr/share/exploitdb/exploits/php/remote/29316.py<br/>File Type: Python script, ASCII text executable, with CRLF line terminators</p>
		<p class="indent">You can view the exploit code by opening the file at the path shown <span class="ent">➊</span>. I’ll discuss exploits in more detail in <a href="ch09.xhtml#ch9">Chapter 9</a>.</p>
		<h3 class="h3" id="ch08lev16"><strong>Vulnerability Scanners</strong></h3>
		<p class="noindent">Searching the vulnerability database for each system configuration is tedious. Luckily, vulnerability scanners can automatically scan systems and identify any vulnerabilities present. In this section, I’ll discuss a commercial solution called <em>Nessus</em>; however, there are also open source ones like the OpenVAS and Metasploit’s Nexpose scanning module.</p>
		<p class="indent">The <em>Nessus Home</em> scanner is free, but it is limited to 16 IP addresses. We’ll use it to scan your virtual lab environment. Open the browser on your Kali Linux virtual machine and download the Nessus scanner for Debian from <em><a href="https://www.tenable.com/downloads/nessus/">https://www.tenable.com/downloads/nessus/</a></em>.</p>
		<p class="indent">Next, open a terminal and go to the folder with the downloaded file:</p>
		<p class="programs">kali@kali:~$ <span class="codestrong1">cd ~/Downloads</span></p>
		<p class="indent"><span epub:type="pagebreak" id="page_149"/>Use the Debian package management system to install the file by running the following command:</p>
		<p class="programs">kali@kali:~/Downloads$ <span class="codestrong1">sudo dpkg -i Nessus-<span class="codeitalic">&lt;version number&gt;</span>-debian6_amd64.deb</span></p>
		<p class="indent">Remember to replace the Nessus version number with the version you downloaded. Next, run the following commands to start the Nessus service:</p>
		<p class="programs">kali@kali:~/Downloads$ <span class="codestrong1">sudo systemctl enable nessusd</span><br/>kali@kali:~/Downloads$ <span class="codestrong1">sudo systemctl start nessusd</span></p>
		<p class="indent">You can access Nessus through your browser. Open Firefox on Kali Linux and enter the following URL to connect to the Nessus server that is running on your Kali Linux virtual machine:</p>
		<p class="programs">https://127.0.0.1:8834/</p>
		<p class="indent">You should see a security warning. This is because the server is using a self-signed certificate like the one we generated in <a href="ch06.xhtml#ch6">Chapter 6</a>, and your browser is unable to verify the certificate with the PKI. Not to worry: this certificate is safe, and you can add an exception. In the browser, click <strong>Advanced</strong> and select <strong>Accept the Risk and Continue</strong> (see <a href="ch08.xhtml#ch8fig12">Figure 8-12</a>).</p>
		<div class="image" id="ch8fig12">
			<img alt="image" src="../images/ch08fig12.jpg"/>
		</div>
		<p class="figcap"><em>Figure 8-12: Accepting a certificate that isn’t validated by the PKI</em></p>
		<p class="indent">Start all of the devices in your virtual lab environment and run the <span class="literal">netdiscover</span> tool that we discussed in <a href="ch02.xhtml#ch2">Chapter 2</a> to get the IP addresses of all machines in your virtual lab environment.</p>
		<p class="indent">Next, in Nessus, click the <strong>All Scans</strong> tab and then the <strong>New Scans</strong> button to create your first scan. Here, you can also see all of the scans you can perform with Nessus. Select a basic scan (<a href="ch08.xhtml#ch8fig13">Figure 8-13</a>).</p>
		<div class="image" id="ch8fig13">
			<span epub:type="pagebreak" id="page_150"/>
			<img alt="image" src="../images/ch08fig13.jpg"/>
		</div>
		<p class="figcap"><em>Figure 8-13: A list of available scans</em></p>
		<p class="indent">Fill out the information for your scan. We’ll limit this to just the Metasploitable machine, so add its IP address to the list of hosts. (Remember, you can log in to the Metasploitable machine using the username <strong>msfadmin</strong> and password <strong>msfadmin</strong> and then run the <span class="literal"><strong>ifconfig</strong></span> command to obtain the virtual machine’s IP address.) <a href="ch08.xhtml#ch8fig14">Figure 8-14</a> shows these settings.</p>
		<div class="image" id="ch8fig14">
			<img alt="image" src="../images/ch08fig14.jpg"/>
		</div>
		<p class="figcap"><em>Figure 8-14: Create a new Nessus scan.</em></p>
		<p class="indent"><span epub:type="pagebreak" id="page_151"/>Launch the scan. When the scan completes, click the <strong>Vulnerabilities</strong> tab to see a list of vulnerabilities (<a href="ch08.xhtml#ch8fig15">Figure 8-15</a>).</p>
		<div class="image" id="ch8fig15">
			<img alt="image" src="../images/ch08fig15.jpg"/>
		</div>
		<p class="figcap"><em>Figure 8-15: Vulnerabilities detected by the scan</em></p>
		<p class="indent">Notice that the scan detected a backdoor. This is the same backdoor we exploited earlier. Once a hacker has identified this vulnerability, they could execute the attack discussed in <a href="ch01.xhtml#ch1">Chapter 1</a> and gain root shell access to the machine.</p>
		<h3 class="h3" id="ch08lev17"><strong>Exercises</strong></h3>
		<p class="noindent">Explore other OSINT tools by attempting the following exercises. I’ve ordered the exercise by increasing difficulty. In the first exercise, you’ll use <span class="literal">nmap</span> to collect information about a server by performing different <span class="literal">nmap</span> scans. In the second exercise, you’ll use the Discover tool to run multiple OSINT tools and aggregate the result into a single report. In the third and final exercise, you will write your own OSINT tool that will retrieve an administrator’s email address from the whois database and check a leaked password list to see if it contains a plaintext password entry.</p>
		<h4 class="h4" id="ch08lev18"><span epub:type="pagebreak" id="page_152"/><strong><em>nmap Scans</em></strong></h4>
		<p class="noindent">I’ve listed some sample <span class="literal">nmap</span> scans in the code that follows. The first scan uses the <span class="literal">http-enum</span> script in <span class="literal">nmap</span> to enumerate the files and folders on a website. This is a great way to discover hidden files or directories:</p>
		<p class="programs">kali@kali:~$ <span class="codestrong1">sudo nmap -sV -p 80 --script http-enum <span class="codeitalic">&lt;IP address of victim</span></span><br/>
    
			<img alt="image" src="../images/arrow01.jpg"/> <span class="codestrong1"><span class="codeitalic">machine&gt;</span></span></p>
		<p class="indent">The second <span class="literal">nmap</span> scan attempts to identify the server’s operating system and running servers while avoiding detection:</p>
		<p class="programs">kali@kali:~$ <span class="codestrong1">sudo nmap -A -sV -D <span class="codeitalic">&lt;decoy-IP-1,decoy-IP-2,MY-IP,decoy-IP-3...&gt; &lt;</span></span><br/>
    
			<img alt="image" src="../images/arrow01.jpg"/> <span class="codestrong1"><span class="codeitalic">IP address of victim machine&gt;</span></span></p>
		<p class="indent">The <span class="literal">-A</span> option enables operating system detection, version detection, script scanning, and traceroute. The <span class="literal">-D</span> flag enables scanning with decoys, which attempt to avoid firewall detection by sending dummy packets with a fake source IP address along with the scanning machine’s real IP address. The third example uses <span class="literal">nmap</span> as a vulnerability scanner.</p>
		<p class="programs">kali@kali:~$ <span class="codestrong1">sudo nmap -sV --script vulners <span class="codeitalic">&lt;IP address of victim machine&gt;</span></span></p>
		<p class="indent">We supply the <span class="literal">vulners</span> script, which scans a machine and lists the CVE vulnerabilities it detects. You can find a complete list of all <span class="literal">nmap</span> scripts currently installed on your Kali Linux virtual machine by listing the contents of the <em>script</em> directory, as follows:</p>
		<p class="programs">kali@kali:~$ <span class="codestrong1">ls /usr/share/nmap/scripts/</span></p>
		<p class="indent">Lastly, try a scan of all common ports (<span class="literal">-p-</span>) using the default scripts (<span class="literal">-sC</span>), and output the results in normal format (<span class="literal">-oN</span>) to a file called <em>scanResults.nmap</em>:</p>
		<p class="programs">kali@kali:~$ <span class="codestrong1">nmap -sV -sC -p- -oN scanResults.nmap <span class="codeitalic">&lt;IP address of victim machine&gt;</span></span></p>
		<h4 class="h4" id="ch08lev19"><strong><em>Discover</em></strong></h4>
		<p class="noindent"><em>Discover</em> is an open source tool that contains various scripts to automate the OSINT and vulnerability scanning process. After your scans have completed, Discover will generate a report with the information it has found, as shown in <a href="ch08.xhtml#ch8fig16">Figure 8-16</a>.</p>
		<div class="image" id="ch8fig16">
			<span epub:type="pagebreak" id="page_153"/>
			<img alt="image" src="../images/ch08fig16.jpg"/>
		</div>
		<p class="figcap"><em>Figure 8-16: Results of running the Discover scan</em></p>
		<p class="indent">Discover includes two OSINT scanning-tool categories: passive and active. The key difference between these is your likelihood of being detected. Passive scans query records held by third parties, so victims are unlikely to know they’re being scanned. Active scans probe the victim’s infrastructure and are more likely to trigger an alarm.</p>
		<p class="indent">Begin by examining some of Discover’s passive scanning tools:</p>
		<p class="noindentn"><strong>ARIN and Whois</strong>    Identifies IP addresses. (The American Registry for Internet Numbers is the organization that administers IP addresses and hosts the whois database.)</p>
		<p class="noindentn"><strong>dnsrecon</strong>    Collects OSINT from DNS servers. (Also supports active scanning.)</p>
		<p class="noindentn"><strong>goofile</strong>    Searches a domain for specific file types.</p>
		<p class="noindentn"><strong>theHarvester</strong>    Searches public sources on the internet, such as Google and LinkedIn, for email addresses that are associated with a domain under investigation.</p>
		<p class="noindentn"><strong>Metasploit scanning tool</strong>    Performs scans with the Metasploit framework.</p>
		<p class="noindentn"><strong>URLCrazy</strong>    Checks for URL variations that could be used for squatting, like the <em><a href="http://facebeok.com">facebeok.com</a></em> example we considered in <a href="ch07.xhtml#ch7">Chapter 7</a>.</p>
		<p class="noindentn"><strong>Recon-ng</strong>    Contains a variety of tools specifically for web-based open source reconnaissance. (Also supports active scanning.)</p>
		<p class="indent"><span epub:type="pagebreak" id="page_154"/>The following are some active scanning tools:</p>
		<p class="noindentn"><strong>traceroute</strong>    Sends ICMP packets to discover routers along the path to a server.</p>
		<p class="noindentn"><strong>Whatweb</strong>    Probes a website to uncover the technologies used to build it.</p>
		<p class="indent">You don’t have to run these tools individually. The Discover tool will execute them for you and generate a comprehensive report.</p>
		<p class="indent">Run the following command to clone the Discover repository and place it in the <em>opt</em> directory on the Kali Linux virtual machine. This directory contains any Linux programs you install:</p>
		<p class="programs">kali@kali:~$ <span class="codestrong1">sudo git clone https://github.com/leebaird/discover /opt/discover/</span></p>
		<p class="indent">Navigate to the directory containing the repository and run the <em>update.sh</em> script. This will install Discover and all of its dependencies:</p>
		<p class="programs">kali@kali:~$ <span class="codestrong1">cd /opt/discover/</span><br/>kali@kali:~/opt/discover$ <span class="codestrong1">sudo./update.sh</span></p>
		<p class="indent">During the installation process, you’ll be asked to enter information to create a certificate. Remember that you don’t need to use your private information. Just make something up like you did with your previous certificates.</p>
		<p class="indent">The installation process takes some time. In the meantime, create a folder called <em>Results</em> on your Kali Linux desktop. You’ll save your reports there. When your installation is complete, run Discover using the following command:</p>
		<p class="programs">kali@kali:~/opt/discover$ <span class="codestrong1">sudo./discover.sh</span></p>
		<p class="indent">As practice, select the domain option from the <strong>Recon</strong> menu and run both a passive and active scan on a domain that you own or have acquired permission to scan. The scan can take more than an hour to complete.</p>
		<p class="indent">Discover should output the results of the scan to the following folder: <em>/root/data/</em>. Move this to your <em>Results</em> folder for easy access by running the following command:</p>
		<p class="programs">kali@kali:~$ <span class="codestrong1">mv /root/data/ ~/Desktop/Results</span></p>
		<p class="indent">What information did you discover?</p>
		<h4 class="h4" id="ch08lev20"><strong><em>Writing Your Own OSINT Tool</em></strong></h4>
		<p class="noindent">How much of of the web can you PWN on your own? Write a scanner that does a whois lookup on any of the four billion IPv4 addresses. It’s okay to check all IP addresses given that you aren’t connecting to these IP addresses. Instead, you’re looking up the admin’s information in a public database.</p>
		<p class="indent">In other words, you should be able to run</p>
		<p class="programs">kali@kali:~$ <span class="codestrong1">whois 8.8.8.8</span></p>
		<p class="noindent"><span epub:type="pagebreak" id="page_155"/>and extract any email addresses it finds. Then, use the <span class="literal">haveibeenpwnded</span> API available at <em><a href="https://haveibeenpwned.com/API/v2">https://haveibeenpwned.com/API/v2</a></em> to see if the administrator email address was associated with a password leak.</p>
		<p class="indent">For testing purposes, you might want to limit your scan to only a couple of addresses, and then scale it up after your tool works.</p>
		<h5 class="h5" id="ch08lev21"><strong>Bonus</strong></h5>
		<p class="noindent">Check the leaked database containing the 1.4 billion email addresses and passwords you downloaded earlier. Does it contain a password entry for the email address returned by the whois command? Loop through a collection of IP addresses and output a CSV file in which each line contains an IP address, email address, and password.<span epub:type="pagebreak" id="page_156"/></p>
	</body>
</html>