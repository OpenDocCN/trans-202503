<html><head></head><body><div class="chapter" title="Chapter&#xA0;8.&#xA0;Cisco ASA, IDS/IPS, and IOS-XRv"><div class="titlepage"><div><div><h1 class="title"><a id="cisco_asacomma_idssolidusipscomma_and_io"/>Chapter 8. Cisco ASA, IDS/IPS, and IOS-XRv</h1></div></div></div><p><a id="iddle1017" class="indexterm"/><a id="iddle1043" class="indexterm"/><a id="iddle1050" class="indexterm"/><a id="iddle1098" class="indexterm"/><a id="iddle1120" class="indexterm"/><a id="iddle1480" class="indexterm"/>You’ve already seen some of the ways GNS3 can interact with other software and operating systems. In this chapter, you’ll delve deeper into the advanced features of GNS3 and explore how you can expand your projects by interacting with additional Quick Emulator (QEMU) virtual devices and software.</p><p>Knowing about technologies such as Cisco’s ASAs, Intrusion Detection Systems/Intrusion Prevention Systems (IDSs/IPSs), and IOS-XR broadens your view of Cisco and GNS3 and can be useful when choosing a network certification path. Plus, it’s a lot of fun to play with virtualized Cisco products that are otherwise inaccessible to most people. It’s also important to learn how to use some of Cisco’s GUI-based tools.</p><p>I’ll begin by showing you how to install Cisco Configuration Professional (CCP) software, a web-based alternative to configuring routers via the Cisco command line interface. Next, you’ll learn how to configure and run an ASA. I’ll discuss using Cisco’s Adaptive Security Device Manager (ASDM) <a id="iddle1099" class="indexterm"/><a id="iddle1100" class="indexterm"/><a id="iddle1366" class="indexterm"/><a id="iddle1799" class="indexterm"/><a id="iddle1993" class="indexterm"/><a id="iddle2069" class="indexterm"/><a id="iddle2408" class="indexterm"/>software, which is similar to the CCP software mentioned earlier but used to configure ASAs. By the end of the chapter, you’ll learn that patience is not only a virtue but a prerequisite when you set up a Cisco IDS/IPS. Finally, I’ll show you how to configure and use Cisco IOS-XRv devices in GNS3.</p><div class="sect1" title="Cisco Configuration Professional"><div class="titlepage"><div><div><h1 class="title"><a id="cisco_configuration_professional"/>Cisco Configuration Professional</h1></div></div></div><p>Most engineers use IOS commands to configure routers and switches, but there are other ways. CCP is a web-based alternative that uses “smart wizards” to simplify router configuration, and it provides tools to help you monitor and troubleshoot networks and VPNs. In a nutshell, CCP allows less experienced users to get their equipment up and running.</p><div class="sect2" title="Project Configuration"><div class="titlepage"><div><div><h2 class="title"><a id="project_configuration"/>Project Configuration</h2></div></div></div><p>To use CCP with GNS3, you’ll create a simple project using one router and a VirtualBox virtual machine running Microsoft Windows, as in <a class="xref" href="ch08.html#ccp_topology_with_a_router_and_windows_h" title="Figure 8-1. CCP topology with a router and Windows host">Figure 8-1</a>. Although there are other methods to do this, I’ve chosen to demonstrate this method because it should work on any PC that’s running GNS3 (Windows, Linux, and OS X).</p><div class="figure"><a id="ccp_topology_with_a_router_and_windows_h"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00095"/><img src="httpatomoreillycomsourcenostarchimages2209059.png.jpg" alt="CCP topology with a router and Windows host"/></div></div><p class="title">Figure 8-1. CCP topology with a router and Windows host</p></div><p>Log on to the Windows computer and disable the firewall to ensure that CCP has unrestricted communication with your router. (This isn’t mandatory, but it may prevent headaches later.) Assign the Windows guest an IP address on the same subnet as your router (in this example, 10.10.10.100).</p><p>Next, create a basic configuration on your router.</p><a id="pro_id00104"/><pre class="programlisting">➊ R1(config)# <span class="strong"><strong>ip http server</strong></span>
  R1(config)# <span class="strong"><strong>ip http secure-server</strong></span>
  R1(config)# <span class="strong"><strong>ip http authentication local</strong></span>
➋ R1(config)# <span class="strong"><strong>username admin privilege 15 secret cisco</strong></span>
  R1(config)# <span class="strong"><strong>interface f0/0</strong></span>
➌ R1(config-if)# <span class="strong"><strong>ip address 10.10.10.1 255.255.255.0</strong></span>
  R1(config-if)# <span class="strong"><strong>no shutdown</strong></span></pre><p>You need to enable the router’s web server ➊, create a user with full EXEC mode privileges ➋, and assign an IP address to the interface ➌. In this example, the router is assigned IP address 10.10.10.1.</p><div class="note" title="Note"><h3 class="title"><a id="ch08note01"/>Note</h3><p><span class="emphasis"><em>You have to create a Cisco admin account with full EXEC mode privileges (privilege 15) so that later you’ll have sufficient rights to configure the router using CCP.</em></span></p></div><p><a id="iddle1025" class="indexterm"/><a id="iddle1097" class="indexterm"/><a id="iddle1101" class="indexterm"/><a id="iddle1230" class="indexterm"/><a id="iddle1265" class="indexterm"/><a id="iddle1522" class="indexterm"/><a id="iddle1674" class="indexterm"/><a id="iddle1774" class="indexterm"/><a id="iddle1964" class="indexterm"/><a id="iddle2101" class="indexterm"/>After configuring the router, test connectivity between the Windows guest and the router using a <code class="literal">ping</code> command.</p><a id="pro_id00105"/><pre class="programlisting">C:&gt; <span class="strong"><strong>ping 10.10.10.1</strong></span></pre><p>If you can successfully ping the router, then it’s safe to proceed. If you cannot ping the router, check your IP addresses and interfaces.</p></div><div class="sect2" title="CCP Installation"><div class="titlepage"><div><div><h2 class="title"><a id="ccp_installation"/>CCP Installation</h2></div></div></div><p>CCP is a Java-based application that interacts with a web browser, so before you begin, download and install Java if you don’t have it already (<span class="emphasis"><em><a class="ulink" href="http://www.java.com/">http://www.java.com/</a></em></span>). Make sure you also have the latest version of Adobe Flash Player (<span class="emphasis"><em><a class="ulink" href="http://www.adobe.com/">http://www.adobe.com/</a></em></span>). You can download Cisco Configuration Professional from the Cisco website (<span class="emphasis"><em><a class="ulink" href="http://www.cisco.com/">http://www.cisco.com/</a></em></span>).</p><p>To install CCP, log on to your Windows virtual machine and launch the setup program; you should see the CCP installation wizard. Click <span class="strong"><strong>Next</strong></span> and follow the instructions to complete the setup.</p></div><div class="sect2" title="Running CCP"><div class="titlepage"><div><div><h2 class="title"><a id="running_ccp"/>Running CCP</h2></div></div></div><p>Launch Cisco Configuration Professional by right-clicking the program icon and choosing <span class="strong"><strong>Run as Administrator</strong></span>. When the program opens, you’ll be asked for the IP address of a router you want to manage. You should see the CCP Device Manager, shown in <a class="xref" href="ch08.html#ccp_device_manager" title="Figure 8-2. CCP Device Manager">Figure 8-2</a>.</p><div class="figure"><a id="ccp_device_manager"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00096"/><img src="httpatomoreillycomsourcenostarchimages2209061.png.jpg" alt="CCP Device Manager"/></div></div><p class="title">Figure 8-2. CCP Device Manager</p></div><p><a id="iddle1044" class="indexterm"/><a id="iddle1224" class="indexterm"/><a id="iddle1300" class="indexterm"/><a id="iddle2070" class="indexterm"/>Enter the IP address you assigned to the router (<span class="strong"><strong>10.10.10.1</strong></span>), enter the administrator username and password you assigned earlier (<span class="strong"><strong>admin</strong></span> and <span class="strong"><strong>cisco</strong></span>), and then click <span class="strong"><strong>OK</strong></span>. After logging on, you should see the CCP management screen, shown in <a class="xref" href="ch08.html#cisco_ccp_management_screen" title="Figure 8-3. Cisco CCP management screen">Figure 8-3</a>.</p><div class="figure"><a id="cisco_ccp_management_screen"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00097"/><img src="httpatomoreillycomsourcenostarchimages2209063.png.jpg" alt="Cisco CCP management screen"/></div></div><p class="title">Figure 8-3. Cisco CCP management screen</p></div><p>Before you can manage your router, you have to select it by first clicking the router hostname R1 ➊ and then clicking <span class="strong"><strong>Discover</strong></span> ➋ so CCP can discover its features and capabilities. After it’s been discovered, you can set up your router by clicking <span class="strong"><strong>Configure</strong></span> ➌ in the toolbar. The advantage of using CCP is that it guides you through the process of assigning IP addresses, NAT, VPNs, and other Cisco features without you having to know any IOS commands. Be aware that Cisco certification exams primarily focus on IOS commands, and not CCP, to configure devices.</p></div></div><div class="sect1" title="Cisco ASA Firewall"><div class="titlepage"><div><div><h1 class="title"><a id="cisco_asa_firewall"/>Cisco ASA Firewall</h1></div></div></div><p>Cisco’s ASA is an improved version of the old PIX firewall. GNS3 emulates a Cisco ASA model 5520. Although it’s not a router, you may be surprised to learn that the ASA supports several routing protocols, including RIP, EIGRP, and OSPF, allowing you to easily network them with other GNS3 routed devices.</p><div class="sect2" title="Acquiring an Image"><div class="titlepage"><div><div><h2 class="title"><a id="acquiring_an_image"/>Acquiring an Image</h2></div></div></div><p><a id="iddle1016" class="indexterm"/><a id="iddle1039" class="indexterm"/><a id="iddle1041" class="indexterm"/><a id="iddle1045" class="indexterm"/><a id="iddle1048" class="indexterm"/><a id="iddle1049" class="indexterm"/><a id="iddle1119" class="indexterm"/><a id="iddle1200" class="indexterm"/><a id="iddle1396" class="indexterm"/><a id="iddle1492" class="indexterm"/><a id="iddle1749" class="indexterm"/><a id="iddle2006" class="indexterm"/><a id="iddle2010" class="indexterm"/><a id="iddle2029" class="indexterm"/><a id="iddle2224" class="indexterm"/><a id="iddle2284" class="indexterm"/><a id="iddle2338" class="indexterm"/>Before you can use an ASA virtual machine with GNS3, you need an image file of the ASA operating system. The fastest way to get an image of the ASA operating system is to copy it from an ASA you already own (that is, from the ASA installation CD or directly from an ASA device). Copying files from a Cisco ASA works the same way as copying files from a Cisco router: you can use FTP or TFTP. In this example, you’ll use a TFTP server. There are plenty of free TFTP servers to choose from, so find one you like and install it on your PC.</p><p>After you have a TFTP server running on your network, log on to your physical ASA and copy your ASA image file to your PC. In the following listing, my ASA image file is named <span class="emphasis"><em>asa824-k8.bin</em></span>, and my TFTP server is running on a PC at IP address 192.168.1.100:</p><a id="pro_id00106"/><pre class="programlisting">ciscoasa# <span class="strong"><strong>copy flash:asa824-k8.bin tftp</strong></span>
Address or name of remote host []? <span class="strong"><strong>192.168.1.100</strong></span></pre><p>After you have an ASA image file, you need to make some modifications to the file before you can use it with GNS3.</p></div><div class="sect2" title="Prepping the ASA Image for GNS3"><div class="titlepage"><div><div><h2 class="title"><a id="prepping_the_asa_image_for_gns3"/>Prepping the ASA Image for GNS3</h2></div></div></div><p>The Cisco ASA is really just a small Linux PC, and ASA image files like <span class="emphasis"><em>asa824-k8.bin</em></span> contain a compact Linux operating system designed to run on ASA hardware.</p><p>The image file includes a Linux kernel and other support software for the appliance. To run the ASA software using GNS3, you have to unpack the <span class="emphasis"><em>.bin</em></span> file, make some modifications, and repack it in a way that’s suitable for QEMU. Fortunately, there are plenty of clever people in the Linux and Cisco communities who have written image unpacker software that does this for you. You can download Cisco Image Unpacker for Windows from the GNS3 website, or you can use a Linux shell script like <span class="emphasis"><em>repack.v4.sh</em></span>. Regardless of which unpacker you choose, you’ll need to find one designed for your version of ASA software. After running the script, you should be left with two files: <span class="emphasis"><em>asa-vmlinuz</em></span> (a Linux kernel) and <span class="emphasis"><em>asa-initrd.gz</em></span> (a RAM disk file). These are the files used by QEMU and GNS3.</p><p>If you don’t want to modify your own ASA image file, a quick Internet search should turn up plenty of ready-to-use ASA files. These images usually come in a <span class="emphasis"><em>.zip</em></span> file that contains the two files (<span class="emphasis"><em>asa-vmlinux</em></span> and <span class="emphasis"><em>asa-initrd.gz</em></span>).</p></div><div class="sect2" title="Configuring GNS3 for ASA"><div class="titlepage"><div><div><h2 class="title"><a id="configuring_gns3_for_asa"/>Configuring GNS3 for ASA</h2></div></div></div><p>Before configuring an ASA in GNS3, check that QEMU is installed and tested on your PC. (See the QEMU installation information for your particular operating system in <a class="xref" href="ch06.html" title="Chapter 6. Juniper Olive and VSRX Firefly">Chapter 6</a>.) Next, launch GNS3, select <span class="strong"><strong>Edit</strong></span> ▸ <span class="strong"><strong>Preferences</strong></span> on Linux and Windows or <span class="strong"><strong>GNS3</strong></span> ▸ <span class="strong"><strong>Preferences</strong></span> on OS X, and choose <span class="strong"><strong>QEMU VMs</strong></span> from the panel on the left, as shown in <a class="xref" href="ch08.html#qemu_vms_preferences" title="Figure 8-4. QEMU VMs preferences">Figure 8-4</a>.</p><div class="figure"><a id="qemu_vms_preferences"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00098"/><img src="httpatomoreillycomsourcenostarchimages2209065.png.jpg" alt="QEMU VMs preferences"/></div></div><p class="title">Figure 8-4. QEMU VMs preferences</p></div><p><a id="iddle1860" class="indexterm"/>To create a new ASA in GNS3, click <span class="strong"><strong>New</strong></span> to start the New QEMU VM wizard. Select <span class="strong"><strong>ASA 8.4(2)</strong></span> from the Type drop-down menu, as shown in <a class="xref" href="ch08.html#creating_a_new_qemu_virtual_machine_and" title="Figure 8-5. Creating a new QEMU virtual machine and setting Type to ASA 8.4(2)">Figure 8-5</a>.</p><div class="figure"><a id="creating_a_new_qemu_virtual_machine_and"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00099"/><img src="httpatomoreillycomsourcenostarchimages2209067.png.jpg" alt="Creating a new QEMU virtual machine and setting Type to ASA 8.4(2)"/></div></div><p class="title">Figure 8-5. Creating a new QEMU virtual machine and setting Type to ASA 8.4(2)</p></div><p>By default your device is automatically named <a class="firstterm" href="apd.html#gloss01_004"><em class="firstterm">ASA</em></a>, but you can rename it whatever you prefer. When you’re done naming your ASA, click <span class="strong"><strong>Next</strong></span> to continue.</p><p><a id="iddle1064" class="indexterm"/><a id="iddle1515" class="indexterm"/><a id="iddle1709" class="indexterm"/><a id="iddle1724" class="indexterm"/><a id="iddle1787" class="indexterm"/><a id="iddle2047" class="indexterm"/>The wizard should automatically locate and choose the correct QEMU binary file for your PC, as shown in <a class="xref" href="ch08.html#selecting_the_asa_virtual_machineapostro" title="Figure 8-6. Selecting the ASA virtual machine’s QEMU binary and memory">Figure 8-6</a>.</p><div class="figure"><a id="selecting_the_asa_virtual_machineapostro"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00100"/><img src="httpatomoreillycomsourcenostarchimages2209069.png.jpg" alt="Selecting the ASA virtual machine’s QEMU binary and memory"/></div></div><p class="title">Figure 8-6. Selecting the ASA virtual machine’s QEMU binary and memory</p></div><p>If it does not find a QEMU binary, verify that QEMU is installed correctly on your PC and try again. The default RAM value is 1024MB, but this is the minimum amount required to run the ASA image. You can increase the value by entering a new value in the field. When you’re done, click <span class="strong"><strong>Next</strong></span> to continue the wizard.</p><p>The last step is to browse and select your initial RAM disk and kernel image, as shown in <a class="xref" href="ch08.html#linux_boot-specific_settings_for_an_asa" title="Figure 8-7. Linux boot-specific settings for an ASA virtual machine">Figure 8-7</a>.</p><div class="figure"><a id="linux_boot-specific_settings_for_an_asa"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00101"/><img src="httpatomoreillycomsourcenostarchimages2209071.png.jpg" alt="Linux boot-specific settings for an ASA virtual machine"/></div></div><p class="title">Figure 8-7. Linux boot-specific settings for an ASA virtual machine</p></div><p>Set Initial Ram disk (initrd) and Kernel image to the correct files for your computer; these are usually named <span class="emphasis"><em>asa842-initrd.gz</em></span> and <span class="emphasis"><em>asa842-vmlinuz</em></span>, respectively.</p><p><a id="iddle1107" class="indexterm"/><a id="iddle1247" class="indexterm"/><a id="iddle1250" class="indexterm"/><a id="iddle1972" class="indexterm"/><a id="iddle2030" class="indexterm"/>When you’re done choosing the two images, click <span class="strong"><strong>Finish</strong></span> to complete the installation. After successfully adding your ASA, the ASA device should be displayed in the QEMU VM Preferences window, as shown in <a class="xref" href="ch08.html#qemu_vms_preferences_for_an_asa_virtual" title="Figure 8-8. QEMU VMs preferences for an ASA virtual machine">Figure 8-8</a>.</p><div class="figure"><a id="qemu_vms_preferences_for_an_asa_virtual"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00102"/><img src="httpatomoreillycomsourcenostarchimages2209073.png.jpg" alt="QEMU VMs preferences for an ASA virtual machine"/></div></div><p class="title">Figure 8-8. QEMU VMs preferences for an ASA virtual machine</p></div><p>The current settings of your ASA should be displayed in the panel on the right, and one setting you should note is CPU throttling (located under Optimizations).</p><p>Unlike Dynamips devices, the ASA does not have an Idle-PC option to control CPU consumption. This means that an ASA can consume your entire CPU, much like a Dynamips router does when no Idle-PC value has been set. To prevent this, GNS3 uses another open source application (cpulimit) to adjust the maximum amount of CPU that a QEMU/ASA instance can consume. The default value is 80 percent, which works well in most situations. You can edit your ASA settings and raise or lower the value, but be careful; using too little of your CPU, by decreasing the percentage, can result in poor ASA performance and frequent ASA crashes, and setting the percentage too high can result in slower overall PC performance.</p><p>Another setting to note under Optimizations is the Process priority. The default value in GNS3 is low, but it can be set to low, medium, or high. The Process priority determines when the QEMU/ASA instance gets CPU time. <a id="iddle1046" class="indexterm"/><a id="iddle1226" class="indexterm"/><a id="iddle1251" class="indexterm"/><a id="iddle1738" class="indexterm"/><a id="iddle1844" class="indexterm"/><a id="iddle1956" class="indexterm"/><a id="iddle2213" class="indexterm"/><a id="iddle2267" class="indexterm"/>Processes with a high priority gain access to the CPU before processes with a low priority. In general, changing the priority should have little or no effect on your system, but to be safe, keep it set to low to prevent your ASA from potentially overriding important system processes.</p><p>On Windows and OS X, the cpulimit program should have been installed with GNS3. On Ubuntu Linux you need to install cpulimit using the following command:</p><a id="pro_id00107"/><pre class="programlisting">$ <span class="strong"><strong>sudo apt-get install cpulimit</strong></span></pre><p>Now that your ASA virtual machine won’t take over your system, let’s log on to an ASA and perform a basic configuration.</p></div><div class="sect2" title="Testing an ASA in GNS3"><div class="titlepage"><div><div><h2 class="title"><a id="testing_an_asa_in_gns3"/>Testing an ASA in GNS3</h2></div></div></div><p>Drag an ASA firewall node from the Devices toolbar to your workspace. Your ASA should be located in the Security Devices section of the toolbar. Start the ASA and open a GNS3 console connection. While it loads, you should see standard ASA startup messages followed by the ASA command prompt:</p><a id="pro_id00108"/><pre class="programlisting">ciscoasa&gt;</pre><p>A few error messages before the prompt are perfectly normal, but if your ASA fails to start or you see a lot of errors, check your settings or try a different ASA image file.</p><div class="note" title="Note"><h3 class="title"><a id="ch08note02"/>Note</h3><p><span class="emphasis"><em>It’s not uncommon for an ASA in GNS3 to hang or stall during the boot cycle, especially on older hardware. If this happens, stop and restart the ASA. It may take a couple attempts before you get a successful boot.</em></span></p></div><p>To test simple network connectivity, create a link from your ASA to another GNS3 device in your workspace. Next, open a console connection to the ASA and configure an interface with an IP address.</p><a id="pro_id00109"/><pre class="programlisting">ciscoasa&gt; <span class="strong"><strong>enable</strong></span>
ciscoasa# <span class="strong"><strong>configure terminal</strong></span>
ciscoasa(config)# <span class="strong"><strong>interface GigabitEthernet0</strong></span>
ciscoasa(config-if)# <span class="strong"><strong>ip address 10.10.10.1 255.255.255.0</strong></span>
ciscoasa(config-if)# <span class="strong"><strong>nameif inside</strong></span>
ciscoasa(config-if)# <span class="strong"><strong>no shutdown</strong></span></pre><p>After you’ve configured an interface, use a <code class="literal">ping</code> command to test connectivity from your ASA to other devices in your project.</p><div class="warning" title="Warning"><h3 class="title"><a id="ch08note03"/>Warning</h3><p><span class="emphasis"><em>Even with CPU throttling enabled, ASA devices are processor intensive, so you may want to use them sparingly in your projects, especially if you have a low-end PC.</em></span></p></div><p><a id="iddle1018" class="indexterm"/><a id="iddle1040" class="indexterm"/><a id="iddle1051" class="indexterm"/><a id="iddle1121" class="indexterm"/><a id="iddle1377" class="indexterm"/><a id="iddle1394" class="indexterm"/><a id="iddle1523" class="indexterm"/><a id="iddle1800" class="indexterm"/><a id="iddle2222" class="indexterm"/><a id="iddle2238" class="indexterm"/><a id="iddle2401" class="indexterm"/>After verifying that your ASA device is running properly, you’re ready to begin adding them to your projects. This can be helpful for learning how to configure the ASA or to prepare for a Cisco certification exam.</p></div></div><div class="sect1" title="ASDM Installation"><div class="titlepage"><div><div><h1 class="title"><a id="asdm_installation"/>ASDM Installation</h1></div></div></div><p>Cisco’s ASDM is similar to the CCP software that was covered in <a class="xref" href="ch08.html#cisco_configuration_professional" title="Cisco Configuration Professional">Cisco Configuration Professional</a>, so many of the details are the same. Like CCP, ASDM provides a point-and-click Java-based web interface. The key difference between CCP and ASDM is that ASDM is designed to configure only the Cisco ASA, not other Cisco devices.</p><p>Before you install the ASDM software, create a project like the one in <a class="xref" href="ch08.html#asdm_topology_with_an_asa_firewall_and_w" title="Figure 8-9. ASDM topology with an ASA firewall and Windows guest">Figure 8-9</a>. You’ll use the Windows virtual machine to install and run the ASDM application, and then you’ll launch ASDM and use it to take a look at the ASA.</p><div class="figure"><a id="asdm_topology_with_an_asa_firewall_and_w"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00103"/><img src="httpatomoreillycomsourcenostarchimages2209075.png.jpg" alt="ASDM topology with an ASA firewall and Windows guest"/></div></div><p class="title">Figure 8-9. ASDM topology with an ASA firewall and Windows guest</p></div><p>There are two ways to acquire the ASDM software: copy it from the flash memory of a real ASA or find it online. After you have the ASDM software, it needs to be stored on your virtual ASA’s flash drive; from there you’ll install it on your Windows virtual machine PC using a web browser. I recommend Mozilla Firefox because I’ve found that it runs ASDM better than Internet Explorer. (Just be sure to disable any pop-up blockers and firewalls and install the latest version of Java.) You’ll also need FTP or TFTP server software to copy the ASDM software from the GNS3 Windows virtual machine to your ASA.</p><p>After you have an ASDM image, there’s some prep work to do on the ASA device so you can copy over the ASDM image. Enter these commands on the ASA:</p><a id="pro_id00110"/><pre class="programlisting">  ciscoasa(config)# <span class="strong"><strong>interface gigabitEthernet0</strong></span>
➊ ciscoasa(config-if)# <span class="strong"><strong>ip address 10.10.10.1 255.255.255.0</strong></span>
  ciscoasa(config-if)# <span class="strong"><strong>nameif inside</strong></span>
  ciscoasa(config-if)# <span class="strong"><strong>no shutdown</strong></span>
  ciscoasa(config-if)# <span class="strong"><strong>exit</strong></span>
➋ ciscoasa(config)# <span class="strong"><strong>username admin password cisco privilege 15</strong></span>
➌ ciscoasa(config)# <span class="strong"><strong>http server enable</strong></span>
  ciscoasa(config)# <span class="strong"><strong>http 10.10.10.0 255.255.255.0 inside</strong></span></pre><p>Just like when you set up CCP, start by assigning an IP address to an inside interface ➊. Then, create a local user account ➋, and enable the HTTP server ➌.</p><p><a id="iddle1395" class="indexterm"/><a id="iddle2223" class="indexterm"/><a id="iddle2402" class="indexterm"/>After the ASA is configured and you have the ASDM software on your FTP or TFTP server, copy the software from your Windows virtual machine to the flash memory of the ASA.</p><a id="pro_id00111"/><pre class="programlisting">ciscoasa# <span class="strong"><strong>copy tftp flash</strong></span>
Source filename []? <span class="strong"><strong>asdm-641.bin</strong></span>
Address or name of remote host []? <span class="strong"><strong>10.10.10.100</strong></span>
Destination filename [asdm-641.bin] &lt;enter&gt;
Accessing tftp://10.10.10.100/asdm-641.bin !!!!!!!!!!!</pre><p>This example copies a file named <span class="emphasis"><em>asdm-641.bin</em></span> from my GNS3 Windows virtual machine to my ASA device using TFTP.</p><p>After copying the ASDM file, you need to install the software on your Windows virtual machine. Launch your web browser and open an HTTP Secure (HTTPS) connection to the IP address of your ASA. You should be presented with a screen similar to <a class="xref" href="ch08.html#cisco_asdm_install_screen" title="Figure 8-10. Cisco ASDM install screen">Figure 8-10</a>.</p><div class="figure"><a id="cisco_asdm_install_screen"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00104"/><img src="httpatomoreillycomsourcenostarchimages2209077.png.jpg" alt="Cisco ASDM install screen"/></div></div><p class="title">Figure 8-10. Cisco ASDM install screen</p></div><p><a id="iddle1123" class="indexterm"/><a id="iddle1263" class="indexterm"/><a id="iddle2103" class="indexterm"/>Because you’ll be using the Java Web Start option, click <span class="strong"><strong>Run ASDM</strong></span>. Your PC should download Java software and present you with a few security warnings, which you can safely click past until you see the Cisco ASDM-IDM Launcher, shown in <a class="xref" href="ch08.html#windows_asdm-idm_launcher" title="Figure 8-11. Windows ASDM-IDM Launcher">Figure 8-11</a>.</p><div class="figure"><a id="windows_asdm-idm_launcher"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00105"/><img src="httpatomoreillycomsourcenostarchimages2209079.png.jpg" alt="Windows ASDM-IDM Launcher"/></div></div><p class="title">Figure 8-11. Windows ASDM-IDM Launcher</p></div><p>Enter your ASA username and password (<span class="strong"><strong>admin</strong></span> and <span class="strong"><strong>cisco</strong></span>) and select <span class="strong"><strong>OK</strong></span> to log on to your ASA. After you have successfully logged on, you can begin configuring the system from the ASDM Device Dashboard, shown in <a class="xref" href="ch08.html#asdm_device_dashboard" title="Figure 8-12. ASDM Device Dashboard">Figure 8-12</a>.</p><div class="figure"><a id="asdm_device_dashboard"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00106"/><img src="httpatomoreillycomsourcenostarchimages2209081.png.jpg" alt="ASDM Device Dashboard"/></div></div><p class="title">Figure 8-12. ASDM Device Dashboard</p></div><p><a id="iddle1080" class="indexterm"/><a id="iddle1102" class="indexterm"/><a id="iddle1145" class="indexterm"/><a id="iddle1475" class="indexterm"/><a id="iddle1477" class="indexterm"/><a id="iddle1481" class="indexterm"/><a id="iddle1482" class="indexterm"/><a id="iddle1494" class="indexterm"/><a id="iddle1501" class="indexterm"/><a id="iddle1524" class="indexterm"/><a id="iddle1560" class="indexterm"/><a id="iddle1669" class="indexterm"/><a id="iddle1728" class="indexterm"/><a id="iddle1817" class="indexterm"/><a id="iddle1926" class="indexterm"/><a id="iddle2018" class="indexterm"/><a id="iddle2317" class="indexterm"/>The ASDM Device Dashboard includes several wizards that provide guided setups for creating common network and virtual private network (VPN) configurations. It also provides many real-time statistics to assist you in monitoring your network performance. Although not necessarily useful in GNS3, this information could be invaluable for maintaining a healthy network in real life.</p></div><div class="sect1" title="Cisco IDS/IPS"><div class="titlepage"><div><div><h1 class="title"><a id="cisco_idssolidusips"/>Cisco IDS/IPS</h1></div></div></div><p>The Cisco IDS/IPS identifies and prevents malicious activity on a network. In the real world, an IDS/IPS can be a stand-alone Cisco device or a module that you plug into an ASA or integrated service router.</p><p>Creating an IDS/IPS virtual machine for GNS3 is a real pain compared to most tasks, so before you begin, you may want to set aside a couple of hours.</p><div class="sect2" title="Acquiring an IDS/IPS Image"><div class="titlepage"><div><div><h2 class="title"><a id="acquiring_an_idssolidusips_image"/>Acquiring an IDS/IPS Image</h2></div></div></div><p>Like PIX and ASA, IDS/IPS runs on special Linux software. If you own a physical IDS/IPS appliance, then an upgrade/recovery CD containing the software should have come with your device.</p><p>To install IDS/IPS using a QEMU virtual machine, you need an ISO image of the CD. You can create your own ISO image file using your CD or find one on the Internet. In this example, I used an IOS image file named <span class="emphasis"><em>IPS-K9-cd-1.1-a-6.0-6-E3.iso</em></span>. Other versions of the software may work fine, but this version has proven to work well for creating a GNS3-compatible IDS/IPS.</p></div><div class="sect2" title="Creating a QEMU-Ready IDS/IPS System"><div class="titlepage"><div><div><h2 class="title"><a id="creating_a_qemu-ready_idssolidusips_syst"/>Creating a QEMU-Ready IDS/IPS System</h2></div></div></div><p>IDS/IPS software runs using QEMU, so be sure you have installed it on your PC and have tested it with GNS3 before you begin. Then, create a build directory for your IDS/IPS and copy your ISO file to the directory. This is where you’ll create the IDS/IPS virtual machine.</p><p>To install IDS/IPS software on a QEMU virtual machine, you have to create two QEMU virtual hard disk image files. Open a terminal window and enter the following commands to create the images:</p><a id="pro_id00112"/><pre class="programlisting">$ <span class="strong"><strong>qemu-img create ipsdisk1.img 512M</strong></span>
$ <span class="strong"><strong>qemu-img create ipsdisk2.img 4000M</strong></span></pre><div class="note" title="Note"><h3 class="title"><a id="ch08note04"/>Note</h3><p><span class="emphasis"><em>On Windows and OS X you may need to set your system path to include the location of your QEMU installation. Please refer to <a class="xref" href="ch06.html#installing_qemu_on_windows_and_os_x" title="Installing QEMU on Windows and OS X">Installing QEMU on Windows and OS X</a> for details.</em></span></p></div><p>Now that you’ve created the virtual disks, enter the following command to boot your virtual machine from the ISO image file:</p><a id="pro_id00113"/><pre class="programlisting">$ <span class="strong"><strong>qemu-system-i386 -hda ipsdisk1.img -hdb ipsdisk2.img -m 1024 -cdrom IPS-K9</strong></span>
<span class="strong"><strong>-cd-1.1-a-6.0-6-E3.iso -boot d</strong></span></pre><p><a id="iddle1818" class="indexterm"/>On Windows systems, replace <code class="literal">qemu-system-i386</code> in this command with <code class="literal">qemu-system-i386w</code>. After the system boots, you should see a screen similar to <a class="xref" href="ch08.html#idssolidusips_installation_screen" title="Figure 8-13. IDS/IPS installation screen">Figure 8-13</a>.</p><div class="figure"><a id="idssolidusips_installation_screen"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00107"/><img src="httpatomoreillycomsourcenostarchimages2209083.png.jpg" alt="IDS/IPS installation screen"/></div></div><p class="title">Figure 8-13. IDS/IPS installation screen</p></div><p>At the <code class="literal">boot:</code> prompt, enter <span class="strong"><strong><code class="literal">k</code></strong></span> to perform a full system recovery. During the recovery process, your QEMU virtual machine will boot Linux from the ISO image, install a GRUB boot loader, and install the IDS/IPS software. When the install finishes copying files, the virtual machine will reboot automatically and end with a “FATAL” boot error message, as shown in <a class="xref" href="ch08.html#fatal_no_bootable_device" title="Figure 8-14. FATAL: No bootable device">Figure 8-14</a>.</p><div class="figure"><a id="fatal_no_bootable_device"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00108"/><img src="httpatomoreillycomsourcenostarchimages2209085.png.jpg" alt="FATAL: No bootable device"/></div></div><p class="title">Figure 8-14. FATAL: No bootable device</p></div><p><a id="iddle1443" class="indexterm"/><a id="iddle1474" class="indexterm"/><a id="iddle1485" class="indexterm"/><a id="iddle1549" class="indexterm"/><a id="iddle2297" class="indexterm"/>Don’t worry, this error is perfectly normal and expected. Quit QEMU and enter the following command to boot the IDS/IPS again:</p><a id="pro_id00114"/><pre class="programlisting">$ <span class="strong"><strong>qemu-system-i386 -name IPS4215 -hda ipsdisk1.img -hdb ipsdisk2.img -m</strong></span>
<span class="strong"><strong>1024 -smbios type=1,product=IDS-4215 -net nic,vlan=1,model=e1000 -net</strong></span>
<span class="strong"><strong>nic,vlan=2,model=e1000</strong></span></pre><p>The IDS/IPS virtual machine will boot to a Linux GRUB boot menu. At the boot menu, enter <span class="strong"><strong><code class="literal">e</code></strong></span> to edit an entry. Use the arrow key to move down to highlight the <code class="literal">kernel</code> entry and enter <span class="strong"><strong><code class="literal">e</code></strong></span> again to edit this entry.</p><p>Use the back arrow key to locate and change <span class="strong"><strong><code class="literal">init=/loadrc</code></strong></span> to <span class="strong"><strong><code class="literal">init=1</code></strong></span>. Press <span class="smaller">ENTER</span> to accept the change and press <span class="strong"><strong><code class="literal">b</code></strong></span> to boot from the modified GRUB menu. The system should now boot, bypassing the IDS/IPS startup, and bring you to a Linux console. From the console command line, you’ll use the vi editor to modify some IDS/IPS configuration files.</p><div class="note" title="Note"><h3 class="title"><a id="ch08note05"/>Note</h3><p><span class="emphasis"><em>You have to use the vi editor to modify files because no other editor is installed. If you are unfamiliar with vi, you’ll want to brush up on it before you continue. Just search for <code class="literal">man vi</code> online or enter <code class="literal">man vi</code> at the command line to view the man page.</em></span></p></div><p>After you’re familiar with vi editing commands, you’re ready to continue.</p></div><div class="sect2" title="Hijacking the Hardware"><div class="titlepage"><div><div><h2 class="title"><a id="hijacking_the_hardware"/>Hijacking the Hardware</h2></div></div></div><p>First, you’ll need to trick the IDS/IPS software into thinking your QEMU virtual machine is a real Cisco IDS-4215 Appliance Sensor. To fool the software, you have to modify two files: <span class="emphasis"><em>ids_functions</em></span> and <span class="emphasis"><em>interface.conf</em></span>. Modifying these files is pretty tedious, and the smallest mistake will prevent you from creating a working IDS/IPS device.</p><p>Start by entering the following commands from the shell prompt:</p><a id="pro_id00115"/><pre class="programlisting">-sh-2.05b# <span class="strong"><strong>/loadrc</strong></span>
-sh-2.05b# <span class="strong"><strong>cd /etc/init.d</strong></span>
-sh-2.05b# <span class="strong"><strong>./rc.init</strong></span></pre><p>This will mount the Linux file systems used by the IDS/IPS and initialize the system. Next, use vi to open the <span class="emphasis"><em>ids_functions</em></span> file.</p><a id="pro_id00116"/><pre class="programlisting">-sh-2.05b# <span class="strong"><strong>vi ids_functions</strong></span></pre><p>After opening the file, enter the command <code class="literal">/845</code> to have vi locate the following entry:</p><a id="pro_id00117"/><pre class="programlisting">elif [[ `isCPU 845` -eq $TRUE &amp;&amp; $NUM_OF_PROCS -eq 1 ]]; then
        MODEL=$IDS4215
        HTLBLOW=8
        MEM_PAGES=${HTLBLOW}
        DEFAULT_MGT_OS="fe0_0"
        DEFAULT_MGT_CIDS="FastEthernet0/0"</pre><p><a id="iddle1550" class="indexterm"/>Next, edit the <code class="literal">elif</code> statement and <code class="literal">DEFAULT_MGT</code> statements so they read as follows:</p><a id="pro_id00118"/><pre class="programlisting">elif [[ <span class="strong"><strong>1 -eq 1</strong></span> ]]; then
        MODEL=$IDS4215
        HTLBLOW=8
        MEM_PAGES=${HTLBLOW}
        DEFAULT_MGT_OS=<span class="strong"><strong>"ma0_0"</strong></span>
        DEFAULT_MGTCIDS=<span class="strong"><strong>"Management0/0"</strong></span></pre><p>When you’re finished editing and certain that you have made the correct changes, save the file and exit the vi editor.</p><p>Next, you’ll edit the <span class="emphasis"><em>interface.conf</em></span> file.</p><a id="pro_id00119"/><pre class="programlisting">-sh-2.05b# <span class="strong"><strong>cd /usr/cids/idsRoot/etc</strong></span>
-sh-2.05b# <span class="strong"><strong>vi interface.conf</strong></span></pre><p>Use the arrow key to move down to the section that begins with <code class="literal">####### IDS-4215 ########</code>, modify each of the interface entries starting at <code class="literal">[models/IDS-4215/interfaces/1]</code> and ending with <code class="literal">[models/IDS-4215/interfaces/6]</code>. Each entry must look exactly like the following six entries:</p><a id="pro_id00120"/><pre class="programlisting">[models/IDS-4215/interfaces/1]
<span class="strong"><strong>name-template=Management0/0</strong></span>
<span class="strong"><strong>port-number=0</strong></span>
<span class="strong"><strong>pci-path=3.0</strong></span>
vendor-id=0x8086
<span class="strong"><strong>device-id=0x100e</strong></span>
type=fe
mgmt-capable=yes
net-dev-only=yes
<span class="strong"><strong>tcp-reset-capable=yes</strong></span>

[models/IDS-4215/interfaces/2]
<span class="strong"><strong>name-template=FastEthernet0/0</strong></span>
<span class="strong"><strong>port-number=1</strong></span>
<span class="strong"><strong>pci-path=4.0</strong></span>
vendor-id=0x8086
<span class="strong"><strong>device-id=0x100e</strong></span>
type=fe
sensing-capable=yes
tcp-reset-capable=yes

[models/IDS-4215/interfaces/3]
<span class="strong"><strong>name-template=FastEthernet0/1</strong></span>
<span class="strong"><strong>port-number=2</strong></span>
<span class="strong"><strong>pci-path=5.0</strong></span>
vendor-id=0x8086
<span class="strong"><strong>device-id=0x100e</strong></span>
type=fe
sensing-capable=yes
tcp-reset-capable=yes

[models/IDS-4215/interfaces/4]
 <span class="strong"><strong>name-template=FastEthernet0/2</strong></span>
 <span class="strong"><strong>port-number=3</strong></span>
 <span class="strong"><strong>pci-path=6.0</strong></span>
 vendor-id=0x8086
 <span class="strong"><strong>device-id=0x100e</strong></span>
 type=fe
 sensing-capable=yes
 tcp-reset-capable=yes

[models/IDS-4215/interfaces/5]
 <span class="strong"><strong>name-template=FastEthernet0/3</strong></span>
 <span class="strong"><strong>port-number=4</strong></span>
 <span class="strong"><strong>pci-path=7.0</strong></span>
 vendor-id=0x8086
 <span class="strong"><strong>device-id=0x100e</strong></span>
 type=fe
 sensing-capable=yes
 tcp-reset-capable=yes

[models/IDS-4215/interfaces/6]
 <span class="strong"><strong>name-template=FastEthernet0/4</strong></span>
 <span class="strong"><strong>port-number=5</strong></span>
 <span class="strong"><strong>pci-path=8.0</strong></span>
 vendor-id=0x8086
 <span class="strong"><strong>device-id=0x100e</strong></span>
 type=fe
 sensing-capable=yes
 tcp-reset-capable=yes</pre><p><a id="iddle1440" class="indexterm"/><a id="iddle1483" class="indexterm"/><a id="iddle2051" class="indexterm"/>After you’ve finished editing the interfaces, scroll through the entries and verify that each interface is correctly configured. If you’re certain everything is correct, save the file and quit vi. Reboot the IDS/IPS virtual machine using the <code class="literal">reboot</code> command.</p><a id="pro_id00121"/><pre class="programlisting">-sh-2.05b# <span class="strong"><strong>reboot</strong></span></pre><p>The system should boot, configure a few things, and reboot again automatically. After the automatic reboot, immediately quit QEMU when you see the GRUB boot manager, shown in <a class="xref" href="ch08.html#grub_boot_manager_screen" title="Figure 8-15. GRUB boot manager screen">Figure 8-15</a>. If you fail to quit and relaunch QEMU without using the proper options, the install will fail, and you’ll have to start over.</p><p>After quitting QEMU, restart your IDS/IPS virtual machine with the following command options:</p><a id="pro_id00122"/><pre class="programlisting">$ <span class="strong"><strong>qemu-system-i386 -name IPS4215 -hda ipsdisk1.img -hdb ipsdisk2.img -m</strong></span>
<span class="strong"><strong>1024 -smbios type=1,product=IDS-4215 -net nic,vlan=1,model=e1000 -net</strong></span>
<span class="strong"><strong>nic,vlan=2,model=e1000</strong></span></pre><div class="figure"><a id="grub_boot_manager_screen"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00109"/><img src="httpatomoreillycomsourcenostarchimages2209087.png.jpg" alt="GRUB boot manager screen"/></div></div><p class="title">Figure 8-15. GRUB boot manager screen</p></div><p><a id="iddle1441" class="indexterm"/><a id="iddle2285" class="indexterm"/>Your IDS/IPS should now boot to the login prompt shown in <a class="xref" href="ch08.html#idssolidusips_login_prompt" title="Figure 8-16. IDS/IPS login prompt">Figure 8-16</a>.</p><div class="figure"><a id="idssolidusips_login_prompt"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00110"/><img src="httpatomoreillycomsourcenostarchimages2209089.png.jpg" alt="IDS/IPS login prompt"/></div></div><p class="title">Figure 8-16. IDS/IPS login prompt</p></div><p>You’re almost done! Log on to the system by entering the default username <span class="strong"><strong><code class="literal">cisco</code></strong></span> and password <span class="strong"><strong><code class="literal">cisco</code></strong></span>, and you should be directed to reset the password. If any part of the IDS/IPS setup has gone wrong, you may see the message “UNSUPPORTED HARDWARE DETECTED,” as in <a class="xref" href="ch08.html#quotation_markunsupported_hardware_detec" title="Figure 8-17. “UNSUPPORTED HARDWARE DETECTED” error">Figure 8-17</a>.</p><p>At this point, you could continue using the IDS/IPS virtual machine, or you could start over. I recommend you start over and create a new IDS/IPS until you can log on without errors. If you continue, the IDS/IPS system may produce further errors and not work as expected.</p><div class="figure"><a id="quotation_markunsupported_hardware_detec"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00111"/><img src="httpatomoreillycomsourcenostarchimages2209091.png.jpg" alt="“UNSUPPORTED HARDWARE DETECTED” error"/></div></div><p class="title">Figure 8-17. “UNSUPPORTED HARDWARE DETECTED” error</p></div><p><a id="iddle1201" class="indexterm"/><a id="iddle1442" class="indexterm"/><a id="iddle1478" class="indexterm"/><a id="iddle1484" class="indexterm"/><a id="iddle1663" class="indexterm"/><a id="iddle2031" class="indexterm"/><a id="iddle2057" class="indexterm"/><a id="iddle2214" class="indexterm"/>When you can log on without errors, you’re ready to continue.</p></div><div class="sect2" title="Testing IDS/IPS (or Patience Is a Virtue)"><div class="titlepage"><div><div><h2 class="title"><a id="testing_idssolidusips_left_parenthesisor"/>Testing IDS/IPS (or Patience Is a Virtue)</h2></div></div></div><p>The first time you log on to the IDS/IPS virtual machine, you will have to wait approximately 20 minutes or so while the system rebuilds its regex cache tables. This is normal even for an actual IDS/IPS appliance, and you should not interrupt it. You can check the progress periodically using the <code class="literal">iplog-status</code> command.</p><a id="pro_id00123"/><pre class="programlisting">sensor# <span class="strong"><strong>iplog-status</strong></span></pre><p>If the status message reads “Error: getIpLogList: Analysis Engine is busy rebuilding regex tables. This may take a while.” then the system is still working and should not be interrupted. After the rebuild is finished, you should instead see “No IP logs available.”</p><p>When the rebuild is finished, enter the <span class="strong"><strong><code class="literal">reset</code></strong></span> command to shut down and reboot the virtual machine. Unfortunately, there’s no elegant way to shut down the system. To avoid file corruption, you should quit QEMU when the reboot reaches the GRUB boot menu.</p></div><div class="sect2" title="Configuring GNS3 for IDS/IPS"><div class="titlepage"><div><div><h2 class="title"><a id="configuring_gns3_for_idssolidusips"/>Configuring GNS3 for IDS/IPS</h2></div></div></div><p>Adding an IDS/IPS to GNS3 is similar to adding an ASA. To add an IDS/IPS device, launch GNS3, select <span class="strong"><strong>Edit</strong></span> ▸ <span class="strong"><strong>Preferences</strong></span> on Linux and Windows or <span class="strong"><strong>GNS3</strong></span> ▸ <span class="strong"><strong>Preferences</strong></span> on OS X, and select <span class="strong"><strong>QEMU VMs</strong></span> from the sidebar, as shown in <a class="xref" href="ch08.html#ids_preferences" title="Figure 8-18. IDS Preferences">Figure 8-18</a>.</p><div class="figure"><a id="ids_preferences"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00112"/><img src="httpatomoreillycomsourcenostarchimages2209093.png.jpg" alt="IDS Preferences"/></div></div><p class="title">Figure 8-18. IDS Preferences</p></div><p><a id="iddle1065" class="indexterm"/><a id="iddle1861" class="indexterm"/>To create a new IDS/IPS in GNS3, click <span class="strong"><strong>New</strong></span> to start the New QEMU VM wizard. Select <span class="strong"><strong>IDS</strong></span> from the Type drop-down menu, as shown in <a class="xref" href="ch08.html#selecting_ids_in_the_new_qemu_vm_wizard" title="Figure 8-19. Selecting IDS in the New QEMU VM wizard">Figure 8-19</a>.</p><div class="figure"><a id="selecting_ids_in_the_new_qemu_vm_wizard"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00113"/><img src="httpatomoreillycomsourcenostarchimages2209095.png.jpg" alt="Selecting IDS in the New QEMU VM wizard"/></div></div><p class="title">Figure 8-19. Selecting IDS in the New QEMU VM wizard</p></div><p>By default your device is automatically named <span class="emphasis"><em>IDS</em></span>. Click <span class="strong"><strong>Next</strong></span> to continue. GNS3 should automatically locate and choose the correct QEMU binary file for your PC, shown in <a class="xref" href="ch08.html#qemu_binary_and_memory_screen" title="Figure 8-20. QEMU binary and memory screen">Figure 8-20</a>.</p><div class="figure"><a id="qemu_binary_and_memory_screen"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00114"/><img src="httpatomoreillycomsourcenostarchimages2209097.png.jpg" alt="QEMU binary and memory screen"/></div></div><p class="title">Figure 8-20. QEMU binary and memory screen</p></div><p><a id="iddle1301" class="indexterm"/><a id="iddle1303" class="indexterm"/><a id="iddle1486" class="indexterm"/><a id="iddle1788" class="indexterm"/><a id="iddle2048" class="indexterm"/><a id="iddle2058" class="indexterm"/><a id="iddle2215" class="indexterm"/>Set the RAM field to <span class="strong"><strong>1024 MB</strong></span> or greater, and click <span class="strong"><strong>Next</strong></span> to continue to the Disk image (hda) selection, shown in <a class="xref" href="ch08.html#chooseing_a_disk_image" title="Figure 8-21. Chooseing a disk image">Figure 8-21</a>.</p><div class="figure"><a id="chooseing_a_disk_image"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00115"/><img src="httpatomoreillycomsourcenostarchimages2209099.png.jpg" alt="Chooseing a disk image"/></div></div><p class="title">Figure 8-21. Chooseing a disk image</p></div><p>Browse and select the file named <span class="emphasis"><em>ipsdisk1.img</em></span> that was created when you built your QEMU-ready IDS system. Click <span class="strong"><strong>Next</strong></span> to continue to the Disk image (hdb) selection screen and choose <span class="emphasis"><em>ipsdisk2.img</em></span>. Click <span class="strong"><strong>Finish</strong></span> to complete the installation. You’re now ready to test your IDS.</p></div><div class="sect2" title="Verifying IDS/IPS in GNS3"><div class="titlepage"><div><div><h2 class="title"><a id="verifying_idssolidusips_in_gns3"/>Verifying IDS/IPS in GNS3</h2></div></div></div><p>To verify that your IDS/IPS is working, drag an IDS/IPS node to your workspace and start the device. GNS3 cannot open a console connection to an IDS/IPS device until after it has fully booted. This means you will not see any IDS/IPS messages prior to the login prompt. After the login prompt appears, you should be able to log in and configure the IDS/IPS. To prevent file corruption from occurring, use the <code class="literal">reset</code> command whenever you shut down the device.</p><p><a id="iddle1060" class="indexterm"/><a id="iddle1202" class="indexterm"/><a id="iddle1476" class="indexterm"/><a id="iddle1493" class="indexterm"/><a id="iddle1600" class="indexterm"/><a id="iddle1604" class="indexterm"/><a id="iddle1862" class="indexterm"/><a id="iddle1905" class="indexterm"/><a id="iddle1930" class="indexterm"/><a id="iddle2007" class="indexterm"/><a id="iddle2011" class="indexterm"/><a id="iddle2032" class="indexterm"/><a id="iddle2326" class="indexterm"/><a id="iddle2380" class="indexterm"/><a id="iddle2383" class="indexterm"/>After determining that your IDS/IPS is in good working order, you should make a backup copy of the QEMU disk image files. If something happens to your working IDS/IPS device, a backup copy of the files can save you hours of work later.</p></div></div><div class="sect1" title="Cisco IOS-XRv"><div class="titlepage"><div><div><h1 class="title"><a id="cisco_ios-xrv"/>Cisco IOS-XRv</h1></div></div></div><p>Cisco offers a version of IOS-XR in the form of a 32-bit virtual machine called IOS-XRv. The cool thing about IOS-XRv is that it’s not an emulator like IOU or NX-OSv. Instead, it’s a “hamstrung” version of IOS-XR that contains only a single route processor (RP). Network throughput is limited to 2Mbps, and there’s a hard-coded AAA user named <span class="emphasis"><em>cisco</em></span> with the password <span class="emphasis"><em>cisco</em></span>, making it impossible to use in a production environment, unless you want a slow and insecure network. Despite these limitations, the operating system includes management features, routing, and forwarding capabilities.</p><p>The software is designed to run using VMware ESXi or QEMU, making it a breeze to use with GNS3. If you have a Cisco CCO account, you should be able to download the software from the Cisco file exchange.</p><div class="sect2" title="Configuring GNS3 for IOS-XRv"><div class="titlepage"><div><div><h2 class="title"><a id="configuring_gns3_for_ios-xrv"/>Configuring GNS3 for IOS-XRv</h2></div></div></div><p>Cisco IOS-XRv files come in two image formats; the first is an OVA, and the second is a Virtual Machine Disk (VMDK) file. The OVA image (ending in .<span class="emphasis"><em>ova</em></span>) is suitable for use with VMware ESXi; the VMDK file (ending in .<span class="emphasis"><em>vmdk</em></span>) is ready to use with QEMU, and it’s the file you’ll use in GNS3. In this example, I’ll be using an image file named <span class="emphasis"><em>iosxrv-k9-demo-5.2.2.vmdk</em></span>.</p><p>Adding an IOS-XRv device to GNS3 is pretty straightforward. You’ll launch the New QEMU VM wizard and follow the prompts; then you’ll edit the device, making a small change to increase the number of adapters. To add an IOS-XRv device, select <span class="strong"><strong>Edit</strong></span> ▸ <span class="strong"><strong>Preferences</strong></span> on Linux and Windows or <span class="strong"><strong>GNS3</strong></span> ▸ <span class="strong"><strong>Preferences</strong></span> on OS X and then select <span class="strong"><strong>QEMU VMs</strong></span> from the panel on the left. Click <span class="strong"><strong>New</strong></span> to start the configuration and open the dialog in <a class="xref" href="ch08.html#new_qemu_vm_wizard" title="Figure 8-22. New QEMU VM wizard">Figure 8-22</a>.</p><div class="figure"><a id="new_qemu_vm_wizard"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00116"/><img src="httpatomoreillycomsourcenostarchimages2209101.png.jpg" alt="New QEMU VM wizard"/></div></div><p class="title">Figure 8-22. New QEMU VM wizard</p></div><p><a id="iddle1003" class="indexterm"/><a id="iddle1004" class="indexterm"/><a id="iddle1066" class="indexterm"/><a id="iddle1789" class="indexterm"/><a id="iddle2049" class="indexterm"/>Set Type to <span class="strong"><strong>Default</strong></span> and enter a name for your device; I’ve entered <span class="strong"><strong>IOS-XRv</strong></span>. When you’re finished, click <span class="strong"><strong>Next</strong></span> to proceed to the QEMU binary and memory settings, shown in <a class="xref" href="ch08.html#configuring_ios-xrv_for_64-bit_systems" title="Figure 8-23. Configuring IOS-XRv for 64-bit systems">Figure 8-23</a>.</p><div class="figure"><a id="configuring_ios-xrv_for_64-bit_systems"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00117"/><img src="httpatomoreillycomsourcenostarchimages2209103.png.jpg" alt="Configuring IOS-XRv for 64-bit systems"/></div></div><p class="title">Figure 8-23. Configuring IOS-XRv for 64-bit systems</p></div><p>IOS-XRv can run using 32-bit or 64-bit QEMU hardware emulation. Because I’m running a 64-bit operating system on my PC, I’ve chosen to use a 64-bit QEMU binary, named <span class="emphasis"><em>qemu-system-x86_64</em></span> (shown in <a class="xref" href="ch08.html#configuring_ios-xrv_for_64-bit_systems" title="Figure 8-23. Configuring IOS-XRv for 64-bit systems">Figure 8-23</a>), and I’ve set RAM to <span class="strong"><strong>2048 MB</strong></span>, which is the recommended amount. However, if you run a 32-bit operating system, such as Windows, you’ll have to set the RAM to less than 2048MB. This is because the 32-bit QEMU program is unable to allocate that much memory to the IOS-XRv virtual machine. In this case, you should enter <span class="strong"><strong>1920 MB</strong></span> and use the drop-down menu to choose the QEMU binary named <span class="emphasis"><em>qemu-system-i386w.exe</em></span>, as shown in <a class="xref" href="ch08.html#configuring_ios-xrv_for_32-bit_windows_s" title="Figure 8-24. Configuring IOS-XRv for 32-bit Windows systems">Figure 8-24</a>.</p><div class="figure"><a id="configuring_ios-xrv_for_32-bit_windows_s"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00118"/><img src="httpatomoreillycomsourcenostarchimages2209105.png.jpg" alt="Configuring IOS-XRv for 32-bit Windows systems"/></div></div><p class="title">Figure 8-24. Configuring IOS-XRv for 32-bit Windows systems</p></div><p><a id="iddle1011" class="indexterm"/><a id="iddle1012" class="indexterm"/><a id="iddle1150" class="indexterm"/><a id="iddle1302" class="indexterm"/><a id="iddle1321" class="indexterm"/><a id="iddle1599" class="indexterm"/><a id="iddle1603" class="indexterm"/><a id="iddle2071" class="indexterm"/><a id="iddle2079" class="indexterm"/><a id="iddle2327" class="indexterm"/><a id="iddle2381" class="indexterm"/>After configuring your QEMU binary and RAM, click <span class="strong"><strong>Next</strong></span> to proceed to the Disk Image selection screen in <a class="xref" href="ch08.html#selecting_a_disk_image" title="Figure 8-25. Selecting a disk image">Figure 8-25</a>.</p><div class="figure"><a id="selecting_a_disk_image"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00119"/><img src="httpatomoreillycomsourcenostarchimages2209107.png.jpg" alt="Selecting a disk image"/></div></div><p class="title">Figure 8-25. Selecting a disk image</p></div><p>Click the <span class="strong"><strong>Browse</strong></span> button to locate and choose your IOS-XRv <span class="emphasis"><em>.vmdk</em></span> image file. I’ve selected a disk image named <span class="emphasis"><em>iosxrv-k9-demo-5.2.2.vmdk</em></span>.</p><p>When you’re done selecting your image, click <span class="strong"><strong>Finish</strong></span> to close the wizard. Next, select your newly created IOS-XRv device and click <span class="strong"><strong>Edit</strong></span>. Select the <span class="strong"><strong>Network</strong></span> tab and increase the number of adapters to <span class="strong"><strong>4</strong></span>. Click <span class="strong"><strong>OK</strong></span> to close the window and then click <span class="strong"><strong>Apply</strong></span> and <span class="strong"><strong>OK</strong></span> to commit the change. You can set the number of adapters to whatever best suits your needs, but four should be suitable for most GNS3 projects.</p></div><div class="sect2" title="Creating a Simple IOS-XR Project"><div class="titlepage"><div><div><h2 class="title"><a id="creating_a_simple_ios-xr_project"/>Creating a Simple IOS-XR Project</h2></div></div></div><p>Cisco IOS-XR is very IOS-like, but it’s not IOS. In this section, you’ll configure a simple project using one Dynamips router and one IOS-XRv device, shown in <a class="xref" href="ch08.html#simple_ios-xrv_project" title="Figure 8-26. A simple IOS-XRv project">Figure 8-26</a>.</p><div class="figure"><a id="simple_ios-xrv_project"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00120"/><img src="httpatomoreillycomsourcenostarchimages2209109.png" alt="A simple IOS-XRv project"/></div></div><p class="title">Figure 8-26. A simple IOS-XRv project</p></div><p>You’ll use EIGRP to advertise three networks from router R1 to the IOS-XRv1 device. Finally, you’ll verify the routes using some IOS-XR commands. This is only a basic introduction to IOS-XR. If you truly want to learn IOS-XR, you’ll have to dig deep into Cisco’s documentation.</p><div class="sect3" title="Configuring the Router"><div class="titlepage"><div><div><h3 class="title"><a id="configuring_the_router"/>Configuring the Router</h3></div></div></div><p><a id="iddle1192" class="indexterm"/><a id="iddle1208" class="indexterm"/><a id="iddle1217" class="indexterm"/><a id="iddle1334" class="indexterm"/><a id="iddle1601" class="indexterm"/><a id="iddle1602" class="indexterm"/><a id="iddle1650" class="indexterm"/><a id="iddle2072" class="indexterm"/>Begin by configuring router R1. Configure an IP address on the Ethernet interface that’s linked to IOS-XRv1.</p><a id="pro_id00124"/><pre class="programlisting">R1# <span class="strong"><strong>configure terminal</strong></span>
R1(config)# <span class="strong"><strong>interface f0/0</strong></span>
R1(config-if)# <span class="strong"><strong>ip address 10.1.1.1 255.255.255.0</strong></span>
R1(config-if)# <span class="strong"><strong>no shutdown</strong></span></pre><p>Next, configure the three IP addresses on router R1’s loopback interfaces.</p><a id="pro_id00125"/><pre class="programlisting">R1(config-if)# <span class="strong"><strong>interface loopback1</strong></span>
R1(config-if)# <span class="strong"><strong>ip address 172.16.1.1 255.255.255.0</strong></span>
R1(config-if)# <span class="strong"><strong>interface loopback2</strong></span>
R1(config-if)# <span class="strong"><strong>ip address 172.16.2.1 255.255.255.0</strong></span>
R1(config-if)# <span class="strong"><strong>interface loopback3</strong></span>
R1(config-if)# <span class="strong"><strong>ip address 172.16.3.1 255.255.255.0</strong></span>
R1(config-if)# <span class="strong"><strong>exit</strong></span></pre><p>These addresses will be advertised to your IOS-XRv1 device using EIGRP. Finally, configure EIGRP and advertise all the networks.</p><a id="pro_id00126"/><pre class="programlisting">R1(config)# <span class="strong"><strong>router eigrp 10</strong></span>
R1(config-router)# <span class="strong"><strong>no auto-summary</strong></span>
R1(config-router)# <span class="strong"><strong>network 10.0.0.0</strong></span>
R1(config-router)# <span class="strong"><strong>network 172.16.0.0</strong></span></pre><p>After you’ve finished configuring router R1, configure the IOS-XR device.</p></div><div class="sect3" title="Configuring the IOS-XR Device"><div class="titlepage"><div><div><h3 class="title"><a id="configuring_the_ios-xr_device"/>Configuring the IOS-XR Device</h3></div></div></div><p>Log on to IOS-XRv1 and create a similar configuration to the one you created on router R1. You’ll configure an IP address and enable EIGRP to allow IOS-XRv1 and router R1 to exchange routing information.</p><a id="pro_id00127"/><pre class="programlisting">➊ RP/0/0/CPU0:ios#
  RP/0/0/CPU0:ios# <span class="strong"><strong>configure terminal</strong></span>
  RP/0/0/CPU0:ios(config)# <span class="strong"><strong>interface GigabitEthernet 0/0/0/0</strong></span>
➋ RP/0/0/CPU0:ios(config-if)# <span class="strong"><strong>ipv4 address 10.1.1.2/24</strong></span>
  RP/0/0/CPU0:ios(config-if)# <span class="strong"><strong>no shutdown</strong></span>
  RP/0/0/CPU0:ios(config)# <span class="strong"><strong>router eigrp 10</strong></span>
➌ RP/0/0/CPU0:ios(config-eigrp)# <span class="strong"><strong>address-family ipv4</strong></span>
➍ RP/0/0/CPU0:ios(config-eigrp-af)# <span class="strong"><strong>interface GigabitEthernet 0/0/0/0</strong></span>
➎ RP/0/0/CPU0:ios(config-eigrp-af)# <span class="strong"><strong>commit</strong></span></pre><p>The first notable difference between IOS and IOS-RX is the command prompt. The IOS-XRv1 command prompt ➊ indicates that your context is the first route processor (RP/0/0/CPU0). Because this is a demo version of IOS-XRv, it’s limited to this single route processor.</p><p><a id="iddle1335" class="indexterm"/><a id="iddle1651" class="indexterm"/><a id="iddle1957" class="indexterm"/><a id="iddle2136" class="indexterm"/><a id="iddle2143" class="indexterm"/>Next, when an IP address is configured on an Ethernet interface, you have to specify the family of the IP address you’re using (IPv4 or IPv6), and the subnet mask is represented in CIDR notation (/24) ➋. Similarly, you have to specify IPv4 or IPv6 when configuring the EIGRP route process ➌. Lastly, you advertise networks by placing an IP-configured interface under the EIGRP route process ➍. When you’re done, be sure to commit your changes ➎.</p><p>Once you’ve configured everything, enter the <code class="literal">show eigrp neighbors</code> command, and you should see this output:</p><a id="pro_id00128"/><pre class="programlisting">RP/0/0/CPU0:ios# <span class="strong"><strong>show eigrp neighbors</strong></span>
IPv4-EIGRP Neighbors for AS(10) VRF default

H   Address                 Interface      Hold Uptime   SRTT   RTO  Q   Seq
                                           (sec)         (ms)        Cnt Num
0   ➊10.1.1.1            ➋Gi0/0/0/0      13 00:28:09   19    200   0   3</pre><p>In a correct configuration, an EIGRP neighbor adjacency will form with router R1 at IP address 10.1.1.1 ➊ from interface Gi0/0/0/0 ➋.</p><p>Now, verify that all the 172.16.0.0 networks have been advertised from router R1 to IOS-XRv1 using the <code class="literal">show route</code> command.</p><a id="pro_id00129"/><pre class="programlisting">RP/0/0/CPU0:ios# <span class="strong"><strong>show route</strong></span>
--<span class="emphasis"><em>snip</em></span>--

C    10.1.1.0/24 is directly connected, 02:58:51, GigabitEthernet0/0/0/0
L    10.1.1.2/32 is directly connected, 02:58:51, GigabitEthernet0/0/0/0
D   ➊172.16.1.0/24 [90/2570240] via 10.1.1.1, 00:43:21, GigabitEthernet0/0/0/0
D   ➊172.16.2.0/24 [90/2570240] via 10.1.1.1, 00:43:21, GigabitEthernet0/0/0/0
D   ➊172.16.3.0/24 [90/2570240] via 10.1.1.1, 00:43:21, GigabitEthernet0/0/0/0</pre><p>All of the 172.16.0.0 networks have been successfully added to the IOS-XR routing table ➊. You can test connectivity by pinging one of the addresses.</p><a id="pro_id00130"/><pre class="programlisting">  RP/0/0/CPU0:ios# <span class="strong"><strong>ping 172.16.1.1</strong></span>
  Thu Oct 16 03:20:27.508 UTC
  Type escape sequence to abort.
  Sending 5, 100-byte ICMP Echos to 172.16.1.1, timeout is 2 seconds:
  !!!!!
➊ Success rate is 100 percent (5/5), round-trip min/avg/max = 9/19/49 ms</pre><p>Here, the ping was 100 percent successful ➊. Now, save the configuration.</p><a id="pro_id00131"/><pre class="programlisting">RP/0/0/CPU0:ios# <span class="strong"><strong>copy running-config nvram:</strong></span>
Thu Oct 16 03:22:39.679 UTC
Destination file name (control-c to abort): [/running-config]? &lt;enter&gt;
Building configuration.
24 lines built in 1 second
[OK]</pre><p>By now it should be obvious that IOS-XR is a little different from traditional IOS, but it’s also similar. IOS-XRv is a reliable platform, and it’s a lot of fun to play with in GNS3. Perhaps someday Cisco will port a version of IOS-XR from their carrier class routers down to their smaller commercial routers. If so, practicing with IOS-XRv in GNS3 will help prepare you for it.</p></div></div></div><div class="sect1" title="Final Thoughts"><div class="titlepage"><div><div><h1 class="title"><a id="final_thoughts-id00018"/>Final Thoughts</h1></div></div></div><p>Using GNS3, you can quickly become proficient at configuring and installing ASA firewalls. Having worked with Cisco gear for more than a decade, I’ve learned that ASAs are rock solid and work great for small network installations. Understanding how to configure the ASA is a must for anyone involved in small business networking. They’re one of the few nonenterprise Cisco products that are reasonably priced, feature rich, and easy to install.</p><p>Using ASDM, you can quickly configure an ASA to allow remote users to connect to their corporate networks through an IPSec VPN. Several cross-platform VPN clients are compatible with Cisco ASAs and routers; OS X has a built-in Cisco VPN client. On Windows, you have to install the Cisco VPN Client or Cisco AnyConnect software. On Linux, you can use Virtual Private Network Connection (VPNC), which works great. I use VPNC on a daily basis with Linux to access VPNs all across the country.</p><p>In the next chapter, you’ll look at Cisco IOU and learn how to integrate IOU devices into GNS3 projects. It’s an exciting new advancement that broadens the future of GNS3.</p></div></div></body></html>