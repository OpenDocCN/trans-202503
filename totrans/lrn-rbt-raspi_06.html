<html><head></head><body>
<h2 class="h2a" id="ch06">6<br/><span epub:type="pagebreak" id="page_121"/>CUSTOMIZING WITH LIGHTS AND SOUND</h2>&#13;
<p class="startpara">MAKING YOUR ROBOT STAND OUT FROM THE CROWD CAN BE A WHOLE LOT OF FUN. IN THIS CHAPTER, I’LL SHOW YOU HOW TO ADD LIGHTS AND SPEAKERS TO YOUR ROBOT TO MAKE IT FLASHIER, LOUDER, AND MORE EXCITING. AS USUAL, WE’LL COVER THE THEORY, THE PARTS YOU’LL NEED, AND HOW TO USE THEM.</p>&#13;
<h3 class="h3" id="ch06lev1sec1">ADDING NEOPIXELS TO YOUR RASPBERRY PI ROBOT</h3>&#13;
<p class="noindent"><span epub:type="pagebreak" id="page_122"/>One of the best ways to grab attention is to have your robot put on a light show. With the right code and wiring and the help of some bright and colorful LEDs, you can make dazzling spectacles as your robot scuttles around the floor!</p>&#13;
<p class="indent">In this project you’ll outfit your robot with a string of super-bright, multicolor LEDs. I’ll guide you through getting the components, wiring them up, and programming different patterns. We’ll combine these new additions with the Wiimote program from <a href="ch04.xhtml#ch04">Chapter 4</a> so that you can trigger different LED combinations by pressing the Wiimote’s buttons.</p>&#13;
<h4 class="h4" id="ch06lev2sec1">Introducing NeoPixels and the RGB Color System</h4>&#13;
<p class="noindent">At the start of this book, I introduced LEDs and showed you how to wire up a single-color LED to your Raspberry Pi and flash it on and off using a simple Python script.</p>&#13;
<p class="indent">That was a great project to get you started, but a lonely LED is hardly going to create the desired wow factor for your robot. Instead, for this project, we’ll use <em>NeoPixels</em> like the ones shown in <a href="ch06.xhtml#ch06fig1">Figure 6-1</a>.</p>&#13;
<div class="image" id="ch06fig1"><img alt="image" src="../images/f122-01.jpg"/></div>&#13;
<p class="caption"><strong>FIGURE 6-1</strong> NeoPixels on my robot</p>&#13;
<p class="indent">NeoPixels are a range of affordable, ultra-bright RGB LEDs from the open source hardware company Adafruit. <em>RGB</em>, which stands for <em>red green blue</em>, is a system of color mixing that computers use to <span epub:type="pagebreak" id="page_123"/>represent a massive spectrum of colors. Red, green, and blue light can be combined in various proportions to produce any color in the visible light spectrum, from orange to indigo to green! By setting the levels of R, G, and B each in a range of 0 to 100 percent intensity, you can create new colors. For example, pure red is represented by 100% R, 0% G, and 0% B, and purple is 50% R, 0% G, and 50% B.</p>&#13;
<p class="indent">Instead of percentages, computers normally represent the levels of each color as a range of decimal numbers from 0 to 255 (256 levels). So, for red the combination is 255 R, 0 G, and 0 B. See <a href="ch06.xhtml#ch06fig2">Figure 6-2</a> for the full RGB range represented as a color wheel.</p>&#13;
<div class="image" id="ch06fig2"><img alt="image" src="../images/f123-01.jpg"/></div>&#13;
<p class="caption"><strong>FIGURE 6-2</strong> The full RGB range represented as a color wheel</p>&#13;
<p class="indent">This means that, unlike the single-color LED, each RGB NeoPixel can display a huge range of colors. You can calculate the exact range by multiplying the number of possibilities for each level: 256 × 256 × 256 = 16,777,216. That’s almost 17 million different colors!</p>&#13;
<p class="indent">But how can a single LED represent so many colors? Well, if you look closely at the NeoPixel in <a href="ch06.xhtml#ch06fig3">Figure 6-3</a>, you’ll see that there are three distinct areas. This is because each NeoPixel actually comprises <em>three</em> LEDs: one each of red, green, and blue. You combine these colors in varying quantities, as discussed earlier, to produce an RGB color.</p>&#13;
<div class="image" id="ch06fig3"><img alt="image" src="../images/f124-01.jpg"/></div>&#13;
<p class="caption"><strong>FIGURE 6-3</strong> A macro shot of a NeoPixel</p>&#13;
<h4 class="h4" id="ch06lev2sec2">The Parts List</h4>&#13;
<p class="noindent"><span epub:type="pagebreak" id="page_124"/>NeoPixels can be used individually or chained together, and Adafruit has a huge range of NeoPixel products available in many different forms and sizes—from individual pixels to huge matrices made out of hundreds of NeoPixels.</p>&#13;
<p class="indent">In this project I recommend picking up a NeoPixel <em>Stick</em>—this is a roughly 2-inch-long LED arrangement of eight NeoPixels, as shown in <a href="ch06.xhtml#ch06fig4">Figure 6-4</a>. Its combination of small size and bright output makes it ideal for your robot.</p>&#13;
<div class="image" id="ch06fig4"><img alt="image" src="../images/f124-02.jpg"/></div>&#13;
<p class="caption"><strong>FIGURE 6-4</strong> NeoPixel Stick with headers soldered on</p>&#13;
<p class="indent">If you’re in the United States, you can buy one of these from Adafruit’s website for less than $6. If you’re elsewhere in the world, just search the net for “NeoPixel Stick,” and you should have no trouble finding one for a similar price from another retailer.</p>&#13;
<p class="indent">It is worth noting that the NeoPixel Stick does require a small degree of assembly: you will have to solder a set of male <em>headers</em> onto the power and Data-In pads, as shown in <a href="ch06.xhtml#ch06fig5">Figure 6-5</a>. There are two sets of pads on the back that look almost identical, except one side is for <em>input</em> into the Stick, and the other for <em>output</em> from the Stick. This is so you can chain the output of one Stick into the input of another Stick to join several together. We will only use one NeoPixel <span epub:type="pagebreak" id="page_125"/>Stick in this project, but you may want to experiment with more NeoPixels at a later point.</p>&#13;
<p class="indent">You’ll have to purchase some male headers separately (which cost less than $1) and solder them to the set of the terminal pads that includes the <em>DIN</em> (Data-In) pin.</p>&#13;
<p class="indent">If you have never soldered before, check out “How to Solder” on <a href="bm04.xhtml#page_204">page 204</a> for guidance.</p>&#13;
<div class="image" id="ch06fig5"><img alt="image" src="../images/f125-01.jpg"/></div>&#13;
<p class="caption"><strong>FIGURE 6-5</strong> The back of my NeoPixel Stick with headers soldered to the input side (L); an individual four-pin header (R)</p>&#13;
<p class="indent">Other than the NeoPixel Stick and headers, you’ll only need a few jumper wires to connect the NeoPixels, as well as some sticky tack to affix them to your Raspberry Pi robot.</p>&#13;
<h4 class="h4" id="ch06lev2sec3">Wiring Up Your NeoPixel Stick</h4>&#13;
<p class="noindent">Once you have a freshly soldered NeoPixel Stick, you can wire it up to your Pi. In total, only three connections are required to get it working. Remember that I won’t show the previous connections in the diagrams, but you don’t need to disconnect any of your previous projects to follow along with this one.</p>&#13;
<p class="indent">Like the HC-SR04 in the previous chapter, the Stick can be plugged directly into a breadboard, but as with that project, I don’t recommend doing so here. Instead, it’s better to connect the Stick using jumper wires so you can mount it elsewhere on your robot.</p>&#13;
<ol>&#13;
<li class="noindent">Use a jumper wire to connect the 4-7VDC pin of your NeoPixel Stick to the +5 V rail of your breadboard. Note that because these LEDs are extra bright, they draw a significant amount of current. Consequently, when we run the software later, you’ll need to connect and switch on the robot’s batteries.</li>&#13;
<li class="noindent"><span epub:type="pagebreak" id="page_126"/>Next, use another jumper wire to attach one of the GND pins of your Stick to the common ground rail of your breadboard. This grounds your NeoPixels to both the power supply (your bat­teries) and the Raspberry Pi. Check out <a href="ch06.xhtml#ch06fig6">Figure 6-6</a> for a diagram of what your setup should look like so far.&#13;
<div class="image" id="ch06fig6"><img alt="image" src="../images/f126-01.jpg"/></div>&#13;
<p class="caption"><strong>FIGURE 6-6</strong> Adafruit NeoPixel Stick connected to +5 V and ground</p></li>&#13;
<li class="noindent">Use a final jumper wire to connect the DIN (Data-In) pin of your NeoPixel Stick to physical pin 19 (BCM 10) on your Raspberry Pi (see “Raspberry Pi GPIO Diagram” on <a href="bm02.xhtml#page_200">page 200</a> for a guide to pin numbering). The complete circuit should look like <a href="ch06.xhtml#ch06fig7">Figure 6-7</a>.&#13;
<div class="image" id="ch06fig7"><img alt="image" src="../images/f126-02.jpg"/></div>&#13;
<p class="caption"><strong>FIGURE 6-7</strong> Complete breadboard diagram with the NeoPixel Stick wired up to power and your Pi</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_127"/>Use sticky tack to mount your NeoPixels somewhere on your robot. I’ve mounted mine to the right of the breadboard.</p></li>&#13;
</ol>&#13;
<h4 class="h4" id="ch06lev2sec4">Installing the Software</h4>&#13;
<p class="noindent">Before you program your NeoPixel Stick, you must first install and configure the necessary software. The Python library we’ll use is called <span class="literal">rpi_ws281x</span>, and you can download it from the internet for Python 3 using <span class="literal">pip</span>, a command line tool that allows you to quickly and easily install and manage Python software.</p>&#13;
<p class="indent">Before you proceed, you’ll need to ensure that you have <span class="literal">pip</span> installed for Python 3. To do so, boot up your Raspberry Pi and log in via SSH. Then, enter the following command into the terminal:</p>&#13;
<p class="codesingle"><span class="p1-green">pi@raspberrypi</span>:<span class="p-dark-blue">~ $</span> <span class="codestrong1">sudo apt-get update</span></p>&#13;
<p class="indent">This command doesn’t actually install new software; instead, it updates the list of available software your Raspberry Pi can download. After this process has completed, you can install <span class="literal">pip</span> for Python 3 with this command:</p>&#13;
<p class="codesingle"><span class="p1-green">pi@raspberrypi</span>:<span class="p-dark-blue">~ $</span> <span class="codestrong1">sudo apt-get install python3-pip</span></p>&#13;
<p class="indent">Most likely, you’ll be informed that <span class="literal">pip</span> is already installed for Python 3, in which case you’re ready to use it. If not, go through the installation process.</p>&#13;
<p class="indent">After this, you can install the <span class="literal">rpi_ws281x</span> library with one simple command:</p>&#13;
<p class="codesingle"><span class="p1-green">pi@raspberrypi</span>:<span class="p-dark-blue">~ $</span> <span class="codestrong1">sudo pip3 install rpi_ws281x</span></p>&#13;
<p class="indent">We will use the <em>SPI bus</em> to control the NeoPixels. This is just an electronics interface (the <em>serial peripheral interface</em>, to be exact) on select GPIO pins of every Raspberry Pi. By default, SPI is disabled, but you should have enabled it in the GUI when you set up your Pi at the start of this book. You can check that you have it enabled by opening the Raspberry Pi software configuration tool with this command:</p>&#13;
<p class="codesingle"><span class="p1-green">pi@raspberrypi</span>:<span class="p-dark-blue">~ $</span> <span class="codestrong1">sudo raspi-config</span></p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_128"/>Once the tool opens, scroll down to <strong>Interfacing Options</strong>, select it, and then press <span class="small">ENTER</span>. You’ll be presented with the menu in <a href="ch06.xhtml#ch06fig8">Figure 6-8</a>.</p>&#13;
<div class="image" id="ch06fig8"><img alt="image" src="../images/f128-01.jpg"/></div>&#13;
<p class="caption"><strong>FIGURE 6-8</strong> The Interfacing Options menu of the <span class="literal">raspi-config</span> tool</p>&#13;
<p class="indent">Scroll down and select <strong>SPI</strong>. You’ll then be asked whether you would like the SPI interface to be enabled. Use the left/right arrow keys to highlight <strong>Yes</strong>. After you’ve done so, you’ll return to the main <span class="literal">raspi-config</span> menu. You can exit the configuration tool by pressing the right arrow key twice (highlighting <strong>Finish</strong>) and then pressing <span class="small">ENTER</span>. Now reboot your Raspberry Pi using this command:</p>&#13;
<p class="codesingle"><span class="p1-green">pi@raspberrypi</span>:<span class="p-dark-blue">~ $</span> <span class="codestrong1">sudo reboot</span></p>&#13;
<p class="indent">Now SPI is enabled!</p>&#13;
<div class="box">&#13;
<p class="headbox">MAKING SPI WORK CORRECTLY ON PI 3</p>&#13;
<p class="noindent">If you’re using the Raspberry Pi 3 Model B/B+ there is one more step you’ll have to take before moving on. You don’t have to worry about this step if you’re using an older Pi.</p>&#13;
<p class="indent">To get SPI to work correctly on a Pi 3, you’ll have to change the GPU core frequency to 250 MHz. All this means is that you are changing the graphics unit on your Raspberry Pi 3 to run at a slightly different rate. If you don’t do this, your NeoPixels may behave erratically and not display the correct patterns.</p>&#13;
<p class="indent">To make this change, enter the following command into the terminal:</p>&#13;
<p class="codesingle"><span class="p1-green">pi@raspberrypi</span>:<span class="p-dark-blue">~ $</span> <span class="codestrong1">sudo nano /boot/config.txt</span></p>&#13;
<p class="indent">This will open up a configuration file containing various text and options. Scroll down to the bottom of this file and, on a new line, add this text:</p>&#13;
<p class="codesingle">core_freq=250</p>&#13;
<p class="indent">So, for example, the end of my configuration file looks like this:</p>&#13;
<p class="programs"><span class="literal1"><span class="codeitalic1">--snip--</span></span><br/># Additional overlays and parameters are documented /boot/<br/>overlays/README<br/><br/># Enable audio (loads snd_bcm2835)<br/>dtparam=audio=on<br/>start_x=1<br/>gpu_mem=128<br/><br/>core_freq=250</p>&#13;
<p class="indent">Once you have added this line, save the file in Nano by pressing <span class="small">CTRL</span>-X, and then press Y and <span class="small">ENTER</span>. Then reboot your Raspberry Pi.</p>&#13;
</div>&#13;
<div class="note">&#13;
<p class="note1"><strong>NOTE</strong></p>&#13;
<p class="notep"><em>If you think that this process may have changed, or you’re concerned that you have done this step incorrectly, check the book’s website at</em> <a href="https://nostarch.com/raspirobots/">https://nostarch.com/raspirobots/</a>.</p>&#13;
</div>&#13;
<h4 class="h4" id="ch06lev2sec5"><span epub:type="pagebreak" id="page_129"/>Configuring the Library’s Example Code</h4>&#13;
<p class="noindent">Before we go any further, let’s test the library you just installed to make sure everything is working perfectly. If you have already downloaded the software bundle that comes with this book onto your Raspberry Pi, then you already have the test file, <em>strandtest.py</em>. This program has been written by Adafruit to test out NeoPixels. If you don’t have it, <span epub:type="pagebreak" id="page_130"/>download the example code from the internet by entering the following command:</p>&#13;
<p class="codesingle"><span class="p1-green">pi@raspberrypi</span>:<span class="p-dark-blue">~/robot $</span> <span class="literal1"><span class="codestrong1">wget https://raw.githubusercontent.com/<br/>the-raspberry-pi-guy/raspirobots/master/strandtest.py</span></span></p>&#13;
<p class="indent">After this has finished, you will have the exact same test code that is provided in the software bundle.</p>&#13;
<p class="indent">Before running the example code, we need to change a few settings. To look at the code and the current settings, open the example code file using Nano as follows:</p>&#13;
<p class="codesingle"><span class="p1-green">pi@raspberrypi</span>:<span class="p-dark-blue">~/robot $</span> <span class="codestrong1">nano strandtest.py</span></p>&#13;
<p class="indent">The purpose of this program is run through several example light patterns. The code is quite long and full of functions that define the different sequences, but you don’t need to edit any of this code.</p>&#13;
<p class="indent">You will, however, need to edit some of the constants inside the program. Near the start of the code you’ll find the chunk of code to be edited, which is reproduced in <a href="ch06.xhtml#ch06list1">Listing 6-1</a>.</p>&#13;
<p class="programs"><span class="p-red">   # LED strip configuration:</span><br/><span class="ent">➊</span> LED_COUNT      = 16      <span class="p-red"># Number of LED pixels.</span><br/><span class="ent">➋</span> LED_PIN        = 18      <span class="p-red"># GPIO pin connected to the pixels </span><img alt="Image" src="../images/common.jpg"/><br/>                            <span class="p-red">(18 uses PWM!).</span><br/><span class="ent">➌</span> <span class="p-red">#LED_PIN       = 10 </span>     <span class="p-red"># GPIO pin connected to the pixels</span> <img alt="Image" src="../images/common.jpg"/><br/>                            <span class="p-red">(10 uses SPI /dev/spidev0.0).</span><br/>   LED_FREQ_HZ    = 800000  <span class="p-red"># LED signal frequency in hertz (usually </span><img alt="Image" src="../images/common.jpg"/><br/>                            <span class="p-red">800khz)</span><br/>   LED_DMA        = 10      <span class="p-red"># DMA channel to use for generating</span> <img alt="Image" src="../images/common.jpg"/><br/>                            <span class="p-red">signal (try 10)</span><br/>   LED_BRIGHTNESS = 255     <span class="p-red"># Set to 0 for darkest and 255 for</span> <img alt="Image" src="../images/common.jpg"/><br/>                            <span class="p-red">brightest</span><br/>   LED_INVERT     = <span class="p-purple">False</span>   <span class="p-red"># True to invert the signal (when using</span> <img alt="Image" src="../images/common.jpg"/><br/>                            <span class="p-red">NPN transistor level shift)</span><br/>   LED_CHANNEL    = 0       <span class="p-red"># set to '1' for GPIOs 13, 19, 41, 45</span> <img alt="Image" src="../images/common.jpg"/><br/>                            <span class="p-red">or 53</span><br/>   LED_STRIP      = ws.WS2811_STRIP_GRB   <span class="p-red"># Strip type and color</span><img alt="Image" src="../images/common.jpg"/><br/>                                          <span class="p-red">ordering</span></p>&#13;
<p class="listing" id="ch06list1"><strong>LISTING 6-1</strong> LED strip configuration of <em>strandtest.py</em></p>&#13;
<p class="indent">The words after each hash character (#) are <em>comments</em>. Programmers will often put comments in their code as a form of annotation. Comments help human readers and other programmers understand what the various parts of your program do.</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_131"/>In Python, a comment starts with a hash character (<span class="literal">#</span>). When Python interprets this code, it simply ignores everything after the hash. It is good coding practice to comment your programs, especially if you are working in a team or open-sourcing your work. Commenting is also handy as a reminder to yourself if you revisit a program in the future and have forgotten how it works!</p>&#13;
<p class="indent">The first thing you need to change appears at <span class="ent">➊</span>: <span class="literal">LED_COUNT</span>. This is a constant for the number of NeoPixels you have attached to your Pi. By default it is set to 16, so you need to change it to 8 instead.</p>&#13;
<p class="indent">Secondly, you’ll change the pin number being used. The constant <span class="literal">LED_PIN</span> at <span class="ent">➋</span> is set to BCM 18 by default, but your NeoPixel Stick is connected to BCM 10. The authors of this example code have noticed that using BCM 10 is a popular choice, so they’ve provided an alternative constant definition at <span class="ent">➌</span>, but commented it out.</p>&#13;
<p class="indent">To swap these lines around, add a hash to the start of the line at <span class="ent">➋</span>. This will <em>comment out</em> that line so that Python will ignore it. Then, remove the hash at <span class="ent">➌</span> to <em>uncomment</em> the line, which will make Python run the line of code assigning <span class="literal">LED_PIN</span> to 10.</p>&#13;
<p class="indent">Your final block of constants should now look like the code in <a href="ch06.xhtml#ch06list2">Listing 6-2</a>.</p>&#13;
<p class="programs"><span class="p-red"># LED strip configuration:</span><br/>LED_COUNT      = 8       <span class="p-red"># Number of LED pixels.</span><br/><span class="p-red">#LED_PIN       = 18</span>      <span class="p-red"># GPIO pin connected to the pixels (18</span> <img alt="Image" src="../images/common.jpg"/><br/>                         <span class="p-red">uses PWM!).</span><br/>LED_PIN        = 10   <span class="p-red">   # GPIO pin connected to the pixels (10</span> <img alt="Image" src="../images/common.jpg"/><br/>                         <span class="p-red">uses SPI /dev/spidev0.0).</span><br/>LED_FREQ_HZ    = 800000  <span class="p-red"># LED signal frequency in hertz (usually</span> <img alt="Image" src="../images/common.jpg"/><br/>                         <span class="p-red">800khz)</span><br/>LED_DMA        = 10      <span class="p-red"># DMA channel to use for generating</span> <img alt="Image" src="../images/common.jpg"/><br/>                         <span class="p-red">signal (try 10)</span><br/>LED_BRIGHTNESS = 255    <span class="p-red"> # Set to 0 for darkest and 255 for</span> <img alt="Image" src="../images/common.jpg"/><br/>                         <span class="p-red">brightest</span><br/>LED_INVERT     = <span class="p-purple">False</span>   <span class="p-red"># True to invert the signal (when using</span> <img alt="Image" src="../images/common.jpg"/><br/>                         <span class="p-red">NPN transistor level shift)</span><br/>LED_CHANNEL    = 0       <span class="p-red"># set to '1' for GPIOs 13, 19, 41, 45 or 53</span><br/>LED_STRIP      = ws.WS2811_STRIP_GRB   <span class="p-red"># Strip type and color</span> <img alt="Image" src="../images/common.jpg"/><br/>                                       <span class="p-red">ordering</span></p>&#13;
<p class="listing" id="ch06list2"><strong>LISTING 6-2</strong> The new LED strip configuration of <em>strandtest.py</em></p>&#13;
<p class="indent">Once you have your code set up, you can run it.</p>&#13;
<h4 class="h4" id="ch06lev2sec6"><span epub:type="pagebreak" id="page_132"/>Running the Example Code</h4>&#13;
<p class="noindent">Save the changes you have made to the example program and run it with the following command:</p>&#13;
<p class="codesingle"><span class="p1-green">pi@raspberrypi</span>:<span class="p-dark-blue">~/robot $</span> <span class="codestrong1">python3 strandtest.py -c</span></p>&#13;
<p class="indent">And you might want to grab a pair of sunglasses! Your NeoPixels should now be going through a sequence of patterns, the names of which are displayed in the terminal as they start (see <a href="ch06.xhtml#ch06fig9">Figure 6-9</a>).</p>&#13;
<div class="image" id="ch06fig9"><img alt="image" src="../images/f132-01.jpg"/></div>&#13;
<p class="caption"><strong>FIGURE 6-9</strong> NeoPixels going through the <em>strandtest.py</em> example program</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="ch06lev2sec7page_133"/>When your retinas have had enough, press <span class="small">CTRL</span>-C to kill the example code. The <span class="literal">–c</span> you should have added to the end of your original run command should turn off your LEDs. If you didn’t add <span class="literal">–c</span> to the command, killing the program will just freeze your LEDs and they will remain powered on.</p>&#13;
<p class="indent">If you’re worried about the intensity of your LEDs and being blinded, don’t fret! As we add NeoPixel control to the Wiimote program, I’ll show you how to turn down their brightness.</p>&#13;
<h4 class="h4" id="ch06lev2sec7">Controlling NeoPixels Using the Wiimote Program</h4>&#13;
<p class="noindent">Now that you have tested out your NeoPixels and seen what they’re capable of, it’s time to add LED-controlling capabilities to the accelerometer-based Wiimote program you made earlier.</p>&#13;
<p class="indent">We’re going to add NeoPixels to the Wiimote program, but it would be ideal to keep a copy of the original Wiimote code without these additions just in case something goes wrong or we want to go back to it in future. To do this, we’ll create and edit a copy of the <span epub:type="pagebreak" id="page_133"/>program instead. First, make sure you are in the directory where your code is stored; for me, that’s my <em>robot</em> directory. Then, in the terminal, copy your original Wiimote program using the command <span class="literal">cp</span>:</p>&#13;
<p class="codesingle"><span class="p1-green">pi@raspberrypi</span>:<span class="p-dark-blue">~/robot $</span> <span class="codestrong1">cp remote_control_accel.py neo_remote_</span><br/><span class="codestrong1">control.py</span></p>&#13;
<p class="indent">This command simply copies the contents of its first argument (<em>remote_control_accel.py</em>) to the new file specified in the second argument. As you can see, I have decided to name my NeoPixel version of the Wiimote program <em>neo_remote_control.py</em>. After this, open the newly copied file with Nano like so:</p>&#13;
<p class="codesingle"><span class="p1-green">pi@raspberrypi</span>:<span class="p-dark-blue">~/robot $</span> <span class="codestrong1">nano neo_remote_control.py</span></p>&#13;
<p class="indent">Now enter the modifications to the code in <a href="ch06.xhtml#ch06list3">Listing 6-3</a>, or you can download the complete program at <em><a href="https://nostarch.com/raspirobots/">https://nostarch.com/raspirobots/</a></em>. I have omitted and compressed the parts of the program that have not changed.</p>&#13;
<p class="programs">   <span class="p-blue">import</span> gpiozero<br/>   <span class="p-blue">import</span> cwiid<br/>   <span class="p-blue">import</span> time<br/><span class="ent">➊</span> <span class="p-blue">from</span> rpi_ws281x <span class="p-blue">import</span> *<br/><br/>   robot = gpiozero.Robot(left=(17,18), right=(27,22))<br/>   <span class="literal1"><span class="codeitalic1">--snip--</span></span><br/>   wii.rpt_mode = cwiid.RPT_BTN | cwiid.RPT_ACC<br/><br/>   LED_COUNT      = 8<br/>   LED_PIN        = 10<br/>   LED_FREQ_HZ    = 800000<br/>   LED_DMA        = 10<br/><span class="ent">➋</span> LED_BRIGHTNESS = 150<br/>   LED_INVERT     = <span class="p-purple">False</span><br/>   LED_CHANNEL    = 0<br/>   LED_STRIP      = ws.WS2811_STRIP_GRB<br/><br/><span class="ent">➌</span> strip = Adafruit_NeoPixel(LED_COUNT, LED_PIN, LED_FREQ_HZ,<br/>   LED_DMA, LED_INVERT, LED_BRIGHTNESS, LED_CHANNEL, LED_STRIP)<br/>   strip.begin()<br/><br/><span class="ent">➍</span> <span class="p-blue">def</span> <span class="p-dark-blue">colorWipe</span>(strip, color, wait_ms=50):<br/>       <span class="p1-green">"""Wipe color across display a pixel at a time."""</span><br/><span class="ent">➎</span>     <span class="p-blue">for</span> i <span class="p-blue">in</span> range(strip.numPixels()):<br/>           strip.setPixelColor(i, color)<br/>           strip.show()<br/>           time.sleep(wait_ms/1000.0)<br/>   <span class="p-blue">while</span> <span class="p-purple">True</span>:<br/><span class="ent">➏</span>     buttons = wii.state[<span class="p1-green">"buttons"</span>]<br/>       <span class="p-blue">if</span> (buttons &amp; cwiid.BTN_PLUS):<br/>           colorWipe(strip, Color(255, 0, 0))  <span class="p-red"># Red wipe</span><br/>       <span class="p-blue">if</span> (buttons &amp; cwiid.BTN_HOME):<br/>           colorWipe(strip, Color(0, 255, 0))  <span class="p-red"># Blue wipe</span><br/>       <span class="p-blue">if</span> (buttons &amp; cwiid.BTN_MINUS):<br/>           colorWipe(strip, Color(0, 0, 255))  <span class="p-red"># Green wipe</span><br/>       <span class="p-blue">if</span> (buttons &amp; cwiid.BTN_B):<br/>           colorWipe(strip, Color(0, 0, 0))    <span class="p-red"># Blank</span><br/><br/>       x = (wii.state[<span class="p1-green">"acc"</span>][cwiid.X] - 95) - 25<br/>       <span class="literal1"><span class="codeitalic1">--snip--</span></span><br/>       <span class="p-blue">if</span> (turn_value &lt; 0.3) <span class="p-blue">and</span> (turn_value &gt; -0.3):<br/>           robot.value = (forward_value, forward_value)<br/>       <span class="p-blue">else</span>:<br/>           robot.value = (-turn_value, turn_value)</p>&#13;
<p class="listing" id="ch06list3"><strong>LISTING 6-3</strong> The updated Wiimote code with NeoPixel functionality</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_134"/>This program relies on two additional sets of libraries that the original Wiimote code did not, so we need to import both the <span class="literal">time</span> and <span class="literal">rpi_ws281x</span> libraries <span class="ent">➊</span>.</p>&#13;
<p class="indent">Then, just as with the original program, we set up the robot and Wiimote for use. After this, we define the same chunk of constants we saw in the example NeoPixel program. These define the various parameters for the NeoPixel Stick. Most notably, you’ll find <span class="literal">LED_BRIGHTNESS</span> <span class="ent">➋</span>, a constant that can be set between 0 and 255. I have set mine to be dimmer and easier on the eyes at 150.</p>&#13;
<p class="indent">At <span class="ent">➌</span>, we create the NeoPixel Stick object and set up the constants defined previously. The library is initialized on the following line.</p>&#13;
<p class="indent">We then define a function called <span class="literal">colorWipe()</span> <span class="ent">➍</span> to use later. This function has been taken directly out of the <em>strandtest.py</em> example. The comment inside it describes what the function does: it wipes a color across the NeoPixel Stick one pixel at a time. To do this, it takes an RGB <span class="literal">color</span> parameter and then uses a <span class="literal">for</span> loop <span class="ent">➎</span> to set each pixel to that color one by one, with a short delay in between.</p>&#13;
<p class="indent">After this, we start the main body of code in the infinite <span class="literal">while</span> loop. At the start of each loop, the status of the Wiimote buttons is read <span class="ent">➏</span>. Then, depending on whether the user presses the plus, minus, or home button, a different color will wipe across the NeoPixel Stick and remain there until another button is pressed. If the user presses the B button, the NeoPixels will be reset.</p>&#13;
<p class="indent">The rest of the program is exactly the same as the original: it deals with the accelerometer output from the controller and makes the robot move accordingly.</p>&#13;
<h4 class="h4" id="ch06lev2sec8"><span epub:type="pagebreak" id="page_135"/>Running Your Program: NeoPixels and Wiimote Control</h4>&#13;
<p class="noindent">Save your work and run your code with the following command:</p>&#13;
<p class="codesingle"><span class="p1-green">pi@raspberrypi</span>:<span class="p-dark-blue">~/robot $</span> <span class="codestrong1">python3 neo_remote_control.py</span></p>&#13;
<p class="indent">Your robot should now respond to the accelerometer data from your Wiimote. Try pressing the plus, minus, home, and B buttons to trigger the different lights, as shown in <a href="ch06.xhtml#ch06fig10">Figure 6-10</a>.</p>&#13;
<div class="image" id="ch06fig10"><img alt="image" src="../images/f135-01.jpg"/></div>&#13;
<p class="caption"><strong>FIGURE 6-10</strong> My robot with its NeoPixels set to blue</p>&#13;
<p class="indent">Before you kill the program with <span class="small">CTRL</span>-C, make sure you press the B button on your Wiimote to turn the NeoPixels off!</p>&#13;
<h4 class="h4" id="ch06lev2sec9">Challenge Yourself: Experiment with Color and Pattern</h4>&#13;
<p class="noindent">Once you have played around with your robot and NeoPixels, go back into the program and the example code shown previously to see if you can set your own custom colors by changing the RGB color combinations. Or, see if you can create more adventurous light patterns to display.</p>&#13;
<p class="indent">If you have more than one NeoPixel Stick, you can chain them together by feeding the output of one into the input of the other to create an even more dazzling two-wheeler!</p>&#13;
<h3 class="h3" id="ch06lev1sec2"><span epub:type="pagebreak" id="page_136"/>ADDING A SPEAKER TO YOUR RASPBERRY PI ROBOT</h3>&#13;
<p class="noindent">While your robot has already come a long way, one feature that has been notably absent is the ability to make noise and communicate. In the following two projects, we’ll change that! I’ll guide you through adding a small 3.5 mm speaker to your robot and using it to add sound to two previous projects: a car horn for the Wiimote program, and a parking-sensor-style beep for your obstacle avoidance program.</p>&#13;
<div class="note">&#13;
<p class="note-warning"><strong>WARNING</strong></p>&#13;
<p class="note-warning1"><em>You’ll only be able to follow along with these projects if you have a full-size Raspberry Pi like the Pi 3, Pi 2, Pi 1 Model B/B+ or even A+. Models such as the Pi Zero and Pi Zero W do not feature 3.5 mm audio jacks and therefore can’t easily connect to a speaker.</em></p>&#13;
</div>&#13;
<h4 class="h4" id="ch06lev2sec10">Understanding How 3.5 mm Speakers Work</h4>&#13;
<p class="noindent">A <em>loudspeaker</em> (or just plain <em>speaker</em>) converts an electrical audio signal into a sound that can be heard by humans. You’ll have come across many speakers in a wide range of environments—from huge speakers at concerts to the minuiscule ones inside your mobile phone.</p>&#13;
<p class="indent">In order to translate an electrical signal into an audible sound, speakers use an electromagnet to vibrate a cone. This cone amplifies those vibrations and pumps sound waves into the surrounding air and to your ears.</p>&#13;
<p class="indent">For the following two projects you’ll need a small 3.5 mm speaker, like the one shown in <a href="ch06.xhtml#ch06fig11">Figure 6-11</a>. The 3.5 mm sizing refers to the diameter of the audio jack. This size is an industry standard, and the same as most phone headphone jacks.</p>&#13;
<div class="image" id="ch06fig11"><img alt="image" src="../images/f136-01.jpg"/></div>&#13;
<p class="caption"><strong>FIGURE 6-11</strong> My small 3.5 mm speaker</p>&#13;
<div class="note">&#13;
<p class="note1"><strong>NOTE</strong></p>&#13;
<p class="notep"><em>If your speaker isn’t rechargeable, the method you use to power it will depend on the exact model. If it requires USB power, you could plug it into one of your Pi’s USB ports. Having a rechargeable speaker avoids this issue and is therefore the most ideal option in this situation.</em></p>&#13;
</div>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_137"/><span epub:type="pagebreak" id="page_138"/>You can pick up a 3.5 mm speaker online by searching eBay, Amazon, or any regular electronics retailer. It should set you back no more than $10. The make and brand isn’t that relevant; as long as it is small enough to fit on your robot, is relatively loud, and has a 3.5 mm jack, you should be good!</p>&#13;
<h4 class="h4" id="ch06lev2sec11">Connecting Your Speaker</h4>&#13;
<p class="noindent">Most small speakers are rechargeable, so before you begin connecting your speaker to your Raspberry Pi, make sure that it is fully charged and operational.</p>&#13;
<p class="indent">Your Pi’s 3.5 mm audio jack is between the HDMI and Ethernet ports. Take your speaker and plug its 3.5 mm cable into the jack on your Pi, as shown in <a href="ch06.xhtml#ch06fig12">Figure 6-12</a>.</p>&#13;
<div class="image" id="ch06fig12"><img alt="image" src="../images/f137-01.jpg"/></div>&#13;
<p class="caption"><strong>FIGURE 6-12</strong> Speaker connected to my Raspberry Pi through the 3.5 mm audio jack</p>&#13;
<p class="indent">Now mount your speaker somewhere on your robot chassis. Where you mount it depends on the size of your speaker, as well as the free space that you have available. Since I didn’t have enough room to simply attach the speaker to the main chassis, I decided to create a small stalk out of a few LEGO pieces, and then affixed my speaker with sticky tack, as shown in <a href="ch06.xhtml#ch06fig13">Figure 6-13</a>.</p>&#13;
<div class="image" id="ch06fig13"><img alt="image" src="../images/f138-01.jpg"/></div>&#13;
<p class="caption"><strong>FIGURE 6-13</strong> My 3.5 mm speaker connected to my Pi and mounted on top of a small LEGO stalk</p>&#13;
<h3 class="h3" id="ch06lev1sec3">ADDING A CAR HORN TO THE WIIMOTE PROGRAM</h3>&#13;
<p class="noindent">Now let’s extend the previous program so that your robot sounds a car horn at your command. We’ll edit the NeoPixel Wiimote program to activate a horn sound effect when the A button on your Wiimote is pressed.</p>&#13;
<h4 class="h4" id="ch06lev2sec12">Installing the Software</h4>&#13;
<p class="noindent">Normally you’d play an audio file by clicking it on a GUI and opening it in a music playing application. Unlike a GUI, though, the terminal leaves you with no such ability, so you have to use special commands to play audio files. As with the NeoPixels, you first need to install the required software and configure the sound output.</p>&#13;
<p class="indent">First, ensure that the <span class="literal">alsa-utils</span> software package is already installed on your Raspberry Pi. This is a collection of software that relates to audio and device drivers. You can check whether it’s installed or install the package using this command:</p>&#13;
<p class="codesingle"><span class="p1-green">pi@raspberrypi</span>:<span class="p-dark-blue">~/robot $</span> <span class="codestrong1">sudo apt-get install alsa-utils</span></p>&#13;
<p class="indent">If your Pi tells you that it already has the latest version of <span class="literal">alsa-utils</span>, then great! If not, you’ll need to go through the quick installation process, responding to the prompts.</p>&#13;
<p class="indent">After this, the only remaining step is to tell the Raspberry Pi to play audio through the 3.5 mm audio jack instead of the HDMI port. We do this in the terminal by using the Raspberry Pi configuration tool <span class="literal">raspi-config</span>, just like we did earlier. To open this tool, use the following command:</p>&#13;
<p class="codesingle"><span class="p1-green">pi@raspberrypi</span>:<span class="p-dark-blue">~/robot $</span> <span class="codestrong1">sudo raspi-config</span></p>&#13;
<p class="indent">You should see a blue screen with options in a gray box in the center, as in <a href="ch06.xhtml#ch06fig14">Figure 6-14</a>.</p>&#13;
<div class="image" id="ch06fig14"><img alt="image" src="../images/f139-01.jpg"/></div>&#13;
<p class="caption"><strong>FIGURE 6-14</strong> The Raspberry Pi software configuration tool</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_139"/>Now use the arrow keys to scroll down and select <strong>Advanced Options</strong> and then press <span class="small">ENTER</span>. This will open up a new menu; scroll down to <strong>Audio</strong>, select it, and press <span class="small">ENTER</span> again.</p>&#13;
<p class="indent">Once here, you will be provided with the three options. Select the <strong>Force 3.5mm jack</strong> option, as shown in <a href="ch06.xhtml#ch06fig15">Figure 6-15</a>.</p>&#13;
<div class="image" id="ch06fig15"><img alt="image" src="../images/f139-02.jpg"/></div>&#13;
<p class="caption"><strong>FIGURE 6-15</strong> Choosing the audio output using <span class="literal">raspi-config</span></p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_140"/>Next, you’ll be returned to the original menu shown in <a href="ch06.xhtml#ch06fig14">Figure 6-14</a>. From there exit the configuration tool by pressing the right arrow key twice (to highlight <strong>Finish</strong>) and then pressing <span class="small">ENTER</span>.</p>&#13;
<h4 class="h4" id="ch06lev2sec13">Playing Sounds from the Terminal</h4>&#13;
<p class="noindent">To play sounds from the terminal, you first need some sounds to play! The audio files for this project and the next one can be found online at <em><a href="https://nostarch.com/raspirobots/">https://nostarch.com/raspirobots/</a></em>. If you have downloaded all of the software in bulk, then you’ll already have the files. Alternatively, you can grab the two audio files off the internet with a few easy commands. Either way, first create a new directory called <em>sounds</em> inside the folder where you’re storing all of your robot programs. For me, this command looks like:</p>&#13;
<p class="codesingle"><span class="p1-green">pi@raspberrypi</span>:<span class="p-dark-blue">~/robot $</span> <span class="codestrong1">mkdir sounds</span></p>&#13;
<p class="indent">If you downloaded the files in bulk, transfer the files <em>beep.wav</em> and <em>horn.wav</em> into this new folder. If you want to download the files directly, then change into that directory as follows:</p>&#13;
<p class="codesingle"><span class="p1-green">pi@raspberrypi</span>:<span class="p-dark-blue">~/robot $</span> <span class="codestrong1">cd sounds</span></p>&#13;
<p class="indent">Finally, to download each of the audio files, use this command:</p>&#13;
<p class="codesingle"><span class="p1-green">pi@raspberrypi</span>:<span class="p-dark-blue">~/robot/sounds $</span> <span class="literal1"><span class="codestrong1">wget https://raw.githubusercontent<br/>.com/the-raspberry-pi-guy/raspirobots/master/sounds/beep.wav</span></span></p>&#13;
<p class="indent">Followed by this one:</p>&#13;
<p class="codesingle"><span class="p1-green">pi@raspberrypi</span>:<span class="p-dark-blue">~/robot/sounds $</span> <span class="literal1"><span class="codestrong1">wget https://raw.githubusercontent<br/>.com/the-raspberry-pi-guy/raspirobots/master/sounds/horn.wav</span></span></p>&#13;
<p class="indent">Now if you enter <span class="literal">ls</span> in the terminal, you’ll find two new audio files—<em>horn.wav</em> and <em>beep.wav</em>:</p>&#13;
<p class="programs"><span class="p1-green">pi@raspberrypi</span>:<span class="p-dark-blue">~/robot/sounds $</span> <span class="codestrong1">ls</span><br/>horn.wav  beep.wav</p>&#13;
<p class="indent">The former is the file we’ll use in this project. Before you test <em>horn.wav</em>, increase the software volume level of your speaker to its maximum with this command:</p>&#13;
<p class="codesingle"><span class="p1-green">pi@raspberrypi</span>:<span class="p-dark-blue">~/robot/sounds $</span> <span class="codestrong1">amixer set PCM 100%</span></p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_141"/>Also ensure that any physical volume control on your 3.5 mm speaker is at its maximum. Then, to play <em>horn.wav</em> through your 3.5 mm speaker, you’ll use <span class="literal">aplay</span>, a terminal-based sound player, like so:</p>&#13;
<p class="codesingle"><span class="p1-green">pi@raspberrypi</span>:<span class="p-dark-blue">~/robot/sounds $</span> <span class="codestrong1">aplay horn.wav</span><br/>Playing WAVE 'horn.wav' : Signed 24 bit Little Endian in 3bytes,<br/>Rate 44100 Hz, Stereo</p>&#13;
<p class="indent">You should hear your robot emit a single car horn noise!</p>&#13;
<h4 class="h4" id="ch06lev2sec14">Playing Sound Using the Wiimote Program</h4>&#13;
<p class="noindent">Now that you understand how to play sound files through the terminal, you can add this functionality to the Wiimote program from earlier in the chapter. This means that your robot will be able not only to trigger a light show, but also to sound a car horn whenever you wish!</p>&#13;
<p class="indent">To accomplish this, we’ll call the <span class="literal">aplay</span> command from inside Python. Navigate back into the <em>robots</em> directory and then reopen the NeoPixel/Wiimote code with this command:</p>&#13;
<p class="codesingle"><span class="p1-green">pi@raspberrypi</span>:<span class="p-dark-blue">~/robot $</span> <span class="codestrong1">nano neo_remote_control.py</span></p>&#13;
<p class="indent">Then, enter the additions in <a href="ch06.xhtml#ch06list4">Listing 6-4</a> into your own code. As before, all of the unchanged code has been omitted. Alternatively, you can grab the modified file from the book’s website.</p>&#13;
<p class="programs">   <span class="p-blue">import</span> gpiozero<br/>   <span class="p-blue">import</span> cwiid<br/>   <span class="p-blue">import</span> time<br/>   <span class="p-blue">from</span> rpi_ws281x <span class="p-blue">import</span><span class="p-red"/> *<br/><span class="ent">➊</span> <span class="p-blue">import</span> os<br/><br/>   robot = gpiozero.Robot(left=(17,18), right=(27,22))<br/>   <span class="literal1"><span class="codeitalic1">--snip--</span></span><br/><br/>   <span class="p-blue">while</span> <span class="p-purple">True</span>:<br/>       buttons = wii.state[<span class="p1-green">"buttons"</span>]<br/>       <span class="p-blue">if</span> (buttons &amp; cwiid.BTN_PLUS):<br/>           colorWipe(strip, Color(255, 0, 0))  <span class="p-red"># Red wipe</span><br/>       <span class="literal1"><span class="codeitalic1">--snip--</span></span><br/>       <span class="p-blue">if</span> (buttons &amp; cwiid.BTN_B):<br/>           colorWipe(strip, Color(0, 0, 0))    <span class="p-red"># Blank</span><br/><br/><span class="ent">➋</span>     <span class="p-blue">if</span> (buttons &amp; cwiid.BTN_A):<br/>           os.system(<span class="p1-green">"aplay sounds/horn.wav"</span>)<br/><br/>        x = (wii.state[<span class="p1-green">"acc"</span>][cwiid.X] - 95) - 25<br/>       <span class="literal1"><span class="codeitalic1">--snip--</span></span><br/>       <span class="p-blue">if</span> (turn_value &lt; 0.3) <span class="p-blue">and</span> (turn_value &gt; -0.3):<br/>           robot.value = (forward_value, forward_value)<br/>       <span class="p-blue">else</span>:<br/>           robot.value = (-turn_value, turn_value)</p>&#13;
<p class="listing" id="ch06list4"><strong>LISTING 6-4</strong> The modified NeoPixel/Wiimote code with car horn sound effect</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_142"/>The additions required are simple and span only three lines. The first thing to note is at <span class="ent">➊</span>, where the <span class="literal">os</span> library is imported. The <span class="literal">os</span> library enables us to use the functionality of the Pi’s operating system inside of a Python program.</p>&#13;
<p class="indent">This comes in handy at <span class="ent">➋</span>. Here, the program detects whether the user has pressed the A button on the Wiimote. If so, the same <span class="literal">aplay</span> terminal command you used earlier is called using <span class="literal">os.system</span>. Notice that there is also a short filepath to the <em>horn.wav</em> sound, as this file is stored in a different directory than the program.</p>&#13;
<h4 class="h4" id="ch06lev2sec15">Running Your Program: NeoPixels, Sound Effects, and the Wiimote Control</h4>&#13;
<p class="noindent">Save your work and run it with the same command as the previous project:</p>&#13;
<p class="codesingle"><span class="p1-green">pi@raspberrypi</span>:<span class="p-dark-blue">~/robot $</span> <span class="codestrong1">python3 neo_remote_control.py</span></p>&#13;
<p class="indent">Your robot will now respond exactly as before, with accelero­meter control. You’ll also be able to trigger the same lights as before. Now try pressing the A button: you should hear your robot honk its horn!</p>&#13;
<h3 class="h3" id="ch06lev1sec4">ADDING BEEPING TO THE OBSTACLE AVOIDANCE PROGRAM</h3>&#13;
<p class="noindent">In this project, we’ll revisit the obstacle avoidance program you already coded in <a href="ch05.xhtml#ch05">Chapter 5</a>, and add a beeping sound to alert you when your robot has detected an obstacle within a 15 cm range.</p>&#13;
<h4 class="h4" id="ch06lev2sec16">Integrating the Beep Sound into the Obstacle Avoidance Program</h4>&#13;
<p class="noindent">You’ve already set up your speaker and configured the necessary software, so we can jump straight into integrating the beep sound into the obstacle avoidance program.</p>&#13;
<p class="indent">We’ll do this as we did with the horn: by calling <span class="literal">aplay</span> inside of the Python program. I recommend using <span class="literal">cp</span> to create a new copy <span epub:type="pagebreak" id="page_143"/>of the obstacle avoidance program. I’ve called mine <em>beep_obstacle_avoider.py</em>. Enter the modifications I made as shown in <a href="ch06.xhtml#ch06list5">Listing 6-5</a>.</p>&#13;
<p class="programs">   <span class="p-blue">import</span> gpiozero<br/>   <span class="p-blue">import</span> time<br/><span class="ent">➊</span> <span class="p-blue">import</span> os<br/><br/>   TRIG = 23<br/>   ECHO = 24<br/><br/>   trigger = gpiozero.OutputDevice(TRIG)<br/>   --<span class="literal1"><span class="codeitalic1">snip</span></span>--<br/><br/>   <span class="p-blue">while</span> <span class="p-purple">True</span>:<br/>      dist = get_distance(trigger,echo)<br/>      <span class="p-blue">if</span> dist &lt;= 15:<br/><span class="ent">➋</span>         os.system(<span class="p1-green">"aplay sounds/beep.wav"</span>)<br/>           robot.right(0.3)<br/>           time.sleep(0.25)<br/>      <span class="p-blue">else</span>:<br/>           robot.forward(0.3)<br/>           time.sleep(0.1)</p>&#13;
<p class="listing" id="ch06list5"><strong>LISTING 6-5</strong> The <em>beep_obstacle_avoider.py</em> program</p>&#13;
<p class="indent">Just as before, we import the <span class="literal">os</span> module <span class="ent">➊</span>. Then, if the sensor detects an object less than or equal to 15 cm away, the program plays the beep sound <span class="ent">➋</span> and the robot changes course.</p>&#13;
<h4 class="h4" id="ch06lev2sec17">Running Your Program: Beeping Obstacle Avoidance</h4>&#13;
<p class="noindent">Save your work and run it with the following command:</p>&#13;
<p class="codesingle"><span class="p1-green">pi@raspberrypi</span>:<span class="p-dark-blue">~/robot $</span> <span class="codestrong1">python3 beep_obstacle_avoider.py</span></p>&#13;
<p class="indent">Your robot will now avoid obstacles and beep when it does so!</p>&#13;
<h4 class="h4" id="ch06lev2sec18">Challenge Yourself: Add Sound Effects to Your Other Projects</h4>&#13;
<p class="noindent">Now that you know the relatively simple process of adding audio effects to a program, why not revisit the other programs you have written over the course of this book and add sound to them? You could use your phone to record your own noises, or you can use online sound libraries that provide free audio files. For example, take a look at Freesound: <em><a href="https://freesound.org/">https://freesound.org/</a></em>.</p>&#13;
<h3 class="h3" id="ch06lev1sec5">SUMMARY</h3>&#13;
<p class="noindent"><span epub:type="pagebreak" id="page_144"/>In this chapter you have decked out your robot with some super-bright NeoPixels and given it the gift of sound, too! Over the course of three different projects, we’ve covered everything from the theory of RGB LEDs to how to play audio in the terminal.</p>&#13;
<p class="indent">In the next chapter, we’ll make your robot a little bit more intelligent! I’ll guide you through the process of giving your two-wheeler the ability to autonomously follow lines.</p>&#13;
</body></html>