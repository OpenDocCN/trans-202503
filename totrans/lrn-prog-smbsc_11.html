<html><head></head><body>
<h2 class="h2" id="ch11"><span epub:type="pagebreak" id="page_149"/><span class="big"><span class="blue"><strong>11</strong></span></span><br/><strong>EVENT-DRIVEN PROGRAMMING</strong></h2>&#13;
<div class="imagec"><img alt="image" src="graphics/common01.jpg"/></div>&#13;
<p class="noindent">So far, the programs you’ve written have been mostly <em>sequential</em> because they have followed the lines of code in order, from top to bottom. Some statements might have made a comparison or called a subroutine to take a detour, but overall the order of statements has been mostly linear.</p>&#13;
<p class="indent">In some ways, this is comparable to how you go about your daily routine: you wake up, make your bed, take a shower, eat your breakfast, watch TV, comb your hair, and so on. But what if the phone rings during your routine? If you’re expecting a call from a friend to confirm that night’s party, you’d better take it! Even though you’re doing something at that moment, you’re also listening for the phone. The minute you hear the ring (the event), you drop everything and take the call (let’s just hope it isn’t your aunt calling to see if you finished reading <em>Little House on the Freeway</em>).</p>&#13;
<p class="indent">Similarly, many computer programs (especially games) use <em>event-driven programming</em>, which means they listen and respond to events raised <span epub:type="pagebreak" id="page_150"/>by the operating system (see <a href="ch11.html#ch11fig1">Figure 11-1</a>). Think of an <em>event</em> as a signal that’s raised in response to an action, like moving or clicking the mouse, clicking a button, typing on the keyboard, having a timer expire, and so on. Some objects in the Small Basic library can see these events and tell you when they happen. Programmers say that an object <em>raised</em> an event. You can write some exciting applications and games by handling these events (like a super fun explosion farming game). These games typically wait patiently for the player to move the mouse or press some keys, and then they take action.</p>&#13;
<div class="image"><img alt="image" src="graphics/f11-01.jpg"/></div>&#13;
<p class="figcap"><a id="ch11fig1"/><em>Figure 11-1: The event-driven programming model</em></p>&#13;
<p class="indent">In <a href="ch11.html#ch11fig1">Figure 11-1</a>, the events are at the top. When a user triggers an action (like pressing a key), the Small Basic library knows about it. If you want to know when an event happens, you can ask Small Basic to inform you when an event occurs so you can write programs that react to certain events.</p>&#13;
<p class="indent">The Small Basic library has three objects that handle events (see <a href="ch11.html#ch11fig2">Figure 11-2</a>): <code>GraphicsWindow</code>, <code>Timer</code>, and <code>Controls</code>. You’ll study the events of <code>GraphicsWindow</code> and <code>Timer</code> objects in this chapter, and you’ll tackle the events of the <code>Controls</code> object in the next chapter.</p>&#13;
<div class="image"><img alt="image" src="graphics/f11-02.jpg"/></div>&#13;
<p class="figcap"><a id="ch11fig2"/><em>Figure 11-2: The available events in Small Basic</em></p>&#13;
<h3 class="h3" id="ch11lev1sec01"><span epub:type="pagebreak" id="page_151"/><span class="blue"><strong>GraphicsWindow Events</strong></span></h3>&#13;
<p class="noindent">Let’s start by exploring the events in <code>GraphicsWindow</code>. When a user interacts with your application, <code>GraphicsWindow</code> knows when keys are pressed, which keys are pressed, and if the user clicks or moves the mouse. Although <code>GraphicsWindow</code> knows about these events, it doesn’t automatically do anything when the events happen. You need to instruct <code>GraphicsWindow</code> to tell you when these events happen so you can use them. Next, you’ll learn how to use the information Small Basic knows about the user to create interesting, interactive applications.</p>&#13;
<h4 class="h4" id="ch11lev2sec01"><em><strong>Create Patterns with the MouseDown Event</strong></em></h4>&#13;
<p class="noindent">Let’s make a simple application that draws a randomly colored circle every time the user clicks the graphics window. Enter the code in <a href="ch11.html#ch11ex1">Listing 11-1</a>.</p>&#13;
<p class="programs">1 <span class="green"><span class="codeitalic">' Circles.sb</span></span><br/>2 <span class="blue1">GraphicsWindow</span><span class="brown">.MouseDown =</span> OnMouseDown<br/>3<br/>4 <span class="purple"><span class="codestrong">Sub</span></span> OnMouseDown<br/>5   <span class="blue1">GraphicsWindow</span><span class="brown">.PenColor =</span> <span class="blue1">GraphicsWindow</span><span class="brown">.GetRandomColor()</span><br/>6   X0 <span class="brown">=</span> <span class="blue1">GraphicsWindow</span><span class="brown">.MouseX -</span> <span class="red">10</span><br/>7   Y0 <span class="brown">=</span> <span class="blue1">GraphicsWindow</span><span class="brown">.MouseY -</span> <span class="red">10</span><br/>8   <span class="blue1">GraphicsWindow</span><span class="brown">.DrawEllipse(</span>X0<span class="brown">,</span> Y0<span class="brown">,</span> <span class="red">20</span><span class="brown">,</span> <span class="red">20</span><span class="brown">)</span><br/>9 <span class="purple"><span class="codestrong">EndSub</span></span></p>&#13;
<p class="listcap"><a id="ch11ex1"/><em>Listing 11-1: Drawing circles with a click of the mouse</em></p>&#13;
<p class="indent">Run the program. A sample output is shown in <a href="ch11.html#ch11fig3">Figure 11-3</a>. When you click inside the graphics window, you draw a circle with a random color. Make a fun pattern, show it to someone else, and try to convince them that Pablo Picasso painted it!</p>&#13;
<div class="image"><img alt="image" src="graphics/f11-03.jpg"/></div>&#13;
<p class="figcap"><a id="ch11fig3"/><em>Figure 11-3: Sample output of</em> Circles.sb</p>&#13;
<p class="indent">Let’s look at the code in <a href="ch11.html#ch11ex1">Listing 11-1</a> to see how Small Basic handles event-driven programming. <a href="ch11.html#ch11fig4">Figure 11-4</a> shows an important line in this program: line 2.</p>&#13;
<div class="image"><span epub:type="pagebreak" id="page_152"/><img alt="image" src="graphics/f11-04.jpg"/></div>&#13;
<p class="figcap"><a id="ch11fig4"/><em>Figure 11-4: The event-handler registration statement</em></p>&#13;
<p class="indent">The statement in line 2 tells the <code>GraphicsWindow</code> object that when the <code>MouseDown</code> event happens, it should run the <code>OnMouseDown()</code> subroutine. This subroutine is also known as an <em>event handler</em>, because its purpose is to handle, or process, an event. Although you can name this subroutine anything you want, it’s common to use the format <code>On<span class="codeitalic">EventName</code></span>, which is why we named the handler <code>OnMouseDown</code>. The statement on line 2 is known as <em>registering</em> an event handler. In this example, Small Basic calls the <code>OnMouseDown()</code> subroutine every time the user clicks inside the graphics window.</p>&#13;
<p class="indent">When the user clicks inside the graphics window, the x and y mouse positions (relative to the window’s upper-left corner) are saved in the <code>MouseX</code> and <code>MouseY</code> properties of <code>GraphicsWindow</code>. Because the program draws a circle with a diameter of 20 centered around the mouse click, it subtracts 10 from <code>MouseX</code> and <code>MouseY</code> (to mark the circle’s upper-left position) and saves the result in the <code>X0</code> and <code>Y0</code> variables (lines 6–7). The subroutine then draws a circle with a diameter of 20 that’s centered at the mouse-click position (line 8).</p>&#13;
<div class="sidebar">&#13;
<p class="sidebart" id="ch11sb01"><strong>TRY IT OUT 11-1</strong></p>&#13;
<p class="noindent">Change the code in <a href="ch11.html#ch11ex1">Listing 11-1</a> to draw triangles and squares instead of a circle. If you need help, refer back to <a href="ch03.html#ch03">Chapter 3</a> to review <code>GraphicsWindow</code>’s drawing methods.</p>&#13;
</div>&#13;
<h4 class="h4" id="ch11lev2sec02"><em><strong>Fire Missiles with the KeyDown Event</strong></em></h4>&#13;
<p class="noindent">Many computer games are played using the keyboard. For example, the player might use the arrow keys to move the main character, the spacebar to shoot a missile, F1 to get help, P to pick the character’s nose, and <small>ESC</small> to exit the game. If you want to make a game that uses the keyboard for input, you need to add the <code>KeyDown</code> event to your program to let you know which key the user presses and when.</p>&#13;
<p class="indent">To understand the <code>KeyDown</code> event, let’s write a simple application that displays the name of each key a user presses. Enter the program in <a href="ch11.html#ch11ex2">Listing 11-2</a>.</p>&#13;
<p class="programs">1 <span class="green"><span class="codeitalic">' KeyDown.sb</span></span><br/>2 yPos <span class="brown">=</span> <span class="red">10</span><br/>3 <span class="blue1">GraphicsWindow</span><span class="brown">.KeyDown =</span> OnKeyDown<br/>4<br/>5 <span class="purple"><span class="codestrong">Sub</span></span> OnKeyDown<br/>6   <span class="blue1">GraphicsWindow</span><span class="brown">.DrawText(</span><span class="red">10</span><span class="brown">,</span> yPos<span class="brown">,</span> <span class="blue1">GraphicsWindow</span><span class="brown">.LastKey)</span><br/>7   yPos <span class="brown">=</span> yPos <span class="brown">+</span> <span class="red">15</span><br/>8 <span class="purple"><span class="codestrong">EndSub</span></span></p>&#13;
<p class="listcap"><a id="ch11ex2"/><em>Listing 11-2: Displaying each key a user presses</em></p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_153"/>A sample run, with some comments, is shown in <a href="ch11.html#ch11fig5">Figure 11-5</a>.</p>&#13;
<div class="image"><img alt="image" src="graphics/f11-05.jpg"/></div>&#13;
<p class="figcap"><a id="ch11fig5"/><em>Figure 11-5: A sample run of</em> KeyDown.sb</p>&#13;
<p class="indent">The <code>yPos</code> variable sets the vertical position where you’ll display the name of the key the user presses. It starts at 10 and increases by 15 after it shows the name of the last pressed key (line 7).</p>&#13;
<p class="indent">You register the <code>KeyDown</code> event handler on line 3. Whenever a user presses a key, the program runs the <code>OnKeyDown()</code> subroutine. The subroutine displays the name of the pressed key (line 6) and increases <code>yPos</code> by 15 (line 7) to get ready to display the name of the next key on the next line. The <code>GraphicsWindow.LastKey</code> property on line 6 provides the name of the pressed key (as a string). This read-only property tells you the last key a user pressed.</p>&#13;
<p class="indent">The importance of this example is that it shows you the names that Small Basic assigns to the different keyboard keys. If you want to create an application that responds to these keys, you need to know what Small Basic calls them. Here are some other details you should know:</p>&#13;
<ol>&#13;
<li><p class="noindenta">The names of the letter keys (A–Z) are always uppercase. For example, if you type the letter <code>"a"</code>, <code>LastKey</code> will register it as an uppercase <code>"A"</code> regardless of whether caps lock is on or if you’re holding down the <small>SHIFT</small> key.</p></li>&#13;
<li><p class="noindenta">The name of a number key (0–9) uses the form <code>"D<span class="codeitalic">digit</code>"</span>. For example, the name of the 5 key is <code>"D5"</code>.</p></li>&#13;
<li><p class="noindenta">The four arrow keys are named <code>"Up"</code>, <code>"Down"</code>, <code>"Right"</code>, and <code>"Left"</code>.</p></li>&#13;
<li><p class="noindenta">The <small>ENTER</small> (or <small>RETURN</small>) key is named <code>"Return"</code><small>,</small> and the spacebar is named <code>"Space"</code>.</p></li>&#13;
<li><span epub:type="pagebreak" id="page_154"/><p class="noindenta">The <code>KeyDown</code> event is raised continuously (about every 35 milliseconds) as long as a key is pressed. This is different from the <code>MouseDown</code> event, which is raised only once (when the left mouse button is clicked).</p></li>&#13;
</ol>&#13;
<p class="indent">Knowing the names of the keys is important if you want to test for certain keypresses in your programs.</p>&#13;
<div class="sidebar">&#13;
<p class="sidebart" id="ch11sb02"><strong>TRY IT OUT 11-2</strong></p>&#13;
<p class="noindent">Enter and run the following code. Press some keys on the keyboard and watch for their names in the text window. Press and hold a key for a while to see what happens. (Make sure the graphics window is the active window when you type.)</p>&#13;
<p class="programs"><span class="blue1">TextWindow</span><span class="brown">.Show()</span><br/><span class="blue1">GraphicsWindow</span><span class="brown">.Show()</span><br/><span class="blue1">GraphicsWindow</span><span class="brown">.KeyDown =</span> OnKeyDown<br/><br/><span class="purple"><span class="codestrong">Sub</span></span> OnKeyDown<br/>  <span class="blue1">TextWindow</span><span class="brown">.WriteLine(</span><span class="blue1">GraphicsWindow</span><span class="brown">.LastKey)</span><br/><span class="purple"><span class="codestrong">EndSub</span></span></p>&#13;
<p class="indent">What did you notice when you tried this example?</p>&#13;
</div>&#13;
<h4 class="h4" id="ch11lev2sec03"><em><strong>Make a Typewriter Using the TextInput Event</strong></em></h4>&#13;
<p class="noindent">The <code>TextInput</code> event is very similar to the <code>KeyDown</code> event, but it’s raised only when the user presses a text-related key on the keyboard. This includes letters (A–Z), digits (0–9), special characters (such as !@#$%^&amp;), and other keys, like <small>ENTER</small>, the spacebar, <small>TAB</small>, and <small>BACKSPACE</small>. When the <code>TextInput</code> event is raised, the last character pressed on the keyboard is saved in the <code>GraphicsWindow.LastText</code> property.</p>&#13;
<p class="indent">Let’s see how this event works. Enter the code in <a href="ch11.html#ch11ex3">Listing 11-3</a> to simulate a typewriter. We know that typewriters are old school, but hey, it could be worse; we could be simulating an abacus!</p>&#13;
<p class="programs"> 1 <span class="green"><span class="codeitalic">' Typewriter.sb</span></span><br/> 2 x <span class="brown">=</span> <span class="red">0</span>                <span class="green"><span class="codeitalic">' x position for displaying the last character</span></span><br/> 3 y <span class="brown">=</span> <span class="red">0</span>                <span class="green"><span class="codeitalic">' y position for displaying the last character</span></span><br/> 4 <span class="blue1">GraphicsWindow</span><span class="brown">.Title =</span> <span class="red">"Typewriter"</span><br/> 5 <span class="blue1">GraphicsWindow</span><span class="brown">.FontName =</span> <span class="red">"Courier New"</span><br/> 6 <span class="blue1">GraphicsWindow</span><span class="brown">.TextInput =</span> OnTextInput<br/> 7<br/> 8 <span class="purple"><span class="codestrong">Sub</span></span> OnTextInput<br/> 9   <span class="blue1">Sound</span><span class="brown">.PlayClick()</span>     <span class="green"><span class="codeitalic">' Plays a typewriter sound effect</span></span><br/>10   <span class="purple"><span class="codestrong">If</span></span> <span class="brown">(</span><span class="blue1">GraphicsWindow</span><span class="brown">.LastKey =</span> <span class="red">"Return"</span><span class="brown">)</span> <span class="purple"><span class="codestrong">Then</span></span><br/>11     x <span class="brown">=</span> <span class="red">0</span>               <span class="green"><span class="codeitalic">' Moves to next line</span></span><br/>12     y <span class="brown">=</span> y <span class="brown">+</span> <span class="red">15</span><br/>13   <span class="purple"><span class="codestrong">Else</span></span><br/>14     <span class="blue1">GraphicsWindow</span><span class="brown">.DrawText(</span>x<span class="brown">,</span> y<span class="brown">,</span> <span class="blue1">GraphicsWindow</span><span class="brown">.LastText)</span><br/>15     x <span class="brown">=</span> x <span class="brown">+</span> <span class="red">8</span>        <span class="green"><span class="codeitalic">' Advances x position for the next character</span></span><br/>16     <span class="purple"><span class="codestrong">If</span></span> <span class="brown">(</span>x <span class="brown">&gt;</span> <span class="blue1">GraphicsWindow</span><span class="brown">.Width)</span> <span class="purple"><span class="codestrong">Then</span></span> <span class="green"><span class="codeitalic">' If more than right margin</span></span><br/>17       x <span class="brown">=</span> <span class="red">0</span>          <span class="green"><span class="codeitalic">' Moves to the next line</span></span><br/>18       y <span class="brown">=</span> y <span class="brown">+</span> <span class="red">15</span><br/>19     <span class="purple"><span class="codestrong">EndIf</span></span><br/>20   <span class="purple"><span class="codestrong">EndIf</span></span><br/>21 <span class="purple"><span class="codestrong">EndSub</span></span></p>&#13;
<p class="listcap"><a id="ch11ex3"/><em>Listing 11-3: Making a typewriter sound with each keypress</em></p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_155"/>Look at the sample output in <a href="ch11.html#ch11fig6">Figure 11-6</a>.</p>&#13;
<div class="image"><img alt="image" src="graphics/f11-06.jpg"/></div>&#13;
<p class="figcap"><a id="ch11fig6"/><em>Figure 11-6: Sample output of</em> Typewriter.sb</p>&#13;
<p class="indent">Lines 2 and 3 set the cursor at the corner of the graphics window. Line 4 gives the window a title, line 5 sets the font style, and line 6 registers the event handler. Line 9 plays the click sound, and lines 10–12 advance the line if the user presses <small>ENTER</small>. Line 14 writes the character entered by the user, line 15 moves the cursor to the next spot, and lines 16–18 move the cursor to the next line when the cursor gets to the right edge.</p>&#13;
<div class="note">&#13;
<p class="notet"><span class="notes"><strong>NOTE</strong></span></p>&#13;
<p class="notep"><em>When you experiment with this application, you’ll notice that the</em> <code><span class="codeitalic">TextInput</code></span> <em>event looks at the states of the different keyboard keys before setting the value of the</em> <code><span class="codeitalic">LastText</code></span> <em>property. For example, if you press the A key while holding down</em> <small>SHIFT</small>, <em>the</em> <code><span class="codeitalic">LastText</code></span> <em>property reports an uppercase</em> <code><span class="codeitalic">"A"</code></span><em>; if you don’t hold down</em> <small>SHIFT</small>, <em>it reports a lowercase</em> <code><span class="codeitalic">"a"</code></span>.</p>&#13;
</div>&#13;
<div class="sidebar">&#13;
<p class="sidebart" id="ch11sb03"><strong>TRY IT OUT 11-3</strong></p>&#13;
<p class="noindent">Update <a href="ch11.html#ch11ex3">Listing 11-3</a> to display each character in a random color. See <a href="ch11.html#ch11ex1">Listing 11-1</a> for ideas on how to randomly change the color.</p>&#13;
</div>&#13;
<h4 class="h4" id="ch11lev2sec04"><em><strong>Draw Pictures with the MouseMove Event</strong></em></h4>&#13;
<p class="noindent">To understand how to use the <code>MouseMove</code> event, you’ll write an application that lets a user draw with the mouse. The user clicks the left mouse button in the graphics window and then drags the mouse to draw. The complete program is shown in <a href="ch11.html#ch11ex4">Listing 11-4</a>.</p>&#13;
<p class="programs"><span epub:type="pagebreak" id="page_156"/> 1 <span class="green"><span class="codeitalic">' Scribble.sb</span></span><br/> 2 <span class="blue1">GraphicsWindow</span><span class="brown">.MouseMove =</span> OnMouseMove<br/> 3<br/> 4 <span class="purple"><span class="codestrong">Sub</span></span> OnMouseMove<br/> 5   x <span class="brown">=</span> <span class="blue1">GraphicsWindow</span><span class="brown">.MouseX</span>   <span class="green"><span class="codeitalic">' Current x position of mouse</span></span><br/> 6   y <span class="brown">=</span> <span class="blue1">GraphicsWindow</span><span class="brown">.MouseY</span>   <span class="green"><span class="codeitalic">' Current y position of mouse</span></span><br/> 7<br/> 8   <span class="purple"><span class="codestrong">If</span></span> <span class="brown">(</span><span class="blue1">Mouse</span><span class="brown">.IsLeftButtonDown)</span> <span class="purple"><span class="codestrong">Then</span></span><br/> 9     <span class="blue1">GraphicsWindow</span><span class="brown">.DrawLine(</span>prevX<span class="brown">,</span> prevY<span class="brown">,</span> x<span class="brown">,</span> y<span class="brown">)</span><br/>10   <span class="purple"><span class="codestrong">EndIf</span></span><br/>11<br/>12   prevX <span class="brown">=</span> x                   <span class="green"><span class="codeitalic">' Updates the last (previous) position</span></span><br/>13   prevY <span class="brown">=</span> y<br/>14 <span class="purple"><span class="codestrong">EndSub</span></span></p>&#13;
<p class="listcap"><a id="ch11ex4"/><em>Listing 11-4: Drawing a line as the user moves the mouse</em></p>&#13;
<p class="indent">A sample output of <em>Scribble.sb</em> is in <a href="ch11.html#ch11fig7">Figure 11-7</a>.</p>&#13;
<div class="image"><img alt="image" src="graphics/f11-07.jpg"/></div>&#13;
<p class="figcap"><a id="ch11fig7"/><em>Figure 11-7: Sample output of</em> Scribble.sb</p>&#13;
<p class="indent">The <code>OnMouseMove()</code> subroutine draws a line from the last mouse position, which you save in the variables <code>prevX</code> and <code>prevY</code> in lines 12 and 13, to the new mouse position, which you get from <code>GraphicsWindow</code>’s <code>MouseX</code> and <code>MouseY</code> properties. Because you want the user to draw only when the left mouse button is down, the <code>OnMouseMove()</code> subroutine checks the state of the left mouse button using the <code>Mouse.IsLeftButtonDown</code> property (line 8). This property indicates whether the left mouse button is being held down. If this value is true, the subroutine draws a line segment (line 9); if the value isn’t true, it doesn’t draw the line.</p>&#13;
<div class="sidebar">&#13;
<p class="sidebart" id="ch11sb04"><strong>TRY IT OUT 11-4</strong></p>&#13;
<p class="noindent">Change <a href="ch11.html#ch11ex4">Listing 11-4</a> to use the <code>TextInput</code> event to set the pen’s color (R for red, G for green, B for black, and so on).</p>&#13;
</div>&#13;
<h3 class="h3" id="ch11lev1sec02"><span epub:type="pagebreak" id="page_157"/><span class="blue"><strong>Useful Tips</strong></span></h3>&#13;
<p class="noindent">Before moving on, we’ll give you some tips for dealing with events and event handlers. You can handle multiple events using the same subroutine. For example, look at these statements:</p>&#13;
<p class="programs"><span class="blue1">GraphicsWindow</span><span class="brown">.MouseDown =</span> OnMouseEvent<br/><span class="blue1">GraphicsWindow</span><span class="brown">.MouseMove =</span> OnMouseEvent</p>&#13;
<p class="indent">These statements cause the <code>MouseDown</code> and <code>MouseMove</code> events to call the <code>OnMouseEvent()</code> subroutine. This feature can come in handy for complex games that use many events, so keep this feature in mind.</p>&#13;
<p class="indent">You can change the event-handler subroutine after you register it. For example, let’s say you registered the <code>OnMouseDown()</code> subroutine to handle the <code>MouseDown</code> event using this statement:</p>&#13;
<p class="programs"><span class="blue1">GraphicsWindow</span><span class="brown">.MouseDown =</span> OnMouseDown</p>&#13;
<p class="indent">If you later decide to stop responding to the <code>MouseDown</code> event (for example, because the game is over), you can write this statement:</p>&#13;
<p class="programs"><span class="blue1">GraphicsWindow</span><span class="brown">.MouseDown =</span> DoNothing</p>&#13;
<p class="indent">Now <code>DoNothing</code> is the new handler for the <code>MouseDown</code> event. If you don’t write any statements in your <code>DoNothing()</code> subroutine, your programs won’t do anything in response to the <code>MouseDown</code> event.</p>&#13;
<p class="indent">A <code>MouseDown</code> event is usually followed by a <code>MouseUp</code> event, but don’t always count on that <code>MouseUp</code> event happening. If you click the left mouse button in the graphics window and then move the cursor outside the graphics window before you release the button, your application receives only a <code>MouseDown</code> event notification. This is important to remember if you write an application that needs to pair the two events (such as if you click to grab a ball and release to throw it).</p>&#13;
<p class="indent">In the next section, you’ll put into practice what you’ve learned so far by creating a complete game. You’ll also learn about the <code>Timer</code> object and its <code>Tick</code> event. Get ready for an exciting adventure in computer gaming!</p>&#13;
<h3 class="h3" id="ch11lev1sec03"><span class="blue"><strong>Create a Gold Rush Game</strong></span></h3>&#13;
<p class="noindent">Let’s create a simple game in which a player uses the arrow keys to move a turtle to collect as many bags of gold as possible (see <a href="ch11.html#ch11fig8">Figure 11-8</a>). The bag of gold appears at random locations on the grid. If the player doesn’t grab the bag in 2 seconds, it moves elsewhere. Let’s see how fast you can get the turtle to move!</p>&#13;
<div class="image"><span epub:type="pagebreak" id="page_158"/><img alt="image" src="graphics/f11-08.jpg"/></div>&#13;
<p class="figcap"><a id="ch11fig8"/><em>Figure 11-8: Help the turtle grab as many bags of gold as possible.</em></p>&#13;
<div class="note">&#13;
<p class="notet"><span class="notes"><strong>NOTE</strong></span></p>&#13;
<p class="notep"><em>The grid is part of the background image, but we added the x- and y-coordinates in <a href="ch11.html#ch11fig8">Figure 11-8</a> to help you understand the numbers used in the code. Refer to this figure to picture how the turtle and the bag of gold move.</em></p>&#13;
</div>&#13;
<h4 class="h4" id="ch11lev2sec05"><em><strong>Step 1: Open the Startup File</strong></em></h4>&#13;
<p class="noindent">Open the file <em>GoldRush_Incomplete.sb</em> from this chapter’s folder. The folder also has the three images you’ll need for this game. Follow the next four steps to walk through the application’s code. The startup file contains the program’s main code, as shown in <a href="ch11.html#ch11ex5">Listing 11-5</a>. It prepares the game’s user interface, registers the event handlers, and initializes the game’s variables. The file also contains empty placeholders (not shown in <a href="ch11.html#ch11ex5">Listing 11-5</a>) for all the subroutines you’ll add.</p>&#13;
<p class="programs"> 1 <span class="green"><span class="codeitalic">' GoldRush_Incomplete.sb</span></span><br/> 2 <span class="blue1">GraphicsWindow</span><span class="brown">.Title =</span> <span class="red">"GOLD RUSH"</span><br/> 3 <span class="blue1">GraphicsWindow</span><span class="brown">.CanResize =</span> <span class="red">"False"</span><br/> 4 <span class="blue1">GraphicsWindow</span><span class="brown">.Width =</span> <span class="red">480</span><br/> 5 <span class="blue1">GraphicsWindow</span><span class="brown">.Height =</span> <span class="red">360</span><br/> 6<br/> 7 path <span class="brown">=</span> <span class="blue1">Program</span><span class="brown">.Directory</span><br/> 8 grid <span class="brown">=</span> <span class="blue1">Shapes</span><span class="brown">.AddImage(</span>path <span class="brown">+</span> <span class="red">"\Grid.png"</span><span class="brown">)</span><br/> 9 player <span class="brown">=</span> <span class="blue1">Shapes</span><span class="brown">.AddImage(</span>path <span class="brown">+</span> <span class="red">"\Turtle.png"</span><span class="brown">)</span><br/>10 gold <span class="brown">=</span> <span class="blue1">Shapes</span><span class="brown">.AddImage(</span>path <span class="brown">+</span> <span class="red">"\Gold.png"</span><span class="brown">)</span><br/>11<br/>12 <span class="green"><span class="codeitalic">' Places the player (turtle) near the middle</span></span><br/>13 XP <span class="brown">=</span> <span class="red">4</span>               <span class="green"><span class="codeitalic">' x position (from 0 to 7)</span></span><br/>14 YP <span class="brown">=</span> <span class="red">3</span>               <span class="green"><span class="codeitalic">' y position (from 0 to 5)</span></span><br/>15 <span class="blue1">Shapes</span><span class="brown">.Move(</span>player<span class="brown">,</span> XP <span class="brown">*</span> <span class="red">60</span><span class="brown">,</span> YP <span class="brown">*</span> <span class="red">60</span><span class="brown">)</span><br/>16<br/>17 <span class="green"><span class="codeitalic">' Creates the score text shape (over a black rectangle)</span></span><br/>18 <span class="blue1">GraphicsWindow</span><span class="brown">.BrushColor =</span> <span class="red">"Black"</span><br/>19 Shape<span class="brown">s.AddRectangle(</span><span class="red">90</span><span class="brown">,</span> <span class="red">20</span><span class="brown">)</span><br/>20 <span class="blue1">GraphicsWindow</span><span class="brown">.FontSize =</span> <span class="red">14</span><br/>21 <span class="blue1">GraphicsWindow</span><span class="brown">.BrushColor =</span> <span class="red">"Red"</span><br/>22 scoreID <span class="brown">=</span> <span class="blue1">Shapes</span><span class="brown">.AddText(</span><span class="red">"Score: 0"</span><span class="brown">)</span> <span class="green"><span class="codeitalic">' For now</span></span><br/>23<br/>24 <span class="green"><span class="codeitalic">' Registers two event handlers</span></span><br/>25 <span class="blue1">GraphicsWindow</span><span class="brown">.KeyDown =</span> OnKeyDown<br/>26 <span class="blue1">Timer</span><span class="brown">.Tick =</span> OnTick<br/>27<br/>28 <span class="green"><span class="codeitalic">' Initializes variables</span></span><br/>29 <span class="blue1">Timer</span><span class="brown">.Interval =</span> <span class="red">2000</span> <span class="green"><span class="codeitalic">' Ticks every 2 sec</span></span><br/>30 score <span class="brown">=</span> <span class="red">0</span>             <span class="green"><span class="codeitalic">' Keeps track of player's score</span></span><br/>31 bagCount <span class="brown">=</span> <span class="red">0</span>          <span class="green"><span class="codeitalic">' Counts how many bags so far</span></span></p>&#13;
<p class="listcap"><a id="ch11ex5"/><em>Listing 11-5: Setting up the Gold Rush game</em></p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_159"/>Lines 3–5 set the size of the graphics window to match the size of the background image (<em>grid.png</em>). Lines 8–10 use the <code>Shapes</code> object to load the three images (the background grid, the turtle, and the bag of gold) and save the returned identifiers. You’ll need the identifiers to move the turtle and the bag of gold later. Lines 13–15 place the turtle near the middle of the grid. Note that each square on the grid is 60×60 pixels.</p>&#13;
<p class="indent">Lines 18–22 create the text shape you’ll use to display the player’s score. The score is displayed in red on a black background in the upper-left corner of the screen (see <a href="ch11.html#ch11fig8">Figure 11-8</a>). Lines 25–26 register two event handlers. The <code>OnKeyDown</code> handler checks the arrow keys and then moves the turtle as the player controls it. The <code>OnTick</code> handler handles the <code>Timer</code> object’s <code>Tick</code> event to limit the player’s time to reach each bag. Line 29 sets the timer interval to 2 seconds (2,000 milliseconds), telling the <code>Timer</code> object to raise a <code>Tick</code> event every 2 seconds. Then the code initializes the two variables <code>score</code> and <code>bagCount</code> to 0: <code>score</code> keeps track of the player’s score (line 30), and <code>bagCount</code> keeps track of how many bags have appeared so far (line 31).</p>&#13;
<p class="indent">Run the code; you should see the turtle in the middle of the grid, the bag of gold in the upper-left square of the grid, and the score text showing 0.</p>&#13;
<h4 class="h4" id="ch11lev2sec06"><em><strong>Step 2: Move the Turtle</strong></em></h4>&#13;
<p class="noindent">To move the turtle when the player presses the arrow keys, add the code in <a href="ch11.html#ch11ex6">Listing 11-6</a> to the bottom of your file.</p>&#13;
<p class="programs"> 1 <span class="purple"><span class="codestrong">Sub</span></span> OnKeyDown<br/> 2  key <span class="brown">=</span> <span class="blue1">GraphicsWindow</span><span class="brown">.LastKey</span><br/> 3   <span class="purple"><span class="codestrong">If</span></span> <span class="brown">((</span>key <span class="brown">=</span> <span class="red">"Up"</span><span class="brown">) And (</span>YP <span class="brown">&gt;</span> <span class="red">0</span><span class="brown">))</span> <span class="purple"><span class="codestrong">Then</span></span><br/> 4     YP <span class="brown">=</span> YP <span class="brown">-</span> <span class="red">1</span><br/> 5   <span class="purple"><span class="codestrong">ElseIf</span></span> <span class="brown">((</span>key <span class="brown">=</span> <span class="red">"Down"</span><span class="brown">) And (</span>YP <span class="brown">&lt;</span> <span class="red">5</span><span class="brown">))</span> <span class="purple"><span class="codestrong">Then</span></span><br/> 6     YP <span class="brown">=</span> YP <span class="brown">+</span> <span class="red">1</span><br/> 7   <span class="purple"><span class="codestrong">ElseIf</span></span> <span class="brown">((</span>key <span class="brown">=</span> <span class="red">"Left"</span><span class="brown">) And (</span>XP <span class="brown">&gt;</span> <span class="red">0</span><span class="brown">))</span> <span class="purple"><span class="codestrong">Then</span></span><br/> 8     XP <span class="brown">=</span> XP <span class="brown">-</span> <span class="red">1</span><br/> 9   <span class="purple"><span class="codestrong">ElseIf</span></span> <span class="brown">((</span>key <span class="brown">=</span> <span class="red">"Right"</span><span class="brown">) And (</span>XP <span class="brown">&lt;</span> <span class="red">7</span><span class="brown">))</span> <span class="purple"><span class="codestrong">Then</span></span><br/>10     XP <span class="brown">=</span> XP <span class="brown">+</span> <span class="red">1</span><br/>11   <span class="purple"><span class="codestrong">EndIf</span></span><br/><span epub:type="pagebreak" id="page_160"/><br/>12  <span class="blue1">Shapes</span><span class="brown">.Move(</span>player<span class="brown">,</span> XP <span class="brown">*</span> <span class="red">60</span><span class="brown">,</span> YP <span class="brown">*</span> <span class="red">60</span><span class="brown">)</span><br/>13  CheckTouch<span class="brown">()</span>          <span class="green"><span class="codeitalic">' Checks if the player touched the bag</span></span><br/>14 <span class="purple"><span class="codestrong">EndSub</span></span></p>&#13;
<p class="listcap"><a id="ch11ex6"/><em>Listing 11-6: Moving the turtle as the player presses the arrow keys</em></p>&#13;
<p class="indent">The grid has eight horizontal and six vertical squares. Squares in the horizontal direction are numbered 0 to 7, and squares in the vertical direction are numbered 0 to 5. That means the <code>XP</code> variable (the player’s x position) takes any value between 0 and 7, and the <code>YP</code> variable (the player’s y position) takes any value between 0 and 5. The <code>OnKeyDown()</code> subroutine uses an <code>If/ElseIf</code> ladder to check whether the pressed key is one of the four arrow keys. If one of the arrow keys is pressed while the turtle is in the graphics window, the subroutine adjusts <code>XP</code> or <code>YP</code> according to the pressed arrow key.</p>&#13;
<p class="indent">For example, lines 3 and 4 check if the player pressed the up arrow, and if the turtle hasn’t reached the top edge yet, the turtle moves up one square. You can find the exact location on the grid (in pixels) by multiplying the square’s number by 60 (because each square is 60 pixels), which is what line 12 does. The code then calls the <code>CheckTouch()</code> subroutine to check if the player touched the bag of gold.</p>&#13;
<p class="indent">Run the application again to check the code you just added. You should be able to move the turtle over the square grid using the arrow keys on the keyboard. It’s alive!</p>&#13;
<h4 class="h4" id="ch11lev2sec07"><em><strong>Step 3: Move the Bag of Gold</strong></em></h4>&#13;
<p class="noindent">Now you’ll add the <code>OnTick</code> handler to create a time limit and the code for moving the bag of gold to a new spot. Add the subroutine in <a href="ch11.html#ch11ex7">Listing 11-7</a> to the bottom of your program.</p>&#13;
<p class="programs">1 <span class="purple"><span class="codestrong">Sub</span></span> OnTick  <span class="green"><span class="codeitalic">' Timer expires</span></span><br/>2   NewRound<span class="brown">()</span><br/>3 <span class="purple"><span class="codestrong">EndSub</span></span></p>&#13;
<p class="listcap"><a id="ch11ex7"/><em>Listing 11-7: The</em> <code><span class="codeitalic">OnTick()</code></span> <em>subroutine</em></p>&#13;
<p class="indent">As mentioned earlier, the bag of gold appears at a random location and gives the player 2 seconds to grab it. If the timer expires, the player loses because they didn’t grab the bag in time. In this case, the <code>OnTick</code> handler calls the <code>NewRound()</code> subroutine (line 2) to start another round of the game.</p>&#13;
<p class="indent">The <code>NewRound()</code> subroutine is shown in <a href="ch11.html#ch11ex8">Listing 11-8</a>. Add it to the bottom of your program.</p>&#13;
<p class="programs"> 1 <span class="purple"><span class="codestrong">Sub</span></span> NewRound<br/> 2   bagCount <span class="brown">=</span> bagCount <span class="brown">+</span> <span class="red">1</span><br/> 3   <span class="purple"><span class="codestrong">If</span></span> <span class="brown">(</span>bagCount <span class="brown">&lt;=</span> <span class="red">20</span><span class="brown">)</span> <span class="purple"><span class="codestrong">Then</span></span><br/> 4     XG <span class="brown">=</span> <span class="blue1">Math</span><span class="brown">.GetRandomNumber(</span><span class="red">8</span><span class="brown">) -</span> <span class="red">1</span>    <span class="green"><span class="codeitalic">' From 0 to 7</span></span><br/> 5     YG <span class="brown">=</span> <span class="blue1">Math</span><span class="brown">.GetRandomNumber(</span><span class="red">6</span><span class="brown">) -</span> <span class="red">1</span>    <span class="green"><span class="codeitalic">' From 0 to 5</span></span><br/> 6     <span class="blue1">Shapes</span><span class="brown">.Move(</span>gold<span class="brown">,</span> XG <span class="brown">*</span> <span class="red">60</span><span class="brown">,</span> YG <span class="brown">*</span> <span class="red">60</span><span class="brown">)</span><br/> 7     CheckTouch<span class="brown">()</span><br/> 8   <span class="purple"><span class="codestrong">Else</span></span><br/> 9     <span class="blue1">Shapes</span><span class="brown">.Remove(</span>gold<span class="brown">)</span>                 <span class="green"><span class="codeitalic">' Deletes the gold bag shape</span></span><br/>10     <span class="blue1">GraphicsWindow</span><span class="brown">.KeyDown =</span> OnGameOver <span class="green"><span class="codeitalic">' Do nothing</span></span><br/>11     <span class="blue1">Timer</span><span class="brown">.Tick =</span> OnGameOver             <span class="green"><span class="codeitalic">' Do nothing</span></span><br/>12   <span class="purple"><span class="codestrong">EndIf</span></span><br/>13 <span class="purple"><span class="codestrong">EndSub</span></span></p>&#13;
<p class="listcap"><a id="ch11ex8"/><em>Listing 11-8: Starting a new round when the timer expires</em></p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_161"/>The <code>NewRound()</code> subroutine starts by increasing <code>bagCount</code> by 1 (line 2); <code>bagCount</code> just counts how many bags have appeared so far. The plan is to show a total of 20 bags to the player. If 20 total bags have not been shown (line 3), the subroutine selects a random position for the bag (lines 4–5) and then moves the bag to that location in the graphics window (line 6). We use the variables <code>XG</code> and <code>YG</code> (for the x- and y-positions of the bag of gold) in the <code>CheckTouch()</code> subroutine. After moving the bag, the code calls <code>CheckTouch()</code> to see if the bag was placed right on top of the player (line 7)—how lucky!</p>&#13;
<p class="indent">If <code>bagCount</code> is more than 20 (line 8), we delete the gold bag shape (line 9) and register the <code>OnGameOver</code> handler, which is a subroutine with no statements, for both the <code>KeyDown</code> and the <code>Tick</code> events to end the game. Then when the player presses the arrow keys or when the timer expires after bag 20 has appeared, nothing happens. Of course, this might surprise the user. There are other ways to end the game, but we’ll leave this to your imagination if you want to change it later.</p>&#13;
<p class="indent">The next subroutine you need to add is the <code>OnGameOver()</code> subroutine shown in <a href="ch11.html#ch11ex9">Listing 11-9</a>.</p>&#13;
<p class="programs">1 <span class="purple"><span class="codestrong">Sub</span></span> OnGameOver<br/>2 <span class="purple"><span class="codestrong">EndSub</span></span></p>&#13;
<p class="listcap"><a id="ch11ex9"/><em>Listing 11-9: The</em> <code><span class="codeitalic">OnGameOver()</code></span> <em>subroutine</em></p>&#13;
<p class="indent">If you run the game at this point, the bag of gold should move to random positions on the grid every 2 seconds. You can still move the turtle with the arrows. After 20 bags have appeared, the bag of gold disappears, and the arrow keys will no longer move the turtle.</p>&#13;
<p class="indent">As you test this game, you might decide to give the user more time to pick up the bags or to remove the lucky feature where a bag could appear right on top of the player. Play around with this code until you think your game is fun to play.</p>&#13;
<h4 class="h4" id="ch11lev2sec08"><span epub:type="pagebreak" id="page_162"/><em><strong>Step 4: Update the User’s Score</strong></em></h4>&#13;
<p class="noindent">To complete the game, add the <code>CheckTouch()</code> subroutine in <a href="ch11.html#ch11ex10">Listing 11-10</a> to check whether the player successfully picked up a bag of gold and, if so, increase their score.</p>&#13;
<p class="programs"> 1 <span class="purple"><span class="codestrong">Sub</span></span> CheckTouch<br/> 2   <span class="purple"><span class="codestrong">If</span></span> <span class="brown">((</span>XP <span class="brown">=</span> XG<span class="brown">) And (</span>YP <span class="brown">=</span> YG<span class="brown">))</span> <span class="purple"><span class="codestrong">Then</span></span><br/> 3     score <span class="brown">=</span> score <span class="brown">+</span> <span class="red">1</span>    <span class="green"><span class="codeitalic">' Gives the player one point</span></span><br/> 4     <span class="blue1">Shapes</span><span class="brown">.SetText(</span>scoreID<span class="brown">,</span> <span class="red">"Score: "</span> <span class="brown">+</span> score<span class="brown">)</span><br/> 5     <span class="blue1">Sound</span><span class="brown">.PlayClick()</span>    <span class="green"><span class="codeitalic">' Adds sound effect</span></span><br/> 6     <span class="blue1">Timer</span><span class="brown">.Pause()</span>        <span class="green"><span class="codeitalic">' Resets the timer</span></span><br/> 7     <span class="blue1">Timer</span><span class="brown">.Resume()</span>       <span class="green"><span class="codeitalic">' Starts the timer</span></span><br/> 8     NewRound<span class="brown">()</span>           <span class="green"><span class="codeitalic">' Starts a new round</span></span><br/> 9   <span class="purple"><span class="codestrong">EndIf</span></span><br/>10 <span class="purple"><span class="codestrong">EndSub</span></span></p>&#13;
<p class="listcap"><a id="ch11ex10"/><em>Listing 11-10: Checking whether the turtle gets to the money</em></p>&#13;
<p class="indent">If the player’s x- and y-positions are the same as the bag, the turtle grabs the bag (line 2). Happy turtle! If the lucky turtle gets the bag of gold, we increase the score (line 3), show it (line 4), and use the <code>Sound</code> object to play a short click (line 5) for a nice audio effect.</p>&#13;
<p class="indent">We also need to reset the timer to 2 seconds for the new round. We do this by pausing the timer (line 6) and then resuming it (line 7). Then we call <code>NewRound()</code> to set another bag in a random spot after this historic triumph. Can your turtle do it again?</p>&#13;
<p class="indent">This completes the game, and you should be able to enjoy your creation after all this hard work. What’s your top score? (Tip: hold down the arrow key to move across squares faster.) Share it with your friends (just click Publish in the Toolbar) to see if they can beat your score. Have fun!</p>&#13;
<div class="sidebar">&#13;
<p class="sidebart" id="ch11sb05"><strong>TRY IT OUT 11-5</strong></p>&#13;
<p class="noindentb">Think of some ways to enhance the game, and try out your ideas. Here are some ideas you could try:</p>&#13;
<p class="bull">• End the game with a bigger bang! Display a message or show some interesting graphics.</p>&#13;
<p class="bull">• Add a second bag of gold.</p>&#13;
<p class="bull">• Make the time limit shorter each time the user grabs the bag.</p>&#13;
<p class="indentt">Head to <em><a href="http://tiny.cc/turtlegame/">http://tiny.cc/turtlegame/</a></em> to share your turtle game updates.</p>&#13;
</div>&#13;
<h3 class="h3a" id="ch11lev1sec04"><span epub:type="pagebreak" id="page_163"/><span class="blues"><strong>Programming Challenges</strong></span></h3>&#13;
<p class="noindent">If you get stuck, check out <em><a href="http://nostarch.com/smallbasic/">http://nostarch.com/smallbasic/</a></em> for the solutions and for more resources and review questions for teachers and students.</p>&#13;
<ol>&#13;
<li><p class="noindenta">He-Man is hanging out with his friends playing <em>Twilight</em> trivia and needs a buzzer for when his friends get a question wrong. Make a program that draws a big X in the graphics window and plays a sound when He-Man clicks the left mouse button. The next click should erase the X. Make sure He-Man can repeat this as often as he wants (it’s a long trivia game).</p></li>&#13;
<li><p class="noindenta">Make a program that stamps a turtle-face image where the mouse was clicked each time the user clicks the mouse. Get <em>turtleface.jpg</em> from this chapter’s folder. (Hint: start with the code in <a href="ch11.html#ch11ex1">Listing 11-1</a>, and use the <code>GraphicsWindow.DrawImage()</code> method to draw your image.)</p></li>&#13;
<li><p class="noindenta">Open the <em>Maze_Incomplete.sb</em> file from this chapter’s folder. The goal is to exit the maze in the shortest possible time, but this maze has no exit yet. Figure out how to add a maze exit condition. When the player exits the maze, display the time it took to solve the maze.<span epub:type="pagebreak" id="page_164"/></p></li>&#13;
</ol>&#13;
</body></html>