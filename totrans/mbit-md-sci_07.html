<html><head></head><body>
<div class="imagec"><span epub:type="pagebreak" id="page_165"/><img alt="Image" src="../images/common1.jpg"/></div>
<h2 class="h2" id="ch07"><strong>7</strong><br/><strong>TIME TRAVEL</strong></h2>
<p class="noindent">Okay, so we won’t actually build a time machine in this chapter, but you’ll measure time by making a binary clock and a clock that can speak. We’ll also conduct an experiment to test how well your micro:bit can keep time. All the experiments and projects in this chapter use MicroPython only.</p>
<h3 class="h3" id="ch00lev1sec174"><span epub:type="pagebreak" id="page_166"/><strong>EXPERIMENT 9: KEEPING TIME</strong></h3>
<div class="image"><img alt="Image" src="../images/common2.jpg"/></div>
<p class="noindent">The aim of this experiment is to make a micro:bit clock that keeps good time. That means programming the micro:bit to tick at precisely one-second intervals.</p>
<div class="image"><img alt="Image" src="../images/f0166-01.jpg"/></div>
<p class="indent">One way to do this would be to use the <span class="literal">sleep</span> function, as in the code shown here. Note that this code is not a full program, so don’t try to run it. The <span class="literal">sleep</span> command stops the micro:bit from doing anything for however long you specify. In our case, the delay is 1,000 milliseconds (1 second).</p>
<div class="programs1">seconds <span class="purple">=</span> <span class="blue1">0</span><br/><br/><span class="green">while True</span><span class="purple">:</span><br/>    sleep<span class="purple">(</span><span class="blue1">1000</span><span class="purple">)</span><br/>    seconds <span class="purple">+=</span> <span class="blue1">1</span></div>
<p class="indent">In this example, after each 1 second delay, the program adds 1 to the <span class="literal">seconds</span> variable, which counts the number of seconds that have passed. This loop repeats indefinitely and, as a way of marking time, works for a bit.</p>
<p class="indent"><span epub:type="pagebreak" id="page_167"/>The problem is that the clock will gradually fall behind because we haven’t accounted for the time it takes the micro:bit to add 1 to the <span class="literal">seconds</span> variable. In this example, adding 1 to the variable won’t take much time at all, but if the program got any longer—for example, by telling the clock to also display the time or even speak the time, which we’ll try later—then the delay could become significant. It would also be unpredictable, as the time lost may not be the same every time the program loops.</p>
<p class="indent">Therefore, a better way to keep time is to use the <span class="literal">running_time</span> function. This function returns the number of milliseconds that have passed since the micro:bit was last reset, and it’s not affected by how long other parts of your code take to do things.</p>
<p class="indent">In this experiment, we’ll use the <span class="literal">running_time</span> function to calculate just how slow or fast our micro:bit clock runs.</p>
<h4 class="h4" id="ch00lev1sec175"><strong>What You’ll Need</strong></h4>
<p class="noindent">To carry out this experiment, you just need two things:</p>
<p class="noindentint"><strong><span class="blue">Micro:bit</span></strong></p>
<p class="noindentin"><strong><span class="blue">USB cable</span></strong></p>
<h4 class="h4" id="ch00lev1sec176"><strong>Construction</strong></h4>
<ol>
<li class="noindent">Find the code at <em><a href="https://github.com/simonmonk/mbms/">https://github.com/simonmonk/mbms/</a></em>. The Python file for this experiment is <em>Experiment_09.py</em>. Open the program in Mu and flash it onto your micro:bit.</li>
<li class="noindent">Once you’ve successfully programmed the micro:bit, press button <strong>B</strong>. You should find that the micro:bit sets the seconds to 0 and starts counting up from there.</li>
<li class="noindent">Set a timer on your phone or another device for exactly 16 minutes 40 seconds. Start the timer and, at the same time, press button <strong>B</strong> to reset the micro:bit’s second count. At the end of the timed period, press button <strong>A</strong> to freeze the clock and make a note of the number of seconds displayed.</li>
</ol>
<p class="indent">Because this experiment is all about timing, it’s important to start the timer at exactly the same time that button B is pressed and to press button A as soon as the timer sounds. <span epub:type="pagebreak" id="page_168"/>This will be easier if a friend helps: one of you can operate the timer, while the other operates the micro:bit.</p>
<p class="indent">The reason for setting the timer to 16 minutes 40 seconds is that this is 1,000 seconds. If the micro:bit’s second count is greater than 1,000, then the clock is running fast, and if the count is less than 1,000, the clock is running slow. My micro:bit’s second count was 989, indicating that the micro:bit’s internal clock was running about 11 parts in 1,000 too slow.</p>
<p class="indent">Make a note of your micro:bit’s second count. You’ll use it in the projects in this chapter to make your clock more accurate.</p>
<h4 class="h4" id="ch00lev1sec177"><strong>Code</strong></h4>
<p class="noindent">Here is the MicroPython code for Experiment 9:</p>
<div class="programs1"><span class="green">from</span> microbit <span class="green">import</span> <span class="purple">*</span><br/><br/>seconds <span class="purple">=</span> <span class="blue1">0</span><br/>last_time <span class="purple">=</span> <span class="blue1">0</span><br/><br/><span class="green">while True</span><span class="purple">:</span><br/>    now <span class="purple">=</span> running_time<span class="purple">()</span><br/>    elapsed_ms <span class="purple">=</span> now <span class="purple">-</span> last_time<br/>    <span class="green">if</span> elapsed_ms <span class="purple">&gt;=</span> <span class="blue1">1000</span><span class="purple">:</span><br/>        seconds <span class="purple">+=</span> <span class="blue1">1</span><br/>        last_time <span class="purple">=</span> now<br/>    <span class="green">if</span> button_a<span class="purple">.</span>was_pressed<span class="purple">():</span><br/>        display<span class="purple">.</span>scroll<span class="purple">(</span>str<span class="purple">(</span>seconds<span class="purple">))</span><br/>    <span class="green">if</span> button_b<span class="purple">.</span>was_pressed<span class="purple">():</span><br/>        seconds <span class="purple">=</span> <span class="blue1">0</span><br/>        display<span class="purple">.</span>show<span class="purple">(</span><span class="red1">"0"</span><span class="purple">)</span><br/>        sleep<span class="purple">(</span><span class="blue1">100</span><span class="purple">)</span><br/>        display<span class="purple">.</span>clear<span class="purple">()</span></div>
<p class="indent">The program uses two variables:</p>
<p class="noindentint"><span class="blue"><span class="literal"><span class="codestrong1">last_time</span></span></span> Keeps track of the last time that the clock ticked</p>
<p class="noindentinb"><span class="blue"><span class="literal"><span class="codestrong1">seconds</span></span></span> Keeps track of the number of seconds that have passed since the micro:bit was last reset and the clock started running</p>
<p class="indent">I find it useful to think of the clock <em>ticking</em>, like a regular clock. That is, it does something at regular intervals.</p>
<p class="indent"><span epub:type="pagebreak" id="page_169"/>The main <span class="literal">while</span> loop uses the <span class="literal">running_time</span> function to find out how long the micro:bit has been running in milliseconds. It stores that number in a variable called <span class="literal">now</span>. It then calculates how many milliseconds have elapsed since the last tick by subtracting <span class="literal">last_time</span> from <span class="literal">now</span>.</p>
<p class="indent">If the number of milliseconds elapsed is greater than or equal to 1,000—in other words, greater than or equal to 1 second—then the <span class="literal">seconds</span> variable increases by 1. Then we reset the number of milliseconds elapsed to 0 so we can count elapsed time over again.</p>
<p class="indent">We use two <span class="literal">if</span> statements to program button A and button B. If you press button A, the micro:bit will display <span class="literal">seconds</span>, or the time that’s passed since the program started running. If you press button B, the seconds count will reset to 0.</p>
<h4 class="h4" id="ch00lev1sec178"><strong>How It Works: Keeping Time</strong></h4>
<p class="noindent">The micro:bit’s processor uses a crystal oscillator (an electronic component used to keep time accurately) that should be accurate to better than 30 parts per million. However, for my micro:bit, it was inaccurate by 11,000 parts per million for some reason.</p>
<p class="indent">To get a truly accurate clock, you’d need to use a dedicated RTC (Real Time Clock) chip and separate crystal oscillator. At the time of writing, no RTC chips are available specifically for the micro:bit. Although they can be made to work with the micro:bit, this is a fairly tricky process. Therefore, it’s probably best not to rely too much on either of the clocks you’ll build in this chapter, but these projects are fun and will teach you important skills.</p>
<h3 class="h3" id="ch00lev1sec179"><strong>PROJECT: BINARY CLOCK</strong></h3>
<div class="image"><img alt="Image" src="../images/common3.jpg"/></div>
<p class="difficulty"><em>Difficulty: Easy</em></p>
<p class="noindent">In this project, shown in <a href="ch07.xhtml#ch7fig1">Figure 7-1</a>, you’ll create a clock that shows you the time in <em>binary</em>. Binary is a numbering system used in computers. You can learn more about it in the “How It Works: Telling the Time in Binary” on <a href="ch07.xhtml#page_176">page 176</a>. A binary clock displays hours, minutes, and seconds as separate binary numbers on the micro:bit’s LED display.</p>
<div class="image" id="ch7fig1"><span epub:type="pagebreak" id="page_170"/><img alt="Image" src="../images/07fig01.jpg"/></div>
<p class="figcap"><em>Figure 7-1: The binary clock in the Kitronik MI:Pro case</em></p>
<p class="indent"><a href="ch07.xhtml#ch7fig2">Figure 7-2</a> shows the binary numbering system on the micro:bit. It might seem confusing at first, like a random pattern of LEDs, but I’ll explain how it works shortly. Plus, the Mad Scientist loves to show off their skill at reading binary clocks to impress their friends!</p>
<div class="image" id="ch7fig2"><img alt="Image" src="../images/07fig02.jpg"/></div>
<p class="figcap"><em>Figure 7-2: Reading the binary clock</em></p>
<h4 class="h4" id="ch00lev1sec180"><span epub:type="pagebreak" id="page_171"/><strong>How to Read the Binary Clock</strong></h4>
<p class="noindent">Our binary clock is a 24-hour clock. To read the clock, start at the top row of LEDs, shown in <a href="ch07.xhtml#ch7fig2">Figure 7-2</a>. This row represents the hours. Each column of LEDs stands for a number. From right to left, the columns represent the numbers 1, 2, 4, 8, and 16. By adding these five numbers, you can create every possible value between 1 and 24. To work out the hour, add the column numbers for the LEDs that are lit. In the case of <a href="ch07.xhtml#ch7fig2">Figure 7-2</a>, that’s 1, 2, and 8, which add up to 11. So, the hour is 11.</p>
<p class="indent">The next two rows represent the number of minutes, and the bottom two rows represent the number of seconds. Both minutes and seconds are indicated by a row with the same 1, 2, 4, 8, and 16 LEDs. However, since we need to be able to count all the way to 60 for minutes and seconds, these values are indicated by an additional LED (worth 32) on the preceding row. As shown in <a href="ch07.xhtml#ch7fig2">Figure 7-2</a>, the 32 LED for minutes is the leftmost LED on the second row from the top, and the 32 LED for seconds is the leftmost LED on the fourth row from the top.</p>
<p class="indent">In <a href="ch07.xhtml#ch7fig2">Figure 7-2</a>, the 4 and 1 minute LEDs are lit, indicating 5 minutes. The 2 and 1 second LEDs are lit, indicating 3 seconds. All together, this display is saying the time is 11:05:03.</p>
<p class="indent">Holding down button A will make the numbers on the clock advance very quickly, allowing you to set the time. You just need to be ready to stop the clock as soon as it reaches the correct time.</p>
<p class="indent">You can see a video of the clock in operation, including how the time is set, at <em><a href="https://www.youtube.com/watch?v=v26gYo5OG0g">https://www.youtube.com/watch?v=v26gYo5OG0g</a></em>.</p>
<h4 class="h4" id="ch00lev1sec181"><strong>What You’ll Need</strong></h4>
<p class="noindent">For this project, all you need is your micro:bit and a power source.</p>
<p class="indent">If you plan to keep your clock running constantly, then you should use a USB power adapter or other long-term power source for the micro:bit (see the <a href="app01.xhtml">appendix</a>) to save on batteries. You might also want to get a case for the micro:bit to make your clock look nicer.</p>
<p class="indent">Remember that the clock won’t keep perfect time, so you’ll need to reset it fairly often.</p>
<h4 class="h4" id="ch00lev1sec182"><span epub:type="pagebreak" id="page_172"/><strong>Construction</strong></h4>
<ol>
<li class="noindent">The code for this project is in MicroPython, because the math required would be extremely tricky to do in the Blocks code. Download the code from <em><a href="https://github.com/simonmonk/mbms/">https://github.com/simonmonk/mbms/</a></em>. The file for this project is <em>ch_07_Binary_Clock.py</em>.</li>
<li class="noindent">Before loading the program onto your micro:bit, open it in Mu and change the current time so it’s accurate. You should probably set it to a few minutes before the current time, just to be safe. You can adjust it later by holding down button A.
<p class="indent">Change the time by altering the following lines. Remember that this is a 24-hour clock, so, for example, 6:00 <small>PM</small> is 12 + 6 or 18 hours.</p>
<div class="programs1">hours <span class="purple">=</span> <span class="blue1">8</span><br/>minutes <span class="purple">=</span> <span class="blue1">25</span></div>
<p class="indent">You should also change the value of the <span class="literal">adjust</span> variable to the number of parts per thousand by which your micro:bit’s clock is slow or fast. My micro:bit ran slow by 11 seconds in 1,000, so I set <span class="literal">adjust</span> to –11 to speed it up a little (note the negative sign). If the micro:bit had run fast by, say, 10 seconds per 1,000, then I would have set <span class="literal">adjust</span> to 10 to slow things down a tiny amount.</p></li>
</ol>
<h4 class="h4" id="ch00lev1sec183"><strong>Code</strong></h4>
<p class="noindent">This project involves quite a lot of math. We’ll also use some more advanced programming features, such as <em>two-dimensional arrays</em>, which are much easier to implement in Python than in Blocks code.</p>
<p class="indent">Let’s break the code into chunks, starting with the lines that assign the correct binary values to each LED:</p>
<div class="programs1"><span class="ash"># hhhhh</span><br/><span class="ash"># m</span><br/><span class="ash"># mmmmm</span><br/><span class="ash"># s</span><br/><span class="ash"># sssss</span><br/><span epub:type="pagebreak" id="page_173"/>sec_leds <span class="purple">=</span> <span class="purple">[[</span><span class="blue1">4</span><span class="purple">,</span> <span class="blue1">4</span><span class="purple">], [</span><span class="blue1">3</span><span class="purple">,</span> <span class="blue1">4</span><span class="purple">], [</span><span class="blue1">2</span><span class="purple">,</span> <span class="blue1">4</span><span class="purple">], [</span><span class="blue1">1</span><span class="purple">,</span> <span class="blue1">4</span><span class="purple">], [</span><span class="blue1">0</span><span class="purple">,</span> <span class="blue1">4</span><span class="purple">], [</span><span class="blue1">0</span><span class="purple">,</span> <span class="blue1">3</span><span class="purple">]]</span><br/>min_leds <span class="purple">= [[</span><span class="blue1">4</span><span class="purple">,</span> <span class="blue1">2</span><span class="purple">], [</span><span class="blue1">3</span><span class="purple">,</span> <span class="blue1">2</span><span class="purple">], [</span><span class="blue1">2</span><span class="purple">,</span> <span class="blue1">2</span><span class="purple">], [</span><span class="blue1">1</span><span class="purple">,</span> <span class="blue1">2</span><span class="purple">], [</span><span class="blue1">0</span><span class="purple">,</span> <span class="blue1">2</span><span class="purple">], [</span><span class="blue1">0</span><span class="purple">,</span> <span class="blue1">1</span><span class="purple">]]</span><br/>hour_leds <span class="purple">= [[</span><span class="blue1">4</span><span class="purple">,</span> <span class="blue1">0</span><span class="purple">], [</span><span class="blue1">3</span><span class="purple">,</span> <span class="blue1">0</span><span class="purple">], [</span><span class="blue1">2</span><span class="purple">,</span> <span class="blue1">0</span><span class="purple">], [</span><span class="blue1">1</span><span class="purple">,</span> <span class="blue1">0</span><span class="purple">], [</span><span class="blue1">0</span><span class="purple">,</span> <span class="blue1">0</span><span class="purple">]]</span><br/>adjust <span class="purple">= -</span><span class="blue1">11</span></div>
<p class="indent">The first four lines of code aren’t actually part of the program. They’re <em>comment lines</em>, or notes, reminding you which LEDs display the hours, minutes, and seconds. These can serve as a useful reference when setting the LED coordinates in the arrays that follow.</p>
<p class="indent">The next three lines are the two-dimensional arrays mentioned earlier. These assign the proper LED coordinates to the seconds, minutes, and hours. Remember that arrays are like variables, except they hold multiple elements. The arrays we’re using here are called <em>two dimensional</em> because their elements are also arrays. For example, the first element in the first array, <span class="literal">sec_leds</span>, is [4, 4]. This identifies the first LED used to display the number of seconds as the LED with an x coordinate of 4 and a y coordinate of 4. That’s the LED in the bottom right corner of the display. <a href="ch07.xhtml#ch7fig3">Figure 7-3</a> shows the coordinates of the individual LEDs that make up the display.</p>
<div class="image" id="ch7fig3"><img alt="Image" src="../images/07fig03.jpg"/></div>
<p class="figcap"><em>Figure 7-3: LED display coordinates</em></p>
<p class="indent">As you can see, the top left LED has the coordinates [0, 0] and the bottom right [4, 4].</p>
<div class="imagec"><span epub:type="pagebreak" id="page_174"/><img alt="Image" src="../images/f0174-01.jpg"/></div>
<p class="indent">Next, we have the <span class="literal">hours</span>, <span class="literal">minutes</span>, and <span class="literal">seconds</span> variables to keep the current time:</p>
<div class="programs1">hours <span class="purple">=</span> <span class="blue1">8</span><br/>minutes <span class="purple">=</span> <span class="blue1">25</span><br/>seconds <span class="purple">=</span> <span class="blue1">1</span><br/>adjust <span class="purple">= -</span><span class="blue1">11</span></div>
<p class="indent">We’ll use the <span class="literal">adjust</span> variable to correct the clock’s speed. See “Construction” on <a href="ch07.xhtml#page_167">page 167</a> if you’re not sure how to do this.</p>
<p class="indent">Here is the function that turns the LEDs on or off to indicate a value in binary:</p>
<div class="programs1"><span class="green">def</span> <span class="blue1">display_binary</span><span class="purple">(</span>value<span class="purple">,</span> num_bits<span class="purple">,</span> leds<span class="purple">):</span><br/>    v <span class="purple">=</span> value<br/>    <span class="green">for</span> i <span class="green">in</span> <span class="blue1">range</span><span class="purple">(</span><span class="blue1">0</span><span class="purple">,</span> num_bits<span class="purple">):</span><br/>        v_bit <span class="purple">=</span> v <span class="purple">%</span> <span class="blue1">2</span><br/>        display<span class="purple">.</span>set_pixel<span class="purple">(</span>leds<span class="purple">[</span>i<span class="purple">][</span><span class="blue1">0</span><span class="purple">],</span> leds<span class="purple">[</span>i<span class="purple">][</span><span class="blue1">1</span><span class="purple">],</span> <span class="blue1">int</span><span class="purple">(</span>v_bit <span class="purple">*</span> <span class="blue1">9</span><span class="purple">))</span><br/>        v <span class="purple">=</span> <span class="blue1">int</span><span class="purple">(</span>v <span class="purple">/</span> <span class="blue1">2</span><span class="purple">)</span></div>
<p class="indent">We have three separate binary numbers (hours, minutes, and seconds) to display, and the <span class="literal">display_binary</span> function works for all of them. It takes a number to display (<span class="literal">value</span>), the number of LEDs to use in displaying the number (<span class="literal">num_bits</span>), and an array of LEDs to use (<span class="literal">leds</span>). It uses these three values to display the three parts of the time—the seconds, minutes, and hours—on the micro:bit.</p>
<p class="indent">To keep track of the time, you use two variables:</p>
<div class="programs1">last_time <span class="purple">=</span> <span class="blue1">0</span><br/>tick <span class="purple">=</span> <span class="blue1">1000</span> <span class="purple">+</span> adjust</div>
<p class="indent"><span epub:type="pagebreak" id="page_175"/>The variable <span class="literal">last_time</span> records the last time that the clock ticked, and the variable <span class="literal">tick</span> holds the duration of the clock’s tick in milliseconds. The default value for <span class="literal">tick</span> is <span class="literal">1,000 + adjust</span>, but this value will change when you press button A to set the time.</p>
<p class="indent">Here is the code to update the time:</p>
<div class="programs1"><span class="green">def</span> <span class="blue1">update_time</span><span class="purple">():</span><br/>    <span class="green">global</span> hours<span class="purple">,</span> minutes<span class="purple">,</span> seconds<br/>    seconds <span class="purple">+=</span> <span class="blue1">1</span><br/>    <span class="green">if</span> seconds <span class="purple">&gt;</span> <span class="blue1">59</span><span class="purple">:</span><br/>        seconds <span class="purple">=</span> <span class="blue1">0</span><br/>        minutes <span class="purple">+=</span> <span class="blue1">1</span><br/>        <span class="green">if</span> minutes <span class="purple">&gt;</span> <span class="blue1">59</span><span class="purple">:</span><br/>            minutes <span class="purple">=</span> <span class="blue1">0</span><br/>            hours <span class="purple">+=</span> <span class="blue1">1</span><br/>            <span class="green">if</span> hours <span class="purple">&gt;</span> <span class="blue1">23</span><span class="purple">:</span><br/>                hours <span class="purple">=</span> <span class="blue1">0</span></div>
<p class="indent">The function <span class="literal">update_time</span> adds 1 to the number of seconds every time it is called. When the <span class="literal">seconds</span> count gets past 59, it resets to 0 and increases the number of <span class="literal">minutes</span>. It does the same thing for the <span class="literal">hours</span>. We use nested <span class="literal">if</span> statements to accomplish this.</p>
<p class="indent">This is the code to display the hours, minutes, and seconds in binary:</p>
<div class="programs1"><span class="green">def</span> <span class="blue1">display_time</span><span class="purple">():</span><br/>    display_binary<span class="purple">(</span>seconds<span class="purple">,</span> <span class="blue1">6</span><span class="purple">,</span> sec_leds<span class="purple">)</span><br/>    display_binary<span class="purple">(</span>minutes<span class="purple">,</span> <span class="blue1">6</span><span class="purple">,</span> min_leds<span class="purple">)</span><br/>    display_binary<span class="purple">(</span>hours<span class="purple">,</span> <span class="blue1">5</span><span class="purple">,</span> hour_leds<span class="purple">)</span></div>
<p class="indent">We put this code inside the <span class="literal">display_time</span> function, which calls the <span class="literal">display_binary</span> function defined earlier.</p>
<p class="indent">Here is the main <span class="literal">while</span> loop that makes the clock run quickly when someone presses button A and normally otherwise. It also contains the code to keep time.</p>
<div class="programs1"><span class="green">while True</span><span class="purple">:</span><br/>    <span class="green">if</span> button_a<span class="purple">.</span>is_pressed<span class="purple">():</span><br/>        tick <span class="purple">=</span> <span class="blue1">10</span><br/>    <span class="green">else</span><span class="purple">:</span><br/>        tick <span class="purple">=</span> <span class="blue1">1000</span> <span class="purple">+</span> adjust<br/>    now <span class="purple">=</span> running_time<span class="purple">()</span><br/>    elapsed_ms <span class="purple">=</span> now <span class="purple">-</span> last_time<br/><span epub:type="pagebreak" id="page_176"/>    <span class="green">if</span> elapsed_ms <span class="purple">&gt;=</span> tick<span class="purple">:</span><br/>        update_time<span class="purple">()</span><br/>        display_time<span class="purple">()</span></div>
<p class="indent">The first part of the loop checks whether button A is being pressed. If it is, the code reduces <span class="literal">tick</span> to 10 milliseconds. Otherwise, it sets it to <span class="literal">1000 + adjust</span>.</p>
<p class="indent">Finally, we write the code that allows the clock to keep time. The function <span class="literal">running_time</span> returns the number of milliseconds since you last reset your micro:bit. Each time the program loops, we calculate how much time has elapsed since the clock last ticked. The loop does the following:</p>
<ol>
<li class="noindent">Gets the current <span class="literal">running_time</span> and stores it in a variable called <span class="literal">now</span></li>
<li class="noindent">Calculates the value for <span class="literal">elapsed_ms</span> by figuring out the difference between the variables <span class="literal">now</span> and <span class="literal">last_time</span></li>
<li class="noindent">Updates the time if <span class="literal">elapsed_time</span> is greater than our <span class="literal">tick</span> time of 1 second</li>
<li class="noindent">Sets <span class="literal">last_time</span> to <span class="literal">now</span>, resetting the millisecond count to zero</li>
</ol>
<h4 class="h4" id="ch00lev1sec184"><strong>How It Works: Telling the Time in Binary</strong></h4>
<p class="noindent">Using this binary clock to tell the time is a little tricky. It’s especially hard to figure out the seconds, which are likely to have changed before the code has calculated them. But there’s a reason the binary system exists.</p>
<p class="indent">Most of us are familiar with the decimal system of writing numbers. <em>Decimal</em> is the Latin word for 10, and in the decimal system, we use 10 different symbols (the digits 0 through 9). If we need to write a number greater than 9—say 15—then we use two digits. Because of the position of the 1 in the number 15, we know that it actually represents the number 10.</p>
<p class="indent">The following table shows the numbers from 0 to 10 in binary. Note that in decimal, we don’t write <em>leading zeros</em>. We wouldn’t write 15 as 0015, for example. In binary, however, it’s customary to write numbers with the leading zeros to give the numbers the same number of digits. That’s just the way computer scientists roll. So in this case, all the binary numbers are four digits long.</p>
<table class="all">
<colgroup>
<col style="width:50%"/>
<col style="width:50%"/>
</colgroup>
<thead>
<tr>
<td class="table-h" style="vertical-align: top;"><span epub:type="pagebreak" id="page_177"/><p class="tab_th"><strong>Decimal</strong></p></td>
<td class="table-h" style="vertical-align: top;"><p class="tab_th"><strong>Binary</strong></p></td>
</tr>
</thead>
<tbody>
<tr>
<td class="table-b" style="vertical-align: top;"><p class="taba">0</p></td>
<td class="table-b" style="vertical-align: top;"><p class="taba">0000</p></td>
</tr>
<tr>
<td class="table-v" style="vertical-align: top;"><p class="taba">1</p></td>
<td class="table-v" style="vertical-align: top;"><p class="taba">0001</p></td>
</tr>
<tr>
<td class="table-b" style="vertical-align: top;"><p class="taba">2</p></td>
<td class="table-b" style="vertical-align: top;"><p class="taba">0010</p></td>
</tr>
<tr>
<td class="table-v" style="vertical-align: top;"><p class="taba">3</p></td>
<td class="table-v" style="vertical-align: top;"><p class="taba">0011</p></td>
</tr>
<tr>
<td class="table-b" style="vertical-align: top;"><p class="taba">4</p></td>
<td class="table-b" style="vertical-align: top;"><p class="taba">0100</p></td>
</tr>
<tr>
<td class="table-v" style="vertical-align: top;"><p class="taba">5</p></td>
<td class="table-v" style="vertical-align: top;"><p class="taba">0101</p></td>
</tr>
<tr>
<td class="table-b" style="vertical-align: top;"><p class="taba">6</p></td>
<td class="table-b" style="vertical-align: top;"><p class="taba">0110</p></td>
</tr>
<tr>
<td class="table-v" style="vertical-align: top;"><p class="taba">7</p></td>
<td class="table-v" style="vertical-align: top;"><p class="taba">0111</p></td>
</tr>
<tr>
<td class="table-b" style="vertical-align: top;"><p class="taba">8</p></td>
<td class="table-b" style="vertical-align: top;"><p class="taba">1000</p></td>
</tr>
<tr>
<td class="table-v" style="vertical-align: top;"><p class="taba">9</p></td>
<td class="table-v" style="vertical-align: top;"><p class="taba">1001</p></td>
</tr>
<tr>
<td class="table-b" style="vertical-align: top;"><p class="taba">10</p></td>
<td class="table-b" style="vertical-align: top;"><p class="taba">1010</p></td>
</tr>
</tbody>
</table>
<p class="indent">In theory, computers could store numbers like this by using 10 different voltages to represent the digits 0 to 9, but they don’t. Instead, computers use a system called binary. Rather than having 10 possible values for a digit, a binary digit (also called a <em>bit</em>) can represent either a 0 or a 1. Computers use binary because the <em>transistors</em> they are made with are really good at being either off (0) or on (1). That means they have only 2 possible states, which is much easier than giving them 10 possible states. Also, the math behind binary logic means that a computer can do reliable arithmetic on binary numbers far more easily than it were dealing with numbers in decimal.</p>
<p class="indent">Just as in the familiar decimal system, the binary system combines digits to represent bigger numbers. Whereas each digit position in a decimal number increases by a factor of 10—going from 1, to 10, to 100—each binary digit increases by a factor of 2—from 1, to 2, to 4, and so on. For example, the four-digit binary number 1010 has 1s in the 16- and 2-digit positions and 0s in the other positions. In decimal, it’s 16 + 2, or 18.</p>
<p class="indent">It turns out that you don’t need very many binary digits to represent some pretty big numbers. For example, eight binary digits put together (called a <em>byte</em>) can represent a decimal number anywhere between 0 and 255. Make that 16 bits, and the number goes up to 65,535. A computer with 64 bits is able to do everything using those binary 64 digits, and it can represent a number between 0 and 18,446,744,073,709,551,615. Incidentally, a micro:bit has a <span epub:type="pagebreak" id="page_178"/>32-bit processor, able to represent numbers between 0 and a very respectable 4,294,967,295. The MicroPython function <span class="literal">running_time</span> that we’ve been using uses a 32-bit number. This means that it will not run out of numbers for 4,294,967,295 ÷ 1,000 ÷ 60 ÷ 60 ÷ 24 = 49.7 days.</p>
<h3 class="h3" id="ch00lev1sec185"><strong>PROJECT: TALKING CLOCK</strong></h3>
<div class="image"><img alt="Image" src="../images/common3.jpg"/></div>
<p class="difficulty"><em>Difficulty: Easy</em></p>
<p class="noindent">Sometimes the Mad Scientist is so busy with test tubes and chemicals and alarming plumes of smoke that they can’t check the time. And then they forget to eat! That’s when a talking clock comes in handy. This project (<a href="ch07.xhtml#ch7fig4">Figure 7-4</a>) announces the time every hour, or whenever you press button A.</p>
<div class="image" id="ch7fig4"><img alt="Image" src="../images/07fig04.jpg"/></div>
<p class="figcap"><em>Figure 7-4: A talking clock</em></p>
<p class="indent">You can see this project in action at <em><a href="https://www.youtube.com/watch?v=iNjXEK8RUtU">https://www.youtube.com/watch?v=iNjXEK8RUtU</a></em>.</p>
<h4 class="h4" id="ch00lev1sec186"><strong>What You’ll Need</strong></h4>
<p class="noindent">For this project, you’ll need the following items:</p>
<p class="noindentint"><strong><span class="blue">Micro:bit</span></strong></p>
<p class="noindentin"><strong><span class="blue">3 × Alligator clip cables</span></strong> To connect the micro:bit to the speaker</p>
<p class="noindentin"><strong><span class="blue">Speaker for micro:bit</span></strong> To play the sounds (Use a Monk Makes Speaker or see <a href="ch02.xhtml#ch02">Chapter 2</a> for other speaker options.)</p>
<p class="noindentinb"><strong><span class="blue">Power adapter</span></strong> See the <a href="app01.xhtml">appendix</a> for options on keeping your micro:bit powered without batteries.</p>
<p class="indent"><span epub:type="pagebreak" id="page_179"/>If you’re planning to keep your clock running, then use a USB power adapter or another long-term power solution to save on batteries.</p>
<p class="indent">You may want to build a case for the clock or attach the micro:bit and speaker to the same piece of cardboard you used for the light-controlled guitar project from <a href="ch03.xhtml#ch03">Chapter 3</a>.</p>
<h4 class="h4" id="ch00lev1sec187"><strong>Construction</strong></h4>
<ol>
<li class="noindent">The code for this project is in MicroPython, as the speech library is not currently available in the Blocks code. Download the code from <em><a href="https://github.com/simonmonk/mbms/">https://github.com/simonmonk/mbms/</a></em>. The file for this project is <em>ch_07_Talking_Clock.py</em>.</li>
<li class="noindent">Before loading the program onto your micro:bit, open the file in Mu and change the hours and minutes to your current time. Also change <span class="literal">adjust</span> to the amount by which you want to adjust your clock. See “Construction” on <a href="ch07.xhtml#page_167">page 167</a> of the binary clock project if you’re not sure how to do this.</li>
<li class="noindent">Connect a speaker to the micro:bit with one alligator clip on pin 0 and the other alligator clip on the pin marked IN on the speaker. Use the other two clips to provide power to the speaker, as shown in <a href="ch07.xhtml#ch7fig4">Figure 7-4</a>.</li>
<li class="noindent">Wait for the time you set in step 2 to arrive. Then connect the micro:bit to a power source. Note that for this project, there is no other mechanism to set the time.</li>
</ol>
<h4 class="h4" id="ch00lev1sec188"><strong>Code</strong></h4>
<p class="noindent">For clarity, we’ll work through this code in sections.</p>
<p class="indent">Here’s the code that does the time keeping—in other words, that makes sure the hours and minutes are correct. It’s almost the same as the time-keeping code from the previous project. The main difference is that, instead of showing the time on the LED display, the code will speak the current time.</p>
<div class="programs1">digits <span class="purple">= [</span><span class="red1">"no"</span><span class="purple">,</span> <span class="red1">"1"</span><span class="purple">,</span> <span class="red1">"2"</span><span class="purple">,</span> <span class="red1">"3"</span><span class="purple">,</span> <span class="red1">"4"</span><span class="purple">,</span> <span class="red1">"5"</span><span class="purple">,</span> <span class="red1">"6"</span><span class="purple">,</span> <span class="red1">"7"</span><span class="purple">,</span> <span class="red1">"8"</span><span class="purple">,</span> <span class="red1">"9"</span><span class="purple">,</span><br/><span class="red1">"</span><span class="red1">ten"</span><span class="purple">,</span> <span class="red1">"eleven"</span><span class="purple">,</span> <span class="red1">"twelve"</span><span class="purple">,</span> <span class="red1">"thirteen"</span><span class="purple">,</span> <span class="red1">"fourteen"</span><span class="purple">,</span> <span class="red1">"fifteen"</span><span class="purple">,</span><br/><span class="red1">"sixteen"</span><span class="purple">,</span> <span class="red1">"seventeen"</span><span class="purple">,</span> <span class="red1">"eighteen"</span><span class="purple">,</span> <span class="red1">"nienteen"</span><span class="purple">]</span><br/>tens <span class="purple">= [</span><span class="red1">"no"</span><span class="purple">,</span> <span class="red1">"no"</span><span class="purple">,</span> <span class="red1">"twenty"</span><span class="purple">,</span> <span class="red1">"thirty"</span><span class="purple">,</span> <span class="red1">"forty"</span><span class="purple">,</span> <span class="red1">"fifty"</span><span class="purple">]</span><br/><span epub:type="pagebreak" id="page_180"/>preamble <span class="purple">=</span> <span class="red1">"The time is "</span><br/>am <span class="purple">=</span> <span class="red1">"aye em"</span><br/>pm <span class="purple">=</span> <span class="red1">"pee em"</span></div>
<p class="indent">We use several variables and arrays to hold a set of words that the micro:bit will speak.</p>
<p class="indent">The speech library contains recordings of some common words. It can say single digits like 1, 2, or 3, but for numbers 10 and over, it pronounces each digit separately, which is not what we want our talking clock to do. That’s why we have to spell out numbers greater than 10. Notice that <em>nineteen</em> is misspelled as <em>nienteen</em> to make it sound right when the synthesized voice says it. The array called <span class="literal">digits</span> holds the text for each number up to 19. The clock should never speak the 0 digit, so we just set it to the word <span class="literal">no</span>.</p>
<p class="indent">The <span class="literal">tens</span> array does a similar job with numbers that are multiples of 10. We already accounted for all the numbers up to 19 with the digits array, so we don’t need to worry about the first two elements in the <span class="literal">tens</span> array, which will never be spoken. We set these to <span class="literal">no</span> as well.</p>
<p class="indent">The <span class="literal">preamble</span> variable contains the text that the micro:bit will speak before it announces each time. The <span class="literal">am</span> and <span class="literal">pm</span> variables contain phonetic versions of the <small>AM</small>/<small>PM</small> indicator. The micro:bit will speak one of these after reading the time.</p>
<p class="indent">Here’s the code with the function that actually speaks the time. Appropriately enough, it’s called <span class="literal">speak_the_time</span>.</p>
<div class="programs1"><span class="green">def</span> <span class="blue1">speak_the_time</span><span class="purple">():</span><br/>    h <span class="purple">=</span> hours<br/>    am_pm <span class="purple">=</span> am<br/>    <span class="green">if</span> h <span class="purple">&gt;=</span> <span class="blue1">12</span><span class="purple">:</span><br/>        am_pm <span class="purple">=</span> pm<br/>    <span class="green">if</span> h <span class="purple">&gt;</span> <span class="blue1">12</span><span class="purple">:</span><br/>        h <span class="purple">=</span> h <span class="purple">-</span> <span class="blue1">12</span><br/>    <span class="green">if</span> minutes <span class="purple">==</span> <span class="blue1">0</span><span class="purple">:</span><br/>        <span class="ash"># The time is twelve pm exactly</span><br/>        speech<span class="purple">.</span>say<span class="purple">(</span>preamble <span class="purple">+</span> digits<span class="purple">[</span>h<span class="purple">] +</span> <span class="red1">" "</span><br/>                            <span class="purple">+</span> am_pm <span class="purple">+</span> <span class="red1">" exactly"</span><span class="purple">)</span><br/>    <span class="green">else</span>:<br/>        <span class="green">if</span> minutes <span class="purple">&lt;</span> <span class="blue1">10</span><span class="purple">:</span><br/>            <span class="ash"># The time is twelve o four pm</span><br/>            speech<span class="purple">.</span>say<span class="purple">(</span>preamble <span class="purple">+</span> digits<span class="purple">[</span>h<span class="purple">] +</span> <span class="red1">"</span> <span class="red1">o "</span><br/>                  <span class="purple">+</span> digits<span class="purple">[</span>minutes<span class="purple">] +</span> <span class="red1">" "</span> <span class="purple">+</span> am_pm<span class="purple">)</span><br/><span epub:type="pagebreak" id="page_181"/>        <span class="green">elif</span> minutes <span class="purple">&lt;</span> <span class="blue1">20</span><span class="purple">:</span><br/>            <span class="ash"># The time is twelve eighteen pm</span><br/>            speech<span class="purple">.</span>say<span class="purple">(</span>preamble <span class="purple">+</span> digits<span class="purple">[</span>h<span class="purple">] +</span> <span class="red1">" "</span><br/>                  <span class="purple">+</span> digits<span class="purple">[</span>minutes<span class="purple">] +</span> <span class="red1">" "</span> <span class="purple">+</span> am_pm<span class="purple">)</span><br/>        <span class="green">else</span><span class="purple">:</span><br/>            mins_tens <span class="purple">=</span> <span class="blue1">int</span><span class="purple">(</span>minutes <span class="purple">/</span> <span class="blue1">10</span><span class="purple">)</span><br/>            mins_units <span class="purple">=</span> minutes <span class="purple">%</span> <span class="blue1">10</span><br/>            <span class="green">if</span> mins_units <span class="purple">==</span> <span class="blue1">0</span><span class="purple">:</span><br/>                <span class="ash"># The time is twelve twenty pm</span><br/>                speech<span class="purple">.</span>say<span class="purple">(</span>preamble <span class="purple">+</span> digits<span class="purple">[</span>h<span class="purple">] +</span> <span class="red1">" "</span><br/>                      <span class="purple">+</span> tens<span class="purple">[</span>mins_tens<span class="purple">] +</span> <span class="red1">" "</span> <span class="purple">+</span> am_pm<span class="purple">)</span><br/>            <span class="green">else</span><span class="purple">:</span><br/>                <span class="ash"># The time is twelve twenty four pm</span><br/>                speech<span class="purple">.</span>say<span class="purple">(</span>preamble <span class="purple">+</span> digits<span class="purple">[</span>h<span class="purple">] +</span> <span class="red1">" "</span><br/>      <span class="purple">+</span> tens<span class="purple">[</span>mins_tens<span class="purple">] +</span> <span class="red1">" "</span> + digits<span class="purple">[</span>mins_units<span class="purple">] +</span> <span class="red1">"</span> <span class="red1">"</span> <span class="purple">+</span> am_pm<span class="purple">)</span></div>
<p class="indent">This function is fairly complex, as it has to account for our different ways of expressing the time.</p>
<p class="indent">This clock speaks in the 12-hour format but stores the hours in 24-hour format, so the first thing <span class="literal">speak_the_time</span> does is decide whether the time is <small>AM</small> or <small>PM</small>. It subtracts 12 from the <span class="literal">hour</span> variable once <span class="literal">hour</span> reaches 13.</p>
<p class="indent">Next, the nested <span class="literal">if</span> statements cover the following possible cases:</p>
<p class="bull1"><img alt="Image" src="../images/play.jpg"/>  If the time is exactly on the hour, say something like <span class="literal">The time is twelve pm exactly</span>.</p>
<p class="bull1"><img alt="Image" src="../images/play.jpg"/>  Otherwise, if the minutes are less than 10, add an <em>o</em>, to say something like <span class="literal">The time is twelve o four pm</span>.</p>
<p class="bull1"><img alt="Image" src="../images/play.jpg"/>  For two-digit minutes less than 20, use the <span class="literal">digits</span> array and say something like <span class="literal">The time is twelve eighteen pm</span>.</p>
<p class="bull1"><img alt="Image" src="../images/play.jpg"/>  For other two-digit minutes of 20 or over that are multiples of 10, use the <span class="literal">tens</span> array to say something like <span class="literal">The time is twelve twenty pm</span>.</p>
<p class="bull1"><img alt="Image" src="../images/play.jpg"/>  And, where the minutes are not multiples of 10, say something like <span class="literal">The time is twelve twenty four pm</span>.</p>
<p class="indent">Last comes the main <span class="literal">while</span> loop:</p>
<div class="programs1"><span class="green">while True</span><span class="purple">:</span><br/>    if button_b.is_pressed<span class="purple">():</span><br/>        speak_the_time<span class="purple">()</span><br/>    now <span class="purple">=</span> running_time<span class="purple">()</span><br/><span epub:type="pagebreak" id="page_182"/>    elapsed_ms <span class="purple">=</span> now <span class="purple">-</span> last_time<br/>    <span class="green">if</span> elapsed_ms <span class="purple">&gt;=</span> tick<span class="purple">:</span><br/>        elapsed_seconds <span class="purple">=</span> <span class="blue1">int</span><span class="purple">(</span>elapsed_ms <span class="purple">/</span> tick<span class="purple">)</span><br/>        update_time<span class="purple">(</span>elapsed_seconds<span class="purple">)</span><br/>        blink<span class="purple">()</span><br/>        last_time <span class="purple">=</span> now</div>
<p class="indent">This loop checks whether button B has been pressed or an hour has passed and speaks the time if either event has occurred. It also calls a function called <span class="literal">blink</span>. That flashes the heart icon on the screen to reassure you that the clock is working, even if it is silent most of the time.</p>
<h4 class="h4" id="ch00lev1sec189"><strong>How It Works: Teaching the Micro:bit to Speak</strong></h4>
<p class="noindent">The MicroPython speech library opens up all sorts of possibilities in your projects, as you saw back in <a href="ch06.xhtml#ch06">Chapter 6</a>. The sound quality isn’t perfect, but it does add loads of fun to your projects.</p>
<p class="indent">The speech library itself is based on the concept of <em>phonemes</em>: building blocks of sound. When you use the <span class="literal">say</span> function, the text to be spoken is first translated into a series of phonemes. Because of the strangeness of spoken language, this often doesn’t work perfectly—hence the misspelling of <em>nineteen</em> in the code for this project to help the <span class="literal">say</span> function pronounce the word more accurately.</p>
<p class="indent">You can read much more about this speech library at <em><a href="https://microbit-micropython.readthedocs.io/en/latest/tutorials/speech.html">https://microbit-micropython.readthedocs.io/en/latest/tutorials/speech.html</a></em>.</p>
<h3 class="h3" id="ch00lev1sec190"><strong>SUMMARY</strong></h3>
<p class="noindent">Hopefully you now have a good sense of how to make a clock using a micro:bit and use it to display or literally tell you the time.</p>
<p class="indent">In the next chapter, the Mad Scientist turns their attention to psychological experiments.</p>
</body></html>