<html><head></head><body><div id="sbo-rt-content"><span epub:type="pagebreak" id="page_217"/>
<h2 class="h2" id="ch11"><strong><span class="big">11</span><br/>COLLABORATIVE SRE</strong></h2>
<div class="image1"><img src="Images/com.jpg" alt="Image" width="204" height="204"/></div>
<p class="noindent">At this point, you should be comfortable navigating the Ghidra project environment and the many available tools and windows. You know how to create a project, import files, navigate, and manipulate the disassembly. You understand Ghidra data types, data structures, and cross-references. But do you understand scale? A 200MB binary is likely to generate a disassembly that is millions of lines long and consists of hundreds of thousands of functions. Even with the largest, portrait-oriented monitor you can find, you’ll be able to view only a few hundred lines of that disassembly at any one time.</p>
<p class="indent">One way to take on such a monumental task is to assign a team of people to it, but that introduces an additional problem: how will you synchronize everyone’s efforts so that people aren’t walking all over one another with their changes? It’s time to extend our discussion of using Ghidra to cover a collaborative team working together on a shared project. Ghidra’s support for collaborative reverse engineering alone makes it unique among software analysis tools. In this chapter, we introduce Ghidra’s collaboration <span epub:type="pagebreak" id="page_218"/>server, which is included with the standard Ghidra distribution. We discuss its installation, configuration, and use to help you get more eyes focused on your most challenging RE problems.</p>
<h3 class="h3" id="ch11lev187"><strong>Teamwork</strong></h3>
<p class="noindent">SRE is a complex process, and few individuals are experts in all of its intricacies. The ability to have analysts with different skill sets simultaneously analyzing a single binary can drastically reduce the amount of time needed to obtain the desired results. A rock star in navigating control flows through a complex program may dread having to analyze and document the associated data structures. An expert in malware analysis may be ill-suited for vulnerability discovery work, and anyone who is pressed for time is less likely to use that time inserting the inevitable plethora of comments that will certainly be useful down the road, but may in the short run keep them from analyzing additional code. Five colleagues may want to individually analyze the same binary but recognize that there are certain steps in the process that they will all need to do. An individual may need to pass off an assignment to a colleague for expert input or while on vacation. Sometimes, it is just helpful to have multiple sets of eyes looking at the same thing for sanity checks. Regardless of the motivation, the shared project capability within Ghidra supports collaborative SRE in many forms.</p>
<span epub:type="pagebreak" id="page_219"/>
<h3 class="h3" id="ch11lev188"><strong>Ghidra Server Setup</strong></h3>
<p class="noindent">Collaboration in Ghidra is facilitated by a shared Ghidra Server instance. If you are the system administrator responsible for setting up the Ghidra Server, you have a lot of choices to make, like whether to deploy it on a bare-metal server or in a virtual environment for ease of migration and repeatable installation. The deployment we use in this chapter to demonstrate Ghidra’s collaborative features is suitable for development and experimentation only. If you are configuring a Ghidra Server for production use, you should carefully read the Ghidra Server documentation and determine an appropriate configuration for your environment and specific use case. (An entire book could be written to describe Ghidra Server setup and all the installation options and associated approaches, but that isn’t this book.)</p>
<p class="indent">Although Ghidra Server can be configured on all platforms that support Ghidra, we will describe running a Ghidra Server instance in a Linux environment and assume some familiarity with the Linux command line and system administration. We will make a few minor modifications to the Ghidra Server configuration file (specified in <em>server/server.conf</em>) to facilitate the concepts that we want to demonstrate in this chapter so that we are not overly reliant on use of the Linux command line interface after we complete the initial installation, configuration, administration, and access control. Modifications include changing the default Ghidra repository directory to one of our own choosing, as recommended in the Ghidra Server documentation, and tuning user management and access control settings.</p>
<div class="box5">
<p class="boxtitle-c"><strong>GHIDRA SERVER SPECIALS</strong></p>
<p class="noindent">Your Ghidra Server is happy to offer you the following installation options:</p>
<p class="noindent"><strong>Platforms</strong> Bare metal, virtual machine, containers, and more!</p>
<p class="noindent"><strong>Operating systems</strong> Multiple flavors of Windows, Linux, and macOS. Something to suit every taste.</p>
<p class="noindent"><strong>Authentication methods</strong> Choose how friends and colleagues are able to access your offerings—from “open to the general public” to “PKI only” and everything in between.</p>
<p class="noindent"><strong>Preparation</strong> You can install from a container, a script, <em>.bat</em> files, or detailed instructions, or you can make your own recipe by banging away at the console until something exciting happens.</p>
<p class="indenta">If you don’t see what you like, don’t worry, as this is just a subset of what is available. Ghidra Server options can meet the needs of even the most discriminating guests to provide them with the Ghidra installation of their dreams. Thank you for visiting your Ghidra Server. For more information, see the extended server menu, <em>server/svrREADME.html</em>, available in a Ghidra directory near you.</p>
</div>
<p class="noindent">The following steps walk you through a scripting process to create an environment and initial set of Ghidra users on an Ubuntu host.</p>
<ol>
<li class="noindent">Define some environment variables used throughout the script including the Ghidra version you are installing:
<pre>
#set some environment variables<br/>
OWNER=ghidrasrv<br/>
SVRROOT=/opt/${OWNER}<br/>
REPODIR=/opt/ghidra-repos<br/>
GHIDRA_URL=https://ghidra-sre.org/ghidra_<span class="codeitalic1">version</span>.zip<br/>
GHIDRA_ZIP=/tmp/ghidra.zip</pre></li>
<li class="noindent">Install the two packages (<em>unzip</em> and <em>OpenJDK</em>), which are needed to complete the installation and run the server:
<pre>
sudo apt update &amp;&amp; sudo apt install -y openjdk-<span class="codeitalic1">version</span>-jdk unzip</pre></li>
<li class="noindent">Create a nonprivileged user to run the server and create a directory for hosting shared Ghidra repositories outside the directory in which Ghidra Server will be installed. Keeping the server executables and your repositories in separate directories is recommended in the server configuration guide and facilitates future server updates. The Ghidra Server administration tool (svrAdmin) will use the home directory of the server admin user.
<span epub:type="pagebreak" id="page_220"/>
<pre>
sudo useradd -r -m -d /home/${OWNER} -s /usr/sbin/nologin -U ${OWNER}<br/>
sudo mkdir ${REPODIR}<br/>
sudo chown ${OWNER}.${OWNER} ${REPODIR}</pre></li>
<li class="noindent">Download Ghidra, unzip it, and move it to the server root directory. Make sure that you grab the latest public release when you are downloading Ghidra (the release date is in the <em>.zip</em> filename):
<pre>
wget ${GHIDRA_URL} -O ${GHIDRA_ZIP}<br/>
mkdir /tmp/ghidra &amp;&amp; cd /tmp/ghidra &amp;&amp; unzip ${GHIDRA_ZIP}<br/>
sudo mv ghidra_* ${SVRROOT}<br/>
cd /tmp &amp;&amp; rm -f ${GHIDRA_ZIP} &amp;&amp; rmdir ghidra</pre></li>
<li class="noindent">Create a backup of the original server configuration file and change the location in which the repositories will be saved:
<pre>
cd ${SVRROOT}/server &amp;&amp; cp server.conf server.conf.orig<br/>
REPOVAR=ghidra.repositories.dir<br/>
sed -i "s@^$REPOVAR=.*\$@$REPOVAR=$REPODIR@g" server.conf
</pre></li>
<li class="noindent">Add the <code>-u</code> parameter to your Ghidra Server launch parameters, so users can specify a username when connecting, instead of being forced to use their local username. This option allows us to log in as several different users from a single machine for demonstration purposes, and allows us to log in to the same account from several machines. (Some versions of Ghidra expect the repository path to be the last command line parameter, so we changed <code>parameter.2</code> to <code>parameter.3</code> and then added the new <code>parameter.2=-u</code> before that updated line.)
<pre>
PARM=wrapper.app.parameter.<br/>
sed -i "s/^${PARM}2=/${PARM}3=/" server.conf<br/>
sed -i "/^${PARM}3=/i ${PARM}2=-u" server.conf
</pre></li>
<li class="noindent">Change the ownership of the Ghidra Server process and the Ghidra Server directory to the <em>ghidrasvr</em> user. (Because this was just a demonstration server, we left all other parameters unchanged. You are strongly advised to read <em>server/svrREADME.html</em> to determine the configurations appropriate for a production deployment.)
<pre>
ACCT=wrapper.app.account<br/>
sed -i "s/^.*$ACCT=.*/$ACCT=$OWNER/" server.conf<br/>
sudo chown -R ${OWNER}.${OWNER} ${SVRROOT}</pre></li>
<li class="noindent">Finally, install the Ghidra Server as a service and add users authorized to connect to the server:
<pre>
sudo ./svrInstall<br/>
sudo ${SVRROOT}/server/svrAdmin -add user1<br/>
<span epub:type="pagebreak" id="page_221"/>
sudo ${SVRROOT}/server/svrAdmin -add user2<br/>
sudo ${SVRROOT}/server/svrAdmin -add user3</pre></li>
</ol>
<p class="indent">While a more detailed discussion of access control comes later in the chapter, it is important to mention here since the users need to exist in the authentication system that your Ghidra Server instance uses. This happens on the Ghidra Server itself. By default, each user must log in from a Ghidra client within 24 hours by using the default password <em>changeme</em> (which must be changed during the initial login). If a user does not activate their account within 24 hours, the account is locked and must be reset. Ghidra provides the Ghidra Server System Administrator with several options for authentication, ranging from simple passwords to public key infrastructure(PKI). We chose to use a local Ghidra password (which is the default).</p>
<p class="indent">If you want to install your own Ghidra Server or just need a more in-depth description of the various installation options, see <em>server/svrREADME.html</em> in your Ghidra directory.</p>
<div class="box5">
<p class="boxtitle-c"><strong>THE PROJECT REPOSITORY</strong></p>
<p class="noindent">One advantage of working together as a team is that multiple people can work on the same binary at the same time. One disadvantage of working together as a team is that multiple people can work on the same binary at the same time. Whenever multiple users are interacting with the same content, there is a potential to introduce race conditions. In a <em>race condition</em>, the order in which the operations (such as saving an updated file) are performed can affect the final outcome. Ghidra has a project repository and versioning system to control which changes are committed, when, and by whom.</p>
<p class="indent">The Ghidra repository checks files in and out, tracks version history, and lets you see what is currently checked out. When you check out a file, you get a copy of the file. When you have finished working with the file and check the file back in, a new version of the file is created and becomes part of the file’s legacy, and if someone else has also checked in a new version of the file, the repository helps resolve any conflicts. We demonstrate interactions with the repository later in the chapter.</p>
</div>
<h3 class="h3" id="ch11lev189"><strong>Shared Projects</strong></h3>
<p class="noindent">Up to this point, we have created and worked with only standalone Ghidra projects, suitable for use by a single analyst working on a single computer. Now that you have configured and given yourself access to a Ghidra Server, let’s walk through the process of creating a shared project. A shared project can be made accessible to any users who are authorized to connect to your Ghidra Server and facilitates collaborative, concurrent access to the project.</p>
<span epub:type="pagebreak" id="page_222"/>
<h4 class="h4" id="ch11lev190"><strong><em>Creating a Shared Project</em></strong></h4>
<p class="noindent">When you create a new project (File ▸ New Project) and select Shared Project, you must specify the server information associated with your Ghidra Server, as shown on the left in <a href="ch11.xhtml#fig11_1">Figure 11-1</a>. The default port number (13100) is provided, but you must supply the server’s hostname or IP address, and may need to authenticate yourself, depending on the configuration of your Ghidra Server.</p>
<div class="image"><img src="Images/fig11-1.jpg" alt="image" width="694" height="204"/></div>
<p class="figcap" id="fig11_1"><em>Figure 11-1: Logging in to a Ghidra Server repository</em></p>
<p class="indent">On the right side of the figure, we log in as one of the users created by our installation script (<em>user1</em>). If this is the first time logging in as this user, you will need to change the password from <em>changeme</em>, as discussed earlier.</p>
<p class="indent">Next, select an existing repository or create a new one by entering a new repository name, as shown in <a href="ch11.xhtml#fig11_2">Figure 11-2</a>. For this example, we will create a new repository named <em>CH11</em>.</p>
<div class="image"><img src="Images/fig11-2.jpg" alt="image" width="694" height="505"/></div>
<p class="figcap" id="fig11_2"><em>Figure 11-2: The New Project dialog</em></p>
<span epub:type="pagebreak" id="page_223"/>
<p class="indent">Clicking <strong>Next</strong> creates a new repository and a new project and takes you to the now-familiar Project window (<a href="ch11.xhtml#fig11_3">Figure 11-3</a>).</p>
<div class="image"><img src="Images/fig11-3.jpg" alt="image" width="715" height="637"/></div>
<p class="figcap" id="fig11_3"><em>Figure 11-3: Project window for shared project showing Table View</em></p>
<p class="indent">We have imported some files <span class="ent">➊</span> and are displaying them using a table instead of the default tree structure for project files. The <em>Table View</em>, which is one of the tabbed layout choices <span class="ent">➋</span>, provides much more information about each of the project’s files. The Project window shows the name of the project repository (<em>CH11</em>), your role on the project (Administrator), and an icon to the right to provide information about your connection to the server <span class="ent">➌</span>. In this case, hovering over the icon <span class="ent">➍</span> displays the message “Connected as user1 to 172.16.4.35.” If you were not connected, the icon would be a broken link rather than the connected link shown in the image.</p>
<h4 class="h4" id="ch11lev191"><strong><em>Project Management</em></strong></h4>
<p class="noindent">Once a project has been created and has an administrator, authorized users can log in to the server and work with the project. A successful login takes you to the Ghidra Project window, where you will have access to your authorized projects.</p>
<div class="box5">
<p class="boxtitle-c"><strong>WHO’S THE BOSS AROUND HERE?</strong></p>
<p class="noindent">The server administrator is responsible for creating Ghidra Server accounts and configuring an authentication protocol for connections to the server. Server administration is an inherently command line–oriented activity, and there is no requirement for the server administrator to be a Ghidra user themselves. On the client side, any authorized user may create repositories on the Ghidra Server, automatically becoming the administrator of each repository they create. This gives them complete control of the repository, including who can access it and the type of access each user can have. After creation, administrators may grant access to additional authorized users via Ghidra’s Project window.</p>
</div>
<div class="box5">
<p class="boxtitle-c"><strong>I DON’T WANT TO SHARE</strong></p>
<p class="noindent">Using a Ghidra Server installation for nonshared projects has advantages as well. Your initial introduction to Ghidra focused on installing Ghidra on a single computer and using that computer to access your projects and files (which were all stored on that computer). This means all analysis work depends on that computer. Ghidra Server facilitates multipoint access to your files from a wide variety of devices. You can require authentication before your files are accessed, and you can convert your projects from nonshared to shared if desired. One limitation is that you need to be connected to the Ghidra Server to check out or check in files.</p>
</div>
<span epub:type="pagebreak" id="page_224"/>
<h3 class="h3" id="ch11lev192"><strong>Project Window Menus</strong></h3>
<p class="noindent">Now that we have created and connected to a Ghidra Server, the options available in the Project window become more meaningful, as some of the previously unavailable options now have a new context. Here, as well as in <a href="ch12.xhtml#ch12">Chapter 12</a>, we discuss the individual menu components and how they can be used to improve your analysis process.</p>
<h4 class="h4" id="ch11lev193"><strong><em>File</em></strong></h4>
<p class="noindent">The File menu is shown in <a href="ch11.xhtml#fig11_4">Figure 11-4</a>. The first five options in the File menu are pretty standard file-type operations, and their behavior is what you would expect from menu-driven applications. We’ll discuss the notable options, marked with numerals, in detail.</p>
<span epub:type="pagebreak" id="page_225"/>
<div class="image"><img src="Images/fig11-4.jpg" alt="image" width="587" height="501"/></div>
<p class="figcap" id="fig11_4"><em>Figure 11-4: File menu</em></p>
<h5 class="h5" id="ch11lev194"><strong>Deleting Projects</strong></h5>
<p class="noindent">Deleting a project <span class="ent">➊</span> is a permanent action in Ghidra that cannot be undone. Fortunately, it takes effort and requires confirmation. First, you cannot delete your active project. This minimizes the danger of an accidental deletion. To delete a project, you must complete the following three steps:</p>
<ol>
<li class="noindent">Choose <strong>File</strong> ▸ <strong>Delete Project</strong> from the menu.</li>
<li class="noindent">Browse to (or enter the name of) the project to be deleted.</li>
<li class="noindent">Confirm that you want to delete the project in the resulting confirmation window.</li>
</ol>
<p class="indent">Deleting a project deletes all of its associated files. For that reason, it may be wise to first archive the project via the Archive Current Project option <span class="ent">➋</span>.</p>
<h5 class="h5" id="ch11lev195"><strong>Archiving Projects</strong></h5>
<p class="noindent">Archiving a project allows you to save a snapshot of the project, its associated files, and associated tool configurations. Reasons for archiving a pro­ject include the following:</p>
<ul>
<li class="noindent">You are going to delete the project but want to preserve a copy “just in case.”</li>
<li class="noindent">You want to package a project for migration to another server.</li>
<li class="noindent"><span epub:type="pagebreak" id="page_226"/>You want a version you can easily transfer between Ghidra versions.</li>
<li class="noindent">You want to create a backup of a project.</li>
</ul>
<p class="indent">Follow these steps to archive a project:</p>
<ol>
<li class="noindent">Close the CodeBrowser window and all associated tools.</li>
<li class="noindent">Choose <strong>File</strong> ▸ <strong>Archive Current Project</strong> from the menu.</li>
<li class="noindent">Choose a location and name for the archive file on your local machine.</li>
</ol>
<p class="indent">If you choose the name of an existing file, you will have the opportunity to change the name or overwrite the existing file. Archived files can easily be restored through the Restore Project option.</p>
<h5 class="h5" id="ch11lev196"><strong>Batch Import</strong></h5>
<p class="noindent">The Batch Import option (at <span class="ent">➌</span> in <a href="ch11.xhtml#fig11_4">Figure 11-4</a>) allows you to import a collection of files into a project in a single operation. When you choose File ▸ Batch Import, Ghidra presents a file browser window similar to the one shown in <a href="ch11.xhtml#fig11_5">Figure 11-5</a>. This window allows you to navigate to the directory containing the files you wish to import.</p>
<div class="image"><img src="Images/fig11-5.jpg" alt="image" width="575" height="462"/></div>
<p class="figcap" id="fig11_5"><em>Figure 11-5: Batch file import selection window with files selected</em></p>
<p class="indent">You can select a file (or files) from a single directory, or an entire directory, to add to the batch import list. After you highlight the files and click the Select files button, you are taken to the Batch Import window, which shows you the files you have already selected for import. In <a href="ch11.xhtml#fig11_6">Figure 11-6</a>, the files from the directory <em>BinBatchImport1</em> were loaded as individual files, and the directory <em>BinBatchImport2</em> was added as a directory with five files, as shown to the right of the directory name. You can add/remove files to refine your <span epub:type="pagebreak" id="page_227"/>import list and control several options, including the depth of recursion to search for files in a directory.</p>
<p class="indent">To determine the appropriate depth limit in the Batch Import window, or simply to explore the filesystem, use the Open File System menu option (at <span class="ent">➍</span> in <a href="ch11.xhtml#fig11_4">Figure 11-4</a>). This option opens the selected file system container (<em>.zip</em> file, <em>.tar</em> file, directory, and so on) in a separate window. (It is best to determine the depth beforehand because you would need a second Ghidra instance open to operate both windows simultaneously. Each window blocks access to the other in a single instance.)</p>
<div class="image"><img src="Images/fig11-6.jpg" alt="image" width="694" height="548"/></div>
<p class="figcap" id="fig11_6"><em>Figure 11-6: Batch file import confirmation dialog</em></p>
<h4 class="h4" id="ch11lev197"><strong><em>Edit</em></strong></h4>
<p class="noindent">The Edit menu is shown in <a href="ch11.xhtml#fig11_7">Figure 11-7</a>. The Tool Options and Plugin Path options are be discussed in <a href="ch12.xhtml#ch12">Chapter 12</a>, but the PKI options are related to the Ghidra Server setup and merit discussion in this chapter.</p>
<div class="image"><img src="Images/fig11-7.jpg" alt="image" width="547" height="179"/></div>
<p class="figcap" id="fig11_7"><em>Figure 11-7: Edit menu</em></p>
<span epub:type="pagebreak" id="page_228"/>
<h5 class="h5" id="ch11lev198"><strong>PKI Certificates</strong></h5>
<p class="noindent">As mentioned at the start of this chapter, when you set up a Ghidra Server, you can choose from several authentication methods. We set up a simple server that uses a username and password for authentication. PKI certificates are more complex. While PKI implementations can vary, the following example represents a reasonable PKI client authentication process for Ghidra Server:</p>
<p class="uln-indent2"><em>User1</em> wants to be authenticated so she can work on her Ghidra Server project. She has a client certificate that includes her username and a public cryptographic key. She also has a private cryptographic key corresponding to the public key contained in the certificate, which she keeps safely hidden away for important occasions such as this. Her certificate was cryptographically signed by a certificate authority (CA) that is trusted by the Ghidra Server.</p>
<p class="uln-indent1"><em>User1</em> presents the server with her certificate, from which the server can extract the public key and username. The server runs checks to confirm the certificate is valid (for example, is not on a Certificate Revocation List, is within a valid date range, and has a valid signature from a trusted CA, and possibly others). If all checks pass, the server confirms a valid certificate and binds <em>User1</em>’s identity to a public key. Now <em>User1</em> needs to prove she has the corresponding private key so the Ghidra Server can verify it against the extracted public key. As long as the private key is truly held by only <em>User1</em>, the Ghidra Server correctly validates her certificate, and the server verifies that <em>User1</em> actually possesses the private key, so <em>User1</em> is considered to be authenticated.</p>
<p class="indenta">The process for managing PKI certificate authorities is described in the Ghidra Server readme file (<em>server/svrREADME.html</em>). The Set PKI Certificate and Clear PKI Certificate menu options enable a user to associate (or disassociate) themselves with a key file (<em>*.pfx</em>, <em>*.pks</em>, <em>*.p12</em>). When setting a PKI certificate, the user will be provided a file navigation window to identify the appropriate keystore. The certificate can be cleared at any time with the Clear PKI Certificate option. Should you choose to enable PKI authentication, Java’s <code>keytool</code> utility may be used to manage keys, certificates, and Java keystores.</p>
<span epub:type="pagebreak" id="page_229"/>
<h4 class="h4" id="ch11lev199"><strong><em>Project</em></strong></h4>
<p class="noindent">The Project menu, shown in <a href="ch11.xhtml#fig11_8">Figure 11-8</a>, provides facilities for managing project-level activities, including viewing and copying from other projects, changing your password, and managing user access to projects that you administer.</p>
<div class="image"><img src="Images/fig11-8.jpg" alt="image" width="618" height="369"/></div>
<p class="figcap" id="fig11_8"><em>Figure 11-8: Project menu</em></p>
<h5 class="h5" id="ch11lev200"><strong>Viewing Projects and Repositories</strong></h5>
<p class="noindent">The first four options <span class="ent">➊</span> are related to viewing projects and repositories. The first two, View Project and View Repository, open read-only versions of a project (local) or repository (remote server) in a new window adjacent to the Active Project window. In <a href="ch11.xhtml#fig11_9">Figure 11-9</a>, the local project <em>ExtraFiles</em> has been opened beside the active project. You can explore the read-only project or drag any file or directory from the Read-Only Project Data window to the Active Project window. In <a href="ch11.xhtml#fig11_9">Figure 11-9</a>, the three selected files (with the extension <em>NEW</em>) have been copied from the Project Data window to the active project: <em>CH11</em>.</p>
<p class="indent">The next option, View Recent, provides a list of recent projects that can speed up the process of locating a project or repository. Close View closes the read-only view (although in some versions of Ghidra, this option appears to be inactive). A simpler reliable alternative is to click the X at the bottom of the project tab you wish to close, as seen in the bottom right of <a href="ch11.xhtml#fig11_9">Figure 11-9</a>.</p>
<span epub:type="pagebreak" id="page_230"/>
<div class="image"><img src="Images/fig11-9.jpg" alt="image" width="694" height="514"/></div>
<p class="figcap" id="fig11_9"><em>Figure 11-9: Using Project window to view another project</em></p>
<h5 class="h5" id="ch11lev201"><strong>Changing Passwords and Project Access</strong></h5>
<p class="noindent">The Change Password option (at <span class="ent">➋</span> in <a href="ch11.xhtml#fig11_8">Figure 11-8</a>) is available only to users on shared projects, provided that the Ghidra Server is configured with an authentication method that allows a password change. This is a two-step process with an initial confirmation dialog, as shown in <a href="ch11.xhtml#fig11_10">Figure 11-10</a>, followed by the same password change option dialog used for the initial mandatory password change.</p>
<div class="image"><img src="Images/fig11-10.jpg" alt="image" width="581" height="242"/></div>
<p class="figcap" id="fig11_10"><em>Figure 11-10: Password change initial confirmation dialog</em></p>
<span epub:type="pagebreak" id="page_231"/>
<p class="indent">While users can each control their own passwords, shared projects also offer the capability to control who can access a project and what permissions are granted to each user. As mentioned earlier in the chapter, the Ghidra Server system administrator has some control over access. Specifically, an administrator can assign an administrator to a repository and create and delete user accounts.</p>
<p class="indent">On the client side, if you are an administrator, you can also control access through the Edit Project Access List option (at <span class="ent">➌</span> in <a href="ch11.xhtml#fig11_8">Figure 11-8</a>) from the Project menu. When it is selected, you will see the dialog shown in <a href="ch11.xhtml#fig11_11">Figure 11-11</a>, which allows you to add and remove users from the project and to control their associated permissions. Each user can be placed in exactly one privilege class, from least privileged (Read Only to the left) to most privileged (Admin on the right).</p>
<div class="image"><img src="Images/fig11-11.jpg" alt="image" width="694" height="314"/></div>
<p class="figcap" id="fig11_11"><em>Figure 11-11: Access control window</em></p>
<h5 class="h5" id="ch11lev202"><strong>Viewing Project Information</strong></h5>
<p class="noindent">The final menu option is View Project Info (at <span class="ent">➍</span> in <a href="ch11.xhtml#fig11_8">Figure 11-8</a>). The options available in the resulting dialog depend on the whether the project is hosted on a Ghidra Server. Examples of nonserver-based (left) and server-based (right) project information dialogs are shown in <a href="ch11.xhtml#fig11_12">Figure 11-12</a>. While the information displayed is pretty straightforward, buttons at the bottom of each window allow you to convert a nonshared project to a shared project (with the Convert to Shared button) or change project information.</p>
<p class="indent">Clicking the Convert to Shared button opens a dialog that asks you to specify the server information and enter the user ID and password for the project administrator. The subsequent steps allow you to specify a repository, add users, set their permissions, and confirm that you want to convert the project. Note that this operation cannot be undone and removes all existing local version history.</p>
<span epub:type="pagebreak" id="page_232"/>
<div class="image"><img src="Images/fig11-12.jpg" alt="image" width="694" height="465"/></div>
<p class="figcap" id="fig11_12"><em>Figure 11-12: Project information windows for nonshared and shared projects</em></p>
<h3 class="h3" id="ch11lev203"><strong>Project Repository</strong></h3>
<p class="noindent">At this point, you may be wondering how projects can be shared while maintaining project integrity. This section covers the process that Ghidra uses to ensure that everyone’s work is retained in a shared project that a team can work on concurrently. Before we delve too deeply into the process, let’s investigate the file types associated with a shared Ghidra project. We start with discussing the relationship between a project and a repository.</p>
<p class="indent">A repository is the key facilitator of the versioning process. When you create a new nonshared project, a project file (<em>.gpr</em> file) and a repository directory, with a <em>.rep</em> extension, are created to facilitate version control. Additional files are created to control locks, versioning, and so on, but understanding the purpose of each file is not critical to successful Ghidra usage. For nonshared projects, all files reside on your computer within the directories that you specify at project creation time (refer to <a href="ch04.xhtml#ch04">Chapter 4</a>).</p>
<p class="indent">When you create a shared project, you have the option of creating a new repository or selecting from existing repositories, as discussed earlier in the chapter (refer to <a href="ch11.xhtml#fig11_2">Figure 11-2</a>). If you create a new project and a new repository at the same time, a one-to-one relationship exists between the project and its repository, and you become the project administrator. If you choose an existing repository, you are creating a new project for which you are not the project administrator (unless you owned the repository). In either case, the <em>.gpr</em> file and the <em>.rep</em> directory share the same base name. If the repository is named RepoExample, the project file will be named <em>RepoExample.gpr</em> and the repository folder will be named <em>RepoExample.rep</em>. (Despite having an extension, the repository is a directory rather than a file.)</p>
<span epub:type="pagebreak" id="page_233"/>
<p class="indent">To sum it up: if you create the repository, you are the project administrator and can choose who else can access your repository. If you use an existing repository, you are a user with the rights and privileges that have been assigned to you by the project administrator. So what happens when multiple users want to make changes to the same project? That’s where version control comes into play.</p>
<div class="box5">
<p class="boxtitle-c"><strong>VERSION CONTROL VS. VERSION TRACKING</strong></p>
<p class="noindent">Ghidra includes two very different versioning systems. In this chapter, we are discussing version control, and hopefully that concept will become quite clear shortly. Ghidra also has a <em>version tracking</em> capability. Version tracking is used to identify differences (and similarities) between two binaries. In the SRE community, this process is generally known as <em>binary differencing</em>. The goals may include identifying updates in different versions of a binary, identifying functions used by a malware family, identifying signatures, and so on. This functionality can be important given that the associated source code may not be available to allow for source-based diffing. Ghidra version tracking is discussed in more detail in <a href="ch23.xhtml#ch23">Chapter 23</a>.</p>
</div>
<h4 class="h4" id="ch11lev204"><strong><em>Version Control</em></strong></h4>
<p class="noindent"><em>Version control</em> is an important concept in any system where changes can be made by multiple users or a recorded history of changes is desirable. Version control allows you to manage updates to the system, effectively controlling race conditions. The Project window has a version control toolbar (<a href="ch11.xhtml#fig11_13">Figure 11-13</a>). Many of the operations require that the file(s) in question be closed in order to complete the action.</p>
<div class="image"><img src="Images/fig11-13.jpg" alt="image" width="296" height="119"/></div>
<p class="figcap" id="fig11_13"><em>Figure 11-13: Ghidra Project window version control toolbar</em></p>
<p class="indent">The icons are enabled for valid version control operations based on the selected file(s). The basic actions that make up the version control workflow are shown in <a href="ch11.xhtml#fig11_14">Figure 11-14</a>. (We have included a column that provides the rough Git equivalents for all the Git fans.)</p>
<span epub:type="pagebreak" id="page_234"/>
<div class="image"><img src="Images/fig11-14.jpg" alt="image" width="695" height="491"/></div>
<p class="figcap" id="fig11_14"><em>Figure 11-14: Ghidra version control toolbar actions</em></p>
<p class="indent">In addition to using the toolbar icons, you can perform the version control actions via the right-click context menu.</p>
<h5 class="h5" id="ch11lev205"><strong>Merging Files</strong></h5>
<p class="noindent">When a collaborative team member decides to check in changes they have made to the project, one of two conditions will be true:</p>
<p class="uln-indent2"><strong>No conflict</strong> In this case, no new versions of the file have been checked in since the user checked out the file. Since no potential conflict exists (no committed, conflicting changes that the user is not already aware of), the file that is being checked in will become the new version of the file. The old version will be retained in an archival fashion and the version number incremented to ensure that a continuous chain of versions can be tracked.</p>
<p class="uln-indent"><strong>Potential conflict</strong> In this case, another user has committed new changes while the user had the file checked out. The order in which the files are checked in can affect the resulting “current version.” In this case, Ghidra begins a merge process. If no conflicts are introduced by the submissions, Ghidra continues with its automatic merge process. If conflicts are detected, each must be manually resolved by the user.</p>
<p class="indenta">As an example of a conflict, assume that <em>user1</em> and <em>user2</em> both have the same file checked out and that <em>user2</em> changes the name of <code>FUN_00123456</code> to <code>hash_something</code> and checks in their change. Meanwhile, <em>user1</em> analyzes the same function and renames it to <code>compute_hash</code>. When <em>user1</em> finally checks their changes in (after <em>user2</em>), they will be informed of a naming conflict <span epub:type="pagebreak" id="page_235"/>and will be asked to choose the correct name of the function, between <code>hash</code><code>_something</code> and <code>compute_hash</code>, before the check-in operation may be completed. Additional information about this process can be found in Ghidra Help.</p>
<div class="box5">
<p class="boxtitle-c"><strong>VERSION CONTROL COMMENTS</strong></p>
<p class="noindent">When you add or modify a file under version control, you should add a comment explaining what you’ve done. Each version control action displays a dialog with a comment field and special options. <a href="ch11.xhtml#fig11_15">Figure 11-15</a> shows the Add File to Version Control comment dialog.</p>
<div class="image"><img src="Images/fig11-15.jpg" alt="image" width="588" height="366"/></div>
<p class="figcap" id="fig11_15"><em>Figure 11-15: Ghidra’s Add File to Version Control comment dialog</em></p>
<p class="indent">The title bar displays the action being performed and is supplemented below by the associated icon as well as a description of what you should be entering in the Comments text box. If more than one file has been selected, any comments will be associated with only the first file unless the Apply to All button is clicked. Below the Comments text box are specific options associated with the action being performed that the user can select or deselect. See the third column of <a href="ch11.xhtml#fig11_14">Figure 11-14</a> for the special options for each of the actions.</p>
</div>
<h4 class="h4" id="ch11lev206"><strong><em>Example Scenario</em></strong></h4>
<p class="noindent">A lot of intricacies, options, and overloaded terminology are associated with shared projects. To clarify some of the concepts associated with Ghidra Server and shared projects, let’s walk through an example that demonstrates the concepts we have been discussing, starting with the concept of a project.</p>
<p class="indent">A <em>project</em> is the local entity that lives on the client machine (like a local Git repo). Shared projects are also associated with a repository on a Ghidra Server (like a Git remote), and that repository is where all of the collaborative analysis effort results are stored. Files are shared after they have <span epub:type="pagebreak" id="page_236"/>been imported and added to version control, and are private before that. Therefore, a user can import files into a project, at which point they are private, and then choose to add them to version control, at which point they are shared.</p>
<div class="box5">
<p class="boxtitle-c"><strong>HELP! MY FILE HAS BEEN HIJACKED!</strong></p>
<p class="noindent">Ghidra has a special term (and associated Project Data Tree icon) for a situation that can frequently occur in a shared project environment. If you have a private file (imported but not yet added to version control) in your project <em>and</em> another user adds a file of the same name to the repository, your file will be <em>hijacked</em>! This is such a frequent occurrence that Ghidra provides a right-click context menu option to handle the situation. You will need to close the hijacked file and then select the Undo Hijack option from the context menu. This will provide you with the option to accept the file in the repository and keep a copy of your own file, if desired. Other options for resolving a hijack include renaming the file, moving it to another project, and deleting it.</p>
</div>
<p class="indent">In reality, project permissions are really repository permissions. If you create a project using an existing repository, you’re really saying, “This project locally is backed remotely by that repository on the server” (like a Git clone). Let’s walk through a sequence of shared project activities and observe how they affect the shared project environment:</p>
<ol>
<li class="noindent"><em>user1</em> creates a new shared project (and associated new repository) called <em>CH11-Example</em>, adds <em>user2</em> and <em>user3</em>, and assigns them permissions (see <a href="ch11.xhtml#fig11_16">Figure 11-16</a>).
<div class="image"><img src="Images/fig11-16.jpg" alt="image" width="657" height="310"/></div>
<p class="figcap" id="fig11_16"><em>Figure 11-16: Example scenario, step 1</em></p></li>
<li class="noindent"><span epub:type="pagebreak" id="page_237"/><em>user2</em> creates a new shared project associated with the existing <em>CH11-Example</em> repository (that is, <em>user2</em> clones <em>CH11-Example</em>). Note that the project is not the same name as <em>user1</em>’s project, but the repository (remote) is the same. In addition, <em>user2</em>’s permissions for the repository are shown at the bottom of the window (see <a href="ch11.xhtml#fig11_17">Figure 11-17</a>).
<div class="image"><img src="Images/fig11-17.jpg" alt="image" width="498" height="479"/></div>
<p class="figcap" id="fig11_17"><em>Figure 11-17: Example scenario, step 2</em></p></li>
<li class="noindent"><em>user1</em> imports a file and adds it to version control, which <em>user2</em> can then also see (roughly equivalent to <code>git add</code>/<code>commit</code>/<code>push</code>). This is shown in <a href="ch11.xhtml#fig11_18">Figure 11-18</a>.
<div class="image"><img src="Images/fig11-18.jpg" alt="image" width="657" height="329"/></div>
<p class="figcap" id="fig11_18"><em>Figure 11-18: Example scenario, step 3</em></p></li>
<li class="noindent"><span epub:type="pagebreak" id="page_238"/><em>user1</em> and <em>user2</em> then each import the same file to their projects but don’t add them to version control. These are private files (see <a href="ch11.xhtml#fig11_19">Figure 11-19</a>).
<div class="image"><img src="Images/fig11-19.jpg" alt="image" width="657" height="364"/></div>
<p class="figcap" id="fig11_19"><em>Figure 11-19: Example scenario, step 4</em></p></li>
<li class="noindent"><em>user2</em> adds this second file to version control (which checks it in). As a result, the file is no longer private. <em>user1</em> now sees this as a hijacked file (see <a href="ch11.xhtml#fig11_20">Figure 11-20</a>).
<div class="image"><img src="Images/fig11-20.jpg" alt="image" width="657" height="315"/></div>
<p class="figcap" id="fig11_20"><em>Figure 11-20: Example scenario, step 5</em></p></li>
<li class="noindent"><em>user1</em> chooses Undo Hijack from the right-click context menu and has the option to replace her file with the version in the repository and keep a copy of her own file if desired. She chooses to accept the repository version and to keep a copy of her own file (which she has moved to another project, and it now has the extension <em>.keep</em>). Now everything is good again. In this case, <em>user1</em> is now seeing the state of the second file as it was when <em>user2</em> added it to version control (see <a href="ch11.xhtml#fig11_21">Figure 11-21</a>).
<span epub:type="pagebreak" id="page_239"/>
<div class="image"><img src="Images/fig11-21.jpg" alt="image" width="657" height="338"/></div>
<p class="figcap" id="fig11_21"><em>Figure 11-21: Example scenario, step 6</em></p></li>
<li class="noindent"><em>user1</em> checks out the second file, analyzes it, and then checks it in. Both <em>user1</em> and <em>user2</em> now see the analyzed version of the file (version 2), as shown in <a href="ch11.xhtml#fig11_22">Figure 11-22</a>.
<div class="image"><img src="Images/fig11-22.jpg" alt="image" width="657" height="340"/></div>
<p class="figcap" id="fig11_22"><em>Figure 11-22: Example scenario, step 7</em></p></li>
<li class="noindent"><em>user3</em> creates a project and associates it with the same repository (see <a href="ch11.xhtml#fig11_23">Figure 11-23</a>). <em>user3</em> can now see all of the files and can make changes locally (including adding private files), but has no option to commit to the repository, because she was not given write permissions. (The project is noted as “Read Only” at the bottom of the window.)
<span epub:type="pagebreak" id="page_240"/>
<div class="image"><img src="Images/fig11-23.jpg" alt="image" width="657" height="525"/></div>
<p class="figcap" id="fig11_23"><em>Figure 11-23: Example scenario, step 8</em></p></li>
<li class="noindent"><em>user2</em> checks in all of her files before leaving work. This is important because she knows that she wants to continue working on her project by using her home computer. Because the project does not exist on her home computer, she needs to log in to the Ghidra Server and create a new project by using the existing repository. This will create the project on her home computer, where she can continue working. (Had she not checked in all of her files before leaving work, she would not have access to her latest work while at home.)</li>
<li class="noindent">The remaining users go home confident that their collaborative Ghidra Server is working as intended.</li>
</ol>
<h3 class="h3" id="ch11lev207"><strong>Summary</strong></h3>
<p class="noindent">Not everyone will require a Ghidra Server or shared projects to facilitate collaborative reverse engineering, but many of the associated capabilities can also be applied to nonshared projects. The remaining chapters focus on nonshared projects, with references to shared projects and Ghidra Server when appropriate. Regardless of the configuration of your Ghidra installation, there is a good chance the default configurations, tools, and views may not be perfect for your workflow. The next chapter focuses on Ghidra configurations, tools, and workspaces and how you can make them work better for you.</p>
</div>



  </body></html>