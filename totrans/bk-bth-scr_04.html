<html><head></head><body>
<div id="sbo-rt-content" class="calibre1"><section aria-labelledby="ch3" epub:type="chapter" role="doc-chapter">
<hgroup>
<h2 class="title" id="ch3">
<span class="cn"><span aria-label=" Page 25. " epub:type="pagebreak" id="pg_25" role="doc-pagebreak" class="calibre2"/><span class="sans_dogma_ot_bold_b_">3</span></span>
<span class="ct1"><span class="sans_dogma_ot_bold_b_">SCOPE AND DELAYED EXPANSION</span></span>
</h2>
</hgroup>
<figure class="opener"><img alt="" class="opener1" height="407" src="../images/chapter.jpg" width="408"/>
</figure>
<p class="chapterintro">In the prior chapter, you learned about variables, how to set them, and how to resolve their values. In this chapter, I’ll focus on the <span class="sans_thesansmonocd_w5regular_1">setlocal</span> command, which is central to some significant and disparate features of Batch and alters when, where, and how you can handle variables. First, it defines <i class="calibre13">scope</i>: where and when those variables can be accessed and manipulated. Second, it enables a feature called <i class="calibre13">delayed expansion</i>, which alters how variables are resolved, one upshot of which allows you to store one variable inside another variable.</p>
<p class="tx">All languages handle scope in some fashion, but delayed expansion, or something similar, is far less common, and you’ll see some surprising uses for it. Finally, the <span class="sans_thesansmonocd_w5regular_">setlocal</span> command enables <i class="calibre6">command extensions</i>, an <span aria-label=" Page 26. " epub:type="pagebreak" id="pg_26" role="doc-pagebreak"/>awkward term for a mass of additional functionality that’s turned on for many other Batch commands.</p>
<section aria-labelledby="sec1" epub:type="division">
<h3 class="h" id="sec1"><span id="h1-25"/><span class="sans_futura_std_bold_b_">Scope</span></h3>
<p class="tni">Scope defines the life span of a variable. A <i class="calibre6">global variable</i> can be set, resolved, deleted, and modified anywhere, and that works fine for most simple bat files. A <i class="calibre6">local variable</i> is created with a limited shelf life, meant to be accessible in a single section of code where it’s <i class="calibre6">in scope</i>. Where those modifications aren’t recognized, the variable is <i class="calibre6">out of scope</i>.</p>
<p class="tx">In Batch, the <span class="sans_thesansmonocd_w5regular_">setlocal</span> command starts a section of code where variables are in scope, and the <span class="sans_thesansmonocd_w5regular_">endlocal</span> command ends that section, making those variables out of scope. Everything defined or manipulated between the two commands is active in that space, but after execution of the <span class="sans_thesansmonocd_w5regular_">endlocal</span> command, those variables revert to their prior state.</p>
<p class="tx">To demonstrate, the following code writes the state of three variables to the console both in and out of scope of the <span class="sans_thesansmonocd_w5regular_">setlocal</span> command. One is defined only inside the scope of the <span class="sans_thesansmonocd_w5regular_">setlocal</span>, one only outside, and one both inside and outside. To the right of the <span class="sans_thesansmonocd_w5regular_">echo</span> commands, I’ve included remarks showing the results, in particular the resolved variables, written to the console:</p>
<pre class="pre"><code class="calibre11"><span aria-label="annotation1" class="codeannotationhang">❶</span> set inAndOut=OUT    
set outer=OUT

<span aria-label="annotation2" class="codeannotationhang">❷</span> setlocal   

<span aria-label="annotation3" class="codeannotationhang">❸</span> set inAndOut=IN     
set inner=IN

<span aria-label="annotation4" class="codeannotationhang">❹</span> &gt; con echo Inside Scope:                   &amp;rem Inside Scope:
&gt; con echo   Outer Variable = %outer%      &amp;rem   Outer Variable = OUT
&gt; con echo   Inner Variable = %inner%      &amp;rem   Inner Variable = IN
&gt; con echo  In/Out Variable = %inAndOut%   &amp;rem  In/Out Variable = IN

<span aria-label="annotation5" class="codeannotationhang">❺</span> endlocal  

<span aria-label="annotation6" class="codeannotationhang">❻</span> &gt; con echo Outside Scope:                  &amp;rem Outside Scope:
&gt; con echo   Outer Variable = %outer%      &amp;rem   Outer Variable = OUT
&gt; con echo   Inner Variable = %inner%      &amp;rem   Inner Variable =
&gt; con echo  In/Out Variable = %inAndOut%   &amp;rem  In/Out Variable = OUT
</code></pre>
<p class="tx">There’s a lot to unpack here. Let’s take the first variable defined: <span class="sans_thesansmonocd_w5regular_">inAndOut</span> is set to <span class="sans_thesansmonocd_w5regular_">OUT</span> <span aria-label="annotation1" class="codeannotation">❶</span> before the <span class="sans_thesansmonocd_w5regular_">setlocal</span> <span aria-label="annotation2" class="codeannotation">❷</span> is executed, meaning that it was set out of scope of the command. After the <span class="sans_thesansmonocd_w5regular_">setlocal</span> executes, the same variable is set to <span class="sans_thesansmonocd_w5regular_">IN</span> <span aria-label="annotation3" class="codeannotation">❸</span> where it’s in scope. When <span class="sans_thesansmonocd_w5regular_">inAndOut</span> is first interrogated, it resolves to <span class="sans_thesansmonocd_w5regular_">IN</span> <span aria-label="annotation4" class="codeannotation">❹</span> because it’s in scope. But after the <span class="sans_thesansmonocd_w5regular_">endlocal</span> <span aria-label="annotation5" class="codeannotation">❺</span> executes, it’s out of scope and reverts to its prior state, which is <span class="sans_thesansmonocd_w5regular_">OUT</span> <span aria-label="annotation6" class="codeannotation">❻</span>. (As a side note, <span class="sans_thesansmonocd_w5regular_">IN-N-OUT</span> is always set to <span class="sans_thesansmonocd_w5regular_">delicious</span>.)</p>
<p class="tx"><span aria-label=" Page 27. " epub:type="pagebreak" id="pg_27" role="doc-pagebreak"/>Now consider the <span class="sans_thesansmonocd_w5regular_">inner</span> variable, which is defined just once, when it’s in scope. That is, after the <span class="sans_thesansmonocd_w5regular_">setlocal</span> <span aria-label="annotation2" class="codeannotation">❷</span> executes, it’s set to <span class="sans_thesansmonocd_w5regular_">IN</span> <span aria-label="annotation3" class="codeannotation">❸</span>. The variable then resolves to the value of <span class="sans_thesansmonocd_w5regular_">IN</span> <span aria-label="annotation4" class="codeannotation">❹</span> before the <span class="sans_thesansmonocd_w5regular_">endlocal</span> <span aria-label="annotation5" class="codeannotation">❺</span> is executed, but here’s where it gets interesting; after the <span class="sans_thesansmonocd_w5regular_">endlocal</span> <span aria-label="annotation5" class="codeannotation">❺</span>, it reverts to its prior state of not being defined at all—that is, null or empty <span aria-label="annotation6" class="codeannotation">❻</span>.</p>
<p class="tx">The final variable is <span class="sans_thesansmonocd_w5regular_">outer</span>, and it’s also defined just one time, but when it’s out of scope. It’s set to <span class="sans_thesansmonocd_w5regular_">OUT</span> <span aria-label="annotation1" class="codeannotation">❶</span> before the <span class="sans_thesansmonocd_w5regular_">setlocal</span> <span aria-label="annotation2" class="codeannotation">❷</span> executes. As you might expect, the variable is still <span class="sans_thesansmonocd_w5regular_">OUT</span> <span aria-label="annotation6" class="codeannotation">❻</span> after the <span class="sans_thesansmonocd_w5regular_">endlocal</span> <span aria-label="annotation5" class="codeannotation">❺</span> executes when it’s out of scope. But as you might not expect, its value is also available while in scope of the <span class="sans_thesansmonocd_w5regular_">setlocal</span> <span aria-label="annotation2" class="codeannotation">❷</span>, as its value also is <span class="sans_thesansmonocd_w5regular_">OUT</span> <span aria-label="annotation4" class="codeannotation">❹</span> before the <span class="sans_thesansmonocd_w5regular_">endlocal</span> <span aria-label="annotation5" class="codeannotation">❺</span> executes.</p>
<p class="tx">This example shows that the <span class="sans_thesansmonocd_w5regular_">setlocal</span> command doesn’t inhibit us from using variables already in scope. Everything existing up to that point is still available. What it does is this: <i class="calibre6">a snapshot is taken of the environment at the moment that the</i> <span class="sans_thesansmonocd_w5regular_italic_i_">setlocal</span> <i class="calibre6">executes, to which it returns when the</i> <span class="sans_thesansmonocd_w5regular_italic_i_">endlocal</span> <i class="calibre6">executes.</i></p>
<p class="tx">Defining scope with the <span class="sans_thesansmonocd_w5regular_">setlocal</span> and <span class="sans_thesansmonocd_w5regular_">endlocal</span> commands has just one use, but it’s an important one: to hide or section off variables in a portion of code to prevent conflicts. By default, Batch variables are global; a variable set in one bat file can be resolved or reset in a called bat file and even in a called internal routine. By default, many other languages use the opposite methodology, limiting the scope of variables used inside called programs and routines. Sometimes global variables are perfectly fine, but in other instances, limiting the scope is the better option. The ability to define scope gives you the power to use what’s best for your application.</p>
<p class="tx">If you’re coding a utility bat file that’ll be called by many other processes, you may have no idea what variables the calling process is using. Placing a <span class="sans_thesansmonocd_w5regular_">setlocal</span> at the top of your bat file and an <span class="sans_thesansmonocd_w5regular_">endlocal</span> at or near the end defines and limits scope. The upshot is that if you happened to use a variable name in common with the calling bat file, you won’t step on its variable, which allows the caller to invoke your bat file with the assurance that there’ll be no ill side effects. The same is often done with called internal routines. (In <span class="xref"><a href="chapter10.xhtml" class="calibre3">Chapter 10</a></span>, we’ll look at calling internal routines and other bat files.)</p>
<p class="tx">Defining scope raises an interesting question. If a utility bat file is called to perform a specific task, there’s a good chance that at least part of that task is to set and return a certain variable. There’s a means for allowing a variable or variables to survive an <span class="sans_thesansmonocd_w5regular_">endlocal</span> command, and I’ll share that in <span class="xref"><a href="chapter16.xhtml" class="calibre3">Chapter 16</a></span>.</p>
</section>
<section aria-labelledby="sec2" epub:type="division">
<h3 class="h" id="sec2"><span id="h1-26"/><span class="sans_futura_std_bold_b_">Delayed Expansion</span></h3>
<p class="tni">The <span class="sans_thesansmonocd_w5regular_">setlocal</span> command is a multipronged tool. In addition to defining scope, it also enables delayed expansion when used with a very descriptive argument:</p>
<pre class="pre"><code class="calibre11">setlocal EnableDelayedExpansion</code></pre>
<p class="tni">Fittingly, the argument is spelled out without any semblance of abbreviation.</p>
<p class="tx"><span aria-label=" Page 28. " epub:type="pagebreak" id="pg_28" role="doc-pagebreak"/>Delayed expansion implements two rounds of variable resolution: the initial resolution and a delayed resolution or expansion. When the interpreter executes a bat file, it processes each line of code one by one, first reading in or parsing a line and then executing that line. The initial resolution happens as the interpreter parses the line, and the delayed expansion happens as it executes the line.</p>
<p class="tx">This feature allows for some interesting behavior that isn’t available in most languages. For instance, you can treat the value of a variable as a variable itself—or its value can be treated as a portion of another variable name. In <a href="#Lis3-1" class="calibre3">Listing 3-1</a>, <span class="sans_thesansmonocd_w5regular_">Toyota</span> is a variable name as well as a value; that’s not a coincidence.</p>
<span id="Lis3-1"/>
<pre class="pre"><code class="calibre11">setlocal EnableDelayedExpansion
set Car=Toyota
set Toyota=Prius
</code></pre>
<p class="listingcaption"><span class="futura_std_book_oblique_i_">Listing 3-1: Setting Car and Toyota with delayed expansion enabled</span></p>
<p class="tx">First, we need the <span class="sans_thesansmonocd_w5regular_">setlocal</span> command with the argument to enable delayed expansion. Next, we set <span class="sans_thesansmonocd_w5regular_">Car</span> to the make of a car, which is a <span class="sans_thesansmonocd_w5regular_">Toyota</span> in this case. But Toyota produces several models, and if we want to capture a particular model, we can set the variable defined as <span class="sans_thesansmonocd_w5regular_">Toyota</span> to the value <span class="sans_thesansmonocd_w5regular_">Prius</span>.</p>
<section aria-labelledby="sec3" epub:type="division">
<h4 class="h1" id="sec3"><span id="h2-8"/><span class="sans_futura_std_heavy_oblique_bi_">Values and Variables</span></h4>
<p class="tni">As I mentioned previously, <span class="sans_thesansmonocd_w5regular_">Toyota</span> is both a value and a variable. It’s the value of the <span class="sans_thesansmonocd_w5regular_">Car</span> variable and also a variable containing the <span class="sans_thesansmonocd_w5regular_">Prius</span> value. Now we can execute three statements to write three variables to the console, as shown in <a href="#Lis3-2" class="calibre3">Listing 3-2</a>.</p>
<span id="Lis3-2"/>
<pre class="pre"><code class="calibre11">&gt; con echo                 Car = %Car%
&gt; con echo           Car Again = !Car!
&gt; con echo   Delayed Expansion = !%Car%!
</code></pre>
<p class="listingcaption"><span class="futura_std_book_oblique_i_">Listing 3-2: Resolving Car by three different means</span></p>
<p class="tx">Here’s the output <a href="#Lis3-2" class="calibre3">Listing 3-2</a> generates:</p>
<pre class="pre"><code class="calibre11">                Car = Toyota
          Car Again = Toyota
  Delayed Expansion = Prius
</code></pre>
<p class="tx">The first resolution of <span class="sans_thesansmonocd_w5regular_">Car</span> is quite pedestrian by now. Surrounding the variable with percent signs (<span class="sans_thesansmonocd_w5regular_">%</span>) resolves it to its value of <span class="sans_thesansmonocd_w5regular_">Toyota</span>. The second command introduces something new: exclamation marks (<span class="sans_thesansmonocd_w5regular_">!</span>) are used as delimiters to resolve a variable, <span class="sans_thesansmonocd_w5regular_">!Car!</span>, instead of percent signs. The variable surrounded with exclamation marks also resolves to <span class="sans_thesansmonocd_w5regular_">Toyota</span>, but why have two different characters that perform the same function? The answer will present itself after we examine the final command.</p>
<p class="tx"><span aria-label=" Page 29. " epub:type="pagebreak" id="pg_29" role="doc-pagebreak"/>The third resolution truly shows the power of delayed expansion. The variable is surrounded by percent signs, and that’s surrounded by exclamation marks. The interpreter first resolves <span class="sans_thesansmonocd_w5regular_">%Car%</span> to be <span class="sans_thesansmonocd_w5regular_">Toyota</span>. Make sure that you are seated for this next part: that value is now surrounded by exclamation marks, which causes it to be resolved yet again, so <span class="sans_thesansmonocd_w5regular_">!Toyota!</span> becomes <span class="sans_thesansmonocd_w5regular_">Prius</span>. Putting it all together, the variable is resolved like so:</p>
<p class="tx"><span class="sans_thesansmonocd_w5regular_">!%Car%!</span> <span class="copyright_accent">→</span> <span class="sans_thesansmonocd_w5regular_">!Toyota!</span> <span class="copyright_accent">→</span> <span class="sans_thesansmonocd_w5regular_">Prius</span></p>
<p class="tx">To answer the question about two different characters performing the same function, the interpreter needs both to perform this resolution since we now have two rounds of it: percent signs do the inner resolution, and exclamation marks do the outer resolution. (Can’t we just encase the variable with two sets of double percent signs? No, the syntax for the <span class="sans_thesansmonocd_w5regular_">for</span> command has a specific purpose for the double percent signs, which you’ll learn about in <span class="xref"><a href="chapter17.xhtml" class="calibre3">Chapter 17</a></span>.)</p>
<p class="tx">The best way to demonstrate exactly how delayed expansion affects the code is to run the same code without it enabled. If we remove the <span class="sans_thesansmonocd_w5regular_">setlocal</span> from <a href="#Lis3-1" class="calibre3">Listing 3-1</a>, the results of <a href="#Lis3-2" class="calibre3">Listing 3-2</a> are:</p>
<pre class="pre"><code class="calibre11">                Car = Toyota
          Car Again = !Car!
  Delayed Expansion = !Toyota!
</code></pre>
<p class="tx">Without delayed expansion, the exclamation marks are treated as simple text and are of no significance to Batch. The <span class="sans_thesansmonocd_w5regular_">!Car!</span> variable isn’t resolved at all; the interpreter doesn’t even consider those three letters to be a variable. The <span class="sans_thesansmonocd_w5regular_">!%Car%!</span> variable experiences one round of variable resolution, but again, the exclamation marks are simply along for the ride.</p>
<p class="tx">In <span class="xref"><a href="chapter2.xhtml" class="calibre3">Chapter 2</a></span>, I adeptly sidestepped an issue by mentioning that a variable name shouldn’t start with a number. Technically, you can set such a variable, but you won’t be able to resolve it with percent signs; you can do it only with exclamation marks and with delayed expansion enabled. The best way to deal with this little oddity is never to start variable names with numbers.</p>
<p class="tx">Now we have a variable that can be resolved to a value that’s resolved a second time to be yet another value. That’s not typically easily done, or even done at all, in those fancy modern compiled languages. To be honest, as cool as an entire word being both a variable and a value may be, it’s not used often in the real world, but partial variable names have many applications.</p>
</section>
<section aria-labelledby="sec4" epub:type="division">
<h4 class="h1" id="sec4"><span id="h2-9"/><span class="sans_futura_std_heavy_oblique_bi_">Partial Variable Names</span></h4>
<p class="tni">This technique becomes even more interesting and useful when the resolved value is used as just a portion of a variable name. To demonstrate, consider these <span class="sans_thesansmonocd_w5regular_">set</span> commands defining the signature culinary masterpieces of five cities:</p>
<pre class="pre"><code class="calibre11">set foodNash=Hot Chicken
set foodNYC=Thin Crust Pizza
set foodChic=Deep Dish Pizza
<span aria-label=" Page 30. " epub:type="pagebreak" id="pg_30" role="doc-pagebreak"/>set foodNO=Muffuletta Sandwich
set foodSTL=Frozen Custard
</code></pre>
<p class="tni">Each variable name, which is the concatenation of <span class="sans_thesansmonocd_w5regular_">food</span> and a common abbreviation for a city, is set to the dish for which that city is famous. Only five variables are shown, but you could define any number.</p>
<p class="tx">The following set of variables has the same abbreviations for the five cities, where each is appended with <span class="sans_thesansmonocd_w5regular_">Full</span> and assigned the full name of the city:</p>
<pre class="pre"><code class="calibre11">set NashFull=Nashville
set NYCFull=New York City
set ChicFull=Chicago
set NOFull=New Orleans
set STLFull=St Louis
</code></pre>
<p class="tx">Now consider this <span class="sans_thesansmonocd_w5regular_">echo</span> command with two examples of delayed expansion:</p>
<pre class="pre"><code class="calibre11">&gt; con echo The best !food%city%! can be found only in !%city%Full!.</code></pre>
<p class="tx">If <span class="sans_thesansmonocd_w5regular_">city</span> is set to <span class="sans_thesansmonocd_w5regular_">NO</span> and delayed expansion is enabled, this command writes the following to the console:</p>
<pre class="pre"><code class="calibre11">The best Muffuletta Sandwich can be found only in New Orleans.</code></pre>
<p class="tx">To understand how this worked, let’s first take a look at the <span class="sans_thesansmonocd_w5regular_">!food%city%!</span> variable. The inner variable, <span class="sans_thesansmonocd_w5regular_">city</span>, and its encasing percent signs is resolved to <span class="sans_thesansmonocd_w5regular_">NO</span>, revealing the <span class="sans_thesansmonocd_w5regular_">foodNO</span> variable. Next the exclamation mark delimiters resolve it to the most delicious sandwich ever created; no, it’s not a glorified ham and cheese sandwich. To summarize:</p>
<p class="tx"><span class="sans_thesansmonocd_w5regular_">!food%city%!</span> <span class="copyright_accent">→</span> <span class="sans_thesansmonocd_w5regular_">!foodNO!</span> <span class="copyright_accent">→</span> <span class="sans_thesansmonocd_w5regular_">Muffuletta Sandwich</span></p>
<p class="tx">Similarly, the full name of the city is also resolved in two steps. The only difference here is that the hardcoded portion of the variable name comes after the portion to be resolved:</p>
<p class="tx"><span class="sans_thesansmonocd_w5regular_">!%city%Full!</span> <span class="copyright_accent">→</span> <span class="sans_thesansmonocd_w5regular_">!NOFull!</span> <span class="copyright_accent">→</span> <span class="sans_thesansmonocd_w5regular_">New Orleans</span></p>
<p class="tx">The <span class="sans_thesansmonocd_w5regular_">echo</span> command behaves differently for different values of <span class="sans_thesansmonocd_w5regular_">city</span>, which is important to note. It writes the following four sentences to the console when the variable is set to <span class="sans_thesansmonocd_w5regular_">NYC</span>, <span class="sans_thesansmonocd_w5regular_">Nash</span>, <span class="sans_thesansmonocd_w5regular_">Chic</span>, and <span class="sans_thesansmonocd_w5regular_">STL</span>, respectively:</p>
<pre class="pre"><code class="calibre11">The best Thin Crust Pizza can be found only in New York City.
The best Hot Chicken can be found only in Nashville.
The best Deep Dish Pizza can be found only in Chicago.
The best Frozen Custard can be found only in St Louis.
</code></pre>
<p class="tx">I opened this section by suggesting that having a resolved value as just a portion of a variable name is more useful. This example is pedagogical, but you can easily extend the technique to something more practical. In the <span aria-label=" Page 31. " epub:type="pagebreak" id="pg_31" role="doc-pagebreak"/>professional realm, instead of the realm of city-centric cuisines, you could create a set of variables to define the paths for the transmission of files to different facilities based on their location, say <span class="sans_thesansmonocd_w5regular_">pathNYC</span>, <span class="sans_thesansmonocd_w5regular_">pathNash</span>, and <span class="sans_thesansmonocd_w5regular_">pathSTL</span>. Then a single command to copy a file can use the same delayed expansion technique to transmit the file to one of many destinations. (I’ll use this technique again in <span class="xref"><a href="chapter5.xhtml" class="calibre3">Chapter 5</a></span> when discussing substringing.)</p>
<p class="tx">Creative coders can make a seemingly unlimited use of delayed expansion, and we’ll get into some of those uses when we explore arrays and hash tables in <span class="xref"><a href="chapter29.xhtml" class="calibre3">Chapter 29</a></span>. The <span class="sans_thesansmonocd_w5regular_">for</span> command in <span class="xref"><a href="part2.xhtml" class="calibre3">Part II</a></span> will rely greatly on delayed expansion, and possibly its most interesting application will come in <span class="xref"><a href="chapter16.xhtml" class="calibre3">Chapter 16</a></span> where a variable will be able to hold two values simultaneously.</p>
</section>
</section>
<section aria-labelledby="sec5" epub:type="division">
<h3 class="h" id="sec5"><span id="h1-27"/><span class="sans_futura_std_bold_b_">Command Extensions</span></h3>
<p class="tni">The <span class="sans_thesansmonocd_w5regular_">setlocal</span> command also accepts an argument that turns on command extensions. Unlike delayed expansion, command extensions should be active by default, but you can turn them on explicitly with the following command:</p>
<pre class="pre"><code class="calibre11">setlocal EnableExtensions</code></pre>
<p class="tx">Enabling command extensions unlocks a great deal of additional functionality and available options for several Batch commands. For instance, the <span class="sans_thesansmonocd_w5regular_">for</span> command is indispensable for any Batch coder. We haven’t discussed it yet, but Batch has one variant of the <span class="sans_thesansmonocd_w5regular_">for</span> command when command extensions are disabled. With command extensions enabled, however, it becomes a turbocharged workhorse with at least 10 forms. Even the <span class="sans_thesansmonocd_w5regular_">set</span> command discussed in <span class="xref"><a href="chapter2.xhtml" class="calibre3">Chapter 2</a></span> (not often considered a dynamic or interesting command) has additional functionality and available options with this setting. The specific features vary from command to command, and you can retrieve their details at the command prompt via the <span class="sans_thesansmonocd_w5regular_">help</span> command (also covered in <span class="xref"><a href="chapter2.xhtml" class="calibre3">Chapter 2</a></span>).</p>
<p class="tx">To demonstrate the additional functionality unlocked for just one command by enabling command extensions, return to the command prompt and enter the same command from the prior chapter to retrieve documentation on the <span class="sans_thesansmonocd_w5regular_">set</span> command:</p>
<pre class="pre"><code class="calibre11"><b class="calibre10">help set</b></code></pre>
<p class="tx">After a short few lines of text detailing what the command does when command extensions aren’t enabled, the interpreter displays the following line:</p>
<pre class="pre"><code class="calibre11">If Command Extensions are enabled SET changes as follows:</code></pre>
<p class="tni"><span aria-label=" Page 32. " epub:type="pagebreak" id="pg_32" role="doc-pagebreak"/>What follows is all of the expanded functionality that has been unlocked. There’s far too much information to show it all, but in this small sample two previously unavailable options are shared:</p>
<pre class="pre"><code class="calibre11">Two new switches have been added to the SET command:

    SET /A expression
    SET /P variable=[promptString]
</code></pre>
<p class="tx">I mentioned these options in <span class="xref"><a href="chapter2.xhtml" class="calibre3">Chapter 2</a></span>, but I didn’t mention that command extensions turn them on. The <span class="sans_thesansmonocd_w5regular_">help</span> command gives you several times the amount of information about the <span class="sans_thesansmonocd_w5regular_">set</span> command’s functionality with command extensions enabled than it does when disabled, and the same is true for many other commands. As I introduce more commands, I encourage you to investigate them further with the <span class="sans_thesansmonocd_w5regular_">help</span> command to see a larger list of uses and options and to see what’s turned on with command extensions.</p>
</section>
<section aria-labelledby="sec6" epub:type="division">
<h3 class="h" id="sec6"><span id="h1-28"/><span class="sans_futura_std_bold_b_">Final Thoughts on setlocal and endlocal</span></h3>
<p class="tni">After two decades of coding bat files, I have some strong opinions on the use of the <span class="sans_thesansmonocd_w5regular_">setlocal</span> and <span class="sans_thesansmonocd_w5regular_">endlocal</span> commands, and I’m not shy about sharing them. Every high-level bat file that I write has this command at or near the very first line of code:</p>
<pre class="pre"><code class="calibre11">setlocal EnableExtensions EnableDelayedExpansion</code></pre>
<p class="tx">I’m defining a high-level bat file as a bat file that isn’t called from another bat file. I’ve rarely come across an instance where I didn’t want command extensions and delayed expansion enabled. There’s virtually no cost for all the extra features. It’s as if you could turn your Toyota into a Lamborghini with none of the disadvantages such as cost and gas mileage. But in that rare instance, you can disable these features with the <span class="sans_thesansmonocd_w5regular_">DisableExtensions</span> and <span class="sans_thesansmonocd_w5regular_">DisableDelayedExpansion</span> arguments.</p>
<p class="tx">Additionally, whenever I code some logic that might adversely affect other code, I precede that logic with a simple <span class="sans_thesansmonocd_w5regular_">setlocal</span> command with no arguments and terminate it with a corresponding <span class="sans_thesansmonocd_w5regular_">endlocal</span> command. Don’t fret; delayed expansion is still enabled from the original <span class="sans_thesansmonocd_w5regular_">setlocal</span> command. You can even nest multiple <span class="sans_thesansmonocd_w5regular_">setlocal</span> and <span class="sans_thesansmonocd_w5regular_">endlocal</span> commands, creating subsections of code with a defined scope within subsections, but not more than 32 levels deep. I have never come close to this limitation, but if you do, you can nest further in a called routine or another bat file. (I’ll get to how those calls are performed in <span class="xref"><a href="chapter10.xhtml" class="calibre3">Chapter 10</a></span>.)</p>
<p class="tx">For the sake of completeness, it’s good form for that original <span class="sans_thesansmonocd_w5regular_">setlocal</span> to have a corresponding <span class="sans_thesansmonocd_w5regular_">endlocal</span> at the end of the bat file, but if omitted, the interpreter executes an implied <span class="sans_thesansmonocd_w5regular_">endlocal</span> before exiting the high-level bat file.</p>
<p class="tx"><span aria-label=" Page 33. " epub:type="pagebreak" id="pg_33" role="doc-pagebreak"/>Crucially, this book is written with the assumption that command extensions and delayed expansion are enabled. In general, I won’t bore you with what functionality is unlocked with these settings and what isn’t. If an example from this book isn’t working in your testing, make sure that you’ve run this command with both of its enabling arguments.</p>
<blockquote class="calibre8">
<p class="warning"><span class="sans_dogma_ot_bold_b_1">NOTE</span></p>
</blockquote>
<p class="warning-txt"><i class="calibre6">I have just one exception to the rule about starting all high-level bat files with the particular setlocal command mentioned previously, and it’s in this book. In later chapters I’ll provide some examples of very short bat files, maybe just two or three lines. These simple examples might not require this command, and its use might pull the focus away from the topic at hand. In those instances, I won’t include the command, but understand that it could and should be there.</i></p>
</section>
<section aria-labelledby="sec7" epub:type="division">
<h3 class="h" id="sec7"><span id="h1-29"/><span class="sans_futura_std_bold_b_">Summary</span></h3>
<p class="tni">The main focus of this chapter was the <span class="sans_thesansmonocd_w5regular_">setlocal</span> command, which defines scope and enables command extensions. Most important, it enables delayed expansion, opening vast possibilities for defining and using variables.</p>
<p class="tx">With delayed expansion enabled, you saw how you can write out one of five sentences based on the value of a variable defining a city with just a single command. But if delayed expansion had been disabled, you may have resorted to interrogating that variable with five <span class="sans_thesansmonocd_w5regular_">if</span> commands. In the example laid out in this chapter, that would’ve been an inelegant solution, but in general, the <span class="sans_thesansmonocd_w5regular_">if</span> command is an important workhorse in any language, and Batch is no different. In the next chapter, I’ll discuss it in detail—and since this is Batch—its idiosyncrasies.</p>
</section>
</section>
</div></body></html>