<html><head></head><body>
<h2 class="h2"><a id="ch04"/><span epub:type="pagebreak" id="page_53"/><strong><span class="big">4</span></strong><br/><strong>WORKING WITH CAPTURED PACKETS</strong></h2>&#13;
<div class="image"><img alt="image" src="../images/common.jpg"/></div>&#13;
<p class="noindent"><span class="big1">Now that you’ve been introduced to Wireshark, you’re ready to start capturing and analyzing packets. In this chapter, you’ll learn how to work with capture files, packets, and time-display formats. We’ll also cover more advanced options for capturing packets and dive into the world of filters.</span></p>&#13;
<h3 class="h3"><a id="ch04lev1sec1"/><strong>Working with Capture Files</strong></h3>&#13;
<p class="noindent">You’ll find that a good portion of your packet analysis will happen after your capture. Usually, you’ll perform several captures at various times, save them, and analyze them all at once. Therefore, Wireshark allows you to save your capture files to be analyzed later. You can also merge multiple capture files.</p>&#13;
<h4 class="h4"><a id="ch04lev2sec1"/><span epub:type="pagebreak" id="page_54"/><strong><em>Saving and Exporting Capture Files</em></strong></h4>&#13;
<p class="noindent">To save a packet capture, select <strong>File</strong> ▶ <strong>Save As</strong>. You should see the Save file as dialog, as shown in <a href="ch04.xhtml#ch04fig1">Figure 4-1</a>. You’ll be asked for a location to save your packet capture and for the file format you wish to use. If you don’t specify a file format, Wireshark will use the default <em>.pcapng</em> file format.</p>&#13;
<div class="image"><img alt="image" src="../images/f54-01.jpg"/></div>&#13;
<p class="figcap"><a id="ch04fig1"/><em>Figure 4-1: The Save file as dialog allows you to save your packet captures.</em></p>&#13;
<p class="indent">In many cases, you may only want to save a subset of the packets in your capture. To do so, select <strong>File</strong> ▶ <strong>Export Specified Packets</strong>. The dialog that appears is shown in <a href="ch04.xhtml#ch04fig2">Figure 4-2</a>. This is a great way to thin bloated packet-capture files. You can choose to save only packets in a specific number range, marked packets, or packets visible as the result of a display filter (marked packets and filters are discussed later in this chapter).</p>&#13;
<p class="indent">You can export your Wireshark capture data into several formats for viewing in other media or for importing into other packet analysis tools. Formats include plaintext, PostScript, comma-separated values (CSV), and XML. To export your packet capture in one of these formats, choose <strong>File</strong> ▶ <strong>Export Packet Dissections</strong> and then select the format for the exported file. You’ll see a Save As dialog containing options related to the format you’ve chosen.</p>&#13;
<div class="image"><span epub:type="pagebreak" id="page_55"/><img alt="image" src="../images/f55-01.jpg"/></div>&#13;
<p class="figcap"><a id="ch04fig2"/><em>Figure 4-2: The Export Specified Packets dialog allows you to have more granular control over the packets you choose to save.</em></p>&#13;
<h4 class="h4"><a id="ch04lev2sec2"/><strong><em>Merging Capture Files</em></strong></h4>&#13;
<p class="noindent">Certain types of analysis require the ability to merge multiple capture files. This is a common practice when comparing two data streams or combining streams of the same traffic that were captured separately.</p>&#13;
<p class="indent">To merge capture files, open one of the files you want to merge and choose <strong>File</strong> ▶ <strong>Merge</strong> to bring up the Merge with capture file dialog, shown in <a href="ch04.xhtml#ch04fig3">Figure 4-3</a>. Select the new file you wish to merge into the already open file and then select the method to use for merging the files. You can prepend the selected file to the currently open one, append it, or merge the files chronologically based on their timestamps.</p>&#13;
<div class="image"><span epub:type="pagebreak" id="page_56"/><img alt="image" src="../images/f56-01.jpg"/></div>&#13;
<p class="figcap"><a id="ch04fig3"/><em>Figure 4-3: The Merge with capture file dialog allows you to merge two capture files.</em></p>&#13;
<h3 class="h3"><a id="ch04lev1sec2"/><strong>Working with Packets</strong></h3>&#13;
<p class="noindent">You will eventually encounter a situation involving a very large number of packets. As the number of packets grows into the thousands and even millions, you will need to navigate through packets more efficiently. For this purpose, Wireshark allows you to find and mark packets that match certain criteria. You can also print packets for easy reference.</p>&#13;
<h4 class="h4"><a id="ch04lev2sec3"/><strong><em>Finding Packets</em></strong></h4>&#13;
<p class="noindent">To find packets that match particular criteria, open the Find Packet bar, shown circled in <a href="ch04.xhtml#ch04fig4">Figure 4-4</a>, by pressing <small>CTRL</small>-F. This bar should appear between the Filter bar and the Packet List pane.</p>&#13;
<div class="image"><img alt="image" src="../images/f56-02.jpg"/></div>&#13;
<p class="figcap"><a id="ch04fig4"/><em>Figure 4-4: Finding packets in Wireshark based on specified criteria—in this case, packets matching the display filter expression</em> <span class="codeitalic">tcp</span></p>&#13;
<p class="indenta"><span epub:type="pagebreak" id="page_57"/>This pane offers three options for finding packets:</p>&#13;
<p class="bullet">•     The Display filter option allows you to enter an expression-based filter that will find only those packets that satisfy that expression. This option is used in <a href="ch04.xhtml#ch04fig4">Figure 4-4</a>.</p>&#13;
<p class="bullet">•     The Hex value option searches for packets with a hexadecimal value you specify.</p>&#13;
<p class="bulleta">•     The String option searches for packets with a text string you specify. You can specify the pane the search is performed in or make the search string case sensitive.</p>&#13;
<p class="indent"><a href="ch04.xhtml#ch04tab1">Table 4-1</a> shows examples of these search types.</p>&#13;
<p class="tablecap"><a id="ch04tab1"/><strong>Table 4-1:</strong> Search Types for Finding Packets</p>&#13;
<table class="all">&#13;
<thead>&#13;
<tr>&#13;
<td class="table_th" style="vertical-align: top;"><p class="table"><strong>Search type</strong></p></td>&#13;
<td class="table_th" style="vertical-align: top;"><p class="table"><strong>Examples</strong></p></td>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td class="table_1" style="vertical-align: top;"><p class="table">Display filter</p></td>&#13;
<td class="table_1" style="vertical-align: top;"><p class="table"><code>not ip<br/>ip.addr==192.168.0.1<br/>arp</code></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1" style="vertical-align: top;"><p class="table">Hex value</p></td>&#13;
<td class="table_1" style="vertical-align: top;"><p class="table"><code>00ff<br/>ffff<br/>00ABB1f0</code></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1b" style="vertical-align: top;"><p class="table">String</p></td>&#13;
<td class="table_1b" style="vertical-align: top;"><p class="table"><code>Workstation1<br/>UserB<br/>domain</code></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<p class="indent">Once you’ve decided which search type you will use, enter your search criteria in the text box and click <strong>Find</strong> to find the first packet that meets your criterion. To find the next matching packet, click <strong>Find</strong> again or press <small>CTRL</small>-N; find the previous matching packet by pressing <small>CTRL</small>-B.</p>&#13;
<h4 class="h4"><a id="ch04lev2sec4"/><strong><em>Marking Packets</em></strong></h4>&#13;
<p class="noindent">After you have found packets that match your criterion, you can mark those of particular interest. For example, marking packets will let you save only these packets. Also, you can find your marked packets quickly by their black background and white text, as shown in <a href="ch04.xhtml#ch04fig5">Figure 4-5</a>.</p>&#13;
<div class="image"><img alt="image" src="../images/f57-01.jpg"/></div>&#13;
<p class="figcap"><a id="ch04fig5"/><em>Figure 4-5: A marked packet is highlighted on your screen. In this example, the second packet is marked and appears darker.</em></p>&#13;
<p class="indent">To mark a packet, either right-click it in the Packet List pane and choose <strong>Mark Packet</strong> from the pop-up or click a packet in the Packet List pane and press <small>CTRL</small>-M. To unmark a packet, toggle this setting off by pressing <small>CTRL</small>-M again. You can mark as many packets as you wish in a capture. To jump forward and backward between marked packets, press <small>SHIFT-CTRL</small>-N and <small>SHIFT-CTRL</small>-B, respectively.</p>&#13;
<h4 class="h4"><a id="ch04lev2sec5"/><span epub:type="pagebreak" id="page_58"/><strong><em>Printing Packets</em></strong></h4>&#13;
<p class="noindent">Although most analysis will take place on the computer screen, you may need to print captured data. I occasionally print out packets and tape them to my desk so I can quickly reference their contents while doing other analysis. Being able to print packets to a PDF file is also very convenient, especially when preparing reports.</p>&#13;
<p class="indent">To print captured packets, open the Print dialog by choosing <strong>File</strong> ▶ <strong>Print</strong> from the main menu, as shown in <a href="ch04.xhtml#ch04fig6">Figure 4-6</a>.</p>&#13;
<div class="image"><img alt="image" src="../images/f58-01.jpg"/></div>&#13;
<p class="figcap"><a id="ch04fig6"/><em>Figure 4-6: The Print dialog allows you to print the packets you specify.</em></p>&#13;
<p class="indent">As with the Export Specified Packets dialog, you can print a specific packet range, marked packets only, or packets displayed as the result of a filter. You can also select the level of detail you wish to print for each packet. Once you have selected the options, click <strong>Print</strong>.</p>&#13;
<h3 class="h3"><a id="ch04lev1sec3"/><strong>Setting Time Display Formats and References</strong></h3>&#13;
<p class="noindent">Time is of the essence—especially in packet analysis. Everything that happens on a network is time sensitive, and you will need to examine trends and network latency in capture files frequently. Wireshark supplies several configurable options related to time. In this section, we’ll look at time display formats and references.</p>&#13;
<h4 class="h4"><a id="ch04lev2sec6"/><span epub:type="pagebreak" id="page_59"/><strong><em>Time Display Formats</em></strong></h4>&#13;
<p class="noindent">Each packet that Wireshark captures is given a timestamp, which is applied to the packet by the operating system. Wireshark can show the absolute timestamp, which indicates the exact moment when the packet was captured, as well as the time in relation to the last captured packet and the beginning and end of the capture.</p>&#13;
<p class="indent">Options related to time display are found under the View heading on the main menu. The Time Display Format section, shown in <a href="ch04.xhtml#ch04fig7">Figure 4-7</a>, lets you configure the presentation format as well as the precision of the time display.</p>&#13;
<div class="image"><img alt="image" src="../images/f59-01.jpg"/></div>&#13;
<p class="figcap"><a id="ch04fig7"/><em>Figure 4-7: Several time display formats are available.</em></p>&#13;
<p class="indent">The presentation format options let you choose various settings for time display. These include date and time of day, UTC date and time of day, seconds since epoch, seconds since beginning of capture (the default setting), seconds since previous captured packet, and more.</p>&#13;
<p class="indent">The precision options allow you to set the time display precision to an automatic setting, which takes the format from the capture file, or to a manual setting, such as seconds, milliseconds, microseconds, and so on. We will be changing these options later in the book, so you should familiarize yourself with them now.</p>&#13;
<div class="note">&#13;
<p class="notet"><span epub:type="pagebreak" id="page_60"/><span class="box"><strong>NOTE</strong></span></p>&#13;
<p class="notep"><em>When comparing packet data from multiple devices, be sure that the devices are synchronized with the same time source, especially if you are performing forensic analysis or troubleshooting. You can use the Network Time Protocol (NTP) to ensure network devices are synced. When examining packets from devices spanning more than one time zone, consider analyzing packets in UTC instead of local time to avoid confusion when reporting your findings.</em></p>&#13;
</div>&#13;
<h4 class="h4"><a id="ch04lev2sec7"/><strong><em>Packet Time Referencing</em></strong></h4>&#13;
<p class="noindent">Packet time referencing allows you to configure a certain packet so that all subsequent time calculations are done in relation to that packet. This feature is particularly handy when you are examining a series of sequential events that are triggered at some point other than the start of the capture file.</p>&#13;
<p class="indent">To set a time reference to a packet, right-click the reference packet in the Packet List pane and choose <strong>Set/Unset Time Reference</strong>. To toggle this reference off, repeat the same action. You can also toggle a packet as a time reference on and off by selecting the packet you wish to reference in the Packet List pane and pressing <small>CTRL</small>-T.</p>&#13;
<p class="indent">When you enable a time reference on a packet, the Time column in the Packet List pane will display <code>*REF*</code>, as shown in <a href="ch04.xhtml#ch04fig8">Figure 4-8</a>.</p>&#13;
<div class="image"><img alt="image" src="../images/f60-01.jpg"/></div>&#13;
<p class="figcap"><a id="ch04fig8"/><em>Figure 4-8: Packet 4 with the packet time reference toggle enabled</em></p>&#13;
<p class="indent">Setting a packet time reference is useful only when the time display format of a capture is set to display the time in relation to the beginning of the capture. Any other setting will produce no usable results and indeed will generate a set of times that can be very confusing.</p>&#13;
<h4 class="h4"><a id="ch04lev2sec8"/><strong><em>Time Shifting</em></strong></h4>&#13;
<p class="noindent">In some cases, you might encounter packets from multiple sources that are not synchronized to the same time source. This is especially common when examining capture files taken from two locations that contain the same stream of data. While most administrators desire a state in which every device on their network is synced, it’s not uncommon for there to be a few seconds of time skew between certain types of devices. Wireshark provides the ability to shift the timestamp on packets to alleviate this problem during your analysis.</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_61"/>To shift the timestamp on one or more packets, select <strong>Edit</strong> ▶ <strong>Time Shift</strong> or press <small>CTRL-SHIFT</small>-T. On the Time Shift screen that opens, you can specify a time range to shift the entire capture file by, or you can specify a time to set individual packets to. In the example shown in <a href="ch04.xhtml#ch04fig9">Figure 4-9</a>, I’ve chosen to shift the timestamp of every packet in the capture by adding two minutes and five seconds to each packet.</p>&#13;
<div class="image"><img alt="image" src="../images/f61-01.jpg"/></div>&#13;
<p class="figcap"><a id="ch04fig9"/><em>Figure 4-9: The Time Shift dialog</em></p>&#13;
<h3 class="h3"><a id="ch04lev1sec4"/><strong>Setting Capture Options</strong></h3>&#13;
<p class="noindent">We looked at the Capture Interfaces dialog while walking through a very basic packet capture in the last chapter. Wireshark offers quite a few additional capture options that we didn’t address then. To access these options, choose <strong>Capture</strong> ▶ <strong>Options</strong>.</p>&#13;
<p class="indent">The Capture Interfaces dialog has a lot of bells and whistles, all designed to give you more flexibility while capturing packets. It’s divided into three tabs: Input, Output, and Options. We’ll examine each separately.</p>&#13;
<h4 class="h4"><a id="ch04lev2sec9"/><strong><em>Input Tab</em></strong></h4>&#13;
<p class="noindent">The main purpose of the Input tab (<a href="ch04.xhtml#ch04fig10">Figure 4-10</a>) is to display all the interfaces available for capturing packets and some basic information for each interface. This includes the friendly name of the interface provided by the operating system, a traffic graph showing the throughput on the interface, and additional configuration options such as promiscuous mode status and buffer size. At the far right (not pictured), there is also a column for the applied capture filter, which we’ll talk about in “Capture Filters” on <a href="ch04.xhtml#page_65">page 65</a>.</p>&#13;
<p class="indent">In this section, you can click most of these options and edit them inline. For example, if you want to disable promiscuous mode on an interface, you can click that field and change it from enabled to disabled via the provided drop-down menu.</p>&#13;
<div class="image"><span epub:type="pagebreak" id="page_62"/><img alt="image" src="../images/f62-01.jpg"/></div>&#13;
<p class="figcap"><a id="ch04fig10"/><em>Figure 4-10: The Capture Interfaces Input options tab</em></p>&#13;
<h4 class="h4"><a id="ch04lev2sec10"/><strong><em>Output Tab</em></strong></h4>&#13;
<p class="noindent">The Output tab (<a href="ch04.xhtml#ch04fig11">Figure 4-11</a>) allows you to automatically store captured packets in a file, rather than capturing them first and then saving the file. Doing so offers you more flexibility in managing how packets are saved. You can choose to save them as a single file or a file set or even use a ring buffer (which we’ll cover in a moment) to manage the number of files created. To enable this option, enter a complete file path and name in the File text box. Alternatively, use the Browse... button to select a directory and provide a filename.</p>&#13;
<div class="image"><img alt="image" src="../images/f62-02.jpg"/></div>&#13;
<p class="figcap"><a id="ch04fig11"/><em>Figure 4-11: The Capture Interfaces Output options tab</em></p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_63"/>When you are capturing a large amount of traffic or performing long-term captures, file sets can prove particularly useful. A <em>file set</em> is a grouping of multiple files separated by a particular condition. To save to a file set, check the <strong>Create a new file automatically after...</strong> option.</p>&#13;
<p class="indent">Wireshark uses various triggers to manage saving to file sets based upon a file size or time condition. To enable one of these triggers, select the radio button next to the size- or time-based option and then specify the value and unit on which to trigger. For instance, you can set a trigger that creates a new file after every 1MB of traffic captured or, as shown in <a href="ch04.xhtml#ch04fig12">Figure 4-12</a>, after every minute of traffic captured.</p>&#13;
<div class="image"><img alt="image" src="../images/f63-01.jpg"/></div>&#13;
<p class="figcap"><a id="ch04fig12"/><em>Figure 4-12: A file set created by Wireshark at one-minute intervals</em></p>&#13;
<p class="indent">The Use a ring buffer option lets you specify a certain number of files your file set will hold before Wireshark begins to overwrite files. Although the term <em>ring buffer</em> has multiple meanings, for our purposes, it is essentially a file set that specifies that once the last file it can hold has been written, when more data must be saved, the first file is overwritten. In other words, it establishes a first in, first out (FIFO) method of writing files. You can check this option and specify the maximum number of files you wish to cycle through. For example, say you choose to use multiple files for your capture with a new file created every hour, and you set your ring buffer to 6. Once the sixth file has been created, the ring buffer will cycle back around and overwrite the first file rather than create a seventh file. This ensures that no more than six files (or in this case, hours) of data will remain on your hard drive, while still allowing new data to be written.</p>&#13;
<p class="indent">Lastly, the Output tab also lets you specify whether to use the .<em>pcapng</em> file format. If you plan to interact with your saved packets using a tool that isn’t capable of parsing .<em>pcapng</em>, you can select the traditional .<em>pcap</em> format.</p>&#13;
<h4 class="h4"><a id="ch04lev2sec11"/><strong><em>Options Tab</em></strong></h4>&#13;
<p class="noindent">The Options tab contains a number of other packet-capturing choices, including display, name resolution, and capture termination options, shown in <a href="ch04.xhtml#ch04fig13">Figure 4-13</a>.</p>&#13;
<div class="image"><span epub:type="pagebreak" id="page_64"/><img alt="image" src="../images/f64-01.jpg"/></div>&#13;
<p class="figcap"><a id="ch04fig13"/><em>Figure 4-13: The Capture Interfaces Options tab</em></p>&#13;
<h5 class="h5"><strong>Display Options</strong></h5>&#13;
<p class="noindent">The Display Options section controls how packets are shown as they are being captured. The Update list of packets in real-time option is self-explanatory and can be paired with the Automatically scroll during live capture option. When both of these options are enabled, all captured packets are displayed on the screen, with the most recently captured ones shown instantly.</p>&#13;
<div class="warning">&#13;
<p class="warningt"><span class="box"><strong>WARNING</strong></span></p>&#13;
<p class="warningp"><em>When paired, the Update list of packets in real-time and Automatically scroll during live capture options can be processor intensive, even when you are capturing a modest amount of data. Unless you have a specific need to see the packets in real time, it’s best to deselect both options.</em></p>&#13;
</div>&#13;
<p class="indent">The Show extra capture information dialog option lets you enable or suppress the display of a small window that shows the number and percentage of packets that have been captured, sorted by their protocol. I like to show the capture info dialog since I typically don’t allow for the live scrolling of packets during capture.</p>&#13;
<h5 class="h5"><strong>Name Resolution Settings</strong></h5>&#13;
<p class="noindent">The Name Resolution section options allow you to enable automatic MAC (layer 2), network (layer 3), and transport (layer 4) name resolution for your capture. We’ll discuss name resolution as a general topic in more depth, including its drawbacks, in <a href="ch05.xhtml#ch05">Chapter 5</a>.</p>&#13;
<h5 class="h5"><span epub:type="pagebreak" id="page_65"/><strong>Stop Capture Settings</strong></h5>&#13;
<p class="noindent">The Stop capture automatically after... section lets you stop the running capture when certain conditions are met. As with multiple file sets, you can trigger the capture to stop based on file size and time interval, but you can also trigger on number of packets. These options can be used with the multiple-file options on the Output tab.</p>&#13;
<h3 class="h3"><a id="ch04lev1sec5"/><strong>Using Filters</strong></h3>&#13;
<p class="noindent">Filters allow you to specify which packets you have available for analysis. Simply stated, a filter is an expression that defines criteria for the inclusion or exclusion of packets. If there are packets you don’t want to see, you can write a filter that gets rid of them. If there are packets you want to see exclusively, you can write a filter that shows only those packets.</p>&#13;
<p class="indenta">Wireshark offers two main types of filters:</p>&#13;
<p class="bullet">•     <em>Capture filters</em> are specified when packets are being captured and will capture only those packets that are specified for inclusion/exclusion in the given expression.</p>&#13;
<p class="bulleta">•     <em>Display filters</em> are applied to an existing set of captured packets in order to hide unwanted packets or show desired packets based on the specified expression.</p>&#13;
<p class="indent">Let’s look at capture filters first.</p>&#13;
<h4 class="h4"><a id="ch04lev2sec12"/><strong><em>Capture Filters</em></strong></h4>&#13;
<p class="noindent">Capture filters are applied during the packet-capturing process to limit the packets delivered to the analyst from the start. One primary reason for using a capture filter is performance. If you know that you do not need to analyze a particular form of traffic, you can simply filter it out with a capture filter and save the processing power that would typically be used in capturing those packets.</p>&#13;
<p class="indent">The ability to create custom capture filters comes in handy when you’re dealing with large amounts of data. The analysis can be sped up by ensuring that you are looking at only the packet relevant to the issue at hand.</p>&#13;
<p class="indent">As an example, suppose you are troubleshooting an issue with a service running on port 262, but the server you are analyzing runs several different services on a variety of ports. Finding and analyzing only the traffic on one port would be quite a job in itself. To capture only the traffic on a specific port, you could use a capture filter. To do so, use the Capture Interfaces dialog as follows:</p>&#13;
<ol>&#13;
<li class="nump"><p class="number">Choose the <strong>Capture</strong> ▶ <strong>Options</strong> button next to the interface on which you want to capture packets. This will open the Capture Interfaces dialog.</p></li>&#13;
<li class="nump"><p class="number">Find the interface you wish to use and scroll to the Capture Filter option in the far-right column.</p></li>&#13;
<li class="nump"><p class="number"><span epub:type="pagebreak" id="page_66"/>You can apply the capture filter by clicking in this column to enter an expression. We want our filter to show only traffic inbound and outbound to port 262, so enter <strong>port 262</strong>, as shown in <a href="ch04.xhtml#ch04fig14">Figure 4-14</a>. (We’ll discuss expressions in more detail in the next section.) The color of the cell should turn green, indicating that you’ve entered a valid expression; it will turn red if the expression is invalid.</p>&#13;
<div class="image"><img alt="image" src="../images/f66-01.jpg"/></div>&#13;
<p class="figcap"><a id="ch04fig14"/><em>Figure 4-14: Creating a capture filter in the Capture Interfaces dialog</em></p></li>&#13;
<li class="nump"><p class="number">Once you have set your filter, click <strong>Start</strong> to begin the capture.</p></li>&#13;
</ol>&#13;
<p class="indent">You should now see only port 262 traffic and be able to more efficiently analyze this particular data.</p>&#13;
<h5 class="h5"><strong>Capture/BPF Syntax</strong></h5>&#13;
<p class="noindent">Capture filters are applied by libpcap/WinPcap and use the Berkeley Packet Filter (BPF) syntax. This syntax is common in several packet-sniffing applications, mostly because packet-sniffing applications tend to rely on the libpcap/WinPcap libraries, which allow for the use of BPFs. A knowledge of BPF syntax will be crucial as you dig deeper into networks at the packet level.</p>&#13;
<p class="indent">A filter created using the BPF syntax is called an <em>expression</em>, and each expression consists of one or more <em>primitives</em>. Primitives consist of one or more <em>qualifiers</em> (as listed in <a href="ch04.xhtml#ch04tab2">Table 4-2</a>), followed by an ID name or number, as shown in <a href="ch04.xhtml#ch04fig15">Figure 4-15</a>.</p>&#13;
<p class="tablecap"><a id="ch04tab2"/><strong>Table 4-2:</strong> The BPF Qualifiers</p>&#13;
<table class="all">&#13;
<thead>&#13;
<tr>&#13;
<td class="table_th" style="vertical-align: top;"><p class="table"><strong>Qualifier</strong></p></td>&#13;
<td class="table_th" style="vertical-align: top;"><p class="table"><strong>Description</strong></p></td>&#13;
<td class="table_th" style="vertical-align: top;"><p class="table"><strong>Examples</strong></p></td>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td class="table_1" style="vertical-align: top;"><p class="table">Type</p></td>&#13;
<td class="table_1" style="vertical-align: top;"><p class="table">Identifies what the ID name or number refers to</p></td>&#13;
<td class="table_1" style="vertical-align: top;"><p class="table"><code>host, net, port</code></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1" style="vertical-align: top;"><p class="table">Dir</p></td>&#13;
<td class="table_1" style="vertical-align: top;"><p class="table">Specifies a transfer direction to or from the ID name or number</p></td>&#13;
<td class="table_1" style="vertical-align: top;"><p class="table"><code>src, dst</code></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1b" style="vertical-align: top;"><p class="table">Proto</p></td>&#13;
<td class="table_1b" style="vertical-align: top;"><p class="table">Restricts the match to a particular protocol</p></td>&#13;
<td class="table_1b" style="vertical-align: top;"><p class="table"><code>ether, ip, tcp, udp, http, ftp</code></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<div class="image"><span epub:type="pagebreak" id="page_67"/><img alt="image" src="../images/f67-01.jpg"/></div>&#13;
<p class="figcap"><a id="ch04fig15"/><em>Figure 4-15: A sample capture filter</em></p>&#13;
<p class="indent">Given the components of an expression, a qualifier of <code>dst host</code> and an ID of 192.168.0.10 would combine to form a primitive. This primitive alone is an expression that would capture traffic only with a destination IP address of 192.168.0.10.</p>&#13;
<p class="indenta">You can use logical operators to combine primitives to create more advanced expressions. Three logical operators are available:</p>&#13;
<p class="bullet">•     Concatenation operator AND (<code>&amp;&amp;</code>)</p>&#13;
<p class="bullet">•     Alternation operator OR (<code>||</code>)</p>&#13;
<p class="bulleta">•     Negation operator NOT (<code>!</code>)</p>&#13;
<p class="indent">For example, the following expression will capture only traffic with a source IP address of 192.168.0.10 and a source or destination port of 80:</p>&#13;
<pre>src host 192.168.0.10 &amp;&amp; port 80</pre>&#13;
<h5 class="h5"><strong>Hostname and Addressing Filters</strong></h5>&#13;
<p class="noindent">Most filters you create will center on a particular network device or grouping of devices. Depending on the circumstances, filtering can be based on a device’s MAC address, IPv4 address, IPv6 address, or DNS hostname.</p>&#13;
<p class="indent">For example, say you’re curious about the traffic of a particular host that is interacting with a server on your network. From the server, you can create a filter using the <code>host</code> qualifier that captures all traffic associated with that host’s IPv4 address:</p>&#13;
<pre>host 172.16.16.149</pre>&#13;
<p class="indent">If you are on an IPv6 network, you would filter based on an IPv6 address using the <code>host</code> qualifier, as shown here:</p>&#13;
<pre>host 2001:db8:85a3::8a2e:370:7334</pre>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_68"/>You can also filter based on a device’s hostname with the <code>host</code> qualifier, like so:</p>&#13;
<pre>host testserver2</pre>&#13;
<p class="indent">Or, if you’re concerned that the IP address for a host might change, you can filter based on its MAC address as well by adding the <code>ether</code> protocol qualifier:</p>&#13;
<pre>ether host 00-1a-a0-52-e2-a0</pre>&#13;
<p class="indent">The transfer direction qualifiers are often used in conjunction with filters, such as the ones in the previous examples, to capture traffic based on whether it’s going to or coming from a host. For example, to capture only traffic coming from a particular host, add the <code>src</code> qualifier:</p>&#13;
<pre>src host 172.16.16.149</pre>&#13;
<p class="noindent">To capture only data destined for 172.16.16.149, use the <code>dst</code> qualifier:</p>&#13;
<pre>dst host 172.16.16.149</pre>&#13;
<p class="indent">When you don’t use a type qualifier (<code>host</code>, <code>net</code>, or <code>port</code>) with a primitive, the <code>host</code> qualifier is assumed. Therefore, this expression, which excludes that qualifier, is the equivalent of the preceding example:</p>&#13;
<pre>dst 172.16.16.149</pre>&#13;
<h5 class="h5"><strong>Port Filters</strong></h5>&#13;
<p class="noindent">In addition to filtering on hosts, you can filter based on the ports used in each packet. Port filtering can be used to filter for services and applications that use known service ports. For example, here’s a simple filter to capture traffic only to or from port 8080:</p>&#13;
<pre>port 8080</pre>&#13;
<p class="indent">To capture all traffic except that on port 8080, this would work:</p>&#13;
<pre>!port 8080</pre>&#13;
<p class="indent">The port filters can be combined with transfer direction qualifiers. For example, to capture only traffic going to the web server listening on the standard HTTP port 80, use the <code>dst</code> qualifier:</p>&#13;
<pre>dst port 80</pre>&#13;
<h5 class="h5"><span epub:type="pagebreak" id="page_69"/><strong>Protocol Filters</strong></h5>&#13;
<p class="noindent">Protocol filters let you filter packets based on certain protocols. They are used to match non–application layer protocols that can’t simply be defined by the use of a certain port. Thus, if you want to see only ICMP traffic, you could use this filter:</p>&#13;
<pre>icmp</pre>&#13;
<p class="indent">To see everything but IPv6 traffic, this will do the trick:</p>&#13;
<pre>!ip6</pre>&#13;
<h5 class="h5"><strong>Protocol Field Filters</strong></h5>&#13;
<p class="noindent">One of the real strengths of the BPF syntax is the ability that it gives us to examine every byte of a protocol header in order to create very specific filters based on that data. The advanced filters that we’ll discuss in this section will allow you to retrieve a specific number of bytes from a packet beginning at a particular location.</p>&#13;
<p class="indent">For example, suppose that we want to filter based on the type field of an ICMP header. The type field is located at the very beginning of a packet, which puts it at offset 0. To identify the location to examine within a packet, specify the byte offset in square brackets next to the protocol qualifier—<code>icmp[0]</code> in this example. This specification will return a 1-byte integer value that we can compare against. For instance, to get only ICMP packets that represent destination unreachable (type 3) messages, we use the equal to operator in our filter expression:</p>&#13;
<pre>icmp[0] == 3</pre>&#13;
<p class="indent">To examine only ICMP packets that represent an echo request (type 8) or echo reply (type 0), use two primitives with the OR operator:</p>&#13;
<pre>icmp[0] == 8 || icmp[0] == 0</pre>&#13;
<p class="indent">These filters work great, but they filter based on only 1 byte of information within a packet header. You can also specify the length of the data to be returned in your filter expression by appending the byte length after the offset number within the square brackets, separated by a colon.</p>&#13;
<p class="indent">For example, say we want to create a filter that captures all ICMP destination-unreachable, host-unreachable packets, identified by type 3, code 1. These are 1-byte fields, located next to each other at offset 0 of the packet header. To do this, we create a filter that checks 2 bytes of data beginning at offset 0 of the packet header, and we compare that data against the hex value 0301 (type 3, code 1), like this:</p>&#13;
<pre>icmp[0:2] == 0x0301</pre>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_70"/>A common scenario is to capture only TCP packets with the RST flag set. We will cover TCP extensively in <a href="ch08.xhtml#ch08">Chapter 8</a>. For now, you just need to know that the flags of a TCP packet are located at offset 13. This is an interesting field because it is collectively 1 byte in size as the flags field, but each particular flag is identified by a single bit within this byte. As I will discuss further in <a href="ch15_appb.xhtml#ch15_appb">Appendix B</a>, each bit in a byte represents some base 2 number. The bit the flag is stored in is specified by the number the bit represents, so the first bit would represent 1, the second 2, the third 4, and so on. Multiple flags can be set simultaneously in a TCP packet. Therefore, we can’t efficiently filter by using a single <code>tcp[13]</code> value because several values may represent the RST bit being set.</p>&#13;
<p class="indent">Instead, we must specify the location within the byte that we wish to examine by appending a single ampersand (<code>&amp;</code>), followed by the number that represents where the flag is stored. The RST flag is at the bit representing the number 4 within this byte, and the fact that this bit is set to 4 tells us that the RST flag is set. The filter looks like this:</p>&#13;
<pre>tcp[13] &amp; 4 == 4</pre>&#13;
<p class="indent">To see all packets with the PSH flag set, which is identified by the bit location representing the number 8 in the TCP flags at offset 13, our filter would use that location instead:</p>&#13;
<pre>tcp[13] &amp; 8 == 8</pre>&#13;
<h5 class="h5"><strong>Sample Capture Filter Expressions</strong></h5>&#13;
<p class="noindent">You will often find that the success or failure of your analysis depends on your ability to create filters appropriate for your current situation. <a href="ch04.xhtml#ch04tab3">Table 4-3</a> shows a few common capture filters that you might use frequently.</p>&#13;
<p class="tablecap"><a id="ch04tab3"/><strong>Table 4-3:</strong> Commonly Used Capture Filters</p>&#13;
<table class="all">&#13;
<thead>&#13;
<tr>&#13;
<td class="table_th" style="vertical-align: top;"><p class="table"><strong>Filter</strong></p></td>&#13;
<td class="table_th" style="vertical-align: top;"><p class="table"><strong>Description</strong></p></td>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td class="table_1" style="vertical-align: top;"><p class="table"><code>tcp[13] &amp; 32 == 32</code></p></td>&#13;
<td class="table_1" style="vertical-align: top;"><p class="table">TCP packets with the URG flag set</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1" style="vertical-align: top;"><p class="table"><code>tcp[13] &amp; 16 == 16</code></p></td>&#13;
<td class="table_1" style="vertical-align: top;"><p class="table">TCP packets with the ACK flag set</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1" style="vertical-align: top;"><p class="table"><code>tcp[13] &amp; 8 == 8</code></p></td>&#13;
<td class="table_1" style="vertical-align: top;"><p class="table">TCP packets with the PSH flag set</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1" style="vertical-align: top;"><p class="table"><code>tcp[13] &amp; 4 == 4</code></p></td>&#13;
<td class="table_1" style="vertical-align: top;"><p class="table">TCP packets with the RST flag set</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1" style="vertical-align: top;"><p class="table"><code>tcp[13] &amp; 2 == 2</code></p></td>&#13;
<td class="table_1" style="vertical-align: top;"><p class="table">TCP packets with the SYN flag set</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1" style="vertical-align: top;"><p class="table"><code>tcp[13] &amp; 1 == 1</code></p></td>&#13;
<td class="table_1" style="vertical-align: top;"><p class="table">TCP packets with the FIN flag set</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1" style="vertical-align: top;"><p class="table"><code>tcp[13] == 18</code></p></td>&#13;
<td class="table_1" style="vertical-align: top;"><p class="table">TCP SYN-ACK packets</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1" style="vertical-align: top;"><p class="table"><code>ether host</code> <span class="codeitalica">00</span><code>:</code><span class="codeitalica">00</span><code>:</code><span class="codeitalica">00</span><code>:</code><span class="codeitalica">00</span><code>:</code><span class="codeitalica">00</span><code>:</code><span class="codeitalica">00</span></p></td>&#13;
<td class="table_1" style="vertical-align: top;"><p class="table">Traffic to or from your MAC address</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1" style="vertical-align: top;"><p class="table"><code>!ether host</code> <span class="codeitalica">00</span><code>:</code><span class="codeitalica">00</span><code>:</code><span class="codeitalica">00</span><code>:</code><span class="codeitalica">00</span><code>:</code><span class="codeitalica">00</span><code>:</code><span class="codeitalica">00</span></p></td>&#13;
<td class="table_1" style="vertical-align: top;"><p class="table">Traffic not to or from your MAC address</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1" style="vertical-align: top;"><p class="table"><code>broadcast</code></p></td>&#13;
<td class="table_1" style="vertical-align: top;"><p class="table">Broadcast traffic only</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1" style="vertical-align: top;"><p class="table"><code>icmp</code></p></td>&#13;
<td class="table_1" style="vertical-align: top;"><p class="table">ICMP traffic</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1" style="vertical-align: top;"><p class="table"><span epub:type="pagebreak" id="page_71"/><code>icmp[0:2] == 0x0301</code></p></td>&#13;
<td class="table_1" style="vertical-align: top;"><p class="table">ICMP destination unreachable, host unreachable</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1" style="vertical-align: top;"><p class="table"><code>ip</code></p></td>&#13;
<td class="table_1" style="vertical-align: top;"><p class="table">IPv4 traffic only</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1" style="vertical-align: top;"><p class="table"><code>ip6</code></p></td>&#13;
<td class="table_1" style="vertical-align: top;"><p class="table">IPv6 traffic only</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1b" style="vertical-align: top;"><p class="table"><code>udp</code></p></td>&#13;
<td class="table_1b" style="vertical-align: top;"><p class="table">UDP traffic only</p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<h4 class="h4"><a id="ch04lev2sec13"/><strong><em>Display Filters</em></strong></h4>&#13;
<p class="noindent">A display filter is one that, when applied to a capture file, tells Wireshark to display only packets that match that filter. You can enter a display filter in the Filter text box above the Packet List pane.</p>&#13;
<p class="indent">Display filters are used more often than capture filters because they allow you to filter the packet data you see without actually omitting the rest of the data in the capture file. That way, if you need to revert to the original capture, you can simply clear the filter expression. They are also a lot more powerful thanks to Wireshark’s extensive library of packet dissectors.</p>&#13;
<p class="indent">As an example, in some situations, you might use a display filter to clear irrelevant broadcast traffic from a capture file by filtering out ARP broadcasts from the Packet List pane when those packets don’t relate to the current problem being analyzed. However, because those ARP broadcast packets may be useful later, it’s better to filter them temporarily than it is to delete them.</p>&#13;
<p class="indent">To filter out all ARP packets in the capture window, place your cursor in the Filter text box at the top of the Packet List pane and enter <span class="codestrong">!arp</span> to remove all ARP packets from the list (<a href="ch04.xhtml#ch04fig16">Figure 4-16</a>). To remove the filter, click the <strong>X</strong> button, and to save the filter for later, click the plus (+) button.</p>&#13;
<div class="image"><img alt="image" src="../images/f71-01.jpg"/></div>&#13;
<p class="figcap"><a id="ch04fig16"/><em>Figure 4-16: Creating a display filter using the Filter text box above the Packet List pane</em></p>&#13;
<p class="indent">There are two ways to apply display filters. One is to apply them directly using the appropriate syntax, as we did in this example. Another is to use the Display Filter Expression dialog to build your filter iteratively; this is the easier method when you are first starting to use filters. Let’s explore both methods, starting with the easier first.</p>&#13;
<h5 class="h5"><strong>The Display Filter Expression Dialog</strong></h5>&#13;
<p class="noindent">The Display Filter Expression dialog, shown in <a href="ch04.xhtml#ch04fig17">Figure 4-17</a>, makes it easy for novice Wireshark users to create capture and display filters. To access this dialog, click the <strong>Expression</strong> button on the Filter toolbar.</p>&#13;
<div class="image"><span epub:type="pagebreak" id="page_72"/><img alt="image" src="../images/f72-01.jpg"/></div>&#13;
<p class="figcap"><a id="ch04fig17"/><em>Figure 4-17: The Display Filter Expression dialog allows for the easy creation of filters in Wireshark.</em></p>&#13;
<p class="indent">The left side of the dialog lists all possible protocol fields, and these fields specify all possible filter criteria. To create a filter, follow these steps:</p>&#13;
<ol>&#13;
<li class="nump"><p class="number">To view the criteria fields associated with a protocol, expand that protocol by clicking the arrow symbol next to it. Once you find the criterion you want to base your filter on, click to select it.</p></li>&#13;
<li class="nump"><p class="number">Choose how your selected field will relate to the criterion value you supply. This relation is specified as equal to, greater than, less than, and so on.</p></li>&#13;
<li class="nump"><p class="number">Create your filter expression by specifying a criterion value that will relate to your selected field. You can define this value or select it from predefined ones programmed into Wireshark.</p></li>&#13;
<li class="nump"><p class="number">Your complete filter will be displayed at the bottom of the screen. When you’ve finished, click <strong>OK</strong> to insert it into the filter bar.</p></li>&#13;
</ol>&#13;
<p class="indent">The Display Filter Expression dialog is great for novice users, but once you get the hang of things, you’ll find that manually entering filter expressions greatly increases your efficiency. The display filter expression syntax structure is simple, yet extremely powerful.</p>&#13;
<h5 class="h5"><span epub:type="pagebreak" id="page_73"/><strong>The Filter Expression Syntax Structure</strong></h5>&#13;
<p class="noindent">When you begin using Wireshark more, you will want to start using the display filter syntax directly in the main window to save time. Fortunately, the syntax used for display filters follows a standard scheme and is easy to navigate. In most cases, this scheme is protocol-centric and follows the format <span class="codeitalic">protocol</span><code>.</code><span class="codeitalic">feature</span><code>.</code><span class="codeitalic">subfeature</span>, as you saw when looking at the Display Filter Expression dialog. Now we will look at a few examples.</p>&#13;
<p class="indent">You will most often use a capture or display filter to see packets based on a specific protocol alone. For example, say you are troubleshooting a TCP problem and you want to see only TCP traffic in a capture file. If so, a simple <code>tcp</code> filter will do the job.</p>&#13;
<p class="indent">Now let’s look at things from the other side of the fence. Imagine that in the course of troubleshooting your TCP problem, you have used the ping utility quite a bit, thereby generating a lot of ICMP traffic. You could remove this ICMP traffic from your capture file with the filter <code>expression !icmp</code>.</p>&#13;
<p class="indent">Comparison operators allow you to compare values. For example, when troubleshooting TCP/IP networks, you will often need to view all packets that reference a particular IP address. The equal to comparison operator (<code>==</code>) will allow you to create a filter showing all packets with an IP address of 192.168.0.1:</p>&#13;
<pre>ip.addr==192.168.0.1</pre>&#13;
<p class="indent">Now suppose that you need to view only packets that are less than 128 bytes. You can use the less than or equal to operator (<code>&lt;=</code>) to accomplish this goal:</p>&#13;
<pre>frame.len&lt;=128</pre>&#13;
<p class="indent"><a href="ch04.xhtml#ch04tab4">Table 4-4</a> shows Wireshark’s comparison operators.</p>&#13;
<p class="tablecap"><a id="ch04tab4"/><strong>Table 4-4:</strong> Wireshark Filter Expression Comparison Operators</p>&#13;
<table class="all">&#13;
<thead>&#13;
<tr>&#13;
<td class="table_th" style="vertical-align: top;"><p class="table"><strong>Operator</strong></p></td>&#13;
<td class="table_th" style="vertical-align: top;"><p class="table"><strong>Description</strong></p></td>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td class="table_1" style="vertical-align: top;"><p class="table"><code>==</code></p></td>&#13;
<td class="table_1" style="vertical-align: top;"><p class="table">Equal to</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1" style="vertical-align: top;"><p class="table"><code>!=</code></p></td>&#13;
<td class="table_1" style="vertical-align: top;"><p class="table">Not equal to</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1" style="vertical-align: top;"><p class="table"><code>&gt;</code></p></td>&#13;
<td class="table_1" style="vertical-align: top;"><p class="table">Greater than</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1" style="vertical-align: top;"><p class="table"><code>&lt;</code></p></td>&#13;
<td class="table_1" style="vertical-align: top;"><p class="table">Less than</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1" style="vertical-align: top;"><p class="table"><code>&gt;=</code></p></td>&#13;
<td class="table_1" style="vertical-align: top;"><p class="table">Greater than or equal to</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1b" style="vertical-align: top;"><p class="table"><code>&lt;=</code></p></td>&#13;
<td class="table_1b" style="vertical-align: top;"><p class="table">Less than or equal to</p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<p class="indent">Logical operators allow you to combine multiple filter expressions into one statement, dramatically increasing the effectiveness of your filters. <span epub:type="pagebreak" id="page_74"/>For example, say that you’re interested in displaying only packets to two IP addresses. You can use the <code>or</code> operator to create one expression that will display packets containing either IP address, like this:</p>&#13;
<pre>ip.addr==192.168.0.1 or ip.addr==192.168.0.2</pre>&#13;
<p class="indent"><a href="ch04.xhtml#ch04tab5">Table 4-5</a> lists Wireshark’s logical operators.</p>&#13;
<p class="tablecap"><a id="ch04tab5"/><strong>Table 4-5:</strong> Wireshark Filter Expression Logical Operators</p>&#13;
<table class="all">&#13;
<thead>&#13;
<tr>&#13;
<td class="table_th" style="vertical-align: top;"><p class="table"><strong>Operator</strong></p></td>&#13;
<td class="table_th" style="vertical-align: top;"><p class="table"><strong>Description</strong></p></td>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td class="table_1" style="vertical-align: top;"><p class="table"><code>and</code></p></td>&#13;
<td class="table_1" style="vertical-align: top;"><p class="table">Both conditions must be true.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1" style="vertical-align: top;"><p class="table"><code>or</code></p></td>&#13;
<td class="table_1" style="vertical-align: top;"><p class="table">Either one of the conditions must be true.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1" style="vertical-align: top;"><p class="table"><code>xor</code></p></td>&#13;
<td class="table_1" style="vertical-align: top;"><p class="table">One and only one condition must be true.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1b" style="vertical-align: top;"><p class="table"><code>not</code></p></td>&#13;
<td class="table_1b" style="vertical-align: top;"><p class="table">Neither one of the conditions is true.</p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<h5 class="h5"><strong>Sample Display Filter Expressions</strong></h5>&#13;
<p class="noindent">Although the concepts related to creating filter expressions are fairly simple, you will need to use several specific keywords and operators when creating new filters for various problems. <a href="ch04.xhtml#ch04tab6">Table 4-6</a> shows some of the display filters that I use most often. For a complete list, see the Wireshark display filter reference at <em><a href="http://www.wireshark.org/docs/dfref/">http://www.wireshark.org/docs/dfref/</a></em>.</p>&#13;
<p class="tablecap"><a id="ch04tab6"/><strong>Table 4-6:</strong> Commonly Used Display Filters</p>&#13;
<table class="all">&#13;
<thead>&#13;
<tr>&#13;
<td class="table_th" style="vertical-align: top;"><p class="table"><strong>Filter</strong></p></td>&#13;
<td class="table_th" style="vertical-align: top;"><p class="table"><strong>Description</strong></p></td>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td class="table_1" style="vertical-align: top;"><p class="table"><code>!tcp.port==3389</code></p></td>&#13;
<td class="table_1" style="vertical-align: top;"><p class="table">Filter out RDP traffic</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1" style="vertical-align: top;"><p class="table"><code>tcp.flags.syn==1</code></p></td>&#13;
<td class="table_1" style="vertical-align: top;"><p class="table">TCP packets with the SYN flag set</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1" style="vertical-align: top;"><p class="table"><code>tcp.flags.reset==1</code></p></td>&#13;
<td class="table_1" style="vertical-align: top;"><p class="table">TCP packets with the RST flag set</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1" style="vertical-align: top;"><p class="table"><code>!arp</code></p></td>&#13;
<td class="table_1" style="vertical-align: top;"><p class="table">Clear ARP traffic</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1" style="vertical-align: top;"><p class="table"><code>http</code></p></td>&#13;
<td class="table_1" style="vertical-align: top;"><p class="table">All HTTP traffic</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1" style="vertical-align: top;"><p class="table"><code>tcp.port==23 || tcp.port==21</code></p></td>&#13;
<td class="table_1" style="vertical-align: top;"><p class="table">Telnet or FTP traffic</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1b" style="vertical-align: top;"><p class="table"><code>smtp || pop || imap</code></p></td>&#13;
<td class="table_1b" style="vertical-align: top;"><p class="table">Email traffic (SMTP, POP, or IMAP)</p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<h4 class="h4"><a id="ch04lev2sec14"/><strong><em>Saving Filters</em></strong></h4>&#13;
<p class="noindent">Once you begin creating a lot of capture and display filters, you will find that you use certain ones frequently. Fortunately, you don’t need to type these in each time you want to use them, because Wireshark lets you save your filters for later use. To save a custom capture filter, follow these steps:</p>&#13;
<ol>&#13;
<li class="nump"><p class="number">Select <strong>Capture</strong> ▶ <strong>Capture Filters</strong> to open the Capture Filter dialog.</p></li>&#13;
<li class="nump"><p class="number">Create a new filter by clicking the plus (+) button on the lower left side of the dialog.</p></li>&#13;
<li class="nump"><p class="number"><span epub:type="pagebreak" id="page_75"/>Enter a name for your filter in the Filter Name box.</p></li>&#13;
<li class="nump"><p class="number">Enter the actual filter expression in the Filter String box.</p></li>&#13;
<li class="nump"><p class="number">Click the <strong>OK</strong> button to save your filter expression in the list.</p></li>&#13;
</ol>&#13;
<p class="indent">To save a custom display filter, follow these steps:</p>&#13;
<ol>&#13;
<li class="nump"><p class="number">Type your filter into the Filter bar above the Packet List pane in the main window and click the <strong>ribbon</strong> button on the left side of the bar.</p></li>&#13;
<li class="nump"><p class="number">Click the <strong>Save this Filter</strong> option, and a list of saved display filters will be presented in a separate dialog. There you can provide a name for your filter before clicking <strong>OK</strong> to save it (<a href="ch04.xhtml#ch04fig18">Figure 4-18</a>).</p></li>&#13;
</ol>&#13;
<div class="image"><img alt="image" src="../images/f75-01.jpg"/></div>&#13;
<p class="figcap"><a id="ch04fig18"/><em>Figure 4-18: You can save display filters directly from the main toolbar.</em></p>&#13;
<h4 class="h4"><a id="ch04lev2sec15"/><strong><em>Adding Display Filters to a Toolbar</em></strong></h4>&#13;
<p class="noindent">If you have filters that you find yourself flipping on and off frequently, one of the easiest ways to interact with them is to add filter toggles to the Filter bar just above the Packet List pane. To do this, complete the following steps:</p>&#13;
<ol>&#13;
<li class="nump"><p class="number">Type your filter into the Filter bar above the Packet List pane in the main window and click the plus (+) button on the right side of the bar.</p></li>&#13;
<li class="nump"><p class="number">A new bar will display below the Filter bar where you can provide a name for your filter in the Label field (<a href="ch04.xhtml#ch04fig19">Figure 4-19</a>). This is the label that will be used to represent the filter on the toolbar. Once you’ve input something in this field, click <strong>OK</strong> to create a shortcut to this expression in the Filter toolbar.</p></li>&#13;
</ol>&#13;
<div class="image"><span epub:type="pagebreak" id="page_76"/><img alt="image" src="../images/f76-01.jpg"/></div>&#13;
<p class="figcap"><a id="ch04fig19"/><em>Figure 4-19: Adding a filter expression shortcut to the Filter toolbar</em></p>&#13;
<p class="indent">As you can see in <a href="ch04.xhtml#ch04fig20">Figure 4-20</a>, we’ve created a shortcut to a filter that will quickly show any TCP packets with the RST flag enabled. Additions to the filtering toolbar are saved to your configuration profile (as discussed in <a href="ch03.xhtml#ch03">Chapter 3</a>), making them a powerful way to enhance your ability to identify problems in packet captures in various scenarios.</p>&#13;
<div class="image"><img alt="image" src="../images/f76-02.jpg"/></div>&#13;
<p class="figcap"><a id="ch04fig20"/><em>Figure 4-20: Filtering using a toolbar shortcut</em></p>&#13;
<p class="indent">Wireshark includes several built-in filters that are great examples of what a filter should look like. You’ll want to use them (together with the Wireshark help pages) when creating your own filters. We’ll use filters in examples throughout this book.</p>&#13;
</body></html>