<html><head></head><body>
<h2 class="h1-part" id="part01"><span epub:type="pagebreak" id="page_35"/><span class="green1"><strong>LEDS</strong></span></h2>


<h2 class="h2" id="ch01"><span epub:type="pagebreak" id="page_36"/><strong>1<br/>Blinking an LED</strong></h2>
<p class="noindent"><span class="green1">In this first project, you’ll connect an LED to your Pi and make it blink with a python script. Learning how to blink an LED using the GPIO pins is an important step in your Pi education; once you know how to control an LED, you can control practically any output, whether it’s a motor, a lamp, or even a toaster.</span></p>
<div class="image"><span epub:type="pagebreak" id="page_37"/><img src="../images/f0037-01.jpg" alt="image"/></div>
<p class="cap"><span class="green1"><strong>PARTS REQUIRED</strong></span></p>
<p class="cap1">Raspberry Pi</p>
<p class="cap1">Breadboard</p>
<p class="cap1">5 mm LED</p>
<p class="cap1">330 Ω resistor</p>
<p class="cap1">Jumper wires</p>
<h3 class="h3" id="lev27"><span epub:type="pagebreak" id="page_38"/><span class="green1"><strong>INTRODUCING THE GPIO PINS</strong></span></h3>
<p class="noindent">The <em>General Purpose Input/Output (GPIO)</em> pins allow you to connect electronic hardware, like LEDs and sensors, to your Pi. They can be used to both read and send information, allowing your Pi to interact with the real world.</p>
<p class="indent">The Raspberry Pi 3 Model B board has a double row of 40 GPIO pins, shown in <a href="ch01.xhtml#ch01fig1">Figure 1-1</a>. This layout is the same for the Pi 2 Model B and Pi 1 Model B+, but slightly different from the Pi 1 Model A and B, which have only the first 26 pins. Check the <a href="app01.xhtml#app01">“Raspberry Pi GPIO Pin Guide”</a> on <a href="app01.xhtml#page_261">page 261</a> if you’re using a board other than the Raspberry Pi 3 Model B.</p>
<div class="image"><a id="ch01fig1"/><img src="../images/f0038-01.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 1-1:</strong> Raspberry Pi GPIO layout</p>
<p class="indent">There are two ways to refer to a GPIO pin: its name (which is known as GPIO numbering or Broadcom numbering) or by its corresponding pin number (which is known as physical numbering). For example, GPIO 25 corresponds to pin 22. Throughout this book, we'll refer to GPIO pins by their names. GPIO pins can be set to HIGH, which outputs 3.3 V and turns a component on, or LOW, which outputs 0 V and turns the component off.</p>
<table class="topbot-d">
<thead>
<tr>
<td style="vertical-align: top;" class="border_tha"><p class="tab_th"><strong>FUNCTION</strong></p></td>
<td style="vertical-align: top;" class="border_tha"><p class="tab_th"><strong>NAME</strong></p></td>
<td style="vertical-align: top;" class="border_tha"><p class="tab_th"><strong>NUMBER</strong></p></td>
<td style="vertical-align: top;" class="border_tha"><p class="tab_th"><strong>NUMBER</strong></p></td>
<td style="vertical-align: top;" class="border_tha"><p class="tab_th"><strong>NAME</strong></p></td>
<td style="vertical-align: top;" class="border_tha"><p class="tab_th"><strong>FUNCTION</strong></p></td>
</tr>
</thead>
<tbody>
<tr>
<td style="vertical-align: top;" class="table-a"><p class="tabc">DC power</p></td>
<td style="vertical-align: top;" class="table-d"><p class="tabc">3.3 V</p></td>
<td style="vertical-align: top;" class="table-d"><p class="tabc">1</p></td>
<td style="vertical-align: top;" class="table-e"><p class="tabc">2</p></td>
<td style="vertical-align: top;" class="table-e"><p class="tabc">5 V</p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc">DC power</p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-a"><p class="tabc">SDA1, I<sup>2</sup>C</p></td>
<td style="vertical-align: top;" class="table-f"><p class="tabc">GPIO 2</p></td>
<td style="vertical-align: top;" class="table-f"><p class="tabc">3</p></td>
<td style="vertical-align: top;" class="table-e"><p class="tabc">4</p></td>
<td style="vertical-align: top;" class="table-e"><p class="tabc">5 V</p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc">DC power</p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-a"><p class="tabc">SCL1, I<sup>2</sup>C</p></td>
<td style="vertical-align: top;" class="table-f"><p class="tabc">GPIO 3</p></td>
<td style="vertical-align: top;" class="table-f"><p class="tabc">5</p></td>
<td style="vertical-align: top;" class="table-g"><p class="tabc">6</p></td>
<td style="vertical-align: top;" class="table-g"><p class="tabc">GND</p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"> </p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-a"><p class="tabc">GPIO_GCLK</p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc">GPIO 4</p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc">7</p></td>
<td style="vertical-align: top;" class="table-h"><p class="tabc">8</p></td>
<td style="vertical-align: top;" class="table-h"><p class="tabc">GPIO 14</p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc">TXD0</p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-a"><p class="tabc"> </p></td>
<td style="vertical-align: top;" class="table-g"><p class="tabc">GND</p></td>
<td style="vertical-align: top;" class="table-g"><p class="tabc">9</p></td>
<td style="vertical-align: top;" class="table-h"><p class="tabc">10</p></td>
<td style="vertical-align: top;" class="table-h"><p class="tabc">GPIO 15</p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc">RXD0</p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-a"><p class="tabc">GPIO_GEN0</p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc">GPIO 17</p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc">11</p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc">12</p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc">GPIO 18</p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc">GPIO_GEN1</p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-a"><p class="tabc">GPIO_GEN2</p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc">GPIO 27</p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc">13</p></td>
<td style="vertical-align: top;" class="table-g"><p class="tabc">14</p></td>
<td style="vertical-align: top;" class="table-g"><p class="tabc">GND</p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"> </p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-a"><p class="tabc">GPIO_GEN3</p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc">GPIO 22</p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc">15</p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc">16</p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc">GPIO 23</p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc">GPIO_GEN4</p></td>
</tr>
</tbody>
</table>
<table class="topbot-d">
<thead>
<tr>
<td style="vertical-align: top;" class="border_tha"><p class="tab_th"><span epub:type="pagebreak" id="page_39"/><strong>FUNCTION</strong></p></td>
<td style="vertical-align: top;" class="border_tha"><p class="tab_th"><strong>NAME</strong></p></td>
<td style="vertical-align: top;" class="border_tha"><p class="tab_th"><strong>NUMBER</strong></p></td>
<td style="vertical-align: top;" class="border_tha"><p class="tab_th"><strong>NUMBER</strong></p></td>
<td style="vertical-align: top;" class="border_tha"><p class="tab_th"><strong>NAME</strong></p></td>
<td style="vertical-align: top;" class="border_tha"><p class="tab_th"><strong>FUNCTION</strong></p></td>
</tr>
</thead>
<tbody>
<tr>
<td style="vertical-align: top;" class="table-a"><p class="tabc">DC power</p></td>
<td style="vertical-align: top;" class="table-d"><p class="tabc">3.3 V</p></td>
<td style="vertical-align: top;" class="table-d"><p class="tabc">17</p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc">18</p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc">GPIO 24</p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc">GPIO_GEN5</p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-a"><p class="tabc">SPI_MOSI</p></td>
<td style="vertical-align: top;" class="table-ha"><p class="tabc">GPIO 10</p></td>
<td style="vertical-align: top;" class="table-ha"><p class="tabc">19</p></td>
<td style="vertical-align: top;" class="table-g"><p class="tabc">20</p></td>
<td style="vertical-align: top;" class="table-g"><p class="tabc">GND</p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"> </p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-a"><p class="tabc">SPI_MISO</p></td>
<td style="vertical-align: top;" class="table-ha"><p class="tabc">GPIO 9</p></td>
<td style="vertical-align: top;" class="table-ha"><p class="tabc">21</p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc">22</p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc">GPIO 25</p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc">GPIO_GEN6</p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-a"><p class="tabc">SPI_CLK</p></td>
<td style="vertical-align: top;" class="table-ha"><p class="tabc">GPIO 11</p></td>
<td style="vertical-align: top;" class="table-ha"><p class="tabc">23</p></td>
<td style="vertical-align: top;" class="table-ha"><p class="tabc">24</p></td>
<td style="vertical-align: top;" class="table-ha"><p class="tabc">GPIO 8</p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc">SPI_CE0_N</p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-a"><p class="tabc"> </p></td>
<td style="vertical-align: top;" class="table-g"><p class="tabc">GND</p></td>
<td style="vertical-align: top;" class="table-g"><p class="tabc">25</p></td>
<td style="vertical-align: top;" class="table-ha"><p class="tabc">26</p></td>
<td style="vertical-align: top;" class="table-ha"><p class="tabc">GPIO 7</p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc">SPI_CE1_N</p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-a"><p class="tabc">I<sup>2</sup>C ID EEPROM</p></td>
<td style="vertical-align: top;" class="table-i"><p class="tabc">DNC</p></td>
<td style="vertical-align: top;" class="table-i"><p class="tabc">27</p></td>
<td style="vertical-align: top;" class="table-i"><p class="tabc">28</p></td>
<td style="vertical-align: top;" class="table-i"><p class="tabc">DNC</p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc">I<sup>2</sup>C ID EEPROM</p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-a"><p class="tabc"> </p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc">GPIO 5</p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc">29</p></td>
<td style="vertical-align: top;" class="table-g"><p class="tabc">30</p></td>
<td style="vertical-align: top;" class="table-g"><p class="tabc">GND</p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"> </p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-a"><p class="tabc"> </p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc">GPIO 6</p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc">31</p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc">32</p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc">GPIO 12</p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"> </p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-a"><p class="tabc"> </p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc">GPIO 13</p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc">33</p></td>
<td style="vertical-align: top;" class="table-g"><p class="tabc">34</p></td>
<td style="vertical-align: top;" class="table-g"><p class="tabc">GND</p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"> </p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-a"><p class="tabc"> </p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc">GPIO 19</p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc">35</p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc">36</p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc">GPIO 16</p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"> </p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-a"><p class="tabc"> </p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc">GPIO 26</p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc">37</p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc">38</p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc">GPIO 20</p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"> </p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-a"><p class="tabc"> </p></td>
<td style="vertical-align: top;" class="table-g"><p class="tabc">GND</p></td>
<td style="vertical-align: top;" class="table-g"><p class="tabc">39</p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc">40</p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc">GPIO 21</p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"> </p></td>
</tr>
</tbody>
</table>
<div class="note">
<p class="notet"><span class="red"><strong>WARNING</strong></span></p>
<p class="notep"><em>The GPIO pins are designed to work at 3.3 V, so if you connect them to higher voltages, you’ll permanently damage your Raspberry Pi.</em></p>
</div>
<p class="indent">The pins highlighted in gray, pins 27 and 28, are DNC, or “do not connect,” pins. The Raspberry Pi also has eight GND (ground) pins—highlighted in black in the table—for connecting ground to your circuits. There are four power pins, two 5 V pins and two 3.3 V—highlighted in red and orange, respectively—to supply power. Several pins have special features; for example, the pins highlighted in yellow are used in serial peripheral interface (SPI) communication, and the ones highlighted in green are used for inter-integrated circuit (I<sup>2</sup>C) communication. You’ll learn about these communication protocols in <a href="ch03.xhtml#ch03">Project 3</a> and <a href="ch07.xhtml#ch07">Project 7</a>, respectively.</p>
<h3 class="h3" id="lev28"><span class="green1"><strong>INTRODUCING LEDs</strong></span></h3>
<p class="noindent">LEDs come in a wide variety of sizes, shapes, and colors, and some can even mix colors to produce almost any color. In this project you’ll use a simple 5 mm red LED.</p>
<p class="indent">An <em>LED</em>, or <em>light-emitting diode</em>, is—as its name suggests—a diode that emits light. Diodes are electronic components that have <em>polarity</em>, meaning they allow current to flow in only one direction, from positive to negative. LEDs, like all diodes, have a positive connection known as an <em>anode</em>, and a negative connection known as a <em>cathode</em>. The two legs, or <em>leads</em>, on LEDs are different lengths to help you identify which is positive and which is negative, illustrated in <a href="ch01.xhtml#ch01fig2">Figure 1-2</a>. The longer lead is the anode (+) and the shorter lead is the cathode (–).</p>
<div class="image"><span epub:type="pagebreak" id="page_40"/><a id="ch01fig2"/><img src="../images/f0040-01.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 1-2:</strong> A 5 mm red LED</p>
<h3 class="h3" id="lev29"><span class="green1">FINDING THE RIGHT RESISTOR</span></h3>
<p class="noindent">LEDs can handle only so much current before they overload and burn out, which can potentially damage the LED and even the Pi board. To prevent this, you must always connect LEDs in series with a <em>resistor</em>: a small component that limits the amount of current passing through it.</p>
<p class="indent">Resistors come in all sorts of values, and you need one that’s strong enough to protect your component without being so strong that it limits the component’s capabilities. For example, a stronger resistor can dull the light an LED gives off. The appropriate resistance value depends on the LED you’re using—most LEDs you’ll use in electronics can handle a maximum current rating of 20 mA. For the LED in this project, picking up a resistor of any value between 220 Ω and 470 Ω is fine, and within this range, a lower resistance value will result in a slightly brighter LED.</p>
<div class="note">
<p class="notet"><strong>NOTE</strong></p>
<p class="notep"><em>We recommend that you purchase a 1/4 W resistor assortment that spans a wide range of resistance values. These will meet most of your needs.</em></p>
</div>
<p class="indent">The resistance value is indicated by the color bands on the resistor. Resistors usually have four bands, as shown in <a href="ch01.xhtml#ch01fig3">Figure 1-3</a>. The first two represent the first two digits of the value. The third is a multiplier representing the number of zeros after the first two digits. The fourth is the <em>tolerance</em> of the resistance, which notes the percentage that the actual resistance might be above or below the given value. For example, a 330 Ω resistor with a 5 percent tolerance might be any value between 313.5 Ω and 346.5 Ω.</p>
<div class="image"><a id="ch01fig3"/><img src="../images/f0040-02.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 1-3:</strong> A 330 Ω resistor</p>
<p class="indent">If you need help identifying a resistor, check the resistor color card in <a href="app02.xhtml#app02">“Decoding Resistor Values”</a> on <a href="app02.xhtml#page_264">page 264</a>.</p>
<h3 class="h3" id="lev30"><span epub:type="pagebreak" id="page_41"/><span class="green1"><strong>WIRING THE CIRCUIT</strong></span></h3>
<p class="noindent">Now you’re ready to build your first circuit. All the projects in this book use a <em>solderless breadboard</em>, which gives you an inexpensive and easy way to build circuits without having to connect the components using solder. If you’ve never used a breadboard before, make sure to read <a href="ch01.xhtml#ch01box1">“How Does a Breadboard Work?”</a> on <a href="ch01.xhtml#page_42">page 42</a> before beginning.</p>
<p class="indent">To wire an LED to the Raspberry Pi, follow these next steps. Use the wiring diagram in <a href="ch01.xhtml#ch01fig4">Figure 1-4</a> as a reference, and review <a href="ch01.xhtml#ch01fig1">Figure 1-1</a> for pin locations if you need to.</p>
<ol>
<li class="noindent"><p class="list">Connect a blue breadboard rail to one of the Raspberry Pi GND pins (pins 6, 9, 14, 20, 25, 30, 34, and 39 all provide GND).</p></li>
<li class="noindent"><p class="list">Insert the LED into the breadboard.</p></li>
<li class="noindent"><p class="list">Insert the 330 Ω resistor into the breadboard so that one side is connected to the LED anode (the longer, positive lead).</p></li>
<li class="noindent"><p class="list">Connect the other side of the resistor to GPIO 25 (pin 22) with a jumper wire.</p></li>
<li class="noindent"><p class="list">Connect the LED cathode (the shorter, negative lead) to the GND power rail.</p></li>
</ol>
<div class="image"><img src="../images/f0041-01.jpg" alt="image"/></div>
<p class="listing" id="ch01list1"><strong>LISTING 1-1:</strong> Wiring an LED to the Raspberry Pi. The LED lead with a bend in it is the anode.</p>
<p class="indent">We’ve given you instructions on where to place the resistor, but really it doesn’t matter whether it’s connected to the anode or cathode as long as it is connected to one. You might wonder why we didn’t just connect the LED cathode directly to pin 6 (GND), since we only need the GND rail for that one connection. The reason is that it’s good practice to use the breadboard GND rails, which will become more useful in more advanced circuits.</p>
<div class="box2">
<p class="box-title" id="ch01box1"><span epub:type="pagebreak" id="page_42"/><span class="green1"><strong>HOW DOES A BREADBOARD WORK?</strong></span></p>
<p class="box-p">Wiring a circuit using a breadboard is as easy as plugging and unplugging components. A breadboard has rows of holes that connect with copper strips underneath, so you just need to insert the components into those holes and then use jumper wires to connect them. The breadboard holes are connected to each other in a specific way, shown here by the orange lines.</p>
<div class="image1"><img src="../images/f0042-01.jpg" alt="image"/></div>
<p class="box-pi">Each individual line is electrically isolated from the others. The horizontal lines are the <em>power rails</em>, used to connect the power supply: the blue rails are used to connect GND and the red rails to connect power. In the middle of the breadboard is a divide that splits the rows on either side. You should place your components in these rows. Components in the same row, on the same side of the center divide, will be connected by the copper strips beneath.</p>
</div>
<h3 class="h3" id="lev31"><span class="green1"><strong>WRITING THE SCRIPT</strong></span></h3>
<p class="noindent">To keep all your projects organized, create a folder called <em>Projects</em> in your desktop environment to save all your projects’ scripts. Inside the newly created folder, create a new folder called <em>LEDs</em> where you’ll save the LED projects in this book.</p>
<p class="indent">In simple terms, the blinking LED project works as follows:</p>
<ol>
<li class="noindent"><p class="list">The LED turns on for 1 second—GPIO 25 set to HIGH.</p></li>
<li class="noindent"><p class="list">The LED turns off for 1 second—GPIO 25 set to LOW.</p></li>
<li class="noindent"><p class="list">The LED is on again for 1 second—GPIO 25 set to HIGH.</p></li>
<li class="noindent"><p class="list">The LED is off again for 1 second—GPIO 25 set to LOW.</p></li>
</ol>
<p class="indent">This pattern continues until you tell the program to stop.</p>
<p class="indent"><span epub:type="pagebreak" id="page_43"/>Throughout this book, we’ll control the Raspberry Pi GPIOs using a Python library called gpiozero. The gpiozero library provides a collection of interfaces for everyday components like LEDs, buttons, potentiometers, sensors, and much more.</p>
<h4 class="h4" id="lev32"><span class="green1"><strong>Entering the Script</strong></span></h4>
<p class="noindent">Open <strong>Python 3 (IDLE)</strong> and go to <strong>File</strong> <span class="ent">▸</span> <strong>New File</strong> to create a new script. Copy the following code to the Python Editor and save the script as <em>blinking_led.py</em> inside the <em>LEDs</em> folder (remember that you can download all the scripts at <em><a href="https://www.nostarch.com/RaspberryPiProject/">https://www.nostarch.com/RaspberryPiProject/</a></em>):</p>
<div class="box">
<pre>  <span class="red1">#importing necessary libraries</span><br/><span class="ent">➊</span> <span class="orange">from</span> gpiozero <span class="orange">import</span> LED<br/><span class="ent">➋</span> <span class="orange">from</span> time <span class="orange">import</span> sleep<br/><br/>  <span class="red1">#create an object called led that refers to GPIO 25</span><br/><span class="ent">➌</span> led = LED(25)<br/><br/>  <span class="red1">#create variable called delay that refers to delay time in seconds</span><br/><span class="ent">➍</span> delay = 1<br/><br/><span class="ent">➎</span> <span class="orange">while True</span>:<br/>      <span class="red1">#set led to on for the delay time</span><br/>    <span class="ent">➏</span> led.on()<br/>      <span class="purple">print</span>(<span class="green">'LED set to on'</span>)<br/>    <span class="ent">➐</span> sleep(delay)<br/>      <span class="red1">#set led to off for the delay time</span><br/>    <span class="ent">➑</span> led.off()<br/>      <span class="purple">print</span>(<span class="green">'LED set to off'</span>)<br/>      sleep(delay)</pre>
</div>
<p class="indent">There’s quite a lot going on here, so we’ll go through each major code section one at a time.</p>
<h5 class="h5"><strong>Importing Libraries</strong></h5>
<p class="noindent">At <span class="ent">➊</span> you import <code>LED</code> from the gpiozero library to control the GPIO that the LED is connected to. Then you import the <code>sleep()</code> function from the <code>time</code> module <span class="ent">➋</span>.</p>
<h5 class="h5"><strong>Declaring the Pin</strong></h5>
<p class="noindent">At <span class="ent">➌</span> you create an <code>LED</code> object called <code>led</code> that refers to GPIO 25, which is the GPIO the LED is connected to. When you create and use this <code>LED</code> object, Python knows GPIO 25 is an output and thus should be set to HIGH or LOW. After this declaration, you can use <code>led</code> to refer to your GPIO 25.</p>
<h5 class="h5"><span epub:type="pagebreak" id="page_44"/><strong>Starting the while Loop</strong></h5>
<p class="noindent">At <span class="ent">➎</span> you start a <code>while</code> loop with the condition <code>True</code>, which means this loop will run forever until you stop the program yourself. The lines of code that follow the loop declaration are indented, telling Python that this is the content of the loop to be run as long as the <code>while</code> condition is met.</p>
<h5 class="h5"><strong>Setting the Digital Output</strong></h5>
<p class="noindent">Next you need to set the digital output for the LED. You use the <code>led.on()</code> function <span class="ent">➏</span> to set GPIO 25 to HIGH, turning the LED on, and the <code>led.off()</code> function <span class="ent">➑</span> to set GPIO 25 to LOW, turning the LED off. There is a pause of 1 second between each LED state using the <code>sleep()</code> function <span class="ent">➐</span>, which creates the blinking effect. The code stops where it is and waits for the amount of time specified in the <code>delay</code> variable (given in seconds) <span class="ent">➍</span> before proceeding to the next line of code. This allows you to keep the LED on or off for a given period of time.</p>
<h4 class="h4" id="lev33"><span class="green1"><strong>Running the Script</strong></span></h4>
<p class="noindent">To run the script, first save it and then press <strong>F5</strong> or go to <strong>Run</strong> <span class="ent">▸</span> <strong>Run Module</strong>. Your circuit should look something like Figure 1-5, with your LED turning on and off every second. To stop the running program, press <small>CTRL</small>-C.</p>
<div class="image"><a id="ch01fig4"/><img src="../images/f0044-01.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 1-4:</strong> The completed project</p>
<p class="indent"><span epub:type="pagebreak" id="page_45"/>Congratulations—you’ve just built your first working project!</p>
<h3 class="h3" id="lev34"><span class="green1"><strong>TAKING IT FURTHER</strong></span></h3>
<p class="noindent">The best way to learn electronics and programming is by experimenting. Here are two simple ideas for modifications you could try:</p>
<ul>
<li class="noindent">Change the delay time in the script.</li>
<li class="noindent">Modify the circuit and script to control more than one LED.</li>
</ul>
<p class="indent">See if you can use what you learned in this project to figure out each task.</p>


<h2 class="h2" id="ch02"><span epub:type="pagebreak" id="page_46"/><strong>2<br/>Pushbutton LED Flashlight</strong></h2>
<p class="noindent"><span class="green1">This LED flashlight will teach you to use pushbuttons, an essential skill in electronic circuits. You’ll learn how to use a pushbutton in your circuit to trigger an event—in this case, lighting an LED—when the pushbutton is pressed and stop the event when it’s released.</span></p>
<div class="image"><span epub:type="pagebreak" id="page_47"/><img src="../images/f0047-01.jpg" alt="image"/></div>
<p class="cap"><span class="green1"><strong>PARTS REQUIRED</strong></span></p>
<p class="cap1">Raspberry Pi</p>
<p class="cap1">Breadboard</p>
<p class="cap1">5 mm LED</p>
<p class="cap1">330 Ω resistor</p>
<p class="cap1">Jumper wires</p>
<h3 class="h3" id="lev35"><span epub:type="pagebreak" id="page_48"/><span class="green1"><strong>INTRODUCING SWITCHES AND BUTTONS</strong></span></h3>
<p class="noindent">Switches are everywhere. You use them to turn on lights, adjust the speed of your blender, light your stove, and so much more. There’s a wide variety of switches available, but some of the ones you’ll see around the house include pushbutton, toggle, rotary, and magnetic reed switches. <a href="ch02.xhtml#ch02fig1">Figure 2-1</a> shows a few different switches commonly used in electronics.</p>
<div class="image"><a id="ch02fig1"/><img src="../images/f0048-01.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 2-1:</strong> Several types of switches used in electronics</p>
<p class="indent">A switch can act either as an <em>interrupter</em>, interrupting the electric current to allow or restrict power to a certain component, or as a <em>diverter</em>, diverting the current to another part of the circuit. This project will use a simple pushbutton—an interrupter switch that is great for electronics because it is cheap, fits perfectly into a breadboard, and is easy to manipulate.</p>
<p class="indent">There are two main types of pushbuttons: normally open and normally closed. <em>Normally open</em> pushbuttons, shown in <a href="ch02.xhtml#ch02fig2">Figure 2-2</a>, have a circuit that’s open by default, preventing the current from flowing through it. When you press the pushbutton, the two sides are connected, the circuit closes, and current flows.</p>
<div class="image"><span epub:type="pagebreak" id="page_49"/><a id="ch02fig2"/><img src="../images/f0049-01.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 2-2:</strong> A normally open pushbutton’s internal connection</p>
<p class="indent"><em>Normally closed</em> pushbuttons have a closed circuit when the button is not being pressed, allowing current to flow through until you press the pushbutton to open the circuit and stop its flow.</p>
<p class="indent">Pushbuttons can have either two or four legs. Four-leg pushbuttons are more common in prototyping projects because they fit well into the breadboard. The right side of <a href="ch02.xhtml#ch02fig2">Figure 2-2</a> shows a diagram of a typical normally open, four-leg pushbutton. Legs 1 and 2 are always connected. The same is true for legs 3 and 4.</p>
<p class="indent">In this project you’ll use a normally open pushbutton with four legs. This pushbutton allows current to flow only <em>while</em> the button is being pressed, so unlike a light switch, the LED in this project will be lit only for the duration that the button is held down.</p>
<h3 class="h3" id="lev36"><span class="green1"><strong>WIRING THE CIRCUIT</strong></span></h3>
<p class="noindent">In this project, you want the LED to turn on only when the button is being pressed, so your Raspberry Pi needs to be able to tell when the button is being pressed and when it isn’t. Your Raspberry Pi will get this information through the GPIO pins.</p>
<p class="indent">Follow these steps to create your circuit, using <a href="ch02.xhtml#ch02fig3">Figure 2-3</a> as a reference:</p>
<ol>
<li class="noindent"><p class="list">Connect GND to the blue power rail.</p></li>
<li class="noindent"><p class="list">Insert an LED into the breadboard and connect the positive LED lead to GPIO 25 through a 330 Ω resistor, as we did in <a href="ch01.xhtml#ch01">Project 1</a>. Connect the negative lead to the GND rail.</p></li>
<li class="noindent"><p class="list">Insert the pushbutton in the middle of the breadboard so that two legs are on either side of the divide. You want to make sure there isn’t a connection between the two top pins and the two bottom pins. (Remember that the connection in the rows of holes is broken in this center strip.)</p></li>
<li class="noindent"><p class="list">Connect one side of the pushbutton to GPIO 2 and the other to GND, as shown in <a href="ch02.xhtml#ch02fig3">Figure 2-3</a>.</p></li>
</ol>
<div class="image"><span epub:type="pagebreak" id="page_50"/><a id="ch02fig3"/><img src="../images/f0050-01.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 2-3:</strong> The LED flashlight circuit</p>
<h3 class="h3" id="lev37"><span class="green1"><strong>WRITING THE SCRIPT</strong></span></h3>
<p class="noindent">This script will trigger different events depending on whether the pushbutton is being pressed or released. The following <em>pseudoscript</em>—a plain English version of the code instructions—should help you understand the Python script. Writing a pseudoscript is a great way to outline your program. Here’s what the program should do:</p>
<ul>
<li class="noindent">When the pushbutton is being pressed, the LED is set to on.</li>
<li class="noindent">When the pushbutton is not being pressed (that is, when it’s released), the LED stays off.</li>
</ul>
<p class="indent">Open <strong>Python 3 (IDLE)</strong> and go to <strong>File</strong> <span class="ent">▸</span> <strong>New File</strong> to create a new script. Copy the following code into the Python Editor and then save the script as <em>led_flashlight.py</em> in the <em>LEDs</em> folder (remember that you can download all the scripts at <em><a href="https://www.nostarch.com/RaspberryPiProject/">https://www.nostarch.com/RaspberryPiProject/</a></em>):</p>
<div class="box">
<pre><span class="ent">➊</span> <span class="orange">from</span> gpiozero <span class="orange">import</span> LED, Button<br/>  <span class="orange">from</span> signal <span class="orange">import</span> pause<br/><br/><span class="ent">➋</span> led = LED(25)<br/>  button = Button(2)<br/><span epub:type="pagebreak" id="page_51"/><span class="ent">➌</span> button.when_pressed = led.on<br/><span class="ent">➍</span> button.when_released = led.off<br/><br/><span class="ent">➎</span> pause()</pre>
</div>
<p class="indent">This script is straightforward to understand. You first import the LED and the Button libraries to control the LED and the pushbutton; then, you import <code>pause</code> from the signal library <span class="ent">➊</span>. The <code>pause()</code> <span class="ent">➎</span> function keeps the program running even after all the code has run through to detect events—in this case, it’s continuously checking the pushbutton state.</p>
<p class="indent">You create an <code>LED</code> object called <code>led</code> that refers to GPIO 25, the pin the LED is connected to, and a <code>Button</code> object called <code>button</code> that refers to GPIO 2, the pin the pushbutton is connected to <span class="ent">➋</span>.</p>
<p class="indent">The <code>button.when_pressed</code> function turns the LED on when the pushbutton is being pressed by calling <code>led.on</code> when a pushbutton press is detected <span class="ent">➌</span>. Likewise, the <code>button.when_released</code> function calls <code>led.off</code> to turn the LED off when the pushbutton is not being pressed <span class="ent">➍</span>.</p>
<p class="indent">Press <strong>F5</strong> or go to <strong>Run</strong> <span class="ent">▸</span> <strong>Run Module</strong> to run the script. The LED should be on while the pushbutton is pressed down. To stop the program, press <small>CTRL</small>-C.</p>
<h3 class="h3" id="lev38"><span class="green1"><strong>TAKING IT FURTHER</strong></span></h3>
<p class="noindent">With what you’ve learned in this simple project, you can create countless other projects. Here are some ideas to test your skills:</p>
<ul>
<li class="noindent">Add more pushbuttons and LEDs.</li>
<li class="noindent">Modify the code to change the LED state when you press the pushbutton so that you don’t have to hold the button to keep the LED lit.</li>
<li class="noindent">Build a traffic light.</li>
</ul>


<h2 class="h2" id="ch03"><span epub:type="pagebreak" id="page_52"/><strong>3<br/>LED Dimmer Switch</strong></h2>
<p class="noindent"><span class="green1">In this project, you’ll build a light dimmer by controlling the brightness of an LED using a potentiometer. The power in this project lies in your ability to read analog inputs with the Raspberry Pi and output pulse-width modulation signals. These will be incredibly useful skills in future projects and in your Pi learning.</span></p>
<div class="image"><span epub:type="pagebreak" id="page_53"/><img src="../images/f0053-01.jpg" alt="image"/></div>
<p class="cap"><span class="green1"><strong>PARTS REQUIRED</strong></span></p>
<p class="cap1">Raspberry Pi</p>
<p class="cap1">Breadboard</p>
<p class="cap1">10 kΩ potent iometer</p>
<p class="cap1">MCP 3008 chip</p>
<p class="cap1">5 mm LED</p>
<p class="cap1">330 Ω resistor</p>
<p class="cap1">Jumper wires</p>
<h3 class="h3" id="lev39"><span epub:type="pagebreak" id="page_54"/><span class="green1"><strong>INTRODUCING POTENTIOMETERS</strong></span></h3>
<p class="noindent">Potentiometers are like power dials and are used in a wide variety of applications in your daily life, such as controlling the volume of the radio, adjusting the brightness of a display, setting the speed on a fan, and much more. The potentiometer you’ll use in this project is shown in <a href="ch03.xhtml#ch03fig1">Figure 3-1</a>.</p>
<div class="image"><a id="ch03fig1"/><img src="../images/f0054-01.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 3-1:</strong> A 10 kΩ potentiometer</p>
<p class="indent">A potentiometer, also referred to as <em>pot</em>, is a manually adjustable variable resistor. This means that you can change the amount of resistance it applies to a circuit by rotating the knob, changing the amount of current reaching a particular component.</p>
<p class="indent">A potentiometer has three pins, as shown in <a href="ch03.xhtml#ch03fig2">Figure 3-2</a>. The two outer pins, shown in blue and red, are connected to a resistive element, while the third, shown in black, is connected to a conductive adjustable <em>wiper</em>.</p>
<div class="image"><a id="ch03fig2"/><img src="../images/f0054-02.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 3-2:</strong> How a potentiometer works</p>
<p class="indent">The position of the wiper determines how much resistance is in the circuit. In this project, you’ll control the resistance in the circuit to make the LED brighter or dimmer.</p>
<h3 class="h3" id="lev40"><span epub:type="pagebreak" id="page_55"/><span class="green1"><strong>READING ANALOG SIGNALS WITH RASPBERRY PI</strong></span></h3>
<p class="noindent">The Raspberry Pi GPIOs can read only digital signals, which means they can read either HIGH (3.3 V ) or LOW (0 V ) but nothing in between. However, the potentiometer is an analog input, and rotating the knob changes its output voltage from 0 V up to 3.3 V. You want the Pi to be able to read all the values in between—like 1 V, 1.4 V, 1.8 V, and so on—so you have gradations of light, not just on and off. For this, you need to convert the analog signal to digital with an analog-to-digital converter chip, and then create imitation analog signals using pulse-width modulation. Let’s go over these two topics before you begin your build.</p>
<h4 class="h4" id="lev41"><span class="green1"><strong>Analog-to-Digital Converters</strong></span></h4>
<p class="noindent">The analog-to-digital converter (ADC) chip (MCP3008), shown in <a href="ch03.xhtml#ch03fig3">Figure 3-3</a>, converts the potentiometer analog signals to digital signals.</p>
<div class="image"><a id="ch03fig3"/><img src="../images/f0055-01.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 3-3:</strong> MCP3008 chip analog-to-digital converter</p>
<p class="indent">This chip has 16 pins, 8 of which are analog inputs you can connect to analog devices. The other 8 connect to the Raspberry Pi GPIOs. The chip pinout is shown in <a href="ch03.xhtml#ch03fig4">Figure 3-4</a>. To identify each pin, orient the chip with the half-circle at the top as shown in the figure.</p>
<div class="image"><a id="ch03fig4"/><img src="../images/f0055-02.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 3-4:</strong> MCP3008 chip</p>
<p class="indent">The following table gives the function for each pin.</p>
<table class="topbot-d">
<thead>
<tr>
<td style="vertical-align: top;" class="border_thb"><p class="tab_th"><span epub:type="pagebreak" id="page_56"/><strong>PIN</strong></p></td>
<td style="vertical-align: top;" class="border_tha"><p class="tab_th"><strong>SYMBOL</strong></p></td>
<td style="vertical-align: top;" class="border_thb"><p class="tab_th"><strong>DESCRIPTION</strong></p></td>
</tr>
</thead>
<tbody>
<tr>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">1</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="green1">CH0</span></p></td>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">Analog input (channel 0)</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">2</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="green1">CH1</span></p></td>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">Analog input (channel 1)</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">3</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="green1">CH2</span></p></td>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">Analog input (channel 2)</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">4</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="green1">CH3</span></p></td>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">Analog input (channel 3)</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">5</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="green1">CH4</span></p></td>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">Analog input (channel 4)</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">6</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="green1">CH5</span></p></td>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">Analog input (channel 5)</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">7</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="green1">CH6</span></p></td>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">Analog input (channel 6)</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">8</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="green1">CH7</span></p></td>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">Analog input (channel 7)</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">9</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="green1">DGND</span></p></td>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">Digital ground</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">10</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="green1">CS/SHDN</span></p></td>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">Chip select/shutdown input</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">11</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="green1">D<sub>IN</sub></span></p></td>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">Serial data in</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">12</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="green1">D<sub>OUT</sub></span></p></td>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">Serial data out</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">13</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="green1">CLK</span></p></td>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">Serial clock</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">14</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="green1">AGND</span></p></td>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">Analog ground</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">15</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="green1">V<sub>REF</sub></span></p></td>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">Reference voltage input</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">16</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="green1">V<sub>DD</sub></span></p></td>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">+2.7 V to 5.5 V power supply</span></p></td>
</tr>
</tbody>
</table>
<h4 class="h4" id="lev42"><span class="green1"><strong>Pulse-Width Modulation</strong></span></h4>
<p class="noindent">As we mentioned earlier, the Raspberry Pi GPIOs can be set to either HIGH or LOW, but they can’t output any voltages in between. However, you can output “fake” mid-level voltages using <em>pulse-width modulation (PWM)</em>, which is how you’ll produce varying levels of LED brightness for this project.</p>
<p class="indent">If you alternate an LED’s voltage between HIGH and LOW very fast, your eyes can’t keep up with the speed at which the LED switches on and off; you’ll simply see some gradations in brightness. That’s basically how PWM works—by producing an output that changes between HIGH and LOW at a very high <em>frequency</em>. The <em>duty cycle</em> is the fraction of the period of time at which the LED is set to HIGH. <a href="ch03.xhtml#ch03fig5">Figure 3-5</a> illustrates how PWM works.</p>
<div class="image"><span epub:type="pagebreak" id="page_57"/><a id="ch03fig5"/><img src="../images/f0057-01.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 3-5:</strong> How PWM works</p>
<p class="indent">A duty cycle of 50 percent results in 50 percent LED brightness, a duty cycle of 0 means the LED is fully off, and a duty cycle of 100 means the LED is fully on. Changing the duty cycle is how you produce different levels of brightness.</p>
<h3 class="h3" id="lev43"><span class="green1"><strong>WIRING THE CIRCUIT</strong></span></h3>
<p class="noindent">For this circuit you’ll need to connect an LED, the MCP3008 chip, and a potentiometer to the Pi. Follow these instructions to build the circuit, using <a href="ch03.xhtml#ch03fig6">Figure 3-6</a> as a reference.</p>
<ol>
<li class="noindent"><p class="list">Connect GND to the blue breadboard rail.</p></li>
<li class="noindent"><p class="list">Connect 3.3 V to the red breadboard rail.</p></li>
<li class="noindent"><p class="list">Insert an LED into the breadboard, connecting the longer LED lead to GPIO 17 through a 330 Ω resistor and the shorter lead to the GND rail.</p></li>
<li class="noindent"><p class="list">Place the MCP3008 chip in the middle of the breadboard and connect it as shown in the following table.</p>
<table class="topbot-d">
<thead>
<tr>
<td style="vertical-align: top;" class="border_thb"><p class="tab_th"><span epub:type="pagebreak" id="page_58"/><strong>MCP3008</strong></p></td>
<td style="vertical-align: top;" class="border_tha"><p class="tab_th"><strong>RASPBERRY PI</strong></p></td>
</tr>
</thead>
<tbody>
<tr>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">1</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="green1">Potentiometer middle lead</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">9</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="green1">GND</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">10</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="green1">GPIO 8</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">11</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="green1">GPIO 10</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">12</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="green1">GPIO 9</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">13</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="green1">GPIO 11</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">14</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="green1">GND</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">15</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="green1">3.3 V</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">16</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="green1">3.3 V</span></p></td>
</tr>
</tbody>
</table>
<div class="note">
<p class="notet"><strong>NOTE</strong></p>
<p class="notep"><em>Before applying power to the circuit, make sure you’ve connected the MCP3008 chip correctly using the pinout in <a href="ch03.xhtml#ch03fig4">Figure 3-4</a>, or you could damage the chip.</em></p>
</div></li>
<li class="noindent"><p class="list">Connect one of the outer leads of the potentiometer to GND and the other to 3.3 V—it doesn’t matter which lead you use for which connection. Connect the middle lead to MCP3008 chip pin 1 if you haven’t already.</p></li>
</ol>
<div class="image"><a id="ch03fig6"/><img src="../images/f0058-01.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 3-6:</strong> Circuit to control the LED brightness with a potentiometer</p>
<h3 class="h3" id="lev44"><span class="green1"><strong>WRITING THE SCRIPT</strong></span></h3>
<p class="noindent">The Pi reads the analog values from the MCP3008 chip using SPI communication, so you’ll need to enable that first.</p>
<p class="indent">From the taskbar main menu, select <strong>Preferences</strong> <span class="ent">▸</span> <strong>Raspberry Pi Configuration</strong>. In the Interfaces tab, enable SPI as shown in <a href="ch03.xhtml#ch03fig7">Figure 3-7</a> and click <strong>OK</strong>.</p>
<div class="image"><span epub:type="pagebreak" id="page_59"/><a id="ch03fig7"/><img src="../images/f0059-01.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 3-7:</strong> Enabling SPI communication</p>
<p class="indent">Your script needs to be able to do the following:</p>
<ul>
<li class="noindent">Read an analog input value from the potentiometer through the MCP3008 chip.</li>
<li class="noindent">Control the brightness of your LED with PWM.</li>
<li class="noindent">Change the duty cycle of the PWM according to the input value read from the potentiometer.</li>
</ul>
<h4 class="h4" id="lev45"><span class="green1"><strong>Entering the Script</strong></span></h4>
<p class="noindent">Open <strong>Python 3 (IDLE)</strong> and go to <strong>File</strong> <span class="ent">▸</span> <strong>New File</strong> to create a new script. Copy the following code to the Python Editor and save the script as <em>brightness_controller.py</em> inside the <em>LEDs</em> folder (remember that you can download all the scripts at <em><a href="https://www.nostarch.com/RaspberryPiProject/">https://www.nostarch.com/RaspberryPiProject/</a></em>):</p>
<div class="box">
<pre>  <span class="red1">#import necessary libraries</span><br/>  <span class="orange">from</span> gpiozero <span class="orange">import</span> PWMLED, MCP3008<br/>  <span class="orange">from</span> time <span class="orange">import</span> sleep<br/><br/>  <span class="red1">#create an object called pot that refers to MCP3008 channel 0</span><br/><span class="ent">➊</span> pot = MCP3008(0)<br/><br/>  <span class="red1">#create a PWMLED object called led that refers to GPIO 17</span><br/><span class="ent">➋</span> led = PWMLED(17)<br/><br/><span class="ent">➌</span> <span class="orange">while True</span>:<br/>      <span class="red1">#pot.value accesses the current pot reading</span><br/>    <span class="ent">➍</span> <span class="orange">if</span>(pot.value &lt; 0.001):<br/>          <span class="red1">#if the pot value is very small, the led is turned off</span><br/>        <span class="ent">➎</span> led.value = 0<br/>    <span class="ent">➏</span> <span class="orange">else</span>:<br/>          <span class="red1">#change led brightness according to the pot value</span><br/>          led.value = pot.value<br/>      <span class="red1">#print the pot value</span><br/>      <span epub:type="pagebreak" id="page_60"/><span class="purple">print</span>(pot.value)<br/>      <span class="red1">#pause for 0.1 seconds</span><br/>      sleep(0.1)</pre>
</div>
<p class="indent">As usual, you start your code by importing the required libraries. Then you create an object called <code>pot</code> <span class="ent">➊</span> that refers to MCP3008 channel 0, the channel the potentiometer is connected to. Channel 0 corresponds to MCP3008 pin 1, channel 1 to pin 2, and so on.</p>
<h5 class="h5"><strong>Setting a PWM Pin and Reading Analog Values</strong></h5>
<p class="noindent">The gpiozero library allows you to control an LED’s brightness with PWM by using a <code>PWMLED</code> object. So at <span class="ent">➋</span>, you create a <code>PWMLED</code> object called <code>led</code> that refers to the pin the LED is connected to, in this case, GPIO17.</p>
<p class="indent">To read an analog value using the gpiozero library, you simply get the potentiometer value with <code>pot.value</code>. Remember that <code>pot</code> refers to MCP3008 channel 0. You’ll get decimal values between <code>0</code> and <code>1</code>.</p>
<h5 class="h5"><strong>Adjusting the Brightness</strong></h5>
<p class="noindent">To adjust the LED brightness using PWM, you need to change its duty cycle. To adjust the duty cycle, you simply have to attribute a value between <code>0</code> and <code>1</code> to the <code>led.value</code>, in which <code>0</code> corresponds to a fully off LED and <code>1</code> to a fully on LED.</p>
<p class="indent">In this script, a <code>while</code> loop <span class="ent">➌</span> that is always <code>True</code> keeps the program running. This loop is constantly checking the potentiometer values: if the value read from the potentiometer is below <code>0.001</code> <span class="ent">➍</span>, the duty cycle is set to <code>0</code>, which turns your LED off <span class="ent">➎</span>. Otherwise, the code enters the <code>else</code> block <span class="ent">➏</span>, in which the duty cycle changes according to the value read from the potentiometer.</p>
<h4 class="h4" id="lev46"><span class="green1"><strong>Running the Script</strong></span></h4>
<p class="noindent">Press <strong>F5</strong> or go to <strong>Run</strong> <span class="ent">▸</span> <strong>Run Module</strong> to run the script. Now you should be able to rotate the potentiometer to control the brightness of the LED.</p>
<h3 class="h3" id="lev47"><span class="green1"><strong>TAKING IT FURTHER</strong></span></h3>
<p class="noindent">Knowing how to read analog values and control output pins with PWM opens you up to a huge variety of projects. Give some of these a try for starters:</p>
<ul>
<li class="noindent">Control several LEDs with the same potentiometer.</li>
<li class="noindent">Build a bar graph of LEDs that you can control with a potentiometer.</li>
<li class="noindent">Control the blinking speed of an LED using a potentiometer.</li>
</ul>


<h2 class="h2" id="ch04"><span epub:type="pagebreak" id="page_61"/><strong>4<br/>A Graphical User Interface for a Multicolor LED</strong></h2>
<p class="noindent"><span class="green1">In this project, we’ll introduce you to the multicolor RGB LED, and you’ll learn how to build a simple graphical user interface in Tkinter to control your electronics.</span></p>
<div class="image"><span epub:type="pagebreak" id="page_62"/><img src="../images/f0062-01.jpg" alt="image"/></div>
<p class="cap"><span class="green1"><strong>PARTS REQUIRED</strong></span></p>
<p class="cap1">Raspberry Pi</p>
<p class="cap1">Breadboard</p>
<p class="cap1">Common cathode RGB LED</p>
<p class="cap1">Three 330 Ω resistors</p>
<p class="cap1">Jumper wires</p>
<h3 class="h3" id="lev48"><span epub:type="pagebreak" id="page_63"/><span class="green1"><strong>INTRODUCING RGB LEDS</strong></span></h3>
<p class="noindent">RGB LEDs are three LEDs in one—red, green, and blue—that can produce almost any color by combining those three colors.</p>
<p class="indent">With an RGB LED you can, of course, produce red, green, and blue light, and by configuring the intensity of each LED, you can produce other colors as well. For example, to produce purely blue light, you’d set the blue LED to the highest intensity and the green and red LEDs to the lowest intensity. For a white light, you’d set all three LEDs to the highest intensity. <a href="ch04.xhtml#ch04fig1">Figure 4-1</a> shows a simplified RGB color-mixing chart to give you an idea of how to combine red, green, and blue to produce different colors.</p>
<div class="image"><a id="ch04fig1"/><img src="../images/f0063-01.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 4-1:</strong> Simple RGB color mixing</p>
<p class="indent">There are two kinds of RGB LEDs: a <em>common cathode</em> LED, where each color LED shares a negative connection, and a <em>common anode</em>, where each LED shares a positive connection. <a href="ch04.xhtml#ch04fig2">Figure 4-2</a> illustrates a common anode and a common cathode LED.</p>
<div class="image"><a id="ch04fig2"/><img src="../images/f0063-02.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 4-2:</strong> Common anode and common cathode RGB LEDs</p>
<p class="indent"><span epub:type="pagebreak" id="page_64"/>RGB LEDs have four leads—one for each LED and another for the common anode or cathode. You can identify each lead by its length, as shown in <a href="ch04.xhtml#ch04fig3">Figure 4-3</a>.</p>
<div class="image"><a id="ch04fig3"/><img src="../images/f0064-01.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 4-3:</strong> Common anode and common cathode RGB LED leads</p>
<p class="indent">With the LED facing you so the anode or cathode (the longest lead) is second from the left, the leads should be in the following order: red, anode or cathode, green, and blue. We’ll be using a common cathode LED for this project, but if you already have a common anode LED it’s fine to use that; just watch out for the differences noted in the circuit wiring.</p>
<h3 class="h3" id="lev49"><span class="green1"><strong>WIRING THE CIRCUIT</strong></span></h3>
<p class="noindent">Wiring an RGB LED to the Raspberry Pi is really straightforward and not much different than wiring a simple LED. You’ll need three current limiting resistors—one for each LED color.</p>
<p class="indent">Follow these instructions, using <a href="ch04.xhtml#ch04fig4">Figure 4-4</a> as a reference.</p>
<ol>
<li class="noindent"><p class="list">Connect the LED pins in the breadboard and add a 330 Ω current-limiting resistor in series for each color lead.</p></li>
<li class="noindent"><p class="list">Connect GND to the breadboard blue rail, and wire the RGB LED to the Raspberry Pi’s GPIO according to the following table, with red connected to GPIO 23, the cathode to GND, green to GPIO 24, and blue to GPIO 25. Check <a href="ch04.xhtml#ch04fig3">Figure 4-3</a> to make sure you’re orienting the LED correctly.</p></li>
</ol>
<div class="note">
<p class="notet"><strong>NOTE</strong></p>
<p class="notep">If you’re using a common anode RGB LED, connect the longest lead (the anode) to 3.3 V.</p>
</div>
<table class="topbot-d">
<thead>
<tr>
<td style="vertical-align: top;" class="border_thb"><p class="tab_th"><span epub:type="pagebreak" id="page_65"/><strong>RGB LED</strong></p></td>
<td style="vertical-align: top;" class="border_tha"><p class="tab_th"><strong>RASPBERRY PI</strong></p></td>
</tr>
</thead>
<tbody>
<tr>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">First lead: red</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="green1">GPIO 23</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">Second lead: cathode</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="green1">GND</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">Third lead: green</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="green1">GPIO 24</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">Fourth lead: blue</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="green1">GPIO 25</span></p></td>
</tr>
</tbody>
</table>
<div class="image"><a id="ch04fig4"/><img src="../images/f0065-01.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 4-4:</strong> Wiring a common cathode RGB LED to the Raspberry Pi</p>
<h3 class="h3" id="lev50"><span class="green1"><strong>WRITING THE SCRIPT</strong></span></h3>
<p class="noindent">In your script, you’ll use a library called Tkinter to create a user interface window in your desktop environment that you can use to control the RGB LED. Tkinter is already installed with your Raspbian system, so you just need to import it in your script.</p>
<p class="indent">The interface window will have three sliders (with values of <code>0</code> to <code>1</code>) to control the intensity of the built-in red, green, and blue LEDs, and a close button to shut down the program. By adjusting the values’ intensities with the sliders, you can change the color of the RGB LED.</p>
<p class="indent"><span epub:type="pagebreak" id="page_66"/>Now, open <strong>Python 3 (IDLE)</strong> and go to <strong>File</strong> <span class="ent">▸</span> <strong>New File</strong> to create a new script. Then, enter the following code into the Python Editor and save the script as <em>rgb_led_controller.py</em> inside the <em>LEDs</em> folder (remember that you can download all the scripts at <em><a href="https://www.nostarch.com/RaspberryPiProject/">https://www.nostarch.com/RaspberryPiProject/</a></em>):</p>
<div class="box">
<pre>  <span class="red1">#import necessary libraries</span><br/><span class="ent">➊</span> <span class="orange">from</span> gpiozero <span class="orange">import</span> PWMLED<br/>  <span class="orange">from</span> tkinter <span class="orange">import</span> *<br/><br/>  <span class="red1">#change the RGB LED color</span><br/><span class="ent">➎</span> <span class="orange">def</span> <span class="blue">change_color</span>(self):<br/>      red.value = red_slider.get()<br/>      green.value = green_slider.get()<br/>      blue.value = blue_slider.get()<br/>      <span class="purple">print</span>(self)<br/><br/>  <span class="red1">#close the window</span><br/><span class="ent">➌</span> <span class="orange">def</span> <span class="blue">close_window()</span>:<br/>      window.destroy()<br/><br/><br/>  <span class="red1">#create a PWMLED object for each color</span><br/><span class="ent">➍</span> red = PWMLED(23)<br/>  green = PWMLED(24)<br/>  blue = PWMLED(25)<br/><br/>  <span class="red1">#create window</span><br/><span class="ent">➎</span> window = Tk()<br/>  window.title(<span class="green">'RGB LED Controller'</span>)<br/>  window.geometry(<span class="green">'300x200'</span>)<br/><br/>  <span class="red1">#create three sliders to control each RGB LED lead</span><br/><span class="ent">➏</span> red_slider = Scale(window, from_=0, to=1, resolution = 0.01,<br/>  orient=HORIZONTAL, label=<span class="green">'Red'</span>, troughcolor=<span class="green">'red'</span>, length=200,<br/>  command=change_color)<br/>  red_slider.pack()<br/><br/>  green_slider = Scale(window, from_=0, to=1, resolution = 0.01,<br/>  orient=HORIZONTAL, label=<span class="green">'Green'</span>, troughcolor=<span class="green">'green'</span>, length=200,<br/>  command=change_color)<br/>  green_slider.pack()<br/><br/>  blue_slider = Scale(window, from_=0, to=1, resolution = 0.01,<br/>  orient=HORIZONTAL, label=<span class="green">'Blue'</span>, troughcolor=<span class="green">'blue'</span>, length=200,<br/>  command=change_color)<br/>  blue_slider.pack()<br/><br/>  <span class="red1">#create close button</span><br/><span class="ent">➐</span> close_button = Button(window, text=<span class="green">'Close'</span>, command=close_window)<br/>  close_button.pack()<br/><br/><span class="ent">➑</span> mainloop()</pre>
</div>
<div class="box2">
<p class="box-title" id="ch04box1"><span epub:type="pagebreak" id="page_67"/><span class="green1"><strong>USER-DEFINED FUNCTIONS</strong></span></p>
<p class="box-p">To define a new function, you use the word <code>def</code> followed by the name you want to give the function and a set of parentheses.</p>
<p class="box-pi">After the parentheses you add a colon (<code>:</code>) and then tell the function what instructions to perform. Python knows which instructions are part of the function definition by the use of the colon and indentation: every indented line after the colon is part of the function. Later, you can run the instructions you’ve set inside the function by entering the name of the function, also known as <em>calling</em> the function.</p>
</div>
<p class="indent">First, you import <code>PWMLED</code> from the gpiozero library to control the LED with PWM, and import the tkinter library to build the user interface <span class="ent">➊</span>. Next, you create the function to control the LED color. Remember that a function is basically a block of reusable code that will perform a certain action. Python has many built-in functions, like <code>print()</code>, <code>int()</code>, and <code>input()</code>, but you can also build your own <em>user-defined functions</em>, as in this script. Read the <a href="ch04.xhtml#ch04box1">“User-Defined Functions”</a> box to learn more.</p>
<h4 class="h4" id="lev51"><span class="green1"><strong>Controlling the Intensity and Closing the Window</strong></span></h4>
<p class="noindent">The <code>change_color()</code> function <span class="ent">➋</span> changes the LED’s duty cycle as you adjust the value of the slider, which in turn changes the intensity of the LED and therefore the color it produces. This function is called every time the sliders move, so you should see an instantaneous change on the LED when you move the slider. At <span class="ent">➍</span>, you create <code>PWMLED</code> objects to refer to each color of the RGB LED.</p>
<p class="indent">The <code>close_window()</code> function <span class="ent">➌</span> closes the window with <code>window.destroy()</code>. This function is called when you press the Close button in the Tkinter interface. We’ll look at how to create the Tkinter interface next.</p>
<h4 class="h4" id="lev52"><span class="green1"><strong>Designing the User Interface with Tkinter</strong></span></h4>
<p class="noindent">At <span class="ent">➎</span>, you define the main window of your interface. You create a variable called <code>window</code> that is a <code>tkinter</code> window with the line <code>window = Tk()</code>. You then give your window a title and set the window dimensions with the <code>title()</code> and <code>geometry()</code> methods, respectively.</p>
<h5 class="h5"><span epub:type="pagebreak" id="page_68"/><strong>Creating Sliders and Buttons</strong></h5>
<p class="noindent">After creating the window, you can start adding the controls, known as <em>widgets</em>, like buttons, labels, and sliders. You’re using a <code>Button</code> widget to close the window and three <code>Scale</code> widgets to add the sliders to your window.</p>
<p class="indent">You then create three sliders, one for each RGB color <span class="ent">➏</span>, using the following syntax:</p>
<div class="box">
<pre><em>slider_name</em> = Scale(<em>master</em>, <em>option</em>, <em>option</em>, ...)</pre>
</div>
<p class="indent">The <span class="codeitalic">master</span> argument is the window you’ll add the widget to, and each <span class="codeitalic">option</span> argument allows you to personalize your sliders. In the <em>rgb_led_controller.py</em> script, you use the following options:</p>
<ul>
<li class="noindent"><code>from_</code> defines the lower end of the scale’s range.</li>
<li class="noindent"><code>to</code> defines the upper end of the scale’s range. In our case, the range is 0 to 1.</li>
<li class="noindent"><code>resolution</code> sets the resolution of the slider—the minimum difference between two consecutive values. Here, the resolution is <code>0.01</code>.</li>
<li class="noindent"><code>orient</code> defines the slider orientation, either <code>HORIZONTAL</code> or <code>VERTICAL</code>. This script sets the sliders to <code>HORIZONTAL</code>.</li>
<li class="noindent"><code>label</code> sets the slider label. You label each slider in this script according to the LED color it controls.</li>
<li class="noindent"><code>troughcolor</code> sets the background color of the slider. Each slider background is the color of the LED it controls.</li>
<li class="noindent"><code>length</code> defines the length of the slider in pixels. All of the sliders are set to <code>200</code>.</li>
<li class="noindent"><code>command</code> dictates the procedure that will be called every time the slider is moved. In this case, moving the slider calls the <code>change_color()</code> function, which changes the LED’s duty cycle and thus the color it produces.</li>
</ul>
<p class="indent">After creating the slider, you use the <code>pack()</code> method to place the widgets in the main <code>window</code>. As you’re not passing any argument to the <code>pack()</code> method, the widgets are placed in the window according to the default settings: widgets fill only their minimal dimension, and they are packed against the top of the window or against the widget above.</p>
<p class="indent">Next, you create the Close button <span class="ent">➐</span> using the following syntax:</p>
<div class="box">
<pre><em>Button_name</em> = Button(<em>master</em>, <em>option</em>, <em>option</em>, ...)</pre>
</div>
<p class="indent"><span epub:type="pagebreak" id="page_69"/>In your code, you use these options:</p>
<ul>
<li class="noindent"><code>text</code> defines the text that will be displayed on the button.</li>
<li class="noindent"><code>command</code> dictates the procedure that will be called when the button is pressed—here, the <code>close_window()</code> function, which closes the window.</li>
</ul>
<h5 class="h5"><strong>Using the Main Loop</strong></h5>
<p class="noindent">The script’s final statement calls the <code>mainloop()</code> function <span class="ent">➑</span>, which is an infinite loop that allows windows to be drawn and events to be processed. The <code>mainloop()</code> function is what keeps your program running.</p>
<h4 class="h4" id="lev53"><span class="green1"><strong>Running the Script</strong></span></h4>
<p class="noindent">Press <strong>F5</strong> or go to <strong>Run</strong> <span class="ent">▸</span> <strong>Run Module</strong> to run the script. Your interface window should pop up, as shown in <a href="ch04.xhtml#ch04fig5">Figure 4-5</a>.</p>
<div class="image"><a id="ch04fig5"/><img src="../images/f0069-01.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 4-5:</strong> The RGB LED controller user interface</p>
<p class="indent">Congratulations! You’ve made your own component user interface! Now try moving the sliders to change the LED color. When you change each slider’s position, the RGB LED color should change accordingly.</p>
<p class="indent">To close the program, just press the Close button.</p>
<h3 class="h3" id="lev54"><span class="green1"><strong>TAKING IT FURTHER</strong></span></h3>
<p class="noindent">Now that you know how to make a graphical user interface, we encourage you to edit its parameters to customize its look to suit your tastes. Here are some other project ideas you could try:</p>
<ul>
<li class="noindent">Build a graphical user interface that controls turning an LED on and off.</li>
<li class="noindent">Make a graphical user interface that controls the brightness of the LED.</li>
<li class="noindent">Alter the user interface to control several LEDs.</li>
</ul>


<h2 class="h2" id="ch05"><span epub:type="pagebreak" id="page_70"/><strong>5<br/>Rainbow Light Strip</strong></h2>
<p class="noindent"><span class="green1">In this project you’ll create a rainbow light effect using an addressable RGB LED strip. You’ll use a pushbutton to start and stop the rainbow effect, and you’ll control the rainbow’s speed and brightness using two potentiometers.</span></p>
<div class="image"><span epub:type="pagebreak" id="page_71"/><img src="../images/f0071-01.jpg" alt="image"/></div>
<p class="cap"><span class="green1"><strong>PARTS REQUIRED</strong></span></p>
<p class="cap1">Raspberry Pi</p>
<p class="cap1">Breadboard</p>
<p class="cap1">WS2812B addressable RGB LED strip</p>
<p class="cap1">Logic level conver ter module BSS 138</p>
<p class="cap1">Two 10 kΩ potentiometers</p>
<p class="cap1">MCP 3 008 chip</p>
<p class="cap1">Pushbutton</p>
<p class="cap1">Three header pins</p>
<p class="cap1">Jumper wires</p>
<p class="cap"><span class="green1"><strong>SOFTWARE REQUIRED</strong></span></p>
<p class="cap1">WS2 81X library</p>
<h3 class="h3" id="lev55"><span epub:type="pagebreak" id="page_72"/><span class="green1"><strong>INTRODUCING THE WS2812B ADDRESSABLE RGB LED STRIP</strong></span></h3>
<p class="noindent">For the rainbow light effect, you’ll use the WS2812B RGB LED strip, which is available in many different sizes. The strip comes in a reel, as shown in <a href="ch05.xhtml#ch05fig1">Figure 5-1</a>, and you can cut off as long a section as you need.</p>
<div class="image"><a id="ch05fig1"/><img src="../images/f0072-01.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 5-1:</strong> WS2812B addressable RGB LED strip on a reel</p>
<p class="indent">The strip shown in <a href="ch05.xhtml#ch05fig1">Figure 5-1</a> is 5 meters long with 300 addressable WS2812B RGB LEDs wired in series, and later you’ll cut a section of 14 LEDs to use in this project. There are cutting marks, shown in <a href="ch05.xhtml#ch05fig2">Figure 5-2</a>, along the entire length of the strip.</p>
<div class="image"><a id="ch05fig2"/><img src="../images/f0072-02.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 5-2:</strong> WS2812B addressable RGB LED strip pins</p>
<p class="indent">The color and brightness of each LED can be controlled individually, allowing you to produce amazing effects easily. Each LED has an integrated circuit (IC) built right in, which means you can control the whole strip using just one GPIO pin, connected to the middle pin—the Data pin—at the end of the strip (see <a href="ch05.xhtml#ch05fig2">Figure 5-2</a>).</p>
<p class="indent"><span epub:type="pagebreak" id="page_73"/>Prepare the LED strip for this project as follows:</p>
<ol>
<li class="noindent"><p class="list">Cut a strip of 14 LEDs along the cutting marks shown on the strip.</p></li>
<li class="noindent"><p class="list">Solder header pins to the 5 V, Data, and GND pins as shown in <a href="ch05.xhtml#ch05fig2">Figure 5-2</a>.</p></li>
</ol>
<div class="note">
<p class="notet"><strong>NOTE</strong></p>
<p class="notep"><em>We’ve found that a Raspberry Pi 5 V pin (such as pin 2 or pin 4) is capable of powering a strip of 20 LEDs or fewer, but in projects where you’re using a longer strip, you’ll need to use an external 5 V power supply to provide enough current.</em></p>
</div>
<p class="indent">Now you need to figure out your power supply. The LED strip requires a 5 V power source. You can determine the amps you need from the amount of power each LED requires. An individual LED draws up to 60 mA at full brightness (which produces white light), but since you’ll rarely need all LEDs at their maximum value for any length of time, you can safely estimate 20 mA per LED. So if your strip is 14 LEDs long, you’ll need a 5 V power source with approximately 20 × 14 = 280 mA.</p>
<p class="indent">The Data pin that controls the strip needs a 5 V signal, but the Pi GPIOs operate at 3.3 V. To get the 5 V you need, you’ll use a component called a logic level converter.</p>
<h3 class="h3" id="lev56"><span class="green1"><strong>INTRODUCING THE LOGIC LEVEL CONVERTER</strong></span></h3>
<p class="noindent">A <em>logic level converter</em> allows you to convert 3.3 V signals to 5 V signals. There are many types of logic level converter, but in this project you’ll use the two-channel logic level converter bidirectional module shown in <a href="ch05.xhtml#ch05fig3">Figure 5-3</a>. (To find the same logic level converter module we’re using, search online for <em>logic level converter module bss138</em>.)</p>
<p class="indent">The bidirectionality of this module allows you to convert data in both ways—from 3.3 V to 5 V and from 5 V to 3.3 V. You won’t need to convert 5 V to 3.3 V in this project, but having this more flexible model in your toolkit (versus a unidirectional model) can come in handy for future projects. This logic level converter also has two channels, channel 1 and channel 2. In this project you’ll use only one of the channels to control the LED strip’s Data pin.</p>
<div class="image"><a id="ch05fig3"/><img src="../images/f0073-01.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 5-3:</strong> Two-channel logic level converter bidirectional module</p>
<p class="indent"><span epub:type="pagebreak" id="page_74"/>More likely than not, your module will come with the header pins separate, so you’ll need to solder the pins to it to make it breadboard-friendly. Break off two rows of six header pins, and solder one pin to each tiny hole.</p>
<p class="indent">The module has a low-voltage side (left side of <a href="ch05.xhtml#ch05fig3">Figure 5-3</a>), to which you attach everything that’s at 3.3 V, and a high-voltage side (right side), where you attach everything at 5 V. For this project, you need to use one of the pins highlighted in red, as you want to send 3.3 V data and convert it to 5 V.</p>
<p class="indent">To use the logic level converter, connect GND on both sides, 3.3 V on the low-voltage side, and 5 V on the high-voltage side. Then, connect data from the Pi on one of the TX1 pins—you can use either channel 1 or channel 2—and get the 5 V data on the corresponding TX0 pin.</p>
<h3 class="h3" id="lev57"><span class="green1"><strong>WIRING THE CIRCUIT</strong></span></h3>
<p class="noindent">At this point, you should have cut your strip to size (14 LEDs) and soldered header pins both to the end of the strip and to the logic level converter. Now you’re ready to wire the circuit. To do so, you’ll connect together a pushbutton, two potentiometers via the MCP3008 chip, and the addressable RGB LED strip using the logic level converter module, as shown in <a href="ch05.xhtml#ch05fig4">Figure 5-4</a>.</p>
<div class="image"><a id="ch05fig4"/><img src="../images/f0074-01.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 5-4:</strong> Circuit for controlling the RGB LED strip</p>
<div class="note">
<p class="notet"><span epub:type="pagebreak" id="page_75"/><span class="red"><strong>WARNING</strong></span></p>
<p class="notep"><em>Remember that you can’t connect 5 V to the Pi GPIOs, as that can permanently damage your board.</em></p>
</div>
<div class="note">
<p class="notet"><strong>NOTE</strong></p>
<p class="notep"><em>To identify the MCP3008 pins, orient the chip so it’s facing you with the half-circle cutout at the top. The first pin is the top left and the last pin is the top right. See <a href="ch03.xhtml#lev41">“Analog-to-Digital Converters”</a> on <a href="ch03.xhtml#page_55">page 55</a> for a full MCP3008 pinout description.</em></p>
</div>
<ol>
<li class="noindent"><p class="list">Connect the GND and 3.3 V pins to the breadboard rails.</p></li>
<li class="noindent"><p class="list">Insert the MCP3008 chip in the middle of the breadboard with the two sides straddling the center divide.</p></li>
<li class="noindent"><p class="list">Insert two potentiometers in the breadboard, wiring one’s outer lead to GND and the other’s outer lead to 3.3 V.</p></li>
<li class="noindent"><p class="list">Connect the MCP3008 chip as shown in the following table. It doesn’t matter which potentiometer you connect to which pins; they will work the same way.</p>
<table class="topbot-d">
<thead>
<tr>
<td style="vertical-align: top;" class="border_thb"><p class="tab_th"><strong>MCP3008</strong></p></td>
<td style="vertical-align: top;" class="border_tha"><p class="tab_th"><strong>CONNECT TO</strong></p></td>
</tr>
</thead>
<tbody>
<tr>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">1</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="green1">One potentiometer’s middle lead</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">2</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="green1">Other potentiometer’s middle lead</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">9</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="green1">GND</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">10</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="green1">GPIO 8</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">11</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="green1">GPIO 10</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">12</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="green1">GPIO 9</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">13</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="green1">GPIO 11</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">14</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="green1">GND</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">15</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="green1">3.3 V</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">16</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="green1">3.3 V</span></p></td>
</tr>
</tbody>
</table></li>
<li class="noindent"><p class="list">Insert a pushbutton into the breadboard, straddling the center divide. On one side of the center divide, connect one pin to GND and the other pin to GPIO 2.</p></li>
<li class="noindent"><p class="list">Insert the RGB LED strip pins into the breadboard.</p></li>
<li class="noindent"><p class="list">Insert the logic level converter into the breadboard. Connect the low-voltage side as directed.</p>
<table class="topbot-d">
<thead>
<tr>
<td style="vertical-align: top;" class="border_thb"><p class="tab_th"><strong>LOGIC LEVEL CONVERTER</strong></p></td>
<td style="vertical-align: top;" class="border_tha"><p class="tab_th"><strong>RASPBERRY PI</strong></p></td>
</tr>
</thead>
<tbody>
<tr>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">TX1 (channel 2)</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="green1">GPIO 18</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">LV</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="green1">3.3 V</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">GND</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="green1">GND</span></p></td>
</tr>
</tbody>
</table></li>
<li class="noindent"><p class="list"><span epub:type="pagebreak" id="page_76"/>Connect the high-voltage side as directed.</p>
<table class="topbot-d">
<thead>
<tr>
<td style="vertical-align: top;" class="border_thb"><p class="tab_th"><strong>LOGIC LEVEL CONVERTER</strong></p></td>
<td style="vertical-align: top;" class="border_tha"><p class="tab_th"><strong>CONNECT TO</strong></p></td>
</tr>
</thead>
<tbody>
<tr>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">TX0 (channel 2)</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="green1">RGB LED strip’s Data pin (middle pin)</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">HV</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="green1">5 V</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">GND</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="green1">GND</span></p></td>
</tr>
</tbody>
</table></li>
<li class="noindent"><p class="list">With the logic level converter connected, connect the RGB LED strip as directed.</p>
<table class="topbot-d">
<thead>
<tr>
<td style="vertical-align: top;" class="border_thb"><p class="tab_th"><strong>RGB LED STRIP</strong></p></td>
<td style="vertical-align: top;" class="border_tha"><p class="tab_th"><strong>CONNECT TO</strong></p></td>
</tr>
</thead>
<tbody>
<tr>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">5 V</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="green1">5 V</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">Din</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="green1">Logic level converter TX0 pin</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-ca"><p class="tabc"><span class="green1">GND</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="green1">GND</span></p></td>
</tr>
</tbody>
</table></li>
</ol>
<div class="note">
<p class="notet"><strong>NOTE</strong></p>
<p class="notep"><em>If you choose to do this project with a strip of more than 20 LEDs, you’ll need to connect your 5 V power source to the strip’s 5 V pin and the GND power source to the GND rail.</em></p>
</div>
<h3 class="h3" id="lev58"><span class="green1"><strong>WRITING THE SCRIPT</strong></span></h3>
<p class="noindent">This script relies on the WS281X library to control the individual LEDs, so you need to install that library and then enable the Serial Peripheral Interface (SPI) communication the strip needs to communicate with the Pi.</p>
<h4 class="h4" id="lev59"><span class="green1"><strong>Installing the WS281X Library</strong></span></h4>
<p class="noindent">There are a few steps to installing the WS281X library, as it requires you to set up the libraries it depends on first.</p>
<ol>
<li class="noindent"><p class="list">Open a terminal window and install the scons, python3-dev, and swig libraries:</p>
<div class="box">
<pre>pi@raspberrypi:~ $ <span class="codestrong">sudo apt install scons python3-dev swig</span></pre>
</div></li>
<li class="noindent"><p class="list">Still in the terminal, navigate to the desktop, create a folder called <em>Libraries</em>, and then navigate to the newly created folder:</p>
<div class="box">
<pre>pi@raspberrypi:~ $ <span class="codestrong">cd ~/Desktop</span><br/>pi@raspberrypi:~/Desktop $ <span class="codestrong">mkdir Libraries</span><br/>pi@raspberrypi:~/Desktop $ <span class="codestrong">cd Libraries</span><br/>pi@raspberrypi:~/Desktop/Libraries $</pre>
</div></li>
<li class="noindent"><p class="list">Clone the library to download it.</p>
<div class="box">
<pre><span epub:type="pagebreak" id="page_77"/>pi@raspberrypi:~/Desktop/Libraries $ <span class="codestrong">git clone https://</span><br/><span class="codestrong">github.com/jgarff/rpi_ws281x.git</span></pre>
</div></li>
<li class="noindent"><p class="list">Move to the <em>rpi_ws281x</em> library folder and run the <code>scons</code> command:</p>
<div class="box">
<pre>pi@raspberrypi:~/Desktop/Libraries $ <span class="codestrong">cd rpi_ws281x</span><br/>pi@raspberrypi:~/Desktop/Libraries/rpi_ws281x $ <span class="codestrong">sudo scons</span></pre>
</div></li>
<li class="noindent"><p class="list">Navigate to the <em>python</em> folder and install the WS281X library on your Pi:</p>
<div class="box">
<pre>pi@raspberrypi:~/Desktop/Libraries/rpi_ws281x $ <span class="codestrong">cd python</span><br/>pi@raspberrypi:~/Desktop/Libraries/rpi_ws281x/python $ <span class="codestrong">sudo</span><br/><span class="codestrong">python3 setup.py install</span></pre>
</div></li>
</ol>
<p class="indent">Now you’re ready to use the WS281X library in your code.</p>
<h4 class="h4" id="lev60"><span class="green1"><strong>Enabling SPI Communication</strong></span></h4>
<p class="noindent">To communicate with the MCP3008 chip, you need to enable SPI communication. Go to the taskbar main menu and select <strong>Preferences</strong> <span class="ent">▸</span> <strong>Raspberry Pi Configuration</strong>. In the Interfaces tab, click <strong>Enabled</strong> in the SPI row, as shown in <a href="ch05.xhtml#ch05fig5">Figure 5-5</a>, and then click <strong>OK</strong>.</p>
<div class="image"><a id="ch05fig5"/><img src="../images/f0077-01.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 5-5:</strong> Enabling SPI communication</p>
<h4 class="h4" id="lev61"><span class="green1"><strong>ENTERING THE SCRIPT</strong></span></h4>
<p class="noindent">Let’s recap how the circuit works to help you better understand the script before entering it:</p>
<ul>
<li class="noindent">Your RGB LED strip displays a moving rainbow.</li>
<li class="noindent">One potentiometer controls the rainbow speed.</li>
<li class="noindent">Another potentiometer controls the rainbow brightness.</li>
<li class="noindent">The pushbutton starts and stops the rainbow animation.</li>
</ul>
<div class="box2">
<p class="box-title"><span epub:type="pagebreak" id="page_78"/><span class="green1"><strong>TROUBLESHOOTING CRAZY PIXELS</strong></span></p>
<p class="box-p">At the time of this writing, there is an issue with the strip pixels on newer versions of Raspbian. The pin used to control the strip is shared with analog audio output, so the pixels can go crazy and not work properly. If this happens when you load the code, you need to add two lines to the <em>config.txt</em> file. Go to the terminal and enter the following:</p>
<div class="box">
<pre>pi@raspberrypi:~ $ <span class="codestrong">sudo nano /boot/config.txt</span></pre>
</div>
<p class="box-pi">In the file that opens, add the following two lines (anywhere should be fine):</p>
<div class="box">
<pre>hdmi_force_hotplug = 1<br/>hdmi_force_edid_audio = 1</pre>
</div>
<p class="box-pi">Press <small>CTRL</small>-X to save the file and then, when prompted, type <strong>Y</strong> and press <small>ENTER</small>. Reboot your Pi for the changes to take effect, and then proceed to the library installation.</p>
</div>
<p class="indent">Open <strong>Python 3 (IDLE)</strong> and go to <strong>File</strong> <span class="ent">▸</span> <strong>New File</strong> to create a new script. Copy the code in <a href="ch05.xhtml#ch05list1">Listing 5-1</a> to the Python Editor and save the script as <em>rainbow_effect.py</em> inside the <em>LEDs</em> folder (remember that you can download all the scripts at <em><a href="https://www.nostarch.com/RaspberryPiProject/">https://www.nostarch.com/RaspberryPiProject/</a></em>):</p>
<p class="listing" id="ch05list1"><strong>LISTING 5-1:</strong> The Rainbow Strip <em>rainbow_effect.py</em> code</p>
<div class="box">
<pre>  <span class="red1">#based on Tony DiCola's NeoPixel library strandtest example</span><br/><br/>  <span class="red1">#import necessary libraries</span><br/><span class="ent">➊</span> <span class="orange">from</span> neopixel <span class="orange">import</span> *<br/>  <span class="orange">from</span> time <span class="orange">import</span> sleep<br/>  <span class="orange">from</span> gpiozero <span class="orange">import</span> Button, MCP3008<br/><br/>  <span class="red1">#LED strip configuration</span><br/><span class="ent">➋</span> LED_COUNT = 14 <span class="red1">#number of LED pixels</span><br/>  LED_PIN = 18 <span class="red1">#GPIO pin connected to the pixels (must support PWM!)</span><br/>  LED_FREQ_HZ = 800000 <span class="red1">#LED signal frequency in Hz (usually 800 kHz)</span><br/>  LED_DMA = 5 <span class="red1">#DMA channel to use for generating signal (try 5)</span><br/>  LED_INVERT = <span class="orange">False</span> <span class="red1">#set True to invert the signal</span><br/><br/>  <span class="red1">#create pot objects to refer to MCP3008 channel 0 and 1</span><br/><span class="ent">➌</span> pot_brightness = MCP3008(0)<br/>  pot_speed = MCP3008(1)<br/><br/><span epub:type="pagebreak" id="page_79"/>  <span class="red1">#connect pushbutton to GPIO 2, pull-up</span><br/>  button_start = Button(2)<br/><br/>  <span class="red1">#animation running control variable</span><br/>  running_animation = <span class="orange">False</span><br/><br/>  <span class="red1">#generate rainbow colors across 0-255 positions</span><br/><span class="ent">➍</span> <span class="orange">def</span> <span class="blue">wheel</span>(pos):<br/>      <span class="orange">if</span> pos &lt; 85:<br/>          <span class="orange">return</span> Color(pos * 3, 255 - pos * 3, 0)<br/>      <span class="orange">elif</span> pos &lt; 170:<br/>          pos -= 85<br/>          <span class="orange">return</span> Color(255 - pos * 3, 0, pos * 3)<br/>      <span class="orange">else</span>:<br/>          pos -= 170<br/>          <span class="orange">return</span> Color(0, pos * 3, 255 - pos * 3)<br/><br/>  <span class="red1">#draw rainbow that uniformly distributes itself across all pixels</span><br/><span class="ent">➎</span> <span class="orange">def</span> <span class="blue">rainbowCycle</span>(strip):<br/>      <span class="orange">for</span> j <span class="orange">in</span> <span class="purple">range</span>(256):<br/>          <span class="orange">for</span> i <span class="orange">in</span> <span class="purple">range</span>(strip.numPixels()):<br/>              strip.setPixelColor(i, wheel((<span class="purple">int</span>(i * 256 /<br/>  strip.numPixels()) + j) &amp; 255))<br/>          strip.show()<br/><span class="ent">➏</span>         sleep((pot_speed.value*40)/1000.0)<br/><br/>  <span class="red1">#function to start and stop the animation</span><br/><span class="ent">➐</span> <span class="orange">def</span> <span class="blue">start_animation</span>():<br/>      <span class="orange">global</span> running_animation<br/>      <span class="orange">if</span> running_animation == <span class="orange">True</span>:<br/>          running_animation = <span class="orange">False</span><br/>      <span class="orange">else</span>:<br/>          running_animation = <span class="orange">True</span><br/><br/>  <span class="red1">#assign a function that runs when the button is pressed</span><br/><span class="ent">➑</span> button_start.when_pressed = start_animation<br/><br/>  <span class="red1">#create NeoPixel object with appropriate configuration</span><br/><span class="ent">➒</span> strip = Adafruit_NeoPixel(LED_COUNT, LED_PIN, LED_FREQ_HZ, LED_DMA,<br/>  LED_INVERT, <span class="purple">int</span>(pot_brightness.value*255))<br/><br/>  <span class="red1">#initialize the strip</span><br/>  strip.begin()<br/><span class="ent">➓</span> <span class="orange">while True</span>:<br/>      <span class="orange">if</span> running_animation == <span class="orange">True</span>:<br/>          <span class="red1">#set LED strip brightness</span><br/>          strip.setBrightness(int(pot_brightness.value*255))<br/>          rainbowCycle(strip)</pre>
</div>
<p class="indent">First, you import the libraries you’ll use to control the project <span class="ent">➊</span>. You need the neopixel library to control the LED strip, the time library to import the <code>sleep()</code> function for controlling the delay time, and from <span epub:type="pagebreak" id="page_80"/>gpiozero you import the <code>Button()</code> and <code>MCP3008()</code> interfaces to read the pushbutton and potentiometer values, respectively.</p>
<h5 class="h5"><strong>Setting the Strip Parameters</strong></h5>
<p class="noindent">At <span class="ent">➋</span>, you create variables for configuring the RGB LED strip, including the number of LEDs and the GPIO pin used. Then, at <span class="ent">➌</span>, you create objects to refer to the two potentiometers, with the brightness on MCP3008 channel 0 (pin 1) and the speed on MCP3008 channel 1 (pin 2), and an object for the button on GPIO 2. You also create a variable for starting and stopping the animation called <code>running_animation</code>, which takes a Boolean and is <code>False</code> (off ) by default.</p>
<h5 class="h5"><strong>Creating the Rainbow Effect Functions</strong></h5>
<p class="noindent">At <span class="ent">➍</span> and <span class="ent">➎</span>, you create the functions that produce the moving rainbow effect. These functions are the same as the ones used in the <em>strandtest.py</em> example that comes with the neopixel library. In simple terms, the <code>wheel()</code> function generates the color spectrum by varying each color parameter between 0 and 255. Each color is composed of red, green, and blue (RGB) parameters, and varying each parameter between 0 and 255 produces different colors, resulting in a rainbow effect. The <code>rainbowCycle()</code> function distributes the rainbow across the number of LEDs on your strip.</p>
<p class="indent">The line at <span class="ent">➏</span> sets the delay time for the <code>sleep()</code> function. To calculate the delay time, you multiply the value read from one of the potentiometers (which is between 0 and 1) by 40 and then divide that result by 1,000. Multiplying the potentiometer value by 40 produces a noticeable delay time; otherwise, the delay would be so short that the rainbow effect would happen too fast for you to detect the movement of the lights. Dividing by 1,000 gives you a delay time in milliseconds.</p>
<h5 class="h5"><strong>Controlling the Pushbutton</strong></h5>
<p class="noindent">Using the gpiozero library, you assign a particular action to a pushbutton press as follows:</p>
<div class="box">
<pre>button.when_pressed = <em>function_name</em></pre>
</div>
<p class="indent">The <span class="codeitalic">function_name</span> function refers to a generic function that will be called when the button is pressed; that function must be defined before it is called. In this case, that function is <code>start_animation</code> <span class="ent">➑</span>, defined at <span class="ent">➐</span>. Notice that <span class="codeitalic">function_name</span> doesn’t have parentheses. This happens because we’re just assigning a function to another <span epub:type="pagebreak" id="page_81"/>function instead of running the function. In our case, we’re telling the code to run the <code>start_animation</code> function when the <code>button_start.when_pressed</code> function is triggered.</p>
<p class="indent">When the button is pressed, the <code>running_animation</code> value changes. When the <code>running_animation</code> variable is <code>False</code> and the button is pressed, it changes to <code>True</code>, and vice versa. This allows you to start and stop the rainbow effect.</p>
<h5 class="h5"><strong>Controlling the Animation with the while Loop</strong></h5>
<p class="noindent">At <span class="ent">➒</span>, you create an <code>Adafruit_Neopixel</code> object called <code>strip</code> that takes in the strip parameters you defined earlier at <span class="ent">➋</span>. To control the strip’s LED brightness, you use <code>int(pot_brightness.value*255)</code>. The brightness changes according to the value read from one of the potentiometers (between 0 and 1). You multiply that value by 255 because the strip’s LED brightness has a range of 0 to 255. Using the <code>int()</code> function rounds the number to an integer. This way, you can adjust the LED brightness by rotating the potentiometer.</p>
<p class="indent">Then, you use <code>strip.begin()</code>, which you need to call before making other calls on the <code>Adafruit_Neopixel</code> object.</p>
<p class="indent">The <code>while</code> loop <span class="ent">➓</span> keeps the program running. Then, you set the strip brightness before starting the animation. If the <code>running_animation</code> variable is equal to <code>True</code>, the <code>rainbowCycle()</code> function will run, starting the animation. If you press the pushbutton, the <code>running_animation</code> variable changes to <code>False</code>, and the animation stops.</p>
<h4 class="h4" id="lev62"><span class="green1"><strong>Running the Script</strong></span></h4>
<p class="noindent">To run this script, you need to use the terminal window. Running it from the Python 3 IDLE editor will give you a permissions error.</p>
<p class="indent">Save the script as <em>rainbow_effect.py</em> inside the <em>LEDs</em> folder within the <em>Projects</em> directory, and open the terminal. Then, navigate to the <em>LEDs</em> folder and run the script:</p>
<div class="box">
<pre>pi@raspberrypi:~ $ <span class="codestrong">cd ~/Desktop/Projects/LEDs</span><br/>pi@raspberrypi:~/Desktop/Projects/LEDs $ <span class="codestrong">sudo python3</span><br/><span class="codestrong">rainbow_effect.py</span></pre>
</div>
<p class="indent">Now you can control the speed and brightness by rotating their respective potentiometers and stop and start the animation by pressing the pushbutton.</p>
<p class="indent">Congratulations! You have an awesome decoration for your home!</p>
<h3 class="h3" id="lev63"><span epub:type="pagebreak" id="page_82"/><span class="green1"><strong>TAKING IT FURTHER</strong></span></h3>
<p class="noindent">Here are some simple ideas you can try if you want to increase your level of control over the strip:</p>
<ul>
<li class="noindent">Light up a specific LED in the middle of the strip.</li>
<li class="noindent">Light all the LEDs in just one color.</li>
<li class="noindent">Add a pushbutton to change between preset effects.</li>
<li class="noindent">Blink the LEDs like Christmas lights.</li>
<li class="noindent">Invent your own effects.</li>
</ul>
</body></html>