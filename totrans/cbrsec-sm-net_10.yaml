- en: '[10](nsp-enoka501485-0007.xhtml#rch10)'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '[10](nsp-enoka501485-0007.xhtml#rch10)'
- en: Monitoring Your Network with Detection and Alerting
  id: totrans-1
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用检测和报警监控你的网络
- en: '![Chapter opening icon](images/nsp-enoka501485-ct.jpg)'
  id: totrans-2
  prefs: []
  type: TYPE_IMG
  zh: '![章节开篇图标](images/nsp-enoka501485-ct.jpg)'
- en: Network monitoring provides real-time visibility into your network activity,
    enabling you to stay ahead of potential threats and (ideally) stop adversaries
    before they’ve performed any disruptive action. Monitoring your network is a huge
    undertaking, so alerts are often a useful starting point for investigations. Without
    meaningful alerts, network monitoring is like finding a needle in a haystack—trying
    to identify malicious activity within a very large dataset.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 网络监控提供了对网络活动的实时可视化，使你能够领先于潜在的威胁，并（理想情况下）在对方进行任何破坏性行为之前将其阻止。监控你的网络是一个巨大的工作，因此警报通常是调查的有用起点。如果没有有意义的警报，网络监控就像是在大海捞针——试图在一个非常大的数据集内识别恶意活动。
- en: Your firewalls, proxies, antivirus, and other solutions should be up and running
    for at least a month before you start trying to actively monitor your hosts and
    network traffic, just to ensure they’re functioning correctly. Up until this point,
    everything has been relatively passive; once set up, no further input from you
    is required, unless you need to update or change the configuration.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 你的防火墙、代理、杀毒软件和其他解决方案应该至少运行一个月，确保它们正常工作后，再开始尝试主动监控你的主机和网络流量，确保它们正确运作。到目前为止，一切相对是被动的；设置完成后，除非需要更新或更改配置，否则无需你进一步操作。
- en: Due to their nature, active monitoring and alerting can take considerable time
    and effort—not only to implement but to maintain, and that is especially true
    as a network expands. Not only will you need to check in regularly to see whether
    your network monitoring software has identified any threats or unusual behavior,
    but you’ll also need to investigate this behavior and potentially work to mitigate
    the identified activity. Depending on the size of the network, monitoring it could
    be a full-time job for one or more people.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 由于其本质，主动监控和报警可能需要相当多的时间和精力——不仅仅是实施，还包括维护，尤其是当网络扩展时，这一点尤为明显。你不仅需要定期检查网络监控软件是否已识别出任何威胁或异常行为，还需要调查这些行为，并可能需要采取措施缓解已识别的活动。根据网络的规模，监控它可能需要一个或多个人全职工作。
- en: This chapter will arm you with the knowledge and tools required to monitor your
    network and alert you to suspicious behavior successfully. We’ll discuss how,
    when, and where to implement network traffic access points (TAPs) and a switch
    port analyzer (SPAN) in your network to enable network traffic capture, monitoring,
    and analysis. Finally, we’ll build a network monitoring appliance using Security
    Onion—a free suite of network security monitoring tools—and discuss how best to
    utilize its built-in capabilities.
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 本章将为你提供必要的知识和工具，以便成功地监控你的网络并提醒你可疑行为。我们将讨论如何、何时以及在哪里在你的网络中实现网络流量接入点（TAP）和交换机端口分析仪（SPAN），以实现网络流量的捕获、监控和分析。最后，我们将使用Security
    Onion（一套免费的网络安全监控工具）构建一个网络监控设备，并讨论如何最好地利用其内置功能。
- en: '[Network Monitoring Methods](nsp-enoka501485-0007.xhtml#rah1201)'
  id: totrans-7
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: '[网络监控方法](nsp-enoka501485-0007.xhtml#rah1201)'
- en: You can use several methods to monitor and capture network traffic for real-time
    or post-facto analysis and alerting. The method you choose depends mostly on your
    network’s hardware, as each device has different capabilities. We’ll discuss two
    of the most common methods in the following sections.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以使用几种方法来监控和捕获网络流量，以进行实时或事后分析和报警。你选择的方法主要取决于网络的硬件，因为每个设备的功能不同。我们将在以下章节中讨论两种最常见的方法。
- en: '[Network Traffic Access Points](nsp-enoka501485-0007.xhtml#rbh1201)'
  id: totrans-9
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: '[网络流量接入点](nsp-enoka501485-0007.xhtml#rbh1201)'
- en: In small networks without switches, you can install a network *traffic access
    point (TAP)* to monitor the data that passes through it. A TAP is an inline device,
    placed between two nodes on a network; it becomes an extension of the transmission
    medium (like an Ethernet cable) that already exists between those two devices.
    In [Figure 10-1](nsp-enoka501485-0019.xhtml#fig1001), the TAP is between the firewall
    and router.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 在没有交换机的小型网络中，你可以安装一个网络*流量接入点（TAP）*来监控通过它的数据。TAP 是一个内联设备，安装在网络中的两个节点之间；它成为现有传输介质（如以太网电缆）的延伸，位于这两个设备之间。在[图10-1](nsp-enoka501485-0019.xhtml#fig1001)中，TAP
    位于防火墙和路由器之间。
- en: '![Diagram of a small network with a network TAP where the main hosts (in this
    example, Desktop 1 and Laptop 1) are connected to a wireless router, which is
    connected to the TAP. The Network Security Monitoring Device is connected to the
    TAP as well. The TAP is connected to the Firewall, which sits between the TAP
    and the internet.](images/nsp-enoka501485-fig1001.jpg)'
  id: totrans-11
  prefs: []
  type: TYPE_IMG
  zh: '![一个小型网络的示意图，其中网络TAP将主要主机（例如桌面电脑1和笔记本电脑1）连接到无线路由器，而无线路由器又连接到TAP。网络安全监控设备也连接到TAP。TAP连接到防火墙，防火墙位于TAP和互联网之间。](images/nsp-enoka501485-fig1001.jpg)'
- en: 'Figure 10-1: Placement of a network TAP'
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 图10-1：网络TAP的放置
- en: In this configuration, all traffic passing between the router and the firewall
    is sent by the TAP to a monitoring device, where it’s stored for analysis.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 在这种配置中，所有经过路由器与防火墙之间的流量都将由TAP发送到监控设备，并在其中存储以供分析。
- en: When placing a TAP, consider what you actually want to see and investigate.
    In a configuration like the one shown in [Figure 10-1](nsp-enoka501485-0019.xhtml#fig1001),
    you’d capture all the traffic between your endpoints and the firewall (the network’s
    boundary). Monitoring your major egress point lets you investigate things like
    *data exfiltration*, where an adversary is trying to steal your data by sending
    it outside your network. However, with this configuration, you won’t be able to
    see traffic between your endpoint devices, as that is handled by the wireless
    router and never reaches the TAP.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 在放置TAP时，要考虑你实际想要看到和调查的内容。在像[图10-1](nsp-enoka501485-0019.xhtml#fig1001)中所示的配置中，你将捕获到所有经过终端设备与防火墙之间的流量（即网络的边界）。监控主要的出口点让你调查像*数据外泄*这样的事件，即攻击者试图通过将数据发送到网络外部来窃取你的数据。然而，使用这种配置，你将无法看到终端设备之间的流量，因为这些流量由无线路由器处理，永远不会到达TAP。
- en: If you placed the TAP behind the firewall (as opposed to on the internet side),
    you wouldn’t see any traffic from the internet attempting to reach the internal
    network that’s blocked by the firewall. If the TAP is in front of the firewall,
    you wouldn’t see the outbound traffic being blocked by the firewall; the security
    monitoring system also would lose the protection of that firewall and become an
    easy route into your network. Decide which of those scenarios you’re comfortable
    with and place your TAP accordingly. In most cases, it’s best to place the TAP
    behind the firewall (inside your network) and review the firewall logs for what
    the TAP doesn’t see.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你将TAP放置在防火墙之后（而不是放在互联网一侧），你将看不到任何来自互联网试图访问被防火墙阻止的内部网络的流量。如果TAP放在防火墙前面，你将看不到防火墙阻止的出站流量；安全监控系统也将失去防火墙的保护，成为进入网络的一个容易途径。根据你对这些场景的舒适度来决定TAP的放置位置。在大多数情况下，最好将TAP放在防火墙之后（网络内部），并查看防火墙日志，找出TAP未能看到的流量。
- en: A TAP is an inline device. Be aware that if the TAP becomes unavailable or goes
    offline—if any of its limited network ports fail—your entire network will lose
    access to the internet. Your endpoint devices should still be able to communicate
    with each other via the router, but traffic will no longer pass through the TAP.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: TAP是一种内联设备。需要注意的是，如果TAP无法使用或脱机——如果它的任何网络端口出现故障——整个网络将失去对互联网的访问。你的终端设备仍然应该能够通过路由器相互通信，但流量将不再通过TAP。
- en: Several TAP devices are available at reasonable prices. One of the simplest
    is the *Dualcomm ETAP*. One possible configuration of such a TAP would be to connect
    the firewall in [Figure 10-1](nsp-enoka501485-0019.xhtml#fig1001) to the A inline
    port, connect the B inline port to the wireless router, and connect a separate
    cable to the monitoring port of your network security monitoring device (discussed
    in the next section). Such a configuration would allow traffic to flow through the
    TAP as if it wasn’t there, except that it would be intercepted, monitored, and
    analyzed by the network security monitoring system.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 有几款TAP设备价格合理。其中最简单的一种是*Dualcomm ETAP*。这种TAP的一个可能配置是，将防火墙（如[图10-1](nsp-enoka501485-0019.xhtml#fig1001)所示）连接到A端口，将B端口连接到无线路由器，并将一根独立的电缆连接到你的网络安全监控设备的监控端口（在下一节中讨论）。这种配置允许流量像没有TAP一样流经网络，只不过它会被网络安全监控系统截取、监控和分析。
- en: '[Switch Port Analyzers](nsp-enoka501485-0007.xhtml#rbh1202)'
  id: totrans-18
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: '[交换机端口分析仪](nsp-enoka501485-0007.xhtml#rbh1202)'
- en: An alternative to a network TAP is the *switch port analyzer (SPAN)* or *mirror
    port* (interchangeable terms) functionality provided by a switch. A SPAN does
    the same thing as a TAP; it mirrors (or copies) all the data passing through a
    source port(s) to the destination SPAN port on the switch. Your network security
    monitoring system is then connected to the SPAN port to capture the network traffic
    for analysis and alerting. In most modern switches, it’s possible to create a
    SPAN configuration with multiple source ports, so you can capture data from any
    port(s) on a switch.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 网络TAP的替代方案是交换机提供的*交换机端口分析（SPAN）*或*镜像端口*（可互换术语）功能。SPAN与TAP的功能相同；它将所有通过源端口的数据镜像（或复制）到交换机上的目标SPAN端口。你的网络安全监控系统然后连接到SPAN端口，捕获网络流量以进行分析和警报。在大多数现代交换机中，可以创建多个源端口的SPAN配置，这样你就可以从交换机上的任何端口捕获数据。
- en: A SPAN configuration in a small network might look like the one shown [Figure
    10-2](nsp-enoka501485-0019.xhtml#fig1002), where the firewall or other system
    provides IP addresses to endpoints. Each host is connected by Ethernet to a port
    on the switch, and then the network security monitoring device is connected to
    the SPAN configured on the switch. Unlike TAPs, if a port on the switch fails,
    the rest of the network continues functioning, but if the entire switch goes offline
    due to a power failure, the entire network will go down with it.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 小型网络中的SPAN配置可能如下图所示[图10-2](nsp-enoka501485-0019.xhtml#fig1002)，其中防火墙或其他系统为终端提供IP地址。每个主机通过以太网连接到交换机的一个端口，然后网络安全监控设备连接到交换机上配置的SPAN端口。与TAP不同，如果交换机上的端口发生故障，网络的其余部分仍然可以继续运行，但如果交换机因电源故障而完全停机，整个网络将与之一起停机。
- en: '![Diagram showing a small network with a switch and SPAN port that has the
    main hosts (in this example, Desktop 1 and Laptop 1) connected to a port on the
    switch. The Network Security Monitoring Device is connected to the switch as well.
    The switch is then connected to the firewall, which is placed between the switch
    and the internet.](images/nsp-enoka501485-fig1002.jpg)'
  id: totrans-21
  prefs: []
  type: TYPE_IMG
  zh: '![图示显示了一个小型网络，其中交换机和SPAN端口连接着主要主机（在此示例中为桌面1和笔记本1），它们通过端口连接到交换机。网络安全监控设备也连接到交换机。交换机随后连接到防火墙，防火墙位于交换机和互联网之间。](images/nsp-enoka501485-fig1002.jpg)'
- en: 'Figure 10-2: A small network with a switch and SPAN port'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 图10-2：带有交换机和SPAN端口的小型网络
- en: Unlike a TAP configuration, with a SPAN set up on a switch, you’ll be able to
    capture and analyze computer-to-computer traffic in addition to inbound and outbound
    data. You’ll still have the placement issue, though; when the switch is on the
    internal side of the firewall (as it should be), your security monitoring system
    won’t have visibility over the traffic blocked by the firewall.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 与TAP配置不同，在交换机上设置SPAN后，你不仅可以捕获和分析计算机间的流量，还可以捕获进出数据。然而，你仍然会遇到布局问题；当交换机位于防火墙的内部（这应该是这样）时，你的安全监控系统将无法看到被防火墙阻止的流量。
- en: '[#35: Configuring a SPAN Port](nsp-enoka501485-0007.xhtml#rhd1201)'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: '[#35: 配置SPAN端口](nsp-enoka501485-0007.xhtml#rhd1201)'
- en: 'To configure a SPAN port on a managed switch, like the Netgear switch that
    we used in [Chapter 2](nsp-enoka501485-0011.xhtml#ch02), follow these steps:'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 要在受管交换机上配置SPAN端口，如我们在[第2章](nsp-enoka501485-0011.xhtml#ch02)中使用的Netgear交换机，请按照以下步骤操作：
- en: 1\. Log in to the switch with administrator credentials.
  id: totrans-26
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 1\. 使用管理员凭证登录交换机。
- en: 2\. Select **System▸Monitoring▸Mirroring**.
  id: totrans-27
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 2\. 选择**系统▸监控▸镜像**。
- en: 3\. In the Port Mirroring Configuration table that appears, click the source
    ports from which you want to capture network traffic to select them. Selected
    ports will have a check mark.
  id: totrans-28
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 3\. 在出现的端口镜像配置表中，点击你希望捕获网络流量的源端口进行选择。已选择的端口会有一个勾选标记。
- en: 4\. In the Destination Port drop-down box, enter the port to use as the SPAN
    port you’ll connect to your security monitoring system.
  id: totrans-29
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 4\. 在目标端口下拉框中，输入作为SPAN端口的端口，用于连接到你的安全监控系统。
- en: 5\. Finally, in the Mirroring drop-down menu, select **Enable▸Apply**.
  id: totrans-30
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 5\. 最后，在镜像下拉菜单中，选择**启用▸应用**。
- en: Whether you choose to set up a TAP or a switch with a SPAN port, you’ll need
    a network monitoring solution capable of aggregating collected data. The best
    solution currently available for small networks is Security Onion, which includes
    various components for capturing and aggregating network data and enables you
    to quickly analyze that data.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 无论你选择设置TAP还是带有SPAN端口的交换机，都需要一个能够聚合收集数据的网络监控解决方案。目前，适用于小型网络的最佳解决方案是Security Onion，它包含了用于捕获和聚合网络数据的各种组件，并使你能够快速分析这些数据。
- en: '[Security Onion](nsp-enoka501485-0007.xhtml#rah1202)'
  id: totrans-32
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Security Onion is an open source platform for threat hunting, network security
    monitoring, and log management. It’s an operating system, like Ubuntu, that includes
    several open source tools we’ll utilize to monitor our network for security and
    configuration issues.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
- en: Security Onion’s tools include suricata, an intrusion detection system, and
    zeek, a software framework for analyzing network traffic to identify anomalous
    behavior. Grafana is a set of visualizations and dashboards for monitoring the
    health of the Security Onion system, and osquery gathers data about the endpoints
    in your network and the operating systems they’re running for analysis. Wazuh
    is similar to osquery; it’s an agent-based tool that gathers analyzable data from
    your endpoints and is used for active endpoint detection and response (in the
    case of a security incident). Finally, Strelka is a real-time file-scanning utility
    that analyzes network traffic and scans any files traversing the network; it’s
    useful for identifying malware or data exfiltration.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
- en: In the following sections, we’ll discuss creating your network security monitoring
    system using Security Onion and its built-in tools. We’ll explore how to utilize
    these tools to start monitoring your network, and how to triage and investigate
    problems when they arise. It’s up to you whether you’d like to buy or build your
    Security Onion appliance. Security Onion Solutions has preconfigured appliances
    ready to go out of the box.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
- en: '[#36: Building a Security Onion System](nsp-enoka501485-0007.xhtml#rhd1202)'
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
- en: 'To build a Security Onion system, you’ll need a device with a minimum of two
    network interfaces: a management interface and a capture interface (connected
    to the TAP or SPAN). We’ll use an Intel NUC (a small form factor computing unit)
    with two Ethernet ports, which is very customizable and available at various price
    points depending on your budget and requirements. The following minimum hardware
    specifications are detailed in the Security Onion documentation:'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
- en: • 12GB of RAM
  id: totrans-38
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: • Four CPU cores
  id: totrans-39
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: • 200GB of storage
  id: totrans-40
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: • Two network interfaces
  id: totrans-41
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: One additional consideration is how much storage you need. For reference, a
    NUC with an internal storage space of 2TB might be capable of storing around three
    weeks of data, depending on the number of devices, number of users, and amount
    of network traffic in your network. After that point, the data will be kept on
    a rolling cycle, where older data is deleted in favor of newer data. To enable
    better incident response capabilities in your network, the more data you keep,
    the better. If you discover an adversary in your network that has been there for
    12 months but you have only one month of data, you’ll never be able to determine
    root cause, making it difficult to kick them out and prevent the problem from
    recurring.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
- en: Once you have a NUC (or similar device), you’ll install Security Onion. At this
    stage, it’s also a good idea to connect the network port you plan to use for management
    (*not* the port you’ll use for capturing network traffic) to your network so you
    can set up its configuration. It doesn’t matter which of the two network ports
    you use for management and traffic capture. This device will need a static IP
    address, and while you could do that on the device itself, it’s better to configure
    the static addressing on your router or whichever device is responsible for IP
    address leases in your environment (like your wireless router or pfSense device).
    Having the management port on your NUC (and only this port) connected will make
    it easier to identify when installing and configuring the rest of the software.
    After this process is complete, you can then configure the capture port independently.
    You should configure the static IP address for the management interface now, as
    some of the agents we’ll install have requirements and dependencies based on this
    address, so changing it later can create challenges.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦你有了 NUC（或类似设备），就可以开始安装 Security Onion。在这一阶段，最好将计划用于管理的网络端口（*不是*用于捕获网络流量的端口）连接到你的网络，以便设置其配置。无论你使用哪一个网络端口来管理和捕获流量都没有关系。此设备需要一个静态
    IP 地址，虽然你可以在设备本身上进行配置，但最好在路由器或负责 IP 地址租用的设备上（如你的无线路由器或 pfSense 设备）配置静态地址。只连接 NUC
    上的管理端口（仅此端口）将使得在安装和配置其余软件时更容易识别。完成此过程后，你可以独立配置捕获端口。现在应该配置管理接口的静态 IP 地址，因为我们将安装的某些代理有基于该地址的要求和依赖关系，因此稍后更改它可能会造成一些问题。
- en: '[Installing Security Onion](nsp-enoka501485-0007.xhtml#rbh1203)'
  id: totrans-44
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: '[安装 Security Onion](nsp-enoka501485-0007.xhtml#rbh1203)'
- en: You can install Security Onion from an ISO file (available directly from Security
    Onion Solutions at [https://securityonionsolutions.com/software/](https://securityonionsolutions.com/software/))
    or manually using CentOS 7 as the base operating system and then installing the
    Security Onion package like any other application in a Linux environment (note
    that CentOS 7 is the only OS supported by Security Onion). Using the ISO file
    is a simpler and faster method of creating a Security Onion system, whereas manual
    installation requires slightly more effort. However, manual installation allows
    you to have more granular control over things like disk partitioning. If that
    is of interest to you, choose the manual installation method. If not, install
    Security Onion using the ISO file.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以从 ISO 文件安装 Security Onion（直接从 Security Onion Solutions 网站 [https://securityonionsolutions.com/software/](https://securityonionsolutions.com/software/)
    获取），或手动使用 CentOS 7 作为基础操作系统，然后像安装其他 Linux 应用程序一样安装 Security Onion 包（请注意，Security
    Onion 仅支持 CentOS 7 操作系统）。使用 ISO 文件是创建 Security Onion 系统更简单和快速的方法，而手动安装则需要更多的操作。不过，手动安装可以让你在磁盘分区等方面有更多的控制。如果你对这一点感兴趣，可以选择手动安装方法。如果没有，使用
    ISO 文件进行安装即可。
- en: Installing Security Onion from the ISO File
  id: totrans-46
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 从 ISO 文件安装 Security Onion
- en: 'Start by downloading the latest ISO from Security Onion Solutions, and follow
    the procedure outlined in [Chapter 1](nsp-enoka501485-0010.xhtml#ch01)’s “[Creating
    a Physical Linux System](nsp-enoka501485-0010.xhtml#hd0302)” to create a bootable
    USB drive from the ISO file. Plug your bootable USB into your NUC, turn on the
    NUC, and you’ll be presented with the Security Onion installation wizard. Follow
    these steps to complete the installation:'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 首先从 Security Onion Solutions 下载最新的 ISO 文件，并按照[第 1 章](nsp-enoka501485-0010.xhtml#ch01)中“[创建物理
    Linux 系统](nsp-enoka501485-0010.xhtml#hd0302)”的步骤，从 ISO 文件创建可启动的 USB 驱动器。将可启动的
    USB 驱动器插入你的 NUC，启动 NUC，你将看到 Security Onion 安装向导。按照以下步骤完成安装：
- en: 1\. The wizard will prompt you to install Security Onion, destroying all data
    and partitions. Type **yes** and press ENTER to accept this and begin the installation
    process.
  id: totrans-48
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 1\. 向导将提示你安装 Security Onion，这将清除所有数据和分区。输入**yes**并按 ENTER 键接受并开始安装过程。
- en: 2\. Enter an administrator username when prompted; then press ENTER.
  id: totrans-49
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 2\. 提示时输入管理员用户名；然后按 ENTER 键。
- en: 3\. Enter a strong passphrase for the user; then press ENTER.
  id: totrans-50
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 3\. 为用户输入一个强密码短语；然后按 ENTER 键。
- en: 4\. Repeat the passphrase to confirm it; then press ENTER to initiate the installation.
  id: totrans-51
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 4\. 重复输入密码短语以确认；然后按 ENTER 键开始安装。
- en: 5\. Once installation completes, the computer will reboot. Log in with your
    newly created credentials and the Security Onion setup wizard will pop up. Press
    ENTER to continue.
  id: totrans-52
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦安装完成，计算机将重新启动。使用你新创建的凭证登录，Security Onion设置向导将弹出。按ENTER继续。
- en: 6\. Using the arrow keys, select **Install** to run the standard Security Onion
    installation; then press ENTER.
  id: totrans-53
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用箭头键，选择**安装**以运行标准的Security Onion安装；然后按ENTER。
- en: At this point, the process for completing the installation of Security Onion
    is the same for both the ISO file installation and the manual installation paths.
    Jump to the section “[Completing the Security Onion Installation](nsp-enoka501485-0019.xhtml#ch1203)”
    on [page 157](nsp-enoka501485-0019.xhtml#p157).
  id: totrans-54
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 在此时，完成Security Onion安装的过程在ISO文件安装和手动安装两种方式下是相同的。跳转到[第157页](nsp-enoka501485-0019.xhtml#p157)中的“[完成Security
    Onion安装](nsp-enoka501485-0019.xhtml#ch1203)”部分。
- en: Installing Security Onion Manually
  id: totrans-55
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 手动安装Security Onion
- en: 'You can install Security Onion entirely from scratch by installing CentOS 7
    on your NUC and then installing the Security Onion packages and tools on top.
    To do this, follow these steps:'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以通过在NUC上安装CentOS 7并在其上安装Security Onion的包和工具，完全从零开始安装Security Onion。为此，按照以下步骤操作：
- en: 1\. Download the most recent CentOS 7 ISO (the correct format is x86_64) from
    [https://www.centos.org/](https://www.centos.org/).
  id: totrans-57
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从[https://www.centos.org/](https://www.centos.org/)下载最新的CentOS 7 ISO（正确的格式是x86_64）。
- en: 2\. Follow the procedure outlined in [Chapter 1](nsp-enoka501485-0010.xhtml#ch01)’s
    “[Creating a Physical Linux System](nsp-enoka501485-0010.xhtml#hd0302)” section
    to create a bootable USB drive from the ISO file.
  id: totrans-58
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 按照[第1章](nsp-enoka501485-0010.xhtml#ch01)中“[创建物理Linux系统](nsp-enoka501485-0010.xhtml#hd0302)”部分的步骤，从ISO文件创建一个可引导的USB驱动器。
- en: 3\. Plug your bootable USB into your NUC and boot from the USB. You’ll be presented
    with a few options; choose **Test this Media & Install CentOS 7**.
  id: totrans-59
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将可引导的USB插入你的NUC并从USB启动。你将看到几个选项；选择**测试此介质并安装CentOS 7**。
- en: 4\. At this point, a graphical installation wizard appears. Select your desired
    language and click **Continue**.
  id: totrans-60
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在此时，将出现图形化安装向导。选择你需要的语言并点击**继续**。
- en: 5\. Set the correct time zone and keyboard layout.
  id: totrans-61
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 设置正确的时区和键盘布局。
- en: 6\. Under Software Selection, it’s recommended to choose **Server with GUI**
    for ease of administration.
  id: totrans-62
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在“软件选择”下，建议选择**带GUI的服务器**，以便于管理。
- en: 7\. Under System▸Installation Destination, select the internal disk where you
    plan to install Security Onion and then choose **I Will Configure Partitioning**.
    Click **Done** to proceed to the partitioning wizard. Partitioning defines how
    the hard drive storage will be divided among the users and applications on the
    system.
  id: totrans-63
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在系统▸安装目标下，选择你计划安装Security Onion的内部磁盘，然后选择**我将配置分区**。点击**完成**继续进入分区向导。分区定义了硬盘存储如何在系统的用户和应用程序之间划分。
- en: '8\. Select **LVM Partitioning** and create the following partitions:'
  id: totrans-64
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择**LVM分区**并创建以下分区：
- en: 'a. */boot*: CentOS will boot from this partition; it should have at least 500MB
    of space available.'
  id: totrans-65
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: a. */boot*：CentOS将从此分区启动；此分区应至少有500MB的可用空间。
- en: 'b. */boot/efi*: Part of the boot partition; it should be at least 500MB.'
  id: totrans-66
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: b. */boot/efi*：启动分区的一部分；应至少为500MB。
- en: 'c. */*: The root of the filesystem; should be 300GB.'
  id: totrans-67
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: c. */*：文件系统的根目录；应为300GB。
- en: 'd. */tmp*: For temporary files; should be 2GB.'
  id: totrans-68
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: d. */tmp*：用于临时文件；应为2GB。
- en: 'e. swap: For swap files; should be 8GB.'
  id: totrans-69
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: e. swap：用于交换文件；应为8GB。
- en: 'f. */home*: A space for any user files; should be 40GB.'
  id: totrans-70
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: f. */home*：存放所有用户文件的空间；应为40GB。
- en: 'g. */nsm*: For all the security tools and captured data; it should be assigned
    the remainder of drive space.'
  id: totrans-71
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: g. */nsm*：存放所有安全工具和捕获的数据；应分配剩余的驱动器空间。
- en: 9\. Click **Done▸Accept Changes** to write the changes to disk.
  id: totrans-72
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**完成▸接受更改**以将更改写入磁盘。
- en: 10\. Click **Begin Installation** to install the operating system.
  id: totrans-73
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**开始安装**以安装操作系统。
- en: 11\. Set your root passphrase and create a non-root, administrative account
    on the following screen. If you want to connect to this system via SSH, ensure
    that your administrative account has a strong passphrase.
  id: totrans-74
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在接下来的屏幕上，设置你的root密码并创建一个非root的管理员账户。如果你想通过SSH连接到该系统，确保你的管理员账户具有强密码。
- en: 12\. Once the installation is complete, reboot the machine and remove the installation
    USB. Then, boot to your CentOS operating system.
  id: totrans-75
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 安装完成后，重启计算机并移除安装USB。然后，启动进入你的CentOS操作系统。
- en: 13\. Accept the license information.
  id: totrans-76
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接受许可信息。
- en: 14\. You might need to turn the network card on to enable the network. Click
    **Network & Host Name**, toggle the network button to **On**, and then click **Done**.
  id: totrans-77
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 14\. 你可能需要打开网络卡以启用网络。点击**网络和主机名**，将网络按钮切换为**开启**，然后点击**完成**。
- en: 15\. Click **Finish Configuration**.
  id: totrans-78
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 15\. 点击**完成配置**。
- en: 'With CentOS installed, next install Security Onion. First, connect to your
    server via SSH or log in directly. Change directory to the */nsm* partition you
    created during the initial setup:'
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 安装了 CentOS 后，接下来安装 Security Onion。首先，通过 SSH 连接到服务器或直接登录。将目录切换到在初始设置过程中创建的 */nsm*
    分区：
- en: '[PRE0]'
  id: totrans-80
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'Use `sudo yum install` to install Git (an application for software management)
    and then `git clone` to download Security Onion:'
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 `sudo yum install` 安装 Git（一个软件管理应用），然后使用 `git clone` 下载 Security Onion：
- en: '[PRE1]'
  id: totrans-82
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: (Whereas Ubuntu is based on Debian Linux and uses the `apt` utility to manage
    software packages, CentOS is based on Red Hat Linux and uses `yum`.)
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: （Ubuntu 基于 Debian Linux，并使用 `apt` 工具来管理软件包，而 CentOS 基于 Red Hat Linux，并使用 `yum`。）
- en: 'Navigate to the newly created *securityonion* directory and run the setup script:'
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 导航到新创建的 *securityonion* 目录，并运行设置脚本：
- en: '[PRE2]'
  id: totrans-85
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: Running this script starts an interactive installation wizard that leads you
    through the initial setup and configuration of your Security Onion server.
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 运行此脚本将启动一个交互式安装向导，指导你完成 Security Onion 服务器的初始设置和配置。
- en: Completing the Security Onion Installation
  id: totrans-87
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 完成 Security Onion 安装
- en: Now that the basic configuration of the operating system has been completed,
    you’ll start installing and configuring the tools you’ll use to monitor and analyze
    the network traffic. Zeek is a security monitoring platform that will enable you
    to analyze network traffic more efficiently and alert on suspicious activity within
    your network automatically. It does this by utilizing rulesets containing information
    on suspicious or malicious activity, software, and network traffic, such as the
    ETOPEN ruleset you’ll use here.
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 基本的操作系统配置完成后，接下来你将开始安装和配置用于监控和分析网络流量的工具。Zeek 是一个安全监控平台，它能帮助你更高效地分析网络流量，并自动对网络中的可疑活动发出警报。它通过使用包含可疑或恶意活动、软件和网络流量信息的规则集来实现这一点，比如你将在此使用的
    ETOPEN 规则集。
- en: 'Regardless of how you’ve installed Security Onion, follow these steps to complete
    the process:'
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 无论你是如何安装 Security Onion，都请按照以下步骤完成安装过程：
- en: 1\. Press ENTER to continue past the welcome screen (and to progress to all
    other screens).
  id: totrans-90
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 1\. 按下 ENTER 键继续跳过欢迎界面（并进入后续所有界面）。
- en: 2\. On the Installation Type page, navigate to STANDALONE with the arrow keys,
    and press the spacebar to select the option.
  id: totrans-91
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 2\. 在安装类型页面，使用箭头键导航到 STANDALONE，然后按空格键选择该选项。
- en: 3\. If you used the Security Onion ISO, select **Standard** on the next page
    to indicate that this machine has internet access.
  id: totrans-92
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 3\. 如果你使用的是 Security Onion ISO 镜像，在下一页面选择**标准**，表示此机器可以连接互联网。
- en: 4\. If you performed the manual installation of Security Onion, type **AGREE**
    to accept the Elastic License on the next page.
  id: totrans-93
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 4\. 如果你执行了 Security Onion 的手动安装，在下一页面键入**同意**以接受 Elastic 许可证。
- en: 5\. On the next page, keep the default hostname for simplicity or change it
    if you like (in larger installations that have more than one server, changing
    the hostname will be beneficial). If prompted to change the hostname, choose to
    proceed anyway.
  id: totrans-94
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 5\. 在下一页面，为简便起见，保留默认主机名，或者根据需要更改主机名（在有多台服务器的大型安装中，修改主机名会更有利）。如果系统提示更改主机名，请选择继续。
- en: 6\. On the next page, enter a short description for this computer or leave it
    blank.
  id: totrans-95
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 6\. 在下一页面，输入此计算机的简短描述或留空。
- en: 7\. On the network card configuration page, shown in [Figure 10-3](nsp-enoka501485-0019.xhtml#fig1003),
    select the interface with the words *Link UP* next to it as the management interface.
    It should be the only interface plugged into the network at this point.
  id: totrans-96
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 7\. 在网络卡配置页面，如[图 10-3](nsp-enoka501485-0019.xhtml#fig1003)所示，选择带有 *Link UP*
    的接口作为管理接口。此时它应该是唯一连接到网络的接口。
- en: '![The Network Interface Card Setup window states link names followed by buttons
    labeled Ok and Cancel.](images/nsp-enoka501485-fig1003.jpg)'
  id: totrans-97
  prefs: []
  type: TYPE_IMG
  zh: '![网络接口卡设置窗口显示了链接名称，后面是标有 Ok 和 Cancel 的按钮。](images/nsp-enoka501485-fig1003.jpg)'
- en: 'Figure 10-3: NIC setup wizard'
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 图 10-3：网络接口卡设置向导
- en: 8\. Press the spacebar to set the monitor interface.
  id: totrans-99
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 8\. 按下空格键设置监控接口。
- en: On the management interface page, you may receive an informational error about
    using DHCP; as long as you’ve configured a static address for this device, you
    can ignore this message.
  id: totrans-100
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 在管理界面页面，你可能会收到有关使用DHCP的提示性错误；只要你已经为该设备配置了静态地址，可以忽略此消息。
- en: 9\. When asked how this computer should connect to the internet, select **Direct**.
  id: totrans-101
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 9\. 在被询问这台计算机如何连接到互联网时，选择**Direct**。
- en: 10\. Select **Automatic** on the OS Patch Schedule page to keep your operating
    system automatically up-to-date.
  id: totrans-102
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 10\. 在操作系统补丁计划页面选择**Automatic**，以保持操作系统自动更新。
- en: 11\. Specify your home network address range, identified in [Chapter 1](nsp-enoka501485-0010.xhtml#ch01).
    If your network uses 10.0.0.0/8 addresses, leave that in the box provided and
    delete the other two subnets. If your network uses 192.168.0.0/16 addresses, keep
    that in the box and delete the other two, and so on.
  id: totrans-103
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 11\. 指定你的家庭网络地址范围，在[第1章](nsp-enoka501485-0010.xhtml#ch01)中可以找到该范围。如果你的网络使用的是10.0.0.0/8地址范围，在框中保留该地址并删除其他两个子网。如果你的网络使用的是192.168.0.0/16地址范围，保留该地址并删除其他两个，依此类推。
- en: 12\. When asked which type of manager to install, select **BASIC**.
  id: totrans-104
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 12\. 当被询问安装哪种类型的管理工具时，选择**BASIC**。
- en: 13\. Select **ZEEK** as the tool to use to generate metadata.
  id: totrans-105
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 13\. 选择**ZEEK**作为生成元数据的工具。
- en: 14\. Select **ETOPEN** as the IDS ruleset to use to generate alerts.
  id: totrans-106
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 14\. 选择**ETOPEN**作为生成警报的IDS规则集。
- en: Note ETOPEN is an open source ruleset updated regularly with new and emerging
    threats and alerts. ETPRO and TALOS are similar to ETOPEN, but they require a
    subscription. For small networks, ETOPEN is sufficient.
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 注意：ETOPEN是一个开源规则集，会定期更新新出现的威胁和警报。ETPRO和TALOS与ETOPEN类似，但它们需要订阅。对于小型网络，ETOPEN已足够。
- en: 15\. The wizard then asks which components of the Security Onion suite of tools
    you want to install. Select **Osquery**, **Wazuh**, and **Strelka**.
  id: totrans-108
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 15\. 向导会询问你要安装Security Onion工具套件中的哪些组件。选择**Osquery**、**Wazuh**和**Strelka**。
- en: 16\. If asked if you’d like to keep the default Docker IP range, select **Yes**.
  id: totrans-109
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 16\. 如果被询问是否保留默认的Docker IP范围，选择**Yes**。
- en: 17\. Enter your email address for the Security Onion administrator.
  id: totrans-110
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 17\. 输入你的电子邮件地址作为Security Onion管理员。
- en: 18\. Enter and re-enter the password for your account.
  id: totrans-111
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 18\. 输入并重新输入你的账户密码。
- en: 19\. When asked how you will access the web interface, select **IP**.
  id: totrans-112
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 19\. 在被询问如何访问Web界面时，选择**IP**。
- en: 20\. Set a strong passphrase for the *soremote* user account (for performing
    some administrative actions).
  id: totrans-113
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 20\. 为*soremote*用户账户设置一个强密码（用于执行一些管理操作）。
- en: 21\. Choose **BASIC** to install the network security monitoring components
    with the recommended settings.
  id: totrans-114
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 21\. 选择**BASIC**以使用推荐的设置安装网络安全监控组件。
- en: 22\. Type **2** for the number of Zeek and Suricata processes.
  id: totrans-115
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 22\. 输入**2**作为Zeek和Suricata进程的数量。
- en: The number of processes dictates how much network traffic your system can process.
    For small networks, two processes should be sufficient; you can change this later
    if necessary.
  id: totrans-116
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 进程的数量决定了系统能够处理的网络流量大小。对于小型网络，两个进程应该足够；如果需要，稍后可以更改此设置。
- en: 23\. If asked if you’d like to configure NTP servers, choose **Yes**. Network
    Time Protocol (NTP) is used to keep endpoints synchronized. It’s best to keep
    your monitoring server in sync with a time server to prevent time drift, which
    can cause issues when troubleshooting alerts. Browse to [https://www.ntppool.org/](https://www.ntppool.org/)
    and choose an NTP server in your region to keep your Security Onion server’s time
    in sync.
  id: totrans-117
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 23\. 如果被询问是否配置NTP服务器，选择**Yes**。网络时间协议（NTP）用于保持端点时间同步。最好保持你的监控服务器与时间服务器同步，以防止时间漂移，这可能会导致排查警报时出现问题。浏览[https://www.ntppool.org/](https://www.ntppool.org/)并选择你所在区域的NTP服务器，保持Security
    Onion服务器时间同步。
- en: 24\. Select **NODEBASIC** when asked.
  id: totrans-118
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 24\. 在被询问时选择**NODEBASIC**。
- en: 25\. Run **so-allow** by pressing ENTER when asked to correctly configure the
    firewall on the system to allow access to all the tools being installed.
  id: totrans-119
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 25\. 按下ENTER键运行**so-allow**，在系统提示时正确配置防火墙，允许访问所有正在安装的工具。
- en: When asked for an IP address to allow access to your network monitoring system,
    you can choose to allow access to the Security Onion web interfaces from a single
    computer or device or from any host in your network. For security purposes, you
    allow access only from a single IP address.
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 当被询问是否允许某个IP地址访问你的网络监控系统时，你可以选择只允许单个计算机或设备访问Security Onion Web界面，或者允许网络中的任何主机访问。出于安全考虑，你只允许单个IP地址访问。
- en: 26\. Enter the IP address you plan to use; then press ENTER.
  id: totrans-121
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 26\. 输入你计划使用的IP地址；然后按ENTER键。
- en: 27\. Finally, accept the configuration you’ve just created by pressing TAB to
    select **Yes**; then press ENTER to finish the setup wizard and commit the changes.
  id: totrans-122
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 27. 最后，通过按 TAB 选择**Yes**，然后按 ENTER 完成设置向导并提交更改，以接受你刚刚创建的配置。
- en: Note Security Onion and some of its tools, like Zeek, can run in a cluster configuration,
    where the agents are installed on multiple systems for enhanced data collection
    and processing. In small networks, a stand-alone system is sufficient. In larger
    networks with multiple network segments and switches, a cluster configuration
    might make more sense.
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 注意，Security Onion 和其一些工具（如 Zeek）可以在集群配置中运行，其中代理安装在多个系统上以增强数据收集和处理能力。在小型网络中，单独的系统已足够。在拥有多个网络段和交换机的大型网络中，集群配置可能更为合理。
- en: 'At the end of the installation, the screen will display the URL to access the
    Security Onion web interface; write this down (it should be *http://<your_server_ip>/*).
    The system will reboot. Once it comes back up, you’ll be able to log in via the
    URL using the email address and passphrase you entered earlier. To test the Security
    Onion configuration, run the following:'
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 安装结束时，屏幕将显示访问 Security Onion Web 界面的 URL；请记下这个网址（应该是*http://<your_server_ip>/*）。系统将重启。重启后，你可以通过该
    URL 使用之前输入的电子邮件地址和密码进行登录。为了测试 Security Onion 的配置，运行以下命令：
- en: '[PRE3]'
  id: totrans-125
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: This command lists the tools Security Onion is running and the status of each,
    which should appear as `OK` if everything worked.
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 该命令列出了 Security Onion 正在运行的工具及其状态，如果一切正常，状态应显示为 `OK`。
- en: 'If any services haven’t started, wait a few minutes before running the status
    command again. If they still fail to start, try starting services manually using
    these commands:'
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 如果有任何服务未启动，稍等几分钟后再次运行状态命令。如果它们仍然无法启动，可以尝试使用以下命令手动启动服务：
- en: '[PRE4]'
  id: totrans-128
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: If you’re still unable to get the services to start, reboot the computer. If
    all else fails, reinstall Security Onion.
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你仍然无法启动服务，请重启计算机。如果一切方法都失败，重新安装 Security Onion。
- en: Once you can access the Security Onion console, you’ll see a menu on the left
    side that lists all the tools at your disposal (see [Figure 10-4](nsp-enoka501485-0019.xhtml#fig1004)).
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦能够访问 Security Onion 控制台，你将看到左侧菜单列出了你可以使用的所有工具（请参见[图 10-4](nsp-enoka501485-0019.xhtml#fig1004)）。
- en: '![Security Onion’s tools include: Kibana, Grafana, CyberChef, Playbook, Fleet,
    TheHive, and Navigator.](images/nsp-enoka501485-fig1004.jpg)'
  id: totrans-131
  prefs: []
  type: TYPE_IMG
  zh: '![Security Onion 的工具包括：Kibana、Grafana、CyberChef、Playbook、Fleet、TheHive 和 Navigator。](images/nsp-enoka501485-fig1004.jpg)'
- en: 'Figure 10-4: Security Onion tools'
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 图 10-4：Security Onion 工具
- en: At this point, click **Kibana**, and a new tab will be launched in your browser.
    You should see a minimal number of records because you haven’t plugged in the
    capture port on your device.
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 此时，点击**Kibana**，浏览器将打开一个新标签页。由于你尚未在设备上连接捕获端口，应该会看到极少的记录。
- en: Connect this port to the SPAN or TAP you configured earlier. Once that’s done,
    refresh the page after a few minutes to see Kibana populated with newly acquired
    data.
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 将此端口连接到之前配置的 SPAN 或 TAP。完成后，几分钟后刷新页面，查看 Kibana 是否已显示新获取的数据。
- en: '[#37: Installing Wazuh](nsp-enoka501485-0007.xhtml#rhd1203)'
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: '[#37: 安装 Wazuh](nsp-enoka501485-0007.xhtml#rhd1203)'
- en: Security Onion’s additional tools help you to understand what’s happening in
    your network and take action to investigate, mitigate, and remediate issues when
    they arise. One of these packages is Wazuh.
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: Security Onion 的附加工具帮助你理解网络中的情况，并采取行动进行调查、缓解和修复问题。其中一个工具包是 Wazuh。
- en: Wazuh is an open source *endpoint detection and response (EDR)* platform that
    monitors your endpoints for malicious activity, alerts you within the Security
    Onion console, and provides the incident response capabilities of blocking network
    traffic, stopping malicious processes, and quarantining malware files.
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: Wazuh 是一个开源的*端点检测和响应（EDR）*平台，用于监控终端设备的恶意活动，在 Security Onion 控制台中提醒你，并提供阻止网络流量、停止恶意进程以及隔离恶意文件的响应能力。
- en: Using agents like Wazuh can be controversial. In larger networks, oftentimes
    so much is going on that adding something new to the network, especially across
    all the systems, can cause stability issues or create/exacerbate challenges around
    limited resources like bandwidth. This is usually less of an issue in smaller
    networks because capacity isn’t shared between so many devices, users, or processes,
    and there generally aren’t as many solutions competing for resources.
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 使用像 Wazuh 这样的代理可能会引起争议。在大型网络中，通常由于网络上活动繁多，尤其是跨所有系统添加新内容可能导致稳定性问题，或者在带宽等有限资源方面产生/加剧挑战。对于小型网络来说，这通常不是问题，因为容量不会在那么多设备、用户或进程之间共享，而且通常没有那么多的解决方案争夺资源。
- en: Installing Wazuh won’t have a meaningful impact on the daily operations of your
    small network. Conversely, the value you receive from the additional monitoring
    and security uplift far outweighs any potential negative consequences of using
    multiple agents. Ultimately, it’s your decision whether to install these agents
    on one, some, or all of the endpoints in your network. The more complete your
    coverage and network monitoring, the more secure your network is likely to be.
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 安装 Wazuh 不会对您小型网络的日常操作产生重大影响。相反，您从额外的监控和安全提升中获得的价值，远远超过使用多个代理可能带来的任何负面后果。最终，是否在您网络中的一个、部分或所有终端上安装这些代理由您决定。覆盖和网络监控越完整，您的网络安全性可能就越高。
- en: This section provides instructions for installing the Wazuh agent on Windows,
    macOS, and Linux.
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 本节提供了在 Windows、macOS 和 Linux 上安装 Wazuh 代理的说明。
- en: '[Installing Wazuh on Windows](nsp-enoka501485-0007.xhtml#rbh1204)'
  id: totrans-141
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: '[在 Windows 上安装 Wazuh](nsp-enoka501485-0007.xhtml#rbh1204)'
- en: 'To install the Wazuh agent on your Windows endpoint(s), follow these steps:'
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 要在您的 Windows 终端上安装 Wazuh 代理，请按照以下步骤操作：
- en: 1\. Log in to your Security Onion console and click **Downloads** in the left menu.
  id: totrans-143
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 1\. 登录到您的 Security Onion 控制台，并在左侧菜单中点击**下载**。
- en: 2\. Click the **MSI** installer agent option to download the correct installer;
    then run the downloaded executable on your Windows computer.
  id: totrans-144
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 2\. 点击**MSI** 安装程序代理选项以下载正确的安装程序；然后运行下载的可执行文件。
- en: 3\. Accept the license agreement and click **Install**.
  id: totrans-145
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 3\. 接受许可协议并点击**安装**。
- en: 4\. Once the installation completes, tick the **Run Agent Configuration Interface**
    checkbox and click **Finish**.
  id: totrans-146
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 4\. 安装完成后，勾选**运行代理配置界面**复选框，然后点击**完成**。
- en: '5\. To add this new system to your Security Onion, log in to Security Onion
    via SSH and run the `manage_agents` script. Following the prompts, add an agent
    with `A`, list agents with `L` to confirm the addition was successful, and extract
    the authentication key for your new agent with `E`:'
  id: totrans-147
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 5\. 要将此新系统添加到您的 Security Onion 中，请通过 SSH 登录到 Security Onion 并运行 `manage_agents`
    脚本。按照提示操作，按 `A` 添加代理，按 `L` 列出代理以确认添加是否成功，按 `E` 提取新代理的认证密钥：
- en: '[PRE5]'
  id: totrans-148
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'You’ll have to provide a name and IP address when you add an agent ❶. For the
    name, use the hostname of the computer being added. Run the `hostname` command
    to find the name:'
  id: totrans-149
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 添加代理时，您需要提供名称和 IP 地址 ❶。名称使用正在添加的计算机的主机名。运行 `hostname` 命令以查找名称：
- en: '[PRE6]'
  id: totrans-150
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE6]'
- en: Find your IP address (see [Project 8](nsp-enoka501485-0010.xhtml#hd0308) in
    [Chapter 1](nsp-enoka501485-0010.xhtml#ch01)) or consult the asset list or network
    map you’ve been maintaining. When you list the agents, verify that an agent with
    that name and IP address is present ❷. Use the agent’s ID number to get its authentication
    key ❸. Return to the main menu with enter and use the `Q` option to quit.
  id: totrans-151
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 查找您的 IP 地址（参见[项目 8](nsp-enoka501485-0010.xhtml#hd0308)中的[第 1 章](nsp-enoka501485-0010.xhtml#ch01)）或查阅您维护的资产列表或网络图。列出代理时，确认是否存在该名称和
    IP 地址的代理 ❷。使用代理的 ID 号码获取其认证密钥 ❸。按回车键返回主菜单，并使用 `Q` 选项退出。
- en: 6\. Open the **Wazuh Agent Manager** on your Windows computer (see [Figure 10-5](nsp-enoka501485-0019.xhtml#fig1005))
    and enter the IP address of your Security Onion system and the agent authentication
    key; click **Save**.
  id: totrans-152
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 6\. 在您的 Windows 计算机上打开**Wazuh 代理管理器**（参见[图 10-5](nsp-enoka501485-0019.xhtml#fig1005)），输入您的
    Security Onion 系统的 IP 地址和代理认证密钥，然后点击**保存**。
- en: '![screenshot of the wazuh agent manager window that shows information including
    the current version of wazuh, the agent, and the status. Text boxes below this
    information allow you to type in the Manager IP and the Authentication key. Below
    them are buttons to Save or Refresh.](images/nsp-enoka501485-fig1005.jpg)'
  id: totrans-153
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![Wazuh 代理管理窗口截图，显示包括当前 Wazuh 版本、代理及状态等信息。信息下方的文本框允许您输入管理器 IP 地址和认证密钥。下面有保存或刷新按钮。](images/nsp-enoka501485-fig1005.jpg)'
- en: 'Figure 10-5: Wazuh agent configuration'
  id: totrans-154
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 10-5：Wazuh 代理配置
- en: 7\. Click **Manage▸Start** to start the agent.
  id: totrans-155
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**管理▸启动**以启动代理。
- en: '8\. Every time you add an agent or make a change to Security Onion or the systems
    that communicate with it, run the `so-allow` script to enable communication between
    the devices (otherwise, the host firewall on Security Onion will block it). You
    should do this at the terminal, logged in to the Security Onion system via SSH:'
  id: totrans-156
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 每次你添加代理或对 Security Onion 或与其通信的系统进行更改时，运行`so-allow`脚本以启用设备之间的通信（否则，Security
    Onion 上的主机防火墙将会阻止它）。你应该在终端中进行此操作，登录到通过 SSH 访问的 Security Onion 系统：
- en: '[PRE7]'
  id: totrans-157
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 9\. When prompted, enter `w` to add a firewall rule for a Wazuh agent; then
    enter the agent’s IP address.
  id: totrans-158
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 当系统提示时，输入`w`以添加一个 Wazuh 代理的防火墙规则；然后输入代理的 IP 地址。
- en: Wazuh will now manage this PC. Repeat the process for all other devices (computers,
    laptops, virtual machines, and so on) in your network that you want to manage
    in this way. System event logs will then start showing up in your Kibana dashboard,
    so expect to see new data and alerts in Security Onion.
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: Wazuh 现在将管理这台 PC。对于网络中你希望以这种方式管理的所有其他设备（如计算机、笔记本、虚拟机等），重复此过程。系统事件日志将开始显示在你的
    Kibana 仪表盘中，因此预计会看到新的数据和警报出现在 Security Onion 中。
- en: '[Installing Wazuh on macOS](nsp-enoka501485-0007.xhtml#rbh1205)'
  id: totrans-160
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: '[在 macOS 上安装 Wazuh](nsp-enoka501485-0007.xhtml#rbh1205)'
- en: 'To install the Wazuh agent on your macOS endpoint(s), follow these steps:'
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 要在你的 macOS 端点上安装 Wazuh 代理，请按照以下步骤操作：
- en: 1\. Log in to your Security Onion console, click **Downloads**, and download
    the macOS package.
  id: totrans-162
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 登录到你的 Security Onion 控制台，点击**下载**，并下载 macOS 包。
- en: 2\. Run the installation wizard on your Mac.
  id: totrans-163
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 运行安装向导在你的 Mac 上进行安装。
- en: 3\. Once complete, log in to your Security Onion system and run `sudo so-allow`
    to allow your Mac access through the firewall (this must be done before agent
    registration; otherwise, the agent won’t be able to connect to the management
    server).
  id: totrans-164
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦完成，登录到你的 Security Onion 系统并运行`sudo so-allow`，允许你的 Mac 通过防火墙访问（此操作必须在代理注册之前完成，否则代理无法连接到管理服务器）。
- en: 4\. Following the prompts, choose the Wazuh registration service with `r` and
    enter the IP address of your endpoint.
  id: totrans-165
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 按照提示，选择 Wazuh 注册服务，输入`r`并输入你的端点的 IP 地址。
- en: '5\. Now, register the agent with the Security Onion server:'
  id: totrans-166
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，将代理注册到 Security Onion 服务器：
- en: '[PRE8]'
  id: totrans-167
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE8]'
- en: Next, you’ll add the Security Onion’s IP address to the agent configuration
    file on your Mac so the agent can communicate with the Security Onion server.
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，你需要将 Security Onion 的 IP 地址添加到 Mac 上的代理配置文件中，这样代理才能与 Security Onion 服务器进行通信。
- en: 6\. Open */Library/Ossec/etc/ossec.conf* with a text editor.
  id: totrans-169
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开*/Library/Ossec/etc/ossec.conf* 文件并使用文本编辑器进行编辑。
- en: '7\. Find the following lines and change `MANAGER_IP` to your Security Onion
    server’s IP address:'
  id: totrans-170
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 找到以下行并将`MANAGER_IP`更改为你的 Security Onion 服务器的 IP 地址：
- en: '[PRE9]'
  id: totrans-171
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE9]'
- en: '8\. Restart the Wazuh agent:'
  id: totrans-172
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 重启 Wazuh 代理：
- en: '[PRE10]'
  id: totrans-173
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE10]'
- en: '9\. Confirm the agent has been successfully configured by listing the agents
    on the Security Onion server; run the *manage_agents* script and enter `L` when
    prompted for an action:'
  id: totrans-174
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 确认代理已成功配置，可以通过在 Security Onion 服务器上列出代理来验证；运行*manage_agents*脚本并在提示时输入`L`来进行操作：
- en: '[PRE11]'
  id: totrans-175
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE11]'
- en: If you see the hostname and IP address of the Mac, the agent is active. Return
    to the main menu with enter and use the `Q` option to quit.
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你看到 Mac 的主机名和 IP 地址，说明代理已处于活动状态。按回车键返回主菜单，使用`Q`选项退出。
- en: '[Installing Wazuh on Linux](nsp-enoka501485-0007.xhtml#rbh1206)'
  id: totrans-177
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: '[在 Linux 上安装 Wazuh](nsp-enoka501485-0007.xhtml#rbh1206)'
- en: 'To install the Wazuh agent on your Linux endpoint(s), follow these steps:'
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: 要在你的 Linux 端点上安装 Wazuh 代理，请按照以下步骤操作：
- en: 1\. Log in to your Security Onion console, click **Downloads**, and download
    the relevant package. For Ubuntu, this will be the DEB package (it’ll be the RPM
    package for CentOS and Fedora).
  id: totrans-179
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 登录到你的 Security Onion 控制台，点击**下载**，并下载相关包。对于 Ubuntu，应该是 DEB 包（对于 CentOS 和 Fedora，则是
    RPM 包）。
- en: 'You can download the package directly from your Ubuntu system, or you can download
    the package to your Windows or Mac computer and transfer it to your Ubuntu system:'
  id: totrans-180
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 你可以直接从你的 Ubuntu 系统下载包，或者你可以将包下载到 Windows 或 Mac 计算机并将其传输到 Ubuntu 系统：
- en: '[PRE12]'
  id: totrans-181
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE12]'
- en: When installing packages directly from package files (like *.deb* files), use
    the dpkg utility instead of the APT package manager (dpkg is the Debian package
    manager and is used similarly to APT).
  id: totrans-182
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 从包文件（如*.deb*文件）直接安装包时，使用 dpkg 工具，而不是 APT 包管理器（dpkg 是 Debian 包管理器，使用方式与 APT 类似）。
- en: '2\. To install the Wazuh agent, run the following:'
  id: totrans-183
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要安装 Wazuh 代理，运行以下命令：
- en: '[PRE13]'
  id: totrans-184
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE13]'
- en: Your package’s version number may be different.
  id: totrans-185
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 你的包版本号可能不同。
- en: 3\. Next, log in to your Security Onion system via SSH and run `sudo so-allow`
    to allow your Linux system access through the firewall.
  id: totrans-186
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，通过 SSH 登录到你的 Security Onion 系统，并运行`sudo so-allow`以允许你的 Linux 系统通过防火墙访问。
- en: 4\. Following the prompts, choose the Wazuh registration service with `r` and
    enter your endpoint’s IP address.
  id: totrans-187
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 按照提示，选择 Wazuh 注册服务并输入你端点的 IP 地址，使用`r`键。
- en: '5\. Register the Linux agent and connect it to the Wazuh management server
    (that is, the Security Onion server):'
  id: totrans-188
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 注册 Linux 代理并将其连接到 Wazuh 管理服务器（即 Security Onion 服务器）：
- en: '[PRE14]'
  id: totrans-189
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE14]'
- en: '6\. Then, modify the configuration file on your Linux system to allow it to
    communicate with the management server by changing the `MANAGER_IP` placeholder
    in the *ossec.conf* file to the IP address of your Security Onion server:'
  id: totrans-190
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后，修改你 Linux 系统上的配置文件，允许它与管理服务器进行通信，方法是将 *ossec.conf* 文件中的`MANAGER_IP`占位符更改为
    Security Onion 服务器的 IP 地址：
- en: '[PRE15]'
  id: totrans-191
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE15]'
- en: '7\. Restart the Wazuh agent to start sending data to Security Onion with this:'
  id: totrans-192
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 重启 Wazuh 代理以开始将数据发送到 Security Onion，使用以下命令：
- en: '[PRE16]'
  id: totrans-193
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE16]'
- en: '8\. Finally, confirm the agent has been successfully configured by listing
    the agents on the Security Onion server; run the `manage_agents` script and enter
    `L` when prompted for an action:'
  id: totrans-194
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后，通过列出 Security Onion 服务器上的代理来确认代理是否已成功配置；运行`manage_agents`脚本并在提示时输入`L`来执行操作：
- en: '[PRE17]'
  id: totrans-195
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE17]'
- en: 9\. If you see the Linux computer’s hostname and IP address, the agent should
    be active. Press ENTER to return to the main menu, and enter `Q` to quit.
  id: totrans-196
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果你看到 Linux 计算机的主机名和 IP 地址，代理应该是激活状态。按 ENTER 返回主菜单，然后输入`Q`退出。
- en: You can now manage all types of computers in your network with Wazuh.
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，你可以使用 Wazuh 管理网络中所有类型的计算机。
- en: '[#38: Installing osquery](nsp-enoka501485-0007.xhtml#rhd1204)'
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: '[#38: 安装 osquery](nsp-enoka501485-0007.xhtml#rhd1204)'
- en: osquery provides improved visibility within your network. It gathers endpoint
    data such as the operating system details, installed software, command-line history,
    and details of running processes; you can then query this data to identify suspicious
    activity or devices not in compliance with your security policies or configurations.
    When used together with Wazuh, these tools provide a detailed view of the systems
    in your network and what each of them is doing or being used for, legitimately
    or not. Once installed, osquery uses a user interface called Fleet to display
    and manage the details of your monitored endpoints.
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
  zh: osquery 提供了更强的网络可见性。它收集端点数据，如操作系统详情、已安装的软件、命令行历史记录以及正在运行的进程详情；然后你可以查询这些数据，识别可疑活动或未遵循安全策略或配置的设备。与
    Wazuh 配合使用时，这些工具为你的网络中的系统提供了详细的视图，展示每个系统正在做什么，合法的还是非法的。一旦安装完成，osquery 使用一个名为 Fleet
    的用户界面来显示和管理你监控的端点的详细信息。
- en: '[Installing osquery on Windows](nsp-enoka501485-0007.xhtml#rbh1207)'
  id: totrans-200
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: '[在 Windows 上安装 osquery](nsp-enoka501485-0007.xhtml#rbh1207)'
- en: 'To install the osquery agent on your Windows endpoint(s), follow these steps:'
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: 要在你的 Windows 端点上安装 osquery 代理，请按照以下步骤操作：
- en: 1\. Log in to your Security Onion console, click **Downloads**, and download
    the osquery package for Windows (the MSI file).
  id: totrans-202
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 登录到你的 Security Onion 控制台，点击**下载**，并下载适用于 Windows 的 osquery 包（MSI 文件）。
- en: 2\. Execute this file on your Windows system and complete the installation wizard.
  id: totrans-203
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 Windows 系统上执行此文件并完成安装向导。
- en: Once osquery is installed, it’ll be invisible and run in the background; there’s
    no user interface to deal with.
  id: totrans-204
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 一旦 osquery 安装完成，它将处于后台运行，不会显示用户界面。
- en: 3\. Next, log in to your Security Onion system via SSH and run `sudo so-allow`
    to allow your computer and osquery access through the firewall. Enter `o` (for
    osquery) and the IP address of your Windows system when prompted.
  id: totrans-205
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，通过 SSH 登录到你的 Security Onion 系统，并运行`sudo so-allow`以允许你的计算机和 osquery 通过防火墙访问。按提示输入`o`（代表
    osquery）和你的 Windows 系统的 IP 地址。
- en: 4\. To view and manage systems with osquery, log in to your Security Onion console.
    In the left menu, click the **Fleet** link to open the Fleet Manager Dashboard.
  id: totrans-206
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要查看和管理使用 osquery 的系统，登录到你的 Security Onion 控制台。在左侧菜单中，点击**Fleet**链接以打开 Fleet
    管理仪表盘。
- en: When you install osquery on an endpoint and after you run `so-allow` to enable
    communication between the osquery agent and the Security Onion server, your managed
    hosts should show up here as cards; it can take a few minutes for communication
    to begin.
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
  zh: 当你在端点上安装 osquery，并且运行`so-allow`来启用 osquery 代理与 Security Onion 服务器之间的通信时，你的管理主机应该会以卡片形式出现在此处；通信开始可能需要几分钟时间。
- en: '[Installing osquery on macOS](nsp-enoka501485-0007.xhtml#rbh1208)'
  id: totrans-208
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: '[在 macOS 上安装 osquery](nsp-enoka501485-0007.xhtml#rbh1208)'
- en: 'To install the osquery agent on your macOS endpoint(s), follow these steps:'
  id: totrans-209
  prefs: []
  type: TYPE_NORMAL
  zh: 要在您的 macOS 终端上安装 osquery 代理，请按照以下步骤操作：
- en: 1\. Log in to your Security Onion console, click **Downloads**, and download
    the osquery package for Mac (the PKG file).
  id: totrans-210
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 1\. 登录到您的 Security Onion 控制台，点击 **下载**，并下载适用于 Mac 的 osquery 包（PKG 文件）。
- en: 2\. Run `sudo so-allow` on your Security Onion server and add your Mac to the
    list of allowed agents for osquery. Enter `o` (for osquery) and the IP address
    of your Mac when prompted.
  id: totrans-211
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 2\. 在您的 Security Onion 服务器上运行 `sudo so-allow`，并将您的 Mac 添加到 osquery 允许的代理列表中。提示时输入
    `o`（代表 osquery）和您的 Mac 的 IP 地址。
- en: 3\. Execute the file you downloaded and complete the installation wizard on
    your Mac.
  id: totrans-212
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 3\. 执行您下载的文件，并在您的 Mac 上完成安装向导。
- en: 4\. Log in to the Fleet Manager Dashboard and click **Add New Host** to find
    your Fleet Secret.
  id: totrans-213
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 4\. 登录到 Fleet Manager Dashboard，点击 **添加新主机** 来查找您的 Fleet Secret。
- en: 5\. Add your Fleet Secret to the */etc/so-launcher/secret* file using any text
    editor.
  id: totrans-214
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 5\. 使用任何文本编辑器，将您的 Fleet Secret 添加到 */etc/so-launcher/secret* 文件中。
- en: '6\. Update */etc/so-launcher/launcher.flags* so the hostname value is `security_onion_IP``:8090`
    and the root directory value is `/var/so-launcher/``security_onion_IP``-8090`:'
  id: totrans-215
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 6\. 更新 */etc/so-launcher/launcher.flags*，使主机名值为 `security_onion_IP``:8090`，根目录值为
    `/var/so-launcher/``security_onion_IP``-8090`：
- en: '[PRE18]'
  id: totrans-216
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 7\. Copy the contents of the */etc/ssl/certs/intca.crt* file on your Security
    Onion server into the */etc/so-launcher/roots.pem* file on your Mac.
  id: totrans-217
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 7\. 将 Security Onion 服务器上 */etc/ssl/certs/intca.crt* 文件的内容复制到 Mac 上的 */etc/so-launcher/roots.pem*
    文件中。
- en: After a few minutes, your Mac should show up as a new card in the Fleet Manager
    Dashboard.
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: 几分钟后，您的 Mac 应该会作为一张新卡片出现在 Fleet Manager Dashboard 中。
- en: '[Installing osquery on Linux](nsp-enoka501485-0007.xhtml#rbh1209)'
  id: totrans-219
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: '[在 Linux 上安装 osquery](nsp-enoka501485-0007.xhtml#rbh1209)'
- en: 'To install the osquery agent on your Linux endpoint(s), follow these steps:'
  id: totrans-220
  prefs: []
  type: TYPE_NORMAL
  zh: 要在您的 Linux 终端上安装 osquery 代理，请按照以下步骤操作：
- en: 1\. Log in to your Security Onion console, click **Downloads**, and download
    the osquery package for Linux (the DEB file for Ubuntu, RPM for CentOS, and so
    on).
  id: totrans-221
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 1\. 登录到您的 Security Onion 控制台，点击 **下载**，并下载适用于 Linux 的 osquery 包（Ubuntu 的 DEB
    文件，CentOS 的 RPM 文件，等等）。
- en: 2\. Run `sudo so-allow` on your Security Onion server to add your Linux system
    to the list of allowed agents for osquery. Enter `o` (for osquery) and the IP
    address of your Linux system when prompted.
  id: totrans-222
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 2\. 在您的 Security Onion 服务器上运行 `sudo so-allow`，将您的 Linux 系统添加到 osquery 允许的代理列表中。提示时输入
    `o`（代表 osquery）和您的 Linux 系统的 IP 地址。
- en: '3\. Install the downloaded file on your Linux system; here’s an example using
    dpkg on Ubuntu:'
  id: totrans-223
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 3\. 在您的 Linux 系统上安装下载的文件；以下是使用 dpkg 在 Ubuntu 上安装的示例：
- en: '[PRE19]'
  id: totrans-224
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE19]'
- en: Your Linux system should automatically show up as a new card in your Fleet Manager
    dashboard.
  id: totrans-225
  prefs: []
  type: TYPE_NORMAL
  zh: 您的 Linux 系统应该会自动显示为 Fleet Manager 仪表板中的一张新卡片。
- en: '[A Network Security Monitoring Crash Course](nsp-enoka501485-0007.xhtml#rah1203)'
  id: totrans-226
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: '[网络安全监控速成课程](nsp-enoka501485-0007.xhtml#rah1203)'
- en: You’ve now installed the necessary hardware and software to monitor your network
    for suspicious and malicious activity. You need to be able to identify issues,
    respond to incidents when they occur, and keep your network, users, and data secure.
    In this section, we’ll cover the fundamentals of how to configure and make use
    of osquery, Wazuh, and the Security Onion Alerts Dashboard.
  id: totrans-227
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，您已经安装了必要的硬件和软件来监控您的网络是否存在可疑和恶意活动。您需要能够识别问题，发生事件时作出响应，并保持网络、用户和数据的安全。在本节中，我们将介绍如何配置并使用
    osquery、Wazuh 和 Security Onion 警报仪表板的基本知识。
- en: '[Using osquery](nsp-enoka501485-0007.xhtml#rbh1210)'
  id: totrans-228
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: '[使用 osquery](nsp-enoka501485-0007.xhtml#rbh1210)'
- en: If you’re familiar with *relational databases* and *Structured Query Language
    (SQL)*, using osquery will be reasonably easy for you. If not, here are the basics.
    You can view all the data for the devices in your network that osquery manages
    in the Fleet Manager Dashboard. To reach the dashboard, log in to your Security
    Onion console at *https://<security_onion_IP>/* and click **Fleet** in the administrator
    menu on the left.
  id: totrans-229
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您熟悉 *关系型数据库* 和 *结构化查询语言（SQL）*，那么使用 osquery 对您来说会相对容易。如果不熟悉，下面是一些基础知识。您可以在
    Fleet Manager Dashboard 中查看 osquery 管理的网络中设备的所有数据。要进入仪表板，请登录到您的 Security Onion
    控制台，网址为 *https://<security_onion_IP>/*，并在左侧管理员菜单中点击 **Fleet**。
- en: Data is stored in a series of *data tables*, wherein each table contains two
    or more columns (also called *tuples*) that include information such as hostname,
    IP address, MAC address, uptime, last shutdown time, and so on, for each device.
    Each row in the table relates to a specific entity, such as a computer or laptop,
    or something more atomic, like a specific user account on a device. For example,
    the *users* table looks similar to [Table 10-1](nsp-enoka501485-0019.xhtml#tab1001).
  id: totrans-230
  prefs: []
  type: TYPE_NORMAL
  zh: 数据存储在一系列*数据表*中，每个表包含两个或更多列（也称为*元组*），其中包含诸如主机名、IP 地址、MAC 地址、运行时间、最后关机时间等信息，每一行都代表一个特定实体，如计算机或笔记本电脑，或更为具体的内容，如设备上的特定用户账户。例如，*users*表类似于[表
    10-1](nsp-enoka501485-0019.xhtml#tab1001)。
- en: '| Table 10-1: The osquery Users Table |'
  id: totrans-231
  prefs: []
  type: TYPE_TB
  zh: '| 表 10-1：osquery 用户表 |'
- en: '| --- |'
  id: totrans-232
  prefs: []
  type: TYPE_TB
  zh: '| --- |'
- en: '| UID | GID | UID_Signed | GID_Signed | Username | Description |'
  id: totrans-233
  prefs: []
  type: TYPE_TB
  zh: '| UID | GID | UID_Signed | GID_Signed | 用户名 | 描述 |'
- en: '| --- | --- | --- | --- | --- | --- |'
  id: totrans-234
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- | --- | --- | --- |'
- en: '| 0 | 0 | 0 | 0 | testuser | A test user account |'
  id: totrans-235
  prefs: []
  type: TYPE_TB
  zh: '| 0 | 0 | 0 | 0 | testuser | 一个测试用户账户 |'
- en: The Username column’s first row of data pertains to the *testuser* account on
    a device. Each of these tables is related to one or more of the other tables in
    the database (of which there are more than 200). These tables and their relationships
    allow you to perform powerful queries about the details and status of each managed
    device.
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
  zh: 用户名列的第一行数据涉及设备上的*testuser*账户。每个表都与数据库中其他一个或多个表有关（数据库中有超过 200 个表）。这些表及其关系使你能够执行关于每个管理设备的详细信息和状态的强大查询。
- en: 'We can ask questions of this data using a query language called SQL, a high-level
    language for accessing and manipulating databases. A SQL query looks like this:'
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以使用一种叫做 SQL 的查询语言来对这些数据提问，它是一种用于访问和操作数据库的高级语言。一个 SQL 查询如下所示：
- en: '[PRE20]'
  id: totrans-238
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: In this query, the uppercase commands, `SELECT` and `FROM`, indicate the action
    you want to perform—in this case, asking for the data in columns 1 and 2, represented
    by the `c1` and `c2` parameters, from the table called `tablename`.
  id: totrans-239
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个查询中，大写的命令 `SELECT` 和 `FROM` 表示你要执行的操作——在这种情况下，要求从名为 `tablename` 的表中提取第 1
    列和第 2 列的数据，分别由 `c1` 和 `c2` 参数表示。
- en: 'In practice, that query would look like this:'
  id: totrans-240
  prefs: []
  type: TYPE_NORMAL
  zh: 实际上，这个查询的格式如下：
- en: '[PRE21]'
  id: totrans-241
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: The first command returns (displays to the user running the query) all the usernames
    that exist in the `users` table and no other columns. The second command returns
    all (`*`) of the columns and rows from the `users` table.
  id: totrans-242
  prefs: []
  type: TYPE_NORMAL
  zh: 第一个命令返回（显示给运行查询的用户）`users` 表中存在的所有用户名，而不包括其他列。第二个命令返回 `users` 表中的所有列和所有行（`*`）。
- en: Note Several SQL commands are available for retrieving data in different ways;
    see the SQL cheat sheet at [https://www.sqltutorial.org/sql-cheat-sheet/](https://www.sqltutorial.org/sql-cheat-sheet/)
    for more details. See also the osquery documentation at [https://osquery.io/](https://osquery.io/)
    for a listing of all available tables and their data.
  id: totrans-243
  prefs: []
  type: TYPE_NORMAL
  zh: 注意：有多种 SQL 命令可用于以不同方式检索数据；详情请参见 SQL 备忘单 [https://www.sqltutorial.org/sql-cheat-sheet/](https://www.sqltutorial.org/sql-cheat-sheet/)。也可以查看
    [https://osquery.io/](https://osquery.io/) 上的 osquery 文档，了解所有可用表及其数据的列表。
- en: Fleet stores a lot of queries in your Fleet dashboard. Click the **Query** menu
    on the left of the page (see [Figure 10-6](nsp-enoka501485-0019.xhtml#fig1006)).
  id: totrans-244
  prefs: []
  type: TYPE_NORMAL
  zh: Fleet 在你的 Fleet 控制面板中存储了大量查询。点击页面左侧的**查询**菜单（见[图 10-6](nsp-enoka501485-0019.xhtml#fig1006)）。
- en: '![fleet manager’s query menu shows a search bar, stored queries, and options
    to manage queries or begin a new query.](images/nsp-enoka501485-fig1006.jpg)'
  id: totrans-245
  prefs: []
  type: TYPE_IMG
  zh: '![fleet manager 的查询菜单显示了搜索框、存储的查询以及管理查询或开始新查询的选项。](images/nsp-enoka501485-fig1006.jpg)'
- en: 'Figure 10-6: Stored SQL queries in Fleet Manager'
  id: totrans-246
  prefs: []
  type: TYPE_NORMAL
  zh: 图 10-6：Fleet Manager 中存储的 SQL 查询
- en: From this menu, you can scroll through the available queries or search for a
    specific query using the search bar at the top of the page. Once you’ve identified
    a query you want to run, click to select it, and then click the **EDIT/RUN QUERY**
    button on the right side. Before you’re able to execute the query, you need to
    select the devices you want to query for this information. Select the relevant
    device(s) from the Select Targets drop-down menu and then click **Run**. When
    the query completes, Fleet will present you with the results of the query at the
    bottom of the screen; you can filter the results using the column filters provided.
  id: totrans-247
  prefs: []
  type: TYPE_NORMAL
- en: 'It’s up to you which queries you run, and it depends on what kinds of problems
    or examples of noncompliance are most concerning to your network. However, these
    are a few good places to start:'
  id: totrans-248
  prefs: []
  type: TYPE_NORMAL
- en: '`users` Useful for identifying user accounts that should or should not exist
    on given endpoints'
  id: totrans-249
  prefs: []
  type: TYPE_NORMAL
- en: '`browser_plugins` Shows all browser plug-ins on a device(s); useful if your
    users install potentially malicious browser plug-ins'
  id: totrans-250
  prefs: []
  type: TYPE_NORMAL
- en: '`chrome_extension` As previously, specifically looking for Chrome plug-ins'
  id: totrans-251
  prefs: []
  type: TYPE_NORMAL
- en: '`crontab` Identifies scheduled tasks on Linux systems performing suspicious
    or malicious activity'
  id: totrans-252
  prefs: []
  type: TYPE_NORMAL
- en: '`disk_free_space_pct` Identifies devices with low disk space'
  id: totrans-253
  prefs: []
  type: TYPE_NORMAL
- en: '`installed_applications` Identifies malicious or potentially unwanted applications
    installed on devices'
  id: totrans-254
  prefs: []
  type: TYPE_NORMAL
- en: The Hosts dashboard in Fleet shows the details for each managed device at a
    glance in the form of cards (see [Figure 10-7](nsp-enoka501485-0019.xhtml#fig1007)).
  id: totrans-255
  prefs: []
  type: TYPE_NORMAL
- en: '![The Fleet Host dashboard shows information for various devices.](images/nsp-enoka501485-fig1007.jpg)'
  id: totrans-256
  prefs: []
  type: TYPE_IMG
- en: 'Figure 10-7: Fleet Host dashboard view'
  id: totrans-257
  prefs: []
  type: TYPE_NORMAL
- en: Here you can see the hostname, operating system, osquery version, processor
    details, amount of RAM, uptime, MAC address, and IP address of this host. Clicking
    the blue query button (the stacked cylinders) at the top right will allow you
    to easily query this device.
  id: totrans-258
  prefs: []
  type: TYPE_NORMAL
- en: Spend some time familiarizing yourself with the available queries and do some
    online research to find other potentially useful queries. Try reviewing some of
    the saved queries and edit or copy them to get the queries you want.
  id: totrans-259
  prefs: []
  type: TYPE_NORMAL
- en: '[Using Wazuh](nsp-enoka501485-0007.xhtml#rbh1211)'
  id: totrans-260
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: We installed the Wazuh agent in [Project 35](nsp-enoka501485-0019.xhtml#hd1201),
    and we’ll configure it in this section. Wazuh allows us to review the logs and
    alerts in Security Onion, which we’ll explore in the next section.
  id: totrans-261
  prefs: []
  type: TYPE_NORMAL
- en: 'The primary Wazuh config file is located at */opt/so/conf/wazuh/ossec.conf*
    on the Security Onion system. Each section of this configuration file is separate
    and identified with a line like the following:'
  id: totrans-262
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE22]'
  id: totrans-263
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: You can revise the settings in this file to change the way Wazuh behaves, which
    can be useful if, for example, Wazuh reacts to a false positive detection and
    stops you from doing something benign. Review this file to get an understanding
    of the types of things Wazuh monitors for.
  id: totrans-264
  prefs: []
  type: TYPE_NORMAL
- en: 'The section shown in the following snippet specifies files that contain lists
    of files that are known or expected to be malicious based on identified adversary
    behaviors, followed by files that are expected to contain trojans (a type of virus)
    and then files and folders to audit for various vulnerabilities:'
  id: totrans-265
  prefs: []
  type: TYPE_NORMAL
  zh: 以下片段显示的部分指定了包含已知或预计为恶意的文件列表的文件，这些文件是基于识别出的对手行为，并接着是预计包含木马（病毒的一种）的文件，以及需要审计的各种漏洞文件和文件夹：
- en: '`--snip--`'
  id: totrans-266
  prefs: []
  type: TYPE_NORMAL
  zh: '`--snip--`'
- en: <rootkit_files>/var/ossec/etc/shared/rootkit_files.txt</rootkit_files>
  id: totrans-267
  prefs: []
  type: TYPE_NORMAL
  zh: <rootkit_files>/var/ossec/etc/shared/rootkit_files.txt</rootkit_files>
- en: <rootkit_trojans>/var/ossec/etc/shared/rootkit_trojans.txt</rootkit_trojans>
  id: totrans-268
  prefs: []
  type: TYPE_NORMAL
  zh: <rootkit_trojans>/var/ossec/etc/shared/rootkit_trojans.txt</rootkit_trojans>
- en: <system_audit>/var/ossec/etc/shared/system_audit_rcl.txt</system_audit>
  id: totrans-269
  prefs: []
  type: TYPE_NORMAL
  zh: <system_audit>/var/ossec/etc/shared/system_audit_rcl.txt</system_audit>
- en: <system_audit>/var/ossec/etc/shared/system_audit_ssh.txt</system_audit>
  id: totrans-270
  prefs: []
  type: TYPE_NORMAL
  zh: <system_audit>/var/ossec/etc/shared/system_audit_ssh.txt</system_audit>
- en: <system_audit>/var/ossec/etc/shared/cis_rhel7_linux_rcl.txt</system_audit>
  id: totrans-271
  prefs: []
  type: TYPE_NORMAL
  zh: <system_audit>/var/ossec/etc/shared/cis_rhel7_linux_rcl.txt</system_audit>
- en: '`--snip--`'
  id: totrans-272
  prefs: []
  type: TYPE_NORMAL
  zh: '`--snip--`'
- en: Each of these files contains a list of things Wazuh will monitor. If the agent
    detects a file or configuration on a device that matches a behavior or setting
    in the *rootkit_files.txt* file, it will take action to remediate that threat.
    If you don’t want it to take that action, delete or comment out that line in the
    configuration file with a `#`.
  id: totrans-273
  prefs: []
  type: TYPE_NORMAL
  zh: 这些文件中的每一个都包含 Wazuh 将监控的内容。如果代理在设备上检测到与 *rootkit_files.txt* 文件中的行为或设置匹配的文件或配置，它将采取行动修复该威胁。如果你不希望它采取该行动，可以删除或注释掉配置文件中的该行，使用
    `#`。
- en: 'When you update Wazuh as part of your efforts to consistently update and patch
    your Security Onion and other systems, the configuration files such as *rootkit_files.txt*
    may also receive updates. This ensures that as new threats are identified and
    indicators of compromise are made publicly available, your network stays protected.
    To avoid losing any changes you make to these files, consider creating new, custom
    configuration files (such as *my_custom_trojans.txt*) and adding a reference to
    this file in the *ossec.conf* file, such as the following example:'
  id: totrans-274
  prefs: []
  type: TYPE_NORMAL
  zh: 当你更新 Wazuh，作为你持续更新和修补 Security Onion 及其他系统的一部分时，配置文件如 *rootkit_files.txt* 也可能会收到更新。这确保了随着新威胁的识别和妥协指标的公开发布，你的网络保持受到保护。为了避免丢失你对这些文件所做的任何更改，考虑创建新的自定义配置文件（例如
    *my_custom_trojans.txt*）并在 *ossec.conf* 文件中添加对该文件的引用，如下所示：
- en: '`--snip--`'
  id: totrans-275
  prefs: []
  type: TYPE_NORMAL
  zh: '`--snip--`'
- en: <rootkit_files>/var/ossec/etc/shared/rootkit_files.txt</rootkit_files>
  id: totrans-276
  prefs: []
  type: TYPE_NORMAL
  zh: <rootkit_files>/var/ossec/etc/shared/rootkit_files.txt</rootkit_files>
- en: <rootkit_trojans>/var/ossec/etc/shared/rootkit_trojans.txt</rootkit_trojans>
  id: totrans-277
  prefs: []
  type: TYPE_NORMAL
  zh: <rootkit_trojans>/var/ossec/etc/shared/rootkit_trojans.txt</rootkit_trojans>
- en: <rootkit_trojans>/var/ossec/etc/shared/my_custom_trojans.txt</rootkit_trojans>
  id: totrans-278
  prefs: []
  type: TYPE_NORMAL
  zh: <rootkit_trojans>/var/ossec/etc/shared/my_custom_trojans.txt</rootkit_trojans>
- en: '`--snip--`'
  id: totrans-279
  prefs: []
  type: TYPE_NORMAL
  zh: '`--snip--`'
- en: Adding files to the *ossec.conf* file will result in Wazuh referring to those
    files for its configuration and settings, in addition to its default configuration
    files. Using custom files is a good way to add custom configurations that you
    might have.
  id: totrans-280
  prefs: []
  type: TYPE_NORMAL
  zh: 将文件添加到 *ossec.conf* 文件中，将导致 Wazuh 参考这些文件进行配置和设置，除此之外，它还会参考默认的配置文件。使用自定义文件是添加你可能拥有的自定义配置的好方法。
- en: If you want Wazuh to ignore a directory or list of directories on any of the
    endpoints on which it’s installed, add that information in the relevant section.
    You can also tell the agent to ignore specific files or file types, to exclude
    certain devices from active response (if you want the agent to never block activity
    on a specific device that might impact your network), and to set various other
    options. Familiarize yourself with these configuration files so you can tailor
    them to your environment.
  id: totrans-281
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你希望 Wazuh 忽略已安装的端点上的某个目录或多个目录，可以在相关部分添加该信息。你还可以告诉代理忽略特定文件或文件类型，排除某些设备的主动响应（如果你希望代理永远不阻止可能影响网络的特定设备的活动），并设置其他各种选项。熟悉这些配置文件，以便根据你的环境进行定制。
- en: '[Using Security Onion as a SIEM Tool](nsp-enoka501485-0007.xhtml#rbh1212)'
  id: totrans-282
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: '[将 Security Onion 作为 SIEM 工具使用](nsp-enoka501485-0007.xhtml#rbh1212)'
- en: Security Onion, in addition to the other useful capabilities it provides, acts
    as a *security information and event management (SIEM)* tool. Several SIEMs are
    available on the market, including Splunk, SolarWinds, or ManageEngine, all of
    which are commercial solutions and can be very expensive. Security Onion, on the
    other hand, is open source and free.
  id: totrans-283
  prefs: []
  type: TYPE_NORMAL
  zh: 除了提供其他有用功能外，Security Onion还充当*安全信息和事件管理（SIEM）*工具。市场上有几种SIEM可供选择，包括Splunk、SolarWinds和ManageEngine，所有这些都是商业解决方案，并且价格非常昂贵。而Security
    Onion则是开源且免费的。
- en: A SIEM is designed to aggregate data from devices in a network and act as a
    central repository for logs and other data. Implementing a SIEM like Security
    Onion centralizes your logs, making it harder for an adversary to hide their tracks
    by deleting the logs on any one system. It also enables you to query your logs
    and other system data in one location so you don’t have to check every system
    or device individually, streamlining the process. Security Onion then analyzes
    this data and alerts you to potentially malicious activity. [Figure 10-8](nsp-enoka501485-0019.xhtml#fig1008)
    shows a list of alerts, found by logging in to the Security Onion console and
    clicking the Alerts option in the menu on the left.
  id: totrans-284
  prefs: []
  type: TYPE_NORMAL
  zh: SIEM（安全信息和事件管理系统）旨在从网络中的设备汇总数据，并充当日志和其他数据的中央存储库。实现像Security Onion这样的SIEM可以将日志集中管理，使得攻击者更难通过删除单一系统中的日志来掩盖自己的踪迹。它还使你可以在一个位置查询日志和其他系统数据，这样你就不必逐一检查每个系统或设备，从而简化了过程。然后，Security
    Onion分析这些数据，并警告你可能的恶意活动。[图 10-8](nsp-enoka501485-0019.xhtml#fig1008)显示了通过登录Security
    Onion控制台并点击左侧菜单中的Alerts选项找到的警报列表。
- en: '![Security Onion’s alerts are listed in rows with the following columns: Count,
    rule.name, event.module, event.severity_label. For severity labels marked “low,”
    a yellow bell icon is at the start (the very left) of the row; for those marked
    “medium,” an orange bell icon is present; for “high,” the bell icon is red. For
    example, the first alert listed has a yellow bell, a count of 14,102 instances,
    a rule.name “Windows Logon Success,” the event.module “windows_eventlog,” and
    an event.severity_label of “low.”](images/nsp-enoka501485-fig1008.jpg)'
  id: totrans-285
  prefs: []
  type: TYPE_IMG
  zh: '![Security Onion的警报以行形式列出，包含以下列：Count、rule.name、event.module、event.severity_label。对于标记为“低”的严重性标签，行的最左侧会有一个黄色铃铛图标；对于标记为“中”的严重性标签，会显示一个橙色铃铛图标；对于“高”标签，铃铛图标为红色。例如，列出的第一个警报有一个黄色铃铛图标，出现了14,102次，rule.name为“Windows
    Logon Success”，event.module为“windows_eventlog”，event.severity_label为“低”。](images/nsp-enoka501485-fig1008.jpg)'
- en: 'Figure 10-8: Security Onion alerts'
  id: totrans-286
  prefs: []
  type: TYPE_NORMAL
  zh: 图 10-8：Security Onion警报
- en: When you click an alert, a context menu is displayed with filtering options;
    you can include, exclude, show only, or group by the alert you’ve selected. You
    can also drill down into an alert to show every instance of the alert in the timeframe
    you’re filtering for. By expanding any of these alerts, you can see all of its
    information, including metadata (see [Figure 10-9](nsp-enoka501485-0019.xhtml#fig1009))
    such as the alert’s timestamp, the source and destination IP address of the network
    traffic, the full message associated with the alert, the actual decoded network
    data that caused the rule or alert to fire, the rule itself, and often a reference
    so that you can learn more about the alert, including potential remediation steps
    or other solutions.
  id: totrans-287
  prefs: []
  type: TYPE_NORMAL
  zh: 当你点击一个警报时，会显示一个上下文菜单，提供过滤选项；你可以包含、排除、仅显示或按你选择的警报分组。你还可以深入查看某个警报，显示你过滤的时间范围内该警报的每个实例。通过展开这些警报中的任何一个，你可以查看所有信息，包括元数据（见[图
    10-9](nsp-enoka501485-0019.xhtml#fig1009)），如警报的时间戳、网络流量的源IP和目标IP地址、与警报相关的完整消息、导致规则或警报触发的实际解码网络数据、规则本身，通常还有一个参考，帮助你了解更多关于该警报的信息，包括潜在的修复步骤或其他解决方案。
- en: '![Security Onion alert’s metadata includes the following information for each
    alert: rule.name, rule.reference, rule.rev, rule.rule, rule.ruleset, rule.severity,
    rule.uuid, source.ip, and source.port.](images/nsp-enoka501485-fig1009.jpg)'
  id: totrans-288
  prefs: []
  type: TYPE_IMG
  zh: '![Security Onion警报的元数据包括每个警报的以下信息：rule.name、rule.reference、rule.rev、rule.rule、rule.ruleset、rule.severity、rule.uuid、source.ip和source.port。](images/nsp-enoka501485-fig1009.jpg)'
- en: 'Figure 10-9: Security Onion alert metadata'
  id: totrans-289
  prefs: []
  type: TYPE_NORMAL
  zh: 图 10-9：Security Onion警报元数据
- en: In practice, the alerts dashboard will show a lot of different categories and
    types of activity; you’ll almost always see alerts that require further investigation.
    Let’s discuss a few to help get you started.
  id: totrans-290
  prefs: []
  type: TYPE_NORMAL
  zh: 实际上，警报仪表板将显示许多不同类别和类型的活动；你几乎总是会看到需要进一步调查的警报。让我们讨论几个警报，帮助你入门。
- en: '| Table 10-2: Examples of Potentially Unwanted Software in an Environment |'
  id: totrans-291
  prefs: []
  type: TYPE_TB
  zh: '| 表 10-2：环境中可能存在的不需要的软件示例 |'
- en: '| --- |'
  id: totrans-292
  prefs: []
  type: TYPE_TB
  zh: '| --- |'
- en: '| Rule name | Event module | Severity |'
  id: totrans-293
  prefs: []
  type: TYPE_TB
- en: '| --- | --- | --- |'
  id: totrans-294
  prefs: []
  type: TYPE_TB
- en: '| ET INFO [eSentire] Possible Kali Linux Updates | suricata | high |'
  id: totrans-295
  prefs: []
  type: TYPE_TB
- en: '| ET USER_AGENTS Steam HTTP Client User-Agent | suricata | high |'
  id: totrans-296
  prefs: []
  type: TYPE_TB
- en: '| ET POLICY curl User-Agent Outbound | suricata | medium |'
  id: totrans-297
  prefs: []
  type: TYPE_TB
- en: '| ET POLICY [Dropbox.com](http://www.Dropbox.com) Offsite File Backup in Use
    | suricata | high |'
  id: totrans-298
  prefs: []
  type: TYPE_TB
- en: '| ET SCAN Possible Nmap User-Agent Observed | suricata | high |'
  id: totrans-299
  prefs: []
  type: TYPE_TB
- en: '| ET TFTP Outbound TFTP Read Request | suricata | high |'
  id: totrans-300
  prefs: []
  type: TYPE_TB
- en: '| ET P2P eMule KAD Network Connection Request | suricata | high |'
  id: totrans-301
  prefs: []
  type: TYPE_TB
- en: '[Table 10-2](nsp-enoka501485-0019.xhtml#tab1002) shows several examples of
    software that is potentially vulnerable, could lead to or be used for malicious
    activity, or shouldn’t be on your network in the first place. Kali Linux, for
    example, is typically used for penetration testing, but attackers can also use
    it to compromise your network. If you receive this alert, investigate it, identify
    the system responsible, and remove it from the network. Security Onion provides
    all of the information you need to do this. You could choose to take the source
    IP address in the alert and add firewall rules (on your hosts as well as your
    border firewall) to block all traffic to and from that address, as an example
    of one mitigation strategy.'
  id: totrans-302
  prefs: []
  type: TYPE_NORMAL
- en: Looking at the other alerts in [Table 10-2](nsp-enoka501485-0019.xhtml#tab1002),
    several pieces of software have been identified that might not be allowed or necessary
    in your network. Steam is a game client. Curl is a utility for transferring data
    to or from a server and can be used to exfiltrate data from your network or download
    malware. Dropbox is a cloud storage solution that can likewise be used to exfiltrate
    or steal data. Nmap is a network mapping tool that attackers can use to identify
    potential targets and vulnerabilities within your network. Trivial File Transfer
    Protocol (TFPT) is a vulnerable protocol used for transferring files, and eMule
    is a peer-to-peer application typically used for file sharing.
  id: totrans-303
  prefs: []
  type: TYPE_NORMAL
- en: Generally, if you aren’t using a tool or application, you should uninstall or
    otherwise remove it to prevent attackers from using it and make your network more
    secure. If you don’t use curl, for example, track down the client responsible
    for this alert using the hostname, source and destination IP address, or other
    metadata in the alert itself, and uninstall or remove the offending software.
    If you use Dropbox, you can safely ignore the alert. Otherwise, investigate and
    remove it from your network. Do this for all software-related alerts.
  id: totrans-304
  prefs: []
  type: TYPE_NORMAL
- en: Then, use the same process to investigate and remediate all the alerts related
    to potential malware activity; [Table 10-3](nsp-enoka501485-0019.xhtml#tab1003)
    shows an example. Drill down into each alert, identify the device(s) related to
    the alert, look at the references for the rule behind the alert, and identify
    and resolve the root cause. If you get stuck, an internet search is usually the
    best tool to solve a lot of problems.
  id: totrans-305
  prefs: []
  type: TYPE_NORMAL
- en: '| Table 10-3: Possible Malware Alerts in Security Onion |'
  id: totrans-306
  prefs: []
  type: TYPE_TB
  zh: '| 表 10-3：Security Onion 中可能的恶意软件警报 |'
- en: '| --- |'
  id: totrans-307
  prefs: []
  type: TYPE_TB
  zh: '| --- |'
- en: '| Rule name | Event module | Severity |'
  id: totrans-308
  prefs: []
  type: TYPE_TB
  zh: '| 规则名称 | 事件模块 | 严重性 |'
- en: '| --- | --- | --- |'
  id: totrans-309
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- |'
- en: '| ET JA3 Hash - [Abuse.ch] Possible Adware | suricata | Low |'
  id: totrans-310
  prefs: []
  type: TYPE_TB
  zh: '| ET JA3 Hash - [Abuse.ch] 可能的广告软件 | suricata | 低 |'
- en: '| ET JA3 Hash - Possible Malware - Neutrino | suricata | Low |'
  id: totrans-311
  prefs: []
  type: TYPE_TB
  zh: '| ET JA3 Hash - 可能的恶意软件 - Neutrino | suricata | 低 |'
- en: '| ET INFO Packed Executable Download | suricata | Low |'
  id: totrans-312
  prefs: []
  type: TYPE_TB
  zh: '| ET INFO 打包可执行文件下载 | suricata | 低 |'
- en: '| ET INFO EXE IsDebuggerPresent (Used in Malware Anti-Debugging) | suricata
    | Low |'
  id: totrans-313
  prefs: []
  type: TYPE_TB
  zh: '| ET INFO EXE IsDebuggerPresent（用于恶意软件反调试） | suricata | 低 |'
- en: '| ET EXPLOIT Possible OpenSSL HeartBleed Large HeartBeat Response (Client Init
    Vuln Server) | suricata | Medium |'
  id: totrans-314
  prefs: []
  type: TYPE_TB
  zh: '| ET EXPLOIT 可能的 OpenSSL HeartBleed 大心跳响应（客户端初始化漏洞 服务器） | suricata | 中 |'
- en: '| ET EXPLOIT Possible OpenSSL HeartBleed Large HeartBeat Response (Server Init
    Vuln Client) | suricata | Medium |'
  id: totrans-315
  prefs: []
  type: TYPE_TB
  zh: '| ET EXPLOIT 可能的 OpenSSL HeartBleed 大心跳响应（服务器初始化漏洞 客户端） | suricata | 中 |'
- en: Other alerts of interest are those related to account login or log-off actions
    and elevation of privileges, such as Successful sudo to ROOT executed, as shown
    in [Table 10-4](nsp-enoka501485-0019.xhtml#tab1004).
  id: totrans-316
  prefs: []
  type: TYPE_NORMAL
  zh: 其他值得关注的警报是与账户登录或注销操作以及权限提升相关的警报，例如成功执行的 sudo 提升为 ROOT，如[表 10-4](nsp-enoka501485-0019.xhtml#tab1004)所示。
- en: '| Table 10-4: Successful and Failed Login Alerts in Security Onion |'
  id: totrans-317
  prefs: []
  type: TYPE_TB
  zh: '| 表 10-4：Security Onion 中的成功与失败登录警报 |'
- en: '| --- |'
  id: totrans-318
  prefs: []
  type: TYPE_TB
  zh: '| --- |'
- en: '| Rule name | Event module | Severity |'
  id: totrans-319
  prefs: []
  type: TYPE_TB
  zh: '| 规则名称 | 事件模块 | 严重性 |'
- en: '| --- | --- | --- |'
  id: totrans-320
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- |'
- en: '| Windows Logon Success | windows_eventlog | Low |'
  id: totrans-321
  prefs: []
  type: TYPE_TB
  zh: '| Windows 登录成功 | windows_eventlog | 低 |'
- en: '| PAM: Login session closed. | ossec | Low |'
  id: totrans-322
  prefs: []
  type: TYPE_TB
  zh: '| PAM: 登录会话已关闭。 | ossec | 低 |'
- en: '| PAM: Login session opened. | ossec | Low |'
  id: totrans-323
  prefs: []
  type: TYPE_TB
  zh: '| PAM: 登录会话已打开。 | ossec | 低 |'
- en: '| Successful sudo to ROOT executed. | ossec | Low |'
  id: totrans-324
  prefs: []
  type: TYPE_TB
  zh: '| 成功执行 sudo 提升为 ROOT。 | ossec | 低 |'
- en: '| Logon Failure - Unknown user or bad password | windows_eventlog | Low |'
  id: totrans-325
  prefs: []
  type: TYPE_TB
  zh: '| 登录失败 - 未知用户或密码错误 | windows_eventlog | 低 |'
- en: While successful logon attempts alert you to accounts that may already be compromised,
    failed logon attempts can alert you to an attacker trying to break in. In both
    cases, investigate those alerts to determine whether it’s legitimate activity.
    If, for example, you see an account increasing their privileges to root on a Linux
    system, determine whether it was you or another trusted user in your network.
    If it wasn’t you or another administrator in your network, change your passwords
    and investigate any related activity that occurred around the same time.
  id: totrans-326
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然成功的登录尝试会提醒您某些账户可能已被入侵，但失败的登录尝试则可能提醒您有攻击者试图入侵。无论是哪种情况，都需要调查这些警报，以确定其是否为合法活动。例如，如果您看到某个账户在
    Linux 系统上提升到 root 权限，请确认是您还是网络中的其他受信用户。如果不是您或网络中的其他管理员，则应更改密码，并调查同一时间段内发生的任何相关活动。
- en: '[Summary](nsp-enoka501485-0007.xhtml#rah1204)'
  id: totrans-327
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: '[总结](nsp-enoka501485-0007.xhtml#rah1204)'
- en: Security Onion’s alerts provide a starting point for you to identify and chase
    down suspicious activity; use them to your advantage when securing your network.
    Use every tool you have at your disposal, as you can be sure that adversaries
    are doing the same. Simply increasing the visibility of activity on your network
    enables you to better protect it. With the instructions and tools described in
    this chapter, you’ll soon find a multitude of potential activity to investigate
    and remediate. Expect this investigation activity to be ongoing and try to keep
    up with the alerts in Security Onion as your network continues to grow and evolve
    over time.
  id: totrans-328
  prefs: []
  type: TYPE_NORMAL
  zh: Security Onion 的警报为您提供了识别和追踪可疑活动的起点；在保护您的网络时，利用这些警报。使用您手头的所有工具，因为您可以确定对手也在使用相同的工具。仅仅通过增加网络活动的可见性，就可以更好地保护您的网络。借助本章中描述的说明和工具，您很快就会发现大量潜在的活动需要调查和修复。预计这项调查活动将是持续进行的，并尽量跟上
    Security Onion 中的警报，随着您的网络不断发展和演变。
