<?xml version='1.0' encoding='utf-8'?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" epub:prefix="z3998: http://www.daisy.org/z3998/2012/vocab/structure/#" lang="en" xml:lang="en">
  <head>
    <title>Project 18: Digital Drum Set</title>
    <link href="../styles/9781593278717.css" rel="stylesheet" type="text/css"/>
    <link href="../68851547a55f.css" rel="stylesheet" type="text/css"/>
  </head>
  <body>
    <div id="sbo-rt-content"><h2 class="h2" id="ch18"><span epub:type="pagebreak" id="page_224"/><strong>18<br/>Digital Drum Set</strong></h2>
<p class="noindent"><span class="orange">In this project you’ll create a button-controlled digital drum set with just a breadboard circuit and a few buttons. Pressing different buttons will produce different drum sounds, including two drumbeat loops.</span></p>
<div class="image"><span epub:type="pagebreak" id="page_225"/><img src="../images/f0225-01.jpg" alt="image"/></div>
<p class="cap"><span class="orange"><strong>PARTS REQUIRED</strong></span></p>
<p class="cap1">Raspberry Pi</p>
<p class="cap1">Breadboard</p>
<p class="cap1">Eight pushbuttons</p>
<p class="cap1">Headphones, or monitor with speakers connected to the Pi via HDMI</p>
<p class="cap1">Jumper wires</p>
<p class="cap"><span class="orange"><strong>SOFTWARE REQUIRED</strong></span></p>
<p class="cap1">avconv</p>
<p class="noindentt"><span epub:type="pagebreak" id="page_226"/>This project uses samples from the Sonic Pi sample library, but you’re free to adapt it to use any sounds you want.</p>
<h3 class="h3" id="lev183"><span class="orange"><strong>PREPARING THE AUDIO</strong></span></h3>
<p class="noindent">First you’ll need to configure the Raspberry Pi audio properly and get set up to use audio samples from Sonic Pi.</p>
<h4 class="h4" id="lev184"><span class="orange"><strong>Configuring the Audio</strong></span></h4>
<p class="noindent">First, plug your headphones or speakers into the Raspberry Pi audio jack. If your monitor has built-in speakers and is connected to the Pi with an HDMI cable, you don’t need to connect anything to the audio jack—you can listen to the sound through the monitor speakers.</p>
<p class="indent">On the top-right corner of your desktop environment, right-click the audio symbol and select the audio source as shown in <a href="ch18.xhtml#ch18fig1">Figure 18-1</a>. Select Analog if you’re using headphones, or HDMI if you’re using a monitor with speakers.</p>
<div class="image"><a id="ch18fig1"/><img src="../images/f0226-01.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 18-1:</strong> Selecting the audio source</p>
<h4 class="h4" id="lev185"><span class="orange"><strong>Getting the Audio Sample Files</strong></span></h4>
<div class="note">
<p class="notet"><strong>NOTE</strong></p>
<p class="notep"><em>We won’t be covering Sonic Pi in this book, but if you want to explore it on your own, go to <strong>Programming</strong></em> <span class="ent">▸</span> <em><strong>Sonic Pi</strong> in the taskbar main menu to open the software and take a look around.</em></p>
</div>
<p class="noindent">The Sonic Pi software comes installed in the Pi’s operating system and allows you to create your own digital music using code, but in this project you’ll just be using the Sonic Pi’s sample audio files.</p>
<p class="indent">In the terminal, enter the following commands to create a new folder called <em>Games_and_Toys</em> inside the <em>Projects</em> folder, and move into the new folder. You’ll save the samples here.</p>
<div class="box">
<pre>pi@raspberrypi:~ $ <span class="codestrong">cd ~/Desktop/Projects</span><br/>pi@raspberrypi:~/Desktop/Projects $ <span class="codestrong">mkdir Games_and_Toys</span><br/>pi@raspberrypi:~/Desktop/Projects $ <span class="codestrong">cd Games_and_Toys</span></pre>
</div>
<p class="indent">Then enter the following to copy the Sonic Pi’s <em>samples</em> folder to the <em>Games_and_Toys</em> folder (note that there is a space between the final <code>/</code> and the period at the end):</p>
<div class="box">
<pre>pi@raspberrypi:~/Desktop/Projects/Games_and_Toys $ <span class="codestrong">cp -r /opt/</span><br/><span class="codestrong">sonic-pi/etc/samples/ .</span></pre>
</div>
<p class="indent"><span epub:type="pagebreak" id="page_227"/>Next, enter these commands to list the contents of the <em>samples</em> folder to check that they transferred correctly:</p>
<div class="box">
<pre>pi@raspberrypi:~/Desktop/Projects/Games_and_Toys $ <span class="codestrong">cd samples</span><br/>pi@raspberrypi:~/Desktop/Projects/Games_and_Toys/samples $ <span class="codestrong">ls</span></pre>
</div>
<p class="indent">If all went as planned, you should see a list of files like so:</p>
<div class="box">
<pre>ambi_choir.flac        drum_cowbell.flac        elec_ping.flac<br/>ambi_dark_woosh.flac   drum_cymbal_closed.flac  elec_plip.flac<br/>...</pre>
</div>
<p class="indent">You may notice these files have the unusual extension <em>.flac</em>. This format is used in Sonic Pi, but to use them with Python you need to convert them to <em>.wav</em> files. For that, you’ll use the avconv software. Enter the following command to install avconv:</p>
<div class="box">
<pre>pi@raspberrypi:~/Desktop/Projects/Games_and_Toys/samples $ <span class="codestrong">sudo apt</span><br/><span class="codestrong">install libav-tools</span></pre>
</div>
<p class="indent">Then enter the following command, which will go through all the files in the <em>samples</em> folder and convert each <em>.flac</em> file into a <em>.wav</em> file:</p>
<div class="box">
<pre>pi@raspberrypi:~/Desktop/Projects/Games_and_Toys/samples $ <span class="codestrong">for f in</span><br/><span class="codestrong">*.flac; do avconv -i "$f" "${f%.flac}.wav"; done</span></pre>
</div>
<p class="indent">Next, use the <code>ls</code> command to list the items in your <em>samples</em> folder and check that you now have <em>.wav</em> files to work with:</p>
<div class="box">
<pre>pi@raspberrypi:~/Desktop/Projects/Games_and_Toys/samples $ <span class="codestrong">ls</span></pre>
</div>
<p class="indent">You should have both a <em>.wav</em> and a <em>.flac</em> file for each sample. To remove the <em>.flac</em> files from your <em>samples</em> folder, enter the following command:</p>
<div class="box">
<pre>pi@raspberrypi:~/Desktop/Projects/Games_and_Toys/samples $ <span class="codestrong">rm *.flac</span></pre>
</div>
<p class="indent">You can double-check that you have the correct files with the <code>ls</code> command again if you like.</p>
<p class="indent">You can play the sounds with the <em>omxplayer</em> software that’s installed on your operating system by default. To listen to the sample called <em>drum_snare_soft.wav</em>, enter the following at your command line:</p>
<div class="box">
<pre>pi@raspberrypi:~/Desktop/Projects/Games_and_Toys/samples $ <span class="codestrong">omxplayer</span><br/><span class="codestrong">drum_snare_soft.wav</span></pre>
</div>
<p class="indent"><span epub:type="pagebreak" id="page_228"/>If you explore the samples files, you’ll see a wide variety of sounds, from guitar sounds to cow bell and drums. Choose eight different drum sounds to include in your drum set (or any other sounds that strike your fancy).</p>
<p class="indent">The sounds we’ve chosen are as follows; the last two are drum beats, while the others refer to single drum sounds:</p>
<ul>
<li class="noindent"><em>drum_cymbal_open.wav</em></li>
<li class="noindent"><em>drum_heavy_kick.wav</em></li>
<li class="noindent"><em>drum_snare_hard.wav</em></li>
<li class="noindent"><em>drum_cymbal_closed.wav</em></li>
<li class="noindent"><em>drum_roll.wav</em></li>
<li class="noindent"><em>perc_snap.wav</em></li>
<li class="noindent"><em>loop_amen_full.wav</em></li>
<li class="noindent"><em>loop_mika.wav</em></li>
</ul>
<h3 class="h3" id="lev186"><span class="orange"><strong>WIRING THE CIRCUIT</strong></span></h3>
<p class="noindent">The circuitry for this project simply involves wiring eight pushbuttons to the Pi. Each pushbutton is associated with a different sound.</p>
<p class="indent">To wire the circuit, follow these instructions, using <a href="ch18.xhtml#ch18fig2">Figure 18-2</a> as a reference.</p>
<div class="image"><a id="ch18fig2"/><img src="../images/f0228-01.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 18-2:</strong> The digital drum set circuit</p>
<ol>
<li class="noindent"><p class="list"><span epub:type="pagebreak" id="page_229"/>Connect the GND pin to the breadboard GND rail.</p></li>
<li class="noindent"><p class="list">Insert eight pushbuttons into the breadboard at equal distances over the center divide.</p></li>
<li class="noindent"><p class="list">Connect the bottom-left pushbutton leads to GND and the bottom-right leads to one of the following GPIO pins in turn: GPIO 2, 3, 14, 15, 17, 18, 22, and 27.</p>
<table class="topbot-d">
<thead>
<tr>
<td style="vertical-align: top;" class="border_th-r"><p class="tab_th"><strong>PUSHBUTTON</strong></p></td>
<td style="vertical-align: top;" class="border_tha"><p class="tab_th"><strong>RASPBERRY PI</strong></p></td>
</tr>
</thead>
<tbody>
<tr>
<td style="vertical-align: top;" class="table-r"><p class="tabc"><span class="orange">1</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="orange">GPIO 2</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-r"><p class="tabc"><span class="orange">2</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="orange">GPIO 3</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-r"><p class="tabc"><span class="orange">3</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="orange">GPIO 14</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-r"><p class="tabc"><span class="orange">4</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="orange">GPIO 15</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-r"><p class="tabc"><span class="orange">5</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="orange">GPIO 17</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-r"><p class="tabc"><span class="orange">6</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="orange">GPIO 18</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-r"><p class="tabc"><span class="orange">7</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="orange">GPIO 22</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-r"><p class="tabc"><span class="orange">8</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="orange">GPIO 27</span></p></td>
</tr>
</tbody>
</table></li>
</ol>
<h3 class="h3" id="lev187"><span class="orange"><strong>WRITING THE SCRIPT</strong></span></h3>
<p class="noindent">Open <strong>Python 3 (IDLE)</strong> and go to <strong>File</strong> <span class="ent">▸</span> <strong>New File</strong> to create a new script. Copy the following code into the Python Editor and save the script as <em>digital_drum_set.py</em> inside the <em>Games_and_Toys</em> folder (remember that you can download all the scripts at <em><a href="https://www.nostarch.com/RaspberryPiProject/">https://www.nostarch.com/RaspberryPiProject/</a></em>):</p>
<div class="box">
<pre>  <span class="red1">#import the necessary libraries</span><br/><span class="ent">➊</span> <span class="orange">import</span> pygame.mixer<br/>  <span class="orange">from</span> pygame.mixer <span class="orange">import</span> Sound<br/>  <span class="orange">from</span> gpiozero <span class="orange">import</span> Button<br/>  <span class="orange">from</span> signal <span class="orange">import</span> pause<br/><br/>  <span class="red1">#create an object for the mixer module that loads and plays sounds</span><br/><span class="ent">➋</span> pygame.mixer.init()<br/><br/>  <span class="red1">#assign each button to a drum sound</span><br/><span class="ent">➌</span> button_sounds = {<br/>      Button(2): Sound(<span class="green">"samples/</span><span class="green">drum_cymbal_open.wav</span><span class="green">"</span>),<br/>      Button(3): Sound(<span class="green">"samples/</span><span class="green">drum_heavy_kick.wav</span><span class="green">"</span>),<br/>      Button(14): Sound(<span class="green">"samples/</span><span class="green">drum_snare_hard.wav</span><span class="green">"</span>),<br/>      Button(15): Sound(<span class="green">"samples/</span><span class="green">drum_cymbal_closed.wav</span><span class="green">"</span>),<br/>      Button(17): Sound(<span class="green">"samples/</span><span class="green">drum_roll.wav</span><span class="green">"</span>),<br/>      Button(18): Sound(<span class="green">"samples/</span><span class="green">perc_snap.wav</span><span class="green">"</span>),<br/><span epub:type="pagebreak" id="page_230"/>      Button(22): Sound(<span class="green">"samples/</span><span class="green">loop_amen_full.wav</span><span class="green">"</span>),<br/>      Button(27): Sound(<span class="green">"samples/</span><span class="green">loop_mika.wav</span><span class="green">"</span>),<br/>  }<br/>  <span class="red1">#the sound plays when the button is pressed</span><br/><span class="ent">➍</span> <span class="orange">for</span> button, sound <span class="orange">in</span> button_sounds.items():<br/>      button.when_pressed = sound.play<br/>  <span class="red1">#keep the program running to detect events</span><br/><span class="ent">➎</span> pause()</pre>
</div>
<p class="indent">As usual, you start your script by importing the necessary libraries <span class="ent">➊</span>. The new library here is the <code>pygame.mixer</code>, used for loading and playing sounds. From <code>pygame.mixer</code> you also import the <code>Sound</code> module, used to create sound objects.</p>
<p class="indent">Then you initialize the Pygame mixer <span class="ent">➋</span> and create a dictionary that holds sounds <span class="ent">➌</span>. In Python, a <em>dictionary</em> is a data structure used to store relationships between items. In this case, you’re associating a button with a specific sound. The basic structure of a dictionary is as follows:</p>
<div class="box">
<pre>dictionary_name = {key_1: value_1, key_2: value_2}</pre>
</div>
<p class="indent">The dictionary is enclosed by curly brackets, <code>{}</code>, and is composed of key/value pairs. You use a colon (<code>:</code>) to assign each key to its corresponding value, and you use commas (<code>,</code>) to separate each key/value pair.</p>
<p class="indent">In this project, the keys are the buttons, and the values are the sounds. To create a sound object, you pass the sound file path as a string to the <code>Sound()</code> function. In this case, since the <em>samples</em> folder is inside the <em>Games_and_Toys</em> folder, you don’t need to provide an entire path, just the folder name followed by the sound filename. You’ll need to change the sound filenames in this script, highlighted in bold, to your chosen sound files.</p>
<p class="indent">Next, assign each button to a sound effect <span class="ent">➍</span>; this means that, when a pushbutton is pressed, the corresponding sound will play. Finally, the <code>pause()</code> function <span class="ent">➎</span> at the end of the script keeps the program running, so events can be detected.</p>
<p class="indent">To run the script, press <strong>F5</strong> or go to <strong>Run</strong> <span class="ent">▸</span> <strong>Run Module</strong>.</p>
<p class="indent">Congratulations—you’ve just built your own digital drum set! Now, press the pushbuttons and compose your own music clips.</p>
<h3 class="h3" id="lev188"><span epub:type="pagebreak" id="page_231"/><span class="orange"><strong>TAKING IT FURTHER</strong></span></h3>
<p class="noindent">This was a cool project and so simple to build. We encourage you to extend this project by trying the following:</p>
<ul>
<li class="noindent">Adding other sounds to your digital drum set</li>
<li class="noindent">Recording your own sounds or searching the web for free sounds</li>
<li class="noindent">Building a digital piano, a digital guitar, or a hybrid music box with mixed sounds</li>
</ul>
</div>
  </body>
</html>
