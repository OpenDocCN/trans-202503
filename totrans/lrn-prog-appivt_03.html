<html><head></head><body>
<h2 class="h2" id="ch03"><span epub:type="pagebreak" id="page_37"/><strong><span class="big">3</span><br/>FRUIT LOOT: CREATING A SIMPLE ANIMATED GAME</strong></h2>
<div class="imagel"><img alt="Image" src="../images/common.jpg"/></div>
<p class="noindent">In this chapter, you’ll create a simple game called “Fruit Loot” that uses components from the Drawing and Animation, Sensors, and Media drawers to let players catch falling fruit.</p>
<p class="indent">You’ll program these components with App Inventor’s built-in Math and Variables blocks and component-specific blocks so that the game will use <em>animation</em>, or movement, with corresponding sound effects; unpredictability to make the game challenging; and the ability to keep score so players can see how well they’re doing.</p>
<p class="indent">First, let’s explore the key components and underlying programming concepts that you’ll use to create the game.</p>
<h3 class="h3" id="ch00lev1sec18"><span epub:type="pagebreak" id="page_38"/><strong>ANIMATING AND MOVING RANDOMLY</strong></h3>
<p class="noindent">To play the game, a player moves a fruit picker character back and forth across the screen trying to catch pieces of falling fruit. The pieces of fruit fall continuously at random speeds from random points at the top of the screen. Because of this random animation, players won’t know exactly where to move the picker to catch the fruit. This unpredictability should challenge players and keep them engaged.</p>
<h4 class="h4" id="ch00lev2sec16"><strong>PROGRAMMING MOVING IMAGES</strong></h4>
<p class="noindent">We’ll use the <code>Canvas</code> and <code>ImageSprite</code> components from the Drawing and Animation drawer to create the moveable game character and constantly dropping fruit. The <code>Canvas</code> component is a layer or sheet that we place on the app’s screen so users can draw. The <code>Canvas</code> is also where <em>sprites</em>, which are flat images, can move around. The game character and different pieces of fruit are all <code>ImageSprite</code>s, which we’ll place on a <code>Canvas</code> to make them move, collide with other sprites, and bounce off the edge of the screen.</p>
<p class="indent">The height and width of the <code>Canvas</code> are measured in <em>pixels</em>, a unit of measurement used in computer graphics, and App Inventor uses a common computer screen coordinate system to determine the exact location of an <code>ImageSprite</code> on the <code>Canvas</code>. In that coordinate system, the top-left point of the <code>ImageSprite</code> is located at the point represented by its x- and y-coordinates or properties (<code>X</code>,<code>Y</code>). The <code>X</code> property is the image’s distance in pixels from the <code>Canvas</code>’s left edge, and the <code>Y</code> property is the picture’s distance from the <code>Canvas</code>’s top edge.</p>
<div class="note">
<p class="notet"><span class="noteh1"><strong>NOTE</strong></span></p>
<p class="notep"><em>In math class, you may have plotted points on a coordinate plane that contains four quadrants. App Inventor’s coordinate system is like the lower-right quadrant in that coordinate plane, where the point of origin (0, 0) is at the top left, and the size of the x-coordinate increases from left to right, while the size of the y-coordinate increases from top to bottom. The difference is that, in the math plane, the increasing y-coordinate numbers are negative, while they’re positive in App Inventor.</em></p>
</div>
<p class="indent">As shown in <a href="ch03.xhtml#ch3fig1">Figure 3-1</a>, in App Inventor’s coordinate system, an <code>ImageSprite</code>’s <code>X</code> property value increases as the graphic moves to the right, and its <code>Y</code> property value increases as it moves down.</p>
<p class="indent">When adding an <code>ImageSprite</code> to the <code>Canvas</code>, we set its initial <code>X</code> and <code>Y</code> property values to the point where we place it or to other values we enter into the Designer window’s Property pane. To move the <code>ImageSprite</code>, we use program blocks to change either property value.</p>
<p class="indent">For this game, you’ll program button click event handlers to let players move the fruit picker. Also, to constantly animate the fruit, you’ll program the <code>Clock</code> so the fruit moves automatically at a time interval you’ll set. JavaScript and other programming languages handle animation the same way, by having images change location in response to user or automated actions.</p>
<div class="image" id="ch3fig1"><span epub:type="pagebreak" id="page_39"/><img alt="Image" src="../images/03fig01.jpg"/></div>
<p class="figcap"><em>Figure 3-1: The Viewer screen with a 300×300 pixel <code>Canvas</code> showing the point of origin and <span class="codeitalic">X</span> and <span class="codeitalic">Y</span> property values of different points</em></p>
<h4 class="h4" id="ch00lev2sec17"><strong>SETTING UP RANDOM APPEARANCE, SPEED, AND LOCATION</strong></h4>
<p class="noindent">Like other games that deal with chance, this game relies on randomness to keep players from plotting exactly how, when, or where to make their next moves. Because of the need for randomness in games and other applications, such as simulations, most traditional programming languages include <em>pseudorandom number generators</em>, which are functions based on mathematical algorithms.</p>
<p class="indent">In its built-in Math blocks, App Inventor provides two pseudorandom number generators. The blocks also include <em>arithmetic operators</em> that perform multiplication, division, addition, and subtraction functions on <em>operands</em> or values, just like similar operators in other programming languages. In your game, you’ll combine one of App Inventor’s pseudorandom number generators, called the <em>random integer block</em>, with arithmetic operator blocks to develop simple formulas to ensure that the appearance, speed, and location of each piece of falling fruit will be determined randomly.</p>
<p class="indent">Thanks to these formulas, although our players will quickly realize that fruit drops constantly, they won’t know where and at what speed it will fall, keeping them from scoring points too easily.</p>
<h3 class="h3" id="ch00lev1sec19"><span epub:type="pagebreak" id="page_40"/><strong>DECLARING AND INITIALIZING VARIABLES</strong></h3>
<p class="noindent">As players earn points, we’ll need a way to let them know their score. We’ll do this by declaring and initializing a couple of <em>variables</em>—uniquely named containers of memory that programmers create to hold values that can change, or vary. Variables allow us to store necessary information that we can update from time to time as conditions in the app change. We can use the unique variable name to refer to that changing information throughout our code and perform operations on the information as the app runs, no matter what value the variable holds at any given time.</p>
<p class="indent">For instance, in your game, you’ll store the score in a variable and compute and display the changing score during the game. To compute the score, you’ll use a Math addition operator block to <em>increment</em> the score, or increase it by a fixed number—in this case, 1—whenever a player earns a point.</p>
<p class="indent">In traditional programming languages, you must follow specific syntactical rules to <em>declare</em>, or create, a variable and to <em>initialize</em> it, or assign its first value. In some languages, you also have to identify the type of data the variable will hold when you create it. In App Inventor, you must declare and initialize variables using the built-in Variables blocks, and you can store <em>strings</em> (sets of characters that can include letters, numbers, and other characters), individual numbers, Boolean values, and lists by snapping in blocks from the Text, Math, Logic, and Lists drawers.</p>
<p class="indent">As you work with variables, you’ll notice that they’re a lot like component properties in that both variables and properties hold data that can be set, reset, and accessed by the blocks used in an app. In fact, as soon as you create a variable, App Inventor creates getter and setter blocks for it, similar to those available for properties, and adds them to the Variables blocks drawer.</p>
<p class="indent">In your game, you’ll create variables that have a <em>global scope</em>, which means you can use them in all of your event handlers. In later chapters, you’ll experiment with <em>local</em> variables, which you’ll create within an event handler or procedure for use only within that handler or procedure. All programming languages use global and local variables.</p>
<h3 class="h3" id="ch00lev1sec20"><strong>BUILDING THE “FRUIT LOOT” APP</strong></h3>
<p class="noindent">Now that you understand how to create variables and program animation and randomness in App Inventor, you’re ready to create “Fruit Loot.”</p>
<p class="indent">To get started, log into App Inventor following the instructions outlined in “Getting Started with App Inventor” on <a href="intro.xhtml#page_xviii">page xviii</a>. In the dialog for the project name, enter <span class="codestrong">FruitLoot</span> without any spaces, and then click <strong>OK</strong>.</p>
<h3 class="h3" id="ch00lev1sec21"><span epub:type="pagebreak" id="page_41"/><strong>DECOMPOSING “FRUIT LOOT”</strong></h3>
<p class="noindent">In “Fruit Loot,” the player moves a fruit picker across the screen to catch rapidly and randomly dropping fruit. The player earns a point for each fruit caught and sees the score on the screen. We can decompose the game activity into five steps:</p>
<ol>
<li><p class="noindent">When a player presses the start button, start the game.</p></li>
<li><p class="noindent">When the <code>Clock</code> timer fires, drop fruit from the top of the Canvas at different speeds.</p></li>
<li><p class="noindent">When a fruit hits the bottom of the Canvas, return it to a random point at the top of the Canvas and display another fruit at random. Increase the total fruits dropped by one.</p></li>
<li><p class="noindent">When a player clicks the left and right buttons, move the picker left and right to catch the falling fruit.</p></li>
<li><p class="noindent">When the picker catches a fruit, play a sound, increase the player’s score by one, display the score, and hide the fruit.</p></li>
</ol>
<p class="indent">Here are the components you’ll need:</p>
<ul>
<li><p class="noindent"><span class="codestrong">Button</span> (3) for the player to click to manually start the action and play the game</p></li>
<li><p class="noindent"><span class="codestrong">Canvas</span> to enable use of <code>ImageSprites</code> and game animation</p></li>
<li><p class="noindent"><span class="codestrong">Clock</span> to fire after the player clicks the start button and move <code>ImageSprites</code> at a set interval</p></li>
<li><p class="noindent"><span class="codestrong">HorizontalArrangement</span> (2) to hold start button, score label, and play buttons</p></li>
<li><p class="noindent"><span class="codestrong">ImageSprite</span> (4) to display moving images</p></li>
<li><p class="noindent"><span class="codestrong">Label</span> to display <code>Variable</code> values</p></li>
<li><p class="noindent"><span class="codestrong">Sound</span> to play the game sound effect</p></li>
<li><p class="noindent">Variable (2) to store game data</p></li>
</ul>
<h3 class="h3" id="ch00lev1sec22"><strong>LAYING OUT “FRUIT LOOT” IN THE DESIGNER</strong></h3>
<p class="noindent">Now let’s lay out the app in the Designer. First, change the Screen’s horizontal alignment so that everything we place on it will be centered. Click <span class="codestrong">Screen1</span> in the Components pane, click the drop-down arrow under <span class="codestrong">AlignHorizontal</span> in the Properties pane, and select <strong>Center: 3</strong>.</p>
<p class="indent">Next, let’s add a background image to the Screen by clicking the text box under <span class="codestrong">BackgroundImage</span> in the Properties pane. Follow the image upload instructions outlined in “Uploading a Picture” on <a href="ch02.xhtml#page_27">page 27</a> to upload <em>fence-tree.png</em>, which comes with the resources for this book. You can download the resources from <em><a href="https://nostarch.com/programwithappinventor/">https://nostarch.com/programwithappinventor/</a></em>.</p>
<p class="indent"><span epub:type="pagebreak" id="page_42"/>Now let’s change the screen <em>orientation</em>, which generally means whether the screen displays vertically (in <em>portrait</em> mode) or horizontally (in <em>landscape</em> mode). By default, <code>ScreenOrientation</code> is set to <code>Unspecified</code>, which means that the orientation changes depending on how a user rotates the device.</p>
<p class="indent">To give our picker <code>ImageSprite</code> a wider screen area to move across to catch fruit, let’s change the orientation to landscape mode to make sure the screen displays horizontally regardless of how the device is held. Click the drop-down arrow under <span class="codestrong">ScreenOrientation</span> and select <strong>Landscape</strong>. Also, unclick the checkbox under both <span class="codestrong">ShowStatusBar</span> and <span class="codestrong">TitleVisible</span> to keep the device status bar and Screen title from showing and taking up space when the game displays on a device.</p>
<h4 class="h4" id="ch00lev2sec18"><strong>ADDING AND ARRANGING USER INTERFACE COMPONENTS</strong></h4>
<p class="noindent">Since we have limited vertical screen space in landscape orientation mode, we need to take up as little of that space as possible with our user interface components. But we still need to make sure those components are easy for players to see and use. To accomplish this, let’s place our <code>Button</code>s and <code>Label</code> in two <code>HorizontalArrangement</code>s, one across the top of the screen and one across the bottom.</p>
<p class="indent">Drag two <span class="codestrong">HorizontalArrangement</span>s from the Layout drawer onto the Viewer. Then, click each in the Components pane, and rename the first one <span class="codestrong">TopArrangement</span> and the second <span class="codestrong">BottomArrangement</span>. Then, in the Properties pane, center both of their horizontal alignments by clicking the drop-down arrow under <span class="codestrong">AlignHorizontal</span> and selecting <strong>Center: 3</strong>, which should center all the components we place inside. Next, make <span class="codestrong">BottomArrangement</span>’s width <strong>Fill parent</strong>, the same way you did with components in <a href="ch01.xhtml#ch01">Chapters 1</a> and <a href="ch02.xhtml#ch02">2</a>, so that it stretches all the way across the screen.</p>
<p class="indent">Now drag a <span class="codestrong">Button</span> and a <span class="codestrong">Label</span> from the User Interface drawer into <span class="codestrong">TopArrangement</span>. Then, in the Components pane, click <span class="codestrong">Button1</span> and rename it <span class="codestrong">StartBtn</span>, and in the Properties pane, change its text size to 18 point by clicking the text box under <span class="codestrong">FontSize</span>, deleting the current number, and entering <span class="codestrong">18</span>. Also change the default text showing on <code>StartBtn</code> by clicking the text box under <strong>Text</strong>, deleting the current text, and entering <span class="codestrong">Start the Fruit Loot Game</span>. Then, in the Components pane, click <span class="codestrong">Label1</span>, and in the Properties pane, remove the <code>Label</code>’s default text by clicking the text box under <strong>Text</strong> and deleting the current text so no text will show until the game starts. Then, center the text by clicking the drop-down arrow under <span class="codestrong">TextAlignment</span> and selecting <strong>Center: 1</strong>.</p>
<p class="indent">Next, drag the remaining two <span class="codestrong">Button</span>s from the User Interface drawer into <span class="codestrong">BottomArrangement</span>, click each in the Components pane, and rename the one on the left <span class="codestrong">LeftBtn</span> and the other <span class="codestrong">RightBtn</span>. Also make the width for each <code>Button</code> <strong>Fill parent</strong>, which makes each take up half the width of <code>BottomArrangement</code>. Now change the text showing on <code>LeftBtn</code> to <span class="codestrong">&lt;&lt;&lt;&lt; Left</span> and <code>RightBtn</code> to <span class="codestrong">Right &gt;&gt;&gt;&gt;</span>.</p>
<p class="indent">Finally, make the background color orange for all three <code>Button</code>s and the <code>Label</code> by clicking the box under <span class="codestrong">BackgroundColor</span> and selecting <span class="codestrong">Orange</span> from the <span epub:type="pagebreak" id="page_43"/>color list dialog. Also make the text displaying on the <code>Button</code>s and <code>Label</code> bold by clicking the checkbox under <span class="codestrong">FontBold</span>. Next, update the font size on all but <code>StartBtn</code> by clicking the text box under <span class="codestrong">FontSize</span> and entering <span class="codestrong">10</span> to replace the existing number. Finally, for <span class="codestrong">BottomArrangement</span>, unclick the checkbox under <strong>Visible</strong> so <code>LeftBtn</code> and <code>RightBtn</code> won’t show when the app opens.</p>
<h4 class="h4" id="ch00lev2sec19"><strong>SETTING UP THE CANVAS AND IMAGESPRITES</strong></h4>
<p class="noindent">Now, click the <strong>Drawing and Animation</strong> drawer and drag a <span class="codestrong">Canvas</span> onto the Viewer between <code>TopArrangement</code> and <code>BottomArrangement</code>. Remember that you must place a <code>Canvas</code> on the Screen before you can add any other Drawing and Animation component. In the Properties pane, make the <code>Canvas</code> transparent so it doesn’t hide the background image by clicking the box under <span class="codestrong">BackgroundColor</span> and then clicking <strong>None</strong> when the color list dialog opens. Then make its height and width <strong>Fill parent</strong>.</p>
<p class="indent">Now drag four <span class="codestrong">ImageSprite</span>s from the Drawing and Animation drawer onto the <code>Canvas</code>, click the <span class="codestrong">ImageSprite</span>s in the Components pane, and rename the first three <span class="codestrong">FruitSprite1</span>, <span class="codestrong">FruitSprite2</span>, and <span class="codestrong">FruitSprite3</span> and the last <span class="codestrong">PickerSprite</span>. Next, under <strong>Picture</strong> in the Properties pane, for the fruit <code>ImageSprite</code>s, upload <em>1.png</em>, <em>2.png</em>, and <em>3.png</em>, and for the picker <code>ImageSprite</code>, upload <em>picker.png</em>. (All of these images come with the resources for this book.)</p>
<p class="indent">Finally, you can either drag the <code>ImageSprite</code>s around the <code>Canvas</code> or enter numbers in the text boxes under their <code>X</code> and <code>Y</code> properties to position them on the <code>Canvas</code> the way they should appear when the game starts. We want the fruit <code>ImageSprite</code>s spread out evenly across the top of the <code>Canvas</code> and <code>PickerSprite</code> in the center at the bottom. To place the components this way on a screen that’s approximately 450 pixels wide, enter the numbers in <a href="ch03.xhtml#ch03tab1">Table 3-1</a> into the Property pane text boxes under <span class="codestrong">X</span> and <span class="codestrong">Y</span> for each <code>ImageSprite</code>.</p>
<p class="tabcap" id="ch03tab1"><strong>Table 3-1:</strong> Initial <code>X</code> and <code>Y</code> Property Values for “Fruit Loot” <code>ImageSprite</code>s on a 450-pixel-wide screen</p>
<table class="all">
<colgroup>
<col style="width:35%"/>
<col style="width:35%"/>
<col style="width:30%"/>
</colgroup>
<thead>
<tr>
<td class="table-h" style="vertical-align: top;"><p class="tab_th"><strong>ImageSprite</strong></p></td>
<td class="table-h" style="vertical-align: top;"><p class="tab_th"><strong><span class="codestrong">X</span> property</strong></p></td>
<td class="table-h" style="vertical-align: top;"><p class="tab_th"><strong><span class="codestrong">Y</span> property</strong></p></td>
</tr>
</thead>
<tbody>
<tr>
<td style="vertical-align: top;"><p class="taba"><code>FruitSprite1</code></p></td>
<td style="vertical-align: top;"><p class="taba">10</p></td>
<td style="vertical-align: top;"><p class="taba">0</p></td>
</tr>
<tr>
<td style="vertical-align: top;"><p class="taba"><code>FruitSprite2</code></p></td>
<td style="vertical-align: top;"><p class="taba">230</p></td>
<td style="vertical-align: top;"><p class="taba">0</p></td>
</tr>
<tr>
<td style="vertical-align: top;"><p class="taba"><code>FruitSprite3</code></p></td>
<td style="vertical-align: top;"><p class="taba">440</p></td>
<td style="vertical-align: top;"><p class="taba">0</p></td>
</tr>
<tr>
<td class="table-ba" style="vertical-align: top;"><p class="taba"><code>PickerSprite</code></p></td>
<td class="table-ba" style="vertical-align: top;"><p class="taba">180</p></td>
<td class="table-ba" style="vertical-align: top;"><p class="taba">150</p></td>
</tr>
</tbody>
</table>
<p class="indentt">Now you’re ready to add and adjust the non-visible components.</p>
<h4 class="h4" id="ch00lev2sec20"><strong>ADDING AND PREPARING NON-VISIBLE COMPONENTS</strong></h4>
<p class="noindent">From the Media drawer, drag in a <span class="codestrong">Sound</span> component, and from the Sensors drawer, drag in a <span class="codestrong">Clock</span> component. In the Components pane, click the <span class="codestrong">Sound</span> component, and in the Properties pane, set the media clip that it will play by clicking the text box under <strong>Source</strong> and uploading the <em>clunk.mp3</em> file that comes with the book resources.</p>
<p class="indent"><span epub:type="pagebreak" id="page_44"/>Then click the <span class="codestrong">Clock</span>, replace its default <code>TimerInterval</code> property by entering <span class="codestrong">150</span>, and unclick the checkbox under <span class="codestrong">TimerEnabled</span> so the timer won’t start when the app opens. Shortly, we’ll program the blocks to enable the timer once the player clicks <code>StartBtn</code>.</p>
<p class="indent">At this point, your screen should look like <a href="ch03.xhtml#ch3fig2">Figure 3-2</a>.</p>
<div class="image" id="ch3fig2"><img alt="Image" src="../images/03fig02.jpg"/></div>
<p class="figcap"><em>Figure 3-2: The Viewer and Component panes after we lay out “Fruit Loot”</em></p>
<p class="indent">Once your screen looks like it should, click the <span class="codestrong">Canvas</span> in the Components pane, and unclick the checkbox under <strong>Visible</strong>. This way, none of the <code>ImageSprite</code>s should show when the app opens. Next, we’ll program the blocks to make these components, <code>LeftBtn</code> and <code>RightBtn</code>, visible once the player clicks <code>StartBtn</code>.</p>
<h3 class="h3" id="ch00lev1sec23"><strong>PROGRAMMING “FRUIT LOOT” IN THE BLOCKS EDITOR</strong></h3>
<p class="noindent">Now that you’ve laid out all the components, you can move to the Blocks Editor to program the app. For “Fruit Loot” we’ll program 10 event handlers. Three respond to events generated by the user’s button clicks. One directs the app’s action after a timer goes off at the time interval we’ve set. The rest respond to <code>ImageSprite</code>s reaching the edge of the <code>Canvas</code> or colliding with one another.</p>
<p class="indent">You’ll notice that most of the event handlers contain duplicate code. We’re programming them this way because you haven’t yet learned the advanced programming structures that would eliminate the repetition. <span epub:type="pagebreak" id="page_45"/>As you learn about those structures in later chapters, we’ll be able to revisit the “Fruit Loot” code and <em>refactor</em> it, which means to restructure and improve it.</p>
<p class="indent">Click the <strong>Blocks</strong> button to switch to the Blocks Editor, and let’s begin programming the five steps of “Fruit Loot” in order.</p>
<h4 class="h4" id="ch00lev2sec21"><strong>STEP 1: STARTING THE GAME</strong></h4>
<p class="noindent">We start by telling the app what to do when the player clicks <code>StartBtn</code>. That’s when we want the <code>StartBtn</code> to disappear, the <code>Canvas</code> with its <code>ImageSprite</code>s and <code>BottomArrangement</code> with its <code>Button</code>s to appear, and the <code>Clock</code>’s timer to begin to fire.</p>
<p class="indent">Here is the button click event handler with its four setter blocks that do what we want in step 1.</p>
<div class="image"><img alt="Image" src="../images/f0045-01.jpg"/></div>
<p class="indent">In the Blocks pane, click <span class="codestrong">StartBtn</span> and, when the blocks for the component appear, drag the <span class="codestrong">whenStartBtn.Click</span> event handler block <span class="ent">➊</span> to the Viewer. Then, in the Blocks pane, click <span class="codestrong">StartBtn</span> again, and drag its <span class="codestrong">setStartBtn.Visibleto</span> block <span class="ent">➋</span> into the <span class="codestrong">whenStartBtn.Click</span> block next to the word <code>do</code>. Next, in the Blocks pane, click the <strong>Logic</strong> blocks drawer, drag the <span class="codestrong">false</span> block <span class="ent">➌</span> to the Viewer, and snap it to the right side of the <span class="codestrong">setStartBtn.Visibleto</span> block. These blocks set <code>StartBtn</code>’s <code>Visible</code> property to <code>false</code> so that it disappears after the player clicks the start button.</p>
<p class="indent">Next, click <span class="codestrong">Canvas1</span>, drag the <span class="codestrong">setCanvas1.Visibleto</span> block <span class="ent">➍</span> to the Viewer, and snap it inside the <span class="codestrong">whenStartBtn.Click</span> block under the <code>setStartBtn.Visibleto</code> block. Then, in the Blocks pane, click the <strong>Logic</strong> blocks drawer again, drag the <span class="codestrong">true</span> block <span class="ent">➎</span> to the Viewer, and snap it to the right side of the <span class="codestrong">setCanvas1.Visibleto</span> block. These blocks set the <code>Visible</code> property for <code>Canvas1</code> and its contents to <code>true</code> so the <code>ImageSprite</code>s will appear after the player clicks the start button.</p>
<p class="indent">Then, click <span class="codestrong">BottomArrangement</span> in the Blocks pane, drag the <span class="codestrong">setBottomArrangement.Visibleto</span> block <span class="ent">➏</span> to the Viewer, and snap it inside the <span class="codestrong">whenStartBtn.Click</span> block under the <code>setCanvas1.Visibleto</code> block. Then click the <strong>Logic</strong> blocks drawer again, drag another <span class="codestrong">true</span> block <span class="ent">➐</span> to the Viewer, and snap it to the right side of the <span class="codestrong">setBottomArrangement.Visibleto</span> block. These blocks set the <code>Visible</code> property for <code>BottomArrangement</code> to <code>true</code>, making the buttons inside of it appear after the player clicks the start button.</p>
<p class="indent">Finally, click <span class="codestrong">Clock1</span>, drag the <span class="codestrong">setClock1.TimerEnabledto</span> block <span class="ent">➑</span> to the Viewer, and snap it inside the <span class="codestrong">whenStartBtn.Click</span> block under the <code>setBottomArrangement.Visibleto</code> block. Then, in the Blocks pane, drag another <span class="codestrong">true</span> block <span class="ent">➒</span> from the <strong>Logic</strong> blocks drawer, and snap it to the right side of the <span epub:type="pagebreak" id="page_46"/><span class="codestrong">setClock1.TimerEnabledto</span> block. These blocks set the value of <code>Clock1</code>’s <code>TimerEnabled</code> property to <code>true</code>. This starts <code>Clock1</code>’s timer, which will move the fruit <code>ImageSprite</code>s down the <code>Canvas</code> the entire time the game is in play.</p>
<p class="indent">Together, the blocks for step 1 start the game. In sum, when the player clicks the start button, the blocks set <code>StartBtn</code>’s <code>Visible</code> property to <code>false</code>, set the <code>Visible</code> properties of the <code>Canvas</code> with <code>ImageSprite</code>s and the <code>HorizontalArrangement</code> with play buttons to <code>true</code>, and set the <code>Clock</code>’s <code>TimerEnabled</code> property to <code>true</code>.</p>
<p class="indent">To see how these blocks work, live-test with a device, as outlined in “Live-Testing Your Apps” on <a href="intro.xhtml#page_xxii">page xxii</a>. Once you click <strong>Connect</strong> <span class="ent">▸</span> <strong>AI Companion</strong> in the top menu bar and scan the QR code with your device’s Companion app, your “Fruit Loot” game should open on your device. As long as your blocks are placed as shown in the code examples, you should see the start button until you click it, when it disappears as the other game components appear. For now, nothing else should happen. Leave the game open on your device to keep live-testing.</p>
<h4 class="h4" id="ch00lev2sec22"><strong>STEP 2: MAKING FRUIT DROP AT RANDOM</strong></h4>
<p class="noindent">Now let’s program step 2 of the app and tell it what to do each time the <code>Clock</code>’s timer fires. This is when we want the fruit to drop at varying speeds every 150 milliseconds—the <code>TimerInterval</code> we set in the Property pane in the Designer.</p>
<div class="image"><img alt="Image" src="../images/f0046-01.jpg"/></div>
<p class="indent">In the Blocks pane, click <span class="codestrong">Clock1</span> and, when the blocks for the component appear, drag the <span class="codestrong">whenClock1.Timer</span> block <span class="ent">➊</span> to the Viewer. Then, in the Blocks pane, click <span class="codestrong">FruitSprite1</span>, drag the <span class="codestrong">callFruitSprite1.MoveTo</span> method block <span class="ent">➋</span> to the Viewer, and snap it inside the <span class="codestrong">whenClock1.Timer</span> block next to the word <code>do</code>.</p>
<div class="note">
<p class="notet"><span class="noteh1"><strong>NOTE</strong></span></p>
<p class="notep"><em>In both the Components pane in the Designer and the Blocks pane in the Blocks Editor, if you don’t see a component that you’ve nested within a parent component—for example, an <span class="codeitalic">ImageSprite</span> placed on a <span class="codeitalic">Canvas</span> or a <span class="codeitalic">Button</span> dragged within a <span class="codeitalic">HorizontalArrangement</span>—you’ll find it by clicking the plus sign to the left of the parent.</em></p>
</div>
<h5 class="h5" id="ch00lev3sec21"><span epub:type="pagebreak" id="page_47"/><strong>Setting X and Y Values for FruitSprite1</strong></h5>
<p class="noindent">Let’s look closer at the <code>callFruitSprite1.MoveTo</code> method block we’ve placed within the <code>Clock1 Timer</code> event handler.</p>
<div class="image"><img alt="Image" src="../images/f0047-01.jpg"/></div>
<p class="indent">You’ll notice that the block requires us to insert values for its <code>x</code> and <code>y</code> <em>method parameters</em>, which are pieces of information the method must have to operate. This means the <code>ImageSprite</code>’s <code>MoveTo</code> method cannot move <code>FruitSprite1</code> until we supply <em>arguments</em>, or values, for the x- and y-coordinates of the point where we want the <code>ImageSprite</code> to move.</p>
<p class="indent">For our “Fruit Loot” game, we want the fruit <code>ImageSprite</code>s to move down only, meaning we’ll change their y-coordinates but not their x-coordinates. To keep the same <code>X</code> value, click <span class="codestrong">FruitSprite1</span>, drag its <span class="codestrong">FruitSprite1.X</span> getter block <span class="ent">➊</span> to the Viewer, and snap it into the method block’s <span class="codestrong">x</span> socket. This tells the app that, when it moves <code>FruitSprite1</code>, it should get the current <code>X</code> value for <code>FruitSprite1</code> and keep that <code>X</code> value the same.</p>
<p class="indent">To provide the argument for the y-coordinate of the point where we want <code>FruitSprite1</code> to move, click the <strong>Math</strong> blocks drawer, drag out an addition operator block <span class="ent">➋</span>, and snap it into the method block’s <span class="codestrong">y</span> socket. Then, click <span class="codestrong">FruitSprite1</span> and drag its <span class="codestrong">FruitSprite1.Y</span> getter block <span class="ent">➌</span> into the addition block’s left socket, and click the <strong>Math</strong> blocks drawer and drag a <code>random integer</code> block <span class="ent">➍</span> into the addition block’s right socket. This tells the app that, when it moves <code>FruitSprite1</code>, it should increase the current value of its y-coordinate by a random number of pixels to move the <code>ImageSprite</code> down the <code>Canvas</code>.</p>
<h5 class="h5" id="ch00lev3sec22"><strong>Dropping FruitSprite1 at Random Speeds</strong></h5>
<p class="noindent">The <code>random integer</code> block generates the random number of pixels—from between the specified range of 15 to 50—that we want <code>FruitSprite1</code> to fall.</p>
<div class="image"><img alt="Image" src="../images/f0047-02.jpg"/></div>
<p class="indent">To set that range of numbers in the <code>random integer</code> block, click the default <span class="codestrong">1</span> in its left socket and replace it by entering <span class="codestrong">15</span>, and click the default <span class="codestrong">100</span> in its right socket and replace it by entering <span class="codestrong">50</span>.</p>
<p class="indent">Now, altogether, our <code>callFruitSprite1.MoveTo</code> method block with the <code>x</code> and <code>y</code> parameters we’ve set tells the app that, when it moves <code>FruitSprite1</code>, we want the <code>ImageSprite</code>’s <code>X</code> value to stay the same and its <code>Y</code> value to move from its current y-coordinate down a random number of pixels between 15 and 50. This randomness ensures that the <code>ImageSprite</code>’s speed will be unpredictable, because, when the <code>Clock</code>’s timer fires every 150 milliseconds, <code>FruitSprite1</code> will travel at a speed anywhere from a slower 15 pixels per 150 milliseconds (100 pixels per second) to a faster 50 pixels per 150 milliseconds (333 pixels per second).</p>
<h5 class="h5" id="ch00lev3sec23"><span epub:type="pagebreak" id="page_48"/><strong>Copying Blocks for FruitSprite2 and FruitSprite3</strong></h5>
<p class="noindent">To complete the blocks for step 2, we now can copy the <code>callFruitSprite1.MoveTo</code> block and adjust it for <code>FruitSprite2</code> and <code>FruitSprite3</code>. Right-click the <span class="codestrong">callFruitSprite1.MoveTo</span> method block to duplicate it for <span class="codestrong">FruitSprite2</span>, and snap the duplicate in under the original.</p>
<div class="image"><img alt="Image" src="../images/f0048-01.jpg"/></div>
<p class="indent">In the duplicate blocks, use the drop-down arrows <span class="ent">➊</span> in the <span class="codestrong">callFruitSprite1.MoveTo</span>, <span class="codestrong">FruitSprite1.X</span>, and <span class="codestrong">FruitSprite1.Y</span> blocks to change to <span class="codestrong">FruitSprite2</span>. Also change the number in the left <code>random integer</code> block socket to <span class="codestrong">5</span>. These blocks now program <code>FruitSprite2</code> to move down some unknown number of pixels between 5 and 50 when the <code>Clock</code>’s timer fires every 150 milliseconds.</p>
<p class="indent">Next, right-click the <span class="codestrong">callFruitSprite1.MoveTo</span> block, make another copy to use for <code>FruitSprite3</code>, and snap the duplicate in under the <span class="codestrong">callFruitSprite2.MoveTo</span> block.</p>
<div class="image"><img alt="Image" src="../images/f0048-02.jpg"/></div>
<p class="indent">In the duplicate, use the drop-down arrows <span class="ent">➋</span> in the <span class="codestrong">callFruitSprite1.MoveTo</span>, <span class="codestrong">FruitSprite1.X</span>, and <span class="codestrong">FruitSprite1.Y</span> blocks to change to <span class="codestrong">FruitSprite3</span>, and change the number in the <code>random integer</code> block’s left socket to <span class="codestrong">25</span>. These blocks program <code>FruitSprite3</code> to move down a random number of pixels between 25 and 50 every 150 milliseconds.</p>
<p class="indent">Now the blocks for step 2 should move the three fruit <code>ImageSprite</code>s down the <code>Canvas</code> every 150 milliseconds at random speeds.</p>
<p class="indent">Live-test to see how these blocks work. When you click <code>StartBtn</code>, you should see the three fruit <code>ImageSprite</code>s drop to the bottom of the screen, where they stay and all movement stops. If any <code>ImageSprite</code> fails to move, you need to debug. In this instance, you may not have changed your references to the correct <code>ImageSprite</code> when you duplicated the <code>MoveTo</code> blocks. Make any necessary corrections, and test again. Once step 2 is working, move to the next step, where we’ll tell the game what to do when the fruit <code>ImageSprite</code>s reach the bottom of the <code>Canvas</code>.</p>
<h4 class="h4" id="ch00lev2sec23"><strong>STEP 3: CREATING MORE FALLING FRUIT AND COUNTING DROPPED FRUIT</strong></h4>
<p class="noindent">Let’s now program step 3 of the app. In this part, when a fruit <code>ImageSprite</code> reaches the bottom edge of the <code>Canvas</code>, we want the app to move the <span epub:type="pagebreak" id="page_49"/><code>ImageSprite</code> back up to a random point along the very top of the <code>Canvas</code>, have the <code>ImageSprite</code> display a random picture of fruit, and add 1 to the total number of times an <code>ImageSprite</code> hits the edge.</p>
<p class="indent">We’ll use a global variable to store and update that total number, and we’ll start our code for this step by creating and initializing that variable.</p>
<div class="image"><img alt="Image" src="../images/f0049-01.jpg"/></div>
<p class="indent">Click the <strong>Variables</strong> blocks drawer and drag an <span class="codestrong">initialize global name</span> block to the Viewer. Click <span class="codestrong">name</span> and replace it with the name of our variable, <span class="codestrong">fruitsDropped</span>. Then drag a <span class="codestrong">0</span> number block from the <strong>Math</strong> drawer and snap it to the right side of the <span class="codestrong">initialize global fruitsDropped</span> block. This declares and initializes the variable you’ll use to store and update the total number of pieces of fruit dropped in your game. Because the variable is global and can be used by all your event handlers, it stands alone in the code, outside of all your event handler blocks.</p>
<p class="indent">Now let’s program the event handler for this step. Here are the blocks that handle this <code>EdgeReached</code> event for <code>FruitSprite1</code>.</p>
<div class="image"><img alt="Image" src="../images/f0049-02.jpg"/></div>
<p class="indent">In the Blocks pane, click <span class="codestrong">FruitSprite1</span> and, when the blocks for the component appear, drag the <span class="codestrong">whenFruitSprite1.EdgeReached</span> block <span class="ent">➊</span> to the Viewer. Then, in the Blocks pane, click <span class="codestrong">FruitSprite1</span> again, drag the <span class="codestrong">setFruitSprite1.Y</span> block <span class="ent">➋</span> to the Viewer, and snap it inside the <span class="codestrong">whenFruitSprite1.EdgeReached</span> block next to the word <code>do</code>.</p>
<p class="indent">Then, click the <strong>Math</strong> blocks drawer, drag a <span class="codestrong">0</span> number block <span class="ent">➌</span> to the Viewer, and snap it to the right of the <span class="codestrong">setFruitSprite1.Y</span> block. So far, once <code>FruitSprite1</code> reaches the edge of the <code>Canvas</code>, these blocks move <code>FruitSprite1</code> right back up to y-coordinate 0, which is the very top of the <code>Canvas</code>.</p>
<h5 class="h5" id="ch00lev3sec24"><strong>Moving Fallen Fruit Back Up to a Random Place</strong></h5>
<p class="noindent">We now need to make sure the code also moves <code>FruitSprite1</code> to an unpredictable x-coordinate using setter blocks, which keeps your game interesting.</p>
<div class="image"><img alt="Image" src="../images/f0049-03.jpg"/></div>
<p class="indent"><span epub:type="pagebreak" id="page_50"/>In the Blocks pane, click the <span class="codestrong">FruitSprite1</span> component, drag the <span class="codestrong">setFruitSprite1.X</span> block <span class="ent">➊</span> to the Viewer, and snap it inside the <span class="codestrong">whenFruitSprite1.EdgeReached</span> block under the <code>setFruitSprite1.Y</code> block. Then, click the <strong>Math</strong> blocks drawer, snap a <code>random integer</code> block <span class="ent">➋</span> to the right of the <span class="codestrong">setFruitSprite1.X</span> block, and click the default <span class="codestrong">1</span> in the <code>random integer</code> block’s left socket and replace it by entering <span class="codestrong">10</span>. Then, delete the default <span class="codestrong">100</span> in the <code>random integer</code> block’s right socket, and replace it with a multiplication operator block <span class="ent">➌</span>, also from the Math drawer. Next, in the Blocks pane, click the <span class="codestrong">Canvas1</span> component, drag the <span class="codestrong">Canvas1.Width</span> getter block <span class="ent">➍</span> to the Viewer, and snap it into the multiplication block’s left socket; then, drag a <span class="codestrong">0</span> number block <span class="ent">➎</span> from the <strong>Math</strong> drawer to the Viewer, click its default <span class="codestrong">0</span>, replace it by entering <span class="codestrong">0.3</span>, and then snap the <span class="codestrong">0.3</span> number block into the multiplication block’s right socket.</p>
<p class="indent">These blocks set the <code>X</code> value for <code>FruitSprite1</code> once it reaches the edge of the <code>Canvas</code>. To avoid collisions with other fruit <code>ImageSprite</code>s, we want this first fruit <code>ImageSprite</code> to drop somewhere in the left third of the <code>Canvas</code> only. These blocks ensure that by setting the new <code>X</code> position to a random number of pixels between 10 and the width of the <code>Canvas</code> multiplied by 0.3, which is a little less than one-third of the <code>Canvas</code> width. For instance, if the width of the <code>Canvas</code> is 450 pixels, the new <code>X</code> position will be anywhere between 10 and (450 × 0.3) pixels, which equals 135 pixels.</p>
<h5 class="h5" id="ch00lev3sec25"><strong>Dropping Random Fruit Images</strong></h5>
<p class="noindent">Next, to keep your game unpredictable, you need to make sure the code randomly changes the type of fruit dropped after <code>FruitSprite1</code> moves back up to the top of the <code>Canvas</code>. To do this, you’ll use setter blocks that set the <code>Picture</code> property for <code>FruitSprite1</code> to a random image.</p>
<div class="image"><img alt="Image" src="../images/f0050-01.jpg"/></div>
<p class="indent">Click the <span class="codestrong">FruitSprite1</span> component in the Blocks pane, drag the <span class="codestrong">setFruitSprite1.Picture</span> block <span class="ent">➊</span> to the Viewer, and snap it inside the <span class="codestrong">whenFruitSprite1.EdgeReached</span> block under the <code>setFruitSprite1.X</code> block. Then, click the <strong>Text</strong> blocks drawer, drag a <code>join</code> block <span class="ent">➋</span> to the Viewer, and snap it to the right of the <span class="codestrong">setFruitSprite1.Picture</span> block, which will allow you to set the name for the picture by joining two strings.</p>
<p class="indent">For the <code>join</code> block’s top input, drag in another <code>random integer</code> block <span class="ent">➌</span> from the Math blocks drawer, click the default <span class="codestrong">100</span> in its right socket, and replace it by entering <span class="codestrong">3</span>. For the <code>join</code> block’s second input, drag in an empty string block <span class="ent">➍</span>, the first block in the Text blocks drawer. Then click the string block’s text area and enter <span class="codestrong">.png</span>.</p>
<p class="indent">These blocks set the name of the image to use as the picture source for <code>FruitSprite1</code> after it reaches the <code>Canvas</code> edge. Since we’ve named the three uploaded fruit images <em>1.png</em>, <em>2.png</em>, and <em>3.png</em>, we can use the <code>random integer</code> block to generate the number 1, 2, or 3 that is part of the image name. This should make the app continually display a randomly selected image on <code>FruitSprite1</code> each time it drops from the top of the <code>Canvas</code>.</p>
<h5 class="h5" id="ch00lev3sec26"><span epub:type="pagebreak" id="page_51"/><strong>Making Sure Fruit is Visible</strong></h5>
<p class="noindent">We also need to make sure <code>FruitSprite1</code> and the other fruit <code>ImageSprite</code>s are visible once they move back up to the top of the <code>Canvas</code>, because later we’ll make them invisible if they hit the picker <code>ImageSprite</code>. Here is the setter block that turns the <code>Visible</code> property on.</p>
<div class="image"><img alt="Image" src="../images/f0051-01.jpg"/></div>
<p class="indent">Click <span class="codestrong">FruitSprite1</span>, drag the <span class="codestrong">setFruitSprite1.Visibleto</span> block <span class="ent">➊</span> to the Viewer, and snap it inside the <span class="codestrong">whenFruitSprite1.EdgeReached</span> block under the <code>setFruitSprite1.Pictureto</code> block. Then, in the Blocks pane, click the <strong>Logic</strong> blocks drawer, drag the <span class="codestrong">true</span> block <span class="ent">➋</span> to the Viewer, and snap it to the right side of the <span class="codestrong">setFruitSprite1.Visibleto</span> block. These blocks reset the <code>ImageSprite</code>’s <code>Visible</code> property to <code>true</code> in case it collides with the picker <code>ImageSprite</code>, after which our blocks in step 5 will set it to <code>false</code>.</p>
<h5 class="h5" id="ch00lev3sec27"><strong>Counting the Number of Fruits Dropped</strong></h5>
<p class="noindent">Finally, we need to program the app to keep track of how many fruits are dropped. Each time a fruit <code>ImageSprite</code> hits the bottom of the <code>Canvas</code>, the game should add 1 to the value of <code>fruitsDropped</code>, which is the variable that keeps track of the number of times an <code>ImageSprite</code> hits the edge. The following blocks increment the value of <code>fruitsDropped</code>.</p>
<div class="image"><img alt="Image" src="../images/f0051-02.jpg"/></div>
<p class="indent">Mouse over the <span class="codestrong">initialize global fruitsDropped</span> block that we placed at the beginning of this step, drag the <span class="codestrong">set global fruitsDropped</span> block <span class="ent">➊</span> to the Viewer, and snap it inside the <span class="codestrong">whenFruitSprite1.EdgeReached</span> block under the <code>setFruitSprite1.Visibleto</code> block. Then drag an addition operator block <span class="ent">➋</span> from the Math drawer and snap it to the right of the <span class="codestrong">set global fruitsDropped</span> block. Fill that addition block’s sockets by mousing over the <span class="codestrong">initialize global fruitsDropped</span> block, dragging the <span class="codestrong">get global fruitsDropped</span> block <span class="ent">➌</span> into the addition block’s left socket, and dragging a <span class="codestrong">1</span> number block <span class="ent">➍</span> from the Math drawer into the addition block’s right socket. These blocks keep track of the game’s total number of fruits dropped by adding 1 to the current value of the <code>fruitsDropped</code> variable each time <code>FruitSprite1</code> reaches the edge of the <code>Canvas</code>.</p>
<h5 class="h5" id="ch00lev3sec28"><strong>Copying Blocks for FruitSprite2 and FruitSprite3</strong></h5>
<p class="noindent">Our final task for step 3 is to duplicate our code to program similar <code>EdgeReached</code> event handlers for <code>FruitSprite2</code> and <code>FruitSprite3</code>.</p>
<p class="indent">For <code>FruitSprite2</code>, right-click the <span class="codestrong">whenFruitSprite1.EdgeReached</span> block and select <strong>duplicate</strong>. When you make this duplicate, you’ll see a red X appear to the left of the word <code>when</code> in both the original and duplicate event handlers. This red X warns you that you have two event handlers for the same event, <span epub:type="pagebreak" id="page_52"/>which is not allowed. Once you change the duplicate handler’s event, the red X should disappear. To change the event, use the drop-down arrow in every block where you see <code>FruitSprite1</code> and change to <span class="codestrong">FruitSprite2</span>.</p>
<p class="indent">The only other adjustment we need to make is to set an <code>X</code> property for <code>FruitSprite2</code> that avoids collisions with the other fruit <code>ImageSprite</code>s when it moves down the <code>Canvas</code>. To accomplish this, make sure this second fruit <code>ImageSprite</code> consistently drops somewhere in the middle third of the <code>Canvas</code> by changing the <code>FruitSprite2 X</code> value.</p>
<div class="image"><img alt="Image" src="../images/f0052-01.jpg"/></div>
<div class="note">
<p class="notet"><span class="noteh1"><strong>NOTE</strong></span></p>
<p class="notep"><em>App Inventor provides a way for you to display the <span class="codeitalic">random integer</span>, <span class="codeitalic">join</span>, and other blocks that require multiple inputs with either <span class="roman">inline inputs</span>, as shown in the <span class="codeitalic">random integer</span> block inside the <span class="codeitalic">FruitSprite1</span> setter, or <span class="roman">external inputs</span>, as shown in the <span class="codeitalic">random integer</span> block inside the figure’s <span class="codeitalic">FruitSprite2</span> setter, which takes up less horizontal space. You can right-click a block to switch between inline and external inputs.</em></p>
</div>
<p class="indent">Replace the <span class="codestrong">10</span> number block in the <span class="codestrong">random integer</span> block’s top socket with a multiplication operator block <span class="ent">➊</span> from the Math drawer. Then fill the multiplication block’s sockets by clicking the <span class="codestrong">Canvas1</span> component in the Blocks pane, dragging the <span class="codestrong">Canvas1.Width</span> block <span class="ent">➋</span> into its left socket, and dragging a <span class="codestrong">0.35</span> number block <span class="ent">➌</span> from the Math drawer into its right socket. Then, in the <code>random integer</code> block’s bottom socket, change the <span class="codestrong">0.3</span> number block to a <span class="codestrong">0.65</span> number block <span class="ent">➍</span>.</p>
<p class="indent">These blocks set the new <code>X</code> position for <code>FruitSprite2</code> to a random number of pixels between the width of the <code>Canvas</code> multiplied by 0.35 and the width of the <code>Canvas</code> multiplied by 0.65, which is some random point in the middle third of the <code>Canvas</code>. For instance, if the width of the <code>Canvas</code> is 450 pixels, the new <code>X</code> position will be anywhere between 450 × 0.35 pixels, which equals 158 pixels, and 450 × 0.65 pixels, which equals 293 pixels.</p>
<p class="indent">Now, to create the <code>EdgeReached</code> event handler for <code>FruitSprite3</code>, right-click the <span class="codestrong">whenFruitSprite2.EdgeReached</span> block and select <strong>duplicate</strong>. In the duplicate blocks, be sure to use the drop-down arrow in every block where you see <code>FruitSprite2</code> and change to <span class="codestrong">FruitSprite3</span>.</p>
<p class="indent">To avoid collisions with the other fruit <code>ImageSprite</code>s, we’ll also need to change the <code>FruitSprite3 X</code> value so this third fruit <code>ImageSprite</code> consistently drops somewhere in the right third of the <code>Canvas</code>.</p>
<div class="image"><span epub:type="pagebreak" id="page_53"/><img alt="Image" src="../images/f0053-01.jpg"/></div>
<p class="indent">To do this, replace the <span class="codestrong">0.35</span> number block in the right socket of the first multiplication block with a <span class="codestrong">0.7</span> number block <span class="ent">➊</span>. Also, replace the second multiplication block with a subtraction operator block <span class="ent">➋</span> from the Math blocks drawer, and fill the subtraction block by dragging the <span class="codestrong">Canvas1.Width</span> block <span class="ent">➌</span> into its left socket and a <span class="codestrong">20</span> number block <span class="ent">➍</span> into its right socket.</p>
<p class="indent">These blocks set the new <code>X</code> position of <code>FruitSprite3</code> to a random number of pixels between the width of the <code>Canvas</code> multiplied by 0.7 and the width of the <code>Canvas</code> minus 20 pixels, which is some random point in the right third of the <code>Canvas</code>. For instance, if the width of the <code>Canvas</code> is 450 pixels, the new <code>X</code> position will be anywhere between 450 × 0.7 pixels, which equals 315 pixels, and 450 – 20 pixels, which equals 430 pixels.</p>
<p class="indent">Altogether, the blocks for step 3 move each fruit <code>ImageSprite</code> to a random point at the very top of the <code>Canvas</code>, have that <code>ImageSprite</code> display a random picture of fruit, and increase the count of total fruits dropped by 1 each time an <code>ImageSprite</code> hits the bottom of the <code>Canvas</code>, just as we planned.</p>
<p class="indent">Now live-test the game again. This time, when you click <code>StartBtn</code>, you should see the three fruit <code>ImageSprite</code>s drop to the bottom of the screen continuously, randomly changing the image displayed. You’ll also notice that the speed at which each <code>ImageSprite</code> drops and its <code>X</code> location changes with each drop.</p>
<p class="indent">If any of the <code>ImageSprite</code>s fail to move, or if two or more appear to drop in the same third of the <code>Canvas</code>, debug your code. Here again, you may not have made the correct changes to your duplicate blocks. Make any necessary corrections, and test again. Once step 3 is working, let’s move to the next part, where we’ll program <code>PickerSprite</code>’s movement.</p>
<h4 class="h4" id="ch00lev2sec24"><strong>STEP 4: LETTING PLAYERS MOVE THE PICKER TO CATCH THE FRUIT</strong></h4>
<p class="noindent">Now let’s program step 4 of the app, telling it what to do when the player clicks the left and right play buttons. When the player clicks <code>LeftBtn</code>, we want <code>PickerSprite</code> to move to the left 50 pixels, and when the player clicks <code>RightBtn</code>, we want <code>PickerSprite</code> to move 50 pixels to the right.</p>
<div class="image"><span epub:type="pagebreak" id="page_54"/><img alt="Image" src="../images/f0054-01.jpg"/></div>
<p class="indent">In the Blocks pane, click <span class="codestrong">LeftBtn</span> and, when the blocks for the component appear, drag the <span class="codestrong">whenLeftBtn.Click</span> block <span class="ent">➊</span> to the Viewer. Then, in the Blocks pane, click <span class="codestrong">PickerSprite</span>, drag the <span class="codestrong">callPickerSprite.MoveTo</span> block <span class="ent">➋</span> to the Viewer, and snap it inside the <span class="codestrong">whenLeftBtn.Click</span> block next to the word <code>do</code>.</p>
<p class="indent">Now we need to provide the <code>MoveTo</code> block’s method parameters to tell the app where we want to move <code>PickerSprite</code>, keeping in mind that, for this game, we want <code>PickerSprite</code> to move from side to side only, along the very bottom of the <code>Canvas</code>. That means we want to change its x-coordinate but leave its y-coordinate at the bottom. To do this, click the <strong>Math</strong> blocks drawer, drag a subtraction operator block <span class="ent">➌</span> to the Viewer, and snap it to the right of <span class="codestrong">x</span>. Then, click <span class="codestrong">PickerSprite</span> and drag its <span class="codestrong">PickerSprite.X</span> block <span class="ent">➍</span> into the subtraction block’s left socket, and drag a <span class="codestrong">50</span> number block <span class="ent">➎</span> from the Math drawer into the subtraction block’s right socket.</p>
<p class="indent">These blocks tell our app to move <code>PickerSprite</code>’s x-coordinate left to its current location minus 50 pixels whenever the <code>Button</code> is clicked. For instance, if <code>PickerSprite</code>’s x-coordinate is at 240 pixels, when the player clicks <code>LeftBtn</code>, the x-coordinate should move 50 pixels to the left to 190 pixels, since 240 pixels – 50 pixels = 190 pixels.</p>
<p class="indent">Next, click <span class="codestrong">Canvas1</span>, drag its <span class="codestrong">Canvas.Height</span> block <span class="ent">➏</span> to the viewer, and snap it into the <span class="codestrong">callPickerSprite.MoveTo</span> block’s <span class="codestrong">y</span> socket. This tells the app that, when it moves <code>PickerSprite</code>, we want the <code>ImageSprite</code>’s <code>Y</code> value to stay the value that equals the height of the <code>Canvas</code>, positioned at the bottom. For instance, if the <code>Canvas</code> is 300 pixels in height, these blocks will keep <code>PickerSprite</code>’s y-coordinate at the <code>Canvas</code>’s bottommost point, 300 pixels, when <code>LeftBtn</code> is clicked.</p>
<p class="indent">Now copy the <span class="codestrong">LeftBtn</span> event handler and modify the duplicate blocks to program <span class="codestrong">RightBtn</span>. First, in the duplicate event handler, be sure to use the drop-down arrow to change <span class="codestrong">LeftBtn</span> to <span class="codestrong">RightBtn</span>. Then replace the subtraction block after the letter <code>x</code> with an addition block <span class="ent">➐</span> from the Math drawer, click <span class="codestrong">PickerSprite</span> and drag its <span class="codestrong">PickerSprite.X</span> block <span class="ent">➑</span> into the addition block’s left socket, and drag a <span class="codestrong">50</span> number block <span class="ent">➒</span> from the Math drawer into the addition block’s right socket.</p>
<p class="indent">These blocks say move <code>PickerSprite</code>’s x-coordinate to its current location plus 50 pixels when the button is clicked. So, if <code>PickerSprite</code>’s x-coordinate is at 240 pixels when the player clicks <code>RightBtn</code>, the x-coordinate should move 50 pixels to the right to 290 pixels, since 240 pixels + 50 pixels = 290 pixels.</p>
<p class="indent"><span epub:type="pagebreak" id="page_55"/>Now live-test the game again, and if <code>LeftBtn</code> and <code>RightBtn</code> don’t work correctly after you click <code>StartBtn</code>, try debugging. <code>LeftBtn</code> and <code>RightBtn</code> should move <code>PickerSprite</code> back and forth across the screen, while fruit <code>ImageSprite</code>s occasionally collide with <code>PickerSprite</code>. Since the player’s goal in the game is to collide with, or “catch,” the fruit, we need to program quite a bit of activity to take place when those fruit <code>ImageSprite</code>s hit <code>PickerSprite</code>. We’ll program that action in the next, and final, step.</p>
<h4 class="h4" id="ch00lev2sec25"><strong>STEP 5: HIDING CAUGHT FRUIT AND KEEPING SCORE</strong></h4>
<p class="noindent">Now we’ll program the last part of the game so that each time a fruit <code>ImageSprite</code> hits <code>PickerSprite</code>, the player “catches” the piece of fruit, hears a noise that sounds like the fruit hitting the picker’s bucket, earns a point, and sees the total score displayed on the screen. We’ll also hide the <code>ImageSprite</code> that hit <code>PickerSprite</code> so that, instead of continuing to fall to the bottom of the <code>Canvas</code>, the fruit looks like it landed in the picker’s bucket.</p>
<p class="indent">To keep the player’s score, we’ll use a variable to store and update that information. Let’s start our code for this step by creating and initializing the <code>score</code> variable.</p>
<div class="image"><img alt="Image" src="../images/f0055-01.jpg"/></div>
<p class="indent">Click the <strong>Variables</strong> block drawer and drag an <span class="codestrong">initialize global name</span> block to the Viewer. Click <span class="codestrong">name</span>, and replace it with the name of our variable, <span class="codestrong">score</span>. Then drag a <span class="codestrong">0</span> number block from the Math drawer and snap it to the right side of the <span class="codestrong">initialize global score</span> block. This declares and initializes the global variable we’ll use to store and update the player’s game score.</p>
<h5 class="h5" id="ch00lev3sec29"><strong>Playing a Sound When Fruit Hits the Picker</strong></h5>
<p class="noindent">Let’s now program the event handler for when a fruit <code>ImageSprite</code> hits <code>PickerSprite</code>.</p>
<div class="image"><img alt="Image" src="../images/f0055-02.jpg"/></div>
<p class="indent">In the Blocks pane, click <span class="codestrong">PickerSprite</span> and, when the blocks for the component appear, drag the <span class="codestrong">whenPickerSprite.CollidedWith</span> block <span class="ent">➊</span> to the Viewer. Then, in the Blocks pane, click <span class="codestrong">Sound1</span>, drag the <span class="codestrong">callSound1.Play</span> block <span class="ent">➋</span> to the Viewer, and snap it inside the <span class="codestrong">whenPickerSprite.CollidedWith</span> block next to the word <code>do</code>. This should play our clunking sound each time an <code>ImageSprite</code> hits <code>PickerSprite</code>.</p>
<h5 class="h5" id="ch00lev3sec30"><span epub:type="pagebreak" id="page_56"/><strong>Increasing and Displaying the Score</strong></h5>
<p class="noindent">Next, let’s place the blocks that increment and display the game score each time a fruit <code>ImageSprite</code> hits the picker.</p>
<div class="image"><img alt="Image" src="../images/f0056-01.jpg"/></div>
<p class="indent">Mouse over the <span class="codestrong">initialize global score</span> block, drag the <span class="codestrong">set global score to</span> block <span class="ent">➊</span> to the Viewer, and snap it inside the <span class="codestrong">whenPickerSprite.CollidedWith</span> block under the <code>callSound1.Play</code> block. Then drag an addition operator block <span class="ent">➋</span> from the Math drawer and snap it to the right of the <span class="codestrong">set global score to</span> block. Next, mouse over the <span class="codestrong">initialize global score</span> block again, and drag the <span class="codestrong">get global score</span> block <span class="ent">➌</span> into the addition block’s left socket and a <span class="codestrong">1</span> number block <span class="ent">➍</span> from the Math drawer into its right socket. These blocks add 1 to the current value of the <code>score</code> variable each time a fruit <code>ImageSprite</code> collides with <code>PickerSprite</code>.</p>
<p class="indent">To display the score and also let the player know how many of the total number of dropped fruits <code>PickerSprite</code> has caught, click <span class="codestrong">Label1</span>, drag the <span class="codestrong">setLabel1.Textto</span> block <span class="ent">➎</span> to the Viewer, and snap it inside the <span class="codestrong">whenPickerSprite.CollidedWith</span> block under the <code>set global score to</code> block. Then, click the <strong>Text</strong> blocks drawer, drag a <span class="codestrong">join</span> block <span class="ent">➏</span> to the Viewer, and snap it to the right of the <span class="codestrong">setLabel1.Textto</span> block.</p>
<p class="indent">Here, we’ll join four strings to set the text and numbers we want <code>Label1</code> to display, although by default the <code>join</code> block allows us to combine only two strings. <a href="ch03.xhtml#ch3fig3">Figure 3-3</a> shows how to change the block to create space for the additional inputs we’ll need.</p>
<div class="image" id="ch3fig3"><img alt="Image" src="../images/03fig03.jpg"/></div>
<p class="figcap"><em>Figure 3-3: Adding inputs to the <code>join</code> block</em></p>
<p class="indent">Click the blue <em>mutator</em> icon to the left of the word <code>join</code>, and drag additional string blocks to the <code>join</code> block in the dialog that opens.</p>
<p class="indent">Now we can snap our four strings into the <code>join</code> block inputs. In the top input, drag in an empty string block <span class="ent">➐</span> from the Text blocks drawer and enter <span epub:type="pagebreak" id="page_57"/><span class="codestrong">Score:</span> , making sure to include the space after the colon so that, when the strings combine, the characters won’t run together without proper spacing. Then mouse over the <span class="codestrong">initialize global score</span> block and drag the <span class="codestrong">get global score</span> block <span class="ent">➑</span> into the <code>join</code> block’s second input. In the <code>join</code> block’s third input, drag in another empty string block <span class="ent">➒</span> and enter <span class="codestrong">out of</span> , leaving a space before <code>out</code> and after <code>of</code>. Then mouse over the <span class="codestrong">initialize global fruitsDropped</span> block and drag the <span class="codestrong">get global fruitsDropped</span> block <span class="ent">➓</span> into the <code>join</code> block’s last input. These blocks display the number of points and total number of fruits dropped on <code>Label1</code> for the player to see at the top of the screen. For instance, if the player’s score is 6 points and a total of 20 fruits have dropped, the label should display “Score: 6 out of 20.”</p>
<h5 class="h5" id="ch00lev3sec31"><strong>Hiding Caught Fruit</strong></h5>
<p class="noindent">Finally, let’s add the blocks that will make the fruit <code>ImageSprite</code>s disappear after they collide with <code>PickerSprite</code>.</p>
<div class="image"><img alt="Image" src="../images/f0057-01.jpg"/></div>
<p class="indent">Click <span class="codestrong">FruitSprite1</span> and, when the blocks for the component appear, drag the <span class="codestrong">whenFruitSprite1.CollidedWith</span> block <span class="ent">➊</span> to the Viewer. Then, click <span class="codestrong">FruitSprite1</span>, drag the <span class="codestrong">setFruitSprite1.Visibleto</span> block <span class="ent">➋</span> to the Viewer, and snap it inside the <span class="codestrong">whenFruitSprite1.CollidedWith</span> block next to the word <code>do</code>. Next, in the Blocks pane, click the <strong>Logic</strong> blocks drawer, drag the <span class="codestrong">false</span> block <span class="ent">➌</span> to the Viewer, and snap it to the right side of the <span class="codestrong">setFruitSprite1.Visibleto</span> block.</p>
<p class="indent">Now duplicate these blocks for <code>FruitSprite2</code>, taking care to use the drop-down arrows both places you see <code>FruitSprite1</code> to change to <span class="codestrong">FruitSprite2</span>. Then duplicate the blocks again, and be sure to change to <span class="codestrong">FruitSprite3</span>. These three event handlers hide the fruit <code>ImageSprite</code>s when they hit <code>PickerSprite</code> so it looks like the picker successfully caught the fruit in the bucket. In the next chapter, you’ll learn how to eliminate these duplicate blocks and accomplish the same task using a more sophisticated programming structure.</p>
<p class="indent">Now, following the plan for step 5, each time a fruit <code>ImageSprite</code> touches <code>PickerSprite</code>, the app should play a sound, increase the player’s score by 1, display the score and the total pieces of fruit, and hide the fruit <code>ImageSprite</code>.</p>
<p class="indent">It’s time to test the completed game! Open the app on your device, and you should see <code>StartBtn</code> at the top of the screen. Click it, and when it disappears, you should see the other game components appear. Now the fruit starts to randomly drop, and you can click <code>LeftBtn</code> and <code>RightBtn</code> to move <code>PickerSprite</code> back and forth across the screen to try to catch it. <span epub:type="pagebreak" id="page_58"/>Whenever <code>PickerSprite</code> catches a piece of fruit, you should hear a sound and see your score increase. If you placed your blocks correctly, the game should work as described, and you’ll have successfully created the “Fruit Loot” game!</p>
<h3 class="h3" id="ch00lev1sec24"><strong>SUMMARY</strong></h3>
<p class="noindent">In this chapter, you built the animated “Fruit Loot” app, a game where a player moves a fruit picker back and forth across the screen and earns points when the picker catches rapidly and randomly dropping fruit.</p>
<p class="indent">You learned how programmers animate an object by moving its x- and y-coordinates; use pseudorandom number generators to add randomness in games, simulators, and other applications; and work with arithmetic operators to manipulate data. You also practiced declaring and initializing variables to store and change information, and you learned how to provide required arguments for built-in methods with parameters.</p>
<p class="indent">In the next chapter, you’ll do more with math operators and random number blocks and begin to make selections in your code using Control blocks. You’ll use those tools to create part 1 of the “Multiplication Station” quiz app, which generates random, timed multiplication problems, evaluates solutions the user inputs, and then speaks to declare those answers right or wrong.</p>
<h3 class="h3" id="ch00lev1sec25"><strong>ON YOUR OWN</strong></h3>
<p class="noindent">Save new versions of “Fruit Loot” as you modify and extend it working on these exercises. You can find solutions online at <em><a href="https://nostarch.com/programwithappinventor/">https://nostarch.com/programwithappinventor/</a></em>.</p>
<ol>
<li><p class="noindent">Change the app so that it calculates and keeps track of how many pieces of fruit the picker fails to catch during a game. How can you calculate, store, and display this information using the existing event handlers and adding the smallest number of additional blocks?</p></li>
<li><p class="noindent">Extend the game so that the frustrated owner of the fruit trees, who can’t keep the fruit from falling over the fence, drops rocks down the fence to try to keep the picker from attempting to catch the falling fruit. Reduce the player’s score each time the rock hits another sprite. What components and blocks will you add?</p></li>
<li><p class="noindent">Extend the game even further so that the score label displays the number of times the rock hits another sprite.</p></li>
</ol>
</body></html>