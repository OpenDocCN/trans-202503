<html><head></head><body>
  <h2 class="h2" id="app01"><a id="page_213"/><strong>A</strong></h2>

  <p class="h2c"><strong>HELLO MONEY! A SIMPLE JAVASCRIPT PROGRAM</strong></p>

  <p class="noindent">One factor that makes Bitcoin so exciting is that <em>anyone</em> can write computer programs to link directly into the Bitcoin network and perform financial transactions. This appendix explains how to write a simple JavaScript program that watches a wallet and indicates when bitcoins have been sent to the wallet. In <a href="../Text/app02.html#app02">Appendix B</a>, we’ll create some more advanced programs in Java that expand on this idea.</p>

  <h3 class="h3" id="ch00leve1sec136"><strong>The Meaning of “Easy”</strong></h3>

  <p class="noindent">Writing programs that manipulate money in Bitcoin is easy. However, as we walk through this process, it might not seem very easy to you.</p>

  <p class="indent"><a id="page_214"/>But imagine, instead, if we built our app or service using a traditional e-commerce system. Roughly, here’s what those steps would look like:</p>

  <p class="ordert">1. Incorporate your business to receive a DUNS<sup><a id="footnote_72"/><a href="../Text/footnote.html#footnote72">1</a></sup> number.</p>

  <p class="order">2. Get a corporate account at your bank.</p>

  <p class="order">3. Have your account verified by a merchant services provider (Intuit, PayPal, Stripe, Apple, etc.).</p>

  <p class="order">4. Set up an account via the provider with your DUNS number to get access keys.</p>

  <p class="order">5. Acquire proprietary library software from the provider (you’ll probably need to update this library regularly to maintain your software).</p>

  <p class="order">6. Redirect your customers to a special provider to authorize payments.</p>

  <p class="order">7. Write your code.</p>

  <p class="orderb">8. Have your finished app reviewed by the payment provider.</p>

  <p class="indent">Here is the main step needed to get a Bitcoin-based, e-commerce system up and running:</p>

  <p class="ordert">1. Write your code.</p>

  <p class="indent">Having to complete just this one task is what we mean when we use the term <em>easy</em> when programming with Bitcoin.</p>

  <h3 class="h3" id="ch00leve1sec137"><strong>Three Ways to Write Bitcoin Software</strong></h3>

  <p class="noindent">To write Bitcoin-enabled software, you can use three different approaches:</p>

  <p class="ordert">1. Use a merchant service.</p>

  <p class="order">2. Connect to a local Bitcoin wallet program (typically the original Bitcoin wallet application based on Satoshi’s initial code, named bitcoind).</p>

  <p class="orderb">3. Create a program that inserts itself directly into the Bitcoin network.</p>

  <p class="indent">Using approach #1, you would connect to a web API over the Internet. That API would be supplied by a third-party company to manage your bitcoins. Companies that supply these APIs for sending and receiving bitcoins are typically called <em>merchant services</em>.</p>

  <p class="indent">For example, if your website sells widgets and you want people to buy your widgets with bitcoins, using a merchant service may be a simple, nofuss way to get your website working quickly. An additional benefit of a merchant service is that it may also offer services to automatically convert Bitcoin to/from other currencies as part of a transaction. Many companies supply these APIs, and BitPay is a common choice. But you can find a more extensive list of companies on the official Bitcoin foundation website.<sup><a id="footnote_73"/><a href="../Text/footnote.html#footnote73">2</a></sup></p>

  <p class="indent"><a id="page_215"/>However, this approach has some drawbacks. First, these vendor APIs arguably go against the spirit of Bitcoin, because using an API middleman makes you beholden to an external party; serious Bitcoiners prefer to retain 100 percent control over their money. Second, these APIs are mostly designed only for common use cases, so they don’t allow the flexibility and innovative app development that we want to foster with this book. Third, the design of these APIs tends to change frequently, making it difficult to provide you with current information. For these reasons, we won’t spend much time discussing vendor APIs in this book.</p>

  <p class="indent">Approach #2 involves connecting to a local Bitcoin wallet and basically running the wallet on autopilot. Two of the Bitcoin wallet programs based on Satoshi’s original code—Bitcoin Core and bitcoind—can be remote-controlled using a special protocol called JSON-RPC, as we will discuss shortly. Because these two programs are the gold standard in Bitcoin wallets, it is very enticing to utilize them for custom programs. Programs written to automate Bitcoin Core and bitcoind are easy to understand, and libraries exist in all popular programming languages, simplifying their use. You can use this approach in JavaScript, Ruby, PHP, Python, and many other languages. Unfortunately, the main drawback of using a local Bitcoin wallet program and controlling it from your own code is that this process often clunky and inefficient, as you’ll see in the first programming example.</p>

  <p class="note"><strong>NOTE</strong><br/>
  <em>Bitcoin Core and bitcoind share the same code. This common code is called the</em> Bitcoin reference client, <em>or just</em> Bitcoin. <em>It was the first implementation of</em> the <em>Bitcoin protocol and eventually was split into two variants: Bitcoin Core has a friendly graphical interface (UI), and bitcoind is a more stripped-down version with a text-based interface.</em></p>

  <p class="indent">Approach #3 involves going right to the metal and inserting your Bitcoin-enabled program directly into the Bitcoin network. You can do this in languages such as Java, C++, or Go or any language that has a fully implemented Bitcoin client library available. This approach is more robust and less resource-intensive than approach #2, but it is more technically complex.</p>

  <p class="indent">However, if you’re a programmer who believes in the Bitcoin ethos, being able to write an app that is a real <em>first-class citizen</em> in the Bitcoin network—a true Bitcoin node participating in the Bitcoin system—is motivating. The reason is that absolutely no limitations restrict what your app can do (as long as your app obeys the rules of the network.) In <a href="../Text/app02.html#app02">Appendix B</a>, we’ll write some programs that use this approach.</p>

  <h3 class="h3" id="ch00leve1sec138"><strong>General Security Notes on Bitcoin Programming</strong></h3>

  <p class="noindent">An important disclaimer we need to mention here is that in this appendix, we’ll write programs that send and receive only a few pennies. The techniques and example discussed are useful for learning the basic concepts of Bitcoin programming <em>but are in no way appropriate for writing programs that <a id="page_216"/>manipulate substantial sums of money</em>. If you plan on writing serious Bitcoin applications, you’ll need to do the following:</p>

  <p class="ordert">1. Learn the basic concepts from the sample programs in this chapter.</p>

  <p class="order">2. Use this knowledge to study and understand the underlying source code for the Bitcoin libraries used in this chapter.</p>

  <p class="orderb">3. Follow the forums used by the developers and other library users to stay current with any security risks involved when using these libraries.</p>

  <p class="indent">Most important, be aware that we’re using community-maintained source code in our examples; if a clever black hat hacker<sup><a id="footnote_74"/><a href="../Text/footnote.html#footnote74">3</a></sup> manages to insert some rogue code into the official library repositories, <em>he or she can steal all your money</em>. Even if you understand the library code perfectly, you run the risk of jeopardizing the safety of your money. For example, as you’re downloading this library code from the Internet, a black hat hacker has many opportunities to perform a man-in-the-middle attack<sup><a id="footnote_75"/><a href="../Text/footnote.html#footnote75">4</a></sup> and insert rogue code into a doctored version of the library that is incorporated into your program. As a result, the hacker can steal all your money.</p>

  <p class="indent">Additionally, as mentioned in earlier chapters, hackers can steal your bitcoins in many other ways that aren’t specific to Bitcoin programming. In a few years, if the current popularity of Bitcoin continues, we suspect most computer viruses will include code that immediately empties any Bitcoin wallets they find.</p>

  <p class="indent">The bottom line is that you need to understand the grave risks your money might be exposed to if you plan on creating more advanced Bitcoin programs; you’ll be able to safely protect your money only if you have a comprehensive and firm understanding of Bitcoin technology that goes beyond the introduction we give in this chapter. Please proceed with caution!</p>

  <h3 class="h3" id="ch00leve1sec139"><strong>Some Upbeat Notes on Bitcoin Security</strong></h3>

  <p class="noindent">Now that you’ve endured some fire and brimstone to prevent you from losing money, we’ll point out a few facts that should make you feel confident about Bitcoin security:</p>

  <p class="bullt">• The core Bitcoin network has so far maintained a record of almost perfect security. Most of the security risks involved in using bitcoins are due to careless acts that people executed on their own computers and could have been avoided.</p>

  <p class="bull"><a id="page_217"/>• Despite the risks we’ve discussed so far in this chapter, established programming practices exist that mitigate all of these risks. You will be able to write secure Bitcoin software if you study this book, follow general guidelines on secure software development, and keep up-to-date on the latest security concerns discussed on Bitcoin development forums.</p>

  <p class="bullb">• As you are learning to write programs that use bitcoins, make sure you use a computer that doesn’t contain Bitcoin wallets with substantial amounts of bitcoins in them. By doing so, you can learn to write Bitcoin software and avoid any dangers: You can’t accidentally lose bitcoins (or have them stolen) on your development machine if you store your coins elsewhere.</p>

  <h3 class="h3" id="ch00leve1sec140"><strong>Writing Your First Bitcoin Program in JavaScript</strong></h3>

  <p class="noindent">By convention, the first program a programmer writes when learning a new technology is a <em>Hello World</em> program: It’s the simplest program possible in that it just prints the message <em>Hello World!</em> on the screen. Essentially, it indicates to the novice that your initial code seems to be working at the outset.</p>

  <p class="indent">However, the Bitcoin programs we need to write must perform two main tasks: receive money and send money. In this chapter, we’ll focus solely on receiving money and write a program called <em>Hello Money!</em>. In <a href="../Text/app02.html#app02">Appendix B</a> we’ll write a <em>Bye-Bye Money</em> program to send money.</p>

  <h4 class="h4" id="ch00leve1sec141"><strong><em>Why Use JavaScript?</em></strong></h4>

  <p class="noindent">JavaScript is arguably the most well-known programming language in use today, because most developers who build software for the Web must learn it sooner or later (it is the only language that can natively run in a standard web browser). However, the JavaScript code we create will not run in a web browser: This is because web browsers have strong protections called <em>cross-domain restrictions</em> that shield them against communicating with external programs and websites. These restrictions limit what you can do with JavaScript within a web browser, making it difficult to interact with any external wallets (which is no surprise, because you wouldn’t want your wallet emptied by visiting a malicious website).</p>

  <p class="indent">However, currently you can also run JavaScript on a server, as is commonly done using the Node.js library. When run on a server, no such restrictions apply, and we can write simple programs that run in a console and can interact with Bitcoin Core and bitcoind.</p>

  <h4 class="h4" id="ch00leve1sec142"><strong><em>Bitcoin Core vs. Bitcoind</em></strong></h4>

  <p class="noindent">As discussed earlier, the programming techniques described in this chapter will work with either of the wallet apps, Bitcoin Core or bitcoind. The only substantive difference between the two programs is that Bitcoin Core has a graphical UI; basically, it is just bitcoind with a frontend attached to it. Because of the friendliness of the graphical UI, we’ll use Bitcoin Core for <a id="page_218"/>the example in this chapter. However, bitcoind is slightly less resource-intensive and can more easily run on computer servers via a terminal console. Consequently, it’s best for you to use bitcoind if you actually deploy a finished program that uses the concepts in this chapter.</p>

  <h3 class="h3" id="ch00leve1sec143"><strong>Preparing Your Machine for JavaScript Bitcoin Programming</strong></h3>

  <p class="noindent">You’ll need a few tools to ready your machine before you begin programming, so let’s get them now. The instructions provided here assume a Windows development environment; skip ahead to “<a href="../Text/app01.html#ch00leve1sec147">For Mac Hackers</a>” on <a href="../Text/app01.html#page_219">page 219</a> or “<a href="../Text/app01.html#ch00leve1sec148">For Linux Folks</a>” on <a href="../Text/app01.html#page_219">page 219</a> if you’re using either of those platforms.</p>

  <h4 class="h4" id="ch00leve1sec144"><strong><em>Installing Node.js</em></strong></h4>

  <p class="noindent">You first need to download an installer for Node.js from the <em><a href="http://nodejs.org/">http://nodejs.org/</a></em> website. When you run the installer for Node.js, it will also install the Node Package Manager (npm) that we’ll rely on next.</p>

  <h4 class="h4" id="ch00leve1sec145"><strong><em>Installing node-bitcoin</em></strong></h4>

  <p class="noindent">Now you’ll need a JavaScript library that connects to Bitcoin Core and bitcoind. We’ll use the node-bitcoin library. To install node-bitcoin, go to a command prompt and enter <code><strong>npm install bitcoin</strong></code>. This command invokes the (previously installed) Node Package Manager, which downloads everything in the library in a simple step.</p>

  <h4 class="h4" id="ch00leve1sec146"><strong><em>Starting Bitcoin Core</em></strong></h4>

  <p class="noindent">If you haven’t already, download Bitcoin Core from its official website at <em><a href="http://bitcoin.org/en/download">http://bitcoin.org/en/download</a></em>.</p>

  <p class="indent">Next, you need to fire up Bitcoin Core in server mode. The wallet app will open an extra socket that we’ll use to connect to the wallet from our JavaScript program. To do this on Mac and Linux machines, go to the Bitcoin Core installation directory from the console and run <code><strong>./Bitcoin-Qt -server</strong></code>. On Windows machines, open a command prompt, go to the <em>C:\Program Files (x86)\Bitcoin</em> directory, and enter <code><strong>bitcoin-qt.exe -server</strong></code>.</p>

  <p class="indent">The first time you run Bitcoin Core in server mode, it will ask you to create a file named <em>bitcoin.conf</em> in a specific location and add a user ID and password to this file. Follow the directions as suggested because we’ll use the userid and password shortly. Then, restart Bitcoin Core.</p>

  <p class="indent">If you already have Bitcoin Core (previously called Bitcoin-Qt) installed but are following this tutorial for the first time, then you will need to locate your previously created <em>bitcoin.conf</em> file. For Windows users you might want to look in <em>C:\Users\&lt;username&gt;\AppData\Roaming\Bitcoin\bitcoin.conf</em>. For Mac users, try <em>/Users/&lt;username&gt;/Library/ApplicationSupport/Bitcoin/bitcoin.conf</em>. For Linux users, try <em>/home/&lt;username&gt;/ .bicoin/bitcoin.conf</em>.</p>

  <p class="note"><a id="page_219"/><strong>NOTE</strong><br/>
  <em>Gotcha for Windows users: If you try to create the</em> bitcoin.conf <em>file with Windows Notepad, be aware that Notepad will (oh so helpfully) tack on a .</em>txt <em>extension, which Windows will also (oh so helpfully) keep completely hidden from you for your own protection (a prime example of why most hackers these days try to avoid using Windows). To circumvent this problem, put quotes around the name</em> bitcoin.conf <em>when you enter it into the Save As dialog in Notepad.</em></p>

  <p class="indent">At this point, as is usual for a Bitcoin wallet, Bitcoin Core will take several hours downloading the blockchain before it’s ready for the next steps—a perfect time for an extended lunch break!</p>

  <h4 class="h4" id="ch00leve1sec147"><strong><em>For Mac Hackers</em></strong></h4>

  <p class="noindent">If you’re using a Mac and are comfortable using a terminal, you can run specific commands to automatically search for, download, and install the required programs.</p>

  <p class="indent">On Mac, download homebrew, a command-line tool that will handle the entire process for you:</p>
  <pre class="programs">
# Get homebrew and if you haven't already<br/>ruby -e "$(curl -fsSL https://raw.github.com/Homebrew/homebrew/go/install)"<br/>brew tap phinze/homebrew-cask<br/>brew install brew-cask<br/><br/># Get node.js and bitcoin stuff<br/>brew cask install bitcoin<br/>brew install nodejs npm<br/>npm install bitcoin<br/><br/># Run bitcoin-qt in server mode<br/>~/Applications/Bitcoin-Qt.app/Contents/MacOS/./Bitcoin-Qt -server
</pre>

  <h4 class="h4" id="ch00leve1sec148"><strong><em>For Linux Folks</em></strong></h4>

  <p class="noindent">If you’re using flavors of Debian Linux, such as Ubuntu, you’ll just use the PPA feature to install the libraries:</p>
  <pre class="programs">
sudo add-apt-repository ppa:bitcoin/bitcoin<br/>sudo apt-get update<br/>sudo apt-get install nodejs npm bitcoin-qt<br/>npm install bitcoin<br/>bitcoin-qt -server
</pre>

  <p class="indent">With a working Bitcoin Core server, we’re now ready to start programming.</p>

  <h3 class="h3" id="ch00leve1sec149"><a id="page_220"/><strong>Hello Money!</strong></h3>

  <p class="noindent">Okay, let’s write our first Bitcoin app. Simply type the following complete program into a file named <em>hellomoney.js</em>:</p>
  <pre class="programs">
var bitcoin = require("bitcoin");<br/><br/>var client = new bitcoin.Client({<br/>    host: 'localhost',<br/>    port: 8332,<br/>    user: '<span class="codeitalic">myUsername</span>',<br/>    pass: '<span class="codeitalic">myPassword</span>'<br/>});<br/><br/>var previousBalance = 0;<br/><br/>function mainLoop() {<br/>    client.getBalance('*', 0, function (err, balance) {<br/>        if (err) {<br/>            console.log(err);<br/>        } else if (balance &gt; previousBalance) {<br/>            console.log("Hello Money! New balance: " + balance);<br/>            previousBalance = balance;<br/>        } else {<br/>            console.log("Nothing's changed.");<br/>        }<br/>    });<br/>}<br/><br/>setInterval(mainLoop(), 5000);
</pre>

  <p class="indent">Before we start running the app, let’s analyze what the code does line by line.</p>

  <h4 class="h4" id="ch00leve1sec150"><strong><em>Part 1: Initializing the Connection with Bitcoin Core</em></strong></h4>
  <pre class="programs">
var bitcoin = require("bitcoin");<span class="ent">➊</span><br/><br/>var client = new bitcoin.Client(<span class="ent">➋</span><br/>   {<br/>      host: 'localhost',<br/>      port: 8332,<br/>      user: '<span class="codeitalic">myUsername</span>',<span class="ent">➌</span><br/>      pass: '<span class="codeitalic">myPassword</span>'<span class="ent">➍</span><br/>   });<br/><br/>var previousBalance = 0;<span class="ent">➎</span>
</pre>

  <p class="indent"><a id="page_221"/>The first line indicates that we’re using the node-bitcoin library <span class="ent">➊</span>. Next, we establish a connection to the Bitcoin Core server that we set up <span class="ent">➋</span>. Because we’ll be running the app on the same machine that Bitcoin Core is installed on, our host is set to <code>'localhost'</code>. By default, the bitcoin server will run on port 8332.</p>

  <p class="indent"><strong>Important:</strong> On the next two lines <span class="ent">➌➍</span>, input the user ID and password that you entered into the <em>bitcoin.conf</em> file. <em>Replace the placeholders shown here with your own.</em> Then, we create a variable to keep track of the previous balance in our program <span class="ent">➎</span>, which we start at zero.</p>

  <h4 class="h4" id="ch00leve1sec151"><strong><em>Part 2: The Main Loop</em></strong></h4>

  <p class="noindent">Now we’ll write a loop that checks the balance in our wallet and reports to us when it has changed. The basic steps follow:</p>

  <p class="ordert">1. Ask Bitcoin Core for the current balance in its wallet.</p>

  <p class="order">2. If the balance is higher than the previous balance, print a message, and update the previous balance to the current balance.</p>

  <p class="order">3. Set a timer that completes the entire procedure again every five seconds.</p>

  <p class="indent">The following <code>mainLoop</code> function carries out the preceding steps:</p>
  <pre class="programs">
function mainLoop() {<br/>    client.getBalance('*', 0, function (err, balance) {<span class="ent">➊</span><br/>        if (err) {<br/>            console.log(err);<span class="ent">➋</span><br/>        } else if (balance &gt; previousBalance) {<span class="ent">➌</span><br/>            console.log("Hello Money! New balance: " + balance);<span class="ent">➍</span><br/>            previousBalance = balance;<span class="ent">➎</span><br/>        } else {<br/>            console.log("Nothing's changed.");<br/>        }<br/>    });<br/>}<br/><br/>setInterval(mainLoop, 5000);<span class="ent">➏</span>
</pre>

  <p class="indent">First, the function asks Bitcoin Core for the balance <span class="ent">➊</span>. As we do this, we create a <em>callback function</em>, which reads <code>function(err,balance) {}</code>. A callback function is called at some future date. In this instance, it will be called when we receive the resulting balance from Bitcoin Core.</p>

  <p class="note"><strong>NOTE</strong><br/>
  <em>If you’ve never worked with Node.js before, you may need some time to learn how to read this type of programming idiom. The philosophy in Node.js is that whenever your program has to wait on an external process (in this case the Bitcoin Core program), it makes you create callback functions, as opposed to stopping the program dead as you wait for a result to arrive. This is called</em> asynchronous programming <em>and enables your program to do other tasks while waiting for data to come in.</em></p>

  <p class="indent"><a id="page_222"/>When the balance becomes available, we first check whether an error has occurred and display it if one has <span class="ent">➋</span>. Next, we check whether the new balance is higher than the previous balance <span class="ent">➌</span>. If so, we print a message <span class="ent">➍</span> and update the previous balance <span class="ent">➎</span>. Finally, we create a timer that runs every 5000 milliseconds with the <code>setInterval</code> function to repeatedly call <code>mainLoop</code> <span class="ent">➏</span>.</p>

  <h4 class="h4" id="ch00leve1sec152"><strong><em>The Bitcoin Core JSON-RPC API</em></strong></h4>

  <p class="noindent">The <code>mainLoop</code> function operates by <em>talking</em> with Bitcoin Core. This talking protocol is formatted as JSON-RPC, or JavaScript Object Notation – Remote Procedure Call. Simply put, JSON-RPC describes a structure with which two computers (or two programs on a single computer) can write messages to each other in a way that’s easy for computer programmers to integrate into their code.</p>

  <p class="indent">In our small app, we use only a single command to communicate with Bitcoin Core—the <code>client.getBalance</code> function. But many more commands are available that let you manipulate Bitcoin addresses, modify the wallet, analyze transactions, and complete most other tasks you’d want to do in a Bitcoin program. To learn which functions are available in the JSON-RPC interface, browse to the official API function list at <em><a href="https://en.bitcoin.it/wiki/Original_Bitcoin_client/API_calls_list">https://en.bitcoin.it/wiki/Original_Bitcoin_client/API_calls_list</a></em>.</p>

  <h3 class="h3" id="ch00leve1sec153"><strong>Running the Hello Money! App</strong></h3>

  <p class="noindent">To try out our shiny new <code>Hello Money!</code> program, run the following command in a console from the directory containing <em>hellomoney.js</em>:</p>
  <pre class="programs">
&gt; <span class="codestrong">node hellomoney.js</span>
</pre>

  <p class="indent">Next, simply send 0.001 bitcoins to the wallet managed by Bitcoin Core from another wallet. To do this, you’ll need to use one of the public addresses, which you can find by clicking Receive in Bitcoin Core. The way we’ve written the app, it will count money that has arrived in your wallet only if it has received a confirmation on the blockchain. (In the next section, we’ll write a <code>Hello Money!</code> program that detects money immediately on arrival, without requiring confirmations.)</p>

  <p class="indent">Because confirmations typically take about 10 minutes, you’ll need to wait a bit before you see the following:</p>
  <pre class="programs">
&gt; <span class="codestrong">node hellomoney.js</span><br/>Hello Money! New balance: 0.001
</pre>

  <p class="indent">Congratulations! You’ve written a program that can watch a Bitcoin wallet and detect when money has been sent to it. If you then send additional money, the app will create messages to report on these new deposits as well.</p>

  <h3 class="h3" id="ch00leve1sec154"><a id="page_223"/><strong>Limitations of Writing Bitcoin Programs That Use JSON-RPC</strong></h3>

  <p class="noindent">By using JSON-RPC, we were able to write a program in JavaScript in no time that could report money sent to a Bitcoin wallet. However, if you’re an experienced programmer (or have an advanced understanding of the Bitcoin protocol), you’ll identify many problems with our example app.</p>

  <p class="indent">One problem is that the app uses <em>polling</em> to detect when money has arrived. Polling constantly checks the status of Bitcoin Core by interrogating the software every five seconds. This process is similar to asking: “Do you have money yet? Do you have money now? What about now?” As you might imagine, repeatedly asking the same question like this not efficient.</p>

  <p class="indent">If you’re writing a production-quality application, it’s therefore best to write it using <em>pushing</em>. Pushing involves specifying that our app is waiting for money and that it would like to be notified when money has arrived. But because of the way our connection with Bitcoin Core is set up, enabling pushing is rather difficult. After all, Bitcoin Core is primarily meant to be a wallet app in which no pushing to external programs is needed. Automating Bitcoin Core with JSON-PRC is a bit of a hack, and for this reason, we may run into limitations, such as needing to use inefficient polling.</p>

  <p class="note"><strong>NOTE</strong><br/>
  <em>In more recent versions of Bitcoin Core and bitcoind, a feature called</em> walletNotify <em>allows for pushing, but the way it works is rather complicated—enough so that we recommend you avoid using it. Instead, we would suggest you use BitcoinJ instead of Bitcoin Core for pushing, as we will discuss in <a href="../Text/app02.html#app02">Appendix B</a>.</em></p>

  <p class="indent">Another problem with our app is that we’re just checking a crude <em>balance</em> amount to determine when money was sent to our wallet. However, the Bitcoin blockchain can sometimes trigger situations that cause the balance of a wallet to jump in ways that are unexpected and could make our app produce incorrect results.</p>

  <p class="indent">For instance, suppose our wallet receives some money with one confirmation, but the blockchain suddenly forks, unconfirming the transaction that was tied to that money and causing the wallet to suddenly lose much of the confirmed money. Then, within the same five-second window, someone sends us more money. In this case, the balance in the wallet could actually <em>decrease</em>, even though we received some new money, and the <em>Hello Money!</em> message will never be triggered.</p>

  <p class="indent">This is a very rare scenario, but if you’re writing an app that manipulates large quantities of money, such incorrect behavior is intolerable. The solution to this problem is to use <code>client.listTransactions</code> (instead of <code>client.getBalance</code>). Then review these transactions to determine whether any new transactions involved sending money to the wallet in the last five seconds, which is what our app is looking for. However, this is too complicated to add to our simple <code>Hello Money!</code> program.</p>

  <p class="indent">An additional problem is that Bitcoin Core (and bitcoind) requires large amounts of blockchain data and computational resources to run, even though our little app doesn’t need most of this power. Is there any way of reducing these resource requirements? As you’ll see in <a href="../Text/app02.html#app02">Appendix B</a>, we can do this by writing a program that runs directly on the Bitcoin network.</p>
</body></html>