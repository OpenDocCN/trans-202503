<html><head></head><body>
<h2 class="h2" id="ch05"><span epub:type="pagebreak" id="page_83"/><strong><span class="big">5</span><br/>BEAT THE BUS: TRACKING LOCATION WITH MAPS AND SENSORS</strong></h2>
<div class="imagel"><img alt="Image" src="../images/common.jpg"/></div>
<p class="noindent">In <a href="ch03.xhtml#ch03">Chapters 3</a> and <a href="ch04.xhtml#ch04">4</a>, we used variables to store and process information, which allowed us to track and report data to users. In the “Fruit Loot” and “Multiplication Station” apps, we created variables that hold one value at a time, like the game score, number of fruits dropped, and percentage of multiplication problems correct.</p>
<p class="indent">But imagine how much more powerful our apps would be if we could store and manipulate multiple values in a single variable! For example, we could display a game’s top 10 scores or allow users to choose from a list of 50 states, without needing to create a different variable for each score or state.</p>
<p class="indent">In most programming environments you can store multiple values in a data structure called an <em>array</em>. In App Inventor, you can store multiple values in variables using the built-in Variables, Lists, and Text blocks. The following variable stores multiple values as a list.</p>
<div class="image"><span epub:type="pagebreak" id="page_84"/><img alt="Image" src="../images/f0084-01.jpg"/></div>
<p class="indent">You can use Lists blocks to manipulate list variables by adding items to a list, searching inside a list, or removing items from a list. You can also access each list item by referring to its <em>index</em>, the number of its position in the list. For instance, the first item in the <span class="literal">size</span> list, <span class="literal">S</span>, is at index 1, the second item is at index 2, and so on.</p>
<div class="note">
<p class="notet"><span class="noteh1"><strong>NOTE</strong></span></p>
<p class="notep"><em>App Inventor numbers indexes differently from most traditional programing languages, which number the first item in a list as index 0, the second item as index 1, and so on.</em></p>
</div>
<p class="indent">In this chapter, we’ll work with four lists that contain <em>static</em> (unchanging) preset values. Three of the lists will be interrelated, so that you’ll use an index of one list to access values in the two other lists. We’ll also create our first local variable to simplify a somewhat complex event handler.</p>
<h3 class="h3" id="ch00lev1sec34"><strong>BUILDING THE “BEAT THE BUS” APP</strong></h3>
<p class="noindent">In this chapter, along with the four lists just mentioned, you’ll use <span class="literal">ListPicker</span>, <span class="literal">LocationSensor</span>, <span class="literal">Texting</span>, and some of App Inventor’s newer <span class="literal">Maps</span> components to create the “Beat the Bus” app. This app allows your parents or friends to track your location without using the GPS and location-sensing functions on their phones, which may drain their batteries. Instead, this app relies on the location sensor on your own device.</p>
<p class="indent">Log into App Inventor, create a project named <span class="codestrong">BeatTheBus</span>, and click <strong>OK</strong>.</p>
<h3 class="h3" id="ch00lev1sec35"><strong>DECOMPOSING “BEAT THE BUS”</strong></h3>
<p class="noindent">In “Beat the Bus,” the user activates location tracking by selecting a telephone number and destination from preset lists. The app then sends periodic text messages to the selected telephone number, showing the user’s location along the route.</p>
<p class="indent">We can decompose the app into the following steps:</p>
<ol>
<li><p class="noindent">When a user opens the app, display a <span class="literal">Map</span> showing the user’s current location with a <span class="literal">Marker</span> pointing to the user’s home. Show a <span class="literal">ListPicker</span> for the user to select a phone number. Once the user selects a number, show a <span class="literal">ListPicker</span> for the user to select a destination.</p></li>
<li><p class="noindent">Before the user selects a destination, set the <span class="literal">ListPicker</span> options from a list of locations.</p></li>
<li><span epub:type="pagebreak" id="page_85"/><p class="noindent">Once the user selects a destination, move the <span class="literal">Map</span> and <span class="literal">Marker</span> to the selected destination, and text the starting location and destination to the selected number.</p></li>
<li><p class="noindent">When the user’s location is 5 miles or less away from the selected destination, periodically text the user’s location to the selected number.</p></li>
</ol>
<p class="indent">You’ll need the following components:</p>
<ul>
<li><p class="noindent">Global variable (4) to store telephone numbers, destinations, latitudes, and longitudes</p></li>
<li><p class="noindent"><span class="codestrong">Image</span> for app design</p></li>
<li><p class="noindent"><span class="codestrong">ListPicker</span> (2) for the user to select from telephone number and destination lists</p></li>
<li><p class="noindent">Local variable to store distance</p></li>
<li><p class="noindent"><span class="codestrong">LocationSensor</span> to provide periodic data related to the user’s location</p></li>
<li><p class="noindent"><span class="codestrong">Map</span> to show the user’s geographic location and hold the <span class="literal">Marker</span></p></li>
<li><p class="noindent"><span class="codestrong">Marker</span> to point to the user’s selected destination</p></li>
<li><p class="noindent"><span class="codestrong">Texting</span> to send text messages</p></li>
</ul>
<p class="indent">Now let’s lay out the app.</p>
<h3 class="h3" id="ch00lev1sec36"><strong>LAYING OUT “BEAT THE BUS” IN THE DESIGNER</strong></h3>
<p class="noindent">To make sure that all components in <span class="literal">Screen1</span> will be centered at the top of the screen, click the drop-down arrow under <span class="codestrong">AlignHorizontal</span> and select <strong>Center: 3</strong>. Next, change the screen’s background color to yellow by clicking <strong>Default</strong> under <span class="codestrong">BackgroundColor</span> and then <strong>Yellow</strong> when the color list dialog opens. Finally, remove the check mark under <span class="codestrong">TitleVisible</span> to hide the title of the screen when the app runs.</p>
<p class="indent">Next, let’s drag the necessary components from their drawers in the Palette pane onto the Viewer pane and adjust their properties as we go. First, drag in an <span class="codestrong">Image</span> from the User Interface drawer and set its <strong>Height</strong> to <strong>Fill parent</strong>. Then upload the picture to display by clicking the text box under <strong>Picture</strong> and following the image upload instructions outlined in “Uploading a Picture” on <a href="ch02.xhtml#page_27">page 27</a>. Finally, click the checkbox under <span class="codestrong">ScalePictureToFit</span> so the image will take up the entire width of the screen.</p>
<p class="indent">To display a <span class="literal">Map</span> centered at your user’s starting location, place a <span class="codestrong">Map</span> component from the Maps drawer under <span class="literal">Image1</span>. Note that you must place a <span class="literal">Map</span> on the screen before you can add any other <span class="literal">Maps</span> component. Adjust the <span class="literal">Map</span>’s properties by replacing the coordinates in the <span class="codestrong">CenterFromString</span> text box to the <em>latitude</em> and <em>longitude</em> for your app’s starting address, separated by a comma and space.</p>
<div class="note">
<p class="notet"><span epub:type="pagebreak" id="page_86"/><span class="noteh1"><strong>NOTE</strong></span></p>
<p class="notep"><em>You can locate any place on a map by its latitude and longitude coordinates. The <span class="roman">latitude</span> of a place is its distance north or south of the equator, while the <span class="roman">longitude</span> is its distance east or west of the prime meridian. You can find the latitude and longitude coordinates for a street address by entering it into the Latitude/Longitude Finder tool at <span class="roman"><a href="https://www.latlong.net/">https://www.latlong.net/</a></span>.</em></p>
</div>
<p class="indent">Then, to change the <span class="literal">Map</span>’s height to 50 percent so it takes up half the vertical screen, click the text box under <strong>Height</strong>; when the dialog opens, input <span class="codestrong">50</span> in the text box next to the word <span class="literal">percent</span> and click <strong>OK</strong>. Next, set its <strong>Width</strong> to <strong>Fill parent</strong>, click the checkbox under <span class="codestrong">ShowUser</span> so an icon representing the user will show on the <span class="literal">Map</span> and track the user’s location, and change the <span class="literal">Map</span> zoom level from the default 13 to 10 by inputting <span class="codestrong">10</span> in the <span class="codestrong">ZoomLevel</span> text box.</p>
<p class="indent">Now drag a <span class="codestrong">Marker</span> from the Maps drawer onto the <span class="literal">Map</span>. Adjust the <span class="literal">Marker</span> in the Properties pane by clicking the text box under <strong>Latitude</strong> and entering the latitude for the user’s home address, then clicking the text box under <strong>Longitude</strong> and entering its longitude.</p>
<p class="indent">Next, to let users select a destination and a phone number to send it to, under <span class="codestrong">Map1</span>, drag two <span class="codestrong">ListPicker</span>s from the User Interface drawer to the Viewer. Rename <span class="codestrong">ListPicker1</span> to <span class="codestrong">NumberPicker</span> and <span class="codestrong">ListPicker2</span> to <span class="codestrong">PlacePicker</span>. In the Properties pane for both, change the background color to yellow by clicking <strong>Default</strong> under <span class="codestrong">BackgroundColor</span> and then <strong>Yellow</strong> when the color list dialog opens. Then make the text bold by clicking the checkbox under <span class="codestrong">FontBold</span>, and make the text larger by inputting <span class="codestrong">25</span> in the <strong>FontSize</strong> text box. Replace the default <span class="literal">Text for ListPicker1</span> by entering <span class="codestrong">Select a Number</span> in the <strong>Text</strong> text box for <span class="literal">NumberPicker</span> and the default <span class="literal">Text for ListPicker2</span> by entering <span class="codestrong">Select a Place</span> in the <strong>Text</strong> text box for <span class="literal">PlacePicker</span>.</p>
<p class="indent">Change the <strong>Width</strong> for both <span class="literal">ListPicker</span>s to <strong>Fill parent</strong>, and change the color of the items in the selection drop-downs to yellow by clicking <strong>Default</strong> under <span class="codestrong">ItemTextColor</span> and then <strong>Yellow</strong> when the color list dialog opens. Then, in the Properties pane for <span class="codestrong">PlacePicker</span>, click the checkbox under <span class="codestrong">Visible</span> to remove the check mark and keep <span class="literal">PlacePicker</span> from showing when the app first opens. We’ll program it later to appear after the user picks a phone number.</p>
<p class="indent">Finally, drag in the non-visible components: the <span class="literal">LocationSensor</span> component from the Sensors drawer and the <span class="literal">Texting</span> component from the Social drawer. In the Properties pane, change the <span class="codestrong">LocationSensor</span>’s <span class="codestrong">TimeInterval</span> from the default 60,000 milliseconds to 1,000 by choosing <strong>1000</strong> in the drop-down box below <span class="codestrong">TimeInterval</span>. This means that the app’s <span class="literal">LocationSensor</span> will report location changes each second if location data is available and the location has changed since the last interval. We’re making this change so that later you can program your app to text updated location information as frequently as every second after new data becomes available.</p>
<p class="indent">Now that we’ve added <span class="literal">LocationSensor1</span>, click the <span class="codestrong">Map</span> in the Components pane and, in its Properties pane, choose its associated <span class="literal">LocationSensor</span> by clicking <strong>None</strong> under <span class="codestrong">LocationSensor</span>, selecting <span class="codestrong">LocationSensor1</span> in the dialog that opens, and clicking <strong>OK</strong>.</p>
<p class="indent"><span class="literal">Screen1</span> should look like <a href="ch05.xhtml#ch5fig1">Figure 5-1</a>.</p>
<div class="image" id="ch5fig1"><span epub:type="pagebreak" id="page_87"/><img alt="Image" src="../images/05fig01.jpg"/></div>
<p class="figcap"><em>Figure 5-1: The Viewer, Component, and Media panes after laying out “Beat the Bus”</em></p>
<p class="indent">In the Viewer pane, you should see all visible components on the screen and the non-visible components under <span class="literal">Screen1</span>. In the Components pane, you should see a list of every component you’ve dragged onto the Viewer pane. In the Media pane, you should see the image you’ve uploaded.</p>
<h3 class="h3" id="ch00lev1sec37"><strong>PROGRAMMING “BEAT THE BUS”</strong></h3>
<p class="noindent">Now that you’ve laid out all components, you’re ready to program the app in the Blocks Editor. For “Beat the Bus,” we’ll program five event handlers. Four of these respond to events related to the two <span class="literal">ListPicker</span>s. The other one directs the app’s action each time the <span class="literal">LocationSensor</span> detects a location change. We’ll also create four global list variables and one local variable to store important information, and we’ll use two <span class="literal">if then</span> blocks to test conditions to direct the flow of the app’s action.</p>
<p class="indent">Click the <strong>Blocks</strong> button to switch to the Blocks Editor, and let’s start programming the app’s four steps.</p>
<h4 class="h4" id="ch00lev2sec34"><strong>STEP 1: CHOOSING THE PHONE NUMBER TO TEXT</strong></h4>
<p class="noindent">When the screen opens, we want the user to see the <span class="literal">Map</span> and <span class="literal">Marker</span>, both with the properties we set in the Designer. We also want to display <span class="literal">NumberPicker</span>, <span epub:type="pagebreak" id="page_88"/>from which the user will select a telephone number for the app to text. Let’s start our code by telling the app what to do before and after the user clicks <span class="literal">NumberPicker</span> and selects a number.</p>
<h5 class="h5" id="ch00lev3sec53"><strong>Creating a Global List Variable</strong></h5>
<p class="noindent">We’ll use a global list variable to store the telephone numbers in <span class="literal">NumberPicker</span> by creating and initializing the <span class="literal">phoneNumbers</span> variable.</p>
<div class="image"><img alt="Image" src="../images/f0088-01.jpg"/></div>
<p class="indent">Click the <strong>Variables</strong> block drawer and drag an <span class="codestrong">initialize global name</span> block <span class="ent">➊</span> to the Viewer, click <span class="codestrong">name</span>, and replace it with <span class="codestrong">phoneNumbers</span>. Then drag a <span class="codestrong">make a list</span> block <span class="ent">➋</span> from the Lists drawer and snap it to the right side of the <span class="codestrong">initialize global phoneNumbers</span> block.</p>
<p class="indent">Now, in order to add three telephone numbers to the list, we need to add another list item input to the <span class="literal">make a list</span> block’s two default inputs. Click the blue mutator icon to the left of the words <span class="literal">make a list</span>, and drag one additional <span class="codestrong">item</span> block to the <span class="codestrong">make a list</span> block in the dialog that opens.</p>
<p class="indent">Then, drag three empty string blocks <span class="ent">➌</span> from the Text drawer and snap them into the sockets of the <span class="codestrong">make a list</span> block. Enter a telephone number into each empty string block, without any dashes or spaces (if you don’t have a phone number for any of the empty strings, enter <span class="codestrong">1111111</span>). Together, these blocks create the global <span class="literal">phoneNumbers</span> variable, which we can use in all our event handlers.</p>
<h5 class="h5" id="ch00lev3sec54"><strong>Handling NumberPicker’s BeforePicking Event</strong></h5>
<p class="noindent">Now that we’ve created <span class="literal">phoneNumbers</span>, we have the data we need for <span class="literal">NumberPicker</span>. Before the user selects from <span class="literal">NumberPicker</span>, we want the app to set the choices that the user will see in <span class="literal">NumberPicker</span> to the items in <span class="literal">phoneNumbers</span>. Then, after the user selects a number, we want <span class="literal">NumberPicker</span> to disappear, replaced by <span class="literal">PlacePicker</span>. Here are the event handlers that we need for step 1.</p>
<div class="image"><img alt="Image" src="../images/f0088-02.jpg"/></div>
<p class="indent">In the Blocks pane, click <span class="codestrong">NumberPicker</span> and drag the <span class="codestrong">whenNumberPicker.BeforePicking</span> event handler block <span class="ent">➊</span> to the Viewer. Then, click <span class="codestrong">NumberPicker</span> again and drag its <span class="codestrong">setNumberPicker.Elementsto</span> block <span class="ent">➋</span> next to the word <span class="literal">do</span>. Next, in the Blocks pane, click the <strong>Variables</strong> blocks drawer and drag the <span class="codestrong">get global</span> <span epub:type="pagebreak" id="page_89"/><span class="codestrong">phoneNumbers</span> block <span class="ent">➌</span> to the right of the <span class="codestrong">setNumberPicker.Elementsto</span> block. These three blocks create the <span class="literal">BeforePicking</span> event handler, which sets the telephone number choices that the user will see in <span class="literal">NumberPicker</span> to the telephone numbers in the <span class="literal">phoneNumbers</span> variable. Next we’ll create the handler for the <span class="literal">AfterPicking</span> event.</p>
<h5 class="h5" id="ch00lev3sec55"><strong>Handling NumberPicker’s AfterPicking Event</strong></h5>
<p class="noindent">To replace <span class="literal">NumberPicker</span> with <span class="literal">PlacePicker</span> after the user chooses a telephone number in <span class="literal">NumberPicker</span>, drag the <span class="codestrong">whenNumberPicker.AfterPicking</span> event handler block <span class="ent">➍</span> to the Viewer. Then, drag the <span class="codestrong">setNumberPicker.Visibleto</span> block <span class="ent">➎</span> next to the word <span class="literal">do</span>. Next, click the <strong>Logic</strong> blocks drawer and snap the <span class="codestrong">false</span> block <span class="ent">➏</span> to the right of the <span class="codestrong">setNumberPicker.Visibleto</span> block. Then, click <span class="codestrong">PlacePicker</span> in the Blocks pane and place the <span class="codestrong">setPlacePicker.Visibleto</span> block <span class="ent">➐</span> under the <span class="literal">setNumberPicker.Visibleto</span> block. Finally, click the <strong>Logic</strong> blocks drawer again and snap the <span class="codestrong">true</span> block <span class="ent">➑</span> to the right of the <span class="literal">setPlacePicker.Visibleto</span> block.</p>
<p class="indent">To see how the blocks for step 1 work, live-test with a phone, as outlined in “Live-Testing Your Apps” on <a href="intro.xhtml#page_xxii">page xxii</a>. Once you click <strong>Connect</strong> <span class="ent">▸</span> <strong>AI Companion</strong> in the top menu bar and scan the QR code with your phone’s AI2 Companion app, your “Beat the Bus” app should open on your phone. As long as the blocks are placed as shown, under the app’s title image, you should see the <span class="literal">Map</span> with the <span class="literal">Marker</span> pointing to the latitude and longitude you set in the Properties pane in the Designer. You may also see a user icon located at your current location, if your location and the <span class="literal">Marker</span> point are both visible at the <span class="literal">Map</span>’s zoom level.</p>
<p class="indent">Below the map, you should see <span class="literal">NumberPicker</span>. When you click it, the list of numbers in your <span class="literal">phoneNumbers</span> variable should appear, and, after you select one, <span class="literal">NumberPicker</span> should disappear and <span class="literal">PlacePicker</span> should appear. That’s all that should happen for now. Leave the app open on your phone to keep live-testing.</p>
<h4 class="h4" id="ch00lev2sec35"><strong>STEP 2: CHOOSING THE DESTINATION</strong></h4>
<p class="noindent">In step 2, to code the <span class="literal">BeforePicking</span> event for the <span class="literal">PlacePicker</span>, we’ll need to create a new global list variable called <span class="literal">places</span> to store the location choices we’ll display to the user. We’ll also create two related global list variables: <span class="literal">placeLats</span>, which will hold the latitudes for the destination options, and <span class="literal">placeLongs</span>, which will hold the longitudes.</p>
<div class="image"><img alt="Image" src="../images/f0089-01.jpg"/></div>
<p class="indent"><span epub:type="pagebreak" id="page_90"/>By creating these as global variables, we can use them in the <span class="literal">BeforePicking</span> event handler for <span class="literal">PlacePicker</span> and in all other handlers in the app to access the name, latitude, and longitude for the user’s selected location.</p>
<h5 class="h5" id="ch00lev3sec56"><strong>Creating Additional Global List Variables</strong></h5>
<p class="noindent">For each variable, click the <strong>Variables</strong> block drawer and drag an <span class="codestrong">initialize global name</span> block <span class="ent">➊</span> to the Viewer, click <span class="codestrong">name</span>, and replace it with the variable name. Then drag a <span class="codestrong">make a list</span> block <span class="ent">➋</span> from the Lists drawer and snap it to the right side of the <span class="codestrong">initialize global</span> block. Finally, drag two empty string blocks <span class="ent">➌</span> from the Text drawer and snap them into the sockets of the <span class="codestrong">make a list</span> block, and enter data into each empty string block.</p>
<p class="indent">When you enter the data for <span class="literal">placeLats</span> and <span class="literal">placeLongs</span>, be sure that you place the coordinate values in the same positions as their corresponding item in the <span class="literal">places</span> variable. For example, the first value you enter for <span class="literal">placeLats</span> should be the latitude of the first value in your <span class="literal">places</span> variable, which is <span class="literal">home</span> in this list. The first value you enter for <span class="literal">placeLongs</span> should be the longitude of the first value in your <span class="literal">places</span> variable. Likewise, the second value you enter into <span class="literal">placeLats</span> must be the latitude for the second value in your <span class="literal">places</span> variable (<span class="literal">coding class</span> in this list), and the second value you enter into <span class="literal">placeLongs</span> should be the longitude for the second value in <span class="literal">places</span>.</p>
<h5 class="h5" id="ch00lev3sec57"><strong>Handling PlacePicker’s BeforePicking Event</strong></h5>
<p class="noindent">Now that we’ve created <span class="literal">places</span>, we have the data we need for <span class="literal">PlacePicker</span>. Before the user can select from <span class="literal">PlacePicker</span>, we want the app to set the choices that the user will see to the items in <span class="literal">places</span>. The <span class="literal">PlacePicker BeforePicking</span> event handler does this.</p>
<div class="image"><img alt="Image" src="../images/f0090-01.jpg"/></div>
<p class="indent">In the Blocks pane, click <span class="codestrong">PlacePicker</span> and drag the <span class="codestrong">whenPlacePicker.BeforePicking</span> event handler block <span class="ent">➊</span> to the Viewer. Then, click <span class="codestrong">PlacePicker</span> again and drag its <span class="codestrong">setPlacePicker.Elementsto</span> block <span class="ent">➋</span> next to the word <span class="literal">do</span>. Next, in the Blocks pane, click the <strong>Variables</strong> blocks drawer and drag the <span class="codestrong">get global places</span> block <span class="ent">➌</span> to the right of the <span class="codestrong">setPlacePicker.Elementsto</span> block. Those three blocks create the <span class="literal">BeforePicking</span> event handler, which sets the destination choices that the user will see in <span class="literal">PlacePicker</span> to the items in the <span class="literal">places</span> variable.</p>
<p class="indent">To see how these new blocks work, live-test again. If the blocks are placed as shown, once you choose a number and <span class="literal">NumberPicker</span> disappears, you should see <span class="literal">PlacePicker</span>. When you click it, the list of destinations in your <span class="literal">places</span> variable should appear, and, after you select one, nothing else should happen for now.</p>
<h4 class="h4" id="ch00lev2sec36"><span epub:type="pagebreak" id="page_91"/><strong>STEP 3: STARTING LOCATION TRACKING</strong></h4>
<p class="noindent">Let’s now program the <span class="literal">PlacePicker AfterPicking</span> event handler.</p>
<div class="image"><img alt="Image" src="../images/f0091-01.jpg"/></div>
<p class="indent">These blocks make <span class="literal">PlacePicker</span> disappear, move the <span class="literal">Marker</span> to the user’s selected destination, and center the <span class="literal">Map</span> at that location. They also tell the app to text the user’s starting location and destination to the selected phone number.</p>
<h5 class="h5" id="ch00lev3sec58"><strong>Making PlacePicker Disappear</strong></h5>
<p class="noindent">In the Blocks pane, click <span class="codestrong">PlacePicker</span> and drag the <span class="codestrong">whenPlacePicker.AfterPicking</span> event handler block <span class="ent">➊</span> to the Viewer. Then, click <span class="codestrong">PlacePicker</span> again and drag its <span class="codestrong">setPlacePicker.Visibleto</span> block <span class="ent">➋</span> next to the word <span class="literal">do</span>. Next, in the Blocks pane, click the <strong>Logic</strong> blocks drawer, drag the <span class="codestrong">false</span> block <span class="ent">➌</span> to the Viewer, and snap it to the right of the <span class="codestrong">setPlacePicker.Visibleto</span> block. These blocks make <span class="literal">PlacePicker</span> disappear after the user chooses a destination.</p>
<h5 class="h5" id="ch00lev3sec59"><strong>Resetting the Map Marker Location</strong></h5>
<p class="noindent">Now we’ll add the blocks that set the location of the <span class="literal">Marker</span> to the destination selected by the user. In the Blocks pane, click <span class="codestrong">Marker1</span>, drag the <span class="codestrong">callMarker1.SetLocation</span> method block <span class="ent">➍</span> to the Viewer, and snap it inside the <span class="codestrong">whenPlacePicker.AfterPicking</span> block under the <span class="literal">setPlacePicker.Visibleto</span> block. The <span class="literal">Marker1 SetLocation</span> method requires arguments for two parameters, <span class="literal">latitude</span> and <span class="literal">longitude</span>, and will set <span class="literal">Marker1</span> on the <span class="literal">Map</span> to the location at the latitude and <span epub:type="pagebreak" id="page_92"/>longitude values provided. We want those values to be the latitude and longitude for the destination chosen by the user in <span class="literal">PlacePicker</span>, which we get from the <span class="literal">placeLats</span> and <span class="literal">placeLongs</span> variables.</p>
<h5 class="h5" id="ch00lev3sec60"><strong>Setting the Map Marker Latitude and Longitude</strong></h5>
<p class="noindent">Let’s take a closer look at the blocks in the <span class="literal">AfterPicking</span> event handler that set the <span class="literal">latitude</span> and <span class="literal">longitude</span> parameter arguments for the <span class="literal">Marker1 SetLocation</span> method to the latitude and longitude for the user’s destination.</p>
<div class="image"><img alt="Image" src="../images/f0092-01.jpg"/></div>
<p class="indent">Click the <strong>Lists</strong> blocks drawer, drag a <span class="codestrong">select list item</span> block <span class="ent">➊</span> to the Viewer, and snap it to the right of the <span class="codestrong">callMarker1.SetLocation</span> block, next to the word <span class="literal">latitude</span>. The <span class="literal">select list item</span> block requires arguments for <span class="literal">list</span> and <span class="literal">index</span>, and then, from the <span class="literal">list</span> provided, will select the item at the specified <span class="literal">index</span> position.</p>
<p class="indent">To provide those arguments, click the <strong>Variables</strong> blocks drawer and drag the <span class="codestrong">get global placeLats</span> block <span class="ent">➋</span> to the right of the <span class="codestrong">select list item</span> block next to the word <span class="literal">list</span>. Then click <span class="codestrong">PlacePicker</span> and drag the <span class="codestrong">PlacePicker.SelectionIndex</span> block <span class="ent">➌</span> next to the word <span class="literal">index</span>.</p>
<p class="indent">These blocks set the <span class="literal">list</span> argument for the <span class="literal">select list item</span> block to the <span class="literal">placeLats</span> variable and the <span class="literal">index</span> argument to <span class="literal">PlacePicker.SelectionIndex</span> (the index of the item the user selected in the related <span class="literal">PlacePicker</span>, which pulls its data from the <span class="literal">places</span> variable). For instance, if the user chose <span class="literal">home</span> as the destination, <span class="literal">PlacePicker.SelectionIndex</span> would equal <span class="literal">1</span>, since <span class="literal">home</span> is the first element in <span class="literal">PlacePicker</span> from the <span class="literal">places</span> variable. If the user selected <span class="literal">coding class</span>, <span class="literal">PlacePicker.SelectionIndex</span> would equal 2. Altogether, these blocks set the latitude for <span class="literal">Marker1</span> to the latitude listed in the <span class="literal">placeLats</span> variable at the <span class="literal">PlacePicker.SelectionIndex</span> position, which is the latitude for the user’s selected destination.</p>
<p class="indent">To set the longitude for <span class="literal">Marker1</span>, copy the blocks at <span class="ent">➊</span>, <span class="ent">➋</span>, and <span class="ent">➌</span> and snap the copy to the right of the <span class="codestrong">callMarker1.SetLocation</span> block, next to the word <span class="literal">longitude</span> <span class="ent">➍</span>. Then change the <span class="codestrong">list</span> argument in the duplicate blocks by clicking the drop-down arrow next to <span class="codestrong">get global placeLats</span> and selecting <span class="codestrong">get global placeLongs</span> <span class="ent">➎</span>. These blocks set the longitude for <span class="literal">Marker1</span> to the longitude value listed in the <span class="literal">placeLongs</span> variable at the <span class="literal">PlacePicker.SelectionIndex</span> position. The app will use this longitude and the latitude we just set to move <span class="literal">Marker1</span> to the destination selected by the user.</p>
<h5 class="h5" id="ch00lev3sec61"><strong>Re-centering the Map</strong></h5>
<p class="noindent">Now let’s add the blocks to re-center the <span class="literal">Map</span> to the same location—the selected destination.</p>
<div class="image"><span epub:type="pagebreak" id="page_93"/><img alt="Image" src="../images/f0093-01.jpg"/></div>
<p class="indent">In the Blocks pane, click <span class="codestrong">Map1</span>, drag the <span class="codestrong">setMap1.CenterFromStringto</span> block <span class="ent">➊</span> to the Viewer, and snap it inside the <span class="codestrong">whenPlacePicker.AfterPicking</span> block under the <span class="literal">callMarker1.SetLocation</span> method block. Then, click the <strong>Text</strong> blocks drawer and drag a <span class="codestrong">join</span> block <span class="ent">➋</span> to the Viewer. Add an input to it by clicking the blue mutator icon to the left of the word <span class="literal">join</span> and dragging one additional string block to the <span class="codestrong">join</span> block in the dialog that opens.</p>
<p class="indent">Next, for the <span class="literal">join</span> block’s top input, click <span class="codestrong">Marker1</span> in the Blocks pane and drag in the <span class="codestrong">Marker1.Latitude</span> block <span class="ent">➌</span>. For the <span class="literal">join</span> block’s second input, drag in an empty string block <span class="ent">➍</span> from the <strong>Text</strong> blocks drawer, click the string block’s text area, and enter <span class="codestrong">,</span> . Then, for the <span class="literal">join</span> block’s bottom input, click <span class="codestrong">Marker1</span> in the Blocks pane drawer again and drag in the <span class="codestrong">Marker1.Longitude</span> block <span class="ent">➎</span>. After the user picks a destination, these blocks center the <span class="literal">Map</span> to <span class="literal">Marker1</span>’s latitude and longitude, which are the coordinates for the destination the user selected in <span class="literal">PlacePicker</span>.</p>
<h5 class="h5" id="ch00lev3sec62"><strong>Texting the Selected Phone Number</strong></h5>
<p class="noindent">The last action we need to program for step 3 is the texting. After the user selects a destination, we want the app to text the destination and the user’s current location to the phone number the user chose. The following blocks in the <span class="literal">AfterPicking</span> event handler set the <span class="literal">PhoneNumber</span> for <span class="literal">Texting1</span>.</p>
<div class="image"><img alt="Image" src="../images/f0093-02.jpg"/></div>
<p class="indent">Click <span class="codestrong">Texting1</span> in the Blocks pane, drag the <span class="codestrong">setTexting1.PhoneNumberto</span> block <span class="ent">➊</span> to the Viewer, and snap it inside the <span class="codestrong">whenPlacePicker.AfterPicking</span> block under the <span class="literal">setMap1.CenterFromStringto</span> block. Then click <span class="codestrong">NumberPicker</span> and drag the <span class="codestrong">NumberPicker.Selection</span> block <span class="ent">➋</span> to the Viewer to the right of the <span class="codestrong">setTexting1.PhoneNumberto</span> block. These blocks set the required phone number for <span class="literal">Texting1</span> to the number selected by the user from the <span class="literal">NumberPicker</span> drop-down list.</p>
<h5 class="h5" id="ch00lev3sec63"><strong>Deciding the Message to Send</strong></h5>
<p class="noindent">Now we need to add the conditional blocks that set the message for <span class="literal">Texting1</span> to send. That message will consist of one statement if the app has received the user’s current longitude and latitude and another statement if the app has not yet received those coordinates. The next blocks in the <span class="literal">AfterPicking</span> event handler set the message.</p>
<div class="image"><span epub:type="pagebreak" id="page_94"/><img alt="Image" src="../images/f0094-01.jpg"/></div>
<p class="indent">Click <span class="codestrong">Texting1</span> again, drag the <span class="codestrong">setTexting1.Messageto</span> block <span class="ent">➊</span> to the Viewer, and snap it inside the <span class="codestrong">whenPlacePicker.AfterPicking</span> block under the <span class="literal">setTexting1.PhoneNumberto</span> block.</p>
<p class="indent">Then, click the <strong>Control</strong> blocks drawer, drag an <span class="codestrong">if then else</span> block with a left plug <span class="ent">➋</span> to the Viewer, and snap it to the right of the <span class="codestrong">setTexting1.Messageto</span> block. The left plug indicates that this block is a <em>return block</em>, which means it returns a value after evaluating a condition rather than only executing commands like the <span class="literal">if then</span> blocks we’ve used before.</p>
<p class="indent">Here, the <span class="literal">if then else</span> block directs the app to evaluate a condition and return one of two joined strings to use for <span class="literal">Texting1</span>’s <span class="literal">Message</span>—either the value from the blocks in the <span class="literal">then</span> socket or the value from the blocks in the <span class="literal">else</span> socket. To provide the condition we want the app to evaluate, click the <strong>Logics</strong> blocks drawer and drag an <span class="codestrong">=</span> comparison block <span class="ent">➌</span> to the Viewer next to the word <span class="literal">if</span>. To fill the <span class="literal">=</span> comparison operator block’s left operand socket, click <span class="codestrong">LocationSensor1</span> in the Blocks pane and drag in its <span class="codestrong">LocationSensor1.HasLongitudeLatitude</span> block <span class="ent">➍</span>. Fill its right operand socket by clicking the <strong>Logic</strong> blocks drawer and dragging in the <span class="codestrong">true</span> block <span class="ent">➎</span>. So far, these blocks set the test condition for the app to evaluate in order to determine the message to text, which is whether <span class="literal">LocationSensor1</span> has gotten the user’s longitude and latitude.</p>
<h5 class="h5" id="ch00lev3sec64"><strong>Texting One Message If the App Knows the User’s Longitude and Latitude</strong></h5>
<p class="noindent">The next blocks tell the app the message to send if <span class="literal">LocationSensor1</span> has the user’s longitude and latitude, which means the test condition evaluates to <span class="literal">true</span>.</p>
<div class="image"><img alt="Image" src="../images/f0094-02.jpg"/></div>
<p class="indent">Click the <strong>Text</strong> blocks drawer and drag a <span class="codestrong">join</span> block <span class="ent">➊</span> to the Viewer to the right of the word <span class="literal">then</span> in the <span class="literal">if then else</span> block. Add two more inputs to the <span class="literal">join</span> block by clicking the blue mutator icon to the left of the word <span class="literal">join</span> and dragging two additional string blocks in the dialog that opens. For the <span class="literal">join</span> block’s top input, drag in an empty string block <span class="ent">➋</span> from the Text blocks drawer, click the string block’s text area, and enter <span class="codestrong">We are getting ready to leave from</span> (with a space after the word <span class="literal">from</span>).</p>
<p class="indent">For the <span class="literal">join</span> block’s second input, click <span class="codestrong">LocationSensor1</span> in the Blocks pane and drag in its <span class="codestrong">LocationSensor1.CurrentAddress</span> block <span class="ent">➌</span>. For the <span class="literal">join</span> <span epub:type="pagebreak" id="page_95"/>block’s third input, drag in an empty string block <span class="ent">➍</span> from the Text blocks drawer, click the string block’s text area, and enter <span class="codestrong">- on the way to</span> (with a space after the word <span class="literal">to</span>). Then, for the <span class="literal">join</span> block’s bottom input, click <span class="codestrong">PlacePicker</span> in the Blocks pane drawer and drag in its <span class="codestrong">PlacePicker.Selection</span> block <span class="ent">➎</span>. These blocks set the message for the app to send if the app’s <span class="literal">LocationSensor</span> has received the user’s longitude and latitude, which means the message will indicate the user’s destination and also include the user’s starting point—the current address.</p>
<h5 class="h5" id="ch00lev3sec65"><strong>Texting a Different Message If the App Doesn’t Know the User’s Longtitude and Latitude</strong></h5>
<p class="noindent">Next, we’ll add the blocks that dictate the message the app will text if <span class="literal">LocationSensor1</span> hasn’t yet received those coordinates, meaning the <span class="literal">if then else</span> test condition evaluates to <span class="literal">false</span>.</p>
<div class="image"><img alt="Image" src="../images/f0095-01.jpg"/></div>
<p class="indent">Click the <strong>Text</strong> blocks drawer and drag another <span class="codestrong">join</span> block <span class="ent">➊</span> to the Viewer to the right of the word <span class="literal">else</span> in the <span class="literal">if then else</span> block. For the <span class="literal">join</span> block’s top input, drag in an empty string block <span class="ent">➋</span> from the Text blocks drawer, click the string block’s text area, and enter <span class="codestrong">We are getting ready to leave for</span> (with a space after the word <span class="literal">for</span>).</p>
<p class="indent">For the <span class="literal">join</span> block’s bottom input, click <span class="codestrong">PlacePicker</span> in the Blocks pane drawer and drag in another <span class="codestrong">PlacePicker.Selection</span> block <span class="ent">➌</span>. These blocks set the message for the app to send to a statement that indicates the destination but does not include the user’s current address, since the app’s <span class="literal">LocationSensor</span> doesn’t yet know it.</p>
<h5 class="h5" id="ch00lev3sec66"><strong>Sending the First Text Message</strong></h5>
<p class="noindent">Finally, click <span class="codestrong">Texting1</span> again and drag its <span class="codestrong">callTexting1.SendMessageDirect</span> block into the <span class="codestrong">whenPlacePicker.AfterPicking</span> block under the <span class="literal">setTexting1.Messageto</span> block. This block sends the text message.</p>
<div class="image"><img alt="Image" src="../images/f0095-02.jpg"/></div>
<p class="indent">In plain English, the blocks for step 3 move the map <span class="literal">Marker</span> to the user’s selected destination, re-center the map, and then direct the app to decide the message to text based on whether <span class="literal">LocationSensor1</span> has retrieved the user’s current latitude and longitude. If it has, the app should send a message to the selected telephone number that includes the user’s current location and the destination. If not, the app sends a message that includes only the destination.</p>
<p class="indent">Use both your tester phone and the phone with the selected phone number to live-test these blocks. If you’ve placed the blocks exactly as shown, once you choose a number and <span class="literal">NumberPicker</span> disappears, you should see <span class="literal">PlacePicker</span>. When you click it, the list of destinations in your <span class="literal">places</span> variable should appear.</p>
<p class="indent"><span epub:type="pagebreak" id="page_96"/>After you select a destination, <span class="literal">PlacePicker</span> should disappear and your <span class="literal">Map</span> and <span class="literal">Marker</span> should shift to the selected destination’s latitude and longitude, if those properties are different from those you set in the Designer. Also, your phone should text a message to your selected number, as long as you have texting enabled on your phone. If anything’s not working as planned, take the time to debug before moving on. Then close the AI2 Companion app on your phone.</p>
<h4 class="h4" id="ch00lev2sec37"><strong>STEP 4: TRACKING THE JOURNEY</strong></h4>
<p class="noindent">Let’s now program step 4 so that the app texts the user’s location to the selected phone number periodically as the user travels the route, but only when the user is less than or equal to 5 miles away from the selected destination. This means that we’ll need to use another conditional to check whether the user’s current location is within 5 miles of the chosen location. Use the following <span class="literal">LocationChanged</span> event handler blocks.</p>
<div class="image"><img alt="Image" src="../images/f0096-01.jpg"/></div>
<p class="indent">Click <span class="codestrong">LocationSensor1</span> in the Blocks pane and drag the <span class="codestrong">whenLocationSensor1.LocationChanged</span> block <span class="ent">➊</span> to the Viewer. You’ll notice that this <span class="literal">LocationChanged</span> event handler provides arguments for four event parameters when the app’s location changes: the new location’s <span class="literal">latitude</span>, <span class="literal">longitude</span>, <span class="literal">altitude</span>, and <span class="literal">speed</span>. These parameters are local in scope, meaning we can use their values only in the event handler in which they’re created, just like the local variable we’ll create in the next section.</p>
<h5 class="h5" id="ch00lev3sec67"><strong>Creating a Local distance Variable</strong></h5>
<p class="noindent">To simplify the code, we’ll use the arguments provided for the <span class="literal">LocationChanged</span> event handler parameters to create a local variable, <span class="literal">distance</span>, to hold the value of the app’s current distance from <span class="literal">Marker1</span>, which we’ve positioned on the <span class="literal">Map</span> at the user’s selected destination. Since <span class="literal">distance</span> is a local variable, we can use it in this event handler only.</p>
<p class="indent">Click the <strong>Variables</strong> blocks drawer and drag the <span class="codestrong">initialize local name to</span> block <span class="ent">➋</span> to the right of the <span class="codestrong">whenLocationSensor1.LocationChanged</span> block next <span epub:type="pagebreak" id="page_97"/>to the word <span class="literal">do</span>. Click <span class="codestrong">name</span> in the <span class="codestrong">initialize local name to</span> block and replace it with <span class="codestrong">distance</span>. Then click <span class="codestrong">Marker1</span> and snap its <span class="codestrong">callMarker1.DistanceToPoint</span> method block <span class="ent">➌</span> to the right of the <span class="codestrong">initialize local distance to</span> block. To fill the method block’s required <span class="literal">latitude</span> and <span class="literal">longitude</span> parameter sockets, mouse over the <span class="codestrong">latitude</span> event parameter above the word <span class="literal">do</span> and drag the <span class="codestrong">get latitude</span> block <span class="ent">➍</span> into the method’s <span class="literal">latitude</span> socket; then, mouse over the <span class="codestrong">longitude</span> event parameter above the word <span class="literal">do</span> and drag the <span class="codestrong">get longitude</span> block <span class="ent">➎</span> into the method’s <span class="literal">longitude</span> socket.</p>
<p class="indent">Now that we’ve created <span class="literal">distance</span>, we can use it in this event handler wherever we need to refer to the app’s current distance from the user’s selected destination.</p>
<p class="indent">Next, let’s direct the app to text information about the user’s location only if <span class="literal">distance</span> is less than or equal to 5 miles.</p>
<h5 class="h5" id="ch00lev3sec68"><strong>Deciding Whether to Text Current Distance</strong></h5>
<p class="noindent">To test whether <span class="literal">distance</span> is less than or equal to 5 miles, we need to set another test condition using the following blocks.</p>
<div class="image"><img alt="Image" src="../images/f0097-01.jpg"/></div>
<p class="indent">Click the <strong>Control</strong> blocks drawer and drag an <span class="codestrong">if then</span> block <span class="ent">➊</span> inside the <span class="codestrong">initialize local distance to</span> block under the <span class="literal">callMarker1.DistanceToPoint</span> block. Now click the <strong>Math</strong> blocks drawer, drag an <span class="codestrong">=</span> comparison operator block <span class="ent">➋</span> to the Viewer next to the word <span class="literal">if</span>, and turn <span class="literal">=</span> into a <span class="literal">≤</span> comparison block by clicking the drop-down arrow to the right of the equal sign and selecting the less than or equal sign.</p>
<p class="indent">To fill the <span class="literal">≤</span> comparison block’s left operand socket, mouse over the local <span class="codestrong">distance</span> variable and drag in its <span class="codestrong">get distance</span> block <span class="ent">➌</span>. To fill the <span class="literal">≤</span> comparison block’s right operand socket, click the <strong>Math</strong> blocks drawer, drag in a <span class="codestrong">8046.72</span> number block <span class="ent">➍</span> for the metric equivalent to 5 miles. This code sets the test condition that determines whether the user is less than or equal to 5 miles away from the selected destination. The condition must evaluate to <span class="literal">true</span> in order for the app to send a text message in this step.</p>
<h5 class="h5" id="ch00lev3sec69"><strong>Setting and Sending Text Messages Along the Route</strong></h5>
<p class="noindent">The next blocks set the text of the message for the app to send if our test condition is met—that is, the user is less than or equal to 5 miles from the selected destination.</p>
<div class="image"><img alt="Image" src="../images/f0097-02.jpg"/></div>
<p class="indent"><span epub:type="pagebreak" id="page_98"/>Click <strong>Texting1</strong> and drag its <span class="codestrong">setTexting1.Messageto</span> block <span class="ent">➊</span> into the <span class="codestrong">if then</span> block next to the word <span class="literal">then</span>. Now, click the <strong>Text</strong> blocks drawer and drag a <span class="codestrong">join</span> block <span class="ent">➋</span> to the Viewer to the right of the <span class="literal">setTexting1.Messageto</span> block. Add two more inputs to it by clicking the blue mutator icon to the left of the word <span class="literal">join</span> and dragging two additional string blocks to the <span class="literal">join</span> block in the dialog that opens. For the <span class="literal">join</span> block’s top input, drag in an empty string block <span class="ent">➌</span> from the Text blocks drawer, click the string block’s text area, and enter <span class="codestrong">I am</span> (including a space after the word <span class="literal">am</span>).</p>
<p class="indent">For the <span class="literal">join</span> block’s second input, drag in a <span class="codestrong">format as decimal</span> block <span class="ent">➍</span> from the Math drawer and fill its <span class="codestrong">number</span> socket by dragging in a division operation block <span class="ent">➎</span>, also from the Math drawer. Mouse over <span class="codestrong">distance</span> to drag its <span class="codestrong">get distance</span> block <span class="ent">➏</span> into the division block’s left operand socket. Then, drag a <span class="codestrong">1609.344</span> number block <span class="ent">➐</span> into the division block’s right operand socket for the metric equivalent to 1 mile. Finally, fill the <span class="codestrong">format as decimal number</span> block’s <span class="codestrong">places</span> socket with a <span class="codestrong">2</span> number block <span class="ent">➑</span> from the Math drawer. This second <span class="literal">join</span> block input computes the user’s distance in miles, presents it as a decimal number with two decimal places, and adds it to the text message the app will send. Since App Inventor calculates distances in meters, we’re converting it to miles for users in the US.</p>
<p class="indent">Next, fill the <span class="literal">join</span> block’s third input with another empty string block <span class="ent">➒</span> from the Text blocks drawer, click the string block’s text area, and enter <span class="codestrong">miles from</span> (including a space before the word <span class="literal">miles</span> and after the word <span class="literal">from</span>). Then, for the <span class="literal">join</span> block’s bottom input, click <span class="codestrong">PlacePicker</span> in the Blocks pane and drag in its <span class="codestrong">PlacePicker.Selection</span> block <span class="ent">➓</span>.</p>
<p class="indent">Finally, click <span class="codestrong">Texting1</span> again, and drag its <span class="codestrong">callTexting1.SendMessageDirect</span> block into the <span class="codestrong">if then</span> block under the <span class="literal">setTexting1.Messageto</span> block to send the message. These blocks set the text message to “I am [<em>x.xx</em>] miles from [<em>selected destination</em>]” and send it to the phone number the user selected.</p>
<p class="indent">Now, altogether, the blocks for step 4 tell the app to text the user’s location to the selected phone number periodically as the user is en route, but only if the user is less than or equal to 5 miles away from the destination.</p>
<p class="indent">Now we can test the completed app! To do so, you need to build the app and install it so you can run it as you are moving along the route. For testing, you can install the app on your phone quickly after creating a temporary QR code that you can scan with your phone’s AI2 Companion app.</p>
<div class="note">
<p class="notet"><span class="noteh2"><strong>WARNING</strong></span></p>
<p class="notep"><em>Please do not try to test this app while you are driving. If you test in a vehicle, have someone else drive so that you can safely operate and monitor the two phones. You also can test the app while walking.</em></p>
</div>
<p class="indent">With the app project open on your computer screen, click <strong>Build</strong> <span class="ent">▸</span> <strong>App ( provide QR code for .apk )</strong> in the top menu bar, as shown in <a href="ch05.xhtml#ch5fig2">Figure 5-2</a>.</p>
<div class="image" id="ch5fig2"><span epub:type="pagebreak" id="page_99"/><img alt="Image" src="../images/05fig02.jpg"/></div>
<p class="figcap"><em>Figure 5-2: The Build menu link that creates the QR code you can scan to install the app</em></p>
<p class="indent">You should see a progress bar showing that the QR code is being generated. Once the code is ready, you should see a small window containing a temporary QR code link to your app’s source file. Scan the code with the AI2 Companion app on your phone and click <strong>OK</strong> to close the small window.</p>
<p class="indent">Note that since “Beat the Bus” is a nonmarket app, you’ll first need to make sure your phone’s settings allow installation of applications from “Unknown Sources.” When you install the app, be sure to allow it to receive text messages and access approximate location, precise location, and extra location provider commands.</p>
<p class="indent">Once you’ve installed and opened the app, you should see the <span class="literal">Map</span> with the <span class="literal">Marker</span> pointing to the latitude and longitude you set in the Properties pane in the Designer. You may also see a user icon located at your current location, if your location and the <span class="literal">Marker</span> are both visible at the <span class="literal">Map</span>’s zoom level.</p>
<p class="indent">You should also see <span class="literal">NumberPicker</span>, which should disappear after you click it and choose a number. Then you should see <span class="literal">PlacePicker</span>, which will disappear after you click it and select a destination. Next, your <span class="literal">Map</span> and <span class="literal">Marker</span> should shift to the selected destination’s latitude and longitude, if those properties are different from those you set in the Designer. The app should also text a message to your selected number.</p>
<p class="indent">As you travel along, you should see the user icon move occasionally on the <span class="literal">Map</span>, and when you get within 5 miles of your destination, the app should text periodic messages to your selected number until you close the app.</p>
<p class="indent">You may notice that, although you’ve set <span class="literal">LocationSensor1</span> to check for location changes every second, the app may not send a message each second. According to the App Inventor documentation, the <span class="literal">LocationSensor</span> component receives location updates only when the location of the phone actually changes, and the chosen time interval is not guaranteed. Nonetheless, your selected phone number should receive several messages between the time you reach the 5-mile mark and arrive at the destination. Note that, if you feel the messages are coming in too frequently, you can increase the <span class="literal">LocationSensor</span>’s <span class="literal">TimeInterval</span> in the Designer.</p>
<p class="indent">If anything’s not working as planned, take time to debug. If you make any changes, you’ll need to reinstall the app to test them. If you placed the blocks correctly, the app should work as expected. You’ve successfully created the “Beat the Bus” tracking app!</p>
<h3 class="h3" id="ch00lev1sec38"><span epub:type="pagebreak" id="page_100"/><strong>SUMMARY</strong></h3>
<p class="noindent">In this chapter, you built the “Beat the Bus” app, which uses App Inventor’s exciting <span class="literal">LocationSensor</span>, <span class="literal">Texting</span>, and <span class="literal">Maps</span> components along with <span class="literal">ListPicker</span>s to allow others to track your location, without using the power-draining location services on their phone. While building this app, you learned how to create list variables that can hold multiple values and local variables that can make your code more efficient. You also continued to use the programming selection control structure to direct the app’s flow.</p>
<p class="indent">In <a href="ch06.xhtml#ch06">Chapter 6</a>, you’ll learn how to use App Inventor’s built-in Control and Logic blocks to control an app’s flow using the repetitive program structure. We’ll use more lists with that structure as we create the “Tic Tac Toe” game app, which allows users to play the classic two-person game and keeps track of the players’ turns.</p>
<h3 class="h3" id="ch00lev1sec39"><strong>ON YOUR OWN</strong></h3>
<p class="noindent">Save new versions of “Beat the Bus” as you modify and extend it for the following exercises. You can find solutions online at <em><a href="https://nostarch.com/programwithappinventor/">https://nostarch.com/programwithappinventor/</a></em>.</p>
<ol>
<li><p class="noindent">Change the app so that it also provides the destination street address in all text messages sent and retrieves that information from a list variable.</p></li>
<li><p class="noindent">Change the app so that it requires users to enter the destination instead of choosing it from the preset list.</p></li>
<li><p class="noindent">Extend the app for Android devices so that the app responds to specific text messages from the selected number by texting the user’s current location at that time. How will your algorithm change? What components and blocks will you need to add and modify?</p></li>
</ol>
</body></html>