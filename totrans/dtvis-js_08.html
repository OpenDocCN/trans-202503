<html><head></head><body><section class="chapter" title="Chapter&#xA0;8.&#xA0;Managing Data in the Browser" epub:type="chapter" id="managing_data_in_the_browser"><div class="titlepage"><div><div><h2 class="title">Chapter 8. Managing Data in the Browser</h2></div></div></div><p><a id="iddle1097" class="indexterm"/><a id="iddle1218" class="indexterm"/><a id="iddle1234" class="indexterm"/>So far in the book, we’ve looked at a lot of visual ization tools and techniques, but we haven’t spent much time considering the data part of data visualization. The emphasis on visualization is appropriate in many cases. Especially if the data is static, we can take all the time we need to clean and organize it before it’s even represented in JavaScript. But what if the data is dynamic and we have no <a id="iddle1238" class="indexterm"/><a id="iddle1408" class="indexterm"/><a id="iddle2088" class="indexterm"/>choice but to import the raw source directly into our JavaScript application? We have much less control over data from third-party REST APIs, Google Docs spreadsheets, or automatically generated CSV files. With those types of data sources, we often need to validate, reformat, recalculate, or otherwise manipulate the data in the browser.</p><p>This chapter considers a JavaScript library that is particularly helpful for managing large data sets in the web browser: Underscore.js (<span class="emphasis"><em><a class="ulink" href="http://underscorejs.org/" target="_top">http://underscorejs.org/</a></em></span>). We’ll cover the following aspects of Underscore.js:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Functional programming, the programming style that Underscore.js encourages</p></li><li class="listitem"><p>Working with simple arrays using Underscore.js utilities</p></li><li class="listitem"><p>Enhancing JavaScript objects</p></li><li class="listitem"><p>Manipulating collections of objects</p></li></ul></div><p>The format of this chapter differs from the other chapters in the book. Instead of covering a few examples of moderate complexity, we’ll look at a lot of simple, short examples. Each section collects several related examples together, but each of the short examples is independent. The first section differs even further. It’s a brief introduction to functional programming cast as a step-by-step migration from the more common imperative programming style. Understanding functional programming is very helpful, as its philosophy underlies almost all of the Underscore.js utilities.</p><p>This chapter serves as a tour of the Underscore.js library with a special focus on managing data. (As a concession to the book’s overall focus on data visualization, it also includes several illustrations.) We’ll see many of the Underscore.js utilities covered here at work in a larger web application project in the subsequent chapters.</p><div class="sect1" title="Using Functional Programming"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="using_functional_programming">Using Functional Programming</h2></div></div></div><p>When we’re working with data that’s part of a visualization, we often have to iterate through the data one item at a time to transform, extract, or otherwise manipulate it to fit our application. Using only the core JavaScript language, our code may rely on a <code class="literal">for</code> loop like the following:</p><a id="pro_id00425"/><pre class="programlisting"><span class="steelblue"><span class="strong"><strong>for</strong></span></span> (<span class="steelblue"><span class="strong"><strong>var</strong></span></span> i=<span class="red">0</span>, len=<span class="steelblue">data</span>.<span class="olive">length</span>; i&lt;len; i++) {
    <span class="indianred"><span class="emphasis"><em>// Code continues...</em></span></span>
}</pre><p>Although this style, known as <span class="emphasis"><em>imperative programming</em></span>, is a common JavaScript idiom, it can present a few problems in large, complex applications. In particular, it might result in code that’s harder than necessary to debug, test, and maintain. This section introduces a different programming style—<span class="emphasis"><em>functional programming</em></span>—that eliminates many of those problems. As you’ll see, functional programming can result in code that’s much more concise and readable, and therefore often much less error prone.</p><p><a id="iddle1239" class="indexterm"/><a id="iddle1333" class="indexterm"/><a id="iddle1337" class="indexterm"/><a id="iddle1409" class="indexterm"/>To compare these two programming styles, let’s consider a simple programming problem: writing a function to calculate the Fibonacci numbers. The first two Fibonacci numbers are 0 and 1, and subsequent numbers are the sum of the two preceding values. The sequence starts like this:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none"><p>0, 1, 1, 2, 3, 5, 8, 13, 21, 34, 55, 89, . . .</p></li></ul></div><div class="sect2" title="Step 1: Start with an Imperative Version"><div class="titlepage"><div><div><h3 class="title" id="step_1_start_with_an_imperative_version">Step 1: Start with an Imperative Version</h3></div></div></div><p>To begin, let’s consider a traditional, imperative approach to the problem. Here’s a first attempt:</p><a id="pro_id00426"/><pre class="programlisting"><span class="steelblue"><span class="strong"><strong>var</strong></span></span> fib = <span class="steelblue"><span class="strong"><strong>function</strong></span></span>(n) {
    <span class="indianred"><span class="emphasis"><em>// If 0th or 1st, just return n itself</em></span></span>
    <span class="steelblue"><span class="strong"><strong>if</strong></span></span> (n &lt; <span class="red">2</span>) <span class="steelblue"><span class="strong"><strong>return</strong></span></span> n;

    <span class="indianred"><span class="emphasis"><em>// Otherwise, initialize variable to compute result</em></span></span>
    <span class="steelblue"><span class="strong"><strong>var</strong></span></span> f0=<span class="red">0</span>, f1=<span class="red">1</span>, f=<span class="red">1</span>;

    <span class="indianred"><span class="emphasis"><em>// Iterate until we reach n</em></span></span>
    <span class="steelblue"><span class="strong"><strong>for</strong></span></span> (i=<span class="red">2</span>; i&lt;=n; i++) {

        <span class="indianred"><span class="emphasis"><em>// At each iteration, slide the intermediate</em></span></span>
        <span class="indianred"><span class="emphasis"><em>// values down a step</em></span></span>
        f0 = f1 = f;

        <span class="indianred"><span class="emphasis"><em>// And calculate sum for the next pass</em></span></span>
        f = f0 + f1;
    }

    <span class="indianred"><span class="emphasis"><em>// After all the iterations, return the result</em></span></span>
    <span class="steelblue"><span class="strong"><strong>return</strong></span></span> f;
}</pre><p>This <code class="literal">fib()</code> function takes as its input a parameter <span class="emphasis"><em>n</em></span> and returns as its output the <span class="emphasis"><em>n</em></span>th Fibonacci number. (By convention, the 0th and 1st Fibonacci numbers are 0 and 1.)</p></div><div class="sect2" title="Step 2: Debug the Imperative Code"><div class="titlepage"><div><div><h3 class="title" id="step_2_debug_the_imperative_code">Step 2: Debug the Imperative Code</h3></div></div></div><p>If you aren’t checking closely, you might be surprised to find that the preceding trivial example contains three bugs. Of course, it’s a contrived example and the bugs are deliberate, but can you find all of them without reading any further? More to the point, if even a trivial example can hide so many bugs, can you imagine what might be lurking in a complex web application?</p><p>To understand why imperative programming can introduce these bugs, let’s fix them one at a time.</p><p>One bug is in the <code class="literal">for</code> loop:</p><a id="pro_id00427"/><pre class="programlisting"><span class="steelblue"><span class="strong"><strong>for</strong></span></span> (i=<span class="red">2</span>; i&lt;=n; i++) {</pre><p>The conditional that determines the loop termination checks for a less-than-or-equal (<code class="literal">&lt;=</code>) value; instead, it should check for a less-than (<code class="literal">&lt;</code>) value.</p><p>A second bug occurs in this line:</p><a id="pro_id00428"/><pre class="programlisting">f0 = f1 = f;</pre><p>Although we think and read left to right (at least in English), JavaScript executes multiple assignments from right to left. Instead of shifting the values in our variables, this statement simply assigns the value of <code class="literal">f</code> to all three. We need to break the single statement into two:</p><a id="pro_id00429"/><pre class="programlisting">f0 = f1;
f1 = f;</pre><p>The final bug is the most subtle, and it’s also in the <code class="literal">for</code> loop. We’re using the local variable <code class="literal">i</code>, but we haven’t declared it. As a result, JavaScript will treat it as a global variable. That won’t cause our function to return incorrect results, but it could well introduce a conflict—and a hard-to-find bug—elsewhere in our application. The correct code declares the variable as local:</p><a id="pro_id00430"/><pre class="programlisting"><span class="steelblue"><span class="strong"><strong>for</strong></span></span> (<span class="steelblue"><span class="strong"><strong>var</strong></span></span> i=<span class="red">2</span>; i&lt;n; i++) {</pre></div><div class="sect2" title="Step 3: Understand the Problems Imperative Programming May Introduce"><div class="titlepage"><div><div><h3 class="title" id="step_3_understand_the_problems_imperativ">Step 3: Understand the Problems Imperative Programming May Introduce</h3></div></div></div><p>The bugs in this short and straightforward piece of code are meant to demonstrate some problematic features of imperative programming in general. In particular, conditional logic and state variables, by their very nature, tend to invite certain errors.</p><p>Consider the first bug. Its error was using an incorrect test (<code class="literal">&lt;=</code> instead of <code class="literal">&lt;</code>) for the conditional that terminates the loop. Precise conditional logic is critical for computer programs, but such precision doesn’t always come naturally to most people, including programmers. Conditional logic has to be perfect, and sometimes making it perfect is tricky.</p><p>The other two errors both relate to state variables, <code class="literal">f0</code> and <code class="literal">f1</code> in the first case and <code class="literal">i</code> in the second. Here again there’s a difference between how programmers think and how programs operate. When programmers write the code to iterate through the numbers, they’re probably concentrating on the specific problem at hand. It may be easy to neglect the potential effect on other areas of the application. More technically, state variables can introduce side effects into a program, and side effects may result in bugs.</p></div><div class="sect2" title="Step 4: Rewrite Using Functional Programming Style"><div class="titlepage"><div><div><h3 class="title" id="step_4_rewrite_using_functional_programm">Step 4: Rewrite Using Functional Programming Style</h3></div></div></div><p><a id="iddle1235" class="indexterm"/><a id="iddle1237" class="indexterm"/><a id="iddle1334" class="indexterm"/><a id="iddle1338" class="indexterm"/><a id="iddle1405" class="indexterm"/><a id="iddle1407" class="indexterm"/>Proponents of functional programming claim that by eliminating conditionals and state variables, a functional programming style can produce code that’s more concise, more maintainable, and less prone to errors than imperative programming.</p><p>The “functional” in “functional programming” does not refer to functions in programming languages but rather to mathematical functions such as <span class="emphasis"><em>y</em></span>=<span class="emphasis"><em>f</em></span>(<span class="emphasis"><em>x</em></span>). Functional programming attempts to emulate mathematical functions in the context of computer programming. Instead of iterating over values by using a <code class="literal">for</code> loop, functional programming often uses recursion, where a function calls itself multiple times to make a calculation or manipulate values.</p><p>Here’s how we can implement the Fibonacci algorithm with functional programming:</p><a id="pro_id00431"/><pre class="programlisting"><span class="steelblue"><span class="strong"><strong>var</strong></span></span> fib = <span class="steelblue"><span class="strong"><strong>function</strong></span></span>(n) { <span class="steelblue"><span class="strong"><strong>return</strong></span></span> n &lt; <span class="red">2</span> ? n : <span class="olive">fib</span>(n<span class="red">-1</span>) + <span class="olive">fib</span>(n<span class="red">-2</span>); }</pre><p>Notice that this version has no state variables and, except for the edge case to handle 0 or 1, no conditional statements. It’s much more concise, and notice how the code mirrors almost word-for-word the statement of the original problem: “The first two Fibonacci numbers are 0 and 1” corresponds to <code class="literal">n &lt; 2 ? n</code>, and “subsequent numbers are the sum of the two preceding values” corresponds to <code class="literal">fib(n-1) + fib(n-2)</code>.</p><p>Functional programming implementations often express the desired outcome directly. They can therefore minimize the chance of misinterpretations or errors in an intermediate algorithm.</p></div><div class="sect2" title="Step 5: Evaluate Performance"><div class="titlepage"><div><div><h3 class="title" id="step_5_evaluate_performance">Step 5: Evaluate Performance</h3></div></div></div><p>From what we’ve seen so far, it may seem that we should always adopt a functional programming style. Certainly functional programming has its advantages, but it can have some significant disadvantages as well. The Fibonacci code is a perfect example. Since functional programming eschews the notion of loops, our example relies instead on recursion.</p><p>In our specific case the <code class="literal">fib()</code> function calls itself twice at every level until the recursion reaches 0 or 1. Since each intermediate call itself results in more intermediate calls, the number of calls to <code class="literal">fib()</code> increases exponentially. Finding the 28th Fibonacci number by executing <code class="literal">fib(28)</code> results in over one million calls to the <code class="literal">fib()</code> function.</p><p>As you might imagine, the resulting performance is simply unacceptable. <a class="xref" href="ch08.html#execution_times_for_fibleft_parenthesisr" title="Table 8-1. Execution Times for fib()">Table 8-1</a> shows the execution times for both the functional and the imperative versions of <code class="literal">fib()</code>.</p><div class="table"><a id="execution_times_for_fibleft_parenthesisr"/><div class="table-title">Table 8-1. Execution Times for fib()</div><div class="table-contents"><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="c1"/><col class="c2"/><col class="c3"/></colgroup><thead><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Version</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Parameter</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Execution time (ms)</p></td></tr></thead><tbody><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Imperative</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><code class="literal">28</code></p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>0.231</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; "><p>Functional</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; "><p><code class="literal">28</code></p></td><td style="vertical-align: top; "><p>296.9</p></td></tr></tbody></table></div></div><p><a id="iddle1011" class="indexterm"/><a id="iddle1236" class="indexterm"/><a id="iddle1335" class="indexterm"/><a id="iddle1406" class="indexterm"/><a id="iddle1673" class="indexterm"/><a id="iddle2087" class="indexterm"/><a id="iddle2104" class="indexterm"/>As you can see, the functional programming version is over a thousand times slower. In the real world, such performance is rarely acceptable.</p></div><div class="sect2" title="Step 6: Fix the Performance Problem"><div class="titlepage"><div><div><h3 class="title" id="step_6_fix_the_performance_problem">Step 6: Fix the Performance Problem</h3></div></div></div><p>Fortunately, we can reap the benefits of functional programming without suffering the performance penalty. We simply turn to the tiny but powerful Underscore.js library. As the library’s web page explains,</p><div class="blockquote"><blockquote class="blockquote"><p>Underscore is a utility-belt library for JavaScript that provides . . . functional programming support.</p></blockquote></div><p>Of course, we need to include that library in our web pages. If you’re including libraries individually, Underscore.js is available on many content distribution networks, such as CloudFlare.</p><a id="pro_id00432"/><pre class="programlisting"><span class="dodgerblue">&lt;!DOCTYPE</span> html<span class="dodgerblue">&gt;</span>
<span class="steelblue"><span class="strong"><strong>&lt;html</strong></span></span> <span class="steelblue">lang=</span><span class="maroon">"en"</span><span class="steelblue"><span class="strong"><strong>&gt;</strong></span></span>
  <span class="steelblue"><span class="strong"><strong>&lt;head&gt;</strong></span></span>
    <span class="steelblue"><span class="strong"><strong>&lt;meta</strong></span></span> <span class="steelblue">charset=</span><span class="maroon">"utf-8"</span><span class="steelblue"><span class="strong"><strong>&gt;</strong></span></span>
    <span class="steelblue"><span class="strong"><strong>&lt;title&gt;&lt;/title&gt;</strong></span></span>
  <span class="steelblue"><span class="strong"><strong>&lt;/head&gt;</strong></span></span>
  <span class="steelblue"><span class="strong"><strong>&lt;body&gt;</strong></span></span>
    <span class="indianred"><span class="emphasis"><em>&lt;!-- Content goes here --&gt;</em></span></span>
    <span class="steelblue"><span class="strong"><strong>&lt;script</strong></span></span>
      <span class="steelblue">src=</span><span class="maroon">"//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.4.4/"+</span>
          <span class="maroon">"underscore-min.js"</span><span class="steelblue"><span class="strong"><strong>&gt;</strong></span></span>
    <span class="steelblue"><span class="strong"><strong>&lt;/script&gt;</strong></span></span>
  <span class="steelblue"><span class="strong"><strong>&lt;/body&gt;</strong></span></span>
<span class="steelblue"><span class="strong"><strong>&lt;/html&gt;</strong></span></span></pre><p>With Underscore.js in place, we can now optimize the performance of our Fibonacci implementation.</p><p>The problem with the recursive implementation is that it results in many unnecessary calls to <code class="literal">fib()</code>. For example, executing <code class="literal">fib(28)</code> requires more than 100,000 calls to <code class="literal">fib(3)</code>. And each time <code class="literal">fib(3)</code> is called, the return value is re calculated from scratch. It would be better if the implementation called <code class="literal">fib(3)</code> only once, and every subsequent time it needed to know the value of <code class="literal">fib(3)</code> it reused the previous result instead of recalculating it from scratch. In effect, we’d like to implement a cache in front of the <code class="literal">fib()</code> function. The cache could eliminate the repetitive calculations.</p><p>This approach is known as <span class="emphasis"><em>memoizing</em></span>, and the Underscore.js library has a simple method to automatically and transparently memoize JavaScript functions. Not surprisingly, that method is called <code class="literal">memoize()</code>. To use it, we first wrap the function we want to memoize within the Underscore object. Just as jQuery uses the dollar sign (<code class="literal">$</code>) for wrapping, Underscore.js uses the underscore character (<code class="literal">_</code>). <a id="iddle1049" class="indexterm"/><a id="iddle1052" class="indexterm"/><a id="iddle1220" class="indexterm"/><a id="iddle1223" class="indexterm"/><a id="iddle1336" class="indexterm"/><a id="iddle2090" class="indexterm"/><a id="iddle2093" class="indexterm"/>After wrapping our function, we simply call the <code class="literal">memoize()</code> method. Here’s the complete code:</p><a id="pro_id00433"/><pre class="programlisting"><span class="steelblue"><span class="strong"><strong>var</strong></span></span> fib = <span class="olive">_</span>( <span class="steelblue"><span class="strong"><strong>function</strong></span></span>(n) {
        <span class="steelblue"><span class="strong"><strong>return</strong></span></span> n &lt; <span class="red">2</span> ? n : <span class="olive">fib</span>(n<span class="red">-1</span>) + <span class="olive">fib</span>(n<span class="red">-2</span>);
    } ).<span class="olive">memoize</span>()</pre><p>As you can see, we haven’t really lost any of the readability or conciseness of functional programming. And it would still be a challenge to introduce a bug in this implementation. The only real change is performance, and it’s substantially better, as shown in <a class="xref" href="ch08.html#execution_times_for_fibleft_pare-id00041" title="Table 8-2. Execution Times for fib(), Continued">Table 8-2</a>.</p><div class="table"><a id="execution_times_for_fibleft_pare-id00041"/><div class="table-title">Table 8-2. Execution Times for fib(), Continued</div><div class="table-contents"><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="c1"/><col class="c2"/><col class="c3"/></colgroup><thead><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Version</p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Parameter</p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>Execution time (ms)</p></td></tr></thead><tbody><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Imperative <code class="literal">fib()</code></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><code class="literal">28</code></p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>0.231</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Functional <code class="literal">fib()</code></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><code class="literal">28</code></p></td><td style="vertical-align: top; border-bottom: 0.5pt solid ; "><p>296.9</p></td></tr><tr><td style="vertical-align: top; border-right: 0.5pt solid ; "><p>Memoized <code class="literal">fib()</code></p></td><td style="vertical-align: top; border-right: 0.5pt solid ; "><p><code class="literal">28</code></p></td><td style="vertical-align: top; "><p>0.352</p></td></tr></tbody></table></div></div><p>Just by including the Underscore.js library and using one of its methods, our functional implementation has nearly the same performance as the imperative version.</p><p>For the rest of this chapter, we’ll look at many of the other improvements and utilities that Underscore.js provides. With its support for functional programming, Underscore.js makes it significantly easier to work with data in the browser.</p></div></div><div class="sect1" title="Working with Arrays"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="working_with_arrays">Working with Arrays</h2></div></div></div><p>If your visualization relies on a significant amount of data, that data is most likely contained in arrays. Unfortunately, it’s very tempting to resort to imperative programming when you are working with arrays. Arrays suggest the use of programming loops, and, as we saw earlier, programming loops are an imperative construct that often causes errors. If we can avoid loops and rely on functional programming instead, we can improve the quality of our JavaScript. The core JavaScript language includes a few utilities and methods to help applications cope with arrays in a functional style, but Underscore.js adds many others. This section describes many of the Underscore.js array utilities that are most helpful for data visualizations.</p><div class="sect2" title="Extracting Elements by Position"><div class="titlepage"><div><div><h3 class="title" id="extracting_elements_by_position">Extracting Elements by Position</h3></div></div></div><p>If you need only a subset of an array for your visualization, Underscore.js has many utilities that make it easy to extract the right one. For the following examples, we’ll consider a simple array (shown in <a class="xref" href="ch08.html#underscoredotjs_has_many_utilities_to_ma" title="Figure 8-1. Underscore.js has many utilities to make working with arrays easy.">Figure 8-1</a>).</p><a id="pro_id00434"/><pre class="programlisting"><span class="steelblue"><span class="strong"><strong>var</strong></span></span> arr = [<span class="red">1</span>,<span class="red">2</span>,<span class="red">3</span>,<span class="red">4</span>,<span class="red">5</span>,<span class="red">6</span>,<span class="red">7</span>,<span class="red">8</span>,<span class="red">9</span>];</pre><div class="figure"><a id="underscoredotjs_has_many_utilities_to_ma"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00117"/><img src="figs/web/08fig01.png" alt="Underscore.js has many utilities to make working with arrays easy."/></div></div><div class="figure-title">Figure 8-1. Underscore.js has many utilities to make working with arrays easy.</div></div><p><a id="iddle1349" class="indexterm"/><a id="iddle1567" class="indexterm"/>Underscore.js’s <code class="literal">first()</code> method provides a simple way to extract the first element of an array, or the first <span class="emphasis"><em>n</em></span> elements (see <a class="xref" href="ch08.html#firstleft_parenthesisright_parenthesis_f" title="Figure 8-2. The first() function returns the first element or the first n elements in an array.">Figure 8-2</a>):</p><a id="pro_id00435"/><pre class="programlisting">&gt; <span class="olive">_</span>(arr).<span class="olive">first</span>()
  <span class="red">1</span>
&gt; <span class="olive">_</span>(arr).<span class="olive">first</span>(<span class="red">3</span>)
  [<span class="red">1</span>, <span class="red">2</span>, <span class="red">3</span>]</pre><div class="figure"><a id="firstleft_parenthesisright_parenthesis_f"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00118"/><img src="figs/web/08fig02.png.jpg" alt="The first() function returns the first element or the first n elements in an array."/></div></div><div class="figure-title">Figure 8-2. The <code class="literal">first()</code> function returns the first element or the first n elements in an array.</div></div><p>Notice that <code class="literal">first()</code> (without any parameter) returns a simple element, while <code class="literal">first(n)</code> returns an array of elements. That means, for example, that <code class="literal">first()</code> and <code class="literal">first(1)</code> have different return values (<code class="literal">1</code> versus <code class="literal">[1]</code> in the example).</p><p>As you might expect, Underscore.js also has a <code class="literal">last()</code> method to extract elements from the end of an array (see <a class="xref" href="ch08.html#lastleft_parenthesisright_parenthesis_fu" title="Figure 8-3. The last() function returns the last element or the last n elements in an array.">Figure 8-3</a>).</p><a id="pro_id00436"/><pre class="programlisting">&gt; <span class="olive">_</span>(arr).<span class="olive">last</span>()
  <span class="red">9</span>
&gt; <span class="olive">_</span>(arr).<span class="olive">last</span>(<span class="red">3</span>)
  [<span class="red">7</span>, <span class="red">8</span>, <span class="red">9</span>]</pre><div class="figure"><a id="lastleft_parenthesisright_parenthesis_fu"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00119"/><img src="figs/web/08fig03.png.jpg" alt="The last() function returns the last element or the last n elements in an array."/></div></div><div class="figure-title">Figure 8-3. The <code class="literal">last()</code> function returns the last element or the last n elements in an array.</div></div><p>Without any parameters, <code class="literal">last()</code> returns the last element in the array. With a parameter <code class="literal">n</code>, it returns a new array with the last <span class="emphasis"><em>n</em></span> elements from the original.</p><p><a id="iddle1484" class="indexterm"/><a id="iddle1819" class="indexterm"/>The more general versions of both of these functions (<code class="literal">.first(3)</code> and <code class="literal">.last(3)</code>) would require some potentially tricky (and error-prone) code to implement in an imperative style. In the functional style that Underscore.js supports, however, our code is clean and simple.</p><p>What if you want to extract from the beginning of the array, but instead of knowing how many elements you want to include in the result, you know only how many elements you want to omit? In other words, you need “all but the last <span class="emphasis"><em>n</em></span>” elements. The <code class="literal">initial()</code> method performs this extraction (see <a class="xref" href="ch08.html#initialleft_parenthesisright_parenthesis" title="Figure 8-4. The initial() function returns all but the last element or all but the last n elements in an array.">Figure 8-4</a>). As with all of these methods, if you omit the optional parameter, Underscore.js assumes a value of <code class="literal">1</code>.</p><a id="pro_id00437"/><pre class="programlisting">&gt; <span class="olive">_</span>(arr).<span class="olive">initial</span>()
  [<span class="red">1</span>, <span class="red">2</span>, <span class="red">3</span>, <span class="red">4</span>, <span class="red">5</span>, <span class="red">6</span>, <span class="red">7</span>, <span class="red">8</span>]
&gt; <span class="olive">_</span>(arr).<span class="olive">initial</span>(<span class="red">3</span>)
  [<span class="red">1</span>, <span class="red">2</span>, <span class="red">3</span>, <span class="red">4</span>, <span class="red">5</span>, <span class="red">6</span>]</pre><div class="figure"><a id="initialleft_parenthesisright_parenthesis"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00120"/><img src="figs/web/08fig04.png.jpg" alt="The initial() function returns all but the last element or all but the last n elements in an array."/></div></div><div class="figure-title">Figure 8-4. The <code class="literal">initial()</code> function returns all but the last element or all but the last n elements in an array.</div></div><p>Finally, you may need the opposite of <code class="literal">initial()</code>. The <code class="literal">rest()</code> method skips past a defined number of elements in the beginning of the array and returns whatever remains (see <a class="xref" href="ch08.html#restleft_parenthesisright_parenthesis_fu" title="Figure 8-5. The rest() function returns all but the first element or all but the first n elements in an array.">Figure 8-5</a>).</p><a id="pro_id00438"/><pre class="programlisting">&gt; <span class="olive">_</span>(arr).<span class="olive">rest</span>()
  [<span class="red">2</span>, <span class="red">3</span>, <span class="red">4</span>, <span class="red">5</span>, <span class="red">6</span>, <span class="red">7</span>, <span class="red">8</span>, <span class="red">9</span>]
&gt; <span class="olive">_</span>(arr).<span class="olive">rest</span>(<span class="red">3</span>)
  [<span class="red">4</span>, <span class="red">5</span>, <span class="red">6</span>, <span class="red">7</span>, <span class="red">8</span>, <span class="red">9</span>]</pre><div class="figure"><a id="restleft_parenthesisright_parenthesis_fu"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00121"/><img src="figs/web/08fig05.png.jpg" alt="The rest() function returns all but the first element or all but the first n elements in an array."/></div></div><div class="figure-title">Figure 8-5. The <code class="literal">rest()</code> function returns all but the first element or all but the first n elements in an array.</div></div><p>Again, these functions would be tricky to implement using traditional, imperative programming, but they are a breeze with Underscore.js.</p></div><div class="sect2" title="Combining Arrays"><div class="titlepage"><div><div><h3 class="title" id="combining_arrays">Combining Arrays</h3></div></div></div><p><a id="iddle1044" class="indexterm"/><a id="iddle1048" class="indexterm"/><a id="iddle1219" class="indexterm"/><a id="iddle1339" class="indexterm"/><a id="iddle2089" class="indexterm"/><a id="iddle2108" class="indexterm"/>Underscore.js includes another set of utilities for combining two or more arrays. These include functions that mimic standard mathematical <span class="emphasis"><em>set</em></span> operations, as well as more-sophisticated combinations. For the next few examples, we’ll use two arrays, one containing the first few Fibonacci numbers and the other containing the first five even integers (see <a class="xref" href="ch08.html#underscoredotjs_also_has_many_utilities" title="Figure 8-6. Underscore.js also has many utilities to work with multiple arrays.">Figure 8-6</a>).</p><a id="pro_id00439"/><pre class="programlisting"><span class="steelblue"><span class="strong"><strong>var</strong></span></span> fibs = [<span class="red">0</span>, <span class="red">1</span>, <span class="red">1</span>, <span class="red">2</span>, <span class="red">3</span>, <span class="red">5</span>, <span class="red">8</span>];
<span class="steelblue"><span class="strong"><strong>var</strong></span></span> even = [<span class="red">0</span>, <span class="red">2</span>, <span class="red">4</span>, <span class="red">6</span>, <span class="red">8</span>];</pre><div class="figure"><a id="underscoredotjs_also_has_many_utilities"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00122"/><img src="figs/web/08fig06.png" alt="Underscore.js also has many utilities to work with multiple arrays."/></div></div><div class="figure-title">Figure 8-6. Underscore.js also has many utilities to work with multiple arrays.</div></div><p>The <code class="literal">union()</code> method is a straightforward combination of multiple arrays. It returns an array containing all elements that are in any of the inputs, and it removes any duplicates (<a class="xref" href="ch08.html#unionleft_parenthesisright_parenthesis_f" title="Figure 8-7. The union() function creates the union of multiple arrays, removing any duplicates.">Figure 8-7</a>).</p><a id="pro_id00440"/><pre class="programlisting">&gt; <span class="olive">_</span>(fibs).<span class="olive">union</span>(even)
  [<span class="red">0</span>, <span class="red">1</span>, <span class="red">2</span>, <span class="red">3</span>, <span class="red">5</span>, <span class="red">8</span>, <span class="red">4</span>, <span class="red">6</span>]</pre><div class="figure"><a id="unionleft_parenthesisright_parenthesis_f"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00123"/><img src="figs/web/08fig07.png.jpg" alt="The union() function creates the union of multiple arrays, removing any duplicates."/></div></div><div class="figure-title">Figure 8-7. The <code class="literal">union()</code> function creates the union of multiple arrays, removing any duplicates.</div></div><p>Notice that <code class="literal">union()</code> removes duplicates whether they appear in separate inputs (<code class="literal">0</code>, <code class="literal">2</code>, and <code class="literal">8</code>) or in the same array (<code class="literal">1</code>).</p><div class="note" title="Note"><h3 class="title"><a id="ch08note01"/>Note</h3><p><span class="strong"><strong>Although this chapter considers combinations of just two arrays, most Underscore.js methods can accept an unlimited number of parameters. For example, <code class="literal">_.union(a,b,c,d,e)</code> returns the union of five different arrays. You can even find the union of an array of arrays with the JavaScript <code class="literal">apply()</code> function with something like <code class="literal">_.union.prototype.apply(this, arrOfArrs)</code>.</strong></span></p></div><p><a id="iddle1270" class="indexterm"/><a id="iddle1526" class="indexterm"/><a id="iddle2109" class="indexterm"/><a id="iddle2193" class="indexterm"/>The <code class="literal">intersection()</code> method acts just as you would expect, returning only those elements that appear in all of the input arrays (<a class="xref" href="ch08.html#intersectionleft_parenthesisright_parent" title="Figure 8-8. The intersection() function returns elements in common among multiple arrays.">Figure 8-8</a>).</p><a id="pro_id00441"/><pre class="programlisting">&gt; <span class="olive">_</span>(fibs).<span class="olive">intersection</span>(even)
  [<span class="red">0</span>, <span class="red">2</span>, <span class="red">8</span>]</pre><div class="figure"><a id="intersectionleft_parenthesisright_parent"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00124"/><img src="figs/web/08fig08.png.jpg" alt="The intersection() function returns elements in common among multiple arrays."/></div></div><div class="figure-title">Figure 8-8. The <code class="literal">intersection()</code> function returns elements in common among multiple arrays.</div></div><p>The <code class="literal">difference()</code> method is the opposite of <code class="literal">intersection()</code>. It returns those elements in the first input array that are <span class="emphasis"><em>not</em></span> present in the other inputs (<a class="xref" href="ch08.html#differenceleft_parenthesisright_parenthe" title="Figure 8-9. The difference() function returns elements that are present only in the first of multiple arrays.">Figure 8-9</a>).</p><a id="pro_id00442"/><pre class="programlisting">&gt; <span class="olive">_</span>(fibs).<span class="olive">difference</span>(even)
  [<span class="red">1</span>, <span class="red">1</span>, <span class="red">3</span>, <span class="red">5</span>]</pre><div class="figure"><a id="differenceleft_parenthesisright_parenthe"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00125"/><img src="figs/web/08fig09.png.jpg" alt="The difference() function returns elements that are present only in the first of multiple arrays."/></div></div><div class="figure-title">Figure 8-9. The <code class="literal">difference()</code> function returns elements that are present only in the first of multiple arrays.</div></div><p>If you need to eliminate duplicate elements but have only one array—making <code class="literal">union()</code> inappropriate—then you can use the <code class="literal">uniq()</code> method (<a class="xref" href="ch08.html#uniqleft_parenthesisright_parenthesis_fu" title="Figure 8-10. The uniq() function removes duplicate elements from an array.">Figure 8-10</a>).</p><a id="pro_id00443"/><pre class="programlisting">&gt; <span class="olive">_</span>(fibs).<span class="olive">uniq</span>()
  [<span class="red">0</span>, <span class="red">1</span>, <span class="red">2</span>, <span class="red">3</span>, <span class="red">5</span>, <span class="red">8</span>]</pre><div class="figure"><a id="uniqleft_parenthesisright_parenthesis_fu"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00126"/><img src="figs/web/08fig10.png.jpg" alt="The uniq() function removes duplicate elements from an array."/></div></div><div class="figure-title">Figure 8-10. The <code class="literal">uniq()</code> function removes duplicate elements from an array.</div></div><p><a id="iddle1053" class="indexterm"/><a id="iddle1159" class="indexterm"/><a id="iddle1224" class="indexterm"/><a id="iddle2094" class="indexterm"/>Finally, Underscore.js has a <code class="literal">zip()</code> method. Its name doesn’t come from the popular compression algorithm but rather because it acts a bit like a zipper. It takes multiple input arrays and combines them, element by element, into an output array. That output is an array of arrays, where the inner arrays are the combined elements.</p><a id="pro_id00444"/><pre class="programlisting">&gt; <span class="steelblue"><span class="strong"><strong>var</strong></span></span> naturals = [<span class="red">1</span>, <span class="red">2</span>, <span class="red">3</span>, <span class="red">4</span>, <span class="red">5</span>];
&gt; <span class="steelblue"><span class="strong"><strong>var</strong></span></span> primes = [<span class="red">2</span>, <span class="red">3</span>, <span class="red">5</span>, <span class="red">7</span>, <span class="red">11</span>];
&gt; <span class="steelblue">_</span>.<span class="olive">zip</span>(naturals, primes)
  [ [<span class="red">1</span>,<span class="red">2</span>], [<span class="red">2</span>,<span class="red">3</span>], [<span class="red">3</span>,<span class="red">5</span>], [<span class="red">4</span>,<span class="red">7</span>], [<span class="red">5</span>,<span class="red">11</span>] ]</pre><p>The operation is perhaps most clearly understood through a picture; see <a class="xref" href="ch08.html#zipleft_parenthesisright_parenthesis_fun" title="Figure 8-11. The zip() function pairs elements from multiple arrays together into a single array.">Figure 8-11</a>.</p><div class="figure"><a id="zipleft_parenthesisright_parenthesis_fun"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00127"/><img src="figs/web/08fig11.png.jpg" alt="The zip() function pairs elements from multiple arrays together into a single array."/></div></div><div class="figure-title">Figure 8-11. The <span class="emphasis"><em>zip()</em></span> function pairs elements from multiple arrays together into a single array.</div></div><p>This example demonstrates an alternative style for Underscore.js. Instead of wrapping an array within the <code class="literal">_</code> object as we’ve done so far, we call the <code class="literal">zip()</code> method on the <code class="literal">_</code> object itself. The alternative style seems a better fit for the underlying functionality in this case, but if you prefer <code class="literal">_(naturals).zip(prime)</code>, you’ll get the exact same result.</p></div><div class="sect2" title="Removing Invalid Data Values"><div class="titlepage"><div><div><h3 class="title" id="removing_invalid_data_values">Removing Invalid Data Values</h3></div></div></div><p>One of the banes of visualization applications is invalid data values. Although we’d like to think that our data sources ensure that all the data they provide is scrupulously correct, that is, unfortunately, rarely the case. More seriously, if JavaScript encounters an invalid value, the most common result is an <span class="emphasis"><em>unhandled exception</em></span>, which halts all further JavaScript execution on the page.</p><p>To avoid such an unpleasant error, we should validate all data sets and remove invalid values before we pass the data to graphing or charting libraries. Underscore.js has several utilities to help.</p><p>The simplest of these Underscore.js methods is <code class="literal">compact()</code>. This function removes any data values that JavaScript treats as <code class="literal">false</code> from the input arrays. Eliminated values include the Boolean value <code class="literal">false</code>, the numeric value <code class="literal">0</code>, an empty string, and the special values <code class="literal">NaN</code> (not a number; for example, <code class="literal">1/0</code>), <code class="literal">undefined</code>, and <code class="literal">null</code>.</p><a id="pro_id00445"/><pre class="programlisting">&gt; <span class="steelblue"><span class="strong"><strong>var</strong></span></span> raw = [<span class="red">0</span>, <span class="red">1</span>, <span class="steelblue"><span class="strong"><strong>false</strong></span></span>, <span class="red">2</span>, <span class="maroon">""</span>, <span class="red">3</span>, <span class="steelblue"><span class="strong"><strong>NaN</strong></span></span>, <span class="red">4</span>, , <span class="red">5</span>, <span class="steelblue"><span class="strong"><strong>null</strong></span></span>];
&gt; <span class="olive">_</span>(raw).<span class="olive">compact</span>()
  [<span class="red">1</span>, <span class="red">2</span>, <span class="red">3</span>, <span class="red">4</span>, <span class="red">5</span>]</pre><p><a id="iddle1050" class="indexterm"/><a id="iddle1221" class="indexterm"/><a id="iddle1350" class="indexterm"/><a id="iddle1481" class="indexterm"/><a id="iddle1887" class="indexterm"/><a id="iddle2091" class="indexterm"/><a id="iddle2163" class="indexterm"/>It is worth emphasizing that <code class="literal">compact()</code> removes elements with a value of <code class="literal">0</code>. If you use <code class="literal">compact()</code> to clean a data array, be sure that <code class="literal">0</code> isn’t a valid data value in your data set.</p><p>Another common problem with raw data is excessively nested arrays. If you want to eliminate extra nesting levels from a data set, the <code class="literal">flatten()</code> method is available to help.</p><a id="pro_id00446"/><pre class="programlisting">&gt; <span class="steelblue"><span class="strong"><strong>var</strong></span></span> raw = [<span class="red">1</span>, <span class="red">2</span>, <span class="red">3</span>, [[<span class="red">4</span>]], <span class="red">5</span>];
&gt; <span class="olive">_</span>(raw).<span class="olive">flatten</span>()
  [<span class="red">1</span>, <span class="red">2</span>, <span class="red">3</span>, <span class="red">4</span>, <span class="red">5</span>]</pre><p>By default, <code class="literal">flatten()</code> removes all nesting, even multiple levels of nesting, from arrays. If you set the <code class="literal">shallow</code> parameter to <code class="literal">true</code>, however, it removes only a single level of nesting.</p><a id="pro_id00447"/><pre class="programlisting">&gt; <span class="steelblue"><span class="strong"><strong>var</strong></span></span> raw = [<span class="red">1</span>, <span class="red">2</span>, <span class="red">3</span>, [[<span class="red">4</span>]], <span class="red">5</span>];
&gt; <span class="olive">_</span>(raw).<span class="olive">flatten</span>(<span class="steelblue"><span class="strong"><strong>true</strong></span></span>)
  [<span class="red">1</span>, <span class="red">2</span>, <span class="red">3</span>, [<span class="red">4</span>], <span class="red">5</span>]</pre><p>Finally, if you have specific values that you want to eliminate from an array, you can use the <code class="literal">without()</code> method. Its parameters provide a list of values that the function should remove from the input array.</p><a id="pro_id00448"/><pre class="programlisting">&gt; <span class="steelblue"><span class="strong"><strong>var</strong></span></span> raw = [<span class="red">1</span>, <span class="red">2</span>, <span class="red">3</span>, <span class="red">4</span>];
&gt; <span class="olive">_</span>(raw).<span class="olive">without</span>(<span class="red">2</span>, <span class="red">3</span>)
  [<span class="red">1</span>, <span class="red">4</span>]</pre></div><div class="sect2" title="Finding Elements in an Array"><div class="titlepage"><div><div><h3 class="title" id="finding_elements_in_an_array">Finding Elements in an Array</h3></div></div></div><p>JavaScript has always defined the <code class="literal">indexOf()</code> method for strings. It returns the position of a given substring within a larger string. Recent versions of JavaScript have added this method to array objects, so you can easily find the first occurrence of a given value in an array. Unfortunately, older browsers (specifically IE8 and earlier) don’t support this method.</p><p>Underscore.js provides its own <code class="literal">indexOf()</code> method to fill the gap those older browsers create. If Underscore.js finds itself running in an environment with native support for array <code class="literal">indexOf</code>, then it defers to the native method to avoid any performance penalty.</p><a id="pro_id00449"/><pre class="programlisting">&gt; <span class="steelblue"><span class="strong"><strong>var</strong></span></span> primes = [<span class="red">2</span>, <span class="red">3</span>, <span class="red">5</span>, <span class="red">7</span>, <span class="red">11</span>];
&gt; <span class="olive">_</span>(primes).<span class="olive">indexOf</span>(<span class="red">5</span>)
  <span class="red">2</span></pre><p><a id="iddle1051" class="indexterm"/><a id="iddle1222" class="indexterm"/><a id="iddle1568" class="indexterm"/><a id="iddle1792" class="indexterm"/><a id="iddle1907" class="indexterm"/><a id="iddle2092" class="indexterm"/><a id="iddle2110" class="indexterm"/>To begin your search somewhere in the middle of the array, you can specify that starting position as the second argument to <code class="literal">indexOf()</code>.</p><a id="pro_id00450"/><pre class="programlisting">&gt; <span class="steelblue"><span class="strong"><strong>var</strong></span></span> arr = [<span class="red">2</span>, <span class="red">3</span>, <span class="red">5</span>, <span class="red">7</span>, <span class="red">11</span>, <span class="red">7</span>, <span class="red">5</span>, <span class="red">3</span>, <span class="red">2</span>];
&gt; <span class="olive">_</span>(arr).<span class="olive">indexOf</span>(<span class="red">5</span>, <span class="red">4</span>)
  <span class="red">6</span></pre><p>You can also search backward from the end of an array using the <code class="literal">lastIndexOf()</code> method.</p><a id="pro_id00451"/><pre class="programlisting">&gt; <span class="steelblue"><span class="strong"><strong>var</strong></span></span> arr = [<span class="red">2</span>, <span class="red">3</span>, <span class="red">5</span>, <span class="red">7</span>, <span class="red">11</span>, <span class="red">7</span>, <span class="red">5</span>, <span class="red">3</span>, <span class="red">2</span>];
&gt; <span class="olive">_</span>(arr).<span class="olive">lastIndexOf</span>(<span class="red">5</span>)
  <span class="red">6</span></pre><p>If you don’t want to start at the very end of the array, you can pass in the starting index as an optional parameter.</p><p>Underscore.js provides a few helpful optimizations for sorted arrays. Both the <code class="literal">uniq()</code> and the <code class="literal">indexOf()</code> methods accept an optional Boolean parameter. If that parameter is <code class="literal">true</code>, then the functions assume that the array is sorted. The performance improvements this assumption allows can be especially significant for large data sets.</p><p>The library also includes the special <code class="literal">sortedIndex()</code> function. This function also assumes that the input array is sorted. It finds the position at which a specific value <span class="emphasis"><em>should</em></span> be inserted to maintain the array’s sort order.</p><a id="pro_id00452"/><pre class="programlisting">&gt; <span class="steelblue"><span class="strong"><strong>var</strong></span></span> arr = [<span class="red">2</span>, <span class="red">3</span>, <span class="red">5</span>, <span class="red">7</span>, <span class="red">11</span>];
&gt; <span class="olive">_</span>(arr).<span class="olive">sortedIndex</span>(<span class="red">6</span>)
  <span class="red">3</span></pre><p>If you have a custom sorting function, you can pass that to <code class="literal">sortedIndex()</code> as well.</p></div><div class="sect2" title="Generating Arrays"><div class="titlepage"><div><div><h3 class="title" id="generating_arrays">Generating Arrays</h3></div></div></div><p>The final array utility I’ll mention is a convenient method to generate arrays. The <code class="literal">range()</code> method tells Underscore.js to create an array with the specified number of elements. You may also specify a starting value (the default is <code class="literal">0</code>) and the increment between adjacent values (the default is <code class="literal">1</code>).</p><a id="pro_id00453"/><pre class="programlisting">&gt; <span class="steelblue">_</span>.<span class="olive">range</span>(<span class="red">10</span>)
  [<span class="red">0</span>, <span class="red">1</span>, <span class="red">2</span>, <span class="red">3</span>, <span class="red">4</span>, <span class="red">5</span>, <span class="red">6</span>, <span class="red">7</span>, <span class="red">8</span>, <span class="red">9</span>]
&gt; <span class="steelblue">_</span>.<span class="olive">range</span>(<span class="red">20</span>,<span class="red">10</span>)
  [<span class="red">20</span>, <span class="red">21</span>, <span class="red">22</span>, <span class="red">23</span>, <span class="red">24</span>, <span class="red">25</span>, <span class="red">26</span>, <span class="red">27</span>, <span class="red">28</span>, <span class="red">29</span>]
&gt; <span class="steelblue">_</span>.<span class="olive">range</span>(<span class="red">0</span>, <span class="red">10</span>, <span class="red">100</span>)
  [<span class="red">0</span>, <span class="red">100</span>, <span class="red">200</span>, <span class="red">300</span>, <span class="red">400</span>, <span class="red">500</span>, <span class="red">600</span>, <span class="red">700</span>, <span class="red">800</span>, <span class="red">900</span>]</pre><p>The <code class="literal">range()</code> function can be quite useful if you need to generate x-axis values to match an array of y-axis values.</p><a id="pro_id00454"/><pre class="programlisting">&gt; <span class="steelblue"><span class="strong"><strong>var</strong></span></span> yvalues = [<span class="red">0.1277</span>, <span class="red">1.2803</span>, <span class="red">1.7697</span>, <span class="red">3.1882</span>]
&gt; <span class="steelblue">_</span>.<span class="olive">zip</span>(<span class="steelblue">_</span>.<span class="olive">range</span>(<span class="steelblue">yvalues</span>.<span class="olive">length</span>),yvalues)
  [ [<span class="red">0</span>, <span class="red">0.1277</span>], [<span class="red">1</span>, <span class="red">1.2803</span>], [<span class="red">2</span>, <span class="red">1.7697</span>], [<span class="red">3</span>, <span class="red">3.1882</span>] ]</pre><p><a id="iddle1231" class="indexterm"/><a id="iddle1232" class="indexterm"/><a id="iddle1543" class="indexterm"/><a id="iddle1548" class="indexterm"/><a id="iddle1553" class="indexterm"/><a id="iddle2101" class="indexterm"/><a id="iddle2102" class="indexterm"/>Here we use <code class="literal">range()</code> to generate the matching x-axis values, and use <code class="literal">zip()</code> to combine them with the y-values.</p></div></div><div class="sect1" title="Enhancing Objects"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="enhancing_objects">Enhancing Objects</h2></div></div></div><p>Although the previous section’s examples show numeric arrays, often our visualization data consists of JavaScript objects instead of simple numbers. That’s especially likely if we get the data via a REST interface, because such interfaces almost always deliver data in JavaScript Object Notation (JSON). If we need to enhance or transform objects without resorting to imperative constructs, Underscore.js has another set of utilities that can help. For the following examples, we can use a simple <code class="literal">pizza</code> object (see <a class="xref" href="ch08.html#underscoredotjs_has_many_utilities_for_w" title="Figure 8-12. Underscore.js has many utilities for working with arbitrary JavaScript objects.">Figure 8-12</a>).</p><a id="pro_id00455"/><pre class="programlisting"><span class="steelblue"><span class="strong"><strong>var</strong></span></span> pizza = {
    <span class="dodgerblue">size</span>: <span class="red">10</span>,
    <span class="dodgerblue">crust</span>: <span class="maroon">"thin"</span>,
    <span class="dodgerblue">cheese</span>: <span class="steelblue"><span class="strong"><strong>true</strong></span></span>,
    <span class="dodgerblue">toppings</span>: [ <span class="maroon">"pepperoni"</span>,<span class="maroon">"sausage"</span>]
};</pre><div class="figure"><a id="underscoredotjs_has_many_utilities_for_w"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00128"/><img src="figs/web/08fig12.png" alt="Underscore.js has many utilities for working with arbitrary JavaScript objects."/></div></div><div class="figure-title">Figure 8-12. Underscore.js has many utilities for working with arbitrary JavaScript objects.</div></div><div class="sect2" title="Working with Keys and Values"><div class="titlepage"><div><div><h3 class="title" id="working_with_keys_and_values">Working with Keys and Values</h3></div></div></div><p>Underscore.js includes several methods to work with the keys and values that make up objects. For example, the <code class="literal">keys()</code> function creates an array consisting solely of an object’s keys (see <a class="xref" href="ch08.html#keysleft_parenthesisright_parenthesis_fu" title="Figure 8-13. The keys() function returns the keys of an object as an array.">Figure 8-13</a>).</p><a id="pro_id00456"/><pre class="programlisting">&gt; <span class="olive">_</span>(pizza).<span class="olive">keys</span>()
  [ <span class="maroon">"size"</span>, <span class="maroon">"crust"</span>, <span class="maroon">"cheese"</span>, <span class="maroon">"toppings"</span>]]</pre><div class="figure"><a id="keysleft_parenthesisright_parenthesis_fu"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00129"/><img src="figs/web/08fig13.png.jpg" alt="The keys() function returns the keys of an object as an array."/></div></div><div class="figure-title">Figure 8-13. The <code class="literal">keys()</code> function returns the keys of an object as an array.</div></div><p><a id="iddle1714" class="indexterm"/><a id="iddle1735" class="indexterm"/><a id="iddle2115" class="indexterm"/>Similarly, the <code class="literal">values()</code> function creates an array consisting solely of an object’s values (<a class="xref" href="ch08.html#valuesleft_parenthesisright_parenthesis" title="Figure 8-14. The values() function returns just the values of an object as an array.">Figure 8-14</a>).</p><a id="pro_id00457"/><pre class="programlisting">&gt; _(pizza).<span class="olive">values</span>()
  [<span class="red">10</span>, <span class="maroon">"thin"</span>, <span class="steelblue"><span class="strong"><strong>true</strong></span></span>, [ <span class="maroon">"pepperoni"</span>,<span class="maroon">"sausage"</span>]]</pre><div class="figure"><a id="valuesleft_parenthesisright_parenthesis"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00130"/><img src="figs/web/08fig14.png.jpg" alt="The values() function returns just the values of an object as an array."/></div></div><div class="figure-title">Figure 8-14. The <code class="literal">values()</code> function returns just the values of an object as an array.</div></div><p>The <code class="literal">pairs()</code> function creates a two-dimensional array. Each element of the outer array is itself an array that contains an object’s key and its corresponding value (<a class="xref" href="ch08.html#pairsleft_parenthesisright_parenthesis_f" title="Figure 8-15. The pairs() function converts an object into an array of array pairs.">Figure 8-15</a>).</p><a id="pro_id00458"/><pre class="programlisting">&gt; <span class="olive">_</span>(pizza).<span class="olive">pairs</span>()
 [
   [ <span class="maroon">"size"</span>,<span class="red">10</span>],
   [ <span class="maroon">"crust"</span>,<span class="maroon">"thin"</span>],
   [ <span class="maroon">"cheese"</span>,<span class="steelblue"><span class="strong"><strong>true</strong></span></span>],
   [ <span class="maroon">"toppings"</span>,[ <span class="maroon">"pepperoni"</span>,<span class="maroon">"sausage"</span>]]
 ]</pre><div class="figure"><a id="pairsleft_parenthesisright_parenthesis_f"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00131"/><img src="figs/web/08fig15.png" alt="The pairs() function converts an object into an array of array pairs."/></div></div><div class="figure-title">Figure 8-15. The <code class="literal">pairs()</code> function converts an object into an array of array pairs.</div></div><p>To reverse this transformation and convert an array into an object, we can use the <code class="literal">object()</code> function.</p><a id="pro_id00459"/><pre class="programlisting">&gt; <span class="steelblue"><span class="strong"><strong>var</strong></span></span> arr = [ [ <span class="maroon">"size"</span>,<span class="red">10</span>], [ <span class="maroon">"crust"</span>,<span class="maroon">"thin"</span>], [ <span class="maroon">"cheese"</span>,<span class="steelblue"><span class="strong"><strong>true</strong></span></span>],
            [ <span class="maroon">"toppings"</span>,[ <span class="maroon">"pepperoni"</span>,<span class="maroon">"sausage"</span>]] ]
&gt; <span class="olive">_</span>(arr).<span class="olive">object</span>()
  { <span class="dodgerblue">size</span>: <span class="red">10</span>, <span class="dodgerblue">crust</span>: <span class="maroon">"thin"</span>, <span class="dodgerblue">cheese</span>: <span class="steelblue"><span class="strong"><strong>true</strong></span></span>, <span class="dodgerblue">toppings</span>: [ <span class="maroon">"pepperoni"</span>,<span class="maroon">"sausage"</span>]}</pre><p>Finally, we can swap the roles of keys and values in an object with the <code class="literal">invert()</code> function (<a class="xref" href="ch08.html#invertleft_parenthesisright_parenthesis" title="Figure 8-16. The invert() function swaps keys and values in an object.">Figure 8-16</a>).</p><a id="pro_id00460"/><pre class="programlisting">&gt; <span class="olive">_</span>(pizza).<span class="olive">invert</span>()
  {<span class="red">10</span>: <span class="maroon">"size"</span>, <span class="dodgerblue">thin</span>: <span class="maroon">"crust"</span>, <span class="dodgerblue">true</span>: <span class="maroon">"cheese"</span>, <span class="maroon">"pepperoni,sausage"</span>:
<span class="maroon">"toppings"</span>}</pre><div class="figure"><a id="invertleft_parenthesisright_parenthesis"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00132"/><img src="figs/web/08fig16.png" alt="The invert() function swaps keys and values in an object."/></div></div><div class="figure-title">Figure 8-16. The <code class="literal">invert()</code> function swaps keys and values in an object.</div></div><p><a id="iddle1230" class="indexterm"/><a id="iddle1527" class="indexterm"/><a id="iddle1748" class="indexterm"/><a id="iddle2100" class="indexterm"/>As the preceding example shows, Underscore.js can even invert an object if the value isn’t a simple type. In this case it takes an array, <code class="literal">["pepperoni","sausage"]</code>, and converts it to a value by joining the individual array elements with commas, creating the key <code class="literal">"pepperoni,sausage"</code>.</p><p>Note also that JavaScript requires that all of an object’s keys are unique. That’s not necessarily the case for values. If you have an object in which multiple keys have the same value, then <code class="literal">invert()</code> keeps only the last of those keys in the inverted object. For example, <code class="literal">_({key1: value, key2: value}).invert()</code> returns <code class="literal">{value: key2}</code>.</p></div><div class="sect2" title="Cleaning Up Object Subsets"><div class="titlepage"><div><div><h3 class="title" id="cleaning_up_object_subsets">Cleaning Up Object Subsets</h3></div></div></div><p>When you want to clean up an object by eliminating unnecessary attributes, you can use Underscore.js’s <code class="literal">pick()</code> function. Simply pass it a list of attributes that you want to retain (<a class="xref" href="ch08.html#pickleft_parenthesisright_parenthesis_fu" title="Figure 8-17. The pick() function selects specific properties from an object.">Figure 8-17</a>).</p><a id="pro_id00461"/><pre class="programlisting">&gt; <span class="olive">_</span>(pizza).<span class="olive">pick</span>( <span class="maroon">"size"</span>,<span class="maroon">"crust"</span>)
  {<span class="dodgerblue">size</span>: <span class="red">10</span>, <span class="dodgerblue">crust</span>: <span class="maroon">"thin"</span>}</pre><div class="figure"><a id="pickleft_parenthesisright_parenthesis_fu"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00133"/><img src="figs/web/08fig17.png.jpg" alt="The pick() function selects specific properties from an object."/></div></div><div class="figure-title">Figure 8-17. The <code class="literal">pick()</code> function selects specific properties from an object.</div></div><p><a id="iddle1233" class="indexterm"/><a id="iddle1254" class="indexterm"/><a id="iddle1718" class="indexterm"/><a id="iddle2103" class="indexterm"/>We can also do the opposite of <code class="literal">pick()</code> by using <code class="literal">omit()</code> and listing the attributes that we want to delete (<a class="xref" href="ch08.html#omitleft_parenthesisright_parenthesis_fu" title="Figure 8-18. The omit() function removes properties from an object.">Figure 8-18</a>). Underscore.js keeps all the other attributes in the object.</p><a id="pro_id00462"/><pre class="programlisting">&gt; <span class="olive">_</span>(pizza).<span class="olive">omit</span>( <span class="maroon">"size"</span>,<span class="maroon">"crust"</span>)
 {<span class="dodgerblue">cheese</span>: <span class="steelblue"><span class="strong"><strong>true</strong></span></span>, <span class="dodgerblue">toppings</span>: [ <span class="maroon">"pepperoni"</span>,<span class="maroon">"sausage"</span>]}</pre><div class="figure"><a id="omitleft_parenthesisright_parenthesis_fu"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00134"/><img src="figs/web/08fig18.png.jpg" alt="The omit() function removes properties from an object."/></div></div><div class="figure-title">Figure 8-18. The <code class="literal">omit()</code> function removes properties from an object.</div></div></div><div class="sect2" title="Updating Attributes"><div class="titlepage"><div><div><h3 class="title" id="updating_attributes">Updating Attributes</h3></div></div></div><p>When you are updating objects, a common requirement is to make sure that an object includes certain attributes and that those attributes have appropriate default values. Underscore.js includes two utilities for this purpose.</p><p>The two utilities, <code class="literal">extend()</code> and <code class="literal">defaults()</code>, both start with one object and adjust its properties based on those of other objects. If the secondary objects include attributes that the original object lacks, these utilities add those properties to the original. The utilities differ in how they handle properties that are already present in the original. The <code class="literal">extend()</code> function overrides the original properties with new values (see <a class="xref" href="ch08.html#extendleft_parenthesisright_parenthesis" title="Figure 8-19. The extend() function updates and adds missing properties to an object.">Figure 8-19</a>):</p><a id="pro_id00463"/><pre class="programlisting">&gt; <span class="steelblue"><span class="strong"><strong>var</strong></span></span> standard = { <span class="dodgerblue">size</span>: <span class="red">12</span>, <span class="dodgerblue">crust</span>: <span class="maroon">"regular"</span>, <span class="dodgerblue">cheese</span>: <span class="steelblue"><span class="strong"><strong>true</strong></span></span> }
&gt; <span class="steelblue"><span class="strong"><strong>var</strong></span></span> order = { <span class="dodgerblue">size</span>: <span class="red">10</span>, <span class="dodgerblue">crust</span>: <span class="maroon">"thin"</span>,
  <span class="dodgerblue">toppings</span>: [ <span class="maroon">"pepperoni"</span>,<span class="maroon">"sausage"</span>] };
&gt; <span class="steelblue">_</span>.<span class="olive">extend</span>(standard, order)
  { <span class="dodgerblue">size</span>: <span class="red">10</span>, <span class="dodgerblue">crust</span>: <span class="maroon">"thin"</span>, <span class="dodgerblue">cheese</span>: <span class="steelblue"><span class="strong"><strong>true</strong></span></span>,
  <span class="dodgerblue">toppings</span>: [ <span class="maroon">"pepperoni"</span>,<span class="maroon">"sausage"</span>] };</pre><p>Meanwhile, <code class="literal">defaults()</code> leaves the original properties unchanged (<a class="xref" href="ch08.html#defaultsleft_parenthesisright_parenthesi" title="Figure 8-20. The defaults() function adds missing properties to an object.">Figure 8-20</a>):</p><a id="pro_id00464"/><pre class="programlisting">&gt; <span class="steelblue"><span class="strong"><strong>var</strong></span></span> order = { <span class="dodgerblue">size</span>: <span class="red">10</span>, <span class="dodgerblue">crust</span>: <span class="maroon">"thin"</span>,
  <span class="dodgerblue">toppings</span>: [ <span class="maroon">"pepperoni"</span>,<span class="maroon">"sausage"</span>] };
&gt; <span class="steelblue"><span class="strong"><strong>var</strong></span></span> standard = { <span class="dodgerblue">size</span>: <span class="red">12</span>, <span class="dodgerblue">crust</span>: <span class="maroon">"regular"</span>, <span class="dodgerblue">cheese</span>: <span class="steelblue"><span class="strong"><strong>true</strong></span></span> }
&gt; <span class="steelblue">_</span>.<span class="olive">defaults</span>(order, standard)
  { <span class="dodgerblue">size</span>: <span class="red">10</span>, <span class="dodgerblue">crust</span>: <span class="maroon">"thin"</span>,
  toppings [ <span class="maroon">"pepperoni"</span>,<span class="maroon">"sausage"</span>], <span class="dodgerblue">cheese</span>: <span class="steelblue"><span class="strong"><strong>true</strong></span></span> };</pre><div class="figure"><a id="extendleft_parenthesisright_parenthesis"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00135"/><img src="figs/web/08fig19.png.jpg" alt="The extend() function updates and adds missing properties to an object."/></div></div><div class="figure-title">Figure 8-19. The <code class="literal">extend()</code> function updates and adds missing properties to an object.</div></div><div class="figure"><a id="defaultsleft_parenthesisright_parenthesi"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00136"/><img src="figs/web/08fig20.png.jpg" alt="The defaults() function adds missing properties to an object."/></div></div><div class="figure-title">Figure 8-20. The <code class="literal">defaults()</code> function adds missing properties to an object.</div></div><p><a id="iddle1151" class="indexterm"/><a id="iddle1227" class="indexterm"/><a id="iddle2097" class="indexterm"/>Note that both <code class="literal">extend()</code> and <code class="literal">defaults()</code> modify the original object directly; they do not make a copy of that object and return the copy. Consider, for example, the following:</p><a id="pro_id00465"/><pre class="programlisting">&gt; <span class="steelblue"><span class="strong"><strong>var</strong></span></span> order = { <span class="dodgerblue">size</span>: <span class="red">10</span>, <span class="dodgerblue">crust</span>: <span class="maroon">"thin"</span>,
  <span class="dodgerblue">toppings</span>: [ <span class="maroon">"pepperoni"</span>,<span class="maroon">"sausage"</span>] };
&gt; <span class="steelblue"><span class="strong"><strong>var</strong></span></span> standard = { <span class="dodgerblue">size</span>: <span class="red">12</span>, <span class="dodgerblue">crust</span>: <span class="maroon">"regular"</span>, <span class="dodgerblue">cheese</span>: <span class="steelblue"><span class="strong"><strong>true</strong></span></span> }
&gt; <span class="steelblue"><span class="strong"><strong>var</strong></span></span> pizza = <span class="steelblue">_</span>.<span class="olive">extend</span>(standard, order)
  { <span class="dodgerblue">size</span>: <span class="red">10</span>, <span class="dodgerblue">crust</span>: <span class="maroon">"thin"</span>, <span class="dodgerblue">cheese</span>: <span class="steelblue"><span class="strong"><strong>true</strong></span></span>,
  <span class="dodgerblue">toppings</span>: [ <span class="maroon">"pepperoni"</span>,<span class="maroon">"sausage"</span>] };</pre><p>This code sets the <code class="literal">pizza</code> variable as you would expect, but it also sets the <code class="literal">standard</code> variable to that same object. More specifically, the code modifies <code class="literal">standard</code> with the properties from <code class="literal">order</code>, and then it sets a new variable <code class="literal">pizza</code> equal to <code class="literal">standard</code>. The modification of <code class="literal">standard</code> is probably not intended. If you need to use either <code class="literal">extend()</code> or <code class="literal">defaults()</code> in a way that does not modify input parameters, start with an empty object.</p><a id="pro_id00466"/><pre class="programlisting">&gt; <span class="steelblue"><span class="strong"><strong>var</strong></span></span> order = { <span class="dodgerblue">size</span>: <span class="red">10</span>, <span class="dodgerblue">crust</span>: <span class="maroon">"thin"</span>,
  <span class="dodgerblue">toppings</span>: [ <span class="maroon">"pepperoni"</span>,<span class="maroon">"sausage"</span>] };
&gt; <span class="steelblue"><span class="strong"><strong>var</strong></span></span> standard = { <span class="dodgerblue">size</span>: <span class="red">12</span>, <span class="dodgerblue">crust</span>: <span class="maroon">"regular"</span>, <span class="dodgerblue">cheese</span>: <span class="steelblue"><span class="strong"><strong>true</strong></span></span> }
&gt; <span class="steelblue"><span class="strong"><strong>var</strong></span></span> pizza = <span class="steelblue">_</span>.<span class="olive">extend</span>({}, standard, order)
  { <span class="dodgerblue">size</span>: <span class="red">10</span>, <span class="dodgerblue">crust</span>: <span class="maroon">"thin"</span>, <span class="dodgerblue">cheese</span>: <span class="steelblue"><span class="strong"><strong>true</strong></span></span>,
  <span class="dodgerblue">toppings</span>: [ <span class="maroon">"pepperoni"</span>,<span class="maroon">"sausage"</span>] };</pre><p>This version gets us the desired <code class="literal">pizza</code> object without modifying <code class="literal">standard</code>.</p></div></div><div class="sect1" title="Manipulating Collections"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="manipulating_collections">Manipulating Collections</h2></div></div></div><p>So far we’ve seen various Underscore.js tools that are suited specifically for either arrays or objects. Next, we’ll see some tools for manipulating collections in general. In Underscore.js both arrays and objects are <span class="emphasis"><em>collections</em></span>, so the tools in this section can be applied to pure arrays, pure objects, or data structures that combine both. In this section, we’ll try out these utilities on an array of objects, since that’s the data structure we most often deal with in the context of data visualization.</p><p>Here’s a small data set we can use for the examples that follow. It contains a few statistics from the 2012 Major League Baseball season.</p><a id="pro_id00467"/><pre class="programlisting"><span class="steelblue"><span class="strong"><strong>var</strong></span></span> national_league = [
    { <span class="dodgerblue">name</span>: <span class="maroon">"Arizona Diamondbacks"</span>,  <span class="dodgerblue">wins</span>: <span class="red">81</span>, <span class="dodgerblue">losses</span>:  <span class="red">81</span>,
      <span class="dodgerblue">division</span>: <span class="maroon">"west"</span> },
    { <span class="dodgerblue">name</span>: <span class="maroon">"Atlanta Braves"</span>,        <span class="dodgerblue">wins</span>: <span class="red">94</span>, <span class="dodgerblue">losses</span>:  <span class="red">68</span>,
      <span class="dodgerblue">division</span>: <span class="maroon">"east"</span> },
    { <span class="dodgerblue">name</span>: <span class="maroon">"Chicago Cubs"</span>,          <span class="dodgerblue">wins</span>: <span class="red">61</span>, <span class="dodgerblue">losses</span>: <span class="red">101</span>,
      <span class="dodgerblue">division</span>: <span class="maroon">"central"</span> },
    { <span class="dodgerblue">name</span>: <span class="maroon">"Cincinnati Reds"</span>,       <span class="dodgerblue">wins</span>: <span class="red">97</span>, <span class="dodgerblue">losses</span>:  <span class="red">65</span>,
      <span class="dodgerblue">division</span>: <span class="maroon">"central"</span> },
    { <span class="dodgerblue">name</span>: <span class="maroon">"Colorado Rockies"</span>,      <span class="dodgerblue">wins</span>: <span class="red">64</span>, <span class="dodgerblue">losses</span>:  <span class="red">98</span>,
      <span class="dodgerblue">division</span>: <span class="maroon">"west"</span> },
    { <span class="dodgerblue">name</span>: <span class="maroon">"Houston Astros"</span>,        <span class="dodgerblue">wins</span>: <span class="red">55</span>, <span class="dodgerblue">losses</span>: <span class="red">107</span>,
      <span class="dodgerblue">division</span>: <span class="maroon">"central"</span> },
    { <span class="dodgerblue">name</span>: <span class="maroon">"Los Angeles Dodgers"</span>,   <span class="dodgerblue">wins</span>: <span class="red">86</span>, <span class="dodgerblue">losses</span>:  <span class="red">76</span>,
      <span class="dodgerblue">division</span>: <span class="maroon">"west"</span> },
    { <span class="dodgerblue">name</span>: <span class="maroon">"Miami Marlins"</span>,         <span class="dodgerblue">wins</span>: <span class="red">69</span>, <span class="dodgerblue">losses</span>:  <span class="red">93</span>,
      <span class="dodgerblue">division</span>: <span class="maroon">"east"</span> },
    { <span class="dodgerblue">name</span>: <span class="maroon">"Milwaukee Brewers"</span>,     <span class="dodgerblue">wins</span>: <span class="red">83</span>, <span class="dodgerblue">losses</span>:  <span class="red">79</span>,
      <span class="dodgerblue">division</span>: <span class="maroon">"central"</span> },
    { <span class="dodgerblue">name</span>: <span class="maroon">"New York Mets"</span>,         <span class="dodgerblue">wins</span>: <span class="red">74</span>, <span class="dodgerblue">losses</span>:  <span class="red">88</span>,
      <span class="dodgerblue">division</span>: <span class="maroon">"east"</span> },
    { <span class="dodgerblue">name</span>: <span class="maroon">"Philadelphia Phillies"</span>, <span class="dodgerblue">wins</span>: <span class="red">81</span>, <span class="dodgerblue">losses</span>:  <span class="red">81</span>,
      <span class="dodgerblue">division</span>: <span class="maroon">"east"</span> },
    { <span class="dodgerblue">name</span>: <span class="maroon">"Pittsburgh Pirates"</span>,    <span class="dodgerblue">wins</span>: <span class="red">79</span>, <span class="dodgerblue">losses</span>:  <span class="red">83</span>,
      <span class="dodgerblue">division</span>: <span class="maroon">"central"</span> },
    { <span class="dodgerblue">name</span>: <span class="maroon">"San Diego Padres"</span>,      <span class="dodgerblue">wins</span>: <span class="red">76</span>, <span class="dodgerblue">losses</span>:  <span class="red">86</span>,
      <span class="dodgerblue">division</span>: <span class="maroon">"west"</span> },
    { <span class="dodgerblue">name</span>: <span class="maroon">"San Francisco Giants"</span>,  <span class="dodgerblue">wins</span>: <span class="red">94</span>, <span class="dodgerblue">losses</span>:  <span class="red">68</span>,
      <span class="dodgerblue">division</span>: <span class="maroon">"west"</span> },
    { <span class="dodgerblue">name</span>: <span class="maroon">"St. Louis Cardinals"</span>,   <span class="dodgerblue">wins</span>: <span class="red">88</span>, <span class="dodgerblue">losses</span>:  <span class="red">74</span>,
      <span class="dodgerblue">division</span>: <span class="maroon">"central"</span> },
    { <span class="dodgerblue">name</span>: <span class="maroon">"Washington Nationals"</span>,  <span class="dodgerblue">wins</span>: <span class="red">98</span>, <span class="dodgerblue">losses</span>:  <span class="red">64</span>,
      <span class="dodgerblue">division</span>: <span class="maroon">"east"</span> }
];</pre><div class="sect2" title="Working with Iteration Utilities"><div class="titlepage"><div><div><h3 class="title" id="working_with_iteration_utilities">Working with Iteration Utilities</h3></div></div></div><p><a id="iddle1002" class="indexterm"/><a id="iddle1150" class="indexterm"/><a id="iddle1226" class="indexterm"/><a id="iddle1530" class="indexterm"/><a id="iddle2096" class="indexterm"/>In the first section, we saw some of the pitfalls of traditional JavaScript iteration loops as well as the improvements that functional programming can provide. Our Fibonacci example eliminated iteration by using recursion, but many algorithms don’t lend themselves to a recursive implementation. In those cases, we can still use a functional programming style, however, by taking advantage of the iteration utilities in Underscore.js.</p><p>The most basic Underscore utility is <code class="literal">each()</code>. It executes an arbitrary function on every element in a collection and often serves as a direct functional replacement for the traditional <code class="literal">for (i=0; i&lt;len; i++)</code> loop.</p><a id="pro_id00468"/><pre class="programlisting">&gt; <span class="olive">_</span>(national_league).<span class="olive">each</span>(<span class="steelblue"><span class="strong"><strong>function</strong></span></span>(team) { <span class="steelblue">console</span>.<span class="olive">log</span>(<span class="steelblue">team</span>.<span class="olive">name</span>); })
  Arizona Diamondbacks
  Atlanta Braves
  <span class="indianred"><span class="emphasis"><em>// Console output continues...</em></span></span>
  Washington Nationals</pre><p>If you’re familiar with the jQuery library, you may know that jQuery includes a similar <code class="literal">$.each()</code> utility. There are two important differences between the Underscore .js and jQuery versions, however. First, the parameters passed to the iterator function differ between the two. Underscore.js passes <code class="literal">(element, index, list)</code> for arrays and <code class="literal">(value, key, list)</code> for simple objects, while jQuery passes <code class="literal">(index, value)</code>. Secondly, at least as of this writing, the Underscore.js implementation can execute much <a id="iddle1010" class="indexterm"/><a id="iddle1149" class="indexterm"/><a id="iddle1225" class="indexterm"/><a id="iddle1342" class="indexterm"/><a id="iddle1347" class="indexterm"/><a id="iddle1631" class="indexterm"/><a id="iddle1662" class="indexterm"/><a id="iddle1799" class="indexterm"/><a id="iddle2095" class="indexterm"/>faster than the jQuery version, depending on the browser. (jQuery also includes a <code class="literal">$.map()</code> function that’s similar to the Underscore.js method.)</p><p>The Underscore.js <code class="literal">map()</code> method iterates through a collection and transforms each element with an arbitrary function. It returns a new collection containing the transformed elements. Here, for example, is how to create an array of all the teams’ winning percentages:</p><a id="pro_id00469"/><pre class="programlisting">&gt; <span class="olive">_</span>(national_league).<span class="olive">map</span>(<span class="steelblue"><span class="strong"><strong>function</strong></span></span>(team) {
      <span class="steelblue"><span class="strong"><strong>return</strong></span></span> <span class="steelblue">Math</span>.<span class="olive">round</span>(<span class="red">100</span>*<span class="steelblue">team</span>.<span class="olive">wins</span>/(<span class="steelblue">team</span>.<span class="olive">wins</span> + <span class="steelblue">team</span>.<span class="olive">losses</span>);
  })
  [<span class="red">50</span>, <span class="red">58</span>, <span class="red">38</span>, <span class="red">60</span>, <span class="red">40</span>, <span class="red">34</span>, <span class="red">53</span>, <span class="red">43</span>, <span class="red">51</span>, <span class="red">46</span>, <span class="red">50</span>, <span class="red">49</span>, <span class="red">47</span>, <span class="red">58</span>, <span class="red">54</span>, <span class="red">60</span>]</pre><p>The <code class="literal">reduce()</code> method iterates through a collection and returns a single value. One parameter initializes this value, and the other parameter is an arbitrary function that updates the value for each element in the collection. We can use <code class="literal">reduce()</code>, for example, to calculate how many teams have a winning percentage over 500.</p><a id="pro_id00470"/><pre class="programlisting">   &gt; <span class="olive">_</span>(national_league).<span class="olive">reduce</span>(
➊       <span class="steelblue"><span class="strong"><strong>function</strong></span></span>(count, team) {
➋           <span class="steelblue"><span class="strong"><strong>return</strong></span></span> count + (<span class="steelblue">team</span>.<span class="olive">wins</span> &gt; <span class="steelblue">team</span>.<span class="olive">losses</span>);
         },
➌       <span class="red">0</span> <span class="indianred"><span class="emphasis"><em>// Starting point for reduced value</em></span></span>
     )
     <span class="red">7</span></pre><p>As the comment at ➊ indicates, we start our count at 0. That value is passed as the first parameter to the function at ➋, and the function returns an updated value at ➌.</p><div class="note" title="Note"><h3 class="title"><a id="ch08note02"/>Note</h3><p><span class="strong"><strong>If you’ve followed the development of “big data” implementations such as Hadoop or Google’s search, you may know that the fundamental algorithm behind those technologies is MapReduce. Although the context differs, the same concepts underlie the <code class="literal">map()</code> and <code class="literal">reduce()</code> utilities in Underscore.js.</strong></span></p></div></div><div class="sect2" title="Finding Elements in a Collection"><div class="titlepage"><div><div><h3 class="title" id="finding_elements_in_a_collection">Finding Elements in a Collection</h3></div></div></div><p>Underscore.js has several methods to help us find elements or sets of elements in a collection. We can, for example, use <code class="literal">find()</code> to get a team with more than 90 wins.</p><a id="pro_id00471"/><pre class="programlisting">&gt; <span class="olive">_</span>(national_league).<span class="olive">find</span>( <span class="steelblue"><span class="strong"><strong>function</strong></span></span>(team) { <span class="steelblue"><span class="strong"><strong>return</strong></span></span> <span class="steelblue">team</span>.<span class="olive">wins</span> &gt; <span class="red">90</span>; })
  { <span class="dodgerblue">name</span>: <span class="maroon">"Atlanta Braves"</span>, <span class="dodgerblue">wins</span>: <span class="red">94</span>, <span class="dodgerblue">losses</span>: <span class="red">68</span>, <span class="dodgerblue">division</span>: <span class="maroon">"east"</span> }</pre><p>The <code class="literal">find()</code> function returns the first element in the array that meets the criterion. To find all elements that meet our criterion, use the <code class="literal">filter()</code> function.</p><a id="pro_id00472"/><pre class="programlisting">&gt; <span class="olive">_</span>(national_league).<span class="olive">filter</span>( <span class="steelblue"><span class="strong"><strong>function</strong></span></span>(team) { <span class="steelblue"><span class="strong"><strong>return</strong></span></span> <span class="steelblue">team</span>.<span class="olive">wins</span> &gt; <span class="red">90</span>; })
  [ { <span class="dodgerblue">name</span>: <span class="maroon">"Atlanta Braves"</span>, <span class="dodgerblue">wins</span>: <span class="red">94</span>, <span class="dodgerblue">losses</span>: <span class="red">68</span>, <span class="dodgerblue">division</span>: <span class="maroon">"east"</span> },
    { <span class="dodgerblue">name</span>: <span class="maroon">"Cincinnati Reds"</span>, <span class="dodgerblue">wins</span>: <span class="red">97</span>, <span class="dodgerblue">losses</span>: <span class="red">65</span>, <span class="dodgerblue">division</span>: <span class="maroon">"central"</span> },
    { <span class="dodgerblue">name</span>: <span class="maroon">"San Francisco Giants"</span>, <span class="dodgerblue">wins</span>: <span class="red">94</span>, <span class="dodgerblue">losses</span>: <span class="red">68</span>, <span class="dodgerblue">division</span>: <span class="maroon">"west"</span> },
    { <span class="dodgerblue">name</span>: <span class="maroon">"Washington Nationals"</span>, <span class="dodgerblue">wins</span>: <span class="red">98</span>, <span class="dodgerblue">losses</span>: <span class="red">64</span>, <span class="dodgerblue">division</span>: <span class="maroon">"east"</span> }
  ]</pre><p><a id="iddle1343" class="indexterm"/><a id="iddle1348" class="indexterm"/><a id="iddle1771" class="indexterm"/><a id="iddle1801" class="indexterm"/><a id="iddle2156" class="indexterm"/>The opposite of the <code class="literal">filter()</code> function is <code class="literal">reject()</code>. It returns an array of elements that don’t meet the criterion.</p><a id="pro_id00473"/><pre class="programlisting">&gt; <span class="olive">_</span>(national_league).<span class="olive">reject</span>( <span class="steelblue"><span class="strong"><strong>function</strong></span></span>(team) { <span class="steelblue"><span class="strong"><strong>return</strong></span></span> <span class="steelblue">team</span>.<span class="olive">wins</span> &gt; <span class="red">90</span>; })
  [ { <span class="dodgerblue">name</span>: <span class="maroon">"Arizona Diamondbacks"</span>, <span class="dodgerblue">wins</span>: <span class="red">81</span>, <span class="dodgerblue">losses</span>: <span class="red">81</span>, <span class="dodgerblue">division</span>: <span class="maroon">"west"</span> },
    { <span class="dodgerblue">name</span>: <span class="maroon">"Chicago Cubs"</span>, <span class="dodgerblue">wins</span>: <span class="red">61</span>, <span class="dodgerblue">losses</span>: <span class="red">101</span>, <span class="dodgerblue">division</span>: <span class="maroon">"central"</span> },
    <span class="indianred"><span class="emphasis"><em>// Console output continues...</em></span></span>
    { <span class="dodgerblue">name</span>: <span class="maroon">"St. Louis Cardinals"</span>, <span class="dodgerblue">wins</span>: <span class="red">88</span>, <span class="dodgerblue">losses</span>: <span class="red">74</span>, <span class="dodgerblue">division</span>: <span class="maroon">"central"</span> }
  ]</pre><p>If your criterion can be described as a property value, you can use a simpler version of <code class="literal">filter()</code>: the <code class="literal">where()</code> function. Instead of an arbitrary function to check for a match, <code class="literal">where()</code> takes for its parameter a set of properties that must match. We can use it to extract all the teams in the Eastern Division.</p><a id="pro_id00474"/><pre class="programlisting">&gt; <span class="olive">_</span>(national_league).<span class="olive">where</span>({<span class="dodgerblue">division</span>: <span class="maroon">"east"</span>})
  [ { <span class="dodgerblue">name</span>: <span class="maroon">"Atlanta Braves"</span>, <span class="dodgerblue">wins</span>: <span class="red">94</span>, <span class="dodgerblue">losses</span>: <span class="red">68</span>, <span class="dodgerblue">division</span>: <span class="maroon">"east"</span> },
    { <span class="dodgerblue">name</span>: <span class="maroon">"Miami Marlins"</span>, <span class="dodgerblue">wins</span>: <span class="red">69</span>, <span class="dodgerblue">losses</span>: <span class="red">93</span>, <span class="dodgerblue">division</span>: <span class="maroon">"east"</span> },
    { <span class="dodgerblue">name</span>: <span class="maroon">"New York Mets"</span>, <span class="dodgerblue">wins</span>: <span class="red">74</span>, <span class="dodgerblue">losses</span>: <span class="red">88</span>, <span class="dodgerblue">division</span>: <span class="maroon">"east"</span> },
    { <span class="dodgerblue">name</span>: <span class="maroon">"Philadelphia Phillies"</span>, <span class="dodgerblue">wins</span>: <span class="red">81</span>, <span class="dodgerblue">losses</span>: <span class="red">81</span>, <span class="dodgerblue">division</span>: <span class="maroon">"east"</span> },
    { <span class="dodgerblue">name</span>: <span class="maroon">"Washington Nationals"</span>, <span class="dodgerblue">wins</span>: <span class="red">98</span>, <span class="dodgerblue">losses</span>: <span class="red">64</span>, <span class="dodgerblue">division</span>: <span class="maroon">"east"</span> }
  ]</pre><p>The <code class="literal">findWhere()</code> method combines the functionality of <code class="literal">find()</code> with the simplicity of <code class="literal">where()</code>. It returns the first element in a collection with properties that match specific values.</p><a id="pro_id00475"/><pre class="programlisting">&gt; <span class="olive">_</span>(national_league).<span class="olive">where</span>({<span class="dodgerblue">name</span>: <span class="maroon">"Atlanta Braves"</span>})
  {<span class="dodgerblue">name</span>: <span class="maroon">"Atlanta Braves"</span>, <span class="dodgerblue">wins</span>: <span class="red">94</span>, <span class="dodgerblue">losses</span>: <span class="red">68</span>, <span class="dodgerblue">division</span>: <span class="maroon">"east"</span>}</pre><p>Another Underscore.js utility that’s especially handy is <code class="literal">pluck()</code>. This function creates an array by extracting only the specified property from a collection. We could use it to extract an array of nothing but team names, for example.</p><a id="pro_id00476"/><pre class="programlisting">&gt; <span class="olive">_</span>(national_league).<span class="olive">pluck</span>( <span class="maroon">"team"</span>)
  [
    <span class="maroon">"Arizona Diamondbacks"</span>,
    <span class="maroon">"Atlanta Braves"</span>,
   <span class="indianred"><span class="emphasis"><em>/* Data continues... */</em></span></span>,
    <span class="maroon">"Washington Nationals"</span>
  ]</pre></div><div class="sect2" title="Testing a Collection"><div class="titlepage"><div><div><h3 class="title" id="testing_a_collection">Testing a Collection</h3></div></div></div><p><a id="iddle1035" class="indexterm"/><a id="iddle1152" class="indexterm"/><a id="iddle1153" class="indexterm"/><a id="iddle1228" class="indexterm"/><a id="iddle1229" class="indexterm"/><a id="iddle1313" class="indexterm"/><a id="iddle1439" class="indexterm"/><a id="iddle1677" class="indexterm"/><a id="iddle1906" class="indexterm"/><a id="iddle2098" class="indexterm"/><a id="iddle2099" class="indexterm"/>Sometimes we don’t necessarily need to transform a collection; we simply want to check some aspect of it. Underscore.js provides several utilities to help with these tests.</p><p>The <code class="literal">every()</code> function tells us whether all elements in a collection pass an arbitrary test. We could use it to check if every team in our data set had at least 70 wins.</p><a id="pro_id00477"/><pre class="programlisting">&gt; <span class="olive">_</span>(national_league).<span class="olive">every</span>(<span class="steelblue"><span class="strong"><strong>function</strong></span></span>(team) { <span class="steelblue"><span class="strong"><strong>return</strong></span></span> <span class="steelblue">team</span>.<span class="olive">wins</span> &gt;= <span class="red">70</span>; })
  <span class="steelblue"><span class="strong"><strong>false</strong></span></span></pre><p>Perhaps we’d like to know if <span class="emphasis"><em>any</em></span> team had at least 70 wins. In that case, the <code class="literal">any()</code> function provides an answer.</p><a id="pro_id00478"/><pre class="programlisting">&gt; <span class="olive">_</span>(national_league).<span class="olive">any</span>(<span class="steelblue"><span class="strong"><strong>function</strong></span></span>(team) { <span class="steelblue"><span class="strong"><strong>return</strong></span></span> <span class="steelblue">team</span>.<span class="olive">wins</span> &gt;= <span class="red">70</span>; })
  <span class="steelblue"><span class="strong"><strong>true</strong></span></span></pre><p>Underscore.js also lets us use arbitrary functions to find the maximum and minimum elements in a collection. If our criteria is number of wins, we use <code class="literal">max()</code> to find the “maximum” team.</p><a id="pro_id00479"/><pre class="programlisting">&gt; <span class="olive">_</span>(national_league).<span class="olive">max</span>(<span class="steelblue"><span class="strong"><strong>function</strong></span></span>(team) { <span class="steelblue"><span class="strong"><strong>return</strong></span></span> <span class="steelblue">team</span>.<span class="olive">wins</span>; })
  { <span class="dodgerblue">name</span>: <span class="maroon">"Washington Nationals"</span>, <span class="dodgerblue">wins</span>: <span class="red">98</span>, <span class="dodgerblue">losses</span>: <span class="red">64</span>, <span class="dodgerblue">division</span>: <span class="maroon">"east"</span> }</pre><p>Not surprisingly, the <code class="literal">min()</code> function works the same way.</p><a id="pro_id00480"/><pre class="programlisting">&gt; <span class="olive">_</span>(national_league).<span class="olive">min</span>(<span class="steelblue"><span class="strong"><strong>function</strong></span></span>(team) { <span class="steelblue"><span class="strong"><strong>return</strong></span></span> <span class="steelblue">team</span>.<span class="olive">wins</span>; })
  { <span class="dodgerblue">name</span>: <span class="maroon">"Houston Astros"</span>, <span class="dodgerblue">wins</span>: <span class="red">55</span>, <span class="dodgerblue">losses</span>: <span class="red">107</span>, <span class="dodgerblue">division</span>: <span class="maroon">"central"</span> }</pre></div><div class="sect2" title="Rearranging Collections"><div class="titlepage"><div><div><h3 class="title" id="rearranging_collections">Rearranging Collections</h3></div></div></div><p>To sort a collection, we can use the <code class="literal">sortBy()</code> method and supply an arbitrary function to provide sortable values. Here’s how to reorder our collection in order of increasing wins.</p><a id="pro_id00481"/><pre class="programlisting">&gt; <span class="olive">_</span>(national_league).<span class="olive">sortBy</span>(<span class="steelblue"><span class="strong"><strong>function</strong></span></span>(team) { <span class="steelblue"><span class="strong"><strong>return</strong></span></span> <span class="steelblue">team</span>.<span class="olive">wins</span>; })
  [ { <span class="dodgerblue">name</span>: <span class="maroon">"Houston Astros"</span>, <span class="dodgerblue">wins</span>: <span class="red">55</span>, <span class="dodgerblue">losses</span>: <span class="red">107</span>, <span class="dodgerblue">division</span>: <span class="maroon">"central"</span> }
    { <span class="dodgerblue">name</span>: <span class="maroon">"Chicago Cubs"</span>, <span class="dodgerblue">wins</span>: <span class="red">61</span>, <span class="dodgerblue">losses</span>: <span class="red">101</span>, <span class="dodgerblue">division</span>: <span class="maroon">"central"</span> },
    <span class="indianred"><span class="emphasis"><em>// Data continues...</em></span></span>
    { <span class="dodgerblue">name</span>: <span class="maroon">"Washington Nationals"</span>, <span class="dodgerblue">wins</span>: <span class="red">98</span>, <span class="dodgerblue">losses</span>: <span class="red">64</span>, <span class="dodgerblue">division</span>: <span class="maroon">"east"</span> }</pre><p>We could also reorganize our collection by grouping its elements according to a property. The Underscore.js function that helps in this case is <code class="literal">groupBy()</code>. One possibility is reorganizing the teams according to their division.</p><a id="pro_id00482"/><pre class="programlisting">&gt; <span class="olive">_</span>(national_league).<span class="olive">groupBy</span>( <span class="maroon">"division"</span>)
  {
    { <span class="dodgerblue">west</span>:
      { <span class="dodgerblue">name</span>: <span class="maroon">"Arizona Diamondbacks"</span>, <span class="dodgerblue">wins</span>: <span class="red">81</span>, <span class="dodgerblue">losses</span>: <span class="red">81</span>, <span class="dodgerblue">division</span>: <span class="maroon">"west"</span> },
      { <span class="dodgerblue">name</span>: <span class="maroon">"Colorado Rockies"</span>, <span class="dodgerblue">wins</span>: <span class="red">64</span>, <span class="dodgerblue">losses</span>: <span class="red">98</span>, <span class="dodgerblue">division</span>: <span class="maroon">"west"</span> },
      { <span class="dodgerblue">name</span>: <span class="maroon">"Los Angeles Dodgers"</span>, <span class="dodgerblue">wins</span>: <span class="red">86</span>, <span class="dodgerblue">losses</span>: <span class="red">76</span>, <span class="dodgerblue">division</span>: <span class="maroon">"west"</span> },
      { <span class="dodgerblue">name</span>: <span class="maroon">"San Diego Padres"</span>, <span class="dodgerblue">wins</span>: <span class="red">76</span>, <span class="dodgerblue">losses</span>: <span class="red">86</span>, <span class="dodgerblue">division</span>: <span class="maroon">"west"</span> },
      { <span class="dodgerblue">name</span>: <span class="maroon">"San Francisco Giants"</span>, <span class="dodgerblue">wins</span>: <span class="red">94</span>, <span class="dodgerblue">losses</span>: <span class="red">68</span>, <span class="dodgerblue">division</span>: <span class="maroon">"west"</span> },
    },
    { <span class="dodgerblue">east</span>:
      { <span class="dodgerblue">name</span>: <span class="maroon">"Atlanta Braves"</span>, <span class="dodgerblue">wins</span>: <span class="red">94</span>, <span class="dodgerblue">losses</span>: <span class="red">68</span>, <span class="dodgerblue">division</span>: <span class="maroon">"east"</span> },
      { <span class="dodgerblue">name</span>: <span class="maroon">"Miami Marlins"</span>, <span class="dodgerblue">wins</span>: <span class="red">69</span>, <span class="dodgerblue">losses</span>: <span class="red">93</span>, <span class="dodgerblue">division</span>: <span class="maroon">"east"</span> },
      { <span class="dodgerblue">name</span>: <span class="maroon">"New York Mets"</span>, <span class="dodgerblue">wins</span>: <span class="red">74</span>, <span class="dodgerblue">losses</span>: <span class="red">88</span>, <span class="dodgerblue">division</span>: <span class="maroon">"east"</span> },
      { <span class="dodgerblue">name</span>: <span class="maroon">"Philadelphia Phillies"</span>, <span class="dodgerblue">wins</span>: <span class="red">81</span>, <span class="dodgerblue">losses</span>: <span class="red">81</span>,
        <span class="dodgerblue">division</span>: <span class="maroon">"east"</span> },
      { <span class="dodgerblue">name</span>: <span class="maroon">"Washington Nationals"</span>, <span class="dodgerblue">wins</span>: <span class="red">98</span>, <span class="dodgerblue">losses</span>: <span class="red">64</span>, <span class="dodgerblue">division</span>: <span class="maroon">"east"</span> }
    },
    { <span class="dodgerblue">central</span>:
      { <span class="dodgerblue">name</span>: <span class="maroon">"Chicago Cubs"</span>, <span class="dodgerblue">wins</span>: <span class="red">61</span>, <span class="dodgerblue">losses</span>: <span class="red">101</span>, <span class="dodgerblue">division</span>: <span class="maroon">"central"</span> },
      { <span class="dodgerblue">name</span>: <span class="maroon">"Cincinnati Reds"</span>, <span class="dodgerblue">wins</span>: <span class="red">97</span>, <span class="dodgerblue">losses</span>: <span class="red">65</span>, <span class="dodgerblue">division</span>: <span class="maroon">"central"</span> },
      { <span class="dodgerblue">name</span>: <span class="maroon">"Houston Astros"</span>, <span class="dodgerblue">wins</span>: <span class="red">55</span>, <span class="dodgerblue">losses</span>: <span class="red">107</span>, <span class="dodgerblue">division</span>: <span class="maroon">"central"</span> },
      { <span class="dodgerblue">name</span>: <span class="maroon">"Milwaukee Brewers"</span>, <span class="dodgerblue">wins</span>: <span class="red">83</span>, <span class="dodgerblue">losses</span>: <span class="red">79</span>, <span class="dodgerblue">division</span>: <span class="maroon">"central"</span> },
      { <span class="dodgerblue">name</span>: <span class="maroon">"Pittsburgh Pirates"</span>, <span class="dodgerblue">wins</span>: <span class="red">79</span>, <span class="dodgerblue">losses</span>: <span class="red">83</span>,
        <span class="dodgerblue">division</span>: <span class="maroon">"central"</span> },
      { <span class="dodgerblue">name</span>: <span class="maroon">"St. Louis Cardinals"</span>, <span class="dodgerblue">wins</span>: <span class="red">88</span>, <span class="dodgerblue">losses</span>: <span class="red">74</span>,
        <span class="dodgerblue">division</span>: <span class="maroon">"central"</span> },
    }
  }</pre><p><a id="iddle1171" class="indexterm"/><a id="iddle1440" class="indexterm"/><a id="iddle1893" class="indexterm"/>We can also use the <code class="literal">countBy()</code> function to simply count the number of elements in each group.</p><a id="pro_id00483"/><pre class="programlisting">&gt; <span class="olive">_</span>(national_league).<span class="olive">countBy</span>( <span class="maroon">"division"</span>)
  {<span class="dodgerblue">west</span>: <span class="red">5</span>, <span class="dodgerblue">east</span>: <span class="red">5</span>, <span class="dodgerblue">central</span>: <span class="red">6</span>}</pre><div class="note" title="Note"><h3 class="title"><a id="ch08note03"/>Note</h3><p><span class="strong"><strong>Although we’ve used a property value (<code class="literal">"division"</code>) for <code class="literal">groupBy()</code> and <code class="literal">countBy()</code>, both methods also accept an arbitrary function if the criteria for grouping isn’t a simple property.</strong></span></p></div><p>As a final trick, Underscore.js lets us randomly reorder a collection using the <code class="literal">shuffle()</code> function.</p><a id="pro_id00484"/><pre class="programlisting"><span class="olive">_</span>(national_league).<span class="olive">shuffle</span>()</pre></div></div><div class="sect1" title="Summing Up"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="summing_up-id00042">Summing Up</h2></div></div></div><p>Although this chapter takes a different approach than the rest of the book, its ultimate focus is still on data visualizations. As we’ve seen in earlier chapters (and as you’ll certainly encounter in your own projects), the raw data for our visualizations isn’t always perfect as delivered. Sometimes we need to clean the data by removing invalid values, and other times we need to rearrange or transform it so that it’s appropriate for our visualization libraries.</p><p>The Underscore.js library contains a wealth of tools and utilities to help with those tasks. It lets us easily manage arrays, modify objects, and transform collections. Furthermore, Underscore.js supports an underlying philosophy based on functional programming, so our code that uses Underscore.js remains highly readable and resistant to bugs and defects.</p></div></section></body></html>