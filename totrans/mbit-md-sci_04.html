<html><head></head><body>
<div class="imagec"><span epub:type="pagebreak" id="page_85"/><img alt="Image" src="../images/common1.jpg"/></div>
<h2 class="h2" id="ch04"><strong>4</strong><br/><strong>MAGICAL MAGNETISM</strong></h2>
<p class="noindent">As you saw in <a href="ch01.xhtml#ch01">Chapter 1</a>, the micro:bit has a built-in magnetometer that serves a variety of purposes. In this chapter, we’ll use it to turn your micro:bit into a compass that tells you which direction you’re facing. We’ll also measure the magnetic fields of neodymium magnets. Then, we’ll make a magnetic alarm that rings whenever someone opens the door.</p>
<h3 class="h3" id="ch00lev1sec99"><span epub:type="pagebreak" id="page_86"/><strong>PROJECT: COMPASS</strong></h3>
<div class="image"><img alt="Image" src="../images/common3.jpg"/></div>
<p class="difficulty"><em>Difficulty: Easy</em></p>
<p class="noindent">In this project, shown in <a href="ch04.xhtml#ch4fig1">Figure 4-1</a>, you’ll use the micro:bit’s built-in magnetometer as a compass. It will display an arrow on the screen that points toward magnetic north.</p>
<div class="image" id="ch4fig1"><img alt="Image" src="../images/04fig01.jpg"/></div>
<p class="figcap"><em>Figure 4-1: Finding north with a micro:bit compass</em></p>
<p class="indent">Unlike a conventional compass, this compass doesn’t always point north. Instead, it shows you which way to turn in order to be facing north.</p>
<p class="indent">Rotate until the arrow is facing straight ahead, and you’re looking north!</p>
<h4 class="h4" id="ch00lev1sec100"><strong>What You’ll Need</strong></h4>
<p class="noindent">For this experiment, you will need:</p>
<p class="noindentint"><strong><span class="blue">Micro:bit</span></strong></p>
<p class="noindentinb"><strong><span class="blue">Battery pack</span></strong></p>
<p class="indent">You only need a micro:bit to make this compass, but if you plan to navigate outdoors, then you’ll need a battery pack as well.</p>
<div class="image"><span epub:type="pagebreak" id="page_87"/><img alt="Image" src="../images/f0087-01.jpg"/></div>
<h4 class="h4" id="ch00lev1sec101"><strong>Construction</strong></h4>
<ol>
<li class="noindent">Go to <em><a href="https://github.com/simonmonk/mbms/">https://github.com/simonmonk/mbms/</a></em> to access the book’s code repository and click the link for <strong>Compass</strong>. Once the program has opened, click <strong>Download</strong> and then copy the hex file onto your micro:bit. If you get stuck on this section, head back to <a href="ch01.xhtml#ch01">Chapter 1</a>, where the process of getting programs onto your micro:bit is explained in full.
<p class="indent">If you prefer to use Python, then download the code from the same website, along with instructions for downloading and using the book’s examples. The Python file for this experiment is <em>ch_04_Compass.py</em>.</p></li>
<li class="noindent">Once you’ve loaded the program onto your micro:bit, you’ll see a message prompting you to move your micro:bit in a certain way. Follow the instructions. This will happen every time you flash a program onto the micro:bit that uses the magnetometer.
<p class="indent">The purpose of moving your micro:bit this way is to calibrate its magnetometer. The magnetometer chip on the micro:bit is sensitive to local magnetic field variations. By moving the magnetometer in different directions, you help its internal filtering software to compensate for the <span epub:type="pagebreak" id="page_88"/>local distortions to Earth’s magnetic field. This is why it’s a good idea to calibrate your compass again if you take it outside, away from the metal objects commonly found indoors. Also, a battery pack can affect the magnetometer, so it’s best to calibrate with the same hardware you’ll use on the final project.</p>
<p class="indent">Calibrating your micro:bit’s magnetometer is a bit like doing a puzzle. As you move your micro:bit, more LEDs will light up (<a href="ch04.xhtml#ch4fig2">Figure 4-2</a>).</p>
<div class="image" id="ch4fig2"><img alt="Image" src="../images/04fig02.jpg"/></div>
<p class="figcap"><em>Figure 4-2: Calibrating your micro:bit’s magnetometer</em></p></li>
<li class="noindent">To use the compass, attach a battery pack to your micro:bit and take it outside, well away from items such as computers and household appliances. Hold the micro:bit level (so it’s flat). If the arrow points to the right or left, slowly turn in that direction until the arrow points straight ahead. When it does, you’re facing magnetic north.
<p class="indent">If the compass isn’t pointing north, try calibrating it again by pressing <strong>button A</strong>.</p></li>
</ol>
<h4 class="h4" id="ch00lev1sec102"><span epub:type="pagebreak" id="page_89"/><strong>Code</strong></h4>
<p class="noindent">The Blocks and MicroPython versions of the code follow the same pattern. The <em>heading</em>, or <em>bearing</em>, (the direction the micro:bit is pointing) is measured and then the program decides which of the three arrows (north, west, or east) it should display in order to direct the user in the right direction.</p>
<h5 class="h5" id="ch00lev1sec103"><strong>Blocks Code</strong></h5>
<p class="noindent">Here is the Blocks code for this project.</p>
<div class="image"><img alt="Image" src="../images/f0089-01.jpg"/></div>
<p class="indent">In this project, we’ll set up the code so that you can calibrate the magnetometer any time you want by pressing button A.</p>
<p class="indent">The <code>calibrate compass</code> block is inside the <code>on button A pressed</code> block. The <code>calibrate compass</code> block will display the dot <span epub:type="pagebreak" id="page_90"/>we used to calibrate the magnetometer earlier. You can then roll it around the display, as we did at the start of this project.</p>
<p class="indent">In the <code>forever</code> block, assign the value of <code>compass heading</code> (degrees from 0 to 359) to a variable called <code>heading</code>, which will contain this heading.</p>
<p class="indent">Then create a large <code>if</code> block that consists of an <code>if</code>, an <code>else if</code>, and an <code>else</code>. This big block will test which direction the micro:bit is facing and display an arrow on the LED display showing you which way to turn to be facing north.</p>
<p class="indent">If you’re writing this code yourself, you will notice that the Blocks code library seems to offer only two kinds of <code>if</code> blocks: <code>if then</code> and <code>else</code>. To add the <code>else if then</code> section, click the <code>+</code> circled in <a href="ch04.xhtml#ch4fig3">Figure 4-3</a>.</p>
<div class="image" id="ch4fig3"><img alt="Image" src="../images/04fig03.jpg"/></div>
<p class="figcap"><em>Figure 4-3: Adding another section to</em> if <em>blocks</em></p>
<p class="indent">The first line of the large <code>if</code> block tests whether <code>heading</code> is between 10 and 180 degrees, where 0 degrees is north. Thus, a <code>heading</code> value between 10 and 180 would indicate that you were facing east. In this case, the micro:bit would display the west arrow, which points left. This arrow tells you to turn to the left in order to face north.</p>
<p class="indent">If <code>heading</code> is not between 10 and 180, then the <code>else if</code> part of the block tests whether <code>heading</code> is greater than or equal to 180 and less than 350 degrees. If it is, then the micro:bit displays the east arrow, which tells you to go right.</p>
<p class="indent">If <code>heading</code> is between 350 and 10 degrees, the <code>else</code> part of the <code>if</code> block will display the north arrow, which points <span epub:type="pagebreak" id="page_91"/>forward—you’re on the right track! <a href="ch04.xhtml#ch4fig4">Figure 4-4</a> shows how this works (the numbers are possible values of <code>heading</code>).</p>
<div class="image" id="ch4fig4"><img alt="Image" src="../images/04fig04.jpg"/></div>
<p class="figcap"><em>Figure 4-4: The arrow will point in one of three directions, guiding you north.</em></p>
<h5 class="h5" id="ch00lev1sec104"><strong>MicroPython Code</strong></h5>
<p class="noindent">Here is the MicroPython code for the project:</p>
<div class="programs1"><span class="green">from</span> microbit <span class="green">import</span> <span class="purple">*</span><br/><br/><span class="green">while True</span><span class="purple">:</span><br/>    heading <span class="purple">=</span> compass<span class="purple">.</span>heading<span class="purple">()</span><br/>    <span class="green">if</span> heading <span class="purple">&gt;</span> <span class="blue1">10</span> <span class="green">and</span> heading <span class="purple">&lt;</span> <span class="blue1">180</span><span class="purple">:</span><br/>        display<span class="purple">.</span>show<span class="purple">(</span>Image<span class="purple">.</span>ARROW_W<span class="purple">)</span><br/>    <span class="green">elif</span> heading <span class="purple">&gt;=</span> <span class="blue1">180</span> <span class="green">and</span> heading <span class="purple">&lt;</span> <span class="blue1">350</span><span class="purple">:</span><br/>        display<span class="purple">.</span>show<span class="purple">(</span>Image<span class="purple">.</span>ARROW_E<span class="purple">)</span><br/>    <span class="green">else</span><span class="purple">:</span><br/>        display<span class="purple">.</span>show<span class="purple">(</span>Image<span class="purple">.</span>ARROW_N<span class="purple">)</span><br/><br/>    <span class="green">if</span> button_a<span class="purple">.</span>was_pressed<span class="purple">():</span><br/>        compass<span class="purple">.</span>calibrate<span class="purple">()</span></div>
<p class="indent">This code uses the same logic as its Blocks code equivalent: it checks the reading of the magnetometer and tells the <span epub:type="pagebreak" id="page_92"/>micro:bit to display an arrow. Again, if the heading is between 10 and 180 degrees from north, the micro:bit shows a west arrow; if it’s between 180 and 350 degrees, the micro:bit displays an east arrow; and if the heading is within 20 degrees of north, an arrow points straight up, telling you to keep going in the same direction.</p>
<h4 class="h4" id="ch00lev1sec105"><strong>Things to Try</strong></h4>
<p class="noindent">See whether you can use a magnet to confuse the compass about which direction is north.</p>
<h4 class="h4" id="ch00lev1sec106"><strong>How It Works: The Earth’s Magnetic Field</strong></h4>
<p class="noindent">Earth’s magnetic north and south poles have strong charges, creating a magnetic field all around the globe, as shown in <a href="ch04.xhtml#ch4fig5">Figure 4-5</a>.</p>
<div class="image" id="ch4fig5"><img alt="Image" src="../images/04fig05.jpg"/></div>
<p class="figcap"><em>Figure 4-5: Earth’s magnetic field</em></p>
<p class="indent">The micro:bit’s magnetometer measures the strength of Earth’s magnetic field to deduce the direction the micro:bit is facing.</p>
<p class="indent"><span epub:type="pagebreak" id="page_93"/>Interestingly, the magnetic north pole is not exactly at the top of the spinning ball that is Earth. The magnetic field can be centered up to 20 degrees away from the geographic poles, depending on where you are in the world.</p>
<p class="indent">Another interesting fact about the magnetic poles is that they’re shifting at a rate of about 6 miles (10 km) a year. One day, the poles will flip completely, meaning that magnetic north will be at the southern end of the globe. This process happens on Earth about every 450,000 years.</p>
<h3 class="h3" id="ch00lev1sec107"><strong>EXPERIMENT 4: MEASURING MAGNETIC FIELDS</strong></h3>
<div class="image"><img alt="Image" src="../images/common2.jpg"/></div>
<p class="difficulty"><em>Difficulty: Medium</em></p>
<p class="noindent">As we just saw, the micro:bit’s built-in magnetometer is sensitive enough that you can use it as a compass to find north. It’s also a great tool for measuring the strength of a nearby magnet. In this experiment (shown in <a href="ch04.xhtml#ch4fig6">Figure 4-6</a>), you’ll measure the strength of a magnetic field at various distances.</p>
<h4 class="h4" id="ch00lev1sec108"><strong>What You’ll Need</strong></h4>
<p class="noindent">In this experiment, you’ll need the following:</p>
<p class="noindentint"><strong><span class="blue">Micro:bit</span></strong></p>
<p class="noindentin"><strong><span class="blue">Strong neodymium magnet</span></strong></p>
<p class="noindentinb"><strong><span class="blue">Ruler (preferably showing millimeters)</span></strong></p>
<p class="indent">You’ll find all sorts of shapes and sizes of magnets on eBay. As you can see in <a href="ch04.xhtml#ch4fig6">Figure 4-6</a>, I’m using a disk-shaped one with a diameter of 10 mm, but any neodymium magnet of a similar size should work. Note that I’ve put a bit of tape labeled <em>N</em> on one side of the magnet (more on this later).</p>
<div class="image" id="ch4fig6"><span epub:type="pagebreak" id="page_94"/><img alt="Image" src="../images/04fig06.jpg"/></div>
<p class="figcap"><em>Figure 4-6: The neodymium magnet used for Experiment 4</em></p>
<div class="note">
<p class="notep"><span class="red"><strong>WARNING</strong></span> <em>Neodynmium magnets are very strong, so be careful when handling them. If two of them get stuck together, it can be hard to separate them.</em></p>
</div>
<h4 class="h4" id="ch00lev1sec109"><strong>Construction</strong></h4>
<p class="noindent">The program repeatedly scrolls a number across the micro:bit’s display. This number represents the overall magnetic field strength detected by the magnetometer. We are going to measure the field strength at various distances from the magnet.</p>
<ol>
<li class="noindent">Go to <em><a href="https://github.com/simonmonk/mbms/">https://github.com/simonmonk/mbms/</a></em> to access the book’s code repository and click the link for <strong>Experiment 4: Magnetic Fields</strong>. Once the program has opened, click <strong>Download</strong> and then copy the hex file onto your micro:bit. If you get stuck on this, head back to <a href="ch01.xhtml#ch01">Chapter 1</a>, where the process of getting programs onto your micro:bit is explained in full.
<p class="indent">If you prefer to use Python, download the code for this project from the same website, along with instructions for downloading and using the book examples. The Python file for this experiment is <em>Experiment_04.py</em>.</p></li>
<li class="noindent">Set your magnet on a flat surface so that it’s balanced on its curved edge. A neodymium magnet is so strong that if you set it down in this way, it will align itself with Earth’s magnetic field (by spinning until one side is facing north), <span epub:type="pagebreak" id="page_95"/>just like a compass needle. Allow your magnet to do this and then put a piece of tape on the side that’s facing north. (You might need to use the Compass project, described earlier in this chapter, to find north so you don’t accidentally mark south instead.)</li>
<li class="noindent">Align your ruler so the 0 cm mark is pointing north and the 30 cm mark is pointing south, as shown in <a href="ch04.xhtml#ch4fig7">Figure 4-7</a>. The ruler allows you to make sure the magnet continues to face north so that the effect of Earth’s magnetic field remains constant.
<div class="image" id="ch4fig7"><img alt="Image" src="../images/04fig07.jpg"/></div>
<p class="figcap"><em>Figure 4-7: Place the ruler in the north–south direction to make sure your magnet continues to face north.</em></p></li>
<li class="noindent">Set the magnet on its curved edge next to the 1 cm mark on the ruler. Make sure the north side is facing the micro:bit. Point the micro:bit south and align its edge with the 0 cm mark. Record the reading displayed on the micro:bit in the following table, in the 1 cm row. The unit of magnetic field strength is a <em>tesla</em> (which is a very, very strong magnetic field), so the readings from the micro:bit are in <em>microtesla</em> or millionths of a Tesla, represented by µT).
<table class="all">
<colgroup>
<col style="width:50%"/>
<col style="width:50%"/>
</colgroup>
<thead>
<tr>
<td class="table-h" style="vertical-align: bottom;"><span epub:type="pagebreak" id="page_96"/><p class="tab_th"><strong>Distance from micro:bit to magnet (cm)</strong></p></td>
<td class="table-h" style="vertical-align: bottom;"><p class="tab_th"><strong>Magnetic field strength (µT)</strong></p></td>
</tr>
</thead>
<tbody>
<tr>
<td class="table-b" style="vertical-align: top;"><p class="taba">1</p></td>
<td class="table-b" style="vertical-align: top;"><p class="taba"><strong>___________________________________</strong></p></td>
</tr>
<tr>
<td class="table-v" style="vertical-align: top;"><p class="taba">2</p></td>
<td class="table-v" style="vertical-align: top;"><p class="taba"><strong>___________________________________</strong></p></td>
</tr>
<tr>
<td class="table-b" style="vertical-align: top;"><p class="taba">3</p></td>
<td class="table-b" style="vertical-align: top;"><p class="taba"><strong>___________________________________</strong></p></td>
</tr>
<tr>
<td class="table-v" style="vertical-align: top;"><p class="taba">4</p></td>
<td class="table-v" style="vertical-align: top;"><p class="taba"><strong>___________________________________</strong></p></td>
</tr>
<tr>
<td class="table-b" style="vertical-align: top;"><p class="taba">5</p></td>
<td class="table-b" style="vertical-align: top;"><p class="taba"><strong>___________________________________</strong></p></td>
</tr>
<tr>
<td class="table-v" style="vertical-align: top;"><p class="taba">6</p></td>
<td class="table-v" style="vertical-align: top;"><p class="taba"><strong>___________________________________</strong></p></td>
</tr>
<tr>
<td class="table-b" style="vertical-align: top;"><p class="taba">7</p></td>
<td class="table-b" style="vertical-align: top;"><p class="taba"><strong>___________________________________</strong></p></td>
</tr>
<tr>
<td class="table-v" style="vertical-align: top;"><p class="taba">8</p></td>
<td class="table-v" style="vertical-align: top;"><p class="taba"><strong>___________________________________</strong></p></td>
</tr>
<tr>
<td class="table-b" style="vertical-align: top;"><p class="taba">9</p></td>
<td class="table-b" style="vertical-align: top;"><p class="taba"><strong>___________________________________</strong></p></td>
</tr>
<tr>
<td class="table-v" style="vertical-align: top;"><p class="taba">10</p></td>
<td class="table-v" style="vertical-align: top;"><p class="taba"><strong>___________________________________</strong></p></td>
</tr>
</tbody>
</table></li>
<li class="noindent">Move the magnet so it’s next to the 2 cm mark on the ruler. Enter the new number displayed on the micro:bit in the corresponding row in the table. Repeat this process for all the readings up to 10 cm. Notice that the field strength decreases quickly as you move the magnet away from the micro:bit.</li>
<li class="noindent">Once you’ve taken all the readings, try plotting a chart of your results. Make the vertical axis, or <em>Y axis</em>, show the field strength in µT and plot the distance of the magnet from the micro:bit in cm against the horizontal axis, or <em>X axis</em>.
<p class="indent">You can plot this graph by hand on paper, or, if you prefer, you can make a copy of the Google Sheets spreadsheet I’ve created for this experiment and then replace my readings with the numbers you have just written down. You will find a link to this spreadsheet at <em><a href="https://github.com/simonmonk/mbms/">https://github.com/simonmonk/mbms/</a></em>. Open this link and, from the spreadsheet menu, select <strong>File</strong>▸<strong>Make a Copy</strong> to make <span epub:type="pagebreak" id="page_97"/>your own copy. <a href="ch04.xhtml#ch4fig8">Figure 4-8</a> shows the completed spreadsheet with a chart of the readings underneath it.</p>
<p class="indent">Note that your readings might be different, as your magnet may be weaker or stronger.</p>
<div class="image" id="ch4fig8"><img alt="Image" src="../images/04fig08.jpg"/></div>
<p class="figcap"><em>Figure 4-8: Make a graph of your results.</em></p></li>
</ol>
<p class="indent">We’ll discuss these results in “How It Works: The Strength of Magnets” on <a href="ch04.xhtml#page_99">page 99</a>.</p>
<h4 class="h4" id="ch00lev1sec110"><strong>Code</strong></h4>
<p class="noindent">The code for this experiment is simple. It takes a reading, displays it, and then repeats.</p>
<h5 class="h5" id="ch00lev1sec111"><span epub:type="pagebreak" id="page_98"/><strong>Blocks Code</strong></h5>
<p class="noindent">Here is the Blocks code for this project.</p>
<div class="image"><img alt="Image" src="../images/f0098-01.jpg"/></div>
<p class="indent">The <code>show number</code> block displays the result of the <code>magnetic force</code> block inside the <code>forever</code> block.</p>
<p class="indent">The <code>magnet force</code> block has four options, which you can see in the drop-down menu of this block. You can either get a separate reading for the force in one of the three dimensions X, Y, or Z, or you can get the combined force measurement from all three dimensions. We will use the combined measurement, which is the <code>strength</code> option in the drop-down menu.</p>
<h5 class="h5" id="ch00lev1sec112"><strong>MicroPython Code</strong></h5>
<p class="noindent">Here is the MicroPython version of the code:</p>
<div class="programs1"><span class="green">from</span> microbit <span class="green">import</span> <span class="purple">*</span><br/><span class="green">while</span> <span class="green">True</span><span class="purple">:</span><br/>    display<span class="purple">.</span>scroll<span class="purple">(</span><span class="blue1">str</span><span class="purple">(</span><span class="blue1">int</span><span class="purple">(</span>compass<span class="purple">.</span>get_field_strength<span class="purple">()</span> <span class="purple">/</span> <span class="blue1">1300</span><span class="purple">)))</span></div>
<p class="indent">In MicroPython, the <code>get_field_strength</code> function takes readings from the micro:bit’s magnetometer. Unlike the <code>magnetic force</code> block of the Blocks code, the MicroPython code does not specify the units for the measurement it returns, but the reading we get back is about 1,300 times the reading reported by the equivalent <code>magnetic force</code> block. Therefore, divide the number by 1,300 and then convert this value with the <code>int</code> function to make it an integer.</p>
<p class="indent">Use the <code>str</code> function to convert the number to a text string so the <code>scroll</code> function can display it on the micro:bit screen.</p>
<h4 class="h4" id="ch00lev1sec113"><strong>Things to Try</strong></h4>
<p class="noindent">Using the program for Experiment 4, try moving the magnet farther and farther away to see how far away the magnet can be and still show up on your micro:bit.</p>
<h4 class="h4" id="ch00lev1sec114"><span epub:type="pagebreak" id="page_99"/><strong>How It Works: The Strength of Magnets</strong></h4>
<p class="noindent">The chart in <a href="ch04.xhtml#ch4fig8">Figure 4-8</a> shows that as you move the magnet away from the micro:bit, the magnetic field strength falls very rapidly at first and then gradually levels off. In fact, the relationship between magnetic field strength and distance from the magnet follows something called the <em>inverse square rule</em>. That is, the field strength is proportional to 1 divided by the square root of the distance from the magnet.</p>
<p class="indent">What this means is that when the distance between the magnet and the micro:bit doubles, the field strength falls to a quarter of its previous strength.</p>
<p class="indent">The strength of Earth’s magnetic field when measured on the ground ranges from 25 to 65 µT. When you measure the magnetic force without a magnet nearby, you should get readings in this range. Even the super-strong neodymium magnet used in this experiment has a field strength of only a few hundred µT at a distance of a few centimeters. Magnets that are used to look inside human bodies during magnetic resonance imaging (MRI) scans typically have a field strength (where the person lies) of 0.5 to 1.5 T. That’s several thousand times stronger than the neodymium magnet. This is why you have to take off any metal you are wearing when you go into an MRI scanner!</p>
<h3 class="h3" id="ch00lev1sec115"><strong>PROJECT: MAGNETIC DOOR ALARM</strong></h3>
<div class="image"><img alt="Image" src="../images/common3.jpg"/></div>
<p class="difficulty"><em>Difficulty: Medium</em></p>
<p class="noindent">We’re going to create a door alarm! By attaching a magnet to a door and a micro:bit to a door frame, the Mad Scientist can be alerted to the arrival of guests. The micro:bit will sound an alarm when it detects a change in the strength of the magnetic field. This is exactly what happens when someone opens the door, moving the magnet farther away.</p>
<p class="indent"><a href="ch04.xhtml#ch4fig9">Figure 4-9</a> shows the project attached to the Mad Scientist’s door.</p>
<div class="image" id="ch4fig9"><span epub:type="pagebreak" id="page_100"/><img alt="Image" src="../images/04fig09.jpg"/></div>
<p class="figcap"><em>Figure 4-9: A magnetic door alarm</em></p>
<h4 class="h4" id="ch00lev1sec116"><strong>What You’ll Need</strong></h4>
<p class="noindent">For this project, you will need the following items:</p>
<p class="noindentint"><strong><span class="blue">Micro:bit</span></strong></p>
<p class="noindentin"><strong><span class="blue">3 × Alligator clip cables</span></strong> To connect the micro:bit to the speaker. These cables should be at least 15 cm (6 inches) long.</p>
<p class="noindentin"><strong><span class="blue">USB power adapter or switched 3V battery pack</span></strong> To power the micro:bit and speaker. See the <a href="app01.xhtml">appendix</a> for other options for powering your micro:bit.</p>
<p class="noindentin"><strong><span class="blue">Speaker</span></strong> You can use any of the methods for getting sound out of a micro:bit discussed in <a href="ch02.xhtml#ch02">Chapter 2</a>. Here, I used a Monk Makes Speaker for micro:bit.</p>
<p class="noindentin"><span epub:type="pagebreak" id="page_101"/><strong><span class="blue">Adhesive putty or self-adhesive pads</span></strong> To attach the micro:bit and speaker to the door frame and the magnet to the door</p>
<p class="noindentin"><strong><span class="blue">Neodymium magnet</span></strong> As used in Experiment 4</p>
<h4 class="h4" id="ch00lev1sec117"><strong>Construction</strong></h4>
<p class="noindent">Make sure to test the project before you install it on your door, since you’ll need to experiment a little to determine the right field strength to use. You’ll also need to calibrate the magnetometer before sticking it to a door frame.</p>
<ol>
<li class="noindent">Connect the speaker to the micro:bit using the three alligator cables, as shown in <a href="ch04.xhtml#ch4fig9">Figure 4-9</a>.
<p class="indent">It’s a good idea to color-code your cables by using black for GND, red for 3V, and any other color for the audio connection from pin 0 of the micro:bit. That way, you won’t forget which cable is which. You’ll need to place the speaker at least 15 cm away from the micro:bit, as speakers have strong magnets that can disrupt the micro:bit’s magnetometer.</p></li>
<li class="noindent">Go to <em><a href="https://github.com/simonmonk/mbms/">https://github.com/simonmonk/mbms/</a></em> to access the book’s code repository and click the link for <strong>Magnetic Alarm</strong>. Once the program has opened, click <strong>Download</strong> and then copy the hex file onto your micro:bit. If you get stuck on this, head back to <a href="ch01.xhtml#ch01">Chapter 1</a>.
<p class="indent">If you prefer to use Python, you’ll find the code for this at the same website, along with instructions for downloading and using the book’s examples. The Python file for this experiment is <em>ch_04_Magnetic_Alarm.py</em>.</p></li>
<li class="noindent">Once you have programmed the micro:bit, when you put the magnet close to the micro:bit, the speaker should be silent. Then when you move the magnet more than a few inches away, the alarm should sound. Once the program is working, disconnect the micro:bit from your computer and attach it to either a USB power adapter or battery pack. Then attach the micro:bit and speaker to your door frame. Fix the magnet to the door itself, within an inch (2.5 cm) of the micro:bit.
<div class="note">
<p class="notep"><span epub:type="pagebreak" id="page_102"/><span class="red"><strong>WARNING</strong></span> <em>Adhesive putty can make a mess, so make sure you get permission before you start sticking things to the door and frame.</em></p>
</div>
<p class="indent">If you’re using a USB power adapter, you’ll need an electrical outlet close enough to the door for the USB power adapter to reach.</p></li>
</ol>
<div class="image"><img alt="Image" src="../images/f0102-01.jpg"/></div>
<h4 class="h4" id="ch00lev1sec118"><strong>Code</strong></h4>
<p class="noindent">In both versions of the code, the magnetic field strength is first read and then compared with a threshold. If the threshold is exceeded, then a note is played.</p>
<h5 class="h5" id="ch00lev1sec119"><strong>Blocks Code</strong></h5>
<p class="noindent">Here is the Blocks code for the project.</p>
<div class="image"><img alt="Image" src="../images/f0102-02.jpg"/></div>
<p class="indent"><span epub:type="pagebreak" id="page_103"/>This code is basically saying that if the micro:bit reads a magnetic force strength of less than 100 µT, it should play a particular note for 4 beats. Since the strength of Earth’s magnetic field at the surface has a range of 25 to 65 µT, setting a threshold at 100 µT should ensure we’re detecting the magnet and not just picking up Earth’s magnetic field.</p>
<h5 class="h5" id="ch00lev1sec120"><strong>MicroPython Code</strong></h5>
<p class="noindent">Here’s the MicroPython version of the program:</p>
<div class="programs1"><span class="green">from</span> microbit <span class="green">import</span> <span class="purple">*</span><br/><span class="green">import</span> music<br/><br/><span class="green">while True</span><span class="purple">:</span><br/>    <span class="green">if</span> compass<span class="purple">.</span>get_field_strength<span class="purple">()</span> <span class="purple">&lt;</span> <span class="blue1">160000</span><span class="purple">:</span><br/>        music<span class="purple">.</span>pitch<span class="purple">(</span><span class="blue1">523</span><span class="purple">,</span> <span class="blue1">1000</span><span class="purple">)</span></div>
<p class="indent">This code works in the same way as the Blocks code, but because the units of <code>get_field_strength</code> are different from those of the <code>magnetic force</code> block, the threshold for sounding the alarm is different than in the Blocks code version. The units of the field strength returned by <code>get_field_strength</code> are not specified in its documentation (<em><a href="https://microbit-micropython.readthedocs.io/en/latest/compass.html">https://microbit-micropython.readthedocs.io/en/latest/compass.html</a></em>), so I chose the threshold value of 160,000 by trial and error.</p>
<p class="indent">We supply the command <code>music.pitch</code> with a frequency of tone to produce. Unlike with the Blocks code, here we have to specify the frequency of the sound wave rather than a note. A frequency of 523 hertz (Hz) is the frequency of high C. The <code>music.pitch</code> command also requires a length of time to play the note. Here we’ve told the micro:bit to play the note for 1,000 milliseconds, or 1 second.</p>
<h4 class="h4" id="ch00lev1sec121"><strong>Things to Try</strong></h4>
<p class="noindent">Could a thief defeat your new alarm? Try placing a second magnet on the other side of the door frame, opposite the micro:bit. If the second magnet is close enough to the micro:bit, you may be able to open the door without triggering the alarm.</p>
<p class="indent"><span epub:type="pagebreak" id="page_104"/>You could also change the alarm tone by changing the frequency to some other value. The following table shows some notes and their corresponding frequencies (to the nearest whole number).</p>
<table class="all">
<colgroup>
<col style="width:50%"/>
<col style="width:50%"/>
</colgroup>
<thead>
<tr>
<td class="table-h" style="vertical-align: top;"><p class="tab_th"><strong>Note</strong></p></td>
<td class="table-h" style="vertical-align: top;"><p class="tab_th"><strong>Frequency (Hz)</strong></p></td>
</tr>
</thead>
<tbody>
<tr>
<td class="table-b" style="vertical-align: top;"><p class="taba">Middle C</p></td>
<td class="table-b" style="vertical-align: top;"><p class="taba">262</p></td>
</tr>
<tr>
<td class="table-v" style="vertical-align: top;"><p class="taba">D</p></td>
<td class="table-v" style="vertical-align: top;"><p class="taba">294</p></td>
</tr>
<tr>
<td class="table-b" style="vertical-align: top;"><p class="taba">E</p></td>
<td class="table-b" style="vertical-align: top;"><p class="taba">330</p></td>
</tr>
<tr>
<td class="table-v" style="vertical-align: top;"><p class="taba">F</p></td>
<td class="table-v" style="vertical-align: top;"><p class="taba">349</p></td>
</tr>
<tr>
<td class="table-b" style="vertical-align: top;"><p class="taba">G</p></td>
<td class="table-b" style="vertical-align: top;"><p class="taba">392</p></td>
</tr>
<tr>
<td class="table-v" style="vertical-align: top;"><p class="taba">A</p></td>
<td class="table-v" style="vertical-align: top;"><p class="taba">440</p></td>
</tr>
<tr>
<td class="table-b" style="vertical-align: top;"><p class="taba">B</p></td>
<td class="table-b" style="vertical-align: top;"><p class="taba">494</p></td>
</tr>
<tr>
<td class="table-v" style="vertical-align: top;"><p class="taba">High C</p></td>
<td class="table-v" style="vertical-align: top;"><p class="taba">523</p></td>
</tr>
</tbody>
</table>
<p class="indent">You can find a full table of musical notes and their frequencies at <em><a href="https://www.liutaiomottola.com/formulae/freqtab.htm">https://www.liutaiomottola.com/formulae/freqtab.htm</a></em>.</p>
<h3 class="h3" id="ch00lev1sec122"><strong>SUMMARY</strong></h3>
<p class="noindent">The micro:bit’s magnetometer is useful for more than working out which direction you’re facing. In this chapter, we’ve explored how you can use it to sense the presence of a magnet and even to do some science by measuring magnetic field strength.</p>
<p class="indent">In the next chapter, we’ll explore one of the micro:bit’s other built-in sensors—its accelerometer.</p>
</body></html>