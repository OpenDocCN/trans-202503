<html><head></head><body>
<h2 class="h1-part" id="part05"><span epub:type="pagebreak" id="page_179"/><span class="blue1">Web Applications</span></h2>


<h2 class="h2" id="ch15"><span epub:type="pagebreak" id="page_180"/><strong>15<br/>Building your First Website</strong></h2>
<p class="noindent"><span class="blue1">In this project you’ll build a simple website with headings, paragraphs, images, links, and buttons. You’ll use HTML to create the page and CSS to style it how you want. The skills you’ll learn here can be used to build any website you’d like.</span></p>
<div class="image"><span epub:type="pagebreak" id="page_181"/><img src="../images/f0181-01.jpg" alt="image"/></div>
<p class="cap"><span class="blue1"><strong>PARTS REQUIRED</strong></span></p>
<p class="cap1">Raspberry Pi</p>
<h3 class="h3" id="lev145"><span epub:type="pagebreak" id="page_182"/><span class="blue1"><strong>SETTING UP THE PROJECT FILES</strong></span></h3>
<p class="noindent">For this project you won’t need any circuitry; everything is done in your Raspberry Pi desktop computer. You’ll use the Text Editor program to create HTML and CSS files. To access the Text Editor, from the desktop’s main menu go to <strong>Accessories</strong> <span class="ent">▸</span> <strong>Text Editor</strong>.</p>
<p class="indent">This project requires several files, so we suggest you create a folder specifically for this project. Create a new folder inside your <em>Projects</em> directory called <em>Web_Applications</em>, and then create a project folder called <em>Project_15</em>.</p>
<p class="indent">After opening the Text Editor, create two blank files with <small>CTRL</small>-N; you’ll have to do this once for each file. Then save those files within the <em>Project_15</em> folder, and name them <em>index.html</em> and <em>style.css</em> as shown in <a href="ch15.xhtml#ch15fig1">Figure 15-1</a>. You can download the scripts a<em>t <a href="https://www.nostarch.com/RaspberryPiProject/">https://www.nostarch.com/RaspberryPiProject/</a></em>.</p>
<div class="image"><a id="ch15fig1"/><img src="../images/f0182-01.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 15-1:</strong> Creating the HTML and CSS files</p>
<h3 class="h3" id="lev146"><span class="blue1"><strong>SETTING UP AN HTML WEB PAGE</strong></span></h3>
<p class="noindent"><em>HTML</em>, short for <em>HyperText Markup Language</em>, is the predominant markup language used to create web pages. Web browsers were designed to read HTML <em>tags</em>, which tell the browser how to display content on the page. Let’s take a look at how tags work.</p>
<h4 class="h4" id="lev147"><span class="blue1"><strong>Setting Up the Basic Content</strong></span></h4>
<p class="noindent">The following snippet shows the basic structure of an HTML document. Open your <em>index.html</em> file using the Text Editor and enter the content from <a href="ch15.xhtml#ch15list1">Listing 15-1</a>.</p>
<p class="listing" id="ch15list1"><strong>LISTING 15-1:</strong> The basic structure of an HTML web page</p>
<div class="box">
<pre>  &lt;!DOCTYPE html&gt;<br/><span class="ent">➊</span> &lt;html&gt;<br/><span class="ent">➋</span> &lt;head&gt;<br/>  &lt;/head&gt;<br/><span class="ent">➌</span> &lt;body&gt;<br/>  &lt;/body&gt;<br/>  &lt;/html&gt;</pre>
</div>
<p class="indent">This document is simply a list of HTML tags, denoted by the enclosing <code>&lt; &gt;</code> symbols. The first line of any HTML document is <span epub:type="pagebreak" id="page_183"/>always <code>&lt;!DOCTYPE html&gt;</code>. This tells the web browser this document is an HTML file.</p>
<p class="indent">The remaining structure needs to be sandwiched between the tags <code>&lt;html&gt;</code> <span class="ent">➊</span> and <code>&lt;/html&gt;</code>, the former indicating the beginning of a web page and the latter indicating the end of the page. Note that the closing tag must have a <code>/</code> after the <code>&lt;</code> symbol; this is true of all HTML closing tags. Not all HTML tags need a closing tag, however, as you’ll see later.</p>
<p class="indent">HTML documents have two main parts: the head and the body. The <em>head</em>, which goes within the tags <code>&lt;head&gt;</code> <span class="ent">➋</span> and <code>&lt;/head&gt;</code>, is where you insert data about the HTML document that is not directly visible on the page but that adds functionality to the web page, like the title that shows up in the browser tab, scripts, styles, and more. The <em>body</em>, which falls within the tags <code>&lt;body&gt;</code> <span class="ent">➌</span> and <code>&lt;/body&gt;</code>, includes the content of the page, such as headings, text, images, tables, and so on.</p>
<h4 class="h4" id="lev148"><span class="blue1"><strong>Adding the Title, Headings, and Paragraphs</strong></span></h4>
<p class="noindent">To see how your web page looks, go to the taskbar menu and open Chromium, and then drag the <em>index.html</em> file into the Chromium web browser. At the moment, you should see only a blank page, because you haven’t added anything to the HTML file yet. In this section, you’ll add the title, headings, and paragraphs.</p>
<h5 class="h5"><strong>Using Title Tags</strong></h5>
<p class="noindent">The title goes between the <code>&lt;title&gt;</code> and <code>&lt;/title&gt;</code> tags, which should go within the <code>&lt;head&gt;</code> and <code>&lt;/head&gt;</code> tags. Add a title to your file, as shown here:</p>
<div class="box">
<pre><span class="ash">&lt;head&gt;</span><br/>&lt;title&gt;Max - The Dog&lt;/title&gt;<br/><span class="ash">&lt;/head&gt;</span></pre>
</div>
<div class="note">
<p class="notet"><strong>NOTE</strong></p>
<p class="notep"><em>Instead of dragging the file into the browser again, you can simply refresh the web page after saving the HTML; the changes are updated immediately.</em></p>
</div>
<p class="indent">If you save <em>index.html</em> and again drag the file into your browser, don’t be surprised to still see a blank page. The title shows in the web browser tab, not on the page itself. We titled our web page “Max – The Dog,” but you can title your page whatever you’d like.</p>
<h5 class="h5"><strong>Using Heading Tags</strong></h5>
<p class="noindent">You can use headings to structure the text on the web page. Heading tags begin with an <code>h</code> followed by a number that indicates the heading level. For example, <code>&lt;h1&gt;</code> and <code>&lt;/h1&gt;</code> are the tags for heading 1, or the top level; <code>&lt;h2&gt;</code> and <code>&lt;/h2&gt;</code> are for heading 2, and so on until heading 6, which is the bottom level of heading. Heading tags should go between <span epub:type="pagebreak" id="page_184"/>the <code>&lt;body&gt;</code> and <code>&lt;/body&gt;</code> tags. Make a couple of headings and place them in the body of your file now:</p>
<div class="box">
<pre><span class="ash">&lt;body&gt;</span><br/>  &lt;h1&gt;MAX - THE DOG&lt;/h1&gt;<br/>  &lt;h2&gt;About Max&lt;/h2&gt;<br/><span class="ash">&lt;/body&gt;</span></pre>
</div>
<p class="indent">We’ve added two headings to our page: “MAX – THE DOG” at the top level and “About Max” at a level below that. Now it’s time to put some text under those headings.</p>
<h5 class="h5"><strong>Using Paragraph Tags</strong></h5>
<p class="noindent">You should put most of your readable content in paragraphs. Every paragraph needs to go between the <code>&lt;p&gt;</code> and <code>&lt;/p&gt;</code> tags. Add a paragraph or two to your file, as shown here:</p>
<div class="box">
<pre>  <span class="ash">&lt;h2&gt;About Max&lt;/h2&gt;</span><br/>  &lt;p&gt;Howdy, I'm Max. I'm an aspiring police dog living in Portugal.<br/>I enjoy barking, running, and playing catch. I like meat, bones, and<br/>leftovers.&lt;/p&gt;<br/>  &lt;p&gt;My favorite TV series is Inspector Rex.&lt;/p&gt;</pre>
</div>
<p class="indent">You now have your very own web page! Feel free to add as many paragraphs and headings as you’d like.</p>
<h4 class="h4" id="lev149"><span class="blue1"><strong>Seeing Your Web Page</strong></span></h4>
<p class="noindent">Save your <em>index.html</em> document and refresh the web page. <a href="ch15.xhtml#ch15fig2">Figure 15-2</a> shows how Max’s web page looks at the moment.</p>
<div class="image"><a id="ch15fig2"/><img src="../images/f0184-01.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 15-2:</strong> A simple HTML page</p>
<p class="indent">As you can see, HTML doesn’t do much besides adding raw text to your page; it’s mainly a series of paragraphs and doesn’t look pretty at all. You’re going to use CSS in a later section to style details and make your page look attractive.</p>
<h4 class="h4" id="lev150"><span epub:type="pagebreak" id="page_185"/><span class="blue1"><strong>Adding Links, Images, and Buttons</strong></span></h4>
<p class="noindent">Any self-respecting website should contain way more than just text. We’ll show you how to add images, buttons, more pages, and links to other pages too.</p>
<h5 class="h5"><strong>Including Hyperlinks</strong></h5>
<p class="noindent">To add a hyperlink to another page on the internet, add the <code>&lt;a&gt;</code> tag anywhere between the <code>&lt;body&gt;</code> and <code>&lt;/body&gt;</code> tags. For example, you can insert a hyperlink to the Inspector Rex Wikipedia page like this:</p>
<div class="box">
<pre>&lt;a href="https://en.wikipedia.org/wiki/Inspector_Rex"&gt;Inspector<br/>Rex&lt;/a&gt;</pre>
</div>
<p class="indent">The <code>a</code> stands for <em>anchor</em> and the text that goes between these tags is called <em>anchor text</em>, which is <code>Inspector Rex</code> in this case. Inside the <code>&lt;a&gt;</code> tag, we’ve included the <code>href</code> attribute, which specifies where the link should go. The anchor text is what the page’s visitors see on the page; when they click that text, the Inspector Rex Wikipedia web page opens.</p>
<p class="indent">Most websites have multiple pages you can navigate through. That navigation between pages is also done using hyperlinks. For example, if you want to insert a new page—say, a photo gallery for Max—you would link to it like this:</p>
<div class="box">
<pre>&lt;a href="gallery.html"&gt;Take a look at my gallery&lt;/a&gt;</pre>
</div>
<p class="indent">On its own, this link won’t take you anywhere because the page it’s pointing to doesn’t yet exist. You have to create the <em>gallery.html</em> file and save it in the same folder as your <em>index.html</em> file. You won’t create another page in this project, but now you know how to do it.</p>
<h5 class="h5"><strong>Including Images</strong></h5>
<p class="noindent">Images make any website more appealing. To insert an image, you use the <code>&lt;img&gt;</code> tag, which doesn’t have a closing tag because you list the image you want shown within the angle brackets, <code>&lt;&gt;</code>. The file for the image you want to include has to be saved in the website’s folder—in this case, <em>Project_15</em>—to make it onto the web page. To insert an image called <em>max.jpg</em>, you use the following:</p>
<div class="box">
<pre>&lt;img src="max.jpg"&gt;</pre>
</div>
<p class="indent">The <code>src</code> indicates the location of the image file. Because we have the image stored in the website’s folder, we can just use the <span epub:type="pagebreak" id="page_186"/>image filename. Replace <code>max.jpg</code> in the code with your own image filename. You can also use a hyperlink to an image by replacing <code>max.jpg</code> with the hyperlink.</p>
<p class="indent">You can resize your image either by editing the image file manually or by using the <code>height</code> attribute within the <code>&lt;img&gt;</code> tag. For example, to resize the image to 350 pixels in height, you use:</p>
<div class="box">
<pre>&lt;img src="max.jpg" height="350"&gt;</pre>
</div>
<p class="indent">The width adjusts automatically according to the height. You could also change the width with the <code>width</code> attribute and the height would readjust automatically.</p>
<p class="indent">The <code>&lt;img&gt;</code> tag must be inside a <code>&lt;p&gt;</code> or a <code>&lt;div&gt;</code> tag—you can use a <code>&lt;div&gt;</code> tag to create a section inside your body content (see this in <a href="ch15.xhtml#ch15list2">Listing 15-2</a>).</p>
<h5 class="h5"><strong>Including Buttons</strong></h5>
<p class="noindent">To include a button on your page, insert the label you want for your button between the <code>&lt;button&gt;</code> and <code>&lt;/button&gt;</code> tags. We want to insert a button that leads to a funny police dog chase video, so we use:</p>
<div class="box">
<pre>&lt;button&gt;Funny police dog chase&lt;/button&gt;</pre>
</div>
<p class="indent">To make the button clickable so it redirects you to the video page, insert the button tags between the <code>&lt;a&gt;</code> hyperlink tags to the video in question:</p>
<div class="box">
<pre>&lt;a href="https://youtu.be/znM9YD2J3Cw"&gt;&lt;button&gt;Funny police dog<br/>chase&lt;/button&gt;&lt;/a&gt;</pre>
</div>
<h5 class="h5"><strong>Viewing Max’s HTML File</strong></h5>
<p class="noindent">We’ve added an image, a link, and a button to Max’s web page. The code in <a href="ch15.xhtml#ch15list2">Listing 15-2</a> shows how the HTML document looks at the moment.</p>
<p class="listing" id="ch15list2"><strong>LISTING 15-2:</strong> The HTML document for Max’s web page with a link, an image, and a button</p>
<div class="box">
<pre>  &lt;!DOCTYPE html&gt;<br/>  &lt;html&gt;<br/>  &lt;head&gt;<br/>  &lt;title&gt;Max - The Dog&lt;/title&gt;<br/>  &lt;/head&gt;<br/><span epub:type="pagebreak" id="page_187"/>  &lt;body&gt;<br/><span class="ent">➊</span> &lt;header&gt;<br/><span class="ent">➋</span>   &lt;div class="title"&gt;<br/>      &lt;h1&gt;MAX - THE DOG&lt;/h1&gt;<br/><span class="ent">➌</span>   &lt;/div&gt;<br/><span class="ent">➍</span> &lt;/header&gt;<br/><br/><span class="ent">➎</span> &lt;main&gt;<br/>    &lt;h2&gt;About Max&lt;/h2&gt;<br/>    &lt;p&gt;Howdy, I'm Max. I'm an aspiring police dog living in Portugal.<br/>  I enjoy barking, running, and playing catch. I like meat, bones, and<br/>  leftovers.&lt;/p&gt;<br/>    &lt;p&gt;My favorite TV series is &lt;a href="https://en.wikipedia.org/<br/>  wiki/Inspector_Rex"&gt;Inspector Rex&lt;/a&gt;.&lt;/p&gt;<br/>    &lt;p&gt;&lt;img src="max.jpg" width="350"&gt;&lt;/p&gt;<br/>    &lt;a href="https://youtu.be/znM9YD2J3Cw"&gt;&lt;button&gt;Funny police dog<br/>  chase&lt;/button&gt;&lt;/a&gt;<br/><span class="ent">➏</span> &lt;/main&gt;<br/>  &lt;/body&gt;<br/>  &lt;/html&gt;</pre>
</div>
<p class="indent">Note that we’ve added three new tags:</p>
<ul>
<li class="noindent"><code>&lt;header&gt;</code> <span class="ent">➊</span> and <code>&lt;/header&gt;</code> <span class="ent">➍</span> contain introductory content. Inside these tags is the first-level heading.</li>
<li class="noindent"><code>&lt;div class="title"&gt;</code> <span class="ent">➋</span> and <code>&lt;/div&gt;</code> <span class="ent">➌</span> define a division or section. The <code>class</code> attribute called <code>title</code> indicates that an HTML element is a member of a particular class—in this case, the <code>title</code> class, but you can give it any name you want. Using the <code>class</code> attribute is useful because it allows you to define the same style in CSS for multiple elements that belong to the same class.</li>
<li class="noindent"><code>&lt;main&gt;</code> <span class="ent">➎</span> and <code>&lt;/main&gt;</code> <span class="ent">➏</span> specify the main content of a document. This is where you should place content that is unique to the document—that is, content that isn’t repeated in the website. A single HTML document shouldn’t have more than one <code>&lt;main&gt;</code> element.</li>
</ul>
<p class="indent">We structured the HTML content this way because it makes it easier to use CSS later to format the page. <a href="ch15.xhtml#ch15fig3">Figure 15-3</a> shows how the web page looks with the HTML file in <a href="ch15.xhtml#ch15list2">Listing 15-2</a>.</p>
<div class="image"><span epub:type="pagebreak" id="page_188"/><a id="ch15fig3"/><img src="../images/f0188-01.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 15-3:</strong> Max’s web page with a link, an image, and a button</p>
<h3 class="h3" id="lev151"><span class="blue1"><strong>STYLING YOUR PAGE WITH CSS</strong></span></h3>
<p class="noindent">Now you’ll add <em>CSS</em>, or <em>Cascading Style Sheets</em>, a style sheet language used to describe how the elements in a web page will look when rendered. You can add CSS either directly to the HTML file or in a separate file that you reference in the HTML file. In this project, you’ll create a separate file for the CSS document; this way, it’ll be easier to read both the CSS and HTML files and understand what they do.</p>
<h4 class="h4" id="lev152"><span class="blue1"><strong>Embedding a Style Sheet</strong></span></h4>
<p class="noindent">Before getting to the CSS document itself, you need to embed the style sheet in the <em>index.html</em> file so that the HTML knows to reference an external CSS file. To do this, add the following line between the <code>&lt;head&gt;</code> and <code>&lt;/head&gt;</code> tags:</p>
<div class="box">
<pre>&lt;link rel="stylesheet" type="text/css" href="style.css"&gt;</pre>
</div>
<p class="indent">This <code>&lt;link&gt;</code> tag tells the HTML file that you’re using an external style sheet to format how the page looks. The <code>rel</code> attribute specifies the nature of the external file, in this case that it is a style sheet—the CSS file—that will be used to alter the appearance of the page. The <code>type</code> attribute is set to <code>"text/css"</code> to indicate that you’re using a CSS file for the styles. The <code>href</code> attribute indicates the file location; again, since the file is in the website’s folder, you just need to reference the filename.</p>
<p class="indent">After you’ve added the link to refer to the style sheet, your header should look like <a href="ch15.xhtml#ch15list3">Listing 15-3</a>.</p>
<p class="listing" id="ch15list3"><span epub:type="pagebreak" id="page_189"/><strong>LISTING 15-3:</strong> Linking to a CSS style sheet in your HTML document</p>
<div class="box">
<pre><span class="ash">&lt;head&gt;</span><br/>    <span class="ash">&lt;title&gt;Max - The Dog&lt;/title&gt;</span><br/>    &lt;link rel="stylesheet" type="text/css" href="style.css"&gt;<br/><span class="ash">&lt;/head&gt;</span></pre>
</div>
<p class="indent">With this extra tag, the style sheet is connected to the HTML document. Creating a separate style sheet is useful because you can embed the same style sheet in several web pages with just one line.</p>
<h4 class="h4" id="lev153"><span class="blue1"><strong>Styling Your HTML Content</strong></span></h4>
<p class="noindent">To style your HTML content, CSS uses <em>selectors</em> that define which elements a set of CSS rules applies to. They have <em>properties</em>, which in turn have <em>values</em>. The code will look like this:</p>
<div class="box">
<pre><em>selector</em> {<br/>    <em>property</em>: <em>value</em>;<br/>}</pre>
</div>
<p class="indent">The set of rules that defines the style for a certain selector should go between curly brackets, <code>{}</code>. You attribute a value to a property with a colon (<code>:</code>), and every value should end with a semicolon (<code>;</code>). Each selector can have, and normally does have, more than one property.</p>
<h4 class="h4" id="lev154"><span class="blue1"><strong>Styling the Header</strong></span></h4>
<p class="noindent">If you’ve been following the instructions, you should have a <em>style.css</em> file inside the <em>Project_15</em> folder along with your <em>index.html</em> file. Open your <em>style.css</em> file and edit the header by entering the content in <a href="ch15.xhtml#ch15list4">Listing 15-4</a>.</p>
<p class="listing" id="ch15list4"><strong>LISTING 15-4:</strong> Styling the header with CSS</p>
<div class="box">
<pre>  header {<br/><span class="ent">➊</span>   background: url(background.jpg);<br/><span class="ent">➋</span>   background-size: cover;<br/><span class="ent">➌</span>   height: 70vh;<br/>  }</pre>
</div>
<p class="indent">In this listing, <code>header</code> is the selector, which means that the style rules you’re going to describe between curly brackets will apply to the header section of your web page. Remember that the header section is what goes between the <code>&lt;header&gt;</code> and <code>&lt;/header&gt;</code> tags and includes the introductory content. Here we insert a background image—a beautiful photo of Max. For that, we use the <code>background</code> property, whose value is <code>url(background.jpg)</code> <span class="ent">➊</span>; inside the <code>url()</code> you write the path directory for the image. Replace <code>background.jpg</code> with the name of the image you want to use as the background. <span epub:type="pagebreak" id="page_190"/>Since you’re going to save the image file in the same folder as the HTML and CSS files, you reference only the image filename.</p>
<p class="indent">Assign the <code>cover</code> value to the <code>background-size</code> property <span class="ent">➋</span>. This says that the background image should fill the entire header section.</p>
<p class="indent">The <code>height</code> property has a value of <code>70vh</code> <span class="ent">➌</span>, which specifies the height of the header. You can use one of several units for the height, but we are using <code>vh</code> (viewport height), which is relative to 1 percent of the height of the viewport and ensures the header elements can fit into the viewport. This instruction means the header fills 70 percent of the web browser’s window regardless of its size. Experiment with other percentage values and see how your page looks.</p>
<p class="indent">Save the CSS file and refresh the browser tab that contains the HTML document in order to see how your newly styled web page looks.</p>
<h4 class="h4" id="lev155"><span class="blue1"><strong>Styling the title Class</strong></span></h4>
<p class="noindent">Now you’ll edit the <code>title</code> class, which includes any content that goes between the <code>&lt;div class="title"&gt;</code> and <code>&lt;/div&gt;</code> tags. These tags are between the <code>&lt;header&gt;</code> and <code>&lt;/header&gt;</code> tags, which means that the <code>header</code> is an <em>ancestor</em> of the <code>title</code> class. Add the snippet in <a href="ch15.xhtml#ch15list5">Listing 15-5</a> to your CSS file.</p>
<p class="listing" id="ch15list5"><strong>LISTING 15-5:</strong> Styling the <code>title</code> class</p>
<div class="box">
<pre>  .title {<br/><span class="ent">➊</span>   position: absolute;<br/><span class="ent">➋</span>   top: 50%;<br/><span class="ent">➌</span>   left: 50%;<br/><span class="ent">➍</span>   transform: translate(-50%, -40%);<br/><span class="ent">➎</span>   color: white;<br/><span class="ent">➏</span>   text-align: center;<br/>  }</pre>
</div>
<p class="indent">To select elements with a specific class, use a period (<code>.</code>) followed by the class name, like <code>.title</code>. We’ll walk you through each element.</p>
<h5 class="h5"><strong>Adjusting Positions</strong></h5>
<p class="noindent">You can position elements using the <code>top</code>, <code>bottom</code>, <code>left</code>, and <code>right</code> properties, but first you need to set the <code>position</code> property <span class="ent">➊</span>.</p>
<p class="indent">The way the elements are positioned on the page works differently depending on whether the <code>position</code> value is set to <code>static</code>, <code>relative</code>, <code>fixed</code>, or <code>absolute</code>.</p>
<div class="box4">
<p class="box-title"><span epub:type="pagebreak" id="page_191"/><span class="blue1"><strong>THE POSITION PROPERTY</strong></span></p>
<p class="box-p">The <code>position</code> property can have the following values:</p>
<p class="box-pt"><span class="codestrong">static</span></p>
<p class="box-pta">An element with the <code>static</code> value is positioned according to the normal flow of the page and is not affected by the <code>top</code>, <code>bottom</code>, <code>left</code>, and <code>right</code> properties. By default, HTML elements are <code>static</code>.</p>
<p class="box-pt"><span class="codestrong">relative</span></p>
<p class="box-pta">An element with the <code>relative</code> value is positioned relative to its default position using the <code>top</code>, <code>bottom</code>, <code>left</code>, and <code>right</code> properties.</p>
<p class="box-pt"><span class="codestrong">fixed</span></p>
<p class="box-pta">An element with the <code>fixed</code> value remains in the same position even when the page is scrolled. To position the elements on the viewport, use the <code>top</code>, <code>bottom</code>, <code>left</code>, and <code>right</code> properties.</p>
<p class="box-pt"><span class="codestrong">absolute</span></p>
<p class="box-pta">An element with the <code>absolute</code> value is positioned relative to its nearest ancestor. To adjust the position, use the <code>top</code>, <code>bottom</code>, <code>left</code>, and <code>right</code> properties.</p>
</div>
<p class="indent">In this case, we are using the <code>absolute</code> value. This means each element is positioned relative to its nearest ancestor, in this case the header section. Take a look at <a href="ch15.xhtml#ch15fig4">Figure 15-4</a> to understand how the <code>title</code> class elements are positioned in relation to the header.</p>
<div class="image"><a id="ch15fig4"/><img src="../images/f0191-01.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 15-4:</strong> Positioning the <code>title</code> class elements inside the header section</p>
<p class="indent">The <code>top</code> <span class="ent">➋</span> and <code>left</code> <span class="ent">➌</span> properties specify where each element is positioned in relation to its ancestor, given as a percentage, which represents how far across the page it appears, with <code>0%</code> being the far left and top edge of its ancestor. The <code>50%</code> values for <code>top</code> and <code>left</code> <span epub:type="pagebreak" id="page_192"/>move the top-left corner of the <code>title</code> class section to the middle of its ancestor. This means the top-left corner of the <code>title</code> class section, rather than its center point, will be positioned at the center of the header section; take a look at <a href="ch15.xhtml#ch15fig4">Figure 15-4</a> (A). You can adjust this with the <code>transform</code> property.</p>
<p class="indent">The <code>transform</code> property <span class="ent">➍</span>, with the <code>translate(–50%, –40%)</code> values, shifts the position of the element. The <code>–</code><code>50%</code> value moves the <code>title</code> class element 50 percent to the left in relation to its size, which will center it horizontally inside the header section—take a look at <a href="ch15.xhtml#ch15fig4">Figure 15-4</a> (B). We also apply <code>–</code><code>40%</code> to the vertical position, to move it 40 percent up from the bottom (see <a href="ch15.xhtml#ch15fig4">Figure 15-4</a> (C)). Try this with different values and see how it changes. The <code>–</code><code>50%</code> and <code>–</code><code>40%</code> work just fine for Max’s page, but you may want to move the text to a different position depending on your background image.</p>
<h5 class="h5"><strong>Setting Text Color and Alignment</strong></h5>
<p class="noindent">The <code>color</code> <span class="ent">➎</span> and <code>text-align</code> <span class="ent">➏</span> properties define text color and text alignment, respectively. You can set colors with their name—HTML recognizes basic color names—or by using a hexadecimal or RGB color code. We’re using hexadecimal. You can google <em>hexadecimal color picker</em> for a hexadecimal reference to a specific color. The <code>text-align</code> property takes several values like <code>left</code>, <code>right</code>, <code>center</code>, and <code>justify</code>, to align text to the left or right or center or justify it, respectively.</p>
<h4 class="h4" id="lev156"><span class="blue1"><strong>Styling the Headings, Paragraphs, and Links</strong></span></h4>
<p class="noindent"><a href="ch15.xhtml#ch15list6">Listing 15-6</a> styles the headings, paragraphs, and links. Add these styles to your CSS document.</p>
<p class="listing" id="ch15list6"><strong>LISTING 15-6:</strong> Styling headings, paragraphs, and hyperlinks</p>
<div class="box">
<pre>  h1 {<br/><span class="ent">➊</span>   font-size: 4rem;<br/>  }<br/>  h2 {<br/>    font-size: 2.5rem;<br/>  }<br/>  p {<br/>    font-size: 1.3rem;<br/>  }<br/><span class="ent">➋</span> main {<br/>    max-width: 500px;<br/>    margin:0 auto;<br/>  }<br/>  a {<br/><span class="ent">➌</span>   text-decoration: none;<br/>  }</pre>
</div>
<p class="indent"><span epub:type="pagebreak" id="page_193"/>To define the text size, use the <code>font-size</code> property <span class="ent">➊</span>. There are several units to define the font size, but we’re going to use the <code>rem</code> unit. <em>Rem</em> is the computed value of <code>font-size</code> on the root element—we use one font size as a reference across the page. This means all font sizes are relative to each other, reducing issues arising from older font size units, which would cause irregularities when viewing the page on devices with different screen sizes.</p>
<p class="indent">When used in the <code>font-size</code> property of the root element, the rem units refer to the property’s initial value. So 1 rem is equal to the font size of the HTML element—that is, 16 pixels by default in most browsers.</p>
<p class="indent">In <a href="ch15.xhtml#ch15list6">Listing 15-6</a>, we define <code>4</code>, <code>2.5</code>, and <code>1.3</code> rem font size for the heading 1, heading 2, and paragraphs, respectively, to make each heading level subsequently smaller than the one above, with the lowest level slightly larger than the default text.</p>
<p class="indent">The <code>main</code> section formats the main content of your page <span class="ent">➋</span>. We’re setting the maximum width of content to <code>500px</code>. Defining the width of an element prevents the element from stretching to the boundaries of its container; in this case, it prevents the text from spreading horizontally on the web browser window. Then, we set the margins with <code>auto</code> to center the element horizontally.</p>
<p class="indent">Hyperlinks are underlined by default. Set <code>text-</code><code>decoration</code> to <code>none</code> <span class="ent">➌</span> to remove the underline.</p>
<h4 class="h4" id="lev157"><span class="blue1"><strong>Styling the Button</strong></span></h4>
<p class="noindent">To style the button, copy the styles in <a href="ch15.xhtml#ch15list7">Listing 15-7</a> to your <em>style.css</em> document file.</p>
<p class="listing" id="ch15list7"><strong>LISTING 15-7:</strong> Styling the button</p>
<div class="box">
<pre>button {<br/>  display: block;<br/>  margin: 0 auto;<br/>  padding: 10px 20px;<br/>  font-size: 1.7rem;<br/>  border-radius: 4px;<br/>  color: #fff;<br/>  background-color: #009933;<br/>  border: none;<br/>}</pre>
</div>
<p class="indent">Setting <code>display</code> to <code>block</code> ensures the button is displayed as a block element, like a paragraph; so, for example, the button will not be on the same line as a text element. We use the <code>padding</code> property to add space around content. We define a padding of <code>10px</code> for the top and bottom margins of the button and <code>20px</code> for <span epub:type="pagebreak" id="page_194"/>the right and left margins—this sets how much space surrounds the button’s content. Notice that here we’re using the hexadecimal color code for setting the color of the button text and the button background color. The other button properties are self-explanatory. Play with these properties to style the button to your liking. You can also search for <em>button properties CSS</em> on the web for more properties and values.</p>
<p class="indent">Save your <em>style.css</em> file and refresh your browser to see the changes you’ve made. You should now have a simple web page similar to the one shown at the beginning of this project.</p>
<h3 class="h3" id="lev158"><span class="blue1"><strong>TAKING IT FURTHER</strong></span></h3>
<p class="noindent">This project was just a quick introduction on how to build a simple web page with HTML and CSS. There are endless ways in which you can edit and improve it. We encourage you to play around with all the options introduced here. For inspiration, you could:</p>
<ul>
<li class="noindent">Add multiple pages to your main page with hyperlinks to each other.</li>
<li class="noindent">Create a web page that showcases one of your Raspberry Pi projects.</li>
<li class="noindent">Search the web for more CSS properties and values and edit the way your page looks.</li>
</ul>


<h2 class="h2" id="ch16"><span epub:type="pagebreak" id="page_195"/><strong>16<br/>Connecting your Electronics to the Web</strong></h2>
<p class="noindent"><span class="blue1">In this project you’ll create your own Internet of Things web server you can use to control a lamp remotely from your phone. The simple web server you’ll build can then be added to other projects so you can control other electronic appliances.</span></p>
<div class="image"><span epub:type="pagebreak" id="page_196"/><img src="../images/f0196-01.jpg" alt="image"/></div>
<p class="cap"><span class="blue1"><strong>PARTS REQUIRED</strong></span></p>
<p class="cap1">Raspberry Pi</p>
<p class="cap1">Relay module HL-52S</p>
<p class="cap1">12 V lamp and holder</p>
<p class="cap1">12 V power adapter</p>
<p class="cap1">Male DC bar rel power jack</p>
<p class="cap1">Plastic box enclosure</p>
<p class="cap1">Jumper wires</p>
<p class="cap"><span class="blue1"><strong>SOFTWARE REQUIRED</strong></span></p>
<p class="cap1">Flask framework</p>
<p class="noindentt"><span epub:type="pagebreak" id="page_197"/>In this project you’re going to create your own web server to control your electronics through a browser. You’ll control a 12 V lamp using a dynamic web page with buttons.</p>
<h3 class="h3" id="lev159"><span class="blue1"><strong>INTRODUCING WEB SERVERS</strong></span></h3>
<p class="noindent">A web server is a computer that provides web pages. It stores the website’s files, including all HTML documents and related assets like images, CSS style sheets, fonts, and video. It also brings those files to the user’s device web browser when the user makes a request to the server’s URL.</p>
<p class="indent">When you access a web page in your browser, you’re actually sending a request via <em>Hypertext Transfer Protocol (HTTP)</em> to a server. This is simply a process for requesting and returning information on the internet. The server sends back the web page you requested—also through HTTP.</p>
<p class="indent">In this project you’ll use your Raspberry Pi to host a web server on the local network, as illustrated in <a href="ch16.xhtml#ch16fig1">Figure 16-1</a>.</p>
<div class="image"><a id="ch16fig1"/><img src="../images/f0197-01.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 16-1:</strong> Your Raspberry Pi running a web server</p>
<p class="indent">As a server, your Raspberry Pi can provide some output through its GPIO pins. In other words, using a browser on your local network, you can access the Pi web server to remotely control the GPIOs and turn something on.</p>
<p class="indent">Web servers can serve <em>static</em> or <em>dynamic</em> content. The content of a static website doesn’t change unless you edit its HTML file. The website built in <a href="ch15.xhtml#ch15">Project 15</a> is an example of a static website. With a dynamic website, the content changes based on user interactions. In this project, you’ll create a dynamic website that controls and shows the current state of a 12 V lamp connected to a relay, which we’ll look at more closely in a second.</p>
<div class="note">
<p class="notet"><strong>NOTE</strong></p>
<p class="notep"><em>Only devices that are connected to the same router as your Pi can access a web page hosted in your Pi through a browser. Accessing your web server from</em> outside <em>your network is more difficult. You can make your Raspberry Pi web server accessible from any computer anywhere by using a technique called</em> router port forwarding, <em>but that subject is beyond the book’s scope.</em></p>
</div>
<h3 class="h3" id="lev160"><span epub:type="pagebreak" id="page_198"/><span class="blue1"><strong>INTRODUCING THE RELAY MODULE</strong></span></h3>
<p class="noindent">A <em>relay</em> is an electrically operated switch that can be turned on or off, letting the current go through or not, and can be controlled with low voltages, like the 3.3 V provided by the Raspberry Pi. The relay module you’ll use in this project has two relays—the two blue cubes shown in <a href="ch16.xhtml#ch16fig2">Figure 16-2</a>.</p>
<div class="image"><a id="ch16fig2"/><img src="../images/f0198-01.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 16-2:</strong> Relay module with two channels</p>
<p class="indent">The six pins on the left side of the relay module connect high voltage, and the pins on the right side connect the component that requires low voltage—the Raspberry Pi GPIOs.</p>
<h4 class="h4" id="lev161"><span class="blue1"><strong>Relay Pinout</strong></span></h4>
<p class="noindent">The high-voltage side has two connectors, each with three sockets: <em>common (COM)</em>, <em>normally closed (NC)</em>, and <em>normally open (NO)</em>. The normally closed configuration is used when you want the relay to be closed by default, meaning the current is flowing unless you send a signal from the Pi to the relay module to open the circuit and stop the current. The normally open configuration works the other way around: the relay is always open, so the circuit is broken unless you send a signal from the Pi to close it.</p>
<p class="indent">The low-voltage side has a set of four pins and a set of three pins. The first set consists of VCC and GND to power up the module, and input 1 (IN1) and input 2 (IN2) to control the bottom and top relays, respectively. The second set of pins consists of GND, VCC, and JD-VCC pins. The JD-VCC pin powers the electromagnet of the relay. Notice that the module has a jumper cap connecting the VCC and JD-VCC pins; the one shown here is blue, but yours may be a different color.</p>
<p class="indent">The jumper cap allows you to choose whether the circuit is physically connected to the Pi circuit or not, and you can choose to have it on or not. With the jumper cap on, the VCC and JD-VCC pins are connected. That means the relay electromagnet is directly powered from the Pi’s power pin, so the relay module and the Raspberry Pi circuits are not physically isolated from each other. This is the configuration we’ll use. Without the jumper cap, you need to provide an independent power source to power up the relay’s electromagnet through the JD-VCC pin. That configuration physically isolates the relays from the Raspberry Pi with the module’s built-in optocoupler, which prevents damage to the Pi in case of electrical spikes.</p>
<div class="box4">
<p class="box-title"><span epub:type="pagebreak" id="page_199"/><span class="blue1"><strong>THE OPTOCOUPLER</strong></span></p>
<p class="box-p">We won’t go into too much detail about the optocoupler. It is basically a component that allows you to send signals between two isolated circuits so that you can control high voltages with low voltages without actually having a physical connection between those two circuits. The optocoupler makes the “connection” between the circuits using an LED that emits light and a phototransistor that receives the light and then activates or deactivates the relay.</p>
</div>
<h4 class="h4" id="lev162"><span class="blue1"><strong>Relay Usage</strong></span></h4>
<p class="noindent">You’ll use a normally open configuration for this project. You want to light the lamp only when you choose to, so the circuit should be broken until you say otherwise. For this, you use the COM and NO sockets.</p>
<p class="indent">In a normally open configuration, there is no contact between the COM and NO sockets unless you trigger the relay. The relay is triggered when the input goes below about 2 V. That means if you send a LOW signal from the Pi, the relay turns on, and if you send a HIGH signal, the relay turns off; this is called <em>inverted logic</em>. You’ll control just one relay, so you’ll connect IN1 to one of the Pi’s GPIO pins.</p>
<div class="note">
<p class="notet"><span class="red"><strong>WARNING</strong></span></p>
<p class="notep"><em>If you’re not comfortable dealing with higher voltages like 12 V, but you want to do the project, you can replace the relay module with an LED. You’ll also need to make some minor changes to the Python script, since the relay works with inverted logic and the LED doesn’t.</em></p>
</div>
<p class="indent">The hardware for the project involves connecting an AC 12 V power adapter that can provide 1 A to a relay module to control a 12 V lamp. We’ll use a DC barrel power jack to make the connections between the adapter and the relay easier. The barrel jack connects perfectly to the power adapter terminal, as shown in <a href="ch16.xhtml#ch16fig3">Figure 16-3</a>.</p>
<div class="image"><a id="ch16fig3"/><img src="../images/f0199-01.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 16-3:</strong> Power adapter terminal and DC barrel power jack</p>
<h3 class="h3" id="lev163"><span epub:type="pagebreak" id="page_200"/><span class="blue1"><strong>PROJECT OVERVIEW</strong></span></h3>
<p class="noindent">Before getting into building this project, let’s go through a quick overview so you better understand each step (see <a href="ch16.xhtml#ch16fig4">Figure 16-4</a>). You should also know the basics of HTML and CSS, so we recommend that you complete <a href="ch15.xhtml#ch15">Project 15</a> if you haven’t already before moving on.</p>
<div class="image"><a id="ch16fig4"/><img src="../images/f0200-01.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 16-4:</strong> Project overview</p>
<p class="indent">You’ll create your web server with Flask, a Python web framework, by creating a file called <em>app.py</em>. When you access the Raspberry Pi IP address, port 80, your web browser requests the web page files stored in your Raspberry Pi—<em>index.html</em> and <em>style.css</em>—and then displays the web page. Your web page will have ON and OFF buttons that trigger an event that turns the lamp on and off, respectively.</p>
<h3 class="h3" id="lev164"><span class="blue1"><strong>WIRING THE CIRCUIT</strong></span></h3>
<p class="noindent">For safety reasons, you’ll want to place your relay inside a plastic box enclosure. You may need to drill some holes in the plastic box for the wires—one hole for the Pi wires, another for the lamp wires, and one for the power adapter. <a href="ch16.xhtml#ch16fig5">Figure 16-5</a> shows how the enclosure looks without the lid. The Raspberry Pi wires will go through a hole on the lid.</p>
<div class="image"><a id="ch16fig5"/><img src="../images/f0200-02.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 16-5:</strong> Circuit with the relay in a plastic box enclosure</p>
<div class="note">
<p class="notet"><span epub:type="pagebreak" id="page_201"/><strong>NOTE</strong></p>
<p class="notep"><em>Make sure you have the jumper cap on the JD-VCC and VCC pins.</em></p>
</div>
<p class="indent">With your Pi powered <em>off</em>, follow these instructions to build the circuit:</p>
<ol>
<li class="noindent"><p class="list">Connect one of the lamp holder terminals to the negative (–) terminal on the DC barrel power jack.</p></li>
<li class="noindent"><p class="list">Connect the DC barrel power jack positive (+) terminal to the relay COM socket.</p></li>
<li class="noindent"><p class="list">Connect the other lamp terminal to the relay NO socket. You need a screwdriver to connect the relay sockets tightly.</p></li>
<li class="noindent"><p class="list">Follow the table to wire the Raspberry Pi to the relay, and make sure your completed setup matches <a href="ch16.xhtml#ch16fig6">Figure 16-6</a>.</p>
<table class="topbot-d">
<thead>
<tr>
<td style="vertical-align: top;" class="border_th-o"><p class="tab_th"><strong>RELAY</strong></p></td>
<td style="vertical-align: top;" class="border_tha"><p class="tab_th"><strong>RASPBERRY PI</strong></p>
</td>
</tr>
</thead>
<tbody>
<tr>
<td style="vertical-align: top;" class="table-o"><p class="tabc"><span class="blue1">VCC</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="blue1">5 V</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-o"><p class="tabc"><span class="blue1">IN2</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="blue1">Don’t connect</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-o"><p class="tabc"><span class="blue1">IN1</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="blue1">GPIO 17</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-o"><p class="tabc"><span class="blue1">GND</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="blue1">GND</span></p></td>
</tr>
</tbody>
</table>
<div class="image"><a id="ch16fig6"/><img src="../images/f0201-01.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 16-6:</strong> Controlling a 12 V lamp with the Raspberry Pi using a relay</p></li>
</ol>
<div class="note">
<p class="notet"><span class="red"><strong>WARNING</strong></span></p>
<p class="notep"><em>Do not touch the relay or any live wires while they are connected to 12 V. If something isn’t working and you decide to make changes to the circuit, remove the 12 V power adapter plug from the socket before touching anything.</em></p>
</div>
<p class="indent">After completing the circuit and double-checking all the connections, apply power to the Raspberry Pi, connect a 12 V power adapter to the DC barrel power jack, and apply power by plugging the 12 V power adapter into a wall socket.</p>
<p class="indent"><span epub:type="pagebreak" id="page_202"/>If you want to control an LED instead, use the <a href="ch01.xhtml#ch01">Project 1</a> schematic diagram on <a href="ch01.xhtml#page_41">page 41</a> as a reference, connecting the LED to GPIO 17.</p>
<h3 class="h3" id="lev165"><span class="blue1"><strong>PREPARING YOUR PI TO RUN A WEB SERVER</strong></span></h3>
<p class="noindent">The Raspberry Pi supports a number of web servers, but we’re going to use Flask, a Python web framework, to turn the Pi into a dynamic web server.</p>
<h4 class="h4" id="lev166"><span class="blue1"><strong>Installing Flask</strong></span></h4>
<p class="noindent">To install Flask, you need to have pip, a tool to install libraries from the Python Package Index. Open the terminal and run the following commands to update your Pi and install pip:</p>
<div class="box">
<pre>pi@raspberrypi:~ $ <span class="codestrong">sudo apt update &amp;&amp; sudo apt upgrade</span><br/>pi@raspberrypi:~ $ <span class="codestrong">sudo apt install python3-pip</span></pre>
</div>
<p class="indent">Then use pip to install Flask and its dependencies by entering the following:</p>
<div class="box">
<pre>pi@raspberrypi:~ $ <span class="codestrong">sudo pip3 install flask</span></pre>
</div>
<p class="indent">If Flask installs correctly, the terminal will display the message <code>successfully installed Flask</code>.</p>
<h4 class="h4" id="lev167"><span class="blue1"><strong>Organizing Your Files</strong></span></h4>
<p class="noindent">Keeping your files organized is essential in this project because Flask needs your files structured in a particular way to work correctly. Create a folder specifically for this project called <em>Project_16</em> inside the <em>Web_Applications</em> folder. Then create the folders and files you’ll need by following the structure shown in <a href="ch16.xhtml#ch16fig7">Figure 16-7</a>.</p>
<div class="image"><a id="ch16fig7"/><img src="../images/f0202-01.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 16-7:</strong> Files and folders structure</p>
<p class="indent"><span epub:type="pagebreak" id="page_203"/>Create the <em>index.html</em> and <em>style.css</em> files using the Text Editor and the <em>app.py</em> file using Python 3 (IDLE). The <em>static</em> folder will store static files like the CSS file. The <em>templates</em> folder will store files that can be changed; for example, the <em>index.html</em> file is a template that dynamically changes the relay status label according to user input.</p>
<h3 class="h3" id="lev168"><span class="blue1"><strong>WRITING THE SCRIPTS</strong></span></h3>
<p class="noindent">You’ll need to write three scripts for this project: a Python script that will create your Pi web server, an HTML file that builds your web page, and a CSS file to style your web page.</p>
<h4 class="h4" id="lev169"><span class="blue1"><strong>Creating the Web Server</strong></span></h4>
<p class="noindent">To create the web server, open your <em>app.py</em> file, currently empty, and enter the code in <a href="ch16.xhtml#ch16list1">Listing 16-1</a>. This code creates the web server on Raspberry Pi port 80 and generates a web page that you can access on the local network, from any web browser. You can download all the code used throughout this project at <em><a href="https://www.nostarch.com/RaspberryPiProject/">https://www.nostarch.com/RaspberryPiProject/</a></em>.</p>
<p class="listing" id="ch16list1"><strong>LISTING 16-1:</strong> Creating a web server with Flask</p>
<div class="box">
<pre>  <span class="red1">#import necessary libraries</span><br/><span class="ent">➊</span> <span class="orange">from</span> gpiozero <span class="orange">import</span> LED<br/>  <span class="orange">from</span> flask <span class="orange">import</span> Flask, render_template, request<br/><br/>  <span class="red1">#create a Flask object</span><br/><span class="ent">➋</span> app = Flask(__name__)<br/><br/>  <span class="red1">#create an object that refers to a relay</span><br/><span class="ent">➌</span> relay = LED(17)<br/>  <span class="red1">#set the relay off; remember the relay works with inverted logic</span><br/>  relay.on()<br/>  <span class="red1">#save current relay state</span><br/>  relay_state = <span class="green">'Relay is off'</span><br/><br/>  <span class="red1">#display the main web page</span><br/><span class="ent">➍</span> @app.route(<span class="green">'/'</span>)<br/>  <span class="orange">def</span> <span class="blue">main</span>():<br/>     <span class="orange">global</span> relay_state<br/>     <span class="red1">#pass the relay state to index.html and return it to the user</span><br/>   <span class="ent">➎</span> <span class="orange">return</span> render_template(<span class="green">'index.html'</span>, relay_state=relay_state)<br/><br/>  <span class="red1">#execute control() when someone presses the on/off buttons</span><br/><span class="ent">➏</span> @app.route(<span class="green">'/&lt;action&gt;'</span>)<br/>  <span class="orange">def</span> <span class="blue">control</span>(action):<br/>     <span class="orange">global</span> relay_state<br/>     <span class="red1">#if the action part of the URL is 'on', turn the relay on</span><br/>   <span class="ent">➐</span> <span class="orange">if</span> action == <span class="green">'on'</span>:<br/>        <span class="red1">#set the relay on</span><br/>        relay.off()<br/><span epub:type="pagebreak" id="page_204"/>        <span class="red1">#save the relay state</span><br/>        relay_state = <span class="green">'Relay is on'</span><br/>     <span class="orange">if</span> action == <span class="green">'off'</span>:<br/>        relay.on()<br/>        relay_state = <span class="green">'Relay is off'</span><br/><br/>     <span class="red1">#pass the relay state to index.html and return it to the user</span><br/>     <span class="orange">return</span> render_template(<span class="green">'index.html'</span>, relay_state=relay_state)<br/>  <span class="red1">#start the web server at localhost on port 80</span><br/>  <span class="orange">if</span> __name__ == <span class="green">'__main__'</span>:<br/>  <span class="ent">➑</span> app.run(host=<span class="green">'0.0.0.0'</span>, port=80, debug=<span class="orange">True</span>)</pre>
</div>
<p class="indent">First you import the needed libraries <span class="ent">➊</span>, and then you create a Flask object called <code>app</code> <span class="ent">➋</span>. You initialize the relay on GPIO 17 <span class="ent">➌</span> and set the relay as <em>off</em> by default. The relay works with inverted logic, so you use <code>relay.on()</code> to turn it off.</p>
<p class="indent">The <code>@app.route('/')</code> decorator <span class="ent">➍</span> runs the <code>main()</code> function when someone accesses the root URL—the main Pi IP address of the server. In Python, a <em>decorator</em> starts with the <code>@</code> symbol and goes above a function definition. A decorator is basically a function that takes in another function, but you don’t need to worry about this for the moment.</p>
<p class="indent">You render the <em>index.html</em> file to the web browser and print the current relay state, using the <code>relay_state</code> variable value on the HTML file <span class="ent">➎</span>. Then you add a dynamic route with <code>action</code> as a variable <span class="ent">➏</span>. This runs the <code>control()</code> function when someone accesses the dynamic route. If the action from the URL is <code>on</code>, the program turns the relay on and saves the current relay state <span class="ent">➐</span>. This means when you access your Raspberry Pi IP address followed by <code>/on</code> (for example, <code>http://192.168.1.112/on</code>), the relay turns on. You’ll fetch your own IP address shortly.</p>
<p class="indent">If the action from the URL is <code>off</code>, the program turns the relay off and saves the current relay state. The server is listening on port 80 and the debug is set to <code>True</code> to report any errors <span class="ent">➑</span>.</p>
<h4 class="h4" id="lev170"><span class="blue1"><strong>Writing the HTML File</strong></span></h4>
<p class="noindent"><a href="ch16.xhtml#ch16list2">Listing 16-2</a> is a simple HTML document that structures the web page. Feel free to add more paragraphs and headings to personalize it using what you learned in <a href="ch15.xhtml#ch15">Project 15</a>. Copy this code to your <em>index.html</em> file, which should be located in the <em>templates</em> folder as shown earlier in <a href="ch16.xhtml#ch16fig7">Figure 16-7</a>.</p>
<p class="listing" id="ch16list2"><span epub:type="pagebreak" id="page_205"/><strong>LISTING 16-2:</strong> Writing the HTML file for your web page</p>
<div class="box">
<pre>  &lt;!DOCTYPE html&gt;<br/>  &lt;head&gt;<br/>  &lt;title&gt;RPi Web Server&lt;/title&gt;<br/>  &lt;link rel="stylesheet" type="text/css" href="{{ url_for('static',<br/>  filename='style.css') }}"&gt;<br/><span class="ent">➊</span> &lt;meta name="viewport" content="width=device-width, initial-scale=1"&gt;<br/>  &lt;/head&gt;<br/><br/>  &lt;body&gt;<br/>      &lt;h2&gt;RPi Web Server&lt;/h2&gt;<br/>   <span class="ent">➋</span> &lt;p&gt;{{relay_state}}&lt;/p&gt;<br/>   <span class="ent">➌</span> &lt;a href="/on"&gt;&lt;button&gt;ON&lt;/button&gt;&lt;/a&gt;<br/>   <span class="ent">➍</span> &lt;a href="/off"&gt;&lt;button class="off"&gt;OFF&lt;/button&gt;&lt;/a&gt;<br/>  &lt;/body&gt;<br/>  &lt;/html&gt;</pre>
</div>
<p class="indent">This is a simple HTML structure, and we won’t go into too much detail in this HTML code, because you should already be familiar with most of it from <a href="ch15.xhtml#ch15">Project 15</a>. You can always refer back to that project for a refresher.</p>
<p class="indent">The <code>&lt;meta&gt;</code> tag and the given attributes make your web page responsive in any mobile browser <span class="ent">➊</span>. With this tag, the browser will render the width of the page to the width of the mobile screen. At line <span class="ent">➋</span>, between double curly brackets <code>{{ }}</code>, is <code>relay_state</code>, the variable we’re using in <em>app.py</em> to save the current relay state. This paragraph displays the state saved in the <code>relay_state</code> variable. When you click the ON button, you are redirected to <code>/on</code> root <span class="ent">➌</span>, which turns the relay on, as seen in <em>app.py</em>. When you click the OFF button, you are redirected to the <code>/off</code> root <span class="ent">➍</span>, which turns the relay off.</p>
<h4 class="h4" id="lev171"><span class="blue1"><strong>Writing the CSS File</strong></span></h4>
<p class="noindent"><a href="ch16.xhtml#ch16list3">Listing 16-3</a> styles your web page. This is just an example of how you can style your page; you can edit the properties as you like. Your <em>style.css</em> file should be inside the <em>static</em> folder, as you saw earlier in <a href="ch16.xhtml#ch16fig7">Figure 16-7</a>.</p>
<p class="listing" id="ch16list3"><strong>LISTING 16-3:</strong> Styling the web page with CSS</p>
<div class="box">
<pre><span class="ent">➊</span> h2 {<br/>    font-size: 2.5rem;<br/>  }<br/>  p {<br/>    font-size: 1.8rem;<br/>  }<br/><span class="ent">➋</span> body {<br/>    display: inline-block;<br/>    margin: 0px auto;<br/>    text-align: center;<br/>  }<br/><span epub:type="pagebreak" id="page_206"/><span class="ent">➌</span> button {<br/>    display: inline-block;<br/>    margin: 0 auto;<br/>    padding: 15px 25px;<br/>    font-size: 3rem;<br/>    border-radius: 4px;<br/>    color: #fff;<br/>    background-color: #009933;<br/>    border: none;<br/>  }<br/>  .off {<br/>    color: #fff;<br/>    background-color: #604f43;<br/>  }<br/>  a {<br/>    text-decoration: none;<br/>  }</pre>
</div>
<p class="indent">In summary, we’ve set font sizes for the heading 2 and the paragraph <span class="ent">➊</span>. Then, we’ve aligned all our page body <span class="ent">➋</span>. Finally, we’ve edited the appearance of the ON and OFF buttons <span class="ent">➌</span>.</p>
<h4 class="h4" id="lev172"><span class="blue1"><strong>Launching Your Web Server</strong></span></h4>
<p class="noindent">With the Python script, HTML file, and CSS file completed, it’s time to run your web server. Open the terminal window and navigate to the <em>Project_16</em> folder by entering this command:</p>
<div class="box">
<pre>pi@raspberrypi:~ $ <span class="codestrong">cd ~/Desktop/Projects/Web_Applications/Project_16</span></pre>
</div>
<p class="indent">Then, run <em>app.py</em> with the following line:</p>
<div class="box">
<pre>pi@raspberrypi:~Desktop/Projects/Web_Applications/Project_16 $ <span class="codestrong">sudo</span><br/><span class="codestrong">python3 app.py</span></pre>
</div>
<p class="indent">Your web server is now running. Open any browser on the local network and enter your Raspberry Pi IP address.</p>
<p class="indent">To find your Pi’s IP address, go to the terminal and enter the following:</p>
<div class="box">
<pre>pi@raspberrypi:~ $ <span class="codestrong">hostname -I</span></pre>
</div>
<p class="indent">This prints the Pi’s IP address.</p>
<p class="indent">With your circuit ready and your server running, open a browser and navigate to your Raspberry Pi IP address. Your browser will display the web server page. Now click the buttons to remotely control the lamp! <a href="ch16.xhtml#ch16fig8">Figure 16-8</a> shows the web page in a smartphone’s browser.</p>
<div class="image"><span epub:type="pagebreak" id="page_207"/><a id="ch16fig8"/><img src="../images/f0207-01.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 16-8:</strong> Raspberry Pi web server page on a smartphone’s browser</p>
<p class="indent">To stop the web server, simply press <small>CTRL</small>-C.</p>
<h3 class="h3" id="lev173"><span class="blue1"><strong>TAKING IT FURTHER</strong></span></h3>
<p class="noindent">In this project, you learned how to use a relay and how to set up a web server to serve a web page, as well as put your HTML and CSS skills into practice. Here are some ideas for taking these concepts further:</p>
<ul>
<li class="noindent">Edit this project to control more than one output.</li>
<li class="noindent">Edit the CSS and HTML files to suit your own tastes.</li>
<li class="noindent">Control other electronic appliances.</li>
<li class="noindent">Edit previous projects to control lamps connected to relays instead of LEDs.</li>
</ul>


<h2 class="h2" id="ch17"><span epub:type="pagebreak" id="page_208"/><strong>17<br/>Internet of Things Control Center with Node-RED</strong></h2>
<p class="noindent"><span class="blue1">In this project, you’ll create an Internet of Things app to control your favorite household electronics from a web server using Node-RED, a powerful and easy-to-use tool for Internet of Things applications.</span></p>
<div class="image"><span epub:type="pagebreak" id="page_209"/><img src="../images/f0209-01.jpg" alt="image"/></div>
<p class="cap"><span class="blue1"><strong>PARTS REQUIRED</strong></span></p>
<p class="cap1">Raspberry Pi</p>
<p class="cap1">Breadboard</p>
<p class="cap1">DHT22 temperature and humidity sensor</p>
<p class="cap1">4.7 kΩ resistor</p>
<p class="cap1">Two 5 mm LEDs</p>
<p class="cap1">Two 330 Ω resistor</p>
<p class="cap1">Jumper wires</p>
<p class="cap"><span class="blue1"><strong>SOFTWARE REQUIRED</strong></span></p>
<p class="cap1">Node-RED DHT node</p>
<p class="cap1">Node-RED dashboard</p>
<p class="noindentt"><span epub:type="pagebreak" id="page_210"/>You’re going to create a Node-RED application that controls outputs and reads inputs in the local network. You’ll use it to control LEDs, as well as to read and display temperature and humidity values using the DHT22 sensor—all remotely through a web server.</p>
<h3 class="h3" id="lev174"><span class="blue1"><strong>INTRODUCING NODE-RED</strong></span></h3>
<p class="noindent">Node-RED is an open source visual wiring tool for building IoT applications that comes already installed on your Pi’s operating system and is designed to run perfectly with the Pi.</p>
<p class="indent">Node-RED uses visual programming, with blocks called <em>nodes</em> that you wire together to perform a certain task, simplifying much of the programming significantly. Node-RED allows you to prototype a complex home automation system quickly and simply, giving you more time to spend on designing and making cool stuff.</p>
<p class="indent">We won’t cover everything that Node-RED can do in this project, but here’s a brief breakdown if you want to explore further:</p>
<ul>
<li class="noindent">Access the Pi’s GPIOs.</li>
<li class="noindent">Establish a connection with other boards like the Arduino and ESP8266.</li>
<li class="noindent">Create a responsive graphical user interface.</li>
<li class="noindent">Communicate with third-party services.</li>
<li class="noindent">Retrieve data from the web.</li>
<li class="noindent">Create time-triggered events.</li>
<li class="noindent">Store and retrieve data from a database.</li>
</ul>
<h4 class="h4" id="lev175"><span class="blue1"><strong>Installing the DHT22 Nodes</strong></span></h4>
<p class="noindent">Although the Node-RED software comes already installed with the Pi’s operating system, it doesn’t come with a node able to read from the DHT22 sensor. We need to install that first, by installing npm (Node Package Management) like so:</p>
<div class="box">
<pre>pi@raspberrypi:~ $ <span class="codestrong">sudo apt install npm</span></pre>
</div>
<p class="indent">When prompted, type <span class="codestrong">Y</span> and press <small>ENTER</small>. The installation may take a few minutes. Then, enter the following command to upgrade npm to the latest 3.x version, which is the version recommended for use with Node-RED:</p>
<div class="box">
<pre>pi@raspberrypi:~ $ <span class="codestrong">sudo npm install -g npm@3.x</span><br/>pi@raspberrypi:~ $ <span class="codestrong">hash -r</span></pre>
</div>
<p class="indent"><span epub:type="pagebreak" id="page_211"/>These commands will output a warning message, but don’t worry—it’s harmless, so you can ignore it.</p>
<p class="indent">Next you’ll download and unzip a C library for the Raspberry Pi. You need this library to control DHT22 through Node-RED. At the time of writing, the latest version of the library is 1.55. Before you install the library, go to <em><a href="http://www.airspayce.com/mikem/bcm2835/">http://www.airspayce.com/mikem/bcm2835/</a></em> and check the latest version. Then, enter the following commands, replacing the <code>1.55</code> highlighted in italics with the latest version.</p>
<div class="box">
<pre>pi@raspberrypi:~ $ <span class="codestrong">wget http://www.airspayce.com/mikem/bcm2835/</span><br/><span class="codestrong">bcm2835-<em>1.55</em>.tar.gz</span><br/>pi@raspberrypi:~ $ <span class="codestrong">tar zxvf bcm2835-<em>1.55</em>.tar.gz</span></pre>
</div>
<p class="indent">Finally, enter the following list of commands to compile and install the nodes needed to control the DHT22 sensor and add dashboard support:</p>
<div class="box">
<pre>pi@raspberrypi:~ $ <span class="codestrong">cd bcm2835-<em>1.55</em></span><br/>pi@raspberrypi:~/bcm2835-1.55 $ <span class="codestrong">./configure</span><br/>pi@raspberrypi:~/bcm2835-1.55 $ <span class="codestrong">make</span><br/>pi@raspberrypi:~/bcm2835-1.55 $ <span class="codestrong">sudo make check</span><br/>pi@raspberrypi:~/bcm2835-1.55 $ <span class="codestrong">sudo make install</span><br/>pi@raspberrypi:~/bcm2835-1.55 $ <span class="codestrong">cd</span><br/>pi@raspberrypi:~ $ <span class="codestrong">sudo npm install -–unsafe-perm -g node-dht-sensor</span><br/>pi@raspberrypi:~ $ <span class="codestrong">sudo npm install --unsafe-perm -g node-red-</span><br/><span class="codestrong">contrib-dht-sensor</span><br/>pi@raspberrypi:~ $ <span class="codestrong">sudo npm install --unsafe-perm -g node-red-</span><br/><span class="codestrong">dashboard</span></pre>
</div>
<p class="indent">With all of that installed, reboot your Pi. Now we’ll give you a quick tour of Node-RED.</p>
<h4 class="h4" id="lev176"><span class="blue1"><strong>Getting Started with Node-RED</strong></span></h4>
<p class="noindent">To open Node-RED, go to the terminal and enter the following:</p>
<div class="box">
<pre>pi@raspberrypi:~ $ <span class="codestrong">sudo node-red start</span></pre>
</div>
<p class="indent">Your terminal window should show something like <a href="ch17.xhtml#ch17fig1">Figure 17-1</a>. The highlighted line shows your localhost’s Raspberry Pi IP address followed by the number of the port the Node-RED server is running on. <em>Localhost</em> is a hostname that means “this computer” and resolves to the IP address shown in the terminal window: http://127.0.0.1. Using this IP address you can access Node-RED only in your Raspberry Pi browser. To access Node-RED in any browser on your local network, you need to find your Pi’s IP address.</p>
<div class="note">
<p class="notet"><strong>NOTE</strong></p>
<p class="notep"><em>Usually, instead of going to the terminal, you can open Node-RED by going to the taskbar main menu and clicking <strong>Programming <span class="ent">▸</span> Node-RED</strong>. However, in this project, you need to start Node-RED from the terminal because DHT22 nodes require administrator permission.</em></p>
</div>
<div class="image"><span epub:type="pagebreak" id="page_212"/><a id="ch17fig1"/><img src="../images/f0212-01.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 17-1:</strong> Starting Node-RED from the terminal</p>
<p class="indent">To find your Raspberry Pi IP address, enter the following in the terminal:</p>
<div class="box">
<pre>pi@raspberrypi:~ $ <span class="codestrong">hostname -I</span></pre>
</div>
<p class="indent">Open Chromium and enter <em>http://&lt;Pi IP address&gt;:1880/</em>, replacing <em>&lt;Pi IP address&gt;</em> with your Raspberry Pi’s IP address. Your Node-RED page server should open as shown in <a href="ch17.xhtml#ch17fig2">Figure 17-2</a>.</p>
<div class="image"><a id="ch17fig2"/><img src="../images/f0212-02.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 17-2:</strong> The Node-RED editor in your browser</p>
<p class="indent">On the left you’ll see a list of blocks, or nodes. Nodes are grouped according to their function; scroll down the list to see what you have. We’ll just cover a small number of existing nodes in this project, including nodes from the input, Raspberry_Pi, function, and dashboard sections, illustrated in <a href="ch17.xhtml#ch17fig3">Figure 17-3</a>.</p>
<div class="image"><span epub:type="pagebreak" id="page_213"/><a id="ch17fig3"/><img src="../images/f0213-01.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 17-3:</strong> Some of the Node-RED nodes</p>
<p class="indent">The center box of your Node-RED page is the <em>flow</em> section; this is where you drag the nodes and wire them together to build your application. On the right are several tabs: the <em>info</em> tab shows information about a selected node, the <em>debug</em> tab is used for debugging purposes, and the <em>dashboard</em> tab is where you organize the user interface widgets of your application. Finally, the <em>Deploy</em> button saves the changes made to the flow and executes it. Next you’ll wire up your hardware, and then put together your flow in Node-RED.</p>
<h3 class="h3" id="lev177"><span class="blue1"><strong>WIRING THE CIRCUIT</strong></span></h3>
<p class="noindent">You should already be familiar with LEDs and the DHT22 sensor, but for a refresher on the DHT22 sensor, check <a href="ch12.xhtml#ch12">Project 12</a>. To wire the circuit, follow these instructions:</p>
<ol>
<li class="noindent"><p class="list">Connect 5 V and GND from the Pi to a red and blue breadboard rail, respectively.</p></li>
<li class="noindent"><p class="list"><span epub:type="pagebreak" id="page_214"/>Insert two LEDs into the breadboard. Wire the shorter lead of each LED to the GND rail through a 330 Ω resistor. Wire the longer lead of one LED to GPIO 18, and the longer lead of the other LED to GPIO 17.</p></li>
<li class="noindent"><p class="list">Insert the DHT22 into the breadboard (with the raised side facing you) and wire it according to the following table. Your completed circuit should match <a href="ch17.xhtml#ch17fig4">Figure 17-4</a>.</p></li>
</ol>
<table class="topbot-d">
<thead>
<tr>
<td style="vertical-align: top;" class="border_th-o"><p class="tab_th"><strong>DHT22</strong></p></td>
<td style="vertical-align: top;" class="border_tha"><p class="tab_th"><strong>RASPBERRY PI</strong></p></td>
</tr>
</thead>
<tbody>
<tr>
<td style="vertical-align: top;" class="table-o"><p class="tabc"><span class="blue1">1</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="blue1">3.3 V</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-o"><p class="tabc"><span class="blue1">2</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="blue1">GPIO 4 and 3.3 V (via 4.7 kΩ resistor)</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-o"><p class="tabc"><span class="blue1">3</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="blue1">Don’t connect</span></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-o"><p class="tabc"><span class="blue1">4</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="tabc"><span class="blue1">GND</span></p></td>
</tr>
</tbody>
</table>
<div class="image"><a id="ch17fig4"/><img src="../images/f0214-01.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 17-4:</strong> Wiring the DHT22 and two LEDs to the Pi</p>
<h3 class="h3" id="lev178"><span class="blue1"><strong>CREATING THE FLOW</strong></span></h3>
<p class="noindent">The script, in this case, is the flow you’ll make in Node-RED. This flow will allow you to do the following:</p>
<ul>
<li class="noindent">Control an LED with an on and off switch. This LED will also be time-sensitive, which means it will automatically light up and turn off at a specific time that you set.</li>
<li class="noindent"><span epub:type="pagebreak" id="page_215"/>Control another LED with PWM using a slider to act as a dimmer switch.</li>
<li class="noindent">Read the temperature from the DHT22 sensor and display it on a time-versus-temperature chart.</li>
<li class="noindent">Read the humidity from the DHT22 sensor and display it on a gauge.</li>
</ul>
<p class="indent">First you’ll make the user interface you’ll use to control the components from your server.</p>
<h4 class="h4" id="lev179"><span class="blue1"><strong>Creating the Dashboard User Interface</strong></span></h4>
<p class="noindent">Nodes from the dashboard section provide widgets that show up in your application user interface (UI) to control components. Every widget—like a button, slider, or chart—you add to the flow has to be associated with a <em>group</em> that tells the widget where it should appear on the UI.</p>
<p class="indent">You’ll also need tabs, which are like pages in your application (like tabs in a browser). Groups are sections within a tab, where you can group widgets together. In any project, you’ll need to create tabs and groups in your dashboard to organize the widgets in the UI. You’ll build a tab called “Home” with one group called “Dashboard.”</p>
<p class="indent">Using <a href="ch17.xhtml#ch17fig5">Figure 17-5</a> as a reference, select the <strong>dashboard</strong> tab <span class="ent">➊</span> in the top right and then press the <strong>+ tab</strong> button <span class="ent">➋</span> to create a new tab under the Tabs list. Click <strong>edit</strong> to edit the tab <span class="ent">➌</span> and enter the name <span class="codestrong">Home</span>. Once that’s created, press the <strong>+ group</strong> button <span class="ent">➍</span> to create a new group; then click <strong>edit</strong> <span class="ent">➎</span> and enter the name <span class="codestrong">Dashboard</span>.</p>
<div class="image"><a id="ch17fig5"/><img src="../images/f0215-01.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 17-5:</strong> Creating tabs and groups in the dashboard</p>
<p class="indent">To see how your dashboard currently looks, go to <em>http://&lt;Pi IP address&gt;:1880/ui</em> in your browser, replacing <em>&lt;Pi IP address&gt;</em> with your Raspberry Pi’s IP address you got earlier. As you can see in <a href="ch17.xhtml#ch17fig6">Figure 17-6</a>, your user interface is empty at the moment because you haven’t added any widgets, so let’s add some functionality next.</p>
<div class="image"><span epub:type="pagebreak" id="page_216"/><a id="ch17fig6"/><img src="../images/f0216-01.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 17-6:</strong> The Node-RED user interface</p>
<h4 class="h4" id="lev180"><span class="blue1"><strong>Wiring the Nodes</strong></span></h4>
<p class="noindent">Now you’re going to add nodes to your flow. Your flow will control the LEDs connected to the Raspberry Pi GPIOs and read temperature and humidity from the DHT22 sensor.</p>
<h5 class="h5"><strong>Adding a Switch and Scheduling Events</strong></h5>
<p class="noindent">Go back to the Node-RED editor and add two inject nodes from the input section by dragging them into the flow. When you drop them in the flow, their name will change to <em>timestamp</em>. Add a switch from the dashboard section, and an rpi gpio output node (the one with a joint on the left side) from the Raspberry_Pi nodes section. Arrange the nodes and wire them as shown in <a href="ch17.xhtml#ch17fig7">Figure 17-7</a>.</p>
<div class="image"><a id="ch17fig7"/><img src="../images/f0216-02.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 17-7:</strong> The flow for controlling LED 1</p>
<p class="indent">This set of nodes controls the LED connected to GPIO 17. This LED can be controlled remotely with an on and off switch, and it is also time sensitive; timestamp 1 determines the time the LED lights up, and timestamp 2 determines the time the LED turns off.</p>
<p class="indent">If you double-click a node, a new window will open that allows you to edit the node’s properties. Double-click the first timestamp node and edit its properties like so: set the payload number to <strong>1</strong>, which sends 1 to the Raspberry Pi GPIO 17 when this node is triggered. In the repeat field, select <strong>at a specific time</strong> and choose the <span epub:type="pagebreak" id="page_217"/>time and day you want your LED to light up; you’ll choose the time to turn it off in timestamp 2. We chose 19:00 (7 <small>PM</small>) for all days of the week. You can choose whatever times and days you want. The name field lets you name the node, and in our case we’ve called it <strong>On at 7PM</strong>. When you’re done editing your node, click the <strong>Done</strong> button. <a href="ch17.xhtml#ch17fig8">Figure 17-8</a> shows the properties we set for this node.</p>
<div class="image"><a id="ch17fig8"/><img src="../images/f0217-01.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 17-8:</strong> Editing the inject node properties</p>
<p class="indent">Edit the other nodes’ properties to match those in the following table.</p>
<table class="topbot-d">
<thead>
<tr>
<td style="vertical-align: top;" class="border_th-o"><p class="tab_th"><strong>NODE</strong></p></td>
<td style="vertical-align: top;" class="border_tha"><p class="tab_th"><strong>PROPERTIES</strong></p></td>
</tr>
</thead>
<tbody>
<tr>
<td style="vertical-align: middle;" class="table-o"><p class="taba"><span class="blue1">timestamp</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="taba"><span class="blue1">Payload: number 1<br/>Repeat: at a specific time<br/>At: 19:00<br/>On: select all days</span></p></td>
</tr>
<tr>
<td style="vertical-align: middle;" class="table-o"><p class="taba"><span class="blue1">timestamp</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="taba"><span class="blue1">Payload: number 0<br/>Repeat: at a specific time<br/>At: 23:00<br/>On: select all days</span></p></td>
</tr>
<tr>
<td style="vertical-align: middle;" class="table-o"><p class="taba"><span class="blue1">switch</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="taba"><span class="blue1">Group: Dashboard [Home]<br/>Label: LED 1<br/>On Payload: number 1<br/>Off Payload: number 0<br/>Name: LED 1 – Switch</span></p></td>
</tr>
<tr>
<td style="vertical-align: middle;" class="table-o"><p class="taba"><span class="blue1">pin</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="taba"><span class="blue1">GPIO: GPIO17 – 11<br/>Type: Digital output<br/>Name: LED 1 – GPIO 17</span></p></td>
</tr>
</tbody>
</table>
<p class="indent"><span epub:type="pagebreak" id="page_218"/>To run your Node-RED application, click the <strong>Deploy</strong> button at the top right. This will also save the changes. To see how your application looks, go to <em>http://&lt;Pi IP address&gt;:1880/ui</em> in the browser. At this point, it should look like <a href="ch17.xhtml#ch17fig9">Figure 17-9</a>.</p>
<div class="image"><a id="ch17fig9"/><img src="../images/f0218-01.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 17-9:</strong> The user interface with the LED 1 control switch</p>
<p class="indent">Click the switch to test whether you can control the LED connected to GPIO 17. If not, go back and make sure you’ve wired your nodes correctly and set the right properties.</p>
<h5 class="h5"><strong>Adding a Slider</strong></h5>
<p class="noindent">Now, you’ll add the nodes to control the brightness of the LED connected to GPIO 18. Drag a slider and an rpi gpio output node into the flow, and arrange them as in <a href="ch17.xhtml#ch17fig10">Figure 17-10</a>.</p>
<div class="image"><a id="ch17fig10"/><img src="../images/f0218-02.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 17-10:</strong> The flow for controlling LED 1 and LED 2</p>
<p class="indent">Edit the new nodes’ properties as shown in the following table.</p>
<table class="topbot-d">
<thead>
<tr>
<td style="vertical-align: top;" class="border_th-o"><p class="tab_th"><strong>NODE</strong></p></td>
<td style="vertical-align: top;" class="border_tha"><p class="tab_th"><strong>PROPERTIES</strong></p></td>
</tr>
</thead>
<tbody>
<tr>
<td style="vertical-align: middle;" class="table-o"><p class="taba"><span class="blue1">slider</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="taba"><span class="blue1">Group: Dashboard [Home]<br/>Label: LED 2<br/>Range: min:0; max:100; step:1<br/>Name: LED 2 – Slider</span></p></td>
</tr>
<tr>
<td style="vertical-align: middle;" class="table-o"><p class="taba"><span class="blue1">pin</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="taba"><span class="blue1">GPIO: 12 – GPIO18<br/>Type: PWM output<br/>Name: LED 2 – GPIO 18</span></p></td>
</tr>
</tbody>
</table>
<p class="indent"><span epub:type="pagebreak" id="page_219"/>This new set of nodes controls the LED connected to GPIO 18 using PWM. Moving the slider will change the LED brightness. Click the <strong>Deploy</strong> button, go to the Node-RED UI, and test your application. It should look something like <a href="ch17.xhtml#ch17fig11">Figure 17-11</a>.</p>
<div class="image"><a id="ch17fig11"/><img src="../images/f0219-01.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 17-11:</strong> The user interface with the LED 1 switch and the LED 2 slider</p>
<h5 class="h5"><strong>Adding a Temperature Chart and Humidity Gauge</strong></h5>
<p class="noindent">Finally, to create a temperature chart and a humidity gauge, drag an inject node, rpi dht22 node, function node, a chart, and a gauge to the flow. The chart and the gauge are dashboard nodes. Arrange the nodes so your flow looks like <a href="ch17.xhtml#ch17fig13">Figure 17-13</a>.</p>
<div class="image"><a id="ch17fig12"/><img src="../images/f0219-02.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 17-12:</strong> The complete Node-RED flow</p>
<p class="indent"><span epub:type="pagebreak" id="page_220"/>Edit the new nodes’ properties with the settings in the following table.</p>
<table class="topbot-d">
<thead>
<tr>
<td style="vertical-align: top;" class="border_th-o"><p class="tab_th"><strong>NODE</strong></p></td>
<td style="vertical-align: top;" class="border_tha"><p class="tab_th"><strong>PROPERTIES</strong></p></td>
</tr>
</thead>
<tbody>
<tr>
<td style="vertical-align: middle;" class="table-o"><p class="taba"><span class="blue1">timestamp</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="taba"><span class="blue1">Payload: Boolean true<br/>Repeat: interval<br/>Every: 1 minute<br/>Name: Read DHT22</span></p></td>
</tr>
<tr>
<td style="vertical-align: middle;" class="table-o"><p class="taba"><span class="blue1">rpi-dht22</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="taba"><span class="blue1">Sensor model: DHT22<br/>Pin numbering: BCM GPIO<br/>Pin number: 4<br/>Name: DHT22 – GPIO 4</span></p></td>
</tr>
<tr>
<td style="vertical-align: middle;" class="table-o"><p class="taba"><span class="blue1">chart</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="taba"><span class="blue1">Group: Dashboard [Home]<br/>Label: Temperature<br/>Type: Line Chart<br/>X-axis: 1 hour<br/>X-axis Label: HH:mm<br/>Name: Temperature – Chart</span></p></td>
</tr>
<tr>
<td style="vertical-align: middle;" class="table-o"><p class="taba"><span class="blue1">f</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="taba"><span class="blue1">Name: Get humidity<br/>Function:<br/>msg.payload = msg.humidity;<br/>return msg;</span></p></td>
</tr>
<tr>
<td style="vertical-align: middle;" class="table-o"><p class="taba"><span class="blue1">gauge</span></p></td>
<td style="vertical-align: top;" class="table-a"><p class="taba"><span class="blue1">Group: Dashboard [Home]<br/>Type: Gauge<br/>Label: Humidity<br/>Value format: {{value}}<br/>Units: %<br/>Range: min:0; max:100<br/>Name: Humidity - Gauge</span></p></td>
</tr>
</tbody>
</table>
<p class="indent">Click the <strong>Deploy</strong> button and once again test your application. Remember, if you run into any trouble, make sure that your properties match the tables here and double-check the wiring of your nodes against the figures.</p>
<h3 class="h3" id="lev181"><span class="blue1"><strong>RUNNING YOUR APPLICATION</strong></span></h3>
<p class="noindent">Congratulations! You’ve built your first IoT application with Node-RED. Go to <em>http://&lt;Pi IP address&gt;:1880/ui</em> to see how your user interface looks. You can access this URL using any browser on the local network, whether that’s on your computer or smartphone. <a href="ch17.xhtml#ch17fig13">Figure 17-13</a> shows the final circuit you can control using your Node-RED application.</p>
<div class="image"><span epub:type="pagebreak" id="page_221"/><a id="ch17fig13"/><img src="../images/f0221-01.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 17-13:</strong> IoT project with Node-RED</p>
<p class="indent">Your application has a switch to control LED 1, which is also time sensitive; a slider to control the brightness of LED 2; and a chart and gauge to display temperature and humidity.</p>
<h3 class="h3" id="lev182"><span class="blue1"><strong>TAKING IT FURTHER</strong></span></h3>
<p class="noindent">This project just scratched the surface of what Node-RED can do. Here are some ideas for taking this project further:</p>
<ul>
<li class="noindent">Replace the time-sensitive LED with a relay and a lamp (refer to <a href="ch16.xhtml#ch16">Project 16</a> for an introduction to the relay module).</li>
<li class="noindent">Add more sensor readings to your application, like the smoke sensor and movement detection.<span epub:type="pagebreak" id="page_222"/></li>
</ul>
</body></html>