<html><head></head><body><section class="preface" epub:type="preface" id="introduction" title="Introduction"><div class="titlepage"><div><div><h2 class="title">Introduction</h2></div></div></div><div class="mediaobject"><a id="med_id00001"/><img alt="Introduction" src="httpatomoreillycomsourcenostarchimages2127149.png.jpg"/></div><p>This is a book about building the network you need. We’ll dip into the topics of firewalls and related functions, starting from a little theory. You’ll see plenty of examples of filtering and other ways to direct network traffic. I’ll assume that you have a basic to intermediate command of TCP/IP networking concepts and Unix administration.</p><p>All the information in this book comes with a warning: As in many endeavors, the solutions we discuss can be done in more than one way. And, of course, the software world is always changing and the best way to do things may have changed since this book was printed. This book was tested with OpenBSD version 5.6, FreeBSD 10.0, and NetBSD 6.1, and any patches available in late July 2014.</p><div class="sect1" title="This Is Not a HOWTO"><div class="titlepage"><div><div><h2 class="title" id="this_is_not_a_howto" style="clear: both">This Is Not a HOWTO</h2></div></div></div><p>The book is a direct descendant of my popular PF tutorial, and the third edition of the manuscript in book form. With all the work that’s gone into making this book a useful one over the years, I am fairly confident you will find it useful, and I hope you will find it an enjoyable read, too. But please keep in mind that this document is not intended as a precooked recipe for cutting and pasting.</p><p>Just to hammer this in, repeat after me:</p><a id="pro_id00001"/><pre class="programlisting">//The Pledge of the Network Admin//&#13;
&#13;
This is my network.&#13;
&#13;
It is mine,&#13;
or technically, my employer's.&#13;
It is my responsibility,&#13;
and I care for it with all my heart.&#13;
&#13;
There are many other networks a lot like mine,&#13;
&#13;
but none are just like it.&#13;
&#13;
I solemnly swear&#13;
&#13;
that I will not mindlessly paste from HOWTOs.</pre><p>The point is that while I have tested all of the configurations in this book, they’re almost certainly at least a little wrong for your network as written. Please keep in mind that this book is intended to show you a few useful techniques and inspire you to achieve good things.</p><p>Strive to understand your network and what you need to do to make it better and please do not paste blindly from this document or any other.</p></div><div class="sect1" title="What This Book Covers"><div class="titlepage"><div><div><h2 class="title" id="what_this_book_covers" style="clear: both">What This Book Covers</h2></div></div></div><p>The book is intended to be a stand-alone document to enable you to work on your machines with only short forays into man pages and occasional reference to the online and printed resources listed in <a class="xref" href="apa.html" title="Appendix A. Resources">Appendix A</a>.</p><p>Your system probably comes with a prewritten <span class="emphasis"><em>pf.conf</em></span> file containing some commented-out suggestions for useful configurations, as well as a few examples in the documentation directories such as <span class="emphasis"><em>/usr/share/pf/</em></span>. These examples are useful as a reference, but we won’t use them directly in this book. Instead, you’ll learn how to construct a <span class="emphasis"><em>pf.conf</em></span> from scratch, step by step.</p><p>Here is a brief rundown of what you will find in this book:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><a class="xref" href="ch01.html" title="Chapter 1. Building the Network you Need">Chapter 1</a>, walks through basic networking concepts, gives a short overview of PF’s history, and provides some pointers on how to adjust to the BSD way if you are new to this family of operating systems. Read this chapter first to get a sense of how to work with BSD systems.</p></li><li class="listitem"><p><a class="xref" href="ch02.html" title="Chapter 2. PF Configuration Basics">Chapter 2</a>, shows how to enable PF on your system and covers a very basic rule set for a single machine. This chapter is fairly crucial, since all the later configurations are based on the one we build here.</p></li><li class="listitem"><p><a class="xref" href="ch03.html" title="Chapter 3. Into the Real World">Chapter 3</a>, builds on the single-machine configuration in <a class="xref" href="ch02.html" title="Chapter 2. PF Configuration Basics">Chapter 2</a> and leads you through the basics of setting up a gateway to serve as a point of contact between separate networks. By the end of <a class="xref" href="ch03.html" title="Chapter 3. Into the Real World">Chapter 3</a>, you will have built a configuration that is fairly typical for a home or small office network, and have some tricks up your sleeve to make network management easier. You’ll also get an early taste of how to handle services with odd requirements such as FTP, as well as some tips on how to make your network troubleshooting-friendly by catering to some of the frequently less understood Internet protocols and services.</p></li><li class="listitem"><p><a class="xref" href="ch04.html" title="Chapter 4. Wireless Networks Made Easy">Chapter 4</a>, walks you through adding wireless networking to your setup. The wireless environment presents some security challenges, and by the end of this chapter, you may find yourself with a wireless network with access control and authentication via <code class="literal">authpf</code>. Some of the information is likely to be useful in wired environments, too.</p></li><li class="listitem"><p><a class="xref" href="ch05.html" title="Chapter 5. Bigger or Trickier Networks">Chapter 5</a>, tackles the situation where you introduce servers and services that need to be accessible from outside your own network. By the end of this chapter, you may have a network with one or several separate subnets and DMZs, and you will have tried your hand at a couple of different load-balancing schemes via redirections and <code class="literal">relayd</code> in order to improve service quality for your users.</p></li><li class="listitem"><p><a class="xref" href="ch06.html" title="Chapter 6. Turning the Tables for Proactive Defense">Chapter 6</a>, introduces some of the tools in the PF tool chest for dealing with attempts at undesirable activity, and shows how to use them productively. We deal with brute-force password-guessing attempts and other network flooding, as well as the antispam tool <code class="literal">spamd</code>, the OpenBSD spam deferral daemon. This chapter should make your network a more pleasant one for legitimate users and less welcoming to those with less than good intentions.</p></li><li class="listitem"><p><a class="xref" href="ch07.html" title="Chapter 7. Traffic Shaping with Queues and Priorities">Chapter 7</a>, introduces traffic shaping via the priorities and queues systems introduced in OpenBSD 5.5. This chapter also contains tips on how to convert earlier ALTQ-based setups to the new system, as well as information on setting up and maintaining ALTQ on operating systems where the newer queueing system is not available. This chapter should leave you with better resource utilization by adapting traffic shaping to your network needs.</p></li><li class="listitem"><p><a class="xref" href="ch08.html" title="Chapter 8. Redundancy and Resource Availability">Chapter 8</a>, shows how to create redundant configurations, with CARP configurations for both failover and load balancing. This chapter should give you insight into how to create and maintain a highly available, redundant, CARP-based configuration.</p></li><li class="listitem"><p><a class="xref" href="ch09.html" title="Chapter 9. Logging, Monitoring, and Statistics">Chapter 9</a>, explains PF logs. You’ll learn how to extract and process log and statistics data from your PF configuration with tools in the base system as well as optional packages. We’ll also discuss NetFlow and SNMP-based tools.</p></li><li class="listitem"><p><a class="xref" href="ch10.html" title="Chapter 10. Getting Your Setup Just Right">Chapter 10</a>, walks through various options that will help you tune your setup. It ties together the knowledge you have gained from the previous chapters with a rule set debugging tutorial.</p></li><li class="listitem"><p><a class="xref" href="apa.html" title="Appendix A. Resources">Appendix A</a>, is an annotated list of print and online literature and other resources you may find useful as you expand your knowledge of PF and networking topics.</p></li><li class="listitem"><p><a class="xref" href="apb.html" title="Appendix B. A Note On Hardware Support">Appendix B</a>, gives an overview of some of the issues involved in creating a first-rate tool as free software.</p></li></ul></div><p>Each chapter in this book builds on the previous one. While as a free being you can certainly skip around, it may be useful to read through chapters in sequence.</p><p>For a number of reasons, OpenBSD is my favorite operating system. My main environment for writing this book is dominated by OpenBSD systems running either recent snapshots, the odd -stable system and every now and then a locally built -current. This means that the main perspective in the book is the world as seen from the command line in OpenBSD 5.6. However, I keep enough of the other BSDs around that this book should be useful even if your choice of platform is FreeBSD, NetBSD or DragonFly BSD. There are areas of network configuration and PF setup where those systems are noticeably different from the OpenBSD baseline, and in those cases you will find notes on the differences as well as platform-specific advice on how to build a useful configuration for your environment.</p></div></section></body></html>