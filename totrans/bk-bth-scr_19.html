<html><head></head><body>
<div id="sbo-rt-content" class="calibre1"><section aria-labelledby="ch17" epub:type="chapter" role="doc-chapter">
<hgroup>
<h2 class="title" id="ch17">
<span class="cn"><span aria-label=" Page 179. " epub:type="pagebreak" id="pg_179" role="doc-pagebreak" class="calibre2"/><span class="sans_dogma_ot_bold_b_">17</span></span>
<span class="ct1"><span class="sans_dogma_ot_bold_b_">FUNDAMENTALS OF THE FOR COMMAND</span></span>
</h2>
</hgroup>
<figure class="opener"><img alt="" class="opener1" height="407" src="../images/chapter.jpg" width="408"/>
</figure>
<p class="chapterintro">In this chapter, I’ll introduce the <span class="sans_thesansmonocd_w5regular_1">for</span> command, in particular, the <span class="sans_thesansmonocd_w5regular_1">for</span> command used without any options, which just touches on its overall power. This optionless command creates loops, where the input is zero to many values, either simple text values or filenames. Some call this the <i class="calibre13">basic</i> <span class="sans_thesansmonocd_w5regular_1">for</span> command, but I chafe at the modifier because there’s nothing basic about the <span class="sans_thesansmonocd_w5regular_1">for</span> command, even without the options (which I’ll discuss in upcoming chapters).</p>
<p class="tx">Speaking of modifiers in a totally different context, the syntax for this command allows for several <i class="calibre6">modifiers</i>, and you’ll learn how to use these modifiers to extract a wealth of information about any file, such as its size, last modified date and time, attributes, and portions of the path and filename. You’ll also see a couple detailed real-world applications of the optionless <span class="sans_thesansmonocd_w5regular_">for</span> command as a small demonstration of its power, and I’ll start with <span aria-label=" Page 180. " epub:type="pagebreak" id="pg_180" role="doc-pagebreak"/>suggestions on how to build personalized documentation about this important command.</p>
<section aria-labelledby="sec1" epub:type="division">
<h3 class="h" id="sec1"><span id="h1-117"/><span class="sans_futura_std_bold_b_">Creating Personalized Documentation</span></h3>
<p class="tni">Before getting started in earnest, I highly recommend dumping the help documentation for the <span class="sans_thesansmonocd_w5regular_">for</span> command into a text file for future reference. As you learned in <span class="xref"><a href="chapter12.xhtml" class="calibre3">Chapter 12</a></span>, you can redirect the output for any command to a file, and this is true for the <span class="sans_thesansmonocd_w5regular_">help</span> command:</p>
<pre class="pre"><code class="calibre11">for /? &gt; %userprofile%\OneDrive\Desktop\ForCommand.txt</code></pre>
<p class="tx">With the use of this path, the command creates the <i class="calibre6">ForCommand.txt</i> file on my Windows desktop. You can try it with the <i class="calibre6">OneDrive\</i> node removed or write it to the folder of your choosing, but the desktop is a handy place for this file. (You’ll learn about the <span class="sans_thesansmonocd_w5regular_">userprofile</span> pseudo-environment variable in <span class="xref"><a href="chapter21.xhtml" class="calibre3">Chapter 21</a></span>.)</p>
<p class="tx">I haven’t suggested that you do this for any other command, and you’ll always be able to find the help information at the command prompt, so you might be curious why I’m suggesting it here. It’ll eventually become more <i class="calibre6">self</i>-documentation (like a digital notebook) than <i class="calibre6">help</i>-documentation, as you explore and experiment more with the <span class="sans_thesansmonocd_w5regular_">for</span> command. Some of the documentation isn’t the clearest and, as you’ll soon see, could really use some annotating. With this file, you can add your own comments and amend the stated syntax so that it makes more sense to you. You can also add examples of the different forms the command can take and include templates that you can retrieve and use later.</p>
<p class="tx">Subtle changes in the syntax of the <span class="sans_thesansmonocd_w5regular_">for</span> command will greatly impact its functionality or possibly render it inoperable. As a result, all too often coders will take a stab at a <span class="sans_thesansmonocd_w5regular_">for</span> command. If that doesn’t work, they’ll take another stab or several, adding a certain keyword, using double quotes around the input, or maybe trying single quotes. They’ll eventually find something that works or appears to work. A better way is to understand the intricacies of the command’s many forms. Create this personalized documentation and you’ll have everything you need to know about the command in one place (other than this book, of course).</p>
</section>
<section aria-labelledby="sec2" epub:type="division">
<h3 class="h" id="sec2"><span id="h1-118"/><span class="sans_futura_std_bold_b_">The Optionless for Command</span></h3>
<p class="tni">Let’s start with the optionless <span class="sans_thesansmonocd_w5regular_">for</span> command. The <span class="sans_thesansmonocd_w5regular_">for</span> command can be used with (appropriately enough) four options, and I’ll delve into those in the next two chapters, but even when used without options, it's a heavy lifter. The following isn’t an actual command but is the general syntax used to execute a loop zero to many times, and it’s loosely based on what you’ll find in the help documentation:</p>
<pre class="pre"><code class="calibre11">for <var class="calibre12">%%variable</var> in (<var class="calibre12">input</var>) do <var class="calibre12">command</var></code></pre>
<p class="tx"><span aria-label=" Page 181. " epub:type="pagebreak" id="pg_181" role="doc-pagebreak"/>The words <span class="sans_thesansmonocd_w5regular_">for</span>, <span class="sans_thesansmonocd_w5regular_">in</span>, and <span class="sans_thesansmonocd_w5regular_">do</span> are reserved words and will appear just as shown here in your <span class="sans_thesansmonocd_w5regular_">for</span> commands. The parentheses also will appear as shown, but what’s inside them is one of the three main components of an optionless <span class="sans_thesansmonocd_w5regular_">for</span>. Those components are the <span class="sans_thesansmonocd_w5regular_">for</span> variable (<span class="sans_thesansmonocd_w5regular_italic_i_">%%variable</span>), the input you are feeding into the command (<span class="sans_thesansmonocd_w5regular_italic_i_">input</span>), and the core logic executed in the loop (<span class="sans_thesansmonocd_w5regular_italic_i_">command</span>).</p>
<p class="listhead"><b class="calibre10">The <span class="sans_thesansmonocd_w5regular_"><b class="calibre10">for</b></span> Variable</b></p>
<p class="listplainfirst">The <span class="sans_thesansmonocd_w5regular_">for</span> variable is central to this command. If the loop executes multiple times, its value changes with each pass. You define the <span class="sans_thesansmonocd_w5regular_">for</span> variable as two percent signs followed by a singular character. Numbers and many special characters are valid, but most coders use letters of the alphabet pretty much universally. Typically, <span class="sans_thesansmonocd_w5regular_">%%i</span> is the variable of choice, where <span class="sans_thesansmonocd_w5regular_">i</span> represents <i class="calibre6">index</i>.</p>
<p class="listbody">Some coders use <span class="sans_thesansmonocd_w5regular_">%%i</span> exclusively as if it was the only allowed <span class="sans_thesansmonocd_w5regular_">for</span> variable, but don’t limit yourself. A one-character variable name doesn’t allow for a great deal of descriptive potential, but use what’s at your disposal. I often use <span class="sans_thesansmonocd_w5regular_">%%f</span> for a <i class="calibre6">file</i>, <span class="sans_thesansmonocd_w5regular_">%%c</span> for a <i class="calibre6">count</i>, and <span class="sans_thesansmonocd_w5regular_">%%n</span> for a <i class="calibre6">name</i> or <i class="calibre6">number</i>, although <span class="sans_thesansmonocd_w5regular_">%%#</span> also works for <i class="calibre6">number</i>. As with other variable names, many coders use uppercase, but I use lowercase. Do what makes sense to you, and do it consistently.</p>
<p class="listhead"><b class="calibre10">The Input</b></p>
<p class="listplainfirst">The second component of the <span class="sans_thesansmonocd_w5regular_">for</span> command is the input found inside the parentheses or the input you’re feeding into the command. It can be a set of filenames, a single filename, a file mask, multiple file masks, hardcoded text, or resolved variables. It’ll be a while before I can show you all of those, so for now, just consider it to be the input, starting with a single file. (The help documentation uses <span class="sans_thesansmonocd_w5regular_">set</span> instead of <span class="sans_thesansmonocd_w5regular_">input</span>, as in a <i class="calibre6">set</i> of files, but that term is incomplete and easily confused with the command of the same name.)</p>
<p class="listhead"><b class="calibre10">The Command</b></p>
<p class="listplainfirst">Finally, the command is the core logic that executes for each pass of the loop, which can be zero to many times. It can be a single command or many commands spanning several lines of code, and anywhere in that logic you can resolve the <span class="sans_thesansmonocd_w5regular_">for</span> variable to its current value, but this variable is quite different from variables you’ve seen up to this point. Typically, you resolve variables with percent signs, front and back, but you resolve the <span class="sans_thesansmonocd_w5regular_">for</span> variable as it’s defined: prefixed with two percent signs. More plainly, if you define the <span class="sans_thesansmonocd_w5regular_">for</span> variable as <span class="sans_thesansmonocd_w5regular_">%%n</span>, you can resolve it with <span class="sans_thesansmonocd_w5regular_">%%n</span> as part of the command.</p>
<p class="listbody">Similar to the way Batch accepts parameters, a strategically placed tilde removes any double quotes encasing the variable. With <span class="sans_thesansmonocd_w5regular_">for</span> variables, the tilde comes after the second percent sign and before the variable name—for example, <span class="sans_thesansmonocd_w5regular_">%%~n</span>. As with parameters, if there are no double quotes, the tilde has no effect on the resolution.</p>
<p class="listbodyl"><span aria-label=" Page 182. " epub:type="pagebreak" id="pg_182" role="doc-pagebreak"/>In a very surprising twist, the <span class="sans_thesansmonocd_w5regular_">for</span> variable is case-sensitive, which is a notable oddity in the world of Batch. Therefore, <span class="sans_thesansmonocd_w5regular_">%%i</span> isn’t the same entity as <span class="sans_thesansmonocd_w5regular_">%%I</span>. In yet another twist, in <span class="xref"><a href="chapter14.xhtml" class="calibre3">Chapter 14</a></span> you learned to escape a percent sign with another percent sign. This variable also sports double percent signs, but the interpreter is smart enough to differentiate. For instance, if <span class="sans_thesansmonocd_w5regular_">%%i</span> turns out to be a <span class="sans_thesansmonocd_w5regular_">for</span> variable, the interpreter resolves it to its value; if not, the interpreter treats the first character as an escape character and resolves it to the text, <span class="sans_thesansmonocd_w5regular_">%i</span>. Let’s put this all together into some examples we can actually execute.</p>
<p class="tx">The following <span class="sans_thesansmonocd_w5regular_">for</span> command writes the path and filename to the console:</p>
<pre class="pre"><code class="calibre11">for %%f in (C:\Batch\MyInputFile.txt) do  &gt; con echo Filename is %%f</code></pre>
<p class="tni">For its three components, I’m choosing <span class="sans_thesansmonocd_w5regular_">%%f</span> for the <span class="sans_thesansmonocd_w5regular_">for</span> variable as shorthand for <i class="calibre6">file</i> because the input is a file, <i class="calibre6">C:\Batch\MyInputFile.txt</i>. The command component is a single <span class="sans_thesansmonocd_w5regular_">echo</span> command that writes text to the console.</p>
<p class="tx">Before long you’ll see how the <span class="sans_thesansmonocd_w5regular_">for</span> command can create a loop executing multiple times, but this example executes exactly once, with the variable set to the path and filename inside the parentheses. Moving to the command after the <span class="sans_thesansmonocd_w5regular_">do</span> reserved word, the <span class="sans_thesansmonocd_w5regular_">%%f</span> in the <span class="sans_thesansmonocd_w5regular_">echo</span> command resolves to the input text, which writes the following to the console:</p>
<pre class="pre"><code class="calibre11">Filename is C:\Batch\MyInputFile.txt</code></pre>
<p class="tx">Notice the two instances of <span class="sans_thesansmonocd_w5regular_">%%f</span> in the line of code, one close to the beginning and a second at the very end. The first defines the <span class="sans_thesansmonocd_w5regular_">for</span> variable, and the second instance uses the variable; that is, the command component resolves it and uses its value.</p>
<p class="tx">It’s a bit easier to follow if you add parentheses around the <span class="sans_thesansmonocd_w5regular_">echo</span> command, which is also legitimate syntax:</p>
<pre class="pre"><code class="calibre11">for %%f in (C:\Batch\MyInputFile.txt) do  (&gt; con echo Filename is %%f)</code></pre>
<p class="tx">If the command component contains logic that’s at all complex, it’s best to rewrite it on multiple lines for the sake of readability.</p>
<p class="tx">The following example is functionally equivalent to the two previous examples, but the <span class="sans_thesansmonocd_w5regular_">echo</span> command is now on its own line. With multiple line syntax, the parentheses are required:</p>
<pre class="pre"><code class="calibre11">for %%f in (C:\Batch\MyInputFile.txt) do (
    &gt; con echo Filename is %%f
)
</code></pre>
<p class="tni">The open parenthesis must follow the <span class="sans_thesansmonocd_w5regular_">do</span> reserved word on the same line. That’s an important stipulation because other languages allow, and even encourage, the open parenthesis to be on its own line, lined up with the close parenthesis.</p>
<p class="tx"><span aria-label=" Page 183. " epub:type="pagebreak" id="pg_183" role="doc-pagebreak"/>This next example demonstrates three additional points about the optionless <span class="sans_thesansmonocd_w5regular_">for</span> command:</p>
<pre class="pre"><code class="calibre11">for %%F in ("C:\Program Files (x86)\Notepad++\notepad++.exe") do (
   &gt; con echo Filename is %%F
   &gt; con echo Filename is %%~F
)
</code></pre>
<p class="tni">First, notice that multiple commands are more than possible in the code block of a <span class="sans_thesansmonocd_w5regular_">for</span> command. Second, I changed the <span class="sans_thesansmonocd_w5regular_">for</span> variable to <span class="sans_thesansmonocd_w5regular_">%%F</span>, just to show that I can make it pretty much any character that I desire, as long as I consistently use <span class="sans_thesansmonocd_w5regular_">%%F</span> or <span class="sans_thesansmonocd_w5regular_">%%~F</span> in the code block (although you won’t see me use a capital for this type of variable again). Third, I’ve encased the input path and filename in double quotes. Embedded spaces, parentheses, and even plus signs are in the path and name of the Notepad++ 32-bit executable, but the interpreter is unfazed because of those double quotes.</p>
<p class="tx">To demonstrate that the tilde works as it does with parameters, notice that the double quotes are present in the output from the first <span class="sans_thesansmonocd_w5regular_">echo</span> command using <span class="sans_thesansmonocd_w5regular_">%%F</span>, but not the second using <span class="sans_thesansmonocd_w5regular_">%%~F</span>:</p>
<pre class="pre"><code class="calibre11">Filename is "C:\Program Files (x86)\Notepad++\notepad++.exe"
Filename is C:\Program Files (x86)\Notepad++\notepad++.exe
</code></pre>
<p class="tx">This <span class="sans_thesansmonocd_w5regular_">for</span> command might seem like overkill for a single filename as input because it most definitely is overkill. You could’ve written these two lines of text to the console far more easily with nothing more than two <span class="sans_thesansmonocd_w5regular_">echo</span> commands. The real benefit of this logic becomes apparent when you use filesets and file masks to execute the loop multiple times, once for each file.</p>
<blockquote class="calibre8">
<p class="warning"><span class="sans_dogma_ot_bold_b_1">NOTE</span></p>
</blockquote>
<p class="warning-txt"><i class="calibre6">The terms for</i><span class="copyright_accent">command</span> <i class="calibre6">and for</i> <span class="copyright_accent">loop</span> <i class="calibre6">are largely interchangeable, but there’s a subtle difference. Technically, loops can execute zero to many times, but I often use the term</i> <span class="copyright_accent">loop</span> <i class="calibre6">when, because of the nature of the input, I’m confident that it will execute multiple times. Conversely, I use</i> <span class="copyright_accent">command</span> <i class="calibre6">when I know that the logic in the code block will execute exactly once, as in all of the previous examples, but I also use it if there’s ambiguity since it’s the more general and inclusive term.</i></p>
</section>
<section aria-labelledby="sec3" epub:type="division">
<h3 class="h" id="sec3"><span id="h1-119"/><span class="sans_futura_std_bold_b_">Filesets, File Masks, and Loops</span></h3>
<p class="tni">A <i class="calibre6">fileset</i> is, as you might expect, a set of files, and the <span class="sans_thesansmonocd_w5regular_">for</span> command accepts a fileset as input as easily as it accepts a single file. Two files delimited by a comma and a space are in the input fileset here, but you can include any realistic number of files:</p>
<pre class="pre"><code class="calibre11">for %%f in (C:\Batch\MyInputFile.txt, C:\AnotherFolder\AnotherFile.dat) do (
   &gt; con echo Filename is %%f
)
</code></pre>
<p class="tni">A comma without the space would also delimit the two files, as would a space without the comma, but both make the code more readable.</p>
<p class="tx"><span aria-label=" Page 184. " epub:type="pagebreak" id="pg_184" role="doc-pagebreak"/>Here’s the output:</p>
<pre class="pre"><code class="calibre11">Filename is C:\Batch\MyInputFile.txt
Filename is C:\AnotherFolder\AnotherFile.dat
</code></pre>
<p class="tx">This is the first example of a <span class="sans_thesansmonocd_w5regular_">for</span> command transformed into something that executes more than once—that is, something more often called a <span class="sans_thesansmonocd_w5regular_">for</span> loop. The interpreter executes the code block twice because the fileset contains exactly two files. A third file in the fileset would have produced a third line of output.</p>
<p class="tx">In <span class="xref"><a href="chapter7.xhtml" class="calibre3">Chapter 7</a></span>, I introduced file masks using wildcards in the context of the <span class="sans_thesansmonocd_w5regular_">xcopy</span> and <span class="sans_thesansmonocd_w5regular_">robocopy</span> commands, and the same rules (and batveats) apply when you create a file mask as the input to a <span class="sans_thesansmonocd_w5regular_">for</span> command. The asterisk stands in for any number of characters, even no characters at all, and the question mark usually represents exactly one character. However, question marks coming at the end of the mask or followed by a dot, can also represent no character at all.</p>
<p class="tx">To demonstrate, I’ll start with a familiar <span class="sans_thesansmonocd_w5regular_">for</span> command, replacing the filename with the simplest of all masks, a lone asterisk:</p>
<pre class="pre"><code class="calibre11">for %%f in (C:\Batch\*) do (
   &gt; con echo Filename is %%f
)
</code></pre>
<p class="tx">Instead of writing a single filename to the console, the interpreter now outputs every file in the folder, one by one, because every file satisfies the mask. If there are 17 files in <i class="calibre6">C:\Batch\</i>, all 17 fit the mask, and the interpreter writes a message to the console for all 17. The <span class="sans_thesansmonocd_w5regular_">echo</span> command executes just once if only one file exists in the folder, and it doesn’t execute at all if no files exist.</p>
<p class="tx">Writing filenames to the console isn’t very satisfying, but you can perform far more interesting tasks with file masks. You might rename every file that satisfies a mask, or you might call a compiled program once for each file. Whatever the task, the basic structure of the <span class="sans_thesansmonocd_w5regular_">for</span> loop won’t change, and if the logic is going to be at all complex, it’s best to set it up in an internal routine. Here’s a <span class="sans_thesansmonocd_w5regular_">call</span> command invoking just such a routine for each file, passing the path and filename of each file as the sole argument:</p>
<pre class="pre"><code class="calibre11">for %%f in (C:\Batch\*) do (
   call :SomeComplexTask "%%~f"
)
</code></pre>
<p class="tni">If a dozen files fit this mask, the <span class="sans_thesansmonocd_w5regular_">call</span> command invokes the routine 12 times, once for each file.</p>
<p class="tx">Batch even accepts a comma-delimited list of file masks as input to a <span class="sans_thesansmonocd_w5regular_">for</span> command. That is, you can create a fileset containing multiple files and/or file masks.</p>
</section>
<section aria-labelledby="sec4" epub:type="division">
<h3 class="h" id="sec4"><span id="h1-120"/><span aria-label=" Page 185. " epub:type="pagebreak" id="pg_185" role="doc-pagebreak"/><span class="sans_futura_std_bold_b_">Simple Text as Input</span></h3>
<p class="tni">Another intriguing use of the optionless <span class="sans_thesansmonocd_w5regular_">for</span> command isn’t found in the help. You can process a list of values one by one by entering them inside the parentheses as the input. The same set of characters that Batch uses for delimiting passed arguments also delimits this list, so you can use commas, semicolons, equal signs, and tab characters, but a space-delimited list is the norm. The syntax is similar to several previous examples, but with the delimited text replacing the filename or mask. For example, this <span class="sans_thesansmonocd_w5regular_">for</span> loop sequentially passes each of the five words in the parentheses to the code block:</p>
<pre class="pre"><code class="calibre11">for %%i in (Individual line for each word) do (
   &gt; con echo %%i
)
</code></pre>
<p class="tni">The result sees each word written to the console on individual lines:</p>
<pre class="pre"><code class="calibre11">Individual
line
for
each
word
</code></pre>
<p class="tni">Notice that Batch treats the <span class="sans_thesansmonocd_w5regular_">for</span> inside the parentheses as simple text and not as the reserved word that starts the command. I’ve taken some shots at the interpreter, but it’s smart enough to recognize the difference contextually.</p>
<p class="tx">The prior input list is space-delimited, but the interpreter treats anything encased in double quotes as a single value, meaning that the following <span class="sans_thesansmonocd_w5regular_">for</span> command executes its code block exactly twice:</p>
<pre class="pre"><code class="calibre11">for %%i in ("Just two lines for" "these seven words") do (
  &gt; con echo %%~i
)
</code></pre>
<p class="tx">The result is these two lines of output to the console, not seven:</p>
<pre class="pre"><code class="calibre11">Just two lines for
these seven words
</code></pre>
<p class="tni">Notice that the use of a tilde when resolving the <span class="sans_thesansmonocd_w5regular_">for</span> variable, <span class="sans_thesansmonocd_w5regular_">%%~i</span>, removes the double quotes from each string.</p>
<p class="tx">These simple examples belie the immense usefulness of the technique. To illustrate, I’ll start with a bat file that accepts a single parameter for some sort of processing. The process isn’t important here; maybe the passed value is added to a data structure, or maybe it’s a filename passed to a called executable. Whatever the process, the point is that if I have 17 items to process, I must call the bat file 17 times. But with this technique of using a list as input to a <span class="sans_thesansmonocd_w5regular_">for</span> command, I can enhance the bat file so that <span aria-label=" Page 186. " epub:type="pagebreak" id="pg_186" role="doc-pagebreak"/>it’ll accept any number of these parameters and process them one by one in a single execution.</p>
<p class="tx">I’ll start by putting the logic for processing a single parameter into a callable routine defined by the <span class="sans_thesansmonocd_w5regular_">:ProcessParm</span> label. Now I can call that routine zero to many times with this code at the top of my bat file:</p>
<pre class="pre"><code class="calibre11">for %%i in (%*) do (
   call :ProcessParm %%i
)
goto :eof
</code></pre>
<p class="tni">I’ve entered <span class="sans_thesansmonocd_w5regular_">%*</span> into the parentheses as the input of the <span class="sans_thesansmonocd_w5regular_">for</span> command. (Remember from <span class="xref"><a href="chapter11.xhtml" class="calibre3">Chapter 11</a></span> that these two bytes expand to the entire parameter list as received by the bat file.)</p>
<p class="tx">If there are 99 parameters, all 99 values become the input to the <span class="sans_thesansmonocd_w5regular_">for</span> command, and the interpreter executes the body of the loop 99 times. In its first pass, <span class="sans_thesansmonocd_w5regular_">%%i</span> resolves to the first parameter in the list and is the argument passed to the routine in the <span class="sans_thesansmonocd_w5regular_">call</span> command. After the first pass completes, the second parameter becomes the argument for the second pass, and so on, until the interpreter processes all 99 parameters.</p>
<p class="tx">Other uses for this technique abound. For instance, you can easily sum up a space-delimited list of numbers. I haven’t introduced arrays yet, but this offers a great means of adding multiple values to an array.</p>
</section>
<section aria-labelledby="sec5" epub:type="division">
<h3 class="h" id="sec5"><span id="h1-121"/><span class="sans_futura_std_bold_b_">Retrieving File Information</span></h3>
<p class="tni">The optionless <span class="sans_thesansmonocd_w5regular_">for</span> command has one more awesome feature. It can retrieve copious amounts of information and data about a file, such as its size, last modified date/time, and much more. Earlier in this chapter, I discussed using the technique of passing a filename into a <span class="sans_thesansmonocd_w5regular_">for</span> loop for the unimpressive purpose of simply writing the path and filename to the console. For example:</p>
<pre class="pre"><code class="calibre11">for %%f in ("C:\Program Files (x86)\Notepad++\notepad++.exe") do (
   &gt; con echo Filename is %%~f
)
</code></pre>
<p class="tx">Let’s turn that into something impressive. Instead of just regurgitating a path and filename, the code will retrieve and write out an abundance of information about the file. If the file has something to hide, we’ll expose it. The only changes I’ll eventually make to the code in the previous example is to the code block associated with the <span class="sans_thesansmonocd_w5regular_">for</span> command, but first I must introduce modifiers.</p>
<section aria-labelledby="sec6" epub:type="division">
<h4 class="h1" id="sec6"><span id="h2-46"/><span class="sans_futura_std_heavy_oblique_bi_">Modifiers</span></h4>
<p class="tni">The tools for extracting this bevy of useful data about a file are called <i class="calibre6">modifiers</i>, and 9 out of 10 of them are a single alpha character strategically <span aria-label=" Page 187. " epub:type="pagebreak" id="pg_187" role="doc-pagebreak"/>inserted into the <span class="sans_thesansmonocd_w5regular_">for</span> variable as it’s being resolved. (I’ll get to the 10th one soon.)</p>
<p class="tx">To use a modifier, start with a <span class="sans_thesansmonocd_w5regular_">for</span> variable such as <span class="sans_thesansmonocd_w5regular_">%%f</span>. Then insert a tilde and the modifier character after the two percent signs and before the one-character variable name. For instance, <span class="sans_thesansmonocd_w5regular_">X</span> is the modifier for retrieving a file’s extension, meaning that for the <span class="sans_thesansmonocd_w5regular_">for</span> variable, <span class="sans_thesansmonocd_w5regular_">%%f</span>, the interpreter resolves <span class="sans_thesansmonocd_w5regular_">%%~Xf</span> to the extension.</p>
<p class="tx">The following code block now has 11 <span class="sans_thesansmonocd_w5regular_">echo</span> commands. The first two are nothing new; they both display the path and filename, the first with the double quotes in place and the second with them removed. The nine other <span class="sans_thesansmonocd_w5regular_">echo</span> commands use a specific modifier to, understandably enough, modify the <span class="sans_thesansmonocd_w5regular_">%%f</span> variable:</p>
<pre class="pre"><code class="calibre11">for %%f in ("C:\Program Files (x86)\Notepad++\notepad++.exe") do (
   &gt; con echo                  Filename = %%f
   &gt; con echo   Filename Without Quotes = %%~f
   &gt; con echo Fully Qualified Path Name = %%~Ff
   &gt; con echo         Drive Letter Only = %%~Df
   &gt; con echo                 Path Only = %%~Pf
   &gt; con echo             Filename Only = %%~Nf
   &gt; con echo       File Extension Only = %%~Xf
   &gt; con echo           Short Name Only = %%~Sf
   &gt; con echo           File Attributes = %%~Af
   &gt; con echo        File Date and Time = %%~Tf
   &gt; con echo                 File Size = %%~Zf
)
</code></pre>
<p class="tni">I’ve documented each of the nine modifiers in the code itself.</p>
<p class="tx">Executing this code might write the following text to the console. Carefully examine the impact of each modifier on the output:</p>
<pre class="pre"><code class="calibre11">                 Filename = "C:\Program Files (x86)\Notepad++\notepad++.exe"
  Filename Without Quotes = C:\Program Files (x86)\Notepad++\notepad++.exe
Fully Qualified Path Name = C:\Program Files (x86)\Notepad++\notepad++.exe
        Drive Letter Only = C:
                Path Only = \Program Files (x86)\Notepad++\
            Filename Only = notepad++
      File Extension Only = .exe
          Short Name Only = C:\PROGRA~2\NOTEPA~1\NOTEPA~1.EXE
          File Attributes = --a--------
       File Date and Time = 03/11/2010 01:23 PM
                File Size = 2958480
</code></pre>
<p class="tx">That’s quite a bit of data. Starting with the third line, the <span class="sans_thesansmonocd_w5regular_">F</span> modifier gives us the fully qualified pathname. Often, <span class="sans_thesansmonocd_w5regular_">%%~Ff</span> resolves to the same value as <span class="sans_thesansmonocd_w5regular_">%%~f</span> as it does here, but not always. If the input consists of a filename and extension without a path and if the interpreter finds the file in the current directory, then <span class="sans_thesansmonocd_w5regular_">%%~f</span> mimics the input without the path, but <span class="sans_thesansmonocd_w5regular_">%%~Ff</span> resolves to the full path and filename.</p>
<p class="tx">Next, you can see the individual components of this fully qualified pathname in the next four modifiers: <span class="sans_thesansmonocd_w5regular_">D</span> (drive letter with the colon), <span class="sans_thesansmonocd_w5regular_">P</span> (path <span aria-label=" Page 188. " epub:type="pagebreak" id="pg_188" role="doc-pagebreak"/>or directory without the drive letter), <span class="sans_thesansmonocd_w5regular_">N</span> (bare filename—that is, without the extension), and the aforementioned <span class="sans_thesansmonocd_w5regular_">X</span> (file extension, including the preceding dot).</p>
<p class="tx">The <span class="sans_thesansmonocd_w5regular_">S</span> modifier generates the short filename defined by the operating system (I promised I’d show you how to find this in <span class="xref"><a href="chapter7.xhtml" class="calibre3">Chapter 7</a></span>), while the <span class="sans_thesansmonocd_w5regular_">A</span> modifier generates a list of file attributes. A file has 11 possible attributes, and if the file doesn’t have a particular attribute, the corresponding byte is a dash. The only attribute that pops in this list is <span class="sans_thesansmonocd_w5regular_">a</span>, meaning that the file is archived, but the lack of other values indicates that the file isn’t hidden, compressed, read only, or characterized by any of the other possible attributes. (I’ll discuss attributes more in <span class="xref"><a href="chapter30.xhtml" class="calibre3">Chapter 30</a></span>.)</p>
<p class="tx">Finally, the <span class="sans_thesansmonocd_w5regular_">T</span> modifier provides the date and time when the file was last modified, and the <span class="sans_thesansmonocd_w5regular_">Z</span> modifier returns the file size in bytes. (Remember that <span class="sans_thesansmonocd_w5regular_">S</span> is taken.) The lack of commas makes it hard to read, but you can see from the output that the file is nearly 3MB.</p>
<blockquote class="calibre8">
<p class="warning"><span class="sans_dogma_ot_bold_b_1">NOTE</span></p>
</blockquote>
<p class="warning-txt"><i class="calibre6">Unless you’ve jumped directly to this portion of the book, you know that I’m not a fan of the overuse of capitalization, but everything has its place. The modifiers are case-insensitive, but I use uppercase to make them stand out. The lowercase for variable, which in this case is f for</i> <span class="copyright_accent">file</span><i class="calibre6">, terminates what’s to be resolved, but I know that I’m in the minority. Be aware that most coders do just the opposite, so you’re more likely to see %%~zI to get the file size of %%I than my %%~Zf used to get the size of %%f.</i></p>
<p class="tx">The applications of modifiers are boundless, but one simple use is to execute some sort of complex task for a file, but only if the file has data in it. Say the Batch code is to process a data file coming from another source. Even if the source has no data to report, it’s best for it to create an empty file, because no file at all would leave the specter of a failed process. To make this work, the bat file needs to determine whether the file is empty or populated. Consider this:</p>
<pre class="pre"><code class="calibre11">for %%f in ("C:\Batch\IntermediateFile.dat") do (
   if %%~Zf gtr 0  call :SomeComplexTask "%%~Ff"
)
</code></pre>
<p class="tni">The <span class="sans_thesansmonocd_w5regular_">if</span> command inside the <span class="sans_thesansmonocd_w5regular_">for</span> command efficiently (and maybe even elegantly) verifies that the size of an intermediate data file, <span class="sans_thesansmonocd_w5regular_">%%~Zf</span>, is greater than <span class="sans_thesansmonocd_w5regular_">0</span> bytes before calling a routine and passing it the path and name of the file.</p>
<section aria-labelledby="sec7" epub:type="division">
<h5 class="h2" id="sec7"><span class="sans_futura_std_bold_b_">The path Modifier</span></h5>
<p class="tni">I owe you a 10th modifier, and just in case you haven’t found this syntax convoluted enough, the syntax for the path modifier is completely different from the other nine. But that’s not a problem, because its function is also completely different. I’ll explain what it does momentarily, but first understand that this modifier is actually an oddly delimited variable. While the other modifiers are each a single character, the path modifier is a variable name preceded by a dollar sign and trailed by a colon.</p>
<p class="tx"><span aria-label=" Page 189. " epub:type="pagebreak" id="pg_189" role="doc-pagebreak"/>To set this up, and for reasons that will soon become obvious, let’s use the <span class="sans_thesansmonocd_w5regular_">path</span> variable in the modifier (the same variable containing a concatenation of semicolon-delimited directories introduced in <span class="xref"><a href="chapter8.xhtml" class="calibre3">Chapter 8</a></span>). The variable should already be set on your machine, but you can append and prepend additional directories to it:</p>
<pre class="pre"><code class="calibre11">path C:\Batch\SubDir\;C:\Batch\;%path%C:\Budget\;</code></pre>
<p class="tx">To see this modifier in action, let’s modify the <span class="sans_thesansmonocd_w5regular_">%%f</span> variable with the <span class="sans_thesansmonocd_w5regular_">%%~$path:f</span> syntax. Notice the <span class="sans_thesansmonocd_w5regular_">path</span> variable, sandwiched between the <span class="sans_thesansmonocd_w5regular_">$</span> and <span class="sans_thesansmonocd_w5regular_">:</span> characters; all three pieces make up the modifier. Now we can use it in a <span class="sans_thesansmonocd_w5regular_">for</span> command:</p>
<pre class="pre"><code class="calibre11">for %%f in (FourBrits.txt) do (
   &gt; con echo File Found: %%~$path:f
)
</code></pre>
<p class="tx">What’s this modifier’s actual function? It instructs the interpreter to traverse the <span class="sans_thesansmonocd_w5regular_">path</span> variable, starting from its first listed directory, looking for the first, and only the first, file named <i class="calibre6">FourBrits.txt</i>. If the file exists in the second directory in our <span class="sans_thesansmonocd_w5regular_">path</span> variable, but not the first, the resulting output contains the fully qualified path and filename:</p>
<pre class="pre"><code class="calibre11">File Found: C:\Batch\FourBrits.txt</code></pre>
<p class="tni">If the interpreter can’t find a file named <i class="calibre6">FourBrits.txt</i> in any of the directories defined in the <span class="sans_thesansmonocd_w5regular_">path</span> variable, it simply resolves <span class="sans_thesansmonocd_w5regular_">%%~$path:f</span> to null.</p>
<p class="tx">This functionality was clearly designed for the <span class="sans_thesansmonocd_w5regular_">path</span> variable, and the help documentation explicitly uses the <span class="sans_thesansmonocd_w5regular_">path</span> variable in its example; only near the bottom does it mention that you can replace it with any valid variable, meaning any variable containing a list of directories. Even so, this is usually referred to simply as the <i class="calibre6">path</i> modifier and used nearly exclusively with the <span class="sans_thesansmonocd_w5regular_">path</span> variable.</p>
</section>
<section aria-labelledby="sec8" epub:type="division">
<h5 class="h2" id="sec8"><span class="sans_futura_std_bold_b_">Stacked Modifiers</span></h5>
<p class="tni">Used individually the modifiers are very helpful, but their real power becomes apparent when you stack multiple modifiers—that is, when used together to resolve more than one file characteristic at a time. For instance, you can resolve the filename and extension separately and then concatenate them as <span class="sans_thesansmonocd_w5regular_">%%~Nf%%~Xf</span>, but that’s a tad bit messy. Instead, <span class="sans_thesansmonocd_w5regular_">%%~NXf</span> sublimely produces the identical result more elegantly. Here are three typical examples:</p>
<pre class="pre"><code class="calibre11">for %%f in ("C:\Batch\FourBrits.txt") do (
   &gt; con echo  Drive Letter and Path = %%~DPf
   &gt; con echo Filename and Extension = %%~NXf
   &gt; con echo    File Date/Time/Size = %%~TZf bytes
)
</code></pre>
<p class="tx"><span aria-label=" Page 190. " epub:type="pagebreak" id="pg_190" role="doc-pagebreak"/>This code might write the following to the console:</p>
<pre class="pre"><code class="calibre11"> Drive Letter and Path = C:\Batch\
Filename and Extension = FourBrits.txt
   File Date/Time/Size = 04/20/2018 01:14 PM 518 bytes
</code></pre>
<p class="tx">With stacked modifiers you can easily retrieve the full path of a file without the filename, or just the filename and extension without the path. The last example might look good on a report with the hardcoded text, <span class="sans_thesansmonocd_w5regular_">bytes</span>, at the end.</p>
<p class="tx">Stacked modifiers even work with the path modifier:</p>
<pre class="pre"><code class="calibre11">for %%f in (FourBrits.txt) do (
   &gt; con echo Path Found: %%~DP$path:f
)
</code></pre>
<p class="tni">This code writes out the full path, sans the filename and extension, of the first file found in the <span class="sans_thesansmonocd_w5regular_">path</span> hierarchy named <i class="calibre6">FourBrits.txt</i>.</p>
</section>
</section>
<section aria-labelledby="sec9" epub:type="division">
<h4 class="h1" id="sec9"><span id="h2-47"/><span class="sans_futura_std_heavy_oblique_bi_">Parameters with Modifiers</span></h4>
<p class="tni">Before getting into a couple of real-world examples, I’ll return to a discussion on parameters from <span class="xref"><a href="chapter11.xhtml" class="calibre3">Chapter 11</a></span>. It turns out that the modifiers that extract file information in the context of <span class="sans_thesansmonocd_w5regular_">for</span> commands work equally well on parameters.</p>
<p class="tx">I had mentioned that you can pass filenames, with or without their paths, as arguments to a bat file and that the called bat file can resolve them with <span class="sans_thesansmonocd_w5regular_">%~1</span>, <span class="sans_thesansmonocd_w5regular_">%~2</span>, and so on. Also, you can resolve <span class="sans_thesansmonocd_w5regular_">%~0</span> to the full path and filename of the bat file being executed. Well, the same modifiers (and stacked modifiers) just discussed also apply to any parameter that represents a file. Assume that the following code receives the names of two files as its first two parameters:</p>
<pre class="pre"><code class="calibre11">&gt; con echo           Size of File #1 = %~Z1
&gt; con echo  Date and Time of File #2 = %~T2
</code></pre>
<p class="tni">The first command writes out the size in bytes of the first file, and the second command writes out the last modified date and time of the second file.</p>
<p class="tx">Attach two specific stacked modifiers to the hidden parameter, and <span class="sans_thesansmonocd_w5regular_">%~DP0</span> resolves to the drive letter and path of the bat file being executed. With this information, you can create a subdirectory, deposit other files in this or sibling directories, or update a logfile associated with the bat file, and you can do this without knowing where the bat file will eventually be installed. Maybe it will live on multiple servers.</p>
<p class="tx">Modifiers allow you to retrieve a great deal of file information with minimal keystrokes.</p>
</section>
</section>
<section aria-labelledby="sec10" epub:type="division">
<h3 class="h" id="sec10"><span id="h1-122"/><span aria-label=" Page 191. " epub:type="pagebreak" id="pg_191" role="doc-pagebreak"/><span class="sans_futura_std_bold_b_">Real-World Applications</span></h3>
<p class="tni">Let’s put all of the useful tools that you’ve just learned in this chapter to use in two real-world examples.</p>
<section aria-labelledby="sec11" epub:type="division">
<h4 class="h1" id="sec11"><span id="h2-48"/><span class="sans_futura_std_heavy_oblique_bi_">Renaming Files on a Backup</span></h4>
<p class="tni">With the use of a file mask, the optionless <span class="sans_thesansmonocd_w5regular_">for</span> command can generate a list of files, and the modifiers can extract the individual components of the path and filename of each. Combining both of those features, you can copy a set of files to a mirror folder structure on another drive, all while tweaking the target filenames.</p>
<p class="tx">Assume that I have a folder called <i class="calibre6">C:\Budget\</i> that unsurprisingly contains budget information. The name certainly suggests a directory that should be backed up, perhaps to an external <i class="calibre6">D:\</i> drive, but with the exact same folder structure so that the files are easy to find and compare. To complicate matters, I’d like to prepend the name of every file with <span class="sans_thesansmonocd_w5regular_">Bkup_</span>, because when both folders are open, it’s far too easy to work in the wrong one, but not if every file in the backup directory starts with this unique and descriptive text. One way to accomplish this task is with a single command inside a <span class="sans_thesansmonocd_w5regular_">for</span> loop (although in the real-real-world, you’ll want some error handling):</p>
<pre class="pre"><code class="calibre11">for %%f in ("C:\Budget\*.*") do (
   echo f | xcopy "%%~Ff" "D:%%~PfBkup_%%~NXf" /Y /F
)
</code></pre>
<p class="tx">I’ve encased both the source and destination in double quotes to accommodate the possibility of embedded spaces in a filename. The source is the fully qualified path and filename, <span class="sans_thesansmonocd_w5regular_">%%~Ff</span>, but the destination is a bit more esoteric. While it might look like random keystrokes, it’s really a concatenation of four items that become more readable when I bolded the two <span class="sans_thesansmonocd_w5regular_">for</span> variables using modifiers in contrast to the constants:</p>
<pre class="pre"><code class="calibre11">D:<b class="calibre10">%%~Pf</b>Bkup_<b class="calibre10">%%~NXf</b></code></pre>
<p class="tni">The destination path starts with the hardcoded drive letter and a colon, <span class="sans_thesansmonocd_w5regular_">D:</span>, followed by the path of the source file variable without the drive letter, <span class="sans_thesansmonocd_w5regular_">%%~Pf</span>; this mimics the source folder from the original drive. The path starts and ends with a backslash, so what comes next, <span class="sans_thesansmonocd_w5regular_">Bkup_</span>, is the start of the filename. To complete the target filename, the interpreter finds a second <span class="sans_thesansmonocd_w5regular_">for</span> variable, <span class="sans_thesansmonocd_w5regular_">%%~NXf</span>, this one having stacked modifiers for the source filename (<span class="sans_thesansmonocd_w5regular_">N</span>) and file extension (<span class="sans_thesansmonocd_w5regular_">X</span>).</p>
<p class="tx">Putting it all together, if the interpreter finds a file named <i class="calibre6">C:\Budget\Budget.January2023.xlsx</i>, the resulting destination string is:</p>
<pre class="pre"><code class="calibre11">D:<b class="calibre10">\Budget\</b>Bkup_<b class="calibre10">Budget.January2023.xlsx</b></code></pre>
<p class="tx"><span aria-label=" Page 192. " epub:type="pagebreak" id="pg_192" role="doc-pagebreak"/>Where the variable names start and end can be confusing if you’re used to Batch variables that are delimited by percent signs. When the compiler sees <span class="sans_thesansmonocd_w5regular_">%%~</span>, it knows that it’s about to resolve a <span class="sans_thesansmonocd_w5regular_">for</span> variable—that’s the start. Because the variable defined by this <span class="sans_thesansmonocd_w5regular_">for</span> command is <span class="sans_thesansmonocd_w5regular_">%%f</span>, the interpreter terminates the variable when it finds a lowercase <span class="sans_thesansmonocd_w5regular_">f</span>—that’s the end. In between the start and end, the interpreter looks for zero to a few valid modifiers. Anything after its termination could be constants, a single percent sign starting the resolution of a more traditional Batch variable, or another <span class="sans_thesansmonocd_w5regular_">for</span> variable.</p>
<p class="tx">Each and every file in the source directory matching the mask is copied to the backup path on the <i class="calibre6">D:\</i> drive with the name of the destination file tweaked. This tool is very powerful with a lot going on inside an apparently modest <span class="sans_thesansmonocd_w5regular_">for</span> command, but to harness that power, a deep understanding of the syntax is a must.</p>
</section>
<section aria-labelledby="sec12" epub:type="division">
<h4 class="h1" id="sec12"><span id="h2-49"/><span class="sans_futura_std_heavy_oblique_bi_">Processing a Variable Number of Files</span></h4>
<p class="tni">At the end of <span class="xref"><a href="chapter11.xhtml" class="calibre3">Chapter 11</a></span>, I introduced the concept of a <i class="calibre6">wrapper</i> bat file—that is, a bat file that does little more than execute a program designed to process a single input file. The bat file is a wrapper around the executable. Also in that chapter, I demonstrated how to drag and drop multiple files onto a bat file, resulting in one execution of the bat file with multiple arguments. As impressive as that is, it’s of little use without a bat file that not only can handle all of those parameters but can do so for a variable number of parameters.</p>
<p class="tx">In this chapter, I’ve discussed two important concepts that are applicable to building such a wrapper bat file. One is the immensely useful technique of using modifiers on a parameter to extract file information, and the other is the <span class="sans_thesansmonocd_w5regular_">for</span> command’s ability to process a list of values.</p>
<p class="tx">Now, for the setup. I’ve created a compiled program to convert Java code to C# code, and it accepts two arguments: the input file followed by the output file. Code conversion programs can help minimize the pain of updating old code to a newer language. A module of one language is the input to the program that converts much of the original syntax to another language, outputting a file of the same name but with a different extension in the same folder. From the perspective of the bat file, it accepts one to many <i class="calibre6">.java</i> files as parameters, determines the path and filename of the corresponding <i class="calibre6">.cs</i> output files, and invokes the compiled code with those two arguments—and the <i class="calibre6">.java</i> files can be in any folder.</p>
<p class="tx">The following bat file, stripped of all error handling and comments, does everything desired. The <span class="sans_thesansmonocd_w5regular_">for</span> command accepts the entire list of parameters as <span class="sans_thesansmonocd_w5regular_">%*</span>, passing them one by one into the code block as <span class="sans_thesansmonocd_w5regular_">%%f</span>, which in turn is the sole argument passed to the <span class="sans_thesansmonocd_w5regular_">:ConvOneFile</span> routine:</p>
<pre class="pre"><code class="calibre11"> for %%f in (%*) do (
    call :ConvOneFile %%f
 )
 goto :eof

<span aria-label=" Page 193. " epub:type="pagebreak" id="pg_193" role="doc-pagebreak"/>:ConvOneFile
 ConvJava2CS.exe  %~F1  %~DPN1.cs
 goto :eof
</code></pre>
<p class="tx">When invoking <i class="calibre6">ConvJava2CS.exe</i>, this Batch code passes it two arguments, the input and output files, respectively. I’m retrieving the fully qualified name of the input file with <span class="sans_thesansmonocd_w5regular_">%~F1</span>, which is the first parameter with the <span class="sans_thesansmonocd_w5regular_">F</span> modifier. The output path and filename, <span class="sans_thesansmonocd_w5regular_">%~DPN1.cs</span>, is more complex. I’m using the same parameter, namely, <span class="sans_thesansmonocd_w5regular_">%~1</span>, but with the modifiers for the drive (<span class="sans_thesansmonocd_w5regular_">D</span>), path (<span class="sans_thesansmonocd_w5regular_">P</span>), and filename (<span class="sans_thesansmonocd_w5regular_">N</span>)—that is, <span class="sans_thesansmonocd_w5regular_">%~F1</span> without the extension denoted by the <span class="sans_thesansmonocd_w5regular_">X</span> modifier. Then I tack on the new extension with the hardcoded <span class="sans_thesansmonocd_w5regular_">.cs</span> to create the output filename. Notice that a single percent sign, not two, is leading these variables, because these are parameters, not <span class="sans_thesansmonocd_w5regular_">for</span> variables; I’m calling the executable from inside a routine, not inside the <span class="sans_thesansmonocd_w5regular_">for</span> command.</p>
<p class="tx">A critic (or maybe someone not versed in Batch) might balk at this, arguing that it’s better or easier to accept a single parameter into the compiled code and do the manipulation of the filename in the program. But this approach is inflexible; if someone else wanted to run this process on scores or even hundreds of files, they might want the output dropped into a subfolder, or even a folder on another server. By manipulating the filenames in the Batch code, dropping the output into a subdirectory doesn’t require a change to the compiled code; instead, simply change <span class="sans_thesansmonocd_w5regular_">%~DPN1.cs</span> to <span class="sans_thesansmonocd_w5regular_">%~DP1%subDir%\%~N1.cs</span>. You could define a hardcoded subdirectory, but here I’m using <span class="sans_thesansmonocd_w5regular_">subDir</span> as the variable for the subdirectory node. You can even execute an <span class="sans_thesansmonocd_w5regular_">md</span> command with <span class="sans_thesansmonocd_w5regular_">%~DP1%subDir%\</span> as its argument to create the subdirectory if it doesn’t already exist.</p>
<p class="tx">There’s always overhead with changes to compiled code, even simple ones. You have to run the compiler and take care to keep the source and executable in sync. Whenever possible, coders should make simple changes, such as deriving file connectors or filenames, in the Batch code, in my humble opinion at least.</p>
<p class="tx">You can now use this bat file to process multiple files or a single file or even no files. If no arguments are passed, the <span class="sans_thesansmonocd_w5regular_">for</span> command has no input, and the code block never executes. Once again, just a few lines of code are doing much more than first meets the eye.</p>
</section>
</section>
<section aria-labelledby="sec13" epub:type="division">
<h3 class="h" id="sec13"><span id="h1-123"/><span class="sans_futura_std_bold_b_">Resolving Variables in Code Blocks</span></h3>
<p class="tni">Before moving forward with all of the functionality and power that you can unlock from the <span class="sans_thesansmonocd_w5regular_">for</span> command with options, I must mention that up to this point I’ve resolved variables for a single use inside of a code block associated with a <span class="sans_thesansmonocd_w5regular_">for</span> command, but this is hopelessly simplistic and naive. It’s far more common to assign a piece of data to a variable and then use it, and maybe even modify it, all inside a complex code block. This is the same type of code block detailed in <span class="xref"><a href="chapter16.xhtml" class="calibre3">Chapter 16</a></span>, and the same rules concerning how to resolve variables apply.</p>
<p class="tx"><span aria-label=" Page 194. " epub:type="pagebreak" id="pg_194" role="doc-pagebreak"/>For example, you might want two distinct fields for a file’s date and time, but the <span class="sans_thesansmonocd_w5regular_">T</span> modifier resolves them as a single value, and that isn’t an issue at all with this code:</p>
<pre class="pre"><code class="calibre11">for %%f in ("C:\Program Files (x86)\Notepad++\notepad++.exe") do (
   set filDtTm=%%~Tf
   &gt; con echo                 File Date = !filDtTm:~0,10!
   &gt; con echo                 File Time = !filDtTm:~11!
)
</code></pre>
<p class="tx">At the top of the code block, I assign the entire string to the <span class="sans_thesansmonocd_w5regular_">filDtTm</span> variable and then substring out the date and time on the next two lines, respectively. This is a fine yet crucial point: I’m using exclamation marks and delayed expansion to resolve the variable just set inside the code block. Percent sign delimiters would’ve resolved this to the value of <span class="sans_thesansmonocd_w5regular_">filDtTm</span> prior to the code block, and since it’s unlikely to have been set at all, the results probably would’ve been garbage (<span class="sans_thesansmonocd_w5regular_">~0,10</span> and <span class="sans_thesansmonocd_w5regular_">~11</span>).</p>
<p class="tx">Ultimately, if you assign a value to a variable inside a code block, you must use exclamation marks to retrieve its current value. If the logic gets overly complex, there are other techniques, and in <span class="xref"><a href="chapter20.xhtml" class="calibre3">Chapter 20</a></span>, I’ll demonstrate how to make full use of delayed expansion inside these more complex code blocks. But as a rule, understand that these variables have two possible values and do your best to not overcomplicate the code.</p>
</section>
<section aria-labelledby="sec14" epub:type="division">
<h3 class="h" id="sec14"><span id="h1-124"/><span class="sans_futura_std_bold_b_">Summary</span></h3>
<p class="tni">In this chapter, I detailed the optionless <span class="sans_thesansmonocd_w5regular_">for</span> command, its components, how it works with filesets and file masks, and how to retrieve a great deal of file information with modifiers. You learned that this command usually accepts a file or files as input, but it can also accept a string of text. I hope you found the real-world applications interesting and informative and that they encouraged you to think about other pertinent uses for this important command. I also included some pointers on how to resolve variables defined in the code block of the <span class="sans_thesansmonocd_w5regular_">for</span> command.</p>
<p class="tx">The remaining chapters of <span class="xref"><a href="part2.xhtml" class="calibre3">Part II</a></span> will reveal much more, all of which will be needed to appreciate the panorama of the <span class="sans_thesansmonocd_w5regular_">for</span> command. In the next chapter, I’ll discuss some functionality that’s opened up with options; one enumerates directories instead of files, one traverses subdirectories looking for files, and the last implements a crucial bit of functionality: an iterative loop.</p>
</section>
</section>
</div></body></html>