<html><head></head><body>
<h1 class="part" id="part02"><span epub:type="pagebreak" id="page_63"/><strong>PART 2</strong><br/><img alt="image" class="middle" src="../images/common-01.jpg"/><br/><span class="big"><strong>SOUND</strong></span></h1>&#13;


<h2 class="h2a" id="ch07"><span epub:type="pagebreak" id="page_64"/>PROJECT 7: ARDUINO MELODY</h2>&#13;
<p class="h2sub"><strong><span class="blue">SO FAR ALL THE PROJECTS HAVE BEEN VISUAL, SO NOW IT’S TIME TO MAKE SOME MUSIC. IN THIS PROJECT WE WILL BE USING A PIEZOELECTRIC BUZZER TO PLAY SOME MELODIES.</span></strong></p>&#13;
<div class="image2"><img alt="image" src="../images/f0064-01.jpg"/></div>&#13;
<div class="image2"><span epub:type="pagebreak" id="page_65"/><img alt="image" src="../images/f0065-01.jpg"/></div>&#13;
<div class="box1">&#13;
<p class="boxtitle1a"><span class="blue"><strong>PARTS REQUIRED</strong></span></p>&#13;
<p class="bull">• Arduino board</p>&#13;
<p class="bull">• Piezo buzzer</p>&#13;
</div>&#13;
<h3 class="h3" id="ch07lev1sec01"><span epub:type="pagebreak" id="page_66"/><span class="blue"><strong>HOW IT WORKS</strong></span></h3>&#13;
<p class="noindent">The Arduino melody uses a piezo buzzer to create frequencies that resemble recognizable notes. You use the Arduino IDE to give the order, rate, and duration of the notes to play a specific tune.</p>&#13;
<p class="indent"><em>Piezos</em> are inexpensive buzzers often used in small toys. A piezo element without its plastic housing looks like a gold metallic disc with connected positive (typically red) and negative (typically black) wires. A piezo is capable only of making a clicking sound, which we create by applying voltage. We can make recognizable notes by getting the piezo to click hundreds of times a second at a particular frequency, so first we need to know the frequency of the different tones we want. <a href="ch07.xhtml#ch7tab1">Table 7-1</a> shows the notes and their corresponding frequencies. <em>Period</em> is the duration of time, in microseconds, at which the frequency is created. We halve this number to get the <code>timeHigh</code> value, which is used in the code to create the note.</p>&#13;
<p class="tablecap"><a id="ch7tab1"/><strong>TABLE 7-1:</strong><br/>Notes and their corresponding frequences</p>&#13;
<table class="all">&#13;
<thead>&#13;
<tr>&#13;
<td class="tableth1a-b" style="vertical-align: middle;"><p class="tablec"><strong>NOTE</strong></p></td>&#13;
<td class="tableth1" style="vertical-align: middle;"><p class="tablec"><strong>FREQUENCY</strong></p></td>&#13;
<td class="tableth1aa-b" style="vertical-align: middle;"><p class="tablec"><strong>PERIOD</strong></p></td>&#13;
<td class="tableth2" style="vertical-align: middle;"><p class="tablec"><strong>TIMEHIGH</strong></p></td>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td class="table1a-b" style="vertical-align: middle;"><p class="tablec"><span class="blue">C</span></p></td>&#13;
<td class="table1" style="vertical-align: middle;"><p class="tablec"><span class="blue">261 Hz</span></p></td>&#13;
<td class="table1aa-b" style="vertical-align: middle;"><p class="tablec"><span class="blue">3,830</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="blue">1915</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-b" style="vertical-align: middle;"><p class="tablec"><span class="blue">D</span></p></td>&#13;
<td class="table1" style="vertical-align: middle;"><p class="tablec"><span class="blue">294 Hz</span></p></td>&#13;
<td class="table1aa-b" style="vertical-align: middle;"><p class="tablec"><span class="blue">3,400</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="blue">1700</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-b" style="vertical-align: middle;"><p class="tablec"><span class="blue">E</span></p></td>&#13;
<td class="table1" style="vertical-align: middle;"><p class="tablec"><span class="blue">329 Hz</span></p></td>&#13;
<td class="table1aa-b" style="vertical-align: middle;"><p class="tablec"><span class="blue">3,038</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="blue">1519</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-b" style="vertical-align: middle;"><p class="tablec"><span class="blue">F</span></p></td>&#13;
<td class="table1" style="vertical-align: middle;"><p class="tablec"><span class="blue">349 Hz</span></p></td>&#13;
<td class="table1aa-b" style="vertical-align: middle;"><p class="tablec"><span class="blue">2,864</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="blue">1432</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-b" style="vertical-align: middle;"><p class="tablec"><span class="blue">G</span></p></td>&#13;
<td class="table1" style="vertical-align: middle;"><p class="tablec"><span class="blue">392 Hz</span></p></td>&#13;
<td class="table1aa-b" style="vertical-align: middle;"><p class="tablec"><span class="blue">2,550</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="blue">1275</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-b" style="vertical-align: middle;"><p class="tablec"><span class="blue">A</span></p></td>&#13;
<td class="table1" style="vertical-align: middle;"><p class="tablec"><span class="blue">440 Hz</span></p></td>&#13;
<td class="table1aa-b" style="vertical-align: middle;"><p class="tablec"><span class="blue">2,272</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="blue">1136</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-b" style="vertical-align: middle;"><p class="tablec"><span class="blue">B</span></p></td>&#13;
<td class="table1" style="vertical-align: middle;"><p class="tablec"><span class="blue">493 Hz</span></p></td>&#13;
<td class="table1aa-b" style="vertical-align: middle;"><p class="tablec"><span class="blue">2,028</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="blue">1014</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table3a-b" style="vertical-align: middle;"><p class="tablec"><span class="blue">C</span></p></td>&#13;
<td class="table3" style="vertical-align: middle;"><p class="tablec"><span class="blue">523 Hz</span></p></td>&#13;
<td class="table3aa-b" style="vertical-align: middle;"><p class="tablec"><span class="blue">1,912</span></p></td>&#13;
<td class="table3l" style="vertical-align: middle;"><p class="tablec"><span class="blue">956</span></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<p class="indent">The code sends a square wave of the appropriate frequency to the piezo, generating the corresponding tone (see <a href="ch02.xhtml#ch02">Project 2</a> for more on waveform). The tones are calculated through the following equation:</p>&#13;
<pre>timeHigh = period / 2 = 1 / (2 * toneFrequency)</pre>&#13;
<p class="indent">The setup of this project is really simple and uses only two wires connected to the Arduino.</p>&#13;
<h3 class="h3" id="ch07lev1sec02"><span epub:type="pagebreak" id="page_67"/><span class="blue"><strong>THE BUILD</strong></span></h3>&#13;
<ol>&#13;
<li><p class="noindenta">Connect the piezo’s black wire directly to GND on the Arduino, and the red wire to Arduino pin 9.</p>&#13;
<table class="all">&#13;
<thead>&#13;
<tr>&#13;
<td class="tableth1a-b" style="vertical-align: middle;"><p class="tablec"><strong>PIEZO</strong></p></td>&#13;
<td class="tableth2" style="vertical-align: middle;"><p class="tablec"><strong>ARDUINO</strong></p></td>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td class="table1a-b" style="vertical-align: middle;"><p class="tablec"><span class="blue">Red wire</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="blue">Pin 9</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table3a-b" style="vertical-align: middle;"><p class="tablec"><span class="blue">Black wire</span></p></td>&#13;
<td class="table3l" style="vertical-align: middle;"><p class="tablec"><span class="blue">GND</span></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table></li>&#13;
<li><p class="noindenta">Check that your setup matches that of <a href="ch07.xhtml#ch7fig1">Figure 7-1</a>, and then upload the code shown next in “<a href="ch07.xhtml#ch07lev1sec03">The Sketch</a>”.</p>&#13;
<p class="figcaption"><a id="ch7fig1"/><strong>FIGURE 7-1</strong><br/>Circuit diagram for the Arduino melody</p>&#13;
<div class="image"><img alt="image" src="../images/f07-01.jpg"/></div></li>&#13;
</ol>&#13;
<h3 class="h3" id="ch07lev1sec03"><span class="blue"><strong>THE SKETCH</strong></span></h3>&#13;
<p class="noindent">We’ll start off with a simple tune. At <span class="ent">➊</span>, we tell the IDE that the tune is made up of 15 notes. Then we store the notes of the melody in a character array as a text string in the order in which they should be played, and the length for which each note will play is stored in another array as integers. If you want to change the tune, you can alter the notes in the array at <span class="ent">➋</span>, and the number of beats for which each corresponding note plays at <span class="ent">➌</span>. Finally at <span class="ent">➍</span> we set the tempo at which the tune will be played. Put it all together, and what does it play?</p>&#13;
<pre>   <span class="ash">// Melody (cleft) 2005 D. Cuartielles for K3</span><br/><br/>   <span class="green2">int</span> speakerPin = 9; <span class="ash">// Pin connected to the piezo</span><br/><span class="ent">➊</span> <span class="green2">int</span> <span class="orange1">length</span> = 15; <span class="ash">// Number of notes</span><br/><span class="ent">➋</span> <span class="green2">char</span> notes[] = "ccggaagffeeddc "; <span class="ash">// A space represents a rest</span><br/><span class="ent">➌</span> <span class="green2">int</span> beats[] = { 1, 1, 1, 1, 1, 1, 2, 1, 1, 1, 1, 1, 1, 2, 4 };<br/><span class="ent">➍</span> <span class="green2">int</span> tempo = 300;<br/><span epub:type="pagebreak" id="page_68"/><br/>   <span class="green2">void</span> playTone(<span class="green2">int</span> <span class="orange1">tone</span>, <span class="green2">int</span> duration) {<br/>     <span class="green3">for</span> (<span class="green2">long</span> i = 0; i &lt; duration * 1000L; i += <span class="orange1">tone</span> * 2) {<br/>       <span class="orange1">digitalWrite</span>(speakerPin, <span class="green2">HIGH</span>);<br/>       <span class="orange1">delayMicroseconds</span>(<span class="orange1">tone</span>);<br/>       <span class="orange1">digitalWrite</span>(speakerPin, <span class="green2">LOW</span>);<br/>       <span class="orange1">delayMicroseconds</span>(<span class="orange1">tone</span>);<br/>     }<br/>   }<br/><br/>   <span class="ash">// Set timeHigh value to specific notes</span><br/>   <span class="green2">void</span> playNote(<span class="green2">char</span> note, <span class="green2">int</span> duration) {<br/>     <span class="green2">char</span> names[] = { <span class="green2">'c'</span>, <span class="green2">'d</span>', <span class="green2">'e</span>', <span class="green2">'f</span>', <span class="green2">'g</span>', <span class="green2">'a</span>', <span class="green2">'b</span>', <span class="green2">'C'</span> };<br/>     <span class="green2">int</span> tones[] = { 1915, 1700, 1519, 1432, 1275, 1136, 1014, 956 };<br/>     <span class="green3">for</span> (<span class="green2">int</span> i = 0; i &lt; 8; i++) { <span class="ash">// Play tone that corresponds</span><br/>                                   <span class="ash">// to note name</span><br/>       <span class="green3">if</span> (names[i] == note) {<br/>         playTone(tones[i], duration);<br/>       }<br/>     }<br/>   }<br/><br/>   <span class="green2">void</span> <span class="green3">setup</span>() {<br/>     <span class="orange1">pinMode</span>(speakerPin, <span class="green2">OUTPUT</span>); <span class="ash">// Set speakerPin as output</span><br/>   }<br/><br/>   <span class="ash">// Play the tune</span><br/>   <span class="green2">void</span> <span class="green3">loop</span>() {<br/>     <span class="green3">for</span> (<span class="green2">int</span> i = 0; i &lt; <span class="orange1">length</span>; i++) {<br/>       <span class="green3">if</span> (notes[i] == ' ') {<br/>         <span class="orange1">delay</span>(beats[i] * tempo); // Rest<br/>       }<br/>       <span class="green2">else</span> {<br/>         playNote(notes[i], beats[i] * tempo);<br/>       }<br/>       <span class="orange1">delay</span>(tempo / 2); <span class="ash">// Pause between notes</span><br/>     }<br/>   }</pre>&#13;


<h2 class="h2a" id="ch08"><span epub:type="pagebreak" id="page_69"/>PROJECT 8: MEMORY GAME</h2>&#13;
<p class="h2sub"><strong><span class="blue">IN THIS PROJECT WE’LL CREATE OUR OWN VERSION OF AN ATARI ARCADE MEMORY GAME CALLED <span class="underline">TOUCH ME</span>, USING FOUR LEDS, FOUR PUSHBUTTON SWITCHES, A PIEZO BUZZER, AND SOME RESISTORS AND JUMPER WIRES.</span></strong></p>&#13;
<div class="image2"><img alt="image" src="../images/f0069-01.jpg"/></div>&#13;
<div class="image2"><span epub:type="pagebreak" id="page_70"/><img alt="image" src="../images/f0070-01.jpg"/></div>&#13;
<div class="box1">&#13;
<p class="boxtitle1a"><span class="blue"><strong>PARTS REQUIRED</strong></span></p>&#13;
<p class="bull">• Arduino board</p>&#13;
<p class="bull">• Breadboard</p>&#13;
<p class="bull">• Jumper wires</p>&#13;
<p class="bull">• Piezo buzzer</p>&#13;
<p class="bull">• 4 momentary tactile four-pin pushbuttons</p>&#13;
<p class="bull">• 4 LEDs</p>&#13;
<p class="bull">• 4 220-ohm resistors</p>&#13;
</div>&#13;
<div class="box1">&#13;
<p class="boxtitle1a"><span class="blue"><strong>LIBRARIES REQUIRED</strong></span></p>&#13;
<p class="bull">• Tone</p>&#13;
</div>&#13;
<h3 class="h3" id="ch08lev1sec01"><span epub:type="pagebreak" id="page_71"/><span class="blue"><strong>HOW IT WORKS</strong></span></h3>&#13;
<p class="noindent">The original Atari game had four colored panels, each with an LED that lit up in a particular pattern that players had to repeat back (see <a href="ch08.xhtml#ch8fig1">Figure 8-1</a>).</p>&#13;
<p class="figcaption"><a id="ch8fig1"/><strong>FIGURE 8-1:</strong><br/>The original <em>Touch Me</em> game</p>&#13;
<div class="image"><img alt="image" src="../images/f08-01.jpg"/></div>&#13;
<p class="indent">This memory game plays a short introductory tune and flashes an LED. When you press the correct corresponding button, the lights flash again in a longer sequence. Each time you repeat the sequence back correctly, the game adds an extra step to make the sequence more challenging for you. When you make an error, the game resets itself.</p>&#13;
<h3 class="h3" id="ch08lev1sec02"><span class="blue"><strong>THE BUILD</strong></span></h3>&#13;
<ol>&#13;
<li><p class="noindenta">Place the pushbuttons in the breadboard so they straddle the center break with pins A and B on one side of the break, and C and D on the other, as shown in <a href="ch08.xhtml#ch8fig2">Figure 8-2</a>. (See <a href="ch01.xhtml#ch01">Project 1</a> for more information on how the pushbutton works.)</p>&#13;
<p class="figcaption"><a id="ch8fig2"/><strong>FIGURE 8-2:</strong><br/>A pushbutton has four pins.</p>&#13;
<div class="image"><img alt="image" src="../images/f08-02.jpg"/></div></li>&#13;
<li><p class="noindenta">Connect pin B of each pushbutton to the GND rail of your breadboard, and connect the rail to Arduino GND.</p></li>&#13;
<li><p class="noindenta">Connect pin D of each pushbutton to Arduino’s digital pins 2 through 5 in order.</p></li>&#13;
<li><p class="noindenta"><span epub:type="pagebreak" id="page_72"/>Insert the LEDs into the breadboard with the shorter, negative legs connected to pin C of each pushbutton. Insert the positive leg into the hole on the right, as shown in the circuit diagram in <a href="ch12.xhtml#ch12fig3">Figure 12-3</a>.</p>&#13;
<table class="all">&#13;
<thead>&#13;
<tr>&#13;
<td class="tableth1a-b" style="vertical-align: middle;"><p class="tablec"><strong>PUSHBUTTON</strong></p></td>&#13;
<td class="tableth2" style="vertical-align: middle;"><p class="tablec"><strong>ARDUINO/LED</strong></p></td>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td class="table1a-b" style="vertical-align: middle;"><p class="tablec"><span class="blue">Pin B</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="blue">GND</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-b" style="vertical-align: middle;"><p class="tablec"><span class="blue">Pin C</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="blue">LED negative legs</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table3a-b" style="vertical-align: middle;"><p class="tablec"><span class="blue">Pin D</span></p></td>&#13;
<td class="table3l" style="vertical-align: middle;"><p class="tablec"><span class="blue">Arduino pins 2–5</span></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table></li>&#13;
<li><p class="noindenta">Place a 220-ohm resistor into the breadboard with one wire connected to the positive leg of each LED. Connect the other wire of the resistor to the Arduino as follows.</p>&#13;
<table class="all">&#13;
<thead>&#13;
<tr>&#13;
<td class="tableth1a-b" style="vertical-align: middle;"><p class="tablec"><strong>LEDS</strong></p></td>&#13;
<td class="tableth2" style="vertical-align: middle;"><p class="tablec"><strong>ARDUINO/PUSHBUTTON</strong></p></td>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td class="table1a-b" style="vertical-align: middle;"><p class="tablec"><span class="blue">Positive legs</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="blue">Arduino pins 8–11 via 220-ohm resistors</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table3a-b" style="vertical-align: middle;"><p class="tablec"><span class="blue">Negative legs</span></p></td>&#13;
<td class="table3l" style="vertical-align: middle;"><p class="tablec"><span class="blue">Pushbutton pin C</span></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<p class="indent">Make sure the red LED connected to pin 11 is paired with the pushbutton connected to pin 5, the yellow LED connected to pin 10 is paired with the pushbutton connected to pin 4, the green LED connected to pin 9 is paired with the pushbutton connected to pin 3, and the blue LED connected to pin 8 is paired with the pushbutton connected to pin 2.</p></li>&#13;
<li><p class="noindenta">Connect the black wire of the piezo directly to Arduino GND, and the red wire to Arduino pin 12.</p>&#13;
<table class="all">&#13;
<thead>&#13;
<tr>&#13;
<td class="tableth1a-b" style="vertical-align: middle;"><p class="tablec"><strong>PIEZO</strong></p></td>&#13;
<td class="tableth2" style="vertical-align: middle;"><p class="tablec"><strong>ARDUINO</strong></p></td>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td class="table1a-b" style="vertical-align: middle;"><p class="tablec"><span class="blue">Red wire</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="blue">Pin 12</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table3a-b" style="vertical-align: middle;"><p class="tablec"><span class="blue">Black wire</span></p></td>&#13;
<td class="table3l" style="vertical-align: middle;"><p class="tablec"><span class="blue">GND</span></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table></li>&#13;
<li><p class="noindenta">Check your setup against <a href="ch08.xhtml#ch8fig3">Figure 8-3</a>, and then upload the code in “<a href="ch08.xhtml#ch08lev1sec03">The Sketch</a>” on <a href="ch08.xhtml#page_73">page 73</a>.</p>&#13;
<p class="figcaption"><a id="ch8fig3"/><strong>FIGURE 8-3:</strong><br/>Circuit diagram for the memory game</p>&#13;
<div class="image"><span epub:type="pagebreak" id="page_73"/><img alt="image" src="../images/f08-03.jpg"/></div></li>&#13;
</ol>&#13;
<h3 class="h3" id="ch08lev1sec03"><span class="blue"><strong>THE SKETCH</strong></span></h3>&#13;
<p class="noindent">The sketch generates a random sequence in which the LEDs will light; a random value generated for <code>y</code> in the pattern loop determines which LED is lit (e.g., if y is 2, the LED connected to pin 2 will light). You have to follow and repeat back the pattern to advance to the next level.</p>&#13;
<p class="indent">In each level, the previous lights are repeated and one more randomly generated light is added to the pattern. Each light is associated with a different tone from the piezo, so you get a different tune each time, too. When you get a sequence wrong, the sketch restarts with a different random sequence. For the sketch to compile correctly, you will need to install the Tone library (available from <em><a href="http://nostarch.com.com/arduinohandbook/">http://nostarch.com.com/arduinohandbook/</a></em>). See “<a href="ch00.xhtml#ch00lev2sec07">Libraries</a>” on <a href="ch00.xhtml#page_7">page 7</a> for details.</p>&#13;
<pre><span epub:type="pagebreak" id="page_74"/><span class="ash">// Used with kind permission from Abdullah Alhazmy www.Alhazmy13.net</span><br/><br/>#include &lt;Tone.h&gt;<br/>Tone speakerpin;<br/><span class="green2">int</span> starttune[] = {NOTE_C4, NOTE_F4, NOTE_C4, NOTE_F4, NOTE_C4,<br/>                   NOTE_F4, NOTE_C4, NOTE_F4, NOTE_G4, NOTE_F4,<br/>                   NOTE_E4, NOTE_F4, NOTE_G4};<br/><span class="green2">int</span> duration2[] = {100, 200, 100, 200, 100, 400, 100, 100, 100, 100,<br/>                   200, 100, 500};<br/><span class="green2">int</span> note[] = {NOTE_C4, NOTE_C4, NOTE_G4, NOTE_C5, NOTE_G4, NOTE_C5};<br/><span class="green2">int</span> duration[] = {100, 100, 100, 300, 100, 300};<br/><span class="green2">boolean</span> button[] = {2, 3, 4, 5}; <span class="ash">// Pins connected to</span><br/>                                 <span class="ash">// pushbutton inputs</span><br/><span class="green2">boolean</span> ledpin[] = {8, 9, 10, 11}; <span class="ash">// Pins connected to LEDs</span><br/><span class="green2">int</span> turn = 0;         <span class="ash">// Turn counter</span><br/><span class="green2">int</span> buttonstate = 0;  <span class="ash">// Check pushbutton state</span><br/><span class="green2">int</span> randomArray[100]; <span class="ash">// Array that can store up to 100 inputs</span><br/><span class="green2">int</span> inputArray[100];<br/><br/><span class="green2">void</span> <span class="green3">setup</span>() {<br/>  <span class="orange1">Serial</span><span class="green3">.</span><span class="orange1">begin</span>(9600);<br/>  speakerpin.<span class="orange1">begin</span>(12); <span class="ash">// Pin connected to piezo buzzer</span><br/>  <span class="green3">for</span> (<span class="green2">int</span> x = 0; x &lt; 4; x++) {<br/>    <span class="orange1">pinMode</span>(ledpin[x], <span class="green2">OUTPUT</span>); <span class="ash">// Set LED pins as output</span><br/>  }<br/>  <span class="green3">for</span> (<span class="green2">int</span> x = 0; x &lt; 4; x++) {<br/>    <span class="orange1">pinMode</span>(button[x], <span class="green2">INPUT</span>); <span class="ash">// Set pushbutton pins as inputs</span><br/>    <span class="orange1">digitalWrite</span>(button[x], <span class="green2">HIGH</span>); <span class="ash">// Enable internal pullup;</span><br/>                                   <span class="ash">// pushbuttons start in high</span><br/>                                   <span class="ash">// position; logic reversed</span><br/>  }<br/>  <span class="ash">// Generate "more randomness" with randomArray for the output</span><br/>  <span class="ash">// function so pattern is different each time</span><br/>  <span class="orange1">randomSeed</span>(<span class="orange1">analogRead</span>(0));<br/>  <span class="green3">for</span> (<span class="green2">int</span> thisNote = 0; thisNote &lt; 13; thisNote ++) {<br/>    speakerpin.play(starttune[thisNote]); <span class="ash">// Play the next note</span><br/>    <span class="green3">if</span> (thisNote == 0 || thisNote == 2 || thisNote == 4 ||<br/>        thisNote == 6) { <span class="ash">// Hold the note</span><br/>      <span class="orange1">digitalWrite</span>(ledpin[0], <span class="green2">HIGH</span>);<br/>    }<br/>    <span class="green3">if</span> (thisNote == 1 || thisNote == 3 || thisNote == 5 ||<br/>        thisNote == 7 || thisNote == 9 || thisNote == 11) {<br/>      <span class="orange1">digitalWrite</span>(ledpin[1], <span class="green2">HIGH</span>);<br/>    }<br/>    <span class="green3">if</span> (thisNote == 8 || thisNote == 12) {<br/>      <span class="orange1">digitalWrite</span>(ledpin[2], <span class="green2">HIGH</span>);<br/>    }<br/>    <span class="green3">if</span> (thisNote == 10) {<br/>      <span class="orange1">digitalWrite</span>(ledpin[3], <span class="green2">HIGH</span>);<br/>    }<br/>    <span class="orange1">delay</span>(duration2[thisNote]);<br/>    speakerpin.<span class="orange1">stop</span>(); <span class="ash">// Stop for the next note</span><br/>    <span class="orange1">digitalWrite</span>(ledpin[0], <span class="green2">LOW</span>);<br/>    <span epub:type="pagebreak" id="page_75"/><span class="orange1">digitalWrite</span>(ledpin[1], <span class="green2">LOW</span>);<br/>    <span class="orange1">digitalWrite</span>(ledpin[2], <span class="green2">LOW</span>);<br/>    <span class="orange1">digitalWrite</span>(ledpin[3], <span class="green2">LOW</span>);<br/>    <span class="orange1">delay</span>(25);<br/>  }<br/>  <span class="orange1">delay</span>(1000);<br/>}<br/><br/><span class="green2">void</span> <span class="green3">loop</span>() {<br/>  <span class="ash">// Generate the array to be matched by the player</span><br/>  <span class="green3">for</span> (<span class="green2">int</span> y = 0; y &lt;= 99; y++) {<br/>    <span class="orange1">digitalWrite</span>(ledpin[0], <span class="green2">HIGH</span>);<br/>    <span class="orange1">digitalWrite</span>(ledpin[1], <span class="green2">HIGH</span>);<br/>    <span class="orange1">digitalWrite</span>(ledpin[2], <span class="green2">HIGH</span>);<br/>    <span class="orange1">digitalWrite</span>(ledpin[3], <span class="green2">HIGH</span>);<br/>    <span class="ash">// Play the next note</span><br/>    <span class="green3">for</span> (<span class="green2">int</span> thisNote = 0; thisNote &lt; 6; thisNote ++) {<br/>      speakerpin.play(note[thisNote]); <span class="ash">// Hold the note</span><br/>      <span class="orange1">delay</span>(duration[thisNote]);       <span class="ash">// Stop for the next note</span><br/>      speakerpin.<span class="orange1">stop</span>();<br/>      <span class="orange1">delay</span>(25);<br/>    }<br/>    <span class="orange1">digitalWrite</span>(ledpin[0], <span class="green2">LOW</span>);<br/>    <span class="orange1">digitalWrite</span>(ledpin[1], <span class="green2">LOW</span>);<br/>    <span class="orange1">digitalWrite</span>(ledpin[2], <span class="green2">LOW</span>);<br/>    <span class="orange1">digitalWrite</span>(ledpin[3], <span class="green2">LOW</span>);<br/>    <span class="orange1">delay</span>(1000);<br/>    <span class="ash">// Limited by the turn variable</span><br/>    <span class="green3">for</span> (<span class="green2">int</span> y = turn; y &lt;= turn; y++) {<br/>      <span class="orange1">Serial</span>.println(<span class="green2">""</span>);<br/>      <span class="orange1">Serial</span>.print(<span class="green2">"Turn: "</span>);<br/>      <span class="orange1">Serial</span>.print(y);<br/>      <span class="orange1">Serial</span>.println(<span class="green2">""</span>);<br/>      randomArray[y] = <span class="orange1">random</span>(1, 5); <span class="ash">// Assign a random number (1-4)</span><br/>      <span class="ash">// Light LEDs in random order</span><br/>      <span class="green3">for</span> (<span class="green2">int</span> x = 0; x &lt;= turn; x++) {<br/>        <span class="orange1">Serial</span>.<span class="orange1">print</span>(randomArray[x]);<br/>        <span class="green3">for</span> (<span class="green2">int</span> y = 0; y &lt; 4; y++) {<br/>          <span class="green3">if</span> (randomArray[x] == 1 &amp;&amp; ledpin[y] == 8) {<br/>            <span class="orange1">digitalWrite</span>(ledpin[y], <span class="green2">HIGH</span>);<br/>            speakerpin.play(NOTE_G3, 100);<br/>            <span class="orange1">delay</span>(400);<br/>            <span class="orange1">digitalWrite</span>(ledpin[y], <span class="green2">LOW</span>);<br/>            <span class="orange1">delay</span>(100);<br/>          }<br/>          <span class="green3">if</span> (randomArray[x] == 2 &amp;&amp; ledpin[y] == 9) {<br/>            <span class="orange1">digitalWrite</span>(ledpin[y], <span class="green2">HIGH</span>);<br/>            speakerpin.play(NOTE_A3, 100);<br/>            <span class="orange1">delay</span>(400);<br/>            <span class="orange1">digitalWrite</span>(ledpin[y], <span class="green2">LOW</span>);<br/>            <span class="orange1">delay</span>(100);<br/>          }<br/>          <span class="green3">if</span> (randomArray[x] == 3 &amp;&amp; ledpin[y] == 10) {<br/>            <span class="orange1">digitalWrite</span>(ledpin[y], <span class="green2">HIGH</span>);<br/>            <span epub:type="pagebreak" id="page_76"/>speakerpin.play(NOTE_B3, 100);<br/>            <span class="orange1">delay</span>(400);<br/>            <span class="orange1">digitalWrite</span>(ledpin[y], <span class="green2">LOW</span>);<br/>            <span class="orange1">delay</span>(100);<br/>          }<br/>          <span class="green3">if</span> (randomArray[x] == 4 &amp;&amp; ledpin[y] == 11) {<br/>            <span class="orange1">digitalWrite</span>(ledpin[y], <span class="green2">HIGH</span>);<br/>            speakerpin.play(NOTE_C4, 100);<br/>            <span class="orange1">delay</span>(400);<br/>            <span class="orange1">digitalWrite</span>(ledpin[y], <span class="green2">LOW</span>);<br/>            <span class="orange1">delay</span>(100);<br/>          }<br/>        }<br/>      }<br/>    }<br/>    input();<br/>  }<br/>}<br/><br/><span class="ash">// Check whether input matches the pattern</span><br/><span class="green2">void</span> input() {<br/>  <span class="green3">for</span> (<span class="green2">int</span> x = 0; x &lt;= turn;) {<br/>    <span class="green3">for</span> (<span class="green2">int</span> y = 0; y &lt; 4; y++) {<br/>      buttonstate = <span class="orange1">digitalRead</span>(button[y]); <span class="ash">// Check for button push</span><br/>      <span class="green3">if</span> (buttonstate == <span class="green2">LOW</span> &amp;&amp; button[y] == 2) {<br/>        <span class="orange1">digitalWrite</span>(ledpin[0], <span class="green2">HIGH</span>);<br/>        speakerpin.play(NOTE_G3, 100);<br/>        <span class="orange1">delay</span>(200);<br/>        <span class="orange1">digitalWrite</span>(ledpin[0], <span class="green2">LOW</span>);<br/>        inputArray[x] = 1;<br/>        <span class="orange1">delay</span>(250);<br/>        <span class="orange1">Serial</span>.<span class="orange1">print</span>(" ");<br/>        <span class="orange1">Serial</span>.<span class="orange1">print</span>(1);<br/>        <span class="ash">// Check if value of user input matches the generated array</span><br/>        <span class="green3">if</span> (inputArray[x] != randomArray[x]) {<br/>          fail(); <span class="ash">// If not, fail function is called</span><br/>        }<br/>        x++;<br/>      }<br/>      <span class="green3">if</span> (buttonstate == <span class="green2">LOW</span> &amp;&amp; button[y] == 3) {<br/>        <span class="orange1">digitalWrite</span>(ledpin[1], <span class="green2">HIGH</span>);<br/>        speakerpin.play(NOTE_A3, 100);<br/>        <span class="orange1">delay</span>(200);<br/>        <span class="orange1">digitalWrite</span>(ledpin[1], <span class="green2">LOW</span>);<br/>        inputArray[x] = 2;<br/>        <span class="orange1">delay</span>(250);<br/>        <span class="orange1">Serial</span>.<span class="orange1">print</span>(<span class="green2">" "</span>);<br/>        <span class="orange1">Serial</span>.<span class="orange1">print</span>(2);<br/>        <span class="green3">if</span> (inputArray[x] != randomArray[x]) {<br/>          fail();<br/>        }<br/>        x++;<br/>      }<br/>      <span class="green3">if</span> (buttonstate == <span class="green2">LOW</span> &amp;&amp; button[y] == 4) {<br/>        <span epub:type="pagebreak" id="page_77"/><span class="orange1">digitalWrite</span>(ledpin[2], <span class="green2">HIGH</span>);<br/>        speakerpin.play(NOTE_B3, 100);<br/>        <span class="orange1">delay</span>(200);<br/>        <span class="orange1">digitalWrite</span>(ledpin[2], <span class="green2">LOW</span>);<br/>        inputArray[x] = 3;<br/>        <span class="orange1">delay</span>(250);<br/>        <span class="orange1">Serial</span>.<span class="orange1">print</span>(" ");<br/>        <span class="orange1">Serial</span>.<span class="orange1">print</span>(3);<br/>        <span class="green3">if</span> (inputArray[x] != randomArray[x]) {<br/>          fail();<br/>        }<br/>        x++;<br/>      }<br/>      <span class="green3">if</span> (buttonstate == <span class="green2">LOW</span> &amp;&amp; button[y] == 5) {<br/>        <span class="orange1">digitalWrite</span>(ledpin[3], <span class="green2">HIGH</span>);<br/>        speakerpin.play(NOTE_C4, 100);<br/>        <span class="orange1">delay</span>(200);<br/>        <span class="orange1">digitalWrite</span>(ledpin[3], <span class="green2">LOW</span>);<br/>        inputArray[x] = 4;<br/>        <span class="orange1">delay</span>(250);<br/>        <span class="orange1">Serial</span>.<span class="orange1">print</span>(" ");<br/>        <span class="orange1">Serial</span>.<span class="orange1">print</span>(4);<br/>        <span class="green3">if</span> (inputArray[x] != randomArray[x]) {<br/>          fail();<br/>        }<br/>        x++;<br/>      }<br/>    }<br/>  }<br/>  <span class="orange1">delay</span>(500);<br/>  turn++; <span class="ash">// Increment turn count</span><br/>}<br/><br/><span class="ash">// Function used if player fails to match the sequence</span><br/><span class="green2">void</span> fail() {<br/>  for (<span class="green2">int</span> y = 0; y &lt;= 2; y++) { <span class="ash">// Flash lights to indicate failure</span><br/>    <span class="orange1">digitalWrite</span>(ledpin[0], <span class="green2">HIGH</span>);<br/>    <span class="orange1">digitalWrite</span>(ledpin[1], <span class="green2">HIGH</span>);<br/>    <span class="orange1">digitalWrite</span>(ledpin[2], <span class="green2">HIGH</span>);<br/>    <span class="orange1">digitalWrite</span>(ledpin[3], <span class="green2">HIGH</span>);<br/>    speakerpin.play(NOTE_G3, 300);<br/>    <span class="orange1">delay</span>(200);<br/>    <span class="orange1">digitalWrite</span>(ledpin[0], <span class="green2">LOW</span>);<br/>    <span class="orange1">digitalWrite</span>(ledpin[1], <span class="green2">LOW</span>);<br/>    <span class="orange1">digitalWrite</span>(ledpin[2], <span class="green2">LOW</span>);<br/>    <span class="orange1">digitalWrite</span>(ledpin[3], <span class="green2">LOW</span>);<br/>    speakerpin.play(NOTE_C3, 300);<br/>    <span class="orange1">delay</span>(200);<br/>  }<br/>  <span class="orange1">delay</span>(500);<br/>  turn = -1; <span class="ash">// Reset turn value to start the game again</span><br/>}</pre>&#13;


<h2 class="h2a" id="ch09"><span epub:type="pagebreak" id="page_78"/>PROJECT 9: SECRET KNOCK LOCK</h2>&#13;
<p class="h2sub"><strong><span class="blue">FOR CENTURIES CLANDESTINE GROUPS HAVE USED SECRET KNOCKS TO PREVENT UNAUTHORIZED ENTRY. LET’S BRING THIS SYSTEM INTO MODERN TIMES, BY CREATING OUR OWN ELECTRONIC GATEKEEPER.</span></strong></p>&#13;
<div class="image2"><img alt="image" src="../images/f0078-01.jpg"/></div>&#13;
<div class="image2"><span epub:type="pagebreak" id="page_79"/><img alt="image" src="../images/f0079-01.jpg"/></div>&#13;
<div class="box1">&#13;
<p class="boxtitle1a"><span class="blue"><strong>PARTS REQUIRED</strong></span></p>&#13;
<p class="bull">• Arduino board</p>&#13;
<p class="bull">• Breadboard</p>&#13;
<p class="bull">• Jumper wires</p>&#13;
<p class="bull">• Tower Pro SG90 9g servomotor</p>&#13;
<p class="bull">• Piezo buzzer</p>&#13;
<p class="bull">• 3 LEDs</p>&#13;
<p class="bull">• 1M-ohm resistor</p>&#13;
<p class="bull">• 3 220-ohm resistors</p>&#13;
</div>&#13;
<div class="box1">&#13;
<p class="boxtitle1a"><span class="blue"><strong>LIBRARIES REQUIRED</strong></span></p>&#13;
<p class="bull">• Servo</p>&#13;
</div>&#13;
<h3 class="h3" id="ch09lev1sec01"><span epub:type="pagebreak" id="page_80"/><span class="blue"><strong>HOW IT WORKS</strong></span></h3>&#13;
<p class="noindent">In this project, you’ll make a circuit that moves a servo arm to unlock a box or door when you provide the correct secret knock. So far we’ve been using a piezo buzzer only to make noise, but we can also use it as a sensor to detect sounds—in this case, knocks. When a piezo is struck it rings like a bell, but instead of producing sound it outputs voltage, which generates a number depending on the force of the strike. We’ll measure this voltage in numbers, and if the knocks fall within a certain range, the Arduino will register them as correct. If three knocks of the correct voltage are detected, you’ve cracked the code, and the servo arm moves to unlock the box or door.</p>&#13;
<p class="indent">Here are the two lines of code we’ll use later in the sketch to set the range for the voltage; if the voltage is between 10 and 100, the knock will be registered.</p>&#13;
<pre><span class="green2">const int</span> quietKnock = 10;<br/><span class="green2">const int</span> loudKnock = 100;</pre>&#13;
<p class="indent">If you knock too softly or too hard, the knock won’t register. You’ll need to do three “correct” knocks to trigger the servo arm to move. When the correct sequence and strength of knock are registered, the servo arm swings 90 degrees to “unlock” whatever it is set up with. The LEDs, shown in <a href="ch09.xhtml#ch9fig1">Figure 9-1</a>, serve as indicators of your lock’s status: the red LED lights when the knocks are incorrect and the servo arm has not moved (that is, the box or door is still locked); the yellow LED flashes when a knock is registered and a correct code is sensed; and the green LED lights and the servomotor moves after three correct knocks.</p>&#13;
<p class="figcaption"><a id="ch9fig1"/><strong>FIGURE 9-1:</strong><br/>The LED setup</p>&#13;
<div class="image"><img alt="image" src="../images/f09-01.jpg"/></div>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_81"/>For the best result, remove your piezo from its casing and attach it directly to the inside of a box or outside of a door so it is more sensitive to the vibration of the knock.</p>&#13;
<h3 class="h3" id="ch09lev1sec02"><span class="blue"><strong>THE BUILD</strong></span></h3>&#13;
<ol>&#13;
<li><p class="noindenta">Insert a 1M-ohm resistor into your breadboard and connect the piezo’s red wire to one leg and its black wire to the other. Connect the black wire to the GND rail, and the red wire to Arduino pin A0.</p>&#13;
<table class="all">&#13;
<thead>&#13;
<tr>&#13;
<td class="tableth1a-b" style="vertical-align: middle;"><p class="tablec"><strong>PIEZO</strong></p></td>&#13;
<td class="tableth2" style="vertical-align: middle;"><p class="tablec"><strong>ARDUINO</strong></p></td>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td class="table1a-b" style="vertical-align: middle;"><p class="tablec"><span class="blue">Red wire</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="blue">A0 via 1M-ohm resistor</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table3a-b" style="vertical-align: middle;"><p class="tablec"><span class="blue">Black wire</span></p></td>&#13;
<td class="table3l" style="vertical-align: middle;"><p class="tablec"><span class="blue">GND via 1M-ohm resistor</span></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table></li>&#13;
<li><p class="noindenta">Connect the servo’s yellow signal wire directly to Arduino pin 9, its brown wire to GND, and its red wire to +5V.</p>&#13;
<table class="all">&#13;
<thead>&#13;
<tr>&#13;
<td class="tableth1a-b" style="vertical-align: middle;"><p class="tablec"><strong>SERVO</strong></p></td>&#13;
<td class="tableth2" style="vertical-align: middle;"><p class="tablec"><strong>ARDUINO</strong></p></td>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td class="table1a-b" style="vertical-align: middle;"><p class="tablec"><span class="blue">Yellow wire</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="blue">Pin 9</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table1a-b" style="vertical-align: middle;"><p class="tablec"><span class="blue">Red wire</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="blue">+5V</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table3a-b" style="vertical-align: middle;"><p class="tablec"><span class="blue">Brown wire</span></p></td>&#13;
<td class="table3l" style="vertical-align: middle;"><p class="tablec"><span class="blue">GND</span></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table></li>&#13;
<li><p class="noindenta">Insert the LEDs into your breadboard with the short, negative legs connected to GND. The positive legs should connect to the pins via 220-ohm resistors as follows: yellow connects to Arduino pin 3, green to pin 4, and red to pin 5.</p>&#13;
<table class="all">&#13;
<thead>&#13;
<tr>&#13;
<td class="tableth1a-b" style="vertical-align: middle;"><p class="tablec"><strong>LEDS</strong></p></td>&#13;
<td class="tableth2" style="vertical-align: middle;"><p class="tablec"><strong>ARDUINO</strong></p></td>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td class="table1a-b" style="vertical-align: middle;"><p class="tablec"><span class="blue">Positive legs</span></p></td>&#13;
<td class="table2" style="vertical-align: middle;"><p class="tablec"><span class="blue">Pins 3–5 via 220-ohm resistors</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table3a-b" style="vertical-align: middle;"><p class="tablec"><span class="blue">Negative legs</span></p></td>&#13;
<td class="table3l" style="vertical-align: middle;"><p class="tablec"><span class="blue">GND</span></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table></li>&#13;
<li><p class="noindenta">Connect Arduino pin 2 to the positive power rail. In our setup this is always on, but you could add a switch in the connection between Arduino pin 2 and the power rail to save power when the project is not in use.</p></li>&#13;
<li><p class="noindenta">Connect the breadboard rails to Arduino GND and +5V.</p></li>&#13;
<li><p class="noindenta">Make sure your setup matches the circuit diagram in <a href="ch09.xhtml#ch9fig2">Figure 9-2</a>, and then upload the code in “<a href="ch09.xhtml#ch09lev1sec03">The Sketch</a>” on <a href="ch09.xhtml#page_82">page 82</a>.</p>&#13;
<p class="figcaption"><a id="ch9fig2"/><strong>FIGURE 9-2:</strong><br/>The circuit diagram for the secret knock lock</p>&#13;
<div class="image"><span epub:type="pagebreak" id="page_82"/><img alt="image" src="../images/f09-02.jpg"/></div></li>&#13;
</ol>&#13;
<h3 class="h3" id="ch09lev1sec03"><span class="blue"><strong>THE SKETCH</strong></span></h3>&#13;
<p class="noindent">We first call on the Servo library and set Arduino pin 9 to control the servo. LEDs are attached to Arduino pins 3, 4, and 5, and these will light depending on the validity of a knock. The piezo acts as a sensor rather than a buzzer in this project and is attached to Arduino pin A0. When someone knocks, the knock is sensed by the piezo and a voltage value is sent to the A0 analog pin of the Arduino depending on the strength of the knock—the harder the knock, the higher the value. A knock with a value below 10 is considered too quiet, and one with a value above 100 too loud, so neither will be <span epub:type="pagebreak" id="page_83"/>accepted as a valid knock. The red LED lights if the knock is not accepted, and the yellow LED lights if it is. Any knock value between 10 and 100 is accepted as a valid knock and counted, and if three valid knocks are received, the servomotor moves and the green LED lights.</p>&#13;
<p class="indent">As mentioned earlier, these are the two lines of code that set the parameters for measuring the voltage:</p>&#13;
<pre><span class="green2">const int</span> quietKnock = 10;<br/><span class="green2">const int</span> loudKnock = 100;</pre>&#13;
<p class="indent">If you were feeling particularly secretive, you could set this range even tighter to make the code harder to crack. Here’s the sketch:</p>&#13;
<pre><span class="ash">/* Created 18 September 2012 by Scott Fitzgerald</span><br/>   <span class="ash">Thanks to Federico Vanzati for improvements</span><br/>   <span class="ash">http://arduino.cc/starterKit</span><br/>   <span class="ash">This example code is part of the public domain.</span><br/><span class="ash">*/</span><br/><br/>#include &lt;<span class="orange1">Servo</span>.h&gt;<br/><span class="orange1">Servo</span> servo9; <span class="ash">// Pin connected to servo mpo</span><br/><br/><span class="green2">const int</span> piezo = A0;    <span class="ash">// Pin connected to piezo</span><br/><span class="green2">const int</span> switchPin = 2; <span class="ash">// Pin connected to servo</span><br/><span class="green2">const int</span> yellowLed = 3; <span class="ash">// Pin connected to yellow LED</span><br/><span class="green2">const int</span> greenLed = 4;  <span class="ash">// Pin connected to green LED</span><br/><span class="green2">const int</span> redLed = 5;    <span class="ash">// Pin connected to red LED</span><br/><br/><span class="green2">int</span> knockVal;   <span class="ash">// Value for the knock strength</span><br/><span class="green2">int</span> switchVal;<br/><br/><span class="green2">const int</span> quietKnock = 10; <span class="ash">// Set min value that will be accepted</span><br/><span class="green2">const int</span> loudKnock = 100; <span class="ash">// Set max value that will be accepted</span><br/><span class="green2">boolean</span> locked = false;    <span class="ash">// A true or false variable</span><br/><span class="green2">int</span> numberOfKnocks = 0;    <span class="ash">// Value for number of knocks</span><br/><br/><span class="green2">void</span> <span class="green3">setup</span>() {<br/>  servo9.<span class="orange1">attach</span>(9);<br/>  <span class="orange1">pinMode</span>(yellowLed, <span class="green2">OUTPUT</span>);   <span class="ash">// Set LED pins as outputs</span><br/>  <span class="orange1">pinMode</span>(greenLed, <span class="green2">OUTPUT</span>);<br/>  <span class="orange1">pinMode</span>(redLed, <span class="green2">OUTPUT</span>);<br/>  <span class="orange1">pinMode</span>(switchPin, <span class="green2">INPUT</span>);    <span class="ash">// Set servo pin as input</span><br/>  <span class="orange1">Serial</span>.<span class="orange1">begin</span>(9600);<br/>  <span class="orange1">digitalWrite</span>(greenLed, <span class="green2">HIGH</span>); <span class="ash">// Green LED is lit when the</span><br/>                                <span class="ash">// sequence is correct</span><br/>  servo9.<span class="orange1">write</span>(0);<br/>  <span class="orange1">Serial</span>.<span class="orange1">println</span>(<span class="green2">"The box is unlocked!"</span>);<br/>}<br/><br/><span epub:type="pagebreak" id="page_84"/><span class="green2">void</span> <span class="green3">loop</span>() {<br/>  <span class="green3">if</span> (locked == false) {<br/>    switchVal = <span class="orange1">digitalRead</span>(switchPin);<br/>    if (switchVal == <span class="green2">HIGH</span>) {<br/>      locked = true;<br/>      <span class="orange1">digitalWrite</span>(greenLed, <span class="green2">LOW</span>);<br/>      <span class="orange1">digitalWrite</span>(redLed, <span class="green2">HIGH</span>);<br/>      servo9.<span class="orange1">write</span>(90);<br/>      <span class="orange1">Serial</span>.<span class="orange1">println</span>(<span class="green2">"The box is locked!"</span>);<br/>      <span class="orange1">delay</span>(1000);<br/>    }<br/>  }<br/>  <span class="green3">if</span> (locked == true) {<br/>    knockVal = <span class="orange1">analogRead</span>(piezo); <span class="ash">// Knock value is read by analog pin</span><br/>    <span class="green3">if</span> (numberOfKnocks &lt; 3 &amp;&amp; knockVal &gt; 0) {<br/>      <span class="green3">if</span> (checkForKnock(knockVal) == true) { <span class="ash">// Check for correct</span><br/>                                             <span class="ash">// number of knocks</span><br/>        numberOfKnocks++;<br/>      }<br/>      <span class="orange1">Serial</span>.<span class="orange1">print</span>(3 - numberOfKnocks);<br/>      <span class="orange1">Serial</span>.<span class="orange1">println</span>(<span class="green2">" more knocks to go"</span>);<br/>    }<br/>    <span class="green3">if</span> (numberOfKnocks &gt;= 3) { <span class="ash">// If 3 valid knocks are detected,</span><br/>                               <span class="ash">// the servo moves</span><br/>      locked = false;<br/>      servo9.<span class="orange1">write</span>(0);<br/>      <span class="orange1">delay</span>(20);<br/>      <span class="orange1">digitalWrite</span>(greenLed, <span class="green2">HIGH</span>);<br/>      <span class="orange1">digitalWrite</span>(redLed, <span class="green2">LOW</span>);<br/>      <span class="orange1">Serial</span>.<span class="orange1">println</span>(<span class="green2">"The box is unlocked!"</span>);<br/>    }<br/>  }<br/>}<br/><br/><span class="green2">boolean</span> checkForKnock(<span class="green2">int</span> value) { <span class="ash">// Checks knock value</span><br/>  <span class="green3">if</span> (value &gt; quietKnock &amp;&amp; value &lt; loudKnock) { <span class="ash">// Value needs to be</span><br/>                                                 <span class="ash">// between these</span><br/>    <span class="orange1">digitalWrite</span>(yellowLed, <span class="green2">HIGH</span>);<br/>    <span class="orange1">delay</span>(50);<br/>    <span class="orange1">digitalWrite</span>(yellowLed, <span class="green2">LOW</span>);<br/>    <span class="orange1">Serial</span>.<span class="orange1">print</span>(<span class="green2">"Valid knock of value "</span>);<br/>    <span class="orange1">Serial</span>.<span class="orange1">println</span>(value);<br/>    <span class="green3">return</span> true;<br/>  }<br/>  <span class="green3">else</span> { <span class="ash">// If value is false then send this to the IDE serial</span><br/>    <span class="orange1">Serial</span>.<span class="orange1">print</span>(<span class="green2">"Bad knock value "</span>);<br/>    <span class="orange1">Serial</span>.<span class="orange1">println</span>(value);<br/>    <span class="green3">return</span> false;<br/>  }<br/>}</pre>&#13;
</body></html>