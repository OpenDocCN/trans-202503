<html><head></head><body><div class="appendix" title="Appendix&#xA0;F.&#xA0;Batch Processing"><div class="titlepage"><div><div><h1 class="title"><a id="batch_processing"/>Appendix F. Batch Processing</h1></div></div></div><p><a id="iddle1251" class="indexterm"/>At some point, you may want to edit several images simultaneously to, for example, convert them from one format to another, change their size, or apply a filter. If you want to do the same thing to dozens of images, repeating the process over and over would be tedious and time consuming. Thankfully, computers excel at automating repetitive processes. Remember: If you’re doing something repetitive on a computer, there’s probably a better—and faster—way to do it!</p><p>Automatically applying changes to a series of images, one after another, is called <span class="emphasis"><em>batch processing</em></span>. Here, we’ll discuss three ways to transform multiple images at the same time. The first one is done from a command line and can be used only in rather simple situations. The second one uses a plug-in, but it works only for a small set of simple operations. The last one uses an independent application.</p></div>
<div class="sect1" title="F.1 GIMP Batch Mode"><div class="titlepage"><div><div><h1 class="title"><a id="fdot1_gimp_batch_mode"/>F.1 GIMP Batch Mode</h1></div></div></div><p>The command line is used for typing textual commands and gives users full access to all the capabilities of their operating system. Many graphical interfaces are complicated ways to access simple textual commands. To use the command line, you open a terminal window in which you type commands. A <span class="emphasis"><em>terminal</em></span> is a text-only window in a graphical interface. Type a command, and after you press <span class="inlinemediaobject"><a id="inline_id00592"/><img src="httpatomoreillycomsourcenostarchimages1453866.png.jpg" alt=""/></span>, you get results or answers. Some commands are interactive and ask questions and display answers. Others simply execute what you ask.</p><p>The capabilities of the command line have a lot to do with the <span class="emphasis"><em>shell</em></span>, the interactive program that opens a terminal window in which you type commands in GNU/Linux. The shell accepts a command language with many capabilities. Certain shell commands can be used to apply the same process to several files (in our case, image files), including a command to call another command over and over, on all the files in a folder, or on a subset of files using just one command with a <span class="emphasis"><em>wildcard</em></span>. Wildcards are symbols that can stand in for one or more characters.</p><p>Mac OS X users enjoy exactly the same capabilities because Mac is a Unix-based system. With Windows, however, the command language is rather poor, so the usefulness of the command line is more limited than in GNU/Linux or on a Mac.</p><p>When you work with GIMP from the command line, you use options and arguments. The <span class="emphasis"><em>options</em></span> specify actions or parameters. The <a id="iddle2044" class="indexterm"/><a id="iddle4899" class="indexterm"/><span class="emphasis"><em>arguments</em></span> are the names of the files to which the actions are applied.</p><p>When using GIMP in batch mode from the command line, you need to specify the following options: <code class="literal">-b</code> for batch processing and <code class="literal">-i</code> for running without the user interface. The <code class="literal">-b</code> option needs an argument, which is the command to execute. A complete call has the following form:</p><a id="pro_id00006"/><pre class="programlisting">gimp -i -b '<span class="emphasis"><em>command</em></span>' <span class="emphasis"><em>files</em></span></pre><p>The command is written using the Script-Fu language, presented in <a class="xref" href="ch21s03.html#scheme" title="Scheme">Scheme</a>. If you want to write a short script on the command line one line at a time, you can use the following form instead:</p><a id="pro_id00007"/><pre class="programlisting">gimp -i -b - <span class="emphasis"><em>files</em></span>
<span class="emphasis"><em>commands</em></span></pre><p>and then type the script on the following lines.</p><p>You can also define a new Script-Fu function and call it from the command line. In this context, the <code class="literal">file-glob</code> plug-in is useful: Given an encoded pattern that specifies the files, it returns the list of filenames matching this pattern. To see an example, look at <span class="emphasis"><em><a class="ulink" href="http://www.gimp.org/tutorials/Basic_Batch/">http://www.gimp.org/tutorials/Basic_Batch/</a></em></span>.</p></div>
<div class="sect1" title="F.2 David&#x2019;s Batch Processor"><div class="titlepage"><div><div><h1 class="title"><a id="fdot2_davidapostrophes_batch_processor"/>F.2 David’s Batch Processor</h1></div></div></div><p>Calling GIMP from the command line and controlling it using the Script-Fu language might be daunting unless you have some experience in programming. David’s Batch Processor, also called DBP, is an alternative for people less inclined to write code. For Debian and Ubuntu GNU/Linux distributions, David’s Batch Processor plug-in is included in the package called <code class="literal">gimp-plugin-registry</code>. Otherwise, visit <span class="emphasis"><em><a class="ulink" href="http://members.ozemail.com.au/~hodsond/dbp.html">http://members.ozemail.com.au/~hodsond/dbp.html</a></em></span> to download the plug-in. Once it’s installed, you can access the plug-in via <span class="strong"><strong>Image: Filters &gt; Batch &gt; Batch Process</strong></span>. Its dialog is shown in <a class="xref" href="apfs02.html#dbp_dialogcomma_input_tab" title="Figure F-1. The DBP dialog, Input tab">Figure F-1</a>.</p><p>This dialog contains nine tabs. The first one is where you select the files to process, the next six tabs are where you specify the various processes to apply to these files, the eighth tab is where you change the filenames and specify global changes to the images, and the ninth tab is where you specify the final format and a few other global parameters.</p><div class="figure"><a id="dbp_dialogcomma_input_tab"/><div class="figure-contents"><div class="mediaobject"><a id="med_id01782"/><img src="httpatomoreillycomsourcenostarchimages1457606.png.jpg" alt="The DBP dialog, Input tab"/></div></div><p class="title">Figure F-1. The DBP dialog, Input tab</p></div><p>The I<span class="smaller">NPUT</span> tab is fairly self-explanatory. Clicking A<span class="smaller">DD</span> F<span class="smaller">ILES</span> opens the file manager window. You can select several files at the same time by pressing <span class="inlinemediaobject"><a id="inline_id00593"/><img src="httpatomoreillycomsourcenostarchimages1453844.png.jpg" alt=""/></span> or <span class="inlinemediaobject"><a id="inline_id00594"/><img src="httpatomoreillycomsourcenostarchimages1453922.png.jpg" alt=""/></span> when clicking the filenames. When you click A<span class="smaller">DD</span>, all the selected files are added to the list. Once the list has files, you can select and remove files or clear the whole list.</p><p>The tool dialog is inactive while the file manager window is open, which is unusual behavior for a GIMP dialog. After the file manager window is closed, you can make adjustments on the tool dialog tabs. On each transformation tab, the E<span class="smaller">NABLE</span> box must be checked for the transformation to be active. The T<span class="smaller">URN</span> tab (<a class="xref" href="apfs02.html#dbp_dialogcomma_turn_tab" title="Figure F-2. The DBP dialog, Turn tab">Figure F-2</a>) lets you rotate the images only by a multiple of 90°.</p><p>The B<span class="smaller">LUR</span> tab (<a class="xref" href="apfs02.html#dbp_dialogcomma_blur_tab" title="Figure F-3. The DBP dialog, Blur tab">Figure F-3</a>) applies a Gaussian blur with the specified radius.</p><div class="figure"><a id="dbp_dialogcomma_turn_tab"/><div class="figure-contents"><div class="mediaobject"><a id="med_id01783"/><img src="httpatomoreillycomsourcenostarchimages1457608.png.jpg" alt="The DBP dialog, Turn tab"/></div></div><p class="title">Figure F-2. The DBP dialog, Turn tab</p></div><div class="figure"><a id="dbp_dialogcomma_blur_tab"/><div class="figure-contents"><div class="mediaobject"><a id="med_id01784"/><img src="httpatomoreillycomsourcenostarchimages1457610.png.jpg" alt="The DBP dialog, Blur tab"/></div></div><p class="title">Figure F-3. The DBP dialog, Blur tab</p></div><div class="figure"><a id="dbp_dialogcomma_colour_tab"/><div class="figure-contents"><div class="mediaobject"><a id="med_id01785"/><img src="httpatomoreillycomsourcenostarchimages1457612.png.jpg" alt="The DBP dialog, Colour tab"/></div></div><p class="title">Figure F-4. The DBP dialog, Colour tab</p></div><p>The C<span class="smaller">OLOUR</span> tab (<a class="xref" href="apfs02.html#dbp_dialogcomma_colour_tab" title="Figure F-4. The DBP dialog, Colour tab">Figure F-4</a>) transforms the colors in several ways: level equalization; adjusting brightness, contrast, and saturation; inverting colors; and converting to grayscale. This tab is useful if you want to correct a systematic color distortion in a series of photographs, for example.</p><p>The R<span class="smaller">ESIZE</span> tab (<a class="xref" href="apfs02.html#dbp_dialogcomma_resize_tab" title="Figure F-5. The DBP dialog, Resize tab">Figure F-5</a>) does what its name implies. You can choose between relative resizing, where the sliders change by a scaling factor, and absolute resizing, where you choose the final width and height. The F<span class="smaller">IT</span> drop-down menu, shown in <a class="xref" href="apfs02.html#dbp_dialogcomma_resize_tab" title="Figure F-5. The DBP dialog, Resize tab">Figure F-5</a>, lets you choose how the new dimensions are applied:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>E<span class="smaller">XACTLY</span>: The dimensions chosen are used, regardless of how the aspect changes.</p></li><li class="listitem"><p>P<span class="smaller">ADDED</span>: The aspect is maintained, and the resulting empty space is filled with the background color.</p></li><li class="listitem"><p>I<span class="smaller">NSIDE</span>: The aspect is maintained, and the image may be smaller than the specified dimensions.</p><div class="figure"><a id="dbp_dialogcomma_resize_tab"/><div class="figure-contents"><div class="mediaobject"><a id="med_id01786"/><img src="httpatomoreillycomsourcenostarchimages1457614.png.jpg" alt="The DBP dialog, Resize tab"/></div></div><p class="title">Figure F-5. The DBP dialog, Resize tab</p></div><div class="figure"><a id="dbp_dialogcomma_crop_tab"/><div class="figure-contents"><div class="mediaobject"><a id="med_id01787"/><img src="httpatomoreillycomsourcenostarchimages1457616.png.jpg" alt="The DBP dialog, Crop tab"/></div></div><p class="title">Figure F-6. The DBP dialog, Crop tab</p></div><div class="figure"><a id="dbp_dialogcomma_sharpen_tab"/><div class="figure-contents"><div class="mediaobject"><a id="med_id01788"/><img src="httpatomoreillycomsourcenostarchimages1457618.png.jpg" alt="The DBP dialog, Sharpen tab"/></div></div><p class="title">Figure F-7. The DBP dialog, Sharpen tab</p></div></li><li class="listitem"><p>O<span class="smaller">UTSIDE</span>: Same idea, but the image can be larger than the specified dimensions.</p></li></ul></div><p>The C<span class="smaller">ROP</span> tab (<a class="xref" href="apfs02.html#dbp_dialogcomma_crop_tab" title="Figure F-6. The DBP dialog, Crop tab">Figure F-6</a>) is where you crop the images. You can specify the origin (top-left corner, for example) of the cropping rectangle, as well as its width and height.</p><p>The S<span class="smaller">HARPEN</span> tab (<a class="xref" href="apfs02.html#dbp_dialogcomma_sharpen_tab" title="Figure F-7. The DBP dialog, Sharpen tab">Figure F-7</a>) works the same as the <span class="strong"><strong>Image: Filters &gt; Enhance &gt; Unsharp Mask</strong></span> filter and has the same parameters. See <a class="xref" href="ch17s03.html" title="17.3 The Enhance Filters">17.3 The Enhance Filters</a>.</p><p>Be careful when using the R<span class="smaller">ENAME</span> tab (<a class="xref" href="apfs02.html#dbp_dialogcomma_rename_tab" title="Figure F-8. The DBP dialog, Rename tab">Figure F-8</a>)—it’s easy to accidentally invert your file- naming scheme. This tab lets you choose how the new files will be named, but it won’t <a id="iddle3293" class="indexterm"/>overwrite existing files. Attempts to overwrite the originals are ignored.</p><div class="figure"><a id="dbp_dialogcomma_rename_tab"/><div class="figure-contents"><div class="mediaobject"><a id="med_id01789"/><img src="httpatomoreillycomsourcenostarchimages1457620.png.jpg" alt="The DBP dialog, Rename tab"/></div></div><p class="title">Figure F-8. The DBP dialog, Rename tab</p></div><p>You can do the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Choose a target folder (directory) different from the source folder.</p></li><li class="listitem"><p>Append a prefix or a suffix to all filenames to prevent replacing existing files and to label the files with the new characteristics (thumb, gray, improved, etc.).</p></li></ul></div><p>This tab also lets you make final transformations to the image, depending on the output format:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Flatten the image (merge into one layer).</p></li><li class="listitem"><p>Convert it to grayscale.</p></li><li class="listitem"><p>Convert it to indexed mode, with or without dithering, with a specified number of colors.</p></li></ul></div><p>Note that you can convert to both grayscale and indexed mode.</p><p>The O<span class="smaller">UTPUT</span> tab (<a class="xref" href="apfs02.html#dbp_dialogcomma_output_tab" title="Figure F-9. The DBP dialog, Output tab">Figure F-9</a>) is mainly used to select the output format and its parameters. The available output formats are shown in <a class="xref" href="apfs02.html#available_output_formats" title="Figure F-10. Available output formats">Figure F-10</a>, and <a class="xref" href="apfs02.html#dbp_dialogcomma_output_tab" title="Figure F-9. The DBP dialog, Output tab">Figure F-9</a> shows the parameters for PNG. For BMP, MIFF, PAT, TIFF, and XCF, no parameters are available.</p><p>When you’ve selected all the actions you want to perform and set all the parameters, click T<span class="smaller">EST</span> to preview the result for the first picture, or click S<span class="smaller">TART</span> and go grab a beverage while GIMP processes your images.</p><div class="figure"><a id="dbp_dialogcomma_output_tab"/><div class="figure-contents"><div class="mediaobject"><a id="med_id01790"/><img src="httpatomoreillycomsourcenostarchimages1457622.png.jpg" alt="The DBP dialog, Output tab"/></div></div><p class="title">Figure F-9. The DBP dialog, Output tab</p></div><div class="figure"><a id="available_output_formats"/><div class="figure-contents"><div class="mediaobject"><a id="med_id01791"/><img src="httpatomoreillycomsourcenostarchimages1457624.png.jpg" alt="Available output formats"/></div></div><p class="title">Figure F-10. Available output formats</p></div></div>
<div class="sect1" title="F.3 ImageMagick"><div class="titlepage"><div><div><h1 class="title"><a id="fdot3_imagemagick"/>F.3 ImageMagick</h1></div></div></div><p>ImageMagick is a free software project (with an Apache-like license) that supports about 100 image formats and format conversions. ImageMagick is also capable of doing a number of sophisticated things to images. For more details, check out its home page (<span class="emphasis"><em><a class="ulink" href="http://www.imagemagick.org/">http://www.imagemagick.org/</a></em></span>).</p><div class="sect2" title="Calling ImageMagick"><div class="titlepage"><div><div><h2 class="title"><a id="calling_imagemagick"/>Calling ImageMagick</h2></div></div></div><p>ImageMagick is normally called from a terminal or command line, but its functionalities can also be accessed from other programs. When using it to process many files, you’ll find the <span class="emphasis"><em>filename globbing</em></span> facilities of GNU/Linux extremely useful. For example, the command</p><a id="pro_id00008"/><pre class="programlisting">convert *.jpg animation.gif</pre><p>converts all the files in the current folder with a <code class="literal">.jpg</code> suffix to a single GIF animation called <code class="literal">animation.gif</code>. The asterisk is a wildcard, which matches any character or string. The Windows command language does not support globbing, but ImageMagick adds support, so you can use the same commands in Windows.</p><p>ImageMagick contains 10 different programs, the most useful being <code class="literal">convert</code>, which we used in the previous example. Among the myriads of possible usages, we describe just a few to give you a taste of this powerful application. These examples use GNU/Linux shell notation, but Windows users can refer to the detailed page <span class="emphasis"><em><a class="ulink" href="http://www.imagemagick.org/Usage/windows/">http://www.imagemagick.org/Usage/windows/</a></em></span>. But this first example is given in both notations.</p><p>Suppose we have a folder with a lot of photographs—called <code class="literal">img001</code>, <code class="literal">img002</code>, and so on— in TIFF format, and we want to convert all of them to the PNG format. The input files do not have a file extension, so we have to tell the <code class="literal">convert</code> command what their format is. We do this with the prefix <code class="literal">tiff:</code>. With GNU/Linux, here is how we write it:</p><a id="pro_id00009"/><pre class="programlisting">for i in img*
do convert tiff:$i $i.png
done</pre><p>With Windows and the DOS shell, we write it as</p><a id="pro_id00010"/><pre class="programlisting">FOR %a in (img*) DO ^
  convert tiff:%a %a.jpg</pre><p>The caret is used to continue the command on the next line.</p><p>Another solution is to use the <code class="literal">mogrify</code> command, which does not check whether the target files already exist and happily overwrites files when asked. The following command would work in both GNU/Linux and Windows:</p><a id="pro_id00011"/><pre class="programlisting">mogrify -format png tiff:*</pre><p>But avoiding this command is best because accidentally erasing files is very easy.</p></div><div class="sect2" title="Building Thumbnails"><div class="titlepage"><div><div><h2 class="title"><a id="building_thumbnails"/>Building Thumbnails</h2></div></div></div><p>One of ImageMagick’s main purposes is to generate thumbnails. ImageMagick makes generating uniform-looking thumbnails for a whole set of images easy. You can use thumbnails on a web page, for example, as links to the actual images. Because thumbnails are normally small images, say 200 × 200 at most, generate them in GIF format, which compresses well. At this size, the limitation to 256 colors is not a problem.</p><p>The following example generates the thumbnail image <code class="literal">thumbnail.gif</code> from the source image <code class="literal">image.jpg</code>:</p><a id="pro_id00012"/><pre class="programlisting">convert -define jpeg:size=500x180
  image.jpg -auto-orient
  -thumbnail 250x90 -unsharp 0x.5
  thumbnail.gif</pre><p>The command is written here on four successive lines, but, in fact, you type it on one line only.</p><p>The <code class="literal">-define</code> option is not necessary, but it may accelerate the process if the source image is very large. The JPEG library must enlarge the (compressed) image when it loads, and this option sets the approximate size that the image is enlarged to. The <code class="literal">-auto-orient</code> option uses the EXIF information provided by the camera and rotates the image if necessary. The <code class="literal">-thumbnail</code> option sets the final dimensions of the thumbnail and can be used to discard any useless information from the image, such as comments. The aspect ratio is maintained: The resulting thumbnail is 90 pixels high, but its width is 250 pixels or less. Finally, the <code class="literal">-unsharp</code> option is used to sharpen the image because resizing always results in a slight blur.</p><p>To generate thumbnails for several images at the same time, you could use the <code class="literal">mogrify</code> command, but calling <code class="literal">convert</code> in a loop is safer. One challenge of generating thumbnails from source images is getting thumbnails with names like <code class="literal">img0567.jpg.gif</code>. <code class="literal">mogrify</code> can solve the problem with its <code class="literal">-format</code> option. If you need to use <code class="literal">convert</code>, with GNU/Linux you can use the shell capabilities for discarding a file extension:</p><a id="pro_id00013"/><pre class="programlisting">for i in *
do convert $i ${i%jpg}gif
done</pre><p>The notation <code class="literal">${i%jpg}gif</code> discards the <code class="literal">jpg</code> extension from the filename and replaces it with the <code class="literal">gif</code> extension, which also tells ImageMagick which conversion to perform.</p><p>Many other additions could be made to the simple example just given. Review <span class="emphasis"><em><a class="ulink" href="http://www.imagemagick.org/Usage/thumbnails/">http://www.imagemagick.org/Usage/thumbnails/</a></em></span>.</p></div><div class="sect2" title="Labels and Transformations"><div class="titlepage"><div><div><h2 class="title"><a id="labels_and_transformations"/>Labels and Transformations</h2></div></div></div><p>ImageMagick can be used to add labels to images:</p><a id="pro_id00014"/><pre class="programlisting">convert image.jpg -background Khaki
  label:'Label' -gravity Center
  -append labeled-image.jpg</pre><p>In this example, a fixed label with a khaki background is added to the bottom center of the image. If you want to label many images, use the following example (with the GNU/Linux shell):</p><a id="pro_id00015"/><pre class="programlisting">for i in *
do convert $i -background Khaki
   label:"${i%.jpg}" -gravity
   Center -append labeled-$i
done</pre><p>Here, the images are labeled with their name minus the extension, and the labeled image name is prefixed with <code class="literal">labeled-</code>.</p><p>Use ImageMagick to perform many of the transformations that GIMP does but on lots of images consecutively. For example, decide which transformations you want to perform, as well as the parameter values. Then you can use the <code class="literal">convert</code> command with many options and parameters to reproduce the GIMP transformation over and over. Test it on the first image. Then embed this command in a loop, start it, and have a beverage while the computer works.</p><p>Once again, the ImageMagick website is an invaluable source of really sophisticated examples.</p></div></div></body></html>