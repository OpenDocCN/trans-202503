<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" epub:prefix="index: http://www.index.com/" lang="en" xml:lang="en">
<head>
<title>Chapter 3: Preparing for an Attack</title>
<link href="NSTemplate_v1.css" rel="stylesheet" type="text/css"/>
<meta content="urn:uuid:5e8bb34b-260b-4fef-91f3-caabb4446e65" name="Adept.expected.resource"/>
</head>
<body epub:type="bodymatter chapter">
<section>
<header>
<h1 class="chapter">
<span class="ChapterNumber"><span epub:type="pagebreak" id="Page_25" title="25"/>3</span><br/>
<span class="ChapterTitle">Preparing for an Attack</span></h1>
</header>
<blockquote class="Epigraph" epub:type="epigraph">
<p class="Epigraph">The most outrageous lies that can be invented will find believers if a man only tells them with all his might. </p>
<p class="EpigraphSource">—Mark Twain, letter to <em>Alta California</em> newspaper, San Francisco, 1867</p>
</blockquote>
<figure class="opener">
<img alt="" src="image_fi/book_art/chapterart.png"/>
</figure>
<p class="ChapterIntro">Performing a social engineering attack creates a rush like no other. But before we perform these attacks, we need to define a process for completing them. If we don’t, we can find ourselves in legal trouble, or worse, we could damage the mental health of our targets. This is where frameworks come into play. </p>
<p>This chapter will introduce you to a process for coordinating with your client to determine (and stick to) the scope of an engagement. We’ll also cover two relevant processes for executing OSINT and social engineering—the social engineering framework and the OSINT OODA (Observe-Orient-Decide-Act) loop—and discuss operating systems you can use to do so. </p>
<h2 id="h1-500983c03-0001"><span epub:type="pagebreak" id="Page_26" title="26"/>Coordinating with the Client</h2>
<p class="BodyFirst">The first step to getting ready for an attack is to coordinate with the client, whether they’re a paying customer, your manager, or another team within your company. Even after you’ve completed the initial scoping process, do not hesitate to ask questions relevant to the performance of the work. Your criminal record and livelihood could be on the line, so ensure that you know explicitly what you are and aren’t allowed to do. </p>
<h3 id="h2-500983c03-0001">Scoping</h3>
<p class="BodyFirst">In the <em>scoping</em> phase, you must work with the client to determine exactly how your engagement will operate. This includes figuring out who your point of contact will be, as well as timing considerations (such as the number of hours budgeted for the engagement; the time of day, week, or month in which to conduct the testing; and <em>blackout periods </em>in which you are not authorized to test). You should also discuss legal considerations, making sure that the contract includes language that will protect you from legal issues. This is why it is prudent to have a lawyer retained. You need verbiage that will protect you from acts of God, natural disasters, and other unforeseen circumstances. Finally, discuss the size of your engagement, such as the number of calls to place or targets to email. </p>
<p>You and your client should document the results of the scoping phase in the <em>statement of work (SOW)</em>, the part of the contract that spells out what you are explicitly authorized and unauthorized to do in the engagement. Ensure that the SOW delineates the appropriate rules of engagement. It should detail any restricted or requested pretexts, source email addresses, source or destination IP addresses, and other constraints or requests relevant to the engagement. Also, make sure that the contract and SOW mention you by name. It’s best to name all testers, if possible, and any company for which you work.</p>
<p>When scoping, make sure your social engineering engagement meets certain requirements. Among other issues, make sure that you have the proper authorization and legal protection to perform social engineering, and that the person signing the contract is authorized to grant you permission to do such activities. If you’re an internal employee performing testing, get authorization in writing. Make sure that you have proper <em>errors and omissions (E&amp;O)</em> insurance to protect yourself legally. Also called <em>professional indemnity insurance (PII)</em> or <em>professional liability insurance (PLI)</em>, E&amp;O insurance is intended to protect you from the full cost of defending against a negligence claim in a civil court. </p>
<p>The scoping phase sets the tone for the entire engagement. Failure to properly scope can cause quite a headache for both parties. It can complicate the engagement unnecessarily, causing you to spend more time on the phone at a later point or perform the work improperly. It can also cause reputational harm to you as a practitioner, if the company you’re working for considers you unprofessional. For a repeatable process, please refer to the scoping worksheet in <span class="xref" itemid="xref_target_Appendix A">Appendix A</span>, which can help you ask the appropriate questions so that you can ensure that you have all the information you need.</p>
<h3 id="h2-500983c03-0002"><span epub:type="pagebreak" id="Page_27" title="27"/>Defining Objectives</h3>
<p class="BodyFirst">Once you’ve signed a contract and created a SOW, discuss the objectives of the engagement with your client. Will this testing be used to make a case for adding defenses to the business, such as new products or technologies? Will it be used to assess human capital requirements? Is the test merely a way to meet compliance requirements? Or will the client use it to evaluate the security team (for instance, as part of a performance evaluation, or to determine raises)? The answers to these questions shouldn’t impact how well you do your engagement, but they should help you understand what to expect and how to frame your communications. </p>
<h3 id="h2-500983c03-0003">Defining Methods</h3>
<p class="BodyFirst">The methods you use are a critical consideration for your engagement. Will you be <em>typo</em> or <em>domain</em> <em>squatting</em>? In other words, will you use a domain similar to the client’s that contains a typographical error (an especially effective strategy if the proper spelling lends itself to misspelling) or will you be buying an available domain with the same name and different top-level domain (such as <em>nostarch.us</em> instead of the legitimate <em>nostarch.com</em>)? Will you pose as a vendor, client, or partner? Will you be attracting downloads of malicious documents or just gathering credentials? Will you chain a vish and phish together? Does the client want you to use an automated solution or should you go a little more manual, as we’ll discuss in <span class="xref" itemid="xref_target_Chapter 7">Chapter 7</span>?</p>
<p>Understanding the technologies that your client uses and the vectors you’re targeting will be essential factors in the success of the engagement. To go above and beyond, find out whether you can enumerate the company technology publicly, and then do so yourself before the engagement. This approach accomplishes two things: it provides the client with a method to detect and possibly attribute any attacks, and it validates that the client has adequately implemented their technologies. The latter accomplishment can provide serious value to your client.</p>
<h2 id="h1-500983c03-0002">Building Successful Pretexts</h2>
<p class="BodyFirst">When building your pretexts, try to find current events in your target’s environment that could be leveraged against them. You could claim to be with the target organization’s cloud or email provider and require additional information due to a “security incident.” You might take a look at the local social media pages and groups to gather additional OSINT about these events. Facebook and Twitter are great resources for finding and enumerating such information, especially if a hashtag is associated with the event. </p>
<p>If you have enough time, get some copies of the local newspapers. If you are close enough, take a stroll through town and look for any flyers or banners announcing such events. Is there a common interest or goal among the targets? Do any of the employees enjoy hiking, running, obstacle races like <span epub:type="pagebreak" id="Page_28" title="28"/>Spartan Race and Tough Mudder, or Iron Man/Woman triathlons? Does the organization have a bowling or softball team? If so, which leagues are they in and where do they play? Whom do they play against?</p>
<p>The considerations mentioned here will separate your phishing attack from casual ones, making it a nation-state-level threat. Taking the time to understand your targets and their surroundings will improve your success rate tremendously, though be sure that you pass the value on to your clients by sharing these tips in your report, as well as in any training you conduct based on your results.</p>
<p>Based on the information you collect, build your scenarios and pretexts. Present the top three to five to the client and let them pick which one they want you to use. If possible, confirm a time frame in which to perform your attack, but not an exact time. This keeps your clients on their toes and gives you an element of surprise. </p>
<p>While no client should brief employees about the scenarios you choose, I’ve encountered what appears to be just that. In the engagement in question, the client limited the possible pretexts and scenarios, and then prescribed the exact time at which I could send phishing emails and make vishing calls. The caveat: if I was told to call back for whatever reason, I could do so without further consent. </p>
<p>Luckily, I exploited this caveat to my advantage. When I called, I created a lot of very loud background noises and faked interruptions. Between the noise and the “phone cutting out,” I was able to get about two-thirds of the people I called to request me to call them back. Since I called them back outside the designated window, their guards were down, and they were more forthcoming than they likely would have been during the prescribed calling period.</p>
<h2 id="h1-500983c03-0003">Using Specialized Operating Systems for Social Engineering</h2>
<p class="BodyFirst">Part of being a professional social engineer or OSINT collector is having the right tool for the job. <em>Kali</em>—a Linux distribution designed for penetration testing, and created and maintained by Offensive Security—ships with tools like the <em>Social-Engineer Toolkit</em> <em>(SET)</em>, theHarvester, Ghost Phisher, Maltego, and Recon-ng. We’ll discuss these tools in more detail in the following chapters. Kali and the tools it ships with are most effective when used as part of a penetration test or an engagement involving general social engineering without extreme OSINT collection, though it’s also possible to perform advanced OSINT investigations using Kali. </p>
<p>In addition, the Canadian not-for-profit Trace Labs has created and actively maintains a fork of Kali Linux (with the blessing and assistance of Offensive Security) that is designed to help with OSINT investigations, specifically in its Search Party competitions using OSINT to find missing persons. The Trace Labs preconfigured virtual machine (VM) has a variety of tools for OSINT investigations focusing on both businesses and people. It is available for free download at <a class="LinkURL" href="https://www.tracelabs.org/trace-labs-osint-vm/">https://www.tracelabs.org/trace-labs-osint-vm/</a>.</p>
<p><span epub:type="pagebreak" id="Page_29" title="29"/>Using a less common operating system and configuration also has advantages. Specifically, doing so allows you to adjust your environment to suit your preferences and comfort levels. If I am doing reconnaissance on a target that may detect and report me, I don’t want to use my home or work network, even over a VPN that could be compromised. Instead, in addition to the Offensive Security and Trace Labs versions of Kali, I use an Ubuntu system running on a cloud virtual private server (VPS) instance, where I’ve installed a customized set of tools, including SpiderFoot, Recon-ng, Metasploit, Metagoofil, theHarvester, and some lesser-known scripts and utilities that I’ve modified. The VPS has its own independent IP address, and I can spin up new instances of it with new IP addresses to evade detection. (I’ve made and archived an image of the Ubuntu system, so I can generate new copies as often as I need to.) I may also enhance the security of the VPS by hardening it—removing unnecessary services or applications, closing unused ports, and applying a secure configuration to the system—and use one or more VPNs to connect to it. We’ll walk through an infrastructure setup for phishing in <span class="xref" itemid="xref_target_Chapter 7">Chapter 7</span>. </p>
<p>Some tools work on Windows as well. A few are web-based tools (for example, Netcraft, Hacker Target, and OSINT Framework) that you primarily access from a web browser. Doing so from a Mac or PC may be more convenient than from Linux. Still, understand that you’re more likely to get caught if you use your personal system or even a work system to conduct these operations. As long as you have the proper permission to do these types of engagements, the worst-case scenarios are (a) being blocked and (b) having your IP address added to a <em>threat intelligence feed</em> (a crowdsourced list of malicious entities, or traits with malicious activities or files such as email address, IP address, file hash, or domain), which means your potential clients or targets may be warned that the IP you are using is considered “malicious.” Using a VPS to attack allows you to use the setup just once and then destroy it. </p>
<h2 id="h1-500983c03-0004">Following the Attack Phases</h2>
<p class="BodyFirst">All ethical hackers typically follow a defined attack process to make sure they collect all the information they need. This process usually has the following steps: reconnaissance, scanning and enumeration, gaining access, maintaining access, clearing tracks, and reporting. You can read more about these phases at <a class="LinkURL" href="https://www.cybrary.it/blog/2015/05/summarizing-the-five-phases-of-penetration-testing/">https://www.cybrary.it/blog/2015/05/summarizing-the-five-phases-of-penetration-testing/</a>. When it comes to social engineering, however, it makes sense to define a slightly different attack process to follow. The <em>social engineering process</em> in <a href="#figure3-1" id="figureanchor3-1">Figure 3-1</a> adapts the penetration testing process to standardize social engineering. </p>
<span epub:type="pagebreak" id="Page_30" title="30"/><figure>
<img alt="&lt;&lt;Circular arrow diagram shows steps of the social engineering process: scoping, reconnaissance, design and approval, implementation, detection, measurement, and reporting.&gt;&gt;" class="" src="image_fi/500983c03/f03001.png"/>
<figcaption><p><a id="figure3-1">Figure 3-1</a>: The social engineering process</p></figcaption>
</figure>
<p>Each step in the process is as follows:</p>
<p class="ListHead"><b>Scoping</b></p>
<ol class="none">
<li>In the scoping phase of the social engineering process, you ask questions of your client so that you can ensure that you have all the information you need. </li>
</ol>
<p class="ListHead"><b>Reconnaissance</b></p>
<ol class="none">
<li>In the reconnaissance phase, you attempt to identify key employees of the company; vendors, partners, suppliers, technology used; domains and subdomains used; and email addresses and the company’s standard email address syntax (for instance, first and last names separated by a period). Once you’ve signed the contract to perform the engagement, you may begin reconnaissance within the time frames defined in the contract. Aside from adhering to the contract and doing the reconnaissance in a manner that is consistent with your time objectives (for example, not spending 12 hours gathering OSINT on a single target in an engagement scoped for 4 hours), you typically can’t collect too much OSINT. That said, some entities just maintain good Operations Security (OPSEC): they don’t use social media, or may even take active steps to purposely put deceptive or false information on their accounts to evade such threats. We call this process <em>disinformation and deception</em>.
<p class="ListBody"><span epub:type="pagebreak" id="Page_31" title="31"/>Chapters <span class="xref" itemid="xref_target_4">4</span>, <span class="xref" itemid="xref_target_5">5</span>, and <span class="xref" itemid="xref_target_6">6</span> will provide you with some of the tools to perform OSINT collection. Keep in mind that while it’s important to collect a good quantity of information on your target company and its employees, you’re responsible for protecting the data while you hold it. You should keep only what you need for the duration that you need it, and for legally mandated time periods only.</p></li>
</ol>
<p class="ListHead"><b>Design and Approval</b></p>
<ol class="none">
<li>You must spend some time ensuring that the OSINT you have gathered is relevant, and then weaponize it in a way that helps the employees and the target organization grow and learn. After all, even though you’re trying to gain access to a system or information, you should want to be caught, and you should want your clients to learn from your activities.
<p class="ListBody">The design and approval phase involves coming up with possible pretexts for your client to review and approve. You’ll share the details of the pretext, the phone numbers you’ll be calling from, the email addresses you’ll be emailing from, and the times at which you plan to start and finish. Also explain your objective. For example, it could be to measure the number of times targets clicked links included in an email. Or maybe you’re attempting to get sensitive information from them or deploy malware or <em>reverse shell droppers</em> (software that enables you to connect remotely and install malware). </p></li>
</ol>
<p class="ListHead"><b>Implementation</b></p>
<ol class="none">
<li>In the implementation phase, you install and configure any software. This includes infrastructure such as email accounts, web servers, macro-enabled Microsoft Office documents, malware, USB drives, and other bait. You may also gain access to the organization’s dumpster and collect items to take offsite for further analysis. You’ll take the pretexts that were approved by your point of contact and put them into action by performing the phishing, vishing, and other attacks defined in the SOW. </li>
</ol>
<p class="ListHead"><b>Detection</b></p>
<ol class="none">
<li>During the detection phase, the defenders will attempt to detect the social engineering activity, and then take action to mitigate its efficiency or impact. Depending on the scope of the engagement, the defenders may or may not know that the attack has been authorized. If this is part of a red team engagement, they likely won’t. While this phase seems less exciting than the actual attacking, it’s the most important part of the process. Remember that your endgame is to condition organizations to detect and mitigate social engineering activity. </li>
</ol>
<p class="ListHead"><b>Measurement</b></p>
<ol class="none">
<li>In the measurement phase, you determine information such as how many people fell victim to the antics, how long the engagement took <span epub:type="pagebreak" id="Page_32" title="32"/>to detect, when the victims filed a report, how many reports were filed, and a variety of other metrics. Once you’ve analyzed this information, you should compile it in a report for the client. We’ll discuss measurement techniques in <span class="xref" itemid="xref_target_Chapter 9">Chapter 9</span>.</li>
</ol>
<p class="ListHead"><b>Reporting</b></p>
<ol class="none">
<li>In the reporting phase, you take the metrics you’ve gathered and assemble them alongside the SOW, an executive summary, a synopsis of how the engagement went, and any findings from OSINT gathering or performance of the engagement. You can use a template like the one in <span class="xref" itemid="xref_target_Appendix B">Appendix B</span> to write your report. You’ll present this to the client for their records and review. If you choose to maintain a copy of this report, you’ll need to safeguard the document, as the information within it could be potentially misused to attack the client. </li>
</ol>
<p>In addition to this social engineering process, you might find it helpful to consult the <em>Observe-Orient-Decide-Act (OODA) loop</em> for OSINT collection, which I use. The loop, shown in <a href="#figure3-2" id="figureanchor3-2">Figure 3-2</a>, prompts you to <em>observe</em> your findings and build a hypothesis (the <em>orient</em> phase), and then seek more information to attempt to confirm this information. </p>
<figure>
<img alt="&lt;&lt;Circular arrow diagram shows steps of the OODA loop: observe, orient, decide, and act.&gt;&gt;" class="" src="image_fi/500983c03/f03002.png"/>
<figcaption><p><a id="figure3-2">Figure 3-2</a>: OODA loop</p></figcaption>
</figure>
<p>Once you have enough data, you can <em>decide</em> what to do with it. Should you engage in phishing or vishing, or do you need more information to be successful? Do you have enough information to perpetrate this penetration <span epub:type="pagebreak" id="Page_33" title="33"/>test or red team engagement with the proper amount of stealth? Then, depending on the outcome of these decisions, you act. </p>
<p>Acting may include performing the attack or writing the report (if OSINT is all the client wants) or it may trigger more iterations of the OODA loop. There is no right or wrong answer here; it depends on your objectives and time constraints as set forth in your agreement with the client.</p>
<p>That said, you could apply this loop to any sort of attack, whether it be exploiting a web server or exploiting the web administrator. </p>
<h2 id="h1-500983c03-0005">Case Study: Why Scoping Matters</h2>
<p class="BodyFirst">In September 2019, a pair of penetration testers working for Coalfire were arrested for trying to gain access to the Dallas County Courthouse in Adel, Iowa. While the specific details about this engagement are not available at this time, we do know that the pair acted as part of a penetration test authorized by the Iowa State Court Administration (SCA). In a statement to Ars Technica, the SCA admits authorizing Coalfire to test the security of the court’s electronic records.</p>
<p>Per their statement, SCA did not intend or anticipate that the testers would attempt to gain physical access. The testers and Coalfire claim that the penetration test was to determine the vulnerability of records and measure the response from law enforcement. While this doesn’t sound entirely unreasonable, the fact that the testers were jailed for more than a few hours and had to make bail does not bode well for the scoping of this engagement.</p>
<p>Based on the information provided, the penetration testers could have done several things differently. It’s a good idea to communicate with your client’s security points of contact frequently. If you have questions, don’t hesitate to ask them. Also, the testers could have ensured that they had a notarized copy of the formal authorization on them at all times when doing the physical infiltration aspect of the test.</p>
<p>How could this have been mitigated or prevented?</p>
<ul>
<li>Ask questions to clarify the scope. </li>
<li>Have a useful dialogue with your contact via email. Verbal communication gets things done but offers little legal protection.</li>
<li>Management should explicitly define not only what is allowed, but also what isn’t allowed, in the contract and authorization documents. This should be part of the contract process.</li>
</ul>
<h2 id="h1-500983c03-0006">Conclusion</h2>
<p class="BodyFirst">Taking the time to properly scope the engagement with your client is a tremendous way to save both of you time and effort. Understanding the right questions to ask will certainly help you. Prepare for your attack by following the social engineering process. Some social engineers preach that their job <span epub:type="pagebreak" id="Page_34" title="34"/>is to bring chaos to a company. While that is true in some sense, you must also have a method to that madness to ensure that everyone involved wins. You get the work and continue to foster your reputation, while the customer gets what they asked for and paid for in a way that adds value to their organization and, hopefully, means repeat business for you.</p>
</section>
</body>
</html>