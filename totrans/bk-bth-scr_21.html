<html><head></head><body>
<div id="sbo-rt-content" class="calibre1"><section aria-labelledby="ch19" epub:type="chapter" role="doc-chapter">
<hgroup>
<h2 class="title" id="ch19">
<span class="cn"><span aria-label=" Page 205. " epub:type="pagebreak" id="pg_205" role="doc-pagebreak" class="calibre2"/><span class="sans_dogma_ot_bold_b_">19</span></span>
<span class="ct1"><span class="sans_dogma_ot_bold_b_">READING FILES AND OTHER INPUTS</span></span>
</h2>
</hgroup>
<figure class="opener"><img alt="" class="opener1" height="407" src="../images/chapter.jpg" width="408"/>
</figure>
<p class="chapterintro">By far the most involved syntax and powerful functionality of the already powerful <span class="sans_thesansmonocd_w5regular_1">for</span> command is unleashed with the <span class="sans_thesansmonocd_w5regular_1">/F</span> option, which allows for <i class="calibre13">file reading</i>. The optionless <span class="sans_thesansmonocd_w5regular_1">for</span> command can do quite a bit with a file such as getting its name, path, drive, size, and attributes, pretty much everything concerning a file except its actual contents. Enter the <span class="sans_thesansmonocd_w5regular_1">/F</span> option.</p>
<p class="tx">After introducing its syntax, I’ll demonstrate how to read a file, record by record. You’ll learn how to manipulate the input data, place the entire contents of a record into a variable, or break it into what Batch calls tokens. By tokenizing the data, you’ll be able to extract just the portions of data you desire.</p>
<p class="tx">Although the <span class="sans_thesansmonocd_w5regular_">for /F</span> command ostensibly reads files, the input can take on other forms. This command can treat a string as a single record file, and you can even use the output from another Batch command as its input. All <span aria-label=" Page 206. " epub:type="pagebreak" id="pg_206" role="doc-pagebreak"/>of this will allow you to manipulate and process different forms of information in many different ways.</p>
<section aria-labelledby="sec1" epub:type="division">
<h3 class="h"><span id="sec1"/><span id="h1-130"/><span class="sans_futura_std_bold_b_">The for Command with the /F Option</span></h3>
<p class="tni">The <span class="sans_thesansmonocd_w5regular_">/F</span> option transforms the <span class="sans_thesansmonocd_w5regular_">for</span> command into a multifaceted tool for reading files. This command with this particular option has multiple forms, but I’ll start by considering just one. Here’s the general syntax of the form or variant of the <span class="sans_thesansmonocd_w5regular_">for /F</span> command that reads a file or a set of files:</p>
<pre class="pre"><code class="calibre11">for /F ["<var class="calibre12">suboptions</var>"] %%<var class="calibre12">variable</var> in (<var class="calibre12">file-set</var>) do <var class="calibre12">command</var></code></pre>
<p class="tx">In comparison to the optionless <span class="sans_thesansmonocd_w5regular_">for</span> command, this syntax is quite different. Most obviously, the <span class="sans_thesansmonocd_w5regular_">/F</span> option is in place. I’ve also changed the generic <span class="sans_thesansmonocd_w5regular_italic_i_">input</span> placeholder inside the parentheses to the more specific term of <span class="sans_thesansmonocd_w5regular_italic_i_">file-set</span>, but that’s little more than nomenclature. In comparison to the optionless version of the command, this variant accepts only a file, a file mask, or multiple files or file masks.</p>
<p class="tx">The most significant difference is the addition of the <span class="sans_thesansmonocd_w5regular_">["</span><span class="sans_thesansmonocd_w5regular_italic_i_">suboptions</span><span class="sans_thesansmonocd_w5regular_">"]</span> clause. The square brackets indicate that these suboptions are themselves optional, but if you include them, encase them in double quotes. Each of the possible <span class="sans_thesansmonocd_w5regular_italic_i_">suboptions</span> is denoted with its own specific keyword. I’ll discuss one of them, <span class="sans_thesansmonocd_w5regular_">usebackq</span>, later in this chapter, but the others have a direct impact on how you will read and manipulate the data.</p>
</section>
<section aria-labelledby="sec2" epub:type="division">
<h3 class="h"><span id="sec2"/><span id="h1-131"/><span class="sans_futura_std_bold_b_">Reading the Contents of a File</span></h3>
<p class="tni">The keywords <span class="sans_thesansmonocd_w5regular_">tokens</span>, <span class="sans_thesansmonocd_w5regular_">delims</span>, <span class="sans_thesansmonocd_w5regular_">skip</span>, and <span class="sans_thesansmonocd_w5regular_">eol</span> might not roll easily off the tongue, but they’re instrumental elements of the <span class="sans_thesansmonocd_w5regular_italic_i_">suboptions</span> clause, which controls the reading of files. The best way to see what they do is to explore the behavior of the <span class="sans_thesansmonocd_w5regular_">for /F</span> command without options and then add in the clauses associated with these four keywords one by one to demonstrate their usefulness.</p>
<p class="tx">Let’s return to the introduction of the <span class="sans_thesansmonocd_w5regular_">for</span> command in <span class="xref"><a href="chapter17.xhtml" class="calibre3">Chapter 17</a></span> where I briefly worked with a file named <i class="calibre6">FourBrits.txt</i> but said nothing about its contents. For this demonstration, assume that it’s a small file of four records. Each record has five elements, the first being a language and the remainder being four particular male names as they are written in that language. The spaces or tabs delimit the elements, and here are the complete contents of the file:</p>
<pre class="pre"><code class="calibre11">English   John      Paul      George    Richard
Spanish   Juan      Pablo     Jorge     Ricardo
French    Jean      Pol       Georges   Richard
Italian   Giovanni  Paolo     Giorgio   Riccardo
</code></pre>
<p class="tx"><span aria-label=" Page 207. " epub:type="pagebreak" id="pg_207" role="doc-pagebreak"/>Consider this <span class="sans_thesansmonocd_w5regular_">for</span> command:</p>
<pre class="pre"><code class="calibre11">for %%a in (C:\Batch\FourBrits.txt) do (
   &gt; con echo %%a
)
</code></pre>
<p class="tni">The output is exactly what you’d now expect: a single line of data displaying the path and filename of the input file:</p>
<pre class="pre"><code class="calibre11">C:\Batch\FourBrits.txt</code></pre>
<p class="tx">To demonstrate the new option, I’ll add <span class="sans_thesansmonocd_w5regular_">/F</span> to the logic:</p>
<pre class="pre"><code class="calibre11">for /F %%a in (C:\Batch\FourBrits.txt) do (
   &gt; con echo %%a
)
</code></pre>
<p class="tni">And now the output:</p>
<pre class="pre"><code class="calibre11">English
Spanish
French
Italian
</code></pre>
<p class="tx">Such a small change results in a vastly different outcome. Instead of a single write to the console in the form of the filename, the code now outputs the first word of each record inside the file itself. Due to the <span class="sans_thesansmonocd_w5regular_">/F</span> option, the command is opening and reading the contents of the file. There’s still much to work out, but the command is actually reading each of the four records in the file, setting <span class="sans_thesansmonocd_w5regular_">%%a</span> to the first word in the record. If the file had contained 64 populated records, the previous logic would have written 64 words to the console on the same number of lines.</p>
<p class="tx">This output raises many more questions than it answers. Why isn’t this writing the entire record? Can we parse out just parts of the record? Must we read every record? This is where the keywords in the <span class="sans_thesansmonocd_w5regular_italic_i_">suboptions</span> clause from the general syntax come into play.</p>
<section aria-labelledby="sec3" epub:type="division">
<h4 class="h1"><span id="sec3"/><span id="h2-52"/><span class="sans_futura_std_heavy_oblique_bi_">Tokenizing the Data</span></h4>
<p class="tni">A <i class="calibre6">token</i> in Batch is an element of a record, and by default each token is delimited by spaces or tabs. Inspecting the first record in the file, it contains exactly five tokens:</p>
<pre class="pre"><code class="calibre11">English   John      Paul      George    Richard</code></pre>
<p class="tx">By default, Batch sets the number of tokens to <span class="sans_thesansmonocd_w5regular_">1</span>. This explains why in the previous example, the interpreter resolved <span class="sans_thesansmonocd_w5regular_">%%a</span> to the first word (or token) in each record and dropped the rest of the record.</p>
<p class="tx"><span aria-label=" Page 208. " epub:type="pagebreak" id="pg_208" role="doc-pagebreak"/>To change this default, you can use the <span class="sans_thesansmonocd_w5regular_">tokens</span> clause; it’s the <span class="sans_thesansmonocd_w5regular_">tokens</span> keyword followed by an equal sign and the setting, which in this case is <span class="sans_thesansmonocd_w5regular_">2</span>:</p>
<pre class="pre"><code class="calibre11">for /F "tokens=2" %%a in (C:\Batch\FourBrits.txt) do (
   &gt; con echo %%a
)
</code></pre>
<p class="tni">The <span class="sans_thesansmonocd_w5regular_">tokens</span> clause tells the interpreter which token or tokens to pass into the loop as the <span class="sans_thesansmonocd_w5regular_">for</span> variable. Executing this code produces the following output written to the console:</p>
<pre class="pre"><code class="calibre11">John
Juan
Jean
Giovanni
</code></pre>
<p class="tx">Due to the <span class="sans_thesansmonocd_w5regular_">tokens</span> clause, the interpreter now sends the second word or token into the loop, writing <span class="sans_thesansmonocd_w5regular_">John</span> and its translations to the console. Setting it to <span class="sans_thesansmonocd_w5regular_">5</span> would have retrieved Richard’s name instead. With this clause you can extract a single token with relative ease.</p>
<section aria-labelledby="sec4" epub:type="division">
<h5 class="h2"><span id="sec4"/><span class="sans_futura_std_bold_b_">Extracting Multiple Tokens</span></h5>
<p class="tni">It’s nice to be able to pull out individual tokens, but it’s more useful to be able to pull out multiple and select tokens. To extract all five tokens, assign the text <span class="sans_thesansmonocd_w5regular_">1-5</span> to the <span class="sans_thesansmonocd_w5regular_">tokens</span> keyword. But this raises an interesting question. How will those five tokens be resolved with only the single variable, <span class="sans_thesansmonocd_w5regular_">%%a</span>, defined?</p>
<p class="tx">Additional variables are elegantly implied in simple alphabetical order. If <span class="sans_thesansmonocd_w5regular_">%%a</span> is the variable defined in the <span class="sans_thesansmonocd_w5regular_">for /F</span> command, it resolves to the first token defined in the <span class="sans_thesansmonocd_w5regular_">tokens</span> clause, then <span class="sans_thesansmonocd_w5regular_">%%b</span> resolves to the second, <span class="sans_thesansmonocd_w5regular_">%%c</span> to the third, <span class="sans_thesansmonocd_w5regular_">%%d</span> to the fourth, and, finally, <span class="sans_thesansmonocd_w5regular_">%%e</span> to the fifth. Consider the following:</p>
<pre class="pre"><code class="calibre11">for /F "tokens=1-5" %%a in (C:\Batch\FourBrits.txt) do (
   &gt; con echo %%a:  %%b, %%c, %%d, and %%e
)
</code></pre>
<p class="tx">This code formats the record so that the language is followed by a colon and two spaces. Then in the output, the names are separated by commas and spaces with a conjunction before the last name:</p>
<pre class="pre"><code class="calibre11">English:  John, Paul, George, and Richard 
Spanish:  Juan, Pablo, Jorge, and Ricardo 
French:  Jean, Pol, Georges, and Richard 
Italian:  Giovanni, Paolo, Giorgio, and Riccardo
</code></pre>
<p class="tx">You can also pick and choose which tokens to extract instead of a range. A comma in the <span class="sans_thesansmonocd_w5regular_">tokens</span> clause separates the desired tokens. This code sends only the second and fourth tokens into the loop:</p>
<pre class="pre"><code class="calibre11"><span aria-label=" Page 209. " epub:type="pagebreak" id="pg_209" role="doc-pagebreak"/>for /F "tokens=2,4" %%a in (C:\Batch\FourBrits.txt) do (
   &gt; con echo %%a and %%b played guitar.
)
</code></pre>
<p class="tx">This result is written to the console:</p>
<pre class="pre"><code class="calibre11">John and George played guitar. 
Juan and Jorge played guitar. 
Jean and Georges played guitar. 
Giovanni and Giorgio played guitar.
</code></pre>
<p class="tni">The second token from the data record is now the first token the <span class="sans_thesansmonocd_w5regular_">tokens</span> clause defines, so Batch assigns it to <span class="sans_thesansmonocd_w5regular_">%%a</span>, not <span class="sans_thesansmonocd_w5regular_">%%b</span>. Likewise, <span class="sans_thesansmonocd_w5regular_">%%b</span> now resolves to the fourth token in the record, which is the second token selected. More succinctly, the variable letter mimics the token’s position defined by the <span class="sans_thesansmonocd_w5regular_">tokens</span> clause—not its position in the record.</p>
<p class="tx">To this point, I’ve used <span class="sans_thesansmonocd_w5regular_">%%a</span> as the <span class="sans_thesansmonocd_w5regular_">for</span> variable. Regardless of the letter you choose for the variable, the interpreter assigns subsequent tokens to corresponding letters in the alphabet. The previous code is functionally equivalent to the following code:</p>
<pre class="pre"><code class="calibre11">for /F "tokens=2,4" %%x in (C:\Batch\FourBrits.txt) do (
   &gt; con echo %%x and %%y played guitar.
)
</code></pre>
<p class="tni">The only difference is that I’ve changed <span class="sans_thesansmonocd_w5regular_">%%a</span> to <span class="sans_thesansmonocd_w5regular_">%%x</span>, meaning that <span class="sans_thesansmonocd_w5regular_">%%y</span> now resolves to the second token instead of <span class="sans_thesansmonocd_w5regular_">%%b</span>.</p>
<p class="tx">The catch is that choosing <span class="sans_thesansmonocd_w5regular_">%%x</span> as the <span class="sans_thesansmonocd_w5regular_">for</span> variable limits you to just three possible tokens, because there’s nothing to assign after <span class="sans_thesansmonocd_w5regular_">%%z</span> (despite the efforts of Dr. Seuss in <i class="calibre6">On Beyond Zebra!</i>). You won’t see this nearly as often, but numbers also work. For instance, if you extract three tokens and define the <span class="sans_thesansmonocd_w5regular_">for</span> variable as <span class="sans_thesansmonocd_w5regular_">%%7</span>, the interpreter will use <span class="sans_thesansmonocd_w5regular_">%%8</span> and <span class="sans_thesansmonocd_w5regular_">%%9</span> for the implied tokens.</p>
<p class="tx">The keyword also accepts a combination of numbers, commas, and dashes. For instance, the <span class="sans_thesansmonocd_w5regular_">tokens=1,3-5</span> clause processes all of the tokens except <span class="sans_thesansmonocd_w5regular_">John</span>, the second token.</p>
</section>
<section aria-labelledby="sec5" epub:type="division">
<h5 class="h2"><span id="sec5"/><span class="sans_futura_std_bold_b_">Extracting the Remainder of a Record</span></h5>
<p class="tni">There’s another twist concerning the <span class="sans_thesansmonocd_w5regular_">tokens</span> keyword. An asterisk represents the remainder of the input record as is, including embedded whitespaces. Consider this code using <span class="sans_thesansmonocd_w5regular_">2*</span> in the <span class="sans_thesansmonocd_w5regular_">tokens</span> clause:</p>
<pre class="pre"><code class="calibre11">for /F "tokens=2*" %%a in (C:\Batch\FourBrits.txt) do (
   &gt; con echo %%a, Rest of the Band: "%%b"
)
</code></pre>
<p class="tx">This command assigns the second token to <span class="sans_thesansmonocd_w5regular_">%%a</span> because of the <span class="sans_thesansmonocd_w5regular_">2</span> in the clause; then the interpreter assigns the remainder of the record, the third, <span aria-label=" Page 210. " epub:type="pagebreak" id="pg_210" role="doc-pagebreak"/>fourth, and fifth tokens, including any embedded spaces and tabs, to <span class="sans_thesansmonocd_w5regular_">%%b</span> because of the asterisk (<span class="sans_thesansmonocd_w5regular_">*</span>). The language, the first token in each record, isn’t to be found anywhere in the output:</p>
<pre class="pre"><code class="calibre11">John, Rest of the Band: "Paul      George    Richard" 
Juan, Rest of the Band: "Pablo     Jorge     Ricardo" 
Jean, Rest of the Band: "Pol       Georges   Richard" 
Giovanni, Rest of the Band: "Paolo     Giorgio   Riccardo"
</code></pre>
<p class="tx">To bring this discussion full circle, when we simply added the <span class="sans_thesansmonocd_w5regular_">/F</span> option to the <span class="sans_thesansmonocd_w5regular_">for</span> command at the beginning of the chapter, the default <span class="sans_thesansmonocd_w5regular_">tokens</span> clause passed the first token only into the code block. On many occasions you’ll want to extract the entire record exactly as it appears in the input file as a single entity. Since the asterisk represents the rest of the input record, assigning it alone to <span class="sans_thesansmonocd_w5regular_">tokens</span> selects the entire record:</p>
<pre class="pre"><code class="calibre11">for /F "tokens=*" %%r in (C:\Batch\FourBrits.txt) do (
   &gt; con echo Entire Record: "%%r"
)
</code></pre>
<p class="tx">Also notice that I changed the variable to <span class="sans_thesansmonocd_w5regular_">%%r</span>. Here’s the output:</p>
<pre class="pre"><code class="calibre11">Entire Record: "English   John      Paul      George    Richard" 
Entire Record: "Spanish   Juan      Pablo     Jorge     Ricardo" 
Entire Record: "French    Jean      Pol       Georges   Richard" 
Entire Record: "Italian   Giovanni  Paolo     Giorgio   Riccardo"
</code></pre>
<p class="tni">The prior use of <span class="sans_thesansmonocd_w5regular_">%%a</span> would have worked fine, but I’ve changed it here for two reasons: first, <span class="sans_thesansmonocd_w5regular_">r</span> stands for <i class="calibre6">record</i>, and second, as a simple reminder that any alphabetic character will work.</p>
<blockquote class="calibre8">
<p class="warning"><span class="sans_dogma_ot_bold_b_1">NOTE</span></p>
</blockquote>
<p class="warning-txt"><i class="calibre6">As mentioned in <a href="chapter17.xhtml" class="calibre3">Chapter 17</a>, the for variable is actually case-sensitive, and some nonalphanumeric characters are permitted. This means %%a and %%b resolve only to the first two tokens for the variable defined as %%a; %%A and %%B won’t work, unless you change the for variable to %%A. I probably don’t need to mention this, but those oddball characters (think %%#) don’t lend themselves at all to extracting multiple tokens.</i></p>
</section>
</section>
<section aria-labelledby="sec6" epub:type="division">
<h4 class="h1"><span id="sec6"/><span id="h2-53"/><span class="sans_futura_std_heavy_oblique_bi_">Defining the Set of Data Delimiters</span></h4>
<p class="tni">Being able to break up an input record into tokens defined by delimiters such as spaces and tabs is powerful indeed, but in many instances, you don’t have control over the data in the file that you’re reading, and a different delimiter, or even a set of delimiters, would be far more applicable. The <span class="sans_thesansmonocd_w5regular_">delims</span> keyword defines one to many <i class="calibre6">delimiters</i> used to tokenize the data.</p>
<section aria-labelledby="sec7" epub:type="division">
<h5 class="h2"><span id="sec7"/><span class="sans_futura_std_bold_b_">Parsing Comma-Delimited Data</span></h5>
<p class="tni">A comma-delimited format is a popular and easy way of storing data. For instance, a <i class="calibre6">.csv</i> file contains any number of comma-delimited records, and you can open it and view the data with Excel. Each token is delimited by <span aria-label=" Page 211. " epub:type="pagebreak" id="pg_211" role="doc-pagebreak"/>a comma, and each token can contain spaces. Before demonstrating how Batch reads in CSV data, I’ll need some setup.</p>
<p class="tx">The <i class="calibre6">FourBrits.txt</i> file might contain a name with embedded spaces such as <span class="sans_thesansmonocd_w5regular_">Richard aka Ringo</span>. In the space-delimited examples discussed so far, this text constitutes three distinct tokens. I’ll now reformat the data and present it in a comma-delimited file called <i class="calibre6">FourBrits.csv</i>. The contents of this file will be the same as its like-named <i class="calibre6">.txt</i> file except for the delimiters and Richard’s alias:</p>
<pre class="pre"><code class="calibre11">English,John,Paul,George,Richard aka Ringo
Spanish,Juan,Pablo,Jorge,Ricardo aka Ringo
French,Jean,Pol,Georges,Richard aka Ringo
Italian,Giovanni,Paolo,Giorgio,Riccardo aka Ringo
</code></pre>
<p class="tx">The next task is to modify the <span class="sans_thesansmonocd_w5regular_">for /F</span> command so that it treats the commas as delimiters in lieu of the spaces, and I’ll accomplish this with the <span class="sans_thesansmonocd_w5regular_">delims</span> keyword. When the keyword isn’t present, the interpreter defaults to the set of delimiters containing just the space and tab characters. In the following example, <span class="sans_thesansmonocd_w5regular_">delims=,</span> defines the set of delimiters as a single character, the comma:</p>
<pre class="pre"><code class="calibre11">for /F "tokens=1-5 delims=," %%a in (C:\Batch\FourBrits.csv) do (
    &gt; con echo %%a:  %%b, %%c, %%d, and %%e
)
</code></pre>
<p class="tx">When the interpreter now comes to the fifth and final token—a name followed by <span class="sans_thesansmonocd_w5regular_">aka Ringo</span>—it writes the text to the console complete with its embedded spaces:</p>
<pre class="pre"><code class="calibre11">English:  John, Paul, George, and Richard aka Ringo
Spanish:  Juan, Pablo, Jorge, and Ricardo aka Ringo
French:  Jean, Pol, Georges, and Richard aka Ringo
Italian:  Giovanni, Paolo, Giorgio, and Riccardo aka Ringo
</code></pre>
<p class="tni">Ringo is nontranslatable.</p>
<p class="tx">Pipe-delimited data files are also popular; the <span class="sans_thesansmonocd_w5regular_">delims=|</span> clause parses the input data on the pipe so that embedded spaces and commas won’t create additional tokens. The equal sign can even be a delimiter with the <span class="sans_thesansmonocd_w5regular_">delims==</span> clause. (You’ll see an example of that before long.)</p>
</section>
<section aria-labelledby="sec8" epub:type="division">
<h5 class="h2"><span id="sec8"/><span class="sans_futura_std_bold_b_">Defining Multiple Delimiters</span></h5>
<p class="tni">You can even define multiple delimiters with a single <span class="sans_thesansmonocd_w5regular_">delims</span> clause. The following code defines the set of delimiters to be the comma and the space. It’s subtle, but in comparison to the previous example, the only change is that I’ve added a space in between <span class="sans_thesansmonocd_w5regular_">delims=,</span> and the trailing double quote:</p>
<pre class="pre"><code class="calibre11">for /F "tokens=1-5 delims=, " %%a in (C:\Batch\FourBrits.csv) do (
   &gt; con echo %%a:  %%b, %%c, %%d, and %%e
)
</code></pre>
<p class="tni"><span aria-label=" Page 212. " epub:type="pagebreak" id="pg_212" role="doc-pagebreak"/>The interpreter will now see a new token whenever it encounters a space or a comma. The fifth token will be only the name Richard, in some language, with <span class="sans_thesansmonocd_w5regular_">aka</span> and <span class="sans_thesansmonocd_w5regular_">Ringo</span> relegated to the unassigned sixth and seventh tokens, respectively.</p>
<p class="tx">To demonstrate an even larger set of delimiters, I’ll use a one-record file named <i class="calibre6">Alphabets.txt</i>, containing the uppercase and lowercase Latin alphabets, with one space separating them:</p>
<pre class="pre"><code class="calibre11">ABCDEFGHIJKLMNOPQRSTUVWXYZ abcdefghijklmnopqrstuvwxyz</code></pre>
<p class="tx">Omitting the <span class="sans_thesansmonocd_w5regular_">delims</span> clause entirely invokes the default delimiter set and results in just two tokens, the uppercase and the lowercase character sets, and nothing more. Instead, in the following code, I’m setting the <span class="sans_thesansmonocd_w5regular_">delims</span> keyword to the <span class="sans_thesansmonocd_w5regular_">Delims</span> text and a trailing space:</p>
<pre class="pre"><code class="calibre11">for /F "tokens=1-8 delims=Delims " %%a in (C:\Batch\Alphabets.txt) do (
   &gt; con echo Token 1 = %%a
   &gt; con echo Token 2 = %%b
   &gt; con echo Token 3 = %%c
   &gt; con echo Token 4 = %%d
   &gt; con echo Token 5 = %%e
   &gt; con echo Token 6 = %%f
   &gt; con echo Token 7 = %%g
   &gt; con echo Token 8 = %%h
)
</code></pre>
<p class="tx">If each of the seven delimiters occurs just once in the data, it seems logical that this logic creates eight tokens. That’s not necessarily true, but I’ve defined that many with the <span class="sans_thesansmonocd_w5regular_">tokens=1-8</span> clause and added the same number of <span class="sans_thesansmonocd_w5regular_">echo</span> commands. But let’s keep an eye on the number of tokens generated. Here’s the resulting output:</p>
<pre class="pre"><code class="calibre11">Token 1 = ABC
Token 2 = EFGHIJKLMNOPQRSTUVWXYZ
Token 3 = abcd
Token 4 = fgh
Token 5 = jk
Token 6 = nopqr
Token 7 = tuvwxyz
Token 8 = 
</code></pre>
<p class="tx">There is much to point out here, including the fact that the delimiter set is case-sensitive. The uppercase <span class="sans_thesansmonocd_w5regular_">D</span> is one delimiter, but not <span class="sans_thesansmonocd_w5regular_">d</span>. The lowercase letters <span class="sans_thesansmonocd_w5regular_">e</span>, <span class="sans_thesansmonocd_w5regular_">l</span>, <span class="sans_thesansmonocd_w5regular_">i</span>, <span class="sans_thesansmonocd_w5regular_">m</span>, and <span class="sans_thesansmonocd_w5regular_">s</span>, along with a space, round out the set of delimiters. It’s a little easier to see the origin of these seven tokens when looking at the original data with the delimiters (other than the space) bolded:</p>
<pre class="pre"><code class="calibre11">ABC<b class="calibre10">D</b>EFGHIJKLMNOPQRSTUVWXYZ abcd<b class="calibre10">e</b>fgh<b class="calibre10">i</b>jk<b class="calibre10">lm</b>nopqr<b class="calibre10">s</b>tuvwxyz</code></pre>
<p class="tx"><span aria-label=" Page 213. " epub:type="pagebreak" id="pg_213" role="doc-pagebreak"/>Notice that this data has two of the delimiters (<span class="sans_thesansmonocd_w5regular_">l</span> and <span class="sans_thesansmonocd_w5regular_">m</span>) listed sequentially, and because nothing is between them, you might expect the interpreter to assign null or nothing to the sixth token and bump the text after it, <span class="sans_thesansmonocd_w5regular_">nopqr</span>, to the seventh token. Batch, however, treats the consecutive delimiters (<span class="sans_thesansmonocd_w5regular_">lm</span>) as a single delimiter so that the sixth token is the text <span class="sans_thesansmonocd_w5regular_">nopqr</span>. Thus, <span class="sans_thesansmonocd_w5regular_">tuvwxyz</span> is the seventh token, and since nothing comes after it, the eighth token resolves to nothing.</p>
<p class="tx">Be careful to use only tokens that you’ve defined. If the clause had been <span class="sans_thesansmonocd_w5regular_">tokens=1-7</span>, the final <span class="sans_thesansmonocd_w5regular_">echo</span> command would have resulted in <span class="sans_thesansmonocd_w5regular_">Token 8 = %h</span>, because <span class="sans_thesansmonocd_w5regular_">%%h</span> wouldn’t have been the eighth token; it would have been a percent sign escaping another percent sign, followed by a hardcoded character.</p>
<p class="tx">When parsing comma-delimited (or pipe-delimited) data, many compiled languages treat consecutive delimiters as two delimiters, honoring the null in between them, which makes perfect sense. Batch, however, typically delimits on spaces, and one look at the original <i class="calibre6">FourBrits.txt</i> data with its varying number of spaces between each word makes it clear that it also makes perfectly good sense to treat multiple spaces as a single delimiter.</p>
<p class="tx">Unfortunately, this does lead to some frustration when instead of spaces, your data is delimited by commas, but in <span class="xref"><a href="chapter20.xhtml" class="calibre3">Chapter 20</a></span>, I’ll show you how to make the <span class="sans_thesansmonocd_w5regular_">for</span> loop honor the nulls between consecutive delimiters. However, if I have control over the input data that’s delimited on just a comma, I’ll always write a null element to the file as a space in between two commas.</p>
<p class="tx">I’ve listed the space last in the set of delimiters because it has to come last. I hate to disparage the interpreter yet again, but it gets confused if it finds the space anywhere else. For that reason, when including a space in the delimiter set, the <span class="sans_thesansmonocd_w5regular_">delims</span> clause must come at the end of the suboptions, just prior to the trailing double quote.</p>
</section>
</section>
<section aria-labelledby="sec9" epub:type="division">
<h4 class="h1"><span id="sec9"/><span id="h2-54"/><span class="sans_futura_std_heavy_oblique_bi_">Skipping Header Records</span></h4>
<p class="tni">As you’ve just seen, the <span class="sans_thesansmonocd_w5regular_">tokens</span> and <span class="sans_thesansmonocd_w5regular_">delims</span> keywords have a great deal of nuance. The next couple are far more straightforward, especially the <span class="sans_thesansmonocd_w5regular_">skip</span> keyword, which lets you skip any number of header records as you read a file.</p>
<p class="tx">Let’s return to the original <i class="calibre6">FourBrits.txt</i> file and add a header record before the unchanged content in the next four records:</p>
<pre class="pre"><code class="calibre11">Four Liverpudlians in Four Languages:
English   John      Paul      George    Richard
Spanish   Juan      Pablo     Jorge     Ricardo
French    Jean      Pol       Georges   Richard
Italian   Giovanni  Paolo     Giorgio   Riccardo
</code></pre>
<p class="tx">Let’s run the same <span class="sans_thesansmonocd_w5regular_">for /F</span> loop from the <span class="sans_thesansmonocd_w5regular_">tokens</span> keyword discussion:</p>
<pre class="pre"><code class="calibre11">for /F "tokens=1-5" %%a in (C:\Batch\FourBrits.txt) do (
   &gt; con echo %%a:  %%b, %%c, %%d, and %%e
)
</code></pre>
<p class="tni"><span aria-label=" Page 214. " epub:type="pagebreak" id="pg_214" role="doc-pagebreak"/>It processes the header line as any other, producing the following garbage output, followed by the four lines of good output (only one of which I’m showing):</p>
<pre class="pre"><code class="calibre11">Four:  Liverpudlians, in, Four, and Languages:
English:  John, Paul, George, and Richard 
</code></pre>
<p class="tx">Fortunately, the <span class="sans_thesansmonocd_w5regular_">skip</span> keyword defines the number of records to be skipped at the beginning of the file. This will skip the first record and process the data records perfectly:</p>
<pre class="pre"><code class="calibre11">for /F "tokens=1-5 skip=1" %%a in (C:\Batch\FourBrits.txt) do (
   &gt; con echo %%a:  %%b, %%c, %%d, and %%e
)
</code></pre>
<p class="tx">If there had been three header records, the <span class="sans_thesansmonocd_w5regular_">skip=3</span> clause would have made the <span class="sans_thesansmonocd_w5regular_">for</span> command start at the fourth record.</p>
</section>
<section aria-labelledby="sec10" epub:type="division">
<h4 class="h1"><span id="sec10"/><span id="h2-55"/><span class="sans_futura_std_heavy_oblique_bi_">Suppressing Comment Records</span></h4>
<p class="tni">While the <span class="sans_thesansmonocd_w5regular_">skip</span> keyword skips records only at the beginning of a file, the <span class="sans_thesansmonocd_w5regular_">eol</span> keyword, which stands for <i class="calibre6">end of line</i> comment character, bypasses all records in the file that start with a defined character. If I were being charitable, I’d say that when the interpreter sees the defined <i class="calibre6">character</i> in the first byte of a record, it considers the character to be the <i class="calibre6">end of line</i> and treats what remains as a <i class="calibre6">comment</i>.</p>
<p class="tx">To demonstrate, let’s edit the input file again. This time I’m adding a second comment record, and more important, each comment record now starts with a period:</p>
<pre class="pre"><code class="calibre11">.Four Liverpudlian in Four Languages:
English   John      Paul      George    Richard
Spanish   Juan      Pablo     Jorge     Ricardo
French    Jean      Pol       Georges   Richard
.This is a random and annoying mid-file comment with no discernable purpose.
Italian   Giovanni  Paolo     Giorgio   Riccardo
</code></pre>
<p class="tx">Adding the <span class="sans_thesansmonocd_w5regular_">eol=.</span> clause to the same <span class="sans_thesansmonocd_w5regular_">for</span> command instructs the interpreter to skip the comment lines, regardless of where they appear in the data, and process only the remaining records:</p>
<pre class="pre"><code class="calibre11">for /F "tokens=1-5 eol=." %%a in (C:\Batch\FourBrits.txt) do (
   &gt; con echo %%a:  %%b, %%c, %%d, and %%e
)
</code></pre>
<p class="tx">Unfortunately, this straightforward keyword has its very own batveat. Given that the <span class="sans_thesansmonocd_w5regular_">delims</span> clause accepts a list of delimiters, you’re probably expecting the <span class="sans_thesansmonocd_w5regular_">eol</span> clause to accept one to many characters. But no, it accepts only a single character.</p>
<p class="tx"><span aria-label=" Page 215. " epub:type="pagebreak" id="pg_215" role="doc-pagebreak"/>The phrase <span class="sans_thesansmonocd_w5regular_">tokens</span>, <span class="sans_thesansmonocd_w5regular_">delims</span>, <span class="sans_thesansmonocd_w5regular_">skip</span>, and <span class="sans_thesansmonocd_w5regular_">eol</span> doesn’t quite roll off the tongue quite like John, Paul, George, and Ringo, but these fabulous four keywords allow for a great deal of flexibility, and there will be more examples of clauses associated with these keywords in this chapter and others.</p>
</section>
</section>
<section aria-labelledby="sec11" epub:type="division">
<h3 class="h"><span id="sec11"/><span id="h1-132"/><span class="sans_futura_std_bold_b_">Defining the Input</span></h3>
<p class="tni">You now know how to read a file with the <span class="sans_thesansmonocd_w5regular_">for /F</span> command, but you might not yet know how to read a <i class="calibre6">file</i>—there’s a distinction. A traditional file is a collection of bytes organized into records stored in a referenceable location on a drive defined by a directory and filename. A <i class="calibre6">file</i> is some sort of input readable by the <span class="sans_thesansmonocd_w5regular_">for /F</span> command; it can take different forms and doesn’t have to be something that an editor can open.</p>
<p class="tx">Other than a traditional file, this command can accept a string as input and also the output of another Batch command. As you’ll soon see, subtle difference in the syntax dictates the type of input.</p>
<section aria-labelledby="sec12" epub:type="division">
<h4 class="h1"><span id="sec12"/><span id="h2-56"/><span class="sans_futura_std_heavy_oblique_bi_">File Input</span></h4>
<p class="tni">The <span class="sans_thesansmonocd_w5regular_italic_i_">file-set</span> input is a traditional file or set of files. I’ve already shown several examples of that form throughout this chapter. Each example contained one file inside the parentheses, and we now know those inputs were files because of the lack of any encasing quotes, single or double. What you’ve yet to see is a set of files. The following command reads the contents of two files in the order that they are listed in the <span class="sans_thesansmonocd_w5regular_italic_i_">file-set</span>, delimited by a comma or a space, or both for readability:</p>
<pre class="pre"><code class="calibre11">for /F "tokens=1-5" %%a in (FourBrits.txt, MoreBrits.txt) do (
   &gt; con echo %%a:  %%b, %%c, %%d, and %%e
)
</code></pre>
<p class="tx">Assuming that the first file, <i class="calibre6">FourBrits.txt</i>, has four records, the <span class="sans_thesansmonocd_w5regular_">for /F</span> command processes each in order, writing four lines to the console. The interpreter then closes that file and opens <i class="calibre6">MoreBrits.txt</i>. Each record in this file triggers one execution of the logic inside the code block and writes one more line to the console. I also removed the file paths, so the interpreter will look for these files in the current directory and the directories defined in the <span class="sans_thesansmonocd_w5regular_">path</span> variable.</p>
</section>
<section aria-labelledby="sec13" epub:type="division">
<h4 class="h1"><span id="sec13"/><span id="h2-57"/><span class="sans_futura_std_heavy_oblique_bi_">String Input</span></h4>
<p class="tni">Here is the general syntax for the <span class="sans_thesansmonocd_w5regular_">for /F</span> command using a string as input. Take note of the input inside the parentheses:</p>
<pre class="pre"><code class="calibre11">for /F ["<var class="calibre12">suboptions</var>"] %%<var class="calibre12">variable</var> in ("<var class="calibre12">string</var>") do <var class="calibre12">command</var></code></pre>
<p class="tx">This form replaces the input text with <span class="sans_thesansmonocd_w5regular_">"string"</span>. The double quotes tell the interpreter that they are encasing some sort of text, while a complete <span aria-label=" Page 216. " epub:type="pagebreak" id="pg_216" role="doc-pagebreak"/>lack of quotes tells the interpreter to consider the input to be a file or a set of files. Everything else works exactly the same.</p>
<p class="tx">The following <span class="sans_thesansmonocd_w5regular_">for /F</span> command is similar to other examples used earlier in this chapter, other than the input:</p>
<pre class="pre"><code class="calibre11">for /F "tokens=1-5" %%a in ("Italian Giovanni Paolo Giorgio Riccardo") do (
   &gt; con echo %%a:  %%b, %%c, %%d, and %%e
)
</code></pre>
<p class="tni">The only difference is that I’ve taken the last line of text from <i class="calibre6">FourBrits.txt</i>, removed some extra spaces for readability, and entered it as the <span class="sans_thesansmonocd_w5regular_">string</span> encased in double quotes.</p>
<p class="tx">The <span class="sans_thesansmonocd_w5regular_">echo</span> command inside the code block doesn’t know the source of the five tokens, whether it’s from a hardcoded string or a record read from a file. Here’s the familiar result:</p>
<pre class="pre"><code class="calibre11">Italian:  Giovanni, Paolo, Giorgio, and Riccardo</code></pre>
<p class="tx">In this example, the text inside the parentheses is hardcoded, but you can use a variable containing text, as long as it’s encased in double quotes. You can use any string as input, and the interpreter treats it like a single record file.</p>
<p class="tx">This feature allows for sophisticated string parsing. I actually used this feature in <span class="xref"><a href="chapter5.xhtml" class="calibre3">Chapter 5</a></span> with absolutely no explanation of how it worked, promising an explanation later. A <span class="sans_thesansmonocd_w5regular_">for /F</span> command converted a boolean to a boolean string, where the <span class="sans_thesansmonocd_w5regular_">bGod</span> boolean contained one of two values, <span class="sans_thesansmonocd_w5regular_">true==true</span> or <span class="sans_thesansmonocd_w5regular_">false==x</span>. At the time I mentioned, while attributing it to little more than a magic trick, that the command strips off the two equal signs and all that follows, giving <span class="sans_thesansmonocd_w5regular_">bStrGod</span> the value of <span class="sans_thesansmonocd_w5regular_">true</span> or <span class="sans_thesansmonocd_w5regular_">false</span>:</p>
<pre class="pre"><code class="calibre11">for /F "delims==" %%b in ("%bGod%") do  set bStrGod=%%b</code></pre>
<p class="tni">With what you’ve learned in this chapter, you can now figure out how this works.</p>
<p class="tx">The <span class="sans_thesansmonocd_w5regular_">for /F</span> command treats the resolved boolean encased in double quotes inside the parentheses as string or text input. The <span class="sans_thesansmonocd_w5regular_">delims</span> clause defines the equal sign as the only delimiter, and since I haven’t defined the <span class="sans_thesansmonocd_w5regular_">tokens</span> keyword, the default clause of <span class="sans_thesansmonocd_w5regular_">tokens=1</span> is implied. The result is that the word before the equal signs is the first token, and the interpreter resolves it as <span class="sans_thesansmonocd_w5regular_">%%b</span> (for <i class="calibre6">boolean</i>, of course), while discarding the second token coming after the equal signs. The <span class="sans_thesansmonocd_w5regular_">set</span> command then assigns that first token to the boolean string on its first and only execution.</p>
<p class="tx">So, it’s not a magic trick at all, instead just a concise means of pulling a single delimited value out of a larger string with a single line of code. Behold the power of the <span class="sans_thesansmonocd_w5regular_">for /F</span> command and its multiple inputs.</p>
</section>
<section aria-labelledby="sec14" epub:type="division">
<h4 class="h1"><span id="sec14"/><span id="h2-58"/><span aria-label=" Page 217. " epub:type="pagebreak" id="pg_217" role="doc-pagebreak"/><span class="sans_futura_std_heavy_oblique_bi_">Command Input</span></h4>
<p class="tni">What’s inside the parentheses dictates the input of any <span class="sans_thesansmonocd_w5regular_">for /F</span> command. You know that no quotes indicate a file and that double quotes indicate a string. Single quotes indicate that another Batch command is the input, and here’s its general syntax:</p>
<pre class="pre"><code class="calibre11">for /F ["<var class="calibre12">suboptions</var>"] %%<var class="calibre12">variable</var> in ('<var class="calibre12">command</var>') do <var class="calibre12">command</var></code></pre>
<p class="tx">Any Batch command entered between the single quotes executes first, with its resulting stdout being the input to the <span class="sans_thesansmonocd_w5regular_">for /F</span> command. The interpreter then processes what it considers to be the input, line by line if there’s more than one, as if it were a file.</p>
<p class="tx">To demonstrate the usefulness of a command as input, consider the <span class="sans_thesansmonocd_w5regular_">dir</span> command introduced in <span class="xref"><a href="chapter13.xhtml" class="calibre3">Chapter 13</a></span>. The following command lists all of the text files in the given directory:</p>
<pre class="pre"><code class="calibre11">dir C:\Batch\*.txt /B</code></pre>
<p class="tni">The <span class="sans_thesansmonocd_w5regular_">/B</span> option produces a list of filenames and extensions only—no file dates and sizes, and no header and trailer lines. But the command simply writes this information to stdout for your perusal and little more. Many times, you’ll want to take this list of files and execute some logic against each one. For example, let’s write some code to change the extension on all <i class="calibre6">.txt</i> files in a directory to <i class="calibre6">.bak</i> to signify that they’re backup files.</p>
<p class="tx">The single quotes tell the <span class="sans_thesansmonocd_w5regular_">for /F</span> command that the input is a command. The <span class="sans_thesansmonocd_w5regular_">dir</span> command generates a list of filenames, each with an extension and no path:</p>
<pre class="pre"><code class="calibre11">for /F "tokens=*" %%f in ('dir C:\Batch\*.txt /B') do (
   ren "C:\Batch\%%f" "%%~Nf.bak"
)
</code></pre>
<p class="tni">The <span class="sans_thesansmonocd_w5regular_">tokens=*</span> clause ensures that <span class="sans_thesansmonocd_w5regular_">%%f</span> takes on the entire string as its value as it enumerates through the list of files. The default clause would have dropped everything after the first embedded space in the name. The <span class="sans_thesansmonocd_w5regular_">ren</span> command renames the file, using the modifier for the filename (<span class="sans_thesansmonocd_w5regular_">N</span>) and tacking on the hardcoded extension.</p>
<p class="tx">I hope that you can appreciate how extremely impressive this is. Three commands are bound up together to perform quite a bit in just a couple lines of code. For those who use this often, it can become commonplace, and for others it might just be overwhelming, but in many languages something like this isn’t possible without an intermediate file. With this technique, the <span class="sans_thesansmonocd_w5regular_">dir</span> command isn’t just something that can dump information to the console or into a file (although that can also be useful). The unadulterated bare format of the output was clearly designed for this purpose. You can perform many processes, simple or complex, on any number of files. I’ll expand on this when I delve into some real-world applications.</p>
</section>
</section>
<section aria-labelledby="sec15" epub:type="division">
<h3 class="h"><span id="sec15"/><span id="h1-133"/><span aria-label=" Page 218. " epub:type="pagebreak" id="pg_218" role="doc-pagebreak"/><span class="sans_futura_std_bold_b_">Alternative Syntax for Input Types</span></h3>
<p class="tni">For some inputs the syntax just discussed simply doesn’t work. Sometimes a filename contains embedded spaces, but encasing it in double quotes turns it into string input. If a string contains a double quote, you can’t encase it in a pair of those characters. Likewise, commands sometimes contain single quotes. These cases pose a problem requiring a different syntax, and the <span class="sans_thesansmonocd_w5regular_">usebackq</span> keyword, the last of the suboptions available with the <span class="sans_thesansmonocd_w5regular_">for /F</span> command, is the solution.</p>
<p class="tx">Before going any further, some Batch abbreviations are obvious; I probably didn’t need to tell you that <span class="sans_thesansmonocd_w5regular_">delims</span> is short for <i class="calibre6">delimiters</i> and that <span class="sans_thesansmonocd_w5regular_">tokens</span> is short for, well, <i class="calibre6">tokens</i>. But there’s a good chance that you are puzzled by the cryptic text <span class="sans_thesansmonocd_w5regular_">usebackq</span>. The keyword stands for <i class="calibre6">use back quote</i>, which probably doesn’t help much, but at least now you’ll know how to pronounce it when you see it.</p>
<section aria-labelledby="sec16" epub:type="division">
<h4 class="h1"><span id="sec16"/><span id="h2-59"/><span class="sans_futura_std_heavy_oblique_bi_">File Input</span></h4>
<p class="tni">The best way to show the usefulness of the <span class="sans_thesansmonocd_w5regular_">usebackq</span> keyword is to re-create the type of situation that surely led to its creation. Many examples to this point in the chapter have read a file named <i class="calibre6">FourBrits.txt</i>. I rarely embed spaces in filenames, but someone else might have named this file <i class="calibre6">Four Brits.txt</i>.</p>
<p class="tx">To demonstrate the problem spaces can cause, I’ve lifted the following <span class="sans_thesansmonocd_w5regular_">for /F</span> command verbatim from earlier, except the filename now contains an embedded space:</p>
<pre class="pre"><code class="calibre11">for /F "tokens=1-5" %%a in (C:\Batch\Four Brits.txt) do (
   &gt; con echo %%a:  %%b, %%c, %%d, and %%e
)
</code></pre>
<p class="tx">Batch considers this to be two files (not one) and will likely fail, not being able to find an extensionless file named <i class="calibre6">Four</i>. The obvious solution is to put double quotes around the path and filename, but the <span class="sans_thesansmonocd_w5regular_">for /F</span> command will treat that as a text string instead of a filename, so that won’t work.</p>
<p class="tx">The solution is to use the <span class="sans_thesansmonocd_w5regular_">usebackq</span> keyword <i class="calibre6">and</i> double quotes around the input:</p>
<pre class="pre"><code class="calibre11">for /F "usebackq tokens=1-5" %%a in ("C:\Batch\Four Brits.txt") do (
   &gt; con echo %%a:  %%b, %%c, %%d, and %%e
)
</code></pre>
<p class="tni">This keyword also makes it easier to process paths and filenames containing special characters such as parentheses.</p>
<p class="tx">The <span class="sans_thesansmonocd_w5regular_">for /F</span> command successfully reads the file and produces the same output as before. You can even read multiple files, each with embedded spaces in their names:</p>
<pre class="pre"><code class="calibre11">for /F "usebackq tokens=1-5" %%a in ("Four Brits.txt", "More Brits.txt") do (
   &gt; con echo %%a:  %%b, %%c, %%d, and %%e
)
</code></pre>
<p class="tni"><span aria-label=" Page 219. " epub:type="pagebreak" id="pg_219" role="doc-pagebreak"/>Notice that the filenames are delimited by a comma and that a set of double quotes encases each filename.</p>
<p class="tx">Here’s the general syntax of the command using a <span class="sans_thesansmonocd_w5regular_italic_i_">file-set</span> as input with the <span class="sans_thesansmonocd_w5regular_">usebackq</span> keyword:</p>
<pre class="pre"><code class="calibre11">for /F "usebackq [<var class="calibre12">suboptions</var>]" %%<var class="calibre12">variable</var> in ("<var class="calibre12">file-set</var>") do <var class="calibre12">command</var></code></pre>
<p class="tx">This keyword changes the rules. Double quotes can surround each filename, although it still works with the keyword and without any double quotes, assuming the filename has no embedded spaces.</p>
</section>
<section aria-labelledby="sec17" epub:type="division">
<h4 class="h1"><span id="sec17"/><span id="h2-60"/><span class="sans_futura_std_heavy_oblique_bi_">String Input</span></h4>
<p class="tni">The <span class="sans_thesansmonocd_w5regular_">usebackq</span> keyword solved one problem but created another. It enables the use of double quotes around a filename, but this seems to disallow the ability to process a string. The solution is to encase the text in a different character and that character is the single quote. Here’s the general syntax:</p>
<pre class="pre"><code class="calibre11">for /F "usebackq [<var class="calibre12">suboptions</var>]" %%<var class="calibre12">variable</var> in ('<var class="calibre12">string</var>') do <var class="calibre12">command</var></code></pre>
<p class="tx">Therefore, the following two <span class="sans_thesansmonocd_w5regular_">for</span> commands are functionally equivalent:</p>
<pre class="pre"><code class="calibre11">for /F "tokens=1-4" %%a in ("Larry Moe Curly Iggy") do break
for /F "usebackq tokens=1-4" %%a in ('Larry Moe Curly Iggy') do break
</code></pre>
<p class="tni">Without <span class="sans_thesansmonocd_w5regular_">usebackq</span>, I’m encasing the short list of Stooges in double quotes, but single quotes encase the same text when the keyword is present. (I’m also using the <span class="sans_thesansmonocd_w5regular_">break</span> or <i class="calibre6">no operation</i> command to make these commands valid while focusing on the keyword and the type of quotes, but these commands produce no output.)</p>
<p class="tx">Why does Batch provide two means of performing the same task? To answer this question, I’ll use a string of Chicago airports, each encased in parentheses for some unknown reason, as the input. The following two commands are functionally equivalent:</p>
<pre class="pre"><code class="calibre11">for /F "tokens=1-2" %%a in ("(O'Hare) (Midway)") do break
for /F "usebackq tokens=1-2" %%a in ('^(O'Hare^) ^(Midway^)') do break
</code></pre>
<p class="tx">The first example, which doesn’t use <span class="sans_thesansmonocd_w5regular_">usebackq</span>, is far more workable. You must escape special characters such as the parentheses when using the keyword, all because of the lack of double quotes. But without the keyword, these characters are just along for the ride inside the double quotes.</p>
<p class="tx">But the one character that will never work in a double-quoted string is a solitary double quote itself—even when escaped. Returning to the Stooges, while Iggy Pop was the front man for <i class="calibre6">The Stooges</i>, he clearly wasn’t a member <span aria-label=" Page 220. " epub:type="pagebreak" id="pg_220" role="doc-pagebreak"/>of <i class="calibre6">The Three Stooges</i>, so I might want to put his name in scare quotes, or double quotes, to denote the irony:</p>
<pre class="pre"><code class="calibre11">for /F "usebackq tokens=1-4" %%a in ('Larry Moe Curly "Iggy"') do (
   &gt; con echo The Four Stooges are %%a, %%b, %%c, and %%d.
)
</code></pre>
<p class="tni">(The interpreter is intelligent enough to handle an even number of double quotes inside a set of double quotes, but for clarity I always use the keyword and encase the entire input in single quotes when the string has any double quotes.)</p>
<p class="tx">This <span class="sans_thesansmonocd_w5regular_">for /F</span> command writes the following to the console:</p>
<pre class="pre"><code class="calibre11">The Four Stooges are Larry, Moe, Curly, and "Iggy".</code></pre>
<p class="tni">(Poor Shemp, everyone forgets about Shemp.)</p>
</section>
<section aria-labelledby="sec18" epub:type="division">
<h4 class="h1"><span id="sec18"/><span id="h2-61"/><span class="sans_futura_std_heavy_oblique_bi_">Command Input</span></h4>
<p class="tni">You just learned to use single quotes when also using <span class="sans_thesansmonocd_w5regular_">usebackq</span> and string input, so you can no longer use them to encase a command. But this general syntax allows you to use the keyword with a command as input:</p>
<pre class="pre"><code class="calibre11">for /F "usebackq [<var class="calibre12">suboptions</var>]" %%<var class="calibre12">variable</var> in (`<var class="calibre12">command</var>`) do <var class="calibre12">command</var></code></pre>
<p class="tni">In some fonts the two characters encasing the command input might look like single quotes, but they’re something new.</p>
<p class="tx">This brings us back to the cliffhanger concerning the meaning of the text <span class="sans_thesansmonocd_w5regular_">usebackq</span> or <i class="calibre6">use back quote</i>. It’s named for those crooked single quotes encasing the <span class="sans_thesansmonocd_w5regular_italic_i_">command</span>, which are more properly called back quotes (or back ticks). The keyboard key for the back quote is just above <small class="calibre5">TAB</small> and to the left of the key for the number 1 on most keyboards. This key does double duty, as shifting it gets you the tilde. It’s relegated to the nether regions of the keyboard because it’s rarely if ever touched by most, but it’s an instrumental key for Batch coders.</p>
<p class="tx">The following <span class="sans_thesansmonocd_w5regular_">for /F</span> commands are functionally equivalent; the first one mimics a command from the prior section, and the second one uses the keyword and back quotes:</p>
<pre class="pre"><code class="calibre11">for /F "tokens=*" %%f in ('dir C:\Batch\*.txt /B') do break
for /F "usebackq tokens=*" %%f in (`dir C:\Batch\*.txt /B`) do break
</code></pre>
<p class="tx">The first line supports instances where the encased command might contain a back quote, while you’d use the second line—the syntax with the <span class="sans_thesansmonocd_w5regular_">usebackq</span> keyword—when the command might contain a single quote.</p>
</section>
<section aria-labelledby="sec19" epub:type="division">
<h4 class="h1"><span id="sec19"/><span id="h2-62"/><span aria-label=" Page 221. " epub:type="pagebreak" id="pg_221" role="doc-pagebreak"/><span class="sans_futura_std_heavy_oblique_bi_">When to Use usebackq</span></h4>
<p class="tni">You can implement each type of input with or without <span class="sans_thesansmonocd_w5regular_">usebackq</span>, so when should you use the keyword? In a sentence: whenever possible, I use <span class="sans_thesansmonocd_w5regular_">usebackq</span> for file-set and command inputs, and I don’t for string input.</p>
<p class="tx">Encasing the input in double quotes allows for the most flexibility and should be done whenever possible. It supports embedded spaces in the input and many characters that might otherwise require escaping. Hence, when processing a file-set, I use double quotes and <span class="sans_thesansmonocd_w5regular_">usebackq</span>, and when processing a string, I use double quotes and omit the keyword.</p>
<p class="tx">When the input is a command, double quotes don’t enter into the calculus. Some may skip the keyword to save a few keystrokes, but I use the <span class="sans_thesansmonocd_w5regular_">usebackq</span> keyword and back quotes around the input for two reasons. First, while both the single quote and back quote are unlikely characters in a command, the back quote is even more unlikely. More important, when you see the single quotes, you immediately ask whether the input is a string or a command; the back quotes remove all ambiguity; it’s a command.</p>
<p class="tx">If you implement my recommendations, the end result will be that anyone looking at your <span class="sans_thesansmonocd_w5regular_">for /F</span> commands will be able to infer a great deal from the input. If it’s encased in back quotes, it’s a <span class="sans_thesansmonocd_w5regular_">command</span>; if it’s encased in double quotes, focus shifts to <span class="sans_thesansmonocd_w5regular_">usebackq</span>. If it’s present, the input is a file-set; if not, it’s a string. There are three more forms available in the event of a blue moon, but you’ll see an input string containing a double quote or an input command containing a back quote less frequently than you’ll see two full moons in a calendar month.</p>
<p class="tx">As one final note on the <span class="sans_thesansmonocd_w5regular_">usebackq</span>, if you don’t find this keyword cryptic enough, the <span class="sans_thesansmonocd_w5regular_">q</span> is optional. You can replace every instance of <span class="sans_thesansmonocd_w5regular_">usebackq</span> appearing in the code listings in this chapter with its synonym <span class="sans_thesansmonocd_w5regular_">useback</span>. I’m usually in favor of reducing keystrokes, but this puts an additional veil over something that’s already inscrutable to many.</p>
</section>
</section>
<section aria-labelledby="sec20" epub:type="division">
<h3 class="h"><span id="sec20"/><span id="h1-134"/><span class="sans_futura_std_bold_b_">Real-World Applications</span></h3>
<p class="tni">The ability to read files and to treat strings and the outputs of commands as if they were files has many applications. Truly understanding the different types of inputs possible for a <span class="sans_thesansmonocd_w5regular_">for /F</span> command will allow you to come up with imaginative solutions to problems that may have seemed intractable not long ago.</p>
<section aria-labelledby="sec21" epub:type="division">
<h4 class="h1"><span id="sec21"/><span id="h2-63"/><span class="sans_futura_std_heavy_oblique_bi_">Process Only Large Files in a Folder</span></h4>
<p class="tni">In <span class="xref"><a href="chapter17.xhtml" class="calibre3">Chapter 17</a></span>, I explored an application that passed a number of files into a bat file to be processed one by one. In this example, we’ll still process files individually, but instead of a list of arguments, let’s process all <i class="calibre6">.txt</i> files in a particular folder. To make it a little more interesting, let’s process only large files, defined as any file at least 100KB in size.</p>
<p class="tx">You can feed the <span class="sans_thesansmonocd_w5regular_">dir</span> command into the <span class="sans_thesansmonocd_w5regular_">for /F</span> command as input with back quotes encasing the command if using the <span class="sans_thesansmonocd_w5regular_">usebackq</span> keyword. The bare <span aria-label=" Page 222. " epub:type="pagebreak" id="pg_222" role="doc-pagebreak"/>format option, <span class="sans_thesansmonocd_w5regular_">/B</span>, produces a clean list of files without headers and is tailor-made for this purpose, but the file size is lost with this option, so let’s drop that idea, at least for now.</p>
<p class="tx">However, not using the <span class="sans_thesansmonocd_w5regular_">/B</span> option presents other challenges. File dates and times will be present, along with header and trailer records. You’ll want to use the size of each file to evaluate whether it’s large enough to process, but the pesky commas in the displayed file size will be more than a nuisance.</p>
<p class="tx">In <span class="xref"><a href="chapter13.xhtml" class="calibre3">Chapter 13</a></span>, I mentioned that the <span class="sans_thesansmonocd_w5regular_">/-C</span> option of the <span class="sans_thesansmonocd_w5regular_">dir</span> command suppresses the commas, but to figure out how to parse what you want out of its output, you’ll want to see a sample. Unless you possess a memory far more detailed than mine, an essential step in building any complex <span class="sans_thesansmonocd_w5regular_">for /F</span> command with an embedded command is to execute that embedded command, the command that will be inside the back quotes, and inspect its output. Here’s the command, where <span class="sans_thesansmonocd_w5regular_">workDir</span> is the folder in question:</p>
<pre class="pre"><code class="calibre11">dir %workDir%\*.txt /-C</code></pre>
<p class="tni">It might generate something like the following:</p>
<pre class="pre"><code class="calibre11"> Volume in drive C is OS
 Volume Serial Number is 2E6D-DBF0

 Directory of C:\Batch

12/25/2011  12:42 PM            538346 Big.txt
11/24/2011  05:22 PM             17234 Little.txt
09/05/2011  10:43 AM                10 Wee Tiny.txt
07/04/2011  07:22 PM           1864408 Wicked Big.txt
               4 File(s)        2419998 bytes
               0 Dir(s)    146181152768 bytes free
</code></pre>
<p class="tx">There’s a lot to unpack here, but with this data you can construct the rest of the <span class="sans_thesansmonocd_w5regular_">for /F</span> command. You’re interested in the four detail records, but there are five header records, including the empty records, so you’ll want to avoid them with the <span class="sans_thesansmonocd_w5regular_">skip=5</span> clause.</p>
<p class="tx">Next, you need to figure out the best way to find the tokens that correspond to the file size and name. The space character is one of the default delimiters, and it’ll work great here, but notice that if you had wanted the month, day, year, hour, or minutes out of the data, you would have used a <span class="sans_thesansmonocd_w5regular_">delims</span> clause defining a delimiter set of forward slashes, colons, and spaces. Given that the space is the delimiter, you must now put on your interpreter hat and look for the space-delimited tokens. The date is the first token, and the time comprises the next two tokens; because of the embedded space, the meridiem (<span class="sans_thesansmonocd_w5regular_">AM</span>/<span class="sans_thesansmonocd_w5regular_">PM</span>) becomes the third token. Hence, the fourth token is the file size with the remainder of the data being the filename.</p>
<p class="tx">To represent size, you’ll use <span class="sans_thesansmonocd_w5regular_">%%s</span> as the <span class="sans_thesansmonocd_w5regular_">for</span> variable, meaning that <span class="sans_thesansmonocd_w5regular_">%%t</span> will be the filename and extension. (If you use <span class="sans_thesansmonocd_w5regular_">%%e</span> as the size, then <span class="sans_thesansmonocd_w5regular_">%%f</span> becomes the file.)</p>
<p class="tx"><span aria-label=" Page 223. " epub:type="pagebreak" id="pg_223" role="doc-pagebreak"/>It might be tempting to consider the filename to be the fifth token, but filenames can contain spaces, and any space in the name will delimit yet another token. Fortunately, the filename comes at the end of the data, meaning that the <span class="sans_thesansmonocd_w5regular_">tokens=4*</span> clause assigns two tokens. The fourth token is the file size, and thanks to the asterisk, the rest of the data, which is the filename, becomes the fifth token.</p>
<p class="tx">You’re not done, but you can put together the main structure of the <span class="sans_thesansmonocd_w5regular_">for /F</span> command. Everything discussed is here, in particular, the <span class="sans_thesansmonocd_w5regular_">dir</span> command inside back quotes:</p>
<pre class="pre"><code class="calibre11">for /F "usebackq tokens=4* skip=5" %%s in (`dir %workDir%\*.txt /-C`) do (</code></pre>
<p class="tx">Before calling the logic to process a big file, you’ll need to navigate two <span class="sans_thesansmonocd_w5regular_">if</span> commands. The first simply verifies that the file size, <span class="sans_thesansmonocd_w5regular_">%%s</span>, is greater than or equal to <span class="sans_thesansmonocd_w5regular_">100000</span>. The <span class="sans_thesansmonocd_w5regular_">for /F</span> command allows you to skip header records, but trailer records are still in play, so you must get creative. Notice in the <span class="sans_thesansmonocd_w5regular_">dir</span> command output that the fourth token in both trailer records is the text <span class="sans_thesansmonocd_w5regular_">bytes</span>, which surely won’t be the case for the detail records you’re interested in. Hence, you’ll need a second <span class="sans_thesansmonocd_w5regular_">if</span> command to filter out those two unwanted records by inspecting the same <span class="sans_thesansmonocd_w5regular_">%%s</span> variable.</p>
<p class="tx">Now you can put it all together:</p>
<pre class="pre"><code class="calibre11">for /F "usebackq tokens=4* skip=5" %%s in (`dir %workDir%\*.txt /-C`) do (
   if %%s geq 100000 (
      if /i "%%s" neq "bytes" (
         call :ProcessBigTxtFile "%workDir%\%%t"
)  )  )
</code></pre>
<p class="tx">If the <span class="sans_thesansmonocd_w5regular_">workDir</span> variable is populated with the working directory of the text files, this code is ready to process the big text files represented by <span class="sans_thesansmonocd_w5regular_">%%t</span>. Also, it might seem quite odd that <span class="sans_thesansmonocd_w5regular_">%%s</span> is used in both numeric and alpha compares. In <span class="xref"><a href="chapter4.xhtml" class="calibre3">Chapter 4</a></span>, I mentioned that numeric and alpha values are ordered; letters are considered to be greater than numbers, so the <span class="sans_thesansmonocd_w5regular_">bytes geq 100000</span> conditional clause is always true. If it had always been false, you could have omitted the second <span class="sans_thesansmonocd_w5regular_">if</span> command.</p>
<p class="tx">Multiple solutions always exist, and it’s great to see a different way to think through an issue. I’m going to take another pass at the <span class="sans_thesansmonocd_w5regular_">/B</span> option of the <span class="sans_thesansmonocd_w5regular_">dir</span> command. I know that it won’t provide the file size, but maybe there’s another way to get it. I showed how to use modifiers to get the size of a file using the optionless <span class="sans_thesansmonocd_w5regular_">for</span> command in <span class="xref"><a href="chapter17.xhtml" class="calibre3">Chapter 17</a></span>. Maybe two <span class="sans_thesansmonocd_w5regular_">for</span> commands will be better than one.</p>
<p class="tx">I’ll start with this solution, which implements nested <span class="sans_thesansmonocd_w5regular_">for</span> commands:</p>
<pre class="pre"><code class="calibre11">for /F "usebackq tokens=*" %%f in (`dir %workDir%\*.txt /B`) do (
   for %%g in ("%workDir%\%%f") do (
      if %%~Zg geq 100000 (
         call :ProcessBigTxtFile %%g
)  )  )
</code></pre>
<p class="tx"><span aria-label=" Page 224. " epub:type="pagebreak" id="pg_224" role="doc-pagebreak"/>The outer <span class="sans_thesansmonocd_w5regular_">for</span> command has the <span class="sans_thesansmonocd_w5regular_">/F</span> option, along with the <span class="sans_thesansmonocd_w5regular_">usebackq</span> keyword, and it uses <span class="sans_thesansmonocd_w5regular_">%%f</span> as its variable. Its input is a <span class="sans_thesansmonocd_w5regular_">dir</span> command with the <span class="sans_thesansmonocd_w5regular_">/B</span> option encased in back quotes. The <span class="sans_thesansmonocd_w5regular_">tokens=*</span> clause ensures that the code passes each filename, regardless of embedded spaces, into the code block, where I immediately prepend it with the path, put it in double quotes, and use it as the input to the inner <span class="sans_thesansmonocd_w5regular_">for</span> command.</p>
<p class="tx">That inner command, which doesn’t sport the <span class="sans_thesansmonocd_w5regular_">/F</span> option, uses <span class="sans_thesansmonocd_w5regular_">%%g</span> as its variable, but anything other than <span class="sans_thesansmonocd_w5regular_">%%f</span> would have been good form. I’m deriving the file size with the use of a modifier, <span class="sans_thesansmonocd_w5regular_">%%~Zg</span>; if it’s large enough, the <span class="sans_thesansmonocd_w5regular_">call</span> command invokes the routine that processes large files.</p>
<p class="tx">Nested <span class="sans_thesansmonocd_w5regular_">for</span> commands don’t behave much differently from their non-nested cousins, but an important point is the alpha character chosen for the <span class="sans_thesansmonocd_w5regular_">for</span> variable of each command. I could’ve used <span class="sans_thesansmonocd_w5regular_">%%f</span> for both commands, but I always use unique values, as it’s simply clearer and easier to read. In addition, the outer variable is still available inside the inner command, but only if it hasn’t been stepped on by the inner variable.</p>
<p class="tx">To prevent a <span class="sans_thesansmonocd_w5regular_">for</span> variable conflict, they should not only be different, but I also recommend staggering them so that any implied variables don’t collide. For instance, if the outer command is extracting three tokens from the input data and using <span class="sans_thesansmonocd_w5regular_">%%f</span> as its <span class="sans_thesansmonocd_w5regular_">for</span> variable, then <span class="sans_thesansmonocd_w5regular_">%%g</span> and <span class="sans_thesansmonocd_w5regular_">%%h</span> should also be off limits for the inner command.</p>
<p class="tx">You’ve seen two solutions to the same problem. One used a more complex command to parse the data, and the other used nested commands. Which way is better is debatable. What isn’t debatable is that just as in other languages, multiple possible solutions exist for all problems. Never settle.</p>
</section>
<section aria-labelledby="sec22" epub:type="division">
<h4 class="h1"><span id="sec22"/><span id="h2-64"/><span class="sans_futura_std_heavy_oblique_bi_">Global Text Replacement</span></h4>
<p class="tni">Imagine you maintain an old system that runs a number of executables, many of which are housed on an old server. The team is decommissioning the server, <i class="calibre6">\\OldServer</i>, and replacing it with the aptly named <i class="calibre6">\\NewServer</i>. The plan is to move every file on the old box to the new box with the same directory structure.</p>
<p class="tx">Fortunately, your team has wisely implemented and adhered to a consistent naming convention for the variables that define each program; they all start with <span class="sans_thesansmonocd_w5regular_">_pgm</span>. You control the creation of some of these variables, but not all. You’ll never be able to track them all down, but to cut over to the new server successfully, you’ll need to tweak all of these variables on the fly—that is, you’ll need to change the text for the old server to the new text, and you can’t even get a list of all the variable names.</p>
<p class="tx">The first problem to solve is retrieving the list of variable names in a given execution. In <span class="xref"><a href="chapter2.xhtml" class="calibre3">Chapter 2</a></span>, you learned that the following command generates a list of all currently active variables that start with the text <span class="sans_thesansmonocd_w5regular_">_pgm</span>:</p>
<pre class="pre"><code class="calibre11">set _pgm</code></pre>
<p class="tx"><span aria-label=" Page 225. " epub:type="pagebreak" id="pg_225" role="doc-pagebreak"/>If just four such variables were set, the following might be the result of the command:</p>
<pre class="pre"><code class="calibre11">_pgmDBMrge=\\OldServer\Executables\DatabaseMerge.exe
_pgmSTElse=\\NewServer\Executables\SomethingElse.exe
_pgmTtlDiff=\\ThirdServer\Progs\TotallyDifferent.exe
_pgmVldtn=\\OldServer\Executables\Validation.exe
</code></pre>
<p class="tx">The first and last of these need tweaking, the second has already been updated with the new text, and third has a completely different directory structure. You’ll need to update two of these without altering the other two. The solution entails the previous <span class="sans_thesansmonocd_w5regular_">set</span> command as the input to a <span class="sans_thesansmonocd_w5regular_">for /F</span> command. The code block will accept the variable name and value and reset the variable to its value with the updated text.</p>
<p class="tx">The following <span class="sans_thesansmonocd_w5regular_">for /F</span> command is one solution:</p>
<pre class="pre"><code class="calibre11">for /F "usebackq tokens=1,2 delims==" %%p in (`set _pgm`) do (
   set tempPgm=%%q
   set %%p=!tempPgm:\\OldServer\=\\NewServer\!
)
</code></pre>
<p class="tx">You’ve placed the command <span class="sans_thesansmonocd_w5regular_">set _pgm</span> between back quotes and used the <span class="sans_thesansmonocd_w5regular_">usebackq</span> keyword in the <span class="sans_thesansmonocd_w5regular_">for /F</span> command. When using the <span class="sans_thesansmonocd_w5regular_">dir</span> command as input, I stressed the importance of understanding its output, and the same holds true for the <span class="sans_thesansmonocd_w5regular_">set</span> command. Looking at the four sample lines of output, the commonality between them is that a variable name is followed by a value, separated by an equal sign. Thus, you’re delimiting on the equal sign with the <span class="sans_thesansmonocd_w5regular_">delims==</span> clause and extracting both tokens with the <span class="sans_thesansmonocd_w5regular_">tokens=1,2</span> clause. The <span class="sans_thesansmonocd_w5regular_">for</span> variable, <span class="sans_thesansmonocd_w5regular_">%%p</span>, is the variable name, implying that <span class="sans_thesansmonocd_w5regular_">%%q</span> is its value.</p>
<p class="tx">This code resets the variable in the code block with just two commands. You assign the original value of the input variable, <span class="sans_thesansmonocd_w5regular_">%%q</span>, to <span class="sans_thesansmonocd_w5regular_">tempPgm</span>, a temporary variable. The second command resets the variable name, <span class="sans_thesansmonocd_w5regular_">%%p</span>, to that value with <i class="calibre6">\\OldServer\</i> replaced with <i class="calibre6">\\NewServer\</i>. Notice that because <span class="sans_thesansmonocd_w5regular_">tempPgm</span> is being set and then used inside of a code block, you must use exclamation marks to resolve the variable to its current value.</p>
<p class="tx">This logic updates all variables with this specific prefix while ignoring those without the prefix. There are many other applications based on this principle. You could reset all similarly named variables to null by replacing the code in the code block with one command, <span class="sans_thesansmonocd_w5regular_">set %%p=</span>, and using the default <span class="sans_thesansmonocd_w5regular_">tokens</span> clause.</p>
</section>
</section>
<section aria-labelledby="sec23" epub:type="division">
<h3 class="h"><span id="sec23"/><span id="h1-135"/><span class="sans_futura_std_bold_b_">Notes on the Documentation</span></h3>
<p class="tni">I’ve taken some liberties with the general syntax of the different forms of the <span class="sans_thesansmonocd_w5regular_">for /F</span> command, so I’ll compare what you’ve seen here to what’s in <span aria-label=" Page 226. " epub:type="pagebreak" id="pg_226" role="doc-pagebreak"/>the help documentation and explain my reasons. First, this is exactly what you’ll find by running <span class="sans_thesansmonocd_w5regular_">for /?</span>:</p>
<pre class="pre"><code class="calibre11">FOR /F ["<var class="calibre12">options</var>"] %<var class="calibre12">variable</var> IN (<var class="calibre12">file-set</var>) DO <var class="calibre12">command</var> [<var class="calibre12">command-parameters</var>]
FOR /F ["<var class="calibre12">options</var>"] %<var class="calibre12">variable</var> IN ("<var class="calibre12">string</var>") DO <var class="calibre12">command</var> [<var class="calibre12">command-parameters</var>]
FOR /F ["<var class="calibre12">options</var>"] %<var class="calibre12">variable</var> IN ('<var class="calibre12">command</var>') DO <var class="calibre12">command</var> [<var class="calibre12">command-parameters</var>]

    or, if usebackq option present:

FOR /F ["<var class="calibre12">options</var>"] %<var class="calibre12">variable</var> IN (<var class="calibre12">file-set</var>) DO <var class="calibre12">command</var> [<var class="calibre12">command-parameters</var>]
FOR /F ["<var class="calibre12">options</var>"] %<var class="calibre12">variable</var> IN ('<var class="calibre12">string</var>') DO <var class="calibre12">command</var> [<var class="calibre12">command-parameters</var>]
FOR /F ["<var class="calibre12">options</var>"] %<var class="calibre12">variable</var> IN (`<var class="calibre12">command</var>`) DO <var class="calibre12">command</var> [<var class="calibre12">command-parameters</var>]
</code></pre>
<p class="tx">I instead list the three forms that I use almost exclusively, followed by the ones I use infrequently:</p>
<pre class="pre"><code class="calibre11">for /F "usebackq [<var class="calibre12">suboptions</var>]" %%<var class="calibre12">variable</var> in ("<var class="calibre12">file-set</var>") do <var class="calibre12">command</var>
for /F ["<var class="calibre12">suboptions</var>"] %%<var class="calibre12">variable</var> in ("<var class="calibre12">string</var>") do <var class="calibre12">command</var>
for /F "usebackq [<var class="calibre12">suboptions</var>]" %%<var class="calibre12">variable</var> in (`<var class="calibre12">command</var>`) do <var class="calibre12">command</var>

for /F ["<var class="calibre12">suboptions</var>"] %%<var class="calibre12">variable</var> in (<var class="calibre12">file-set</var>) do <var class="calibre12">command</var>
for /F "usebackq [<var class="calibre12">suboptions</var>]" %%<var class="calibre12">variable</var> in ('<var class="calibre12">string</var>') do <var class="calibre12">command</var>
for /F ["<var class="calibre12">suboptions</var>"] %%<var class="calibre12">variable</var> in ('<var class="calibre12">command</var>') do <var class="calibre12">command</var>
</code></pre>
<p class="tx">First off, I have more of an affinity for lowercase characters than most coders. Also, I’ve replaced the <span class="sans_thesansmonocd_w5regular_">["options"]</span> clause with <span class="sans_thesansmonocd_w5regular_">["suboptions"]</span>. This <span class="sans_thesansmonocd_w5regular_">for</span> command already has one option, <span class="sans_thesansmonocd_w5regular_">/F</span>, and I see no reason to introduce another type of option, so I’ve settled on the term <i class="calibre6">suboptions</i>, but both of these tweaks are cosmetic.</p>
<p class="tx">I’ve dropped [<span class="sans_thesansmonocd_w5regular_italic_i_">command-parameters</span>] from the end of each, which just states that the <span class="sans_thesansmonocd_w5regular_italic_i_">command</span> could have parameters, but that’s obvious and unworthy of the extra ink. To truly do it correctly, I could’ve shown additional optional commands as well as optional parentheses defining a possible code block. To be readable, it has to be a bit vague, so I’ve decided to also make it succinct.</p>
<p class="tx">Another difference is that I’ve used two percent signs for the <span class="sans_thesansmonocd_w5regular_">for</span> variable, <span class="sans_thesansmonocd_w5regular_">%%</span><span class="sans_thesansmonocd_w5regular_italic_i_">variable</span>, as opposed to one. The help shows how you would execute the command from the command prompt, where the only difference is that it calls for a single percent sign. This is a book about bat files, not the command prompt, and the command is usually too complex to be entered at the prompt anyway.</p>
<p class="tx">I explicitly show the <span class="sans_thesansmonocd_w5regular_">usebackq</span> keyword in the forms that use it, while the help documentation places them after an odd heading. To accommodate this change, I’ve also placed the other <span class="sans_thesansmonocd_w5regular_italic_i_">suboptions</span> inside the square brackets because they are still optional.</p>
<p class="tx">The final difference is in the first form, and it’s the most critical one. When researching this book, I was absolutely flabbergasted to notice that the two forms using the <span class="sans_thesansmonocd_w5regular_italic_i_">file-set</span> as input are identical in the help. Adding the <span class="sans_thesansmonocd_w5regular_">usebackq</span> keyword means that double quotes can now encase the input. Technically, they don’t have to be there, but isn’t that the whole point of using <span class="sans_thesansmonocd_w5regular_">usebackq</span>? I’m hard-pressed to come up with an instance where I <span aria-label=" Page 227. " epub:type="pagebreak" id="pg_227" role="doc-pagebreak"/>wouldn’t want the double quotes while using the keyword, so I’m including them in my documentation, but understand that they are optional.</p>
<p class="tx">Use the forms that make sense to you. Better yet, start with one set or the other (I hope mine) and build on it in your own personal documentation about the <span class="sans_thesansmonocd_w5regular_">for</span> command.</p>
</section>
<section aria-labelledby="sec24" epub:type="division">
<h3 class="h"><span id="sec24"/><span id="h1-136"/><span class="sans_futura_std_bold_b_">Deconstructing Any for Command</span></h3>
<p class="tni">The <span class="sans_thesansmonocd_w5regular_">for</span> command, especially when followed by the <span class="sans_thesansmonocd_w5regular_">/F</span> option, can be overwhelming. You can pack quite a bit of logic into just a few lines of code. When you come across one of these constructs, it can be difficult to know exactly where to start your analysis. I’ve deconstructed many of these commands (a good number being my own) over the years, and whenever I see a command starting with <span class="sans_thesansmonocd_w5regular_">for</span>, I use these questions and steps to figure out what the code is doing:</p>
<div class="top">
<p class="listnumber">  1.  What’s the option? Is it optionless, <span class="sans_thesansmonocd_w5regular_">/D</span>, <span class="sans_thesansmonocd_w5regular_">/R</span>, <span class="sans_thesansmonocd_w5regular_">/L</span>, or <span class="sans_thesansmonocd_w5regular_">/F</span>?</p>
<p class="listnumber">  2.  Based on the option, what type of input is it using? If it’s optionless, is the input a file, files, or a list of values? If it’s <span class="sans_thesansmonocd_w5regular_">/D</span>, expect a directory as input. If it’s <span class="sans_thesansmonocd_w5regular_">/R</span>, expect a recursive process on an input of one or more files. If it’s <span class="sans_thesansmonocd_w5regular_">/L</span>, look at the three numbers defining the iterative loop. In all four of these cases, next step through the logic in the code block given the input.</p>
<p class="listbody">But if the option is <span class="sans_thesansmonocd_w5regular_">/F</span>, you’ve only just begun the deconstruction. What type of input is the command using? If there are no quotes, the input is a file-set; if back quotes, a command. If double quotes, <span class="sans_thesansmonocd_w5regular_">usebackq</span> translates to a file-set; otherwise, a string. If single quotes, <span class="sans_thesansmonocd_w5regular_">usebackq</span> translates to a string; otherwise, a command.</p>
<p class="listnumber">  3.  Determine what the input is contributing. Does the file-set have a wildcard? Roughly how many files are being processed? What type of data is in the file or files? Is the string hardcoded or a variable? What does the command do, and what’s its output? Roughly how many lines of output are created? How consistent is the data—that is, will there be header or trailer data?</p>
<p class="listnumber">  4.  Examine the suboptions and determine how the input is being manipulated. Based on the <span class="sans_thesansmonocd_w5regular_">tokens</span> and <span class="sans_thesansmonocd_w5regular_">delims</span> clauses (or their defaults), how many tokens are created, and how will they be populated from the input? Are any records dropped with <span class="sans_thesansmonocd_w5regular_">skip</span> or <span class="sans_thesansmonocd_w5regular_">eol</span> clauses?</p>
<p class="listnumber">  5.  Identify the <span class="sans_thesansmonocd_w5regular_">for</span> variable, perhaps <span class="sans_thesansmonocd_w5regular_">%%i</span>, and determine the input data associated with it and its subsequent variables, perhaps <span class="sans_thesansmonocd_w5regular_">%%j</span> and <span class="sans_thesansmonocd_w5regular_">%%k</span>.</p>
<p class="listnumber">  6.  Examine the code block. Determine how the <span class="sans_thesansmonocd_w5regular_">for</span> variable, and any implied variables, are referenced. Is something being copied, renamed, deleted, or processed in any way?</p>
</div>
<p class="tx">Maybe these questions and steps seem overwhelming, but to demonstrate how easy they are to use, let’s deconstruct some code. Someone you <span aria-label=" Page 228. " epub:type="pagebreak" id="pg_228" role="doc-pagebreak"/>just met online has given you this command telling you that it will back up some files. Just run it:</p>
<pre class="pre"><code class="calibre11">for /F "usebackq tokens=1,3" %%x in (`xcopy * %userprofile%\%random%\`) do (
   if "%%y" neq "copied" &gt; %%x echo This file has been randomly moved.
)
</code></pre>
<p class="tx">But before executing this, you should deconstruct it. Using the prior six steps:</p>
<div class="top">
<p class="listnumber">  1.  The option is <span class="sans_thesansmonocd_w5regular_">/F</span>.</p>
<p class="listnumber">  2.  Back quotes encase the input, so it’s a <span class="sans_thesansmonocd_w5regular_">command</span>.</p>
<p class="listnumber">  3.  The source argument of the <span class="sans_thesansmonocd_w5regular_">xcopy</span> is an asterisk, meaning that the command copies all files from the current directory to an oddly named folder using two pseudo-environment variables that I’ve yet to discuss (but will in <span class="listnumber_xref"><a href="chapter21.xhtml" class="calibre3">Chapter 21</a></span>). If this command copies five files successfully, the output will be a list of the five source files, followed by the trailer record stating: <span class="sans_thesansmonocd_w5regular_">5 File(s) copied</span>.</p>
<p class="listnumber">  4.  Based on the <span class="sans_thesansmonocd_w5regular_">tokens</span> clause and the lack of a <span class="sans_thesansmonocd_w5regular_">delims</span> clause, this code extracts the first and third tokens from the space-delimited input. For most of the output, the first token is the full path and name of the source file, assuming that there are no embedded spaces, and the third token is null. For the last line of input, or the trailer record, the first token resolves to the number of files copied, while the third token is the word <span class="sans_thesansmonocd_w5regular_">copied</span>.</p>
<p class="listnumber">  5.  The <span class="sans_thesansmonocd_w5regular_">%%x</span> is the path and filename up until the last line of output when it becomes the number of files copied. The <span class="sans_thesansmonocd_w5regular_">%%y</span> is nothing at all (again assuming no embedded spaces) before resolving to <span class="sans_thesansmonocd_w5regular_">copied</span> while processing the last line of output. So far, so good.</p>
<p class="listnumber">  6.  Shifting to the code block, the <span class="sans_thesansmonocd_w5regular_">if</span> command filters out the last record where <span class="sans_thesansmonocd_w5regular_">%%y</span> resolves to the specific text, meaning that for every file that’s copied the <span class="sans_thesansmonocd_w5regular_">echo</span> command replaces its entire contents with what looks to be a vague threat.</p>
</div>
<p class="tx">This looks to be more than a little suspicious. The code is hiding away all files from the current directory, including the bat file itself assuming it’s in the current directory, in a randomly named folder. Then it wipes out and replaces the contents of each source file with some text. It’s of little consolation that files with embedded spaces in their name may be spared.</p>
<p class="tx">Because you now know how to deconstruct a <span class="sans_thesansmonocd_w5regular_">for</span> command, you weren’t fooled by this bat file. Without executing the code, you’ve deduced that it’s malicious code—a bat virus.</p>
</section>
<section aria-labelledby="sec25" epub:type="division">
<h3 class="h"><span id="sec25"/><span id="h1-137"/><span aria-label=" Page 229. " epub:type="pagebreak" id="pg_229" role="doc-pagebreak"/><span class="sans_futura_std_bold_b_">Summary</span></h3>
<p class="tni">In this chapter, you learned about the file reading option of the <span class="sans_thesansmonocd_w5regular_">for</span> command, and you learned that it does much more than read files. The input can be a file, a string, or the output of a command, each with distinct syntaxes. I detailed the syntax for manipulating the input data, creating tokens, and using those tokens in the code block of the command. I also demonstrated much of this functionality with some real-world problems, finishing up with a discussion about how to deconstruct this important command.</p>
<p class="tx">In the next chapter, I’ll close out <span class="xref"><a href="part2.xhtml" class="calibre3">Part II</a></span> with an examination of a few advanced techniques that will either solve a problem associated with using the <span class="sans_thesansmonocd_w5regular_">for</span> command or solve a problem with the use of the <span class="sans_thesansmonocd_w5regular_">for</span> command.</p>
</section>
</section>
</div></body></html>