<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" epub:prefix="index: http://www.index.com/" xml:lang="en" lang="en">
<head>
<title>1. Setting Up a Powershell Testing Environment</title>
<link href="../styles/stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="sbo-rt-content"><section aria-labelledby="ch1" epub:type="chapter" role="doc-chapter">
<hgroup>
<h2 class="CHAPTER" id="ch1">
<span class="CN"><span aria-label=" Page 3. " epub:type="pagebreak" id="pg_3" role="doc-pagebreak"></span><samp class="SANS_Futura_Std_Bold_Condensed_B_11">1</samp></span>
<span class="CT"><samp class="SANS_Dogma_OT_Bold_B_11">SETTING UP A POWERSHELL TESTING ENVIRONMENT</samp></span>
</h2>
</hgroup>
<figure class="opener"><img alt="" class="opener" height="386" src="../images/chapter.jpg" width="386"/></figure>
<p class="ChapterIntro">In this chapter, you’ll configure PowerShell so you can work through the code examples presented in the rest of the book. Then, we’ll walk through a very quick overview of the PowerShell language, including its types, variables, and expressions. We’ll also cover how to execute its commands, how to get help, and how to export data for later use.</p>
<section aria-labelledby="sec1" epub:type="division">
<h3 class="H1" id="sec1"><span id="h1-6"></span><samp class="SANS_Futura_Std_Bold_B_11">Choosing a PowerShell Version</samp></h3>
<p class="TNI1">The most important tool you’ll need to use this book effectively is PowerShell, which has been installed on the Windows operating system by default since Windows 7. However, there are many different versions of this tool. The version installed by default on currently supported versions of Windows is 5.1, which is suitable for our purposes, even though Microsoft no longer fully <span aria-label=" Page 4. " epub:type="pagebreak" id="pg_4" role="doc-pagebreak"></span>supports it. More recent versions of PowerShell are cross platform and open source but must be installed separately on Windows.</p>
<p class="TX">All the code presented in this book will run in both PowerShell 5.1 and the latest open source version, so it doesn’t matter which you choose. If you want to use the open source PowerShell, visit the project’s GitHub page at <i><a href="https://github.com/PowerShell/PowerShell">https://<wbr/>github<wbr/>.com<wbr/>/PowerShell<wbr/>/PowerShell</a></i> to find installation instructions for your version of Windows.</p>
</section>
<section aria-labelledby="sec2" epub:type="division">
<h3 class="H1" id="sec2"><span id="h1-7"></span><samp class="SANS_Futura_Std_Bold_B_11">Configuring PowerShell</samp></h3>
<p class="TNI1">The first thing we need to do in PowerShell is set the <i>script execution policy</i>, which determines what types of scripts PowerShell can execute. For Windows clients running PowerShell 5.1, the default is <samp class="SANS_TheSansMonoCd_W5Regular_11">Restricted</samp>, which blocks all scripts from running unless they are signed with a trusted certificate. As the scripts in this book are unsigned, we’ll change the execution policy to <samp class="SANS_TheSansMonoCd_W5Regular_11">RemoteSigned</samp>. This execution policy allows us to run unsigned PowerShell scripts if they’re created locally but will not allow us to execute unsigned scripts downloaded in a web browser or attached to emails. Run the following command to set the execution policy:</p>
<pre><code>PS&gt; <b>Set-ExecutionPolicy -Scope CurrentUser -ExecutionPolicy RemoteSigned -Force</b>
</code></pre>
<p class="TX">The command changes the execution policy for the current user only, not the entire system. If you want to change it for all users, you’ll need to start PowerShell as an administrator and then rerun the command, removing the <samp class="SANS_TheSansMonoCd_W5Regular_11">Scope</samp> parameter.</p>
<p class="TX">If you’re using the open source version of PowerShell or version 5.1 on Windows Server, then the default script execution policy is <samp class="SANS_TheSansMonoCd_W5Regular_11">RemoteSigned</samp> and you do not need to change anything.</p>
<p class="TX">Now that we can run unsigned scripts, we can install the PowerShell module we’ll be using for this book. A PowerShell <i>module</i> is a package of scripts and .NET binaries that export PowerShell commands. Every installation of PowerShell comes preinstalled with several modules for tasks ranging from configuring your applications to setting up Windows Update. You can install a module manually by copying its files, but the easiest approach is to use the PowerShell Gallery (<i><a href="https://www.powershellgallery.com">https://<wbr/>www<wbr/>.powershellgallery<wbr/>.com</a></i>), an online repository of modules.</p>
<p class="TX">To install a module from the PowerShell Gallery, we use PowerShell’s <samp class="SANS_TheSansMonoCd_W5Regular_11">Install-Module</samp> command. For this book, we’ll need to install the <samp class="SANS_TheSansMonoCd_W5Regular_11">NtObjectManager</samp> module, which we can do using the following command:</p>
<pre><code>PS&gt; <b>Install-Module NtObjectManager -Scope CurrentUser -Force</b>
</code></pre>
<p class="TX">Make sure to say yes if the installer asks you any questions (after you’ve read and understood the question, of course). If you have the module installed already, you can ensure that you have the latest version by using the <samp class="SANS_TheSansMonoCd_W5Regular_11">Update-Module</samp> command:</p>
<pre><code><span aria-label=" Page 5. " epub:type="pagebreak" id="pg_5" role="doc-pagebreak"></span>PS&gt; <b>Update-Module NtObjectManager</b></code></pre>
<p class="TX">Once it’s installed, you can load the module using the <samp class="SANS_TheSansMonoCd_W5Regular_11">Import-Module</samp> command:</p>
<pre><code>PS&gt; <b>Import-Module NtObjectManager</b>
</code></pre>
<p class="TX">If you see any errors after importing the module, double-check that you’ve correctly set the execution policy; that’s the most common reason for the module not loading correctly. As a final test, let’s run a command that comes with the module to check that it’s working. Execute the command in <a href="chapter1.xhtml#Lis1-1">Listing 1-1</a> and verify that the output matches what you see in the PowerShell console. We’ll explore the purpose of this command in a later chapter.</p>
<span id="Lis1-1"></span><pre><code>PS&gt; <b>New-NtSecurityDescriptor</b>
Owner DACL ACE Count SACL ACE Count Integrity Level
----- -------------- -------------- ---------------
NONE  NONE           NONE           NONE
</code></pre>
<p class="ListingCaption"><span class="Futura_Std_Book_Oblique_I_11">Listing 1-1: Testing that the NtObjectManager module is working</span></p>
<p class="TX">If everything is working and you’re comfortable with PowerShell, you can move on to the next chapter. If you need a quick refresher on the PowerShell language, keep reading.</p>
</section>
<section aria-labelledby="sec3" epub:type="division">
<h3 class="H1" id="sec3"><span id="h1-8"></span><samp class="SANS_Futura_Std_Bold_B_11">An Overview of the PowerShell Language</samp></h3>
<p class="TNI1">A complete introduction to PowerShell is beyond the scope of this book. However, this section touches on various language features you’ll need to be familiar with to use the book most effectively.</p>
<section aria-labelledby="sec4" epub:type="division">
<h4 class="H2" id="sec4"><span id="h2-1"></span><samp class="SANS_Futura_Std_Bold_Condensed_Oblique_BI_11">Understanding Types, Variables, and Expressions</samp></h4>
<p class="TNI1">PowerShell supports many different types, from basic integers and strings to complex objects. <a href="chapter1.xhtml#tab1-1">Table 1-1</a> shows some of the most common built-in types, along with the underlying .NET runtime types and some simple examples.</p>
<table class="Basic-Table">
<caption><p class="TT" id="tab1-1"><span class="Heavy"><samp class="SANS_Futura_Std_Heavy_B_11">Table 1-1:</samp></span> <samp class="SANS_Futura_Std_Book_11">Common Basic PowerShell Types with .NET Types and Examples</samp></p></caption>
<thead>
<tr>
<th class="Basic-Table TCH" scope="col"><p class="TableHeader"><samp class="SANS_Futura_Std_Heavy_B_11">Type</samp></p></th>
<th class="Basic-Table TCH" scope="col"><p class="TableHeader"><samp class="SANS_Futura_Std_Heavy_B_11">.NET type</samp></p></th>
<th class="Basic-Table TCH" scope="col"><p class="TableHeader"><samp class="SANS_Futura_Std_Heavy_B_11">Examples</samp></p></th>
</tr>
</thead>
<tbody>
<tr>
<td class="Basic-Table TBF"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">int</samp></p></td>
<td class="Basic-Table TBF"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">System.Int32</samp></p></td>
<td class="Basic-Table TBF"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">142</samp><samp class="SANS_Futura_Std_Book_11">,</samp> <samp class="SANS_TheSansMonoCd_W5Regular_11">0x8E</samp><samp class="SANS_Futura_Std_Book_11">,</samp> <samp class="SANS_TheSansMonoCd_W5Regular_11">0216</samp></p></td>
</tr>
<tr>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">long</samp></p></td>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">System.Int64</samp></p></td>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">142L</samp><samp class="SANS_Futura_Std_Book_11">,</samp> <samp class="SANS_TheSansMonoCd_W5Regular_11">0x8EL</samp><samp class="SANS_Futura_Std_Book_11">,</samp> <samp class="SANS_TheSansMonoCd_W5Regular_11">0216L</samp></p></td>
</tr>
<tr>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">string</samp></p></td>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">System.String</samp></p></td>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">"Hello"</samp><samp class="SANS_Futura_Std_Book_11">,</samp> <samp class="SANS_TheSansMonoCd_W5Regular_11">'World!'</samp></p></td>
</tr>
<tr>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">double</samp></p></td>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">System.Double</samp></p></td>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">1.0</samp><samp class="SANS_Futura_Std_Book_11">,</samp> <samp class="SANS_TheSansMonoCd_W5Regular_11">1e10</samp></p></td>
</tr>
<tr>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">bool</samp></p></td>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">System.Boolean</samp></p></td>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">$true</samp><samp class="SANS_Futura_Std_Book_11">,</samp> <samp class="SANS_TheSansMonoCd_W5Regular_11">$false</samp></p></td>
</tr>
<tr>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">array</samp></p></td>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">System.Object[]</samp></p></td>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">@(1, "ABC", $true)</samp></p></td>
</tr>
<tr>
<td class="Basic-Table TBL"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">hashtable</samp></p></td>
<td class="Basic-Table TBL"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">System.Collections.Hashtable</samp></p></td>
<td class="Basic-Table TBL"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">@{A=1; B="ABC"}</samp></p></td>
</tr>
</tbody>
</table>
<p class="TX"><span aria-label=" Page 6. " epub:type="pagebreak" id="pg_6" role="doc-pagebreak"></span>To perform calculations on basic types, we can use well-known operators such as <samp class="SANS_TheSansMonoCd_W5Regular_11">+</samp>, <samp class="SANS_TheSansMonoCd_W5Regular_11">−</samp>, <samp class="SANS_TheSansMonoCd_W5Regular_11">*</samp>, and <samp class="SANS_TheSansMonoCd_W5Regular_11">/</samp>. These operators can be overloaded; for example, <samp class="SANS_TheSansMonoCd_W5Regular_11">+</samp> is used for addition as well as for concatenating strings and arrays. <a href="chapter1.xhtml#tab1-2">Table 1-2</a> provides a list of common operators, with simple examples and their results. You can test the examples yourself to check the output of each operator.</p>
<table class="Basic-Table">
<caption><p class="TT" id="tab1-2"><span class="Heavy"><samp class="SANS_Futura_Std_Heavy_B_11">Table 1-2:</samp></span> <samp class="SANS_Futura_Std_Book_11">Common Operators</samp></p></caption>
<thead>
<tr>
<th class="Basic-Table TCH" scope="col"><p class="TableHeader"><samp class="SANS_Futura_Std_Heavy_B_11">Operator</samp></p></th>
<th class="Basic-Table TCH" scope="col"><p class="TableHeader"><samp class="SANS_Futura_Std_Heavy_B_11">Name</samp></p></th>
<th class="Basic-Table TCH" scope="col"><p class="TableHeader"><samp class="SANS_Futura_Std_Heavy_B_11">Examples</samp></p></th>
<th class="Basic-Table TCH" scope="col"><p class="TableHeader"><samp class="SANS_Futura_Std_Heavy_B_11">Results</samp></p></th>
</tr>
</thead>
<tbody>
<tr>
<td class="Basic-Table TBF"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">+</samp></p></td>
<td class="Basic-Table TBF"><p class="TableBody"><samp class="SANS_Futura_Std_Book_11">Addition or concatenation</samp></p></td>
<td class="Basic-Table TBF"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">1</samp> <samp class="SANS_TheSansMonoCd_W5Regular_11">+</samp> <samp class="SANS_TheSansMonoCd_W5Regular_11">2</samp><samp class="SANS_Futura_Std_Book_11">,</samp> <samp class="SANS_TheSansMonoCd_W5Regular_11">"Hello"</samp> <samp class="SANS_TheSansMonoCd_W5Regular_11">+</samp> <samp class="SANS_TheSansMonoCd_W5Regular_11">"World!"</samp></p></td>
<td class="Basic-Table TBF"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">3</samp><samp class="SANS_Futura_Std_Book_11">,</samp> <samp class="SANS_TheSansMonoCd_W5Regular_11">"HelloWorld!"</samp></p></td>
</tr>
<tr>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">−</samp></p></td>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_Futura_Std_Book_11">Subtraction</samp></p></td>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">2 − 1</samp></p></td>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">1</samp></p></td>
</tr>
<tr>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">*</samp></p></td>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_Futura_Std_Book_11">Multiplication</samp></p></td>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">2 * 4</samp></p></td>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">8</samp></p></td>
</tr>
<tr>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">/</samp></p></td>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_Futura_Std_Book_11">Division</samp></p></td>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">8 / 4</samp></p></td>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">2</samp></p></td>
</tr>
<tr>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">%</samp></p></td>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_Futura_Std_Book_11">Modulus</samp></p></td>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">6 % 4</samp></p></td>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">2</samp></p></td>
</tr>
<tr>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">[]</samp></p></td>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_Futura_Std_Book_11">Index</samp></p></td>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">@(3, 2, 1, 0)[1]</samp></p></td>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">2</samp></p></td>
</tr>
<tr>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">-f</samp></p></td>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_Futura_Std_Book_11">String formatter</samp></p></td>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">"0x{0:X} {1}" -f 42, 123</samp></p></td>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">"0x2A 123"</samp></p></td>
</tr>
<tr>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">-band</samp></p></td>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_Futura_Std_Book_11">Bitwise AND</samp></p></td>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">0x1FF -band 0xFF</samp></p></td>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">255</samp></p></td>
</tr>
<tr>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">-bor</samp></p></td>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_Futura_Std_Book_11">Bitwise OR</samp></p></td>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">0x100 -bor 0x20</samp></p></td>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">288</samp></p></td>
</tr>
<tr>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">-bxor</samp></p></td>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_Futura_Std_Book_11">Bitwise XOR</samp></p></td>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">0xCC -bxor 0xDD</samp></p></td>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">17</samp></p></td>
</tr>
<tr>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">-bnot</samp></p></td>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_Futura_Std_Book_11">Bitwise NOT</samp></p></td>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">-bnot 0xEE</samp></p></td>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">-239</samp></p></td>
</tr>
<tr>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">-and</samp></p></td>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_Futura_Std_Book_11">Boolean AND</samp></p></td>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">$true -and $false</samp></p></td>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">$false</samp></p></td>
</tr>
<tr>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">-or</samp></p></td>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_Futura_Std_Book_11">Boolean OR</samp></p></td>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">$true -or $false</samp></p></td>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">$true</samp></p></td>
</tr>
<tr>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">-not</samp></p></td>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_Futura_Std_Book_11">Boolean NOT</samp></p></td>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">-not $true</samp></p></td>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">$false</samp></p></td>
</tr>
<tr>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">-eq</samp></p></td>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_Futura_Std_Book_11">Equals</samp></p></td>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">"Hello" -eq "Hello"</samp></p></td>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">$true</samp></p></td>
</tr>
<tr>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">-ne</samp></p></td>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_Futura_Std_Book_11">Not equals</samp></p></td>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">"Hello" -ne "Hello"</samp></p></td>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">$false</samp></p></td>
</tr>
<tr>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">-lt</samp></p></td>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_Futura_Std_Book_11">Less than</samp></p></td>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">4 -lt 10</samp></p></td>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">$true</samp></p></td>
</tr>
<tr>
<td class="Basic-Table TBL"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">-gt</samp></p></td>
<td class="Basic-Table TBL"><p class="TableBody"><samp class="SANS_Futura_Std_Book_11">Greater than</samp></p></td>
<td class="Basic-Table TBL"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">4 -gt 10</samp></p></td>
<td class="Basic-Table TBL"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">$false</samp></p></td>
</tr>
</tbody>
</table>
<p class="TX">You can assign values to variables using the assignment operator, <samp class="SANS_TheSansMonoCd_W5Regular_11">=</samp>. A variable has an alphanumeric name prefixed with the <samp class="SANS_TheSansMonoCd_W5Regular_11">$</samp> character. For example, <a href="chapter1.xhtml#Lis1-2">Listing 1-2</a> shows how you can capture an array in a variable and use the indexing operator to look up a value.</p>
<span id="Lis1-2"></span><pre><code>PS&gt; <b>$var = 3, 2, 1, 0</b>
PS&gt; <b>$var[1]</b>
2
</code></pre>
<p class="ListingCaption"><span class="Futura_Std_Book_Oblique_I_11">Listing 1-2: Capturing an array in a variable and indexing it via the variable name</span></p>
<p class="TX">There are also some predefined variables we’ll use in the rest of this book. These variables are:</p>
<p class="RunInPara1"><samp class="SANS_TheSansMonoCd_W7Bold_B_11">$null  </samp>Represents the NULL value, which indicates the absence of a value in comparisons</p>
<p class="RunInPara"><samp class="SANS_TheSansMonoCd_W7Bold_B_11">$pwd  </samp>Contains the current working directory</p>
<p class="RunInPara"><span aria-label=" Page 7. " epub:type="pagebreak" id="pg_7" role="doc-pagebreak"></span><samp class="SANS_TheSansMonoCd_W7Bold_B_11">$pid  </samp>Contains the process ID of the shell</p>
<p class="RunInPara2"><samp class="SANS_TheSansMonoCd_W7Bold_B_11">$env  </samp>Accesses the process environment (for example, <samp class="SANS_TheSansMonoCd_W5Regular_11">$env:WinDir</samp> to get the <i>Windows</i> directory)</p>
<p class="TX">You can enumerate all variables using the <samp class="SANS_TheSansMonoCd_W5Regular_11">Get-Variable</samp> command.</p>
<p class="TX">In <a href="chapter1.xhtml#tab1-1">Table 1-1</a>, you might have noticed that there were two string examples, one using double quotation marks and one using single quotation marks. One difference between the two is that a double-quoted string supports <i>string interpolation</i>, where you insert a variable name into the string as a placeholder and PowerShell includes its value in the result. <a href="chapter1.xhtml#Lis1-3">Listing 1-3</a> shows what happens when you do this in double- and single-quoted strings.</p>
<span id="Lis1-3"></span><pre><code>PS&gt; <b>$var = 42</b>
PS&gt; <b>"The magic number is $var"</b>
The magic number is 42

PS&gt; <b>'It is not $var'</b>
It is not $var
</code></pre>
<p class="ListingCaption"><span class="Futura_Std_Book_Oblique_I_11">Listing 1-3: Examples of string interpolation</span></p>
<p class="TX">First, we define a variable with the value <samp class="SANS_TheSansMonoCd_W5Regular_11">42</samp> to insert into a string. Then we create a double-quoted string with the variable name inside it. The result is the string with the variable name replaced by its value formatted as a string. (If you want more control over the formatting, you can use the string formatter operator defined in <a href="chapter1.xhtml#tab1-2">Table 1-2</a>.)</p>
<p class="TX">Next, to demonstrate the different behavior of a single-quoted string, we define one of these with the variable name inline. We can observe that in this case the variable name is copied verbatim and is not replaced by the value.</p>
<p class="TX">Another difference is that a double-quoted string can contain character escapes that are ignored in single-quoted strings. These escapes use a similar syntax to those of the C programming language, but instead of a backslash character (\) PowerShell uses the backtick (`). This is because Windows uses the backslash as a path separator, and writing out filepaths would be very annoying if you had to escape every backslash. <a href="chapter1.xhtml#tab1-3">Table 1-3</a> gives a list of character escapes you can use in PowerShell.</p>
<span aria-label=" Page 8. " epub:type="pagebreak" id="pg_8" role="doc-pagebreak"></span>
<table class="Basic-Table">
<caption><p class="TT" id="tab1-3"><span class="Heavy"><samp class="SANS_Futura_Std_Heavy_B_11">Table 1-3:</samp></span> <samp class="SANS_Futura_Std_Book_11">String Character Escapes</samp></p></caption>
<thead>
<tr>
<th class="Basic-Table TCH" scope="col"><p class="TableHeader"><samp class="SANS_Futura_Std_Heavy_B_11">Character escape</samp></p></th>
<th class="Basic-Table TCH" scope="col"><p class="TableHeader"><samp class="SANS_Futura_Std_Heavy_B_11">Name</samp></p></th>
</tr>
</thead>
<tbody>
<tr>
<td class="Basic-Table TBF"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">`0</samp></p></td>
<td class="Basic-Table TBF"><p class="TableBody"><samp class="SANS_Futura_Std_Book_11">NUL character, with a value of zero</samp></p></td>
</tr>
<tr>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">`a</samp></p></td>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_Futura_Std_Book_11">Bell</samp></p></td>
</tr>
<tr>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">`b</samp></p></td>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_Futura_Std_Book_11">Backspace</samp></p></td>
</tr>
<tr>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">`n</samp></p></td>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_Futura_Std_Book_11">Line feed</samp></p></td>
</tr>
<tr>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">`r</samp></p></td>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_Futura_Std_Book_11">Carriage return</samp></p></td>
</tr>
<tr>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">`t</samp></p></td>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_Futura_Std_Book_11">Horizontal tab</samp></p></td>
</tr>
<tr>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">`v</samp></p></td>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_Futura_Std_Book_11">Vertical tab</samp></p></td>
</tr>
<tr>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">``</samp></p></td>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_Futura_Std_Book_11">Backtick character</samp></p></td>
</tr>
<tr>
<td class="Basic-Table TBL"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">`"</samp></p></td>
<td class="Basic-Table TBL"><p class="TableBody"><samp class="SANS_Futura_Std_Book_11">Double quote character</samp></p></td>
</tr>
</tbody>
</table>
<p class="TX">If you want to insert a double quote character into a double-quoted string, you’ll need to use the <samp class="SANS_TheSansMonoCd_W5Regular_11">`"</samp> escape. To insert a single quote into a single- quoted string, you double the quote character: for example, <samp class="SANS_TheSansMonoCd_W5Regular_11">'Hello''There'</samp> would convert to <samp class="SANS_TheSansMonoCd_W5Regular_11">Hello'There</samp>. Note also the mention of a NUL character in this table. As PowerShell uses the .NET string type, it can contain embedded NUL characters. Unlike in the C language, adding a NUL will not terminate the string prematurely.</p>
<p class="TX">Because all values are .NET types, we can invoke methods and access properties on an object. For example, the following calls the <samp class="SANS_TheSansMonoCd_W5Regular_11">ToCharArray</samp> method on a string to convert it to an array of single characters:</p>
<pre><code>PS&gt; <b>"Hello".ToCharArray()</b>
H
e
l
l
o
</code></pre>
<p class="TX">We can use PowerShell to construct almost any .NET type. The simplest way to do this is to cast a value to that type by specifying the .NET type in square brackets. When casting, PowerShell will try to find a suitable constructor for the type to invoke. For example, the following command will convert a string to a <samp class="SANS_TheSansMonoCd_W5Regular_11">System.Guid</samp> object; PowerShell will find a constructor that accepts a string and call it:</p>
<pre><code>PS&gt; <b>[System.Guid]"6c0a3a17-4459-4339-a3b6-1cdb1b3e8973"</b>
</code></pre>
<p class="TX">You can also call a constructor explicitly by calling the <samp class="SANS_TheSansMonoCd_W5Regular_11">new</samp> method on the type. The previous example can be rewritten as follows:</p>
<pre><code>PS&gt; <b>[System.Guid]::new("6c0a3a17-4459-4339-a3b6-1cdb1b3e8973")</b>
</code></pre>
<p class="TX">This syntax can also be used to invoke static methods on the type. For example, the following calls the <samp class="SANS_TheSansMonoCd_W5Regular_11">NewGuid</samp> static method to create a new random globally unique identifier (GUID):</p>
<pre><code>PS&gt; <b>[System.Guid]::NewGuid()</b>
</code></pre>
<p class="TX">You can create new objects too, using the <samp class="SANS_TheSansMonoCd_W5Regular_11">New-Object</samp> command:</p>
<pre><code>PS&gt; <b>New-Object -TypeName Guid -ArgumentList "6c0a3a17-4459-4339-a3b6-1cdb1b3e8973"</b>
</code></pre>
<p class="TX">This example is equivalent to the call to the static <samp class="SANS_TheSansMonoCd_W5Regular_11">new</samp> function.</p>
</section>
<section aria-labelledby="sec5" epub:type="division">
<h4 class="H2" id="sec5"><span id="h2-2"></span><span aria-label=" Page 9. " epub:type="pagebreak" id="pg_9" role="doc-pagebreak"></span><samp class="SANS_Futura_Std_Bold_Condensed_Oblique_BI_11">Executing Commands</samp></h4>
<p class="TNI1">Almost all commands in PowerShell are named using a common pattern: a verb and a noun, separated by a dash. For example, consider the command <samp class="SANS_TheSansMonoCd_W5Regular_11">Get-Item</samp>. The <samp class="SANS_TheSansMonoCd_W5Regular_11">Get</samp> verb implies retrieving an existing resource, while <samp class="SANS_TheSansMonoCd_W5Regular_11">Item</samp> is the type of resource to return.</p>
<p class="TX">Each command can accept a list of parameters that controls the behavior of the command. For example, the <samp class="SANS_TheSansMonoCd_W5Regular_11">Get-Item</samp> command accepts a <samp class="SANS_TheSansMonoCd_W5Regular_11">Path</samp> parameter that indicates the existing resource to retrieve, as shown here:</p>
<pre><code>PS&gt; <b>Get-Item -Path "C:\Windows"</b>
</code></pre>
<p class="TX">The <samp class="SANS_TheSansMonoCd_W5Regular_11">Path</samp> parameter is a <i>positional</i> parameter. This means that you can omit the name of the parameter, and PowerShell will do its best to select the best match. So, the previous command can also be written as the following:</p>
<pre><code>PS&gt; <b>Get-Item "C:\Windows"</b>
</code></pre>
<p class="TX">If a parameter takes a string value, and the string does not contain any special characters or whitespace, then you do not need to use quotes around the string. For example, the <samp class="SANS_TheSansMonoCd_W5Regular_11">Get-Item</samp> command would also work with the following:</p>
<pre><code>PS&gt; <b>Get-Item C:\Windows</b>
</code></pre>
<p class="TX">The output of a single command is zero or more values, which can be basic or complex object types. You can pass the output of one command to another as input using a <i>pipeline</i>, which is represented by a vertical bar character, <samp class="SANS_TheSansMonoCd_W5Regular_11">|</samp>. We’ll see examples of using a pipeline when we discuss filtering, grouping, and sorting later in this chapter.</p>
<p class="TX">You can capture the result of an entire command or pipeline into a variable, then interact with the results. For example, the following captures the result of the <samp class="SANS_TheSansMonoCd_W5Regular_11">Get-Item</samp> command and queries for the <samp class="SANS_TheSansMonoCd_W5Regular_11">FullName</samp> property:</p>
<pre><code>PS&gt; <b>$var = Get-Item -Path "C:\Windows"</b>
PS&gt; <b>$var.FullName</b>
C:\Windows
</code></pre>
<p class="TX">If you don’t want to capture the result in a variable, you can enclose the command in parentheses and directly access its properties and methods:</p>
<pre><code>PS&gt; <b>(Get-Item -Path "C:\Windows").FullName</b>
C:\Windows
</code></pre>
<p class="TX">The length of a command line is effectively infinite. However, you’ll want to try to split up long lines to make the commands more readable. The shell will automatically split a line on the pipe character. If you need to split a long line with no pipes, you can use the backtick character, then start a <span aria-label=" Page 10. " epub:type="pagebreak" id="pg_10" role="doc-pagebreak"></span>new line. The backtick must be the last character on the line; otherwise, an error will occur when the script is parsed.</p>
</section>
<section aria-labelledby="sec6" epub:type="division">
<h4 class="H2" id="sec6"><span id="h2-3"></span><samp class="SANS_Futura_Std_Bold_Condensed_Oblique_BI_11">Discovering Commands and Getting Help</samp></h4>
<p class="TNI1">A default installation of PowerShell has hundreds of commands to choose from. This means that finding a command to perform a specific task can be difficult, and even if you find the command, it might not be clear how to use it. To help, you can use two built-in commands, <samp class="SANS_TheSansMonoCd_W5Regular_11">Get-Command</samp> and <samp class="SANS_TheSansMonoCd_W5Regular_11">Get-Help</samp>.</p>
<p class="TX">The <samp class="SANS_TheSansMonoCd_W5Regular_11">Get-Command</samp> command can be used to enumerate all the commands available to you. In its simplest form, you can execute it without any parameters and it will print all commands from all modules. However, it’s probably more useful to filter on a specific word you’re interested in. For example, <a href="chapter1.xhtml#Lis1-4">Listing 1-4</a> will list only the commands with the word <samp class="SANS_TheSansMonoCd_W5Regular_11">SecurityDescriptor</samp> in their names.</p>
<span id="Lis1-4"></span><pre><code>PS&gt; <b>Get-Command -Name *SecurityDescriptor*</b>
CommandType     Name                              Source
-----------     ----                              ------
Function        Add-NtSecurityDescriptorControl   NtObjectManager
Function        Add-NtSecurityDescriptorDaclAce   NtObjectManager
Function        Clear-NtSecurityDescriptorDacl    NtObjectManager
Function        Clear-NtSecurityDescriptorSacl    NtObjectManager
<var>--snip--</var>
</code></pre>
<p class="ListingCaption"><span class="Futura_Std_Book_Oblique_I_11">Listing 1-4: Using Get-Command to enumerate commands</span></p>
<p class="TX">This command uses <i>wildcard syntax</i> to list only commands whose names include the specified word. Wildcard syntax uses a <samp class="SANS_TheSansMonoCd_W5Regular_11">*</samp> character to represent any character or series of characters. Here, we’ve put the <samp class="SANS_TheSansMonoCd_W5Regular_11">*</samp> on both sides of <samp class="SANS_TheSansMonoCd_W5Regular_11">SecurityDescriptor</samp> to indicate that any text can come before or after it.</p>
<p class="TX">You can also list the commands available in a module. For example, <a href="chapter1.xhtml#Lis1-5">Listing 1-5</a> will list only the commands that are exported by the <samp class="SANS_TheSansMonoCd_W5Regular_11">NtObjectManager</samp> module and begin with the verb <samp class="SANS_TheSansMonoCd_W5Regular_11">Start</samp>.</p>
<span id="Lis1-5"></span><pre><code>PS&gt; <b>Get-Command -Module NtObjectManager -Name Start-*</b>
CommandType     Name                             Source
-----------     ----                             ------
Function        Start-AccessibleScheduledTask    NtObjectManager
Function        Start-NtFileOplock               NtObjectManager
Function        Start-Win32ChildProcess          NtObjectManager
Cmdlet          Start-NtDebugWait                NtObjectManager
Cmdlet          Start-NtWait                     NtObjectManager
</code></pre>
<p class="ListingCaption"><span class="Futura_Std_Book_Oblique_I_11">Listing 1-5: Using Get-Command to enumerate commands in the NtObjectManager module</span></p>
<p class="TX">Once you’ve found a command that looks promising, you can use the <samp class="SANS_TheSansMonoCd_W5Regular_11">Get-Help</samp> command to inspect its parameters and get some usage examples. In <a href="chapter1.xhtml#Lis1-6">Listing 1-6</a>, we take the <samp class="SANS_TheSansMonoCd_W5Regular_11">Start-NtWait</samp> command from <a href="chapter1.xhtml#Lis1-5">Listing 1-5</a> and pass it to <samp class="SANS_TheSansMonoCd_W5Regular_11">Get-Help</samp>.</p>
<span id="Lis1-6"></span><pre><code><span aria-label=" Page 11. " epub:type="pagebreak" id="pg_11" role="doc-pagebreak"></span>PS&gt; <b>Get-Help Start-NtWait</b>
NAME
  <span aria-label="annotation1" class="CodeAnnotationCode2">❶</span> Start-NtWait
SYNOPSIS
  <span aria-label="annotation2" class="CodeAnnotationCode2">❷</span> Wait on one or more NT objects to become signaled.
SYNTAX
  <span aria-label="annotation3" class="CodeAnnotationCode2">❸</span> Start-NtWait [-Object] &lt;NtObject[]&gt; [-Alertable &lt;SwitchParameter&gt;]
    [-Hour &lt;int&gt;] [-MilliSecond &lt;long&gt;]
    [-Minute &lt;int&gt;] [-Second &lt;int&gt;] [-WaitAll &lt;SwitchParameter&gt;]
    [&lt;CommonParameters&gt;]

    Start-NtWait [-Object] &lt;NtObject[]&gt; [-Alertable &lt;SwitchParameter&gt;]
    [-Infinite &lt;SwitchParameter&gt;] [-WaitAll &lt;SwitchParameter&gt;]
    [&lt;CommonParameters&gt;]
DESCRIPTION
  <span aria-label="annotation4" class="CodeAnnotationCode2">❹</span> This cmdlet allows you to issue a wait on one or more NT
    objects until they become signaled.
<var>--snip--</var>
</code></pre>
<p class="ListingCaption"><span class="Futura_Std_Book_Oblique_I_11">Listing 1-6: Displaying help for the Start-NtWait command</span></p>
<p class="TX">By default, <samp class="SANS_TheSansMonoCd_W5Regular_11">Get-Help</samp> outputs the name of the command <span aria-label="annotation1" class="CodeAnnotationCode">❶</span>, a short synopsis <span aria-label="annotation2" class="CodeAnnotationCode">❷</span>, the syntax of the command <span aria-label="annotation3" class="CodeAnnotationCode">❸</span>, and a more in-depth description <span aria-label="annotation4" class="CodeAnnotationCode">❹</span>. In the command syntax section, you can see its multiple possible modes of operation: in this case, either specifying a time in hours, minutes, seconds, and/or milliseconds, or specifying <samp class="SANS_TheSansMonoCd_W5Regular_11">Infinite</samp> to wait indefinitely.</p>
<p class="TX">When any part of the syntax is shown in brackets, <samp class="SANS_TheSansMonoCd_W5Regular_11">[]</samp>, that means it’s optional. For example, the only required parameter is <samp class="SANS_TheSansMonoCd_W5Regular_11">Object</samp>, which takes an array of <samp class="SANS_TheSansMonoCd_W5Regular_11">NtObject</samp> values. Even the name of this parameter is optional, as <samp class="SANS_TheSansMonoCd_W5Regular_11">-Object</samp> is in brackets.</p>
<p class="TX">You can get more information about a parameter by using the <samp class="SANS_TheSansMonoCd_W5Regular_11">Parameter</samp> command. <a href="chapter1.xhtml#Lis1-7">Listing 1-7</a> shows the details for the <samp class="SANS_TheSansMonoCd_W5Regular_11">Object</samp> parameter.</p>
<span id="Lis1-7"></span><pre><code>PS&gt; <b>Get-Help Start-NtWait -Parameter Object</b>
-Object &lt;NtObject[]&gt;
    Specify a list of objects to wait on.

    Required?                    true
    Position?                    0
    Default value
    Accept pipeline input?       true (ByValue)
    Accept wildcard characters?  False
</code></pre>
<p class="ListingCaption"><span class="Futura_Std_Book_Oblique_I_11">Listing 1-7: Querying the details of the Object parameter with the Parameter command</span></p>
<p class="TX">You can use wildcard syntax to select a group of similar parameter names. For example, if you specify <samp class="SANS_TheSansMonoCd_W5Regular_11">Obj*</samp>, then you’ll get information about any parameters whose names start with the <samp class="SANS_TheSansMonoCd_W5Regular_11">Obj</samp> prefix.</p>
<p class="TX">If you want usage examples for a command, use the <samp class="SANS_TheSansMonoCd_W5Regular_11">Examples</samp> parameter, as demonstrated in <a href="chapter1.xhtml#Lis1-8">Listing 1-8</a>.</p>
<span id="Lis1-8"></span><pre><code><span aria-label=" Page 12. " epub:type="pagebreak" id="pg_12" role="doc-pagebreak"></span>PS&gt; <b>Get-Help Start-NtWait -Examples</b>
<var>--snip--</var>
    ----------  EXAMPLE 1  ----------
 <span aria-label="annotation1" class="CodeAnnotationCode">❶</span> $ev = Get-NtEvent \BaseNamedObjects\ABC
    Start-NtWait $ev -Second 10

 <span aria-label="annotation2" class="CodeAnnotationCode">❷</span> Get an event and wait for 10 seconds for it to be signaled.
<var>--snip--</var>
</code></pre>
<p class="ListingCaption"><span class="Futura_Std_Book_Oblique_I_11">Listing 1-8: Showing examples for Start-NtWait</span></p>
<p class="TX">Each example should include a one- or two-line snippet of a PowerShell script <span aria-label="annotation1" class="CodeAnnotationCode">❶</span> and a description of what it does <span aria-label="annotation2" class="CodeAnnotationCode">❷</span>. You can also see the full help output for the command by specifying the <samp class="SANS_TheSansMonoCd_W5Regular_11">Full</samp> parameter. To view this output in a separate pop-up window, use the <samp class="SANS_TheSansMonoCd_W5Regular_11">ShowWindow</samp> parameter. For example, try running this command:</p>
<pre><code>PS&gt; <b>Get-Help Start-NtWait -ShowWindow</b>
</code></pre>
<p class="TX">You should see the dialog shown in <a href="chapter1.xhtml#fig1-1">Figure 1-1</a>.</p>
<figure class="IMG"><img alt="" class="img1" height="873" id="fig1-1" src="../images/Figure1-1.jpg" width="1388"/>
<figcaption><p class="CAP"><samp class="SANS_Futura_Std_Book_Oblique_I_11">Figure 1-1: A dialog showing Get-Help information using the ShowWindow parameter</samp></p></figcaption>
</figure>
<p class="TX">One final topic to mention about commands is that you can set up <i>aliases</i>, or alternative names for the commands. For example, you can use an alias to make commands shorter to type. PowerShell comes with many aliases predefined, and you can define your own using the <samp class="SANS_TheSansMonoCd_W5Regular_11">New-Alias</samp> command. For example, we can set the <samp class="SANS_TheSansMonoCd_W5Regular_11">Start-NtWait</samp> command to have the alias <samp class="SANS_TheSansMonoCd_W5Regular_11">swt</samp> by doing the following:</p>
<pre><code>PS&gt; <b>New-Alias -Name swt -Value Start-NtWait</b>
</code></pre>
<p class="TX"><span aria-label=" Page 13. " epub:type="pagebreak" id="pg_13" role="doc-pagebreak"></span>To display a list of all the defined aliases, use the <samp class="SANS_TheSansMonoCd_W5Regular_11">Get-Alias</samp> command. We’ll avoid using aliases unnecessarily throughout this book, as it can make the scripts more confusing if you don’t know what an alias represents.</p>
</section>
<section aria-labelledby="sec7" epub:type="division">
<h4 class="H2" id="sec7"><span id="h2-4"></span><samp class="SANS_Futura_Std_Bold_Condensed_Oblique_BI_11">Defining Functions</samp></h4>
<p class="TNI1">As with all programming languages, it pays to reduce complexity in PowerShell. One way of reducing complexity is to combine common code into a function. Once a function is defined, the PowerShell script can call the function rather than needing to repeat the same code in multiple places. The basic function syntax in PowerShell is simple; <a href="chapter1.xhtml#Lis1-9">Listing 1-9</a> shows an example.</p>
<span id="Lis1-9"></span><pre><code>PS&gt; <b>function Get-NameValue</b> <b>{</b>
    <b>param(</b>
        <b>[string]$Name = "",</b>
        <b>$Value</b>
    <b>)</b>
    <b>return "We've got $Name with value $Value"</b>
<b>}</b>

PS&gt; <b>Get-NameValue -Name "Hello" -Value "World"</b>
We've got Hello with value World

PS&gt; <b>Get-NameValue "Goodbye" 12345</b>
We've got Goodbye with value 12345
</code></pre>
<p class="ListingCaption"><span class="Futura_Std_Book_Oblique_I_11">Listing 1-9: Defining a simple PowerShell function called Get-NameValue</span></p>
<p class="TX">The syntax for defining a function starts with the keyword <samp class="SANS_TheSansMonoCd_W5Regular_11">function</samp> followed by the name of the function you want to define. While it’s not required to use the standard PowerShell command naming convention of a verb followed by a noun, it pays to do so, as it makes it clear to the user what your function does.</p>
<p class="TX">Next, you define the function’s named parameters. Like variables, parameters are defined using a name prefixed with <samp class="SANS_TheSansMonoCd_W5Regular_11">$</samp>, as you can see in <a href="chapter1.xhtml#Lis1-9">Listing 1-9</a>. You can specify a type in brackets, but this is optional; in this example, <samp class="SANS_TheSansMonoCd_W5Regular_11">$Name</samp> is a string, but the <samp class="SANS_TheSansMonoCd_W5Regular_11">$Value</samp> parameter can take any value from the caller. Specifying named parameters is not required. If no <samp class="SANS_TheSansMonoCd_W5Regular_11">param</samp> block is included, then any passed arguments are placed in the <samp class="SANS_TheSansMonoCd_W5Regular_11">$args</samp> array. The first parameter is located at <samp class="SANS_TheSansMonoCd_W5Regular_11">$args[0]</samp>, the second at <samp class="SANS_TheSansMonoCd_W5Regular_11">$args[1]</samp>, and so on.</p>
<p class="TX">The body of the <samp class="SANS_TheSansMonoCd_W5Regular_11">Get-NameValue</samp> function takes the parameters and builds a string using string interpolation. The function returns the string using the <samp class="SANS_TheSansMonoCd_W5Regular_11">return</samp> keyword, which also immediately finishes the function. You can omit the <samp class="SANS_TheSansMonoCd_W5Regular_11">return</samp> keyword in this case, as PowerShell will return any values uncaptured in variables.</p>
<p class="TX">After defining the function, we invoke it. You can specify the parameter names explicitly. However, if the call is unambiguous, then specifying the parameter names is not required. <a href="chapter1.xhtml#Lis1-9">Listing 1-9</a> shows both approaches.</p>
<p class="TX"><span aria-label=" Page 14. " epub:type="pagebreak" id="pg_14" role="doc-pagebreak"></span>If you want to run a small block of code without defining a function, you can create a script block. A <i>script block</i> is one or more statements enclosed in braces, <samp class="SANS_TheSansMonoCd_W5Regular_11">{}</samp>. This block can be assigned to a variable and executed when needed using the <samp class="SANS_TheSansMonoCd_W5Regular_11">Invoke-Command</samp> command or the <samp class="SANS_TheSansMonoCd_W5Regular_11">&amp;</samp> operator, as shown in <a href="chapter1.xhtml#Lis1-10">Listing 1-10</a>.</p>
<span id="Lis1-10"></span><pre><code>PS&gt; <b>$script = {Write-Output "Hello"}</b>
PS&gt; <b>&amp; $script</b>
Hello
</code></pre>
<p class="ListingCaption"><span class="Futura_Std_Book_Oblique_I_11">Listing 1-10: Creating a script block and executing it</span></p>
</section>
<section aria-labelledby="sec8" epub:type="division">
<h4 class="H2" id="sec8"><span id="h2-5"></span><samp class="SANS_Futura_Std_Bold_Condensed_Oblique_BI_11">Displaying and Manipulating Objects</samp></h4>
<p class="TNI1">If you execute a command and do not capture the results in a variable, the results are passed to the PowerShell console. The console will use a formatter to display the results, in either a table or a list (the format is chosen automatically depending on the types of objects contained in the results). It’s also possible to specify custom formatters. For example, if you use the built-in <samp class="SANS_TheSansMonoCd_W5Regular_11">Get-Process</samp> command to retrieve the list of running processes, PowerShell uses a custom formatter to display the entries as a table, as shown in <a href="chapter1.xhtml#Lis1-11">Listing 1-11</a>.</p>
<span id="Lis1-11"></span><pre><code>PS&gt; <b>Get-Process</b>
Handles  NPM(K)    PM(K)      WS(K)     CPU(s)     Id  SI ProcessName
-------  ------    -----      -----     ------     --  -- -----------
    476      27    25896      32044      <b> </b>2.97   3352   1 ApplicationFrameHost
    623      18    25096      18524    <b> </b>529.95  19424   0 audiodg
    170       8     6680       5296       0.08   5192   1 bash
    557      31    23888        332       0.59  10784   1 Calculator
<var>--snip--</var>
</code></pre>
<p class="ListingCaption"><span class="Futura_Std_Book_Oblique_I_11">Listing 1-11: Outputting the process list as a table</span></p>
<p class="TX">If you want to reduce the number of columns in the output, you can use the <samp class="SANS_TheSansMonoCd_W5Regular_11">Select-Object</samp> command to select only the properties you need. For example, <a href="chapter1.xhtml#Lis1-12">Listing 1-12</a> selects the <samp class="SANS_TheSansMonoCd_W5Regular_11">Id</samp> and <samp class="SANS_TheSansMonoCd_W5Regular_11">ProcessName</samp> properties.</p>
<span id="Lis1-12"></span><pre><code>PS&gt; <b>Get-Process | Select-Object Id, ProcessName</b>
   Id ProcessName
   -- -----------
 3352 ApplicationFrameHost
19424 audiodg
 5192 bash
10784 Calculator
<var>--snip--</var>
</code></pre>
<p class="ListingCaption"><span class="Futura_Std_Book_Oblique_I_11">Listing 1-12: Selecting only the Id and ProcessName properties</span></p>
<p class="TX"><span aria-label=" Page 15. " epub:type="pagebreak" id="pg_15" role="doc-pagebreak"></span>You can change the default behavior of the output by using the <samp class="SANS_TheSansMonoCd_W5Regular_11">Format-Table</samp> or <samp class="SANS_TheSansMonoCd_W5Regular_11">Format-List</samp> command, which will force table or list formatting, respectively. For example, <a href="chapter1.xhtml#Lis1-13">Listing 1-13</a> shows how to use the <samp class="SANS_TheSansMonoCd_W5Regular_11">Format-List</samp> command to change the output to a list.</p>
<span id="Lis1-13"></span><pre><code>PS&gt; <b>Get-Process | Format-List</b>
Id      : 3352
Handles : 476
CPU     : 2.96875
SI      : 1
Name    : ApplicationFrameHost
<var>--snip--</var>
</code></pre>
<p class="ListingCaption"><span class="Futura_Std_Book_Oblique_I_11">Listing 1-13: Using Format-List to show processes in a list view</span></p>
<p class="TX">To find the names of the available properties, you can use the <samp class="SANS_TheSansMonoCd_W5Regular_11">Get-Member</samp> command on one of the objects that <samp class="SANS_TheSansMonoCd_W5Regular_11">Get-Process</samp> returns. For example, <a href="chapter1.xhtml#Lis1-14">Listing 1-14</a> lists the properties of the <samp class="SANS_TheSansMonoCd_W5Regular_11">Process</samp> object.</p>
<span id="Lis1-14"></span><pre><code>PS&gt; <b>Get-Process | Get-Member -Type Property</b>
   TypeName: System.Diagnostics.Process
Name                MemberType Definition
----                ---------- ----------
BasePriority        Property   int BasePriority {get;}
Container           Property   System.ComponentModel.IContainer Container {get;}
EnableRaisingEvents Property   bool EnableRaisingEvents {get;set;}
ExitCode            Property   int ExitCode {get;}
ExitTime            Property   datetime ExitTime {get;}
<var>--snip--</var>
</code></pre>
<p class="ListingCaption"><span class="Futura_Std_Book_Oblique_I_11">Listing 1-14: Using the Get-Member command to list properties of the Process object</span></p>
<p class="TX">You might notice that there are other properties not included in the output. To display them, you need to override the custom formatting. The simplest way to access the hidden properties is to use <samp class="SANS_TheSansMonoCd_W5Regular_11">Select-Object</samp> to extract the values explicitly, or specify the properties to display to the <samp class="SANS_TheSansMonoCd_W5Regular_11">Format-Table</samp> or <samp class="SANS_TheSansMonoCd_W5Regular_11">Format-List</samp> command. You can use <samp class="SANS_TheSansMonoCd_W5Regular_11">*</samp> as a wildcard to show all properties, as in <a href="chapter1.xhtml#Lis1-15">Listing 1-15</a>.</p>
<span id="Lis1-15"></span><pre><code>PS&gt; <b>Get-Process | Format-List *</b>
Name            : ApplicationFrameHost
Id              : 3352
PriorityClass   : Normal
FileVersion     : 10.0.18362.1 (WinBuild.160101.0800)
HandleCount     : 476
WorkingSet      : 32968704
PagedMemorySize : 26517504
<var>--snip--</var>
</code></pre>
<p class="ListingCaption"><span class="Futura_Std_Book_Oblique_I_11">Listing 1-15: Showing all the properties of the Process object in a list</span></p>
<p class="TX"><span aria-label=" Page 16. " epub:type="pagebreak" id="pg_16" role="doc-pagebreak"></span>Many objects also have methods you can call to perform some action on the object. <a href="chapter1.xhtml#Lis1-16">Listing 1-16</a> shows how you can use <samp class="SANS_TheSansMonoCd_W5Regular_11">Get-Member</samp> to query for methods.</p>
<span id="Lis1-16"></span><pre><code>PS&gt; <b>Get-Process | Get-Member -Type Method</b>
   TypeName: System.Diagnostics.Process

Name                MemberType Definition
----                ---------- ----------
BeginErrorReadLine  Method     void BeginErrorReadLine()
BeginOutputReadLine Method     void BeginOutputReadLine()
CancelErrorRead     Method     void CancelErrorRead()
CancelOutputRead    Method     void CancelOutputRead()
Close               Method     void Close()
<var>--snip--</var>
</code></pre>
<p class="ListingCaption"><span class="Futura_Std_Book_Oblique_I_11">Listing 1-16: Displaying the methods on a Process object</span></p>
<p class="TX">If the output from a command is too long to fit on the screen, you can <i>page</i> the output so that only the first part is displayed, and the console will wait for you to press a key before displaying more. You can enable paging by piping the output to the <samp class="SANS_TheSansMonoCd_W5Regular_11">Out-Host</samp> command and specifying the <samp class="SANS_TheSansMonoCd_W5Regular_11">Paging</samp> parameter, or by using the <samp class="SANS_TheSansMonoCd_W5Regular_11">more</samp> command. <a href="chapter1.xhtml#Lis1-17">Listing 1-17</a> shows an example.</p>
<span id="Lis1-17"></span><pre><code>PS&gt; <b>Get-Process | Out-Host -Paging</b>
Handles  NPM(K)    PM(K)      WS(K)     CPU(s)     Id  SI ProcessName
-------  ------    -----      -----     ------     --  -- -----------
    476      27    25896      32044       2.97   3352   1 ApplicationFrameHost
    623      18    25096      18524     529.95  19424   0 audiodg
    170       8     6680       5296       0.08   5192   1 bash
    557      31    23888        332       0.59  10784   1 Calculator
&lt;SPACE&gt; next page; &lt;CR&gt; next line; Q quit
</code></pre>
<p class="ListingCaption"><span class="Futura_Std_Book_Oblique_I_11">Listing 1-17: Paging output using Out-Host</span></p>
<p class="TX">You can write directly to the console window by using the <samp class="SANS_TheSansMonoCd_W5Regular_11">Write-Host</samp> command in your own scripts. This allows you to change the colors of the output to suit your taste, using the <samp class="SANS_TheSansMonoCd_W5Regular_11">ForegroundColor</samp> and <samp class="SANS_TheSansMonoCd_W5Regular_11">BackgroundColor</samp> parameters. It also has the advantage of not inserting objects into the pipeline by default, as shown here:</p>
<pre><code>PS&gt; <b>$output = Write-Host "Hello"</b>
Hello
</code></pre>
<p class="TX">This means that, by default, you can’t redirect the output to a file or into a pipeline. However, you can redirect the host output by redirecting its stream to the standard output stream using a command like the following:</p>
<pre><code>PS&gt; <b>$output = Write-Host "Hello" 6&gt;&amp;1</b>
PS&gt; <b>$output</b>
Hello
</code></pre>
<p class="TX"><span aria-label=" Page 17. " epub:type="pagebreak" id="pg_17" role="doc-pagebreak"></span>PowerShell also supports a basic GUI to display tables of objects. To access it, use the <samp class="SANS_TheSansMonoCd_W5Regular_11">Out-GridView</samp> command. Note that the custom formatting will still restrict what columns PowerShell displays. If you want to view other columns, use <samp class="SANS_TheSansMonoCd_W5Regular_11">Select-Object</samp> in the pipeline to select the properties. The following example displays all properties in the Grid View GUI:</p>
<pre><code>PS&gt; <b>Get-Process | Select-Object * | Out-GridView</b>
</code></pre>
<p class="TX">Running this command should show a dialog like <a href="chapter1.xhtml#fig1-2">Figure 1-2</a>.</p>
<figure class="IMG"><img alt="" class="img1" height="808" id="fig1-2" src="../images/Figure1-2.jpg" width="1388"/>
<figcaption><p class="CAP"><samp class="SANS_Futura_Std_Book_Oblique_I_11">Figure 1-2: Showing Process objects in a grid view</samp></p></figcaption>
</figure>
<p class="TX">You can filter and manipulate the data in the Grid View GUI. Try playing around with the controls. You can also specify the <samp class="SANS_TheSansMonoCd_W5Regular_11">PassThru</samp> parameter to <samp class="SANS_TheSansMonoCd_W5Regular_11">Out-GridView</samp>, which causes the command to wait for you to click the OK button in the GUI. Any rows in the view that are selected when you click OK will be written to the command pipeline.</p>
</section>
<section aria-labelledby="sec9" epub:type="division">
<h4 class="H2" id="sec9"><span id="h2-6"></span><samp class="SANS_Futura_Std_Bold_Condensed_Oblique_BI_11">Filtering, Ordering, and Grouping Objects</samp></h4>
<p class="TNI1">A traditional shell passes raw text between commands; PowerShell passes objects. Passing objects lets you access individual properties of the objects and trivially filter the pipeline. You can even order and group the objects easily.</p>
<p class="TX">You can filter objects using the <samp class="SANS_TheSansMonoCd_W5Regular_11">Where-Object</samp> command, which has the aliases <samp class="SANS_TheSansMonoCd_W5Regular_11">Where</samp> and <samp class="SANS_TheSansMonoCd_W5Regular_11">?</samp>. The simplest filter is to check for the value of a parameter, as shown in <a href="chapter1.xhtml#Lis1-18">Listing 1-18</a>, where we filter the output from the built-in <samp class="SANS_TheSansMonoCd_W5Regular_11">Get-Process</samp> command to find the <samp class="SANS_TheSansMonoCd_W5Regular_11">explorer</samp> process.</p>
<span id="Lis1-18"></span><pre><code><span aria-label=" Page 18. " epub:type="pagebreak" id="pg_18" role="doc-pagebreak"></span>PS&gt; <b>Get-Process | Where-Object ProcessName -EQ "explorer"</b>
Handles  NPM(K)    PM(K)      WS(K)     CPU(s)     Id  SI ProcessName
-------  ------    -----      -----     ------     --  -- -----------
   2792     130   118152     158144     624.83    6584  1 explorer
</code></pre>
<p class="ListingCaption"><span class="Futura_Std_Book_Oblique_I_11">Listing 1-18: Filtering a list of processes using Where-Object</span></p>
<p class="TX">In <a href="chapter1.xhtml#Lis1-18">Listing 1-18</a>, we pass through only <samp class="SANS_TheSansMonoCd_W5Regular_11">Process</samp> objects where the <samp class="SANS_TheSansMonoCd_W5Regular_11">ProcessName</samp> equals (<samp class="SANS_TheSansMonoCd_W5Regular_11">-EQ</samp>) <samp class="SANS_TheSansMonoCd_W5Regular_11">"explorer"</samp>. There are numerous operators you can use for filtering, some of which are shown in <a href="chapter1.xhtml#tab1-4">Table 1-4</a>.</p>
<table class="Basic-Table">
<caption><p class="TT" id="tab1-4"><span class="Heavy"><samp class="SANS_Futura_Std_Heavy_B_11">Table 1-4:</samp></span> <samp class="SANS_Futura_Std_Book_11">Common Operators for</samp> <samp class="SANS_TheSansMonoCd_W5Regular_11">Where-Object</samp></p></caption>
<thead>
<tr>
<th class="Basic-Table TCH" scope="col"><p class="TableHeader"><samp class="SANS_Futura_Std_Heavy_B_11">Operator</samp></p></th>
<th class="Basic-Table TCH" scope="col"><p class="TableHeader"><samp class="SANS_Futura_Std_Heavy_B_11">Example</samp></p></th>
<th class="Basic-Table TCH" scope="col"><p class="TableHeader"><samp class="SANS_Futura_Std_Heavy_B_11">Description</samp></p></th>
</tr>
</thead>
<tbody>
<tr>
<td class="Basic-Table TBF"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">-EQ</samp></p></td>
<td class="Basic-Table TBF"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">ProcessName -EQ "explorer"</samp></p></td>
<td class="Basic-Table TBF"><p class="TableBody"><samp class="SANS_Futura_Std_Book_11">Equal to the value</samp></p></td>
</tr>
<tr>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">-NE</samp></p></td>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">ProcessName -NE "explorer"</samp></p></td>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_Futura_Std_Book_11">Not equal to the value</samp></p></td>
</tr>
<tr>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">-Match</samp></p></td>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">ProcessName -Match "ex.*"</samp></p></td>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_Futura_Std_Book_11">Matches a string against a regular expression</samp></p></td>
</tr>
<tr>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">-NotMatch</samp></p></td>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">ProcessName -NotMatch "ex.*"</samp></p></td>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_Futura_Std_Book_11">Inverse of the</samp> <samp class="SANS_TheSansMonoCd_W5Regular_11">-Match</samp> <samp class="SANS_Futura_Std_Book_11">operator</samp></p></td>
</tr>
<tr>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">-Like</samp></p></td>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">ProcessName -Like "ex*"</samp></p></td>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_Futura_Std_Book_11">Matches a string against a wildcard</samp></p></td>
</tr>
<tr>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">-NotLike</samp></p></td>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">ProcessName -NotLike "ex*"</samp></p></td>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_Futura_Std_Book_11">Inverse of the</samp> <samp class="SANS_TheSansMonoCd_W5Regular_11">-Like</samp> <samp class="SANS_Futura_Std_Book_11">operator</samp></p></td>
</tr>
<tr>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">-GT</samp></p></td>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">ProcessName -GT "ex"</samp></p></td>
<td class="Basic-Table TB"><p class="TableBody"><samp class="SANS_Futura_Std_Book_11">Greater-than comparison</samp></p></td>
</tr>
<tr>
<td class="Basic-Table TBL"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">-LT</samp></p></td>
<td class="Basic-Table TBL"><p class="TableBody"><samp class="SANS_TheSansMonoCd_W5Regular_11">ProcessName -LT "ex</samp><samp class="SANS_Futura_Std_Heavy_B_11">"</samp></p></td>
<td class="Basic-Table TBL"><p class="TableBody"><samp class="SANS_Futura_Std_Book_11">Less-than comparison</samp></p></td>
</tr>
</tbody>
</table>
<p class="TX">You can investigate all of the supported operators by using <samp class="SANS_TheSansMonoCd_W5Regular_11">Get-Help</samp> on the <samp class="SANS_TheSansMonoCd_W5Regular_11">Where-Object</samp> command. If the condition to filter on is more complex than a simple comparison, you can use a script block. The script block should return <samp class="SANS_TheSansMonoCd_W5Regular_11">True</samp> to keep the object in the pipeline or <samp class="SANS_TheSansMonoCd_W5Regular_11">False</samp> to filter it. For example, you could also write <a href="chapter1.xhtml#Lis1-18">Listing 1-18</a> as the following:</p>
<pre><code>PS&gt; <b>Get-Process | Where-Object {$_.ProcessName -eq "explorer"}</b>
</code></pre>
<p class="TX">The <samp class="SANS_TheSansMonoCd_W5Regular_11">$_</samp> variable passed to the script block represents the current object in the pipeline. By using a script block you can access the entire language in your filtering, including calling functions.</p>
<p class="TX">To order objects, use the <samp class="SANS_TheSansMonoCd_W5Regular_11">Sort-Object</samp> command. If the objects can be ordered, as in the case of strings or numbers, then you just need to pipe the objects into the command. Otherwise, you’ll need to specify a property to sort on. For example, you can sort the process list by its handle count, represented by the <samp class="SANS_TheSansMonoCd_W5Regular_11">Handles</samp> property, as shown in <a href="chapter1.xhtml#Lis1-19">Listing 1-19</a>.</p>
<span id="Lis1-19"></span><pre><code><span aria-label=" Page 19. " epub:type="pagebreak" id="pg_19" role="doc-pagebreak"></span>PS&gt; <b>Get-Process | Sort-Object Handles</b>
Handles  NPM(K)    PM(K)      WS(K)     CPU(s)     Id  SI ProcessName
-------  ------    -----      -----     ------     --  -- -----------
      0       0       60          8                 0   0 Idle
     32       9     4436       6396              1032   1 fontdrvhost
     53       3     1148       1080               496   0 smss
     59       5      804       1764               908   0 LsaIso
<var>--snip--</var>
</code></pre>
<p class="ListingCaption"><span class="Futura_Std_Book_Oblique_I_11">Listing 1-19: Sorting processes by the number of handles</span></p>
<p class="TX">To sort in descending order instead of ascending order, use the <samp class="SANS_TheSansMonoCd_W5Regular_11">Descending</samp> parameter, as shown in <a href="chapter1.xhtml#Lis1-20">Listing 1-20</a>.</p>
<span id="Lis1-20"></span><pre><code>PS&gt; <b>Get-Process | Sort-Object Handles -Descending</b>
Handles   NPM(K)    PM(K)      WS(K)     CPU(s)      Id   SI  ProcessName
-------  ------     -----      -----     ------      --   --  -----------
   5143       0       244      15916                  4    0  System
   2837     130    116844     156356     634.72    6584    1  explorer
   1461      21     11484      16384               1116    0  svchost
   1397      52     55448       2180      12.80   12452    1  Microsoft.Photos
</code></pre>
<p class="ListingCaption"><span class="Futura_Std_Book_Oblique_I_11">Listing 1-20: Sorting processes by the number of handles in descending order</span></p>
<p class="TX">It’s also possible to filter out duplicate entries at this stage by specifying the <samp class="SANS_TheSansMonoCd_W5Regular_11">Unique</samp> parameter to <samp class="SANS_TheSansMonoCd_W5Regular_11">Sort-Object</samp>.</p>
<p class="TX">Finally, you can group objects based on a property name using the <samp class="SANS_TheSansMonoCd_W5Regular_11">Group-Object</samp> command. <a href="chapter1.xhtml#Lis1-21">Listing 1-21</a> shows that this command returns a list of objects, each with <samp class="SANS_TheSansMonoCd_W5Regular_11">Count</samp>, <samp class="SANS_TheSansMonoCd_W5Regular_11">Name</samp>, and <samp class="SANS_TheSansMonoCd_W5Regular_11">Group</samp> properties.</p>
<span id="Lis1-21"></span><pre><code>PS&gt; <b>Get-Process | Group-Object ProcessName</b>
Count Name                 Group
----- ----                 -----
    1 ApplicationFrameHost {System.Diagnostics.Process (ApplicationFrameHost)}
    1 Calculator           {System.Diagnostics.Process (Calculator)}
   11 conhost              {System.Diagnostics.Process (conhost)...}
<var>--snip--</var>
</code></pre>
<p class="ListingCaption"><span class="Futura_Std_Book_Oblique_I_11">Listing 1-21: Grouping Process objects by ProcessName</span></p>
<p class="TX">Alternatively, you could use all of these commands together in one pipeline, as shown in <a href="chapter1.xhtml#Lis1-22">Listing 1-22</a>.</p>
<span id="Lis1-22"></span><pre><code>PS&gt; <b>Get-Process | Group-Object ProcessName |</b>
<b>Where-Object Count -GT 10 | Sort-Object Count</b>
Count Name                 Group
----- ----                 -----
   11 conhost              {System.Diagnostics.Process (conhost),...}
   83 svchost              {System.Diagnostics.Process (svchost),...}
</code></pre>
<p class="ListingCaption"><span class="Futura_Std_Book_Oblique_I_11">Listing 1-22: Combining Where-Object, Group-Object, and Sort-Object</span></p>
</section>
<section aria-labelledby="sec10" epub:type="division">
<h4 class="H2" id="sec10"><span id="h2-7"></span><span aria-label=" Page 20. " epub:type="pagebreak" id="pg_20" role="doc-pagebreak"></span><samp class="SANS_Futura_Std_Bold_Condensed_Oblique_BI_11">Exporting Data</samp></h4>
<p class="TNI1">Once you’ve got the perfect set of objects you want to inspect, you might want to persist that information to a file on disk. PowerShell provides numerous options for this, a few of which I’ll discuss here. The first option is to output the objects to a file as text, using <samp class="SANS_TheSansMonoCd_W5Regular_11">Out-File</samp>. This command captures the formatted text output and writes it to a file. You can use <samp class="SANS_TheSansMonoCd_W5Regular_11">Get-Content</samp> to read the file back in again, as shown in <a href="chapter1.xhtml#Lis1-23">Listing 1-23</a>.</p>
<span id="Lis1-23"></span><pre><code>PS&gt; <b>Get-Process | Out-File processes.txt</b>
PS&gt; <b>Get-Content processes.txt</b>
Handles  NPM(K)    PM(K)      WS(K)     CPU(s)     Id  SI ProcessName
-------  ------    -----      -----     ------     --  -- -----------
    476      27    25896      32044       2.97   3352   1 ApplicationFrameHost
    623      18    25096      18524     529.95  19424   0 audiodg
    170       8     6680      <b> </b>5296       0.08   5192   1 bash
    557      31    23888        332       0.59  10784   1 Calculator
<var>--snip--</var>
</code></pre>
<p class="ListingCaption"><span class="Futura_Std_Book_Oblique_I_11">Listing 1-23: Writing content to a text file and reading it back in again</span></p>
<p class="TX">You can also use the greater-than operator to send the output to a file, as in other shells. For example:</p>
<pre><code>PS&gt; <b>Get-Process &gt; processes.txt</b>
</code></pre>
<p class="TX">If you want a more structured format, you can use <samp class="SANS_TheSansMonoCd_W5Regular_11">Export-Csv</samp> to convert the object to a comma-separated value (CSV) table format. You could then import this file into a spreadsheet program to analyze offline. The example in <a href="chapter1.xhtml#Lis1-24">Listing 1-24</a> selects some properties of the <samp class="SANS_TheSansMonoCd_W5Regular_11">Process</samp> object and exports them to the CSV file <i>processes.csv</i>.</p>
<span id="Lis1-24"></span><pre><code>PS&gt; <b>Get-Process | Select-Object Id, ProcessName |</b>
<b>Export-Csv processes.csv -NoTypeInformation</b>
PS&gt; <b>Get-Content processes.csv</b>
"Id","ProcessName"
"3352","ApplicationFrameHost"
"19424","audiodg"
"5192","bash"
"10784","Calculator"
<var>--snip--</var>
</code></pre>
<p class="ListingCaption"><span class="Futura_Std_Book_Oblique_I_11">Listing 1-24: Exporting objects to a CSV file</span></p>
<p class="TX">It’s possible to reimport the CSV data using the <samp class="SANS_TheSansMonoCd_W5Regular_11">Import-Csv</samp> command. However, if you expect to export the data and then reimport it later, you’ll probably prefer the CLI XML format. This format can include the structure and type of the original object, which allows you to reconstruct it when you import the data. <a href="chapter1.xhtml#Lis1-25">Listing 1-25</a> shows how you can use the <samp class="SANS_TheSansMonoCd_W5Regular_11">Export-CliXml</samp> and <samp class="SANS_TheSansMonoCd_W5Regular_11">Import-CliXml</samp> commands to export objects in this format and then reimport them.</p>
<span id="Lis1-25"></span><pre><code><span aria-label=" Page 21. " epub:type="pagebreak" id="pg_21" role="doc-pagebreak"></span>PS&gt; <b>Get-Process | Select-Object Id, ProcessName | Export-CliXml processes.xml</b>
PS&gt; <b>Get-Content processes.xml</b>
&lt;Objs Version="1.1.0.1" xmlns="http://schemas.microsoft.com/powershell/2004/04"&gt;
  &lt;Obj RefId="0"&gt;
    &lt;TNRef RefId="0" /&gt;
    &lt;MS&gt;
      &lt;I32 N="Id"&gt;3352&lt;/I32&gt;
      &lt;S N="ProcessName"&gt;ApplicationFrameHost&lt;/S&gt;
    &lt;/MS&gt;
  &lt;/Obj&gt;
<var>--snip--</var>
&lt;/Objs&gt;
PS&gt; <b>$ps = Import-CliXml processes.xml</b>
PS&gt; <b>$ps[0]</b>
  Id ProcessName
  -- -----------
3352 ApplicationFrameHost
</code></pre>
<p class="ListingCaption"><span class="Futura_Std_Book_Oblique_I_11">Listing 1-25: Exporting and reimporting CLI XML files</span></p>
<p class="TX">This concludes our discussion of the PowerShell language. If you’re a little rusty, I recommend picking up a good book on the topic, such as <i>PowerShell for Sysadmins</i> by Adam Bertram (No Starch Press, 2020).</p>
</section>
</section>
<section aria-labelledby="sec11" epub:type="division">
<h3 class="H1" id="sec11"><span id="h1-9"></span><samp class="SANS_Futura_Std_Bold_B_11">Wrapping Up</samp></h3>
<p class="TNI1">This chapter gave a short overview of how to set up your PowerShell environment so that you can run the code examples included throughout the book. We discussed configuring PowerShell to run scripts and installing the required external PowerShell module.</p>
<p class="TX">The rest of the chapter provided a bit of background on the PowerShell language. This included the basics of PowerShell syntax, as well as discovering commands using <samp class="SANS_TheSansMonoCd_W5Regular_11">Get-Command</samp>, getting help using <samp class="SANS_TheSansMonoCd_W5Regular_11">Get-Help</samp>, and displaying, filtering, grouping, and exporting PowerShell objects.</p>
<p class="TX">With the basics of PowerShell out of the way, we can start to dive into the inner workings of the Windows operating system. In the next chapter, we’ll discuss the Windows kernel and how you can interact with it using PowerShell.</p>
</section>
</section>
</div></body>
</html>