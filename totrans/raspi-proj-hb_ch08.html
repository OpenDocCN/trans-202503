<?xml version='1.0' encoding='utf-8'?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" epub:prefix="z3998: http://www.daisy.org/z3998/2012/vocab/structure/#" lang="en" xml:lang="en">
  <head>
    <title>Project 8: Pong with a Sense HAT</title>
    <link href="../styles/9781593278717.css" rel="stylesheet" type="text/css"/>
    <link href="../68851547a55f.css" rel="stylesheet" type="text/css"/>
  </head>
  <body>
    <div id="sbo-rt-content"><h2 class="h2" id="ch08"><span epub:type="pagebreak" id="page_110"/><strong>8<br/>Pong with a Sense HAT</strong></h2>
<p class="noindent"><span class="green2">Here you’ll build your own LED Pong game using the Sense HAT. The Sense HAT is an add-on board for your Pi that gives it a lot more functionality through extra features like an LED matrix, joystick, and several sensors that get information from the outside world.</span></p>
<div class="image"><span epub:type="pagebreak" id="page_111"/><img src="../images/f0111-01.jpg" alt="image"/></div>
<p class="cap"><span class="green2"><strong>PARTS REQUIRED</strong></span></p>
<p class="cap1">Raspberry Pi (versions with 40 GPIOs)</p>
<p class="cap1">Sense HAT</p>
<p class="indentt"><span epub:type="pagebreak" id="page_112"/>You’ll use the Sense HAT’s LED matrix to display the game and the joystick to play. If you don’t have the hardware, not to worry: you’ll also learn how to use the Sense HAT emulator to create the same game without it.</p>
<h3 class="h3" id="lev86"><span class="green2"><strong>INTRODUCING PONG</strong></span></h3>
<p class="noindent">One of the first video games ever created, Pong is an immensely popular 2D table-tennis (ping-pong) game that can be played in single- or double-player mode. You’re going to create the single-player version, so it’s more like playing squash: you bounce the ball against the walls with your bat and catch it with the bat when it comes back. If you miss the ball, you lose.</p>
<h3 class="h3" id="lev87"><span class="green2"><strong>INTRODUCING THE RASPBERRY PI SENSE HAT</strong></span></h3>
<p class="noindent">The Raspberry Pi Sense HAT features an 8×8 RGB LED matrix, a five-button joystick, a gyroscope, an accelerometer, a magnetometer, a temperature sensor, a barometric sensor, and a humidity sensor in one package, shown in <a href="ch08.xhtml#ch08fig1">Figure 8-1</a>.</p>
<div class="image"><a id="ch08fig1"/><img src="../images/f0112-01.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 8-1:</strong> Raspberry Pi Sense HAT</p>
<h4 class="h4" id="lev88"><span class="green2"><strong>Mounting the Board</strong></span></h4>
<div class="note">
<p class="notet"><strong>NOTE</strong></p>
<p class="notep"><em>The Sense HAT is not compatible with Raspberry Pi 1 Model A and B, but you can build the project using the emulator if you have an incompatible board.</em></p>
</div>
<p class="noindent">This project doesn’t require much hardware assembly—you just need to mount the Sense HAT on the Pi, and the rest is done in code.</p>
<p class="indent">Attach the 40 GPIOs on the Sense HAT to the 40 GPIOs on your Raspberry Pi; the boards should line up perfectly. When you first successfully mount the Sense HAT on a powered Pi, the LED matrix displays an illuminated rainbow background as shown in <a href="ch08.xhtml#ch08fig2">Figure 8-2</a>.</p>
<div class="image"><span epub:type="pagebreak" id="page_113"/><a id="ch08fig2"/><img src="../images/f0113-01.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 8-2:</strong> Sense HAT welcome rainbow</p>
<h4 class="h4" id="lev89"><span class="green2"><strong>Using the Sense HAT Emulator</strong></span></h4>
<p class="noindent">If you don’t have a Sense HAT or a compatible board, or if you just want to test the script first, you can use the Sense HAT emulator to build the Pong game on your computer. The emulator is a virtual Sense HAT that you can interact with to test your scripts. To launch it from the Desktop main menu, go to <strong>Programming</strong> <span class="ent">▸</span> <strong>Sense HAT Emulator</strong>. This opens the emulator window, shown in <a href="ch08.xhtml#ch08fig3">Figure 8-3</a>.</p>
<div class="image"><a id="ch08fig3"/><img src="../images/f0113-02.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 8-3:</strong> Sense HAT Emulator window</p>
<p class="indent">The Sense HAT emulator comes with examples stored in <strong>File</strong> <span class="ent">▸</span> <strong>Examples</strong>; just select the example you want and then run the file to see the code in action in the emulator window.</p>
<h3 class="h3" id="lev90"><span epub:type="pagebreak" id="page_114"/><span class="green2"><strong>WORKING WITH SENSE HAT FUNCTIONS AND CONTROLS</strong></span></h3>
<p class="noindent">Before you go right into building the game, it’s important to understand how to control the LED matrix and read inputs from the joystick. Let’s look at some examples that you’ll use later in the Pong script.</p>
<h4 class="h4" id="lev91"><span class="green2"><strong>Controlling the LED Matrix</strong></span></h4>
<p class="noindent">The Sense HAT LED matrix has 8 columns and 8 rows, containing a total of 64 RGB LEDs. You can display text and create images on the matrix by controlling each LED individually. You can also set the color of each LED.</p>
<h5 class="h5"><strong>Displaying Text</strong></h5>
<p class="noindent">The code in <a href="ch08.xhtml#ch08list1">Listing 8-1</a> displays the scrolling text “Hello World!” in blue on the dot matrix.</p>
<p class="listing" id="ch08list1"><strong>LISTING 8-1:</strong> Display text on the Sense HAT LED matrix</p>
<div class="box">
<pre><span class="ent">➊</span> <span class="orange">from</span> sense_hat <span class="orange">import</span> SenseHat<br/>  <span class="red1">#uncomment the following line if you are using the emulator</span><br/><span class="ent">➋</span> <span class="red1">#from sense_emu import SenseHat</span><br/>  sense = SenseHat()<br/><span class="ent">➌</span> sense.show_message(<span class="green">'Hello World!'</span>, text_colour = [0, 0, 255])</pre>
</div>
<p class="indent">First import the <code>SenseHat</code> class <span class="ent">➊</span>. If you’re using the emulator, delete or comment out this line and uncomment the code at <span class="ent">➋</span>.</p>
<p class="indent">The <code>show_message()</code> function <span class="ent">➌</span> accepts the message to display—a text string—as the first parameter, and then takes several options as further parameters:</p>
<div class="note">
<p class="notet"><strong>NOTE</strong></p>
<p class="notep"><em>The sense_hat library uses the British spelling “colour,” so you must use “colour” throughout your code.</em></p>
</div>
<ul>
<li class="noindent">Use <code>text_colour = [<em>r</em>, <em>g</em>, <em>b</em>]</code> to set the RGB color of the text, replacing <code><em>r</em>, <em>g</em>, <em>b</em></code> with integers between <code>0</code> and <code>255</code> (as you did in <a href="ch05.xhtml#ch05">Project 5</a>).</li>
<li class="noindent">Use <code>scroll_speed = <em>x</em></code>, where <span class="codeitalic">x</span> is a float, to control the speed at which text moves across the display. The default scrolling speed is set to pause for 0.1 seconds each time the text shifts one pixel to the left.</li>
<li class="noindent">Use <code>back_colour = [<em>r</em>, <em>g</em>, <em>b</em>]</code> to set the background color, replacing <code><em>r</em>, <em>g</em>, <em>b</em></code> with integer values as with <code>text_colour</code>.</li>
</ul>
<h5 class="h5"><strong>Controlling Specific LEDs</strong></h5>
<p class="noindent">To control individual LEDs, you refer to each LED you want to light by its position in the matrix. For that, the Sense HAT uses an (x, y) coordinate system. For example, the LEDs in <a href="ch08.xhtml#ch08fig4">Figure 8-4</a> have the coordinates listed next to the diagram.</p>
<div class="image"><span epub:type="pagebreak" id="page_115"/><a id="ch08fig4"/><img src="../images/f0115-01.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 8-4:</strong> Sense HAT coordinate system</p>
<p class="indent">To light up the LEDs in <a href="ch08.xhtml#ch08fig4">Figure 8-4</a> with their corresponding colors, you’d use the code in <a href="ch08.xhtml#ch08list2">Listing 8-2</a>.</p>
<p class="listing" id="ch08list2"><strong>LISTING 8-2:</strong> Using <code>set_pixel()</code> to light particular LEDs</p>
<div class="box">
<pre><span class="orange">from</span> sense_hat <span class="orange">import</span> SenseHat<br/><span class="red1">#uncomment the following line if you are using the emulator</span><br/><span class="red1">#from sense_emu import SenseHat</span><br/>sense = SenseHat()<br/><span class="red1">#set blue pixel</span><br/>sense.set_pixel(0, 1, 0, 0, 255)<br/><span class="red1">#set green pixel</span><br/>sense.set_pixel(7, 6, 0, 255, 0)<br/><span class="red1">#set pink pixel</span><br/>sense.set_pixel(2, 5, 255, 51, 153)</pre>
</div>
<p class="indent">The function <code>sense.set_pixel(<em>x</em>, <em>y</em>, <em>r</em>, <em>g</em>, <em>b</em>)</code> lights up a specific LED, in which <span class="codeitalic">x</span> is the x-coordinate; <span class="codeitalic">y</span> is the y-coordinate; and <span class="codeitalic">r</span>, <span class="codeitalic">g</span>, and <span class="codeitalic">b</span> set the color.</p>
<h5 class="h5"><strong>Displaying a Picture</strong></h5>
<p class="noindent">Rather than controlling individual LEDs, you can use the function <code>sense.set_pixels()</code> to more quickly display an image. Instead of entering coordinates, you insert a list for all 64 LEDs that determines the color of each LED. Take a look at the code in <a href="ch08.xhtml#ch08list3">Listing 8-3</a>, which displays a sad face.</p>
<p class="listing" id="ch08list3"><strong>LISTING 8-3:</strong> Displaying an image with <code>set_pixels()</code></p>
<div class="box">
<pre><span class="orange">from</span> sense_hat <span class="orange">import</span> SenseHat<br/><span class="red1">#uncomment the following line if you are using the emulator</span><br/><span class="red1">#from sense_emu import SenseHat</span><br/>sense = SenseHat()<br/><br/><span class="red1">#red color</span><br/>X = [255, 0, 0]<br/><br/><span epub:type="pagebreak" id="page_116"/><span class="red1">#no color</span><br/>N = [0, 0, 0]<br/><br/><span class="red1">#sad face array</span><br/>sad_face = [<br/>N, N, <span class="red1">X</span>, <span class="red1">X</span>, <span class="red1">X</span>, <span class="red1">X</span>, N, N,<br/>N, <span class="red1">X</span>, N, N, N, N, <span class="red1">X</span>, N,<br/><span class="red1">X</span>, N, <span class="red1">X</span>, N, N, <span class="red1">X</span>, N, <span class="red1">X</span>,<br/><span class="red1">X</span>, N, N, N, N, N, N, <span class="red1">X</span>,<br/><span class="red1">X</span>, N, N, <span class="red1">X</span>, <span class="red1">X</span>, N, N, <span class="red1">X</span>,<br/><span class="red1">X</span>, N, <span class="red1">X</span>, N, N, <span class="red1">X</span>, N, <span class="red1">X</span>,<br/>N, <span class="red1">X</span>, N, N, N, N, <span class="red1">X</span>, N,<br/>N, N, <span class="red1">X</span>, <span class="red1">X</span>, <span class="red1">X</span>, <span class="red1">X</span>, N, N<br/>]<br/><br/>sense.set_pixels(sad_face)</pre>
</div>
<div class="note">
<p class="notet"><strong>NOTE</strong></p>
<p class="notep"><em>The red Xs in the <code>sad_face</code> array won’t appear red in your code. We’re just highlighting them so it’s easier to visualize how the LEDs will look.</em></p>
</div>
<p class="indent">You create a variable to store the color of the lit LEDs (<code>X</code>), and a variable to store the color of the background (<code>N</code>)—you can set the background to any color or set it to <code>0</code> to keep it unlit. Then you need to create an array that sets each of the 64 LEDs either to <code>X</code> or to <code>N</code>. <a href="ch08.xhtml#ch08fig5">Figure 8-5</a> shows the end result of the code in <a href="ch08.xhtml#ch08list3">Listing 8-3</a>:</p>
<div class="image"><a id="ch08fig5"/><img src="../images/f0116-01.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 8-5:</strong> Displaying a sad face on the LED matrix</p>
<p class="indent">You can include as many colors as you want in your drawing; you just need to change the color parameters. We encourage you to practice working with the LED matrix by changing the colors and drawing your own images.</p>
<p class="indent">Now that you know how to control the LED matrix, let’s look at how to program the joystick.</p>
<h4 class="h4" id="lev92"><span epub:type="pagebreak" id="page_117"/><span class="green2"><strong>Reading Data from the Joystick</strong></span></h4>
<p class="noindent">The joystick that comes with the Sense HAT has five control options:</p>
<ul>
<li class="noindent">Move up</li>
<li class="noindent">Move down</li>
<li class="noindent">Move right</li>
<li class="noindent">Move left</li>
<li class="noindent">Press</li>
</ul>
<p class="indent">You need to tell your program what each control option should make the Pi do. The script in <a href="ch08.xhtml#ch08list4">Listing 8-4</a> sets the events associated with each joystick control, and displays a message on the computer screen saying which control was used:</p>
<p class="listing" id="ch08list4"><strong>LISTING 8-4:</strong> Associating events with each joystick control</p>
<div class="box">
<pre>  <span class="orange">from</span> signal <span class="orange">import</span> pause<br/><br/>  <span class="orange">from</span> sense_hat <span class="orange">import</span> SenseHatm<br/>  <span class="red1">#uncomment the following line if you are using the emulator</span><br/>  <span class="red1">#from sense_emu import SenseHat</span><br/>  sense = SenseHat()<br/><br/><span class="ent">➊</span> <span class="orange">def</span> <span class="blue">move_up</span>(event):<br/>      <span class="purple">print</span>(<span class="green">'joystick was moved up'</span>)<br/><br/>  <span class="orange">def</span> <span class="blue">move_down</span>(event):<br/>      <span class="purple">print</span>(<span class="green">'joystick was moved down'</span>)<br/><br/>  <span class="orange">def</span> <span class="blue">move_right</span>(event):<br/>      <span class="purple">print</span>(<span class="green">'joystick was moved right'</span>)<br/><br/>  <span class="orange">def</span> <span class="blue">move_left</span>(event):<br/>      <span class="purple">print</span>(<span class="green">'joystick was moved left'</span>)<br/><br/>  <span class="orange">def</span> <span class="blue">move_middle</span>(event):<br/>      <span class="purple">print</span>(<span class="green">'joystick was pressed'</span>)<br/><br/><span class="ent">➋</span> sense.stick.direction_up = move_up<br/>  sense.stick.direction_down = move_down<br/>  sense.stick.direction_right = move_right<br/>  sense.stick.direction_left = move_left<br/>  sense.stick.direction_middle = move_middle<br/><br/>  pause()</pre>
</div>
<p class="indent">First, you need to tell your Pi what action to take when each joystick control is triggered. You do that by defining a series of functions to perform actions. For example, when the joystick is <span epub:type="pagebreak" id="page_118"/>moved up, you call the function <code>move_up()</code> <span class="ent">➊</span> to print the message <code>joystick was moved up</code>. The <code>event</code> argument tells the Pi that the joystick will be sending information to those functions. Then you use <code>sense.stick.direction_up = move_up</code> <span class="ent">➋</span> to associate the <code>move_up</code> function with the up movement of the joystick.</p>
<p class="indent">The other movement functions work in the same way.</p>
<h3 class="h3" id="lev93"><span class="green2"><strong>WRITING THE SCRIPT</strong></span></h3>
<p class="noindent">Now that you know how to display text and drawings on the LED matrix and how to make something happen when the joystick is used, you’re ready to start writing the script for your game.</p>
<p class="indent">Here’s what the game aims to do:</p>
<ul>
<li class="noindent">A bat that is 3 pixels long and 1 pixel wide should appear in column 0.</li>
<li class="noindent">Each time you move the joystick up or down, the bat should move correspondingly.</li>
<li class="noindent">The ball should start in a random position and move diagonally.</li>
<li class="noindent">When the ball hits something—walls, ceiling, or the bat—it should move diagonally in the opposite direction.</li>
<li class="noindent">If the ball hits column 0, it means you missed the ball, so you lose and the game is over.</li>
</ul>
<h4 class="h4" id="lev94"><span class="green2"><strong>Entering the Script</strong></span></h4>
<p class="noindent">Open <strong>Python 3 (IDLE)</strong> and go to <strong>File</strong> <span class="ent">▸</span> <strong>New File</strong> to create a new script. Then copy the code in <a href="ch08.xhtml#ch08list5">Listing 8-5</a> to the new file and save the script as <em>pong_game.py</em> inside the <em>Displays</em> folder (remember that you can download all the scripts at <em><a href="https://www.nostarch.com/RaspberryPiProject/">https://www.nostarch.com/RaspberryPiProject/</a></em>).</p>
<p class="listing" id="ch08list5"><strong>LISTING 8-5:</strong> The Pong game code</p>
<div class="box">
<pre>  <span class="red1">#based on raspberrypi.org Sense HAT Pong example</span><br/><br/>  <span class="red1">#import necessary libraries</span><br/><span class="ent">➊</span> from <span class="orange">random</span> import <span class="orange">randint</span><br/>  from <span class="orange">time</span> import <span class="orange">sleep</span><br/><br/>  <span class="red1">#use this line if you are using the Sense HAT board</span><br/>  <span class="orange">from</span> sense_hat <span class="orange">import</span> SenseHat<br/>  <span class="red1">#uncomment the following line if you are using the emulator</span><br/>  <span class="red1">#from sense_emu import SenseHat</span><br/><br/>  <span class="red1">#create an object called sense</span><br/><span class="ent">➋</span> sense = SenseHat()<br/><br/><span epub:type="pagebreak" id="page_119"/>  <span class="red1">#set bat position, random ball position, and velocity</span><br/><span class="ent">➌</span> y = 4<br/><span class="ent">➍</span> ball_position = [<span class="purple">int</span>(randint(2,6)), <span class="purple">int</span>(randint(1,6))]<br/><span class="ent">➎</span> ball_velocity = [1, 1]<br/><br/>  <span class="red1">#red color</span><br/>  X = [255, 0, 0]<br/>  <span class="red1">#no color</span><br/>  N = [0, 0, 0]<br/><br/>  <span class="red1">#sad face array</span><br/>  sad_face = [<br/>  N, N, X, X, X, X, N, N,<br/>  N, X, N, N, N, N, X, N,<br/>  X, N, X, N, N, X, N, X,<br/>  X, N, N, X, N, N, N, X,<br/>  X, N, N, X, N, N, N, X,<br/>  X, N, X, N, N, X, N, X,<br/>  N, X, N, N, N, N, X, N,<br/>  N, N, X, X, X, X, N, N<br/>  ]<br/><br/>  <span class="red1">#draw bat at y position</span><br/><span class="ent">➏</span> <span class="orange">def</span> <span class="blue">draw_bat</span>():<br/>      sense.set_pixel(0, y, 0, 255, 0)<br/>      sense.set_pixel(0, y+1, 0, 255, 0)<br/>      sense.set_pixel(0, y-1, 0, 255, 0)<br/><br/>  <span class="red1">#move bat up</span><br/><span class="ent">➐</span> <span class="orange">def</span> <span class="blue">move_up</span>(event):<br/>      <span class="orange">global</span> y<br/>      <span class="orange">if</span> y &gt; 1 <span class="orange">and</span> event.action==<span class="green">'pressed'</span>:<br/>          y -= 1<br/><br/>  <span class="red1">#move bat down</span><br/>  <span class="orange">def</span> <span class="blue">move_down</span>(event):<br/>      <span class="orange">global</span> y<br/>      <span class="orange">if</span> y &lt; 6 <span class="orange">and</span> event.action==<span class="green">'pressed'</span>:<br/>          y += 1<br/><br/>  <span class="red1">#move ball to the next position</span><br/><span class="ent">➑</span> <span class="orange">def</span> <span class="blue">draw_ball</span>():<br/>      <span class="red1">#ball displayed on current position</span><br/>      sense.set_pixel(ball_position[0], ball_position[1], 75, 0, 255)<br/>      <span class="red1">#next ball position</span><br/>      ball_position[0] += ball_velocity[0]<br/>      ball_position[1] += ball_velocity[1]<br/>      <span class="red1">#if ball hits ceiling, calculate next position</span><br/>      <span class="orange">if</span> ball_position[0] == 7:<br/>          ball_velocity[0] = -ball_velocity[0]<br/>      <span class="red1">#if ball hits wall, calculate next position</span><br/>      <span class="orange">if</span> ball_position[1] == 0 <span class="orange">or</span> ball_position[1] == 7:<br/>          ball_velocity[1] = -ball_velocity[1]<br/><span epub:type="pagebreak" id="page_120"/>      <span class="red1">#if ball reaches 0 position, player loses and game quits</span><br/>      <span class="orange">if</span> ball_position[0] == 0:<br/>          sleep(0.25)<br/>          sense.set_pixels(sad_face)<br/>          <span class="purple">quit</span>()<br/>      <span class="red1">#if ball hits bat, calculate next ball position</span><br/>      <span class="orange">if</span> ball_position[0] == 1 <span class="orange">and</span> y - 1 &lt;= ball_position[1] &lt;= y+1:<br/>          ball_velocity[0] = -ball_velocity[0]<br/><br/>  <span class="red1">#when joystick moves up or down, trigger corresponding function</span><br/><span class="ent">➒</span> sense.stick.direction_up = move_up<br/>  sense.stick.direction_down = move_down<br/><br/>  <span class="red1">#run the game</span><br/><span class="ent">➓</span> <span class="orange">while True</span>:<br/>      sense.clear()<br/>      draw_bat()<br/>      draw_ball()<br/>      sleep(0.25)</pre>
</div>
<p class="indent">There’s a lot going on in this code. Let’s walk through it step by step.</p>
<h5 class="h5"><strong>Importing Necessary Libraries</strong></h5>
<p class="noindent">At <span class="ent">➊</span>, you import the <code>randint()</code> function from the rand library to generate pseudorandom integers and the <code>sleep()</code> function from the time library to set delay times.</p>
<p class="indent">At <span class="ent">➋</span>, you create an object called <code>sense</code> that will be used to refer to the Sense HAT throughout the code.</p>
<h5 class="h5"><strong>Creating the Bat</strong></h5>
<p class="noindent">The bat is a 3-pixel bar that moves up and down the leftmost column. At <span class="ent">➌</span>, you define the bat’s starting position at 4 pixels down from the top with <code>y = 4</code>. The complete bat is drawn in green within the <code>draw_bat()</code> function <span class="ent">➏</span>, which adds one more pixel to the top of the starting position (<code>y - 1</code>) and to the bottom (<code>y + 1</code>) to make the bat 3 pixels long.</p>
<h5 class="h5"><strong>Moving the Bat</strong></h5>
<p class="noindent">The bat moves just on the y-axis, so its x-coordinate is always <code>0</code>, but its y-coordinate needs to change as the player moves the bat. In other words, the player can only move the bat up and down. The <code>move_up()</code> and <code>move_down()</code> functions, defined at <span class="ent">➐</span>, control those movements. At <span class="ent">➒</span>, you tell the Pi what action to take when the player moves the joystick up or down by calling <code>move_up()</code> and <code>move_down()</code>, respectively.</p>
<p class="indent">Take a closer look at the <code>move_up()</code> function (the <code>move_down()</code> function works in a similar way):</p>
<div class="box">
<pre><span epub:type="pagebreak" id="page_121"/><span class="red1">#move bat up</span><br/><span class="orange">def</span> <span class="blue">move_up</span>(event):<br/>    <span class="orange">global</span> y<br/>    <span class="orange">if</span> y &gt; 1 <span class="orange">and</span> event.action==<span class="green">'pressed'</span>:<br/>        y -= 1</pre>
</div>
<p class="indent">The <code>move_up()</code> function accepts <code>event</code> as a parameter. Basically, the <code>event</code> parameter allows you to pass some information about the joystick to the function—such as the time the stick was used; the direction it was pushed; and if it was pressed, released, or held—so the Pi knows how to react.</p>
<div class="note">
<p class="notet"><strong>HINT</strong></p>
<p class="notep"><em>Writing</em> <code>y -= 1</code> <em>in Python is equal to</em> <code>y = y - 1</code>.</p>
</div>
<p class="indent">When the player moves the joystick up, the function moves the y-coordinate of the bat up by subtracting <code>1</code> from the variable <code>y</code>. But first, the code checks that <code>y &gt; 1</code>; otherwise, the bat may end up moving out of the matrix.</p>
<h5 class="h5"><strong>Declaring Variable Scope</strong></h5>
<p class="noindent">Note that <code>y</code> is defined as a <code>global</code> variable. Not all variables in a program are accessible at all locations in the program, so there might be areas where it is invalid to call a certain variable. A variable’s <em>scope</em> is the area of a program where it is accessible. In Python, there are two basic variable scopes: <em>local</em> and <em>global</em>.</p>
<p class="indent">A variable defined in the main code body is global, meaning it is accessible anywhere else in the code. A variable defined inside a function is local to that function, so what you do with the local variable inside the function has no effect on variables outside, even if they have the same name.</p>
<p class="indent">As you want <code>y</code> to be usable both inside the function where it is defined and throughout the code, it needs to be declared as <code>global</code>. Otherwise, when you move the joystick nothing will happen, because the <code>y</code> variable is just being changed inside the function and not in the main body of the code.</p>
<h5 class="h5"><strong>Creating the Ball</strong></h5>
<p class="noindent">To make a moving ball, you first need a starting position and a velocity. At <span class="ent">➍</span>, you set the ball’s starting position using a list. Lists are defined between square brackets, <code>[<em>0th element</em>, <em>1st element</em>, ..., <em>nth element</em>]</code>, and each element is separated by a comma. The elements in the lists have <em>zero indexing</em>, meaning the index for the first element is 0, not 1. In this case, our 0th element is the x-position, and the 1st element is the y-position.</p>
<p class="indent"><span epub:type="pagebreak" id="page_122"/>When you start the game, the ball is in a random position, generated by the <code>randint()</code> function. That random position can be between 1 and 6 for the y-axis and 2 and 6 for the x-axis. These numbers ensure that the ball doesn’t start on the ceiling, walls, or next to the bat.</p>
<h5 class="h5"><strong>Moving the Ball</strong></h5>
<p class="noindent">Once you have a starting position for the ball, you need to give it a velocity <span class="ent">➎</span> to get it moving. You create a list for the ball’s velocity in which the 0th element is the velocity for the x-coordinate and the 1st element is the velocity for the y-coordinate.</p>
<p class="indent">You need to add or subtract the velocity to or from the current ball position to make the ball move forward or backward, respectively. The <code>draw_ball()</code> function at <span class="ent">➑</span> is where you display and move the ball, which always moves in diagonals. If it goes forward it continues forward, and if it goes backward it continues backward, unless it hits the ceiling or the bat, in which case it goes in the opposite direction.</p>
<h5 class="h5"><strong>Keeping the Game Running</strong></h5>
<p class="noindent">Once everything is set up, you add a <code>while</code> loop to keep the game running <span class="ent">➓</span>. The <code>while</code> loop starts by cleaning the display; then, it calls the function <code>draw_bat()</code> to draw the bat and <code>draw_ball()</code> to display the ball.</p>
<p class="indent">The <code>sleep()</code> function in the last line defines the time the ball takes to move to another position, so you can use this function to determine how fast the ball moves. If you increase the delay time, the game becomes slower and easier; if you decrease it, the game moves faster. We encourage you to experiment with different delay times.</p>
<h4 class="h4" id="lev95"><span class="green2"><strong>Running the Script</strong></span></h4>
<p class="noindent">Congratulations! After a lot of programming, you have your reward: you can play Pong on your Sense HAT! Press <strong>F5</strong> or go to <strong>Run</strong> <span class="ent">▸</span> <strong>Run Module</strong> to run the script.</p>
<p class="indent">When you lose and the game ends, the LED matrix displays a sad face as shown in <a href="ch08.xhtml#ch08fig6">Figure 8-6</a>.</p>
<div class="image"><span epub:type="pagebreak" id="page_123"/><a id="ch08fig6"/><img src="../images/f0123-01.jpg" alt="image"/></div>
<p class="figcap"><strong>FIGURE 8-6:</strong> LED matrix displaying a sad face when the game ends</p>
<h3 class="h3" id="lev96"><span class="green2"><strong>TAKING IT FURTHER</strong></span></h3>
<p class="noindent">Here are some ideas to upgrade your game:</p>
<ul>
<li class="noindent">Decrease the delay time as the game continues to increase the level of difficulty.</li>
<li class="noindent">Add a scoring system so that you earn a point every time the ball hits the bat, and display the score on the screen.</li>
<li class="noindent">Insert a condition that restarts the game when you press the joystick.<span epub:type="pagebreak" id="page_124"/></li>
</ul>
</div>
  </body>
</html>
