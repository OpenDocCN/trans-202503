<html><head></head><body>
<h2 class="h2" id="ch12"><span class="big"><strong>12</strong></span><br/><strong>EXCEPTIONS, TIMINGS, AND VISIBILITY</strong></h2>&#13;
<div class="image"><img src="../images/common-01.jpg" alt="image"/></div>&#13;
<p class="noindent">Now that you’ve seen how to write your own functions in R, let’s examine some common function augmentations and behaviors. In this chapter, you’ll learn how to make your functions throw an error or warning when they receive unexpected input. You’ll also see some simple ways to measure completion time and check progress for computationally expensive functions. Finally, you’ll see how R masks functions when two have the same name but reside in different packages.</p>&#13;
<h3 class="h3" id="ch12lev1sec39"><strong>12.1 Exception Handling</strong></h3>&#13;
<p class="noindent">When there’s an unexpected problem during execution of a function, R will notify you with either a <em>warning</em> or an <em>error</em>. In this section, I’ll demonstrate how to build these constructs into your own functions where appropriate. I’ll also show how to <em>try</em> a calculation to check whether it’s possible without an error (that is, to see whether it’ll even work).</p>&#13;
<h4 class="h4" id="ch12lev2sec106"><span epub:type="pagebreak" id="page_242"/><strong><em>12.1.1 Formal Notifications: Errors and Warnings</em></strong></h4>&#13;
<p class="noindent">In <a href="ch11.xhtml#ch11">Chapter 11</a>, you made your functions print a string (for example, <code>"no valid matrices"</code>) when they couldn’t perform certain operations. Warnings and errors are more formal mechanisms designed to convey these types of messages and handle subsequent operations. An error forces the function to immediately terminate at the point it occurs. A warning is less severe. It indicates that the function is being run in an atypical way but tries to work around the issue and continue executing. In R, you can issue warnings with the <code>warning</code> command, and you can throw errors with the <code>stop</code> command. The following two functions show an example of each:</p>&#13;
<pre>warn_test &lt;- function(x){<br/>    if(x&lt;=0){<br/>        warning("'x' is less than or equal to 0 but setting it to 1 and<br/>                continuing")<br/>        x &lt;- 1<br/>    }<br/>    return(5/x)<br/>}<br/><br/>error_test &lt;- function(x){<br/>    if(x&lt;=0){<br/>        stop("'x' is less than or equal to 0... TERMINATE")<br/>    }<br/>    return(5/x)<br/>}</pre>&#13;
<p class="indent">Both <code>warn_test</code> and <code>error_test</code> divide 5 by the argument <code>x</code>. They also both expect <code>x</code> to be positive. In <code>warn_test</code>, if <code>x</code> is nonpositive, the function issues a warning, and <code>x</code> is overwritten to be <code>1</code>. In <code>error_test</code>, on the other hand, if <code>x</code> is nonpositive, the function throws an error and terminates immediately. The two commands <code>warning</code> and <code>stop</code> are used with a character string argument, which becomes the message printed to the console.</p>&#13;
<p class="indent">You can see these notifications by importing and calling the functions as follows:</p>&#13;
<pre>R&gt; warn_test(0)<br/>[1] 5<br/>Warning message:<br/>In warn_test(0) :<br/>  'x' is less than or equal to 0 but setting it to 1 and continuing<br/>R&gt; error_test(0)<br/>Error in error_test(0) : 'x' is less than or equal to 0... TERMINATE</pre>&#13;
<p class="indent">Notice that <code>warn_test</code> has continued to execute and returned the value <code>5</code>—the result of <code>5/1</code> after setting <code>x</code> to <code>1</code>. The call to <code>error_test</code> did not return anything because R exited the function at the <code>stop</code> command.</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_243"/>Warnings are useful when there’s a natural way for a function to try to save itself even when it doesn’t get the input it expects. For example, in <a href="ch10.xhtml#ch10lev2sec89">Section 10.1.3</a>, R issued a warning when you supplied a logical vector of elements to the <code>if</code> statement. Remember that the <code>if</code> statement expects a single logical value, but rather than quit when a logical vector is provided instead, it continues execution using just the first entry in the supplied vector. That said, sometimes it’s more appropriate to actually throw an error and stop execution altogether.</p>&#13;
<p class="indent">Let’s go back to <code>myfibrec</code> from <a href="ch11.xhtml#ch11lev2sec105">Section 11.3.3</a>. This function expects a positive integer (the position of the Fibonacci number it should return). Suppose you assume that if the user supplies a negative integer, the user actually means the positive version of that term. You can add a warning to handle this situation. Meanwhile, if the user enters 0, which doesn’t correspond to any position in the Fibonacci series, the code will throw an error. Consider these modifications:</p>&#13;
<pre>myfibrec2 &lt;- function(n){<br/>    if(n&lt;0){<br/>        warning("Assuming you meant 'n' to be positive -- doing that instead")<br/>        n &lt;- n*-1<br/>    } else if(n==0){<br/>        stop("'n' is uninterpretable at 0")<br/>    }<br/><br/>    if(n==1||n==2){<br/>        return(1)<br/>    } else {<br/>        return(myfibrec2(n-1)+myfibrec2(n-2))<br/>    }<br/>}</pre>&#13;
<p class="indent">In <code>myfibrec2</code>, you now check whether <code>n</code> is negative or zero. If it’s negative, the function issues a warning and continues executing after swapping the argument’s sign. If <code>n</code> is zero, an error halts execution with a corresponding message. Here you can see the responses for a few different arguments:</p>&#13;
<pre>R&gt; myfibrec2(6)<br/>[1] 8<br/>R&gt; myfibrec2(-3)<br/>[1] 2<br/>Warning message:<br/>In myfibrec2(-3) :<br/>  Assuming you meant 'n' to be positive -- doing that instead<br/>R&gt; myfibrec2(0)<br/>Error in myfibrec2(0) : 'n' is uninterpretable at 0</pre>&#13;
<p class="indent">Note that the call to <code>myfibrec2(-3)</code> has returned the third Fibonacci number.</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_244"/>Broadly speaking, both errors and warnings signal that something has gone wrong. If you’re using a certain function or running chunks of code and you encounter these kinds of messages, you should look carefully at what has been run and what may have occurred to spark them.</p>&#13;
<div class="note">&#13;
<p class="notet"><strong><span class="notes">NOTE</span></strong></p>&#13;
<p class="notep"><em>Identifying and repairing erroneous code is referred to as</em> debugging<em>, for which there are various strategies. One of the most basic strategies involves including</em> <code><span class="codeitalic">print</code></span> <em>or</em> <code><span class="codeitalic">cat</code></span> <em>commands to inspect various quantities as they are calculated during live execution. R does have some more sophisticated debugging tools; if you’re interested, check out the excellent discussion of them provided in <a href="ch13.xhtml#ch13">Chapter 13</a> of</em> The Art of R Programming <em>by Matloff (<a href="ref.xhtml#ref44">2011</a>). A more general discussion can be found in</em> The Art of Debugging <em>by Matloff and Salzman (<a href="ref.xhtml#ref45">2008</a>). As you gain more experience in R, understanding error messages or locating potential problems in code before they arise becomes easier and easier, a benefit you get partly because of R’s interpretative style.</em></p>&#13;
</div>&#13;
<h4 class="h4" id="ch12lev2sec107"><strong><em>12.1.2 Catching Errors with try Statements</em></strong></h4>&#13;
<p class="noindent">When a function terminates from an error, it also terminates any parent functions. For example, if function A calls function B and function B halts because of an error, this halts execution of A at the same point. To avoid this severe consequence, you can use a <code>try</code> statement to attempt a function call and check whether it produces an error. You can also use an <code>if</code> statement to specify alternative operations, rather than allowing all processes to cease.</p>&#13;
<p class="indent">For example, if you call the <code>myfibrec2</code> function from earlier and pass it 0, the function throws an error and terminates. But watch what happens when you pass that function call as the first argument to <code>try</code>:</p>&#13;
<pre>R&gt; attempt1 &lt;- try(myfibrec2(0),silent=TRUE)</pre>&#13;
<p class="indent">Nothing seems to happen. What’s happened to the error? In fact, the error has still occurred, but <code>try</code> has suppressed the printing of an error message to the console because you passed it the argument <code>silent</code> set to <code>TRUE</code>. The error information is now stored in the object <code>attempt1</code>, which is of class <code>"try-error"</code>. To see the error, simply print <code>attempt1</code> to the console:</p>&#13;
<pre>R&gt; attempt1<br/>[1] "Error in myfibrec2(0) : 'n' is uninterpretable at 0\n"<br/>attr(,"class")<br/>[1] "try-error"<br/>attr(,"condition")<br/>&lt;simpleError in myfibrec2(0): 'n' is uninterpretable at 0&gt;</pre>&#13;
<p class="indent">You would have seen this printed to the console if you’d left <code>silent</code> set to <code>FALSE</code>. Catching an error this way can be really handy, especially when a function produces the error in the body code of another function. Using <code>try</code>, you can handle the error without terminating that parent function.</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_245"/>Meanwhile, if you pass a function to <code>try</code> and it doesn’t throw an error, then <code>try</code> has no effect, and you simply get the normal return value.</p>&#13;
<pre>R&gt; attempt2 &lt;- try(myfibrec2(6),silent=TRUE)<br/>R&gt; attempt2<br/>[1] 8</pre>&#13;
<p class="indent">Here, you executed <code>myfibrec2</code> with a valid argument, <code>n=6</code>. Since this call doesn’t result in an error, the result passed to <code>attempt2</code> is the normal return value from <code>myfibrec2</code>, in this case <code>8</code>.</p>&#13;
<h5 class="h5" id="ch12lev3sec32"><strong>Using try in the Body of a Function</strong></h5>&#13;
<p class="noindent">Let’s see a more complete example of how you could use <code>try</code> in a larger function. The following <code>myfibvector</code> function takes a vector of indexes as the argument <code>nvec</code> and provides the corresponding terms from the Fibonacci sequence:</p>&#13;
<pre>myfibvector &lt;- function(nvec){<br/>    nterms &lt;- length(nvec)<br/>    result &lt;- rep(0,nterms)<br/>    for(i in 1:nterms){<br/>        result[i] &lt;- myfibrec2(nvec[i])<br/>    }<br/>    return(result)<br/>}</pre>&#13;
<p class="indent">This function uses a <code>for</code> loop to work through <code>nvec</code> element by element, computing the corresponding Fibonacci number with the earlier function, <code>myfibrec2</code>. As long as all the values in <code>nvec</code> are nonzero, <code>myfibvector</code> works just fine. For example, the following call obtains the first, the second, the tenth, and the eighth Fibonacci number:</p>&#13;
<pre>R&gt; foo &lt;- myfibvector(nvec=c(1,2,10,8))<br/>R&gt; foo<br/>[1]  1  1 55 21</pre>&#13;
<p class="indent">Suppose, however, there’s a mistake and one of the entries in <code>nvec</code> ends up being zero.</p>&#13;
<pre>R&gt; bar &lt;- myfibvector(nvec=c(3,2,7,0,9,13))<br/>Error in myfibrec2(nvec[i]) : 'n' is uninterpretable at 0</pre>&#13;
<p class="indent">The internal call to <code>myfibrec2</code> has thrown an error when it’s called on <code>n=0</code>, and this has terminated execution of <code>myfibvector</code>. Nothing is returned, and the entire call has failed.</p>&#13;
<p class="indent">You can prevent this outright failure by using <code>try</code> within the <code>for</code> loop to check each call to <code>myfibrec2</code> and have it catch any errors. The following function, <code>myfibvectorTRY</code>, does just that.</p>&#13;
<pre><span epub:type="pagebreak" id="page_246"/>myfibvectorTRY &lt;- function(nvec){<br/>    nterms &lt;- length(nvec)<br/>    result &lt;- rep(0,nterms)<br/>    for(i in 1:nterms){<br/>        attempt &lt;- try(myfibrec2(nvec[i]),silent=T)<br/>        if(class(attempt)=="try-error"){<br/>            result[i] &lt;- NA<br/>        } else {<br/>            result[i] &lt;- attempt<br/>        }<br/>    }<br/>    return(result)<br/>}</pre>&#13;
<p class="indent">Here, within the <code>for</code> loop, you use <code>attempt</code> to store the result of trying each call to <code>myfibrec2</code>. Then, you inspect <code>attempt</code>. If this object’s class is <code>"try-error"</code>, that means <code>myfibrec2</code> produced an error, and you fill the corresponding slot in the <code>result</code> vector with <code>NA</code>. Otherwise, <code>attempt</code> will represent a valid return value from <code>myfibrec2</code>, so you place it in the corresponding slot of the <code>result</code> vector. Now if you import and call <code>myfibvectorTRY</code> on the same <code>nvec</code>, you see a complete set of results.</p>&#13;
<pre>R&gt; baz &lt;- myfibvectorTRY(nvec=c(3,2,7,0,9,13))<br/>R&gt; baz<br/>[1]   2   1  13  NA  34 233</pre>&#13;
<p class="indent">The error that would have otherwise terminated everything was silently caught, and the alternative response in this situation, <code>NA</code>, was inserted into the <code>result</code> vector.</p>&#13;
<div class="note">&#13;
<p class="notet"><strong><span class="notes">NOTE</span></strong></p>&#13;
<p class="notep"><em>The</em> <code><span class="codeitalic">try</code></span> <em>command is a simplification of R’s more complex</em> <code><span class="codeitalic">tryCatch</code></span> <em>function, which is beyond the scope of this book, but it provides more precise control over how you test and execute chunks of code. If you’re interested in learning more, enter</em> <code><span class="codeitalic">?tryCatch</code></span> <em>in the console.</em></p>&#13;
</div>&#13;
<h5 class="h5" id="ch12lev3sec33"><strong>Suppressing Warning Messages</strong></h5>&#13;
<p class="noindent">In all the <code>try</code> calls I’ve shown so far, I’ve set the <code>silent</code> argument to <code>TRUE</code>, which stops any error messages from being printed. If you leave <code>silent</code> set to <code>FALSE</code> (the default value), the error message will be printed, but the error will still be caught without terminating execution.</p>&#13;
<p class="indent">Note that setting <code>silent=TRUE</code> only suppresses error messages, not warnings. Observe the following:</p>&#13;
<pre>R&gt; attempt3 &lt;- try(myfibrec2(-3),silent=TRUE)<br/>Warning message:<br/>In myfibrec2(-3) :<br/>  Assuming you meant 'n' to be positive -- doing that instead<br/>R&gt; attempt3<br/>[1] 2</pre>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_247"/>Although <code>silent</code> was <code>TRUE</code>, the warning (for negative values of <code>n</code> in this example) is still issued and printed. Warnings are treated separately from errors in this type of situation, as they should be—they can highlight other unforeseen issues with your code during execution. If you are absolutely sure you don’t want to see any warnings, you can use <code>suppressWarnings</code>.</p>&#13;
<pre>R&gt; attempt4 &lt;- suppressWarnings(myfibrec2(-3))<br/>R&gt; attempt4<br/>[1] 2</pre>&#13;
<p class="indent">The <code>suppressWarnings</code> function should be used only if you are certain that every warning in a given call can be safely ignored and you want to keep the output tidy.</p>&#13;
<div class="ex">&#13;
<p class="ext"><a id="ch12exc1"/><strong>Exercise 12.1</strong></p>&#13;
<ol type="a">&#13;
<li><p class="noindents">In <a href="ch11.xhtml#ch11exc3">Exercise 11.3</a> (b) on <a href="ch11.xhtml#page_238">page 238</a>, your task was to write a recursive R function to compute integer factorials, given some supplied non-negative integer <code>x</code>. Now, modify your function so that it throws an error (with an appropriate message) if <code>x</code> is negative. Test your new function responses by using the following:</p>&#13;
<ol type="i">&#13;
<li><p class="noindents"><code>x</code> as <code>5</code></p></li>&#13;
<li><p class="noindents"><code>x</code> as <code>8</code></p></li>&#13;
<li><p class="noindents"><code>x</code> as <code>-8</code></p></li>&#13;
</ol></li>&#13;
<li><p class="noindents">The idea of <em>matrix inversion</em>, briefly discussed in <a href="ch03.xhtml#ch03lev2sec34">Section 3.3.6</a>, is possible only for certain square matrices (those with an equal number of columns as rows). These inversions can be computed using the <code>solve</code> function, for example:</p>&#13;
<pre>R&gt; solve(matrix(1:4,2,2))<br/>     [,1] [,2]<br/>[1,]   -2  1.5<br/>[2,]    1 -0.5</pre>&#13;
<p class="indent">Note that <code>solve</code> throws an error if the supplied matrix cannot be inverted. With this in mind, write an R function that attempts to invert each matrix in a list, according to the following guidelines:</p>&#13;
<p class="dash">– The function should take four arguments.</p>&#13;
<p class="d-star">* The list <code>x</code> whose members are to be tested for matrix inversion</p>&#13;
<p class="d-star"><span epub:type="pagebreak" id="page_248"/>* A value <code>noninv</code> to fill in results where a given matrix member of <code>x</code> cannot be inverted, defaulting to <code>NA</code></p>&#13;
<p class="d-star">* A character string <code>nonmat</code> to be the result if a given member of <code>x</code> is not a matrix, defaulting to <code>"not a matrix"</code></p>&#13;
<p class="d-star">* A logical value <code>silent</code>, defaulting to <code>TRUE</code>, to be passed to <code>try</code> in the body code</p>&#13;
<p class="dash">– The function should first check whether <code>x</code> is in fact a list. If not, it should throw an error with an appropriate message.</p>&#13;
<p class="dash">– Then, the function should ensure that <code>x</code> has at least one member. If not, it should throw an error with an appropriate message.</p>&#13;
<p class="dash">– Next, the function should check whether <code>nonmat</code> is a character string. If not, it should try to coerce it to a character string using an appropriate “as-dot” function (see <a href="ch06.xhtml#ch06lev2sec62">Section 6.2.4</a>), and it should issue an appropriate warning.</p>&#13;
<p class="dash">– After these checks, a loop should search each member <code>i</code> of the list <code>x</code>.</p>&#13;
<p class="d-star">* If member <code>i</code> is a matrix, attempt to invert it with <code>try</code>. If it’s invertible without error, overwrite member <code>i</code> of <code>x</code> with the result. If an error is caught, then member <code>i</code> of <code>x</code> should be overwritten with the value of <code>noninv</code>.</p>&#13;
<p class="d-star">* If member <code>i</code> is not a matrix, then member <code>i</code> of <code>x</code> should be overwritten with the value of <code>nonmat</code>.</p>&#13;
<p class="dash">– Finally, the modified list <code>x</code> should be returned.</p>&#13;
<p class="indent">Now, test your function using the following argument values to make sure it responds as expected:</p>&#13;
<ol type="i">&#13;
<li><p class="noindents"><code>x</code> as</p>&#13;
<pre>list(1:4,matrix(1:4,1,4),matrix(1:4,4,1),matrix(1:4,2,2))</pre></li>&#13;
</ol>&#13;
<p class="noindentz">and all other arguments at default.</p>&#13;
<ol type="i" start="2">&#13;
<li><p class="noindents"><code>x</code> as in (i), <code>noninv</code> as <code>Inf</code>, <code>nonmat</code> as <code>666</code>, <code>silent</code> at default.</p></li>&#13;
<li><p class="noindents">Repeat (ii), but now with <code>silent=FALSE</code>.</p></li>&#13;
<li><p class="noindents"><code>x</code> as</p></li>&#13;
</ol>&#13;
<pre>list(diag(9),matrix(c(0.2,0.4,0.2,0.1,0.1,0.2),3,3),<br/>     rbind(c(5,5,1,2),c(2,2,1,8),c(6,1,5,5),c(1,0,2,0)),<br/>     matrix(1:6,2,3),cbind(c(3,5),c(6,5)),as.vector(diag(2)))</pre>&#13;
<p class="noindentz">and <code>noninv</code> as <code>"unsuitable matrix"</code>; all other values at default.</p>&#13;
<p class="indentt">Finally, test the error messages by attempting calls to your function with the following:</p>&#13;
<ol type="i" start="5">&#13;
<li><p class="noindents"><code>x</code> as <code>"hello"</code></p></li>&#13;
<li><p class="noindents"><code>x</code> as <code>list()</code></p></li>&#13;
</ol></li>&#13;
</ol>&#13;
</div>&#13;
<h3 class="h3" id="ch12lev1sec40"><span epub:type="pagebreak" id="page_249"/><strong>12.2 Progress and Timing</strong></h3>&#13;
<p class="noindent">R is often used for lengthy numeric exercises, such as simulation or random variate generation. For these complex, time-consuming operations, it’s often useful to keep track of progress or see how long a certain task took to complete. For example, you may want to compare the speed of two different programming approaches to a given problem. In this section, you’ll look at ways to time code execution and show its progress.</p>&#13;
<h4 class="h4" id="ch12lev2sec108"><strong><em>12.2.1 Textual Progress Bars: Are We There Yet?</em></strong></h4>&#13;
<p class="noindent">A <em>progress bar</em> shows how far along R is as it executes a set of operations. To show how this works, you need to run code that takes a while to execute, which you’ll do by making R <em>sleep</em>. The <code>Sys.sleep</code> command makes R pause for a specified amount of time, in seconds, before continuing.</p>&#13;
<pre>R&gt; Sys.sleep(3)</pre>&#13;
<p class="indent">If you run this code, R will pause for three seconds before you can continue using the console. Sleeping will be used in this section as a surrogate for the delay caused by computationally expensive operations, which is where progress bars are most useful.</p>&#13;
<p class="indent">To use <code>Sys.sleep</code> in a more common fashion, consider the following:</p>&#13;
<pre>sleep_test &lt;- function(n){<br/>    result &lt;- 0<br/>    for(i in 1:n){<br/>        result &lt;- result + 1<br/>        Sys.sleep(0.5)<br/>    }<br/>    return(result)<br/>}</pre>&#13;
<p class="indent">The <code>sleep_test</code> function is basic—it takes a positive integer <code>n</code> and adds <code>1</code> to the <code>result</code> value for <code>n</code> iterations. At each iteration, you also tell the loop to sleep for a half second. Because of that sleep command, executing the following code takes about four seconds to return a result:</p>&#13;
<pre>R&gt; sleep_test(8)<br/>[1] 8</pre>&#13;
<p class="indent">Now, say you want to track the progress of this type of function as it executes. You can implement a textual progress bar with three steps: initialize the bar object with <code>txtProgressBar</code>, update the bar with <code>setTxtProgressBar</code>, and terminate the bar with <code>close</code>. The next function, <code>prog_test</code>, modifies <code>sleep_test</code> to include those three commands.</p>&#13;
<pre><span epub:type="pagebreak" id="page_250"/>prog_test &lt;- function(n){<br/>    result &lt;- 0<br/>    progbar &lt;- txtProgressBar(min=0,max=n,style=1,char="=")<br/>    for(i in 1:n){<br/>        result &lt;- result + 1<br/>        Sys.sleep(0.5)<br/>        setTxtProgressBar(progbar,value=i)<br/>    }<br/>    close(progbar)<br/>    return(result)<br/>}</pre>&#13;
<p class="indent">Before the <code>for</code> loop, you create an object named <code>progbar</code> by calling <code>txtProgressBar</code> with four arguments. The <code>min</code> and <code>max</code> arguments are numeric values that define the limits of the bar. In this case, you set <code>max=n</code>, which matches the number of iterations of the impending <code>for</code> loop. The <code>style</code> argument (integer, either <code>1</code>, <code>2</code>, or <code>3</code>) and the <code>char</code> argument (character string, usually a single character) govern the appearance of the bar. Setting <code>style=1</code> means the bar will simply display a line of <code>char</code>; with <code>char="="</code> it’ll be a series of equal signs.</p>&#13;
<p class="indent">Once this object is created, you have to instruct the bar to actually progress during execution with a call to <code>setTxtProgressBar</code>. You pass in the bar object to update (<code>progbar</code>) and the <code>value</code> it should update to (in this case, <code>i</code>). Once complete (after exiting the loop), the progress bar must be terminated with a call to <code>close</code>, passing in the bar object of interest. Import and execute <code>prog_test</code>, and you’ll see the line of <code>"="</code> drawn in steps as the loop completes.</p>&#13;
<pre>R&gt; prog_test(8)<br/>================================================================<br/>[1] 8</pre>&#13;
<p class="indent">The width of the bar is, by default, determined by the width of the R console pane upon execution of the <code>txtProgressBar</code> command. You can customize the bar a bit by changing the <code>style</code> and <code>char</code> arguments. Choosing <code>style=3</code>, for example, shows the bar as well as a “percent completed” counter. Some packages offer more elaborate options too, such as pop-up widgets, but the textual version is the simplest and most universally compatible version across different systems.</p>&#13;
<h4 class="h4" id="ch12lev2sec109"><strong><em>12.2.2 Measuring Completion Time: How Long Did It Take?</em></strong></h4>&#13;
<p class="noindent">If you want to know how long a computation takes to complete, you can use the <code>Sys.time</code> command. This command outputs an object that details current date and time information based on your system.</p>&#13;
<pre><span epub:type="pagebreak" id="page_251"/>R&gt; Sys.time()<br/>[1] "2016-03-06 16:39:27 NZDT"</pre>&#13;
<p class="indent">You can store objects like these before and after some code and then compare them to see how much time has passed. Enter this in the editor:</p>&#13;
<pre>t1 &lt;- Sys.time()<br/>Sys.sleep(3)<br/>t2 &lt;- Sys.time()<br/>t2-t1</pre>&#13;
<p class="indent">Now highlight all four lines and execute them in the console.</p>&#13;
<pre>R&gt; t1 &lt;- Sys.time()<br/>R&gt; Sys.sleep(3)<br/>R&gt; t2 &lt;- Sys.time()<br/>R&gt; t2-t1<br/>Time difference of 3.012889 secs</pre>&#13;
<p class="indent">By executing this entire code block together, you get an easy measure of the total completion time in a nicely formatted string printed to the console. Note that there’s a small time cost for interpreting and invoking any commands, in addition to the three seconds you tell R to sleep. This time will vary between computers.</p>&#13;
<p class="indent">If you need more detailed timing reports, there are more sophisticated tools. For example, you can use <code>proc.time()</code> to receive not just the total elapsed “wall clock” time but also computer-related CPU timings (see the definitions in the help file <code>?proc.time</code>). To time a single expression, you can also use the <code>system.time</code> function (which uses the same detail of output as <code>proc.time</code>). There are also <em>benchmarking</em> tools (formal or systematic comparisons of different approaches) for timing your code; see, for example, the <code>rbenchmark</code> package (<a href="ref.xhtml#ref38">Kusnierczyk, 2012</a>). However, for everyday use, the time-object differencing approach used here is easy to interpret and provides a good indication of the computational expense.</p>&#13;
<div class="ex">&#13;
<p class="ext"><a id="ch12exc2"/><strong>Exercise 12.2</strong></p>&#13;
<ol type="a">&#13;
<li><p class="noindents">Modify <code>prog_test</code> from <a href="ch12.xhtml#ch12lev2sec108">Section 12.2.1</a> to include an ellipsis in its argument list, intended to take values for the additional arguments in <code>txtProgressBar</code>; name the new function <code>prog_test_fancy</code>. Time how long it takes a call to <code>prog_test_fancy</code> to execute. Set <code>50</code> as <code>n</code>, instruct the progress bar (through the ellipsis) to use <code>style=3</code>, and set the bar character to be <code>"r"</code>.</p></li>&#13;
<li><p class="noindents"><span epub:type="pagebreak" id="page_252"/>In <a href="ch12.xhtml#ch12lev2sec107">Section 12.1.2</a>, you defined a function named <code>myfibvectorTRY</code> (which itself calls <code>myfibrec2</code> from <a href="ch12.xhtml#ch12lev2sec106">Section 12.1.1</a>) to return multiple terms from the Fibonacci sequence based on a supplied “term vector” <code>nvec</code>. Write a new version of <code>myfibvectorTRY</code> that includes a progress bar of <code>style=3</code> and a character of your choosing that increments at each pass of the internal <code>for</code> loop. Then, do the following:</p>&#13;
<ol type="i">&#13;
<li><p class="noindents">Use your new function to reproduce the results from the text where <code>nvec=c(3,2,7,0,9,13)</code>.</p></li>&#13;
<li><p class="noindents">Time how long it takes to use your new function to return the first 35 terms of the Fibonacci sequence. What do you notice, and what does this say about your recursive Fibonacci functions?</p></li>&#13;
</ol></li>&#13;
<li><p class="noindents">Remain with the Fibonacci sequence. Write a stand-alone <code>for</code> loop that can compute, and store in a vector, the same first 35 terms as in (b)(ii). Time it. Which approach would you prefer?</p></li>&#13;
</ol>&#13;
</div>&#13;
<h3 class="h3" id="ch12lev1sec41"><strong>12.3 Masking</strong></h3>&#13;
<p class="noindent">With the plethora of built-in and contributed data and functionality available for R, it is virtually inevitable that at some point you will come across objects, usually functions, that share the same name in distinctly different loaded packages.</p>&#13;
<p class="indent">So, what happens in those instances? For example, say you define a function with the same name as a function in an R package that you have already loaded. R responds by <em>masking</em> one of the objects—that is, one object or function will take precedence over the other and assume the object or function name, while the masked function must be called with an additional command. This protects objects from overwriting or blocking one another. In this section, you’ll look at the two most common masking situations in R.</p>&#13;
<h4 class="h4" id="ch12lev2sec110"><strong><em>12.3.1 Function and Object Distinction</em></strong></h4>&#13;
<p class="noindent">When two functions or objects in different environments have the same name, the object that comes earlier in the search path will mask the later one. That is, when the object is sought, R will use the object or function it finds first, and you’ll need extra code to access the other, masked version. Remember, you can see the current search path by executing <code>search()</code>.</p>&#13;
<pre>R&gt; search()<br/> [1] ".GlobalEnv"        "tools:RGUI"        "package:stats"<br/> [4] "package:graphics"  "package:grDevices" "package:utils"<br/> [7] "package:datasets"  "package:methods"   "Autoloads"<br/>[10] "package:base"</pre>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_253"/>When R searches, the function or object that falls closest to the start of the search path (the global environment) is reached first and masks the function or object of the same name that occurs somewhere later in the search path. To see a simple example of masking, you’ll define a function with the same name as a function in the base package: <code>sum</code>. Here’s how <code>sum</code> works normally, adding up all the elements in the vector <code>foo</code>:</p>&#13;
<pre>R&gt; foo &lt;- c(4,1.5,3)<br/>R&gt; sum(foo)<br/>[1] 8.5</pre>&#13;
<p class="indent">Now, suppose you were to enter the following function:</p>&#13;
<pre>sum &lt;- function(x){<br/>    result &lt;- 0<br/>    for(i in 1:length(x)){<br/>        result &lt;- result + x[i]^2<br/>    }<br/>    return(result)<br/>}</pre>&#13;
<p class="indent">This version of <code>sum</code> takes in a vector <code>x</code> and uses a <code>for</code> loop to square each element before summing them and returning the result. This can be imported into the R console without any problem, but clearly, it doesn’t offer the same functionality as the (original) built-in version of <code>sum</code>. Now, after importing the function, if you make a call to <code>sum</code>, your version is used.</p>&#13;
<pre>R&gt; sum(foo)<br/>[1] 27.25</pre>&#13;
<p class="indent">This happens because the user-defined function is stored in the global environment (<code>.GlobalEnv</code>), which always comes first in the search path. R’s built-in function is part of the <code>base</code> package, which comes at the end of the search path. In this case, the user-defined function is masking the original.</p>&#13;
<p class="indent">Now, if you want R to run the <code>base</code> version of <code>sum</code>, you have to include the name of its package in the call, with a double colon.</p>&#13;
<pre>R&gt; base::sum(foo)<br/>[1] 8.5</pre>&#13;
<p class="indent">This tells R to use the version in <code>base</code>, even though there’s another version of the function in the global environment.</p>&#13;
<p class="indent">To avoid any confusion, let’s remove the <code>sum</code> function from the global environment.</p>&#13;
<pre>R&gt; rm(sum)</pre>&#13;
<h5 class="h5" id="ch12lev3sec34"><span epub:type="pagebreak" id="page_254"/><strong>When Package Objects Clash</strong></h5>&#13;
<p class="noindent">When you load a package, R will notify you if any objects in the package clash with other objects that are accessible in the present session. To illustrate this, I’ll make use of two contributed packages: the <code>car</code> package (you saw this earlier in <a href="ch08.xhtml#ch8exc1">Exercise 8.1</a> (b) on <a href="ch08.xhtml#page_162">page 162</a>) and the <code>spatstat</code> package (you’ll use this in <a href="part05.xhtml#part05">Part V</a>). After ensuring these two packages are installed, when I load them in the following order, I see this message:</p>&#13;
<pre>R&gt; library("spatstat")<br/>spatstat 1.40-0       (nickname: 'Do The Maths')<br/>For an introduction to spatstat, type 'beginner'<br/>R&gt; library("car")<br/><br/>Attaching package: 'car'<br/><br/>The following object is masked from 'package:spatstat':<br/><br/>    ellipse</pre>&#13;
<p class="indent">This indicates that the two packages each have an object with the same name—<code>ellipse</code>. R has automatically notified you that this object is being masked. Note that the functionality of both <code>car</code> and <code>spatstat</code> remains completely available; it’s just that the <code>ellipse</code> objects require some distinction should they be needed. Using <code>ellipse</code> at the prompt will access <code>car</code>’s object since that package was loaded more recently. To use <code>spatstat</code>’s version, you must type <code>spatstat::ellipse</code>. These rules also apply to accessing the respective help files.</p>&#13;
<p class="indent">A similar notification occurs when you load a package with an object that’s masked by a global environment object (a global environment object will always take precedence over a package object). To see an example, you can load the <code>MASS</code> package (<a href="ref.xhtml#ref69">Venables and Ripley, 2002</a>), which is included with R but isn’t automatically loaded. Continuing in the current R session, create the following object:</p>&#13;
<pre>R&gt; cats &lt;- "meow"</pre>&#13;
<p class="indent">Now, suppose you need to load <code>MASS</code>.</p>&#13;
<pre>R&gt; library("MASS")<br/><br/>Attaching package: 'MASS'<br/><br/>The following object is masked _by_ '.GlobalEnv':<br/><br/>    cats<br/><br/>The following object is masked from 'package:spatstat':<br/><br/>    area</pre>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_255"/>Upon loading the package, you’re informed that the <code>cats</code> object you’ve just created is masking an object of the same name in <code>MASS</code>. (As you can see with <code>?MASS::cats</code>, this object is a data frame with weight measurements of household felines.) Furthermore, it appears <code>MASS</code> also shares an object name with <code>spatstat</code>—<code>area</code>. The same kind of “package masking” message as shown earlier is also displayed for that particular item.</p>&#13;
<h5 class="h5" id="ch12lev3sec35"><strong>Unmounting Packages</strong></h5>&#13;
<p class="noindent">You can unmount loaded packages from the search path. With the packages loaded in this discussion, my current search path looks like this:</p>&#13;
<pre>R&gt; search()<br/> [1] ".GlobalEnv"        "package:MASS"      "package:car"<br/> [4] "package:spatstat"  "tools:RGUI"        "package:stats"<br/> [7] "package:graphics"  "package:grDevices" "package:utils"<br/>[10] "package:datasets"  "package:methods"   "Autoloads"<br/>[13] "package:base"</pre>&#13;
<p class="indent">Now, suppose you don’t need <code>car</code> anymore. You can remove it with the <code>detach</code> function as follows.</p>&#13;
<pre>R&gt; detach("package:car",unload=TRUE)<br/>R&gt; search()<br/> [1] ".GlobalEnv"        "package:MASS"     "package:spatstat"<br/> [4] "tools:RGUI"        "package:stats"    "package:graphics"<br/> [7] "package:grDevices" "package:utils"    "package:datasets"<br/>[10] "package:methods"   "Autoloads"        "package:base"</pre>&#13;
<p class="indent">This removes the elected package from the path, unloading its namespace. Now, the functionality of <code>car</code> is no longer immediately available, and <code>spatstat</code>’s <code>ellipsis</code> function is no longer masked.</p>&#13;
<div class="note">&#13;
<p class="notet"><strong><span class="notes">NOTE</span></strong></p>&#13;
<p class="notep"><em>As contributed packages get updated by their maintainers, they may include new objects that spark new maskings or remove or rename objects that previously caused maskings (when compared with other contributed packages). The specific maskings illustrated here among</em> <code><span class="codeitalic">car</code></span>, <code><span class="codeitalic">spatstat</code></span><em>, and</em> <code><span class="codeitalic">MASS</code></span> <em>occur at the time of writing with the versions available and may change in the future.</em></p>&#13;
</div>&#13;
<h4 class="h4" id="ch12lev2sec111"><strong><em>12.3.2 Data Frame Variable Distinction</em></strong></h4>&#13;
<p class="noindent">There’s one other common situation in which you’ll be explicitly notified of masking: when you add a data frame to the search path. Let’s see how <span epub:type="pagebreak" id="page_256"/>this works. Continuing in the current workspace, define the following data frame:</p>&#13;
<pre>R&gt; foo &lt;- data.frame(surname=c("a","b","c","d"),<br/>                     sex=c(0,1,1,0),height=c(170,168,181,180),<br/>                     stringsAsFactors=F)<br/>R&gt; foo<br/>  surname sex height<br/>1       a   0    170<br/>2       b   1    168<br/>3       c   1    181<br/>4       d   0    180</pre>&#13;
<p class="indent">The data frame <code>foo</code> has three column variables: <code>person</code>, <code>sex</code>, and <code>height</code>. To access one of these columns, normally you need to use the <code>$</code> operator and enter something like <code>foo$surname</code>. However, you can <em>attach</em> a data frame directly to your search path, which makes it easier to access a variable.</p>&#13;
<pre>R&gt; attach(foo)<br/>R&gt; search()<br/> [1] ".GlobalEnv"        "foo"               "package:MASS"<br/> [4] "package:spatstat"  "tools:RGUI"        "package:stats"<br/> [7] "package:graphics"  "package:grDevices" "package:utils"<br/>[10] "package:datasets"  "package:methods"   "Autoloads"<br/>[13] "package:base"</pre>&#13;
<p class="indent">Now the <code>surname</code> variable is directly accessible.</p>&#13;
<pre>R&gt; surname<br/>[1] "a" "b" "c" "d"</pre>&#13;
<p class="indent">This saves you from having to enter <code>foo$</code> every time you want to access a variable, which can be a handy shortcut if your analysis deals exclusively with one static, unchanging data frame. However, if you forget about your attached objects, they can cause problems later, especially if you continue to mount more objects onto the search path in the same session. For example, say you enter another data frame.</p>&#13;
<pre>R&gt; bar &lt;- data.frame(surname=c("e","f","g","h"),<br/>                     sex=c(1,0,1,0),weight=c(55,70,87,79),<br/>                     stringsAsFactors=F)<br/>R&gt; bar<br/>  surname sex weight<br/>1       e   1     55<br/>2       f   0     70<br/>3       g   1     87<br/>4       h   0     79</pre>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_257"/>Then add it to the search path too.</p>&#13;
<pre>R&gt; attach(bar)<br/>The following objects are masked from foo:<br/><br/>    sex, surname</pre>&#13;
<p class="indent">The notification tells you that the <code>bar</code> object now precedes <code>foo</code> in the search path.</p>&#13;
<pre>R&gt; search()<br/> [1] ".GlobalEnv"       "bar"               "foo"<br/> [4] "package:MASS"     "package:spatstat"  "tools:RGUI"<br/> [7] "package:stats"    "package:graphics"  "package:grDevices"<br/>[10] "package:utils"    "package:datasets"  "package:methods"<br/>[13] "Autoloads"        "package:base"</pre>&#13;
<p class="indent">As a result, any direct use of either <code>sex</code> or <code>surname</code> will now access <code>bar</code>’s contents, not <code>foo</code>’s. Meanwhile, the unmasked variable <code>height</code> from <code>foo</code> is still directly accessible.</p>&#13;
<pre>R&gt; height<br/>[1] 170 168 181 180</pre>&#13;
<p class="indent">This is a pretty simple example, but it highlights the potential for confusion when data frames, lists, or other objects are added to the search path. Mounting objects this way can quickly become difficult to track, especially for large data sets with many different variables. For this reason, it’s best to avoid attaching objects this way as a general guideline—unless, as stated earlier, you’re working exclusively with one data frame.</p>&#13;
<p class="indent">Note that <code>detach</code> can be used to remove objects from the search path, in a similar way as you saw with packages. In this case, you can simply enter the object name itself.</p>&#13;
<pre>R&gt; detach(foo)<br/>R&gt; search()<br/> [1] ".GlobalEnv"        "bar"               "package:MASS"<br/> [4] "package:spatstat"  "tools:RGUI"        "package:stats"<br/> [7] "package:graphics"  "package:grDevices" "package:utils"<br/>[10] "package:datasets"  "package:methods"   "Autoloads"<br/>[13] "package:base"</pre>&#13;
<h5 class="h5" id="ch12lev3sec36"><span epub:type="pagebreak" id="page_258"/><strong>Important Code in This Chapter</strong></h5>&#13;
<table class="topbot">&#13;
<thead>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table_th"><p class="table"><strong>Function/operator</strong></p></td>&#13;
<td style="vertical-align: top;" class="table_th"><p class="table"><strong>Brief description</strong></p></td>&#13;
<td style="vertical-align: top;" class="table_th"><p class="table"><strong>First occurrence</strong></p></td>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><code>warning</code></p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table">Issue warning</p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><a href="ch12.xhtml#ch12lev2sec106">Section 12.1.1</a>, <a href="ch12.xhtml#page_242">p. 242</a></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><code>stop</code></p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table">Throw error</p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><a href="ch12.xhtml#ch12lev2sec106">Section 12.1.1</a>, <a href="ch12.xhtml#page_242">p. 242</a></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><code>try</code></p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table">Attempt error catch</p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><a href="ch12.xhtml#ch12lev2sec107">Section 12.1.2</a>, <a href="ch12.xhtml#page_244">p. 244</a></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><code>Sys.sleep</code></p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table">Sleep (pause) execution</p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><a href="ch12.xhtml#ch12lev2sec108">Section 12.2.1</a>, <a href="ch12.xhtml#page_249">p. 249</a></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><code>txtProgressBar</code></p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table">Initialize progress bar</p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><a href="ch12.xhtml#ch12lev2sec108">Section 12.2.1</a>, <a href="ch12.xhtml#page_249">p. 249</a></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><code>setTxtProgressBar</code></p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table">Increment progress bar</p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><a href="ch12.xhtml#ch12lev2sec108">Section 12.2.1</a>, <a href="ch12.xhtml#page_249">p. 249</a></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><code>close</code></p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table">Close progress bar</p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><a href="ch12.xhtml#ch12lev2sec108">Section 12.2.1</a>, <a href="ch12.xhtml#page_249">p. 249</a></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><code>Sys.time</code></p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table">Get local system time</p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><a href="ch12.xhtml#ch12lev2sec109">Section 12.2.2</a>, <a href="ch12.xhtml#page_250">p. 250</a></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><code>detach</code></p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table">Remove library/object from path</p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><a href="ch12.xhtml#ch12lev2sec110">Section 12.3.1</a>, <a href="ch12.xhtml#page_255">p. 255</a></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><code>attach</code></p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table">Attach object to search path</p></td>&#13;
<td style="vertical-align: top;" class="table"><p class="table"><a href="ch12.xhtml#ch12lev2sec111">Section 12.3.2</a>, <a href="ch12.xhtml#page_256">p. 256</a></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
</body></html>