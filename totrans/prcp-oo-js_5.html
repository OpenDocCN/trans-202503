<html><head></head><body><section class="chapter" title="Chapter&#xA0;5.&#xA0;Inheritance" epub:type="chapter" id="inheritance"><div class="titlepage"><div><div><h2 class="title">Chapter 5. Inheritance</h2></div></div></div><p><a id="iddle1145" class="indexterm"/><a id="iddle1149" class="indexterm"/><a id="iddle1243" class="indexterm"/><a id="iddle1289" class="indexterm"/><a id="iddle1305" class="indexterm"/>Learning how to create objects is the first step to understanding object-oriented programming. The second step is to understand inheritance. In traditional object-oriented languages, classes inherit properties from other classes.</p><p>In JavaScript, however, inheritance can occur between objects with no classlike structure defining the relationship. The mechanism for this inheritance is one with which you are already familiar: prototypes.</p><div class="sect1" title="Prototype Chaining and Object.prototype"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="prototype_chaining_and_objectdotprototyp">Prototype Chaining and Object.prototype</h2></div></div></div><p>JavaScript’s built-in approach for inheritance is called <span class="emphasis"><em>prototype chaining</em></span>, or <span class="emphasis"><em>prototypal inheritance</em></span>. As you learned in <a class="xref" href="ch04.html" title="Chapter 4. Constructors and Prototypes">Chapter 4</a>, prototype properties are automatically available on object instances, which is a form of inheritance. The object instances inherit properties from the prototype. Because <a id="iddle1140" class="indexterm"/><a id="iddle1147" class="indexterm"/><a id="iddle1169" class="indexterm"/><a id="iddle1230" class="indexterm"/><a id="iddle1231" class="indexterm"/><a id="iddle1249" class="indexterm"/><a id="iddle1250" class="indexterm"/><a id="iddle1287" class="indexterm"/><a id="iddle1366" class="indexterm"/><a id="iddle1380" class="indexterm"/>the prototype is also an object, it has its own prototype and inherits properties from that. This is the <span class="emphasis"><em>prototype chain</em></span>: An object inherits from its prototype, while that prototype in turn inherits from its prototype, and so on.</p><p>All objects, including those you define yourself, automatically inherit from <code class="literal">Object</code> unless you specify otherwise (discussed later in this chapter). More specifically, all objects inherit from <code class="literal">Object.prototype</code>. Any object defined via an object literal has its <code class="literal">[[Prototype]]</code> set to <code class="literal">Object.prototype</code>, meaning that it inherits properties from <code class="literal">Object.prototype</code>, just like <code class="literal">book</code> in this example:</p><a id="pro_id00100"/><pre class="programlisting"><span class="pd_green"><code class="kd">var</code></span> <code class="nx">book</code> <span class="pd_ash"><code class="o">=</code></span> <code class="p">{</code>
    <code class="nx">title</code><code class="o">:</code> <span class="pd_red"><code class="s2">"The Principles of Object-Oriented JavaScript"</code></span>
<code class="p">};</code>

<span class="pd_green"><code class="kd">var</code></span> <code class="nx">prototype</code> <span class="pd_ash"><code class="o">=</code></span> <span class="pd_green"><code class="nb">Object</code></span><code class="p">.</code><code class="nx">getPrototypeOf</code><code class="p">(</code><code class="nx">book</code><code class="p">);</code>

<code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">prototype</code> <span class="pd_ash"><code class="o">===</code></span> <span class="pd_green"><code class="nb">Object</code></span><code class="p">.</code><code class="nx">prototype</code><code class="p">);</code>        <span class="pd_green1"><code class="c1">// true</code></span></pre><p>Here, <code class="literal">book</code> has a prototype equal to <code class="literal">Object.prototype</code>. No additional code was necessary to make this happen, as this is the default behavior when new objects are created. This relationship means that <code class="literal">book</code> automatically receives methods from <code class="literal">Object.prototype</code>.</p><div class="sect2" title="Methods Inherited from Object.prototype"><div class="titlepage"><div><div><h3 class="title" id="methods_inherited_from_objectdotprototyp">Methods Inherited from Object.prototype</h3></div></div></div><p>Several of the methods used in the past couple of chapters are actually defined on <code class="literal">Object.prototype</code> and are therefore inherited by all other objects. Those methods are:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none"><p title="hasOwnProperty()"><span class="title"><strong><span class="strong"><strong><code class="literal">hasOwnProperty()</code></strong></span></strong></span>. Determines whether an own property with the given name exists</p></li><li class="listitem" style="list-style-type: none"><p title="propertyIsEnumerable()"><span class="title"><strong><span class="strong"><strong><code class="literal">propertyIsEnumerable()</code></strong></span></strong></span>. Determines whether an own property is enumerable</p></li><li class="listitem" style="list-style-type: none"><p title="isPrototypeOf()"><span class="title"><strong><span class="strong"><strong><code class="literal">isPrototypeOf()</code></strong></span></strong></span>. Determines whether the object is the prototype of another</p></li><li class="listitem" style="list-style-type: none"><p title="valueOf()"><span class="title"><strong><span class="strong"><strong><code class="literal">valueOf()</code></strong></span></strong></span>. Returns the value representation of the object</p></li><li class="listitem" style="list-style-type: none"><p title="toString()"><span class="title"><strong><span class="strong"><strong><code class="literal">toString()</code></strong></span></strong></span>. Returns a string representation of the object</p></li></ul></div><p>These five methods appear on all objects through inheritance. The last two are important when you need to make objects work consistently in JavaScript, and sometimes you might want to define them yourself.</p><div class="sect3" title="valueOf()"><div class="titlepage"><div><div><h4 class="title" id="valueofleft_parenthesisright_parenthesis">valueOf()</h4></div></div></div><p><a id="iddle1082" class="indexterm"/><a id="iddle1367" class="indexterm"/><a id="iddle1381" class="indexterm"/>The <code class="literal">valueOf()</code> method gets called whenever an operator is used on an object. By default, <code class="literal">valueOf()</code> simply returns the object instance. The primitive wrapper types override <code class="literal">valueOf()</code> so that it returns a string for <code class="literal">String</code>, a Boolean for <code class="literal">Boolean</code>, and a number for <code class="literal">Number</code>. Likewise, the <code class="literal">Date</code> object’s <code class="literal">valueOf()</code> method returns the epoch time in milliseconds (just as <code class="literal">Date.prototype.getTime()</code> does). This is what allows you to write code that compares dates such as:</p><a id="pro_id00101"/><pre class="programlisting">  <span class="pd_green"><code class="kd">var</code></span> <code class="nx">now</code> <span class="pd_ash"><code class="o">=</code></span> <span class="pd_green"><code class="k">new</code> <code class="nb">Date</code></span><code class="p">();</code>
  <span class="pd_green"><code class="kd">var</code></span> <code class="nx">earlier</code> <span class="pd_ash"><code class="o">=</code></span> <span class="pd_green"><code class="k">new</code> <code class="nb">Date</code></span><code class="p">(</code><span class="pd_ash"><code class="mi">2010</code></span><code class="p">,</code> <span class="pd_ash"><code class="mi">1</code></span><code class="p">,</code> <span class="pd_ash"><code class="mi">1</code></span><code class="p">);</code>

<code class="err">❶</code> <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">now</code> <span class="pd_ash"><code class="o">&gt;</code></span> <code class="nx">earlier</code><code class="p">);</code>        <span class="pd_green1"><code class="c1">// true</code></span></pre><p>In this example, <code class="literal">now</code> is a <code class="literal">Date</code> representing the current time, and <code class="literal">earlier</code> is a fixed date in the past. When the greater-than operator (<code class="literal">&gt;</code>) is used ❶, the <code class="literal">valueOf()</code> method is called on both objects before the comparison is performed. You can even subtract one date from another and get the difference in epoch time because of <code class="literal">valueOf()</code>.</p><p>You can always define your own <code class="literal">valueOf()</code> method if your objects are intended to be used with operators. If you do define a <code class="literal">valueOf()</code> method, keep in mind that you’re not changing how the operator works, only what value is used with the operator’s default behavior.</p></div><div class="sect3" title="toString()"><div class="titlepage"><div><div><h4 class="title" id="tostringleft_parenthesisright_parenthesi">toString()</h4></div></div></div><p>The <code class="literal">toString()</code> method is called as a fallback whenever <code class="literal">valueOf()</code> returns a reference value instead of a primitive value. It is also implicitly called on primitive values whenever JavaScript is expecting a string. For example, when a string is used as one operand for the plus operator, the other operand is automatically converted to a string. If the other operand is a primitive value, it is converted into a string representation (for example, <code class="literal">true</code> becomes <code class="literal">"true"</code>), but if it is a reference value, then <code class="literal">valueOf()</code> is called. If <code class="literal">valueOf()</code> returns a reference value, <code class="literal">toString()</code> is called and the returned value is used. For example:</p><a id="pro_id00102"/><pre class="programlisting"><span class="pd_green"><code class="kd">var</code></span> <code class="nx">book</code> <span class="pd_ash"><code class="o">=</code></span> <code class="p">{</code>
    <code class="nx">title</code><code class="o">:</code> <span class="pd_red"><code class="s2">"The Principles of Object-Oriented JavaScript"</code></span>
<code class="p">};</code>

<span class="pd_green"><code class="kd">var</code></span> <code class="nx">message</code> <span class="pd_ash"><code class="o">=</code></span> <span class="pd_red"><code class="s2">"Book = "</code></span> <span class="pd_ash"><code class="o">+</code></span> <code class="nx">book</code><code class="p">;</code>
<code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">message</code><code class="p">);</code>                <span class="pd_green1"><code class="c1">// "Book = [object Object]"</code></span></pre><p><a id="iddle1232" class="indexterm"/>This code constructs the string by combining <code class="literal">"Book = "</code> with <code class="literal">book</code>. Since <code class="literal">book</code> is an object, its <code class="literal">toString()</code> method is called. That method is inherited from <code class="literal">Object.prototype</code> and returns the default value of <code class="literal">"[object Object]"</code> in most JavaScript engines. If you are happy with that value, there’s no need to change your object’s <code class="literal">toString()</code> method. Sometimes, however, it’s useful to define your own <code class="literal">toString()</code> method so that string conversions return a value that gives more information. Suppose, for example, that you want the previous script to log the book’s title:</p><a id="pro_id00103"/><pre class="programlisting">  <span class="pd_green"><code class="kd">var</code></span> <code class="nx">book</code> <span class="pd_ash"><code class="o">=</code></span> <code class="p">{</code>
      <code class="nx">title</code><code class="o">:</code> <span class="pd_red"><code class="s2">"The Principles of Object-Oriented JavaScript"</code></span><code class="p">,</code>
      <code class="nx">toString</code><code class="o">:</code> <span class="pd_green"><code class="kd">function</code></span><code class="p">()</code> <code class="p">{</code>
          <span class="pd_green"><code class="k">return</code></span> <span class="pd_red"><code class="s2">"[Book "</code></span> <span class="pd_ash"><code class="o">+</code></span> <span class="pd_green"><code class="k">this</code></span><code class="p">.</code><code class="nx">title</code> <code class="o">+</code> <span class="pd_red"><code class="s2">"]"</code></span>
      <code class="p">}</code>
  <code class="p">};</code>

  <span class="pd_green"><code class="kd">var</code></span> <code class="nx">message</code> <span class="pd_ash"><code class="o">=</code></span> <span class="pd_red"><code class="s2">"Book = "</code></span> <code class="o">+</code> <code class="nx">book</code><code class="p">;</code>

  <span class="pd_green1"><code class="c1">// "Book = [Book The Principles of Object-Oriented JavaScript]"</code></span>
<code class="err">❶</code> <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">message</code><code class="p">);</code></pre><p>This code defines a custom <code class="literal">toString()</code> method for <code class="literal">book</code> that returns a more useful value ❶ than the inherited version. You don’t usually need to worry about defining a custom <code class="literal">toString()</code> method, but it’s good to know that it’s possible to do so if necessary.</p></div></div><div class="sect2" title="Modifying Object.prototype"><div class="titlepage"><div><div><h3 class="title" id="modifying_objectdotprototype">Modifying Object.prototype</h3></div></div></div><p>All objects inherit from <code class="literal">Object.prototype</code> by default, so changes to <code class="literal">Object.prototype</code> affect all objects. That’s a very dangerous situation. You were advised in <a class="xref" href="ch04.html" title="Chapter 4. Constructors and Prototypes">Chapter 4</a> not to modify built-in object prototypes, and that advice goes double for <code class="literal">Object.prototype</code>. Take a look at what can happen:</p><a id="pro_id00104"/><pre class="programlisting"><span class="pd_green"><code class="nb">Object</code></span><code class="p">.</code><code class="nx">prototype</code><code class="p">.</code><code class="nx">add</code> <span class="pd_ash"><code class="o">=</code></span> <span class="pd_green"><code class="kd">function</code></span><code class="p">(</code><code class="nx">value</code><code class="p">)</code> <code class="p">{</code>
    <span class="pd_green"><code class="k">return</code> <code class="k">this</code></span> <span class="pd_ash"><code class="o">+</code></span> <code class="nx">value</code><code class="p">;</code>
<code class="p">};</code>

<span class="pd_green"><code class="kd">var</code></span> <code class="nx">book</code> <span class="pd_ash"><code class="o">=</code></span> <code class="p">{</code>
    <code class="nx">title</code><code class="o">:</code> <span class="pd_red"><code class="s2">"The Principles of Object-Oriented JavaScript"</code></span>
<code class="p">};</code>

<code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">book</code><code class="p">.</code><code class="nx">add</code><code class="p">(</code><span class="pd_ash"><code class="mi">5</code></span><code class="p">));</code>           <span class="pd_green1"><code class="c1">// "[object Object]5"</code></span>
<code class="nx">console</code><code class="p">.</code><code class="nx">log</code><span class="pd_red"><code class="p">(</code><code class="s2">"title"</code></span><code class="p">.</code><code class="nx">add</code><code class="p">(</code><span class="pd_red"><code class="s2">"end"</code></span><code class="p">));</code>    <span class="pd_green1"><code class="c1">// "titleend"</code></span>

<span class="pd_green1"><code class="c1">// in a web browser</code></span>
<code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><span class="pd_green"><code class="nb">document</code></span><code class="p">.</code><code class="nx">add</code><code class="p">(</code><span class="pd_green"><code class="kc">true</code></span><code class="p">));</code>    <span class="pd_green1"><code class="c1">// "[object HTMLDocument]true"</code></span>
<code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><span class="pd_green"><code class="nb">window</code></span><code class="p">.</code><code class="nx">add</code><code class="p">(</code><span class="pd_ash"><code class="mi">5</code></span><code class="p">));</code>         <span class="pd_green1"><code class="c1">// "[object Window]true"</code></span></pre><p><a id="iddle1074" class="indexterm"/><a id="iddle1095" class="indexterm"/><a id="iddle1112" class="indexterm"/><a id="iddle1141" class="indexterm"/><a id="iddle1148" class="indexterm"/><a id="iddle1239" class="indexterm"/><a id="iddle1276" class="indexterm"/>Adding <code class="literal">Object.prototype.add()</code> causes all objects to have an <code class="literal">add()</code> method, whether or not it actually makes sense. This problem has been an issue not just for developers but also for the committee that works on the JavaScript language: It has had to put new methods in different locations because adding methods to <code class="literal">Object.prototype</code> can have unforeseen consequences.</p><p>Another aspect of this problem involves adding enumerable properties to <code class="literal">Object.prototype</code>. In the previous example, <code class="literal">Object.prototype.add()</code> is an enumerable property, which means it will show up when you use a <code class="literal">for-in</code> loop, such as:</p><a id="pro_id00105"/><pre class="programlisting"><span class="pd_green"><code class="kd">var</code></span> <code class="nx">empty</code> <span class="pd_ash"><code class="o">=</code></span> <code class="p">{};</code>

<span class="pd_green"><code class="k">for</code></span> <code class="p">(</code><span class="pd_green"><code class="kd">var</code></span> <code class="nx">property</code> <span class="pd_green"><code class="k">in</code></span> <code class="nx">empty</code><code class="p">)</code> <code class="p">{</code>
    <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">property</code><code class="p">);</code>
<code class="p">}</code></pre><p>Here, an empty object will still output <code class="literal">"add"</code> as a property because it exists on the prototype and is enumerable. Given how often the <code class="literal">for-in</code> construct is used in JavaScript, modifying <code class="literal">Object.prototype</code> with enumerable properties has the potential to affect a lot of code. For this reason, Douglas Crockford recommends using <code class="literal">hasOwnProperty()</code> in <code class="literal">for-in</code> loops all the time,<sup>[<a id="ch05fn01" href="#ftn.ch05fn01" class="footnote">1</a>]</sup> such as:</p><a id="pro_id00106"/><pre class="programlisting"><span class="pd_green"><code class="kd">var</code></span> <code class="nx">empty</code> <span class="pd_ash"><code class="o">=</code></span> <code class="p">{};</code>

<span class="pd_green"><code class="k">for</code></span> <code class="p">(</code><span class="pd_green"><code class="kd">var</code></span> <code class="nx">property</code> <span class="pd_green"><code class="k">in</code></span> <code class="nx">empty</code><code class="p">)</code> <code class="p">{</code>
    <code class="k">if</code> <code class="p">(</code><code class="nx">empty</code><code class="p">.</code><code class="nx">hasOwnProperty</code><code class="p">(</code><code class="nx">property</code><code class="p">))</code> <code class="p">{</code>
        <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">property</code><code class="p">);</code>
    <code class="p">}</code>
<code class="p">}</code></pre><p>While this approach is effective against possible unwanted prototype properties, it also limits the use of <code class="literal">for-in</code> to only own properties, which may or may not be want you want. Your best bet for the most flexibility is to not modify <code class="literal">Object.prototype</code>.</p></div></div><div class="sect1" title="Object Inheritance"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="object_inheritance">Object Inheritance</h2></div></div></div><p>The simplest type of inheritance is between objects. All you have to do is specify what object should be the new object’s <code class="literal">[[Prototype]]</code>. Object literals have <code class="literal">Object.prototype</code> set as their <code class="literal">[[Prototype]]</code> implicitly, but you can also explicitly specify <code class="literal">[[Prototype]]</code> with the <code class="literal">Object.create()</code> method.</p><p><a id="iddle1070" class="indexterm"/><a id="iddle1211" class="indexterm"/>The <code class="literal">Object.create()</code> method accepts two arguments. The first argument is the object to use for <code class="literal">[[Prototype]]</code> in the new object. The optional second argument is an object of property descriptors in the same format used by <code class="literal">Object.defineProperties()</code> (see <a class="xref" href="ch03.html" title="Chapter 3. Understanding Objects">Chapter 3</a>). Consider the following:</p><a id="pro_id00107"/><pre class="programlisting"><span class="pd_green"><code class="kd">var</code></span> <code class="nx">book</code> <span class="pd_ash"><code class="o">=</code></span> <code class="p">{</code>
    <code class="nx">title</code><code class="o">:</code> <span class="pd_red"><code class="s2">"The Principles of Object-Oriented JavaScript"</code></span>
<code class="p">};</code>

<span class="pd_green1"><code class="c1">// is the same as</code></span>

<span class="pd_green"><code class="kd">var</code></span> <code class="nx">book</code> <span class="pd_ash"><code class="o">=</code></span> <span class="pd_green"><code class="nb">Object</code></span><code class="p">.</code><code class="nx">create</code><code class="p">(</code><span class="pd_green"><code class="nb">Object</code></span><code class="p">.</code><code class="nx">prototype</code><code class="p">,</code> <code class="p">{</code>
                <code class="nx">title</code><code class="o">:</code> <code class="p">{</code>
                    <code class="nx">configurable</code><code class="o">:</code> <span class="pd_green"><code class="kc">true</code></span><code class="p">,</code>
                    <code class="nx">enumerable</code><code class="o">:</code> <span class="pd_green"><code class="kc">true</code></span><code class="p">,</code>
                    <code class="nx">value</code><code class="o">:</code> <span class="pd_red"><code class="s2">"The Principles of Object-Oriented JavaScript"</code></span><code class="p">,</code>
                    <code class="nx">writable</code><code class="o">:</code> <span class="pd_green"><code class="kc">true</code></span>
                <code class="p">}</code>
            <code class="p">});</code></pre><p>The two declarations in this code are effectively the same. The first declaration uses an object literal to define an object with a single property called <code class="literal">title</code>. That object automatically inherits from <code class="literal">Object.prototype</code>, and the property is set to be configurable, enumerable, and writable by default. The second declaration takes the same steps but does so explicitly using <code class="literal">Object.create()</code>. The resulting <code class="literal">book</code> object from each declaration behaves the exact same way. But you’ll probably never write code that inherits from <code class="literal">Object.prototype</code> directly, because you get that by default. Inheriting from other objects is much more interesting:</p><a id="pro_id00108"/><pre class="programlisting"><span class="pd_green"><code class="kd">var</code></span> <code class="nx">person1</code> <span class="pd_ash"><code class="o">=</code></span> <code class="p">{</code>
    <code class="nx">name</code><code class="o">:</code> <span class="pd_red"><code class="s2">"Nicholas"</code></span><code class="p">,</code>
    <code class="nx">sayName</code><code class="o">:</code> <span class="pd_green"><code class="kd">function</code></span><code class="p">()</code> <code class="p">{</code>
        <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><span class="pd_green"><code class="k">this</code></span><code class="p">.</code><code class="nx">name</code><code class="p">);</code>
    <code class="p">}</code>
<code class="p">};</code>

<span class="pd_green"><code class="kd">var</code></span> <code class="nx">person2</code> <span class="pd_ash"><code class="o">=</code></span> <span class="pd_green"><code class="nb">Object</code></span><code class="p">.</code><code class="nx">create</code><code class="p">(</code><code class="nx">person1</code><code class="p">,</code> <code class="p">{</code>
    <code class="nx">name</code><code class="o">:</code> <code class="p">{</code>
        <code class="nx">configurable</code><code class="o">:</code> <span class="pd_green"><code class="kc">true</code></span><code class="p">,</code>
        <code class="nx">enumerable</code><code class="o">:</code> <span class="pd_green"><code class="kc">true</code></span><code class="p">,</code>
        <code class="nx">value</code><code class="o">:</code> <span class="pd_red"><code class="s2">"Greg"</code></span><code class="p">,</code>
        <code class="nx">writable</code><code class="o">:</code> <span class="pd_green"><code class="kc">true</code></span>
    <code class="p">}</code>
<code class="p">});</code>

<code class="nx">person1</code><code class="p">.</code><code class="nx">sayName</code><code class="p">();</code>                                  <span class="pd_green1"><code class="c1">// outputs "Nicholas"</code></span>
<code class="nx">person2</code><code class="p">.</code><code class="nx">sayName</code><code class="p">();</code>                                  <span class="pd_green1"><code class="c1">// outputs "Greg"</code></span>
<code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">person1</code><code class="p">.</code><code class="nx">hasOwnProperty</code><code class="p">(</code><span class="pd_red"><code class="s2">"sayName"</code></span><code class="p">));</code>     <span class="pd_green1"><code class="c1">// true</code></span>
<code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">person1</code><code class="p">.</code><code class="nx">isPrototypeOf</code><code class="p">(</code><code class="nx">person2</code><code class="p">));</code>        <span class="pd_green1"><code class="c1">// true</code></span>
<code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">person2</code><code class="p">.</code><code class="nx">hasOwnProperty</code><code class="p">(</code><span class="pd_red"><code class="s2">"sayName"</code></span><code class="p">));</code>     <span class="pd_green1"><code class="c1">// false</code></span></pre><p><a id="iddle1290" class="indexterm"/>This code creates an object, <code class="literal">person1</code>, with a <code class="literal">name</code> property and a <code class="literal">sayName()</code> method. The <code class="literal">person2</code> object inherits from <code class="literal">person1</code>, so it inherits both <code class="literal">name</code> and <code class="literal">sayName()</code>. However, <code class="literal">person2</code> is defined via <code class="literal">Object.create()</code>, which also defines an own <code class="literal">name</code> property for <code class="literal">person2</code>. This own property shadows the prototype property of the same name and is used in its place. So, <code class="literal">person1.sayName()</code> outputs <code class="literal">"Nicholas"</code>, while <code class="literal">person2.sayName()</code> outputs <code class="literal">"Greg"</code>. Keep in mind that <code class="literal">sayName()</code> still exists only on <code class="literal">person1</code> and is being inherited by <code class="literal">person2</code>.</p><p>The inheritance chain in this example is longer for <code class="literal">person2</code> than it is for <code class="literal">person1</code>. The <code class="literal">person2</code> object inherits from the <code class="literal">person1</code> object, and the <code class="literal">person1</code> object inherits from <code class="literal">Object.prototype</code>. See <a class="xref" href="ch05.html#prototype_chain_for_person2_includes_per" title="Figure 5-1. The prototype chain for person2 includes person1 and Object.prototype.">Figure 5-1</a>.</p><div class="figure"><a id="prototype_chain_for_person2_includes_per"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00009"/><img src="figs/web/oojs05_01.png.jpg" alt="The prototype chain for person2 includes person1 and Object.prototype."/></div></div><div class="figure-title">Figure 5-1. The prototype chain for <code class="literal">person2</code> includes <code class="literal">person1</code> and <code class="literal">Object.prototype</code>.</div></div><p>When a property is accessed on an object, the JavaScript engine goes through a search process. If the property is found on the instance (that is, if it’s an own property), that property value is used. If the property is not found on the instance, the search continues on <code class="literal">[[Prototype]]</code>. If the property is still not found, the search continues to that object’s <code class="literal">[[Prototype]]</code>, and so on until the end of the chain is reached. That chain usually ends with <code class="literal">Object.prototype</code>, whose <code class="literal">[[Prototype]]</code> is set to <code class="literal">null</code>.</p><p><a id="iddle1059" class="indexterm"/><a id="iddle1066" class="indexterm"/><a id="iddle1068" class="indexterm"/><a id="iddle1146" class="indexterm"/><a id="iddle1292" class="indexterm"/><a id="iddle1297" class="indexterm"/><a id="iddle1350" class="indexterm"/><a id="iddle1353" class="indexterm"/>You can also create objects with a <code class="literal">null [[Prototype]]</code> via <code class="literal">Object.create()</code>, such as:</p><a id="pro_id00109"/><pre class="programlisting"><span class="pd_green"><code class="kd">var</code></span> <code class="nx">nakedObject</code> <span class="pd_ash"><code class="o">=</code></span> <span class="pd_green"><code class="nb">Object</code></span><code class="p">.</code><code class="nx">create</code><code class="p">(</code><span class="pd_green"><code class="kc">null</code></span><code class="p">);</code>

<code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><span class="pd_red"><code class="s2">"toString"</code></span> <span class="pd_green"><code class="k">in</code></span> <code class="nx">nakedObject</code><code class="p">);</code>    <span class="pd_green1"><code class="c1">// false</code></span>
<code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><span class="pd_red"><code class="s2">"valueOf"</code></span> <span class="pd_green"><code class="k">in</code></span> <code class="nx">nakedObject</code><code class="p">);</code>     <span class="pd_green1"><code class="c1">// false</code></span></pre><p>The <code class="literal">nakedObject</code> in this example is an object with no prototype chain. That means built-in methods such as <code class="literal">toString()</code> and <code class="literal">valueOf()</code> aren’t present on the object. In effect, this object is a completely blank slate with no predefined properties, which makes it perfect for creating a lookup hash without potential naming collisions with inherited property names. There aren’t many other uses for an object like this, and you can’t use it as if it were inheriting from <code class="literal">Object.prototype</code>. For example, any time you use an operator on <code class="literal">nakedObject</code>, you’ll just get an error along the lines of “Cannot convert object to primitive value.” Still, it’s an interesting quirk of the JavaScript language that you can create a prototype-less object.</p></div><div class="sect1" title="Constructor Inheritance"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="constructor_inheritance">Constructor Inheritance</h2></div></div></div><p>Object inheritance in JavaScript is also the basis of constructor inheritance. Recall from <a class="xref" href="ch04.html" title="Chapter 4. Constructors and Prototypes">Chapter 4</a> that almost every function has a <code class="literal">prototype</code> property that can be modified or replaced. That <code class="literal">prototype</code> property is automatically assigned to be a new generic object that inherits from <code class="literal">Object.prototype</code> and has a single own property called <code class="literal">constructor</code>. In effect, the JavaScript engine does the following for you:</p><a id="pro_id00110"/><pre class="programlisting"><span class="pd_green1"><code class="c1">// you write this</code></span>
<span class="pd_green"><code class="kd">function</code></span> <code class="nx">YourConstructor</code><code class="p">()</code> <code class="p">{</code>
    <span class="pd_green1"><code class="c1">// initialization</code></span>
<code class="p">}</code>

<span class="pd_green1"><code class="c1">// JavaScript engine does this for you behind the scenes</code></span>
<code class="nx">YourConstructor</code><code class="p">.</code><code class="nx">prototype</code> <span class="pd_ash"><code class="o">=</code></span> <span class="pd_green"><code class="nb">Object</code></span><code class="p">.</code><code class="nx">create</code><code class="p">(</code><span class="pd_green"><code class="nb">Object</code></span><code class="p">.</code><code class="nx">prototype</code><code class="p">,</code> <code class="p">{</code>
                                <code class="nx">constructor</code><code class="o">:</code> <code class="p">{</code>
                                    <code class="nx">configurable</code><code class="o">:</code> <span class="pd_green"><code class="kc">true</code></span><code class="p">,</code>
                                    <code class="nx">enumerable</code><code class="o">:</code> <span class="pd_green"><code class="kc">true</code></span><code class="p">,</code>
                                    <code class="nx">value</code><code class="o">:</code> <code class="nx">YourConstructor</code>
                                    <code class="nx">writable</code><code class="o">:</code> <span class="pd_green"><code class="kc">true</code></span>
                                <code class="p">}</code>
                            <code class="p">});</code></pre><p>So without doing anything extra, this code sets the constructor’s <code class="literal">prototype</code> property to an object that inherits from <code class="literal">Object.prototype</code>, which means any instances of <code class="literal">YourConstructor</code> also inherit from <code class="literal">Object.prototype</code>. <code class="literal">YourConstructor</code> is a <span class="emphasis"><em>subtype</em></span> of <code class="literal">Object</code>, and <code class="literal">Object</code> is a <span class="emphasis"><em>supertype</em></span> of <code class="literal">YourConstructor</code>.</p><p><a id="iddle1293" class="indexterm"/><a id="iddle1314" class="indexterm"/><a id="iddle1339" class="indexterm"/>Because the <code class="literal">prototype</code> property is writable, you can change the prototype chain by overwriting it. Consider the following example:</p><a id="pro_id00111"/><pre class="programlisting"><code class="err">❶</code> <span class="pd_green"><code class="kd">function</code></span> <code class="nx">Rectangle</code><code class="p">(</code><code class="nx">length</code><code class="p">,</code> <code class="nx">width</code><code class="p">)</code> <code class="p">{</code>
      <span class="pd_green"><code class="k">this</code></span><code class="p">.</code><code class="nx">length</code> <span class="pd_ash"><code class="o">=</code></span> <code class="nx">length</code><code class="p">;</code>
      <span class="pd_green"><code class="k">this</code></span><code class="p">.</code><code class="nx">width</code> <span class="pd_ash"><code class="o">=</code></span> <code class="nx">width</code><code class="p">;</code>
  <code class="p">}</code>

  <code class="nx">Rectangle</code><code class="p">.</code><code class="nx">prototype</code><code class="p">.</code><code class="nx">getArea</code> <span class="pd_ash"><code class="o">=</code></span> <span class="pd_green"><code class="kd">function</code></span><code class="p">()</code> <code class="p">{</code>
      <span class="pd_green"><code class="k">return</code> <code class="k">this</code></span><code class="p">.</code><code class="nx">length</code> <span class="pd_ash"><code class="o">*</code></span> <span class="pd_green"><code class="k">this</code></span><code class="p">.</code><code class="nx">width</code><code class="p">;</code>
  <code class="p">};</code>

  <code class="nx">Rectangle</code><code class="p">.</code><code class="nx">prototype</code><code class="p">.</code><code class="nx">toString</code> <span class="pd_ash"><code class="o">=</code></span> <span class="pd_green"><code class="kd">function</code></span><code class="p">()</code> <code class="p">{</code>
      <span class="pd_green"><code class="k">return</code></span> <span class="pd_red"><code class="s2">"[Rectangle "</code></span> <span class="pd_ash"><code class="o">+</code></span> <span class="pd_green"><code class="k">this</code></span><code class="p">.</code><code class="nx">length</code> <span class="pd_ash"><code class="o">+</code></span> <span class="pd_red"><code class="s2">"x"</code></span> <span class="pd_ash"><code class="o">+</code></span> <span class="pd_green"><code class="k">this</code></span><code class="p">.</code><code class="nx">width</code> <span class="pd_ash"><code class="o">+</code></span> <span class="pd_red"><code class="s2">"]"</code></span><code class="p">;</code>
  <code class="p">};</code>

  <span class="pd_green1"><code class="c1">// inherits from Rectangle</code></span>
<code class="err">❷</code> <span class="pd_green"><code class="kd">function</code></span> <code class="nx">Square</code><code class="p">(</code><code class="nx">size</code><code class="p">)</code> <code class="p">{</code>
      <span class="pd_green"><code class="k">this</code></span><code class="p">.</code><code class="nx">length</code> <span class="pd_ash"><code class="o">=</code></span> <code class="nx">size</code><code class="p">;</code>
      <span class="pd_green"><code class="k">this</code></span><code class="p">.</code><code class="nx">width</code> <span class="pd_ash"><code class="o">=</code></span> <code class="nx">size</code><code class="p">;</code>
  <code class="p">}</code>

  <code class="nx">Square</code><code class="p">.</code><code class="nx">prototype</code> <span class="pd_ash"><code class="o">=</code></span> <span class="pd_green"><code class="k">new</code></span> <code class="nx">Rectangle</code><code class="p">();</code>
  <code class="nx">Square</code><code class="p">.</code><code class="nx">prototype</code><code class="p">.</code><code class="nx">constructor</code> <span class="pd_ash"><code class="o">=</code></span> <code class="nx">Square</code><code class="p">;</code>

  <code class="nx">Square</code><code class="p">.</code><code class="nx">prototype</code><code class="p">.</code><code class="nx">toString</code> <span class="pd_ash"><code class="o">=</code></span> <span class="pd_green"><code class="kd">function</code></span><code class="p">()</code> <code class="p">{</code>
      <span class="pd_green"><code class="k">return</code></span> <span class="pd_red"><code class="s2">"[Square "</code></span> <span class="pd_ash"><code class="o">+</code></span> <span class="pd_green"><code class="k">this</code></span><code class="p">.</code><code class="nx">length</code> <span class="pd_ash"><code class="o">+</code></span> <span class="pd_red"><code class="s2">"x"</code></span> <span class="pd_ash"><code class="o">+</code></span> <span class="pd_green"><code class="k">this</code></span><code class="p">.</code><code class="nx">width</code> <span class="pd_ash"><code class="o">+</code></span> <span class="pd_red"><code class="s2">"]"</code></span><code class="p">;</code>
  <code class="p">};</code>

  <span class="pd_green"><code class="kd">var</code></span> <code class="nx">rect</code> <span class="pd_ash"><code class="o">=</code></span> <span class="pd_green"><code class="k">new</code></span> <code class="nx">Rectangle</code><code class="p">(</code><span class="pd_ash"><code class="mi">5</code></span><code class="p">,</code> <span class="pd_ash"><code class="mi">10</code></span><code class="p">);</code>
  <span class="pd_green"><code class="kd">var</code></span> <code class="nx">square</code> <span class="pd_ash"><code class="o">=</code></span> <span class="pd_green"><code class="k">new</code></span> <code class="nx">Square</code><code class="p">(</code><span class="pd_ash"><code class="mi">6</code></span><code class="p">);</code>

  <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">rect</code><code class="p">.</code><code class="nx">getArea</code><code class="p">());</code>        <span class="pd_green1"><code class="c1">// 50</code></span>
  <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">square</code><code class="p">.</code><code class="nx">getArea</code><code class="p">());</code>      <span class="pd_green1"><code class="c1">// 36</code></span>

  <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">rect</code><code class="p">.</code><code class="nx">toString</code><code class="p">());</code>       <span class="pd_green1"><code class="c1">// "[Rectangle 5x10]"</code></span>
  <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">square</code><code class="p">.</code><code class="nx">toString</code><code class="p">());</code>     <span class="pd_green1"><code class="c1">// "[Square 6x6]"</code></span>

  <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">rect</code> <span class="pd_green"><code class="k">instanceof</code></span> <code class="nx">Rectangle</code><code class="p">);</code>     <span class="pd_green1"><code class="c1">// true</code></span>
  <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">rect</code> <span class="pd_green"><code class="k">instanceof</code> <code class="nb">Object</code></span><code class="p">);</code>        <span class="pd_green1"><code class="c1">// true</code></span>

  <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">square</code> <span class="pd_green"><code class="k">instanceof</code></span> <code class="nx">Square</code><code class="p">);</code>      <span class="pd_green1"><code class="c1">// true</code></span>
  <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">square</code> <span class="pd_green"><code class="k">instanceof</code></span> <code class="nx">Rectangle</code><code class="p">);</code>   <span class="pd_green1"><code class="c1">// true</code></span>
  <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">square</code> <span class="pd_green"><code class="k">instanceof</code> <code class="nb">Object</code></span><code class="p">);</code>      <span class="pd_green1"><code class="c1">// true</code></span></pre><p>In this code, there are two constructors: <code class="literal">Rectangle</code> ❶ and <code class="literal">Square</code> ❷. The <code class="literal">Square</code> constructor has its <code class="literal">prototype</code> property overwritten with an instance of <code class="literal">Rectangle</code>. No arguments are passed into <code class="literal">Rectangle</code> at this point because they don’t need to be used, and if they were, all instances of <code class="literal">Square</code> would share the same dimensions. To change the prototype chain this way, you always need to make sure that the constructor won’t throw an error if the <a id="iddle1291" class="indexterm"/>arguments aren’t supplied (many constructors contain initialization logic that may require the arguments) and that the constructor isn’t altering any sort of global state, such as keeping track of how many instances have been created. The <code class="literal">constructor</code> property is restored on <code class="literal">Square.prototype</code> after the original value is overwritten.</p><p>After that, <code class="literal">rect</code> is created as an instance of <code class="literal">Rectangle</code>, and <code class="literal">square</code> is created as an instance of <code class="literal">Square</code>. Both objects have the <code class="literal">getArea()</code> method because it is inherited from <code class="literal">Rectangle.prototype</code>. The <code class="literal">square</code> variable is considered an instance of <code class="literal">Square</code> as well as <code class="literal">Rectangle</code> and <code class="literal">Object</code> because <code class="literal">instanceof</code> uses the prototype chain to determine the object type. See <a class="xref" href="ch05.html#prototype_chains_for_square_and_rect_sho" title="Figure 5-2. The prototype chains for square and rect show that both inherit from Rectangle.prototype and Object.prototype, but only square inherits from Square.prototype.">Figure 5-2</a>.</p><div class="figure"><a id="prototype_chains_for_square_and_rect_sho"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00010"/><img src="figs/web/oojs05_02.png.jpg" alt="The prototype chains for square and rect show that both inherit from Rectangle.prototype and Object.prototype, but only square inherits from Square.prototype."/></div></div><div class="figure-title">Figure 5-2. The prototype chains for <code class="literal">square</code> and <code class="literal">rect</code> show that both inherit from <code class="literal">Rectangle.prototype</code> and <code class="literal">Object.prototype</code>, but only <code class="literal">square</code> inherits from <code class="literal">Square.prototype</code>.</div></div><p><code class="literal">Square.prototype</code> doesn’t actually need to be overwritten with a <code class="literal">Rectangle</code> object, though; the <code class="literal">Rectangle</code> constructor isn’t doing anything that is necessary for <code class="literal">Square</code>. In fact, the only relevant part is that <code class="literal">Square.prototype</code> needs to somehow link to <code class="literal">Rectangle.prototype</code> in order for inheritance to happen. That means you can simplify this example by using <code class="literal">Object.create()</code> once again.</p><a id="pro_id00112"/><pre class="programlisting"><span class="pd_green1"><code class="c1">// inherits from Rectangle</code></span>
<span class="pd_green"><code class="kd">function</code></span> <code class="nx">Square</code><code class="p">(</code><code class="nx">size</code><code class="p">)</code> <code class="p">{</code>
    <span class="pd_green"><code class="k">this</code></span><code class="p">.</code><code class="nx">length</code> <span class="pd_ash"><code class="o">=</code></span> <code class="nx">size</code><code class="p">;</code>
    <span class="pd_green"><code class="k">this</code></span><code class="p">.</code><code class="nx">width</code> <span class="pd_ash"><code class="o">=</code></span> <code class="nx">size</code><code class="p">;</code>
<code class="p">}</code>

<code class="nx">Square</code><code class="p">.</code><code class="nx">prototype</code> <span class="pd_ash"><code class="o">=</code></span> <span class="pd_green"><code class="nb">Object</code></span><code class="p">.</code><code class="nx">create</code><code class="p">(</code><code class="nx">Rectangle</code><code class="p">.</code><code class="nx">prototype</code><code class="p">,</code> <code class="p">{</code>
                        <code class="nx">constructor</code><code class="o">:</code> <code class="p">{</code>
                            <code class="nx">configurable</code><code class="o">:</code> <span class="pd_green"><code class="kc">true</code></span><code class="p">,</code>
                            <code class="nx">enumerable</code><code class="o">:</code> <span class="pd_green"><code class="kc">true</code></span><code class="p">,</code>
                            <code class="nx">value</code><code class="o">:</code> <code class="nx">Square</code><code class="p">,</code>
                            <code class="nx">writable</code><code class="o">:</code> <span class="pd_green"><code class="kc">true</code></span>
                        <code class="p">}</code>
                   <code class="p">});</code>
<code class="nx">Square</code><code class="p">.</code><code class="nx">prototype</code><code class="p">.</code><code class="nx">toString</code> <span class="pd_ash"><code class="o">=</code></span> <span class="pd_green"><code class="kd">function</code></span><code class="p">()</code> <code class="p">{</code>
    <span class="pd_green"><code class="k">return</code></span> <span class="pd_red"><code class="s2">"[Square "</code></span> <span class="pd_ash"><code class="o">+</code></span> <span class="pd_green"><code class="k">this</code></span><code class="p">.</code><code class="nx">length</code> <span class="pd_ash"><code class="o">+</code></span> <span class="pd_red"><code class="s2">"x"</code></span> <span class="pd_ash"><code class="o">+</code></span> <span class="pd_green"><code class="k">this</code></span><code class="p">.</code><code class="nx">width</code> <span class="pd_ash"><code class="o">+</code></span> <span class="pd_red"><code class="s2">"]"</code></span><code class="p">;</code>
<code class="p">};</code></pre><p><a id="iddle1017" class="indexterm"/><a id="iddle1042" class="indexterm"/><a id="iddle1065" class="indexterm"/><a id="iddle1067" class="indexterm"/><a id="iddle1069" class="indexterm"/><a id="iddle1340" class="indexterm"/><a id="iddle1351" class="indexterm"/><a id="iddle1354" class="indexterm"/>In this version of the code, <code class="literal">Square.prototype</code> is overwritten with a new object that inherits from <code class="literal">Rectangle.prototype</code>, and the <code class="literal">Rectangle</code> constructor is never called. That means you don’t need to worry about causing an error by calling the constructor without arguments anymore. Otherwise, this code behaves exactly the same as the previous code. The prototype chain remains intact, so all instances of <code class="literal">Square</code> inherit from <code class="literal">Rectangle.prototype</code> and the constructor is restored in the same step.</p><div class="note" title="Note"><h3 class="title"><a id="ch05note01"/>Note</h3><p><span class="emphasis"><em>Always make sure that you overwrite the prototype</em></span> before <span class="emphasis"><em>adding properties to it, or you will lose the added methods when the overwrite happens.</em></span></p></div></div><div class="sect1" title="Constructor Stealing"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="constructor_stealing">Constructor Stealing</h2></div></div></div><p>Because inheritance is accomplished through prototype chains in JavaScript, you don’t need to call an object’s supertype constructor. If you do want to call the supertype constructor from the subtype constructor, then you need to take advantage of how JavaScript functions work.</p><p>In <a class="xref" href="ch02.html" title="Chapter 2. Functions">Chapter 2</a>, you learned about the <code class="literal">call()</code> and <code class="literal">apply()</code> methods, which allow functions to be called with a different <code class="literal">this</code> value. That’s exactly how <span class="emphasis"><em>constructor stealing</em></span> works. You simply call the supertype constructor from the subtype constructor using either <code class="literal">call()</code> or <code class="literal">apply()</code> to pass in the newly created object. In effect, you’re stealing the supertype constructor for your own object, as in this example:</p><a id="pro_id00113"/><pre class="programlisting">  <span class="pd_green"><code class="kd">function</code></span> <code class="nx">Rectangle</code><code class="p">(</code><code class="nx">length</code><code class="p">,</code> <code class="nx">width</code><code class="p">)</code> <code class="p">{</code>
      <span class="pd_green"><code class="k">this</code></span><code class="p">.</code><code class="nx">length</code> <span class="pd_ash"><code class="o">=</code></span> <code class="nx">length</code><code class="p">;</code>
      <span class="pd_green"><code class="k">this</code></span><code class="p">.</code><code class="nx">width</code> <span class="pd_ash"><code class="o">=</code></span> <code class="nx">width</code><code class="p">;</code>
  <code class="p">}</code>

  <code class="nx">Rectangle</code><code class="p">.</code><code class="nx">prototype</code><code class="p">.</code><code class="nx">getArea</code> <span class="pd_ash"><code class="o">=</code></span> <span class="pd_green"><code class="kd">function</code></span><code class="p">()</code> <code class="p">{</code>
      <span class="pd_green"><code class="k">return</code> <code class="k">this</code></span><code class="p">.</code><code class="nx">length</code> <span class="pd_ash"><code class="o">*</code></span> <span class="pd_green"><code class="k">this</code></span><code class="p">.</code><code class="nx">width</code><code class="p">;</code>
  <code class="p">};</code>

  <code class="nx">Rectangle</code><code class="p">.</code><code class="nx">prototype</code><code class="p">.</code><code class="nx">toString</code> <span class="pd_ash"><code class="o">=</code></span> <span class="pd_green"><code class="kd">function</code></span><code class="p">()</code> <code class="p">{</code>
      <span class="pd_green"><code class="k">return</code></span> <span class="pd_red"><code class="s2">"[Rectangle "</code></span> <span class="pd_ash"><code class="o">+</code></span> <span class="pd_green"><code class="k">this</code></span><code class="p">.</code><code class="nx">length</code> <span class="pd_ash"><code class="o">+</code></span> <span class="pd_red"><code class="s2">"x"</code></span> <span class="pd_ash"><code class="o">+</code></span> <span class="pd_green"><code class="k">this</code></span><code class="p">.</code><code class="nx">width</code> <span class="pd_ash"><code class="o">+</code></span> <span class="pd_red"><code class="s2">"]"</code></span><code class="p">;</code>
  <code class="p">};</code>

  <span class="pd_green1"><code class="c1">// inherits from Rectangle</code></span>
<code class="err">❶</code> <span class="pd_green"><code class="kd">function</code></span> <code class="nx">Square</code><code class="p">(</code><code class="nx">size</code><code class="p">)</code> <code class="p">{</code>
      <code class="nx">Rectangle</code><code class="p">.</code><code class="nx">call</code><code class="p">(</code><span class="pd_green"><code class="k">this</code></span><code class="p">,</code> <code class="nx">size</code><code class="p">,</code> <code class="nx">size</code><code class="p">);</code>

      <span class="pd_green1"><code class="c1">// optional: add new properties or override existing ones here</code></span>
  <code class="p">}</code>

  <code class="nx">Square</code><code class="p">.</code><code class="nx">prototype</code> <span class="pd_ash"><code class="o">=</code></span> <span class="pd_green"><code class="nb">Object</code></span><code class="p">.</code><code class="nx">create</code><code class="p">(</code><code class="nx">Rectangle</code><code class="p">.</code><code class="nx">prototype</code><code class="p">,</code> <code class="p">{</code>
                          <code class="nx">constructor</code><code class="o">:</code> <code class="p">{</code>
                              <code class="nx">configurable</code><code class="o">:</code> <span class="pd_green"><code class="kc">true</code></span><code class="p">,</code>
                              <code class="nx">enumerable</code><code class="o">:</code> <span class="pd_green"><code class="kc">true</code></span><code class="p">,</code>
                              <code class="nx">value</code><code class="o">:</code> <code class="nx">Square</code><code class="p">,</code>
                              <code class="nx">writable</code><code class="o">:</code> <span class="pd_green"><code class="kc">true</code></span>
                          <code class="p">}</code>
                      <code class="p">});</code>

  <code class="nx">Square</code><code class="p">.</code><code class="nx">prototype</code><code class="p">.</code><code class="nx">toString</code> <span class="pd_ash"><code class="o">=</code></span> <span class="pd_green"><code class="kd">function</code></span><code class="p">()</code> <code class="p">{</code>
      <span class="pd_green"><code class="k">return</code></span> <span class="pd_red"><code class="s2">"[Square "</code></span> <span class="pd_ash"><code class="o">+</code></span> <span class="pd_green"><code class="k">this</code></span><code class="p">.</code><code class="nx">length</code> <span class="pd_ash"><code class="o">+</code></span> <span class="pd_red"><code class="s2">"x"</code></span> <code class="o">+</code> <span class="pd_green"><code class="k">this</code></span><code class="p">.</code><code class="nx">width</code> <span class="pd_ash"><code class="o">+</code></span> <span class="pd_red"><code class="s2">"]"</code></span><code class="p">;</code>
  <code class="p">};</code>

  <span class="pd_green"><code class="kd">var</code></span> <code class="nx">square</code> <span class="pd_ash"><code class="o">=</code></span> <span class="pd_green"><code class="k">new</code></span> <code class="nx">Square</code><code class="p">(</code><span class="pd_ash"><code class="mi">6</code></span><code class="p">);</code>

  <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">square</code><code class="p">.</code><code class="nx">length</code><code class="p">);</code>        <span class="pd_green1"><code class="c1">// 6</code></span>
  <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">square</code><code class="p">.</code><code class="nx">width</code><code class="p">);</code>         <span class="pd_green1"><code class="c1">// 6</code></span>
  <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">square</code><code class="p">.</code><code class="nx">getArea</code><code class="p">());</code>     <span class="pd_green1"><code class="c1">// 36</code></span></pre><p><a id="iddle1150" class="indexterm"/><a id="iddle1307" class="indexterm"/><a id="iddle1360" class="indexterm"/>The ❶ <code class="literal">Square</code> constructor calls the <code class="literal">Rectangle</code> constructor and passes in <code class="literal">this</code> as well as <code class="literal">size</code> two times (once for <code class="literal">length</code> and once for <code class="literal">width</code>). Doing so creates the <code class="literal">length</code> and <code class="literal">width</code> properties on the new object and makes each equal to <code class="literal">size</code>. This is the way to avoid redefining properties from a constructor from which you want to inherit. You can add new properties or override existing ones after applying the super type constructor.</p><p>This two-step process is useful when you need to accomplish inheritance between custom types. You’ll always need to modify a constructor’s prototype, and you may also need to call the supertype constructor from within the subtype constructor. Generally, you’ll modify the prototype for method inheritance and use constructor stealing for properties. This approach is typically referred to as <span class="emphasis"><em>pseudoclassical inheritance</em></span> because it mimics classical inheritance from class-based languages.</p></div><div class="sect1" title="Accessing Supertype Methods"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="accessing_supertype_methods">Accessing Supertype Methods</h2></div></div></div><p><a id="iddle1188" class="indexterm"/><a id="iddle1355" class="indexterm"/>In the previous example, the <code class="literal">Square</code> type has its own <code class="literal">toString()</code> method that shadows <code class="literal">toString()</code> on the prototype. It is fairly common to override supertype methods with new functionality in the subtype, but what if you still want to access the supertype method? In other languages, you might be able to say <code class="literal">super.toString()</code>, but JavaScript doesn’t have anything similar. Instead, you can directly access the method on the supertype’s prototype and use either <code class="literal">call()</code> or <code class="literal">apply()</code> to execute the method on the subtype object. For example:</p><a id="pro_id00114"/><pre class="programlisting">  <span class="pd_green"><code class="kd">function</code></span> <code class="nx">Rectangle</code><code class="p">(</code><code class="nx">length</code><code class="p">,</code> <code class="nx">width</code><code class="p">)</code> <code class="p">{</code>
      <span class="pd_green"><code class="k">this</code></span><code class="p">.</code><code class="nx">length</code> <span class="pd_ash"><code class="o">=</code></span> <code class="nx">length</code><code class="p">;</code>
      <span class="pd_green"><code class="k">this</code></span><code class="p">.</code><code class="nx">width</code> <span class="pd_ash"><code class="o">=</code></span> <code class="nx">width</code><code class="p">;</code>
  <code class="p">}</code>

  <code class="nx">Rectangle</code><code class="p">.</code><code class="nx">prototype</code><code class="p">.</code><code class="nx">getArea</code> <span class="pd_ash"><code class="o">=</code></span> <span class="pd_green"><code class="kd">function</code></span><code class="p">()</code> <code class="p">{</code>
      <span class="pd_green"><code class="k">return</code> <code class="k">this</code></span><code class="p">.</code><code class="nx">length</code> <span class="pd_ash"><code class="o">*</code></span> <span class="pd_green"><code class="k">this</code></span><code class="p">.</code><code class="nx">width</code><code class="p">;</code>
  <code class="p">};</code>

  <code class="nx">Rectangle</code><code class="p">.</code><code class="nx">prototype</code><code class="p">.</code><code class="nx">toString</code> <span class="pd_ash"><code class="o">=</code></span> <span class="pd_green"><code class="kd">function</code></span><code class="p">()</code> <code class="p">{</code>
      <span class="pd_green"><code class="k">return</code></span> <span class="pd_red"><code class="s2">"[Rectangle "</code></span> <span class="pd_ash"><code class="o">+</code></span> <span class="pd_green"><code class="k">this</code></span><code class="p">.</code><code class="nx">length</code> <span class="pd_ash"><code class="o">+</code></span> <span class="pd_red"><code class="s2">"x"</code></span> <span class="pd_ash"><code class="o">+</code></span> <span class="pd_green"><code class="k">this</code></span><code class="p">.</code><code class="nx">height</code> <span class="pd_ash"><code class="o">+</code></span> <span class="pd_red"><code class="s2">"]"</code></span><code class="p">;</code>
  <code class="p">};</code>

  <span class="pd_green1"><code class="c1">// inherits from Rectangle</code></span>
  <span class="pd_green"><code class="kd">function</code></span> <code class="nx">Square</code><code class="p">(</code><code class="nx">size</code><code class="p">)</code> <code class="p">{</code>
      <code class="nx">Rectangle</code><code class="p">.</code><code class="nx">call</code><code class="p">(</code><span class="pd_green"><code class="k">this</code></span><code class="p">,</code> <code class="nx">size</code><code class="p">,</code> <code class="nx">size</code><code class="p">);</code>
  <code class="p">}</code>

  <code class="nx">Square</code><code class="p">.</code><code class="nx">prototype</code> <span class="pd_ash"><code class="o">=</code></span> <span class="pd_green"><code class="nb">Object</code></span><code class="p">.</code><code class="nx">create</code><code class="p">(</code><code class="nx">Rectangle</code><code class="p">.</code><code class="nx">prototype</code><code class="p">,</code> <code class="p">{</code>
                          <code class="nx">constructor</code><code class="o">:</code> <code class="p">{</code>
                              <code class="nx">configurable</code><code class="o">:</code> <span class="pd_green"><code class="kc">true</code></span><code class="p">,</code>
                              <code class="nx">enumerable</code><code class="o">:</code> <span class="pd_green"><code class="kc">true</code></span><code class="p">,</code>
                              <code class="nx">value</code><code class="o">:</code> <code class="nx">Square</code><code class="p">,</code>
                              <code class="nx">writable</code><code class="o">:</code> <span class="pd_green"><code class="kc">true</code></span>
                          <code class="p">}</code>
                      <code class="p">});</code>
  <span class="pd_green1"><code class="c1">// call the supertype method</code></span>
<code class="err">❶</code> <code class="nx">Square</code><code class="p">.</code><code class="nx">prototype</code><code class="p">.</code><code class="nx">toString</code> <span class="pd_ash"><code class="o">=</code></span> <span class="pd_green"><code class="kd">function</code></span><code class="p">()</code> <code class="p">{</code>
      <span class="pd_green"><code class="kd">var</code></span> <code class="nx">text</code> <span class="pd_ash"><code class="o">=</code></span> <code class="nx">Rectangle</code><code class="p">.</code><code class="nx">prototype</code><code class="p">.</code><code class="nx">toString</code><code class="p">.</code><code class="nx">call</code><code class="p">(</code><span class="pd_green"><code class="k">this</code><code class="p">);</code></span>
      <span class="pd_green"><code class="k">return</code></span> <code class="nx">text</code><code class="p">.</code><code class="nx">replace</code><code class="p">(</code><span class="pd_red"><code class="s2">"Rectangle"</code></span><code class="p">,</code> <span class="pd_red"><code class="s2">"Square"</code></span><code class="p">);</code>
  <code class="p">};</code></pre><p>In this version of the code, ❶ <code class="literal">Square.prototype.toString()</code> calls <code class="literal">Rectangle.prototype.toString()</code> by using <code class="literal">call()</code>. The method just needs to replace <code class="literal">"Rectangle"</code> with <code class="literal">"Square"</code> before returning the resulting text. This approach may seem a bit verbose for such a simple operation, but it is the only way to access a supertype’s method.</p></div><div class="sect1" title="Summary"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="summary-id00006">Summary</h2></div></div></div><p>JavaScript supports inheritance through prototype chaining. A prototype chain is created between objects when the <code class="literal">[[Prototype]]</code> of one object is set equal to another. All generic objects automatically inherit from <code class="literal">Object.prototype</code>. If you want to create an object that inherits from something else, you can use <code class="literal">Object.create()</code> to specify the value of <code class="literal">[[Prototype]]</code> for a new object.</p><p>You accomplish inheritance between custom types by creating a prototype chain on the constructor. By setting the constructor’s <code class="literal">prototype</code> property to another value, you create inheritance between instances of the custom type and the prototype of that other value. All instances of that constructor share the same prototype, so they all inherit from the same object. This technique works very well for inheriting methods from other objects, but you cannot inherit own properties using prototypes.</p><p>To inherit own properties correctly, you can use constructor stealing, which is simply calling a constructor function using <code class="literal">call()</code> or <code class="literal">apply()</code> so that any initialization is done on the subtype object. Combining constructor stealing and prototype chaining is the most common way to achieve inheritance between custom types in JavaScript. This combination is frequently called pseudoclassical inheritance because of its similarity to inheritance in class-based languages.</p><p>You can access methods on a supertype by directly accessing the supertype’s prototype. In doing so, you must use <code class="literal">call()</code> or <code class="literal">apply()</code> to execute the supertype method on the subtype object.</p></div><div class="footnotes" epub:type="footnotes"><br/><hr style="width: 100; align: left;"/><div class="footnote" id="ftn.ch05fn01"><p><sup>[<a href="#ch05fn01" class="para">1</a>] </sup>See Douglas Crockford’s “Code Conventions for the JavaScript Programming Language” (<span class="emphasis"><em><a class="ulink" href="http://javascript.crockford.com/code.html" target="_top">http://javascript.crockford.com/code.html</a></em></span>).</p></div></div></section></body></html>