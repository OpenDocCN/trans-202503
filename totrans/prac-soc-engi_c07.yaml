- en: '7'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '7'
- en: Phishing
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 网络钓鱼
- en: '![](image_fi/book_art/chapterart.png)'
  id: totrans-2
  prefs: []
  type: TYPE_IMG
  zh: '![](image_fi/book_art/chapterart.png)'
- en: In this chapter, you’ll create a phishing campaign. We’ll walk through the infrastructure
    you’ll need if you want to create an attack manually, and then discuss automated
    solutions, technical features like tracking pixels that you can add to your attack,
    and the factors you should consider before deployment to make your engagement
    successful. This chapter should help any social engineer get started with email-based
    attacks. It may also be a refresher for system administrators or an informative
    guide for someone coming from a Security Operations Center or compliance role.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，你将创建一个网络钓鱼活动。我们将介绍如果你想手动创建攻击所需的基础设施，然后讨论自动化解决方案、你可以在攻击中加入的技术功能，如跟踪像素，以及在部署前需要考虑的因素，以确保活动的成功。本章应帮助任何社会工程师开始进行基于邮件的攻击，也可能为系统管理员提供复习，或为来自安全运营中心或合规角色的人提供信息性指南。
- en: Setting Up a Phishing Attack
  id: totrans-4
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 设置网络钓鱼攻击
- en: The proper architecture to use for a phishing attack varies. The tools you’ll
    need all depend on the engagement’s scope, SOW, contract, and client’s desires.
    For example, if the client wants you to measure how many employees click a sketchy
    link in an email, all you need is a simple web server that captures HTTP GET requests
    and displays a 404 or Thank You page to the user. The responses will be stored
    in an Apache log.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 网络钓鱼攻击所需的架构会有所不同。你需要的工具完全取决于任务的范围、工作说明书（SOW）、合同以及客户的需求。例如，如果客户希望你衡量有多少员工点击了邮件中的可疑链接，你只需要一个简单的Web服务器来捕获HTTP
    GET请求，并向用户显示404页面或“感谢”页面。响应将被存储在Apache日志中。
- en: From there, things get more complicated. Does the client want you to spoof or
    squat? You could *spoof* a legitimate domain, sending an email and manipulating
    the information displayed to the recipient to make it appear as if it came from
    a legitimate source, but spoofing is easy to detect.
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 从这里开始，事情变得更加复杂。客户是否希望你进行伪装或蹲守？你可以*伪装*一个合法的域名，发送邮件并操控显示给接收者的信息，使其看起来像是来自合法来源，但伪装是很容易被发现的。
- en: '*Squatting*, a similar technique, is less risky, and you’re less likely to
    get caught. It involves registering a domain similar to the recipient’s, such
    as *.co.uk* to a company’s *.com* domain. This makes your emails appear to come
    from the legitimate domain—at least to those who don’t look too closely.'
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: '*蹲守*（Squatting），一种类似的技术，风险较低，且不容易被抓住。它涉及注册一个类似于目标接收者域名的域名，比如将公司*.com*的域名注册成*.co.uk*。这样，你的邮件看起来就像是来自合法的域名——至少对那些不仔细查看的人来说是这样。'
- en: Next, do your clients want you to collect user credentials or other sensitive
    information, like password-reset questions? In that case, your email will have
    to link to a web page that asks for this information in a convincing way. Or do
    your clients want you to send malicious documents? If so, you’ll need to create
    those documents and find a place to host them without getting flagged by security
    tools.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，你的客户是否希望你收集用户凭证或其他敏感信息，如密码重置问题？如果是这样，你的邮件将需要链接到一个网页，要求以令人信服的方式输入这些信息。或者，你的客户是否希望你发送恶意文档？如果是，你需要创建这些文档，并找到一个地方托管它们，同时避免被安全工具标记。
- en: Do they want you to use an automated phishing solution, like King Phisher or
    Gophish? If you phish regularly, you’ll likely already have an automated setup,
    but even if you do, you may need to make some changes or input your own email
    designs. The most successful social engineers understand both the technical aspects
    of the architecture and the human element that makes their attack succeed.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 他们是否希望你使用自动化的网络钓鱼解决方案，比如King Phisher或Gophish？如果你经常进行网络钓鱼攻击，你可能已经有了自动化的设置，但即便如此，你可能仍需要进行一些修改或输入你自己的邮件设计。最成功的社会工程师不仅理解架构的技术细节，还能把握人类因素，这使他们的攻击能够成功。
- en: In this section, you’ll set up a sophisticated phishing attack designed to fool
    users and evade detection. By setting up your own VPS, email server, and landing
    page, you’ll be able to send emails that appear to come from a legitimate company
    email address. You’ll include a link in the body of the email that directs users
    to a web page, prompting them to enter their credentials.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，你将设置一个复杂的网络钓鱼攻击，旨在欺骗用户并避免检测。通过设置自己的VPS、邮件服务器和登录页面，你将能够发送看起来来自合法公司邮件地址的邮件。在邮件正文中，你会包含一个链接，引导用户访问一个网页，促使他们输入凭证。
- en: Setting Up a Secure VPS Instance for Phishing Landing Pages
  id: totrans-11
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 为网络钓鱼登录页面设置安全的VPS实例
- en: No matter what you do in your engagement, you’ll almost always need a VPS instance.
    Through a VPS, you’ll be able to host a landing page and run a mail server if
    you choose, all without linking your attack to your IP address.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 无论你在参与过程中做什么，几乎总是需要一个 VPS 实例。通过 VPS，你可以托管一个登陆页面并运行邮件服务器（如果需要），而无需将你的攻击行为与你的
    IP 地址关联。
- en: In this section, I’ll show you how to set up a secure VPS with DigitalOcean,
    a cloud infrastructure company that lets you use its services for security research.
    *Droplets,* which are DigitalOcean VPS instances, start at low monthly prices
    and come with backups, snapshots, storage volumes, DNS, a CDN, load balancing,
    one-click applications, and network firewalls. You can choose from a variety of
    Linux and BSD operating systems, containers, and preloaded apps like Node.js,
    LAMP, WordPress, GitLab, and Docker.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 在这一节中，我将向你展示如何使用 DigitalOcean 设置一个安全的 VPS。DigitalOcean 是一家云基础设施公司，允许你在其平台上进行安全研究。**滴灌（Droplets）**是
    DigitalOcean 的 VPS 实例，起始价格较低，且包含备份、快照、存储卷、DNS、CDN、负载均衡、一键应用和网络防火墙等功能。你可以选择多种 Linux
    和 BSD 操作系统、容器以及预装的应用程序，如 Node.js、LAMP、WordPress、GitLab 和 Docker。
- en: Note that DigitalOcean has data centers in New York, San Francisco, Toronto,
    Bangalore, Amsterdam, Frankfurt, London, and Singapore. These locations can matter,
    because some regions filter certain content, and some companies filter traffic
    based on country. Additionally, if you are dealing with European citizens and
    their data, you should seek legal counsel regarding the EU GDPR.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，DigitalOcean 在纽约、旧金山、多伦多、班加罗尔、阿姆斯特丹、法兰克福、伦敦和新加坡设有数据中心。这些位置很重要，因为某些地区会过滤特定的内容，而一些公司则会根据国家过滤流量。此外，如果你处理的是欧洲公民的数据，你应该就欧盟
    GDPR 寻求法律建议。
- en: Ideally, you should set up your VPS with your domain and web server at least
    two weeks before the engagement. That’s because some mail server security platforms
    reject all mail from domains that are less than two weeks old.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 理想情况下，你应该在任务开始前至少两周就设置好你的 VPS、域名和 Web 服务器。这是因为一些邮件服务器安全平台会拒绝来自成立不到两周的域名的所有邮件。
- en: Creating a DigitalOcean Account and Droplet
  id: totrans-16
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 创建 DigitalOcean 账户和滴灌
- en: To set up a DigitalOcean droplet, you need to create an account. Navigate to
    [https://www.digitalocean.com/](https://www.digitalocean.com/) and follow the
    page’s sign-up instructions. I recommend enabling two-factor authentication for
    your account to prevent anyone from gaining access should they compromise your
    password.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 要设置 DigitalOcean 滴灌，你需要先创建一个账户。访问 [https://www.digitalocean.com/](https://www.digitalocean.com/)
    并按照页面上的注册说明操作。我建议启用账户的双重身份验证，以防他人通过破解你的密码访问你的账户。
- en: Once logged in, select **Create**▶**Droplet**. Select your desired operating
    system. I recommend using either Kali or Debian Linux. Then size the droplet to
    determine the number of processors and the amount of RAM it should use. The more
    connections the droplet will have, the more processing power it will need. For
    a short engagement that targets, say, 150 users, the standard droplet should work
    without issue. Next, you can choose to use IPv6, private networking, backups,
    or your own RSA key. You can also add a hostname or spin up multiple droplets.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 登录后，选择 **创建**▶**滴灌（Droplet）**。选择你所需的操作系统。我推荐使用 Kali 或 Debian Linux。然后根据需要调整滴灌的配置，确定所需的处理器数量和内存大小。滴灌连接的用户越多，它所需的处理能力也会越大。如果是一个针对大约
    150 个用户的小型任务，标准滴灌应该能正常运行。接下来，你可以选择使用 IPv6、私有网络、备份或你自己的 RSA 密钥。你还可以添加主机名或创建多个滴灌。
- en: You should see the droplet’s IP address once it’s created. DigitalOcean will
    email you the initial root credential for the host, as well as the IP address.
    If you upload an SSH key pair, as described in the next section, you can use this
    information to log in. If you do not, DigitalOcean will email you a temporary
    root password, but you will be prompted to change it after your first login.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦创建完成，你应该能够看到滴灌的 IP 地址。DigitalOcean 会通过电子邮件发送初始的 root 凭据给你，并附上 IP 地址。如果你上传了
    SSH 密钥对，按照下一节的描述，你可以使用这些信息进行登录。如果没有，DigitalOcean 会通过电子邮件发送临时的 root 密码，但在第一次登录后你会被提示更改密码。
- en: Creating an SSH Key Pair to Secure the VPS
  id: totrans-20
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 创建 SSH 密钥对以保护 VPS
- en: Having a strong authentication method is important, because this server is internet
    facing. When I used DigitalOcean to run *honeypots*—purposely vulnerable systems
    created with the aim of being attacked, allowing researchers to study the attackers’
    techniques and behavior, or alerting administrators of a system compromise—the
    hosts were hammered by scanners and would-be exploiters.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 拥有强身份验证方法很重要，因为这个服务器是面向互联网的。当我使用DigitalOcean运行*蜜罐*——故意设计成脆弱的系统，目的是被攻击，以便研究人员研究攻击者的技术和行为，或提醒管理员系统被攻击——这些主机受到了扫描器和潜在攻击者的猛烈攻击。
- en: To prevent attackers from brute-forcing your password, create an SSH key pair.
    Also known as an *RSA key pair*, an *SSH key pair* is a private and public RSA
    key used to log in. You will copy the private key (`id_rsa` by default) to your
    remote system and copy the public key (`id_rsa.pub` by default) to the *authorized_keys*
    file to allow the login to occur. SSH keys allow you to disable password authentication.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 为了防止攻击者暴力破解你的密码，创建SSH密钥对。SSH密钥对，也称为*RSA密钥对*，是一对用于登录的私有和公有RSA密钥。你将私钥（默认是`id_rsa`）复制到远程系统，并将公钥（默认是`id_rsa.pub`）复制到*authorized_keys*文件中，以允许登录。SSH密钥还可以禁用密码认证。
- en: 'First, execute the following command in your terminal:'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，在终端中执行以下命令：
- en: '[PRE0]'
  id: totrans-24
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: The `ssh-keygen` command creates the key pair. By default, the keys appear in
    the */root/.ssh* directory on the VPS. You can choose to write the keys to a particular
    location by passing `-C /path/` to the `ssh-keygen` command, followed by the desired
    file path. You may also want to enter a passphrase with your SSH key to create
    a second authentication factor. You will be prompted to enter a passphrase while
    creating the key pair. If you don’t want to use one, press enter to continue.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: '`ssh-keygen`命令会生成密钥对。默认情况下，密钥会出现在VPS的*/root/.ssh*目录下。你可以通过向`ssh-keygen`命令传递`-C
    /path/`选项，后跟所需的文件路径，来选择将密钥写入特定位置。你可能还需要为SSH密钥设置一个密码短语，以创建第二重身份验证因素。在创建密钥对时，系统会提示你输入密码短语。如果你不想使用密码短语，直接按回车键继续。'
- en: You’ll need to access the VPS key pair on the system you’ll use to control the
    VPS. To do this, use the Secure Copy Protocol (SCP) or an SCP client. If you’re
    on a Windows host, you could use *WinSCP*, which is a terminal emulator that allows
    Windows users to connect directly to Linux hosts over FTP, SSH, and Telnet. If
    you are on a Mac or Linux host, you can use an SCP client like the native terminal,
    iTerm2, Cyberduck, or Termius. This will allow you to move the RSA keys to and
    from the droplet. You can also use the SCP client later to move artifacts, such
    as files, to and from the droplet.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 你需要在用来控制VPS的系统上访问VPS密钥对。为此，可以使用安全复制协议（SCP）或SCP客户端。如果你使用的是Windows主机，可以使用*WinSCP*，它是一个终端仿真器，允许Windows用户通过FTP、SSH和Telnet直接连接到Linux主机。如果你使用的是Mac或Linux主机，可以使用类似原生终端、iTerm2、Cyberduck或Termius的SCP客户端。这将允许你在Droplet之间移动RSA密钥。你也可以稍后使用SCP客户端将文件等工件在Droplet之间移动。
- en: To copy the files using WinSCP, log in to the VPS using the credentials (password
    or RSA key pair) you created and drag and drop the files in either direction from
    within the GUI. You will need to ensure that you have the correct permissions
    for your file. Run the command `chmod 600``filename_of_private_key` to ensure
    you have the proper permissions set.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 使用WinSCP复制文件时，使用你创建的凭据（密码或RSA密钥对）登录VPS，然后在GUI中拖放文件即可。你需要确保文件具有正确的权限。运行命令`chmod
    600``filename_of_private_key`以确保你设置了正确的权限。
- en: Setting Up Windows Remote Access to the VPS
  id: totrans-28
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 设置Windows远程访问VPS
- en: Once you have moved the RSA key to your workstation, install a client that will
    give you remote access to your VPS. You need remote access in order to set up
    the landing page and configure any additional services, such as mail servers,
    on the VPS.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦你将RSA密钥移动到工作站，安装一个客户端来为你提供VPS的远程访问。你需要远程访问以便在VPS上设置登录页面并配置其他服务，如邮件服务器。
- en: On Windows, you can get remote access with the PuTTY tool. Download PuTTYgen
    from the PuTTY website, [https://www.putty.org/](https://www.putty.org/). Then,
    create a PuTTY Private Key (PPK) file to use in PuTTY and WinSCP by importing
    your RSA private key into the software. In the PuTTY Key Generator window, click
    **Generate** ([Figure 7-1](#figure7-1)).
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 在Windows上，你可以使用PuTTY工具进行远程访问。从PuTTY官方网站下载PuTTYgen，[https://www.putty.org/](https://www.putty.org/)。然后，通过将RSA私钥导入到该软件中，创建一个PuTTY私钥（PPK）文件，用于PuTTY和WinSCP。在PuTTY密钥生成器窗口中，点击**生成**（[图7-1](#figure7-1)）。
- en: Import the `id_rsa` key from the host into PuTTYgen. You should see the key
    generated in PPK format, as shown in [Figure 7-2](#figure7-2).
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 将 `id_rsa` 密钥从主机导入到 PuTTYgen 中。你应该能看到以 PPK 格式生成的密钥，如[图 7-2](#figure7-2)所示。
- en: '![<<PuTTY Key Generator window shows options to generate a public/private key
    pair, load an existing private key file, save the generated key, and select the
    key parameters and number of bits. “Generate” button highlighted.>>](image_fi/500983c07/f07001.png)'
  id: totrans-32
  prefs: []
  type: TYPE_IMG
  zh: '![<<PuTTY 密钥生成器窗口显示生成公私钥对、加载现有私钥文件、保存生成的密钥、选择密钥参数和位数的选项。“Generate”按钮高亮显示。>>](image_fi/500983c07/f07001.png)'
- en: 'Figure 7-1: PuTTYgen'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 图 7-1：PuTTYgen
- en: '![<<PuTTY Key Generator window shows public key in PPK format for pasting into
    OpenSSH authorized_keys file.>>](image_fi/500983c07/f07002.png)'
  id: totrans-34
  prefs: []
  type: TYPE_IMG
  zh: '![<<PuTTY 密钥生成器窗口显示 PPK 格式的公钥，可粘贴到 OpenSSH authorized_keys 文件中。>>](image_fi/500983c07/f07002.png)'
- en: 'Figure 7-2: Creating a PPK'
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 图 7-2：创建 PPK
- en: Next, load the key into the PuTTY session. To do so, add your username or your
    droplet’s IP address into the **Host Name (or IP Address)** field ([Figure 7-3](#figure7-3)).
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，将密钥加载到 PuTTY 会话中。为此，将你的用户名或滴滴（droplet）的 IP 地址输入 **Host Name (or IP Address)**
    字段中（见[图 7-3](#figure7-3)）。
- en: '![<<PuTTY Configuration window shows basic options for the PuTTY session. "root@127.0.1.1"
    listed in Host Name field and "22" listed in Port field. SSH connection type selected.
    BOOK saved session and Load button highlighted.>>](image_fi/500983c07/f07003.png)'
  id: totrans-37
  prefs: []
  type: TYPE_IMG
  zh: '![<<PuTTY 配置窗口显示 PuTTY 会话的基本选项。主机名字段列出了 "root@127.0.1.1"，端口字段列出了 "22"。已选择 SSH
    连接类型。BOOK 保存的会话和 Load 按钮高亮显示。>>](image_fi/500983c07/f07003.png)'
- en: 'Figure 7-3: PuTTY configuration'
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 图 7-3：PuTTY 配置
- en: Then select **Connection**▶**SSH**▶**Auth** from the left pane ([Figure 7-4](#figure7-4)).
    Enter the file path to the PPK file in the **Private key file for authentication**
    field. Finally, click **Session** at the top of the left pane, and then give the
    instance a name and save it. To connect to the host, click **Open**.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 然后从左侧窗格中选择 **Connection**▶**SSH**▶**Auth**（见[图 7-4](#figure7-4)）。在 **Private
    key file for authentication** 字段中输入 PPK 文件的文件路径。最后，点击左侧窗格顶部的 **Session**，为实例命名并保存。要连接到主机，点击
    **Open**。
- en: '![<<PuTTY Configuration window shows options controlling SSH authentication,
    accessed from the Connection category under SSH and Auth (outlined in red). "Display
    pre-authentication banner (SSH-2 only)," "Attempt authentication using Pageant,"
    and "Attempt ''keyboard-interactive'' auth (SSH-2)" options are selected. File
    path field to upload private key file for authentication also outlined.>>](image_fi/500983c07/f07004.png)'
  id: totrans-40
  prefs: []
  type: TYPE_IMG
  zh: '![<<PuTTY 配置窗口显示控制 SSH 身份验证的选项，可以从 Connection 类别下的 SSH 和 Auth（用红色框标出）访问。已选择“Display
    pre-authentication banner (SSH-2 only)”、“Attempt authentication using Pageant”和“Attempt
    ''keyboard-interactive'' auth (SSH-2)”选项。用于上传私钥文件进行身份验证的文件路径字段也已框选。>>](image_fi/500983c07/f07004.png)'
- en: 'Figure 7-4: Configuring PuTTY to use the PPK'
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 图 7-4：配置 PuTTY 使用 PPK
- en: Now that you’ve configured PuTTY to use SSH keys, enter your passphrase, if
    you set one, to log in to the VPS. Update all packages and run any outstanding
    security updates to protect yourself against attacks on the public internet.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 现在你已经配置了 PuTTY 使用 SSH 密钥，输入你设置的密码短语（如果设置了的话）来登录到 VPS。更新所有包并运行任何未完成的安全更新，以保护自己免受公共互联网的攻击。
- en: Setting Up macOS or Linux Remote Access to the VPS
  id: totrans-43
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 设置 macOS 或 Linux 远程访问 VPS
- en: 'If you’re accessing the VPS from a macOS or Linux operating system, you’ll
    have to copy the RSA private key over first, either via SCP or copy and paste.
    You can do this from the terminal. Issue the following command to copy over the
    key (I’ve censored the IP address in this example):'
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你从 macOS 或 Linux 操作系统访问 VPS，你需要先将 RSA 私钥复制过去，可以通过 SCP 或复制粘贴完成。这可以通过终端来操作。执行以下命令来复制密钥（在这个例子中，我已经屏蔽了
    IP 地址）：
- en: '[PRE1]'
  id: totrans-45
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'If you’re using a remote access tool like Termius, a paid solution that allows
    you to save SSH sessions, you won’t have to copy over the file, but you’ll need
    to copy and paste the contents of the file into your keychain. To accomplish this,
    execute the following command:'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你使用像 Termius 这样的远程访问工具，它是一个付费解决方案，允许你保存 SSH 会话，那么你不需要复制文件，但你需要将文件的内容复制并粘贴到你的钥匙链中。为此，执行以下命令：
- en: '[PRE2]'
  id: totrans-47
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'If using a terminal to connect via SSH, execute the following command to gain
    access:'
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 如果使用终端通过 SSH 连接，执行以下命令来获得访问权限：
- en: '[PRE3]'
  id: totrans-49
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: If everything runs properly, you will see a prompt on the VPS showing last login
    and any packages to be updated. If the key is not configured properly, you will
    see an error indicating what went wrong.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 如果一切正常运行，你将在 VPS 上看到最后登录的提示，以及任何需要更新的包。如果密钥配置不正确，你将看到一个错误，指示出了问题所在。
- en: Disabling Password-Based Authentication
  id: totrans-51
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 禁用基于密码的认证
- en: Now that you’re connected, take steps to make sure your VPS remains secure.
    First, remove the ability to log in to the system itself using a password. (This
    won’t affect any web applications you install later.) Anyone who logs in to this
    VPS will need the RSA private key, which is extremely difficult (if not impossible)
    to brute-force, unlike passwords.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 既然你已经连接，接下来要采取措施确保你的 VPS 保持安全。首先，移除通过密码登录系统的能力。（这不会影响你以后安装的任何 Web 应用程序。）任何登录到此
    VPS 的人都需要 RSA 私钥，这种密钥极难（如果不是不可能的话）进行暴力破解，而不像密码那样容易。
- en: 'Ensure that the *authorized_keys* file contains the public key you created
    earlier by executing the following command:'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 通过执行以下命令，确保 *authorized_keys* 文件包含你之前创建的公钥：
- en: '[PRE4]'
  id: totrans-54
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: Open the *sshd_config* file in a text editor and change `#PasswordAuthentication
    yes` to `PasswordAuthentication no`.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 在文本编辑器中打开 *sshd_config* 文件，并将 `#PasswordAuthentication yes` 更改为 `PasswordAuthentication
    no`。
- en: 'To do so, execute the following command:'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 为此，执行以下命令：
- en: '[PRE5]'
  id: totrans-57
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'Save the file, then restart SSH. You will need to define the key in your `ssh`
    command to connect to the VPS:'
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 保存文件后，重新启动 SSH。你需要在 `ssh` 命令中定义密钥以连接到 VPS：
- en: '[PRE6]'
  id: totrans-59
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: Then enter your passphrase if you’ve created one.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 然后输入你创建的密码短语（如果有的话）。
- en: Installing a Firewall
  id: totrans-61
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 安装防火墙
- en: 'Next, you need a firewall to limit the ports on the VPS that an application
    can access, and the hosts that can access the VPS. This will keep vulnerability
    scanning bots and attackers from connecting with the VPS, preventing collateral
    damage. Install *Uncomplicated Firewall* (`ufw`) if it’s not already installed:'
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，你需要一个防火墙来限制 VPS 上某个应用程序可以访问的端口以及哪些主机可以访问 VPS。这将防止漏洞扫描机器人和攻击者连接到 VPS，避免连带损害。如果尚未安装
    *Uncomplicated Firewall*（`ufw`），请安装它：
- en: '[PRE7]'
  id: totrans-63
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'Now make sure you can access the firewall by issuing `ufw enable`*.* The following
    steps create new rules to control the flow of data in and out of your VPS:'
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，确保通过发出 `ufw enable` 来启用防火墙。接下来的步骤将创建新规则来控制数据进出 VPS 的流动：
- en: '[PRE8]'
  id: totrans-65
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: You can run the firewall on a specific port, as opposed to all ports, by adding
    `port` `port_number` to the IP address for source or destination.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以在特定端口上运行防火墙，而不是在所有端口上，通过将 `port` `port_number` 添加到源地址或目标地址的 IP 地址中。
- en: To set up the firewall, log in to DigitalOcean and navigate to the **Networking**
    menu along the left pane. Next, select **Firewalls**. If you already have a firewall
    connected to DigitalOcean, select it from the list, as shown in [Figure 7-5](#figure7-5).
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 要设置防火墙，请登录到 DigitalOcean 并导航到左侧面板中的**网络**菜单。接下来，选择**防火墙**。如果你已经有连接到 DigitalOcean
    的防火墙，从列表中选择它，如[图 7-5](#figure7-5)所示。
- en: '![<<DigitalOcean web page displays Firewalls tab under the Networking menu.
    Shows an entry named "Web" with 0 droplets and 4 rules, created Just now.>>](image_fi/500983c07/f07005.png)'
  id: totrans-68
  prefs: []
  type: TYPE_IMG
  zh: '![<<DigitalOcean 网页显示了网络菜单下的防火墙标签。显示了一个名为“Web”的条目，包含 0 个 Droplet 和 4 条规则，刚刚创建。>>](image_fi/500983c07/f07005.png)'
- en: 'Figure 7-5: Setting up a DigitalOcean firewall'
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 图 7-5：设置 DigitalOcean 防火墙
- en: If you don’t have a firewall already, click the green **Create** button and
    choose **Firewall** from the drop-down. This should take you to a page, shown
    in [Figure 7-6](#figure7-6), that prompts you to create inbound rules. An *inbound
    rule* dictates how the VPS will interact with connections coming into it. An *outbound
    rule* dictates how the VPS will behave when trying to connect to other hosts,
    sometimes also referred to as *egress filtering*.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你还没有防火墙，点击绿色的**创建**按钮，并从下拉菜单中选择**防火墙**。这将带你到一个页面，如[图 7-6](#figure7-6)所示，提示你创建传入规则。*传入规则*决定了
    VPS 如何与进入的连接进行交互。*传出规则*则决定了 VPS 在尝试连接其他主机时的行为，有时也称为 *出口过滤*。
- en: '![<<DigitalOcean screenshot of the Create Firewall page displays name (Book)
    and fields for inputting Inbound Rules for incoming traffic (Type, Protocol, Port
    Range, and Sources).>>](image_fi/500983c07/f07006.png)'
  id: totrans-71
  prefs: []
  type: TYPE_IMG
  zh: '![<<DigitalOcean 创建防火墙页面的截图，显示了名称（书籍）以及输入传入流量的规则（类型、协议、端口范围和来源）的字段。>>](image_fi/500983c07/f07006.png)'
- en: 'Figure 7-6: Creating a DigitalOcean firewall'
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 图 7-6：创建 DigitalOcean 防火墙
- en: Since you may use this host for phishing, you probably want the web server to
    be publicly accessible. Depending on your contract with the client, you may want
    to restrict this to hosts in their IP ranges. It’s also a good idea to limit IP
    ranges if you’re using the server to host malicious scripts for use in your phish.
    This would keep web crawlers and threat intelligence firms from spidering your
    website and finding it—a quick way to end up on blacklists and in threat intelligence
    feeds ingested by intrusion detection systems, SIEM programs, and other defensive
    technologies.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 由于你可能会用这个主机进行网络钓鱼，你可能希望让web服务器对外公开。根据你与客户的合同，你可能希望将访问限制在客户IP范围内。如果你将服务器用于托管恶意脚本以便进行钓鱼，这样做也是一个好主意。这样可以防止网络爬虫和威胁情报公司抓取你的网站并发现它，这是一种迅速被列入黑名单和威胁情报源（这些源会被入侵检测系统、SIEM程序和其他防御技术收录）的方式。
- en: To give only a specific range of IP addresses access to your server, create
    an inbound rule for HTTP on TCP port 80 and HTTPS on TCP port 443 accepting inbound
    connections from **All IPv4** and **All IPv6** unless the preceding conditions
    apply. Make sure to create an inbound rule that lets you connect to the host using
    SSH from any IP addresses that you personally use.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 若要仅允许特定IP地址范围访问你的服务器，请为HTTP（TCP端口80）和HTTPS（TCP端口443）创建一个入站规则，接受来自**所有IPv4**和**所有IPv6**的入站连接，除非满足前述条件。确保创建一个入站规则，允许你从任何你个人使用的IP地址通过SSH连接到主机。
- en: 'The system image from your VPS provider may not be fully up to date. To update
    a Linux system, execute the following commands:'
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 你的VPS提供商提供的系统镜像可能没有完全更新。要更新Linux系统，执行以下命令：
- en: '[PRE9]'
  id: totrans-76
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: The `apt-get update` command gives you a list of the updated packages, `apt-get
    upgrade` executes the updates, and `apt-get dist-upgrade` updates the kernel as
    well as software dependencies. The `-y` switch answers yes to most of the prompts
    you may receive.
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: '`apt-get update`命令会列出已更新的包，`apt-get upgrade`执行更新，`apt-get dist-upgrade`更新内核以及软件依赖项。`-y`开关会默认对你可能收到的大多数提示回答“是”。'
- en: Choosing an Email Platform
  id: totrans-78
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 选择电子邮件平台
- en: Now that you have the VPS, you need to choose which service you’ll use to actually
    send your email. Although you could use a free email account from Yahoo! or Gmail,
    doing so might arouse suspicion if you’re posing as an authoritative figure. Free
    email accounts could work for certain attacks, such as ones targeting HR in which
    you pretend to be a hiring candidate. In most cases, though, it is better to use
    a domain that is not free, and so you’ll need to set up an email server.
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 既然你已经有了VPS，现在需要选择实际用于发送电子邮件的服务。虽然你可以使用Yahoo!或Gmail的免费电子邮件账户，但如果你假装是权威人士，这可能会引起怀疑。免费电子邮件账户在某些攻击中可能有效，例如针对人力资源的攻击，在这种攻击中你假装是求职者。然而，在大多数情况下，使用非免费的域名更好，因此你需要搭建一个电子邮件服务器。
- en: 'The available services use several protocols to send mail, each with its strengths
    and weaknesses. In terms of choosing protocols, the blog post “Managed File Transfer
    and Network Solutions” by John Carl Villanueva ([https://jscape.com/blog/smtp-vs-imap-vs-pop3-difference/](https://jscape.com/blog/smtp-vs-imap-vs-pop3-difference/))
    is a comprehensive resource. Email protocols include the following:'
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 可用的服务使用多种协议发送邮件，每种协议都有其优缺点。关于选择协议，John Carl Villanueva的博客文章《管理文件传输与网络解决方案》（[https://jscape.com/blog/smtp-vs-imap-vs-pop3-difference/](https://jscape.com/blog/smtp-vs-imap-vs-pop3-difference/)）是一个全面的资源。电子邮件协议包括以下几种：
- en: '**Simple Mail Transfer Protocol (SMTP)**'
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: '**简单邮件传输协议（SMTP）**'
- en: Defined in RFC 5321\. Uses port 25 by default. It may also use port 587 and
    port 465\.
  id: totrans-82
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在RFC 5321中定义。默认使用25端口，也可以使用587端口和465端口。
- en: '**Internet Message Access Protocol (IMAP)**'
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: '**互联网邮件访问协议（IMAP）**'
- en: Defined in RFC 3501\. Uses port 143 (or 993 for SSL/TLS connections).
  id: totrans-84
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在RFC 3501中定义。使用143端口（或者对于SSL/TLS连接使用993端口）。
- en: '**Post Office Protocol v3 (POP3)**'
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: '**邮局协议 v3（POP3）**'
- en: Defined inRFC 1939\. Uses port 110 (or 995 for SSL/TLS connections).
  id: totrans-86
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在RFC 1939中定义。使用110端口（或对于SSL/TLS连接使用995端口）。
- en: 'If you’re planning to spoof your email, you must use SMTP. POP3 and IMAP4 do
    not support spoofing but will work with squatting. If you have the autonomy to
    decide which email server to use for yourself, you can use one of a few options:'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你计划伪造电子邮件，你必须使用SMTP。POP3和IMAP4不支持伪造，但可以用于占位。如果你有自主权决定使用哪个电子邮件服务器，你可以选择以下几个选项：
- en: '**Dovecot**'
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: '**Dovecot**'
- en: An open source IMAP and POP3 email server for Linux/Unix-like systems. It is
    lightweight, meaning it uses little memory and does not require a lot of processing.
    As with any software, you must maintain a secure configuration and keep the system
    up to date in order to remain secure. If you are doing sporadic, low volumes of
    phishing, this upkeep may not be worth the effort and time, even though the software
    is free. If you’re phishing from a large pool of domains, or sending emails multiple
    times per day, this may be a more economical solution. Since Dovecot does not
    support SMTP, it does not support spoofing. You can use Dovecot for squatting
    attacks.
  id: totrans-89
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一个适用于 Linux/Unix 类系统的开源 IMAP 和 POP3 邮件服务器。它体积轻巧，意味着它占用很少的内存，并且不需要大量的处理能力。像任何软件一样，你必须保持安全的配置，并及时更新系统，以保持安全。如果你进行的是偶尔、低量的钓鱼攻击，这种维护可能不值得花费时间和精力，尽管软件是免费的。如果你从大量域名中进行钓鱼，或每天发送多封邮件，这可能是一个更经济的解决方案。由于
    Dovecot 不支持 SMTP，它不支持伪造身份。你可以使用 Dovecot 进行域名劫持攻击。
- en: '**Sendmail**'
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: '**Sendmail**'
- en: One of the original internet mail clients, first released in 1983\. It implements
    SMTP and is currently maintained by the Sendmail Consortium and Proofpoint, a
    phishing awareness and prevention company. The same considerations that are relevant
    to Dovecot exist with Sendmail. While Sendmail is open source software, its maintainers
    attempt to prevent phishing, which may make some social engineers uneasy. Since
    Sendmail uses SMTP, you can use it for either spoofing or squatting.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 1983 年首次发布的原始互联网邮件客户端之一。它实现了 SMTP，目前由 Sendmail 联盟和 Proofpoint（一家钓鱼意识与预防公司）维护。与
    Dovecot 相同的考虑因素同样适用于 Sendmail。尽管 Sendmail 是开源软件，但其维护者试图防止钓鱼攻击，这可能会让一些社交工程师感到不安。由于
    Sendmail 使用 SMTP，你可以使用它进行伪造身份或域名劫持攻击。
- en: '**Cloud Email**'
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: '**云邮件**'
- en: Microsoft 365 is Microsoft’s cloud-based email service, and Google Workspace
    is Google’s cloud-based enterprise email. Both services charge per user, per month,
    or per year and are accessible from anywhere with an internet connection. Both
    services support SMTP, POP3, and IMAP4, although they default to IMAP. You can
    tie Microsoft 365 or Google Workspace to any domain you own, so they work for
    squatting but not spoofing.
  id: totrans-93
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Microsoft 365 是微软的基于云的电子邮件服务，Google Workspace 是谷歌的基于云的企业邮件服务。两项服务按用户、按月或按年收费，并且可以通过任何有互联网连接的设备访问。两者都支持
    SMTP、POP3 和 IMAP4，虽然默认使用 IMAP。你可以将 Microsoft 365 或 Google Workspace 绑定到你拥有的任何域名，因此它们适用于域名劫持攻击，但不适用于身份伪造。
- en: '**Google Mail (Gmail)**'
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: '**谷歌邮件（Gmail）**'
- en: In my experience, Google won’t let you send malware (even macro-enabled Office
    documents) via email or Google Drive. However, Google won’t shut you down if you
    phish. At the time of this writing, you can acquire access to Google Workspace
    for your domains through Namecheap, Bluehost, SiteGround, or GoDaddy for around
    $6 per user per month. Most phishing domains are used on a burn-and-churn basis,
    meaning they’re used for one instance of phishing per client. If you’re the only
    person doing the phishing, you need to pay for only one user. If this is the case,
    you will likely pay no more than $6 per client for a phishing engagement.
  id: totrans-95
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 根据我的经验，Google 不允许你通过电子邮件或 Google Drive 发送恶意软件（即使是宏启用的 Office 文档）。然而，如果你进行钓鱼攻击，Google
    不会关闭你的账户。撰写本文时，你可以通过 Namecheap、Bluehost、SiteGround 或 GoDaddy 等服务为你的域名获取 Google
    Workspace，费用大约是每位用户每月 $6。大多数钓鱼域名采用短期使用方式，即每个客户只使用一次。如果你是唯一进行钓鱼攻击的人，你只需要为一个用户付费。如果是这种情况，你每个钓鱼活动的费用可能不超过每个客户
    $6。
- en: When selecting one of these options, keep the following considerations in mind.
    First, spoofing is easy to catch, and many mail systems have logic in place to
    detect it. Moreover, several apps independent of the mail systems, like Exchange,
    Proofpoint, and Mimecast, can validate emails and thwart spoofing. On the other
    hand, even if your target implements anti-phishing tools like Sender Policy Framework
    (SPF), Domain Keys Identified Mail (DKIM), or Domain-based Message Authentication,
    Reporting, and Conformance (DMARC), you can still successfully perform typo and
    domain squatting. SPF, DKIM, and DMARC are technical solutions that aim to prevent
    spoofing. In reality, if implemented, they prevent other parties from spoofing
    your domain, so they are worth implementing for your reputation, but they do little
    to prevent the spoofing of your organization.
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 在选择这些选项时，需牢记以下几点。首先，伪造邮件很容易被捕获，许多邮件系统都有检测伪造的逻辑。此外，许多与邮件系统独立的应用程序，如Exchange、Proofpoint和Mimecast，能够验证电子邮件并阻止伪造攻击。另一方面，即使目标实施了像发送者策略框架（SPF）、域密钥识别邮件（DKIM）或基于域的邮件身份验证、报告和一致性（DMARC）等反钓鱼工具，你仍然可以成功进行拼写错误和域名抢注。SPF、DKIM和DMARC是旨在防止伪造的技术解决方案。实际上，如果这些工具被实施，它们会防止其他方伪造你的域名，因此值得为你的声誉实施，但它们对防止伪造你的组织作用有限。
- en: Squatting can also bypass technologies, like Mimecast, that attempt to catch
    phishing emails by looking at statistics in the emails themselves, as well as
    age and reputation of the domain sending the email. If the sending domain does
    not have a bad reputation or use language consistent with phishing, you should
    be able to get through these filters unless administrators have set up any specific
    rules. Even if the target has SPF or another solution, sending the mail using
    cloud services such as Google Mail (for domains) and Microsoft 365 will often
    bypass their filters, since the mail servers for Google and Microsoft are almost
    universally trusted.
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 攻击者通过**Squatting**（域名抢注）也可以绕过像Mimecast这样的技术，它们试图通过查看电子邮件中的统计数据、邮件发送域名的年龄和信誉来拦截钓鱼邮件。如果发送域名没有不良声誉或使用与钓鱼一致的语言，除非管理员设置了特定规则，否则应该能够通过这些过滤器。即便目标启用了SPF或其他解决方案，使用Google
    Mail（适用于域名）和Microsoft 365等云服务发送邮件通常会绕过这些过滤器，因为Google和Microsoft的邮件服务器几乎是普遍信任的。
- en: Third, automated phishing solutions have several methods to integrate into email
    services like Dovecot, Sendmail, or cloud providers. However, automated solutions
    may put code, watermarks, or signatures into the email that filters and other
    defensive technologies for mail can detect.
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 第三，自动化钓鱼解决方案有几种方法可以与Dovecot、Sendmail或云服务提供商的电子邮件服务集成。然而，自动化解决方案可能会在邮件中添加代码、水印或签名，这些内容会被邮件过滤器和其他防御技术检测到。
- en: Before you configure a mail server, you need to create firewall rules in DigitalOcean
    for it and to update UFW in your droplet with information about the protocols
    (either SMTP, IMAP, or POP3) you’re using to allow the communications. Use the
    steps coming up in “Setting Up the Phishing and Infrastructure Web Server” to
    create the firewall rules for your mail server of choice.
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 在配置邮件服务器之前，你需要为其创建DigitalOcean的防火墙规则，并更新你Droplet上的UFW，提供你所使用的协议（SMTP、IMAP或POP3）的信息，以允许通信。使用接下来的步骤“设置钓鱼和基础设施Web服务器”来为你选择的邮件服务器创建防火墙规则。
- en: Purchasing Sending and Landing Page Domains
  id: totrans-100
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 购买发送和着陆页域名
- en: 'Next, you need to purchase two domains: one to host the *landing page*, which
    is where you’ll redirect victims who click the link in your email, and one to
    host the site from which you’ll send the phishing email. The landing page domain
    can be cheap, like the 88-cent *.tech* or *.info* domains. You’ll apply a long
    subdomain name to the link, so making it look legitimate is less critical.'
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，你需要购买两个域名：一个用于托管*着陆页*，这是你将把点击你邮件中的链接的受害者引导到的页面，另一个用于托管你发送钓鱼邮件的网站。着陆页的域名可以选择便宜的域名，比如88美分的*.tech*或*.info*域名。你将为链接申请一个长子域名，这样使其看起来合法性不那么重要。
- en: The domain you’ll use to send the email needs to be one of the better-known
    top-level domains, like *.com*, *.net*, *.org*, *.io*, or *.us*. My main recommendation
    is to ensure that you buy one with domain privacy enabled, which *.us* domains
    don’t allow. *Domain privacy* is a service offered by domain registrars that allows
    you to put anonymized data as your domain’s WHOIS contact information. That way,
    people won’t be able to link you to the domain. Should anything occur that would
    require you to be notified, the registrar will act as an intermediary between
    you and the sender. You don’t want you or your employer’s names associated with
    a phishing domain, or threat intelligence professionals will dig relentlessly
    and enumerate all your domains and sites.
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 用来发送电子邮件的域名应该是更为知名的顶级域名之一，如 *.com*、*.net*、*.org*、*.io* 或 *.us*。我的主要建议是确保购买一个启用了域名隐私的域名，而
    *.us* 域名不允许这样做。*域名隐私* 是域名注册商提供的一项服务，允许你将匿名化的个人数据作为域名的 WHOIS 联系信息。这样，别人就无法将你与你的域名关联起来。如果发生任何需要通知的情况，注册商将充当你和发件人之间的中介。你不希望你的名字或你雇主的名字与钓鱼域名关联，否则威胁情报专家将会不懈追查并列举出你所有的域名和网站。
- en: Once you have the domain you’ll be phishing from, attach it to the mail platform
    of your choice within your hosting platform and follow the prompts to gain access
    to it. If you are doing a more advanced phishing engagement, consider implementing
    a technical email control (such as SPF, DKIM, or DMARC) on your domain, since
    you’ll be squatting instead of spoofing.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦你获得了钓鱼用的域名，将其附加到你选择的邮件平台，并按照提示进行操作，以获取对其的访问权限。如果你进行的是更高级的钓鱼活动，考虑在你的域名上实施技术邮件控制（如
    SPF、DKIM 或 DMARC），因为你将进行域名劫持而非伪造。
- en: Setting Up the Phishing and Infrastructure Web Server
  id: totrans-104
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 设置钓鱼和基础设施 Web 服务器
- en: Now that you have the VPS instance and email service, you must set up the web
    server that will receive incoming connections, collect credentials, host malicious
    scripts, and perform anything else you need to do to be successful for your particular
    attack. In this section, I’ll show you how to use Apache, a free and open source
    web server software package. Apache is well-documented and fairly simple to use.
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 现在你已经拥有了 VPS 实例和电子邮件服务，你必须设置一个能够接收传入连接、收集凭证、托管恶意脚本并执行你特定攻击所需操作的 web 服务器。在本节中，我将向你展示如何使用
    Apache，这是一款免费且开源的 web 服务器软件包。Apache 文档丰富，且相对简单易用。
- en: 'To install Apache, execute the following commands:'
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 要安装 Apache，请执行以下命令：
- en: '[PRE10]'
  id: totrans-107
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'Once the installation is complete, verify that Apache is in the UFW list of
    allowed processes/services by entering the following command:'
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 安装完成后，通过输入以下命令验证 Apache 是否已在 UFW 允许的进程/服务列表中：
- en: '[PRE11]'
  id: totrans-109
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'Now, you need to minimize the range of IP addresses that can access the Apache
    instance to prevent third parties from accessing your server. I recommend allowing
    the IP address from which you will be connecting to the VPS, any testing or quality
    assurance IP addresses, and the IP range of your target organization (ideally,
    provided in writing from your security point of contact in the contract). To restrict
    your server to this range, execute the following commands:'
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，你需要最小化能够访问 Apache 实例的 IP 地址范围，以防止第三方访问你的服务器。我建议只允许从你将连接到 VPS 的 IP 地址、任何测试或质量保证的
    IP 地址，以及目标组织的 IP 范围（理想情况下，应该由安全联系人在合同中书面提供）。要将服务器限制在此范围内，请执行以下命令：
- en: '[PRE12]'
  id: totrans-111
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'Verify the status by using the `ufw status` command:'
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 `ufw status` 命令验证状态：
- en: '[PRE13]'
  id: totrans-113
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'Now that the installation is complete, shut down Apache for the time being
    with these commands:'
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 安装完成后，暂时使用以下命令关闭 Apache：
- en: '[PRE14]'
  id: totrans-115
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: You can still make the configuration changes, bind domains, and perform other
    housekeeping tasks without Apache running. Shutting down Apache minimizes the
    possibility that the server will get picked up in security scans or spidering.
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 即使没有运行 Apache，你仍然可以进行配置更改、绑定域名以及执行其他管理任务。关闭 Apache 可以最大程度地减少服务器被安全扫描或蜘蛛爬取的可能性。
- en: In Chapter 8, you’ll clone a realistic landing page to host on this server.
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 在第八章中，你将克隆一个逼真的登陆页面，并将其托管在该服务器上。
- en: Additional Steps for Phishing
  id: totrans-118
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 钓鱼的附加步骤
- en: The steps discussed in this section are not mandatory for a good phish, but
    they provide services that clients may occasionally request.
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 本节讨论的步骤对于成功的钓鱼攻击并非必需，但它们提供了一些客户可能会偶尔请求的服务。
- en: Using Tracking Pixels to Measure How Often Your Email Is Opened
  id: totrans-120
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 使用追踪像素来衡量电子邮件被打开的频率
- en: If you are doing a nonautomated test, like the one described thus far in this
    chapter, you may need a means to see how many people open your email. You can
    easily accomplish this with *tracking pixels*, which are usually 1-pixel-by-1-pixel
    images that are unique to each user and rendered from a remote site that you own.
    You can then watch the access logs for instances of each ID connecting to the
    server.
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你正在进行一个非自动化的测试，比如本章到目前为止描述的那种，你可能需要一种方法来查看有多少人打开了你的电子邮件。你可以轻松实现这一点，使用*跟踪像素*，它们通常是
    1x1 像素的图像，每个用户都是唯一的，并且从你拥有的远程站点呈现。然后，你可以查看访问日志，查看每个 ID 连接到服务器的实例。
- en: 'Add the following HTML snippet to your email to set up a tracking pixel:'
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 在电子邮件中添加以下 HTML 代码片段，以设置跟踪像素：
- en: '[PRE15]'
  id: totrans-123
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'Create the file that will monitor the tracking pixel, *tracker.php*. It should
    look something like this:'
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 创建用于监控跟踪像素的文件，*tracker.php*。它应该类似于这样：
- en: '[PRE16]'
  id: totrans-125
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: Tracking pixels are often used in marketing and sales. In phishing, they can
    create headaches and waste time for those perpetrating the attack. Automated solutions
    build them in. The number of emails opened is an overhyped metric in phishing.
    Having victims report that they received a phishing email or acted upon one is
    far more important than how many people open an email.
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 跟踪像素通常用于营销和销售。在钓鱼攻击中，它们会给攻击者带来麻烦并浪费时间。自动化解决方案会内置这些像素。打开电子邮件的数量在钓鱼攻击中是一个被过度强调的指标。让受害者报告他们收到钓鱼邮件或采取了行动，比统计有多少人打开邮件要重要得多。
- en: Automating Phishing with Gophish
  id: totrans-127
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 使用 Gophish 自动化钓鱼攻击
- en: An *automated phishing solution* is a service that lets you develop a phish
    and send it through an automated system, such as a built-in mail interface. The
    solution will often monitor information such as the number of times the phish
    was opened and by whom, the number of times a victim clicked a link in the email,
    and the time at which each event occurred. These services are convenient to use,
    and sometimes they’re the most economical option. However, because they’re well-known,
    phishes sent through them are likely to get caught and shut down.
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: '*自动化钓鱼解决方案* 是一种服务，允许你开发钓鱼邮件并通过自动化系统（如内建的邮件接口）发送。该解决方案通常会监控信息，如钓鱼邮件被打开的次数和打开者，受害者点击邮件中链接的次数，以及每个事件发生的时间。这些服务使用起来很方便，有时它们也是最经济的选择。然而，由于它们是众所周知的，通过这些服务发送的钓鱼邮件很可能会被捕捉并关闭。'
- en: 'In this section, I’ll show you how to send phishing emails with Gophish, an
    automated phishing utility written in the Go language. To use it, you need to
    have an SMTP server to send the mail through and a web server at which victims
    will land. Although you can create both of these within Gophish, doing so might
    increase your chances of detection. I suggest setting up these three firewall
    rules to prevent detection or collateral damage:'
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我将向你展示如何使用 Gophish 发送钓鱼邮件。Gophish 是一个用 Go 语言编写的自动化钓鱼工具。要使用它，你需要一个 SMTP
    服务器来发送邮件，并需要一个 Web 服务器让受害者访问。虽然你可以在 Gophish 中创建这两个组件，但这样做可能会增加被检测的机会。我建议设置以下三个防火墙规则，以防止被检测或造成附带损害：
- en: Allow port 3333/TCP (the port for the Gophish web admin interface) and port
    22 (the SSH port) from your network only.
  id: totrans-130
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 只允许从你的网络访问端口 3333/TCP（Gophish Web 管理界面的端口）和端口 22（SSH 端口）。
- en: Allow port 80/TCP (the default port for your landing page, though you could
    use port 443 with an SSL/TLS certificate for more realism) from your network and
    the victim IP ranges only.
  id: totrans-131
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 只允许从你的网络和受害者 IP 范围访问端口 80/TCP（你的登录页面的默认端口，尽管你可以使用带 SSL/TLS 证书的端口 443 来增加真实性）。
- en: Allow port 25/TCP (the port for SMTP traffic) in the outbound direction only.
  id: totrans-132
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 只允许出站方向访问端口 25/TCP（SMTP 流量的端口）。
- en: 'To set these rules in UFW, execute the following commands:'
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 要在 UFW 中设置这些规则，请执行以下命令：
- en: '[PRE17]'
  id: totrans-134
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: 'Now, let’s install Gophish:'
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，让我们安装 Gophish：
- en: '[PRE18]'
  id: totrans-136
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 'Configure Gophish to listen on the public or private IP address that you will
    use to connect to it:'
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 配置 Gophish 监听你将用来连接的公共或私有 IP 地址：
- en: '[PRE19]'
  id: totrans-138
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: 'Within *config.json*, change `admin_server listen_url` to the IP address of
    the VPS from which you’re administering the phish. Then change `phish_server listen_url`
    to the IP address or domain name to which you are sending victims:'
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 在 *config.json* 文件中，将 `admin_server listen_url` 更改为你管理钓鱼攻击的 VPS 的 IP 地址。然后，将
    `phish_server listen_url` 更改为你发送钓鱼邮件给受害者的 IP 地址或域名：
- en: '[PRE20]'
  id: totrans-140
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'Make sure that you change the admin password after you log in. The default
    credentials for Gophish are as follows:'
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 登录后，请务必更改管理员密码。Gophish 的默认凭据如下：
- en: '[PRE21]'
  id: totrans-142
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: I recommend going to the **Settings** menu on the left pane and changing your
    password immediately. Even if you’re the only one accessing Gophish, create a
    new user. If multiple people will log in to this account, you must create distinct
    users. To do this, click the **Users**tab, select **New User**, and then fill
    out the form on the page.
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 我建议你立即前往左侧面板的**设置**菜单，并更改你的密码。即使只有你一个人在使用 Gophish，也应该创建一个新用户。如果有多人将登录此账户，你必须创建不同的用户。为此，点击**用户**标签，选择**新用户**，然后填写页面上的表单。
- en: Next, you need a place to send victims. You create this via the **Landing Pages**
    tab, under **New Landing Page** ([Figure 7-7](#figure7-7)).
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，你需要一个地方来发送受害者。你可以通过**登录页面**标签下的**新登录页面**来创建（[图 7-7](#figure7-7)）。
- en: '![<<GoPhish New Landing Page interface. Includes fields for page name, HTML,
    and redirection, "Import Site" button, and checkboxes to capture submitted data
    and passwords.>>](image_fi/500983c07/f07007.png)'
  id: totrans-145
  prefs: []
  type: TYPE_IMG
  zh: '![<<GoPhish 新的登录页面界面。包含页面名称、HTML 和重定向的字段，“导入站点”按钮，以及用于捕获提交的数据和密码的复选框。>>](image_fi/500983c07/f07007.png)'
- en: 'Figure 7-7: Setting up a new landing page in Gophish'
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 图 7-7：在 Gophish 中设置新的登录页面
- en: You can build the landing page from scratch or copy and paste the HTML of another
    page into this.
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以从头开始构建登录页面，也可以将另一页面的 HTML 复制并粘贴到这里。
- en: Next, you have to know who you’re pretending to be when you send the phishing
    emails, and which mail server (in `ip_address:port` format) needs to send the
    email. You can configure this in the **Sending Profiles** tab, under **New Sending
    Profile** ([Figure 7-8](#figure7-8)).
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，你需要知道在发送钓鱼邮件时，你假装成谁，并且需要哪个邮件服务器（以 `ip_address:port` 格式）来发送邮件。你可以在**发送配置文件**标签下的**新发送配置文件**中进行配置（[图
    7-8](#figure7-8)）。
- en: '![<<GoPhish New Sending Profile interface. Input fields include Name, Interface
    Type, From, Host, Username, Password, and Email Headers. “Ignore Certificate Errors”
    checkbox is selected. Shows buttons for adding a customer header and sending a
    test email.>>](image_fi/500983c07/f07008.png)'
  id: totrans-149
  prefs: []
  type: TYPE_IMG
  zh: '![<<GoPhish 新的发送配置文件界面。输入字段包括名称、接口类型、发件人、主机、用户名、密码和电子邮件头。“忽略证书错误”复选框已选中。显示添加客户头和发送测试电子邮件的按钮。>>](image_fi/500983c07/f07008.png)'
- en: 'Figure 7-8: Setting up a new sending profile in Gophish'
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 图 7-8：在 Gophish 中设置新的发送配置文件
- en: Now you know who is sending the email, how it’s getting to its destination,
    and what you want it to do, it’s time to create the actual email. One way to do
    this is to import an existing email—say, an email that Erica in HR got two weeks
    ago—and use it as a template. Gophish will use the format, style, and language
    of the email you import. You can configure this in the **Email Templates** tab
    under **New Template** ([Figure 7-9](#figure7-9)).
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 现在你知道了是谁在发送电子邮件，邮件是如何到达目的地的，以及你希望它执行什么操作，接下来是创建实际的电子邮件。一种方法是导入现有的电子邮件——比如说，HR
    部门的 Erica 两周前收到的邮件——并将其作为模板。Gophish 会使用你导入的电子邮件的格式、样式和语言。你可以在**电子邮件模板**标签下的**新模板**中进行配置（[图
    7-9](#figure7-9)）。
- en: '![<<GoPhish New Template interface. Includes fields for name, subject, and
    plaintext and HTML. "Add Tracking Image" checkbox is selected. Shows buttons for
    importing email and adding files.>>](image_fi/500983c07/f07009.png)'
  id: totrans-152
  prefs: []
  type: TYPE_IMG
  zh: '![<<GoPhish 新的模板界面。包括名称、主题、纯文本和 HTML 的字段。选中“添加跟踪图片”复选框。显示导入电子邮件和添加文件的按钮。>>](image_fi/500983c07/f07009.png)'
- en: 'Figure 7-9: Setting up a new email template in Gophish'
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 图 7-9：在 Gophish 中设置新的电子邮件模板
- en: You have everything you need. Let’s organize it into a *campaign*, which puts
    all the pieces you’ve worked on together to send to clients. You can configure
    this in the **Campaigns** tab, under **New Campaign**([Figure 7-10](#figure7-10))*.*
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 你已经拥有了所需的一切。让我们将它组织成一个*活动*，将你所做的所有部分集合起来，发送给客户。你可以在**活动**标签下的**新活动**中进行配置（[图
    7-10](#figure7-10)）。
- en: '![<<GoPhish New Campaign interface. Includes fields for name, email template,
    landing page, URL, launch date, send emails by, sending profile, and groups. "No
    profiles found!" red banner shown above fields and green “Launch Campaign” button
    shown below.>>](image_fi/500983c07/f07010.png)'
  id: totrans-155
  prefs: []
  type: TYPE_IMG
  zh: '![<<GoPhish 新的活动界面。包括名称、电子邮件模板、登录页面、URL、启动日期、发送邮件方式、发送配置文件和组的字段。字段上方显示“没有找到配置文件！”红色横幅，下方显示绿色的“启动活动”按钮。>>](image_fi/500983c07/f07010.png)'
- en: 'Figure 7-10: Setting up a campaign in Gophish'
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 图 7-10：在 Gophish 中设置一个活动
- en: Once this form is complete, all you have to do is launch the campaign and wait
    for the results.
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 填写完这个表单后，你所需要做的就是启动活动，等待结果。
- en: Adding HTTPS Support for Phishing Landing Pages
  id: totrans-158
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 为钓鱼登录页面添加 HTTPS 支持
- en: Some users look for the green padlock associated with HTTPS websites as a litmus
    test to see that a site was not part of a phishing attack. Attackers took notice
    and started to use HTTPS in their sites. Through the use of Let’s Encrypt, we
    can do the same for free and give our clients a more realistic experience.
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 一些用户会寻找带有绿色锁形图标的HTTPS网站，作为判断网站是否为钓鱼攻击的一种标志。攻击者注意到了这一点，并开始在他们的网站中使用HTTPS。通过使用Let's
    Encrypt，我们也可以免费做到这一点，并为客户提供更真实的体验。
- en: 'Let’s Encrypt is a free, automated, and open certificate authority (CA), run
    for the public’s benefit. It is a service provided by the Internet Security Research
    Group (ISRG) and is an excellent method for implementing HTTPS (for free!). Let’s
    install Let’s Encrypt for Gophish:'
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: Let's Encrypt 是一个免费的自动化开放证书授权机构（CA），旨在为公众提供服务。它是互联网安全研究小组（ISRG）提供的服务，是实现HTTPS（免费！）的绝佳方法。让我们为Gophish安装Let's
    Encrypt：
- en: '[PRE22]'
  id: totrans-161
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: Once the installation is complete, follow the onscreen prompts to complete any
    verifications in DNS and finish the setup.
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 安装完成后，按照屏幕上的提示完成DNS验证并完成设置。
- en: The process is similar if you’re manually setting up your phishing attack. (Note
    that the setup will not auto-renew. You will have to execute the script to renew
    this every three months, assuming you leave it up that long.)
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你手动设置钓鱼攻击，过程类似。（请注意，设置不会自动续期。如果你长时间不进行操作，每三个月你需要执行脚本来续期。）
- en: '[PRE23]'
  id: totrans-164
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: 'After this series of commands, you will be prompted to enter some information.
    Once all verifications have occurred, run this command to verify installation:'
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 在输入完这些命令后，系统会提示你输入一些信息。所有验证完成后，运行此命令来验证安装：
- en: '[PRE24]'
  id: totrans-166
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: Using URL Shorteners in Phishing
  id: totrans-167
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 在钓鱼攻击中使用URL缩短工具
- en: URL shorteners (like *Bitly*) can make the landing page less obviously recognizable.
    When deciding whether to use them, consider the perceived level of difficulty
    of the phishing engagement and the maturity of the target organization. Some organizations
    attempt to filter shortened URLs from emails, and others train users to avoid
    these links. Whether to use shorteners is something to discuss with your security
    point of contact. If you choose to use them, understand that they may be stripped
    from the emails.
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: URL缩短工具（如 *Bitly*）可以使目标页面不那么容易被识别。当决定是否使用它们时，考虑钓鱼攻击的难度和目标组织的成熟度。有些组织会尝试过滤电子邮件中的缩短URL，其他组织则会训练用户避免点击这些链接。是否使用缩短工具，应该与您的安全联系人讨论。如果选择使用，请理解这些链接可能会被从电子邮件中剥离。
- en: Using SpoofCard for Call Spoofing
  id: totrans-169
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 使用SpoofCard进行呼叫伪造
- en: The only architecture you’ll need for a vishing attack is a call spoofing platform,
    and if it’s legal in your target’s area, a means to record the call.
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 对于语音钓鱼攻击，你只需要一个呼叫伪造平台，如果目标地区允许，还需要一个记录通话的工具。
- en: '*SpoofCard* is a mobile application that allows you to spoof numbers, call
    them, record them, and even inject background noises into the call. The application
    itself is free, but you have to purchase credits to use it.'
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: '*SpoofCard* 是一个移动应用程序，它允许你伪造号码、拨打电话、录音，甚至在通话中注入背景噪音。该应用程序本身是免费的，但你需要购买积分才能使用它。'
- en: Timing and Delivery Considerations
  id: totrans-172
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 时间和交付考虑
- en: Now that you’ve set up your attack, you need to actually deliver it. Before
    doing so, you should take into account two time-related factors.
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 现在你已经设置好了攻击，接下来需要实际执行它。在执行之前，你应当考虑两个与时间相关的因素。
- en: The first is how much time you have between preparing the architecture and performing
    the engagement itself. The amount of time you put into the project will tell you
    how likely you are to be caught using technical controls such as email filters
    or threat intelligence feeds. A rushed project will likely be easy to detect,
    but if the client wants something more advanced, you need to have the time to
    do the appropriate research about company lingo and culture, as well as the technologies
    they use, so you can seem like an insider with authorized access when you send
    the campaign. The bottom line? Don’t rush if you don’t have to. Sometimes your
    clients will need you to move quickly, but this should be the exception, not the
    standard.
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: 第一点是你在准备架构和实际执行操作之间有多少时间。你投入到项目中的时间将决定你被检测到使用技术控制手段（如电子邮件过滤器或威胁情报源）的可能性。一个匆忙完成的项目很可能容易被发现，但如果客户需要更高级的方案，你需要有时间进行适当的研究，了解公司用语、文化以及他们使用的技术，这样当你发送活动时，你才能看起来像是一个拥有授权访问的内部人员。底线是什么？如果不必要的话，不要急于完成。有时候，客户需要你迅速行动，但这应该是例外，而不是常态。
- en: Second, choose the day and time to execute the engagement carefully. Choosing
    the proper moment takes research. For example, if you’re vishing, you could block
    your number and mute your line, and then call at the same time on the same day
    of the week every week for a few weeks before the engagement, to see who will
    answer. Also pay attention to whether you are performing your engagement during
    working hours. If you’re posing as an employee, regardless of whether you’re spoofing
    or squatting, what is that person’s work schedule and patterns? If, during a phishing
    engagement, you pose as a person who works 10-hour shifts from 6:00 AM to 5:00
    PM, Monday through Thursday, sending your email at 5:45 PM any day—or, worse,
    on Friday—is probably not a good idea.
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 第二，谨慎选择执行渗透测试的日期和时间。选择合适的时机需要进行研究。例如，如果你是在进行电话钓鱼攻击（vishing），你可以屏蔽自己的号码并静音线路，然后在接下来的几周里，每周的同一天同一时间进行拨打，看看谁会接听。此外，还要注意你是否在工作时间内执行渗透测试。如果你假扮成一名员工，不管你是伪装还是蹲点，那个员工的工作时间安排是什么？如果在进行钓鱼攻击时，你假扮成一个从早上6点到下午5点，星期一到星期四工作10小时的员工，在下午5点45分发送邮件——更糟的是，星期五发送——可能不是一个好主意。
- en: 'Case Study: The $25 Advanced Persistent Phish'
  id: totrans-176
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 案例研究：25美元的高级持续钓鱼攻击
- en: This is the story of how I phished an organization in a creative way and for
    a relatively small price. In doing so, I was able to send a high-quality phish,
    bypass the organization’s technical defenses, and make my way into the inboxes
    of unsuspecting employees.
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 这是我如何以一种创意十足且相对低廉的方式钓鱼一个组织的故事。在这个过程中，我成功地发送了一个高质量的钓鱼邮件，绕过了该组织的技术防御，并进入了毫无防备的员工邮箱。
- en: On the scoping call for this engagement, my point of contact at the target company
    mentioned that the CEO was retiring within the next two weeks, and that the COO
    would be taking over. Based on this information, I devised a plan. When I shared
    my idea with the point of contact, he called me a devious madman and approved
    it. Time to get rolling on making this work!
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: 在这次渗透测试的范围电话会议中，我的目标公司联系人提到，CEO将在两周内退休，COO将接替他的职位。基于这些信息，我制定了一个计划。当我与联系人分享我的想法时，他称我为一个狡猾的疯子，并批准了这个计划。是时候开始实施这个计划了！
- en: 'To set up my phishing attack, I followed the process described in this chapter.
    First, I spun up a DigitalOcean droplet. Because this was a short engagement with
    150 targets, I didn’t need a huge droplet with a lot of space or processing power,
    so I signed up for a $5 droplet. Since DigitalOcean bills by the hour, and the
    cost is paid at the end of the month, I had spent nothing so far. *Total cost:
    $0.*'
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: 为了设置我的钓鱼攻击，我遵循了本章中描述的过程。首先，我创建了一个DigitalOcean的droplet。因为这是一个涉及150个目标的短期渗透测试，我不需要一个空间或处理能力特别大的droplet，所以我注册了一个5美元的droplet。由于DigitalOcean按小时计费，费用在月末支付，到目前为止我没有花费任何费用。*总费用：0美元*。
- en: The schedule for this attack didn’t give me much time to collect OSINT using
    the methods discussed in Chapters 5 and 6. Instead, I dedicated my effort to enumerating
    the target company’s domains, recording names of pertinent employees, and finding
    direct quotes from the CEO and COO on the company website, in trade journals,
    and in press releases.
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 这个攻击的时间安排并没有给我太多时间使用第五章和第六章中讨论的方法来收集OSINT（开放源情报）。相反，我将精力集中在列举目标公司的域名、记录相关员工的姓名，并在公司网站、行业期刊以及新闻稿中查找CEO和COO的直接引用。
- en: 'The next step was to buy the sending and landing page domains. The target domain
    had a *.com* top-level domain, so I bought the corresponding *.us* domain name.
    This cost about $12, because I had a promo code for the domain registration company
    Namecheap. Next, I bought something to the effect of *surveysofsatisfaction.life*
    for the web domain. The cheap domain cost me 88 cents. I subscribed to the Google
    apps for the email domain for $5 for the month. *Total cost: $17.88.*'
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 下一步是购买发送和登录页面的域名。目标域名是一个*.com*顶级域名，所以我购买了相应的*.us*域名。这个花费了大约12美元，因为我有一个Namecheap域名注册公司的促销代码。接下来，我购买了一个类似*surveysofsatisfaction.life*的网页域名。这个便宜的域名花费了我88美分。我还为电子邮件域名订阅了Google应用，每月花费5美元。*总费用：17.88美元*。
- en: I configured the web domain to resolve to my droplet’s IP address. Then I installed
    a Let’s Encrypt TLS/HTTPS certificate on the domain for free. I used HTTrack to
    get a perfect clone of SurveyMonkey (as you’ll do in Chapter 8), then added a
    high-resolution logo from the target’s website to the page.
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 我将网页域名配置为解析到我的droplet的IP地址。然后，我为该域名免费安装了Let’s Encrypt TLS/HTTPS证书。我使用HTTrack获取了SurveyMonkey的完美克隆（正如你将在第八章中做的那样），然后从目标公司网站上获取了一个高分辨率的logo并添加到页面中。
- en: I configured the landing page to resolve to https://<target company name>.surveysofsatisfaction.life,
    making it seem like the target company had its own subdomain on the survey website.Once
    again, I used the SurveyMonkey and target company logo. I also added prompts for
    users to submit their email addresses and passwords, and then passed these credentials
    to the Apache log in an HTTP GET request.
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 我将着陆页配置为指向 https://<目标公司名称>.surveysofsatisfaction.life，使其看起来像是目标公司在调查网站上拥有自己的子域名。我再次使用了SurveyMonkey和目标公司的标志。我还添加了提示，要求用户提交他们的电子邮件地址和密码，然后将这些凭据通过HTTP
    GET请求传递给Apache日志。
- en: 'On a second page, I set up common password-reset questions: mother’s maiden
    name, first school, honeymoon location, and name of elementary school. I passed
    this information to the log in the same way.'
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 在第二页，我设置了常见的密码重置问题：母亲的娘家姓、第一所学校、蜜月地点以及小学的名称。我将这些信息以相同的方式传递给了日志。
- en: Finally, I created a third page that said, “Sorry, this survey is closed” and
    started an infinite loop. The loop was initially a coding error, but I chose to
    leave it as a hint for the target employees that this wasn’t a legitimate survey.
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，我创建了第三页，上面写着“抱歉，调查已关闭”，并启动了一个无限循环。这个循环最初是一个编码错误，但我选择将其保留，作为给目标员工的提示，表明这不是一个合法的调查。
- en: Next, I wrote the email using direct quotes from both the CEO and COO. I’d also
    uncovered a specific term, *Owner-Associates*, that the company used to refer
    to its employees, so I used that, too. I chose to send the phish posing as the
    COO. I was able to send him an email from a random account and got his email signature
    from his out-of-office reply.
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我编写了电子邮件，引用了首席执行官和首席运营官的直接引语。我还发现了公司用来称呼其员工的特定术语*Owner-Associates*，所以我也使用了这个术语。我选择以首席运营官的身份发送这封钓鱼邮件。我通过一个随机账户发送了邮件，并从他的自动回复中获得了他的电子邮件签名。
- en: 'The email said something to the effect of this:'
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: 电子邮件的内容大致如下：
- en: 'Dear Owner-Associates:'
  id: totrans-188
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 亲爱的Owner-Associates：
- en: ''
  id: totrans-189
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: As you know, I will be replacing Steve as CEO next week after 37 years of dedicated,
    selfless, devoted service. These are enormous shoes to fill, but I will do my
    best. <Insert Direct Quote from COO here>.
  id: totrans-190
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 正如你们所知，我将在下周接替史蒂夫担任首席执行官，结束他37年来无私奉献的服务。这是一个巨大的责任，但我会尽最大努力。<在此插入首席运营官的直接引用>。
- en: ''
  id: totrans-191
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Over the years, we have had ups and downs and seek to do better. I plan on <points
    taken from a press release>. As Steve says, <direct quote from the outgoing CEO’s
    media interviews about his retirement>.
  id: totrans-192
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 多年来，我们经历了起伏，并致力于做得更好。我计划在<新闻稿中提到的要点>方面进行改进。正如史蒂夫所说，<来自即将退休的首席执行官媒体采访中的直接引用>。
- en: ''
  id: totrans-193
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: As some of you know, I am committed to constant improvement of processes for
    the customers, partners, vendors, and most importantly, Owner-Associates. That’s
    why I have collaborated with HR to set up a SurveyMonkey survey to improve all
    aspects of <Company Name>. Please use the link below to complete this survey no
    later than close of business on Friday.
  id: totrans-194
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 正如你们中的一些人所知，我致力于不断改进为客户、合作伙伴、供应商，最重要的是，Owner-Associates的服务。这就是为什么我与人力资源部合作，设置了一个SurveyMonkey调查，以改善<公司名称>的各个方面。请使用以下链接，在周五营业结束前完成此调查。
- en: ''
  id: totrans-195
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: <Bitly Link to Web Domain>
  id: totrans-196
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: <Bitly 链接到网站域名>
- en: ''
  id: totrans-197
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: <Signature stolen from out of office reply>
  id: totrans-198
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: <从自动回复中盗取的签名>
- en: I confirmed with my point of contact that the phish looked acceptable and received
    the green light to go ahead. I sent the email from the Google apps in batches
    of about 10 to 20 at a time, every 5 to 10 minutes, so as to not set off any potential
    alarms. Though my emails were eventually blocked, I managed to send enough to
    receive numerous survey inputs from the target’s IP address.
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
  zh: 我与我的联系人确认了这封钓鱼邮件的可接受性，并获得了绿灯可以继续操作。我将邮件从谷歌应用程序中分批发送，每次发送10到20封，每隔5到10分钟发送一次，以避免触发潜在的警报。尽管我的邮件最终被封锁，但我成功发送了足够多的邮件，收到了来自目标IP地址的大量调查反馈。
- en: 'I left the website up for a week, and then verified the information the following
    Monday and saw that I had received more input from employees. One employee had
    entered information multiple times with a new password. I coordinated with the
    point of contact to end the engagement. I preserved the droplet for another week
    in case he wanted any more information. I collected metrics, controlling for out-of-office
    replies and emails not sent (we’ll discuss collecting metrics in Chapter 9). Per
    the contract, I was not permitted to give him the passwords entered, only the
    names of the employees who entered their passwords. I took backups of the web
    pages and the Apache log for retention and deleted the droplet. A total of two
    weeks had elapsed. *Total cost: $22.88.*'
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: 我将网站保持在线一周，然后在接下来的星期一验证信息，发现我收到了更多员工的反馈。一名员工多次输入了信息并且更改了密码。我与联系人协调，结束了这次行动。我保留了滴灌服务器一周，以防他需要更多信息。我收集了度量数据，控制了外出回复和未发送的邮件（我们将在第9章讨论如何收集度量数据）。根据合同，我不得提供输入的密码，只能提供输入密码的员工姓名。我对网页和Apache日志进行了备份并保存，然后删除了滴灌服务器。整个过程持续了两周。*总成本：22.88美元。*
- en: On the 29th day of the subscription, I logged in to the email from which I’d
    sent the phish to verify that nothing of value was in there and then canceled
    the service. An employee had added that email address to several highly sensitive
    emails and mailing lists. *Priceless.*I advised my point of contact immediately
    and forwarded the emails to him. I wrote up the report and then ended the engagement.
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: 在订阅的第29天，我登录了我用来发送钓鱼邮件的电子邮件账户，确认没有重要信息后取消了该服务。一名员工将该电子邮件地址添加到了多个高度敏感的邮件和邮件列表中。*无价。*我立即告知了我的联系人并将邮件转发给他。我写了报告，然后结束了这次行动。
- en: This great phish could have been disastrous if I were a true bad actor, and
    it cost me less than $25\.
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我是一个真正的坏分子，这次钓鱼攻击可能会导致灾难，而这次攻击的成本却不到25美元。
- en: Based on the information I’ve provided, how could this attack have been mitigated
    or prevented?
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: 基于我提供的信息，这次攻击本可以如何被缓解或防止？
- en: The company should have trained all users on how to evaluate emails for suspicious
    context. Teach them to ask security for help when in doubt, especially when shortened
    URLs are involved.
  id: totrans-204
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 公司本应对所有用户进行如何评估可疑邮件内容的培训。教导他们在有疑问时向安全部门寻求帮助，特别是当涉及到缩短的URL时。
- en: The company should have implemented Proofpoint or a similar solution to add
    the word *[External]* to the beginning of the subject line of the email.
  id: totrans-205
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 公司本应实施Proofpoint或类似的解决方案，将*【外部】*添加到电子邮件主题行的开头。
- en: The company should have trained employees to evaluate the URLs of the pages
    to which they navigate.
  id: totrans-206
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 公司本应训练员工评估他们访问的页面URL。
- en: Better coordination could have occurred between the security and networking
    teams. Better communication could have prevented the networking lead from emailing
    the company about the email, thus drawing attention to the email instead of quietly
    removing it from the inbox queue before the email.
  id: totrans-207
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 安全团队和网络团队之间本可以有更好的协调。更好的沟通本可以避免网络负责人向公司发送关于该电子邮件的邮件，从而引起对该电子邮件的注意，而不是在电子邮件到达之前悄悄将其从收件箱队列中移除。
- en: There should have been a better incident response plan for social engineering
    attacks.
  id: totrans-208
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 应该有一个更好的社会工程攻击应急响应计划。
- en: Conclusion
  id: totrans-209
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 结论
- en: Successful social engineering engagements require significant planning and technical
    setup. This chapter covered how to set up a phishing attack that collected user
    credentials without getting caught. You first set up a DigitalOcean droplet, secured
    the droplet, and configured the droplet’s firewall. You then learned about considerations
    for setting up a realistic email server.
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: 成功的社会工程攻击需要充分的计划和技术配置。本章介绍了如何设置一个钓鱼攻击，收集用户凭据而不被发现。首先，你需要设置一个DigitalOcean的滴灌服务器，确保服务器的安全，并配置服务器的防火墙。然后，你学习了如何搭建一个真实的邮件服务器。
- en: You’ll have to make many decisions in the process of phishing. We discussed
    how best to select a domain for your email account, as well as for the landing
    page to which you’ll direct users. We also discussed add-ons like tracking pixels,
    automated phishing services, HTTPS support, and URL shorteners. Equally important
    on the nontechnical side, we discussed the timing of your attack.
  id: totrans-211
  prefs: []
  type: TYPE_NORMAL
  zh: 在钓鱼攻击的过程中，你将不得不做出许多决策。我们讨论了如何选择一个适合的域名用于你的电子邮件账户，以及如何选择你将引导用户访问的着陆页面。我们还讨论了如跟踪像素、自动化钓鱼服务、HTTPS支持和URL缩短工具等附加功能。我们同样讨论了非技术方面的内容，比如攻击的时机。
- en: In the next chapter, you’ll set up a realistic clone of a legitimate website
    that you could use to harvest user credentials and sensitive information—or for
    some other devious purpose.
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，你将搭建一个合法网站的真实克隆，你可以利用它来收集用户凭证和敏感信息——或者用于其他一些阴险的目的。
