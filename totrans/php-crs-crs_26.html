<html><head></head><body>
<div id="sbo-rt-content"><section aria-labelledby="ch21" epub:type="chapter" role="doc-chapter">
<span aria-label="395" epub:type="pagebreak" id="pg_395" role="doc-pagebreak"/>
<hgroup>
<h2 class="CHAPTER" id="ch21">
<span class="CN"><span class="SANS_Futura_Std_Bold_Condensed_B_11">21</span></span>
<span class="CT"><span class="SANS_Dogma_OT_Bold_B_11">EFFICIENT TEMPLATE DESIGN WITH TWIG</span></span>
</h2>
</hgroup>
<figure class="opener"><img alt="" class="opener" height="380" src="../images/opener.jpg" width="380"/>
</figure>
<p class="INTRO">This chapter introduces the free, open source Twig templating library, a third-party package that applies object-oriented principles such as inheritance to page display templates. This mix of templating with OOP streamlines the process of designing web applications. We’ll explore the basics of using Twig, then use it to progressively build a multipage website.</p>
<p class="TX">This chapter also offers a first look at how the object-oriented style of programming influences the web application architecture we arrived at in <span class="Xref"><a href="part3.xhtml">Part III</a></span>. For example, rather than writing functions that implement the logic of a front controller, we’ll create object-oriented classes containing front-controller methods. We’ll refine our approach to object-oriented application development in <span class="Xref"><a href="chapter22.xhtml">Chapter 22</a></span> as we further develop this chapter’s multipage site.</p>
<section aria-labelledby="sec1" epub:type="division">
<span aria-label="396" epub:type="pagebreak" id="pg_396" role="doc-pagebreak"/>
<h3 class="H1" id="sec1"><span id="toc-link_290"/><span class="SANS_Futura_Std_Bold_B_11">The Twig Templating Library</span></h3>
<p class="TNI1">Web templating systems like the Twig library (which can be found at <i><a href="https://twig.symfony.com">https://twig.symfony.com</a></i>) manage the duplication that’s common in web application outputs by distinguishing between unchanging content and content that may change upon each request. This makes developing the view element of a web application’s MVC architecture much more efficient. As we’ve discussed in previous chapters, a lot of basic HTML is often duplicated across the template scripts for each page of a website, since the multiple pages typically share elements such as a header and a navigation bar. When we created a three-page website in <span class="Xref"><a href="chapter13.xhtml">Chapter 13</a></span>, for example, most of the code in the template file for each page was redundant HTML; barely any code was unique to the page at hand.</p>
<p class="TX">Duplicating so much HTML across multiple templates causes two issues. First, if you need to change an aspect of the website design (for example, the look and feel of the navigation bar, or a special header or footer), you’d have to edit <i>every</i> page template, which for a large website could be tens, hundreds, or even thousands of files. Second, when editing the content or behavior of a page template, spotting the content that’s specific to the current page can be difficult when it’s hidden within a bunch of generic code. You want to be able to focus on just the content for the particular page you’re editing.</p>
<p class="TX">One solution is to separate the common parts of a page into sub-templates for the header, navigation, footer, and so on. This is what we did in <span class="Xref"><a href="chapter15.xhtml">Chapter 15</a></span>, for example, when we created a <i>templates/_header.php</i> file containing header elements common to all the pages in our shopping cart website. A more elegant solution, however, is to use a dedicated PHP templating library, especially one such as Twig that supports template inheritance. As you’ll see, a key advantage of template inheritance is that after we’ve declared that a template for a particular page inherits from a parent template, the only content in the child page is that for the child page itself; we don’t have to write <span class="SANS_TheSansMonoCd_W5Regular_11">require</span> statements for standard page headers, footers, navigation bars, and so on. This way, each child template contains fewer distractions away from the page it represents.</p>
<p class="TX">Another advantage of templating libraries is that they limit the behavior that can be encoded into a page template by removing any PHP code from the template itself. If you’re working on a website as part of a team, these limitations mean you can safely have other members of the team (such as a marketing department) edit the page templates to refine the website’s look and feel, secure in the knowledge that they can’t accidentally copy in PHP code that would break the website or create a security vulnerability. After all, template files are the view component of an MVC architecture, so they should only be “decorating” provided data with tags in a markup language like HTML.</p>
<section aria-labelledby="sec2" epub:type="division">
<span aria-label="397" epub:type="pagebreak" id="pg_397" role="doc-pagebreak"/>
<h4 class="H2" id="sec2"><span id="toc-link_291"/><span class="SANS_Futura_Std_Bold_Condensed_Oblique_11">How Twig Works</span></h4>
<p class="TNI1">Before we create anything with Twig, let’s explore the basic files, objects, and methods involved when working with Twig templates. When using Twig in our code, we work with an object of the <span class="SANS_TheSansMonoCd_W5Regular_11">Twig\Environment</span> class. This object is responsible for generating the HTML for a web page, based on a template file and any data needed to customize the contents of the page. It does this through its <span class="SANS_TheSansMonoCd_W5Regular_11">render()</span> method. Usually, you store a reference to the <span class="SANS_TheSansMonoCd_W5Regular_11">Twig\Environment</span> object in a variable called <span class="SANS_TheSansMonoCd_W5Regular_11">twig</span>, which is itself a property of a general <span class="SANS_TheSansMonoCd_W5Regular_11">Application</span> class that encapsulates all the high-level logic for the web application.</p>
<p class="TX">The <span class="SANS_TheSansMonoCd_W5Regular_11">render()</span> method requires two parameters. The first is a string containing the path to the desired template file. This string is typically stored in a variable called <span class="SANS_TheSansMonoCd_W5Regular_11">$template</span>. The second parameter is an array of variables that need to be provided to the template to customize the page’s content. This array is typically stored in a variable called <span class="SANS_TheSansMonoCd_W5Regular_11">$args</span>, since the array is essentially providing arguments to the template. The string keys in the array should correspond to the names of any variables used in the Twig template. If no values need to be provided to the template, <span class="SANS_TheSansMonoCd_W5Regular_11">$args</span> will be an empty array.</p>
<p class="TX">To illustrate, say you wanted to display a page showing the items in a shopping cart. The template for this page would be in a file that is called <i>shoppingCart.xhtml.twig</i> (by convention, Twig template files that output HTML are named in the form <i>&lt;pageName&gt;.xhtml.twig</i>), and it would have a <span class="SANS_TheSansMonoCd_W5Regular_11">products</span> variable standing in for whatever products are in the user’s cart (variables in Twig templates don’t start with dollar signs).</p>
<p class="TX">You would pass the template filepath as the first argument to the <span class="SANS_TheSansMonoCd_W5Regular_11">Twig\Environment</span> class’s <span class="SANS_TheSansMonoCd_W5Regular_11">render()</span> method. The second argument would be an <span class="SANS_TheSansMonoCd_W5Regular_11">$args</span> array containing a <span class="SANS_TheSansMonoCd_W5Regular_11">'products'</span> key (the same name as the variable in the template) whose value is an array of <span class="SANS_TheSansMonoCd_W5Regular_11">Product</span> objects. The <span class="SANS_TheSansMonoCd_W5Regular_11">render()</span> method would then return a string containing the HTML for a web page listing all the products as a nice shopping cart, with subtotals, the grand total, links to remove items or change their quantities, and so on. This string could then be printed to the output buffer that would become the body of the HTTP response being returned to the web client.</p>
<p class="TX">If a web application uses Twig templating, every method that returns HTML response text will contain something similar to the code shown in <a href="#lis21-1">Listing 21-1</a>.</p>
<span id="lis21-1"/>
<pre><code>$template = '<span class="TheSansMonoCd_W5Regular_Italic_11">path</span>/<span class="TheSansMonoCd_W5Regular_Italic_11">templateName</span>.xhtml.twig';&#13;
$args = [&#13;
    '<span class="TheSansMonoCd_W5Regular_Italic_11">variable1NameForTwig</span>' =&gt; $phpVariable1,&#13;
    '<span class="TheSansMonoCd_W5Regular_Italic_11">variable2NameForTwig</span>' =&gt; $phpVariable2,&#13;
    ...&#13;
];&#13;
$html = $this-&gt;twig-&gt;render($template, $args);&#13;
print $html;</code></pre>
<p class="CodeListingCaption"><span class="SANS_Futura_Std_Book_Oblique_11">Listing 21-1: The typical code to create and print HTML from a Twig template</span></p>
<p class="TX"><span aria-label="398" epub:type="pagebreak" id="pg_398" role="doc-pagebreak"/>We store the path to a template in the <span class="SANS_TheSansMonoCd_W5Regular_11">$template</span> variable, then build up the <span class="SANS_TheSansMonoCd_W5Regular_11">$args</span> array with the required template variables. We pass these variables to the <span class="SANS_TheSansMonoCd_W5Regular_11">render()</span> method. Remember, we typically store a reference to the <span class="SANS_TheSansMonoCd_W5Regular_11">Twig\Environment</span> object that owns the <span class="SANS_TheSansMonoCd_W5Regular_11">render()</span> method in the <span class="SANS_TheSansMonoCd_W5Regular_11">twig</span> property of an overarching <span class="SANS_TheSansMonoCd_W5Regular_11">Application</span> class. This is why the call to the method is written as <span class="SANS_TheSansMonoCd_W5Regular_11">$this-&gt;twig-&gt;render()</span> rather than <span class="SANS_TheSansMonoCd_W5Regular_11">$twig-&gt;render()</span>. We store the resulting string in <span class="SANS_TheSansMonoCd_W5Regular_11">$html</span>, which we print. Soon you’ll see this code pattern in context as we use Twig to create a basic web page.</p>
</section>
<section aria-labelledby="sec3" epub:type="division">
<h4 class="H2" id="sec3"><span id="toc-link_292"/><span class="SANS_Futura_Std_Bold_Condensed_Oblique_11">A Simple Example</span></h4>
<p class="TNI1">In this section, we’ll use Twig to create a simple “Hello, world!” web page that displays a greeting. Thanks to Twig, we’ll be able to customize the greeting by filling in a name for the person being greeted, based on the value of a PHP variable. In addition to illustrating the basics of working with Twig, this project will also offer a first glimpse at how an object-oriented web application is structured.</p>
<p class="TX">To create our basic greeting page, we’ll start by setting up Twig. Then we’ll write a Twig template featuring a <span class="SANS_TheSansMonoCd_W5Regular_11">name</span> variable, as well as the PHP scripts needed to make the template work.</p>
<section aria-labelledby="sec4" epub:type="division">
<h5 class="H3" id="sec4"><span class="SANS_Futura_Std_Bold_Condensed_B_11">Adding Twig to the Project</span></h5>
<p class="TNI1">The easiest way to add Twig to a project is to use Composer. Create a new empty folder for the project and then enter the following at the command line:</p>
<pre><code>$ <b>composer require twig/twig</b></code></pre>
<p class="TX">This command triggers Composer to install the latest version of the Twig package into the project’s <i>vendor</i> folder (the folder will be created, since the project doesn’t already have one). The command also installs any additional dependencies that Twig requires, such as <span class="SANS_TheSansMonoCd_W5Regular_11">symfony/polyfill -mbstring</span> and <span class="SANS_TheSansMonoCd_W5Regular_11">symfony/polyfill-ctype</span>. If you look at the contents of the <i>vendor</i> folder after installation has finished, you should see that folders for these packages have been created. You can even look in each package’s <i>src</i> folder and examine each class and configuration file in the package.</p>
<p class="TX">Now that the Twig package has been copied into our project folder, we can add <span class="SANS_TheSansMonoCd_W5Regular_11">use</span> statements in our classes to create and exploit the features of the library in our project.</p>
</section>
<section aria-labelledby="sec5" epub:type="division">
<h5 class="H3" id="sec5"><span class="SANS_Futura_Std_Bold_Condensed_B_11">Writing the Twig Template</span></h5>
<p class="TNI1">By convention, Twig template files are stored in a <i>templates</i> folder, just like the PHP template files we’ve written in earlier chapters. Add this folder to your project directory, then create a <i>hello.xhtml.twig</i> template in that folder and enter the contents of <a href="#lis21-2">Listing 21-2</a>.</p>
<span id="lis21-2"/>
<pre><code><span aria-label="399" epub:type="pagebreak" id="pg_399" role="doc-pagebreak"/>&lt;!doctype html&gt;&#13;
&lt;html lang="en"&gt;&#13;
&lt;head&gt;&#13;
    &lt;title&gt;Twig hello&lt;/title&gt;&#13;
&lt;/head&gt;&#13;
&#13;
&lt;body&gt;&#13;
  <span aria-label="annotation1" class="Code_CodeAnnotation">❶</span> Hello {{name}}, nice to meet you&#13;
&lt;/body&gt;&#13;
&lt;/html&gt;</code></pre>
<p class="CodeListingCaption"><span class="SANS_Futura_Std_Book_Oblique_11">Listing 21-2: The</span> <span class="SANS_Futura_Std_Book_11">hello.xhtml.twig</span> <span class="SANS_Futura_Std_Book_Oblique_11">template to create an HTML greeting around the</span> <span class="TheSansMonoCd_W5Regular_Italic_11">name</span> <span class="SANS_Futura_Std_Book_Oblique_11">variable</span></p>
<p class="TX">Like many web templating languages, Twig templates use double curly brackets to indicate a value that should be filled in, such as <span class="SANS_TheSansMonoCd_W5Regular_11">{{name}}</span> in this template <span aria-label="annotation1" class="CodeAnnotation">❶</span>. This declares that the value of a Twig variable called <span class="SANS_TheSansMonoCd_W5Regular_11">name</span> is to be inserted here when the <span class="SANS_TheSansMonoCd_W5Regular_11">render()</span> method generates its HTML output string. In the PHP script invoking this template, we’ll need to pass Twig a value for the variable in the <span class="SANS_TheSansMonoCd_W5Regular_11">$args</span> array, under a key of the same name. For example, if we declared the <span class="SANS_TheSansMonoCd_W5Regular_11">$args</span> array as <span class="SANS_TheSansMonoCd_W5Regular_11">['name' =&gt; 'Matt']</span>, the <span class="SANS_TheSansMonoCd_W5Regular_11">render()</span> method would produce the HTML shown in <a href="#lis21-3">Listing 21-3</a>, with <span class="SANS_TheSansMonoCd_W5Regular_11">Matt</span> (shown here in bold) inserted in place of the <span class="SANS_TheSansMonoCd_W5Regular_11">name</span> variable.</p>
<span id="lis21-3"/>
<pre><code>&lt;!doctype html&gt;&#13;
&lt;html lang="en"&gt;&#13;
&lt;head&gt;&#13;
    &lt;title&gt;Twig hello&lt;/title&gt;&#13;
&lt;/head&gt;&#13;
&#13;
&lt;body&gt;&#13;
  <span aria-label="annotation1" class="Code_CodeAnnotation">❶</span> Hello <b>Matt</b>, nice to meet you&#13;
&lt;/body&gt;&#13;
&lt;/html&gt;</code></pre>
<p class="CodeListingCaption"><span class="SANS_Futura_Std_Book_Oblique_11">Listing 21-3: The HTML rendered by the Twig template when</span> <span class="TheSansMonoCd_W5Regular_Italic_11">name</span> <span class="SANS_Futura_Std_Book_Oblique_11">contains</span> <span class="TheSansMonoCd_W5Regular_Italic_11">'Matt'</span></p>
<p class="TX">We see <span class="SANS_TheSansMonoCd_W5Regular_11">Matt</span> has been inserted into the line saying hello in the HTML text output <span aria-label="annotation1" class="CodeAnnotation">❶</span>.</p>
<p class="TX">Twig’s double curly brackets are similar to the PHP <span class="SANS_TheSansMonoCd_W5Regular_11">&lt;?=</span> short echo tag, in that both set off expressions that evaluate to strings and will be inserted into the output HTML. (Just as with PHP, Twig has other tags for setting off logic, such as loops and conditionals, rather than string output statements.) However, since Twig templates can’t contain PHP statements, using Twig double curly brackets instead of PHP short echo tags protects a website from PHP security vulnerabilities in the site’s templates.</p>
</section>
<section aria-labelledby="sec6" epub:type="division">
<h5 class="H3" id="sec6"><span class="SANS_Futura_Std_Bold_Condensed_B_11">Creating the Application Class</span></h5>
<p class="TNI1">Let’s now write an <span class="SANS_TheSansMonoCd_W5Regular_11">Application</span> class for our greeting page. It will set up the <span class="SANS_TheSansMonoCd_W5Regular_11">Twig\Environment</span> object in its constructor method and have a <span class="SANS_TheSansMonoCd_W5Regular_11">run()</span> method <span aria-label="400" epub:type="pagebreak" id="pg_400" role="doc-pagebreak"/>to set variables and generate the page’s HTML via Twig. All object-oriented MVC web applications have something like this <span class="SANS_TheSansMonoCd_W5Regular_11">Application</span> class to perform any setup and initializations required, and then to execute the main logic for handling requests to the application.</p>
<p class="TX">For now, the class will always output the same HTML, but later in the chapter, we’ll see some logic in the class’s <span class="SANS_TheSansMonoCd_W5Regular_11">run()</span> method to output different HTML content depending on variables received in the request to the server. To declare the class, create <i>src/Application.php</i> containing the code in <a href="#lis21-4">Listing 21-4</a>.</p>
<span id="lis21-4"/>
<pre><code>&lt;?php&#13;
namespace Mattsmithdev;&#13;
&#13;
use \Twig\Loader\FilesystemLoader;&#13;
use \Twig\Environment;&#13;
&#13;
class Application&#13;
{&#13;
    const PATH_TO_TEMPLATES = __DIR__ . '/../templates';&#13;
&#13;
    private Environment $twig;&#13;
&#13;
    public function __construct()&#13;
    {&#13;
        $loader = new FilesystemLoader(self::PATH_TO_TEMPLATES);&#13;
      <span aria-label="annotation1" class="Code_CodeAnnotation">❶</span> $this-&gt;twig = new Environment($loader);&#13;
    }&#13;
&#13;
    public function run()&#13;
    {&#13;
        $name = 'Matt';&#13;
&#13;
        $template = 'hello.xhtml.twig';&#13;
        $args = [&#13;
            'name' =&gt; $name,&#13;
        ];&#13;
&#13;
      <span aria-label="annotation2" class="Code_CodeAnnotation">❷</span> $html = $this-&gt;twig-&gt;render($template, $args);&#13;
        print $html;&#13;
    }&#13;
}</code></pre>
<p class="CodeListingCaption"><span class="SANS_Futura_Std_Book_Oblique_11">Listing 21-4: The class</span> <span class="SANS_Futura_Std_Book_11">src/Application.php</span> <span class="SANS_Futura_Std_Book_Oblique_11">to create a Twig object and a method to output HTML</span></p>
<p class="TX">We declare the <span class="SANS_TheSansMonoCd_W5Regular_11">Application</span> class as part of the <span class="SANS_TheSansMonoCd_W5Regular_11">Mattsmithdev</span> namespace and include two <span class="SANS_TheSansMonoCd_W5Regular_11">use</span> statements, since we’ll need to create objects of classes from the <span class="SANS_TheSansMonoCd_W5Regular_11">Twig</span> namespace in the constructor. Then we declare a constant named <span class="SANS_TheSansMonoCd_W5Regular_11">PATH_TO_TEMPLATES</span> holding the path to the base <i>templates</i> directory where all the templates are saved. We also declare a private <span class="SANS_TheSansMonoCd_W5Regular_11">twig</span> property, which will be a reference to a <span class="SANS_TheSansMonoCd_W5Regular_11">Twig\Environment</span> object.</p>
<p class="TX"><span aria-label="401" epub:type="pagebreak" id="pg_401" role="doc-pagebreak"/>Next, we declare the class’s constructor method. Within it, we create two Twig-related objects, <span class="SANS_TheSansMonoCd_W5Regular_11">FilesystemLoader</span> and <span class="SANS_TheSansMonoCd_W5Regular_11">Environment</span>. The latter holds the all-important <span class="SANS_TheSansMonoCd_W5Regular_11">render()</span> method, while the former helps the <span class="SANS_TheSansMonoCd_W5Regular_11">Environment</span> object access the template files. The <span class="SANS_TheSansMonoCd_W5Regular_11">FilesystemLoader</span> object is created only temporarily, since its reference, stored in the <span class="SANS_TheSansMonoCd_W5Regular_11">$loader</span> variable, exists only within the scope of the constructor. When we create the <span class="SANS_TheSansMonoCd_W5Regular_11">Environment</span> object (using <span class="SANS_TheSansMonoCd_W5Regular_11">$loader</span>), we store a reference to it in the <span class="SANS_TheSansMonoCd_W5Regular_11">Application</span> object’s <span class="SANS_TheSansMonoCd_W5Regular_11">twig</span> property <span aria-label="annotation1" class="CodeAnnotation">❶</span>, which all our <span class="SANS_TheSansMonoCd_W5Regular_11">Application</span> methods can access when <span class="SANS_TheSansMonoCd_W5Regular_11">$this-&gt;twig</span> is written.</p>
<p class="TX">Notice that when we create the <span class="SANS_TheSansMonoCd_W5Regular_11">FilesystemLoader</span> object by using the <span class="SANS_TheSansMonoCd_W5Regular_11">PATH_TO_TEMPLATES</span> constant, we must add <span class="SANS_TheSansMonoCd_W5Regular_11">self::</span> before the constant identifier. As we’ll discuss in <span class="Xref"><a href="chapter25.xhtml">Chapter 25</a></span>, this prefix is necessary when referencing a constant declared in the same class. This is because PHP doesn’t create a copy of the constant for each object of the class. Instead, there’s just one constant for all objects of the class, so writing <span class="SANS_TheSansMonoCd_W5Regular_11">$this-&gt;PATH_TO_TEMPLATES</span> isn’t valid.</p>
<p class="TX">We next declare the <span class="SANS_TheSansMonoCd_W5Regular_11">Application</span> class’s <span class="SANS_TheSansMonoCd_W5Regular_11">run()</span> method. In it, we define the <span class="SANS_TheSansMonoCd_W5Regular_11">$name</span> variable containing the name of the person we want to greet. Then we create the <span class="SANS_TheSansMonoCd_W5Regular_11">$template</span> variable, which holds the name of our template file (<i>hello.xhtml.twig</i>), and the <span class="SANS_TheSansMonoCd_W5Regular_11">$args</span> variable, an array with a single element holding the value of the <span class="SANS_TheSansMonoCd_W5Regular_11">$name</span> variable under the <span class="SANS_TheSansMonoCd_W5Regular_11">'name'</span> key. As we’ve discussed, this key corresponds to the Twig variable enclosed in double curly brackets in our template file. Still within the <span class="SANS_TheSansMonoCd_W5Regular_11">run()</span> method, we then invoke the <span class="SANS_TheSansMonoCd_W5Regular_11">render()</span> method of our Twig object, storing the string it returns in the <span class="SANS_TheSansMonoCd_W5Regular_11">$html</span> variable <span aria-label="annotation2" class="CodeAnnotation">❷</span>. Finally, we print the content of <span class="SANS_TheSansMonoCd_W5Regular_11">$html</span>, which becomes the HTML body of the response returned to the web client.</p>
</section>
<section aria-labelledby="sec7" epub:type="division">
<h5 class="H3" id="sec7"><span class="SANS_Futura_Std_Bold_Condensed_B_11">Creating the Autoloader</span></h5>
<p class="TNI1">Let’s now get Composer to create the autoloader for <span class="SANS_TheSansMonoCd_W5Regular_11">Mattsmithdev</span> namespaced classes located in the <i>src</i> directory (such as our <span class="SANS_TheSansMonoCd_W5Regular_11">Application</span> class). To do this, we need to add an <span class="SANS_TheSansMonoCd_W5Regular_11">"autoload"</span> property to <i>composer.json</i> in the top-level directory for the project. This file was created automatically when we used Composer to add the Twig package to the project, and it should already contain a <span class="SANS_TheSansMonoCd_W5Regular_11">"require"</span> property with information about Twig. Update the file as shown in <a href="#lis21-5">Listing 21-5</a>.</p>
<span id="lis21-5"/>
<pre><code>{&#13;
    "autoload": {&#13;
        "psr-4": {&#13;
            "Mattsmithdev\\": "src"&#13;
        }&#13;
  <span aria-label="annotation1" class="Code_CodeAnnotation">❶</span>},&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">    "require": {</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">        "twig/twig": "^3.10"</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">    }</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">}</span></code></pre>
<p class="CodeListingCaption"><span class="SANS_Futura_Std_Book_Oblique_11">Listing 21-5: Updating</span> <span class="SANS_Futura_Std_Book_11">composer.json</span> <span class="SANS_Futura_Std_Book_Oblique_11">for class autoloading</span></p>
<p class="TX"><span aria-label="402" epub:type="pagebreak" id="pg_402" role="doc-pagebreak"/>We add an <span class="SANS_TheSansMonoCd_W5Regular_11">"autoload"</span> property, declaring that <span class="SANS_TheSansMonoCd_W5Regular_11">Mattsmithdev</span> namespaced classes are PSR-4 compliant and can be found in the <i>src</i> directory. Don’t forget the comma after the closing curly bracket <span aria-label="annotation1" class="CodeAnnotation">❶</span>; you’ll get a JSON syntax error if this comma is missing.</p>
<p class="TX">Once you’ve updated <i>composer.json</i>, enter the following at the command line:</p>
<pre><code>$ <b>composer dump-autoload</b></code></pre>
<p class="BodyContinued">This instructs Composer to generate the necessary autoload scripts in the <i>vendor</i> folder.</p>
</section>
<section aria-labelledby="sec8" epub:type="division">
<h5 class="H3" id="sec8"><span class="SANS_Futura_Std_Bold_Condensed_B_11">Adding the Index Script</span></h5>
<p class="TNI1">The final step required to get our greeting page up and running is to create a simple index script that will read in the autoloader, create an <span class="SANS_TheSansMonoCd_W5Regular_11">Application</span> object, and invoke its <span class="SANS_TheSansMonoCd_W5Regular_11">run()</span> method. All our object-oriented web applications will have a simple index script like this, since all the work is being performed by the <span class="SANS_TheSansMonoCd_W5Regular_11">Application</span> object. Create <i>public/index.php</i> as shown in <a href="#lis21-6">Listing 21-6</a>.</p>
<span id="lis21-6"/>
<pre><code>&lt;?php&#13;
require_once __DIR__ . '/../vendor/autoload.php';&#13;
&#13;
use Mattsmithdev\Application;&#13;
$app = new Application();&#13;
$app-&gt;run();</code></pre>
<p class="CodeListingCaption"><span class="SANS_Futura_Std_Book_Oblique_11">Listing 21-6: The</span> <span class="SANS_Futura_Std_Book_11">index.php</span> <span class="SANS_Futura_Std_Book_Oblique_11">script</span></p>
<p class="TX">We first read in and execute the generated autoloader script. Note that the autoloader created by Composer will load any class declared in the <span class="SANS_TheSansMonoCd_W5Regular_11">Mattsmithdev</span> namespace, as well as any classes in third-party libraries that Composer has added to the project (such as Twig). Next, we add a <span class="SANS_TheSansMonoCd_W5Regular_11">use</span> statement so we can refer to the <span class="SANS_TheSansMonoCd_W5Regular_11">Application</span> class without specifying the namespace each time. Then we create an <span class="SANS_TheSansMonoCd_W5Regular_11">Application</span> object and invoke its <span class="SANS_TheSansMonoCd_W5Regular_11">run()</span> method.</p>
<p class="TX">If you run the PHP web server and visit the project home page, you should see something like <a href="#fig21-1">Figure 21-1</a>. Also shown in the figure is the HTML source of the response that the web client receives. Notice that the HTML and the resulting web page both have the name <i>Matt</i> filled in at the location of the Twig <span class="SANS_TheSansMonoCd_W5Regular_11">{{name}}</span> variable.</p>
<span aria-label="403" epub:type="pagebreak" id="pg_403" role="doc-pagebreak"/>
<figure class="IMG"><a id="fig21-1"/><img alt="" class="img100" height="694" src="../images/figure21-1.jpg" width="1499"/>
<figcaption><p class="CAP"><span class="SANS_Futura_Std_Book_Oblique_11">Figure 21-1: The web output, with HTML source, for our basic Twig project</span></p></figcaption>
</figure>
<p class="TX">This might have seemed like <i>a lot</i> of work for a simple “Hello, world!” website, but we’ve now created all the structure required for any project that uses the powerful Twig templating system. Before we apply that structure to a more substantial website, let’s explore a few more useful features of the Twig package.</p>
</section>
</section>
</section>
<section aria-labelledby="sec9" epub:type="division">
<h3 class="H1" id="sec9"><span id="toc-link_293"/><span class="SANS_Futura_Std_Bold_B_11">Manipulating Objects and Arrays in Twig Templates</span></h3>
<p class="TNI1">In addition to simple data types like strings, Twig templates can work with PHP objects, arrays, and so on. However, the notation is a bit different from what we’re used to in PHP, since Twig uses <i>dot notation</i> to access a property or method of an object, or an element in an array. For example, while you’d write <span class="SANS_TheSansMonoCd_W5Regular_11">$product-&gt;price</span> in PHP to access the <span class="SANS_TheSansMonoCd_W5Regular_11">price</span> property of a <span class="SANS_TheSansMonoCd_W5Regular_11">Product</span> object, you’d use <span class="SANS_TheSansMonoCd_W5Regular_11">{{product.price}}</span> to do the same in a Twig template. Conveniently, this works whether the property is public or private, provided that if it’s private, the property has a public getter method that follows the usual <span class="SANS_TheSansMonoCd_W5Regular_11">get</span><span class="SANS_TheSansMonoCd_W5Regular_Italic_11">PropertyName</span><span class="SANS_TheSansMonoCd_W5Regular_11">()</span> or <span class="SANS_TheSansMonoCd_W5Regular_11">is</span><span class="SANS_TheSansMonoCd_W5Regular_Italic_11">BooleanPropertyName</span><span class="SANS_TheSansMonoCd_W5Regular_11">()</span> naming convention. For example, <span class="SANS_TheSansMonoCd_W5Regular_11">{{product.price}}</span> would still successfully access an object’s private <span class="SANS_TheSansMonoCd_W5Regular_11">price</span> property as long as the object has a public <span class="SANS_TheSansMonoCd_W5Regular_11">getPrice()</span> method. You don’t need to reference the <span class="SANS_TheSansMonoCd_W5Regular_11">getPrice()</span> method explicitly in the Twig template, since Twig calls the method for you.</p>
<p class="TX">To illustrate how Twig templates work with these more complex data types, we’ll update our “Hello, world!” web page to display information obtained from a PHP object and array. First, we’ll need to write a class so we can create an object and pass it to the Twig template. <a href="#lis21-7">Listing 21-7</a> shows a simple <span class="SANS_TheSansMonoCd_W5Regular_11">Product</span> class that we can use as an example. Create <i>src/Product.php</i> and enter the contents of the listing.</p>
<span id="lis21-7"/>
<pre><code><span aria-label="404" epub:type="pagebreak" id="pg_404" role="doc-pagebreak"/>&lt;?php&#13;
namespace Mattsmithdev;&#13;
&#13;
class Product&#13;
{&#13;
    private string $description;&#13;
    private float $price;&#13;
&#13;
    public function getDescription(): string {&#13;
        return $this-&gt;description;&#13;
    }&#13;
&#13;
    public function setDescription(string $description): void {&#13;
        $this-&gt;description = $description;&#13;
    }&#13;
&#13;
    public function getPrice(): float {&#13;
        return $this-&gt;price;&#13;
    }&#13;
&#13;
    public function setPrice(float $price): void {&#13;
        $this-&gt;price = $price;&#13;
    }&#13;
&#13;
    public function __toString(): string {&#13;
        return "(PRODUCT) description =&#13;
            $this-&gt;description / price = $this-&gt;price";&#13;
    }&#13;
}</code></pre>
<p class="CodeListingCaption"><span class="SANS_Futura_Std_Book_Oblique_11">Listing 21-7: A simple</span> <span class="TheSansMonoCd_W5Regular_Italic_11">Product</span> <span class="SANS_Futura_Std_Book_Oblique_11">class to use in the Twig demo</span></p>
<p class="TX">The class has two private properties: <span class="SANS_TheSansMonoCd_W5Regular_11">description</span> and <span class="SANS_TheSansMonoCd_W5Regular_11">price</span>. The code also has public getter and setter methods for each of these properties, as well as a <span class="SANS_TheSansMonoCd_W5Regular_11">__toString()</span> method that generates a string summary of the object.</p>
<p class="TX">Next, we’ll modify the <span class="SANS_TheSansMonoCd_W5Regular_11">run()</span> method of our <span class="SANS_TheSansMonoCd_W5Regular_11">Application</span> class. The new method will create an array and a <span class="SANS_TheSansMonoCd_W5Regular_11">Product</span> object and pass them along to the Twig template, along with the original <span class="SANS_TheSansMonoCd_W5Regular_11">name</span> variable. Update <i>src/Application.php</i> to match the contents of <a href="#lis21-8">Listing 21-8</a>.</p>
<span id="lis21-8"/>
<pre><code><span class="TheSansMonoCd_W5Regular_Italic_11">--snip--</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">    public function run()</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">    {</span>&#13;
        $meals = [&#13;
            'breakfast' =&gt; 'toast',&#13;
            'lunch' =&gt; 'salad',&#13;
            'dinner' =&gt; 'fish and chips',&#13;
        ];&#13;
&#13;
        $product1 = new Product();&#13;
        $product1-&gt;setDescription('bag of nails');&#13;
        $product1-&gt;setPrice(10.99);&#13;
&#13;
<span aria-label="405" epub:type="pagebreak" id="pg_405" role="doc-pagebreak"/>      <span aria-label="annotation1" class="Code_CodeAnnotation">❶</span> $template = 'demo.xhtml.twig';&#13;
        $args = [&#13;
            'name' =&gt; 'matt',&#13;
            'meals' =&gt; $meals,&#13;
            'product' =&gt; $product1&#13;
        ];&#13;
&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">        $html = $this-&gt;twig-&gt;render($template, $args);</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">        print $html;</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">    }</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">}</span></code></pre>
<p class="CodeListingCaption"><span class="SANS_Futura_Std_Book_Oblique_11">Listing 21-8: The updated</span> <span class="TheSansMonoCd_W5Regular_Italic_11">Application</span> <span class="SANS_Futura_Std_Book_Oblique_11">class passing an object and an array to the template</span></p>
<p class="TX">We create a <span class="SANS_TheSansMonoCd_W5Regular_11">$meals</span> array with the keys <span class="SANS_TheSansMonoCd_W5Regular_11">'breakfast'</span>, <span class="SANS_TheSansMonoCd_W5Regular_11">'lunch'</span>, and <span class="SANS_TheSansMonoCd_W5Regular_11">'dinner'</span>, along with a <span class="SANS_TheSansMonoCd_W5Regular_11">Product</span> object with the description <span class="SANS_TheSansMonoCd_W5Regular_11">'bag of nails'</span> and the price <span class="SANS_TheSansMonoCd_W5Regular_11">10.99</span>. Then we declare the <span class="SANS_TheSansMonoCd_W5Regular_11">$template</span> and <span class="SANS_TheSansMonoCd_W5Regular_11">$args</span> variables required for the <span class="SANS_TheSansMonoCd_W5Regular_11">render()</span> method. In <span class="SANS_TheSansMonoCd_W5Regular_11">$args</span>, we pass values for three variables in the Twig template: <span class="SANS_TheSansMonoCd_W5Regular_11">name</span>, <span class="SANS_TheSansMonoCd_W5Regular_11">meals</span>, and <span class="SANS_TheSansMonoCd_W5Regular_11">product</span>. This time we declare the value for the <span class="SANS_TheSansMonoCd_W5Regular_11">'name'</span> key directly in the array rather than as a separate variable.</p>
<p class="TX">Notice that we declare the Twig template to be <i>demo.xhtml.twig</i> rather than the <i>hello.xhtml.twig</i> template we created earlier <span aria-label="annotation1" class="CodeAnnotation">❶</span>. We’ll create that new template now and design it to show off some of the ways Twig interacts with objects and arrays. Make a copy of <i>hello.xhtml.twig</i>, rename it <i>demo.xhtml.twig</i>, and update this new file to match <a href="#lis21-9">Listing 21-9</a>.</p>
<span id="lis21-9"/>
<pre><code><span class="TheSansMonoCd_W5Regular_Grey_11">&lt;!doctype html&gt;</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">&lt;html lang="en"&gt;</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">&lt;head&gt;</span>&#13;
    &lt;title&gt;Twig examples&lt;/title&gt;&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">&lt;/head&gt;</span>&#13;
&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">&lt;body&gt;</span>&#13;
<span aria-label="annotation1" class="codeannotated_CodeAnnotation">❶</span> Hello {{name}}&#13;
&lt;hr&gt;&#13;
<span aria-label="annotation2" class="codeannotated_CodeAnnotation">❷</span> for dinner you will have: {{meals.dinner}}&#13;
&lt;hr&gt;&#13;
the price of <span aria-label="annotation3" class="Code_CodeAnnotation">❸</span> {{product.getDescription()}} is $ <span aria-label="annotation4" class="Code_CodeAnnotation">❹</span> {{product.price}}&#13;
&#13;
&lt;hr&gt;&#13;
<span aria-label="annotation5" class="codeannotated_CodeAnnotation">❺</span> details about product: {{product}}&#13;
&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">&lt;/body&gt;</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">&lt;/html&gt;</span></code></pre>
<p class="CodeListingCaption"><span class="SANS_Futura_Std_Book_Oblique_11">Listing 21-9: The</span> <span class="SANS_Futura_Std_Book_11">demo.xhtml.twig</span> <span class="SANS_Futura_Std_Book_Oblique_11">template</span></p>
<p class="TX">In the body of the template, we first print the value of the Twig <span class="SANS_TheSansMonoCd_W5Regular_11">name</span> variable <span aria-label="annotation1" class="CodeAnnotation">❶</span>. Then we print the value inside the <span class="SANS_TheSansMonoCd_W5Regular_11">meals</span> array variable under the <span class="SANS_TheSansMonoCd_W5Regular_11">dinner</span> key <span aria-label="annotation2" class="CodeAnnotation">❷</span>. The Twig dot notation of <span class="SANS_TheSansMonoCd_W5Regular_11">{{meals.dinner}}</span> here corresponds to the PHP expression <span class="SANS_TheSansMonoCd_W5Regular_11">$meals['dinner']</span>.</p>
<p class="TX">Next, we print the value returned from the <span class="SANS_TheSansMonoCd_W5Regular_11">getDescription()</span> method of the <span class="SANS_TheSansMonoCd_W5Regular_11">product</span> object variable <span aria-label="annotation3" class="CodeAnnotation">❸</span>. In this case, the Twig dot notation of <span aria-label="406" epub:type="pagebreak" id="pg_406" role="doc-pagebreak"/><span class="SANS_TheSansMonoCd_W5Regular_11">{{product.getDescription()}}</span> corresponds to the PHP expression <span class="SANS_TheSansMonoCd_W5Regular_11">$product -&gt;getDescription()</span>. We also print the value of the object’s <span class="SANS_TheSansMonoCd_W5Regular_11">price</span> property <span aria-label="annotation4" class="CodeAnnotation">❹</span>. When Twig tries to access this <span class="SANS_TheSansMonoCd_W5Regular_11">price</span> property, it will see that the property is <span class="SANS_TheSansMonoCd_W5Regular_11">private</span>, so it will automatically attempt to invoke the object’s <span class="SANS_TheSansMonoCd_W5Regular_11">getPrice()</span> accessor method instead. The Twig dot notation of <span class="SANS_TheSansMonoCd_W5Regular_11">{{product.price}}</span> therefore corresponds to the PHP expression <span class="SANS_TheSansMonoCd_W5Regular_11">$product-&gt;getPrice()</span>.</p>
<p class="TX">Finally, we place the Twig <span class="SANS_TheSansMonoCd_W5Regular_11">product</span> variable inside double curly brackets without any dot notation <span aria-label="annotation5" class="CodeAnnotation">❺</span>. When Twig sees that <span class="SANS_TheSansMonoCd_W5Regular_11">product</span> is an object, it will automatically attempt to invoke its <span class="SANS_TheSansMonoCd_W5Regular_11">__toString()</span> method. This is similar to PHP automatically invoking an object’s <span class="SANS_TheSansMonoCd_W5Regular_11">__toString()</span> method when a reference to that object is used in a context where a string is expected. Essentially, <span class="SANS_TheSansMonoCd_W5Regular_11">{{product}}</span> in Twig corresponds to <span class="SANS_TheSansMonoCd_W5Regular_11">print $product</span> in PHP, which in turn corresponds to <span class="SANS_TheSansMonoCd_W5Regular_11">$product-&gt;__toString()</span>. <a href="#fig21-2">Figure 21-2</a> shows how the HTML rendered from this template will appear in the browser.</p>
<figure class="IMG"><a id="fig21-2"/><img alt="" class="img100" height="445" src="../images/figure21-2.jpg" width="1680"/>
<figcaption><p class="CAP"><span class="SANS_Futura_Std_Book_Oblique_11">Figure 21-2: A browser rendering of the HTML from the Twig demo template</span></p></figcaption>
</figure>
<p class="TX">As you can see, Twig has successfully filled in all the information from the object and array passed to the template. The annotations in the figure summarize the Twig notation used to access each piece of information, and the equivalent expressions in PHP.</p>
</section>
<section aria-labelledby="sec10" epub:type="division">
<h3 class="H1" id="sec10"><span id="toc-link_294"/><span class="SANS_Futura_Std_Bold_B_11">Twig Control Structures</span></h3>
<p class="TNI1">Beyond printing individual values, the Twig templating language also offers several control structures, including <span class="SANS_TheSansMonoCd_W5Regular_11">if</span> and <span class="SANS_TheSansMonoCd_W5Regular_11">for</span> statements, allowing you to add conditional logic and looping to your Twig templates. This greatly expands the templates’ ability to adapt to whatever data they receive in the <span class="SANS_TheSansMonoCd_W5Regular_11">$args</span> array.</p>
<p class="TX">Twig control statements are written within single curly brackets and percent characters, such as <span class="SANS_TheSansMonoCd_W5Regular_11">{% if</span> <span class="SANS_TheSansMonoCd_W5Regular_Italic_11">condition</span> <span class="SANS_TheSansMonoCd_W5Regular_11">%}</span> or <span class="SANS_TheSansMonoCd_W5Regular_11">{% for ... %}</span>, and each control structure must conclude with a closing tag, such as <span class="SANS_TheSansMonoCd_W5Regular_11">{% endif %}</span> or <span class="SANS_TheSansMonoCd_W5Regular_11">{% endfor %}</span>.</p>
<p class="TX">Twig can loop through all the values in an array with <span class="SANS_TheSansMonoCd_W5Regular_11">{% for value in</span> <span class="SANS_TheSansMonoCd_W5Regular_Italic_11">array</span> <span class="SANS_TheSansMonoCd_W5Regular_11">%}</span>, much like a <span class="SANS_TheSansMonoCd_W5Regular_11">foreach</span> loop in PHP. If you want the key and value for each array item, you could write <span class="SANS_TheSansMonoCd_W5Regular_11">{% for key, value in</span> <span class="SANS_TheSansMonoCd_W5Regular_Italic_11">array</span> <span class="SANS_TheSansMonoCd_W5Regular_11">%}</span>. Let’s try that now by creating a Twig template that will loop through the items in the PHP <span class="SANS_TheSansMonoCd_W5Regular_11">$meals</span> array we created in the preceding section. Update the Twig template <i>demo.xhtml.twig</i> as shown in <a href="#lis21-10">Listing 21-10</a>.</p>
<span id="lis21-10"/>
<pre><code><span aria-label="407" epub:type="pagebreak" id="pg_407" role="doc-pagebreak"/><span class="TheSansMonoCd_W5Regular_Grey_11">&lt;!doctype html&gt;</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">&lt;html lang="en"&gt;</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">&lt;head&gt;</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">    &lt;title&gt;Twig examples&lt;/title&gt;</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">&lt;/head&gt;</span>&#13;
&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">&lt;body&gt;</span>&#13;
&lt;ul&gt;&#13;
  <span aria-label="annotation1" class="Code_CodeAnnotation">❶</span> {% for key, value in meals %}&#13;
        &lt;li&gt;&#13;
          <span aria-label="annotation2" class="Code_CodeAnnotation">❷</span> meal: {{key}} = {{value}}&#13;
        &lt;/li&gt;&#13;
  <span aria-label="annotation3" class="Code_CodeAnnotation">❸</span> {% else %}&#13;
        &lt;li&gt;&#13;
            (there are no meals to list)&#13;
        &lt;/li&gt;&#13;
  <span aria-label="annotation4" class="Code_CodeAnnotation">❹</span> {% endfor %}&#13;
&lt;/ul&gt;&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">&lt;/body&gt;</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">&lt;/html&gt;</span></code></pre>
<p class="CodeListingCaption"><span class="SANS_Futura_Std_Book_Oblique_11">Listing 21-10: Looping through and outputting meals as an HTML list</span></p>
<p class="TX">We declare a Twig <span class="SANS_TheSansMonoCd_W5Regular_11">for</span> loop to iterate through the elements of the <span class="SANS_TheSansMonoCd_W5Regular_11">meals</span> array <span aria-label="annotation1" class="CodeAnnotation">❶</span>. The key and value of each element in the array will become part of a list item in an HTML unordered list and will be output as HTML in the form <span class="SANS_TheSansMonoCd_W5Regular_11">&lt;li&gt;meal: lunch = salad&lt;/li&gt;</span> <span aria-label="annotation2" class="CodeAnnotation">❷</span>. Instead of having to write separate HTML for each item in the list, we simply write one item using the Twig variables <span class="SANS_TheSansMonoCd_W5Regular_11">key</span> and <span class="SANS_TheSansMonoCd_W5Regular_11">value</span>, and the <span class="SANS_TheSansMonoCd_W5Regular_11">for</span> loop will generate all the items for us. The loop also includes a Twig <span class="SANS_TheSansMonoCd_W5Regular_11">else</span> statement <span aria-label="annotation3" class="CodeAnnotation">❸</span>, which is executed if the given array is empty. In that case, we output a message stating that no meals are in the list. The loop concludes with the closing <span class="SANS_TheSansMonoCd_W5Regular_11">endfor</span> tag <span aria-label="annotation4" class="CodeAnnotation">❹</span>. <a href="#fig21-3">Figure 21-3</a> shows the web page that’s rendered when you serve this code with the web server.</p>
<figure class="IMG"><a id="fig21-3"/><img alt="" class="img100" height="758" src="../images/figure21-3.jpg" width="1691"/>
<figcaption><p class="CAP"><span class="SANS_Futura_Std_Book_Oblique_11">Figure 21-3: The web page and HTML source generated by the Twig</span> <span class="SANS_TheSansMonoCd_W5Regular_Italic_11">for</span> <span class="SANS_Futura_Std_Book_Oblique_11">loop</span></p></figcaption>
</figure>
<p class="TX"><span aria-label="408" epub:type="pagebreak" id="pg_408" role="doc-pagebreak"/>The Twig <span class="SANS_TheSansMonoCd_W5Regular_11">for</span> loop has successfully generated an HTML list by using the keys and values from the <span class="SANS_TheSansMonoCd_W5Regular_11">$meals</span> array.</p>
</section>
<section aria-labelledby="sec11" epub:type="division">
<h3 class="H1" id="sec11"><span id="toc-link_295"/><span class="SANS_Futura_Std_Bold_B_11">Creating a Multipage Website with Twig</span></h3>
<p class="TNI1">For the rest of this chapter, we’ll harness Twig templating to create a multipage website. In addition to demonstrating the value of Twig templating, building this site will illustrate how the front-controller structure we’ve used in previous chapters translates to an object-oriented web application. <a href="#fig21-4">Figure 21-4</a> shows the site we’ll progressively develop: a simplified two-page version of the website we created in <span class="Xref"><a href="chapter16.xhtml">Chapter 16</a></span>, with the login page removed.</p>
<figure class="IMG"><a id="fig21-4"/><img alt="" class="img100" height="845" src="../images/figure21-4.jpg" width="1691"/>
<figcaption><p class="CAP"><span class="SANS_Futura_Std_Book_Oblique_11">Figure 21-4: A two-page website created with Twig templating</span></p></figcaption>
</figure>
<p class="TX">Our site will have a home page and a Contact Us page, with the same header and navigation links shared by the two pages. All the common HTML will be declared in a <i>base template</i> from which the page-specific content templates will inherit.</p>
<p class="TX">This means that each <i>page (child) template</i> will contain only the special content for that page. It also means that every page in the website can be changed simply by updating the base template (for example, if we wanted to add or change the navigation links, change the logo, or make the website background turn green for St. Patrick’s Day).</p>
<section aria-labelledby="sec12" epub:type="division">
<h4 class="H2" id="sec12"><span id="toc-link_296"/><span class="SANS_Futura_Std_Bold_Condensed_Oblique_11">The File Structure and Dependencies</span></h4>
<p class="TNI1">Let’s first establish the file structure for the application. Create a new project folder. Inside it, we’ll build the following directories and files:</p>
<span aria-label="409" epub:type="pagebreak" id="pg_409" role="doc-pagebreak"/>
<figure class="IMG-1"><img alt="" class="img100" height="548" src="../images/pg409.jpg" width="1390"/>
</figure>
<p class="TX">Two files are exactly the same as the examples shown earlier in this chapter: <i>public/index.php</i> and <i>composer.json</i>. As you saw in <a href="#lis21-6">Listing 21-6</a>, the <i>index.php</i> script simply reads in the autoloader, creates an object of the <span class="SANS_TheSansMonoCd_W5Regular_11">Application</span> class, and calls the class’s <span class="SANS_TheSansMonoCd_W5Regular_11">run()</span> method. The <i>composer.json</i> file (Listing 21-5) provides information for the autoloader and about the project’s namespace (<span class="SANS_TheSansMonoCd_W5Regular_11">Mattsmithdev</span>) as well as third-party library requirements (Twig). Copy these two files into the folder created for the project.</p>
<p class="TX">Also copy the <i>public/images/logo.png</i> image provided in the files accompanying this book at <i><a href="https://github.com/dr-matt-smith/php-crash-course">https://github.com/dr-matt-smith/php-crash-course</a></i> (or use your own logo image). Finally, since we’ll be using the same namespace and Twig library as before, you can also copy the <i>vendor</i> folder to get the same autoloader and library files.</p>
</section>
<section aria-labelledby="sec13" epub:type="division">
<h4 class="H2" id="sec13"><span id="toc-link_297"/><span class="SANS_Futura_Std_Bold_Condensed_Oblique_11">The Application Class</span></h4>
<p class="TNI1">The <span class="SANS_TheSansMonoCd_W5Regular_11">Application</span> class for our project plays the role of a front controller: it determines which page of the website to display based on the URL-encoded navigation action. If the URL has no <span class="SANS_TheSansMonoCd_W5Regular_11">action</span> variable, <span class="SANS_TheSansMonoCd_W5Regular_11">Application</span> will display the home page. If <span class="SANS_TheSansMonoCd_W5Regular_11">Application</span> finds an <span class="SANS_TheSansMonoCd_W5Regular_11">action</span> variable with the value <span class="SANS_TheSansMonoCd_W5Regular_11">contact</span>, it will display the Contact Us page.</p>
<p class="TX">The <span class="SANS_TheSansMonoCd_W5Regular_11">Application</span> class is also responsible for creating a <span class="SANS_TheSansMonoCd_W5Regular_11">Twig\Environment</span> object to manage the Twig templates, and for this reason the first several lines of the <span class="SANS_TheSansMonoCd_W5Regular_11">Application</span> class declaration are the same as they were for our “Hello, world!” project earlier in the chapter. Copy <i>src/Application.php</i> from the previous project and update it to match <a href="#lis21-11">Listing 21-11</a>.</p>
<span id="lis21-11"/>
<pre><code><span class="TheSansMonoCd_W5Regular_Grey_11">&lt;?php</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">namespace Mattsmithdev;</span>&#13;
&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">use \Twig\Loader\FilesystemLoader;</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">use \Twig\Environment;</span>&#13;
&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">class Application</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">{</span>&#13;
<span aria-label="410" epub:type="pagebreak" id="pg_410" role="doc-pagebreak"/><span class="TheSansMonoCd_W5Regular_Grey_11">    const PATH_TO_TEMPLATES = __DIR__ . '/../templates';</span>&#13;
&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">    private Environment $twig;</span>&#13;
&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">    public function __construct()</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">    {</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">        $loader = new FilesystemLoader(self::PATH_TO_TEMPLATES);</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">        $this-&gt;twig = new Environment($loader);</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">    }</span>&#13;
&#13;
  <span aria-label="annotation1" class="Code_CodeAnnotation">❶</span> public function run(): void&#13;
    {&#13;
        $action = filter_input(INPUT_GET, 'action');&#13;
        switch ($action) {&#13;
            case 'contact':&#13;
                $this-&gt;contactUs();&#13;
                break;&#13;
&#13;
            case 'home':&#13;
            default:&#13;
                $this-&gt;homepage();&#13;
        }&#13;
    }&#13;
&#13;
  <span aria-label="annotation2" class="Code_CodeAnnotation">❷</span> private function homepage(): void&#13;
    {&#13;
        $template = 'homepage.xhtml.twig';&#13;
        $args = [&#13;
            'pageTitle' =&gt; 'Home Page'&#13;
        ];&#13;
&#13;
        $html = $this-&gt;twig-&gt;render($template, $args);&#13;
        print $html;&#13;
    }&#13;
&#13;
  <span aria-label="annotation3" class="Code_CodeAnnotation">❸</span> private function contactUs(): void&#13;
    {&#13;
        $template = 'contactUs.xhtml.twig';&#13;
        $args = [&#13;
            'pageTitle' =&gt; 'Contact Us Page'&#13;
        ];&#13;
&#13;
        $html = $this-&gt;twig-&gt;render($template, $args);&#13;
        print $html;&#13;
    }&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">}</span></code></pre>
<p class="CodeListingCaption"><span class="SANS_Futura_Std_Book_Oblique_11">Listing 21-11: The</span> <span class="TheSansMonoCd_W5Regular_Italic_11">Application</span> <span class="SANS_Futura_Std_Book_Oblique_11">class for the two-page website</span></p>
<p class="TX">We first declare the <span class="SANS_TheSansMonoCd_W5Regular_11">run()</span> method <span aria-label="annotation1" class="CodeAnnotation">❶</span>, which takes the place of the front-controller code we’ve previously written in an <i>index.php</i> script. The method attempts to find a URL-encoded variable named <span class="SANS_TheSansMonoCd_W5Regular_11">action</span>, then feeds its value to a typical front-controller <span class="SANS_TheSansMonoCd_W5Regular_11">switch</span> statement. If the value is <span class="SANS_TheSansMonoCd_W5Regular_11">'contact'</span>, the <span class="SANS_TheSansMonoCd_W5Regular_11">contactUs()</span> method is invoked. Otherwise, the <span class="SANS_TheSansMonoCd_W5Regular_11">homepage()</span> method is invoked.</p>
<p class="TX"><span aria-label="411" epub:type="pagebreak" id="pg_411" role="doc-pagebreak"/>Next, we declare the <span class="SANS_TheSansMonoCd_W5Regular_11">homepage()</span> method <span aria-label="annotation2" class="CodeAnnotation">❷</span>. It prints the result of running the <span class="SANS_TheSansMonoCd_W5Regular_11">render()</span> method of the <span class="SANS_TheSansMonoCd_W5Regular_11">twig</span> property (which contains a reference to the <span class="SANS_TheSansMonoCd_W5Regular_11">Twig\Environment</span> object). When we call <span class="SANS_TheSansMonoCd_W5Regular_11">render()</span>, we pass in <span class="SANS_TheSansMonoCd_W5Regular_11">$template</span>, which has a value of <span class="SANS_TheSansMonoCd_W5Regular_11">'homepage.xhtml.twig'</span>, and pass in the <span class="SANS_TheSansMonoCd_W5Regular_11">$args</span> array, which provides the Twig <span class="SANS_TheSansMonoCd_W5Regular_11">pageTitle</span> variable with the value <span class="SANS_TheSansMonoCd_W5Regular_11">'Home Page'</span>.</p>
<p class="TX">We also declare the <span class="SANS_TheSansMonoCd_W5Regular_11">contactUs()</span> method for displaying the Contact Us page <span aria-label="annotation3" class="CodeAnnotation">❸</span>. This method similarly calls <span class="SANS_TheSansMonoCd_W5Regular_11">render()</span> and prints the result, this time passing in <span class="SANS_TheSansMonoCd_W5Regular_11">$template</span> with a value of <span class="SANS_TheSansMonoCd_W5Regular_11">'contactUs.xhtml.twig'</span> and <span class="SANS_TheSansMonoCd_W5Regular_11">$args</span> providing the Twig <span class="SANS_TheSansMonoCd_W5Regular_11">pageTitle</span> variable with the <span class="SANS_TheSansMonoCd_W5Regular_11">'Contact Us Page'</span> value.</p>
<p class="TX">These two methods, <span class="SANS_TheSansMonoCd_W5Regular_11">homepage()</span> and <span class="SANS_TheSansMonoCd_W5Regular_11">contactUs()</span>, replace stand-alone helper functions that we earlier would have written in a <i>functions.php</i> file. In this way, our object-oriented application encapsulates all the display logic within the <span class="SANS_TheSansMonoCd_W5Regular_11">Application</span> class.</p>
</section>
<section aria-labelledby="sec14" epub:type="division">
<h4 class="H2" id="sec14"><span id="toc-link_298"/><span class="SANS_Futura_Std_Bold_Condensed_Oblique_11">The Twig Templates</span></h4>
<p class="TNI1">Now all we have to do to complete our site is write the Twig template files for the two pages. We’ll start with the home page. Create <i>templates/homepage.xhtml.twig</i> containing the code in <a href="#lis21-12">Listing 21-12</a>.</p>
<span id="lis21-12"/>
<pre><code>&lt;!doctype html&gt;&#13;
&lt;html lang="en"&gt;&#13;
&lt;head&gt;&#13;
  <span aria-label="annotation1" class="Code_CodeAnnotation">❶</span> &lt;title&gt;MGW: {{pageTitle}}&lt;/title&gt;&#13;
&lt;/head&gt;&#13;
&#13;
&lt;body&gt;&#13;
&lt;header&gt;&#13;
  <span aria-label="annotation2" class="Code_CodeAnnotation">❷</span> &lt;img src="/images/logo.png" alt="logo" width="200px"&gt;&#13;
    &lt;ul&gt;&#13;
        &lt;li&gt;&#13;
          <span aria-label="annotation3" class="Code_CodeAnnotation">❸</span> &lt;a href="/"&gt;&#13;
                Home&#13;
            &lt;/a&gt;&#13;
        &lt;/li&gt;&#13;
        &lt;li&gt;&#13;
          <span aria-label="annotation4" class="Code_CodeAnnotation">❹</span> &lt;a href="/?action=contact"&gt;&#13;
                Contact Us&#13;
            &lt;/a&gt;&#13;
        &lt;/li&gt;&#13;
    &lt;/ul&gt;&#13;
&lt;/header&gt;&#13;
&#13;
<span aria-label="annotation5" class="codeannotated_CodeAnnotation">❺</span> &lt;blockquote&gt;&#13;
    &lt;p&gt;&#13;
        &lt;b&gt;MGW. &lt;/b&gt;&#13;
        &lt;br&gt;You know it makes sense!&#13;
    &lt;/p&gt;&#13;
    &lt;p&gt;&#13;
        Welcome to My Great Website (MGW).&#13;
    &lt;/p&gt;&#13;
&lt;/blockquote&gt;&#13;
&#13;
<span aria-label="412" epub:type="pagebreak" id="pg_412" role="doc-pagebreak"/><span aria-label="annotation6" class="codeannotated_CodeAnnotation">❻</span> &lt;h1&gt;{{pageTitle}}&lt;/h1&gt;&#13;
&#13;
<span aria-label="annotation7" class="codeannotated_CodeAnnotation">❼</span> &lt;p&gt;&#13;
    Welcome to the secure website demo.&#13;
&lt;/p&gt;&#13;
&#13;
&lt;/body&gt;&#13;
&lt;/html&gt;</code></pre>
<p class="CodeListingCaption"><span class="SANS_Futura_Std_Book_Oblique_11">Listing 21-12: The</span> <span class="SANS_Futura_Std_Book_11">homepage.xhtml.twig</span> <span class="SANS_Futura_Std_Book_Oblique_11">template</span></p>
<p class="TX">We declare the HTML title, outputting <span class="SANS_TheSansMonoCd_W5Regular_11">MGW</span> followed by the contents of the Twig <span class="SANS_TheSansMonoCd_W5Regular_11">pageTitle</span> variable <span aria-label="annotation1" class="CodeAnnotation">❶</span>. Then we display the site logo image <span aria-label="annotation2" class="CodeAnnotation">❷</span>. We next present a simple navigation list with links to the home page <span aria-label="annotation3" class="CodeAnnotation">❸</span> and the Contact Us page <span aria-label="annotation4" class="CodeAnnotation">❹</span>. Then we use a <span class="SANS_TheSansMonoCd_W5Regular_11">&lt;blockquote&gt;</span> element to present the website’s tagline and greeting <span aria-label="annotation5" class="CodeAnnotation">❺</span>, followed by a level 1 heading that again uses the Twig <span class="SANS_TheSansMonoCd_W5Regular_11">pageTitle</span> variable <span aria-label="annotation6" class="CodeAnnotation">❻</span>. Finally, we declare the page-specific content; for this home page, it’s just a sentence in a paragraph <span aria-label="annotation7" class="CodeAnnotation">❼</span>.</p>
<p class="TX">Listing 21-13 shows the parts of the page that are different for the Contact Us Twig template. Copy <i>homepage.xhtml.twig</i>, name the copy <i>contactUs.xhtml.twig</i>, and edit this file to match this listing.</p>
<span id="lis21-13"/>
<pre><code><span class="TheSansMonoCd_W5Regular_Italic_11">--snip--</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">    &lt;/p&gt;</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">    &lt;p&gt;</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">        Welcome to My Great Website (MGW).</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">    &lt;/p&gt;</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">&lt;/blockquote&gt;</span>&#13;
&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">&lt;h1&gt;{{pageTitle}}&lt;/h1&gt;</span>&#13;
&#13;
<span aria-label="annotation1" class="codeannotated_CodeAnnotation">❶</span> &lt;p&gt;&#13;
    Contact us as follows:&#13;
&lt;/p&gt;&#13;
&#13;
&lt;dl&gt;&#13;
    &lt;dt&gt;Email&lt;/dt&gt;&#13;
    &lt;dd&gt;inquiries@securitydemo.com&lt;/dd&gt;&#13;
&#13;
    &lt;dt&gt;Phone&lt;/dt&gt;&#13;
    &lt;dd&gt;+123 22-333-4444&lt;/dd&gt;&#13;
&#13;
    &lt;dt&gt;Address&lt;/dt&gt;&#13;
    &lt;dd&gt;1 Main Street,&lt;br&gt;Newtown,&lt;br&gt;Ireland&lt;/dd&gt;&#13;
&lt;/dl&gt;&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">&lt;/body&gt;</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">&lt;/html&gt;</span></code></pre>
<p class="CodeListingCaption"><span class="SANS_Futura_Std_Book_Oblique_11">Listing 21-13: The</span> <span class="SANS_Futura_Std_Book_11">contactUs.xhtml.twig</span> <span class="SANS_Futura_Std_Book_Oblique_11">template</span></p>
<p class="TX"><span aria-label="413" epub:type="pagebreak" id="pg_413" role="doc-pagebreak"/>The only content of this template that differs from the home page is the paragraph and definition list at the end of the HTML body <span aria-label="annotation1" class="CodeAnnotation">❶</span>. Thanks to the use of the Twig <span class="SANS_TheSansMonoCd_W5Regular_11">pageTitle</span> variable, the rest of the template is identical. Twig will fill in the variable with <span class="SANS_TheSansMonoCd_W5Regular_11">Home Page</span> or <span class="SANS_TheSansMonoCd_W5Regular_11">Contact Us Page</span> as appropriate.</p>
<p class="TX">At this point, the website has everything we need to display and navigate the two pages. If you run the project, you’ll see something like <a href="#fig21-5">Figure 21-5</a>.</p>
<figure class="IMG"><a id="fig21-5"/><img alt="" class="img100" height="1362" src="../images/figure21-5.jpg" width="1689"/>
<figcaption><p class="CAP"><span class="SANS_Futura_Std_Book_Oblique_11">Figure 21-5: A simple two-page site built with Twig</span></p></figcaption>
</figure>
<p class="TX">Notice that Twig has correctly filled in the value of the <span class="SANS_TheSansMonoCd_W5Regular_11">pageTitle</span> variable for each page.</p>
</section>
<section aria-labelledby="sec15" epub:type="division">
<h4 class="H2" id="sec15"><span id="toc-link_299"/><span class="SANS_Futura_Std_Bold_Condensed_Oblique_11">Twig Features to Improve Efficiency</span></h4>
<p class="TNI1">Our two-page website now works as expected, but a lot of duplicated code remains in the two Twig template files. In this section, we’ll explore techniques for improving the efficiency of our templates, such as <span class="SANS_TheSansMonoCd_W5Regular_11">include</span> statements and template inheritance. Features like these make Twig particularly useful for developing multipage web applications.</p>
<section aria-labelledby="sec16" epub:type="division">
<span aria-label="414" epub:type="pagebreak" id="pg_414" role="doc-pagebreak"/>
<h5 class="H3" id="sec16"><span class="SANS_Futura_Std_Bold_Condensed_B_11">include Statements</span></h5>
<p class="TNI1">As you’ve seen, pages in a website typically share much of the same HTML code. Twig <span class="SANS_TheSansMonoCd_W5Regular_11">include</span> statements make it possible to create partial templates containing that shared code and add the rendered output from those partial templates to the actual page templates that need it. These <span class="SANS_TheSansMonoCd_W5Regular_11">include</span> statements take the form <span class="SANS_TheSansMonoCd_W5Regular_11">{{include(</span><span class="SANS_TheSansMonoCd_W5Regular_Italic_11">templateName</span><span class="SANS_TheSansMonoCd_W5Regular_11">)}}</span>.</p>
<p class="TX">To demonstrate, we’ll take all the shared content at the top of each of our two page templates and put it in a common <i>_header.xhtml.twig</i> file. (Remember, it’s common to prefix partial templates like this with an underscore.) Then we’ll use <span class="SANS_TheSansMonoCd_W5Regular_11">include</span> statements to add the partial template to the top of our page template files, which we’ll be able to shorten to contain just the content unique to each page.</p>
<p class="TX">Create <i>templates/_header.xhtml.twig</i> and copy in the code from the top of one of the page template files, as shown in <a href="#lis21-14">Listing 21-14</a>.</p>
<span id="lis21-14"/>
<pre><code>&lt;!doctype html&gt;&#13;
&lt;html lang="en"&gt;&#13;
&lt;head&gt;&#13;
    &lt;title&gt;MGW: {{pageTitle}}&lt;/title&gt;&#13;
&lt;/head&gt;&#13;
&#13;
<span class="TheSansMonoCd_W5Regular_Italic_11">--snip--</span>&#13;
    &lt;p&gt;&#13;
        Welcome to My Great Website (MGW).&#13;
    &lt;/p&gt;&#13;
&lt;/blockquote&gt;&#13;
&#13;
&lt;h1&gt;{{pageTitle}}&lt;/h1&gt;</code></pre>
<p class="CodeListingCaption"><span class="SANS_Futura_Std_Book_Oblique_11">Listing 21-14: The partial</span> <span class="SANS_Futura_Std_Book_11">_header.xhtml.twig</span> <span class="SANS_Futura_Std_Book_Oblique_11">template</span></p>
<p class="TX">Everything up to and including the level 1 heading (again, using the Twig <span class="SANS_TheSansMonoCd_W5Regular_11">pageTitle</span> variable) has been moved into this <i>_header.xhtml.twig</i> partial template. With that, we can greatly reduce the content in the home page and Contact Us templates. <a href="#lis21-15">Listing 21-15</a> shows the updated home page Twig template, replacing all the duplicated content with a simple Twig <span class="SANS_TheSansMonoCd_W5Regular_11">include</span> statement. Update <i>templates/homepage.xhtml.twig</i> to match the contents of this listing.</p>
<span id="lis21-15"/>
<pre><code>{{include('_header.xhtml.twig')}}&#13;
&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">&lt;p&gt;</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">    Welcome to the secure website demo.</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">&lt;/p&gt;</span>&#13;
&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">&lt;/body&gt;</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">&lt;/html&gt;</span></code></pre>
<p class="CodeListingCaption"><span class="SANS_Futura_Std_Book_Oblique_11">Listing 21-15: The simplified</span> <span class="SANS_Futura_Std_Book_11">homepage.xhtml.twig</span> <span class="SANS_Futura_Std_Book_Oblique_11">template</span></p>
<p class="TX">We begin with a the Twig <span class="SANS_TheSansMonoCd_W5Regular_11">include</span> statement, <span class="SANS_TheSansMonoCd_W5Regular_11">{{include('_header.xhtml.twig')}}</span>, telling Twig to read in the partial template file <i>_header.xhtml.twig</i>. All that remains in the template is the page-specific content.</p>
<p class="TX"><span aria-label="415" epub:type="pagebreak" id="pg_415" role="doc-pagebreak"/>We can similarly remove the duplicated content from our Contact Us template. Update <i>templates/contactUs.xhtml.twig</i> as shown in <a href="#lis21-16">Listing 21-16</a>.</p>
<span id="lis21-16"/>
<pre><code>{{include('_header.xhtml.twig')}}&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">&lt;p&gt;</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">    Contact us as follows:</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">&lt;/p&gt;</span>&#13;
&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">&lt;dl&gt;</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">    &lt;dt&gt;Email&lt;/dt&gt;</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">    &lt;dd&gt;inquiries@securitydemo.com&lt;/dd&gt;</span>&#13;
&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">    &lt;dt&gt;Phone&lt;/dt&gt;</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">    &lt;dd&gt;+123 22-333-4444&lt;/dd&gt;</span>&#13;
&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">    &lt;dt&gt;Address&lt;/dt&gt;</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">    &lt;dd&gt;1 Main Street,&lt;br&gt;Newtown,&lt;br&gt;Ireland&lt;/dd&gt;</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">&lt;/dl&gt;</span>&#13;
&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">&lt;/body&gt;</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">&lt;/html&gt;</span></code></pre>
<p class="CodeListingCaption"><span class="SANS_Futura_Std_Book_Oblique_11">Listing 21-16: The simplified</span> <span class="SANS_Futura_Std_Book_11">contactUs.xhtml.twig</span> <span class="SANS_Futura_Std_Book_Oblique_11">template</span></p>
<p class="TX">Once again, we’ve removed the duplicated content and replaced it with a Twig <span class="SANS_TheSansMonoCd_W5Regular_11">include</span> statement. The page-specific content follows.</p>
<p class="TX">Using Twig <span class="SANS_TheSansMonoCd_W5Regular_11">include</span> statements, we’ve drastically simplified our individual page templates. However, notice that we still have the final <span class="SANS_TheSansMonoCd_W5Regular_11">&lt;/body&gt;</span> and <span class="SANS_TheSansMonoCd_W5Regular_11">&lt;/html&gt;</span> tags shared by both templates. In theory, we could relocate these to a partial <i>_footer.xhtml.twig</i> template. For a simple website, this could be a reasonable approach, but for more complex pages and larger websites, Twig offers an even more powerful feature for consolidating redundant content than <span class="SANS_TheSansMonoCd_W5Regular_11">include</span> statements: template inheritance.</p>
</section>
<section aria-labelledby="sec17" epub:type="division">
<h5 class="H3" id="sec17"><span class="SANS_Futura_Std_Bold_Condensed_B_11">Template Inheritance</span></h5>
<p class="TNI1"><i>Template inheritance</i> involves creating a <i>base template</i> with all the content shared by a group of web pages, then creating individual <i>child templates</i> that extend the base template by filling in or overriding just the content unique to a particular page. It’s much like the OOP technique of creating subclasses that inherit from, extend, and override certain behaviors of a superclass.</p>
<p class="TX">The base template ensures that all website pages have all the required valid, well-formed HTML, including ending tags, freeing up the child templates to focus on their own page-specific content. As you’ll see, this inheritance approach is much neater than using <span class="SANS_TheSansMonoCd_W5Regular_11">include</span> statements to incorporate partial templates.</p>
<aside aria-labelledby="box-15" class="box">
<span aria-label="416" epub:type="pagebreak" id="pg_416" role="doc-pagebreak"/>
<h6 class="BoxTitle" id="box-15"><span class="SANS_Dogma_OT_Bold_B_11">INCLUDE IS SOMETIMES USEFUL EVEN WHEN USING INHERITANCE</span></h6>
<p class="BoxBodyFirst"><span class="SANS_Futura_Std_Book_11">Once we are using Twig inheritance, all we need for many web applications are base and child templates, since all the common page content is declared in the base templates. So it may seem there is no need to use Twig</span> <span class="SANS_TheSansMonoCd_W5Regular_11">include</span> <span class="SANS_Futura_Std_Book_11">statements and partial templates. However, sometimes a web application developer may choose to declare rarely used content in partial templates, which can then be included by those few pages that need them. The chosen approach is often a personal preference between keeping everything inheritance based versus simplifying the base template to declare only the most commonly used content blocks.</span></p>
</aside>
<p class="TX">To use template inheritance, we’ll first convert our <i>templates/_header.xhtml.twig</i> file into a base template that the other templates can inherit from and extend. Rename <i>_header.xhtml.twig</i> to <i>base.xhtml.twig</i> and edit it to match <a href="#lis21-17">Listing 21-17</a>.</p>
<span id="lis21-17"/>
<pre><code><span class="TheSansMonoCd_W5Regular_Grey_11">&lt;!doctype html&gt;</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">&lt;html lang="en"&gt;</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">&lt;head&gt;</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">    &lt;title&gt;MGW: {{pageTitle}}&lt;/title&gt;</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">&lt;/head&gt;</span>&#13;
&#13;
<span class="TheSansMonoCd_W5Regular_Italic_11">--snip--</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">    &lt;p&gt;</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">        Welcome to My Great Website (MGW).</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">    &lt;/p&gt;</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">&lt;/blockquote&gt;</span>&#13;
&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">&lt;h1&gt;{{pageTitle}}&lt;/h1&gt;</span>&#13;
&#13;
{% block main %}&#13;
{% endblock %}&#13;
&#13;
&lt;/body&gt;&#13;
&lt;/html&gt;</code></pre>
<p class="CodeListingCaption"><span class="SANS_Futura_Std_Book_Oblique_11">Listing 21-17: The</span> <span class="SANS_Futura_Std_Book_11">base.xhtml.twig</span> <span class="SANS_Futura_Std_Book_Oblique_11">template</span></p>
<p class="TX">The key to template inheritance is to use Twig statements in the base template to delineate blocks of code that will be filled in or overridden in each child page template. In this example, we define a block called <span class="SANS_TheSansMonoCd_W5Regular_11">main</span>. This is where the unique content for each page will go. In our base template itself, however, the block is empty, so nothing is between the <span class="SANS_TheSansMonoCd_W5Regular_11">block</span> and <span class="SANS_TheSansMonoCd_W5Regular_11">endblock</span> statements. Twig blocks have names (in this case, <span class="SANS_TheSansMonoCd_W5Regular_11">main</span>) so that child templates can specify which blocks (if any) are to be overridden with page-specific content.</p>
<p class="TX"><span aria-label="417" epub:type="pagebreak" id="pg_417" role="doc-pagebreak"/>Notice that in this inheritance approach, we have a full web page in the base template; that is, it isn’t a partial template. In particular, the base template includes closing <span class="SANS_TheSansMonoCd_W5Regular_11">&lt;/body&gt;</span> and <span class="SANS_TheSansMonoCd_W5Regular_11">&lt;/html&gt;</span> tags. A Twig base template is a complete HTML page in its own right, although it may have default or empty blocks meant to be overridden in the child templates.</p>
<p class="TX">We can now update our home page and Contact Us templates to inherit from the base template and override the <span class="SANS_TheSansMonoCd_W5Regular_11">main</span> block with individual page content. First, update <i>templates/homepage.xhtml.twig</i> to match <a href="#lis21-18">Listing 21-18</a>.</p>
<span id="lis21-18"/>
<pre><code>{% extends 'base.xhtml.twig' %}&#13;
&#13;
{% block main %}&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">&lt;p&gt;</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">    Welcome to the secure website demo.</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">&lt;/p&gt;</span>&#13;
{% endblock %}</code></pre>
<p class="CodeListingCaption"><span class="SANS_Futura_Std_Book_Oblique_11">Listing 21-18: The</span> <span class="SANS_Futura_Std_Book_11">homepage.xhtml.twig</span> <span class="SANS_Futura_Std_Book_Oblique_11">template, inheriting from the base template</span></p>
<p class="TX">We declare that this template extends (inherits from) <i>base.xhtml.twig</i>. Then we embed the page-specific paragraph inside the <span class="SANS_TheSansMonoCd_W5Regular_11">main</span> block, overriding the empty contents of this block in the base template. We finish with an <span class="SANS_TheSansMonoCd_W5Regular_11">endblock</span> statement so that Twig knows where the overriding content ends. These <span class="SANS_TheSansMonoCd_W5Regular_11">endblock</span> statements are particularly important because in more complex pages we may be overriding two or more blocks in a child page template. Notice that we no longer have the closing HTML tags at the end of the file, since these have moved to the base template.</p>
<p class="TX">We next need to make the same changes to the Contact Us page. Update <i>templates/contactUs.xhtml.twig</i> to match <a href="#lis21-19">Listing 21-19</a>.</p>
<span id="lis21-19"/>
<pre><code>{% extends 'base.xhtml.twig' %}&#13;
&#13;
{% block main %}&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">&lt;p&gt;</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">    Contact us as follows:</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">&lt;/p&gt;</span>&#13;
&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">&lt;dl&gt;</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">    &lt;dt&gt;Email&lt;/dt&gt;</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">    &lt;dd&gt;inquiries@securitydemo.com&lt;/dd&gt;</span>&#13;
&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">    &lt;dt&gt;Phone&lt;/dt&gt;</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">    &lt;dd&gt;+123 22-333-4444&lt;/dd&gt;</span>&#13;
&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">    &lt;dt&gt;Address&lt;/dt&gt;</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">    &lt;dd&gt;1 Main Street,&lt;br&gt;Newtown,&lt;br&gt;Ireland&lt;/dd&gt;</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">&lt;/dl&gt;</span>&#13;
&#13;
{% endblock %}</code></pre>
<p class="CodeListingCaption"><span class="SANS_Futura_Std_Book_Oblique_11">Listing 21-19: The</span> <span class="SANS_Futura_Std_Book_11">contactUs.xhtml.twig</span> <span class="SANS_Futura_Std_Book_Oblique_11">template, inheriting from the base template</span></p>
<p class="TX"><span aria-label="418" epub:type="pagebreak" id="pg_418" role="doc-pagebreak"/>Once again, we use <span class="SANS_TheSansMonoCd_W5Regular_11">extends</span> so that this template will inherit from <i>base.xhtml.twig</i>, and we override the <span class="SANS_TheSansMonoCd_W5Regular_11">main</span> block with the page-specific content. As before, we close out the <span class="SANS_TheSansMonoCd_W5Regular_11">main</span> block with an <span class="SANS_TheSansMonoCd_W5Regular_11">endblock</span> statement.</p>
</section>
<section aria-labelledby="sec18" epub:type="division">
<h5 class="H3" id="sec18"><span class="SANS_Futura_Std_Bold_Condensed_B_11">Blocks Instead of Variables</span></h5>
<p class="TNI1">For this simple, static, two-page website, we shouldn’t need to pass any variables to the Twig templates through the <span class="SANS_TheSansMonoCd_W5Regular_11">$args</span> array when we call the <span class="SANS_TheSansMonoCd_W5Regular_11">render()</span> method. At present, our controller methods are passing the page title as a Twig variable named <span class="SANS_TheSansMonoCd_W5Regular_11">pageTitle</span>. However, we could instead make the page title a block in the base template and override the block with the appropriate text in each child template.</p>
<p class="TX">Let’s remove the <span class="SANS_TheSansMonoCd_W5Regular_11">pageTitle</span> variable being passed by the controller methods in our <span class="SANS_TheSansMonoCd_W5Regular_11">Application</span> class. Update <i>src/Application.php</i> to match <a href="#lis21-20">Listing 21-20</a>.</p>
<span id="lis21-20"/>
<pre><code><span class="TheSansMonoCd_W5Regular_Italic_11">--snip--</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">    private function homepage(): void</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">    {</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">        $template = 'homepage.xhtml.twig';</span>&#13;
        $args = [];&#13;
&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">        $html = $this-&gt;twig-&gt;render($template, $args);</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">        print $html;</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">    }</span>&#13;
&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">    private function contactUs(): void</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">    {</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">        $template = 'contactUs.xhtml.twig';</span>&#13;
        $args = [];&#13;
&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">        $html = $this-&gt;twig-&gt;render($template, $args);</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">        print $html;</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">    }</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">}</span></code></pre>
<p class="CodeListingCaption"><span class="SANS_Futura_Std_Book_Oblique_11">Listing 21-20: Passing an empty</span> <span class="TheSansMonoCd_W5Regular_Italic_11">$args</span> <span class="SANS_Futura_Std_Book_Oblique_11">array in the</span> <span class="TheSansMonoCd_W5Regular_Italic_11">Application</span> <span class="SANS_Futura_Std_Book_Oblique_11">class</span></p>
<p class="TX">We declare <span class="SANS_TheSansMonoCd_W5Regular_11">$args</span> as an empty array in the <span class="SANS_TheSansMonoCd_W5Regular_11">homepage()</span> and <span class="SANS_TheSansMonoCd_W5Regular_11">contactUs()</span> methods. While we could just pass an empty array as the second argument to <span class="SANS_TheSansMonoCd_W5Regular_11">render()</span>, first declaring the array as a variable clarifies whether any variables are being passed to the Twig template.</p>
<p class="TX">We must now update the base template to declare a block for the page title, rather than printing the contents of a Twig variable. Update <i>templates/base.xhtml.twig</i> as shown in <a href="#lis21-21">Listing 21-21</a>.</p>
<span id="lis21-21"/>
<pre><code><span class="TheSansMonoCd_W5Regular_Grey_11">&lt;!doctype html&gt;</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">&lt;html lang="en"&gt;</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">&lt;head&gt;</span>&#13;
    &lt;title&gt;MGW: {% block pageTitle %}{% endblock %}&lt;/title&gt;&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">&lt;/head&gt;</span>&#13;
&#13;
<span aria-label="419" epub:type="pagebreak" id="pg_419" role="doc-pagebreak"/><span class="TheSansMonoCd_W5Regular_Italic_11">--snip--</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">    &lt;p&gt;</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">        Welcome to My Great Website (MGW).</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">    &lt;/p&gt;</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">&lt;/blockquote&gt;</span>&#13;
&#13;
<span aria-label="annotation1" class="codeannotated_CodeAnnotation">❶</span> &lt;h1&gt;{{block('pageTitle')}}&lt;/h1&gt;&#13;
&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">{% block main %}</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">{% endblock %}</span>&#13;
&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">&lt;/body&gt;</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">&lt;/html&gt;</span></code></pre>
<p class="CodeListingCaption"><span class="SANS_Futura_Std_Book_Oblique_11">Listing 21-21: Adding a page title block to the</span> <span class="SANS_Futura_Std_Book_11">base.xhtml.twig</span> <span class="SANS_Futura_Std_Book_Oblique_11">template</span></p>
<p class="TX">We declare a new <span class="SANS_TheSansMonoCd_W5Regular_11">pageTitle</span> Twig block whose contents will become part of the HTML <span class="SANS_TheSansMonoCd_W5Regular_11">&lt;title&gt;</span> element. We also need to repeat the contents of this block later as a level 1 heading <span aria-label="annotation1" class="CodeAnnotation">❶</span>. We aren’t permitted to declare a second block with the same name, however. Instead, we print the contents of the block by using Twig’s <span class="SANS_TheSansMonoCd_W5Regular_11">block()</span> function, which takes an argument indicating the name of the block whose contents should be output. We need to enclose this function call in double curly brackets, just like other Twig expressions.</p>
<p class="TX">All that remains is to update each child page to declare a <span class="SANS_TheSansMonoCd_W5Regular_11">pageTitle</span> block containing an appropriate page name, overriding the default empty <span class="SANS_TheSansMonoCd_W5Regular_11">pageTitle</span> block in the base template. Update <i>templates/homepage.xhtml.twig</i> to match <a href="#lis21-22">Listing 21-22</a>.</p>
<span id="lis21-22"/>
<pre><code><span class="TheSansMonoCd_W5Regular_Grey_11">{% extends 'base.xhtml.twig' %}</span>&#13;
&#13;
{% block pageTitle %}Home Page{% endblock %}&#13;
&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">{% block main %}</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">&lt;p&gt;</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">    Welcome to the secure website demo.</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">&lt;/p&gt;</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">{% endblock %}</span></code></pre>
<p class="CodeListingCaption"><span class="SANS_Futura_Std_Book_Oblique_11">Listing 21-22: Declaring a page title block in the</span> <span class="SANS_Futura_Std_Book_11">homepage.xhtml.twig</span> <span class="SANS_Futura_Std_Book_Oblique_11">template</span></p>
<p class="TX">We declare the <span class="SANS_TheSansMonoCd_W5Regular_11">pageTitle</span> block with the <span class="SANS_TheSansMonoCd_W5Regular_11">Home Page</span> content. This one declaration is enough to fill in the page title at both locations in the base template. Update <i>templates/contactUs.xhtml.twig</i> in the same way, declaring the <span class="SANS_TheSansMonoCd_W5Regular_11">pageTitle</span> block with the <span class="SANS_TheSansMonoCd_W5Regular_11">Contact Us Page</span> content.</p>
<p class="TX">When you now load the website, you should see that nothing has changed. However, our use of template inheritance has made the code much more efficient.</p>
</section>
</section>
<section aria-labelledby="sec19" epub:type="division">
<h4 class="H2" id="sec19"><span id="toc-link_300"/><span class="SANS_Futura_Std_Bold_Condensed_Oblique_11">Improved Page Styling with CSS</span></h4>
<p class="TNI1">Our website is working, and the template code is efficient and well organized, but the pages themselves don’t look very appealing. We’ll round out <span aria-label="420" epub:type="pagebreak" id="pg_420" role="doc-pagebreak"/>the website by introducing some CSS to give it a more polished design. With all the common content for the site confined to the single <i>base.xhtml.twig</i> template file, you’ll see that Twig makes this process of updating the site’s appearance quite straightforward.</p>
<section aria-labelledby="sec20" epub:type="division">
<h5 class="H3" id="sec20"><span class="SANS_Futura_Std_Bold_Condensed_B_11">Highlighting the Current Navigation Link</span></h5>
<p class="TNI1">Highlighting the current page’s navigation bar link is a common way to inform the user which page they’re viewing. In <span class="Xref"><a href="chapter16.xhtml">Chapter 16</a>,</span> we did this with PHP variables. Now you’ll see how Twig template inheritance makes the process even easier. In the base template, we’ll declare a uniquely named Twig block for the content of the <span class="SANS_TheSansMonoCd_W5Regular_11">class</span> attribute for each link element in the navigation list. Then, in the child templates, we’ll override the appropriate Twig block to set the current page link’s <span class="SANS_TheSansMonoCd_W5Regular_11">class</span> attribute to <span class="SANS_TheSansMonoCd_W5Regular_11">active</span>. We’ll use CSS to style the active link a different color from others.</p>
<p class="TX">To begin, update <i>base.xhtml.twig</i> to match <a href="#lis21-23">Listing 21-23</a>.</p>
<span id="lis21-23"/>
<pre><code><span class="TheSansMonoCd_W5Regular_Grey_11">&lt;!doctype html&gt;</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">&lt;html lang="en"&gt;</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">&lt;head&gt;</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">    &lt;title&gt;MGW: {% block pageTitle %}{% endblock %}&lt;/title&gt;</span>&#13;
    &lt;style&gt;@import '/css/style.css'&lt;/style&gt;&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">&lt;/head&gt;</span>&#13;
&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">&lt;body&gt;</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">&lt;header&gt;</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">    &lt;img src="/images/logo.png" alt="logo" width="200px"&gt;</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">    &lt;ul&gt;</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">        &lt;li&gt;</span>&#13;
            &lt;a href="/" class="{% block homeLink %}{% endblock %}"&gt;&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">                Home</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">            &lt;/a&gt;</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">        &lt;/li&gt;</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">        &lt;li&gt;</span>&#13;
            &lt;a href="/?action=contact"&#13;
                class="{% block contactLink %}{% endblock %}"&gt;&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">                Contact Us</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">            &lt;/a&gt;</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">    &lt;/ul&gt;</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">&lt;/header&gt;</span>&#13;
&#13;
<span class="TheSansMonoCd_W5Regular_Italic_11">--snip--</span></code></pre>
<p class="CodeListingCaption"><span class="SANS_Futura_Std_Book_Oblique_11">Listing 21-23: The</span> <span class="SANS_Futura_Std_Book_11">base.xhtml.twig</span> <span class="SANS_Futura_Std_Book_Oblique_11">template with blocks for the navigation links</span></p>
<p class="TX">We add a style import declaration so that all pages of the site will be able to use the CSS styles declared in <i>public/css/style.css</i> (which we’ll create shortly). Then we declare a <span class="SANS_TheSansMonoCd_W5Regular_11">homeLink</span> Twig block as the content for a <span class="SANS_TheSansMonoCd_W5Regular_11">class</span> attribute for the link to the home page. The block is empty, so if it isn’t overridden, the link won’t be assigned to a class. We similarly declare a <span class="SANS_TheSansMonoCd_W5Regular_11">contactLink</span> Twig block as the content for a <span class="SANS_TheSansMonoCd_W5Regular_11">class</span> attribute for the Contact Us link.</p>
<p class="TX"><span aria-label="421" epub:type="pagebreak" id="pg_421" role="doc-pagebreak"/>We now need to make the child templates override these blocks. Update the <i>homepage.xhtml.twig</i> template file as shown in <a href="#lis21-24">Listing 21-24</a>.</p>
<span id="lis21-24"/>
<pre><code><span class="TheSansMonoCd_W5Regular_Grey_11">{% extends 'base.xhtml.twig' %}</span>&#13;
&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">{% block pageTitle %}Home Page{% endblock %}</span>&#13;
&#13;
{% block homeLink %}active{% endblock %}&#13;
&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">{% block main %}</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">&lt;p&gt;</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">    Welcome to the secure website demo.</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">&lt;/p&gt;</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">{% endblock %}</span></code></pre>
<p class="CodeListingCaption"><span class="SANS_Futura_Std_Book_Oblique_11">Listing 21-24: Declaring a</span> <span class="TheSansMonoCd_W5Regular_Italic_11">homeLink</span> <span class="SANS_Futura_Std_Book_Oblique_11">block in</span> <span class="SANS_Futura_Std_Book_11">homepage.xhtml.twig</span></p>
<p class="TX">We declare the <span class="SANS_TheSansMonoCd_W5Regular_11">homeLink</span> block to have <span class="SANS_TheSansMonoCd_W5Regular_11">active</span> content, thereby assigning it to a CSS class that will highlight the page link in a different color from the default navigation links. <a href="#lis21-25">Listing 21-25</a> shows how to update the <i>contactUs.xhtml.twig</i> template file in the same way.</p>
<span id="lis21-25"/>
<pre><code><span class="TheSansMonoCd_W5Regular_Grey_11">{% extends 'base.xhtml.twig' %}</span>&#13;
&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">{% block pageTitle %}Contact Us Page{% endblock %}</span>&#13;
&#13;
{% block contactLink %}active{% endblock %}&#13;
&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">{% block main %}</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">&lt;p&gt;</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">    Contact us as follows:</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">&lt;/p&gt;</span>&#13;
<span class="TheSansMonoCd_W5Regular_Italic_11">--snip--</span></code></pre>
<p class="CodeListingCaption"><span class="SANS_Futura_Std_Book_Oblique_11">Listing 21-25: Declaring a</span> <span class="TheSansMonoCd_W5Regular_Italic_11">contactLink</span> <span class="SANS_Futura_Std_Book_Oblique_11">block in</span> <span class="SANS_Futura_Std_Book_11">contactUs.xhtml.twig</span></p>
<p class="TX">We declare the <span class="SANS_TheSansMonoCd_W5Regular_11">contactLink</span> block with <span class="SANS_TheSansMonoCd_W5Regular_11">active</span> content, which again will highlight the page’s link when the user visits it.</p>
<p class="TX">To finish, we need to declare some simple CSS rules. We’ll give the page header (containing the navigation list) a dark background color and define default and active colors for the links. Create a new <i>public/css</i> folder for the project, then create <i>style.css</i> within it and enter the contents of <a href="#lis21-26">Listing 21-26</a>.</p>
<span id="lis21-26"/>
<pre><code>header {&#13;
    background-color: rebeccapurple;&#13;
}&#13;
&#13;
<span aria-label="annotation1" class="codeannotated_CodeAnnotation">❶</span> a {&#13;
    color: gray;&#13;
    text-decoration: none;&#13;
}&#13;
&#13;
<span aria-label="422" epub:type="pagebreak" id="pg_422" role="doc-pagebreak"/><span aria-label="annotation2" class="codeannotated_CodeAnnotation">❷</span> a.active {&#13;
    color: white;&#13;
}&#13;
&#13;
<span aria-label="annotation3" class="codeannotated_CodeAnnotation">❸</span> header ul {&#13;
    display: inline-block;&#13;
}</code></pre>
<p class="CodeListingCaption"><span class="SANS_Futura_Std_Book_Oblique_11">Listing 21-26: The</span> <span class="SANS_Futura_Std_Book_11">style.css</span> <span class="SANS_Futura_Std_Book_Oblique_11">stylesheet</span></p>
<p class="TX">We set the default color of all <span class="SANS_TheSansMonoCd_W5Regular_11">&lt;a&gt;</span> elements to be <span class="SANS_TheSansMonoCd_W5Regular_11">gray</span> <span aria-label="annotation1" class="CodeAnnotation">❶</span>, while any <span class="SANS_TheSansMonoCd_W5Regular_11">&lt;a&gt;</span> elements with a <span class="SANS_TheSansMonoCd_W5Regular_11">class</span> attribute of <span class="SANS_TheSansMonoCd_W5Regular_11">active</span> will be <span class="SANS_TheSansMonoCd_W5Regular_11">white</span> instead <span aria-label="annotation2" class="CodeAnnotation">❷</span>. Finally, we declare the unordered list in the <span class="SANS_TheSansMonoCd_W5Regular_11">header</span> element to display <span class="SANS_TheSansMonoCd_W5Regular_11">inline-block</span> <span aria-label="annotation3" class="CodeAnnotation">❸</span> so our navigation items appear in the same row as the logo image in the header. <a href="#fig21-6">Figure 21-6</a> shows the updated home page for our site, as well as the page’s HTML source code.</p>
<figure class="IMG"><a id="fig21-6"/><img alt="" class="img100" height="593" src="../images/figure21-6.jpg" width="1460"/>
<figcaption><p class="CAP"><span class="SANS_Futura_Std_Book_Oblique_11">Figure 21-6: The home page and corresponding</span> <span class="SANS_TheSansMonoCd_W5Regular_Italic_11">active</span> <span class="SANS_Futura_Std_Book_Oblique_11">CSS class for the page’s link in the HTML source</span></p></figcaption>
</figure>
<p class="TX">In the HTML, notice that the <span class="SANS_TheSansMonoCd_W5Regular_11">active</span> content from the <span class="SANS_TheSansMonoCd_W5Regular_11">homeLink</span> block appears in the <span class="SANS_TheSansMonoCd_W5Regular_11">class</span> element for the Home link in the navigation bar. As a result, the Home link appears white to indicate it’s the page currently being viewed.</p>
</section>
<section aria-labelledby="sec21" epub:type="division">
<h5 class="H3" id="sec21"><span class="SANS_Futura_Std_Bold_Condensed_B_11">Polishing the Website with Bootstrap</span></h5>
<p class="TNI1">Rather than hacking together our own CSS for a more professional-looking and responsive page layout, we can once again let the powerful Bootstrap CSS framework do most of the work for us. Twig makes incorporating Bootstrap styling easy. All we need to do is make a few changes to the base template, and those changes will affect every page of the website. We don’t need to change the child page templates at all.</p>
<p class="TX">We’ll let Bootstrap style our navigation links, and we’ll use predefined colors that Bootstrap provides, so we can delete the folder and file <i>css/style.css</i> altogether. Then we just need to modify the base template of the site. Edit <i>base.xhtml.twig</i> to match the contents of <a href="#lis21-27">Listing 21-27</a>.</p>
<span id="lis21-27"/>
<pre><code><span aria-label="423" epub:type="pagebreak" id="pg_423" role="doc-pagebreak"/><span class="TheSansMonoCd_W5Regular_Grey_11">&lt;!doctype HTML&gt;</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">&lt;html&gt;</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">&lt;head&gt;</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">    &lt;title&gt;MGW: {% block pageTitle %}{% endblock %}&lt;/title&gt;</span>&#13;
    &lt;meta name="viewport" content="width=device-width"&gt; <span aria-label="annotation1" class="codewide_CodeAnnotation">❶</span>&#13;
&#13;
    &lt;link rel="stylesheet"&#13;
          href=https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css&gt; <span aria-label="annotation2" class="codewide_CodeAnnotation">❷</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">&lt;/head&gt;</span>&#13;
&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">&lt;body</span> class="container"&gt; <span aria-label="annotation3" class="codewide_CodeAnnotation">❸</span>&#13;
&#13;
&lt;header class="navbar navbar-expand navbar-dark bg-dark"&gt; <span aria-label="annotation4" class="codewide_CodeAnnotation">❹</span>&#13;
    &lt;img src="/images/logo.png" alt="logo" width="200px"&gt;&#13;
&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">&lt;ul</span> class="navbar-nav"&gt; <span aria-label="annotation5" class="codewide_CodeAnnotation">❺</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">    &lt;li</span> class="nav-item"&gt;&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">        &lt;a</span> class="nav-link <span class="TheSansMonoCd_W5Regular_Grey_11">{% block homeLink %}{% endblock %}" href="/"&gt;</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">            Home</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">        &lt;/a&gt;</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">    &lt;/li&gt;</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">    &lt;li</span> class="nav-item"&gt;&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">        &lt;a</span> class="nav-link <span class="TheSansMonoCd_W5Regular_Grey_11">{% block contactLink %}{% endblock %}" href="/?action=contact"&gt;</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">            Contact Us</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">        &lt;/a&gt;</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">    &lt;/li&gt;</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">&lt;/ul&gt;</span>&#13;
&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">&lt;/header&gt;</span>&#13;
&#13;
&lt;div class="row bg-light p-5 mb-4"&gt; <span aria-label="annotation6" class="codewide_CodeAnnotation">❻</span>&#13;
    &lt;div class="col display-6"&gt;&#13;
        &lt;span class="fw-bold"&gt;<span class="TheSansMonoCd_W5Regular_Grey_11">MGW.</span> &lt;/span&gt;&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">        &lt;br&gt;You know it makes sense!</span>&#13;
    &lt;/div&gt;&#13;
&#13;
    &lt;div class="col"&gt;&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">        &lt;p&gt;</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">            Welcome to My Great Website (MGW).</span>&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">        &lt;/p&gt;</span>&#13;
    &lt;/div&gt;&#13;
&lt;/div&gt;&#13;
&#13;
<span class="TheSansMonoCd_W5Regular_Grey_11">&lt;h1&gt;{{block('pageTitle')}}&lt;/h1&gt;</span>&#13;
<span class="TheSansMonoCd_W5Regular_Italic_11">--snip--</span></code></pre>
<p class="CodeListingCaption"><span class="SANS_Futura_Std_Book_Oblique_11">Listing 21-27: Updating the</span> <span class="SANS_Futura_Std_Book_11">base.xhtml.twig</span> <span class="SANS_Futura_Std_Book_Oblique_11">template with Bootstrap</span></p>
<p class="TX">We add a <span class="SANS_TheSansMonoCd_W5Regular_11">meta</span> element to prevent the page content from appearing too small when viewed on mobile devices <span aria-label="annotation1" class="CodeAnnotation">❶</span>. Then we load in the Bootstrap stylesheet <span aria-label="annotation2" class="CodeAnnotation">❷</span> and entire HTML page body as a Bootstrap <span class="SANS_TheSansMonoCd_W5Regular_11">container</span> <span aria-label="annotation3" class="CodeAnnotation">❸</span>. This adds basic spacing to the left and right margins of the page after Bootstrap <span aria-label="424" epub:type="pagebreak" id="pg_424" role="doc-pagebreak"/>has determined the appropriate maximum width for page content for the web client viewport dimensions.</p>
<p class="TX">We assign the <span class="SANS_TheSansMonoCd_W5Regular_11">header</span> element containing the logo and navigation bar several Bootstrap classes to render the element as a navigation bar in dark mode with the predefined <span class="SANS_TheSansMonoCd_W5Regular_11">bg-dark</span> background color <span aria-label="annotation4" class="CodeAnnotation">❹</span>. The unordered list containing the navigation links receives the <span class="SANS_TheSansMonoCd_W5Regular_11">navbar-nav</span> style <span aria-label="annotation5" class="CodeAnnotation">❺</span> for professional-looking links. We style each link’s list item as a <span class="SANS_TheSansMonoCd_W5Regular_11">nav-item</span> and its anchor link element as a <span class="SANS_TheSansMonoCd_W5Regular_11">nav-link</span>. Notice that the Twig <span class="SANS_TheSansMonoCd_W5Regular_11">homeLink</span> and <span class="SANS_TheSansMonoCd_W5Regular_11">contactLink</span> blocks still appear as part of the links’ <span class="SANS_TheSansMonoCd_W5Regular_11">class</span> attributes, alongside the <span class="SANS_TheSansMonoCd_W5Regular_11">nav-link</span> class. This way, the currently displayed page’s link element will have both the <span class="SANS_TheSansMonoCd_W5Regular_11">nav-link</span> and <span class="SANS_TheSansMonoCd_W5Regular_11">active</span> styles applied, and Bootstrap will highlight the link accordingly.</p>
<p class="TX">The background color, spacing, and multicolumn layout of the header are achieved using a combination of Bootstrap utility classes. We replace the header’s old <span class="SANS_TheSansMonoCd_W5Regular_11">&lt;blockquote&gt;</span> element with a <span class="SANS_TheSansMonoCd_W5Regular_11">&lt;div&gt;</span> <span aria-label="annotation6" class="CodeAnnotation">❻</span> styled as a <span class="SANS_TheSansMonoCd_W5Regular_11">row</span> with a light background (<span class="SANS_TheSansMonoCd_W5Regular_11">bg-light</span>), lots of padding on all four sides (<span class="SANS_TheSansMonoCd_W5Regular_11">p-5</span>), and a medium-spaced bottom margin (<span class="SANS_TheSansMonoCd_W5Regular_11">mb-4</span>). The header <span class="SANS_TheSansMonoCd_W5Regular_11">&lt;div&gt;</span> contains a <span class="SANS_TheSansMonoCd_W5Regular_11">&lt;div&gt;</span> for the main heading and tagline styled as a column (<span class="SANS_TheSansMonoCd_W5Regular_11">col display-6</span>), which will appear to the left of another <span class="SANS_TheSansMonoCd_W5Regular_11">&lt;div&gt;</span> for the site’s greeting.</p>
<p class="TX">With the addition of Bootstrap styling, our website now has the professional look and feel shown previously in <a href="#fig21-4">Figure 21-4</a>. We achieved this styling simply by changing the base template file, without having to touch any of the child page templates.</p>
</section>
</section>
</section>
<section aria-labelledby="sec22" epub:type="division">
<h3 class="H1" id="sec22"><span id="toc-link_301"/><span class="SANS_Futura_Std_Bold_B_11">Summary</span></h3>
<p class="TNI1">In this chapter, you learned the basics of the Twig templating package, which greatly simplifies the process of creating general HTML templates that can be customized with page-specific content. Using Twig, we created a multipage website, driven by the <span class="SANS_TheSansMonoCd_W5Regular_11">run()</span> method of an <span class="SANS_TheSansMonoCd_W5Regular_11">Application</span> class, which performs the function of a front controller. The only part of our web application that isn’t object-oriented is the code in the <i>public/index.php</i> script, which reads in and executes the Composer autoloader, creates an <span class="SANS_TheSansMonoCd_W5Regular_11">Application</span> object, and calls its <span class="SANS_TheSansMonoCd_W5Regular_11">run()</span> method.</p>
<p class="TX">Thanks to Twig, we can safely hand over responsibility for creating and modifying page templates to team members who need no knowledge of PHP programming. Through the use of Twig inheritance and overridable blocks, the templates for each page are small and focus on content specific to that individual page. We leveraged Twig’s powerful inheritance feature, enabling us to add features such as professional Bootstrap styling and active link highlighting, all through declarations in the top-level base template. Overall, using a templating system such as Twig means we’re strongly separating the view component of our web application from its controllers and model: Twig templates have the single responsibility of decorating provided data with HTML to create the body of responses to be returned to the requesting web client.</p>
</section>
<section aria-labelledby="sec23" epub:type="division">
<span aria-label="425" epub:type="pagebreak" id="pg_425" role="doc-pagebreak"/>
<h3 class="H1" id="sec23"><span id="toc-link_302"/><span class="SANS_Futura_Std_Bold_B_11">Exercises</span></h3>
<p class="ListNumber">1.   Create a project with a single script, <i>public/index.php</i>, that returns a complete, well-formed HTML page body containing a paragraph saying <span class="SANS_TheSansMonoCd_W5Regular_11">Hello</span> <span class="SANS_TheSansMonoCd_W5Regular_Italic_11">name</span>, where <span class="SANS_TheSansMonoCd_W5Regular_Italic_11">name</span> is a URL-encoded variable. Then progressively refactor the project in the following sequence:</p>
<p class="ListLetterSub">a.   Move the HTML into <i>templates/hello.php</i>, and write front-controller PHP code in <i>public/index.php</i> to display this template.</p>
<p class="ListLetterSub">b.   Move your front-controller logic into a <span class="SANS_TheSansMonoCd_W5Regular_11">run()</span> method in a namespaced <span class="SANS_TheSansMonoCd_W5Regular_11">Application</span> class. The <span class="SANS_TheSansMonoCd_W5Regular_11">run()</span> method should extract the <span class="SANS_TheSansMonoCd_W5Regular_Italic_11">name</span> URL-encoded variable and pass it to a <span class="SANS_TheSansMonoCd_W5Regular_11">hello()</span> method that displays the <i>templates/hello.php</i> template. You’ll also need to create a <i>composer.json</i> file for your class’s namespace, generate the Composer autoloader, and update <i>public/index.php</i> to read in the autoloader, create an <span class="SANS_TheSansMonoCd_W5Regular_11">Application</span> object, and call the <span class="SANS_TheSansMonoCd_W5Regular_11">run()</span> method.</p>
<p class="ListLetterSub">c.   Convert your <i>templates/hello.php</i> file into a Twig template called <i>templates/hello.xhtml.twig</i>, and update your <span class="SANS_TheSansMonoCd_W5Regular_11">Application</span> class to create a <span class="SANS_TheSansMonoCd_W5Regular_11">twig</span> property in its constructor. Use this property in the <span class="SANS_TheSansMonoCd_W5Regular_11">hello()</span> method to create and then print an <span class="SANS_TheSansMonoCd_W5Regular_11">$html</span> variable for the body of the request to be returned to the web client.</p>
<p class="ListNumber">2.   Copy the project from Exercise 1 and progressively turn it into a two-page website by doing the following:</p>
<p class="ListLetterSub">a.   Separate the core of the HTML structure into a <i>base.xhtml.twig</i> template, and then refactor <i>hello.xhtml.twig</i> to extend this base template and override its body block with the “hello” message.</p>
<p class="ListLetterSub">b.   Create a second page template, <i>privacy.xhtml.twig</i>, that also extends the base template and displays the sentence <i>This website stores zero cookies and so does not affect your browsing privacy in any way.</i></p>
<p class="ListLetterSub">c.   Add a footer to the <i>hello.xhtml.twig</i> template containing the text <span class="SANS_TheSansMonoCd_W5Regular_11">Privacy Policy</span> and linking to URL <i>/?action=privacy.</i></p>
<p class="ListLetterSub">d.   Add a <span class="SANS_TheSansMonoCd_W5Regular_11">privacy()</span> method to the <span class="SANS_TheSansMonoCd_W5Regular_11">Application</span> class. This method should display the <i>privacy.xhtml.twig</i> template.</p>
<p class="ListLetterSub">e.   Update the logic in the <span class="SANS_TheSansMonoCd_W5Regular_11">run()</span> method of the <span class="SANS_TheSansMonoCd_W5Regular_11">Application</span> class so that the value of the URL-encoded <span class="SANS_TheSansMonoCd_W5Regular_11">action</span> variable (if found) is stored in the <span class="SANS_TheSansMonoCd_W5Regular_11">$action</span> variable. Then add a <span class="SANS_TheSansMonoCd_W5Regular_11">switch</span> statement that invokes the <span class="SANS_TheSansMonoCd_W5Regular_11">privacy()</span> method if the value of <span class="SANS_TheSansMonoCd_W5Regular_11">$action</span> is <span class="SANS_TheSansMonoCd_W5Regular_11">privacy</span>, or otherwise invokes the <span class="SANS_TheSansMonoCd_W5Regular_11">hello()</span> method.</p>
<p class="ListNumber">3.   Create an object-oriented, inheritance-based, Twig-templated, three-page website, with a home page, a staff details page, and a privacy policy page. Include Bootstrap CSS and a three-item navigation bar, where the navigation bar item for the page being displayed is highlighted using the <span class="SANS_TheSansMonoCd_W5Regular_11">active</span> CSS class. The staff details page should use a Twig <span class="SANS_TheSansMonoCd_W5Regular_11">for</span> loop to display an HTML table of three staff members, from a provided array of <span class="SANS_TheSansMonoCd_W5Regular_11">Staff</span> objects. The <span class="SANS_TheSansMonoCd_W5Regular_11">Staff</span> class should have <span class="SANS_TheSansMonoCd_W5Regular_11">name</span> and <span class="SANS_TheSansMonoCd_W5Regular_11">jobTitle</span> properties.</p>
</section>
</section>
</div></body></html>