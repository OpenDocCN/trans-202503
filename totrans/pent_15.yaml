- en: Chapter 11. Social Engineering
  id: totrans-0
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 第11章 社会工程学
- en: It is a common saying in information security that users are the vulnerability
    that can never be patched. Put all the security controls in place that you want,
    but if an employee can be convinced to give up sensitive company information,
    it is all for naught. In fact, many of the most famous hacks include no system
    exploitation at all.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 信息安全领域有一句常见的话：“用户是永远无法修补的漏洞。”你可以设置所有想要的安全控制，但如果一个员工被说服泄露敏感的公司信息，那一切都是徒劳。事实上，许多最著名的黑客事件根本没有涉及系统漏洞的利用。
- en: 'For example, consider notorious hacker Kevin Mitnick. Many of Mitnick’s most
    famous exploits came down to walking into a building, convincing the security
    guard he had permission to be there, and then walking out with what he wanted.
    This kind of attack, called *social engineering*, exploits human vulnerabilities:
    a desire to be helpful, unawareness of security policies, and so on.'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，考虑到臭名昭著的黑客凯文·米特尼克。米特尼克最著名的一些黑客事件，通常是走进一座大楼，说服保安他有权限在那里，然后带着自己想要的东西走出去。这种攻击，称为*社会工程学*，利用了人的弱点：愿意提供帮助的心理、对安全政策的不了解等等。
- en: Social-engineering attacks can involve complex technical requirements or no
    technology at all. A social engineer can buy a cable guy uniform at the thrift
    store and potentially walk into an organization, and even into the server room.
    The IT help desk can receive a frantic call from the boss’s boss’s assistant,
    who claims to have locked himself out of his webmail account. People generally
    want to be helpful, so unless there is a secure policy in place, the help desk
    worker may read back the password over the phone or set it to a default value,
    even though the caller is not who he says he is.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 社会工程学攻击可以涉及复杂的技术要求，也可以根本不需要技术。一个社会工程师可以在二手商店买一套电缆工制服，潜入一个组织，甚至进入服务器机房。IT帮助台可能接到一个来自老板助理的慌张电话，他声称自己无法访问公司的网页邮件账户。人们通常想要帮助别人，所以除非有安全的政策规定，否则帮助台工作人员可能会在电话中复述密码，或者将密码重置为默认值，尽管来电者并不是他所声称的那个人。
- en: A common vector for social-engineering attacks is email. If you are ever short
    on entertainment at work, check out your email spam folder. Among the advertisements
    to make some things bigger and others smaller, you will find people trying desperately
    to give you all their money. I firmly believe that if you can find the one African
    prince who really does want to give you his fortune, it will be worth all those
    times your bank account got hacked from answering phishing emails. Joking aside,
    attempting to trick a user into giving up sensitive information by posing as a
    trusted person via email or other electronic means is known as a *phishing attack*.
    Phishing emails can be used to lure targets to visit malicious sites or download
    malicious attachments, among other things. Social-engineering attacks are the
    missing element needed to trick users into falling victim to the client-side attacks
    we studied in [Chapter 10](ch10.xhtml "Chapter 10. Client-Side Exploitation").
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 社会工程学攻击的一个常见途径是电子邮件。如果你在工作中有点无聊，不妨检查一下你的电子邮件垃圾邮件文件夹。在那些让某些东西变大、某些东西变小的广告中，你会发现有人拼命想把他们所有的钱都给你。我坚信，如果你能找到那个真的想把财富送给你的非洲王子，那么所有那些因为回复网络钓鱼邮件而导致你的银行账户被黑的经历都是值得的。开个玩笑，试图通过伪装成可信任的人，诱使用户泄露敏感信息的行为，称为*钓鱼攻击*。钓鱼邮件可以用于诱导目标访问恶意网站或下载恶意附件等。社会工程学攻击是让用户成为我们在[第10章](ch10.xhtml
    "第10章 客户端攻击")中研究的客户端攻击的受害者所必需的缺失环节。
- en: Companies should put time and effort into training all employees about social-engineering
    attacks. No matter what sort of security technologies you put in place, employees
    have to be able to use their workstations, their mobile devices, and so on to
    get their job done. They will have access to sensitive information or security
    controls that, in the wrong hands, could harm the organization. Some security-awareness
    training may seem obvious, like “Don’t share your password with anyone” and “Check
    someone’s badge before you hold the door to a secure area for him or her.” Other
    security awareness may be new to many employees. For instance, on some pentesting
    engagements, I’ve had great success leaving USB sticks in the parking lot or DVDs
    labeled “Payroll” on the bathroom floor. Curious users start plugging these in,
    opening files, and giving me access to their systems. Security-awareness training
    about malicious files, USB switchblades, and other attacks can help stop users
    from falling victim to these types of social-engineering attacks.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 公司应该投入时间和精力，培训所有员工识别社交工程攻击。无论你部署什么样的安全技术，员工都必须能够使用他们的工作站、移动设备等来完成工作。他们将接触到敏感信息或安全控制，这些如果落入不当之手，可能会对组织造成伤害。一些安全意识培训看起来很显然，比如“不要与任何人分享你的密码”和“在为他人打开安全区域的门之前，检查他们的工作证”。其他的安全意识培训可能对许多员工来说是新的。例如，在一些渗透测试项目中，我曾成功地将USB闪存盘放在停车场，或者将标有“工资单”的DVD放在浴室地板上。好奇的用户开始插入这些设备，打开文件，从而让我获得了他们系统的访问权限。关于恶意文件、USB切换刀和其他攻击的安全意识培训，可以帮助阻止用户成为这些类型的社交工程攻击的受害者。
- en: The Social-Engineer Toolkit
  id: totrans-6
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 社交工程工具包
- en: TrustedSec’s Social-Engineer Toolkit (SET), an open source Python-driven tool,
    is designed to help you perform social-engineering attacks during pentests. SET
    will help you create a variety of attacks such as email phishing campaigns (designed
    to steal credentials, financial information, and so on using specially targeted
    email) and web-based attacks (such as cloning a client website and tricking users
    into entering their login credentials).
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: TrustedSec的社交工程工具包（SET）是一个开源的Python驱动工具，旨在帮助你在渗透测试过程中执行社交工程攻击。SET将帮助你创建各种攻击，例如电子邮件钓鱼活动（旨在通过特别针对性的邮件窃取凭证、财务信息等）和基于网页的攻击（如克隆客户网站并欺骗用户输入他们的登录凭证）。
- en: SET comes preinstalled in Kali Linux. To start SET in Kali Linux, enter **`setoolkit`**
    at a prompt, as shown in [Example 11-1](ch11.xhtml#starting_set "Example 11-1. Starting
    SET"). We’ll use SET to run social-engineering attacks, so enter a **`1`** at
    the prompt to move to the Social-Engineering Attacks menu. You will be prompted
    to accept the terms of service.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: SET预装在Kali Linux中。要在Kali Linux中启动SET，请在提示符下输入**`setoolkit`**，如[示例11-1](ch11.xhtml#starting_set
    "示例11-1. 启动SET")所示。我们将使用SET来执行社交工程攻击，因此在提示符下输入**`1`**，进入社交工程攻击菜单。系统会提示你接受服务条款。
- en: Example 11-1. Starting SET
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 示例11-1. 启动SET
- en: '[PRE0]'
  id: totrans-10
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: In this chapter we’ll look at just a few of the SET attacks that I use regularly
    on pentesting engagements. We’ll begin with spear-phishing attacks, which allow
    us to deliver attacks via email.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将仅介绍我在渗透测试中常用的几种SET攻击。我们将从Spear-Phishing攻击开始，它允许我们通过电子邮件进行攻击。
- en: Spear-Phishing Attacks
  id: totrans-12
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Spear-Phishing攻击
- en: The Social-Engineering Attacks menu gives us several attack options, as shown
    in [Example 11-2](ch11.xhtml#choose_spear-phishing_attack_vectors "Example 11-2. Choose
    Spear-Phishing Attack Vectors"). We’ll create a spear-phishing attack, which will
    allow us to create malicious files for client-side attacks (like the ones covered
    in [Chapter 10](ch10.xhtml "Chapter 10. Client-Side Exploitation")), email them,
    and automatically set up a Metasploit handler to catch the payload.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 社交工程攻击菜单为我们提供了几种攻击选项，如[示例11-2](ch11.xhtml#choose_spear-phishing_attack_vectors
    "示例11-2. 选择Spear-Phishing攻击向量")所示。我们将创建一个Spear-Phishing攻击，这将允许我们创建用于客户端攻击（如[第10章](ch10.xhtml
    "第10章. 客户端漏洞利用")中介绍的攻击）的恶意文件，通过电子邮件发送，并自动设置Metasploit处理程序以捕获有效载荷。
- en: Example 11-2. Choose `Spear-Phishing Attack Vectors`
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 示例11-2. 选择`Spear-Phishing攻击向量`
- en: '[PRE1]'
  id: totrans-15
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: Select option **`1`** to choose `Spear-Phishing Attack Vectors` ❶. The Spear-Phishing
    Attack Vectors menu is shown in [Example 11-3](ch11.xhtml#choose_perform_a_mass_email_attack
    "Example 11-3. Choose Perform a Mass Email Attack").
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 选择选项**`1`**来选择`Spear-Phishing Attack Vectors` ❶。Spear-Phishing Attack Vectors菜单在[示例11-3](ch11.xhtml#choose_perform_a_mass_email_attack
    "示例11-3. 选择执行群发邮件攻击")中显示。
- en: Example 11-3. Choose `Perform a Mass Email Attack`
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 示例11-3. 选择`执行群发邮件攻击`
- en: '[PRE2]'
  id: totrans-18
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: The first option, `Perform a Mass Email Attack` ❶, allows us to send a malicious
    file to a predefined email address or list of addresses as well as set up a Metasploit
    listener for the selected payload. The second option, `Create a Fi``leFormat Payload`
    ❷, lets us create a malicious file with a Metasploit payload. The third option
    allows us to create a new email template ❸ to be used in SET attacks.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 第一个选项，`执行群发邮件攻击` ❶，允许我们将恶意文件发送到预定义的电子邮件地址或地址列表，并为所选的载荷设置一个 Metasploit 监听器。第二个选项，`创建一个文件格式载荷`
    ❷，允许我们创建一个带有 Metasploit 载荷的恶意文件。第三个选项允许我们创建一个新的电子邮件模板 ❸，用于 SET 攻击。
- en: Choose option **`1`** to create an email attack. (We’ll have the option to send
    a single email or mass email later.)
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 选择选项 **`1`** 来创建一个电子邮件攻击。（稍后我们将有机会选择发送单封邮件或群发邮件。）
- en: Choosing a Payload
  id: totrans-21
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 选择载荷
- en: Now to choose a payload. A selection of payload options is shown in [Example 11-4](ch11.xhtml#choose_a_spear-phishing_attack
    "Example 11-4. Choose a spear-phishing attack").
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 现在选择一个载荷。载荷选项的选择可参考[示例 11-4](ch11.xhtml#choose_a_spear-phishing_attack "示例 11-4.
    选择一项鱼叉式网络钓鱼攻击")。
- en: Example 11-4. Choose a spear-phishing attack
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 示例 11-4. 选择一项鱼叉式网络钓鱼攻击
- en: '[PRE3]'
  id: totrans-24
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'For example, to re-create our PDF attack from [Chapter 10](ch10.xhtml "Chapter 10. Client-Side
    Exploitation"), choose option **`12`**: `Adobe util.printf() Buffer Overflow`
    ❶. (SET includes many Metasploit attacks, as well as its own, specific attacks.)'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，要重新创建我们在[第10章](ch10.xhtml "第10章. 客户端利用")中的 PDF 攻击，选择选项 **`12`**：`Adobe util.printf()
    缓冲区溢出` ❶。（SET 包含许多 Metasploit 攻击，以及其自身的特定攻击。）
- en: You should be prompted to choose a payload for your malicious file (see [Example 11-5](ch11.xhtml#choose_a_payload
    "Example 11-5. Choose a payload")).
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 系统会提示你选择一个恶意文件的载荷（参见[示例 11-5](ch11.xhtml#choose_a_payload "示例 11-5. 选择载荷")）。
- en: Example 11-5. Choose a payload
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 示例 11-5. 选择载荷
- en: '[PRE4]'
  id: totrans-28
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: The usual suspects are all here, including *windows/meterpreter/reverse_tcp*,
    which appears in a more human-readable form as `Windows Meterpreter Reverse_TCP`
    ❶. We’ll choose this option for our sample attack.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 常见的载荷都在这里，包括 *windows/meterpreter/reverse_tcp*，它以更易读的形式显示为 `Windows Meterpreter
    Reverse_TCP` ❶。我们将选择此选项进行示例攻击。
- en: Setting Options
  id: totrans-30
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 设置选项
- en: SET should prompt for the relevant options for the payload, in this case the
    `LHOST` and `LPORT`. If you’re not very familiar with Metasploit, just answer
    the prompts to set the correct options automatically, as shown in [Example 11-6](ch11.xhtml#setting_options-id00031
    "Example 11-6. Setting options"). Set the payload listener to the IP address of
    Kali Linux. Leave the port to connect back on to the default (443).
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: SET 应该提示输入载荷的相关选项，在这种情况下是 `LHOST` 和 `LPORT`。如果你不太熟悉 Metasploit，只需根据提示设置正确的选项，系统会自动配置，如[示例
    11-6](ch11.xhtml#setting_options-id00031 "示例 11-6. 设置选项")所示。将载荷监听器设置为 Kali Linux
    的 IP 地址。将回连接端口保留为默认端口（443）。
- en: Example 11-6. Setting options
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 示例 11-6. 设置选项
- en: '[PRE5]'
  id: totrans-33
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: Naming Your File
  id: totrans-34
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 命名你的文件
- en: Next you should be prompted to name your malicious file.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，系统会提示你为你的恶意文件命名。
- en: '[PRE6]'
  id: totrans-36
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: Select option **`2`** ❶ to rename the malicious PDF, and enter the filename
    *bulbsecuritysalaries.pdf*. SET should continue.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 选择选项 **`2`** ❶ 来重命名恶意 PDF 文件，并输入文件名 *bulbsecuritysalaries.pdf*。SET 应该继续。
- en: Single or Mass Email
  id: totrans-38
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 单个邮件或群发邮件
- en: Now to decide whether to have SET send our malicious file to a single email
    address or a list of addresses, as shown in [Example 11-7](ch11.xhtml#choosing_to_perform_a_single_email_addre
    "Example 11-7. Choosing to perform a single email address attack").
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 现在决定是让 SET 将恶意文件发送到单个电子邮件地址还是一个地址列表，具体可参考[示例 11-7](ch11.xhtml#choosing_to_perform_a_single_email_addre
    "示例 11-7. 选择执行单一电子邮件地址攻击")。
- en: Example 11-7. Choosing to perform a single email address attack
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 示例 11-7. 选择执行单一电子邮件地址攻击
- en: '[PRE7]'
  id: totrans-41
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: Choose the single email address option ❶ for now. (We’ll look at sending mass
    email ❷ in [Mass Email Attacks](ch11.xhtml#mass_email_attacks "Mass Email Attacks").)
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 目前选择单个电子邮件地址选项 ❶。（稍后我们将在[群发邮件攻击](ch11.xhtml#mass_email_attacks "群发邮件攻击")中看到如何发送群发邮件
    ❷。）
- en: Creating the Template
  id: totrans-43
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 创建模板
- en: When crafting the email, we can use one of SET’s email templates or enter text
    for one-time use in the template. In addition, if you choose `Create a Social-Engineering
    Template`, you can create a template that you can reuse.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 在撰写电子邮件时，我们可以使用 SET 的电子邮件模板之一，或输入一次性使用的文本。此外，如果选择 `创建一个社交工程模板`，则可以创建一个可以重复使用的模板。
- en: Many of my social engineering customers like me to use fake emails that appear
    to come from a company executive or the IT manager, announcing new website functionality
    or a new company policy. Let’s use one of SET’s email templates as an example
    to fake this email now, as shown in [Example 11-8](ch11.xhtml#choosing_an_email_template
    "Example 11-8. Choosing an email template"); we’ll create our own email later
    in the chapter.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 我的许多社会工程学客户喜欢我使用看起来像是来自公司高管或IT经理的伪造邮件，宣布新网站功能或新的公司政策。现在让我们使用SET的一个电子邮件模板作为示例来伪造这封电子邮件，如[示例
    11-8](ch11.xhtml#choosing_an_email_template "示例 11-8. 选择电子邮件模板")所示；我们将在本章稍后自己创建电子邮件。
- en: Example 11-8. Choosing an email template
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 示例 11-8. 选择电子邮件模板
- en: '[PRE8]'
  id: totrans-47
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: Choose **`1`** for `Pre-Defined Template`, then choose template **`5`**.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 选择**`1`**为`预定义模板`，然后选择模板**`5`**。
- en: Setting the Target
  id: totrans-49
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 设置目标
- en: Now SET should prompt you for your target email address and a mail server for
    use in delivering the attack email. You can use your own mail server, one that
    is misconfigured to allow anyone to send mail (called an open relay), or a Gmail
    account, as shown in [Example 11-9](ch11.xhtml#sending_email_with_set "Example 11-9. Sending
    email with SET"). Let’s use Gmail for this attack by choosing option **`1`**.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 现在SET应该提示你输入目标电子邮件地址和用于发送攻击邮件的邮件服务器。你可以使用自己的邮件服务器、一个配置错误的服务器（允许任何人发送邮件，称为开放转发），或者Gmail账户，如[示例
    11-9](ch11.xhtml#sending_email_with_set "示例 11-9. 使用SET发送电子邮件")所示。让我们通过选择选项**`1`**来使用Gmail进行这次攻击。
- en: Example 11-9. Sending email with SET
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 示例 11-9. 使用SET发送电子邮件
- en: '[PRE9]'
  id: totrans-52
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: When prompted, enter the email address and password for your Gmail account.
    SET should attempt to deliver the message. But as you can see in the message at
    the bottom of the listing, Gmail inspects attachments and catches our attack ❶.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 当提示时，输入你的Gmail账户的电子邮件地址和密码。SET应该尝试发送消息。但正如你在列表底部的消息中看到的那样，Gmail会检查附件并拦截我们的攻击❶。
- en: That’s just a first attempt, of course. You may get better results using your
    own mail server or your client’s mail server, if you can gather or guess the credentials.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 当然，这只是第一次尝试。如果你能够收集或猜测凭据，你可能会使用自己的邮件服务器或客户的邮件服务器得到更好的结果。
- en: Of course, in this example, I’m just sending emails to myself. We looked at
    tools such as theHarvester to find valid email addresses to target in [Chapter 5](ch05.xhtml
    "Chapter 5. Information Gathering").
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 当然，在这个示例中，我只是将电子邮件发送给我自己。我们在[第5章](ch05.xhtml "第5章. 信息收集")中使用过像theHarvester这样的工具来找到有效的电子邮件地址进行目标攻击。
- en: Setting Up a Listener
  id: totrans-56
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 设置监听器
- en: We can also have SET set up a Metasploit listener to catch our payload if anyone
    opens the email attachment. Even if you’re not familiar with Metasploit syntax,
    you should be able to use SET to set up this attack based on the options we chose
    in [Setting Options](ch04.xhtml#setting_options "Setting Options"). You can see
    that SET uses a resource file to automatically set the payload, `LHOST`, and `LPORT`
    options based on our previous answers when building the payload (see [Example 11-10](ch11.xhtml#setting_up_a_listener-id00032
    "Example 11-10. Setting up a listener")).
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 我们还可以让SET设置一个Metasploit监听器来捕获我们的有效载荷，如果有人打开了电子邮件附件。即使你不熟悉Metasploit语法，你也应该能够使用SET根据我们在[设置选项](ch04.xhtml#setting_options
    "设置选项")中选择的选项来设置此攻击。你可以看到，SET使用资源文件根据我们在构建有效载荷时的先前回答自动设置有效载荷、`LHOST`和`LPORT`选项（见[示例
    11-10](ch11.xhtml#setting_up_a_listener-id00032 "示例 11-10. 设置监听器")）。
- en: Example 11-10. Setting up a listener
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 示例 11-10. 设置监听器
- en: '[PRE10]'
  id: totrans-59
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: Now we wait for a curious user to open our malicious PDF and send us a session.
    Use ctrl-C to close the listener and type `exit` to move back to the previous
    menu. Option 99 will take you back to SET’s Social-Engineering Attacks menu.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们等待一个好奇的用户打开我们的恶意PDF并发送会话给我们。使用ctrl-C关闭监听器并输入`exit`返回到上一个菜单。选项99将把你带回SET的社会工程学攻击菜单。
- en: Web Attacks
  id: totrans-61
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 网络攻击
- en: In this section we’ll look at web-based attacks. Return to the Social-Engineering
    Attacks menu ([Example 11-2](ch11.xhtml#choose_spear-phishing_attack_vectors "Example 11-2. Choose
    Spear-Phishing Attack Vectors")), and choose option **`2`** (`Website Attack Vectors`).
    This is the sort of attack that I use most often in pentests that have a social-engineering
    component because it emulates many social-engineering attacks seen in the wild.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 在这一部分，我们将讨论基于Web的攻击。返回到社会工程攻击菜单([示例 11-2](ch11.xhtml#choose_spear-phishing_attack_vectors
    "示例 11-2. 选择鱼叉式钓鱼攻击向量"))，选择选项**`2`**（`网站攻击向量`）。这是我在具有社会工程学组件的渗透测试中最常用的攻击类型，因为它模拟了许多现实中看到的社会工程学攻击。
- en: You should be presented with a list of web-based attacks as shown in [Example 11-11](ch11.xhtml#set_website_attacks
    "Example 11-11. SET website attacks").
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 你应该会看到一个列出的网站攻击列表，如 [示例 11-11](ch11.xhtml#set_website_attacks "示例 11-11. SET
    网站攻击") 所示。
- en: Example 11-11. SET website attacks
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 示例 11-11. SET 网站攻击
- en: '[PRE11]'
  id: totrans-65
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'Here’s a description of some of the attacks:'
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 这里是一些攻击的描述：
- en: The Java Applet Attack Method automates the Java-signed applet attack we used
    in [Chapter 10](ch10.xhtml "Chapter 10. Client-Side Exploitation").
  id: totrans-67
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Java 小程序攻击方法自动化了我们在 [第 10 章](ch10.xhtml "第 10 章. 客户端漏洞利用") 中使用的 Java 签名小程序攻击。
- en: The Metasploit Browser Exploit Method allows you to use all of Metasploit’s
    browser-exploitation client-side attacks without having to set parameters manually,
    by knowing Metasploit syntax.
  id: totrans-68
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Metasploit 浏览器利用方法使你可以使用 Metasploit 的所有浏览器客户端攻击，而无需手动设置参数，也不需要了解 Metasploit
    的语法。
- en: The Credential Harvester Attack Method helps create websites to trick users
    into giving up their credentials.
  id: totrans-69
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 凭据收集者攻击方法帮助创建网站，诱使用户交出他们的凭据信息。
- en: The Tabnabbing Attack Method relies on users’ propensity to build up a collection
    of open browser tabs. When the user first opens the attack page, it says “Please
    wait.” Naturally, the user switches back to another tab while he waits. Once the
    attack tab is no longer in focus, it loads the attack site (which can be a clone
    of any website you like), with the goal of tricking the user into supplying his
    credentials or otherwise interacting with the malicious site. The assumption is
    that the user will use the first tab he encounters that looks legitimate.
  id: totrans-70
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Tabnabbing 攻击方法依赖于用户在浏览器中打开多个标签页的习惯。当用户第一次打开攻击页面时，它会显示“请稍等。”自然，用户会在等待期间切换回其他标签页。一旦攻击标签页不再处于焦点，它会加载攻击网站（可以是你喜欢的任何网站的克隆），目的是诱使用户提供其凭据或与恶意网站进行交互。假设用户会使用他遇到的第一个看起来合法的标签页。
- en: Choose option **`3`**, the `Credential Harvester Attack Method`.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 选择选项 **`3`**，即 `凭据收集者攻击方法`。
- en: Next you should see a prompt asking what sort of website you would like. We
    can choose from some prebuilt web templates, clone a website from the Internet
    with Site Cloner, or import a custom web page with Custom Import. Choose option
    **`1`** to use a SET template (see [Example 11-12](ch11.xhtml#set_website_template_options
    "Example 11-12. SET website template options")).
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，你应该会看到一个提示，询问你想要选择什么类型的网站。我们可以从一些预构建的网站模板中选择，使用站点克隆器从互联网上克隆一个网站，或者使用自定义导入导入一个自定义网页。选择选项
    **`1`** 来使用 SET 模板（参见 [示例 11-12](ch11.xhtml#set_website_template_options "示例 11-12.
    SET 网站模板选项")）。
- en: Example 11-12. SET website template options
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 示例 11-12. SET 网站模板选项
- en: '[PRE12]'
  id: totrans-74
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: Now enter the IP address for the website to post credentials back to. We can
    just use the local IP address for the Kali virtual machine, but if you use this
    attack against a client, you will need an Internet-facing IP address.
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 现在输入网站的 IP 地址，以便将凭据发送回去。我们可以直接使用 Kali 虚拟机的本地 IP 地址，但如果你将此攻击用在客户端，你将需要一个面对互联网的
    IP 地址。
- en: '[PRE13]'
  id: totrans-76
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: Now choose a template. Because we want to trick users into entering their credentials,
    choose a template with a login field, such as Gmail (option **`2`**), as shown
    in [Example 11-13](ch11.xhtml#setting_up_the_site "Example 11-13. Setting up the
    site"). SET should now start a web server with our fake Gmail page, a clone of
    the actual Gmail page.
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 现在选择一个模板。因为我们想诱使用户输入凭据，所以选择一个带有登录字段的模板，比如 Gmail（选项 **`2`**），如 [示例 11-13](ch11.xhtml#setting_up_the_site
    "示例 11-13. 设置网站") 所示。SET 现在应该会启动一个 Web 服务器，显示我们的假 Gmail 页面，这是实际 Gmail 页面的克隆。
- en: Example 11-13. Setting up the site
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 示例 11-13. 设置网站
- en: '[PRE14]'
  id: totrans-79
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: Now browse to the cloned Gmail site at the Kali Linux web server and enter some
    credentials to see how this works. After entering credentials you should be redirected
    to the real Gmail site. To a user it will just seem like he typed in his password
    incorrectly. In the meantime, back in SET, you should see a result that looks
    something like [Example 11-14](ch11.xhtml#set_capturing_credentials "Example 11-14. SET
    capturing credentials").
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 现在浏览到克隆的 Gmail 网站，位于 Kali Linux Web 服务器上，并输入一些凭据以查看其工作原理。输入凭据后，你应该会被重定向到真实的
    Gmail 网站。对于用户来说，似乎只是他输入密码时出错了。与此同时，回到 SET 中，你应该看到类似于 [示例 11-14](ch11.xhtml#set_capturing_credentials
    "示例 11-14. SET 捕获凭据") 的结果。
- en: Example 11-14. SET capturing credentials
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 示例 11-14. SET 捕获凭据
- en: '[PRE15]'
  id: totrans-82
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: When the user submits the page, SET highlights the fields that it thinks are
    interesting. In this case, it found the Email ❶ and Passwd ❷ that were submitted.
    Once you shut down the web server with ctrl-C to end the web attack, the results
    should be written to a file.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 当用户提交页面时，SET 会高亮显示它认为感兴趣的字段。在此情况下，它找到了提交的电子邮件 ❶ 和密码 ❷。一旦你通过 ctrl-C 关闭 Web 服务器以结束
    Web 攻击，结果应写入一个文件中。
- en: When combined with the email attack discussed next, this is a great attack to
    use to gather credentials for a pentest or, at the very least, test the security
    awareness of your client’s employees.
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 当与接下来讨论的电子邮件攻击结合使用时，这是一种很好的攻击方式，可以用来收集渗透测试的凭证，或者至少测试客户员工的安全意识。
- en: 'Note that this attack can be even more interesting if you use option **`5`**,
    `Site Cloner`, to make a copy of your customer’s site. If they do not have a page
    with a login form of some sort (VPN, webmail, blogging, and so on) you can even
    create one. Clone their site, and add a simple HTML form like this:'
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，如果使用选项**`5`**，`网站克隆器`，来复制客户的网站，这个攻击会更加有趣。如果他们的网站没有任何登录表单（如 VPN、Webmail、博客等），你甚至可以创建一个。克隆他们的网站，并添加一个简单的
    HTML 表单，如下所示：
- en: '[PRE16]'
  id: totrans-86
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: Then use option **`3`**, `Custom Import`, to have SET serve your modified page.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 然后使用选项**`3`**，`自定义导入`，让 SET 提供你修改后的页面。
- en: Mass Email Attacks
  id: totrans-88
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 批量电子邮件攻击
- en: Now to use SET to automate phishing email attacks. Create a file and enter a
    few email addresses, one per line, as shown here.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 现在使用 SET 来自动化钓鱼邮件攻击。创建一个文件，并按如下方式逐行输入几个电子邮件地址。
- en: '[PRE17]'
  id: totrans-90
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: Now return to the main SET Social-Engineering Attacks menu with option 99 ([Example 11-15](ch11.xhtml#setting_up_an_email_attack
    "Example 11-15. Setting up an email attack")) and choose option **`5`**, `Mass
    Mailer Attack`. Large carbon copy or blind carbon copy lists can trigger spam
    filters or tip off users that something is amiss, and emailing a long list of
    client employees individually by hand can be tedious, so we’ll use SET to email
    multiple addresses (see [Example 11-15](ch11.xhtml#setting_up_an_email_attack
    "Example 11-15. Setting up an email attack")). Scripts are good for repetitive
    tasks like this.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 现在返回主菜单 SET 社会工程攻击菜单，选择选项**`99`**（[示例 11-15](ch11.xhtml#setting_up_an_email_attack
    "示例 11-15. 设置电子邮件攻击")），然后选择选项**`5`**，`批量邮件攻击`。大型的抄送或密送列表可能会触发垃圾邮件过滤器，或者让用户察觉到异常，手动逐个发送给大量客户员工的电子邮件也非常繁琐，因此我们将使用
    SET 来一次性发送多封邮件（参见 [示例 11-15](ch11.xhtml#setting_up_an_email_attack "示例 11-15.
    设置电子邮件攻击")）。脚本在处理此类重复任务时非常有效。
- en: Example 11-15. Setting up an email attack
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 示例 11-15. 设置电子邮件攻击
- en: '[PRE18]'
  id: totrans-93
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: Choose option **`2`** and enter the name of the email address file to import
    ❶.
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 选择选项**`2`**，并输入要导入的电子邮件地址文件名 ❶。
- en: Next we need to choose a server (see [Example 11-16](ch11.xhtml#logging_in_to_gmail
    "Example 11-16. Logging in to Gmail")). Let’s use Gmail again—option **`1`**.
    When prompted, enter your credentials.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们需要选择一个服务器（参见 [示例 11-16](ch11.xhtml#logging_in_to_gmail "示例 11-16. 登录 Gmail")）。我们再使用
    Gmail——选择选项**`1`**。当系统提示时，输入你的凭证。
- en: Example 11-16. Logging in to Gmail
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 示例 11-16. 登录 Gmail
- en: '[PRE19]'
  id: totrans-97
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: You should be asked to create the email to send, as shown in [Example 11-17](ch11.xhtml#sending_the_email
    "Example 11-17. Sending the email").
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 你将被要求创建发送的电子邮件，如[示例 11-17](ch11.xhtml#sending_the_email "示例 11-17. 发送电子邮件")中所示。
- en: Example 11-17. Sending the email
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 示例 11-17. 发送电子邮件
- en: '[PRE20]'
  id: totrans-100
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: When asked whether to make the email plaintext or HTML, choose **`h`** for HTML
    ❶. By using HTML for the email, we’ll be better able to hide the real destination
    of the links in the email behind graphics and such.
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 当被问到是否将电子邮件设置为纯文本或 HTML 时，选择**`h`** 作为 HTML ❶。通过使用 HTML 格式的电子邮件，我们可以更好地隐藏邮件中链接的真实目的地，例如通过图形等方式。
- en: 'Now to enter the text for the email. Because we chose HTML as the email format,
    we can use HTML tags in our email. For example, this code creates a link for the
    recipient to click: `<a href="192.168.20.9">http://www.bulbsecurity.com/webportal</a>`.
    The text displayed indicates that the link goes to *[http://www.bulbsecurity.com/webportal](http://www.bulbsecurity.com/webportal)*,
    but the link will really open 192.168.20.9 in the browser. We control the website
    at 192.168.20.9, so we can put a browser exploit or a phishing attack there. Add
    some text to the email to convince users to click the included link. This is where
    you can be particularly creative. For example, in [Example 11-17](ch11.xhtml#sending_the_email
    "Example 11-17. Sending the email"), we inform the users that a new company portal
    has been added, and they should log in with their domain credentials to check
    it out. On a pentest, a better way to approach this would be to register a variation
    of the company’s domain name (bulb-security.com) or perhaps use a slight misspelling
    (bulbsecurty.com) that is likely to go unnoticed by users and host your social-engineering
    site there.'
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 现在输入邮件的文本。由于我们选择了 HTML 格式的邮件，因此可以在邮件中使用 HTML 标签。例如，以下代码创建了一个链接供收件人点击：`<a href="192.168.20.9">http://www.bulbsecurity.com/webportal</a>`。显示的文本表明该链接指向
    *[http://www.bulbsecurity.com/webportal](http://www.bulbsecurity.com/webportal)*，但实际点击时会在浏览器中打开
    192.168.20.9。我们控制着 192.168.20.9 上的网站，因此可以在那里放置浏览器漏洞或钓鱼攻击。在邮件中加入一些文字，以说服用户点击附带的链接。在这里，你可以特别发挥创意。例如，在
    [示例 11-17](ch11.xhtml#sending_the_email "示例 11-17. 发送邮件") 中，我们通知用户新增了一个公司门户，并建议他们使用域凭据登录查看。在渗透测试中，采用更好的方法是注册一个公司域名的变种（例如
    bulb-security.com），或者使用轻微拼写错误（如 bulbsecurty.com），这样用户不容易察觉，然后将你的社会工程学网站托管在该域名下。
- en: After you finish the email, press ctrl-C to send it. The email will be sent
    to each address in the *emails.txt* file we entered earlier.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 完成邮件后，按下 ctrl-C 发送邮件。邮件将发送到我们之前输入的 *emails.txt* 文件中的每个地址。
- en: 'Recipients will see this email:'
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 收件人将看到此邮件：
- en: All,
  id: totrans-105
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 各位，
- en: ''
  id: totrans-106
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: We are adding a new company web portal. Please go to *[http://www.bulbsecurity.com/webportal](http://www.bulbsecurity.com/webportal)*
    and use your Windows domain credentials to log in.
  id: totrans-107
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 我们正在添加一个新的公司网页门户。请访问 *[http://www.bulbsecurity.com/webportal](http://www.bulbsecurity.com/webportal)*，并使用您的
    Windows 域凭据登录。
- en: ''
  id: totrans-108
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Bulb Security Administrator
  id: totrans-109
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: Bulb 安全管理员
- en: While a security-savvy user should know better than to click links in emails
    that are not from a trusted source, and would know how to verify where a link
    points to before clicking it, not all users are that savvy, and even the savvy
    ones aren’t always paying attention. In fact, I have never launched a social-engineering
    test that failed.
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然具有安全意识的用户应该知道不要点击来自不信任来源的电子邮件中的链接，并且他们会知道在点击之前如何验证链接指向的位置，但并非所有用户都具备这种意识，即使是那些安全意识强的用户也并不总是保持警惕。事实上，我从未进行过一次失败的社会工程学测试。
- en: Multipronged Attacks
  id: totrans-111
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 多重攻击方式
- en: Let’s combine our previous two attacks (credential harvesting and phishing emails)
    to trick employees into submitting their credentials to a pentester-controlled
    site. We’ll use an email attack together with a web attack to send users to our
    attacker-controlled site by tricking them into clicking links in the emails.
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们将之前的两个攻击方式（凭证收集和钓鱼邮件）结合起来，诱使员工将他们的凭证提交到由渗透测试人员控制的网站。我们将通过电子邮件攻击和网页攻击相结合，诱使用户点击邮件中的链接，转到由攻击者控制的网站。
- en: But first we need to change an option in SET’s configuration file. In Kali this
    file is at */usr/share/set/config/set_config*. The option to change is `WEB_ATTACK_EMAIL`,
    which by default is set to `OFF`. Open the `config` file in a text editor and
    change this option to `ON`.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 但在此之前，我们需要更改 SET 配置文件中的一个选项。在 Kali 系统中，此文件位于 */usr/share/set/config/set_config*。需要更改的选项是
    `WEB_ATTACK_EMAIL`，默认设置为 `OFF`。请在文本编辑器中打开 `config` 文件，并将此选项更改为 `ON`。
- en: '[PRE21]'
  id: totrans-114
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: Now try running the Credential Harvesting attack again. Instead of using a template,
    you can clone one of your client’s web pages if they have a login site, such as
    webmail or an employee portal. If the client uses a web page and not a login site,
    use the `Custom Import` option to build your own page that looks like the employee’s
    web page with a login form added.
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 现在再次尝试运行凭证收集攻击。你可以不使用模板，直接克隆客户的登录网页（例如 Webmail 或员工门户），如果客户有这类网站的话。如果客户没有登录网页，则使用
    `Custom Import` 选项构建一个自定义页面，使其看起来像员工的网页，并添加登录表单。
- en: Summary
  id: totrans-116
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 摘要
- en: In this chapter we’ve looked at only a couple of social-engineering attacks
    that we can automate with SET. The scripts for your attacks will change based
    on your clients’ needs. Some clients may have a specific attack scenario in mind,
    or you may find the need to run multiple attacks at once. For instance, you may
    create a multipronged attack where you harvest credentials and the malicious website
    runs a malicious Java applet. In addition to the web-based attacks and malicious
    files we looked at here, SET can create other attacks, such as USB sticks, QR
    codes, and rogue wireless access points.
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们仅看了一些可以通过SET自动化的社会工程学攻击。你的攻击脚本将根据客户的需求而变化。一些客户可能有特定的攻击场景，或者你可能发现需要同时进行多个攻击。例如，你可能会创建一个多管齐下的攻击，其中你收集凭证，而恶意网站运行一个恶意的Java小程序。除了我们在这里讨论的基于网页的攻击和恶意文件，SET还可以创建其他攻击，例如USB闪存驱动器、二维码和恶意无线接入点。
