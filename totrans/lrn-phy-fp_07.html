<html><head></head><body><div id="sbo-rt-content"><h2 class="h2" id="ch6"><span epub:type="pagebreak" id="page_69"/><span class="big">6</span><br/>HIGHER-ORDER FUNCTIONS</h2>&#13;
<div class="image1"><img src="Images/common.jpg" alt="Image" width="189" height="189"/></div>&#13;
<p class="noindent">Higher-order functions are central to functional programming and flow naturally from the idea that functions should be “first-class objects” in a language, with all of the rights and privileges that numbers or lists have. A <em>higher-order function</em> is one that accepts a function as input and/or returns a function as output. Many things we want the computer to do for us find a natural expression as a higher-order function.</p>&#13;
<p class="indent">In this chapter, we’ll first look at higher-order functions that produce functions as output. We’ll see that these higher-order functions can be viewed as having one input, or alternatively, as having multiple inputs. From there, we’ll consider mapping, the idea of applying a function to every element of a list and producing a list of the results. We’ll then show how we can use the higher-order function <span class="literal">iterate</span>, another function that takes a function as input, to do our iteration. After looking at anonymous higher-order functions and operators, we’ll look at predicate-based higher-order functions. Finally, we’ll look in detail at numerical integration, a central tool in physics that has a natural expression as a higher-order function.</p>&#13;
<h3 class="h3" id="ch6lev1"><span epub:type="pagebreak" id="page_70"/>How to Think About Functions with Parameters</h3>&#13;
<p class="noindent">Consider the force of a linear spring with a spring constant <em>k</em>. We usually write this as</p>&#13;
<div class="imagec"><em>F</em><sub>spring</sub> = –<em>kx</em></div>&#13;
<p class="noindent">where the minus sign indicates that the force acts in the direction opposite the displacement.</p>&#13;
<p class="indent">Suppose we wish to write a Haskell function to give the force in Newtons produced by a spring with a spring constant of 5,500 N/m. We could write the following:</p>&#13;
<pre>springForce5500 :: R -&gt; R&#13;
springForce5500 x = -5500 * x</pre>&#13;
<p class="indent">This is a fine function, but it handles only the force produced by a spring with a spring constant of 5500 N/m. It would be nicer to have a function that could handle a spring with any spring constant.</p>&#13;
<p class="indent">Note that as usual, we are using the type synonym</p>&#13;
<pre>type R = Double</pre>&#13;
<p class="noindent">because we like to think of these numbers as real numbers.</p>&#13;
<p class="indent">Now consider the following function:</p>&#13;
<pre>springForce :: R -&gt; R -&gt; R&#13;
springForce k x = -k * x</pre>&#13;
<p class="indent">Because arrows between types associate to the right, <span class="literal">springForce</span>’s type, <span class="literal">R -&gt; R -&gt; R</span>, is equivalent to <span class="literal">R -&gt; (R -&gt; R)</span>, meaning that if we send the <span class="literal">spring</span> <span class="literal">Force</span> function an <span class="literal">R</span> (the spring constant), it will return to us a <em>function</em> with type <span class="literal">R -&gt; R</span>. This latter function wants an <span class="literal">R</span> as input (the displacement) and will give an <span class="literal">R</span> as output (the force).</p>&#13;
<p class="indent">We can look at the types of these functions using GHCi’s :type command (abbreviated <span class="literal">:t</span>):</p>&#13;
<pre>Prelude&gt; <span class="codestrong1">:l HigherOrder.lhs</span>&#13;
[1 of 1] Compiling Main            ( HigherOrder.lhs, interpreted )&#13;
Ok, one module loaded.&#13;
*Main&gt; <span class="codestrong1">:t springForce</span>&#13;
springForce :: R -&gt; R -&gt; R</pre>&#13;
<p class="indent">Next, let’s look at the function <span class="literal">springForce 2200</span>:</p>&#13;
<pre>*Main&gt; <span class="codestrong1">:t springForce 2200</span>&#13;
springForce 2200 :: R -&gt; R</pre>&#13;
<p class="indent">The function <span class="literal">springForce 2200</span> represents the force function (input: displacement, output: force) for a spring with a spring constant of 2200 N/m. It has the same type and plays the same role as the springForce5500 function above. However, it looks funny because it is a function made up of two parts: the springForce part and the 2200 part.</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_71"/>Finally, look at the type of <span class="literal">springForce 2200 0.4</span>:</p>&#13;
<pre>*Main&gt; <span class="codestrong1">:t springForce 2200 0.4</span>&#13;
springForce 2200 0.4 :: R</pre>&#13;
<p class="indent">This is not a function but just a number representing the force exerted by a spring with a spring constant of 2200 N/m when extended by a distance of 0.4 m.</p>&#13;
<p class="indent">A function that takes another function as input or returns another function as a result is called a higher-order function. The function <span class="literal">springForce</span> is a higher-order function because it returns a function as its result. <a href="ch06.xhtml#ch6fig1">Figure 6-1</a> shows that the <span class="literal">springForce</span> function takes a number as input (the spring constant <span class="literal">k :: R</span>) and returns a function as output (<span class="literal">springForce k :: R -&gt; R</span>). The function <span class="literal">springForce k</span> then takes a number as input (the displacement <span class="literal">x :: R</span>) and returns a number as output (the force <span class="literal">springForce k x :: R</span>).</p>&#13;
<div class="imagel" id="ch6fig1"><img src="Images/071fig01.jpg" alt="Image" width="504" height="127"/></div>&#13;
<p class="figcap"><em>Figure 6-1:</em> The higher-order function <span class="codestrongitalic1">springForce</span> takes a number as input and returns the function <span class="codestrongitalic1">springForce k</span> as output. The function <span class="codestrongitalic1">springForce k</span> then takes a number as input and returns a number as output.</p>&#13;
<p class="indent">Higher-order functions give us a convenient way to define a function that takes one or more parameters (like the spring constant) in addition to its “actual” input (like the displacement). <a href="ch06.xhtml#ch6tab1">Table 6-1</a> shows some higher-order functions from the Prelude that return a function as output.</p>&#13;
<p class="tabcap" id="ch6tab1"><strong>Table 6-1:</strong> Some Higher-Order Functions from the Prelude That Produce a Function as Output</p>&#13;
<table class="all">&#13;
<colgroup>&#13;
<col style="width:40%"/>&#13;
<col style="width:20%"/>&#13;
<col style="width:40%"/>&#13;
</colgroup>&#13;
<thead>&#13;
<tr>&#13;
<th style="vertical-align: top;" class="table-h"><p class="taba"><strong>Function</strong></p></th>&#13;
<th style="vertical-align: top;" class="table-h"><p class="taba"><strong> </strong></p></th>&#13;
<th style="vertical-align: top;" class="table-h"><p class="taba"><strong>Type</strong></p></th>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba"><span class="literal">take</span></p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba"><span class="literal">::</span></p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba"><span class="literal">Int -&gt; [a] -&gt; [a]</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba"><span class="literal">drop</span></p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba"><span class="literal">::</span></p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba"><span class="literal">Int -&gt; [a] -&gt; [a]</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1bw_bot"><p class="taba"><span class="literal">replicate</span></p></td>&#13;
<td style="vertical-align: top;" class="table-1bw_bot"><p class="taba"><span class="literal">::</span></p></td>&#13;
<td style="vertical-align: top;" class="table-1bw_bot"><p class="taba"><span class="literal">Int -&gt; a -&gt; [a]</span></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<p class="indent">Consider the higher-order function <span class="literal">take</span>. The <span class="literal">take</span> function produces a list by taking a given number of elements from a given list. <a href="ch06.xhtml#ch6tab2">Table 6-2</a> shows some examples of its use.</p>&#13;
<p class="tabcap" id="ch6tab2"><strong>Table 6-2:</strong> Examples of the Use of take</p>&#13;
<table class="all">&#13;
<colgroup>&#13;
<col style="width:40%"/>&#13;
<col style="width:20%"/>&#13;
<col style="width:40%"/>&#13;
</colgroup>&#13;
<thead>&#13;
<tr>&#13;
<th style="vertical-align: top;" class="table-h"><p class="taba"><strong>Expression</strong></p></th>&#13;
<th style="vertical-align: top;" class="table-h"><p class="taba"><strong> </strong></p></th>&#13;
<th style="vertical-align: top;" class="table-h"><p class="taba"><strong>Evaluates to</strong></p></th>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba"><span class="literal">take 3 [9,7,5,3,17]</span></p></td>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba">⇝</p></td>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba"><span class="literal">[9,7,5]</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba"><span class="literal">take 3 [3,2]</span></p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">⇝</p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba"><span class="literal">[3,2]</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba"><span class="literal">take 4 [1..]</span></p></td>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba">⇝</p></td>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba"><span class="literal">[1,2,3,4]</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1bw_bot"><p class="taba"><span class="literal">take 4 [-10.0,-9.5..10]</span></p></td>&#13;
<td style="vertical-align: top;" class="table-1bw_bot"><p class="taba">⇝</p></td>&#13;
<td style="vertical-align: top;" class="table-1bw_bot"><p class="taba"><span class="literal">[-10.0,-9.5,-9.0,-8.5]</span></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_72"/>Let’s look at the type of <span class="literal">take</span>:</p>&#13;
<pre>*Main&gt; <span class="codestrong1">:t take</span>&#13;
take :: Int -&gt; [a] -&gt; [a]</pre>&#13;
<p class="noindent">According to the type of <span class="literal">take</span>, when given an <span class="literal">Int</span>, it should return a function with type <span class="literal">[a] -&gt; [a]</span>. What function should <span class="literal">take</span> return? If we give the integer <em>n</em> to <span class="literal">take</span>, the returned function will accept a list as input and return a list of the first <em>n</em> elements of the input list.</p>&#13;
<p class="indent">There are two ways to think about the higher-order function <span class="literal">take</span> (and others like it that return a function as output), as shown in <a href="ch06.xhtml#ch6tab3">Table 6-3</a>.</p>&#13;
<p class="tabcap" id="ch6tab3"><strong>Table 6-3:</strong> Two Ways of Thinking About the Higher-Order Function take</p>&#13;
<table class="all">&#13;
<colgroup>&#13;
<col style="width:30%"/>&#13;
<col style="width:30%"/>&#13;
<col style="width:40%"/>&#13;
</colgroup>&#13;
<thead>&#13;
<tr>&#13;
<th style="vertical-align: top;" class="table-h"><p class="taba"><strong>Way of thinking</strong></p></th>&#13;
<th style="vertical-align: top;" class="table-h"><p class="taba"><strong>Input to <span class="literal">take</span></strong></p></th>&#13;
<th style="vertical-align: top;" class="table-h"><p class="taba"><strong>Output from <span class="literal">take</span></strong></p></th>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">One-input thinking</p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba"><span class="literal">Int</span></p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba"><span class="literal">[a] -&gt; [a]</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1bw_bot"><p class="taba">Two-input thinking</p></td>&#13;
<td style="vertical-align: top;" class="table-1bw_bot"><p class="taba"><span class="literal">Int and then [a]</span></p></td>&#13;
<td style="vertical-align: top;" class="table-1bw_bot"><p class="taba"><span class="literal">[a]</span></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<p class="indent">We have already described, with <span class="literal">springForce</span>, the “one-input thinking” in which we read the type signature of <span class="literal">take</span> as expecting a single <span class="literal">Int</span> as input and producing a <span class="literal">[a] -&gt; [a]</span> (read “list of <span class="literal">a</span> to list of <span class="literal">a</span>”) as output. <a href="ch06.xhtml#ch6fig2">Figure 6-2</a> shows the one-input picture of <span class="literal">take</span>.</p>&#13;
<div class="imagel" id="ch6fig2"><img src="Images/072fig01.jpg" alt="Image" width="399" height="126"/></div>&#13;
<p class="figcap"><em>Figure 6-2:</em> One-input thinking about the higher-order function <span class="codestrongitalic1">take</span></p>&#13;
<p class="indent">An alternative way to think about the type signature <span class="literal">Int -&gt; [a] -&gt; [a]</span> is that the function expects two inputs, the first of type <span class="literal">Int</span> and the second of type <span class="literal">[a]</span>, and produces an output of type <span class="literal">[a]</span>. <a href="ch06.xhtml#ch6fig3">Figure 6-3</a> shows the two-input picture of <span class="literal">take</span>.</p>&#13;
<div class="imagel" id="ch6fig3"><img src="Images/072fig02.jpg" alt="Image" width="363" height="120"/></div>&#13;
<p class="figcap"><em>Figure 6-3:</em> Two-input thinking about the higher-order function <span class="codestrongitalic1">take</span></p>&#13;
<p class="indent">As readers and writers of higher-order functions, we have a choice in how to think about them. Sometimes it is convenient to think of a higher-order function as accepting multiple inputs, but it can also be <span epub:type="pagebreak" id="page_73"/>very useful to think of every function, higher-order functions included, as accepting exactly one input. The Haskell compiler regards every function as having exactly one input.</p>&#13;
<p class="indent">Like <span class="literal">take</span>, the higher-order function <span class="literal">drop</span> is another everyday tool for working with lists. The function <span class="literal">drop</span> produces a list by discarding a given number of elements from a given list. <a href="ch06.xhtml#ch6tab4">Table 6-4</a> shows some examples of its use.</p>&#13;
<p class="tabcap" id="ch6tab4"><strong>Table 6-4:</strong> Examples of the Use of drop</p>&#13;
<table class="all">&#13;
<colgroup>&#13;
<col style="width:40%"/>&#13;
<col style="width:20%"/>&#13;
<col style="width:40%"/>&#13;
</colgroup>&#13;
<thead>&#13;
<tr>&#13;
<th style="vertical-align: top;" class="table-h"><p class="taba"><strong>Expression</strong></p></th>&#13;
<th style="vertical-align: top;" class="table-h"><p class="taba"><strong> </strong></p></th>&#13;
<th style="vertical-align: top;" class="table-h"><p class="taba"><strong>Evaluates to</strong></p></th>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba"><span class="literal">drop 3 [9,7,5,10,17]</span></p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">⇝</p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba"><span class="literal">[10,17]</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba"><span class="literal">drop 3 [4,2]</span></p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">⇝</p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba"><span class="literal">[]</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1bw_bot"><p class="taba"><span class="literal">drop 37 [-10.0,-9.5..10]</span></p></td>&#13;
<td style="vertical-align: top;" class="table-1bw_bot"><p class="taba">⇝</p></td>&#13;
<td style="vertical-align: top;" class="table-1bw_bot"><p class="taba"><span class="literal">[8.5,9.0,9.5,10.0]</span></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<p class="indent">The function <span class="literal">replicate</span> produces a list by repeating one item a given number of times. <a href="ch06.xhtml#ch6tab5">Table 6-5</a> shows some examples of its use.</p>&#13;
<p class="tabcap" id="ch6tab5"><strong>Table 6-5:</strong> Examples of the Use of replicate</p>&#13;
<table class="all">&#13;
<colgroup>&#13;
<col style="width:40%"/>&#13;
<col style="width:20%"/>&#13;
<col style="width:40%"/>&#13;
</colgroup>&#13;
<thead>&#13;
<tr>&#13;
<th style="vertical-align: top;" class="table-h"><p class="taba"><strong>Expression</strong></p></th>&#13;
<th style="vertical-align: top;" class="table-h"><p class="taba"><strong> </strong></p></th>&#13;
<th style="vertical-align: top;" class="table-h"><p class="taba"><strong>Evaluates to</strong></p></th>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba"><span class="literal">replicate 2 False</span></p></td>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba">⇝</p></td>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba"><span class="literal">[False,False]</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba"><span class="literal">replicate 3 "ho"</span></p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">⇝</p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba"><span class="literal">["ho","ho","ho"]</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba"><span class="literal">replicate 4 5</span></p></td>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba">⇝</p></td>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba"><span class="literal">[5,5,5,5]</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1bw_bot"><p class="taba"><span class="literal">replicate 3 'x'</span></p></td>&#13;
<td style="vertical-align: top;" class="table-1bw_bot"><p class="taba">⇝</p></td>&#13;
<td style="vertical-align: top;" class="table-1bw_bot"><p class="taba"><span class="literal">"xxx"</span></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<p class="indent">In this section, we’ve focused on higher-order functions that return functions as output. Now let’s take a look at a higher-order function that takes a function as input.</p>&#13;
<h3 class="h3" id="ch6lev2">Mapping a Function Over a List</h3>&#13;
<p class="noindent"><a href="ch06.xhtml#ch6tab6">Table 6-6</a> shows some higher-order Prelude functions that take other functions as input.</p>&#13;
<p class="tabcap" id="ch6tab6"><strong>Table 6-6:</strong> Some Higher-Order Functions from the Prelude That Accept a Function as Input</p>&#13;
<table class="all">&#13;
<colgroup>&#13;
<col style="width:40%"/>&#13;
<col style="width:20%"/>&#13;
<col style="width:40%"/>&#13;
</colgroup>&#13;
<thead>&#13;
<tr>&#13;
<th style="vertical-align: top;" class="table-h"><p class="taba"><strong>Function</strong></p></th>&#13;
<th style="vertical-align: top;" class="table-h"><p class="taba"><strong> </strong></p></th>&#13;
<th style="vertical-align: top;" class="table-h"><p class="taba"><strong>Type</strong></p></th>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba"><span class="literal">map</span></p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba"><span class="literal">::</span></p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba"><span class="literal">(a -&gt; b) -&gt; [a] -&gt; [b]</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba"><span class="literal">iterate</span></p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba"><span class="literal">::</span></p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba"><span class="literal">(a -&gt; a) -&gt; a -&gt; [a]</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1bw_bot"><p class="taba"><span class="literal">flip</span></p></td>&#13;
<td style="vertical-align: top;" class="table-1bw_bot"><p class="taba"><span class="literal">::</span></p></td>&#13;
<td style="vertical-align: top;" class="table-1bw_bot"><p class="taba"><span class="literal">(a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c</span></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<p class="indent">The Prelude function <span class="literal">map</span> is a nice example of a higher-order function that takes another function as input. The function <span class="literal">map</span> will apply the function you give to every element of the list you give. <a href="ch06.xhtml#ch6tab7">Table 6-7</a> shows some examples of the use of <span class="literal">map</span>.</p>&#13;
<p class="tabcap" id="ch6tab7"><strong>Table 6-7:</strong> Examples of the Use of map</p>&#13;
<table class="all">&#13;
<colgroup>&#13;
<col style="width:40%"/>&#13;
<col style="width:20%"/>&#13;
<col style="width:40%"/>&#13;
</colgroup>&#13;
<thead>&#13;
<tr>&#13;
<th style="vertical-align: top;" class="table-h"><p class="taba"><strong>Expression</strong></p></th>&#13;
<th style="vertical-align: top;" class="table-h"><p class="taba"><strong> </strong></p></th>&#13;
<th style="vertical-align: top;" class="table-h"><p class="taba"><strong>Evaluates to</strong></p></th>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba"><span class="literal">map sqrt [1,4,9]</span></p></td>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba">⇝</p></td>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba"><span class="literal">[1.0,2.0,3.0]</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba"><span class="literal">map length ["Four","score","and"]</span></p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">⇝</p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba"><span class="literal">[4,5,3]</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba"><span class="literal">map (logBase 2) [1,64,1024]</span></p></td>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba">⇝</p></td>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba"><span class="literal">[0.0,6.0,10.0]</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1bw_bot"><p class="taba"><span class="literal">map reverse ["Four","score"]</span></p></td>&#13;
<td style="vertical-align: top;" class="table-1bw_bot"><p class="taba">⇝</p></td>&#13;
<td style="vertical-align: top;" class="table-1bw_bot"><p class="taba"><span class="literal">["ruoF","erocs"]</span></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_74"/>In the first example listed in <a href="ch06.xhtml#ch6tab7">Table 6-7</a>, we say that the function <span class="literal">sqrt</span> gets “mapped” over the list, meaning that it gets applied to each element of the list.</p>&#13;
<p class="indent">Note that the parentheses around the function type <span class="literal">a -&gt; b</span> in the type signature for <span class="literal">map</span> are essential. The type <span class="literal">a -&gt; b -&gt; [a] -&gt; [b]</span>, in which no parentheses appear, is an entirely different type. This latter type would take as input a value of type <span class="literal">a</span>, a value of type <span class="literal">b</span>, and a list of type <span class="literal">[a]</span> and produce a list of type <span class="literal">[b]</span> as output. This latter type is short for <span class="literal">a -&gt; (b -&gt; ([a] -&gt; [b]))</span> because arrows associate to the right.</p>&#13;
<p class="indent">A list comprehension can do the work of <span class="literal">map</span>. Whether you choose <span class="literal">map</span> or a list comprehension is a matter of style.</p>&#13;
<pre>*Main&gt; <span class="codestrong1">map sqrt [1,4,9]</span>&#13;
[1.0,2.0,3.0]&#13;
*Main&gt; <span class="codestrong1">[sqrt x | x &lt;- [1,4,9]]</span>&#13;
[1.0,2.0,3.0]</pre>&#13;
<p class="indent">The idea of mapping a function over a structure actually extends past the structure of a list to other structures like trees. Haskell has a function <span class="literal">fmap</span> for this, although we will not have occasion to use it in this book.</p>&#13;
<h3 class="h3" id="ch6lev3">Iteration and Recursion</h3>&#13;
<p class="noindent">Iteration is an essential feature in any programming language. The ability to do things over and over again is one of the chief sources of power that computers have. How do people express the idea of iteration in a programming language?</p>&#13;
<p class="indent">Imperative programming languages provide ways to write <em>loops</em>, which are instructions to do something over and over, either a fixed number of times or until some condition is reached.</p>&#13;
<p class="indent">Functional programming languages have a different way to express iteration. The most popular way to achieve iteration among functional programmers is to write <em>recursive functions</em>, that is, functions that call themselves. Recursive functions are very powerful, but it takes a person approaching recursive functions for the first time some time and effort to comprehend how to write them.</p>&#13;
<p class="indent">The Haskell Prelude has many built-in recursive functions that we can use without needing to write our own explicitly. In this book, we’ll avoid <span epub:type="pagebreak" id="page_75"/>writing <em>explicitly</em> recursive functions, meaning that you can see from the function definition that the function calls itself. We will write functions using the built-in recursive functions from the Prelude, and these functions that we write may legitimately be called recursive because their behavior is recursive in that something is calling itself under the hood. However, the functions we write are not <em>explicitly</em> recursive because they will not call themselves.</p>&#13;
<p class="indent">We can understand and explain most of the recursive functions in the Prelude by their behavior through examples without needing to understand how they achieve this behavior through the power of recursion. Recursion is certainly very interesting, and I encourage you to look into it if you have the time. I learned recursion from <em>The Little Schemer</em> [<strong><a href="bib.xhtml#bib4"><span class="green">4</span></a></strong>], a book using the Scheme language that I enthusiastically recommend. The book <em>Learn You a Haskell for Great Good!</em> [<strong><a href="bib.xhtml#bib1"><span class="green">1</span></a></strong>], deals with recursion in its <a href="ch04.xhtml">Chapter 4</a>, showing how to write Prelude functions like <span class="literal">take</span>, <span class="literal">reverse</span>, <span class="literal">replicate</span>, and <span class="literal">repeat</span>.</p>&#13;
<p class="indent">How will we achieve iteration in Haskell without writing explicitly recursive functions? We’ll use the Prelude function <span class="literal">iterate</span>. Rather than thinking imperatively about what we want the computer to <em>do</em>, we will think functionally about what we want to <em>have</em> and arrange to have these things in a list. “Lists instead of loops” is the functional programming slogan we might apply here.</p>&#13;
<p class="indent">The Prelude function <span class="literal">iterate</span>, whose type is given in <a href="ch06.xhtml#ch6tab6">Table 6-6</a>, is a higher-order function that takes a function as input. Iteration and the <span class="literal">iterate</span> function will be important when we solve Newton’s second law in <a href="part02.xhtml">Part II</a>. The function <span class="literal">iterate</span> produces an infinite list as follows: if <span class="literal">f :: a -&gt; a</span> and <span class="literal">x :: a</span> (read “<span class="literal">f</span> has type <span class="literal">a</span> to <span class="literal">a</span>” and “<span class="literal">x</span> has type <span class="literal">a</span>”), then <span class="literal">iterate f x</span> produces this infinite list:</p>&#13;
<pre>[x, f x, f (f x), f (f (f x)), ...]</pre>&#13;
<p class="indent">In other words, the result is a list with <span class="literal">f</span> applied zero times, once, twice, three times, and so on. <a href="ch06.xhtml#ch6tab8">Table 6-8</a> shows some examples of the use of <span class="literal">iterate</span>.</p>&#13;
<p class="tabcap" id="ch6tab8"><strong>Table 6-8:</strong> Examples of the Use of iterate</p>&#13;
<table class="all">&#13;
<colgroup>&#13;
<col style="width:40%"/>&#13;
<col style="width:20%"/>&#13;
<col style="width:40%"/>&#13;
</colgroup>&#13;
<thead>&#13;
<tr>&#13;
<th style="vertical-align: top;" class="table-h"><p class="taba"><strong>Expression</strong></p></th>&#13;
<th style="vertical-align: top;" class="table-h"><p class="taba"> </p></th>&#13;
<th style="vertical-align: top;" class="table-h"><p class="taba"><strong>Evaluates to</strong></p></th>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba"><span class="literal">iterate (\n -&gt; 2*n) 1</span></p></td>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba">⇝</p></td>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba"><span class="literal">[1,2,4,8,...]</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba"><span class="literal">iterate (\n -&gt; n*n) 1</span></p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">⇝</p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba"><span class="literal">[1,1,1,1,...]</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba"><span class="literal">iterate (\n -&gt; n*n) 2</span></p></td>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba">⇝</p></td>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba"><span class="literal">[2,4,16,256,...]</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1bw_bot"><p class="taba"><span class="literal">iterate (\v -&gt; v - 9.8*0.1) 4</span></p></td>&#13;
<td style="vertical-align: top;" class="table-1bw_bot"><p class="taba">⇝</p></td>&#13;
<td style="vertical-align: top;" class="table-1bw_bot"><p class="taba"><span class="literal">[4.0,3.02,2.04,1.06,...]</span></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<p class="indent"><a href="ch06.xhtml#ch6fig4">Figure 6-4</a> shows how iterate f applies the function f to its input zero times, one time, two times, and so on, and collects the results in a list.</p>&#13;
<div class="imagel" id="ch6fig4"><span epub:type="pagebreak" id="page_76"/><img src="Images/076fig01.jpg" alt="Image" width="519" height="305"/></div>&#13;
<p class="figcap"><em>Figure 6-4: The function <span class="codestrongitalic1">iterate f</span> applies the function <span class="codestrongitalic1">f</span> to the input zero, one, two, three, and more times and collects the results in an infinite list.</em></p>&#13;
<h3 class="h3" id="ch6lev4">Anonymous Higher-Order Functions</h3>&#13;
<p class="noindent">In <a href="ch02.xhtml">Chapter 2</a>, we discussed anonymous functions as a way to describe a function without giving it a name. We can do the same thing for higher-order functions, describing them without giving them a name.</p>&#13;
<p class="indent">Let’s return to the function <span class="literal">springForce</span> discussed earlier. How could we write <span class="literal">springForce</span> without naming it? There are actually two ways to write this function as an anonymous function, corresponding to the one-input thinking and two-input thinking we described in “How to Think About Functions with Parameters.” In one-input thinking, we regard the input to <span class="literal">springForce</span> as being a number (<span class="literal">R</span>) and the output as being a function <span class="literal">R -&gt; R</span>. The anonymous function for one-input thinking is shown in the first row of <a href="ch06.xhtml#ch6tab9">Table 6-9</a>. We can see from the form of that function that it returns a function, namely <span class="literal">\x -&gt; -k*x</span>.</p>&#13;
<p class="tabcap" id="ch6tab9"><strong>Table 6-9:</strong> Two Ways of Writing the springForce Function as an Anonymous Function</p>&#13;
<table class="all">&#13;
<colgroup>&#13;
<col style="width:40%"/>&#13;
<col style="width:40%"/>&#13;
</colgroup>&#13;
<thead>&#13;
<tr>&#13;
<th style="vertical-align: top;" class="table-h"><p class="taba"><strong>Way of thinking</strong></p></th>&#13;
<th style="vertical-align: top;" class="table-h"><p class="taba"><strong>Anonymous function</strong></p></th>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">One-input thinking</p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba"><span class="literal">\k -&gt; \x -&gt; -k*x</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1bw_bot"><p class="taba">Two-input thinking</p></td>&#13;
<td style="vertical-align: top;" class="table-1bw_bot"><p class="taba"><span class="literal">\k x -&gt; -k*x</span></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<p class="indent">In two-input thinking, we regard the inputs to <span class="literal">springForce</span> as an <span class="literal">R</span> for the spring constant and a second <span class="literal">R</span> for the position and the output as being simply an <span class="literal">R</span>. The anonymous function for two-input thinking is shown in the second row of <a href="ch06.xhtml#ch6tab9">Table 6-9</a>. The form of the anonymous function shows us that it returns a number. Either form is completely legitimate. In fact, the two forms describe the same function.</p>&#13;
<h3 class="h3" id="ch6lev5"><span epub:type="pagebreak" id="page_77"/>Operators as Higher-Order Functions</h3>&#13;
<p class="noindent">In <a href="ch01.xhtml">Chapter 1</a>, we introduced several infix operators in <a href="ch01.xhtml#ch1tab2">Table 1-2</a>. Any infix operator can be converted into a higher-order function by enclosing it in parentheses. <a href="ch06.xhtml#ch6tab10">Table 6-10</a> shows examples of how infix operators may be written as higher-order functions.</p>&#13;
<p class="tabcap" id="ch6tab10"><strong>Table 6-10:</strong> Infix Operators Transformed into Prefix Functions by Enclosing in Parentheses</p>&#13;
<table class="all">&#13;
<colgroup>&#13;
<col style="width:50%"/>&#13;
<col style="width:50%"/>&#13;
</colgroup>&#13;
<thead>&#13;
<tr>&#13;
<th style="vertical-align: top;" class="table-h"><p class="taba"><strong>Infix expression</strong></p></th>&#13;
<th style="vertical-align: top;" class="table-h"><p class="taba"><strong>Equivalent prefix expression</strong></p></th>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba"><span class="literal">f . g</span></p></td>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba"><span class="literal">(.) f g</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba"><span class="literal">'A':"moral"</span></p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba"><span class="literal">(:) 'A' "moral"</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba"><span class="literal">[3,9] ++ [6,7]</span></p></td>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba"><span class="literal">(++) [3,9] [6,7]</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba"><span class="literal">True &amp;&amp; False</span></p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba"><span class="literal">(&amp;&amp;) True False</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1b_bot"><p class="taba"><span class="literal">log . sqrt $ 10</span></p></td>&#13;
<td style="vertical-align: top;" class="table-1b_bot"><p class="taba"><span class="literal">($) (log . sqrt) 10</span></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<p class="indent"><a href="ch06.xhtml#ch6tab11">Table 6-11</a> shows the types of some higher-order functions obtained from operators. If you want to ask GHCi for the type of an operator, you must enclose the operator in parentheses when using the GHCi <span class="literal">:t</span> command.</p>&#13;
<p class="tabcap" id="ch6tab11"><strong>Table 6-11:</strong> Infix Operators Viewed as Higher-Order Functions</p>&#13;
<table class="all">&#13;
<colgroup>&#13;
<col style="width:40%"/>&#13;
<col style="width:20%"/>&#13;
<col style="width:40%"/>&#13;
</colgroup>&#13;
<thead>&#13;
<tr>&#13;
<th style="vertical-align: top;" class="table-h"><p class="taba"><strong>Function</strong></p></th>&#13;
<th style="vertical-align: top;" class="table-h"><p class="taba"> </p></th>&#13;
<th style="vertical-align: top;" class="table-h"><p class="taba"><strong>Type</strong></p></th>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba"><span class="literal">(.)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba"><span class="literal">::</span></p></td>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba"><span class="literal">(b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba"><span class="literal">(:)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba"><span class="literal">::</span></p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba"><span class="literal">a -&gt; [a] -&gt; [a]</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba"><span class="literal">(++)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba"><span class="literal">::</span></p></td>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba"><span class="literal">[a] -&gt; [a] -&gt; [a]</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba"><span class="literal">(&amp;&amp;)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba"><span class="literal">::</span></p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba"><span class="literal">Bool -&gt; Bool -&gt; Bool</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba"><span class="literal">(||)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba"><span class="literal">::</span></p></td>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba"><span class="literal">Bool -&gt; Bool -&gt; Bool</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1bw_bot"><p class="taba"><span class="literal">($)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-1bw_bot"><p class="taba"><span class="literal">::</span></p></td>&#13;
<td style="vertical-align: top;" class="table-1bw_bot"><p class="taba"><span class="literal">(a -&gt; b) -&gt; a -&gt; b</span></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<p class="indent">In <a href="ch05.xhtml">Chapter 5</a>, we discussed a type error that occurred when trying to concatenate lists with different types. Now that we know the type of <span class="literal">(++)</span>, we are in a better position to understand type errors more generally. A type error comes from trying to apply a function that expects input of one type to an expression that actually has a different type. When we apply the concatenation function <span class="literal">(++)</span> to the expression <span class="literal">physicists</span>,</p>&#13;
<pre>physicists :: [String]&#13;
physicists = ["Einstein","Newton","Maxwell"]</pre>&#13;
<p class="noindent">we obtain a function <span class="literal">(++) physicists</span>, which has type <span class="literal">[String] -&gt; [String]</span>:</p>&#13;
<pre>*Main&gt; <span class="codestrong1">:t (++)</span>&#13;
(++) :: [a] -&gt; [a] -&gt; [a]&#13;
*Main&gt; <span class="codestrong1">:t physicists</span>&#13;
&#13;
physicists :: [String]&#13;
*Main&gt; <span class="codestrong1">:t (++) physicists</span>&#13;
(++) physicists :: [String] -&gt; [String]</pre>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_78"/>The concatenation function accepts a list of any type <span class="literal">a</span>. When given a list of strings, the concrete type <span class="literal">String</span> is substituted for all occurrences of the type variable <span class="literal">a</span> so that the function <span class="literal">(++) physicists</span> has type <span class="literal">[String] -&gt; [String]</span>. This function <span class="literal">(++) physicists</span> expects an input with type <span class="literal">[String]</span>, so if we give it something with a different type instead, we get a type error.</p>&#13;
<pre>velocities :: [R]&#13;
velocities = [0,-9.8,-19.6,-29.4]</pre>&#13;
<p class="indent">In GHCi, we get:</p>&#13;
<pre>*Main&gt; <span class="codestrong1">:t (++) physicists velocities</span>&#13;
&#13;
&lt;interactive&gt;:1:17: error:&#13;
    • Couldn't match type Double with [Char]&#13;
      Expected type: [String]&#13;
        Actual type: [R]&#13;
    • In the second argument of (++), namely velocities&#13;
      In the expression: (++) physicists velocities</pre>&#13;
<p class="indent">The “Expected type” <span class="literal">[String]</span> is the type expected as input by the function <span class="literal">(++) physicists</span>, while the “Actual type” <span class="literal">[R]</span> is the type of the list <span class="literal">velocities</span>.</p>&#13;
<p class="indent">A class of functions and operators known as <em>combinators</em> that can be thought of as standard connectors can make it easier to use higher-order functions. We turn to these next.</p>&#13;
<h3 class="h3" id="ch6lev6">Combinators</h3>&#13;
<p class="noindent">Combinators, in the broad sense of the term, are functions that combine things. They are often functions that have very general applicability, and their types show this by being full of type variables. They tend not to be specific to numbers, lists, Booleans, or any particular basic type. They are standard plumbing fixtures that make it easier to work with and connect higher-order functions. <a href="ch06.xhtml#ch6tab12">Table 6-12</a> gives a short list of Haskell functions that are considered to be combinators.</p>&#13;
<p class="tabcap" id="ch6tab12"><strong>Table 6-12:</strong> Some Haskell Functions Regarded as Combinators</p>&#13;
<table class="all">&#13;
<colgroup>&#13;
<col style="width:40%"/>&#13;
<col style="width:20%"/>&#13;
<col style="width:40%"/>&#13;
</colgroup>&#13;
<thead>&#13;
<tr>&#13;
<th style="vertical-align: top;" class="table-h"><p class="taba"><strong>Function</strong></p></th>&#13;
<th style="vertical-align: top;" class="table-h"><p class="taba"><strong> </strong></p></th>&#13;
<th style="vertical-align: top;" class="table-h"><p class="taba"><strong>Type</strong></p></th>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba"><span class="literal">id</span></p></td>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba"><span class="literal">::</span></p></td>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba"><span class="literal">a -&gt; a</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba"><span class="literal">const</span></p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba"><span class="literal">::</span></p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba"><span class="literal">a -&gt; b -&gt; a</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba"><span class="literal">flip</span></p></td>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba"><span class="literal">::</span></p></td>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba"><span class="literal">(a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba"><span class="literal">(.)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba"><span class="literal">::</span></p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba"><span class="literal">(b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1b_bot"><p class="taba"><span class="literal">($)</span></p></td>&#13;
<td style="vertical-align: top;" class="table-1b_bot"><p class="taba"><span class="literal">::</span></p></td>&#13;
<td style="vertical-align: top;" class="table-1b_bot"><p class="taba"><span class="literal">(a -&gt; b) -&gt; a -&gt; b</span></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_79"/>The identity function <span class="literal">id</span> seems at first to be a silly function, because when I apply it to some value, I get that same value back. So what purpose does the identity function serve? The relevance of the identity function, like the anonymous functions we studied in <a href="ch02.xhtml">Chapter 2</a>, lies in its use as an input to a higher-order function. In <a href="ch22.xhtml">Chapter 22</a>, we will write a higher-order function to display vector fields. One of the inputs to this function will be a scaling function that accepts one number and returns another. The most trivial scaling is achieved by using the identity function, which leaves every input unchanged. The higher-order function requires <em>some</em> scaling function to be given, and the identity function <span class="literal">id</span> can be given when no scaling is desired.</p>&#13;
<p class="indent">The combinator <span class="literal">const</span> turns a value into a constant function that returns that value. For example, <span class="literal">const 3</span> is the function that returns <span class="literal">3</span> regardless of its input. So, <span class="literal">const 3 7</span> evaluates to <span class="literal">3</span>, <span class="literal">const 3 5</span> evaluates to <span class="literal">3</span>, and <span class="literal">const 3 "Hi"</span> evaluates to <span class="literal">3</span>. In <a href="ch14.xhtml">Chapter 14</a>, we will write a function to solve mechanics problems that takes a list of forces as input. The forces are functions that depend on inputs like velocity, so if we want to specify a constant force, we can use the <span class="literal">const</span> combinator. In <a href="ch23.xhtml">Chapter 23</a>, we will write surfaces like hemispheres and spheres. Our surfaces will be specified with two parameters that take values over some range. The limits for the parameters are allowed to be functions, so we can write, for example, a triangular surface. If we want a constant function, again we can use <span class="literal">const</span>.</p>&#13;
<p class="indent">The <span class="literal">flip</span> combinator takes a higher-order function and exchanges the positions of its inputs. It is often used in conjunction with point-free style. For example, the exponentiation function <span class="literal">(**)</span> takes two inputs: the base and the exponent. If we provide the first input but not the second, as in <span class="literal">(**) 2</span>, we get the “two to the power of” function. What if we want the function that cubes its input? We would need to fix the second input of <span class="literal">(**)</span> at <span class="literal">3</span> while leaving the first open to be the input to the cubing function. We could do this with an anonymous function, as <span class="literal">\x -&gt; x ** 3</span>. We could also do it with flip, as <span class="literal">flip (**) 3</span>. Either of these is an expression for the cubing function.</p>&#13;
<p class="indent">The composition combinator was listed in <a href="ch01.xhtml#ch1tab2">Table 1-2</a> and discussed in <a href="ch02.xhtml">Chapter 2</a>. We will use it in <a href="ch16.xhtml">Chapter 16</a> when we solve mechanics problems by passing information through a sequence of functions. The full solution is given as a composition of the functions in the sequence.</p>&#13;
<p class="indent">The function application combinator was listed in <a href="ch01.xhtml#ch1tab2">Table 1-2</a> and discussed in <a href="ch01.xhtml">Chapter 1</a> . It seems like a silly and useless operator until we realize that its precedence allows it to act like parentheses.</p>&#13;
<p class="indent">The next section discusses a class of higher-order functions used to classify data.</p>&#13;
<h3 class="h3" id="ch6lev7">Predicate-Based Higher-Order Functions</h3>&#13;
<p class="noindent">A <em>predicate</em> is a function with type <span class="literal">a -&gt; Bool</span>, where <span class="literal">a</span> is any valid Haskell type. (For example, <span class="literal">a</span> could be a concrete type like <span class="literal">Int</span> or <span class="literal">R -&gt; R</span>, a type variable <span epub:type="pagebreak" id="page_80"/>like <span class="literal">a</span>, or a type that contains type variables like <span class="literal">[a]</span> or even <span class="literal">a -&gt; [b]</span>.) A predicate expresses a property that an element of type <span class="literal">a</span> may or may not have. For example, the property of an integer being greater than or equal to 7 is a predicate. We can define such a predicate in Haskell.</p>&#13;
<pre>greaterThanOrEq7 :: Int -&gt; Bool&#13;
greaterThanOrEq7 n = if n &gt;= 7 then True else False</pre>&#13;
<p class="indent"><a href="ch06.xhtml#ch6tab13">Table 6-13</a> shows a few higher-order functions that take a predicate as the first argument.</p>&#13;
<p class="tabcap" id="ch6tab13"><strong>Table 6-13:</strong> Some Predicate-Based Higher-Order Functions from the Prelude</p>&#13;
<table class="all">&#13;
<colgroup>&#13;
<col style="width:40%"/>&#13;
<col style="width:20%"/>&#13;
<col style="width:40%"/>&#13;
</colgroup>&#13;
<thead>&#13;
<tr>&#13;
<th style="vertical-align: top;" class="table-h"><p class="taba"><strong>Function</strong></p></th>&#13;
<th style="vertical-align: top;" class="table-h"><p class="taba"> </p></th>&#13;
<th style="vertical-align: top;" class="table-h"><p class="taba"><strong>Type</strong></p></th>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba"><span class="literal">filter</span></p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba"><span class="literal">::</span></p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba"><span class="literal">(a -&gt; Bool) -&gt; [a] -&gt; [a]</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba"><span class="literal">takeWhile</span></p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba"><span class="literal">::</span></p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba"><span class="literal">(a -&gt; Bool) -&gt; [a] -&gt; [a]</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1bw_bot"><p class="taba"><span class="literal">dropWhile</span></p></td>&#13;
<td style="vertical-align: top;" class="table-1bw_bot"><p class="taba"><span class="literal">::</span></p></td>&#13;
<td style="vertical-align: top;" class="table-1bw_bot"><p class="taba"><span class="literal">(a -&gt; Bool) -&gt; [a] -&gt; [a]</span></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<p class="indent">Let’s examine the use of these functions. Suppose we define the following “less than 10” predicate:</p>&#13;
<pre>lt10 :: Int -&gt; Bool&#13;
lt10 n = n &lt; 10</pre>&#13;
<p class="indent"><a href="ch06.xhtml#ch6tab14">Table 6-14</a> shows examples of how to use the higher-order functions in <a href="ch06.xhtml#ch6tab13">Table 6-13</a>.</p>&#13;
<p class="tabcap" id="ch6tab14"><strong>Table 6-14:</strong> Examples of the Use of Some Predicate-Based Higher-Order Functions</p>&#13;
<table class="all">&#13;
<colgroup>&#13;
<col style="width:40%"/>&#13;
<col style="width:20%"/>&#13;
<col style="width:40%"/>&#13;
</colgroup>&#13;
<thead>&#13;
<tr>&#13;
<th style="vertical-align: top;" class="table-h"><p class="taba"><strong>Expression</strong></p></th>&#13;
<th style="vertical-align: top;" class="table-h"><p class="taba"><strong> </strong></p></th>&#13;
<th style="vertical-align: top;" class="table-h"><p class="taba"><strong>Evaluates to</strong></p></th>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba"><span class="literal">filter lt10 [6,4,8,13,7]</span></p></td>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba">⇝</p></td>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba"><span class="literal">[6,4,8,7]</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba"><span class="literal">takeWhile lt10 [6,4,8,13,7]</span></p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">⇝</p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba"><span class="literal">[6,4,8]</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba"><span class="literal">dropWhile lt10 [6,4,8,13,7]</span></p></td>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba">⇝</p></td>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba"><span class="literal">[13,7]</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba"><span class="literal">any lt10 [6,4,8,13,7]</span></p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">⇝</p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba"><span class="literal">True</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1b_bot"><p class="taba"><span class="literal">all lt10 [6,4,8,13,7]</span></p></td>&#13;
<td style="vertical-align: top;" class="table-1b_bot"><p class="taba">⇝</p></td>&#13;
<td style="vertical-align: top;" class="table-1b_bot"><p class="taba"><span class="literal">False</span></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<p class="indent">Let’s go through the functions in this table. The <span class="literal">filter</span> function returns all elements in a list that satisfy the predicate, regardless of where they occur in the list. The <span class="literal">takeWhile</span> function returns elements of a list that satisfy the predicate <em>until</em> it finds one that fails to satisfy the predicate, and it returns the initial list of satisfying elements. Elements in the input list that occur after the first non-satisfying element are not even considered for inclusion in the result list. The <span class="literal">dropWhile</span> function returns a list that begins with the first non-satisfying element of the input list and includes every element from that point on, regardless of whether it satisfies the predicate. The <span class="literal">any</span> function returns <span class="literal">True</span> if one or more elements of the input list satisfy the predicate and returns <span class="literal">False</span> otherwise. The <span class="literal">all</span> function returns <span class="literal">True</span> if all elements of the input list satisfy the predicate, and it returns <span class="literal">False</span> otherwise.</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_81"/>A list comprehension can also do the work of <span class="literal">filter</span>.</p>&#13;
<pre>*Main&gt; filter lt10 [6,4,8,13,7]&#13;
[6,4,8,7]&#13;
*Main&gt;  <span class="codestrong1">[x | x &lt;- [6,4,8,13,7], x &lt; 10]</span>&#13;
[6,4,8,7]</pre>&#13;
<p class="indent">To filter a list using a list comprehension, include a Boolean expression (<span class="literal">x &lt; 10</span> in the example above) after a comma on the right side of the list comprehension. Such an expression is called a <em>guard</em>. Only terms that satisfy the Boolean guard will be included in the resulting list.</p>&#13;
<h3 class="h3" id="ch6lev8">Numerical Integration</h3>&#13;
<p class="noindent">Acceleration is the rate at which velocity changes. If we know how velocity depends on time, we can use a derivative to find acceleration, as we did in <a href="ch04.xhtml">Chapter 4</a>. What about the converse problem? What if we know how acceleration depends on time and we want to know velocity? This is the purpose of integration in calculus. Integrating is the opposite of differentiating (or taking the derivative); this claim is the content of the fundamental theorem of calculus.</p>&#13;
<h4 class="h4" id="ch6lev9">Introducing Integrators</h4>&#13;
<p class="noindent">If <em>a</em>(<em>t</em>) is the acceleration of an object at time <em>t</em>, the velocity <em>v</em>(<em>t</em>) of the object can be found by integrating</p>&#13;
<div class="imagec"><img src="Images/081equ01.jpg" alt="Image" width="445" height="51"/></div>&#13;
<p class="noindent">where <em>v</em>(0) is the velocity of the object at time 0.</p>&#13;
<p class="indent">If we are integrating and the variable of integration is time, we can imagine a device that takes as input the value of acceleration at time <em>t</em> and produces as output the value of velocity at time <em>t</em>. Let’s call such a device an <em>integrator</em>, and we can picture it as in <a href="ch06.xhtml#ch6fig5">Figure 6-5</a>.</p>&#13;
<div class="imagel" id="ch6fig5"><img src="Images/081fig01.jpg" alt="Image" width="337" height="115"/></div>&#13;
<p class="figcap"><em>Figure 6-5: An integrator is continuous and stateful. The continuously changing output at the right depends on the continuously changing input at the left in addition to some stored state.</em></p>&#13;
<p class="indent">The input to the integrator describes the rate at which the output is to change. For example, the input could be the volume flow rate of water from a faucet into a tub in gallons per minute. The output is the volume of <span epub:type="pagebreak" id="page_82"/>water in the tub in gallons. Or the input could be the current flowing into a capacitor, and the output the charge on a capacitor plate. The current flowing into the capacitor describes the rate at which charge is deposited on the capacitor plate. <a href="ch06.xhtml#ch6tab15">Table 6-15</a> shows some physical quantities related by integration.</p>&#13;
<p class="tabcap" id="ch6tab15"><strong>Table 6-15:</strong> Physical Quantities Related by Integration</p>&#13;
<table class="all">&#13;
<colgroup>&#13;
<col style="width:50%"/>&#13;
<col style="width:50%"/>&#13;
</colgroup>&#13;
<thead>&#13;
<tr>&#13;
<th style="vertical-align: top;" class="table-h"><p class="taba"><strong>Input to integrator</strong></p></th>&#13;
<th style="vertical-align: top;" class="table-h"><p class="taba"><strong>Output of integrator</strong></p></th>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba">Acceleration</p></td>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba">Velocity</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">Velocity</p></td>&#13;
<td style="vertical-align: top;" class="table-1bw"><p class="taba">Position</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba">Flow rate</p></td>&#13;
<td style="vertical-align: top;" class="table-1b"><p class="taba">Volume</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-1bw_bot"><p class="taba">Capacitor current</p></td>&#13;
<td style="vertical-align: top;" class="table-1bw_bot"><p class="taba">Capacitor charge</p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<p class="indent">The integrator is continuous and stateful. By <em>continuous</em>, I mean that the input is ever-present and the output is continuously changing. <em>Stateful</em> means that the integrator must maintain some internal information; that is, the output is not a pure function of the input. For the integrator to output the volume of water in the tub from the flow rate, it needs to maintain a value of the volume that will be updated by the flow rate. Similarly, for the integrator to output the charge on the capacitor from the current, it needs to maintain a value of the charge that will be updated by the input current.</p>&#13;
<h4 class="h4" id="ch6lev10">Digital Integration</h4>&#13;
<p class="noindent">We’d like to be able to teach Haskell how to integrate. Unfortunately, while nature supplies us with many good candidates for integrators, digital computation does not. The integrator is an analog continuous device. To model the integrator, we switch from continuous to discrete and work in time steps that are smaller than any time scales of interest in our problem.</p>&#13;
<p class="indent"><a href="ch06.xhtml#ch6fig6">Figure 6-6</a> shows how we can model an integrator.</p>&#13;
<div class="imagel" id="ch6fig6"><img src="Images/082fig01.jpg" alt="Image" width="567" height="286"/></div>&#13;
<p class="figcap"><em>Figure 6-6: Model of an integrator that is discrete and stateful</em></p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_83"/>The model is intended to be used in a discrete way. At instants of time separated by Δ<em>t</em>, we sample the input, multiply it by Δ<em>t</em>, and then add it to the current value of the output to produce a new output. If Δ<em>t</em> is small compared with time scales on which the input changes, this discrete model will emulate the continuous integrator very well.</p>&#13;
<p class="indent">The model in <a href="ch06.xhtml#ch6fig6">Figure 6-6</a> forms the basis for a method of numerical integration. To integrate a function, choose a small time step Δ<em>t</em>, sample the values the function produces at discrete times, multiply each function output by Δ<em>t</em>, and sum the results.</p>&#13;
<p class="indent">If we unwrap the stateful integrator in <a href="ch06.xhtml#ch6fig6">Figure 6-6</a>, we obtain the state-free integrator in <a href="ch06.xhtml#ch6fig7">Figure 6-7</a>, which is shown for the case in which we are integrating acceleration to obtain velocity.</p>&#13;
<div class="imagel" id="ch6fig7"><img src="Images/083fig01.jpg" alt="Image" width="635" height="304"/></div>&#13;
<p class="figcap"><em>Figure 6-7: A functional model of an integrator that is discrete and state free. This integrator uses the midpoint rule.</em></p>&#13;
<p class="indent">All of the rectangles are purely functional operations (addition and multiplication); the state contained in the circular integrator now exists only in the wires between pure functions. To approximate the velocity at time Δ<em>t</em>, we sample the acceleration at time Δ<em>t</em>/2, multiply it by Δ<em>t</em>, and add that to the velocity at time 0. Sampling at Δ<em>t</em>/2 is called the <em>midpoint rule</em> for numerical integration. If Δ<em>t</em> is small compared with the important time scales for the situation, we will get a good approximation from this method. <a href="ch06.xhtml#ch6fig7">Figure 6-7</a> shows four samples of the acceleration function; usually we will ask the computer to do many more.</p>&#13;
<p class="indent">What we would like to be able to do is to give the computer a function <em>f</em>, give the computer limits <em>a</em> and <em>b</em>, and ask it to compute the number:</p>&#13;
<div class="imagec"><img src="Images/083equ01.jpg" alt="Image" width="384" height="52"/></div>&#13;
<p class="indent">Viewed in this way, <span class="literal">Integration</span> is a function that takes a function <span class="literal">R -&gt; R</span> as input, along with two limits, and gives a number as output.</p>&#13;
<pre>type Integration = (R -&gt; R)  -- function&#13;
                 -&gt; R        -- lower limit&#13;
                 -&gt; R        -- upper limit&#13;
                 -&gt; R        -- result</pre>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_84"/>Integration is often thought of as finding the area under the curve. The midpoint rule for numerical integration samples the function at the midpoint of each interval of the independent variable, as shown in <a href="ch06.xhtml#ch6fig8">Figure 6-8</a>.</p>&#13;
<div class="imagel" id="ch6fig8"><img src="Images/084equ01.jpg" alt="Image" width="489" height="432"/></div>&#13;
<p class="figcap"><em>Figure 6-8: Numerical integration using the midpoint rule,</em> Δ<em>t = 0.5</em></p>&#13;
<p class="indent">Here is the Haskell code for a numerical integrator that uses the midpoint rule:</p>&#13;
<pre>integral :: R -&gt; Integration&#13;
integral dt f a b&#13;
    = sum [f t * dt | t &lt;- [a+dt/2, a+3*dt/2 .. b - dt/2]]</pre>&#13;
<p class="indent">The first argument to the function is a step size to use for the numerical integration. We have been speaking as though the independent variable is time, but in mathematics it could be anything. The second argument to <span class="literal">integral</span> is the function to be integrated. Note how we use a single identifier (<span class="literal">f</span>) to name the function that the user of <span class="literal">integral</span> passes in. Also, we don’t need to define the function <span class="literal">f</span>; what we are doing here is <em>naming</em> the function that the user of <span class="literal">integral</span> is sending in.</p>&#13;
<p class="indent">We use an arithmetic sequence to specify the times at which we want to sample the function. We use a list comprehension to give back a list of the same size that contains the products of the values the function returns with the step size. These products are the areas of the rectangles in <a href="ch06.xhtml#ch6fig8">Figure 6-8</a>. All that remains is to add up these areas with the <span class="literal">sum</span> function.</p>&#13;
<p class="indent">Let’s test out our integral function.</p>&#13;
<span epub:type="pagebreak" id="page_85"/>&#13;
<pre>*Main&gt; <span class="codestrong1">integral 0.01 (\x -&gt; x**2) 0 1</span>&#13;
0.33332499999999987</pre>&#13;
<p class="indent">Here we use an anonymous function to specify the function that squares its input because it’s easier than writing a function definition to name that function. In <a href="ch02.xhtml">Chapter 2</a>, we mentioned that anonymous functions would be useful as inputs to higher-order functions, and now we see an example of that. The exact value of this definite integral is 1/3, as shown here:</p>&#13;
<div class="imagec"><img src="Images/085equ01.jpg" alt="Image" width="187" height="57"/></div>&#13;
<h4 class="h4" id="ch6lev11">Implementing Antiderivatives</h4>&#13;
<p class="noindent">The type synonym <span class="literal">Integration</span> corresponds to the idea of a definite integral, where one has a function and two limits and expects to get a number as output, as in Expression 6.2. However, there is a second way of thinking about integration in which one integrates a function to obtain another function. In Equation 6.1, for example, we integrate an acceleration function to obtain a velocity function.</p>&#13;
<p class="indent">In calculus, a distinction is often made between a definite integral on one hand and an indefinite integral, or <em>antiderivative</em>, on the other. The antiderivative wants to be the inverse function to the derivative, but there is a catch, because functions like <span class="literal">sin</span> and <span class="literal">\x -&gt; sin x + 7</span> have the same derivative, namely <span class="literal">cos</span>. Thus, the derivative, as a higher-order function from functions to functions, does not have a well-defined inverse function. An antiderivative of a function <em>f</em> is any function <em>F</em> whose derivative is <em>f</em> . In other words, <em>F</em> is an antiderivative of <em>f</em> exactly when <em>DF</em> = <em>f</em>. If <em>F</em> is an antiderivative of <em>f</em>, we write</p>&#13;
<div class="imagec"><img src="Images/085equ02.jpg" alt="Image" width="428" height="47"/></div>&#13;
<p class="noindent">using the indefinite integral symbol without limits and the constant of integration <em>C</em>. For example, we write</p>&#13;
<div class="imagec"><img src="Images/085equ03.jpg" alt="Image" width="203" height="47"/></div>&#13;
<p class="noindent">where <em>C</em> is an undetermined constant of integration. There is a relationship between a definite integral and an indefinite integral. The fundamental theorem of calculus claims that if <em>F</em> is any antiderivative of <em>f</em>, then</p>&#13;
<div class="imagec"><img src="Images/085equ04.jpg" alt="Image" width="196" height="53"/></div>&#13;
<p class="indent">Renaming variables and rearranging terms, we obtain an expression that allows us to relate the constant of integration to an initial value of <em>F</em>.</p>&#13;
<div class="imagec"><img src="Images/085equ05.jpg" alt="Image" width="451" height="49"/></div>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_86"/>For any real number <em>a</em>, an antiderivative <em>F</em> is a function whose value <em>F</em>(<em>x</em>) at <em>x</em> is the sum of its “initial” value <em>F</em>(<em>a</em>) at <em>a</em> and the definite integral of <em>f</em> from <em>a</em> to <em>x</em>. If we associate the indefinite integral <em>∫ f</em> (<em>x</em>)<em>dx</em> of Equation 6.3 with the definite integral <img class="inline" src="Images/e0085-06.jpg" alt="Image" width="87" height="25"/> of Equation 6.4, we can associate the initial value <em>F</em>(<em>a</em>) in Equation 6.4 with – <em>C</em>, where <em>C</em> is the constant of integration in Equation 6.3. In this sense, constants of integration are related to initial values.</p>&#13;
<p class="indent">A typical function has many functions that can serve as its antiderivative. How can we select one function in particular? There are two ways: we can specify a lower limit or we can specify an initial value. Specifying a lower limit corresponds to the definite integral <span class="literal">Integration</span> that we explored earlier. Specifying an initial value leads to the <span class="literal">AntiDerivative</span> we explore below.</p>&#13;
<p class="indent">Let’s call an antiderivative a function that takes an initial value (such as <em>v</em>(0) in Equation 6.1) and a function (such as <em>a</em>) and returns a function (such as <em>v</em>).</p>&#13;
<pre>type AntiDerivative =   R        -- initial value&#13;
                    -&gt; (R -&gt; R)  -- function&#13;
                    -&gt; (R -&gt; R)  -- antiderivative of function</pre>&#13;
<p class="indent">The idea of the antiderivative is closely related to the idea of the integral. We can define a function <span class="literal">antiDerivative</span> in terms of the <span class="literal">integral</span> we have already defined.</p>&#13;
<pre>antiDerivative :: R -&gt; AntiDerivative&#13;
antiDerivative dt v0 a t = v0 + integral dt a 0 t</pre>&#13;
<p class="indent"><a href="ch04.xhtml">Chapter 4</a> showed how to implement Equations 4.5 and 4.12 as the functions <span class="literal">velFromPos</span> and <span class="literal">accFromVel</span>. Now let’s implement Equation 6.1 in Haskell.</p>&#13;
<pre>velFromAcc :: R                       -- dt&#13;
           -&gt; Velocity                -- initial velocity&#13;
           -&gt; (Time -&gt; Acceleration)  -- acceleration function&#13;
           -&gt; (Time -&gt; Velocity)      -- velocity function&#13;
velFromAcc dt v0 a t = antiDerivative dt v0 a t</pre>&#13;
<p class="indent">We see that finding a velocity function from an acceleration function is nothing other than the antiderivative.</p>&#13;
<p class="indent">How about finding a position function from a velocity function?</p>&#13;
<div class="imagec"><img src="Images/086equ01.jpg" alt="Image" width="445" height="51"/></div>&#13;
<p class="indent">In Haskell, this is:</p>&#13;
<pre>posFromVel :: R                   -- dt&#13;
           -&gt; Position            -- initial position&#13;
           -&gt; (Time -&gt; Velocity)  -- velocity function&#13;
           -&gt; (Time -&gt; Position)  -- position function&#13;
posFromVel = antiDerivative</pre>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_87"/>Again, nothing but the antiderivative. Here we use point-free style to show an alternative way of writing the function and to emphasize the equality of the two functions. The functions <span class="literal">velFromAcc</span> and <span class="literal">posFromVel</span> from earlier are the same, and each is the same as <span class="literal">antiDerivative</span>. Both integrate a given function from 0 to <em>t</em> and add on an initial value.</p>&#13;
<p class="indent">Type synonyms show that time, velocity, and acceleration are all treated as numbers.</p>&#13;
<pre>type Time         = R&#13;
type Position     = R&#13;
type Velocity     = R&#13;
type Acceleration = R</pre>&#13;
<p class="indent">Perhaps you’d rather provide your numerical integrator with the number of steps to take from the lower limit to the upper limit rather than the step size. This is not hard to do.</p>&#13;
<pre>integralN :: Int -&gt; Integration&#13;
integralN n f a b&#13;
    = let dt = (b - a) / fromIntegral n&#13;
      in integral dt f a b</pre>&#13;
<p class="indent">The <span class="literal">let</span> keyword introduces local variables and/or functions that can be used in the body after the <span class="literal">in</span> keyword. The variable dt is a local variable defined inside the function <span class="literal">integralN</span>. This dt is not visible outside of the definition of integralN. Any dt we use outside of this function has an independent meaning separate from this. Local variables are particularly useful to define if they are used more than once in the remainder of the definition. In this case, we use <span class="literal">dt</span> only once, so we could have inserted the definition of <span class="literal">dt</span> directly in the final line.</p>&#13;
<pre>integralN' :: Int -&gt; Integration&#13;
integralN' n f a b&#13;
    = integral ((b - a) / fromIntegral n) f a b</pre>&#13;
<p class="indent">Using the local variable <span class="literal">dt</span> saves us a set of parentheses and makes the code easier to read because the name <span class="literal">dt</span> has meaning to us as a step size. I encourage you to define local variables with <span class="literal">let</span> whenever you can think of a name that has meaning. It will help readers of the code, including the writer.</p>&#13;
<p class="indent">The division operator (<span class="literal">/</span>) can be used only between numbers of the same type. Since <span class="literal">b - a</span> has type <span class="literal">R</span> and <span class="literal">n</span> has type <span class="literal">Int</span>, we can’t directly divide one by the other. The solution is to transform <span class="literal">n</span> into something with type <span class="literal">R</span>, and <span class="literal">fromIntegral</span> does the trick.</p>&#13;
<h3 class="h3" id="ch6lev12">Summary</h3>&#13;
<p class="noindent">A higher-order function takes another function as input and/or produces a function as output. Higher-order functions that produce functions as <span epub:type="pagebreak" id="page_88"/>output can be thought of as taking multiple inputs. Numerical integration is a key example of a higher-order function that takes a function as input. The lambda notation for writing anonymous functions can be used for higher-order functions as well. Mapping a function over a list is an example of a higher-order function that takes another function as input and is similar to a list comprehension. We can make binary infix operators into higher-order functions by enclosing them in parentheses. Haskell can achieve iteration via the higher-order function <span class="literal">iterate</span>, which takes a function and a starting value and repeatedly applies the function to form an infinite list. Some higher-order functions, such as <span class="literal">filter</span>, take a predicate as input. We can also achieve filtering through list comprehensions. In the next chapter, we introduce a library that allows us to plot functions.</p>&#13;
<h3 class="h3" id="ch6lev13">Exercises</h3>&#13;
<p class="noindentts"><strong>Exercise 6.1.</strong> Let us return to the example of throwing a rock straight upward. Perhaps we don’t want to throw it upward at 30 m/s but would like to be able to throw it upward with whatever initial velocity we choose. Write a function</p>&#13;
<pre>yRock :: R -&gt; R -&gt; R</pre>&#13;
<p class="noindentts">that takes as input an initial velocity and returns as output a function that takes as input a time and returns as output a height. Also, write a function</p>&#13;
<pre>vRock :: R -&gt; R -&gt; R</pre>&#13;
<p class="noindentts">that takes as input an initial velocity and returns as output a function that takes as input a time and returns as output a velocity.</p>&#13;
<p class="noindentts"><strong>Exercise 6.2.</strong> Give the type of <span class="literal">take 4</span>.</p>&#13;
<p class="noindentts"><strong>Exercise 6.3.</strong> The function <span class="literal">map</span> has type <span class="literal">(a -&gt; b) -&gt; [a] -&gt; [b]</span>. This means that <span class="literal">map</span> is expecting a function with type <span class="literal">a -&gt; b</span> as its first argument. The function <span class="literal">not</span> has type <span class="literal">Bool -&gt; Bool</span>. Can <span class="literal">not</span> be the first argument to <span class="literal">map</span>? If so, what is the type of <span class="literal">map not</span>? Show how, starting from the types of <span class="literal">map</span> and <span class="literal">not</span>, you can figure out the type of <span class="literal">map not</span>.</p>&#13;
<p class="noindentts"><strong>Exercise 6.4.</strong> Write a function</p>&#13;
<pre>greaterThanOrEq7' :: Int -&gt; Bool&#13;
greaterThanOrEq7' n = undefined</pre>&#13;
<p class="noindentts">that does the same thing as <span class="literal">greaterThanOrEq7</span> but doesn’t use an <span class="literal">if-then-else</span> construction. (Hint: look at the function <span class="literal">lt10</span>.)</p>&#13;
<p class="noindentts"><strong>Exercise 6.5.</strong> Write a function with type <span class="literal">Int -&gt; String -&gt; Bool</span> and describe in words what it does.</p>&#13;
<p class="noindentts"><strong>Exercise 6.6.</strong> Write a predicate expressing the property “has more than six elements” that takes a list as input. Include a type signature with your predicate definition.</p>&#13;
<p class="noindentts"><span epub:type="pagebreak" id="page_89"/><strong>Exercise 6.7.</strong> <a href="ch06.xhtml#ch6tab5">Table 6-5</a> gives examples of the use of the <span class="literal">replicate</span> function. In the first three examples, a list is created with the requested length of the requested item. In the last case, a string is created. This seems different. Explain what is going on here.</p>&#13;
<p class="noindentts"><strong>Exercise 6.8.</strong> Make a list of the first 1,000 squares. Don’t print the list; just print your definition. You could print the first 10 squares to see if your method is working.</p>&#13;
<p class="noindentts"><strong>Exercise 6.9.</strong> Use <span class="literal">iterate</span> to define a function <span class="literal">repeat'</span> that does the same thing as the Prelude function <span class="literal">repeat</span>.</p>&#13;
<p class="noindentts"><strong>Exercise 6.10.</strong> Use <span class="literal">take</span> and <span class="literal">repeat</span> to define a function <span class="literal">replicate'</span> that does the same thing as the Prelude function <span class="literal">replicate</span>.</p>&#13;
<p class="noindentts"><strong>Exercise 6.11.</strong> A car starts from rest and accelerates at 5 m/s<sup>2</sup> on a straight, level highway. Use <span class="literal">iterate</span> to make an infinite list of velocities for this car, with one velocity every second. (The list should look like [0,5,10,15,...]. Use the <span class="literal">take</span> function to see the first several elements of your infinite list.)</p>&#13;
<p class="noindentts"><strong>Exercise 6.12.</strong> List comprehensions can be used as an alternative to the <span class="literal">map</span> function. To prove this, write a function</p>&#13;
<pre>  map' :: (a -&gt; b) -&gt; [a] -&gt; [b]</pre>&#13;
<p class="noindentts">that does the same thing as <span class="literal">map</span>. Use a list comprehension to write your definition.</p>&#13;
<p class="noindentts"><strong>Exercise 6.13.</strong> List comprehensions can be used as an alternative to the <span class="literal">filter</span> function. To prove this, write a function</p>&#13;
<pre>  filter' :: (a -&gt; Bool) -&gt; [a] -&gt; [a]</pre>&#13;
<p class="noindentts">that does the same thing as <span class="literal">filter</span>. Use a list comprehension to write your definition.</p>&#13;
<p class="noindentts"><strong>Exercise 6.14.</strong> Write a function</p>&#13;
<pre>average :: [R] -&gt; R&#13;
average xs = undefined</pre>&#13;
<p class="noindentts">that finds the average of a list of numbers. You can assume the list has at least one number. You may want to use the <span class="literal">fromIntegral</span> function.</p>&#13;
<p class="noindentts"><strong>Exercise 6.15.</strong> Produce one-input and two-input pictures, similar to <a href="ch06.xhtml#ch6fig2">Figures 6-2</a> and <a href="ch06.xhtml#ch6fig3">6-3</a>, for the higher-order function <span class="literal">drop</span>. Do the same thing for the higher-order function <span class="literal">replicate</span>.</p>&#13;
<p class="noindentts"><strong>Exercise 6.16.</strong> An alternative rule to the midpoint rule for numerical integration is the trapezoidal rule. In the trapezoidal rule, we approximate the area under a curve by the sum of the areas of a bunch of trapezoids, as shown in <a href="ch06.xhtml#ch6fig9">Figure 6-9</a>.</p>&#13;
<span epub:type="pagebreak" id="page_90"/>&#13;
<div class="imagel" id="ch6fig9"><img src="Images/090fig01.jpg" alt="Image" width="647" height="228"/></div>&#13;
<p class="figcap"><em>Figure 6-9: The trapezoidal rule</em></p>&#13;
<p class="indent">For the example, in <a href="ch06.xhtml#ch6fig9">Figure 6-9</a>, the area of the first trapezoid is</p>&#13;
<div class="imagec"><img src="Images/090equ01.jpg" alt="Image" width="178" height="45"/></div>&#13;
<p class="noindent">and the area of all four trapezoids in the figure is</p>&#13;
<div class="imagec"><img src="Images/090equ02.jpg" alt="Image" width="528" height="50"/></div>&#13;
<p class="indent">Write a definition for the function</p>&#13;
<pre>trapIntegrate :: Int       -- # of trapezoids n&#13;
              -&gt; (R -&gt; R)  -- function f&#13;
              -&gt; R         -- lower limit a&#13;
              -&gt; R         -- upper limit b&#13;
              -&gt; R         -- result&#13;
trapIntegrate n f a b = undefined</pre>&#13;
<p class="noindentts">that takes a number of trapezoids, a function, and two limits as its arguments and gives back (an approximation to) the definite integral, using the trapezoidal rule. Test your integrator on the following integrals and see how close you can get to the correct values:</p>&#13;
<div class="imagec"><img src="Images/090equ03.jpg" alt="Image" width="220" height="198"/></div>&#13;
</div></body></html>