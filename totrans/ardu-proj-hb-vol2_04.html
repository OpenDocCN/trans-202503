<html><head></head><body>
<h1 class="h1-part" id="part03"><span epub:type="pagebreak" id="page_83"/><strong><span class="green1">Motors</span></strong></h1>&#13;


<h2 class="h2s" id="ch10"><span epub:type="pagebreak" id="page_84"/><strong>10<br/>Old-School Analog Dial</strong></h2>&#13;
<p class="intro"><span class="green1">Old-fashioned analog displays have a certain charm. In this project I’ll demonstrate how to make your own.</span></p>&#13;
<div class="image"><img alt="Image" src="../images/p0084-01.jpg"/></div>&#13;
<div class="image"><span epub:type="pagebreak" id="page_85"/><img alt="Image" src="../images/p0085-01.jpg"/></div>&#13;
<p class="capg1"><strong>PARTS REQUIRED</strong></p>&#13;
<p class="cap1"><strong>Arduino board</strong></p>&#13;
<p class="cap1"><strong>Breadboard</strong></p>&#13;
<p class="cap1"><strong>Jumper wires</strong></p>&#13;
<p class="cap1"><strong>Tower Pro SG90 9g servomotor</strong></p>&#13;
<p class="cap1"><strong>Photoresistor</strong></p>&#13;
<p class="cap1"><strong>10k-ohm resistor</strong></p>&#13;
<p class="capg1"><strong>LIBRARY REQUIRED</strong></p>&#13;
<p class="cap1"><strong>Servo</strong></p>&#13;
<h3 class="h3" id="ch00lev1sec39"><span epub:type="pagebreak" id="page_86"/><span class="green1"><strong>HOW IT WORKS</strong></span></h3>&#13;
<p class="noindent">Today, visual representations of measurements are usually displayed digitally on an LCD screen or with LED digits, but not that long ago analog dials were always used to show pressure, speed, and even time! The Arduino can detect a voltage input from a sensor, and we’ll use that capability here to create a dial that the Arduino moves in response to the input received. We can use this dial in lots of ways to show measurements for different projects.</p>&#13;
<p class="indent">In this project, we’ll use a photoresistor to measure light input, but you could easily swap in a water sensor to make a rain detector, or a gas sensor for a warning meter. A <em>photoresistor</em>, also referred to as a <em>light-dependent resistor</em>, produces a variable resistance depending on the amount of light the sensor detects, as discussed in Project 2.</p>&#13;
<p class="indent">The principles for adding an analog sensor are the same for whichever sensor you choose. Most sensors have three connections: ground, +5V, and a signal connection that connects to the analog A0 pin on the Arduino—this makes it easy to swap in a different sensor. The photoresistor is slightly different because it has only two connections, so one will go to power and one to A0.</p>&#13;
<p class="indent">We’ll use the sensor to measure light levels, and the Arduino will use that measurement to move the arm of a small servomotor (or “servo” for short) to the corresponding angle. The angle of the motor arm indicates the strength of the light input.</p>&#13;
<p class="indent">A <em>servo</em>, shown in <a href="ch10.xhtml#ch10fig1">Figure 10-1</a>, is a small, cheap, mass-produced motor used for small robotics and a variety of electronics tasks. The servo is controlled by three wires: ground (black or brown), power (red), and signal or control (typically orange, yellow, or white). Pulses are sent from the Arduino over the control wire via pulse width modulation (PWM; discussed in Project 5), and the input received by the photoresistor determines the angle of the servo’s actuator arm. The servo expects a pulse every 20 milliseconds in order to retrieve the correct information about the angle.</p>&#13;
<p class="indent">The pulse width dictates the range of the servo’s angular motion. Typically, a servo pulse width of 1.5 milliseconds sets the servo to its “neutral” position of 45 degrees, a pulse width of 1.25 milliseconds sets the angle to 0 degrees, and a pulse width of 1.75 milliseconds sets the angle to 90 degrees.</p>&#13;
<p class="figcap"><span epub:type="pagebreak" id="page_87"/><a id="ch10fig1"/><strong>FIGURE 10-1:</strong> A servomotor</p>&#13;
<div class="image"><img alt="Image" src="../images/f10-01.jpg"/></div>&#13;
<p class="indent">The physical limits of the arm angle and the timing of the servo hardware vary across brands and models, but in general a servo’s angular motion travels in the range of 90 to 180 degrees and the neutral position is almost always at 1.5 milliseconds.</p>&#13;
<h3 class="h3" id="ch00lev1sec40"><span class="green1"><strong>THE BUILD</strong></span></h3>&#13;
<ol>&#13;
<li><p class="noindents">Connect the servo’s red (power) wire directly to +5V on the Arduino, the brown (ground) wire to Arduino GND, and the yellow (signal) wire to Arduino pin 9, as shown in the following table.</p>&#13;
<table class="all">&#13;
<thead>&#13;
<tr>&#13;
<td class="table_thg" style="vertical-align: top;"><p class="tablec"><strong>SERVO</strong></p></td>&#13;
<td class="table_th" style="vertical-align: top;"><p class="tablec"><strong>ARDUINO</strong></p></td>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td class="table_1g" style="vertical-align: top;"><p class="tablec"><span class="green1">Red (power) wire</span></p></td>&#13;
<td class="table_2" style="vertical-align: top;"><p class="tablec"><span class="green1">+5V</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1g" style="vertical-align: top;"><p class="tablec"><span class="green1">Brown (ground) wire</span></p></td>&#13;
<td class="table_2" style="vertical-align: top;"><p class="tablec"><span class="green1">GND</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1g" style="vertical-align: top;"><p class="tablec"><span class="green1">Yellow signal (control) wire</span></p></td>&#13;
<td class="table" style="vertical-align: top;"><p class="tablec"><span class="green1">Pin 9</span></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table></li>&#13;
<li><p class="noindents">Place the photoresistor in the breadboard and connect one leg to +5V on the Arduino. Connect the photoresistor’s other leg to a 10k-ohm resistor, as shown in the circuit diagram in <a href="ch10.xhtml#ch10fig2">Figure 10-2</a>, and use a jumper wire to connect this resistor leg to Arduino pin A0 (see the following table). Connect the other leg of the 10k-ohm resistor to GND.</p>&#13;
<table class="all">&#13;
<thead>&#13;
<tr>&#13;
<td class="table_thg" style="vertical-align: top;"><p class="tablec"><strong>PHOTORESISTOR</strong></p></td>&#13;
<td class="table_th" style="vertical-align: top;"><p class="tablec"><strong>ARDUINO</strong></p></td>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td class="table_1g" style="vertical-align: top;"><p class="tablec"><span class="green1">Leg 1</span></p></td>&#13;
<td class="table_2" style="vertical-align: top;"><p class="tablec"><span class="green1">+5V</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1g" style="vertical-align: top;"><p class="tablec"><span class="green1">Leg 2</span></p></td>&#13;
<td class="table" style="vertical-align: top;"><p class="tablec"><span class="green1">Pin A0 via 10k-ohm resistor</span></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<p class="figcap"><span epub:type="pagebreak" id="page_88"/><a id="ch10fig2"/><strong>FIGURE 10-2:</strong> The photoresistor is connected to Arduino pin A0 and measures the amount of light. The servo is connected to pin 9 and moves according to the amount of light.</p>&#13;
<div class="image"><img alt="Image" src="../images/f10-02.jpg"/></div></li>&#13;
<li><p class="noindents">Upload the code in “<a href="ch10.xhtml#ch00lev1sec41">The Sketch</a>” on <a href="ch10.xhtml#page_89">page 89</a>.</p></li>&#13;
<li><p class="noindents">Make a faceplate for your dial, like the one in <a href="ch10.xhtml#ch10fig3">Figure 10-3</a>, and attach it to the servo. Be sure the servo arm can move over the measurements of the dial like a pointer. Cover the photoresistor completely when you add power to the Arduino, and then mark this position as 0 on the faceplate. Shine a bright flashlight at the light resistor to get the maximum value, and then mark that position on the faceplate as well. Add equally spaced marks between 0 and the max value to give you a scale.</p>&#13;
<p class="figcap"><a id="ch10fig3"/><strong>FIGURE 10-3:</strong> An example faceplate</p>&#13;
<div class="image"><img alt="Image" src="../images/f10-03.jpg"/></div></li>&#13;
</ol>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_89"/>The servo’s actuator arm will move up the scale as it detects light, depending on the brightness. For example, on the left of <a href="ch10.xhtml#ch10fig4">Figure 10-4</a>, the servo arm is shown at position 0. On the right, the servo arm displays the brightness measurement when light—in this case, a laser—is applied to the photoresistor.</p>&#13;
<p class="figcap"><a id="ch10fig4"/><strong>FIGURE 10-4:</strong> When light shines on the photoresistor, the servo arm moves.</p>&#13;
<div class="image"><img alt="Image" src="../images/f10-04.jpg"/></div>&#13;
<h3 class="h3" id="ch00lev1sec41"><span class="green1"><strong>THE SKETCH</strong></span></h3>&#13;
<p class="noindent">The sketch first calls the Servo library, which is already built into the Arduino IDE (so there’s no need to download and install this library). We give the servo position a starting value of <code>0</code>, and set the photoresistor pin as A0. We assign Arduino pin 9 to control the servo and then read the value from the analog pin. Pin A0 is capable of reading an analog value from the photoresistor and converting it to a digital value in the range 0–1,023, so we scale this down to 0–179 (180 possible values) to fit the servo arm’s 180-degree range of movement. If no light is applied to the photoresistor, the value will be <code>0</code> and the servo position will be 0. As you add light, the servo arm will move, up to a maximum of 180 degrees. The angle depends on the brightness.</p>&#13;
<p class="programs1"><span class="ash">/* Created by David Cuartielles modified 30 Aug 2011 by Tom Igoe</span><br/><span class="ash">This example code is in the public domain <a href="http://arduino.cc/en/Tutorial/AnalogInput">http://arduino.cc/en/Tutorial/AnalogInput</a> */</span><br/>#include &lt;<span class="orange">Servo</span>.h&gt; <span class="ash">// Call the Servo library (built into the IDE)</span><br/><span class="orange">Servo</span> myservo;<br/><span class="green1">int</span> pos = 0; <span class="ash">// Give the position a value</span><br/><span class="green1">int</span> lightPin = A0; <span class="ash">// Pin connected to the photoresistor</span><br/><br/><span class="green1">void</span> <span class="green2">setup</span>() {<br/>  myservo.<span class="orange">attach</span>(9); <span class="ash">// Pin connected to the servo</span><br/>}<br/><br/><span class="green1">void</span> <span class="green2">loop</span>() {<br/>  <span class="ash">// Read voltage from photoresistor, can read 1024 possible values</span><br/>  <span class="green1">int</span> lightLevel = <span class="orange">analogRead</span>(lightPin);<br/><span epub:type="pagebreak" id="page_90"/>  <span class="ash">// Scale 1024 values to 180</span><br/>  lightLevel = <span class="orange">map</span>(lightLevel, 0, 1023, 0, 179);<br/>  <span class="ash">// Scale of 0-179 (180 values)</span><br/>  pos = <span class="orange">constrain</span>(lightLevel, 0, 179);<br/><br/>  myservo.<span class="orange">write</span>(pos); <span class="ash">// Set the servo angle</span><br/>  <span class="orange">delay</span>(100);<br/>}</p>&#13;
<h3 class="h3" id="ch00lev1sec42"><span class="green1"><strong>TROUBLESHOOTING</strong></span></h3>&#13;
<p class="ques"><strong>Q.</strong> <em>The code compiles, but the servo does not move when light is applied to the photoresistor.</em></p>&#13;
<p class="bull">• If the servo does not move at all, make sure that your wiring matches the diagram in <a href="ch10.xhtml#ch10fig2">Figure 10-2</a> and that there’s power going to the Arduino.</p>&#13;
<p class="bull">• Connect the Arduino to your PC and open the Serial Monitor to check that there’s a reading from the photoresistor. If no reading is registered, check that the photoresistor is securely inserted into the breadboard. If you still get no reading, your photoresistor may be faulty, so replace it with another one.</p>&#13;


<h2 class="h2s" id="ch11"><span epub:type="pagebreak" id="page_91"/><strong>11<br/>Stepper Motor</strong></h2>&#13;
<p class="intro"><span class="green1">In this project I’ll introduce you to a stepper motor (or step motor), set it up, and discuss how it works.</span></p>&#13;
<div class="image"><img alt="Image" src="../images/p0091-01.jpg"/></div>&#13;
<div class="image"><span epub:type="pagebreak" id="page_92"/><img alt="Image" src="../images/p0092-01.jpg"/></div>&#13;
<p class="capg1"><strong>PARTS REQUIRED</strong></p>&#13;
<p class="cap1"><strong>Arduino board</strong></p>&#13;
<p class="cap1"><strong>Breadboard</strong></p>&#13;
<p class="cap1"><strong>Jumper wires</strong></p>&#13;
<p class="cap1"><strong>28BYJ-48 stepper motor with ULN2003 driver module</strong></p>&#13;
<p class="cap1"><strong>50k-ohm potentiometer</strong></p>&#13;
<p class="capg1"><strong>LIBRARY REQUIRED</strong></p>&#13;
<p class="cap1"><strong>Stepper</strong></p>&#13;
<h3 class="h3" id="ch00lev1sec43"><span epub:type="pagebreak" id="page_93"/><span class="green1"><strong>HOW IT WORKS</strong></span></h3>&#13;
<p class="noindent">A <em>stepper motor</em>, like the one shown in <a href="ch11.xhtml#ch11fig1">Figure 11-1</a>, is a direct current (DC) electric motor that divides a full rotation of the arm into a number of equal steps. Unlike the servomotor used in Project 10, this stepper motor turns 360 degrees and has the advantage of being able to position itself with great accuracy or rotate continuously.</p>&#13;
<p class="figcap"><a id="ch11fig1"/><strong>FIGURE 11-1:</strong> A 28BYJ-48 stepper motor</p>&#13;
<div class="image"><img alt="Image" src="../images/f11-01.jpg"/></div>&#13;
<p class="indent">The stepper motor’s data sheet will state the number of steps it performs per revolution; a <em>step</em> is just one movement within one revolution. A motor with 200 steps per revolution will turn through 360 degrees in 200 steps, or 1.8 degrees per step. Within a stepper motor there are two interlocked discs, similar to gears, with teeth of opposing magnetism that alternate and connect to the center shaft or rotor. The motor moves in steps when power is sent to its <em>windings</em>—a series of wire coils that become electromagnets when voltage is applied. When powered, these electromagnets attract or oppose the gear-shaped discs and rotate the shaft.</p>&#13;
<p class="indent">You can control the motor’s position and speed by commanding it to move to and hold at one of these steps. Since we know the angle each step represents, we can get accurate and precise turning angles and distance measurements. Stepper motors are commonly used in CD and DVD players and in 3D printers, where movements need to be very accurate.</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_94"/>When you’re looking to buy a stepper motor, there are a few things to consider. The first is whether or not it has a gearbox. A gearbox will improve the <em>torque</em> (moving power) but reduce the <em>revolutions per minute</em> (RPM, or speed).</p>&#13;
<p class="indent">The next consideration is whether the stepper motor is bipolar or unipolar. <em>Bipolar</em> motors switch polarity of the coils. Polarity is the direction the current flows; so if, for example, we reversed the 5V and GND connections, the motor would turn in the opposite direction. Bipolar motors have simpler windings but require more complicated drivers as they reverse the polarity for us. <em>Unipolar</em> motors essentially have a winding per polarity, but they can use simpler drivers. You can check whether your motor is bipolar or unipolar by looking at the connections: a bipolar motor has four connections, and a unipolar motor has five to eight connections. In this project we’re using a unipolar motor, the 28BYJ-48 stepper motor with the ULN2003 driver test module—a board that makes it easy to control the motor with the Arduino, like the module board for the LED matrix in Project 4. Some driver boards will have a slightly different setup, so I’d recommend getting the model of motor listed here for the project so you can follow the instructions closely.</p>&#13;
<p class="indent">Turning the potentiometer alters the angle of the stepper motor arm, so as you move the potentiometer to the left or right, the stepper motor arm will follow your input. (A <em>potentiometer</em> is a variable resistor with a knob.) The resistance of the potentiometer changes as you turn the knob. They are commonly used in electrical devices such as volume controls on audio equipment.</p>&#13;
<h3 class="h3" id="ch00lev1sec44"><span class="green1"><strong>THE BUILD</strong></span></h3>&#13;
<ol>&#13;
<li><p class="noindents">Connect the stepper motor to the driver board, as shown in <a href="ch11.xhtml#ch11fig2">Figure 11-2</a>. From the outermost pin to the innermost pin in the middle of the board, connect the wires from the motor in the following order: blue, pink, yellow, orange, red. The connector can only be inserted in this way.</p>&#13;
<p class="figcap"><span epub:type="pagebreak" id="page_95"/><a id="ch11fig2"/><strong>FIGURE 11-2:</strong> Connecting the stepper to the driver board</p>&#13;
<div class="image"><img alt="Image" src="../images/f11-02.jpg"/></div></li>&#13;
<li><p class="noindents">Connect the driver board pins 1, 2, 3, and 4 at the other end of the board directly to Arduino pins 8, 9, 10, and 11, respectively.</p>&#13;
<table class="all">&#13;
<thead>&#13;
<tr>&#13;
<td class="table_thg" style="vertical-align: top;"><p class="tablec"><strong>STEPPER DRIVER BOARD</strong></p></td>&#13;
<td class="table_th" style="vertical-align: top;"><p class="tablec"><strong>ARDUINO</strong></p></td>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td class="table_1g" style="vertical-align: top;"><p class="tablec"><span class="green1">IN1</span></p></td>&#13;
<td class="table_2" style="vertical-align: top;"><p class="tablec"><span class="green1">Pin 8</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1g" style="vertical-align: top;"><p class="tablec"><span class="green1">IN2</span></p></td>&#13;
<td class="table_2" style="vertical-align: top;"><p class="tablec"><span class="green1">Pin 9</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1g" style="vertical-align: top;"><p class="tablec"><span class="green1">IN3</span></p></td>&#13;
<td class="table_2" style="vertical-align: top;"><p class="tablec"><span class="green1">Pin 10</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1g" style="vertical-align: top;"><p class="tablec"><span class="green1">IN4</span></p></td>&#13;
<td class="table_2" style="vertical-align: top;"><p class="tablec"><span class="green1">Pin 11</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1g" style="vertical-align: top;"><p class="tablec"><span class="green1">GND</span></p></td>&#13;
<td class="table_2" style="vertical-align: top;"><p class="tablec"><span class="green1">GND</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1g" style="vertical-align: top;"><p class="tablec"><span class="green1">+5V</span></p></td>&#13;
<td class="table" style="vertical-align: top;"><p class="tablec"><span class="green1">+5V</span></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table></li>&#13;
<li><p class="noindents">Insert a potentiometer into the breadboard, connecting its center pin to Arduino A0 and its outer two pins to Arduino +5V and GND in any order.</p>&#13;
<table class="all">&#13;
<thead>&#13;
<tr>&#13;
<td class="table_thg" style="vertical-align: top;"><p class="tablec"><strong>POTENTIOMETER</strong></p></td>&#13;
<td class="table_th" style="vertical-align: top;"><p class="tablec"><strong>ARDUINO</strong></p></td>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td class="table_1g" style="vertical-align: top;"><p class="tablec"><span class="green1">Left pin</span></p></td>&#13;
<td class="table_2" style="vertical-align: top;"><p class="tablec"><span class="green1">GND</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1g" style="vertical-align: top;"><p class="tablec"><span class="green1">Center pin</span></p></td>&#13;
<td class="table_2" style="vertical-align: top;"><p class="tablec"><span class="green1">A0</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1g" style="vertical-align: top;"><p class="tablec"><span class="green1">Right pin</span></p></td>&#13;
<td class="table_2" style="vertical-align: top;"><p class="tablec"><span class="green1">+5V</span></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table></li>&#13;
<li><p class="noindents">Connect the driver board GND and +5V to the breadboard GND and +5V, and connect the breadboard rails to the Arduino. Don’t forget to attach the power rails of the breadboard to GND and +5V too.</p></li>&#13;
<li><p class="noindents"><span epub:type="pagebreak" id="page_96"/>Make sure that your setup matches the final configuration shown in <a href="ch11.xhtml#ch11fig3">Figure 11-3</a>, and upload the code in “<a href="ch11.xhtml#ch00lev1sec45">The Sketch</a>” below.</p>&#13;
<p class="figcap"><a id="ch11fig3"/><strong>FIGURE 11-3:</strong> The circuit diagram for the stepper motor</p>&#13;
<div class="image"><img alt="Image" src="../images/f11-03.jpg"/></div></li>&#13;
</ol>&#13;
<h3 class="h3" id="ch00lev1sec45"><span class="green1"><strong>THE SKETCH</strong></span></h3>&#13;
<p class="noindent">This code comes with the Arduino IDE and can be found at File ▸ Examples ▸ Stepper ▸ MotorKnob. I’ve reproduced it here as you’ll see it in the IDE. It uses the built-in stepper library, <code>&lt;Stepper.h&gt;</code>. The potentiometer is connected to the Arduino A0 pin and gives a variable voltage depending on the turn of the potentiometer, which then controls the position of the stepper motor.</p>&#13;
<p class="programs1"><span class="ash">/* MotorKnob</span><br/> <span class="ash">* <a href="http://www.arduino.cc/en/Reference/Stepper">http://www.arduino.cc/en/Reference/Stepper</a></span><br/> <span class="ash">* This example code is in the public domain.</span><br/> <span class="ash">*/</span><br/>#include &lt;<span class="orange">Stepper</span>.h&gt;<br/><span class="ash">// Change this to the number of steps on your motor</span><br/>#define STEPS 100<br/><br/><span class="ash">// Create an instance of the stepper class, specifying the number of</span><br/><span class="ash">// steps of the motor and the pins it's attached to</span><br/><span class="orange">Stepper</span> stepper(STEPS, 8, 10, 9, 11);<br/><span class="ash"><span epub:type="pagebreak" id="page_97"/>// The previous reading from the analog input</span><br/><span class="green1">int</span> previous = 0;<br/><br/><span class="green1">void</span> <span class="green2">setup</span>() {<br/>  <span class="ash">// Set the speed of the motor to 700 RPM</span><br/>  stepper.<span class="orange">setSpeed</span>(30);<br/>}<br/><br/><span class="green1">void</span> <span class="green2">loop</span>() {<br/>  <span class="ash">// Get the sensor value</span><br/>  <span class="green1">int</span> val = <span class="orange">analogRead</span>(0);<br/><br/>  <span class="ash">// Move a number of steps equal to change in the sensor reading</span><br/>  stepper.<span class="orange">step</span>(val - previous);<br/><br/>  <span class="ash">// Remember the previous value of the sensor</span><br/>  previous = val;<br/>}</p>&#13;
<h3 class="h3" id="ch00lev1sec46"><span class="green1"><strong>TROUBLESHOOTING</strong></span></h3>&#13;
<p class="ques"><strong>Q.</strong> <em>The code compiles, but the stepper motor does not move.</em></p>&#13;
<p class="bull">• When you power the motor, lights should blink on the driver motor board. If they don’t, there’s an issue with power, so check that your setup matches the circuit diagram in <a href="ch11.xhtml#ch11fig3">Figure 11-3</a>. Make sure the stepper motor connection is firmly inserted into the driver motor board—it can only go in one way.</p>&#13;
<p class="bull">• If the driver board lights but the motor does not move, check that the connections to the potentiometer are secure and match the tables shown earlier.</p>&#13;


<h2 class="h2s" id="ch12"><span epub:type="pagebreak" id="page_98"/><strong>12<br/>Temperature-Controlled Fan</strong></h2>&#13;
<p class="intro"><span class="green1">In this project, we’ll use an LM35 temperature sensor to turn a fan on automatically when the temperature is too high.</span></p>&#13;
<div class="image"><img alt="Image" src="../images/p0098-01.jpg"/></div>&#13;
<div class="image"><span epub:type="pagebreak" id="page_99"/><img alt="Image" src="../images/p0099-01.jpg"/></div>&#13;
<p class="capg1"><strong>PARTS REQUIRED</strong></p>&#13;
<p class="cap1"><strong>Arduino board</strong></p>&#13;
<p class="cap1"><strong>Breadboard</strong></p>&#13;
<p class="cap1"><strong>Jumper wires</strong></p>&#13;
<p class="cap1"><strong>LM35 temperature sensor</strong></p>&#13;
<p class="cap1"><strong>5V single-channel relay module</strong></p>&#13;
<p class="cap1"><strong>12V mini computer cooling fan</strong></p>&#13;
<p class="cap1"><strong>9V battery snap and battery</strong></p>&#13;
<h3 class="h3" id="ch00lev1sec47"><span epub:type="pagebreak" id="page_100"/><span class="green1"><strong>HOW IT WORKS</strong></span></h3>&#13;
<p class="noindent">The LM35 temperature sensor (shown in <a href="ch12.xhtml#ch12fig1">Figure 12-1</a>) senses the temperature and sends that measurement to the Arduino in voltage. The Arduino converts this voltage value to temperature in degrees Celsius and then converts this value to degrees Fahrenheit. When the temperature reading is above 71 degrees Fahrenheit, the Arduino sends power to the relay, which turns on the computer fan.</p>&#13;
<p class="figcap"><a id="ch12fig1"/><strong>FIGURE 12-1:</strong> The LM35 temperature sensor: the left pin is +5V, center is data out, and right is GND.</p>&#13;
<div class="image"><img alt="Image" src="../images/f12-01.jpg"/></div>&#13;
<p class="indent">The computer fan requires more power than the Arduino can provide, so we need to give it its own power supply: a 9V battery. This circuit is controlled by an <em>electronic relay</em>—an electronically operated switch that in this case uses an electromagnet to mechanically open or close the circuit (shown in <a href="ch12.xhtml#ch12fig2">Figure 12-2</a>). A relay is generally used when a low-power device is required to switch on or off a much higher-voltage device. Our relay is powered by 5 volts to operate the mechanical switch. In this project the circuit is only 9 volts, but the relay could control a circuit up to 240 volts. Adding higher-voltage circuits can be very dangerous, however, so do this only if you are comfortable working with electricity or can seek professional advice.</p>&#13;
<p class="figcap"><a id="ch12fig2"/><strong>FIGURE 12-2:</strong> A 5V single-channel relay</p>&#13;
<div class="image"><img alt="Image" src="../images/f12-02.jpg"/></div>&#13;
<h3 class="h3" id="ch00lev1sec48"><span epub:type="pagebreak" id="page_101"/><span class="green"><strong>THE BUILD</strong></span></h3>&#13;
<ol>&#13;
<li><p class="noindents">Insert the LM35 sensor into the breadboard with the front of the sensor (the flat surface with text on it) facing you. Connect the left pin to the +5V rail on the breadboard, the center pin to Arduino A0, and the right pin to the GND rail, as shown in the following table.</p>&#13;
<table class="all">&#13;
<thead>&#13;
<tr>&#13;
<td class="table_thg" style="vertical-align: top;"><p class="tablec"><strong>LM35 SENSOR</strong></p></td>&#13;
<td class="table_th" style="vertical-align: top;"><p class="tablec"><strong>ARDUINO</strong></p></td>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td class="table_1g" style="vertical-align: top;"><p class="tablec"><span class="green1">Left pin</span></p></td>&#13;
<td class="table_2" style="vertical-align: top;"><p class="tablec"><span class="green1">+5V</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1g" style="vertical-align: top;"><p class="tablec"><span class="green1">Center pin</span></p></td>&#13;
<td class="table_2" style="vertical-align: top;"><p class="tablec"><span class="green1">A0</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1g" style="vertical-align: top;"><p class="tablec"><span class="green1">Right pin</span></p></td>&#13;
<td class="table" style="vertical-align: top;"><p class="tablec"><span class="green1">GND</span></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table></li>&#13;
<li><p class="noindents">There are a number of connections on the relay, as shown in <a href="ch12.xhtml#ch12fig3">Figure 12-3</a>. If your relay module has a different layout, adapt the wiring accordingly (using the data sheet or the pin markings on the module). Our relay has an LED marked PWR to indicate when it’s receiving power, and another LED to show when the electromagnetic switch is on (you can usually hear this, too, as it makes a satisfying clicking noise). The relay can be set to be <code>HIGH</code> or <code>LOW</code> when triggered, as indicated by a small jumper switch or pins. For our project, make sure the jumper is set to <code>HIGH</code> so the relay will send power when it is triggered.</p>&#13;
<p class="figcap"><a id="ch12fig3"/><strong>FIGURE 12-3:</strong> Relay connections (your relay pins may differ, so follow the data sheet provided)</p>&#13;
<div class="image"><img alt="Image" src="../images/f12-03.jpg"/></div></li>&#13;
<li><p class="noindents">As <a href="ch12.xhtml#ch12fig3">Figure 12-3</a> shows, the pins on the right side of the relay module are Signal, GND, and +5V. Attach the relay’s Signal pin to Arduino pin 5, GND to Arduino GND, and +5V to the Arduino power via the breadboard rails.</p>&#13;
<table class="all">&#13;
<thead>&#13;
<tr>&#13;
<td class="table_thg" style="vertical-align: top;"><p class="tablec"><strong>5V RELAY</strong></p></td>&#13;
<td class="table_th" style="vertical-align: top;"><p class="tablec"><strong>ARDUINO</strong></p></td>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td class="table_1g" style="vertical-align: top;"><p class="tablec"><span class="green1">Signal</span></p></td>&#13;
<td class="table_2" style="vertical-align: top;"><p class="tablec"><span class="green1">Pin 5</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1g" style="vertical-align: top;"><p class="tablec"><span class="green1">GND</span></p></td>&#13;
<td class="table_2" style="vertical-align: top;"><p class="tablec"><span class="green1">GND</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1g" style="vertical-align: top;"><p class="tablec"><span class="green1">+5V</span></p></td>&#13;
<td class="table" style="vertical-align: top;"><p class="tablec"><span class="green1">+5V</span></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table></li>&#13;
<li><p class="noindents"><span epub:type="pagebreak" id="page_102"/>On the left side of the relay module are the connections for the electromagnetic switch (<a href="ch12.xhtml#ch12fig3">Figure 12-3</a>). The center pin is the common connection; the left pin is marked NO for <em>normally open</em>, meaning the circuit is broken and the default state is off; and the right pin is marked NC for <em>normally closed</em>, meaning the default state is on. If the relay is not switched, the common pin is connected to the NC pin. If the relay is switched, the common pin is connected to the NO pin. Because we want the circuit to be off until we use the switch, we will use the NO pin.</p></li>&#13;
<li><p class="noindents">Next, connect the black GND wire of the fan to the GND wire of the 9V battery. Then, as shown in the following table, attach the red positive wire of the fan to the common pin on the relay, and connect the positive wire of the 9V battery to NO on the relay.</p>&#13;
<table class="all">&#13;
<thead>&#13;
<tr>&#13;
<td class="table_thg" style="vertical-align: top;"><p class="tablec"><strong>5V RELAY</strong></p></td>&#13;
<td class="table_th" style="vertical-align: top;"><p class="tablec"><strong>FAN/9V BATTERY</strong></p></td>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td class="table_1g" style="vertical-align: top;"><p class="tablec"><span class="green1">NO (normally open)</span></p></td>&#13;
<td class="table_2" style="vertical-align: top;"><p class="tablec"><span class="green1">9V battery’s positive wire</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1g" style="vertical-align: top;"><p class="tablec"><span class="green1">Common</span></p></td>&#13;
<td class="table_2" style="vertical-align: top;"><p class="tablec"><span class="green1">Fan’s positive wire</span></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td class="table_1g" style="vertical-align: top;"><p class="tablec"><span class="green1">NC (normally closed)</span></p></td>&#13;
<td class="table" style="vertical-align: top;"><p class="tablec"><span class="green1">Not connected</span></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table></li>&#13;
<li><p class="noindents">Connect the breadboard power rails to each other and to the Arduino GND and +5V pins.</p></li>&#13;
<li><p class="noindents">Make sure your setup matches the circuit diagram in <a href="ch12.xhtml#ch12fig4">Figure 12-4</a>, and then upload the code in “<a href="ch12.xhtml#ch00lev1sec49">The Sketch</a>” on <a href="ch12.xhtml#page_103">page 103</a>.</p>&#13;
<p class="figcap"><a id="ch12fig4"/><strong>FIGURE 12-4:</strong> The circuit diagram for the temperature-controlled fan</p>&#13;
<div class="image"><img alt="Image" src="../images/f12-04.jpg"/></div></li>&#13;
</ol>&#13;
<h3 class="h3" id="ch00lev1sec49"><span epub:type="pagebreak" id="page_103"/><span class="green1"><strong>THE SKETCH</strong></span></h3>&#13;
<p class="noindent">In this sketch we first set the sensor pin for the LM35 as A0 on the Arduino, define the fan as pin 5, and create a variable to read the value from the LM35. We then create a variable to store the temperature and set the fan pin as an output. A small calculation turns the voltage reading from the sensor into a temperature value in degrees Fahrenheit. We then start the Serial Monitor so you can see the LM35 reading value when the Arduino is connected to your PC, which is handy for making sure the sensor is working correctly. A loop reads the sensor every second, and if the temperature reaches 71 degrees Fahrenheit, power is sent to the fan pin, which triggers the relay and switches on the fan. If the temperature falls below 71, the relay switches the fan off.</p>&#13;
<p class="programs1">#define SENS_PIN A0 <span class="ash">// Defines A0 pin as "sensor"</span><br/>#define FAN_PIN 5<br/><span class="green1">int</span> Vin; <span class="ash">// Reads value from Arduino pin</span><br/><span class="green1">float</span> Temperature; <span class="ash">// Receives converted voltage value to temp</span><br/><span class="green1">float</span> TF; <span class="ash">// Receives converted value in °F</span><br/><br/><span class="green1">void</span> <span class="green2">setup</span>() {<br/>  <span class="orange">pinMode</span>(FAN_PIN, <span class="green1">OUTPUT</span>); <span class="ash">// Fan pin as an output</span><br/>  <span class="orange">Serial.begin</span>(9600); <span class="ash">// Start Serial Monitor</span><br/>}<br/><br/><span class="green1">void</span> loop() {<br/>  <span class="ash">// Tells Arduino to read pin and stores value in Vin</span><br/>  Vin = <span class="orange">analogRead</span>(SENS_PIN);<br/><br/>  <span class="ash">// Converts voltage value into temperature and</span><br/>  <span class="ash">// stores value in Temperature (as °F)</span><br/>  Temperature = (500 * Vin) / 1023 * (1.8) + 32;<br/><br/>  TF = Temperature;<br/>  <span class="orange">Serial.print</span>(<span class="green1">"Temperature: "</span>); <span class="ash">// Sends text to display screen</span><br/>  <span class="orange">Serial.print</span>(TF); <span class="ash">// Shows value of temperature in Serial Monitor</span><br/>  <span class="orange">Serial.println</span>(<span class="green1">" F"</span>); <span class="ash">// Writes F to indicate it is in Fahrenheit</span><br/>  <span class="green2">if</span> (TF &gt; 71) { <span class="ash">// If temperature is more than 71</span><br/>    <span class="orange">digitalWrite</span>(FAN_PIN, <span class="green1">HIGH</span>); <span class="ash">// Turn fan on</span><br/>  }<br/>  <span class="green2">else if</span> (TF &lt; 71) {<br/>    <span class="orange">digitalWrite</span>(FAN_PIN, <span class="green1">LOW</span>); <span class="ash">// Or keep fan off</span><br/>  }<br/>  <span class="orange">delay</span>(1000); <span class="ash">// Waits for a second to read the pin again</span><br/>}</p>&#13;
<h3 class="h3" id="ch00lev1sec50"><span epub:type="pagebreak" id="page_104"/><span class="green1"><strong>TROUBLESHOOTING</strong></span></h3>&#13;
<p class="ques"><strong>Q.</strong> <em>The fan does not turn on when expected.</em></p>&#13;
<p class="bull">• Make sure the connections to the LM35 match the tables in this chapter and the circuit diagram in <a href="ch12.xhtml#ch12fig4">Figure 12-4</a>. Connect the Arduino to your computer and open the IDE Serial Monitor to check whether the Arduino is reading the sensor correctly. If the reading is incorrect, recheck your wiring or change the sensor to another.</p>&#13;
<p class="bull">• Remember, your relay may not match the one used here, so the connections may be in a slightly different order; alter the wiring according to your relay and data sheet.</p>&#13;
<p class="bull">• The fan used here takes between 9 and 12 volts, so a 9V battery has enough power to run it. If you used a fan that requires more voltage, you will need to match its voltage input accordingly with a more powerful battery.</p>&#13;
</body></html>