<html><head></head><body>
  <div class="chapter" title="Chapter&#xA0;13.&#xA0;Follow the WEBrick Road">&#13;
    <div class="titlepage">&#13;
      <h1 class="title" id="heading_id_2"><a id="follow_the_webrick_road"/>Chapter 13. Follow the WEBrick Road</h1>&#13;
    </div>&#13;
&#13;
    <div class="sect1" title="Ruby and the Internet">&#13;
      <div class="titlepage">&#13;
        <h1 class="title" id="heading_id_3"><a id="ruby_and_the_internet"/>Ruby and the Internet</h1>&#13;
      </div>&#13;
&#13;
      <p><a class="indexterm" id="iddle1440"/><a class="indexterm" id="iddle1755"/>The King and Queen burst through the Refactory exit and into the bright late-afternoon sunshine, Ruben and Scarlet following hot on their heels. Ahead of them, the WEBrick road stretched far away, its dark red bricks glowing softly. In the distance, they could make out the hunched shapes of the four mysterious villains retreating, and farther still, the wall that marked the outer edge of the kingdom.</p>&#13;
&#13;
      <p>“They’re so fast!” Ruben gasped, his hands on his knees. “We’ll never be able to catch them!”</p>&#13;
&#13;
      <p>“Never say never,” Rusty said, jogging up behind them. “There <span class="emphasis"><em>must</em></span> be something we can do.”</p>&#13;
&#13;
      <p>The Queen turned to him. “Is there any way to shut down the WEBrick road?” she asked.</p>&#13;
&#13;
      <div class="informalfigure">&#13;
        <a id="med_id00061a"/>&#13;
&#13;
        <div class="mediaobject"><a id="med_id00061"/><img alt="image with no caption" src="../Images/httpatomoreillycomsourcenostarchimages2160075.png.jpg"/></div>&#13;
      </div>&#13;
&#13;
      <p>Rusty thought for a moment. “I’m not sure,” he said, “but I have an idea.” He flipped up all the pages of his clipboard and pulled out a thin piece of metal with a familiar-looking screen. “This is my portable Computing Contraption,” he said. “My workers and I will go on ahead and try to catch these snakes. In the meantime, if there’s anything you can do to shut down the road and keep them from escaping, you can do it on this little computer.”</p>&#13;
&#13;
      <p>“Right!” said Scarlet, taking the hand-held computer from the Foreman. Rusty gave her a wink, then motioned to the men and women of the Refactory who were rapidly pouring out of the exit. “This way, everyone! Let’s try to head these villains off! Move, move, move!”</p>&#13;
&#13;
      <p>As the Refactory workers ran down the deep red road, the King, the Queen, Scarlet, and Ruben huddled around the Foreman’s portable Computing Contraption.</p>&#13;
&#13;
      <p>“Okay, first things first,” said Scarlet. “How can we shut down the road?”</p>&#13;
&#13;
      <p>The King tugged on his fluffy white beard. “It seems to me,” he said, “that we should first check to be sure the road <a class="indexterm" id="iddle1351"/><a class="indexterm" id="iddle1354"/><a class="indexterm" id="iddle1438"/><a class="indexterm" id="iddle1635"/><a class="indexterm" id="iddle1721"/>is working properly! If it’s already off for some reason, we can join Rusty’s team up ahead and apprehend these goons.”</p>&#13;
&#13;
      <p>Scarlet and Ruben looked at each other. “That’s . . . actually a great idea,” Ruben said. “How do we test to see if the road is open?”</p>&#13;
&#13;
      <p>“Well,” said the King, “the WEBrick road, like all things in the kingdom, runs on Ruby, and it’s the main connection between the kingdom and the rest of the world. If we can use Ruby to check whether we can get information from outside the kingdom, we’ll know if the road is working.”</p>&#13;
&#13;
      <p>“That’s it!” said Ruben. “If we can connect to the Internet with Ruby, then we’ll know the road is open!”</p>&#13;
&#13;
      <p>“But how do we do that?” said Scarlet. “I feel like I know Ruby pretty well now, but I don’t even know where to begin with connecting to the Internet.”</p>&#13;
&#13;
      <p>“I think I know a way,” said the Queen. “You see, connecting to the Internet is just like connecting to a file—you just have to tell Ruby the right way to do it! May I?” she asked. Scarlet nodded and handed the Queen the portable Computing Contraption. The Queen began to type.</p>&#13;
&#13;
      <p>“Remember how we could write our code in separate Ruby files, then use <code class="literal">require</code> to pull one script’s code into another?” the Queen asked. Scarlet and Ruben nodded. “Well,” the Queen continued, “it turns out there are little bundles of files that come with Ruby that we can <code class="literal">require</code>, too!”</p>&#13;
&#13;
      <p>“There are?” asked the King, incredulous. “Absolutely!” said the Queen. “You can think of these bundles of files as tiny libraries of code that we can use in our own projects. They’re called <span class="emphasis"><em>gems</em></span>.”</p>&#13;
&#13;
      <p>“That’s right! I think I’ve heard of Ruby gems before,” Ruben said. “Is there a gem for connecting to the Internet?”</p>&#13;
    </div>&#13;
&#13;
    <div class="sect1" title="Using the open-uri Ruby Gem">&#13;
      <div class="titlepage">&#13;
        <h1 class="title" id="heading_id_4"><a id="using_the_open-uri_ruby_gem"/>Using the open-uri Ruby Gem</h1>&#13;
      </div>&#13;
&#13;
      <p>The Queen nodded. “The <code class="literal">open-uri</code> gem,” she said. “It lets your Ruby code open Internet sites the same way it can open files! <a class="indexterm" id="iddle1634"/><a class="indexterm" id="iddle1959"/>Once we <code class="literal">require</code> it in our IRB session, we’ll be able to do all sorts of wonderful things.” She typed into the Computing Contraption:</p><a id="pro_id00436"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="red">require 'open-uri'</span>&#13;
=&gt; true&#13;
</pre>&#13;
&#13;
      <p>She handed the little machine back to Scarlet. “Loaded up and ready to go!” she said.</p>&#13;
&#13;
      <p>Scarlet looked at the screen. “Don’t I need <code class="literal">'./open-uri'</code>, not just <code class="literal">'open-uri'</code>?” she asked.</p>&#13;
&#13;
      <p>“Not for gems!” said the Queen. “That’s true for files you create, but if you’re requiring a gem, you can just type the name as a string. One of the many things Ruby does for you is keep track of where gems are installed on your computer. Since it already knows where to find them, you don’t need to look in the current directory with <code class="literal">./</code>. Just type the name of the gem, and Ruby does the rest.”</p>&#13;
&#13;
      <p>“Perfect!” said Scarlet. “Now we just need a website to test whether the WEBrick road is working.”</p>&#13;
&#13;
      <p>“Aha!” said the King, raising a finger in the air. “We can test it with my favorite website!”</p>&#13;
&#13;
      <p>“Which one is that?” asked Scarlet, poised to type into the keyboard.</p>&#13;
&#13;
      <p>“<span class="emphasis"><em>Example.com</em></span>!” the King said, beaming. The Queen rolled her eyes.</p>&#13;
&#13;
      <p>“It’s as good as any,” Scarlet admitted, and she typed into the tiny Computing Contraption.</p>&#13;
&#13;
      <div class="note" title="Note">&#13;
        <h3 class="title" id="heading_id_5"><a id="ch13note01"/>Note</h3>&#13;
&#13;
        <p><span class="emphasis"><em>You’ll need to be connected to the Internet for this code to work! Go ahead and grab your local adult if you need help connecting to the Internet.</em></span></p>&#13;
      </div><a id="pro_id00437"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="red">site = open('http://www.example.com')</span>&#13;
=&gt; #&lt;StringIO:0x000001032de2f0&gt;&#13;
</pre>&#13;
&#13;
      <p>“First,” Scarlet said, “we’ve used the <code class="literal">open</code> method to tell Ruby to create an object based on the website of the URL we entered. Then we can just use the <code class="literal">.read</code> method as we did on a regular text file, and that will give us the contents of the site at <span class="emphasis"><em><a class="ulink" href="http://www.example.com">www.example.com</a></em></span>!”</p><a id="pro_id00438"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="red">site.read</span>&#13;
=&gt; "&lt;!doctype html&gt;...&#13;
</pre>&#13;
&#13;
      <p>The screen quickly filled with code from the <span class="emphasis"><em>example.com</em></span> website.</p>&#13;
&#13;
      <p>“It’s working!” Scarlet said. “The WEBrick road must be turned on. Now we just need to find a way to shut it down!”</p>&#13;
&#13;
      <p>Ruben thought for a moment. “Hey, wait,” he said, “does the kingdom request <span class="emphasis"><em>and</em></span> send information through the WEBrick road?”</p>&#13;
&#13;
      <p>“It does,” said the King.</p>&#13;
&#13;
      <p>“Does that mean there’s some kind of <span class="emphasis"><em>web server</em></span> running?” Ruben asked.</p>&#13;
&#13;
      <p>The Queen snapped her fingers. “Ruben, you’re a genius!” she said. Ruben blushed slightly. The Queen turned to Scarlet. “Not only is there a web server running, but it’s a <span class="emphasis"><em>WEBrick web server</em></span>.” She began talking quickly and gesturing excitedly. “The WEBrick server is a special piece of Ruby code that sends information out of the kingdom. You see, when you visit a website, you’re asking a web server—that is, a computer somewhere on the Internet—for information. Well, when people on the Internet want information about our kingdom, our very own WEBrick web server sends it!”</p>&#13;
&#13;
      <div class="note" title="Note">&#13;
        <h3 class="title" id="heading_id_6"><a id="ch13note02"/>Note</h3>&#13;
&#13;
        <p><span class="emphasis"><em>The WEBrick server isn’t something that exists only in the kingdom—that’s the real name of the Ruby web server you’re using right on your own computer!</em></span></p>&#13;
      </div>&#13;
&#13;
      <p>“And if that web server is turned off . . .” Ruben began. “. . . then nothing and no one can get out of the kingdom!” Scarlet finished.</p>&#13;
&#13;
      <p>“Now we just need to figure out how to find the server to shut it down,” Ruben said.</p>&#13;
&#13;
      <p>“Well,” said the King, kicking at a bit of dust, “I actually might be able to help with that. You see, I lose things so frequently that I’ve gotten to know the Computing Contraption’s search function very well.”</p>&#13;
&#13;
      <p>“Perfect!” said Scarlet. “What do we think the file is called?”</p>&#13;
    </div>&#13;
&#13;
    <div class="sect1" title="Investigating the Kingdom’s Web Server">&#13;
      <div class="titlepage">&#13;
        <h1 class="title" id="heading_id_7"><a id="investigating_the_kingdomapostrophes_web"/>Investigating the Kingdom’s Web Server</h1>&#13;
      </div>&#13;
&#13;
      <p><a class="indexterm" id="iddle1220"/><a class="indexterm" id="iddle1692"/><a class="indexterm" id="iddle1799"/><a class="indexterm" id="iddle1819"/><a class="indexterm" id="iddle1950"/>“Well, you might want to search for <span class="emphasis"><em>WEBrick</em></span> or <span class="emphasis"><em>server</em></span>,” the King said. “That’s what I’d do, at any rate.”</p>&#13;
&#13;
      <p>Scarlet nodded and pressed a few keys, searching for the file. She squinted, shook her head, typed, sighed, thought, and typed some more.</p>&#13;
&#13;
      <p>“I think I’ve got it!” she finally said. “I found a file called <span class="emphasis"><em>server.rb</em></span>.”</p>&#13;
&#13;
      <p>“Open it, open it!” said Ruben, standing on tiptoe to see the screen better.</p>&#13;
&#13;
      <p>Scarlet opened the <span class="emphasis"><em>server.rb</em></span> file, and this is what they saw:</p><a id="pro_id00439"/>&#13;
      <pre class="programlisting">&#13;
require 'webrick'&#13;
include WEBrick&#13;
&#13;
server = HTTPServer.new(&#13;
  :Port =&gt; 3000,&#13;
  :DocumentRoot =&gt; Dir.pwd&#13;
)&#13;
trap('INT') { server.shutdown }&#13;
&#13;
server.start&#13;
</pre>&#13;
&#13;
      <p>“Let’s see,” said Scarlet. “It looks like the first two lines <code class="literal">require</code> the <code class="literal">webrick</code> gem and include the <code class="literal">WEBrick</code> module.”</p>&#13;
&#13;
      <p>“That looks right to me,” said Ruben. “Then it looks like the next few lines create a new WEBrick server. I’m not sure what the <code class="literal">port</code> is for, but it’s set to the number <code class="literal">3000</code>. What does the <code class="literal">Dir.pwd</code> part mean?”</p>&#13;
&#13;
      <p>“I think I know,” said the Queen. “Just like Ruby uses the <code class="literal">File</code> class for methods that work on files, it uses the <code class="literal">Dir</code> class for methods that work on <span class="emphasis"><em>directories</em></span>, which is just a fancy way of saying <span class="emphasis"><em>folders</em></span>.” The Queen pointed to the screen. “The <code class="literal">pwd</code> method returns the <span class="emphasis"><em>present working directory</em></span>, so <code class="literal">Dir.pwd</code> is just Ruby’s way of saying ‘this folder right here.’ The web server is running, and it’s sending information out of this folder!”</p>&#13;
&#13;
      <p><a class="indexterm" id="iddle1441"/><a class="indexterm" id="iddle1803"/><a class="indexterm" id="iddle1952"/>“Okay!” said Scarlet. “We’ve just got to shut it down, and I think I see a clue. The <code class="literal">trap('INT') { server.shutdown }</code> line—what does that do?”</p>&#13;
&#13;
      <p>The Queen studied the screen for a minute. “If I remember correctly, that’s Ruby’s way of saying that when it gets an <span class="emphasis"><em>interrupt signal</em></span>, it will shut down the server!”</p>&#13;
&#13;
      <p>“An interrupt signal?” Ruben asked. “Does that mean we have to tell the server to quit running?”</p>&#13;
&#13;
      <p>“Exactly,” said the Queen. “But how?”</p>&#13;
&#13;
      <p>“Hold down the <span class="smaller">CTRL</span> key and the C key at the same time!” the King suddenly. Everyone turned to look at him. “Just do it!” he urged, waving his hands in the air. “We haven’t a moment to lose!” Scarlet nodded and immediately pressed the keys, and this is what she saw:</p><a id="pro_id00440"/>&#13;
      <pre class="programlisting">&#13;
INFO going to shutdown ...&#13;
INFO WEBrick::HTTPServer#start done.&#13;
</pre>&#13;
&#13;
      <p>“We did it! We did it!” Scarlet and Ruben jumped up and down and hugged each other.</p>&#13;
&#13;
      <p>The Queen turned to the King, smiling. “How on <span class="emphasis"><em>Earth</em></span> did you know how to do that?” she asked him.</p>&#13;
&#13;
      <p>The King smiled sheepishly. “Well, I manage to break my Computing Contraption so often, I’ve learned to use <span class="smaller">CTRL</span>-C to stop programs!” They all burst into laughter.</p>&#13;
&#13;
      <p>“Now that the server is shut down,” Scarlet said, “nothing and no one can get out of the kingdom! Quick, let’s get down the WEBrick road and see if we stopped the bad guys in time!”</p>&#13;
&#13;
      <p>The four of them hurried down the bright red path, hoping against hope that they’d closed the WEBrick road in time. In the distance, they could see the huge group of Refactory workers milling around. As they got closer, they could start to pick out individual workers, then faces. Soon they were close enough to see that Rusty was frantically waving them over, and just beyond him in the center of the group were the four hooded hooligans!</p>&#13;
&#13;
      <p>“Great coats! Sweet breakfast gravy! Glorious corn muffins! We’ve got them!” cried the King, nearly weeping with joy.</p>&#13;
&#13;
      <p>As they ran up to the group, the Foreman turned to them, beaming. “Your Majesty! Your Highness!” he said, addressing the King and Queen in turn. “I don’t know how you did it, but you shut down the WEBrick road long enough for us to catch these villains! They were pulling on the gates to the kingdom wall, trying to escape, when we cornered them here.” He crossed his arms and smiled, his entire big bushy beard rising on his face. “I’m pleased to formally hand them over to you.”</p>&#13;
&#13;
      <p>“Thank you, Rusty,” said the Queen. The King and Queen moved into the center of the group, where two Refactory workers each held one of the four mysterious figures. Ruben and Scarlet followed close behind.</p>&#13;
&#13;
      <p>“You scoundrels have been creating utter pandemonium in our kingdom!” the King said.</p>&#13;
&#13;
      <p>“And depriving all the citizens in the kingdom of their Purple Panda-monium Parade,” the Queen said, frowning.</p>&#13;
&#13;
      <p>“Yes, precisely,” said the King. “And we’ve had enough of it! It’s time for you to reveal who you <span class="emphasis"><em>really</em></span> are.” The King nodded to the Refactory workers. Each placed a hand on either side of each prankster’s hood.</p>&#13;
&#13;
      <p>“On my count. One . . . two . . . two and a half . . . <span class="emphasis"><em>three</em></span>!” cried the King, and the workers yanked back the hoods. The crowd gasped. Standing before them, flicking their tongues and hissing, were four enormous snakes!</p>&#13;
&#13;
      <div class="informalfigure">&#13;
        <a id="med_id00062a"/>&#13;
&#13;
        <div class="mediaobject"><a id="med_id00062"/><img alt="image with no caption" src="../Images/httpatomoreillycomsourcenostarchimages2160077.png.jpg"/></div>&#13;
      </div>&#13;
&#13;
      <p><a class="indexterm" id="iddle1693"/>“Literal snakes!” said Rusty. “How about that?”</p>&#13;
&#13;
      <p>“Pythonssss, actually,” hissed the snake nearest to Rusty.</p>&#13;
&#13;
      <p>“Sweet hibbeldy-jibbeldy! A talking snake!” said the King, hiding behind a particularly brawny Refactory worker.</p>&#13;
&#13;
      <p>“The name issss Terry,” the snake said. “Terry One, actually.” She gestured with her head to the snake next to her. “That’s John,” she said. “Then Terry Two, then Graham.”</p>&#13;
&#13;
      <p>“Pleassssed to meet you,” said John.</p>&#13;
&#13;
      <p>“Well, we’re certainly not pleased to meet <span class="emphasis"><em>you</em></span>,” said the King, recovering his courage. “What in the name of the Carmine Pines did you think you all were <span class="emphasis"><em>doing</em></span>, causing such trouble?” He started counting on his fingers. “Stealing my string! Clogging the Mysterious Pipe! Looping up the Loop! Crashing the Hashery’s Computing Contraption! Hacking into the Queen’s machine! De-purpling the pandas! The list goes on and on!”</p>&#13;
&#13;
      <p>Graham looked around uneasily. “Your ssssstring? We didn’t steal your ssstring!” he said.</p>&#13;
&#13;
      <p>The King threw up his hands. “Okay, fine, maybe that was me,” he said, “but the rest was all your doing. I demand an explanation!”</p>&#13;
&#13;
      <p>Terry Two lowered her head; Ruben and Scarlet couldn’t tell if she was angry or sad. “It’s becaussse everyone was all about Ruby, Ruby, Ruby!” she said. “No one wanted to use Python anymore.”</p>&#13;
&#13;
      <p>“Python?” asked Ruben.</p>&#13;
&#13;
      <p>“You ssssee?” said Terry Two, nodding her head at Ruben. “The boy’s never even heard of Python!”</p>&#13;
&#13;
      <p>“What is it?” Ruben asked, inching forward.</p>&#13;
&#13;
      <p>Terry Two sighed. “A programming language, very much like Ruby,” she said.</p>&#13;
&#13;
      <p>“But better,” John piped up.</p>&#13;
&#13;
      <p>“Oh, much better,” Terry One chimed in.</p>&#13;
&#13;
      <p>“But no one in the kingdom uses it,” Terry Two continued.</p>&#13;
&#13;
      <p>“We thought if we got people thinking that sssssomething was wrong with Ruby, they might make the sssswitch.”</p>&#13;
&#13;
      <p>Scarlet stepped closer to the pythons, angry. “You should have tried to show how good a language Python is, not try to make people think there’s something wrong with Ruby!” she scolded.</p>&#13;
&#13;
      <p><a class="indexterm" id="iddle1694"/><a class="indexterm" id="iddle1745"/>John shook his head sadly. “No one would lissssssten,” he said, “so we thought our besssst chance would be to attract attention, even if it had to be negative.” No one could be quite sure, but it looked like the enormous snake had tears in his eyes.</p>&#13;
&#13;
      <p>The King’s expression softened a bit. “You all know Python?” he asked.</p>&#13;
&#13;
      <p>The pythons looked at each other, clearly confused. They slowly nodded.</p>&#13;
&#13;
      <p>“Tell me about it,” said the King.</p>&#13;
&#13;
      <p>“It’s quite a wonderful language,” said Graham. “It has sssstrings and numbers and Booleans.”</p>&#13;
&#13;
      <p>“Arrays, too!” added Terry One.</p>&#13;
&#13;
      <p>“Objects and methods and classsses,” said John, “and you can write programs that do anything you like.”</p>&#13;
&#13;
      <p>The King nodded, walking in a small circle. “It seems to me,” he said, “that Ruby and Python aren’t all that different, then.”</p>&#13;
&#13;
      <p>The pythons were silent for a moment. “Perhapssss not,” John said, finally. “But if that’ssss so, why not use Python instead of Ruby?”</p>&#13;
&#13;
      <p>“I suppose my question,” the King said, “is why do you need to choose? Why not write whichever you prefer?” Terry One opened her mouth to speak, but the King continued. “In fact,” he said, “what if I told you that it’s possible to write Ruby that <span class="emphasis"><em>turns into Python</em></span>?”</p>&#13;
&#13;
      <p>There was total silence. Ruben, Scarlet, and the Queen shot one another amazed looks.</p>&#13;
&#13;
      <p>“You see,” said the King, “I’ve never been a very good programmer. Programming has never come easily to me. So I spend much of my time practicing and reading articles and sample code, trying to become better.” He reached into his robe and pulled out a small scroll. “During my research, I discovered a truly amazing bit of code that can transform Ruby code into instructions that Python can understand. You can write Ruby, and Python programs will come out! Isn’t that amazing?” he asked, becoming excited. “You can write <span class="emphasis"><em>any language</em></span> you want <span class="emphasis"><em>any way</em></span> you want, and you can still tell stories to a computer that will make it do anything you like. That’s the beauty of programming!”</p>&#13;
&#13;
      <p>The pythons didn’t say anything for a moment. Finally, Terry One spoke up. “I . . . hadn’t thought of it that way before,” she said.</p>&#13;
&#13;
      <p>“I suppose what I’m trying to say,” said the King, “is that all curiosity, all honest desire to learn, all sharing and teaching, is <span class="emphasis"><em>always</em></span> welcome in this kingdom. Yes, we happen to use Ruby to run our day-to-day lives. Yes, it’s the language that many of our citizens know and prefer and even <span class="emphasis"><em>think</em></span> in. But that doesn’t make it the only way, and it certainly doesn’t mean we think there’s nothing to learn from Python!”</p>&#13;
&#13;
      <p>Rusty cupped his hands around his mouth. “Hear, hear!” he said, and the entire crowd burst into applause.</p>&#13;
&#13;
      <p>“What do you say?” the King asked gently, approaching the four pythons. “Would you like to help us learn a bit about Python, and we can teach you some Ruby?”</p>&#13;
&#13;
      <p>The pythons exchanged glances, then began to nod.</p>&#13;
&#13;
      <p>“We’re ssssso terribly ssssorry,” Graham said. “We were just ssssad and frusssstrated, and we didn’t know how to tell everyone how we felt.”</p>&#13;
&#13;
      <p>“We hope we didn’t wreck anything too badly,” Terry Two said.</p>&#13;
&#13;
      <p>“We’ll help repair anything we broke,” Terry One added.</p>&#13;
&#13;
      <p>“I tried the hash at Hank’ssss Hashery,” John said. “It was the mosssst amazing food I’ve ever tasted. I’d help fix a hundred Ruby programs if I could eat there again!”</p>&#13;
&#13;
      <p>“Then it’s settled!” the King said. He looked at the Queen, who smiled and nodded. He returned his gaze to the four pythons. “By the power vested in me by the many citizens of my kingdom, you are hereby officially pardoned of all wrongdoing!” He leaned forward slightly. “And if you’d like to come back to the palace for some cake and tea, that would be fine, too.”</p>&#13;
&#13;
      <p>The pythons nodded eagerly, overjoyed. “That would be sssssplendid,” said Terry One. “Thank you sssso much!”</p>&#13;
&#13;
      <p>The King held his arms over his head. “Everyone back to the Royal Palace!” he cried. “Cake and tea for everyone!”</p>&#13;
&#13;
      <p><a class="indexterm" id="iddle1956"/>A massive cheer went up in the crowd. The Refactory workers who had been holding the pythons released them, and the group swept the King, the Queen, Scarlet, and Ruben up onto their shoulders.</p>&#13;
&#13;
      <p>“You really saved the day, Your Kingliness!” Scarlet said to the King. He dismissed the compliment with a wave of his hand.</p>&#13;
&#13;
      <p>“You kids did all the saving!” he said. “Without you, we’d never have solved this mystery and brought peace and prosperity back to the kingdom.”</p>&#13;
&#13;
      <p>“Let’s say we <span class="emphasis"><em>all</em></span> had a piece of the pie,” said the Queen. “And speaking of! Let’s add a little pie to this cake-and-tea party.”</p>&#13;
&#13;
      <p>“Let’s!” said the King, who had been patting the pockets of his robe for the last several seconds. “Oh, turnips,” he said. “Now where did I put my string?”</p>&#13;
&#13;
      <div class="informalfigure">&#13;
        <a id="med_id00063a"/>&#13;
&#13;
        <div class="mediaobject"><a id="med_id00063"/><img alt="image with no caption" src="../Images/httpatomoreillycomsourcenostarchimages2160079.png.jpg"/></div>&#13;
      </div>&#13;
    </div>&#13;
&#13;
    <div class="sect1" title="Beyond the Kingdom Walls">&#13;
      <div class="titlepage">&#13;
        <h1 class="title" id="heading_id_8"><a id="beyond_the_kingdom_walls"/>Beyond the Kingdom Walls</h1>&#13;
      </div>&#13;
&#13;
      <p>Holy cannoli! Pythons! I wouldn’t have seen that coming 42 miles away. I’ve still got so many questions! How did they sneak into the kingdom? What cool Python tricks do they know that a Ruby programmer like me could learn? And how did they manage to work a Key-a-ma-Jigger with no hands?</p>&#13;
&#13;
      <p>While I ponder these and other great mysteries, feel free to get in a little more practice with the WEBrick web server. Go ahead and create a new file called <span class="bolditalic red">web_server.rb</span> and type in the following code.</p>&#13;
&#13;
      <p><a class="indexterm" id="iddle1389"/><a class="indexterm" id="iddle1559"/><a class="indexterm" id="iddle1955"/><a class="indexterm" id="iddle1957"/><span class="bolditalic red">web_server.rb</span></p><a id="pro_id00441"/>&#13;
      <pre class="programlisting">&#13;
require 'webrick'&#13;
include WEBrick&#13;
&#13;
server = HTTPServer.new(Port: 3000)&#13;
&#13;
server.mount_proc '/' do |request, response|&#13;
  response.body = 'Your Ruby adventure is just beginning!'&#13;
end&#13;
&#13;
trap('INT') { server.shutdown }&#13;
&#13;
server.start&#13;
</pre>&#13;
&#13;
      <p>This code’s a bit different from the last version you saw, but there’s nothing here you haven’t seen! The only tricky bit is the <code class="literal">mount_proc</code> method, which is built into WEBrick. This tells the server how to respond to certain requests; in this case, if you go to the <code class="literal">/</code> URL on your computer, you should see the message assigned to <code class="literal">response.body</code>. Your computer’s built-in website is <span class="emphasis"><em>http://localhost/</em></span>.</p>&#13;
&#13;
      <p>As usual, you can run your finished script by typing <span class="strong"><strong><span class="red"><code class="literal">ruby web_server.rb</code></span></strong></span> in the terminal. Once you’ve started your script, you should see some numbers and text, like this:</p><a id="pro_id00442"/>&#13;
      <pre class="programlisting">&#13;
INFO WEBrick 1.3.1&#13;
INFO WEBrick::HTTPServer#start: pid=78115 port=3000&#13;
</pre>&#13;
&#13;
      <p>(Your numbers will be slightly different, but the words should be pretty similar.) When you see the text appear, your web server is up and running! Open your favorite web browser (such as Chrome, Firefox, Internet Explorer, or Safari) and go to <span class="emphasis"><em>http://localhost:3000/</em></span>. If everything’s working right, you should see <code class="literal">Your Ruby adventure is just beginning!</code> in the browser window. Crazy, right? Your first website has just been born! (I’m gonna name her Marigold.) When you’re done using your server, hold down <span class="smaller">CTRL</span>-C in the terminal where WEBrick is running to shut it down.</p>&#13;
&#13;
      <p><a class="indexterm" id="iddle1356"/><a class="indexterm" id="iddle1695"/><a class="indexterm" id="iddle1746"/><a class="indexterm" id="iddle1762"/><a class="indexterm" id="iddle1765"/>This web server is a pretty simple affair, and if I know you, you’re already thinking of ways to make it better. Well, don’t hold back! Feel free to play with the code in the <span class="emphasis"><em>web_server.rb</em></span> file. (You’ll need to use <span class="smaller">CTRL</span>-C to shut down the server and restart it each time you make changes in order to see them.) For example, you could start just by changing the <code class="literal">response.body</code> string, then move on to playing with the port number or adding more <code class="literal">mount_proc</code>s.</p>&#13;
&#13;
      <p>Here’s a hint: What if you add the following code to your <span class="emphasis"><em>web_server.rb</em></span> file, then go to <span class="emphasis"><em>http://localhost:3000/favorite_vegetable</em></span>?</p><a id="pro_id00443"/>&#13;
      <pre class="programlisting">&#13;
server.mount_proc '/favorite_vegetable' do |request, response|&#13;
  response.body = 'Certainly not yams!'&#13;
end&#13;
</pre>&#13;
&#13;
      <p>If you want to see the gems that people all over the world have made available, you can visit the RubyGems website at <span class="emphasis"><em><a class="ulink" href="http://rubygems.org/">http://rubygems.org/</a></em></span>. For just about any task, someone has probably created a gem to do it, so you should always stop by RubyGems. Take your time to read through the information on the site, and you’ll be able to download other people’s gems and use them in no time!</p>&#13;
&#13;
      <p>Speaking of sharing code, that magical little program that can convert Ruby to Python really does exist! It was written by a programmer named <span class="emphasis"><em>why the lucky stiff</em></span> and can be found on <span class="emphasis"><em>GitHub</em></span>, a website where people share the code they write with people all across the planet. You can find the GitHub website at <span class="emphasis"><em><a class="ulink" href="https://github.com/">https://github.com/</a></em></span> and the Ruby-to-Python project—called <span class="emphasis"><em>unholy</em></span>—at <span class="emphasis"><em><a class="ulink" href="https://github.com/whymirror/unholy/">https://github.com/whymirror/unholy/</a></em></span>. (The code is very advanced, but if you keep at it, I think you’ll start to get it. I’ve yet to meet a brighter bulb!)</p>&#13;
    </div>&#13;
&#13;
    <div class="sect1" title="You Know This!">&#13;
      <div class="titlepage">&#13;
        <h1 class="title" id="heading_id_9"><a id="you_know_thisexclamation_mark-id00013"/>You Know This!</h1>&#13;
      </div>&#13;
&#13;
      <p>We took some of the code and concepts you already knew a few steps further in this chapter, so let’s take a second to make sure it all made sense.</p>&#13;
&#13;
      <p><a class="indexterm" id="iddle1352"/><a class="indexterm" id="iddle1636"/><a class="indexterm" id="iddle1951"/><a class="indexterm" id="iddle1953"/>You learned that we can use Ruby to get information about websites on the Internet by using the <code class="literal">open-uri</code> gem:</p><a id="pro_id00444"/>&#13;
      <pre class="programlisting">&#13;
&gt;&gt; <span class="red">require 'open-uri'</span>&#13;
=&gt; true&#13;
&#13;
&gt;&gt; <span class="red">site = open('http://www.example.com')</span>&#13;
=&gt; #&lt;StringIO:0x000001032de2f0&gt;&#13;
&#13;
&gt;&gt; <span class="red">site.read</span>&#13;
=&gt; "&lt;!doctype html&gt;...&#13;
</pre>&#13;
&#13;
      <p>A <span class="emphasis"><em>gem</em></span> is just a set of files that someone else created to make writing your Ruby programs easier. We can <code class="literal">require</code> gems into our programs just as we can <code class="literal">require</code> files we wrote ourselves, only we need to put a <code class="literal">./</code> before our filenames, and for gems, we can just write the name as a string after the <code class="literal">require</code> method call.</p>&#13;
&#13;
      <p>Feel free to try this code with other websites! Just be sure to get permission first, and be careful—some websites send back a <span class="emphasis"><em>lot</em></span> of code, and it may fill up your terminal window.</p>&#13;
&#13;
      <p>You also saw that we don’t have to settle for just <span class="emphasis"><em>requesting</em></span> information; we can <span class="emphasis"><em>serve</em></span> it to visitors using <span class="emphasis"><em>web servers</em></span> like WEBrick:</p><a id="pro_id00445"/>&#13;
      <pre class="programlisting">&#13;
require 'webrick'&#13;
include WEBrick&#13;
&#13;
server = HTTPServer.new(:Port =&gt; 3000)&#13;
&#13;
server.mount_proc '/' do |request, response|&#13;
  response.body = 'WEBrick is online and running fine!'&#13;
end&#13;
&#13;
trap('INT') { server.shutdown }&#13;
&#13;
server.start&#13;
</pre>&#13;
&#13;
      <p>You learned that we can modify web server code to write simple messages, that we can see the changes in our code by stopping and restarting the server, and that <span class="smaller">CTRL</span>-C will let us <a class="indexterm" id="iddle1357"/><a class="indexterm" id="iddle1763"/>stop our server (once we get it running) by typing <code class="literal">ruby server_file_name.rb</code> or calling <code class="literal">load 'server_file_name.rb'</code> from inside IRB.</p>&#13;
&#13;
      <p>Finally, we talked a little bit about using gems written by other people by visiting the RubyGems website (<span class="emphasis"><em><a class="ulink" href="http://rubygems.org/">http://rubygems.org/</a></em></span>) and reading and sharing code all over the world through the GitHub site (<span class="emphasis"><em><a class="ulink" href="https://github.com/">https://github.com/</a></em></span>). If you want to set up accounts on these sites, grab your nearest adult and ask!</p>&#13;
&#13;
      <p>Our story may be over, gentle reader, but that doesn’t mean I’m quite done blabbering yet. We covered a <span class="emphasis"><em>lot</em></span> of Ruby magic in the last several hundred pages, and I’d be a terrible teacher, writer, and programmer if I just said, “Welp, see ya!” and left it at that. Take a deep breath, turn the page, and let’s spend just a few more sentences going over all the crazy, amazing, wonderful stuff we’ve learned.</p>&#13;
    </div>&#13;
  </div>&#13;
</body></html>